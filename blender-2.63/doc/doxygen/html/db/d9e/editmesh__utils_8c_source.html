<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: editmesh_utils.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">editmesh_utils.c</div>  </div>
</div>
<div class="contents">
<a href="../../db/d9e/editmesh__utils_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2004 by Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): Joseph Eagar</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html">BKE_DerivedMesh.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/BKE__bmesh_8h.html" title="BMesh modeler structure and functions.">BKE_bmesh.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html">BKE_tessmesh.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd6/ED__mesh_8h.html">ED_mesh.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/df1/ED__util_8h.html">ED_util.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/dc9/bmesh_8h.html">bmesh.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d5c/mesh__intern_8h.html">mesh_intern.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a4b7f21d581dc24ed45fcb1429e0c2275">00061</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#afc818d571d27864536e18764e9c44a86">EDBM_mesh_normals_update</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#ac71038cf4336c3efd8a7d2a247091571" title="BMesh Compute Normals.">BM_mesh_normals_update</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a8088299b091fa6500bf5e9595ac2a423">00066</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a1174cc671806c2a153f9018f2447f884">EDBM_mesh_clear</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068     <span class="comment">/* clear bmesh */</span>
<a name="l00069"></a>00069     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#a23edbfcb28dfc8f51e037c8a3b5a2142" title="BMesh Clear Mesh.">BM_mesh_clear</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>);
<a name="l00070"></a>00070     
<a name="l00071"></a>00071     <span class="comment">/* free derived meshes */</span>
<a name="l00072"></a>00072     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a70f4254c9e74e01ae7579dac46585245">derivedCage</a>) {
<a name="l00073"></a>00073         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a70f4254c9e74e01ae7579dac46585245">derivedCage</a>-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a18e4784d6ea7e5877394c53cdfd65691">needsFree</a> = 1;
<a name="l00074"></a>00074         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a70f4254c9e74e01ae7579dac46585245">derivedCage</a>-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a70f4254c9e74e01ae7579dac46585245">derivedCage</a>);
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1e29091bf70bbf487416ed9aff2a1072">derivedFinal</a> &amp;&amp; em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1e29091bf70bbf487416ed9aff2a1072">derivedFinal</a> != em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a70f4254c9e74e01ae7579dac46585245">derivedCage</a>) {
<a name="l00077"></a>00077         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1e29091bf70bbf487416ed9aff2a1072">derivedFinal</a>-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a18e4784d6ea7e5877394c53cdfd65691">needsFree</a> = 1;
<a name="l00078"></a>00078         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1e29091bf70bbf487416ed9aff2a1072">derivedFinal</a>-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1e29091bf70bbf487416ed9aff2a1072">derivedFinal</a>);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080     
<a name="l00081"></a>00081     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a70f4254c9e74e01ae7579dac46585245">derivedCage</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1e29091bf70bbf487416ed9aff2a1072">derivedFinal</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00082"></a>00082     
<a name="l00083"></a>00083     <span class="comment">/* free tessellation data */</span>
<a name="l00084"></a>00084     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#adb1bea95a064e41031e34a5a18b3be21">tottri</a> = 0;
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a569c5a14f9e26ded573dd9a6b848da93">looptris</a>) 
<a name="l00086"></a>00086         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a569c5a14f9e26ded573dd9a6b848da93">looptris</a>);
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#aa4d3bb7b2b3964805dc7460ce50b962e">00089</a> <span class="keywordtype">void</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a6d50b689822f2100a534f508910ed39b">EDBM_stats_update</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <span class="keyword">const</span> <span class="keywordtype">char</span> iter_types[3] = {<a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>,
<a name="l00092"></a>00092                                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>,
<a name="l00093"></a>00093                                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>};
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00096"></a>00096     <a class="code" href="../../da/d7e/structBMElem.html">BMElem</a> *ele;
<a name="l00097"></a>00097     <span class="keywordtype">int</span> *tots[3];
<a name="l00098"></a>00098     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     tots[0] = &amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a63cca38a2559df39fd49e10a02f96f3b">totvertsel</a>;
<a name="l00101"></a>00101     tots[1] = &amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ab7c58bf63d064b3c60054c66d51d193a">totedgesel</a>;
<a name="l00102"></a>00102     tots[2] = &amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a1dd07eb2ac0b586cd437a5a687d11a8a">totfacesel</a>;
<a name="l00103"></a>00103     
<a name="l00104"></a>00104     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a63cca38a2559df39fd49e10a02f96f3b">totvertsel</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ab7c58bf63d064b3c60054c66d51d193a">totedgesel</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a1dd07eb2ac0b586cd437a5a687d11a8a">totfacesel</a> = 0;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l00107"></a>00107         ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, iter_types[i], <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00108"></a>00108         <span class="keywordflow">for</span> ( ; ele; ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l00109"></a>00109             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(ele, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l00110"></a>00110                 (*tots[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])++;
<a name="l00111"></a>00111             }
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#ad9f39fab0decaa7321748a78e05e58d8">00116</a> <span class="keywordtype">int</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a561ee9fbf78e4d1e00c4d60071b3b183">EDBM_op_init</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *bmop, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l00119"></a>00119     va_list list;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     va_start(list, fmt);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a308d8867dbb483689c585adb84c50b0c">BMO_op_vinitf</a>(bm, bmop, fmt, list)) {
<a name="l00124"></a>00124         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Parse error in %s&quot;</span>, __func__);
<a name="l00125"></a>00125         va_end(list);
<a name="l00126"></a>00126         <span class="keywordflow">return</span> 0;
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128     
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (!em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>)
<a name="l00130"></a>00130         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a> = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a2818a2e2d3dcac3ab0b81df2c1ad38c5">BMEdit_Copy</a>(em);
<a name="l00131"></a>00131     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a>++;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     va_end(list);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="keywordflow">return</span> 1;
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment">/* returns 0 on error, 1 on success.  executes and finishes a bmesh operator */</span>
<a name="l00140"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#a3144b7222bb5cee6a4622e4b3e2c1ea1">00140</a> <span class="keywordtype">int</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#ac99aaa31d04c904bb8845e0578133db1">EDBM_op_finish</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *bmop, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keyword">const</span> <span class="keywordtype">int</span> report)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142     <span class="keyword">const</span> <span class="keywordtype">char</span> *errmsg;
<a name="l00143"></a>00143     
<a name="l00144"></a>00144     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, bmop);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7d/bmesh__error_8h.html#af3ed48d074a05f9a2fd69f15dafa314f">BMO_error_get</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;errmsg, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00147"></a>00147         <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *emcopy = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="keywordflow">if</span> (report) {
<a name="l00150"></a>00150             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, errmsg);
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a02b853112680711d30075d378c60e77c">EDBM_mesh_free</a>(em);
<a name="l00154"></a>00154         *em = *emcopy;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(emcopy);
<a name="l00157"></a>00157         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a> = 0;
<a name="l00158"></a>00158         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="comment">/* when copying, tessellation isn&#39;t to for faster copying,</span>
<a name="l00161"></a>00161 <span class="comment">         * but means we need to re-tessellate here */</span>
<a name="l00162"></a>00162         <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a569c5a14f9e26ded573dd9a6b848da93">looptris</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00163"></a>00163             <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#afc0e56c3f54c1f596f823eeb1d723611">BMEdit_RecalcTessellation</a>(em);
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168     <span class="keywordflow">else</span> {
<a name="l00169"></a>00169         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a>--;
<a name="l00170"></a>00170         <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a> &lt; 0) {
<a name="l00171"></a>00171             printf(<span class="stringliteral">&quot;warning: em-&gt;emcopyusers was less then zero.\n&quot;</span>);
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a> &lt;= 0) {
<a name="l00175"></a>00175             <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a6cdbe4b2737c452122bb7d8d777ee0ca">BMEdit_Free</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>);
<a name="l00176"></a>00176             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>);
<a name="l00177"></a>00177             em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#a8a94a16868c3cc821673b99bb096287e">00184</a> <span class="keywordtype">int</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a12387cad667ed9bf79eaf6ab7911db92">EDBM_op_callf</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l00187"></a>00187     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> bmop;
<a name="l00188"></a>00188     va_list list;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     va_start(list, fmt);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a308d8867dbb483689c585adb84c50b0c">BMO_op_vinitf</a>(bm, &amp;bmop, fmt, list)) {
<a name="l00193"></a>00193         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Parse error in %s&quot;</span>, __func__);
<a name="l00194"></a>00194         va_end(list);
<a name="l00195"></a>00195         <span class="keywordflow">return</span> 0;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (!em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>)
<a name="l00199"></a>00199         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a> = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a2818a2e2d3dcac3ab0b81df2c1ad38c5">BMEdit_Copy</a>(em);
<a name="l00200"></a>00200     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a>++;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;bmop);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     va_end(list);
<a name="l00205"></a>00205     <span class="keywordflow">return</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#ac99aaa31d04c904bb8845e0578133db1">EDBM_op_finish</a>(em, &amp;bmop, op, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#a79390c9cd068af2fdb99410c3a376211">00208</a> <span class="keywordtype">int</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a61d1b5be5f4a30c42227d2efba27d8cf">EDBM_op_call_and_selectf</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keyword">const</span> <span class="keywordtype">char</span> *selectslot, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l00211"></a>00211     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> bmop;
<a name="l00212"></a>00212     va_list list;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     va_start(list, fmt);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a308d8867dbb483689c585adb84c50b0c">BMO_op_vinitf</a>(bm, &amp;bmop, fmt, list)) {
<a name="l00217"></a>00217         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Parse error in %s&quot;</span>, __func__);
<a name="l00218"></a>00218         va_end(list);
<a name="l00219"></a>00219         <span class="keywordflow">return</span> 0;
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="keywordflow">if</span> (!em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>)
<a name="l00223"></a>00223         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a> = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a2818a2e2d3dcac3ab0b81df2c1ad38c5">BMEdit_Copy</a>(em);
<a name="l00224"></a>00224     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a>++;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;bmop);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <a class="code" href="../../d5/def/bmesh__marking_8c.html#a38d355744ee2bbd8c413709c693775f4">BM_mesh_elem_hflag_disable_all</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a9c98dbf43c8b979e7c2b4224eaf18c94">BM_EDGE</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a279a53b6bc9b4dd104fa2607f8439075">BM_FACE</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a6a701aef471b7b63bc03f2bba717fe9a" title="BMO_FLAG_BUFFER.">BMO_slot_buffer_hflag_enable</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop, selectslot, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     va_end(list);
<a name="l00233"></a>00233     <span class="keywordflow">return</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#ac99aaa31d04c904bb8845e0578133db1">EDBM_op_finish</a>(em, &amp;bmop, op, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#ab78ca680001b9030e642ddb3d05a484b">00236</a> <span class="keywordtype">int</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a43405c6c953495532aa8433f34dc0002">EDBM_op_call_silentf</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l00239"></a>00239     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> bmop;
<a name="l00240"></a>00240     va_list list;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     va_start(list, fmt);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a308d8867dbb483689c585adb84c50b0c">BMO_op_vinitf</a>(bm, &amp;bmop, fmt, list)) {
<a name="l00245"></a>00245         va_end(list);
<a name="l00246"></a>00246         <span class="keywordflow">return</span> 0;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="keywordflow">if</span> (!em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a>)
<a name="l00250"></a>00250         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7db46958618d22426177fcf8cb7ada55">emcopy</a> = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a2818a2e2d3dcac3ab0b81df2c1ad38c5">BMEdit_Copy</a>(em);
<a name="l00251"></a>00251     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a55d7845d5d5ec619a532544f72140822">emcopyusers</a>++;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;bmop);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     va_end(list);
<a name="l00256"></a>00256     <span class="keywordflow">return</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#ac99aaa31d04c904bb8845e0578133db1">EDBM_op_finish</a>(em, &amp;bmop, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ade742aada07ba78d0ec7fc3f88325c8b">00259</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a022ccedf3a7d9e4fc07d9d14d69935ec">EDBM_selectmode_to_scene</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00262"></a>00262     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00263"></a>00263     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (!em)
<a name="l00266"></a>00266         <span class="keywordflow">return</span>;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a>;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <span class="comment">/* Request redraw of header buttons (to show new select mode) */</span>
<a name="l00271"></a>00271     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a6d45e7088a585f99262267fe26de1b33">ND_TOOLSETTINGS</a>, scene);
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a19004fc0450b2dbe3081eee2281f0568">00274</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ad0ae502cbe75c98b006bf5864e8a5dfe">EDBM_mesh_make</a>(<a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(scene), <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00277"></a>00277     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a>(!me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> &amp;&amp; me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>)) {
<a name="l00280"></a>00280         <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a645f16d2719f8c139e5b37feb5329f4e">BKE_mesh_convert_mfaces_to_mpolys</a>(me);
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     bm = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a8f71e15c2858f216b66c8ee9ba54ef9c">BKE_mesh_to_bmesh</a>(me, ob);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>) {
<a name="l00286"></a>00286         <span class="comment">/* this happens when switching shape keys */</span>
<a name="l00287"></a>00287         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a02b853112680711d30075d378c60e77c">EDBM_mesh_free</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>);
<a name="l00288"></a>00288         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>);
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="comment">/* currently executing operators re-tessellates, so we can avoid doing here</span>
<a name="l00292"></a>00292 <span class="comment">     * but at some point it may need to be added back. */</span>
<a name="l00293"></a>00293 <span class="preprocessor">#if 0</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>    me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a> = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#ab7688f70ca4a703ed2e50bbcb6686ef5">BMEdit_Create</a>(bm, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00295"></a>00295 <span class="preprocessor">#else</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>    me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a> = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#ab7688f70ca4a703ed2e50bbcb6686ef5">BMEdit_Create</a>(bm, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00297"></a>00297 <span class="preprocessor">#endif</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span>
<a name="l00299"></a>00299     me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a92ce22bd230b2db7a2553f8cb2dfaae9">selectmode</a> = ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a>;
<a name="l00300"></a>00300     me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a60da1c4cfed512004a8b694a5372c8ad">mat_nr</a> = (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7f7913949235b61d1cd0b8f343d0cbfc">actcol</a> &gt; 0) ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7f7913949235b61d1cd0b8f343d0cbfc">actcol</a> - 1 : 0;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a54f680d4dbd4335a071103c48125da3b">me</a> = me;
<a name="l00303"></a>00303     me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a815cc66cf41040145259f3b71599309c">ob</a> = ob;
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ac2cce4032ab1faf06c2552388e2e3768">00306</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a49439770c1f71ab91942cc040effcca0">EDBM_mesh_load</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00309"></a>00309     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <a class="code" href="../../d4/da7/bmesh__mesh__conv_8c.html#ad842bcf863e2244f3aec1a1c9a7c84b5">BM_mesh_bm_to_me</a>(bm, me, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="preprocessor">#ifdef USE_TESSFACE_DEFAULT</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span>    <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a935b5b7d16979aed31099dc7024bdbab">BKE_mesh_tessface_calc</a>(me);
<a name="l00315"></a>00315 <span class="preprocessor">#endif</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>}
<a name="l00317"></a>00317 
<a name="l00321"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a20c69a706ed418bcaf313c5e7c235c89">00321</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a02b853112680711d30075d378c60e77c">EDBM_mesh_free</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323     <span class="comment">/* These tables aren&#39;t used yet, so it&#39;s not strictly necessary</span>
<a name="l00324"></a>00324 <span class="comment">     * to &#39;end&#39; them (with &#39;e&#39; param) but if someone tries to start</span>
<a name="l00325"></a>00325 <span class="comment">     * using them, having these in place will save a lot of pain */</span>
<a name="l00326"></a>00326     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a67add616c5fd97f17bf7870d9b05f3f6">mesh_octree_table</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;e&#39;</span>);
<a name="l00327"></a>00327     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a3c8665b18a239636c5f8051e7dc547be">mesh_mirrtopo_table</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="charliteral">&#39;e&#39;</span>);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a6cdbe4b2737c452122bb7d8d777ee0ca">BMEdit_Free</a>(em);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ad9616d92ac3362fa4e305edf3d8333ef">00332</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *tm, <span class="keywordtype">int</span> forvert, <span class="keywordtype">int</span> foredge, <span class="keywordtype">int</span> forface)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(tm);
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordflow">if</span> (forvert) {
<a name="l00337"></a>00337         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00338"></a>00338         <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *ele;
<a name="l00339"></a>00339         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l00340"></a>00340         
<a name="l00341"></a>00341         tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> **) * tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>, <span class="stringliteral">&quot;tm-&gt;vert_index&quot;</span>);
<a name="l00342"></a>00342 
<a name="l00343"></a>00343         ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00344"></a>00344         <span class="keywordflow">for</span> ( ; ele; ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l00345"></a>00345             tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>[i++] = ele;
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="keywordflow">if</span> (foredge) {
<a name="l00350"></a>00350         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00351"></a>00351         <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *ele;
<a name="l00352"></a>00352         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l00353"></a>00353         
<a name="l00354"></a>00354         tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> **) * tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3f12552bb4c91af433df2e26260ac672">totedge</a>, <span class="stringliteral">&quot;tm-&gt;edge_index&quot;</span>);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00357"></a>00357         <span class="keywordflow">for</span> ( ; ele; ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l00358"></a>00358             tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a>[i++] = ele;
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (forface) {
<a name="l00363"></a>00363         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00364"></a>00364         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *ele;
<a name="l00365"></a>00365         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l00366"></a>00366         
<a name="l00367"></a>00367         tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> **) * tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a>, <span class="stringliteral">&quot;tm-&gt;face_index&quot;</span>);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369         ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00370"></a>00370         <span class="keywordflow">for</span> ( ; ele; ele = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l00371"></a>00371             tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a>[i++] = ele;
<a name="l00372"></a>00372         }
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 }
<a name="l00375"></a>00375 
<a name="l00376"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ae05aa0812cc3349ad9c545e57c2f2e70">00376</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *tm)
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>) {
<a name="l00379"></a>00379         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>);
<a name="l00380"></a>00380         tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a>) {
<a name="l00384"></a>00384         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a>);
<a name="l00385"></a>00385         tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a>) {
<a name="l00389"></a>00389         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a>);
<a name="l00390"></a>00390         tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 }
<a name="l00393"></a>00393 
<a name="l00394"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#acffbdf814a266ccb8bc8bfc028e0511c">00394</a> <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *tm, <span class="keywordtype">int</span> index)
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396     <span class="keywordflow">return</span> tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a> &amp;&amp; index &lt; tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a> ? tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>[index] : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#af598360da677be6de6f0d95ee74f6e2a">00399</a> <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *tm, <span class="keywordtype">int</span> index)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401     <span class="keywordflow">return</span> tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a> &amp;&amp; index &lt; tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3f12552bb4c91af433df2e26260ac672">totedge</a> ? tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a7a253741d6de22177d1c3be4ea210cd3">edge_index</a>[index] : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a9fba1cd666f766cffdbe46911bc727f1">00404</a> <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *tm, <span class="keywordtype">int</span> index)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406     <span class="keywordflow">return</span> (tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a> &amp;&amp; index &lt; tm-&gt;bm-&gt;totface &amp;&amp; index &gt;= 0) ? tm-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#ad20e39dc4d16b0f718b5675246e7354a">face_index</a>[index] : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2ed481d82056e4ca8040c25c2dea603c">00409</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a6a13c21e96dcafdff46182c80a8591c2">EDBM_selectmode_flush_ex</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keywordtype">int</span> selectmode)
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a92ce22bd230b2db7a2553f8cb2dfaae9">selectmode</a> = selectmode;
<a name="l00412"></a>00412     <a class="code" href="../../d5/def/bmesh__marking_8c.html#a2be78c591f24ee32e021a8c9cf1df7d6" title="Select Mode Flush.">BM_mesh_select_mode_flush</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>);
<a name="l00413"></a>00413     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a92ce22bd230b2db7a2553f8cb2dfaae9">selectmode</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a>;
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00416"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a8082d10049a3bee9a902bd246506fe0c">00416</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#afa2daa39e2c58399963b222c607783c1">EDBM_selectmode_flush</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a6a13c21e96dcafdff46182c80a8591c2">EDBM_selectmode_flush_ex</a>(em, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a>);
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a51af29f969020d47f163fd69cd322628">00421</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ac1f1a7187e5e11528c5ab95274abd4b5">EDBM_deselect_flush</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423     <span class="comment">/* function below doesnt use. just do this to keep the values in sync */</span>
<a name="l00424"></a>00424     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a92ce22bd230b2db7a2553f8cb2dfaae9">selectmode</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a>;
<a name="l00425"></a>00425     <a class="code" href="../../d5/def/bmesh__marking_8c.html#ab101cfcebb814ec469b6064effdbdf57">BM_mesh_deselect_flush</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>);
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ad6219cd6f2530b4151ce1b0411e984e0">00429</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a977da939e552e049610ddc52fd98be26">EDBM_select_flush</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     <span class="comment">/* function below doesnt use. just do this to keep the values in sync */</span>
<a name="l00432"></a>00432     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a92ce22bd230b2db7a2553f8cb2dfaae9">selectmode</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a>;
<a name="l00433"></a>00433     <a class="code" href="../../d5/def/bmesh__marking_8c.html#a46495fea8a1cb2ee9d694b8dc5c79fd0">BM_mesh_select_flush</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>);
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ae666229fe9752749953047c042e26596">00436</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a4b3c4d6726e2623707da815b21240047">EDBM_select_more</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> bmop;
<a name="l00439"></a>00439     <span class="keywordtype">int</span> use_faces = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ad937005656381b377e84cf7a3f10073f">BMO_op_initf</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop,
<a name="l00442"></a>00442                  <span class="stringliteral">&quot;regionextend geom=%hvef constrict=%b use_faces=%b&quot;</span>,
<a name="l00443"></a>00443                  <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, use_faces);
<a name="l00444"></a>00444     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop);
<a name="l00445"></a>00445     <span class="comment">/* don&#39;t flush selection in edge/vertex mode  */</span>
<a name="l00446"></a>00446     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a6a701aef471b7b63bc03f2bba717fe9a" title="BMO_FLAG_BUFFER.">BMO_slot_buffer_hflag_enable</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop, <span class="stringliteral">&quot;geomout&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>, use_faces ? <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00447"></a>00447     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a977da939e552e049610ddc52fd98be26">EDBM_select_flush</a>(em);
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2590dde125df4f1d9f051625f867519a">00452</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a2c8a22b098d7e330df6a7c63cd8dfc46">EDBM_select_less</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> bmop;
<a name="l00455"></a>00455     <span class="keywordtype">int</span> use_faces = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ad937005656381b377e84cf7a3f10073f">BMO_op_initf</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop,
<a name="l00458"></a>00458                  <span class="stringliteral">&quot;regionextend geom=%hvef constrict=%b use_faces=%b&quot;</span>,
<a name="l00459"></a>00459                  <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, use_faces);
<a name="l00460"></a>00460     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop);
<a name="l00461"></a>00461     <span class="comment">/* don&#39;t flush selection in edge/vertex mode  */</span>
<a name="l00462"></a>00462     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a1738215546cdb3e92aec2b09328dad3d" title="BMO_FLAG_BUFFER.">BMO_slot_buffer_hflag_disable</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop, <span class="stringliteral">&quot;geomout&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>, use_faces ? <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00463"></a>00463     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;bmop);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#afa2daa39e2c58399963b222c607783c1">EDBM_selectmode_flush</a>(em);
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="../../d3/d5c/mesh__intern_8h.html#ad41c90158b6c2ef698cb56722a5baf36">00468</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ad41c90158b6c2ef698cb56722a5baf36">EDBM_flag_disable_all</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keyword">const</span> <span class="keywordtype">char</span> hflag)
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470     <a class="code" href="../../d5/def/bmesh__marking_8c.html#a38d355744ee2bbd8c413709c693775f4">BM_mesh_elem_hflag_disable_all</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a9c98dbf43c8b979e7c2b4224eaf18c94">BM_EDGE</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a279a53b6bc9b4dd104fa2607f8439075">BM_FACE</a>, hflag, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00473"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a3c89a41bc506fc646e38dbba7302e122">00473</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a91005733b0c49b5af24f2019ceebaee7">EDBM_flag_enable_all</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keyword">const</span> <span class="keywordtype">char</span> hflag)
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475     <a class="code" href="../../d5/def/bmesh__marking_8c.html#ac012ac3b7c7f4eaed6710fbef6884e7b">BM_mesh_elem_hflag_enable_all</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a9c98dbf43c8b979e7c2b4224eaf18c94">BM_EDGE</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a279a53b6bc9b4dd104fa2607f8439075">BM_FACE</a>, hflag, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 <span class="comment">/**************-------------- Undo ------------*****************/</span>
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="comment">/* for callbacks */</span>
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a30c5fe905f96d4ad1eb43eecb2bb3106">00482</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../db/d9e/editmesh__utils_8c.html#a30c5fe905f96d4ad1eb43eecb2bb3106">getEditMesh</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (obedit &amp;&amp; obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l00486"></a>00486         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00487"></a>00487         <span class="keywordflow">return</span> me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>;
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a><a class="code" href="../../da/ddf/structUndoMesh.html">00492</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../da/ddf/structUndoMesh.html">UndoMesh</a> {
<a name="l00493"></a><a class="code" href="../../da/ddf/structUndoMesh.html#a8d9467f0d582272a180b97caa1c83b5d">00493</a>     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> <a class="code" href="../../da/ddf/structUndoMesh.html#a8d9467f0d582272a180b97caa1c83b5d">me</a>;
<a name="l00494"></a><a class="code" href="../../da/ddf/structUndoMesh.html#a715c745b29d896d8ca4203f7f77f5bfd">00494</a>     <span class="keywordtype">int</span> <a class="code" href="../../da/ddf/structUndoMesh.html#a715c745b29d896d8ca4203f7f77f5bfd">selectmode</a>;
<a name="l00495"></a>00495 } <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a837bd9d6d9494506bb76d49335599661">UndoMesh</a>;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 <span class="comment">/* undo simply makes copies of a bmesh */</span>
<a name="l00498"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2967f179101cc77162e1daf5e01235c3">00498</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2967f179101cc77162e1daf5e01235c3">editbtMesh_to_undoMesh</a>(<span class="keywordtype">void</span> *emv, <span class="keywordtype">void</span> *obdata)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = emv;
<a name="l00501"></a>00501     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *obme = obdata;
<a name="l00502"></a>00502     
<a name="l00503"></a>00503     <a class="code" href="../../da/ddf/structUndoMesh.html">UndoMesh</a> *um = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/ddf/structUndoMesh.html">UndoMesh</a>), <span class="stringliteral">&quot;undo Mesh&quot;</span>);
<a name="l00504"></a>00504     
<a name="l00505"></a>00505     <span class="comment">/* make sure shape keys work */</span>
<a name="l00506"></a>00506     um-&gt;<a class="code" href="../../da/ddf/structUndoMesh.html#a8d9467f0d582272a180b97caa1c83b5d">me</a>.<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a> = obme-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a> ? <a class="code" href="../../d5/d17/BKE__key_8h.html#aa9736a2e6a013f517a05414ae65cdb37">copy_key_nolib</a>(obme-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     <span class="comment">/* BM_mesh_validate(em-&gt;bm); */</span> <span class="comment">/* for troubleshooting */</span>
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <a class="code" href="../../d4/da7/bmesh__mesh__conv_8c.html#ad842bcf863e2244f3aec1a1c9a7c84b5">BM_mesh_bm_to_me</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;um-&gt;<a class="code" href="../../da/ddf/structUndoMesh.html#a8d9467f0d582272a180b97caa1c83b5d">me</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     um-&gt;<a class="code" href="../../da/ddf/structUndoMesh.html#a715c745b29d896d8ca4203f7f77f5bfd">selectmode</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a>;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="keywordflow">return</span> um;
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2885412a7414198054b99460bfd9f4f7">00517</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2885412a7414198054b99460bfd9f4f7">undoMesh_to_editbtMesh</a>(<span class="keywordtype">void</span> *umv, <span class="keywordtype">void</span> *em_v, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(obdata))
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = em_v, *em_tmp;
<a name="l00520"></a>00520     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a815cc66cf41040145259f3b71599309c">ob</a>;
<a name="l00521"></a>00521     <a class="code" href="../../da/ddf/structUndoMesh.html">UndoMesh</a> *um = umv;
<a name="l00522"></a>00522     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a749993da86326a6394781cf252d8e903">shapenr</a> = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a33e727e71ff97a478d7704fd5dbeb1b2">shapenr</a>;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a02b853112680711d30075d378c60e77c">EDBM_mesh_free</a>(em);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     bm = <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#a6f9c120579fc0fa39567d1c2add3a21d" title="BMesh Make Mesh.">BM_mesh_create</a>(&amp;<a class="code" href="../../d5/db9/bmesh__mesh_8c.html#a0b96f95bc7f4f95e93d1ac953cd2f041">bm_mesh_allocsize_default</a>);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <a class="code" href="../../d4/da7/bmesh__mesh__conv_8c.html#aa6c2436d946b050362ba8f8c42ef2839">BM_mesh_bm_from_me</a>(bm, &amp;um-&gt;<a class="code" href="../../da/ddf/structUndoMesh.html#a8d9467f0d582272a180b97caa1c83b5d">me</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a749993da86326a6394781cf252d8e903">shapenr</a>);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="comment">/* face normals need recalculation since we are not calling through an operator */</span>
<a name="l00533"></a>00533     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#ac71038cf4336c3efd8a7d2a247091571" title="BMesh Compute Normals.">BM_mesh_normals_update</a>(bm, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     em_tmp = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#ab7688f70ca4a703ed2e50bbcb6686ef5">BMEdit_Create</a>(bm, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00536"></a>00536     *em = *em_tmp;
<a name="l00537"></a>00537     
<a name="l00538"></a>00538     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> = um-&gt;<a class="code" href="../../da/ddf/structUndoMesh.html#a715c745b29d896d8ca4203f7f77f5bfd">selectmode</a>;
<a name="l00539"></a>00539     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a815cc66cf41040145259f3b71599309c">ob</a> = ob;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(em_tmp);
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#adefe53a02b3048ef4ffe6f4537c6f6fd">00544</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d9e/editmesh__utils_8c.html#adefe53a02b3048ef4ffe6f4537c6f6fd">free_undo</a>(<span class="keywordtype">void</span> *me_v)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = me_v;
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>) {
<a name="l00548"></a>00548         <a class="code" href="../../d5/d17/BKE__key_8h.html#a0fbd53478c90d90e72e93775bd6dde4b">free_key</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>);
<a name="l00549"></a>00549         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>);
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a23efebe0b42be7b7066f4d0d1eefe264">free_mesh</a>(me, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00553"></a>00553     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me);
<a name="l00554"></a>00554 }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 <span class="comment">/* and this is all the undo system needs to know */</span>
<a name="l00557"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#aee9666b3774ca3671cc945be5d22e770">00557</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aad056d49e6b316957259001544091ea7">undo_push_mesh</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559     <span class="comment">/* em-&gt;ob gets out of date and crashes on mesh undo,</span>
<a name="l00560"></a>00560 <span class="comment">     * this is an easy way to ensure its OK</span>
<a name="l00561"></a>00561 <span class="comment">     * though we could investigate the matter further. */</span>
<a name="l00562"></a>00562     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00563"></a>00563     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00564"></a>00564     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a815cc66cf41040145259f3b71599309c">ob</a> = obedit;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <a class="code" href="../../d6/df1/ED__util_8h.html#ab72acb872843c87ffaa182ae19ac4b67">undo_editmode_push</a>(C, name, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a30c5fe905f96d4ad1eb43eecb2bb3106">getEditMesh</a>, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#adefe53a02b3048ef4ffe6f4537c6f6fd">free_undo</a>, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2885412a7414198054b99460bfd9f4f7">undoMesh_to_editbtMesh</a>, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2967f179101cc77162e1daf5e01235c3">editbtMesh_to_undoMesh</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 <span class="comment">/* write comment here */</span>
<a name="l00570"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ac57b71bd55e1d484d92f09dc6bfb7a40">00570</a> <a class="code" href="../../dd/de5/structUvVertMap.html">UvVertMap</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#aea75846d02941f59c03e0206c5565d20">EDBM_uv_vert_map_create</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keywordtype">int</span> selected, <span class="keywordtype">int</span> do_face_idx_array, <span class="keywordtype">float</span> *limit)
<a name="l00571"></a>00571 {
<a name="l00572"></a>00572     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *ev;
<a name="l00573"></a>00573     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00574"></a>00574     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00575"></a>00575     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l00576"></a>00576     <span class="comment">/* vars from original func */</span>
<a name="l00577"></a>00577     <a class="code" href="../../dd/de5/structUvVertMap.html">UvVertMap</a> *vmap;
<a name="l00578"></a>00578     <a class="code" href="../../de/db1/structUvMapVert.html">UvMapVert</a> *buf;
<a name="l00579"></a>00579     <span class="comment">/* MTexPoly *tf; */</span> <span class="comment">/* UNUSED */</span>
<a name="l00580"></a>00580     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00581"></a>00581     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a;
<a name="l00582"></a>00582     <span class="keywordtype">int</span> totverts, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, totuv;
<a name="l00583"></a>00583     
<a name="l00584"></a>00584     <span class="keywordflow">if</span> (do_face_idx_array)
<a name="l00585"></a>00585         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(em, 0, 0, 1);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#af3c1d0fa5b86a3ce17293fff3d2d0fcd">BM_mesh_elem_index_ensure</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a>);
<a name="l00588"></a>00588     
<a name="l00589"></a>00589     totverts = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>;
<a name="l00590"></a>00590     totuv = 0;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <span class="comment">/* generate UvMapVert array */</span>
<a name="l00593"></a>00593     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00594"></a>00594         <span class="keywordflow">if</span> (!selected || ((!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)))
<a name="l00595"></a>00595             totuv += efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>;
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (totuv == 0) {
<a name="l00599"></a>00599         <span class="keywordflow">if</span> (do_face_idx_array)
<a name="l00600"></a>00600             <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l00601"></a>00601         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603     vmap = (<a class="code" href="../../dd/de5/structUvVertMap.html">UvVertMap</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*vmap), <span class="stringliteral">&quot;UvVertMap&quot;</span>);
<a name="l00604"></a>00604     <span class="keywordflow">if</span> (!vmap) {
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (do_face_idx_array)
<a name="l00606"></a>00606             <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l00607"></a>00607         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a> = (<a class="code" href="../../de/db1/structUvMapVert.html">UvMapVert</a> **)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>) * totverts, <span class="stringliteral">&quot;UvMapVert_pt&quot;</span>);
<a name="l00611"></a>00611     buf = vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#a486c06bbe288019a842829ae2df79b2b">buf</a> = (<a class="code" href="../../de/db1/structUvMapVert.html">UvMapVert</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#a486c06bbe288019a842829ae2df79b2b">buf</a>) * totuv, <span class="stringliteral">&quot;UvMapVert&quot;</span>);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <span class="keywordflow">if</span> (!vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a> || !vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#a486c06bbe288019a842829ae2df79b2b">buf</a>) {
<a name="l00614"></a>00614         <a class="code" href="../../df/d7f/BKE__mesh_8h.html#aa2e751b5d7199a6addf930ce419e9c0a">free_uv_vert_map</a>(vmap);
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (do_face_idx_array)
<a name="l00616"></a>00616             <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l00617"></a>00617         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619     
<a name="l00620"></a>00620     a = 0;
<a name="l00621"></a>00621     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00622"></a>00622         <span class="keywordflow">if</span> (!selected || ((!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))) {
<a name="l00623"></a>00623             i = 0;
<a name="l00624"></a>00624             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00625"></a>00625                 buf-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a96b53216b44525aed06c2e0a222aa6e6">tfindex</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00626"></a>00626                 buf-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a9351c97a0bd4d0dd1079cf5271c14778">f</a> = a;
<a name="l00627"></a>00627                 buf-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a4baaaecc364af5b2cd693944129b635b">separate</a> = 0;
<a name="l00628"></a>00628                 
<a name="l00629"></a>00629                 buf-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a2977586def755f33556936015b470cc6">next</a> = vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>)];
<a name="l00630"></a>00630                 vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>)] = buf;
<a name="l00631"></a>00631                 
<a name="l00632"></a>00632                 buf++;
<a name="l00633"></a>00633                 i++;
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         a++;
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639     
<a name="l00640"></a>00640     <span class="comment">/* sort individual uvs for each vert */</span>
<a name="l00641"></a>00641     a = 0;
<a name="l00642"></a>00642     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (ev, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l00643"></a>00643         <a class="code" href="../../de/db1/structUvMapVert.html">UvMapVert</a> *newvlist = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *vlist = vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>[a];
<a name="l00644"></a>00644         <a class="code" href="../../de/db1/structUvMapVert.html">UvMapVert</a> *iterv, *v, *lastv, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00645"></a>00645         <span class="keywordtype">float</span> *uv, *uv2, uvdiff[2];
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         <span class="keywordflow">while</span> (vlist) {
<a name="l00648"></a>00648             v = vlist;
<a name="l00649"></a>00649             vlist = vlist-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a2977586def755f33556936015b470cc6">next</a>;
<a name="l00650"></a>00650             v-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a2977586def755f33556936015b470cc6">next</a> = newvlist;
<a name="l00651"></a>00651             newvlist = v;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653             efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(em, v-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a9351c97a0bd4d0dd1079cf5271c14778">f</a>);
<a name="l00654"></a>00654             <span class="comment">/* tf = CustomData_bmesh_get(&amp;em-&gt;bm-&gt;pdata, efa-&gt;head.data, CD_MTEXPOLY); */</span> <span class="comment">/* UNUSED */</span>
<a name="l00655"></a>00655             
<a name="l00656"></a>00656             l = <a class="code" href="../../d1/db3/bmesh__iterators_8c.html#a8a0b0b976bc8f5305864afcf9a599bb5">BM_iter_at_index</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>, efa, v-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a96b53216b44525aed06c2e0a222aa6e6">tfindex</a>);
<a name="l00657"></a>00657             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00658"></a>00658             uv = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00659"></a>00659             
<a name="l00660"></a>00660             lastv = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00661"></a>00661             iterv = vlist;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663             <span class="keywordflow">while</span> (iterv) {
<a name="l00664"></a>00664                 next = iterv-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a2977586def755f33556936015b470cc6">next</a>;
<a name="l00665"></a>00665                 efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(em, iterv-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a9351c97a0bd4d0dd1079cf5271c14778">f</a>);
<a name="l00666"></a>00666                 <span class="comment">/* tf = CustomData_bmesh_get(&amp;em-&gt;bm-&gt;pdata, efa-&gt;head.data, CD_MTEXPOLY); */</span> <span class="comment">/* UNUSED */</span>
<a name="l00667"></a>00667                 
<a name="l00668"></a>00668                 l = <a class="code" href="../../d1/db3/bmesh__iterators_8c.html#a8a0b0b976bc8f5305864afcf9a599bb5">BM_iter_at_index</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>, efa, iterv-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a96b53216b44525aed06c2e0a222aa6e6">tfindex</a>);
<a name="l00669"></a>00669                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00670"></a>00670                 uv2 = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00671"></a>00671                 
<a name="l00672"></a>00672                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(uvdiff, uv2, uv);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(uvdiff[0]) &lt; limit[0] &amp;&amp; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(uvdiff[1]) &lt; limit[1]) {
<a name="l00675"></a>00675                     <span class="keywordflow">if</span> (lastv) lastv-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a2977586def755f33556936015b470cc6">next</a> = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00676"></a>00676                     <span class="keywordflow">else</span> vlist = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00677"></a>00677                     iterv-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a2977586def755f33556936015b470cc6">next</a> = newvlist;
<a name="l00678"></a>00678                     newvlist = iterv;
<a name="l00679"></a>00679                 }
<a name="l00680"></a>00680                 <span class="keywordflow">else</span> {
<a name="l00681"></a>00681                     lastv = iterv;
<a name="l00682"></a>00682                 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684                 iterv = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00685"></a>00685             }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687             newvlist-&gt;<a class="code" href="../../de/db1/structUvMapVert.html#a4baaaecc364af5b2cd693944129b635b">separate</a> = 1;
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690         vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>[a] = newvlist;
<a name="l00691"></a>00691         a++;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     
<a name="l00694"></a>00694     <span class="keywordflow">if</span> (do_face_idx_array)
<a name="l00695"></a>00695         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l00696"></a>00696     
<a name="l00697"></a>00697     <span class="keywordflow">return</span> vmap;
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 
<a name="l00701"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2b691d2e838deb8cd44e1aacdf6dd0d5">00701</a> <a class="code" href="../../de/db1/structUvMapVert.html">UvMapVert</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#ae8546caaaa650b1700abfa1a8d0e3481">EDBM_uv_vert_map_at_index</a>(<a class="code" href="../../dd/de5/structUvVertMap.html">UvVertMap</a> *vmap, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v)
<a name="l00702"></a>00702 {
<a name="l00703"></a>00703     <span class="keywordflow">return</span> vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>[v];
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 <span class="comment">/* from editmesh_lib.c in trunk */</span>
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">/* A specialized vert map used by stitch operator */</span>
<a name="l00710"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#aa910daaa16e826ef12015ca74f5bebc9">00710</a> <a class="code" href="../../db/d82/structUvElementMap.html">UvElementMap</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8c285246807828c108526a4b68dbd1ea">EDBM_uv_element_map_create</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keywordtype">int</span> selected, <span class="keywordtype">int</span> do_islands)
<a name="l00711"></a>00711 {
<a name="l00712"></a>00712     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *ev;
<a name="l00713"></a>00713     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00714"></a>00714     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00715"></a>00715     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l00716"></a>00716     <span class="comment">/* vars from original func */</span>
<a name="l00717"></a>00717     <a class="code" href="../../db/d82/structUvElementMap.html">UvElementMap</a> *element_map;
<a name="l00718"></a>00718     <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *buf;
<a name="l00719"></a>00719     <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *islandbuf;
<a name="l00720"></a>00720     <span class="comment">/* island number for faces */</span>
<a name="l00721"></a>00721     <span class="keywordtype">int</span> *island_number;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00724"></a>00724     <span class="keywordtype">int</span> totverts, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, totuv, j, nislands = 0, islandbufsize = 0;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *map;
<a name="l00727"></a>00727     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> **<a class="code" href="../../d3/d1a/smemory_8c.html#ab8d3e2ffc5cefd244b83373a93cc692b">stack</a>;
<a name="l00728"></a>00728     <span class="keywordtype">int</span> stacksize = 0;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#af3c1d0fa5b86a3ce17293fff3d2d0fcd">BM_mesh_elem_index_ensure</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a> | <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a279a53b6bc9b4dd104fa2607f8439075">BM_FACE</a>);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     totverts = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>;
<a name="l00733"></a>00733     totuv = 0;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     island_number = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*stack) * em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a>, <span class="stringliteral">&quot;uv_island_number_face&quot;</span>);
<a name="l00736"></a>00736     <span class="keywordflow">if</span> (!island_number) {
<a name="l00737"></a>00737         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="comment">/* generate UvElement array */</span>
<a name="l00741"></a>00741     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00742"></a>00742         <span class="keywordflow">if</span> (!selected || ((!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)))
<a name="l00743"></a>00743             totuv += efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <span class="keywordflow">if</span> (totuv == 0) {
<a name="l00747"></a>00747         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(island_number);
<a name="l00748"></a>00748         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     element_map = (<a class="code" href="../../db/d82/structUvElementMap.html">UvElementMap</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*element_map), <span class="stringliteral">&quot;UvElementMap&quot;</span>);
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (!element_map) {
<a name="l00752"></a>00752         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(island_number);
<a name="l00753"></a>00753         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ad14f2ef387d634c54b24702b6d721239">totalUVs</a> = totuv;
<a name="l00756"></a>00756     element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a> = (<a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> **)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>) * totverts, <span class="stringliteral">&quot;UvElementVerts&quot;</span>);
<a name="l00757"></a>00757     buf = element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a> = (<a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>) * totuv, <span class="stringliteral">&quot;UvElement&quot;</span>);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordflow">if</span> (!element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a> || !element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>) {
<a name="l00760"></a>00760         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a6bc4a87bc02cc601eccb1a8b49d1978c">EDBM_uv_element_map_free</a>(element_map);
<a name="l00761"></a>00761         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(island_number);
<a name="l00762"></a>00762         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     j = 0;
<a name="l00766"></a>00766     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00767"></a>00767         island_number[j++] = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a0bf0c6384a29a12168d7a62a1497ca07">INVALID_ISLAND</a>;
<a name="l00768"></a>00768         <span class="keywordflow">if</span> (!selected || ((!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))) {
<a name="l00769"></a>00769             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a9b2a8e422a094b146f7dd359475ec303">BM_ITER_ELEM_INDEX</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>, i) {
<a name="l00770"></a>00770                 buf-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a> = l;
<a name="l00771"></a>00771                 buf-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a> = efa;
<a name="l00772"></a>00772                 buf-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> = 0;
<a name="l00773"></a>00773                 buf-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a0bf0c6384a29a12168d7a62a1497ca07">INVALID_ISLAND</a>;
<a name="l00774"></a>00774                 buf-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a02dd85e3ba8235edbb809a64c444295e">tfindex</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776                 buf-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> = element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>)];
<a name="l00777"></a>00777                 element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>)] = buf;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779                 buf++;
<a name="l00780"></a>00780             }
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     <span class="comment">/* sort individual uvs for each vert */</span>
<a name="l00785"></a>00785     i = 0;
<a name="l00786"></a>00786     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (ev, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l00787"></a>00787         <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *newvlist = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *vlist = element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00788"></a>00788         <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *iterv, *v, *lastv, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00789"></a>00789         <span class="keywordtype">float</span> *uv, *uv2, uvdiff[2];
<a name="l00790"></a>00790 
<a name="l00791"></a>00791         <span class="keywordflow">while</span> (vlist) {
<a name="l00792"></a>00792             v = vlist;
<a name="l00793"></a>00793             vlist = vlist-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>;
<a name="l00794"></a>00794             v-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> = newvlist;
<a name="l00795"></a>00795             newvlist = v;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797             l = v-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00798"></a>00798             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00799"></a>00799             uv = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             lastv = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00802"></a>00802             iterv = vlist;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804             <span class="keywordflow">while</span> (iterv) {
<a name="l00805"></a>00805                 next = iterv-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807                 l = iterv-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00808"></a>00808                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00809"></a>00809                 uv2 = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(uvdiff, uv2, uv);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813                 <span class="keywordflow">if</span> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(uvdiff[0]) &lt; <a class="code" href="../../df/d7f/BKE__mesh_8h.html#adc08e719e3f967380f727b3fbce1c952">STD_UV_CONNECT_LIMIT</a> &amp;&amp; <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(uvdiff[1]) &lt; <a class="code" href="../../df/d7f/BKE__mesh_8h.html#adc08e719e3f967380f727b3fbce1c952">STD_UV_CONNECT_LIMIT</a>) {
<a name="l00814"></a>00814                     <span class="keywordflow">if</span> (lastv) lastv-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00815"></a>00815                     <span class="keywordflow">else</span> vlist = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00816"></a>00816                     iterv-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> = newvlist;
<a name="l00817"></a>00817                     newvlist = iterv;
<a name="l00818"></a>00818                 }
<a name="l00819"></a>00819                 <span class="keywordflow">else</span> {
<a name="l00820"></a>00820                     lastv = iterv;
<a name="l00821"></a>00821                 }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823                 iterv = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00824"></a>00824             }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826             newvlist-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> = 1;
<a name="l00827"></a>00827         }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829         element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = newvlist;
<a name="l00830"></a>00830         i++;
<a name="l00831"></a>00831     }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="keywordflow">if</span> (do_islands) {
<a name="l00834"></a>00834         <span class="comment">/* map holds the map from current vmap-&gt;buf to the new, sorted map */</span>
<a name="l00835"></a>00835         map = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*map) * totuv, <span class="stringliteral">&quot;uvelement_remap&quot;</span>);
<a name="l00836"></a>00836         stack = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*stack) * em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a>, <span class="stringliteral">&quot;uv_island_face_stack&quot;</span>);
<a name="l00837"></a>00837         islandbuf = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*islandbuf) * totuv, <span class="stringliteral">&quot;uvelement_island_buffer&quot;</span>);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839         <span class="comment">/* at this point, every UvElement in vert points to a UvElement sharing the same vertex. Now we should sort uv&#39;s in islands. */</span>
<a name="l00840"></a>00840         <span class="keywordflow">for</span> (i = 0; i &lt; totuv; i++) {
<a name="l00841"></a>00841             <span class="keywordflow">if</span> (element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>[i].<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> == <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a0bf0c6384a29a12168d7a62a1497ca07">INVALID_ISLAND</a>) {
<a name="l00842"></a>00842                 element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> = nislands;
<a name="l00843"></a>00843                 stack[0] = element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a>;
<a name="l00844"></a>00844                 island_number[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(stack[0])] = nislands;
<a name="l00845"></a>00845                 stacksize = 1;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847                 <span class="keywordflow">while</span> (stacksize &gt; 0) {
<a name="l00848"></a>00848                     efa = stack[--stacksize];
<a name="l00849"></a>00849 
<a name="l00850"></a>00850                     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00851"></a>00851                         <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element, *initelement = element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>)];
<a name="l00852"></a>00852 
<a name="l00853"></a>00853                         <span class="keywordflow">for</span> (element = initelement; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00854"></a>00854                             <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a>)
<a name="l00855"></a>00855                                 initelement = element;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857                             <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a> == efa) {
<a name="l00858"></a>00858                                 <span class="comment">/* found the uv corresponding to our face and vertex. Now fill it to the buffer */</span>
<a name="l00859"></a>00859                                 element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> = nislands;
<a name="l00860"></a>00860                                 map[element - element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>] = islandbufsize;
<a name="l00861"></a>00861                                 islandbuf[islandbufsize].<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a> = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00862"></a>00862                                 islandbuf[islandbufsize].<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a> = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a>;
<a name="l00863"></a>00863                                 islandbuf[islandbufsize].<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a>;
<a name="l00864"></a>00864                                 islandbuf[islandbufsize].<a class="code" href="../../d6/de7/structUvElement.html#a02dd85e3ba8235edbb809a64c444295e">tfindex</a> = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a02dd85e3ba8235edbb809a64c444295e">tfindex</a>;
<a name="l00865"></a>00865                                 islandbuf[islandbufsize].<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> =  nislands;
<a name="l00866"></a>00866                                 islandbufsize++;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868                                 <span class="keywordflow">for</span> (element = initelement; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00869"></a>00869                                     <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> &amp;&amp; element != initelement)
<a name="l00870"></a>00870                                         <span class="keywordflow">break</span>;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872                                     <span class="keywordflow">if</span> (island_number[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a>)] == <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a0bf0c6384a29a12168d7a62a1497ca07">INVALID_ISLAND</a>) {
<a name="l00873"></a>00873                                         stack[stacksize++] = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a>;
<a name="l00874"></a>00874                                         island_number[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a83b4cf0298393a72e5b0078bd7e5433e">face</a>)] = nislands;
<a name="l00875"></a>00875                                     }
<a name="l00876"></a>00876                                 }
<a name="l00877"></a>00877                                 <span class="keywordflow">break</span>;
<a name="l00878"></a>00878                             }
<a name="l00879"></a>00879                         }
<a name="l00880"></a>00880                     }
<a name="l00881"></a>00881                 }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883                 nislands++;
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887         <span class="comment">/* remap */</span>
<a name="l00888"></a>00888         <span class="keywordflow">for</span> (i = 0; i &lt; em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>; i++) {
<a name="l00889"></a>00889             <span class="comment">/* important since we may do selection only. Some of these may be NULL */</span>
<a name="l00890"></a>00890             <span class="keywordflow">if</span> (element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[i])
<a name="l00891"></a>00891                 element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = &amp;islandbuf[map[element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>]];
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894         element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#acda58a62dcdb4166fd8508e6a2f12d12">islandIndices</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#acda58a62dcdb4166fd8508e6a2f12d12">islandIndices</a>) * nislands, <span class="stringliteral">&quot;UvElementMap_island_indices&quot;</span>);
<a name="l00895"></a>00895         <span class="keywordflow">if</span> (!element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#acda58a62dcdb4166fd8508e6a2f12d12">islandIndices</a>) {
<a name="l00896"></a>00896             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(islandbuf);
<a name="l00897"></a>00897             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(stack);
<a name="l00898"></a>00898             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(map);
<a name="l00899"></a>00899             <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a6bc4a87bc02cc601eccb1a8b49d1978c">EDBM_uv_element_map_free</a>(element_map);
<a name="l00900"></a>00900             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(island_number);
<a name="l00901"></a>00901         }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903         j = 0;
<a name="l00904"></a>00904         <span class="keywordflow">for</span> (i = 0; i &lt; totuv; i++) {
<a name="l00905"></a>00905             <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element = element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>;
<a name="l00906"></a>00906             <span class="keywordflow">if</span> (element == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00907"></a>00907                 islandbuf[map[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]].<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00908"></a>00908             <span class="keywordflow">else</span>
<a name="l00909"></a>00909                 islandbuf[map[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]].<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> = &amp;islandbuf[map[element - element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>]];
<a name="l00910"></a>00910 
<a name="l00911"></a>00911             <span class="keywordflow">if</span> (islandbuf[i].island != j) {
<a name="l00912"></a>00912                 j++;
<a name="l00913"></a>00913                 element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#acda58a62dcdb4166fd8508e6a2f12d12">islandIndices</a>[j] = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00914"></a>00914             }
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919         element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a> = islandbuf;
<a name="l00920"></a>00920         element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a5eb8ac26d2c2d747651f0d6cda302944">totalIslands</a> = nislands;
<a name="l00921"></a>00921         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(stack);
<a name="l00922"></a>00922         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(map);
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(island_number);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     <span class="keywordflow">return</span> element_map;
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a6c7f725093cb9e84a65e99d19480ebdb">00929</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a2a4f08b16da25c48970826ca70fb8e88">EDBM_uv_vert_map_free</a>(<a class="code" href="../../dd/de5/structUvVertMap.html">UvVertMap</a> *vmap)
<a name="l00930"></a>00930 {
<a name="l00931"></a>00931     <span class="keywordflow">if</span> (vmap) {
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#ae34ea626c2d75395c9832990f7a69bf3">vert</a>);
<a name="l00933"></a>00933         <span class="keywordflow">if</span> (vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#a486c06bbe288019a842829ae2df79b2b">buf</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(vmap-&gt;<a class="code" href="../../dd/de5/structUvVertMap.html#a486c06bbe288019a842829ae2df79b2b">buf</a>);
<a name="l00934"></a>00934         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(vmap);
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#adb84db2eef1410d4c05bc599617b4389">00938</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a6bc4a87bc02cc601eccb1a8b49d1978c">EDBM_uv_element_map_free</a>(<a class="code" href="../../db/d82/structUvElementMap.html">UvElementMap</a> *element_map)
<a name="l00939"></a>00939 {
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (element_map) {
<a name="l00941"></a>00941         <span class="keywordflow">if</span> (element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>);
<a name="l00942"></a>00942         <span class="keywordflow">if</span> (element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>);
<a name="l00943"></a>00943         <span class="keywordflow">if</span> (element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#acda58a62dcdb4166fd8508e6a2f12d12">islandIndices</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(element_map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#acda58a62dcdb4166fd8508e6a2f12d12">islandIndices</a>);
<a name="l00944"></a>00944         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(element_map);
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 <span class="comment">/* last_sel, use em-&gt;act_face otherwise get the last selected face in the editselections</span>
<a name="l00949"></a>00949 <span class="comment"> * at the moment, last_sel is mainly useful for making sure the space image dosnt flicker */</span>
<a name="l00950"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#afdbf3d7fb6ff1222935578d2c85cd143">00950</a> <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a5ce2ddb35cc766fbe64a4e7a0eea3e6c">EDBM_mtexpoly_active_get</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> **r_act_efa, <span class="keywordtype">int</span> sloppy)
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00953"></a>00953     
<a name="l00954"></a>00954     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dd6/ED__mesh_8h.html#aee1eae81bbb9df65368016a3c309f21d">EDBM_mtexpoly_check</a>(em))
<a name="l00955"></a>00955         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00956"></a>00956     
<a name="l00957"></a>00957     efa = <a class="code" href="../../d5/def/bmesh__marking_8c.html#a6e02febedf269e86d8f9cb8efedd9500">BM_active_face_get</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, sloppy);
<a name="l00958"></a>00958     
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (efa) {
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (r_act_efa) *r_act_efa = efa;
<a name="l00961"></a>00961         <span class="keywordflow">return</span> <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a80c8c910b6b28425ea8544e07741092c">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <span class="keywordflow">if</span> (r_act_efa) *r_act_efa = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00965"></a>00965     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968 <span class="comment">/* can we edit UV&#39;s for this mesh?*/</span>
<a name="l00969"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a979dd8dace7ac22c855e4a623486da07">00969</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aee1eae81bbb9df65368016a3c309f21d">EDBM_mtexpoly_check</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00970"></a>00970 {
<a name="l00971"></a>00971     <span class="comment">/* some of these checks could be a touch overkill */</span>
<a name="l00972"></a>00972     <span class="keywordflow">return</span> em &amp;&amp; em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a> &amp;&amp; <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a6474531880fa81739ccdb10fdffd1866">CustomData_has_layer</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>) &amp;&amp;
<a name="l00973"></a>00973            <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a6474531880fa81739ccdb10fdffd1866">CustomData_has_layer</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a2be9581f6b8128044da2562996bc96d2">00976</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a61d4c55ca071ef3d68211ebdb3445f78">EDBM_vert_color_check</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00977"></a>00977 {
<a name="l00978"></a>00978     <span class="comment">/* some of these checks could be a touch overkill */</span>
<a name="l00979"></a>00979     <span class="keywordflow">return</span> em &amp;&amp; em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a> &amp;&amp; <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a6474531880fa81739ccdb10fdffd1866">CustomData_has_layer</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#adfdc3d9683ce132f088e8fee80fe6f71">CD_MLOOPCOL</a>);
<a name="l00980"></a>00980 }
<a name="l00981"></a>00981 
<a name="l00982"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ad50180d0653acd9915b050471a7cb40b">00982</a> <span class="keyword">static</span> <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *<a class="code" href="../../db/d9e/editmesh__utils_8c.html#ad50180d0653acd9915b050471a7cb40b">cache_mirr_intptr_as_bmvert</a>(intptr_t *index_lookup, <span class="keywordtype">int</span> index)
<a name="l00983"></a>00983 {
<a name="l00984"></a>00984     intptr_t eve_i = index_lookup[index];
<a name="l00985"></a>00985     <span class="keywordflow">return</span> (eve_i == -1) ? <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : (<a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *)eve_i;
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l01008"></a>01008 <span class="comment">/* BM_SEARCH_MAXDIST is too big, copied from 2.6x MOC_THRESH, should become a</span>
<a name="l01009"></a>01009 <span class="comment"> * preference */</span>
<a name="l01010"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#acd30e54f819b4e819fbc2b2e288a2aa8">01010</a> <span class="preprocessor">#define BM_SEARCH_MAXDIST_MIRR 0.00002f</span>
<a name="l01011"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a37c3f31cbe9d50ee52d888294a9ab737">01011</a> <span class="preprocessor"></span><span class="preprocessor">#define BM_CD_LAYER_ID &quot;__mirror_index&quot;</span>
<a name="l01012"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#af2e45373cd45d7bd64a416246c89e9f2">01012</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8562f3fbedef4b00a94279babfc429f2">EDBM_verts_mirror_cache_begin</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keyword">const</span> <span class="keywordtype">short</span> use_select)
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a54f680d4dbd4335a071103c48125da3b">me</a>;
<a name="l01015"></a>01015     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l01016"></a>01016     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l01017"></a>01017     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v;
<a name="l01018"></a>01018     <span class="keywordtype">int</span> li, topo = 0;
<a name="l01019"></a>01019 
<a name="l01020"></a>01020     <span class="comment">/* one or the other is used depending if topo is enabled */</span>
<a name="l01021"></a>01021     <a class="code" href="../../d4/df5/structBMBVHTree.html">BMBVHTree</a> *tree = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01022"></a>01022     <a class="code" href="../../db/d5d/structMirrTopoStore__t.html">MirrTopoStore_t</a> <a class="code" href="../../d7/d35/meshtools_8c.html#a8786d5aea96d17aa2a4346749a1d1807">mesh_topo_store</a> = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, -1, -1};
<a name="l01023"></a>01023 
<a name="l01024"></a>01024     <span class="keywordflow">if</span> (me &amp;&amp; (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8e2607f7fddc692e3082aac5b180c35e">editflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a8f914757b1b9493014237f078540f8c5">ME_EDIT_MIRROR_TOPO</a>)) {
<a name="l01025"></a>01025         topo = 1;
<a name="l01026"></a>01026     }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028     <span class="keywordflow">if</span> (!em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>) {
<a name="l01029"></a>01029         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(em, 1, 0, 0);
<a name="l01030"></a>01030         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1c1538d8ce0ad34404e9a543cbf25f1f">mirr_free_arrays</a> = 1;
<a name="l01031"></a>01031     }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a75c45b1e5bbcdd8df04afe5203f7752d">CustomData_get_layer_named</a>(&amp;bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5fc86a6f74a7955a2e212b6d90b34245">CD_PROP_INT</a>, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a37c3f31cbe9d50ee52d888294a9ab737">BM_CD_LAYER_ID</a>)) {
<a name="l01034"></a>01034         <a class="code" href="../../de/d02/bmesh__interp_8c.html#a827f52edc33c7021888548854e264d17">BM_data_layer_add_named</a>(bm, &amp;bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5fc86a6f74a7955a2e212b6d90b34245">CD_PROP_INT</a>, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a37c3f31cbe9d50ee52d888294a9ab737">BM_CD_LAYER_ID</a>);
<a name="l01035"></a>01035     }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037     li = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a42d4bac4843a93806cbf4b71a76c2e81">CustomData_get_named_layer_index</a>(&amp;bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5fc86a6f74a7955a2e212b6d90b34245">CD_PROP_INT</a>, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#a37c3f31cbe9d50ee52d888294a9ab737">BM_CD_LAYER_ID</a>);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[li].<a class="code" href="../../d5/d97/structCustomDataLayer.html#a8838b5a61a319759037c096d6b8d9887">flag</a> |= <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#ae4c5bb1e4ffeb49e72f409bd2bfa8479">CD_FLAG_TEMPORARY</a>;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#af3c1d0fa5b86a3ce17293fff3d2d0fcd">BM_mesh_elem_index_ensure</a>(bm, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a>);
<a name="l01042"></a>01042 
<a name="l01043"></a>01043     <span class="keywordflow">if</span> (topo) {
<a name="l01044"></a>01044         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a59f430bdd02e0b8160d247f3b974abad">ED_mesh_mirrtopo_init</a>(me, -1, &amp;mesh_topo_store, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01045"></a>01045     }
<a name="l01046"></a>01046     <span class="keywordflow">else</span> {
<a name="l01047"></a>01047         tree = <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#a48e8437ae244ebfcff2902ddf6b4dcd4">BMBVH_NewBVH</a>(em, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01048"></a>01048     }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l01051"></a>01051 
<a name="l01052"></a>01052         <span class="comment">/* temporary for testing, check for selection */</span>
<a name="l01053"></a>01053         <span class="keywordflow">if</span> (use_select &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l01054"></a>01054             <span class="comment">/* do nothing */</span>
<a name="l01055"></a>01055         }
<a name="l01056"></a>01056         <span class="keywordflow">else</span> {
<a name="l01057"></a>01057             <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *mirr;
<a name="l01058"></a>01058             <span class="keywordtype">int</span> *idx = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab3aafde2f51930adc18fc20d69b506d6">CustomData_bmesh_get_layer_n</a>(&amp;bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#ae60b9e519f421cdd79d5e3309853d7f5">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, li);
<a name="l01059"></a>01059 
<a name="l01060"></a>01060             <span class="keywordflow">if</span> (topo) {
<a name="l01061"></a>01061                 mirr = <a class="code" href="../../db/d9e/editmesh__utils_8c.html#ad50180d0653acd9915b050471a7cb40b">cache_mirr_intptr_as_bmvert</a>(mesh_topo_store.<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a054f4fb9ba516f11630cb85a1a783c19">index_lookup</a>, <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(v));
<a name="l01062"></a>01062             }
<a name="l01063"></a>01063             <span class="keywordflow">else</span> {
<a name="l01064"></a>01064                 <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[3] = {-v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>[0], v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>[1], v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>[2]};
<a name="l01065"></a>01065                 mirr = <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#ad4556f957bb48174bf3e4d9279118b22">BMBVH_FindClosestVert</a>(tree, co, <a class="code" href="../../db/d9e/editmesh__utils_8c.html#acd30e54f819b4e819fbc2b2e288a2aa8">BM_SEARCH_MAXDIST_MIRR</a>);
<a name="l01066"></a>01066             }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068             <span class="keywordflow">if</span> (mirr &amp;&amp; mirr != v) {
<a name="l01069"></a>01069                 *idx = <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(mirr);
<a name="l01070"></a>01070                 idx = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab3aafde2f51930adc18fc20d69b506d6">CustomData_bmesh_get_layer_n</a>(&amp;bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, mirr-&gt;<a class="code" href="../../df/d18/structBMVert.html#ae60b9e519f421cdd79d5e3309853d7f5">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, li);
<a name="l01071"></a>01071                 *idx = <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(v);
<a name="l01072"></a>01072             }
<a name="l01073"></a>01073             <span class="keywordflow">else</span> {
<a name="l01074"></a>01074                 *idx = -1;
<a name="l01075"></a>01075             }
<a name="l01076"></a>01076         }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 
<a name="l01081"></a>01081     <span class="keywordflow">if</span> (topo) {
<a name="l01082"></a>01082         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a9530ab6c17a68f34b530f074bb7dd66f">ED_mesh_mirrtopo_free</a>(&amp;mesh_topo_store);
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084     <span class="keywordflow">else</span> {
<a name="l01085"></a>01085         <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#abd50e6411b00a38414d8401d9d0fbdde">BMBVH_FreeBVH</a>(tree);
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a9d8c135579e97f08c8cc9c74cf4ab3c7">mirror_cdlayer</a> = li;
<a name="l01089"></a>01089 }
<a name="l01090"></a>01090 
<a name="l01091"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a33578f04ec033b80a0cb0d1bba30354b">01091</a> <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a9cc298344377e44c710bb7bd5ff16a6f">EDBM_verts_mirror_get</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v)
<a name="l01092"></a>01092 {
<a name="l01093"></a>01093     <span class="keywordtype">int</span> *mirr = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab3aafde2f51930adc18fc20d69b506d6">CustomData_bmesh_get_layer_n</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#ae60b9e519f421cdd79d5e3309853d7f5">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a9d8c135579e97f08c8cc9c74cf4ab3c7">mirror_cdlayer</a>);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a9d8c135579e97f08c8cc9c74cf4ab3c7">mirror_cdlayer</a> != -1); <span class="comment">/* invalid use */</span>
<a name="l01096"></a>01096 
<a name="l01097"></a>01097     <span class="keywordflow">if</span> (mirr &amp;&amp; *mirr &gt;= 0 &amp;&amp; *mirr &lt; em-&gt;bm-&gt;totvert) {
<a name="l01098"></a>01098         <span class="keywordflow">if</span> (!em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>) {
<a name="l01099"></a>01099             printf(<span class="stringliteral">&quot;err: should only be called between &quot;</span>
<a name="l01100"></a>01100                    <span class="stringliteral">&quot;EDBM_verts_mirror_cache_begin and EDBM_verts_mirror_cache_end&quot;</span>);
<a name="l01101"></a>01101             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01102"></a>01102         }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104         <span class="keywordflow">return</span> em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>[*mirr];
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01108"></a>01108 }
<a name="l01109"></a>01109 
<a name="l01110"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#aa56259eab8cf009c8600324f66ec6a2b">01110</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a135c3886ddcf731c432e91ecde3673d3">EDBM_verts_mirror_cache_clear</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v)
<a name="l01111"></a>01111 {
<a name="l01112"></a>01112     <span class="keywordtype">int</span> *mirr = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab3aafde2f51930adc18fc20d69b506d6">CustomData_bmesh_get_layer_n</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#ae60b9e519f421cdd79d5e3309853d7f5">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a9d8c135579e97f08c8cc9c74cf4ab3c7">mirror_cdlayer</a>);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a9d8c135579e97f08c8cc9c74cf4ab3c7">mirror_cdlayer</a> != -1); <span class="comment">/* invalid use */</span>
<a name="l01115"></a>01115 
<a name="l01116"></a>01116     <span class="keywordflow">if</span> (mirr) {
<a name="l01117"></a>01117         *mirr = -1;
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 }
<a name="l01120"></a>01120 
<a name="l01121"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#aa4c79356f78404e6b0dc44801b2cded4">01121</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa76ecba29f4840071504d2f8d6cba488">EDBM_verts_mirror_cache_end</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l01122"></a>01122 {
<a name="l01123"></a>01123     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a1c1538d8ce0ad34404e9a543cbf25f1f">mirr_free_arrays</a>) {
<a name="l01124"></a>01124         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a>);
<a name="l01125"></a>01125         em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127 
<a name="l01128"></a>01128     em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a9d8c135579e97f08c8cc9c74cf4ab3c7">mirror_cdlayer</a> = -1;
<a name="l01129"></a>01129 }
<a name="l01130"></a>01130 
<a name="l01131"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#ae71d93255049d5c4e4075edf57d866f8">01131</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a0b147d2c3ec2aec47aa11ea258052c5d">EDBM_verts_mirror_apply</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keyword">const</span> <span class="keywordtype">int</span> sel_from, <span class="keyword">const</span> <span class="keywordtype">int</span> sel_to)
<a name="l01132"></a>01132 {
<a name="l01133"></a>01133     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l01134"></a>01134     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a656bd725a28ef8f7a39d482b0fe3363e">vert_index</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01137"></a>01137 
<a name="l01138"></a>01138     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l01139"></a>01139         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) == sel_from) {
<a name="l01140"></a>01140             <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *mirr = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a9cc298344377e44c710bb7bd5ff16a6f">EDBM_verts_mirror_get</a>(em, v);
<a name="l01141"></a>01141             <span class="keywordflow">if</span> (mirr) {
<a name="l01142"></a>01142                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(mirr, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) == sel_to) {
<a name="l01143"></a>01143                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(mirr-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l01144"></a>01144                     mirr-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>[0] *= -1.0f;
<a name="l01145"></a>01145                 }
<a name="l01146"></a>01146             }
<a name="l01147"></a>01147         }
<a name="l01148"></a>01148     }
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 
<a name="l01152"></a>01152 <span class="comment">/* swap is 0 or 1, if 1 it hides not selected */</span>
<a name="l01153"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#afe55657044142bba6dd64bb3a569419a">01153</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a1b4669783a5813f0330e9aff78907bbf">EDBM_mesh_hide</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keywordtype">int</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#a8c6a16881d4ab28d222f7ac896ced037">swap</a>)
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l01156"></a>01156     <a class="code" href="../../da/d7e/structBMElem.html">BMElem</a> *ele;
<a name="l01157"></a>01157     <span class="keywordtype">int</span> itermode;
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <span class="keywordflow">if</span> (em == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>)
<a name="l01162"></a>01162         itermode = <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>;
<a name="l01163"></a>01163     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad6cb358a5c5612c639f998b0601e0865">SCE_SELECT_EDGE</a>)
<a name="l01164"></a>01164         itermode = <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>;
<a name="l01165"></a>01165     <span class="keywordflow">else</span>
<a name="l01166"></a>01166         itermode = <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (ele, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, itermode) {
<a name="l01169"></a>01169         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(ele, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) ^ swap)
<a name="l01170"></a>01170             <a class="code" href="../../d9/d94/bmesh__marking_8h.html#a5e6bbde136e3a1819af4af1b9a2e41c6">BM_elem_hide_set</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, ele, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#afa2daa39e2c58399963b222c607783c1">EDBM_selectmode_flush</a>(em);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     <span class="comment">/* original hide flushing comment (OUTDATED):</span>
<a name="l01176"></a>01176 <span class="comment">     * hide happens on least dominant select mode, and flushes up, not down! (helps preventing errors in subsurf) */</span>
<a name="l01177"></a>01177     <span class="comment">/* - vertex hidden, always means edge is hidden too</span>
<a name="l01178"></a>01178 <span class="comment">     * - edge hidden, always means face is hidden too</span>
<a name="l01179"></a>01179 <span class="comment">     * - face hidden, only set face hide</span>
<a name="l01180"></a>01180 <span class="comment">     * - then only flush back down what&#39;s absolute hidden</span>
<a name="l01181"></a>01181 <span class="comment">     */</span>
<a name="l01182"></a>01182 }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 
<a name="l01185"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#a5ab4aa59369db5eeeea4a91ac14bfd96">01185</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a92276b944f0e6bc1847d13d8f5b5c9f7">EDBM_mesh_reveal</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l01186"></a>01186 {
<a name="l01187"></a>01187     <span class="keyword">const</span> <span class="keywordtype">char</span> iter_types[3] = {<a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>,
<a name="l01188"></a>01188                                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>,
<a name="l01189"></a>01189                                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>};
<a name="l01190"></a>01190 
<a name="l01191"></a>01191     <span class="keywordtype">int</span> sels[3] = {(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>),
<a name="l01192"></a>01192                    (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad6cb358a5c5612c639f998b0601e0865">SCE_SELECT_EDGE</a>),
<a name="l01193"></a>01193                    (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>), };
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l01196"></a>01196     <a class="code" href="../../da/d7e/structBMElem.html">BMElem</a> *ele;
<a name="l01197"></a>01197     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199     <span class="comment">/* Use tag flag to remember what was hidden before all is revealed.</span>
<a name="l01200"></a>01200 <span class="comment">     * BM_ELEM_HIDDEN --&gt; BM_ELEM_TAG */</span>
<a name="l01201"></a>01201     <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l01202"></a>01202         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (ele, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, iter_types[i]) {
<a name="l01203"></a>01203             <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a86447ee04a947592c5b005aea27cebfe">BM_elem_flag_set</a>(ele, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>, <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(ele, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>));
<a name="l01204"></a>01204         }
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207     <span class="comment">/* Reveal everything */</span>
<a name="l01208"></a>01208     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ad41c90158b6c2ef698cb56722a5baf36">EDBM_flag_disable_all</a>(em, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>);
<a name="l01209"></a>01209 
<a name="l01210"></a>01210     <span class="comment">/* Select relevant just-revealed elements */</span>
<a name="l01211"></a>01211     <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l01212"></a>01212         <span class="keywordflow">if</span> (!sels[i]) {
<a name="l01213"></a>01213             <span class="keywordflow">continue</span>;
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (ele, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, iter_types[i]) {
<a name="l01217"></a>01217             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(ele, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>)) {
<a name="l01218"></a>01218                 <a class="code" href="../../d5/def/bmesh__marking_8c.html#a4ae75f0cde91878366054c6aff6d9276">BM_elem_select_set</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, ele, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01219"></a>01219             }
<a name="l01220"></a>01220         }
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#afa2daa39e2c58399963b222c607783c1">EDBM_selectmode_flush</a>(em);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     <span class="comment">/* hidden faces can have invalid normals */</span>
<a name="l01226"></a>01226     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#afc818d571d27864536e18764e9c44a86">EDBM_mesh_normals_update</a>(em);
<a name="l01227"></a>01227 }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="comment">/* so many tools call these that we better make it a generic function.</span>
<a name="l01230"></a>01230 <span class="comment"> */</span>
<a name="l01231"></a><a class="code" href="../../db/d9e/editmesh__utils_8c.html#adcf73e9ed20f6b067b97629752b82eaa">01231</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a13d0b5662b3a6db159da122eaced50ab">EDBM_update_generic</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keyword">const</span> <span class="keywordtype">short</span> do_tessface)
<a name="l01232"></a>01232 {
<a name="l01233"></a>01233     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a815cc66cf41040145259f3b71599309c">ob</a>;
<a name="l01234"></a>01234     <span class="comment">/* order of calling isn&#39;t important */</span>
<a name="l01235"></a>01235     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l01236"></a>01236     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     <span class="keywordflow">if</span> (do_tessface) {
<a name="l01239"></a>01239         <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#afc0e56c3f54c1f596f823eeb1d723611">BMEdit_RecalcTessellation</a>(em);
<a name="l01240"></a>01240     }
<a name="l01241"></a>01241 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:16 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

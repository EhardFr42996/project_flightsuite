<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: view2d_ops.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">view2d_ops.c</div>  </div>
</div>
<div class="contents">
<a href="../../db/d51/view2d__ops_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> * </span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Blender Foundation, Joshua Leung</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de4/DNA__userdef__types_8h.html">DNA_userdef_types.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span> <span class="comment">/* USER_ZOOM_CONT */</span>
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a5094f9627cce4338b2399f649c084548">00056</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a5094f9627cce4338b2399f649c084548">view2d_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     <span class="keywordflow">return</span> (ar != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a39f3bc5c996c526f80c092ba7628b129">V2D_IS_INITIALISED</a>);
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/* ********************************************************* */</span>
<a name="l00064"></a>00064 <span class="comment">/* VIEW PANNING OPERATOR                                 */</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/*  This group of operators come in several forms:</span>
<a name="l00067"></a>00067 <span class="comment"> *      1) Modal &#39;dragging&#39; with MMB - where movement of mouse dictates amount to pan view by</span>
<a name="l00068"></a>00068 <span class="comment"> *      2) Scrollwheel &#39;steps&#39; - rolling mousewheel by one step moves view by predefined amount</span>
<a name="l00069"></a>00069 <span class="comment"> *</span>
<a name="l00070"></a>00070 <span class="comment"> *  In order to make sure this works, each operator must define the following RNA-Operator Props:</span>
<a name="l00071"></a>00071 <span class="comment"> *      deltax, deltay  - define how much to move view by (relative to zoom-correction factor)</span>
<a name="l00072"></a>00072 <span class="comment"> */</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">/* ------------------ Shared &#39;core&#39; stuff ---------------------- */</span>
<a name="l00075"></a>00075  
<a name="l00076"></a>00076 <span class="comment">/* temp customdata for operator */</span>
<a name="l00077"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html">00077</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> {
<a name="l00078"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#adbd4e1216bca578461a1eafa68937ced">00078</a>     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *<a class="code" href="../../d2/dde/structv2dViewPanData.html#adbd4e1216bca578461a1eafa68937ced">sc</a>;            <span class="comment">/* screen where view pan was initiated */</span>
<a name="l00079"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#ac1033c9c3ff071b3099c1a60930ac5f9">00079</a>     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../d2/dde/structv2dViewPanData.html#ac1033c9c3ff071b3099c1a60930ac5f9">sa</a>;            <span class="comment">/* area where view pan was initiated */</span>
<a name="l00080"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#abe4482aefbc0108fe5979027b9f23204">00080</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../d2/dde/structv2dViewPanData.html#abe4482aefbc0108fe5979027b9f23204">ar</a>;            <span class="comment">/* region where view pan was initiated */</span>
<a name="l00081"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">00081</a>     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>;            <span class="comment">/* view2d we&#39;re operating in */</span>
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#ab184b4ef95cce7574adb7e176d58d430">00083</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dde/structv2dViewPanData.html#ae9d871a38e07be281f35d269bee668f1">facx</a>, <a class="code" href="../../d2/dde/structv2dViewPanData.html#ab184b4ef95cce7574adb7e176d58d430">facy</a>;       <span class="comment">/* amount to move view relative to zoom */</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="comment">/* options for version 1 */</span>
<a name="l00086"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a32b4a2847569a783ca4cc097703cab">00086</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/dde/structv2dViewPanData.html#a3003aadaa24f88cc1c9e752ed8cee8da">startx</a>, <a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a32b4a2847569a783ca4cc097703cab">starty</a>;     <span class="comment">/* mouse x/y values in window when operator was initiated */</span>
<a name="l00087"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">00087</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/dde/structv2dViewPanData.html#a5acb36bf282057609aa876a514c4721c">lastx</a>, <a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">lasty</a>;       <span class="comment">/* previous x/y values of mouse in window */</span>
<a name="l00088"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a441bd71ce853bc40a43fca385631fe">00088</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a441bd71ce853bc40a43fca385631fe">invoke_event</a>;       <span class="comment">/* event starting pan, for modal exit */</span>
<a name="l00089"></a>00089     
<a name="l00090"></a><a class="code" href="../../d2/dde/structv2dViewPanData.html#ab662f7e732284d96c5c182df7b5d704d">00090</a>     <span class="keywordtype">short</span> <a class="code" href="../../d2/dde/structv2dViewPanData.html#ab662f7e732284d96c5c182df7b5d704d">in_scroller</a>;      <span class="comment">/* for MMB in scrollers (old feature in past, but now not that useful) */</span>
<a name="l00091"></a>00091 } <a class="code" href="../../db/d51/view2d__ops_8c.html#a0dd8977374e2723be52b76f262409685">v2dViewPanData</a>;
<a name="l00092"></a>00092  
<a name="l00093"></a>00093 <span class="comment">/* initialize panning customdata */</span>
<a name="l00094"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">00094</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00097"></a>00097     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd;
<a name="l00098"></a>00098     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00099"></a>00099     <span class="keywordtype">float</span> winx, winy;
<a name="l00100"></a>00100     
<a name="l00101"></a>00101     <span class="comment">/* regions now have v2d-data by default, so check for region */</span>
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (ar == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00103"></a>00103         <span class="keywordflow">return</span> 0;
<a name="l00104"></a>00104         
<a name="l00105"></a>00105     <span class="comment">/* check if panning is allowed at all */</span>
<a name="l00106"></a>00106     v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00107"></a>00107     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>))
<a name="l00108"></a>00108         <span class="keywordflow">return</span> 0;
<a name="l00109"></a>00109     
<a name="l00110"></a>00110     <span class="comment">/* set custom-data for operator */</span>
<a name="l00111"></a>00111     vpd = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a>), <span class="stringliteral">&quot;v2dViewPanData&quot;</span>);
<a name="l00112"></a>00112     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = vpd;
<a name="l00113"></a>00113     
<a name="l00114"></a>00114     <span class="comment">/* set pointers to owners */</span>
<a name="l00115"></a>00115     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#adbd4e1216bca578461a1eafa68937ced">sc</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l00116"></a>00116     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ac1033c9c3ff071b3099c1a60930ac5f9">sa</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00117"></a>00117     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a> = v2d;
<a name="l00118"></a>00118     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#abe4482aefbc0108fe5979027b9f23204">ar</a> = ar;
<a name="l00119"></a>00119     
<a name="l00120"></a>00120     <span class="comment">/* calculate translation factor - based on size of view */</span>
<a name="l00121"></a>00121     winx = (float)(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> + 1);
<a name="l00122"></a>00122     winy = (float)(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> + 1);
<a name="l00123"></a>00123     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ae9d871a38e07be281f35d269bee668f1">facx</a> = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / winx;
<a name="l00124"></a>00124     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ab184b4ef95cce7574adb7e176d58d430">facy</a> = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) / winy;
<a name="l00125"></a>00125     
<a name="l00126"></a>00126     <span class="keywordflow">return</span> 1;
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">/* apply transform to view (i.e. adjust &#39;cur&#39; rect) */</span>
<a name="l00130"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">00130</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00133"></a>00133     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>;
<a name="l00134"></a>00134     <span class="keywordtype">float</span> dx, dy;
<a name="l00135"></a>00135     
<a name="l00136"></a>00136     <span class="comment">/* calculate amount to move view by */</span>
<a name="l00137"></a>00137     dx = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ae9d871a38e07be281f35d269bee668f1">facx</a> * (float)<a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>);
<a name="l00138"></a>00138     dy = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ab184b4ef95cce7574adb7e176d58d430">facy</a> * (float)<a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>);
<a name="l00139"></a>00139     
<a name="l00140"></a>00140     <span class="comment">/* only move view on an axis if change is allowed */</span>
<a name="l00141"></a>00141     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>) == 0) {
<a name="l00142"></a>00142         v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += dx;
<a name="l00143"></a>00143         v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += dx;
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>) == 0) {
<a name="l00146"></a>00146         v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += dy;
<a name="l00147"></a>00147         v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += dy;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149     
<a name="l00150"></a>00150     <span class="comment">/* validate that view is in valid configuration after this operation */</span>
<a name="l00151"></a>00151     <a class="code" href="../../d5/d63/UI__view2d_8h.html#af75b83105e7573fbdbfd1a6c1e856058">UI_view2d_curRect_validate</a>(v2d);
<a name="l00152"></a>00152     
<a name="l00153"></a>00153     <span class="comment">/* request updates to be done... */</span>
<a name="l00154"></a>00154     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#abe4482aefbc0108fe5979027b9f23204">ar</a>);
<a name="l00155"></a>00155     
<a name="l00156"></a>00156     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#adbd4e1216bca578461a1eafa68937ced">sc</a>, vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ac1033c9c3ff071b3099c1a60930ac5f9">sa</a>, v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l00157"></a>00157     
<a name="l00158"></a>00158     <span class="comment">/* exceptions */</span>
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ac1033c9c3ff071b3099c1a60930ac5f9">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>) {
<a name="l00160"></a>00160         <span class="comment">/* don&#39;t rebuild full tree, since we&#39;re just changing our view */</span>
<a name="l00161"></a>00161         <a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *soops = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#ac1033c9c3ff071b3099c1a60930ac5f9">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00162"></a>00162         soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#afa5f6723bdfa80b2c1b91dcd74942d21">storeflag</a> |= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75887cd4f4fe3e6149b78e43230360a5">SO_TREESTORE_REDRAW</a>;
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">/* cleanup temp customdata  */</span>
<a name="l00167"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">00167</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>) {
<a name="l00170"></a>00170         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l00171"></a>00171         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173 } 
<a name="l00174"></a>00174  
<a name="l00175"></a>00175 <span class="comment">/* ------------------ Modal Drag Version (1) ---------------------- */</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">/* for &#39;redo&#39; only, with no user input */</span>
<a name="l00178"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a72dd3a404ed85f3ec2ee91dae53a056a">00178</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a72dd3a404ed85f3ec2ee91dae53a056a">view_pan_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(C, op))
<a name="l00181"></a>00181         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00182"></a>00182     
<a name="l00183"></a>00183     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00184"></a>00184     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00185"></a>00185     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="comment">/* set up modal operator and relevant settings */</span>
<a name="l00189"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#aec6f4231c5cb5b52984d4240f9b00dc6">00189</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#aec6f4231c5cb5b52984d4240f9b00dc6">view_pan_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00192"></a>00192     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd;
<a name="l00193"></a>00193     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00194"></a>00194     
<a name="l00195"></a>00195     <span class="comment">/* set up customdata */</span>
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(C, op))
<a name="l00197"></a>00197         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00198"></a>00198     
<a name="l00199"></a>00199     vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00200"></a>00200     v2d = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>;
<a name="l00201"></a>00201     
<a name="l00202"></a>00202     <span class="comment">/* set initial settings */</span>
<a name="l00203"></a>00203     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3003aadaa24f88cc1c9e752ed8cee8da">startx</a> = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5acb36bf282057609aa876a514c4721c">lastx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l00204"></a>00204     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a32b4a2847569a783ca4cc097703cab">starty</a> = vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">lasty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l00205"></a>00205     vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a441bd71ce853bc40a43fca385631fe">invoke_event</a> = <span class="keyword">event</span>-&gt;type;
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a65f114370656971c14863717d5364176">MOUSEPAN</a>) {
<a name="l00208"></a>00208         <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>);
<a name="l00209"></a>00209         <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l00210"></a>00210         
<a name="l00211"></a>00211         <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00212"></a>00212         <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00213"></a>00213         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215     
<a name="l00216"></a>00216     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0);
<a name="l00217"></a>00217     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0);
<a name="l00218"></a>00218     
<a name="l00219"></a>00219     <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>)
<a name="l00220"></a>00220         <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(window, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9baf692e6e9cba3ec86430dd42ac011dba1">BC_NS_SCROLLCURSOR</a>);
<a name="l00221"></a>00221     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>)
<a name="l00222"></a>00222         <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(window, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9ba66cd47f5b5b8c10426fc21db81c197c1">BC_EW_SCROLLCURSOR</a>);
<a name="l00223"></a>00223     <span class="keywordflow">else</span>
<a name="l00224"></a>00224         <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(window, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9baaa57a16b408a2323b90a0c1ab099c6ab">BC_NSEW_SCROLLCURSOR</a>);
<a name="l00225"></a>00225     
<a name="l00226"></a>00226     <span class="comment">/* add temp handler */</span>
<a name="l00227"></a>00227     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="comment">/* handle user input - calculations of mouse-movement need to be done here, not in the apply callback! */</span>
<a name="l00233"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a73e0ca726c78bc56047c40aaece43d89">00233</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a73e0ca726c78bc56047c40aaece43d89">view_pan_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00236"></a>00236     
<a name="l00237"></a>00237     <span class="comment">/* execute the events */</span>
<a name="l00238"></a>00238     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l00239"></a>00239         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l00240"></a>00240         {
<a name="l00241"></a>00241             <span class="comment">/* calculate new delta transform, then store mouse-coordinates for next-time */</span>
<a name="l00242"></a>00242             <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5acb36bf282057609aa876a514c4721c">lastx</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>));
<a name="l00243"></a>00243             <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">lasty</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>));
<a name="l00244"></a>00244             
<a name="l00245"></a>00245             vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5acb36bf282057609aa876a514c4721c">lastx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l00246"></a>00246             vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">lasty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l00247"></a>00247             
<a name="l00248"></a>00248             <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250         <span class="keywordflow">break</span>;
<a name="l00251"></a>00251             <span class="comment">/* XXX - Mode switching isn&#39;t implemented. See comments in 36818.</span>
<a name="l00252"></a>00252 <span class="comment">             * switch to zoom */</span>
<a name="l00253"></a>00253 <span class="preprocessor">#if 0</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l00255"></a>00255             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l00256"></a>00256                 <span class="comment">/* calculate overall delta mouse-movement for redo */</span>
<a name="l00257"></a>00257                 <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3003aadaa24f88cc1c9e752ed8cee8da">startx</a> - vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5acb36bf282057609aa876a514c4721c">lastx</a>));
<a name="l00258"></a>00258                 <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a32b4a2847569a783ca4cc097703cab">starty</a> - vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">lasty</a>));
<a name="l00259"></a>00259                 
<a name="l00260"></a>00260                 <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00261"></a>00261                 <a class="code" href="../../de/d3c/wm__cursors_8c.html#ab8500ccfbffb6b57f4e0645e0f9a4759">WM_cursor_restore</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l00262"></a>00262                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, <span class="stringliteral">&quot;VIEW2D_OT_zoom&quot;</span>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00263"></a>00263                 <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00264"></a>00264             }
<a name="l00265"></a>00265 <span class="preprocessor">#endif</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span>        <span class="keywordflow">default</span>:
<a name="l00267"></a>00267             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a441bd71ce853bc40a43fca385631fe">invoke_event</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l00268"></a>00268                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l00269"></a>00269                     <span class="comment">/* calculate overall delta mouse-movement for redo */</span>
<a name="l00270"></a>00270                     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3003aadaa24f88cc1c9e752ed8cee8da">startx</a> - vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5acb36bf282057609aa876a514c4721c">lastx</a>));
<a name="l00271"></a>00271                     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a3a32b4a2847569a783ca4cc097703cab">starty</a> - vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a4cf24a69fb3fccb3a115f638085c68fa">lasty</a>));
<a name="l00272"></a>00272                     
<a name="l00273"></a>00273                     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00274"></a>00274                     <a class="code" href="../../de/d3c/wm__cursors_8c.html#ab8500ccfbffb6b57f4e0645e0f9a4759">WM_cursor_restore</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l00275"></a>00275                     
<a name="l00276"></a>00276                     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00277"></a>00277                 }
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279             <span class="keywordflow">break</span>;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a1836d68fde920af6d9be457c825d8cc9">00285</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a1836d68fde920af6d9be457c825d8cc9">view_pan_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00288"></a>00288     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a4383a69b8eecd7c1ea128bf2f5becf74">00291</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a4383a69b8eecd7c1ea128bf2f5becf74">VIEW2D_OT_pan</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <span class="comment">/* identifiers */</span>
<a name="l00294"></a>00294     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Pan View&quot;</span>;
<a name="l00295"></a>00295     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Pan the view&quot;</span>;
<a name="l00296"></a>00296     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_pan&quot;</span>;
<a name="l00297"></a>00297     
<a name="l00298"></a>00298     <span class="comment">/* api callbacks */</span>
<a name="l00299"></a>00299     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a72dd3a404ed85f3ec2ee91dae53a056a">view_pan_exec</a>;
<a name="l00300"></a>00300     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#aec6f4231c5cb5b52984d4240f9b00dc6">view_pan_invoke</a>;
<a name="l00301"></a>00301     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a73e0ca726c78bc56047c40aaece43d89">view_pan_modal</a>;
<a name="l00302"></a>00302     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a1836d68fde920af6d9be457c825d8cc9">view_pan_cancel</a>;
<a name="l00303"></a>00303     
<a name="l00304"></a>00304     <span class="comment">/* operator is modal */</span>
<a name="l00305"></a>00305     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#ac9470de8419174a032e9097a5ec317fd">OPTYPE_GRAB_POINTER</a>;
<a name="l00306"></a>00306     
<a name="l00307"></a>00307     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00308"></a>00308     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00309"></a>00309     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">/* ------------------ Scrollwheel Versions (2) ---------------------- */</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">/* this operator only needs this single callback, where it callsthe view_pan_*() methods */</span>
<a name="l00315"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a7b51edd7eee610c7b2ee45b592391994">00315</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a7b51edd7eee610c7b2ee45b592391994">view_scrollright_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd;
<a name="l00318"></a>00318     
<a name="l00319"></a>00319     <span class="comment">/* initialize default settings (and validate if ok to run) */</span>
<a name="l00320"></a>00320     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(C, op))
<a name="l00321"></a>00321         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00322"></a>00322         
<a name="l00323"></a>00323     <span class="comment">/* also, check if can pan in horizontal axis */</span>
<a name="l00324"></a>00324     vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>) {
<a name="l00326"></a>00326         <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00327"></a>00327         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329     
<a name="l00330"></a>00330     <span class="comment">/* set RNA-Props - only movement in positive x-direction */</span>
<a name="l00331"></a>00331     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 20);
<a name="l00332"></a>00332     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0);
<a name="l00333"></a>00333     
<a name="l00334"></a>00334     <span class="comment">/* apply movement, then we&#39;re done */</span>
<a name="l00335"></a>00335     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00336"></a>00336     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00337"></a>00337     
<a name="l00338"></a>00338     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#ac3746ea42dc1c87459cec45d1d9d5000">00341</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#ac3746ea42dc1c87459cec45d1d9d5000">VIEW2D_OT_scroll_right</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343     <span class="comment">/* identifiers */</span>
<a name="l00344"></a>00344     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Scroll Right&quot;</span>;
<a name="l00345"></a>00345     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Scroll the view right&quot;</span>;
<a name="l00346"></a>00346     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_scroll_right&quot;</span>;
<a name="l00347"></a>00347     
<a name="l00348"></a>00348     <span class="comment">/* api callbacks */</span>
<a name="l00349"></a>00349     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a7b51edd7eee610c7b2ee45b592391994">view_scrollright_exec</a>;
<a name="l00350"></a>00350     
<a name="l00351"></a>00351     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00352"></a>00352     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00353"></a>00353     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">/* this operator only needs this single callback, where it callsthe view_pan_*() methods */</span>
<a name="l00359"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a344db906b8ae49f68e7c5fa10d3dbcb4">00359</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a344db906b8ae49f68e7c5fa10d3dbcb4">view_scrollleft_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00360"></a>00360 {
<a name="l00361"></a>00361     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd;
<a name="l00362"></a>00362     
<a name="l00363"></a>00363     <span class="comment">/* initialize default settings (and validate if ok to run) */</span>
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(C, op))
<a name="l00365"></a>00365         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00366"></a>00366         
<a name="l00367"></a>00367     <span class="comment">/* also, check if can pan in horizontal axis */</span>
<a name="l00368"></a>00368     vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00369"></a>00369     <span class="keywordflow">if</span> (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>) {
<a name="l00370"></a>00370         <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00371"></a>00371         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373     
<a name="l00374"></a>00374     <span class="comment">/* set RNA-Props - only movement in negative x-direction */</span>
<a name="l00375"></a>00375     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, -20);
<a name="l00376"></a>00376     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0);
<a name="l00377"></a>00377     
<a name="l00378"></a>00378     <span class="comment">/* apply movement, then we&#39;re done */</span>
<a name="l00379"></a>00379     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00380"></a>00380     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00381"></a>00381     
<a name="l00382"></a>00382     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a138231d4d2d0ae8a67978755df4eb87a">00385</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a138231d4d2d0ae8a67978755df4eb87a">VIEW2D_OT_scroll_left</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387     <span class="comment">/* identifiers */</span>
<a name="l00388"></a>00388     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Scroll Left&quot;</span>;
<a name="l00389"></a>00389     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Scroll the view left&quot;</span>;
<a name="l00390"></a>00390     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_scroll_left&quot;</span>;
<a name="l00391"></a>00391     
<a name="l00392"></a>00392     <span class="comment">/* api callbacks */</span>
<a name="l00393"></a>00393     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a344db906b8ae49f68e7c5fa10d3dbcb4">view_scrollleft_exec</a>;
<a name="l00394"></a>00394     
<a name="l00395"></a>00395     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00396"></a>00396     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00397"></a>00397     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="comment">/* this operator only needs this single callback, where it callsthe view_pan_*() methods */</span>
<a name="l00402"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a1c6667ab85e667d057d65b5436978937">00402</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a1c6667ab85e667d057d65b5436978937">view_scrolldown_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd;
<a name="l00405"></a>00405     
<a name="l00406"></a>00406     <span class="comment">/* initialize default settings (and validate if ok to run) */</span>
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(C, op))
<a name="l00408"></a>00408         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00409"></a>00409         
<a name="l00410"></a>00410     <span class="comment">/* also, check if can pan in vertical axis */</span>
<a name="l00411"></a>00411     vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>) {
<a name="l00413"></a>00413         <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00414"></a>00414         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416     
<a name="l00417"></a>00417     <span class="comment">/* set RNA-Props */</span>
<a name="l00418"></a>00418     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0);
<a name="l00419"></a>00419     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, -40);
<a name="l00420"></a>00420     
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;page&quot;</span>)) {
<a name="l00422"></a>00422         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00423"></a>00423         <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>);
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425     
<a name="l00426"></a>00426     <span class="comment">/* apply movement, then we&#39;re done */</span>
<a name="l00427"></a>00427     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00428"></a>00428     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00429"></a>00429     
<a name="l00430"></a>00430     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00433"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a372ece836bde537958a9b36606902c6c">00433</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a372ece836bde537958a9b36606902c6c">VIEW2D_OT_scroll_down</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00434"></a>00434 {
<a name="l00435"></a>00435     <span class="comment">/* identifiers */</span>
<a name="l00436"></a>00436     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Scroll Down&quot;</span>;
<a name="l00437"></a>00437     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Scroll the view down&quot;</span>;
<a name="l00438"></a>00438     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_scroll_down&quot;</span>;
<a name="l00439"></a>00439     
<a name="l00440"></a>00440     <span class="comment">/* api callbacks */</span>
<a name="l00441"></a>00441     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a1c6667ab85e667d057d65b5436978937">view_scrolldown_exec</a>;
<a name="l00442"></a>00442     
<a name="l00443"></a>00443     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00444"></a>00444     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00445"></a>00445     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00446"></a>00446     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;page&quot;</span>, 0, <span class="stringliteral">&quot;Page&quot;</span>, <span class="stringliteral">&quot;Scroll down one page&quot;</span>);
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 <span class="comment">/* this operator only needs this single callback, where it callsthe view_pan_*() methods */</span>
<a name="l00452"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a11e1a2bb65b49b74ceae8a82f0394295">00452</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a11e1a2bb65b49b74ceae8a82f0394295">view_scrollup_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <a class="code" href="../../d2/dde/structv2dViewPanData.html">v2dViewPanData</a> *vpd;
<a name="l00455"></a>00455     
<a name="l00456"></a>00456     <span class="comment">/* initialize default settings (and validate if ok to run) */</span>
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a8002aefc224eae6a5f4fc6a856ceaee2">view_pan_init</a>(C, op))
<a name="l00458"></a>00458         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00459"></a>00459         
<a name="l00460"></a>00460     <span class="comment">/* also, check if can pan in vertical axis */</span>
<a name="l00461"></a>00461     vpd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (vpd-&gt;<a class="code" href="../../d2/dde/structv2dViewPanData.html#a5818aa54a83418758b51cb00cb31e63c">v2d</a>-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>) {
<a name="l00463"></a>00463         <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00464"></a>00464         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466     
<a name="l00467"></a>00467     <span class="comment">/* set RNA-Props */</span>
<a name="l00468"></a>00468     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0);
<a name="l00469"></a>00469     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 40);
<a name="l00470"></a>00470     
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;page&quot;</span>)) {
<a name="l00472"></a>00472         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00473"></a>00473         <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475     
<a name="l00476"></a>00476     <span class="comment">/* apply movement, then we&#39;re done */</span>
<a name="l00477"></a>00477     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4760dad0de53ee3111f16a11242552f8">view_pan_apply</a>(op);
<a name="l00478"></a>00478     <a class="code" href="../../db/d51/view2d__ops_8c.html#a77903d86a50947f6461b8179385c301e">view_pan_exit</a>(op);
<a name="l00479"></a>00479     
<a name="l00480"></a>00480     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a0627f33759dff7917f7c367a6fc1b8d2">00483</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0627f33759dff7917f7c367a6fc1b8d2">VIEW2D_OT_scroll_up</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485     <span class="comment">/* identifiers */</span>
<a name="l00486"></a>00486     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Scroll Up&quot;</span>;
<a name="l00487"></a>00487     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Scroll the view up&quot;</span>;
<a name="l00488"></a>00488     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_scroll_up&quot;</span>;
<a name="l00489"></a>00489     
<a name="l00490"></a>00490     <span class="comment">/* api callbacks */</span>
<a name="l00491"></a>00491     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a11e1a2bb65b49b74ceae8a82f0394295">view_scrollup_exec</a>;
<a name="l00492"></a>00492     
<a name="l00493"></a>00493     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00494"></a>00494     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00495"></a>00495     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Delta Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l00496"></a>00496     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;page&quot;</span>, 0, <span class="stringliteral">&quot;Page&quot;</span>, <span class="stringliteral">&quot;Scroll up one page&quot;</span>);
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="comment">/* ********************************************************* */</span>
<a name="l00500"></a>00500 <span class="comment">/* SINGLE-STEP VIEW ZOOMING OPERATOR                         */</span>
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">/*  This group of operators come in several forms:</span>
<a name="l00503"></a>00503 <span class="comment"> *      1) Scrollwheel &#39;steps&#39; - rolling mousewheel by one step zooms view by predefined amount</span>
<a name="l00504"></a>00504 <span class="comment"> *      2) Scrollwheel &#39;steps&#39; + alt + ctrl/shift - zooms view on one axis only (ctrl=x, shift=y)  // XXX this could be implemented...</span>
<a name="l00505"></a>00505 <span class="comment"> *      3) Pad +/- Keys - pressing each key moves the zooms the view by a predefined amount</span>
<a name="l00506"></a>00506 <span class="comment"> *</span>
<a name="l00507"></a>00507 <span class="comment"> *  In order to make sure this works, each operator must define the following RNA-Operator Props:</span>
<a name="l00508"></a>00508 <span class="comment"> *      zoomfacx, zoomfacy  - These two zoom factors allow for non-uniform scaling.</span>
<a name="l00509"></a>00509 <span class="comment"> *                            It is safe to scale by 0, as these factors are used to determine</span>
<a name="l00510"></a>00510 <span class="comment"> *                            amount to enlarge &#39;cur&#39; by</span>
<a name="l00511"></a>00511 <span class="comment"> */</span>
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 <span class="comment">/* ------------------ &#39;Shared&#39; stuff ------------------------ */</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="comment">/* temp customdata for operator */</span>
<a name="l00516"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html">00516</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> {
<a name="l00517"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a7b96ceb4febf8b119bff19e6542d6f15">00517</a>     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a7b96ceb4febf8b119bff19e6542d6f15">v2d</a>;            <span class="comment">/* view2d we&#39;re operating in */</span>
<a name="l00518"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a53ded60a25586833dd3e5a722b6a49be">00518</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a53ded60a25586833dd3e5a722b6a49be">ar</a>;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">/* needed for continuous zoom */</span>
<a name="l00521"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2b81f7de9c6270917a2df9fc787ad914">00521</a>     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2b81f7de9c6270917a2df9fc787ad914">timer</a>;
<a name="l00522"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">00522</a>     <span class="keywordtype">double</span> <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">timer_lastdraw</a>;
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">00524</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a5b2efbc128a3ee8eff868f73fad9efc6">lastx</a>, <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">lasty</a>;       <span class="comment">/* previous x/y values of mouse in window */</span>
<a name="l00525"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a08172b83a3e7ce668b826305e54f842a">00525</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a08172b83a3e7ce668b826305e54f842a">invoke_event</a>;       <span class="comment">/* event type that invoked, for modal exits */</span>
<a name="l00526"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a47bdff79ca72da502eba0e69a6df7eb0">00526</a>     <span class="keywordtype">float</span> <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a910f214de6dc86d9ef3587f334c9c3c5">dx</a>, <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a47bdff79ca72da502eba0e69a6df7eb0">dy</a>;           <span class="comment">/* running tally of previous delta values (for obtaining final zoom) */</span>
<a name="l00527"></a><a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">00527</a>     <span class="keywordtype">float</span> <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2db622c90cde9c3594b1f71be234e136">mx_2d</a>, <a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">my_2d</a>;     <span class="comment">/* initial mouse location in v2d coords */</span>
<a name="l00528"></a>00528 } <a class="code" href="../../db/d51/view2d__ops_8c.html#a99aeae7f37e529292b9d24d31e7d5402">v2dViewZoomData</a>;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="comment">/* initialize panning customdata */</span>
<a name="l00532"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a2c190be1a24137e23be90459fcad7615">00532</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a2c190be1a24137e23be90459fcad7615">view_zoomdrag_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00535"></a>00535     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd;
<a name="l00536"></a>00536     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00537"></a>00537     
<a name="l00538"></a>00538     <span class="comment">/* regions now have v2d-data by default, so check for region */</span>
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (ar == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00540"></a>00540         <span class="keywordflow">return</span> 0;
<a name="l00541"></a>00541     v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00542"></a>00542     
<a name="l00543"></a>00543     <span class="comment">/* check that 2d-view is zoomable */</span>
<a name="l00544"></a>00544     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>))
<a name="l00545"></a>00545         <span class="keywordflow">return</span> 0;
<a name="l00546"></a>00546     
<a name="l00547"></a>00547     <span class="comment">/* set custom-data for operator */</span>
<a name="l00548"></a>00548     vzd = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a>), <span class="stringliteral">&quot;v2dViewZoomData&quot;</span>);
<a name="l00549"></a>00549     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = vzd;
<a name="l00550"></a>00550     
<a name="l00551"></a>00551     <span class="comment">/* set pointers to owners */</span>
<a name="l00552"></a>00552     vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a7b96ceb4febf8b119bff19e6542d6f15">v2d</a> = v2d;
<a name="l00553"></a>00553     vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a53ded60a25586833dd3e5a722b6a49be">ar</a> = ar;
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     <span class="keywordflow">return</span> 1;
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">/* check if step-zoom can be applied */</span>
<a name="l00559"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">00559</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00562"></a>00562     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00563"></a>00563     
<a name="l00564"></a>00564     <span class="comment">/* check if there&#39;s a region in context to work with */</span>
<a name="l00565"></a>00565     <span class="keywordflow">if</span> (ar == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00566"></a>00566         <span class="keywordflow">return</span> 0;
<a name="l00567"></a>00567     v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00568"></a>00568     
<a name="l00569"></a>00569     <span class="comment">/* check that 2d-view is zoomable */</span>
<a name="l00570"></a>00570     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>))
<a name="l00571"></a>00571         <span class="keywordflow">return</span> 0;
<a name="l00572"></a>00572         
<a name="l00573"></a>00573     <span class="comment">/* view is zoomable */</span>
<a name="l00574"></a>00574     <span class="keywordflow">return</span> 1;
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576  
<a name="l00577"></a>00577 <span class="comment">/* apply transform to view (i.e. adjust &#39;cur&#39; rect) */</span>
<a name="l00578"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a4108cca004c1a4b1a95d5f9c484a5893">00578</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a4108cca004c1a4b1a95d5f9c484a5893">view_zoomstep_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00581"></a>00581     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00582"></a>00582     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00583"></a>00583     <span class="keywordtype">float</span> dx, dy, facx, facy;
<a name="l00584"></a>00584     
<a name="l00585"></a>00585     <span class="comment">/* calculate amount to move view by, ensuring symmetry so the</span>
<a name="l00586"></a>00586 <span class="comment">     * old zoom level is restored after zooming back the same amount </span>
<a name="l00587"></a>00587 <span class="comment">     */</span>
<a name="l00588"></a>00588     facx = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;zoomfacx&quot;</span>);
<a name="l00589"></a>00589     facy = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;zoomfacy&quot;</span>);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (facx &gt;= 0.0f) {
<a name="l00592"></a>00592         dx = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) * facx;
<a name="l00593"></a>00593         dy = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) * facy;
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595     <span class="keywordflow">else</span> {
<a name="l00596"></a>00596         dx = ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / (1.0f + 2.0f * facx)) * facx;
<a name="l00597"></a>00597         dy = ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) / (1.0f + 2.0f * facy)) * facy;
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <span class="comment">/* only resize view on an axis if change is allowed */</span>
<a name="l00601"></a>00601     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) == 0) {
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>) {
<a name="l00603"></a>00603             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> -= 2 * dx;
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a6c89462bb28d7566a5d9488ccbaf5c8e">V2D_KEEPOFS_X</a>) {
<a name="l00606"></a>00606             <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a30dc44584ef654fc33e0f1e3f1534de6">V2D_ALIGN_NO_POS_X</a>)
<a name="l00607"></a>00607                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += 2 * dx;
<a name="l00608"></a>00608             <span class="keywordflow">else</span>
<a name="l00609"></a>00609                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> -= 2 * dx;
<a name="l00610"></a>00610         }
<a name="l00611"></a>00611         <span class="keywordflow">else</span> {
<a name="l00612"></a>00612             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00613"></a>00613                 <span class="keywordtype">float</span> mval_fac = (vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2db622c90cde9c3594b1f71be234e136">mx_2d</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00614"></a>00614                 <span class="keywordtype">float</span> mval_faci = 1.0f - mval_fac;
<a name="l00615"></a>00615                 <span class="keywordtype">float</span> ofs = (mval_fac * dx) - (mval_faci * dx);
<a name="l00616"></a>00616                 
<a name="l00617"></a>00617                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += ofs + dx;
<a name="l00618"></a>00618                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += ofs - dx;
<a name="l00619"></a>00619             }
<a name="l00620"></a>00620             <span class="keywordflow">else</span> {
<a name="l00621"></a>00621                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += dx;
<a name="l00622"></a>00622                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> -= dx;
<a name="l00623"></a>00623             }
<a name="l00624"></a>00624         }
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>) == 0) {
<a name="l00627"></a>00627         <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>) {
<a name="l00628"></a>00628             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> -= 2 * dy;
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#afeb15edb0e15ff137058eff0e649d12f">V2D_KEEPOFS_Y</a>) {
<a name="l00631"></a>00631             <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>)
<a name="l00632"></a>00632                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += 2 * dy;
<a name="l00633"></a>00633             <span class="keywordflow">else</span>
<a name="l00634"></a>00634                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> -= 2 * dy;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636         <span class="keywordflow">else</span> {
<a name="l00637"></a>00637             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00638"></a>00638                 <span class="keywordtype">float</span> mval_fac = (vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">my_2d</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) / (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00639"></a>00639                 <span class="keywordtype">float</span> mval_faci = 1.0f - mval_fac;
<a name="l00640"></a>00640                 <span class="keywordtype">float</span> ofs = (mval_fac * dy) - (mval_faci * dy);
<a name="l00641"></a>00641                 
<a name="l00642"></a>00642                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += ofs + dy;
<a name="l00643"></a>00643                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += ofs - dy;
<a name="l00644"></a>00644             } 
<a name="l00645"></a>00645             <span class="keywordflow">else</span> {
<a name="l00646"></a>00646                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += dy;
<a name="l00647"></a>00647                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> -= dy;
<a name="l00648"></a>00648             }
<a name="l00649"></a>00649         }
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="comment">/* validate that view is in valid configuration after this operation */</span>
<a name="l00653"></a>00653     <a class="code" href="../../d5/d63/UI__view2d_8h.html#af75b83105e7573fbdbfd1a6c1e856058">UI_view2d_curRect_validate</a>(v2d);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="comment">/* request updates to be done... */</span>
<a name="l00656"></a>00656     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a53ded60a25586833dd3e5a722b6a49be">ar</a>);
<a name="l00657"></a>00657     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="comment">/* --------------- Individual Operators ------------------- */</span>
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 <span class="comment">/* cleanup temp customdata  */</span>
<a name="l00663"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#af9a26fbd5b71109d6f47aa823f7c01e0">00663</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#af9a26fbd5b71109d6f47aa823f7c01e0">view_zoomstep_exit</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00664"></a>00664 {
<a name="l00665"></a>00665     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>) {
<a name="l00666"></a>00666         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l00667"></a>00667         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="comment">/* this operator only needs this single callback, where it calls the view_zoom_*() methods */</span>
<a name="l00672"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a718827b6406140b87829301404baf068">00672</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a718827b6406140b87829301404baf068">view_zoomin_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674     <span class="comment">/* check that there&#39;s an active region, as View2D data resides there */</span>
<a name="l00675"></a>00675     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>(C))
<a name="l00676"></a>00676         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00677"></a>00677     
<a name="l00678"></a>00678     <span class="comment">/* set RNA-Props - zooming in by uniform factor */</span>
<a name="l00679"></a>00679     <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;zoomfacx&quot;</span>, 0.0375f);
<a name="l00680"></a>00680     <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;zoomfacy&quot;</span>, 0.0375f);
<a name="l00681"></a>00681     
<a name="l00682"></a>00682     <span class="comment">/* apply movement, then we&#39;re done */</span>
<a name="l00683"></a>00683     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4108cca004c1a4b1a95d5f9c484a5893">view_zoomstep_apply</a>(C, op);
<a name="l00684"></a>00684     
<a name="l00685"></a>00685     <a class="code" href="../../db/d51/view2d__ops_8c.html#af9a26fbd5b71109d6f47aa823f7c01e0">view_zoomstep_exit</a>(op);
<a name="l00686"></a>00686     
<a name="l00687"></a>00687     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 
<a name="l00690"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a9c68c7d0723277cbf224905a4f668192">00690</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a9c68c7d0723277cbf224905a4f668192">view_zoomin_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00691"></a>00691 {
<a name="l00692"></a>00692     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd;
<a name="l00693"></a>00693     
<a name="l00694"></a>00694     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a2c190be1a24137e23be90459fcad7615">view_zoomdrag_init</a>(C, op))
<a name="l00695"></a>00695         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00696"></a>00696     
<a name="l00697"></a>00697     vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00698"></a>00698     
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00700"></a>00700         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00701"></a>00701         
<a name="l00702"></a>00702         <span class="comment">/* store initial mouse position (in view space) */</span>
<a name="l00703"></a>00703         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, 
<a name="l00704"></a>00704                                  event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l00705"></a>00705                                  &amp;vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2db622c90cde9c3594b1f71be234e136">mx_2d</a>, &amp;vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">my_2d</a>);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707     
<a name="l00708"></a>00708     <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a718827b6406140b87829301404baf068">view_zoomin_exec</a>(C, op);
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 
<a name="l00711"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a83d4b93d003bd62849762a242079dbea">00711</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a83d4b93d003bd62849762a242079dbea">VIEW2D_OT_zoom_in</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713     <span class="comment">/* identifiers */</span>
<a name="l00714"></a>00714     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Zoom In&quot;</span>;
<a name="l00715"></a>00715     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Zoom in the view&quot;</span>;
<a name="l00716"></a>00716     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_zoom_in&quot;</span>;
<a name="l00717"></a>00717     
<a name="l00718"></a>00718     <span class="comment">/* api callbacks */</span>
<a name="l00719"></a>00719     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a9c68c7d0723277cbf224905a4f668192">view_zoomin_invoke</a>;
<a name="l00720"></a>00720 <span class="comment">//  ot-&gt;exec = view_zoomin_exec;  // XXX, needs view_zoomdrag_init called first.</span>
<a name="l00721"></a>00721     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>;
<a name="l00722"></a>00722     
<a name="l00723"></a>00723     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00724"></a>00724     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;zoomfacx&quot;</span>, 0, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Zoom Factor X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l00725"></a>00725     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;zoomfacy&quot;</span>, 0, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Zoom Factor Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l00726"></a>00726 }
<a name="l00727"></a>00727     
<a name="l00728"></a>00728 <span class="comment">/* this operator only needs this single callback, where it callsthe view_zoom_*() methods */</span>
<a name="l00729"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#aa83c20dc63f4fbe01b3237ad7fa4c974">00729</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#aa83c20dc63f4fbe01b3237ad7fa4c974">view_zoomout_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731     <span class="comment">/* check that there&#39;s an active region, as View2D data resides there */</span>
<a name="l00732"></a>00732     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>(C))
<a name="l00733"></a>00733         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00734"></a>00734     
<a name="l00735"></a>00735     <span class="comment">/* set RNA-Props - zooming in by uniform factor */</span>
<a name="l00736"></a>00736     <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;zoomfacx&quot;</span>, -0.0375f);
<a name="l00737"></a>00737     <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;zoomfacy&quot;</span>, -0.0375f);
<a name="l00738"></a>00738     
<a name="l00739"></a>00739     <span class="comment">/* apply movement, then we&#39;re done */</span>
<a name="l00740"></a>00740     <a class="code" href="../../db/d51/view2d__ops_8c.html#a4108cca004c1a4b1a95d5f9c484a5893">view_zoomstep_apply</a>(C, op);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <a class="code" href="../../db/d51/view2d__ops_8c.html#af9a26fbd5b71109d6f47aa823f7c01e0">view_zoomstep_exit</a>(op);
<a name="l00743"></a>00743     
<a name="l00744"></a>00744     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a91ad858b36c1d5a7cd6deb57201edb9e">00747</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a91ad858b36c1d5a7cd6deb57201edb9e">view_zoomout_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd;
<a name="l00750"></a>00750     
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a2c190be1a24137e23be90459fcad7615">view_zoomdrag_init</a>(C, op))
<a name="l00752"></a>00752         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00755"></a>00755     
<a name="l00756"></a>00756     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00757"></a>00757         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00758"></a>00758         
<a name="l00759"></a>00759         <span class="comment">/* store initial mouse position (in view space) */</span>
<a name="l00760"></a>00760         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, 
<a name="l00761"></a>00761                                  event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l00762"></a>00762                                  &amp;vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2db622c90cde9c3594b1f71be234e136">mx_2d</a>, &amp;vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">my_2d</a>);
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764     
<a name="l00765"></a>00765     <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#aa83c20dc63f4fbe01b3237ad7fa4c974">view_zoomout_exec</a>(C, op);
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00768"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a5fe4c203beecfa2acc70250504896107">00768</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a5fe4c203beecfa2acc70250504896107">VIEW2D_OT_zoom_out</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00769"></a>00769 {
<a name="l00770"></a>00770     <span class="comment">/* identifiers */</span>
<a name="l00771"></a>00771     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Zoom Out&quot;</span>;
<a name="l00772"></a>00772     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Zoom out the view&quot;</span>;
<a name="l00773"></a>00773     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_zoom_out&quot;</span>;
<a name="l00774"></a>00774     
<a name="l00775"></a>00775     <span class="comment">/* api callbacks */</span>
<a name="l00776"></a>00776     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a91ad858b36c1d5a7cd6deb57201edb9e">view_zoomout_invoke</a>;
<a name="l00777"></a>00777 <span class="comment">//  ot-&gt;exec = view_zoomout_exec; // XXX, needs view_zoomdrag_init called first.</span>
<a name="l00778"></a>00778     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>;
<a name="l00779"></a>00779     
<a name="l00780"></a>00780     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l00781"></a>00781     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;zoomfacx&quot;</span>, 0, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Zoom Factor X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l00782"></a>00782     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;zoomfacy&quot;</span>, 0, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Zoom Factor Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 <span class="comment">/* ********************************************************* */</span>
<a name="l00786"></a>00786 <span class="comment">/* DRAG-ZOOM OPERATOR                                    */</span>
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="comment">/*  MMB Drag - allows non-uniform scaling by dragging mouse</span>
<a name="l00789"></a>00789 <span class="comment"> *</span>
<a name="l00790"></a>00790 <span class="comment"> *  In order to make sure this works, each operator must define the following RNA-Operator Props:</span>
<a name="l00791"></a>00791 <span class="comment"> *      deltax, deltay  - amounts to add to each side of the &#39;cur&#39; rect</span>
<a name="l00792"></a>00792 <span class="comment"> */</span>
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">/* apply transform to view (i.e. adjust &#39;cur&#39; rect) */</span>
<a name="l00795"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a898180a9cbcaaeb6b4b8320a73b7bdf1">00795</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a898180a9cbcaaeb6b4b8320a73b7bdf1">view_zoomdrag_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00796"></a>00796 {
<a name="l00797"></a>00797     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00798"></a>00798     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a7b96ceb4febf8b119bff19e6542d6f15">v2d</a>;
<a name="l00799"></a>00799     <span class="keywordtype">float</span> dx, dy;
<a name="l00800"></a>00800     
<a name="l00801"></a>00801     <span class="comment">/* get amount to move view by */</span>
<a name="l00802"></a>00802     dx = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>);
<a name="l00803"></a>00803     dy = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805     <span class="comment">/* continuous zoom shouldn&#39;t move that fast... */</span>
<a name="l00806"></a>00806     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.viewzoom == <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a2ca6297cdd510067dc2178b53d150e80">USER_ZOOM_CONT</a>) { <span class="comment">// XXX store this setting as RNA prop?</span>
<a name="l00807"></a>00807         <span class="keywordtype">double</span> time = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00808"></a>00808         <span class="keywordtype">float</span> time_step = (float)(time - vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">timer_lastdraw</a>);
<a name="l00809"></a>00809 
<a name="l00810"></a>00810         dx *= time_step * 0.5f;
<a name="l00811"></a>00811         dy *= time_step * 0.5f;
<a name="l00812"></a>00812         
<a name="l00813"></a>00813         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">timer_lastdraw</a> = time;
<a name="l00814"></a>00814     }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     <span class="comment">/* only move view on an axis if change is allowed */</span>
<a name="l00817"></a>00817     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) == 0) {
<a name="l00818"></a>00818         <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>) {
<a name="l00819"></a>00819             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> -= 2 * dx;
<a name="l00820"></a>00820         }
<a name="l00821"></a>00821         <span class="keywordflow">else</span> {
<a name="l00822"></a>00822             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00823"></a>00823                 <span class="keywordtype">float</span> mval_fac = (vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2db622c90cde9c3594b1f71be234e136">mx_2d</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00824"></a>00824                 <span class="keywordtype">float</span> mval_faci = 1.0f - mval_fac;
<a name="l00825"></a>00825                 <span class="keywordtype">float</span> ofs = (mval_fac * dx) - (mval_faci * dx);
<a name="l00826"></a>00826                 
<a name="l00827"></a>00827                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += ofs + dx;
<a name="l00828"></a>00828                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += ofs - dx;
<a name="l00829"></a>00829             }
<a name="l00830"></a>00830             <span class="keywordflow">else</span> {
<a name="l00831"></a>00831                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += dx;
<a name="l00832"></a>00832                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> -= dx;
<a name="l00833"></a>00833             }
<a name="l00834"></a>00834         }
<a name="l00835"></a>00835     }
<a name="l00836"></a>00836     <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>) == 0) {
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>) {
<a name="l00838"></a>00838             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> -= 2 * dy;
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840         <span class="keywordflow">else</span> {
<a name="l00841"></a>00841             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00842"></a>00842                 <span class="keywordtype">float</span> mval_fac = (vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">my_2d</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) / (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00843"></a>00843                 <span class="keywordtype">float</span> mval_faci = 1.0f - mval_fac;
<a name="l00844"></a>00844                 <span class="keywordtype">float</span> ofs = (mval_fac * dy) - (mval_faci * dy);
<a name="l00845"></a>00845                 
<a name="l00846"></a>00846                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += ofs + dy;
<a name="l00847"></a>00847                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += ofs - dy;
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849             <span class="keywordflow">else</span> {
<a name="l00850"></a>00850                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += dy;
<a name="l00851"></a>00851                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> -= dy;
<a name="l00852"></a>00852             }
<a name="l00853"></a>00853         }
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     
<a name="l00856"></a>00856     <span class="comment">/* validate that view is in valid configuration after this operation */</span>
<a name="l00857"></a>00857     <a class="code" href="../../d5/d63/UI__view2d_8h.html#af75b83105e7573fbdbfd1a6c1e856058">UI_view2d_curRect_validate</a>(v2d);
<a name="l00858"></a>00858     
<a name="l00859"></a>00859     <span class="comment">/* request updates to be done... */</span>
<a name="l00860"></a>00860     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a53ded60a25586833dd3e5a722b6a49be">ar</a>);
<a name="l00861"></a>00861     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l00862"></a>00862 }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864 <span class="comment">/* cleanup temp customdata  */</span>
<a name="l00865"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a8041a66b49ed7ff079569b23e9cf321b">00865</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a8041a66b49ed7ff079569b23e9cf321b">view_zoomdrag_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>) {
<a name="l00868"></a>00868         <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00869"></a>00869         
<a name="l00870"></a>00870         <span class="keywordflow">if</span> (vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2b81f7de9c6270917a2df9fc787ad914">timer</a>)
<a name="l00871"></a>00871             <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2b81f7de9c6270917a2df9fc787ad914">timer</a>);
<a name="l00872"></a>00872         
<a name="l00873"></a>00873         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l00874"></a>00874         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876 } 
<a name="l00877"></a>00877 
<a name="l00878"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#ae920ff663fb01e4010331e366d8f8f01">00878</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#ae920ff663fb01e4010331e366d8f8f01">view_zoomdrag_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00879"></a>00879 {
<a name="l00880"></a>00880     <a class="code" href="../../db/d51/view2d__ops_8c.html#a8041a66b49ed7ff079569b23e9cf321b">view_zoomdrag_exit</a>(C, op);
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 <span class="comment">/* for &#39;redo&#39; only, with no user input */</span>
<a name="l00886"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#ae004c0f87b6f41e57e42924e94bb9e1c">00886</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#ae004c0f87b6f41e57e42924e94bb9e1c">view_zoomdrag_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a2c190be1a24137e23be90459fcad7615">view_zoomdrag_init</a>(C, op))
<a name="l00889"></a>00889         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00890"></a>00890     
<a name="l00891"></a>00891     <a class="code" href="../../db/d51/view2d__ops_8c.html#a898180a9cbcaaeb6b4b8320a73b7bdf1">view_zoomdrag_apply</a>(C, op);
<a name="l00892"></a>00892     <a class="code" href="../../db/d51/view2d__ops_8c.html#a8041a66b49ed7ff079569b23e9cf321b">view_zoomdrag_exit</a>(C, op);
<a name="l00893"></a>00893     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="comment">/* set up modal operator and relevant settings */</span>
<a name="l00897"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#af51c497d727f6039932cbefc532a38d5">00897</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#af51c497d727f6039932cbefc532a38d5">view_zoomdrag_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00900"></a>00900     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd;
<a name="l00901"></a>00901     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00902"></a>00902     
<a name="l00903"></a>00903     <span class="comment">/* set up customdata */</span>
<a name="l00904"></a>00904     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/view2d__ops_8c.html#a2c190be1a24137e23be90459fcad7615">view_zoomdrag_init</a>(C, op))
<a name="l00905"></a>00905         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00906"></a>00906     
<a name="l00907"></a>00907     vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00908"></a>00908     v2d = vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a7b96ceb4febf8b119bff19e6542d6f15">v2d</a>;
<a name="l00909"></a>00909     
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a87d179409a17bb20a1c248c84b170b55">MOUSEZOOM</a>) {
<a name="l00911"></a>00911         <span class="keywordtype">float</span> dx, dy, fac;
<a name="l00912"></a>00912         
<a name="l00913"></a>00913         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a5b2efbc128a3ee8eff868f73fad9efc6">lastx</a> = <span class="keyword">event</span>-&gt;prevx;
<a name="l00914"></a>00914         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">lasty</a> = <span class="keyword">event</span>-&gt;prevy;
<a name="l00915"></a>00915         
<a name="l00916"></a>00916         <span class="comment">/* As we have only 1D information (magnify value), feed both axes</span>
<a name="l00917"></a>00917 <span class="comment">         * with magnify information that is stored in x axis </span>
<a name="l00918"></a>00918 <span class="comment">         */</span>
<a name="l00919"></a>00919         fac = 0.01f * (<span class="keyword">event</span>-&gt;x - <span class="keyword">event</span>-&gt;prevx);
<a name="l00920"></a>00920         dx = fac * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / 10.0f;
<a name="l00921"></a>00921         dy = fac * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) / 10.0f;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923         <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, dx);
<a name="l00924"></a>00924         <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, dy);
<a name="l00925"></a>00925         
<a name="l00926"></a>00926         <a class="code" href="../../db/d51/view2d__ops_8c.html#a898180a9cbcaaeb6b4b8320a73b7bdf1">view_zoomdrag_apply</a>(C, op);
<a name="l00927"></a>00927         <a class="code" href="../../db/d51/view2d__ops_8c.html#a8041a66b49ed7ff079569b23e9cf321b">view_zoomdrag_exit</a>(C, op);
<a name="l00928"></a>00928         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00929"></a>00929     }   
<a name="l00930"></a>00930     
<a name="l00931"></a>00931     <span class="comment">/* set initial settings */</span>
<a name="l00932"></a>00932     vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a5b2efbc128a3ee8eff868f73fad9efc6">lastx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l00933"></a>00933     vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">lasty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l00934"></a>00934     <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0);
<a name="l00935"></a>00935     <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0);
<a name="l00936"></a>00936     
<a name="l00937"></a>00937     <span class="comment">/* for modal exit test */</span>
<a name="l00938"></a>00938     vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a08172b83a3e7ce668b826305e54f842a">invoke_event</a> = <span class="keyword">event</span>-&gt;type;
<a name="l00939"></a>00939     
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a9ad0e641c5a80e22dde1508ec99414c3">USER_ZOOM_TO_MOUSEPOS</a>) {
<a name="l00941"></a>00941         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00942"></a>00942         
<a name="l00943"></a>00943         <span class="comment">/* store initial mouse position (in view space) */</span>
<a name="l00944"></a>00944         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, 
<a name="l00945"></a>00945                                  event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l00946"></a>00946                                  &amp;vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2db622c90cde9c3594b1f71be234e136">mx_2d</a>, &amp;vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#ad7f16bfbda473e11d9f71721f777dd59">my_2d</a>);
<a name="l00947"></a>00947     }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949     <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>)
<a name="l00950"></a>00950         <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(window, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9baf692e6e9cba3ec86430dd42ac011dba1">BC_NS_SCROLLCURSOR</a>);
<a name="l00951"></a>00951     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>)
<a name="l00952"></a>00952         <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(window, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9ba66cd47f5b5b8c10426fc21db81c197c1">BC_EW_SCROLLCURSOR</a>);
<a name="l00953"></a>00953     <span class="keywordflow">else</span>
<a name="l00954"></a>00954         <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(window, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9baaa57a16b408a2323b90a0c1ab099c6ab">BC_NSEW_SCROLLCURSOR</a>);
<a name="l00955"></a>00955     
<a name="l00956"></a>00956     <span class="comment">/* add temp handler */</span>
<a name="l00957"></a>00957     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.viewzoom == <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a2ca6297cdd510067dc2178b53d150e80">USER_ZOOM_CONT</a>) {
<a name="l00960"></a>00960         <span class="comment">/* needs a timer to continue redrawing */</span>
<a name="l00961"></a>00961         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2b81f7de9c6270917a2df9fc787ad914">timer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, 0.01f);
<a name="l00962"></a>00962         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">timer_lastdraw</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00963"></a>00963     }
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968 <span class="comment">/* handle user input - calculations of mouse-movement need to be done here, not in the apply callback! */</span>
<a name="l00969"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a282f9730054bcc2d77dc87fc3d3747c2">00969</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a282f9730054bcc2d77dc87fc3d3747c2">view_zoomdrag_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00970"></a>00970 {
<a name="l00971"></a>00971     <a class="code" href="../../d1/d3c/structv2dViewZoomData.html">v2dViewZoomData</a> *vzd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00972"></a>00972     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a7b96ceb4febf8b119bff19e6542d6f15">v2d</a>;
<a name="l00973"></a>00973     
<a name="l00974"></a>00974     <span class="comment">/* execute the events */</span>
<a name="l00975"></a>00975     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> == vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a2b81f7de9c6270917a2df9fc787ad914">timer</a>) {
<a name="l00976"></a>00976         <a class="code" href="../../db/d51/view2d__ops_8c.html#a898180a9cbcaaeb6b4b8320a73b7bdf1">view_zoomdrag_apply</a>(C, op);
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l00979"></a>00979         <span class="keywordtype">float</span> dx, dy;
<a name="l00980"></a>00980         
<a name="l00981"></a>00981         <span class="comment">/* calculate new delta transform, based on zooming mode */</span>
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.viewzoom == <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a0f85ef8af2346a76266bd96f7a27a7a9">USER_ZOOM_SCALE</a>) {
<a name="l00983"></a>00983             <span class="comment">/* &#39;scale&#39; zooming */</span>
<a name="l00984"></a>00984             <span class="keywordtype">float</span> dist;
<a name="l00985"></a>00985             
<a name="l00986"></a>00986             <span class="comment">/* x-axis transform */</span>
<a name="l00987"></a>00987             dist = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>) / 2.0f;
<a name="l00988"></a>00988             dx = 1.0f - (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a5b2efbc128a3ee8eff868f73fad9efc6">lastx</a> - dist) + 2.0f) / (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> - dist) + 2.0f);
<a name="l00989"></a>00989             dx *= 0.5f * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00990"></a>00990             
<a name="l00991"></a>00991             <span class="comment">/* y-axis transform */</span>
<a name="l00992"></a>00992             dist = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>) / 2.0f;
<a name="l00993"></a>00993             dy = 1.0f - (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">lasty</a> - dist) + 2.0f) / (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> - dist) + 2.0f);
<a name="l00994"></a>00994             dy *= 0.5f * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00995"></a>00995         }
<a name="l00996"></a>00996         <span class="keywordflow">else</span> {
<a name="l00997"></a>00997             <span class="comment">/* &#39;continuous&#39; or &#39;dolly&#39; */</span>
<a name="l00998"></a>00998             <span class="keywordtype">float</span> fac;
<a name="l00999"></a>00999             
<a name="l01000"></a>01000             <span class="comment">/* x-axis transform */</span>
<a name="l01001"></a>01001             fac = 0.01f * (<span class="keyword">event</span>-&gt;x - vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a5b2efbc128a3ee8eff868f73fad9efc6">lastx</a>);
<a name="l01002"></a>01002             dx = fac * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l01003"></a>01003             
<a name="l01004"></a>01004             <span class="comment">/* y-axis transform */</span>
<a name="l01005"></a>01005             fac = 0.01f * (<span class="keyword">event</span>-&gt;y - vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">lasty</a>);
<a name="l01006"></a>01006             dy = fac * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l01007"></a>01007 <span class="preprocessor">#if 0</span>
<a name="l01008"></a>01008 <span class="preprocessor"></span>            <span class="comment">/* continuous zoom shouldn&#39;t move that fast... */</span>
<a name="l01009"></a>01009             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.viewzoom == <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a2ca6297cdd510067dc2178b53d150e80">USER_ZOOM_CONT</a>) { <span class="comment">// XXX store this setting as RNA prop?</span>
<a name="l01010"></a>01010                 <span class="keywordtype">double</span> time = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l01011"></a>01011                 <span class="keywordtype">float</span> time_step = (float)(time - vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">timer_lastdraw</a>);
<a name="l01012"></a>01012 
<a name="l01013"></a>01013                 dx /= (0.1f / time_step);
<a name="l01014"></a>01014                 dy /= (0.1f / time_step);
<a name="l01015"></a>01015                 
<a name="l01016"></a>01016                 vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a30b80afef385adfcd87226804aec8640">timer_lastdraw</a> = time;
<a name="l01017"></a>01017             }
<a name="l01018"></a>01018 <span class="preprocessor">#endif</span>
<a name="l01019"></a>01019 <span class="preprocessor"></span>        }
<a name="l01020"></a>01020         
<a name="l01021"></a>01021         <span class="comment">/* set transform amount, and add current deltas to stored total delta (for redo) */</span>
<a name="l01022"></a>01022         <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, dx);
<a name="l01023"></a>01023         <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, dy);
<a name="l01024"></a>01024         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a910f214de6dc86d9ef3587f334c9c3c5">dx</a> += dx;
<a name="l01025"></a>01025         vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a47bdff79ca72da502eba0e69a6df7eb0">dy</a> += dy;
<a name="l01026"></a>01026         
<a name="l01027"></a>01027         <span class="comment">/* store mouse coordinates for next time, if not doing continuous zoom</span>
<a name="l01028"></a>01028 <span class="comment">         *  - continuous zoom only depends on distance of mouse to starting point to determine rate of change</span>
<a name="l01029"></a>01029 <span class="comment">         */</span>
<a name="l01030"></a>01030         <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.viewzoom != <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a2ca6297cdd510067dc2178b53d150e80">USER_ZOOM_CONT</a>) { <span class="comment">// XXX store this setting as RNA prop?</span>
<a name="l01031"></a>01031             vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a5b2efbc128a3ee8eff868f73fad9efc6">lastx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l01032"></a>01032             vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a33921e9287e2e8ad006f0d34ce2cc45f">lasty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034         
<a name="l01035"></a>01035         <span class="comment">/* apply zooming */</span>
<a name="l01036"></a>01036         <a class="code" href="../../db/d51/view2d__ops_8c.html#a898180a9cbcaaeb6b4b8320a73b7bdf1">view_zoomdrag_apply</a>(C, op);
<a name="l01037"></a>01037     } 
<a name="l01038"></a>01038     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a08172b83a3e7ce668b826305e54f842a">invoke_event</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l01039"></a>01039         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l01040"></a>01040             
<a name="l01041"></a>01041             <span class="comment">/* for redo, store the overall deltas - need to respect zoom-locks here... */</span>
<a name="l01042"></a>01042             <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) == 0)
<a name="l01043"></a>01043                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a910f214de6dc86d9ef3587f334c9c3c5">dx</a>);
<a name="l01044"></a>01044             <span class="keywordflow">else</span>
<a name="l01045"></a>01045                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0);
<a name="l01046"></a>01046                 
<a name="l01047"></a>01047             <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>) == 0)
<a name="l01048"></a>01048                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, vzd-&gt;<a class="code" href="../../d1/d3c/structv2dViewZoomData.html#a47bdff79ca72da502eba0e69a6df7eb0">dy</a>);
<a name="l01049"></a>01049             <span class="keywordflow">else</span>
<a name="l01050"></a>01050                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0);
<a name="l01051"></a>01051             
<a name="l01052"></a>01052             <span class="comment">/* free customdata */</span>
<a name="l01053"></a>01053             <a class="code" href="../../db/d51/view2d__ops_8c.html#a8041a66b49ed7ff079569b23e9cf321b">view_zoomdrag_exit</a>(C, op);
<a name="l01054"></a>01054             <a class="code" href="../../de/d3c/wm__cursors_8c.html#ab8500ccfbffb6b57f4e0645e0f9a4759">WM_cursor_restore</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l01055"></a>01055             
<a name="l01056"></a>01056             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01057"></a>01057         }
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01061"></a>01061 }
<a name="l01062"></a>01062 
<a name="l01063"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a7c878ad8c5b155487cf354d41175efbe">01063</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a7c878ad8c5b155487cf354d41175efbe">VIEW2D_OT_zoom</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01064"></a>01064 {
<a name="l01065"></a>01065     <span class="comment">/* identifiers */</span>
<a name="l01066"></a>01066     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Zoom 2D View&quot;</span>;
<a name="l01067"></a>01067     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Zoom in/out the view&quot;</span>;
<a name="l01068"></a>01068     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_zoom&quot;</span>;
<a name="l01069"></a>01069     
<a name="l01070"></a>01070     <span class="comment">/* api callbacks */</span>
<a name="l01071"></a>01071     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#ae004c0f87b6f41e57e42924e94bb9e1c">view_zoomdrag_exec</a>;
<a name="l01072"></a>01072     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#af51c497d727f6039932cbefc532a38d5">view_zoomdrag_invoke</a>;
<a name="l01073"></a>01073     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a282f9730054bcc2d77dc87fc3d3747c2">view_zoomdrag_modal</a>;
<a name="l01074"></a>01074     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#ae920ff663fb01e4010331e366d8f8f01">view_zoomdrag_cancel</a>;
<a name="l01075"></a>01075     
<a name="l01076"></a>01076     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>;
<a name="l01077"></a>01077     
<a name="l01078"></a>01078     <span class="comment">/* operator is repeatable */</span>
<a name="l01079"></a>01079     <span class="comment">// ot-&gt;flag = OPTYPE_BLOCKING;</span>
<a name="l01080"></a>01080     
<a name="l01081"></a>01081     <span class="comment">/* rna - must keep these in sync with the other operators */</span>
<a name="l01082"></a>01082     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltax&quot;</span>, 0, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Delta X&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l01083"></a>01083     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deltay&quot;</span>, 0, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Delta Y&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l01084"></a>01084 }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 <span class="comment">/* ********************************************************* */</span>
<a name="l01087"></a>01087 <span class="comment">/* BORDER-ZOOM */</span>
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 <span class="comment">/* The user defines a rect using standard borderselect tools, and we use this rect to </span>
<a name="l01090"></a>01090 <span class="comment"> * define the new zoom-level of the view in the following ways:</span>
<a name="l01091"></a>01091 <span class="comment"> *  1) LEFTMOUSE - zoom in to view</span>
<a name="l01092"></a>01092 <span class="comment"> *  2) RIGHTMOUSE - zoom out of view</span>
<a name="l01093"></a>01093 <span class="comment"> *</span>
<a name="l01094"></a>01094 <span class="comment"> * Currently, these key mappings are hardcoded, but it shouldn&#39;t be too important to</span>
<a name="l01095"></a>01095 <span class="comment"> * have custom keymappings for this...</span>
<a name="l01096"></a>01096 <span class="comment"> */</span>
<a name="l01097"></a>01097  
<a name="l01098"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#aad1d19df3b1de4fc345494b4a992431c">01098</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#aad1d19df3b1de4fc345494b4a992431c">view_borderzoom_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01099"></a>01099 {
<a name="l01100"></a>01100     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01101"></a>01101     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l01102"></a>01102     <a class="code" href="../../da/d10/structrctf.html">rctf</a> rect;
<a name="l01103"></a>01103     <span class="keywordtype">int</span> gesture_mode;
<a name="l01104"></a>01104     
<a name="l01105"></a>01105     <span class="comment">/* convert coordinates of rect to &#39;tot&#39; rect coordinates */</span>
<a name="l01106"></a>01106     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;xmin&quot;</span>), <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;ymin&quot;</span>), &amp;rect.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, &amp;rect.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l01107"></a>01107     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;xmax&quot;</span>), <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;ymax&quot;</span>), &amp;rect.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, &amp;rect.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l01108"></a>01108     
<a name="l01109"></a>01109     <span class="comment">/* check if zooming in/out view */</span>
<a name="l01110"></a>01110     gesture_mode = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;gesture_mode&quot;</span>);
<a name="l01111"></a>01111     
<a name="l01112"></a>01112     <span class="keywordflow">if</span> (gesture_mode == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8d375b8e58b507f7384767a0fc8dd538">GESTURE_MODAL_IN</a>) {
<a name="l01113"></a>01113         <span class="comment">/* zoom in: </span>
<a name="l01114"></a>01114 <span class="comment">         *  - &#39;cur&#39; rect will be defined by the coordinates of the border region </span>
<a name="l01115"></a>01115 <span class="comment">         *  - just set the &#39;cur&#39; rect to have the same coordinates as the border region</span>
<a name="l01116"></a>01116 <span class="comment">         *    if zoom is allowed to be changed</span>
<a name="l01117"></a>01117 <span class="comment">         */</span>
<a name="l01118"></a>01118         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) == 0) {
<a name="l01119"></a>01119             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = rect.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l01120"></a>01120             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = rect.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l01121"></a>01121         }
<a name="l01122"></a>01122         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>) == 0) {
<a name="l01123"></a>01123             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = rect.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l01124"></a>01124             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = rect.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>;
<a name="l01125"></a>01125         }
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127     <span class="keywordflow">else</span> { <span class="comment">/* if (gesture_mode == GESTURE_MODAL_OUT) */</span>
<a name="l01128"></a>01128 
<a name="l01129"></a>01129         <span class="comment">/* zoom out:</span>
<a name="l01130"></a>01130 <span class="comment">         *  - the current &#39;cur&#39; rect coordinates are going to end up where the &#39;rect&#39; ones are,</span>
<a name="l01131"></a>01131 <span class="comment">         *    but the &#39;cur&#39; rect coordinates will need to be adjusted to take in more of the view</span>
<a name="l01132"></a>01132 <span class="comment">         *  - calculate zoom factor, and adjust using center-point</span>
<a name="l01133"></a>01133 <span class="comment">         */</span>
<a name="l01134"></a>01134         <span class="keywordtype">float</span> zoom, center, <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01135"></a>01135         
<a name="l01136"></a>01136         <span class="comment">// TODO: is this zoom factor calculation valid? It seems to produce same results everytime...</span>
<a name="l01137"></a>01137         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) == 0) {
<a name="l01138"></a>01138             size = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l01139"></a>01139             zoom = size / (rect.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - rect.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l01140"></a>01140             center = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> + v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) * 0.5f;
<a name="l01141"></a>01141             
<a name="l01142"></a>01142             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = center - (size * zoom);
<a name="l01143"></a>01143             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = center + (size * zoom);
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>) == 0) {
<a name="l01146"></a>01146             size = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l01147"></a>01147             zoom = size / (rect.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - rect.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l01148"></a>01148             center = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> + v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) * 0.5f;
<a name="l01149"></a>01149             
<a name="l01150"></a>01150             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = center - (size * zoom);
<a name="l01151"></a>01151             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = center + (size * zoom);
<a name="l01152"></a>01152         }
<a name="l01153"></a>01153     }
<a name="l01154"></a>01154     
<a name="l01155"></a>01155     <span class="comment">/* validate that view is in valid configuration after this operation */</span>
<a name="l01156"></a>01156     <a class="code" href="../../d5/d63/UI__view2d_8h.html#af75b83105e7573fbdbfd1a6c1e856058">UI_view2d_curRect_validate</a>(v2d);
<a name="l01157"></a>01157     
<a name="l01158"></a>01158     <span class="comment">/* request updates to be done... */</span>
<a name="l01159"></a>01159     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01160"></a>01160     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l01161"></a>01161     
<a name="l01162"></a>01162     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01163"></a>01163 } 
<a name="l01164"></a>01164 
<a name="l01165"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a7723b568e0f98da58fcba9abfc4c8f7c">01165</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a7723b568e0f98da58fcba9abfc4c8f7c">VIEW2D_OT_zoom_border</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01166"></a>01166 {
<a name="l01167"></a>01167     <span class="comment">/* identifiers */</span>
<a name="l01168"></a>01168     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Zoom to Border&quot;</span>;
<a name="l01169"></a>01169     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Zoom in the view to the nearest item contained in the border&quot;</span>;
<a name="l01170"></a>01170     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_zoom_border&quot;</span>;
<a name="l01171"></a>01171     
<a name="l01172"></a>01172     <span class="comment">/* api callbacks */</span>
<a name="l01173"></a>01173     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a8d45022b7baa1add659b6798c15601b1">WM_border_select_invoke</a>;
<a name="l01174"></a>01174     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#aad1d19df3b1de4fc345494b4a992431c">view_borderzoom_exec</a>;
<a name="l01175"></a>01175     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#ab6bb53ebc07c5ca59c0a1a687124de2b">WM_border_select_modal</a>;
<a name="l01176"></a>01176     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a30c4cae4bcb919d6519d9a1b5b77cdb0">WM_border_select_cancel</a>;
<a name="l01177"></a>01177     
<a name="l01178"></a>01178     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a5b3ef01d273cb0f548983970b0e384aa">view_zoom_poll</a>;
<a name="l01179"></a>01179     
<a name="l01180"></a>01180     <span class="comment">/* rna */</span>
<a name="l01181"></a>01181     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;gesture_mode&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Gesture Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l01182"></a>01182     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;xmin&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;X Min&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l01183"></a>01183     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;xmax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;X Max&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l01184"></a>01184     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;ymin&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Y Min&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l01185"></a>01185     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;ymax&quot;</span>, 0, INT_MIN, INT_MAX, <span class="stringliteral">&quot;Y Max&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, INT_MIN, INT_MAX);
<a name="l01186"></a>01186 }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="comment">/* ********************************************************* */</span>
<a name="l01189"></a>01189 <span class="comment">/* SCROLLERS */</span>
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="comment">/*  Scrollers should behave in the following ways, when clicked on with LMB (and dragged):</span>
<a name="l01192"></a>01192 <span class="comment"> *      1) &#39;Handles&#39; on end of &#39;bubble&#39; - when the axis that the scroller represents is zoomable, </span>
<a name="l01193"></a>01193 <span class="comment"> *          enlarge &#39;cur&#39; rect on the relevant side </span>
<a name="l01194"></a>01194 <span class="comment"> *      2) &#39;Bubble&#39;/&#39;bar&#39; - just drag, and bar should move with mouse (view pans opposite)</span>
<a name="l01195"></a>01195 <span class="comment"> *</span>
<a name="l01196"></a>01196 <span class="comment"> *  In order to make sure this works, each operator must define the following RNA-Operator Props:</span>
<a name="l01197"></a>01197 <span class="comment"> *      deltax, deltay  - define how much to move view by (relative to zoom-correction factor)</span>
<a name="l01198"></a>01198 <span class="comment"> */</span>
<a name="l01199"></a>01199 
<a name="l01200"></a>01200 <span class="comment">/* customdata for scroller-invoke data */</span>
<a name="l01201"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html">01201</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> {
<a name="l01202"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#ac51599d37be68397f2cb699c558be950">01202</a>     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ac51599d37be68397f2cb699c558be950">v2d</a>;            <span class="comment">/* View2D data that this operation affects */</span>
<a name="l01203"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a26298e4fa77bfbf6035b38fb44b8986c">01203</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a26298e4fa77bfbf6035b38fb44b8986c">ar</a>;            <span class="comment">/* region that the scroller is in */</span>
<a name="l01204"></a>01204     
<a name="l01205"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">01205</a>     <span class="keywordtype">short</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a>;         <span class="comment">/* scroller that mouse is in (&#39;h&#39; or &#39;v&#39;) */</span>
<a name="l01206"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">01206</a>     <span class="keywordtype">short</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>; <span class="comment">/* -1 is min zoomer, 0 is bar, 1 is max zoomer */</span>             <span class="comment">// XXX find some way to provide visual feedback of this (active color?)</span>
<a name="l01207"></a>01207     
<a name="l01208"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a824d48b17daf90f6a76b39a23bf78576">01208</a>     <span class="keywordtype">float</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#a824d48b17daf90f6a76b39a23bf78576">fac</a>;              <span class="comment">/* view adjustment factor, based on size of region */</span>
<a name="l01209"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">01209</a>     <span class="keywordtype">float</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a>;            <span class="comment">/* amount moved by mouse on axis of interest */</span>
<a name="l01210"></a>01210     
<a name="l01211"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a0f72502b14a26f28f68a64f02ab43710">01211</a>     <span class="keywordtype">float</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#a0f72502b14a26f28f68a64f02ab43710">scrollbarwidth</a>;   <span class="comment">/* width of the scrollbar itself, used for page up/down clicks */</span>
<a name="l01212"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a48d1125e9ff44e7a119e5ea9a071a146">01212</a>     <span class="keywordtype">int</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#a48d1125e9ff44e7a119e5ea9a071a146">scrollbar_orig</a>;      <span class="comment">/* initial location of scrollbar x/y, mouse relative */</span>
<a name="l01213"></a>01213     
<a name="l01214"></a><a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">01214</a>     <span class="keywordtype">int</span> <a class="code" href="../../dd/d26/structv2dScrollerMove.html#adaab1977f74d03b2f5854a55f9cb27a3">lastx</a>, <a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">lasty</a>;       <span class="comment">/* previous mouse coordinates (in screen coordinates) for determining movement */</span>
<a name="l01215"></a>01215 } <a class="code" href="../../db/d51/view2d__ops_8c.html#af811e05dbdf5aaecd453c0e106dc8792">v2dScrollerMove</a>;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="comment">/* View2DScrollers is typedef&#39;d in UI_view2d.h </span>
<a name="l01219"></a>01219 <span class="comment"> * This is a CUT DOWN VERSION of the &#39;real&#39; version, which is defined in view2d.c, as we only need focus bubble info</span>
<a name="l01220"></a>01220 <span class="comment"> * WARNING: the start of this struct must not change, so that it stays in sync with the &#39;real&#39; version</span>
<a name="l01221"></a>01221 <span class="comment"> *         For now, we don&#39;t need to have a separate (internal) header for structs like this...</span>
<a name="l01222"></a>01222 <span class="comment"> */</span>
<a name="l01223"></a>01223 <span class="keyword">struct </span><a class="code" href="../../d6/dfa/structView2DScrollers.html">View2DScrollers</a> {    
<a name="l01224"></a>01224     <span class="comment">/* focus bubbles */</span>
<a name="l01225"></a>01225     <span class="keywordtype">int</span> <a class="code" href="../../d6/dfa/structView2DScrollers.html#a509a9665c12ac0fc956e3badddaa1d3f">vert_min</a>, <a class="code" href="../../d6/dfa/structView2DScrollers.html#a8177f5c90b61dac63b5c8cc26c628bad">vert_max</a>; <span class="comment">/* vertical scrollbar */</span>
<a name="l01226"></a>01226     <span class="keywordtype">int</span> <a class="code" href="../../d6/dfa/structView2DScrollers.html#a8ddde9939c49ed90c3d28f64b0b0d160">hor_min</a>, <a class="code" href="../../d6/dfa/structView2DScrollers.html#aeda6d0df26de06c6bf0d4b4fa3e42510">hor_max</a>;   <span class="comment">/* horizontal scrollbar */</span>
<a name="l01227"></a>01227 };
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="comment">/* quick enum for vsm-&gt;zone (scroller handles) */</span>
<a name="l01230"></a>01230 <span class="keyword">enum</span> {
<a name="l01231"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">01231</a>     <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a> = -1,
<a name="l01232"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">01232</a>     <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>,
<a name="l01233"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">01233</a>     <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>,
<a name="l01234"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aa6833a53a634b8fbd065fa802879f201">01234</a>     <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aa6833a53a634b8fbd065fa802879f201">SCROLLHANDLE_MIN_OUTSIDE</a>,
<a name="l01235"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aebbbbe7e289f684f9207efd4165f3138">01235</a>     <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aebbbbe7e289f684f9207efd4165f3138">SCROLLHANDLE_MAX_OUTSIDE</a>
<a name="l01236"></a>01236 } <span class="comment">/*eV2DScrollerHandle_Zone*/</span>;
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 <span class="comment">/* ------------------------ */</span>
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 <span class="comment">/* check if mouse is within scroller handle </span>
<a name="l01241"></a>01241 <span class="comment"> *  - mouse         =   relevant mouse coordinate in region space</span>
<a name="l01242"></a>01242 <span class="comment"> *  - sc_min, sc_max    =   extents of scroller &#39;groove&#39; (potential available space for scroller)</span>
<a name="l01243"></a>01243 <span class="comment"> *  - sh_min, sh_max    =   positions of scrollbar handles</span>
<a name="l01244"></a>01244 <span class="comment"> */</span>
<a name="l01245"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#ac5643c994292db46ec1c50f631b37ed7">01245</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#ac5643c994292db46ec1c50f631b37ed7">mouse_in_scroller_handle</a>(<span class="keywordtype">int</span> mouse, <span class="keywordtype">int</span> sc_min, <span class="keywordtype">int</span> sc_max, <span class="keywordtype">int</span> sh_min, <span class="keywordtype">int</span> sh_max)
<a name="l01246"></a>01246 {
<a name="l01247"></a>01247     <span class="keywordtype">short</span> in_min, in_max, in_bar, out_min, out_max, in_view = 1;
<a name="l01248"></a>01248     
<a name="l01249"></a>01249     <span class="comment">/* firstly, check if </span>
<a name="l01250"></a>01250 <span class="comment">     *  - &#39;bubble&#39; fills entire scroller </span>
<a name="l01251"></a>01251 <span class="comment">     *  - &#39;bubble&#39; completely out of view on either side </span>
<a name="l01252"></a>01252 <span class="comment">     */</span>
<a name="l01253"></a>01253     <span class="keywordflow">if</span> ((sh_min &lt;= sc_min) &amp;&amp; (sh_max &gt;= sc_max)) in_view = 0;
<a name="l01254"></a>01254     <span class="keywordflow">if</span> (sh_min == sh_max) {
<a name="l01255"></a>01255         <span class="keywordflow">if</span> (sh_min &lt;= sc_min) in_view = 0;
<a name="l01256"></a>01256         <span class="keywordflow">if</span> (sh_max &gt;= sc_max) in_view = 0;
<a name="l01257"></a>01257     }
<a name="l01258"></a>01258     <span class="keywordflow">else</span> {
<a name="l01259"></a>01259         <span class="keywordflow">if</span> (sh_max &lt;= sc_min) in_view = 0;
<a name="l01260"></a>01260         <span class="keywordflow">if</span> (sh_min &gt;= sc_max) in_view = 0;
<a name="l01261"></a>01261     }
<a name="l01262"></a>01262     
<a name="l01263"></a>01263     
<a name="l01264"></a>01264     <span class="keywordflow">if</span> (in_view == 0) {
<a name="l01265"></a>01265         <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267     
<a name="l01268"></a>01268     <span class="comment">/* check if mouse is in or past either handle */</span>
<a name="l01269"></a>01269     <span class="comment">// TODO: check if these extents are still valid or not</span>
<a name="l01270"></a>01270     in_max = ( (mouse &gt;= (sh_max - <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>)) &amp;&amp; (mouse &lt;= (sh_max + <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>)) );
<a name="l01271"></a>01271     in_min = ( (mouse &lt;= (sh_min + V2D_SCROLLER_HANDLE_SIZE)) &amp;&amp; (mouse &gt;= (sh_min - <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>)) );
<a name="l01272"></a>01272     in_bar = ( (mouse &lt; (sh_max - <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>)) &amp;&amp; (mouse &gt; (sh_min + <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>)) );
<a name="l01273"></a>01273     out_min = mouse &lt; (sh_min - <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>);
<a name="l01274"></a>01274     out_max = mouse &gt; (sh_max + <a class="code" href="../../d5/d63/UI__view2d_8h.html#acf0d2852b3ba3bbe3502214f3d7b6390">V2D_SCROLLER_HANDLE_SIZE</a>);
<a name="l01275"></a>01275     
<a name="l01276"></a>01276     <span class="keywordflow">if</span> (in_bar)
<a name="l01277"></a>01277         <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01278"></a>01278     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_max)
<a name="l01279"></a>01279         <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>;
<a name="l01280"></a>01280     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_min)
<a name="l01281"></a>01281         <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a>;
<a name="l01282"></a>01282     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (out_min)
<a name="l01283"></a>01283         <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aa6833a53a634b8fbd065fa802879f201">SCROLLHANDLE_MIN_OUTSIDE</a>;              
<a name="l01284"></a>01284     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (out_max)
<a name="l01285"></a>01285         <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aebbbbe7e289f684f9207efd4165f3138">SCROLLHANDLE_MAX_OUTSIDE</a>;
<a name="l01286"></a>01286     
<a name="l01287"></a>01287     <span class="comment">/* unlikely to happen, though we just cover it in case */</span>
<a name="l01288"></a>01288     <span class="keywordflow">return</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01289"></a>01289 } 
<a name="l01290"></a>01290 
<a name="l01291"></a>01291 <span class="comment">/* initialize customdata for scroller manipulation operator */</span>
<a name="l01292"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a343775927015730e748e06ec0554fffc">01292</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a343775927015730e748e06ec0554fffc">scroller_activate_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">short</span> in_scroller)
<a name="l01293"></a>01293 {
<a name="l01294"></a>01294     <a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> *vsm;
<a name="l01295"></a>01295     <a class="code" href="../../d6/dfa/structView2DScrollers.html">View2DScrollers</a> *scrollers;
<a name="l01296"></a>01296     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01297"></a>01297     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l01298"></a>01298     <span class="keywordtype">float</span> mask_size;
<a name="l01299"></a>01299     
<a name="l01300"></a>01300     <span class="comment">/* set custom-data for operator */</span>
<a name="l01301"></a>01301     vsm = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a>), <span class="stringliteral">&quot;v2dScrollerMove&quot;</span>);
<a name="l01302"></a>01302     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = vsm;
<a name="l01303"></a>01303     
<a name="l01304"></a>01304     <span class="comment">/* set general data */</span>
<a name="l01305"></a>01305     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ac51599d37be68397f2cb699c558be950">v2d</a> = v2d;
<a name="l01306"></a>01306     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a26298e4fa77bfbf6035b38fb44b8986c">ar</a> = ar;
<a name="l01307"></a>01307     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> = in_scroller;
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="comment">/* store mouse-coordinates, and convert mouse/screen coordinates to region coordinates */</span>
<a name="l01310"></a>01310     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#adaab1977f74d03b2f5854a55f9cb27a3">lastx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l01311"></a>01311     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">lasty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l01312"></a>01312     <span class="comment">/* &#39;zone&#39; depends on where mouse is relative to bubble </span>
<a name="l01313"></a>01313 <span class="comment">     *  - zooming must be allowed on this axis, otherwise, default to pan</span>
<a name="l01314"></a>01314 <span class="comment">     */</span>
<a name="l01315"></a>01315     scrollers = <a class="code" href="../../d5/d63/UI__view2d_8h.html#ac59b39b29261b0af35bff6a60231319a">UI_view2d_scrollers_calc</a>(C, v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab5ba307cf79a2ef296222e3681de4b05">V2D_ARG_DUMMY</a>, <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab5ba307cf79a2ef296222e3681de4b05">V2D_ARG_DUMMY</a>, <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab5ba307cf79a2ef296222e3681de4b05">V2D_ARG_DUMMY</a>, <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab5ba307cf79a2ef296222e3681de4b05">V2D_ARG_DUMMY</a>);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 
<a name="l01318"></a>01318     <span class="keywordflow">if</span> (in_scroller == <span class="charliteral">&#39;h&#39;</span>) {
<a name="l01319"></a>01319         <span class="comment">/* horizontal scroller - calculate adjustment factor first */</span>
<a name="l01320"></a>01320         mask_size = (float)(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#aca03edb292ceb17b769a2179bc5949af">hor</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#aca03edb292ceb17b769a2179bc5949af">hor</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>);
<a name="l01321"></a>01321         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a824d48b17daf90f6a76b39a23bf78576">fac</a> = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / mask_size;
<a name="l01322"></a>01322         
<a name="l01323"></a>01323         <span class="comment">/* get &#39;zone&#39; (i.e. which part of scroller is activated) */</span>
<a name="l01324"></a>01324         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#ac5643c994292db46ec1c50f631b37ed7">mouse_in_scroller_handle</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#aca03edb292ceb17b769a2179bc5949af">hor</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#aca03edb292ceb17b769a2179bc5949af">hor</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>, scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a8ddde9939c49ed90c3d28f64b0b0d160">hor_min</a>, scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#aeda6d0df26de06c6bf0d4b4fa3e42510">hor_max</a>);
<a name="l01325"></a>01325         
<a name="l01326"></a>01326         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>) &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>)) {
<a name="l01327"></a>01327             <span class="comment">/* default to scroll, as handles not usable */</span>
<a name="l01328"></a>01328             vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01329"></a>01329         }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a0f72502b14a26f28f68a64f02ab43710">scrollbarwidth</a> = scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#aeda6d0df26de06c6bf0d4b4fa3e42510">hor_max</a> - scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a8ddde9939c49ed90c3d28f64b0b0d160">hor_min</a>;
<a name="l01332"></a>01332         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a48d1125e9ff44e7a119e5ea9a071a146">scrollbar_orig</a> = ((scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#aeda6d0df26de06c6bf0d4b4fa3e42510">hor_max</a> + scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a8ddde9939c49ed90c3d28f64b0b0d160">hor_min</a>) / 2) + ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l01333"></a>01333     }
<a name="l01334"></a>01334     <span class="keywordflow">else</span> {
<a name="l01335"></a>01335         <span class="comment">/* vertical scroller - calculate adjustment factor first */</span>
<a name="l01336"></a>01336         mask_size = (float)(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a53e0cbdcced638078253737881e1603d">vert</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a53e0cbdcced638078253737881e1603d">vert</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l01337"></a>01337         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a824d48b17daf90f6a76b39a23bf78576">fac</a> = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) / mask_size;
<a name="l01338"></a>01338         
<a name="l01339"></a>01339         <span class="comment">/* get &#39;zone&#39; (i.e. which part of scroller is activated) */</span>
<a name="l01340"></a>01340         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#ac5643c994292db46ec1c50f631b37ed7">mouse_in_scroller_handle</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1], v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a53e0cbdcced638078253737881e1603d">vert</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>, v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a53e0cbdcced638078253737881e1603d">vert</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>, scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a509a9665c12ac0fc956e3badddaa1d3f">vert_min</a>, scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a8177f5c90b61dac63b5c8cc26c628bad">vert_max</a>);
<a name="l01341"></a>01341             
<a name="l01342"></a>01342         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>) &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>)) {
<a name="l01343"></a>01343             <span class="comment">/* default to scroll, as handles not usable */</span>
<a name="l01344"></a>01344             vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01345"></a>01345         }
<a name="l01346"></a>01346         
<a name="l01347"></a>01347         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a0f72502b14a26f28f68a64f02ab43710">scrollbarwidth</a> = scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a8177f5c90b61dac63b5c8cc26c628bad">vert_max</a> - scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a509a9665c12ac0fc956e3badddaa1d3f">vert_min</a>;
<a name="l01348"></a>01348         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a48d1125e9ff44e7a119e5ea9a071a146">scrollbar_orig</a> = ((scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a8177f5c90b61dac63b5c8cc26c628bad">vert_max</a> + scrollers-&gt;<a class="code" href="../../d6/dfa/structView2DScrollers.html#a509a9665c12ac0fc956e3badddaa1d3f">vert_min</a>) / 2) +  +ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l01349"></a>01349     }
<a name="l01350"></a>01350     
<a name="l01351"></a>01351     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ac30f32ea757898d20f76ae42e6cbdb2b">UI_view2d_scrollers_free</a>(scrollers);
<a name="l01352"></a>01352     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01353"></a>01353 }
<a name="l01354"></a>01354 
<a name="l01355"></a>01355 <span class="comment">/* cleanup temp customdata  */</span>
<a name="l01356"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">01356</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">scroller_activate_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01357"></a>01357 {
<a name="l01358"></a>01358     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>) {
<a name="l01359"></a>01359         <a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> *vsm = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ac51599d37be68397f2cb699c558be950">v2d</a>-&gt;<a class="code" href="../../d7/de3/structView2D.html#a6133bacc7fd88a33c357dd5d8ba0c00d">scroll_ui</a> &amp;= ~(<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a34aa1494116ed6f4c5e6359b1a92801f">V2D_SCROLL_H_ACTIVE</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ade75ed9557b52238877785653921dc26">V2D_SCROLL_V_ACTIVE</a>);
<a name="l01362"></a>01362         
<a name="l01363"></a>01363         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l01364"></a>01364         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01365"></a>01365         
<a name="l01366"></a>01366         <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C));
<a name="l01367"></a>01367     }
<a name="l01368"></a>01368 }
<a name="l01369"></a>01369 
<a name="l01370"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a2a35efb22fed418d4abefb888ba71379">01370</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a2a35efb22fed418d4abefb888ba71379">scroller_activate_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01371"></a>01371 {
<a name="l01372"></a>01372     <a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">scroller_activate_exit</a>(C, op);
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 <span class="comment">/* apply transform to view (i.e. adjust &#39;cur&#39; rect) */</span>
<a name="l01378"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a19277f22f70da95b755b7b9ca40a9c44">01378</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a19277f22f70da95b755b7b9ca40a9c44">scroller_activate_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380     <a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> *vsm = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01381"></a>01381     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ac51599d37be68397f2cb699c558be950">v2d</a>;
<a name="l01382"></a>01382     <span class="keywordtype">float</span> temp;
<a name="l01383"></a>01383     
<a name="l01384"></a>01384     <span class="comment">/* calculate amount to move view by */</span>
<a name="l01385"></a>01385     temp = vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a824d48b17daf90f6a76b39a23bf78576">fac</a> * vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a>;
<a name="l01386"></a>01386     
<a name="l01387"></a>01387     <span class="comment">/* type of movement */</span>
<a name="l01388"></a>01388     <span class="keywordflow">switch</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>) {
<a name="l01389"></a>01389         <span class="keywordflow">case</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a>:
<a name="l01390"></a>01390             <span class="comment">/* only expand view on axis if zoom is allowed */</span>
<a name="l01391"></a>01391             <span class="keywordflow">if</span> ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>))
<a name="l01392"></a>01392                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> -= temp;
<a name="l01393"></a>01393             <span class="keywordflow">if</span> ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;v&#39;</span>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>))
<a name="l01394"></a>01394                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> -= temp;
<a name="l01395"></a>01395             <span class="keywordflow">break</span>;
<a name="l01396"></a>01396             
<a name="l01397"></a>01397         <span class="keywordflow">case</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>:
<a name="l01398"></a>01398             
<a name="l01399"></a>01399             <span class="comment">/* only expand view on axis if zoom is allowed */</span>
<a name="l01400"></a>01400             <span class="keywordflow">if</span> ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>))
<a name="l01401"></a>01401                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += temp;
<a name="l01402"></a>01402             <span class="keywordflow">if</span> ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;v&#39;</span>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>))
<a name="l01403"></a>01403                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += temp;
<a name="l01404"></a>01404             <span class="keywordflow">break</span>;
<a name="l01405"></a>01405             
<a name="l01406"></a>01406         <span class="keywordflow">case</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aa6833a53a634b8fbd065fa802879f201">SCROLLHANDLE_MIN_OUTSIDE</a>:
<a name="l01407"></a>01407         <span class="keywordflow">case</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aebbbbe7e289f684f9207efd4165f3138">SCROLLHANDLE_MAX_OUTSIDE</a>:
<a name="l01408"></a>01408         <span class="keywordflow">case</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>:
<a name="l01409"></a>01409         <span class="keywordflow">default</span>:
<a name="l01410"></a>01410             <span class="comment">/* only move view on an axis if panning is allowed */</span>
<a name="l01411"></a>01411             <span class="keywordflow">if</span> ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>)) {
<a name="l01412"></a>01412                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += temp;
<a name="l01413"></a>01413                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += temp;
<a name="l01414"></a>01414             }
<a name="l01415"></a>01415             <span class="keywordflow">if</span> ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;v&#39;</span>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>)) {
<a name="l01416"></a>01416                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += temp;
<a name="l01417"></a>01417                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += temp;
<a name="l01418"></a>01418             }
<a name="l01419"></a>01419             <span class="keywordflow">break</span>;
<a name="l01420"></a>01420             
<a name="l01421"></a>01421     }
<a name="l01422"></a>01422     
<a name="l01423"></a>01423     <span class="comment">/* validate that view is in valid configuration after this operation */</span>
<a name="l01424"></a>01424     <a class="code" href="../../d5/d63/UI__view2d_8h.html#af75b83105e7573fbdbfd1a6c1e856058">UI_view2d_curRect_validate</a>(v2d);
<a name="l01425"></a>01425     
<a name="l01426"></a>01426     <span class="comment">/* request updates to be done... */</span>
<a name="l01427"></a>01427     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a26298e4fa77bfbf6035b38fb44b8986c">ar</a>);
<a name="l01428"></a>01428     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l01429"></a>01429 }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431 <span class="comment">/* handle user input for scrollers - calculations of mouse-movement need to be done here, not in the apply callback! */</span>
<a name="l01432"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a9594cd8ff7419c32e06e96782cb77fe3">01432</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a9594cd8ff7419c32e06e96782cb77fe3">scroller_activate_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01433"></a>01433 {
<a name="l01434"></a>01434     <a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> *vsm = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01435"></a>01435     
<a name="l01436"></a>01436     <span class="comment">/* execute the events */</span>
<a name="l01437"></a>01437     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01438"></a>01438         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l01439"></a>01439         {
<a name="l01440"></a>01440             <span class="comment">/* calculate new delta transform, then store mouse-coordinates for next-time */</span>
<a name="l01441"></a>01441             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>)) {
<a name="l01442"></a>01442                 <span class="comment">/* if using bar (i.e. &#39;panning&#39;) or &#39;max&#39; zoom widget */</span>
<a name="l01443"></a>01443                 <span class="keywordflow">switch</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a>) {
<a name="l01444"></a>01444                     <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>: <span class="comment">/* horizontal scroller - so only horizontal movement (&#39;cur&#39; moves opposite to mouse) */</span>
<a name="l01445"></a>01445                         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = (float)(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> - vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#adaab1977f74d03b2f5854a55f9cb27a3">lastx</a>);
<a name="l01446"></a>01446                         <span class="keywordflow">break</span>;
<a name="l01447"></a>01447                     <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: <span class="comment">/* vertical scroller - so only vertical movement (&#39;cur&#39; moves opposite to mouse) */</span>
<a name="l01448"></a>01448                         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = (float)(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> - vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">lasty</a>);
<a name="l01449"></a>01449                         <span class="keywordflow">break</span>;
<a name="l01450"></a>01450                 }
<a name="l01451"></a>01451             }
<a name="l01452"></a>01452             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> == <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a>) {
<a name="l01453"></a>01453                 <span class="comment">/* using &#39;min&#39; zoom widget */</span>
<a name="l01454"></a>01454                 <span class="keywordflow">switch</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a>) {
<a name="l01455"></a>01455                     <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>: <span class="comment">/* horizontal scroller - so only horizontal movement (&#39;cur&#39; moves with mouse) */</span>
<a name="l01456"></a>01456                         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = (float)(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#adaab1977f74d03b2f5854a55f9cb27a3">lastx</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>);
<a name="l01457"></a>01457                         <span class="keywordflow">break</span>;
<a name="l01458"></a>01458                     <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: <span class="comment">/* vertical scroller - so only vertical movement (&#39;cur&#39; moves with to mouse) */</span>
<a name="l01459"></a>01459                         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = (float)(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">lasty</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l01460"></a>01460                         <span class="keywordflow">break</span>;
<a name="l01461"></a>01461                 }
<a name="l01462"></a>01462             }
<a name="l01463"></a>01463             
<a name="l01464"></a>01464             <span class="comment">/* store previous coordinates */</span>
<a name="l01465"></a>01465             vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#adaab1977f74d03b2f5854a55f9cb27a3">lastx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l01466"></a>01466             vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">lasty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l01467"></a>01467             
<a name="l01468"></a>01468             <a class="code" href="../../db/d51/view2d__ops_8c.html#a19277f22f70da95b755b7b9ca40a9c44">scroller_activate_apply</a>(C, op);
<a name="l01469"></a>01469         }
<a name="l01470"></a>01470         <span class="keywordflow">break</span>;
<a name="l01471"></a>01471             
<a name="l01472"></a>01472         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l01473"></a>01473         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l01474"></a>01474             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l01475"></a>01475                 <span class="comment">/* single-click was in empty space outside bubble, so scroll by 1 &#39;page&#39; */</span>
<a name="l01476"></a>01476                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aa6833a53a634b8fbd065fa802879f201">SCROLLHANDLE_MIN_OUTSIDE</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aebbbbe7e289f684f9207efd4165f3138">SCROLLHANDLE_MAX_OUTSIDE</a>)) {
<a name="l01477"></a>01477                     <span class="keywordflow">if</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> == <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aa6833a53a634b8fbd065fa802879f201">SCROLLHANDLE_MIN_OUTSIDE</a>)
<a name="l01478"></a>01478                         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = -vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a0f72502b14a26f28f68a64f02ab43710">scrollbarwidth</a> * 0.8f;
<a name="l01479"></a>01479                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> == <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815aebbbbe7e289f684f9207efd4165f3138">SCROLLHANDLE_MAX_OUTSIDE</a>)
<a name="l01480"></a>01480                         vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a0f72502b14a26f28f68a64f02ab43710">scrollbarwidth</a> * 0.8f;
<a name="l01481"></a>01481                     
<a name="l01482"></a>01482                     <a class="code" href="../../db/d51/view2d__ops_8c.html#a19277f22f70da95b755b7b9ca40a9c44">scroller_activate_apply</a>(C, op);
<a name="l01483"></a>01483                     <a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">scroller_activate_exit</a>(C, op);
<a name="l01484"></a>01484                     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01485"></a>01485                 }
<a name="l01486"></a>01486                 
<a name="l01487"></a>01487                 <span class="comment">/* otherwise, end the drag action  */</span>
<a name="l01488"></a>01488                 <span class="keywordflow">if</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#adaab1977f74d03b2f5854a55f9cb27a3">lastx</a> || vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a520351c8e5dd87004e887c421731d895">lasty</a>) {
<a name="l01489"></a>01489                     <a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">scroller_activate_exit</a>(C, op);
<a name="l01490"></a>01490                     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01491"></a>01491                 }
<a name="l01492"></a>01492             }
<a name="l01493"></a>01493             <span class="keywordflow">break</span>;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496 
<a name="l01497"></a>01497     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01498"></a>01498 }
<a name="l01499"></a>01499 
<a name="l01500"></a>01500 
<a name="l01501"></a>01501 <span class="comment">/* a click (or click drag in progress) should have occurred, so check if it happened in scrollbar */</span>
<a name="l01502"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a82e7dc75c1470edd4b713c095c7b3dde">01502</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a82e7dc75c1470edd4b713c095c7b3dde">scroller_activate_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01503"></a>01503 {
<a name="l01504"></a>01504     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01505"></a>01505     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l01506"></a>01506     <span class="keywordtype">short</span> in_scroller = 0;
<a name="l01507"></a>01507         
<a name="l01508"></a>01508     <span class="comment">/* check if mouse in scrollbars, if they&#39;re enabled */</span>
<a name="l01509"></a>01509     in_scroller = <a class="code" href="../../d5/d63/UI__view2d_8h.html#aefe3371cc37f6438217d89f75a339c71">UI_view2d_mouse_in_scrollers</a>(C, v2d, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l01510"></a>01510     
<a name="l01511"></a>01511     <span class="comment">/* if in a scroller, init customdata then set modal handler which will catch mousedown to start doing useful stuff */</span>
<a name="l01512"></a>01512     <span class="keywordflow">if</span> (in_scroller) {
<a name="l01513"></a>01513         <a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> *vsm;
<a name="l01514"></a>01514         
<a name="l01515"></a>01515         <span class="comment">/* initialize customdata */</span>
<a name="l01516"></a>01516         <a class="code" href="../../db/d51/view2d__ops_8c.html#a343775927015730e748e06ec0554fffc">scroller_activate_init</a>(C, op, event, in_scroller);
<a name="l01517"></a>01517         vsm = (<a class="code" href="../../dd/d26/structv2dScrollerMove.html">v2dScrollerMove</a> *)op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01518"></a>01518         
<a name="l01519"></a>01519         <span class="comment">/* support for quick jump to location - gtk and qt do this on linux */</span>
<a name="l01520"></a>01520         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>) {
<a name="l01521"></a>01521             <span class="keywordflow">switch</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a>) {
<a name="l01522"></a>01522                 <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>: <span class="comment">/* horizontal scroller - so only horizontal movement (&#39;cur&#39; moves opposite to mouse) */</span>
<a name="l01523"></a>01523                     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = (float)(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> - vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a48d1125e9ff44e7a119e5ea9a071a146">scrollbar_orig</a>);
<a name="l01524"></a>01524                     <span class="keywordflow">break</span>;
<a name="l01525"></a>01525                 <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: <span class="comment">/* vertical scroller - so only vertical movement (&#39;cur&#39; moves opposite to mouse) */</span>
<a name="l01526"></a>01526                     vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a6c9759c2e95eb9e52b0d5f30437c0f8c">delta</a> = (float)(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> - vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a48d1125e9ff44e7a119e5ea9a071a146">scrollbar_orig</a>);
<a name="l01527"></a>01527                     <span class="keywordflow">break</span>;
<a name="l01528"></a>01528             }
<a name="l01529"></a>01529             <a class="code" href="../../db/d51/view2d__ops_8c.html#a19277f22f70da95b755b7b9ca40a9c44">scroller_activate_apply</a>(C, op);
<a name="l01530"></a>01530 
<a name="l01531"></a>01531             vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01532"></a>01532         }
<a name="l01533"></a>01533 
<a name="l01534"></a>01534         <span class="comment">/* check if zoom zones are inappropriate (i.e. zoom widgets not shown), so cannot continue</span>
<a name="l01535"></a>01535 <span class="comment">         * NOTE: see view2d.c for latest conditions, and keep this in sync with that</span>
<a name="l01536"></a>01536 <span class="comment">         */</span>
<a name="l01537"></a>01537         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815ae571d6d715fa9c9510cd78911d24a007">SCROLLHANDLE_MIN</a>, <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815adb64a11d6f91d42cbcd43141fccbc752">SCROLLHANDLE_MAX</a>)) {
<a name="l01538"></a>01538             <span class="keywordflow">if</span> ( ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aea84ae057740160cfff79dc8997dc47b">V2D_SCROLL_SCALE_HORIZONTAL</a>) == 0) ||
<a name="l01539"></a>01539                  ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;v&#39;</span>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a232ca231c26fa4332850f8268cbd0e0d">V2D_SCROLL_SCALE_VERTICAL</a>) == 0) )
<a name="l01540"></a>01540             {
<a name="l01541"></a>01541                 <span class="comment">/* switch to bar (i.e. no scaling gets handled) */</span>
<a name="l01542"></a>01542                 vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>;
<a name="l01543"></a>01543             }
<a name="l01544"></a>01544         }
<a name="l01545"></a>01545         
<a name="l01546"></a>01546         <span class="comment">/* check if zone is inappropriate (i.e. &#39;bar&#39; but panning is banned), so cannot continue */</span>
<a name="l01547"></a>01547         <span class="keywordflow">if</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#ab8518cf33b4eadd017fd555ee633092c">zone</a> == <a class="code" href="../../db/d51/view2d__ops_8c.html#a0b887f38fa71033f0904f8e2330b6815a61b42dc4bdc93b95b8ea433f75a7b09e">SCROLLHANDLE_BAR</a>) {
<a name="l01548"></a>01548             <span class="keywordflow">if</span> ( ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>)) ||
<a name="l01549"></a>01549                  ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;v&#39;</span>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>)) )
<a name="l01550"></a>01550             {
<a name="l01551"></a>01551                 <span class="comment">/* free customdata initialized */</span>
<a name="l01552"></a>01552                 <a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">scroller_activate_exit</a>(C, op);
<a name="l01553"></a>01553                 
<a name="l01554"></a>01554                 <span class="comment">/* can&#39;t catch this event for ourselves, so let it go to someone else? */</span>
<a name="l01555"></a>01555                 <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01556"></a>01556             }           
<a name="l01557"></a>01557         }
<a name="l01558"></a>01558         
<a name="l01559"></a>01559         <span class="comment">/* zone is also inappropriate if scroller is not visible... */</span>
<a name="l01560"></a>01560         <span class="keywordflow">if</span> ( ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a638a7692b2855648cbcb103f24c37438">V2D_SCROLL_HORIZONTAL_HIDE</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a5d65f65de4a34a681d97b0163cbab60f">V2D_SCROLL_HORIZONTAL_FULLR</a>))) ||
<a name="l01561"></a>01561              ((vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;v&#39;</span>) &amp;&amp; (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a0792ec92f99fe3abf23f0cc8787cbef6">V2D_SCROLL_VERTICAL_HIDE</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a20450ed868d3f08927be0251482b5a28">V2D_SCROLL_VERTICAL_FULLR</a>))) )
<a name="l01562"></a>01562         {
<a name="l01563"></a>01563             <span class="comment">/* free customdata initialized */</span>
<a name="l01564"></a>01564             <a class="code" href="../../db/d51/view2d__ops_8c.html#a6e0780815b764ccacc64a80111a7b3d8">scroller_activate_exit</a>(C, op);
<a name="l01565"></a>01565                 
<a name="l01566"></a>01566             <span class="comment">/* can&#39;t catch this event for ourselves, so let it go to someone else? */</span>
<a name="l01567"></a>01567             <span class="comment">/* XXX note: if handlers use mask rect to clip input, input will fail for this case */</span>
<a name="l01568"></a>01568             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01569"></a>01569         }
<a name="l01570"></a>01570         
<a name="l01571"></a>01571         <span class="comment">/* activate the scroller */</span>
<a name="l01572"></a>01572         <span class="keywordflow">if</span> (vsm-&gt;<a class="code" href="../../dd/d26/structv2dScrollerMove.html#a76ee3d7d0b2ec7a3dc78f00a50b349f4">scroller</a> == <span class="charliteral">&#39;h&#39;</span>)
<a name="l01573"></a>01573             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a6133bacc7fd88a33c357dd5d8ba0c00d">scroll_ui</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a34aa1494116ed6f4c5e6359b1a92801f">V2D_SCROLL_H_ACTIVE</a>;
<a name="l01574"></a>01574         <span class="keywordflow">else</span>
<a name="l01575"></a>01575             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a6133bacc7fd88a33c357dd5d8ba0c00d">scroll_ui</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ade75ed9557b52238877785653921dc26">V2D_SCROLL_V_ACTIVE</a>;
<a name="l01576"></a>01576         
<a name="l01577"></a>01577         <span class="comment">/* still ok, so can add */</span>
<a name="l01578"></a>01578         <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l01579"></a>01579         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01580"></a>01580     }
<a name="l01581"></a>01581     <span class="keywordflow">else</span> {
<a name="l01582"></a>01582         <span class="comment">/* not in scroller, so nothing happened... (pass through let&#39;s something else catch event) */</span>
<a name="l01583"></a>01583         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01584"></a>01584     }
<a name="l01585"></a>01585 }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587 <span class="comment">/* LMB-Drag in Scrollers - not repeatable operator! */</span>
<a name="l01588"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a213cf4b196397fb1e85f4b84ab24130d">01588</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#a213cf4b196397fb1e85f4b84ab24130d">VIEW2D_OT_scroller_activate</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01589"></a>01589 {
<a name="l01590"></a>01590     <span class="comment">/* identifiers */</span>
<a name="l01591"></a>01591     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Scroller Activate&quot;</span>;
<a name="l01592"></a>01592     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Scroll view by mouse click and drag&quot;</span>;
<a name="l01593"></a>01593     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_scroller_activate&quot;</span>;
<a name="l01594"></a>01594 
<a name="l01595"></a>01595     <span class="comment">/* flags */</span>
<a name="l01596"></a>01596     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l01597"></a>01597     
<a name="l01598"></a>01598     <span class="comment">/* api callbacks */</span>
<a name="l01599"></a>01599     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a82e7dc75c1470edd4b713c095c7b3dde">scroller_activate_invoke</a>;
<a name="l01600"></a>01600     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a9594cd8ff7419c32e06e96782cb77fe3">scroller_activate_modal</a>;
<a name="l01601"></a>01601     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a2a35efb22fed418d4abefb888ba71379">scroller_activate_cancel</a>;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a5094f9627cce4338b2399f649c084548">view2d_poll</a>;
<a name="l01604"></a>01604 }
<a name="l01605"></a>01605 
<a name="l01606"></a>01606 <span class="comment">/* ********************************************************* */</span>
<a name="l01607"></a>01607 <span class="comment">/* RESET */</span>
<a name="l01608"></a>01608 
<a name="l01609"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#af2e345ddc7d2f6dafdef14c9b559f73e">01609</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#af2e345ddc7d2f6dafdef14c9b559f73e">reset_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01610"></a>01610 {
<a name="l01611"></a>01611     <a class="code" href="../../d3/d28/structuiStyle.html">uiStyle</a> *style = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a16828a47eb4af34d08dce0ead86693b3">UI_GetStyle</a>();
<a name="l01612"></a>01612     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01613"></a>01613     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l01614"></a>01614     <span class="keywordtype">int</span> winx, winy;
<a name="l01615"></a>01615 
<a name="l01616"></a>01616     <span class="comment">/* zoom 1.0 */</span>
<a name="l01617"></a>01617     winx = (float)(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> + 1);
<a name="l01618"></a>01618     winy = (float)(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> + 1);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> + winx;
<a name="l01621"></a>01621     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> + winy;
<a name="l01622"></a>01622     
<a name="l01623"></a>01623     <span class="comment">/* align */</span>
<a name="l01624"></a>01624     <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a>) {
<a name="l01625"></a>01625         <span class="comment">/* posx and negx flags are mutually exclusive, so watch out */</span>
<a name="l01626"></a>01626         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a30dc44584ef654fc33e0f1e3f1534de6">V2D_ALIGN_NO_POS_X</a>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a9e75d9c4cc082bfcdca415b211bdae88">V2D_ALIGN_NO_NEG_X</a>)) {
<a name="l01627"></a>01627             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = 0.0f;
<a name="l01628"></a>01628             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = -winx * style-&gt;<a class="code" href="../../d3/d28/structuiStyle.html#a98094973ebdd8601e76aaaea762ca8bd">panelzoom</a>;
<a name="l01629"></a>01629         }
<a name="l01630"></a>01630         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a9e75d9c4cc082bfcdca415b211bdae88">V2D_ALIGN_NO_NEG_X</a>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a30dc44584ef654fc33e0f1e3f1534de6">V2D_ALIGN_NO_POS_X</a>)) {
<a name="l01631"></a>01631             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = winx * style-&gt;<a class="code" href="../../d3/d28/structuiStyle.html#a98094973ebdd8601e76aaaea762ca8bd">panelzoom</a>;
<a name="l01632"></a>01632             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = 0.0f;
<a name="l01633"></a>01633         }
<a name="l01634"></a>01634 
<a name="l01635"></a>01635         <span class="comment">/* - posx and negx flags are mutually exclusive, so watch out */</span>
<a name="l01636"></a>01636         <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#adef4c229c91733757ad48327e398f168">V2D_ALIGN_NO_NEG_Y</a>)) {
<a name="l01637"></a>01637             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0.0f;
<a name="l01638"></a>01638             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = -winy * style-&gt;<a class="code" href="../../d3/d28/structuiStyle.html#a98094973ebdd8601e76aaaea762ca8bd">panelzoom</a>;
<a name="l01639"></a>01639         }
<a name="l01640"></a>01640         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#adef4c229c91733757ad48327e398f168">V2D_ALIGN_NO_NEG_Y</a>) &amp;&amp; !(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>)) {
<a name="l01641"></a>01641             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = winy * style-&gt;<a class="code" href="../../d3/d28/structuiStyle.html#a98094973ebdd8601e76aaaea762ca8bd">panelzoom</a>;
<a name="l01642"></a>01642             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = 0.0f;
<a name="l01643"></a>01643         }
<a name="l01644"></a>01644     }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646     <span class="comment">/* validate that view is in valid configuration after this operation */</span>
<a name="l01647"></a>01647     <a class="code" href="../../d5/d63/UI__view2d_8h.html#af75b83105e7573fbdbfd1a6c1e856058">UI_view2d_curRect_validate</a>(v2d);
<a name="l01648"></a>01648     
<a name="l01649"></a>01649     <span class="comment">/* request updates to be done... */</span>
<a name="l01650"></a>01650     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01651"></a>01651     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l01652"></a>01652     
<a name="l01653"></a>01653     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01654"></a>01654 }
<a name="l01655"></a>01655  
<a name="l01656"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#ad95acbccbf1f57c18f64e990fc492cbf">01656</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d51/view2d__ops_8c.html#ad95acbccbf1f57c18f64e990fc492cbf">VIEW2D_OT_reset</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01657"></a>01657 {
<a name="l01658"></a>01658     <span class="comment">/* identifiers */</span>
<a name="l01659"></a>01659     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Reset View&quot;</span>;
<a name="l01660"></a>01660     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset the view&quot;</span>;
<a name="l01661"></a>01661     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;VIEW2D_OT_reset&quot;</span>;
<a name="l01662"></a>01662     
<a name="l01663"></a>01663     <span class="comment">/* api callbacks */</span>
<a name="l01664"></a>01664     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#af2e345ddc7d2f6dafdef14c9b559f73e">reset_exec</a>;
<a name="l01665"></a>01665     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../db/d51/view2d__ops_8c.html#a5094f9627cce4338b2399f649c084548">view2d_poll</a>;
<a name="l01666"></a>01666 }
<a name="l01667"></a>01667  
<a name="l01668"></a>01668 <span class="comment">/* ********************************************************* */</span>
<a name="l01669"></a>01669 <span class="comment">/* Registration */</span>
<a name="l01670"></a>01670 
<a name="l01671"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#a607c21a31be8072d4851b85c24a4d283">01671</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d63/UI__view2d_8h.html#a607c21a31be8072d4851b85c24a4d283">UI_view2d_operatortypes</a>(<span class="keywordtype">void</span>)
<a name="l01672"></a>01672 {
<a name="l01673"></a>01673     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a4383a69b8eecd7c1ea128bf2f5becf74">VIEW2D_OT_pan</a>);
<a name="l01674"></a>01674     
<a name="l01675"></a>01675     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a138231d4d2d0ae8a67978755df4eb87a">VIEW2D_OT_scroll_left</a>);
<a name="l01676"></a>01676     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#ac3746ea42dc1c87459cec45d1d9d5000">VIEW2D_OT_scroll_right</a>);
<a name="l01677"></a>01677     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a0627f33759dff7917f7c367a6fc1b8d2">VIEW2D_OT_scroll_up</a>);
<a name="l01678"></a>01678     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a372ece836bde537958a9b36606902c6c">VIEW2D_OT_scroll_down</a>);
<a name="l01679"></a>01679     
<a name="l01680"></a>01680     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a83d4b93d003bd62849762a242079dbea">VIEW2D_OT_zoom_in</a>);
<a name="l01681"></a>01681     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a5fe4c203beecfa2acc70250504896107">VIEW2D_OT_zoom_out</a>);
<a name="l01682"></a>01682     
<a name="l01683"></a>01683     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a7c878ad8c5b155487cf354d41175efbe">VIEW2D_OT_zoom</a>);
<a name="l01684"></a>01684     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a7723b568e0f98da58fcba9abfc4c8f7c">VIEW2D_OT_zoom_border</a>);
<a name="l01685"></a>01685     
<a name="l01686"></a>01686     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#a213cf4b196397fb1e85f4b84ab24130d">VIEW2D_OT_scroller_activate</a>);
<a name="l01687"></a>01687 
<a name="l01688"></a>01688     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7c407ff2261b21c85afff3b689e279c0">WM_operatortype_append</a>(<a class="code" href="../../db/d51/view2d__ops_8c.html#ad95acbccbf1f57c18f64e990fc492cbf">VIEW2D_OT_reset</a>);
<a name="l01689"></a>01689 }
<a name="l01690"></a>01690 
<a name="l01691"></a><a class="code" href="../../db/d51/view2d__ops_8c.html#aa9fd2ae9b33fdc4ad8940da2cd661fc0">01691</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d63/UI__view2d_8h.html#a90c0a7bb3f69eedbe045a0b86822a881">UI_view2d_keymap</a>(<a class="code" href="../../d3/df7/structwmKeyConfig.html">wmKeyConfig</a> *keyconf)
<a name="l01692"></a>01692 {
<a name="l01693"></a>01693     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a92bcf8f3f041915f81ad660495dc30cd">WM_keymap_find</a>(keyconf, <span class="stringliteral">&quot;View2D&quot;</span>, 0, 0);
<a name="l01694"></a>01694     <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696     <span class="comment">/* scrollers */</span>
<a name="l01697"></a>01697     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroller_activate&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01698"></a>01698     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroller_activate&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01699"></a>01699 
<a name="l01700"></a>01700     <span class="comment">/* pan/scroll */</span>
<a name="l01701"></a>01701     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_pan&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01702"></a>01702     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_pan&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0);
<a name="l01703"></a>01703     
<a name="l01704"></a>01704     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_pan&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a65f114370656971c14863717d5364176">MOUSEPAN</a>, 0, 0, 0);
<a name="l01705"></a>01705     
<a name="l01706"></a>01706     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_right&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#ab1edce62abb6c90ee2059ba76da20b50">KM_CTRL</a>, 0);
<a name="l01707"></a>01707     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_left&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#ab1edce62abb6c90ee2059ba76da20b50">KM_CTRL</a>, 0);
<a name="l01708"></a>01708     
<a name="l01709"></a>01709     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_down&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0);
<a name="l01710"></a>01710     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_up&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0);
<a name="l01711"></a>01711     
<a name="l01712"></a>01712     <span class="comment">/* zoom - single step */</span>
<a name="l01713"></a>01713     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_out&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3c41d070a90b207d618058b1fb5350c7">WHEELOUTMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01714"></a>01714     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_in&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68fca273375360faf8a1f122cfe1a37c">WHEELINMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01715"></a>01715     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_out&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01716"></a>01716     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_in&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01717"></a>01717     
<a name="l01718"></a>01718     <span class="comment">/* scroll up/down - no modifiers, only when zoom fails */</span>
<a name="l01719"></a>01719     <span class="comment">/* these may fail if zoom is disallowed, in which case they should pass on event */</span>
<a name="l01720"></a>01720     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_down&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01721"></a>01721     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_up&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01722"></a>01722     <span class="comment">/* these may be necessary if vertical scroll is disallowed */</span>
<a name="l01723"></a>01723     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_right&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01724"></a>01724     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_left&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01725"></a>01725     
<a name="l01726"></a>01726     <span class="comment">/* alternatives for page up/down to scroll */</span>
<a name="l01727"></a>01727 <span class="preprocessor">#if 0 // XXX disabled, since this causes conflicts with hotkeys in animation editors</span>
<a name="l01728"></a>01728 <span class="preprocessor"></span>    <span class="comment">/* scroll up/down may fall through to left/right */</span>
<a name="l01729"></a>01729     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_down&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01730"></a>01730     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_up&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01731"></a>01731     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_right&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01732"></a>01732     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_left&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01733"></a>01733     <span class="comment">/* shift for moving view left/right with page up/down */</span>
<a name="l01734"></a>01734     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_right&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0);
<a name="l01735"></a>01735     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_left&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0);
<a name="l01736"></a>01736 <span class="preprocessor">#endif</span>
<a name="l01737"></a>01737 <span class="preprocessor"></span>    
<a name="l01738"></a>01738     <span class="comment">/* zoom - drag */</span>
<a name="l01739"></a>01739     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#ab1edce62abb6c90ee2059ba76da20b50">KM_CTRL</a>, 0);
<a name="l01740"></a>01740     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a87d179409a17bb20a1c248c84b170b55">MOUSEZOOM</a>, 0, 0, 0);
<a name="l01741"></a>01741     
<a name="l01742"></a>01742     <span class="comment">/* borderzoom - drag */</span>
<a name="l01743"></a>01743     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_border&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3ec89d7b25cbb572b2e11b10ad8bc196">BKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0);
<a name="l01744"></a>01744 
<a name="l01745"></a>01745     <span class="comment">/* Alternative keymap for buttons listview */</span>
<a name="l01746"></a>01746     keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a92bcf8f3f041915f81ad660495dc30cd">WM_keymap_find</a>(keyconf, <span class="stringliteral">&quot;View2D Buttons List&quot;</span>, 0, 0);
<a name="l01747"></a>01747 
<a name="l01748"></a>01748     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroller_activate&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01749"></a>01749     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroller_activate&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_pan&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01752"></a>01752     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_pan&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a65f114370656971c14863717d5364176">MOUSEPAN</a>, 0, 0, 0);
<a name="l01753"></a>01753     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_down&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01754"></a>01754     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_up&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01755"></a>01755     
<a name="l01756"></a>01756     kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_down&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01757"></a>01757     <a class="code" href="../../d3/d10/rna__access_8c.html#a1741c6fd78b5d828bb7b83517e2766db">RNA_boolean_set</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a17c86417e0dedf1a101de028ec6a2bd6">ptr</a>, <span class="stringliteral">&quot;page&quot;</span>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01758"></a>01758     kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_scroll_up&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01759"></a>01759     <a class="code" href="../../d3/d10/rna__access_8c.html#a1741c6fd78b5d828bb7b83517e2766db">RNA_boolean_set</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a17c86417e0dedf1a101de028ec6a2bd6">ptr</a>, <span class="stringliteral">&quot;page&quot;</span>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01760"></a>01760     
<a name="l01761"></a>01761     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#ab1edce62abb6c90ee2059ba76da20b50">KM_CTRL</a>, 0);
<a name="l01762"></a>01762     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a87d179409a17bb20a1c248c84b170b55">MOUSEZOOM</a>, 0, 0, 0);
<a name="l01763"></a>01763     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_out&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01764"></a>01764     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_zoom_in&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01765"></a>01765     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(keymap, <span class="stringliteral">&quot;VIEW2D_OT_reset&quot;</span>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9ab826a2e86a9ccd0095979fc4726119">HOMEKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l01766"></a>01766 }
<a name="l01767"></a>01767 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:02 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

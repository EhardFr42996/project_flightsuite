<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: KX_ConvertPhysicsObjects.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">KX_ConvertPhysicsObjects.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../db/dfa/KX__ConvertPhysicsObjects_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00032"></a>00032 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(FREE_WINDOWS)</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#pragma warning (disable : 4786)</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d60/MT__assert_8h.html">MT_assert.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d70/KX__SoftBodyDeformer_8h.html">KX_SoftBodyDeformer.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html">KX_ConvertPhysicsObject.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/de4/BL__DeformableGameObject_8h.html">BL_DeformableGameObject.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da5/KX__Scene_8h.html">KX_Scene.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d4a/BL__System_8h.html">BL_System.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d49/PHY__Pro_8h.html">PHY_Pro.h</a>&quot;</span> <span class="comment">//todo cleanup</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/db9/KX__ClientObjectInfo_8h.html">KX_ClientObjectInfo.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d5d/CTR__Map_8h.html">CTR_Map.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d77/CTR__HashedPtr_8h.html">CTR_HashedPtr.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html">KX_PhysicsEngineEnums.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d49/PHY__Pro_8h.html">PHY_Pro.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d8c/KX__MotionState_8h.html">KX_MotionState.h</a>&quot;</span> <span class="comment">// bridge between motionstate and scenegraph node</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span>{
<a name="l00057"></a>00057 <span class="preprocessor">    #include &quot;<a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html">BKE_DerivedMesh.h</a>&quot;</span>
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d40/btSoftBody_8h.html">BulletSoftBody/btSoftBody.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d4a/CcdPhysicsEnvironment_8h.html">CcdPhysicsEnvironment.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d14/CcdPhysicsController_8h.html">CcdPhysicsController.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d01/btBroadphaseInterface_8h.html">BulletCollision/BroadphaseCollision/btBroadphaseInterface.h</a>&quot;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db9/KX__BulletPhysicsController_8h.html">KX_BulletPhysicsController.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d1d/btBulletDynamicsCommon_8h.html">btBulletDynamicsCommon.h</a>&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="preprocessor">                            #ifdef WIN32</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#if _MSC_VER &gt;= 1310</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="comment">//only use SIMD Hull code under Win32</span>
<a name="l00073"></a>00073 <span class="comment">//#define TEST_HULL 1</span>
<a name="l00074"></a>00074 <span class="preprocessor">#ifdef TEST_HULL</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#define USE_HULL 1</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="comment">//#define TEST_SIMD_HULL 1</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;NarrowPhaseCollision/Hull.h&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#endif //#ifdef TEST_HULL</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="preprocessor">#endif //_MSC_VER </span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#endif //WIN32</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">// forward declarations</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="keywordtype">void</span>    KX_ConvertBulletObject( <span class="keyword">class</span>   <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj,
<a name="l00089"></a>00089     <span class="keyword">class</span>   <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>* meshobj,
<a name="l00090"></a>00090     <span class="keyword">struct</span>  <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a>* dm,
<a name="l00091"></a>00091     <span class="keyword">class</span>   <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* kxscene,
<a name="l00092"></a>00092     <span class="keyword">struct</span>  <a class="code" href="../../d4/dd1/structPHY__ShapeProps.html">PHY_ShapeProps</a>* shapeprops,
<a name="l00093"></a>00093     <span class="keyword">struct</span>  <a class="code" href="../../d7/dce/structPHY__MaterialProps.html">PHY_MaterialProps</a>*  smmaterial,
<a name="l00094"></a>00094     <span class="keyword">struct</span>  <a class="code" href="../../d7/da6/structKX__ObjectProperties.html">KX_ObjectProperties</a>*    objprop)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a>* env = (<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a>*)kxscene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>();
<a name="l00098"></a>00098     <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(env);
<a name="l00099"></a>00099     
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     <span class="keywordtype">bool</span> isbulletdyna = <span class="keyword">false</span>;
<a name="l00102"></a>00102     <span class="keywordtype">bool</span> isbulletsensor = <span class="keyword">false</span>;
<a name="l00103"></a>00103     <span class="keywordtype">bool</span> useGimpact = <span class="keyword">false</span>;
<a name="l00104"></a>00104     <a class="code" href="../../da/d62/structCcdConstructionInfo.html">CcdConstructionInfo</a> ci;
<a name="l00105"></a>00105     <span class="keyword">class </span><a class="code" href="../../d2/d52/classPHY__IMotionState.html">PHY_IMotionState</a>* motionstate = <span class="keyword">new</span> <a class="code" href="../../da/d5b/classKX__MotionState.html">KX_MotionState</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>());
<a name="l00106"></a>00106     <span class="keyword">class </span><a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html">CcdShapeConstructionInfo</a> *shapeInfo = <span class="keyword">new</span> <a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ac4100d728f24cb65e1101f6df37f1a7a">CcdShapeConstructionInfo</a>();
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (!objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a2a2d8e41e05888fc2ccf7d1002d6843d">m_dyna</a>)
<a name="l00110"></a>00110     {
<a name="l00111"></a>00111         ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a42d72c367ca67806e51801f67948d0f3">m_collisionFlags</a> |= btCollisionObject::CF_STATIC_OBJECT;
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113     <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a889e780a79018334110aeaaebb0b312a">m_ghost</a>)
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115         ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a42d72c367ca67806e51801f67948d0f3">m_collisionFlags</a> |= btCollisionObject::CF_NO_CONTACT_RESPONSE;
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ae781f7f6c86bc82e40c8dabbf453648e">m_MotionState</a> = motionstate;
<a name="l00119"></a>00119     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a40a5bfd35e14ed71df4f73fba859017e">m_gravity</a> = btVector3(0,0,0);
<a name="l00120"></a>00120     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a8546c38f9444cd3b53b99e39b03ad33b">m_localInertiaTensor</a> =btVector3(0,0,0);
<a name="l00121"></a>00121     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ac76146c64292e77f0cc1d3b218b074ec">m_mass</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a2a2d8e41e05888fc2ccf7d1002d6843d">m_dyna</a> ? shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a8a75b26b55c5c30d0afee6e8dd7561c5">m_mass</a> : 0.f;
<a name="l00122"></a>00122     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#abd096791b041500499f2518db612f5c6">m_clamp_vel_min</a> = shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#ac093f3c4b17444e2ac595f491809bc6f">m_clamp_vel_min</a>;
<a name="l00123"></a>00123     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ac3afa10130ca2daf5be73f3032072777">m_clamp_vel_max</a> = shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#afc3f16b984dba45dac9292111b40fc5c">m_clamp_vel_max</a>;
<a name="l00124"></a>00124     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a77b185d044381ace03345cb6859fc6ef">m_margin</a>;
<a name="l00125"></a>00125     shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#adae2d19530c86139753b99340c9f435a">m_radius</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a0c25cac9781d3d63622ee1e3e92b9a1d">m_radius</a>;
<a name="l00126"></a>00126     isbulletdyna = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a2a2d8e41e05888fc2ccf7d1002d6843d">m_dyna</a>;
<a name="l00127"></a>00127     isbulletsensor = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ae55504014f8ae1716d5ed906e10d25a4">m_sensor</a>;
<a name="l00128"></a>00128     useGimpact = ((isbulletdyna || isbulletsensor) &amp;&amp; !objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7e800924c61802411a91f3ce10ee5be0">m_softbody</a>);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a8546c38f9444cd3b53b99e39b03ad33b">m_localInertiaTensor</a> = btVector3(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ac76146c64292e77f0cc1d3b218b074ec">m_mass</a>/3.f,ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ac76146c64292e77f0cc1d3b218b074ec">m_mass</a>/3.f,ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ac76146c64292e77f0cc1d3b218b074ec">m_mass</a>/3.f);
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     <a class="code" href="../../d7/dd7/classbtCollisionShape.html" title="The btCollisionShape class provides an interface for collision shapes that can be shared among btColl...">btCollisionShape</a>* bm = 0;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <span class="keywordflow">switch</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a0f16a7259cf5a0dc78b64129ac06481e">m_boundclass</a>)
<a name="l00135"></a>00135     {
<a name="l00136"></a>00136     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498a91dc35df4f5f5039d7ea00ea82618201">KX_BOUNDSPHERE</a>:
<a name="l00137"></a>00137         {
<a name="l00138"></a>00138             <span class="comment">//float radius = objprop-&gt;m_radius;</span>
<a name="l00139"></a>00139             <span class="comment">//btVector3 inertiaHalfExtents (</span>
<a name="l00140"></a>00140             <span class="comment">//  radius,</span>
<a name="l00141"></a>00141             <span class="comment">//  radius,</span>
<a name="l00142"></a>00142             <span class="comment">//  radius);</span>
<a name="l00143"></a>00143             
<a name="l00144"></a>00144             <span class="comment">//blender doesn&#39;t support multisphere, but for testing:</span>
<a name="l00145"></a>00145 
<a name="l00146"></a>00146             <span class="comment">//bm = new MultiSphereShape(inertiaHalfExtents,,&amp;trans.getOrigin(),&amp;radius,1);</span>
<a name="l00147"></a>00147             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> = <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaa1cbd35b2b5125b05682ae9c63822d0f4">PHY_SHAPE_SPHERE</a>;
<a name="l00148"></a>00148             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>);
<a name="l00149"></a>00149             <span class="keywordflow">break</span>;
<a name="l00150"></a>00150         };
<a name="l00151"></a>00151     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498a5b6d917d87de164d08d63cf9aab0babc">KX_BOUNDBOX</a>:
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a08df07eabfc1aa1821e9c5461e6f1ab6">m_halfExtend</a>.setValue(
<a name="l00154"></a>00154                 objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ad158270d698d6c45b69ea4b875b7e3ab">box</a>.<a class="code" href="../../dc/dc5/structKX__BoxBounds.html#a07fb4676041e1193e73fec6f5744a64a">m_extends</a>[0],
<a name="l00155"></a>00155                 objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ad158270d698d6c45b69ea4b875b7e3ab">box</a>.<a class="code" href="../../dc/dc5/structKX__BoxBounds.html#a07fb4676041e1193e73fec6f5744a64a">m_extends</a>[1],
<a name="l00156"></a>00156                 objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ad158270d698d6c45b69ea4b875b7e3ab">box</a>.<a class="code" href="../../dc/dc5/structKX__BoxBounds.html#a07fb4676041e1193e73fec6f5744a64a">m_extends</a>[2]);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a08df07eabfc1aa1821e9c5461e6f1ab6">m_halfExtend</a> /= 2.0;
<a name="l00159"></a>00159             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a08df07eabfc1aa1821e9c5461e6f1ab6">m_halfExtend</a> = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a08df07eabfc1aa1821e9c5461e6f1ab6">m_halfExtend</a>.absolute();
<a name="l00160"></a>00160             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> = <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaa4d70e8b66f3d61c6340027608ec01601">PHY_SHAPE_BOX</a>;
<a name="l00161"></a>00161             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>);
<a name="l00162"></a>00162             <span class="keywordflow">break</span>;
<a name="l00163"></a>00163         };
<a name="l00164"></a>00164     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498aaa8c85d9d8cfa90f67813502ea83a3d1">KX_BOUNDCYLINDER</a>:
<a name="l00165"></a>00165         {
<a name="l00166"></a>00166             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a08df07eabfc1aa1821e9c5461e6f1ab6">m_halfExtend</a>.setValue(
<a name="l00167"></a>00167                 objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#ad61aa7dbd910dbbc657d3649d2f10f68">m_radius</a>,
<a name="l00168"></a>00168                 objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#ad61aa7dbd910dbbc657d3649d2f10f68">m_radius</a>,
<a name="l00169"></a>00169                 objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#a270e49e4f6da154b26a35c1b36a1eb3c">m_height</a> * 0.5f
<a name="l00170"></a>00170             );
<a name="l00171"></a>00171             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> = <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaa77cc0d4a3571df3241893de8494c7c3c">PHY_SHAPE_CYLINDER</a>;
<a name="l00172"></a>00172             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>);
<a name="l00173"></a>00173             <span class="keywordflow">break</span>;
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498a87bea1bf3d641072f2d817f8d616e9c0">KX_BOUNDCONE</a>:
<a name="l00177"></a>00177         {
<a name="l00178"></a>00178             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#adae2d19530c86139753b99340c9f435a">m_radius</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#ad61aa7dbd910dbbc657d3649d2f10f68">m_radius</a>;
<a name="l00179"></a>00179             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9e64f37bddcead2c45e18a90952ecc6a">m_height</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#a270e49e4f6da154b26a35c1b36a1eb3c">m_height</a>;
<a name="l00180"></a>00180             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> = <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaa02b16d466b7723ab08987d636bb3c893">PHY_SHAPE_CONE</a>;
<a name="l00181"></a>00181             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>);
<a name="l00182"></a>00182             <span class="keywordflow">break</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498af30f6c2dbe487b4b16ab07494f8a136d">KX_BOUNDPOLYTOPE</a>:
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ab991d8adf0b5e91af719869623ae2bea">SetMesh</a>(meshobj, dm,<span class="keyword">true</span>);
<a name="l00187"></a>00187             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>);
<a name="l00188"></a>00188             <span class="keywordflow">break</span>;
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498a9fb8393f8804dd6001afe17ed88842ba">KX_BOUNDCAPSULE</a>:
<a name="l00191"></a>00191         {
<a name="l00192"></a>00192             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#adae2d19530c86139753b99340c9f435a">m_radius</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#ad61aa7dbd910dbbc657d3649d2f10f68">m_radius</a>;
<a name="l00193"></a>00193             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9e64f37bddcead2c45e18a90952ecc6a">m_height</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7443a7cd7674987ab3f416f2f487180e">m_boundobject</a>.<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a01b11cd260859fee687f5e445ab84332">c</a>.<a class="code" href="../../da/d1e/structKX__CBounds.html#a270e49e4f6da154b26a35c1b36a1eb3c">m_height</a>;
<a name="l00194"></a>00194             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> = <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaaac44ec4fdfcc1d5aa10aacf48db0b9d7">PHY_SHAPE_CAPSULE</a>;
<a name="l00195"></a>00195             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>);
<a name="l00196"></a>00196             <span class="keywordflow">break</span>;
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498aa615954e6f6374c988d5229f4997089b">KX_BOUNDMESH</a>:
<a name="l00199"></a>00199         {
<a name="l00200"></a>00200             <span class="comment">// mesh shapes can be shared, check first if we already have a shape on that mesh</span>
<a name="l00201"></a>00201             <span class="keyword">class </span><a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html">CcdShapeConstructionInfo</a> *sharedShapeInfo = <a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a0d6ce0acf0b0ecee7c8b3a8ff8ba78ad">CcdShapeConstructionInfo::FindMesh</a>(meshobj, dm, <span class="keyword">false</span>);
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (sharedShapeInfo != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l00203"></a>00203             {
<a name="l00204"></a>00204                 shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a70f35abafde365e311441d8052697069">Release</a>();
<a name="l00205"></a>00205                 shapeInfo = sharedShapeInfo;
<a name="l00206"></a>00206                 shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a82628ab59948d70446675dd8bf389fa6">AddRef</a>();
<a name="l00207"></a>00207             } <span class="keywordflow">else</span>
<a name="l00208"></a>00208             {
<a name="l00209"></a>00209                 shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ab991d8adf0b5e91af719869623ae2bea">SetMesh</a>(meshobj, dm, <span class="keyword">false</span>);
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212             <span class="comment">// Soft bodies can benefit from welding, don&#39;t do it on non-soft bodies</span>
<a name="l00213"></a>00213             <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7e800924c61802411a91f3ce10ee5be0">m_softbody</a>)
<a name="l00214"></a>00214             {
<a name="l00215"></a>00215                 shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a7777aa524988516d06e8714118a4fc4b">setVertexWeldingThreshold1</a>(objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a5b8c115e3ad261e5f9dfb1522cf9c726">m_soft_welding</a>); <span class="comment">//todo: expose this to the UI</span>
<a name="l00216"></a>00216             }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218             bm = shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>, useGimpact, !objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7e800924c61802411a91f3ce10ee5be0">m_softbody</a>);
<a name="l00219"></a>00219             <span class="comment">//should we compute inertia for dynamic shape?</span>
<a name="l00220"></a>00220             <span class="comment">//bm-&gt;calculateLocalInertia(ci.m_mass,ci.m_localInertiaTensor);</span>
<a name="l00221"></a>00221 
<a name="l00222"></a>00222             <span class="keywordflow">break</span>;
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224     <span class="keywordflow">case</span> <a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html#a39af9cd48df73be814b55929af6a2498a5ea6f3e1d6612bb67b9da5a340c84de5">KX_BOUND_DYN_MESH</a>:
<a name="l00225"></a>00225         <span class="comment">/* do nothing */</span>
<a name="l00226"></a>00226         <span class="keywordflow">break</span>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">//  ci.m_localInertiaTensor.setValue(0.1f,0.1f,0.1f);</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (!bm)
<a name="l00233"></a>00233     {
<a name="l00234"></a>00234         <span class="keyword">delete</span> motionstate;
<a name="l00235"></a>00235         shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a70f35abafde365e311441d8052697069">Release</a>();
<a name="l00236"></a>00236         <span class="keywordflow">return</span>;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">//bm-&gt;setMargin(ci.m_margin);</span>
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#af838746a2c7f0ca35506eb0633aa6017">m_isCompoundChild</a>)
<a name="l00243"></a>00243         {
<a name="l00244"></a>00244             <span class="comment">//find parent, compound shape and add to it</span>
<a name="l00245"></a>00245             <span class="comment">//take relative transform into account!</span>
<a name="l00246"></a>00246             <a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>* parentCtrl = (<a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>*)objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a782c5231e5c7d54281d6de34f33aa3c8">m_dynamic_parent</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8fca8020988a86c8cb72dbeb5d4a8e2f">GetPhysicsController</a>();
<a name="l00247"></a>00247             <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(parentCtrl);
<a name="l00248"></a>00248             <a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html">CcdShapeConstructionInfo</a>* parentShapeInfo = parentCtrl-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a4a71ada6af7ac5621ab35ec7fdc0f5d0">GetShapeInfo</a>();
<a name="l00249"></a>00249             <a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a>* rigidbody = parentCtrl-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a23213dc1febb96503449d50afb9a8da6">GetRigidBody</a>();
<a name="l00250"></a>00250             <a class="code" href="../../d7/dd7/classbtCollisionShape.html" title="The btCollisionShape class provides an interface for collision shapes that can be shared among btColl...">btCollisionShape</a>* colShape = rigidbody-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a5f821aa731290a47b6dfcd2e981e69bb">getCollisionShape</a>();
<a name="l00251"></a>00251             <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(colShape-&gt;<a class="code" href="../../d7/dd7/classbtCollisionShape.html#a2ae27ee79f2b96b73a5edb887a28e050">isCompound</a>());
<a name="l00252"></a>00252             btCompoundShape* compoundShape = (btCompoundShape*)colShape;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254             <span class="comment">// compute the local transform from parent, this may include several node in the chain</span>
<a name="l00255"></a>00255             <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* gameNode = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>();
<a name="l00256"></a>00256             <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* parentNode = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a782c5231e5c7d54281d6de34f33aa3c8">m_dynamic_parent</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>();
<a name="l00257"></a>00257             <span class="comment">// relative transform</span>
<a name="l00258"></a>00258             <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> parentScale = parentNode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a3078d7872c2ae7a194546c96b09ff301">GetWorldScaling</a>();
<a name="l00259"></a>00259             parentScale[0] = <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a>(1.0)/parentScale[0];
<a name="l00260"></a>00260             parentScale[1] = <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a>(1.0)/parentScale[1];
<a name="l00261"></a>00261             parentScale[2] = <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a>(1.0)/parentScale[2];
<a name="l00262"></a>00262             <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> relativeScale = gameNode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a3078d7872c2ae7a194546c96b09ff301">GetWorldScaling</a>() * parentScale;
<a name="l00263"></a>00263             <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a> parentInvRot = parentNode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1da2a4c264204b135154f815f41d637e">GetWorldOrientation</a>().<a class="code" href="../../dd/d6f/classMT__Matrix3x3.html#a8048302d84c11dc1fec3d686c7ed3e01">transposed</a>();
<a name="l00264"></a>00264             <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> relativePos = parentInvRot*((gameNode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1bbc34fe0c2345e55900eaa5943dfc51">GetWorldPosition</a>()-parentNode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1bbc34fe0c2345e55900eaa5943dfc51">GetWorldPosition</a>())*parentScale);
<a name="l00265"></a>00265             <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a> relativeRot = parentInvRot*gameNode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1da2a4c264204b135154f815f41d637e">GetWorldOrientation</a>();
<a name="l00266"></a>00266 
<a name="l00267"></a>00267             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ad1d24777f6f3007cf62c4c66cfd6f6ab">m_childScale</a>.setValue(relativeScale[0],relativeScale[1],relativeScale[2]);
<a name="l00268"></a>00268             bm-&gt;<a class="code" href="../../d7/dd7/classbtCollisionShape.html#ab0e7232cb21511258227afafb952a0a5">setLocalScaling</a>(shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ad1d24777f6f3007cf62c4c66cfd6f6ab">m_childScale</a>);
<a name="l00269"></a>00269             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ab15e9cca981790b830d00eee502526df">m_childTrans</a>.<a class="code" href="../../d4/d79/classbtTransform.html#a1fbf71080d75e64ef8cb5130e2bef196" title="Return the origin vector translation.">getOrigin</a>().setValue(relativePos[0],relativePos[1],relativePos[2]);
<a name="l00270"></a>00270             <span class="keywordtype">float</span> <a class="code" href="../../df/d5a/svm__noise_8h.html#aae44e21ada356d9d84450d5440fbb0c4">rot</a>[12];
<a name="l00271"></a>00271             relativeRot.<a class="code" href="../../dd/d6f/classMT__Matrix3x3.html#a7f3657640cc6d479d1d965262a560f9c">getValue</a>(rot);
<a name="l00272"></a>00272             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ab15e9cca981790b830d00eee502526df">m_childTrans</a>.<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>().<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a2135b57e51831fd0112299c6e1348beb" title="Set from the rotational part of a 4x4 OpenGL matrix.">setFromOpenGLSubMatrix</a>(rot);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274             parentShapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a90deb6051a630673574ad407498a5e7a">AddShape</a>(shapeInfo);   
<a name="l00275"></a>00275             compoundShape-&gt;addChildShape(shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ab15e9cca981790b830d00eee502526df">m_childTrans</a>,bm);
<a name="l00276"></a>00276             <span class="comment">//do some recalc?</span>
<a name="l00277"></a>00277             <span class="comment">//recalc inertia for rigidbody</span>
<a name="l00278"></a>00278             <span class="keywordflow">if</span> (!rigidbody-&gt;isStaticOrKinematicObject())
<a name="l00279"></a>00279             {
<a name="l00280"></a>00280                 btVector3 localInertia;
<a name="l00281"></a>00281                 <span class="keywordtype">float</span> mass = 1.f/rigidbody-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#aff8193d59d882da6de7236b2410d7e52">getInvMass</a>();
<a name="l00282"></a>00282                 compoundShape-&gt;calculateLocalInertia(mass,localInertia);
<a name="l00283"></a>00283                 rigidbody-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a912b4a273bcd6fe9af25c47106db900c">setMassProps</a>(mass,localInertia);
<a name="l00284"></a>00284             }
<a name="l00285"></a>00285             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a70f35abafde365e311441d8052697069">Release</a>();
<a name="l00286"></a>00286             <span class="comment">// delete motionstate as it&#39;s not used</span>
<a name="l00287"></a>00287             <span class="keyword">delete</span> motionstate;
<a name="l00288"></a>00288             <span class="keywordflow">return</span>;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#af7804bcac378a0e44222515ff44909c5">m_hasCompoundChildren</a>)
<a name="l00292"></a>00292         {
<a name="l00293"></a>00293             <span class="comment">// create a compound shape info</span>
<a name="l00294"></a>00294             <a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html">CcdShapeConstructionInfo</a> *compoundShapeInfo = <span class="keyword">new</span> <a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ac4100d728f24cb65e1101f6df37f1a7a">CcdShapeConstructionInfo</a>();
<a name="l00295"></a>00295             compoundShapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> = <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaa8b272a35838563913e4e2f274d17c98d">PHY_SHAPE_COMPOUND</a>;
<a name="l00296"></a>00296             compoundShapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a90deb6051a630673574ad407498a5e7a">AddShape</a>(shapeInfo);
<a name="l00297"></a>00297             <span class="comment">// create the compound shape manually as we already have the child shape</span>
<a name="l00298"></a>00298             btCompoundShape* compoundShape = <span class="keyword">new</span> btCompoundShape();
<a name="l00299"></a>00299             compoundShape-&gt;addChildShape(shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ab15e9cca981790b830d00eee502526df">m_childTrans</a>,bm);
<a name="l00300"></a>00300             <span class="comment">// now replace the shape</span>
<a name="l00301"></a>00301             bm = compoundShape;
<a name="l00302"></a>00302             shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a70f35abafde365e311441d8052697069">Release</a>();
<a name="l00303"></a>00303             shapeInfo = compoundShapeInfo;
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="preprocessor">#ifdef TEST_SIMD_HULL</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (bm-&gt;IsPolyhedral())
<a name="l00313"></a>00313     {
<a name="l00314"></a>00314         PolyhedralConvexShape* polyhedron = <span class="keyword">static_cast&lt;</span>PolyhedralConvexShape*<span class="keyword">&gt;</span>(bm);
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (!polyhedron-&gt;m_optionalHull)
<a name="l00316"></a>00316         {
<a name="l00317"></a>00317             <span class="comment">//first convert vertices in &#39;Point3&#39; format</span>
<a name="l00318"></a>00318             <span class="keywordtype">int</span> numPoints = polyhedron-&gt;GetNumVertices();
<a name="l00319"></a>00319             Point3* points = <span class="keyword">new</span> Point3[numPoints+1];
<a name="l00320"></a>00320             <span class="comment">//first 4 points should not be co-planar, so add central point to satisfy MakeHull</span>
<a name="l00321"></a>00321             points[0] = Point3(0.f,0.f,0.f);
<a name="l00322"></a>00322             
<a name="l00323"></a>00323             btVector3 <a class="code" href="../../db/d7c/structvertex.html">vertex</a>;
<a name="l00324"></a>00324             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>=0;<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>&lt;numPoints;<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>++)
<a name="l00325"></a>00325             {
<a name="l00326"></a>00326                 polyhedron-&gt;GetVertex(<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>,vertex);
<a name="l00327"></a>00327                 points[<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>+1] = Point3(vertex.getX(),vertex.getY(),vertex.getZ());
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330             Hull* hull = Hull::MakeHull(numPoints+1,points);
<a name="l00331"></a>00331             polyhedron-&gt;m_optionalHull = hull;
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335 <span class="preprocessor">#endif //TEST_SIMD_HULL</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#aaf65bb11c7165027cafe233dd66d414c">m_collisionShape</a> = bm;
<a name="l00339"></a>00339     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a39566e54911c4db6515a25216795e00d">m_shapeInfo</a> = shapeInfo;
<a name="l00340"></a>00340     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ac434a908df2e47b6e511a4c20b7d822a">m_friction</a> = smmaterial-&gt;<a class="code" href="../../d7/dce/structPHY__MaterialProps.html#a6773431e8f8476c767a6c2ee55676289">m_friction</a>;<span class="comment">//tweak the friction a bit, so the default 0.5 works nice</span>
<a name="l00341"></a>00341     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ad06c56b4cc3bdf7593302084e2e882e7">m_restitution</a> = smmaterial-&gt;<a class="code" href="../../d7/dce/structPHY__MaterialProps.html#a67231b92b9ef7cd2097f4072a1bc4b39">m_restitution</a>;
<a name="l00342"></a>00342     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ad1466866214087738d21867bd8c5f64e">m_physicsEnv</a> = env;
<a name="l00343"></a>00343     <span class="comment">// drag / damping is inverted</span>
<a name="l00344"></a>00344     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a3ac285e9deac28c5e952b220309141c9">m_linearDamping</a> = 1.f - shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a03e311aae67b87988d7792663d98e81f">m_lin_drag</a>;
<a name="l00345"></a>00345     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a390d2d1a52258ff4652ddb87a2e59617">m_angularDamping</a> = 1.f - shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#abfe88f86141eab2841189b2691a06eaf">m_ang_drag</a>;
<a name="l00346"></a>00346     <span class="comment">//need a bit of damping, else system doesn&#39;t behave well</span>
<a name="l00347"></a>00347     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a030b2dd440b5ff88a13a3f2356cc9458">m_inertiaFactor</a> = shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a004e2a690ab605f8e55afed6e851a7f8">m_inertia</a>/0.4f;<span class="comment">//defaults to 0.4, don&#39;t want to change behavior</span>
<a name="l00348"></a>00348     
<a name="l00349"></a>00349     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a367f57043c4855b5b10f5f9948286a4f">m_do_anisotropic</a> = shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a3e832ce28d8af948fa7851211865e421">m_do_anisotropic</a>;
<a name="l00350"></a>00350     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ab146ba10047198628a7fbe69bcc63a52">m_anisotropicFriction</a>.setValue(shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a7c1b3f81c86908c8924353410dc45f72">m_friction_scaling</a>[0],shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a7c1b3f81c86908c8924353410dc45f72">m_friction_scaling</a>[1],shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a7c1b3f81c86908c8924353410dc45f72">m_friction_scaling</a>[2]);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 
<a name="l00354"></a>00354     <span class="comment">//do Fh, do Rot Fh</span>
<a name="l00355"></a>00355     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a41033798c3ae08e69b9e61298f4ed640" title="Should the object have a linear Fh spring?">m_do_fh</a> = shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a03bbcb172e95856fe73ceccd7058469e">m_do_fh</a>;
<a name="l00356"></a>00356     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a29852d1a5881974f17acf31f090f262d" title="Should the object have an angular Fh spring?">m_do_rot_fh</a> = shapeprops-&gt;<a class="code" href="../../d4/dd1/structPHY__ShapeProps.html#a6600dad2a4e1c6d7bf9a254258e83b71">m_do_rot_fh</a>;
<a name="l00357"></a>00357     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a91c40eca37bf6e7ed8c9398d055e27fc" title="Damping factor (linear and angular) in range [0, 1].">m_fh_damping</a> = smmaterial-&gt;<a class="code" href="../../d7/dce/structPHY__MaterialProps.html#a6686a5317bdb3f4f7b2db527ef79ab00">m_fh_damping</a>;
<a name="l00358"></a>00358     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a6813d7eb78e9e7601de34de45739b161" title="The range above the surface where Fh is active.">m_fh_distance</a> = smmaterial-&gt;<a class="code" href="../../d7/dce/structPHY__MaterialProps.html#a6a855a987e430b26ca30404fbeaf4c89">m_fh_distance</a>;
<a name="l00359"></a>00359     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a0e6c8ff870452fe107b750640e78eb0e" title="Should the object slide off slopes?">m_fh_normal</a> = smmaterial-&gt;<a class="code" href="../../d7/dce/structPHY__MaterialProps.html#a6b7e19bc1fe368b13a3804f51f01fd07">m_fh_normal</a>;
<a name="l00360"></a>00360     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a3fdc31c31cac61016f5edf519bac11db" title="Spring constant (both linear and angular)">m_fh_spring</a> = smmaterial-&gt;<a class="code" href="../../d7/dce/structPHY__MaterialProps.html#adb56370e9cc933e70d6e06e8c61b3793">m_fh_spring</a>;
<a name="l00361"></a>00361     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a2dc89ae011a56a31466570570a58a5ff">m_radius</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a0c25cac9781d3d63622ee1e3e92b9a1d">m_radius</a>;
<a name="l00362"></a>00362     
<a name="l00363"></a>00363     
<a name="l00365"></a>00365     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ace856d59a527ccceb1d3399690d40015">m_gamesoftFlag</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a171c7d32d7604fbc1745467dcdeb1942">m_gamesoftFlag</a>;
<a name="l00366"></a>00366     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#aba2103e6ecba386f51e8a73c113d502a">m_soft_linStiff</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a5664b39cedc5f24fd5f34bd04df13965">m_soft_linStiff</a>;
<a name="l00367"></a>00367     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ab69a10d1e1c0c4b525598564f2ed47bb">m_soft_angStiff</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a492a13beab3f04a951b54061cc96c534">m_soft_angStiff</a>;      <span class="comment">/* angular stiffness 0..1 */</span>
<a name="l00368"></a>00368     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#adab8a098b68ee28d18520804e642d522">m_soft_volume</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#abe0688efd0d97ca220dd2e48578b2b0c">m_soft_volume</a>;           <span class="comment">/* volume preservation 0..1 */</span>
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a5c854de8a180f1945b072f4cadccbf24">m_soft_viterations</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aaf0a4da83862a70fa947f57a4e4f0191">m_soft_viterations</a>;     <span class="comment">/* Velocities solver iterations */</span>
<a name="l00371"></a>00371     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ab45fa188cb97007c3a48dd05aaba10c1">m_soft_piterations</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a4a67ee2ea5dc3c01271a94f3fd84cf43">m_soft_piterations</a>;     <span class="comment">/* Positions solver iterations */</span>
<a name="l00372"></a>00372     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a84aebfa68f28a8aa0bedbbfaaf978dac">m_soft_diterations</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a6e9391755b3380696f31d8aea1aa666e">m_soft_diterations</a>;     <span class="comment">/* Drift solver iterations */</span>
<a name="l00373"></a>00373     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a3d086492280f0a7cade34e272f375b57">m_soft_citerations</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ac67d05816847ecc8515c60958fa6c113">m_soft_citerations</a>;     <span class="comment">/* Cluster solver iterations */</span>
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a66be96159b91fab7a3905b0d4644baee">m_soft_kSRHR_CL</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a68ac66dc9fd9cdea145cd8b4c6e5d08f">m_soft_kSRHR_CL</a>;       <span class="comment">/* Soft vs rigid hardness [0,1] (cluster only) */</span>
<a name="l00376"></a>00376     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a5cfd060a7c58e9bea0320331a9e4bb64">m_soft_kSKHR_CL</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aeba2d6df9c8adbd0fe69b649ff789580">m_soft_kSKHR_CL</a>;       <span class="comment">/* Soft vs kinetic hardness [0,1] (cluster only) */</span>
<a name="l00377"></a>00377     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a43bb4a0d43308f798b3b29e537c83d62">m_soft_kSSHR_CL</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ab3df8d7c13346d2a9ac4ee6968c972d4">m_soft_kSSHR_CL</a>;       <span class="comment">/* Soft vs soft hardness [0,1] (cluster only) */</span>
<a name="l00378"></a>00378     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a77bdb946cf7c311a2595fea32fba9017">m_soft_kSR_SPLT_CL</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a1176573581953526d9ecbcf3684b4397">m_soft_kSR_SPLT_CL</a>; <span class="comment">/* Soft vs rigid impulse split [0,1] (cluster only) */</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#abb8e957a0ae9bf280483da70ea3d9d34">m_soft_kSK_SPLT_CL</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a505aa65590082d826e4107e87116f38d">m_soft_kSK_SPLT_CL</a>; <span class="comment">/* Soft vs rigid impulse split [0,1] (cluster only) */</span>
<a name="l00381"></a>00381     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a007c77a5d24249543b9cb8133d51121d">m_soft_kSS_SPLT_CL</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a8feb9899bfb6b7737cd04154348e236c">m_soft_kSS_SPLT_CL</a>; <span class="comment">/* Soft vs rigid impulse split [0,1] (cluster only) */</span>
<a name="l00382"></a>00382     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a2a2cd387def71dc64f71fba28f81973b">m_soft_kVCF</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a5bde0114e1dd06b63e0dca3c9ddb38ca">m_soft_kVCF</a>;           <span class="comment">/* Velocities correction factor (Baumgarte) */</span>
<a name="l00383"></a>00383     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a0b5cb893d2061d603bfe012d7056f086">m_soft_kDP</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a209d760d49d5f9d6013b7ecb55be45b9">m_soft_kDP</a>;         <span class="comment">/* Damping coefficient [0,1] */</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a500ba0cbe767136440be7b3addffe978">m_soft_kDG</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#adfa78b945e9292e58b46945c770ec553">m_soft_kDG</a>;         <span class="comment">/* Drag coefficient [0,+inf] */</span>
<a name="l00386"></a>00386     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ab6d4934d0bd388f4cbc6c0a95a6bbf57">m_soft_kLF</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ab6cd9c42ca4458809d9888dc565bea12">m_soft_kLF</a>;         <span class="comment">/* Lift coefficient [0,+inf] */</span>
<a name="l00387"></a>00387     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#aec3146ad3cd1d93ebc2d44c15609786f">m_soft_kPR</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a9f367ff75ea2f36231319579a9ab4204">m_soft_kPR</a>;         <span class="comment">/* Pressure coefficient [-inf,+inf] */</span>
<a name="l00388"></a>00388     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a23dcf336e89dd7a4a8ca1d14fd056a52">m_soft_kVC</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#abb500deac2a3b09117245103cf01de3b">m_soft_kVC</a>;         <span class="comment">/* Volume conversation coefficient [0,+inf] */</span>
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a138711ceb8e7a03824179871b88d2c1d">m_soft_kDF</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a1d4794dbce151568dfa0b0dfe0cf5bb4">m_soft_kDF</a>;         <span class="comment">/* Dynamic friction coefficient [0,1] */</span>
<a name="l00391"></a>00391     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ab3d5ffd5106f4ef2e8df6439ff100444">m_soft_kMT</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a9ab29256290c46eee911bb73de3560a1">m_soft_kMT</a>;         <span class="comment">/* Pose matching coefficient [0,1] */</span>
<a name="l00392"></a>00392     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a76952a8f0c2b21ea53cf1eac71d7f395">m_soft_kCHR</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aeede16a7b244fec6db247966a1e5574f">m_soft_kCHR</a>;           <span class="comment">/* Rigid contacts hardness [0,1] */</span>
<a name="l00393"></a>00393     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a3e2a21a75c8eb55c01d0028f47bc8b1e">m_soft_kKHR</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a4ba1e8140760d0d84dfe33345e26e5ac">m_soft_kKHR</a>;           <span class="comment">/* Kinetic contacts hardness [0,1] */</span>
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#aeaa7f115b6679ee7e776ff5ef9571d43">m_soft_kSHR</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aa2a9b7459b9d92de86b4a408e70c46f0">m_soft_kSHR</a>;           <span class="comment">/* Soft contacts hardness [0,1] */</span>
<a name="l00396"></a>00396     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a0834f9ead5fb8979cfb5b625f7530191">m_soft_kAHR</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aea77b052686441ffe84be439a4e7d73c">m_soft_kAHR</a>;           <span class="comment">/* Anchors hardness [0,1] */</span>
<a name="l00397"></a>00397     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ad5151b64d709a4c73053840b636f1b20">m_soft_collisionflags</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a5b00c80fd7c990652c45d66746423e2d">m_soft_collisionflags</a>;   <span class="comment">/* Vertex/Face or Signed Distance Field(SDF) or Clusters, Soft versus Soft or Rigid */</span>
<a name="l00398"></a>00398     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a4e1a7b83942c5e1b6b2ded206cd1da3b">m_soft_numclusteriterations</a>= objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a4c33044a01a788b0d117ee463ed06cb6">m_soft_numclusteriterations</a>;   <span class="comment">/* number of iterations to refine collision clusters*/</span>
<a name="l00399"></a>00399 
<a name="l00401"></a>00401     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a2e2f8551979a6f26522cf62448ea8a3b">m_collisionFilterGroup</a> = 
<a name="l00402"></a>00402         (isbulletsensor) ? <span class="keywordtype">short</span>(<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298a618c5baa69959d9a2682f74a49b36527">CcdConstructionInfo::SensorFilter</a>) :
<a name="l00403"></a>00403         (isbulletdyna) ? <span class="keywordtype">short</span>(<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298a5aba9748c8bd06b257c87a01a5485de7">CcdConstructionInfo::DefaultFilter</a>) : 
<a name="l00404"></a>00404         short(<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298a1718efa37f53cbf28f0f50ce9c6caab0">CcdConstructionInfo::StaticFilter</a>);
<a name="l00405"></a>00405     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#ae4ecf7c30d4530665b6491f576252387">m_collisionFilterMask</a> = 
<a name="l00406"></a>00406         (isbulletsensor) ? <span class="keywordtype">short</span>(<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298aa1f08abd4de4fdd28ba59d040e828b7e">CcdConstructionInfo::AllFilter</a> ^ <a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298a618c5baa69959d9a2682f74a49b36527">CcdConstructionInfo::SensorFilter</a>) :
<a name="l00407"></a>00407         (isbulletdyna) ? <span class="keywordtype">short</span>(<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298aa1f08abd4de4fdd28ba59d040e828b7e">CcdConstructionInfo::AllFilter</a>) : 
<a name="l00408"></a>00408         short(<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298aa1f08abd4de4fdd28ba59d040e828b7e">CcdConstructionInfo::AllFilter</a> ^ <a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1a55389ea25ac77c3d624d62239e9298a1718efa37f53cbf28f0f50ce9c6caab0">CcdConstructionInfo::StaticFilter</a>);
<a name="l00409"></a>00409     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a95a413467b4fd2d2842eaf22e9e17319">m_bRigid</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a2a2d8e41e05888fc2ccf7d1002d6843d">m_dyna</a> &amp;&amp; objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aa2c1cd2e076e53add183a1daff78d761">m_angular_rigidbody</a>;
<a name="l00410"></a>00410     
<a name="l00411"></a>00411     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a662a71feeda1d11825edfd966b047a7c" title="Process contacts with positive distance in range [0..INF].">m_contactProcessingThreshold</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aca66e9104c473d231da6bda2a4614d32">m_contactProcessingThreshold</a>;<span class="comment">//todo: expose this in advanced settings, just like margin, default to 10000 or so</span>
<a name="l00412"></a>00412     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a36e3a83bcf2c43873e18e7cf37ad0cfb">m_bSoft</a> = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7e800924c61802411a91f3ce10ee5be0">m_softbody</a>;
<a name="l00413"></a>00413     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a5b4930045b8eef5ec0763ae3ea844f02">m_bSensor</a> = isbulletsensor;
<a name="l00414"></a>00414     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#abf4c4109803d3e4a825678aa88f594b9">m_bGimpact</a> = useGimpact;
<a name="l00415"></a>00415     <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> scaling = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a214226e36095439d638bb17d0057f88c">NodeGetWorldScaling</a>();
<a name="l00416"></a>00416     ci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#aabfdc66b42772c0dbf93ea6123bf3d2b">m_scaling</a>.setValue(scaling[0], scaling[1], scaling[2]);
<a name="l00417"></a>00417     <a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>* physicscontroller = <span class="keyword">new</span> <a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>(ci,isbulletdyna,isbulletsensor,objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#af7804bcac378a0e44222515ff44909c5">m_hasCompoundChildren</a>);
<a name="l00418"></a>00418     <span class="comment">// shapeInfo is reference counted, decrement now as we don&#39;t use it anymore</span>
<a name="l00419"></a>00419     <span class="keywordflow">if</span> (shapeInfo)
<a name="l00420"></a>00420         shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a70f35abafde365e311441d8052697069">Release</a>();
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a85599457a0abdd5c10f28ae3ebd26a0d">SetPhysicsController</a>(physicscontroller,isbulletdyna);
<a name="l00423"></a>00423     <span class="comment">// don&#39;t add automatically sensor object, they are added when a collision sensor is registered</span>
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (!isbulletsensor &amp;&amp; objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a0e57c5cf100db051a0bcde57c8dc9808">m_in_active_layer</a>)
<a name="l00425"></a>00425     {
<a name="l00426"></a>00426         env-&gt;<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html#a499ce415dc0d29c5b3ec83c73eb59192">addCcdPhysicsController</a>( physicscontroller);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428     physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#abfa4d13e5c2850a1c77e972fecc1c88d">setNewClientInfo</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4fb43f2d41de4ddd5130fa0c882dd204">getClientInfo</a>());      
<a name="l00429"></a>00429     {
<a name="l00430"></a>00430         <a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a>* rbody = physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a23213dc1febb96503449d50afb9a8da6">GetRigidBody</a>();
<a name="l00431"></a>00431 
<a name="l00432"></a>00432         <span class="keywordflow">if</span> (rbody)
<a name="l00433"></a>00433         {
<a name="l00434"></a>00434             <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aa2c1cd2e076e53add183a1daff78d761">m_angular_rigidbody</a>)
<a name="l00435"></a>00435             {
<a name="l00436"></a>00436                 btVector3 linearFactor(
<a name="l00437"></a>00437                     objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ace94bbbebf6b253eab7389d0b07e98dd">m_lockXaxis</a>? 0 : 1,
<a name="l00438"></a>00438                     objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a0e69d6031433e8a0f3430eaab09dd3b0">m_lockYaxis</a>? 0 : 1,
<a name="l00439"></a>00439                     objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a0fe87ca3d67fea8b63a2f2f0ae660cff">m_lockZaxis</a>? 0 : 1);
<a name="l00440"></a>00440                 btVector3 angularFactor(
<a name="l00441"></a>00441                     objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a9691e88b9aa0b5262e99b4a35bb55bc9">m_lockXRotaxis</a>? 0 : 1,
<a name="l00442"></a>00442                     objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7d7f062366070ef20b19ae3b6fe4fd05">m_lockYRotaxis</a>? 0 : 1,
<a name="l00443"></a>00443                     objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#abeb59a3a03d70a0c014a0f7fc8121de0">m_lockZRotaxis</a>? 0 : 1);
<a name="l00444"></a>00444                 rbody-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a00cf3fa28987ffb77764e5bd3605e3ef">setLinearFactor</a>(linearFactor);
<a name="l00445"></a>00445                 rbody-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#aa2061f3fd87043f2a3b8c68ee74847cb">setAngularFactor</a>(angularFactor);
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448             <span class="keywordflow">if</span> (rbody &amp;&amp; objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#afeab83bd79d2b8e6f3df7da4c3a0699a">m_disableSleeping</a>)
<a name="l00449"></a>00449             {
<a name="l00450"></a>00450                 rbody-&gt;setActivationState(<a class="code" href="../../da/df2/btCollisionObject_8h.html#a3974157ba49bb9a32bcfcd3d01a5447b">DISABLE_DEACTIVATION</a>);
<a name="l00451"></a>00451             }
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <a class="code" href="../../d2/d9d/classCcdPhysicsController.html" title="CcdPhysicsController is a physics object that supports continuous collision detection and time of imp...">CcdPhysicsController</a>* parentCtrl = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a782c5231e5c7d54281d6de34f33aa3c8">m_dynamic_parent</a> ? (<a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>*)objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a782c5231e5c7d54281d6de34f33aa3c8">m_dynamic_parent</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8fca8020988a86c8cb72dbeb5d4a8e2f">GetPhysicsController</a>() : 0;
<a name="l00456"></a>00456     physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#aaccd42a5eaaac45e6ab6bff83cb97291">setParentCtrl</a>(parentCtrl);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     
<a name="l00459"></a>00459     <span class="comment">//Now done directly in ci.m_collisionFlags so that it propagates to replica</span>
<a name="l00460"></a>00460     <span class="comment">//if (objprop-&gt;m_ghost)</span>
<a name="l00461"></a>00461     <span class="comment">//{</span>
<a name="l00462"></a>00462     <span class="comment">//  rbody-&gt;setCollisionFlags(rbody-&gt;getCollisionFlags() | btCollisionObject::CF_NO_CONTACT_RESPONSE);</span>
<a name="l00463"></a>00463     <span class="comment">//}</span>
<a name="l00464"></a>00464     
<a name="l00465"></a>00465     <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a2a2d8e41e05888fc2ccf7d1002d6843d">m_dyna</a> &amp;&amp; !objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#aa2c1cd2e076e53add183a1daff78d761">m_angular_rigidbody</a>)
<a name="l00466"></a>00466     {
<a name="l00467"></a>00467 <span class="preprocessor">#if 0</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>        <span class="comment">//setting the inertia could achieve similar results to constraint the up</span>
<a name="l00469"></a>00469         <span class="comment">//but it is prone to instability, so use special &#39;Angular&#39; constraint</span>
<a name="l00470"></a>00470         btVector3 inertia = physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a23213dc1febb96503449d50afb9a8da6">GetRigidBody</a>()-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#acaf08c40e69ccacaf50a64e03519e3a2">getInvInertiaDiagLocal</a>();
<a name="l00471"></a>00471         inertia.setX(0.f);
<a name="l00472"></a>00472         inertia.setZ(0.f);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474         physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a23213dc1febb96503449d50afb9a8da6">GetRigidBody</a>()-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#ac47e4f27b351e24ed180bb0fcfa5a51d">setInvInertiaDiagLocal</a>(inertia);
<a name="l00475"></a>00475         physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a23213dc1febb96503449d50afb9a8da6">GetRigidBody</a>()-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#aeb2880f17187c3f28b4a253423aa71d1">updateInertiaTensor</a>();
<a name="l00476"></a>00476 <span class="preprocessor">#endif</span>
<a name="l00477"></a>00477 <span class="preprocessor"></span>
<a name="l00478"></a>00478         <span class="comment">//env-&gt;createConstraint(physicscontroller,0,PHY_ANGULAR_CONSTRAINT,0,0,0,0,0,1);</span>
<a name="l00479"></a>00479     
<a name="l00480"></a>00480         <span class="comment">//Now done directly in ci.m_bRigid so that it propagates to replica</span>
<a name="l00481"></a>00481         <span class="comment">//physicscontroller-&gt;GetRigidBody()-&gt;setAngularFactor(0.f);</span>
<a name="l00482"></a>00482         ;
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="keywordtype">bool</span> isActor = objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#ae59850baab9540b932da1512342f0b7d">m_isactor</a>;
<a name="l00486"></a>00486     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4fb43f2d41de4ddd5130fa0c882dd204">getClientInfo</a>()-&gt;<a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#ad796d22d9c94d635cd2ead9c278c9620">m_type</a> = 
<a name="l00487"></a>00487         (isbulletsensor) ? ((isActor) ? <a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a71f6d446903dada2386a86bc137929cda9369627ac7ffd7aa8df66d02e5e4c882">KX_ClientObjectInfo::OBACTORSENSOR</a> : <a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a71f6d446903dada2386a86bc137929cdacfd37092d7dec5d95b1ae9a698dcf56e">KX_ClientObjectInfo::OBSENSOR</a>) :
<a name="l00488"></a>00488         (isActor) ? <a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a71f6d446903dada2386a86bc137929cda47e0cd2575250e6f4404b4f45e3faf00">KX_ClientObjectInfo::ACTOR</a> : <a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a71f6d446903dada2386a86bc137929cda3c1c208a6cf86a9c672638244a53b5a0">KX_ClientObjectInfo::STATIC</a>;
<a name="l00489"></a>00489     <span class="comment">// store materialname in auxinfo, needed for touchsensors</span>
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (meshobj)
<a name="l00491"></a>00491     {
<a name="l00492"></a>00492         <span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; matname=meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3adb905a4ed11dc6f3870444119cbd39">GetMaterialName</a>(0);
<a name="l00493"></a>00493         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4fb43f2d41de4ddd5130fa0c882dd204">getClientInfo</a>()-&gt;<a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a8c146f7bb538805448882cfbb211ba5a">m_auxilary_info</a> = (matname.<a class="code" href="../../d6/dce/classSTR__String.html#a0f9f9b6889f81f39eab65d7a775c0532">Length</a>() ? (<span class="keywordtype">void</span>*)(matname.<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>()+2) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00494"></a>00494     } <span class="keywordflow">else</span>
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4fb43f2d41de4ddd5130fa0c882dd204">getClientInfo</a>()-&gt;<a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a8c146f7bb538805448882cfbb211ba5a">m_auxilary_info</a> = 0;
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#ac5ab1fa024907ab0f4857ae4daa029c9">AddSGController</a>(physicscontroller);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a> materialname;
<a name="l00503"></a>00503     <span class="keywordflow">if</span> (meshobj)
<a name="l00504"></a>00504         materialname = meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3adb905a4ed11dc6f3870444119cbd39">GetMaterialName</a>(0);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     physicscontroller-&gt;<a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html#aeb3612266c00d5c7a35d3294e3917324">SetObject</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>());
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="preprocessor">#if 0</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (objprop-&gt;<a class="code" href="../../d7/da6/structKX__ObjectProperties.html#a7e800924c61802411a91f3ce10ee5be0">m_softbody</a> &amp;&amp; physicscontroller)
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512         <a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* softBody = physicscontroller-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#aaa0a4d84c88ada42031b70fc997ad335">GetSoftBody</a>();
<a name="l00513"></a>00513         <span class="keywordflow">if</span> (softBody &amp;&amp; gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(0))<span class="comment">//only the first mesh, if any</span>
<a name="l00514"></a>00514         {
<a name="l00515"></a>00515             <span class="comment">//should be a mesh then, so add a soft body deformer</span>
<a name="l00516"></a>00516             <a class="code" href="../../d6/d77/classKX__SoftBodyDeformer.html">KX_SoftBodyDeformer</a>* softbodyDeformer = <span class="keyword">new</span> <a class="code" href="../../d6/d77/classKX__SoftBodyDeformer.html">KX_SoftBodyDeformer</a>( gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(0),(<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a>*)gameobj);
<a name="l00517"></a>00517             gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#add49c58f52394936c489cd3a177d4cae">SetDeformer</a>(softbodyDeformer);
<a name="l00518"></a>00518         }
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 <span class="preprocessor">#endif</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span>
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="keywordtype">void</span>    KX_ClearBulletSharedShapes()
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">/* Refresh the physics object from either an object or a mesh.</span>
<a name="l00530"></a>00530 <span class="comment"> * gameobj must be valid</span>
<a name="l00531"></a>00531 <span class="comment"> * from_gameobj and from_meshobj can be NULL</span>
<a name="l00532"></a>00532 <span class="comment"> * </span>
<a name="l00533"></a>00533 <span class="comment"> * when setting the mesh, the following vars get priority</span>
<a name="l00534"></a>00534 <span class="comment"> * 1) from_meshobj - creates the phys mesh from RAS_MeshObject</span>
<a name="l00535"></a>00535 <span class="comment"> * 2) from_gameobj - creates the phys mesh from the DerivedMesh where possible, else the RAS_MeshObject</span>
<a name="l00536"></a>00536 <span class="comment"> * 3) gameobj - update the phys mesh from DerivedMesh or RAS_MeshObject</span>
<a name="l00537"></a>00537 <span class="comment"> * </span>
<a name="l00538"></a>00538 <span class="comment"> * Most of the logic behind this is in shapeInfo-&gt;UpdateMesh(...)</span>
<a name="l00539"></a>00539 <span class="comment"> */</span>
<a name="l00540"></a>00540 <span class="keywordtype">bool</span> KX_ReInstanceBulletShapeFromMesh(<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *gameobj, <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *from_gameobj, <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>* from_meshobj)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542     <a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>  *spc= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a>*<span class="keyword">&gt;</span>((gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8fca8020988a86c8cb72dbeb5d4a8e2f">GetPhysicsController</a>()));
<a name="l00543"></a>00543     <a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html">CcdShapeConstructionInfo</a>    *shapeInfo;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     <span class="comment">/* if this is the child of a compound shape this can happen</span>
<a name="l00546"></a>00546 <span class="comment">     * don&#39;t support compound shapes for now */</span>
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (spc==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00548"></a>00548         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00549"></a>00549     
<a name="l00550"></a>00550     shapeInfo = spc-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a4a71ada6af7ac5621ab35ec7fdc0f5d0">GetShapeInfo</a>();
<a name="l00551"></a>00551     
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#ae267af5ffec5201be111f3bb531c5993">m_shapeType</a> != <a class="code" href="../../d4/d03/PHY__DynamicTypes_8h.html#a1e1c821deea56c0291bad534b29d1bfaab87e2dce120244386e70501968c1329b">PHY_SHAPE_MESH</a><span class="comment">/* || spc-&gt;GetSoftBody()*/</span>)
<a name="l00553"></a>00553         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     spc-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a6757d85bb3011c1f7d48895b1043dcbe">DeleteControllerShape</a>();
<a name="l00556"></a>00556     
<a name="l00557"></a>00557     <span class="keywordflow">if</span> (from_gameobj==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; from_meshobj==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00558"></a>00558         from_gameobj= gameobj;
<a name="l00559"></a>00559     
<a name="l00560"></a>00560     <span class="comment">/* updates the arrays used for making the new bullet mesh */</span>
<a name="l00561"></a>00561     shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a1c5716e3a94929a75b95868fd12aec0e">UpdateMesh</a>(from_gameobj, from_meshobj);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="comment">/* create the new bullet mesh */</span>
<a name="l00564"></a>00564     <a class="code" href="../../da/d62/structCcdConstructionInfo.html">CcdConstructionInfo</a>&amp; cci = spc-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#ae2a6411d757c4d701b876eaa0d24fb97">getConstructionInfo</a>();
<a name="l00565"></a>00565     <a class="code" href="../../d7/dd7/classbtCollisionShape.html" title="The btCollisionShape class provides an interface for collision shapes that can be shared among btColl...">btCollisionShape</a>* bm= shapeInfo-&gt;<a class="code" href="../../d5/ddd/classCcdShapeConstructionInfo.html#a9d1ba0bb87f77e9ef4529c494faacada">CreateBulletShape</a>(cci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a1ea6b1df1de1bbcf8204ccd64bc2c397">m_margin</a>, cci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#abf4c4109803d3e4a825678aa88f594b9">m_bGimpact</a>, !cci.<a class="code" href="../../da/d62/structCcdConstructionInfo.html#a36e3a83bcf2c43873e18e7cf37ad0cfb">m_bSoft</a>);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     spc-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#a9fbfca2a45799fd05d55196739921ff6">ReplaceControllerShape</a>(bm);
<a name="l00568"></a>00568     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570 <span class="preprocessor">#endif // USE_BULLET</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:28 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

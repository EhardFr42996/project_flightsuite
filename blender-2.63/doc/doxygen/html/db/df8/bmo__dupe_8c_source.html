<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: bmo_dupe.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">bmo_dupe.c</div>  </div>
</div>
<div class="contents">
<a href="../../db/df8/bmo__dupe_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * Contributor(s): Joseph Eagar.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d6c/BLI__array_8h.html">BLI_array.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/dc9/bmesh_8h.html">bmesh.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d02/bmesh__operators__private_8h.html">intern/bmesh_operators_private.h</a>&quot;</span> <span class="comment">/* own include */</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">/* local flag define */</span>
<a name="l00037"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">00037</a> <span class="preprocessor">#define DUPE_INPUT      1 </span><span class="comment">/* input from operator */</span>
<a name="l00038"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#a0c190627222704b7fdee74e178be6390">00038</a> <span class="preprocessor">#define DUPE_NEW        2</span>
<a name="l00039"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define DUPE_DONE       4</span>
<a name="l00040"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#a3b5148e98ce88bfc3f25219bba58f8d2">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define DUPE_MAPPED     8</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#acae900c76ea46136c0cf4004018e76f2">00047</a> <span class="keyword">static</span> <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *<a class="code" href="../../db/df8/bmo__dupe_8c.html#acae900c76ea46136c0cf4004018e76f2">copy_vertex</a>(<a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *source_mesh, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *source_vertex, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *target_mesh, <a class="code" href="../../df/da0/structGHash.html">GHash</a> *vhash)
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *target_vertex = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051     <span class="comment">/* Create a new vertex */</span>
<a name="l00052"></a>00052     target_vertex = <a class="code" href="../../d0/de5/bmesh__core_8c.html#a65d5fc195621d50fd17a65b941149f40" title="Main function for creating a new vertex.">BM_vert_create</a>(target_mesh, source_vertex-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00053"></a>00053     
<a name="l00054"></a>00054     <span class="comment">/* Insert new vertex into the vert hash */</span>
<a name="l00055"></a>00055     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(vhash, source_vertex, target_vertex);
<a name="l00056"></a>00056     
<a name="l00057"></a>00057     <span class="comment">/* Copy attributes */</span>
<a name="l00058"></a>00058     <a class="code" href="../../da/dd9/bmesh__construct_8c.html#aba9609d213e7cb739f94d879a0167785">BM_elem_attrs_copy</a>(source_mesh, target_mesh, source_vertex, target_vertex);
<a name="l00059"></a>00059     
<a name="l00060"></a>00060     <span class="comment">/* Set internal op flags */</span>
<a name="l00061"></a>00061     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(target_mesh, target_vertex, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a0c190627222704b7fdee74e178be6390">DUPE_NEW</a>);
<a name="l00062"></a>00062     
<a name="l00063"></a>00063     <span class="keywordflow">return</span> target_vertex;
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00071"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#ad0f3f1f8ad064207172ce27fcec4e5dd">00071</a> <span class="keyword">static</span> <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *<a class="code" href="../../db/df8/bmo__dupe_8c.html#ad0f3f1f8ad064207172ce27fcec4e5dd">copy_edge</a>(<a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *source_mesh,
<a name="l00072"></a>00072                          <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *source_edge, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *target_mesh,
<a name="l00073"></a>00073                          <a class="code" href="../../df/da0/structGHash.html">GHash</a> *vhash, <a class="code" href="../../df/da0/structGHash.html">GHash</a> *ehash)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *target_edge = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00076"></a>00076     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *target_vert1, *target_vert2;
<a name="l00077"></a>00077     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *face;
<a name="l00078"></a>00078     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> fiter;
<a name="l00079"></a>00079     <span class="keywordtype">int</span> rlen;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">/* see if any of the neighboring faces are</span>
<a name="l00082"></a>00082 <span class="comment">     * not being duplicated.  in that case,</span>
<a name="l00083"></a>00083 <span class="comment">     * add it to the new/old map. */</span>
<a name="l00084"></a>00084     rlen = 0;
<a name="l00085"></a>00085     <span class="keywordflow">for</span> (face = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;fiter, source_mesh, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa3027c8bb018a25ce0260593cb6d02ef3">BM_FACES_OF_EDGE</a>, source_edge);
<a name="l00086"></a>00086          face;
<a name="l00087"></a>00087          face = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;fiter))
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source_mesh, face, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>)) {
<a name="l00090"></a>00090             rlen++;
<a name="l00091"></a>00091         }
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="comment">/* Lookup v1 and v2 */</span>
<a name="l00095"></a>00095     target_vert1 = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vhash, source_edge-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>);
<a name="l00096"></a>00096     target_vert2 = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vhash, source_edge-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>);
<a name="l00097"></a>00097     
<a name="l00098"></a>00098     <span class="comment">/* Create a new edge */</span>
<a name="l00099"></a>00099     target_edge = <a class="code" href="../../d0/de5/bmesh__core_8c.html#a75ba3d28215494c6a507aa0d575c454e" title="Main function for creating a new edge.">BM_edge_create</a>(target_mesh, target_vert1, target_vert2, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00100"></a>00100     
<a name="l00101"></a>00101     <span class="comment">/* add to new/old edge map if necassary */</span>
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (rlen &lt; 2) {
<a name="l00103"></a>00103         <span class="comment">/* not sure what non-manifold cases of greater then three</span>
<a name="l00104"></a>00104 <span class="comment">         * radial should do. */</span>
<a name="l00105"></a>00105         <a class="code" href="../../d6/d21/bmesh__operator__api__inline_8h.html#a1ff1714c9c8269b07b0213c71c258c14">BMO_slot_map_ptr_insert</a>(source_mesh, op, <span class="stringliteral">&quot;boundarymap&quot;</span>,
<a name="l00106"></a>00106                                 source_edge, target_edge);
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="comment">/* Insert new edge into the edge hash */</span>
<a name="l00110"></a>00110     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(ehash, source_edge, target_edge);
<a name="l00111"></a>00111     
<a name="l00112"></a>00112     <span class="comment">/* Copy attributes */</span>
<a name="l00113"></a>00113     <a class="code" href="../../da/dd9/bmesh__construct_8c.html#aba9609d213e7cb739f94d879a0167785">BM_elem_attrs_copy</a>(source_mesh, target_mesh, source_edge, target_edge);
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     <span class="comment">/* Set internal op flags */</span>
<a name="l00116"></a>00116     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(target_mesh, target_edge, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a0c190627222704b7fdee74e178be6390">DUPE_NEW</a>);
<a name="l00117"></a>00117     
<a name="l00118"></a>00118     <span class="keywordflow">return</span> target_edge;
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00127"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#ac927460b53afb2a042d9f10f62bb3b96">00127</a> <span class="keyword">static</span> <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *<a class="code" href="../../db/df8/bmo__dupe_8c.html#ac927460b53afb2a042d9f10f62bb3b96">copy_face</a>(<a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *source_mesh,
<a name="l00128"></a>00128                          <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *source_face, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *target_mesh,
<a name="l00129"></a>00129                          <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> **vtar, <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> **edar, <a class="code" href="../../df/da0/structGHash.html">GHash</a> *vhash, <a class="code" href="../../df/da0/structGHash.html">GHash</a> *ehash)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131     <span class="comment">/* BMVert *target_vert1, *target_vert2; */</span> <span class="comment">/* UNUSED */</span>
<a name="l00132"></a>00132     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *source_loop, *target_loop;
<a name="l00133"></a>00133     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *target_face = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00134"></a>00134     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, iter2;
<a name="l00135"></a>00135     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00136"></a>00136     
<a name="l00137"></a>00137     <span class="comment">/* lookup the first and second vert */</span>
<a name="l00138"></a>00138 <span class="preprocessor">#if 0 </span><span class="comment">/* UNUSED */</span>
<a name="l00139"></a>00139     target_vert1 = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vhash, <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, source_mesh, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa8fa96ae233cbf490f7efc618e8efbffd">BM_VERTS_OF_FACE</a>, source_face));
<a name="l00140"></a>00140     target_vert2 = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vhash, <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter));
<a name="l00141"></a>00141 <span class="preprocessor">#else</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>    <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, source_mesh, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa8fa96ae233cbf490f7efc618e8efbffd">BM_VERTS_OF_FACE</a>, source_face);
<a name="l00143"></a>00143     <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter);
<a name="l00144"></a>00144 <span class="preprocessor">#endif</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a>00146     <span class="comment">/* lookup edge */</span>
<a name="l00147"></a>00147     <span class="keywordflow">for</span> (i = 0, source_loop = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, source_mesh, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>, source_face);
<a name="l00148"></a>00148          source_loop;
<a name="l00149"></a>00149          source_loop = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter), i++)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         vtar[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vhash, source_loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>);
<a name="l00152"></a>00152         edar[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(ehash, source_loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>);
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <span class="comment">/* create new face */</span>
<a name="l00156"></a>00156     target_face = <a class="code" href="../../d0/de5/bmesh__core_8c.html#ad79da0eb69eaaa50b12e62408de62fe6" title="Main face creation function.">BM_face_create</a>(target_mesh, vtar, edar, source_face-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00157"></a>00157     <a class="code" href="../../d6/d21/bmesh__operator__api__inline_8h.html#a1ff1714c9c8269b07b0213c71c258c14">BMO_slot_map_ptr_insert</a>(source_mesh, op, <span class="stringliteral">&quot;facemap&quot;</span>, source_face, target_face);
<a name="l00158"></a>00158     <a class="code" href="../../d6/d21/bmesh__operator__api__inline_8h.html#a1ff1714c9c8269b07b0213c71c258c14">BMO_slot_map_ptr_insert</a>(source_mesh, op, <span class="stringliteral">&quot;facemap&quot;</span>, target_face, source_face);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <a class="code" href="../../da/dd9/bmesh__construct_8c.html#aba9609d213e7cb739f94d879a0167785">BM_elem_attrs_copy</a>(source_mesh, target_mesh, source_face, target_face);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="comment">/* mark the face for output */</span>
<a name="l00163"></a>00163     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(target_mesh, target_face, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a0c190627222704b7fdee74e178be6390">DUPE_NEW</a>);
<a name="l00164"></a>00164     
<a name="l00165"></a>00165     <span class="comment">/* copy per-loop custom data */</span>
<a name="l00166"></a>00166     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (source_loop, &amp;iter, source_face, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00167"></a>00167         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (target_loop, &amp;iter2, target_face, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00168"></a>00168             <span class="keywordflow">if</span> (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vhash, source_loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>) == target_loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>) {
<a name="l00169"></a>00169                 <a class="code" href="../../da/dd9/bmesh__construct_8c.html#aba9609d213e7cb739f94d879a0167785">BM_elem_attrs_copy</a>(source_mesh, target_mesh, source_loop, target_loop);
<a name="l00170"></a>00170                 <span class="keywordflow">break</span>;
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="keywordflow">return</span> target_face;
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00184"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#acc1303b147f38d7ce5aca6c25b90de00">00184</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a094edf743a2a93c2a81a5ebcd22f03cc">copy_mesh</a>(<a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *source, <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *target)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *v2;
<a name="l00188"></a>00188     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00189"></a>00189     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <a class="code" href="../../da/d6c/BLI__array_8h.html#ae22059e2259b0ea217cfe400e698d21e">BLI_array_declare</a>(vtar);
<a name="l00192"></a>00192     <a class="code" href="../../da/d6c/BLI__array_8h.html#ae22059e2259b0ea217cfe400e698d21e">BLI_array_declare</a>(edar);
<a name="l00193"></a>00193     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> **vtar = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00194"></a>00194     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> **edar = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00195"></a>00195     
<a name="l00196"></a>00196     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> viter, eiter, fiter;
<a name="l00197"></a>00197     <a class="code" href="../../df/da0/structGHash.html">GHash</a> *vhash, *ehash;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="comment">/* initialize pointer hashes */</span>
<a name="l00200"></a>00200     vhash = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a371913beecfb01de3d0a8d5f0bb598d4">BLI_ghashutil_ptrhash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a51865a4bfcfc2502e01a9369bfb72877">BLI_ghashutil_ptrcmp</a>, <span class="stringliteral">&quot;bmesh dupeops v&quot;</span>);
<a name="l00201"></a>00201     ehash = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a371913beecfb01de3d0a8d5f0bb598d4">BLI_ghashutil_ptrhash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a51865a4bfcfc2502e01a9369bfb72877">BLI_ghashutil_ptrcmp</a>, <span class="stringliteral">&quot;bmesh dupeops e&quot;</span>);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="comment">/* duplicate flagged vertices */</span>
<a name="l00204"></a>00204     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;viter, source, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, v, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>) &amp;&amp;
<a name="l00206"></a>00206             !<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, v, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>))
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208             <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00209"></a>00209             <span class="keywordtype">int</span> isolated = 1;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211             v2 = <a class="code" href="../../db/df8/bmo__dupe_8c.html#acae900c76ea46136c0cf4004018e76f2">copy_vertex</a>(source, v, target, vhash);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (f, &amp;iter, v, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa37651dfdb90919510896eeccfbcc9cf4">BM_FACES_OF_VERT</a>) {
<a name="l00214"></a>00214                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, f, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>)) {
<a name="l00215"></a>00215                     isolated = 0;
<a name="l00216"></a>00216                     <span class="keywordflow">break</span>;
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218             }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220             <span class="keywordflow">if</span> (isolated) {
<a name="l00221"></a>00221                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (e, &amp;iter, v, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fae7bcabb6ce8c89d63c863eae870b97eb">BM_EDGES_OF_VERT</a>) {
<a name="l00222"></a>00222                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>)) {
<a name="l00223"></a>00223                         isolated = 0;
<a name="l00224"></a>00224                         <span class="keywordflow">break</span>;
<a name="l00225"></a>00225                     }
<a name="l00226"></a>00226                 }
<a name="l00227"></a>00227             }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229             <span class="keywordflow">if</span> (isolated) {
<a name="l00230"></a>00230                 <a class="code" href="../../d6/d21/bmesh__operator__api__inline_8h.html#a1ff1714c9c8269b07b0213c71c258c14">BMO_slot_map_ptr_insert</a>(source, op, <span class="stringliteral">&quot;isovertmap&quot;</span>, v, v2);
<a name="l00231"></a>00231             }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, v, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="comment">/* now we dupe all the edges */</span>
<a name="l00238"></a>00238     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (e, &amp;eiter, source, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>) &amp;&amp;
<a name="l00240"></a>00240             !<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>))
<a name="l00241"></a>00241         {
<a name="l00242"></a>00242             <span class="comment">/* make sure that verts are copied */</span>
<a name="l00243"></a>00243             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>)) {
<a name="l00244"></a>00244                 <a class="code" href="../../db/df8/bmo__dupe_8c.html#acae900c76ea46136c0cf4004018e76f2">copy_vertex</a>(source, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>, target, vhash);
<a name="l00245"></a>00245                 <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>)) {
<a name="l00248"></a>00248                 <a class="code" href="../../db/df8/bmo__dupe_8c.html#acae900c76ea46136c0cf4004018e76f2">copy_vertex</a>(source, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>, target, vhash);
<a name="l00249"></a>00249                 <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00250"></a>00250             }
<a name="l00251"></a>00251             <span class="comment">/* now copy the actual edge */</span>
<a name="l00252"></a>00252             <a class="code" href="../../db/df8/bmo__dupe_8c.html#ad0f3f1f8ad064207172ce27fcec4e5dd">copy_edge</a>(op, source, e, target, vhash, ehash);
<a name="l00253"></a>00253             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">/* first we dupe all flagged faces and their elements from source */</span>
<a name="l00258"></a>00258     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (f, &amp;fiter, source, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00259"></a>00259         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, f, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>)) {
<a name="l00260"></a>00260             <span class="comment">/* vertex pass */</span>
<a name="l00261"></a>00261             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (v, &amp;viter, f, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa8fa96ae233cbf490f7efc618e8efbffd">BM_VERTS_OF_FACE</a>) {
<a name="l00262"></a>00262                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, v, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>)) {
<a name="l00263"></a>00263                     <a class="code" href="../../db/df8/bmo__dupe_8c.html#acae900c76ea46136c0cf4004018e76f2">copy_vertex</a>(source, v, target, vhash);
<a name="l00264"></a>00264                     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, v, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00265"></a>00265                 }
<a name="l00266"></a>00266             }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268             <span class="comment">/* edge pass */</span>
<a name="l00269"></a>00269             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (e, &amp;eiter, f, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faea7083697f3214428274bffcf37e49a7">BM_EDGES_OF_FACE</a>) {
<a name="l00270"></a>00270                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(source, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>)) {
<a name="l00271"></a>00271                     <a class="code" href="../../db/df8/bmo__dupe_8c.html#ad0f3f1f8ad064207172ce27fcec4e5dd">copy_edge</a>(op, source, e, target, vhash, ehash);
<a name="l00272"></a>00272                     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00273"></a>00273                 }
<a name="l00274"></a>00274             }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276             <span class="comment">/* ensure arrays are the right size */</span>
<a name="l00277"></a>00277             <a class="code" href="../../da/d6c/BLI__array_8h.html#ad92d45d552a54bf2f7e4db4aba15ea8a">BLI_array_empty</a>(vtar);
<a name="l00278"></a>00278             <a class="code" href="../../da/d6c/BLI__array_8h.html#ad92d45d552a54bf2f7e4db4aba15ea8a">BLI_array_empty</a>(edar);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280             <a class="code" href="../../da/d6c/BLI__array_8h.html#a2b94e088d5d4b36bccad5ad91b41da23">BLI_array_growitems</a>(vtar, f-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>);
<a name="l00281"></a>00281             <a class="code" href="../../da/d6c/BLI__array_8h.html#a2b94e088d5d4b36bccad5ad91b41da23">BLI_array_growitems</a>(edar, f-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283             <a class="code" href="../../db/df8/bmo__dupe_8c.html#ac927460b53afb2a042d9f10f62bb3b96">copy_face</a>(op, source, f, target, vtar, edar, vhash, ehash);
<a name="l00284"></a>00284             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(source, f, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a575e7371c170662332b39c9c2977dd38">DUPE_DONE</a>);
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     
<a name="l00288"></a>00288     <span class="comment">/* free pointer hashes */</span>
<a name="l00289"></a>00289     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(vhash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00290"></a>00290     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(ehash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <a class="code" href="../../da/d6c/BLI__array_8h.html#af7fa9a27c7dee77862238c7da8472b81">BLI_array_free</a>(vtar); <span class="comment">/* free vert pointer array */</span>
<a name="l00293"></a>00293     <a class="code" href="../../da/d6c/BLI__array_8h.html#af7fa9a27c7dee77862238c7da8472b81">BLI_array_free</a>(edar); <span class="comment">/* free edge pointer array */</span>
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00317"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#aa798c2791e21e79a105f4ea0a088b7b8">00317</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/bmesh__operators__private_8h.html#aa798c2791e21e79a105f4ea0a088b7b8">bmo_dupe_exec</a>(<a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm, <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op)
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *dupeop = op;
<a name="l00320"></a>00320     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm2 = <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#af844527b4e811aa9b68b5e264a14deb3">BMO_slot_ptr_get</a>(op, <span class="stringliteral">&quot;dest&quot;</span>);
<a name="l00321"></a>00321     
<a name="l00322"></a>00322     <span class="keywordflow">if</span> (!bm2)
<a name="l00323"></a>00323         bm2 = bm;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="comment">/* flag input */</span>
<a name="l00326"></a>00326     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a5f62bc113fc0f7d8467305aeb5560dbf" title="BMO_FLAG_BUFFER.">BMO_slot_buffer_flag_enable</a>(bm, dupeop, <span class="stringliteral">&quot;geom&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a1862b4d142a3480f452d753975c8bcef">DUPE_INPUT</a>);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="comment">/* use the internal copy function */</span>
<a name="l00329"></a>00329     <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a094edf743a2a93c2a81a5ebcd22f03cc">copy_mesh</a>(dupeop, bm, bm2);
<a name="l00330"></a>00330     
<a name="l00331"></a>00331     <span class="comment">/* Output */</span>
<a name="l00332"></a>00332     <span class="comment">/* First copy the input buffers to output buffers - original data */</span>
<a name="l00333"></a>00333     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(dupeop, dupeop, <span class="stringliteral">&quot;geom&quot;</span>, <span class="stringliteral">&quot;origout&quot;</span>);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="comment">/* Now alloc the new output buffers */</span>
<a name="l00336"></a>00336     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ad8258ef654a8fcfcd20255bff6bac832">BMO_slot_buffer_from_enabled_flag</a>(bm, dupeop, <span class="stringliteral">&quot;newout&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a0c190627222704b7fdee74e178be6390">DUPE_NEW</a>);
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 <span class="preprocessor">#if 0 </span><span class="comment">/* UNUSED */</span>
<a name="l00340"></a>00340 <span class="comment">/* executes the duplicate operation, feeding elements of</span>
<a name="l00341"></a>00341 <span class="comment"> * type flag etypeflag and header flag flag to it.  note,</span>
<a name="l00342"></a>00342 <span class="comment"> * to get more useful information (such as the mapping from</span>
<a name="l00343"></a>00343 <span class="comment"> * original to new elements) you should run the dupe op manually */</span>
<a name="l00344"></a>00344 <span class="keywordtype">void</span> BMO_dupe_from_flag(<a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm, <span class="keywordtype">int</span> htype, <span class="keyword">const</span> <span class="keywordtype">char</span> hflag)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> dupeop;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a022f5ed9fd4c92f527b661975c66e89b" title="BMESH OPSTACK INIT OP.">BMO_op_init</a>(bm, &amp;dupeop, <span class="stringliteral">&quot;dupe&quot;</span>);
<a name="l00349"></a>00349     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab46b0ba0c23f5b2987e6b111213bea59">BMO_slot_buffer_from_enabled_hflag</a>(bm, &amp;dupeop, <span class="stringliteral">&quot;geom&quot;</span>, htype, hflag);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;dupeop);
<a name="l00352"></a>00352     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(bm, &amp;dupeop);
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 <span class="preprocessor">#endif</span>
<a name="l00355"></a>00355 <span class="preprocessor"></span>
<a name="l00374"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">00374</a> <span class="preprocessor">#define SPLIT_INPUT 1</span>
<a name="l00375"></a>00375 <span class="preprocessor"></span>
<a name="l00376"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#a3ce841ce4508734314c356fe3d9c6fc6">00376</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/bmesh__operators__private_8h.html#a3ce841ce4508734314c356fe3d9c6fc6">bmo_split_exec</a>(<a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm, <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op)
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *splitop = op;
<a name="l00379"></a>00379     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> dupeop;
<a name="l00380"></a>00380     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> delop;
<a name="l00381"></a>00381     <span class="keyword">const</span> <span class="keywordtype">short</span> use_only_faces = <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a34d1980519f9762637107a809ce15667">BMO_slot_bool_get</a>(op, <span class="stringliteral">&quot;use_only_faces&quot;</span>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">/* initialize our sub-operator */</span>
<a name="l00384"></a>00384     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a022f5ed9fd4c92f527b661975c66e89b" title="BMESH OPSTACK INIT OP.">BMO_op_init</a>(bm, &amp;dupeop, <span class="stringliteral">&quot;dupe&quot;</span>);
<a name="l00385"></a>00385     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a022f5ed9fd4c92f527b661975c66e89b" title="BMESH OPSTACK INIT OP.">BMO_op_init</a>(bm, &amp;delop, <span class="stringliteral">&quot;del&quot;</span>);
<a name="l00386"></a>00386     
<a name="l00387"></a>00387     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(splitop, &amp;dupeop, <span class="stringliteral">&quot;geom&quot;</span>, <span class="stringliteral">&quot;geom&quot;</span>);
<a name="l00388"></a>00388     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;dupeop);
<a name="l00389"></a>00389     
<a name="l00390"></a>00390     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a5f62bc113fc0f7d8467305aeb5560dbf" title="BMO_FLAG_BUFFER.">BMO_slot_buffer_flag_enable</a>(bm, splitop, <span class="stringliteral">&quot;geom&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">SPLIT_INPUT</a>);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (use_only_faces) {
<a name="l00393"></a>00393         <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v;
<a name="l00394"></a>00394         <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e;
<a name="l00395"></a>00395         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f;
<a name="l00396"></a>00396         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, iter2;
<a name="l00397"></a>00397         <span class="keywordtype">int</span> found;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="comment">/* make sure to remove edges and verts we don&#39;t need */</span>
<a name="l00400"></a>00400         <span class="keywordflow">for</span> (e = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); e; e = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l00401"></a>00401             found = 0;
<a name="l00402"></a>00402             f = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter2, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa3027c8bb018a25ce0260593cb6d02ef3">BM_FACES_OF_EDGE</a>, e);
<a name="l00403"></a>00403             <span class="keywordflow">for</span> ( ; f; f = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter2)) {
<a name="l00404"></a>00404                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(bm, f, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">SPLIT_INPUT</a>)) {
<a name="l00405"></a>00405                     found = 1;
<a name="l00406"></a>00406                     <span class="keywordflow">break</span>;
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408             }
<a name="l00409"></a>00409             <span class="keywordflow">if</span> (!found) {
<a name="l00410"></a>00410                 <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(bm, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">SPLIT_INPUT</a>);
<a name="l00411"></a>00411             }
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414         <span class="keywordflow">for</span> (v = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); v; v = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l00415"></a>00415             found = 0;
<a name="l00416"></a>00416             e = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter2, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fae7bcabb6ce8c89d63c863eae870b97eb">BM_EDGES_OF_VERT</a>, v);
<a name="l00417"></a>00417             <span class="keywordflow">for</span> ( ; e; e = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter2)) {
<a name="l00418"></a>00418                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ae95647462dd30213d7930e1a0a54ef81">BMO_elem_flag_test</a>(bm, e, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">SPLIT_INPUT</a>)) {
<a name="l00419"></a>00419                     found = 1;
<a name="l00420"></a>00420                     <span class="keywordflow">break</span>;
<a name="l00421"></a>00421                 }
<a name="l00422"></a>00422             }
<a name="l00423"></a>00423             <span class="keywordflow">if</span> (!found) {
<a name="l00424"></a>00424                 <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac8b0b897ab30ade097cd0b9b5a8817c2">BMO_elem_flag_enable</a>(bm, v, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">SPLIT_INPUT</a>);
<a name="l00425"></a>00425             }
<a name="l00426"></a>00426         }
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <span class="comment">/* connect outputs of dupe to delete, exluding keep geometry */</span>
<a name="l00430"></a>00430     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a30493a59a997d67f36d2c82ee44ebc8b">BMO_slot_int_set</a>(&amp;delop, <span class="stringliteral">&quot;context&quot;</span>, <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac205be2172292384dd687b5471a87edda5677f7b6066364293961f44ed1eb9a33">DEL_FACES</a>);
<a name="l00431"></a>00431     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ad8258ef654a8fcfcd20255bff6bac832">BMO_slot_buffer_from_enabled_flag</a>(bm, &amp;delop, <span class="stringliteral">&quot;geom&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a29f96d8dfac1df9c531cb7cbc18fdb99">SPLIT_INPUT</a>);
<a name="l00432"></a>00432     
<a name="l00433"></a>00433     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;delop);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="comment">/* now we make our outputs by copying the dupe output */</span>
<a name="l00436"></a>00436     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(&amp;dupeop, splitop, <span class="stringliteral">&quot;newout&quot;</span>, <span class="stringliteral">&quot;geomout&quot;</span>);
<a name="l00437"></a>00437     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(&amp;dupeop, splitop, <span class="stringliteral">&quot;boundarymap&quot;</span>, <span class="stringliteral">&quot;boundarymap&quot;</span>);
<a name="l00438"></a>00438     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(&amp;dupeop, splitop, <span class="stringliteral">&quot;isovertmap&quot;</span>, <span class="stringliteral">&quot;isovertmap&quot;</span>);
<a name="l00439"></a>00439     
<a name="l00440"></a>00440     <span class="comment">/* cleanup */</span>
<a name="l00441"></a>00441     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(bm, &amp;delop);
<a name="l00442"></a>00442     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(bm, &amp;dupeop);
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 
<a name="l00446"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#af17d469d95a2f3dbaa35e2553281c47f">00446</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/bmesh__operators__private_8h.html#af17d469d95a2f3dbaa35e2553281c47f">bmo_del_exec</a>(<a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm, <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op)
<a name="l00447"></a>00447 {
<a name="l00448"></a>00448 <span class="preprocessor">#define DEL_INPUT 1</span>
<a name="l00449"></a>00449 <span class="preprocessor"></span>
<a name="l00450"></a>00450     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *delop = op;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452     <span class="comment">/* Mark Buffer */</span>
<a name="l00453"></a>00453     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a5f62bc113fc0f7d8467305aeb5560dbf" title="BMO_FLAG_BUFFER.">BMO_slot_buffer_flag_enable</a>(bm, delop, <span class="stringliteral">&quot;geom&quot;</span>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a9bf8085857e7d4a80f0a7218f714652c">BM_ALL</a>, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a6be8d194999f57dcc7c160c7e43d2834">DEL_INPUT</a>);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <a class="code" href="../../da/dd9/bmesh__construct_8c.html#a19cdce2e15b6f6c8789a317a10a4318e">BMO_remove_tagged_context</a>(bm, <a class="code" href="../../db/df8/bmo__dupe_8c.html#a6be8d194999f57dcc7c160c7e43d2834">DEL_INPUT</a>, <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a71c3348c192c1252955d17e143252575">BMO_slot_int_get</a>(op, <span class="stringliteral">&quot;context&quot;</span>));
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="preprocessor">#undef DEL_INPUT</span>
<a name="l00458"></a>00458 <span class="preprocessor"></span>}
<a name="l00459"></a>00459 
<a name="l00467"></a><a class="code" href="../../db/df8/bmo__dupe_8c.html#ab9967af6e8d8286ffe5ef1e465446b69">00467</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d02/bmesh__operators__private_8h.html#ab9967af6e8d8286ffe5ef1e465446b69">bmo_spin_exec</a>(<a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm, <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> *op)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469     <a class="code" href="../../d0/d92/structBMOperator.html">BMOperator</a> dupop, extop;
<a name="l00470"></a>00470     <span class="keywordtype">float</span> cent[3], dvec[3];
<a name="l00471"></a>00471     <span class="keywordtype">float</span> axis[3] = {0.0f, 0.0f, 1.0f};
<a name="l00472"></a>00472     <span class="keywordtype">float</span> rmat[3][3];
<a name="l00473"></a>00473     <span class="keywordtype">float</span> phi;
<a name="l00474"></a>00474     <span class="keywordtype">int</span> steps, do_dupli, a, usedvec;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab3e489efaf32c3314084f95b062d5ab3">BMO_slot_vec_get</a>(op, <span class="stringliteral">&quot;cent&quot;</span>, cent);
<a name="l00477"></a>00477     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab3e489efaf32c3314084f95b062d5ab3">BMO_slot_vec_get</a>(op, <span class="stringliteral">&quot;axis&quot;</span>, axis);
<a name="l00478"></a>00478     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(axis);
<a name="l00479"></a>00479     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab3e489efaf32c3314084f95b062d5ab3">BMO_slot_vec_get</a>(op, <span class="stringliteral">&quot;dvec&quot;</span>, dvec);
<a name="l00480"></a>00480     usedvec = !<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a212d65c08323cdf9e10d72e1775e94c2">is_zero_v3</a>(dvec);
<a name="l00481"></a>00481     steps = <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a71c3348c192c1252955d17e143252575">BMO_slot_int_get</a>(op, <span class="stringliteral">&quot;steps&quot;</span>);
<a name="l00482"></a>00482     phi = <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#aa1be2f98599393f3d595ac1f0dcc9f4a">BMO_slot_float_get</a>(op, <span class="stringliteral">&quot;ang&quot;</span>) * <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(1.0f) / steps;
<a name="l00483"></a>00483     do_dupli = <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a34d1980519f9762637107a809ce15667">BMO_slot_bool_get</a>(op, <span class="stringliteral">&quot;do_dupli&quot;</span>);
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aa804c4cef742fd7a1dd820bf0128ad4a">axis_angle_to_mat3</a>(rmat, axis, phi);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(op, op, <span class="stringliteral">&quot;geom&quot;</span>, <span class="stringliteral">&quot;lastout&quot;</span>);
<a name="l00488"></a>00488     <span class="keywordflow">for</span> (a = 0; a &lt; steps; a++) {
<a name="l00489"></a>00489         <span class="keywordflow">if</span> (do_dupli) {
<a name="l00490"></a>00490             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ad937005656381b377e84cf7a3f10073f">BMO_op_initf</a>(bm, &amp;dupop, <span class="stringliteral">&quot;dupe geom=%s&quot;</span>, op, <span class="stringliteral">&quot;lastout&quot;</span>);
<a name="l00491"></a>00491             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;dupop);
<a name="l00492"></a>00492             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a5113211e19fe53429699444369f258aa">BMO_op_callf</a>(bm, <span class="stringliteral">&quot;rotate cent=%v mat=%m3 verts=%s&quot;</span>,
<a name="l00493"></a>00493                          cent, rmat, &amp;dupop, <span class="stringliteral">&quot;newout&quot;</span>);
<a name="l00494"></a>00494             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(&amp;dupop, op, <span class="stringliteral">&quot;newout&quot;</span>, <span class="stringliteral">&quot;lastout&quot;</span>);
<a name="l00495"></a>00495             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(bm, &amp;dupop);
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         <span class="keywordflow">else</span> {
<a name="l00498"></a>00498             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ad937005656381b377e84cf7a3f10073f">BMO_op_initf</a>(bm, &amp;extop, <span class="stringliteral">&quot;extrude_face_region edgefacein=%s&quot;</span>,
<a name="l00499"></a>00499                          op, <span class="stringliteral">&quot;lastout&quot;</span>);
<a name="l00500"></a>00500             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a72fc55143180f21895f7ce90da0e8ca2" title="BMESH OPSTACK EXEC OP.">BMO_op_exec</a>(bm, &amp;extop);
<a name="l00501"></a>00501             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a5113211e19fe53429699444369f258aa">BMO_op_callf</a>(bm, <span class="stringliteral">&quot;rotate cent=%v mat=%m3 verts=%s&quot;</span>,
<a name="l00502"></a>00502                          cent, rmat, &amp;extop, <span class="stringliteral">&quot;geomout&quot;</span>);
<a name="l00503"></a>00503             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a47baefa8e0bc9d9fa5a25bcb549fcea8" title="BMESH OPSTACK COPY SLOT.">BMO_slot_copy</a>(&amp;extop, op, <span class="stringliteral">&quot;geomout&quot;</span>, <span class="stringliteral">&quot;lastout&quot;</span>);
<a name="l00504"></a>00504             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ab6f764453b1419d3dfca2aec5943a381" title="BMESH OPSTACK FINISH OP.">BMO_op_finish</a>(bm, &amp;extop);
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (usedvec)
<a name="l00508"></a>00508             <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#a5113211e19fe53429699444369f258aa">BMO_op_callf</a>(bm, <span class="stringliteral">&quot;translate vec=%v verts=%s&quot;</span>, dvec, op, <span class="stringliteral">&quot;lastout&quot;</span>);
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:04 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

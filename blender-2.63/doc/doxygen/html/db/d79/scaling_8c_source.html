<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: scaling.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">scaling.c</div>  </div>
</div>
<div class="contents">
<a href="../../db/d79/scaling_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> * allocimbuf.c</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/db5/imbuf_8h.html">imbuf.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db4/IMB__allocimbuf_8h.html" title="Header file for allocimbuf.c.">IMB_allocimbuf.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d00/IMB__filter_8h.html" title="Function declarations for filter.c.">IMB_filter.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d59/BLO__sys__types_8h.html">BLO_sys_types.h</a>&quot;</span> <span class="comment">// for intptr_t support</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/************************************************************************/</span>
<a name="l00049"></a>00049 <span class="comment">/*                              SCALING                                 */</span>
<a name="l00050"></a>00050 <span class="comment">/************************************************************************/</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="../../db/d79/scaling_8c.html#aa40839198ff393879b8b6d4d2d371b72">00053</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#aa40839198ff393879b8b6d4d2d371b72">IMB_half_x</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00056"></a>00056     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *p1,*_p1,*dest;
<a name="l00057"></a>00057     <span class="keywordtype">short</span> a,r,<a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>,b;
<a name="l00058"></a>00058     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>,<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00059"></a>00059     <span class="keywordtype">float</span> af,rf,gf,bf, *p1f, *_p1f, *destf;
<a name="l00060"></a>00060     <span class="keywordtype">int</span> do_rect, do_float;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00063"></a>00063     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     do_rect= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00066"></a>00066     do_float= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00067"></a>00067     
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;= 1) <span class="keywordflow">return</span>(<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a094bab2aa339f34922893e1d6d617c28">IMB_dupImBuf</a>(ibuf1));
<a name="l00069"></a>00069     
<a name="l00070"></a>00070     ibuf2 = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a439680f7777db0973e76f25001cff0cd">IMB_allocImBuf</a>((ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>)/2, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a>, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#aface8662f09c3426342a256122974872">flags</a>);
<a name="l00071"></a>00071     <span class="keywordflow">if</span> (ibuf2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     _p1 = (<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00074"></a>00074     dest=(<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     _p1f = ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00077"></a>00077     destf= ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keywordflow">for</span> (y=ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;y&gt;0;y--) {
<a name="l00080"></a>00080         p1 = _p1;
<a name="l00081"></a>00081         p1f = _p1f;
<a name="l00082"></a>00082         <span class="keywordflow">for</span> (x = ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>; x&gt;0; x--) {
<a name="l00083"></a>00083             <span class="keywordflow">if</span> (do_rect) {
<a name="l00084"></a>00084                 a = *(p1++);
<a name="l00085"></a>00085                 b = *(p1++);
<a name="l00086"></a>00086                 g = *(p1++);
<a name="l00087"></a>00087                 r = *(p1++);
<a name="l00088"></a>00088                 a += *(p1++);
<a name="l00089"></a>00089                 b += *(p1++);
<a name="l00090"></a>00090                 g += *(p1++);
<a name="l00091"></a>00091                 r += *(p1++);
<a name="l00092"></a>00092                 *(dest++) = a &gt;&gt; 1;
<a name="l00093"></a>00093                 *(dest++) = b &gt;&gt; 1;
<a name="l00094"></a>00094                 *(dest++) = g &gt;&gt; 1;
<a name="l00095"></a>00095                 *(dest++) = r &gt;&gt; 1;
<a name="l00096"></a>00096             }
<a name="l00097"></a>00097             <span class="keywordflow">if</span> (do_float) {
<a name="l00098"></a>00098                 af = *(p1f++);
<a name="l00099"></a>00099                 bf = *(p1f++);
<a name="l00100"></a>00100                 gf = *(p1f++);
<a name="l00101"></a>00101                 rf = *(p1f++);
<a name="l00102"></a>00102                 af += *(p1f++);
<a name="l00103"></a>00103                 bf += *(p1f++);
<a name="l00104"></a>00104                 gf += *(p1f++);
<a name="l00105"></a>00105                 rf += *(p1f++);
<a name="l00106"></a>00106                 *(destf++) = 0.5f*af;
<a name="l00107"></a>00107                 *(destf++) = 0.5f*bf;
<a name="l00108"></a>00108                 *(destf++) = 0.5f*gf;
<a name="l00109"></a>00109                 *(destf++) = 0.5f*rf;
<a name="l00110"></a>00110             }
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112         <span class="keywordflow">if</span> (do_rect) _p1 += (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 2);
<a name="l00113"></a>00113         <span class="keywordflow">if</span> (do_float) _p1f += (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 2);
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115     <span class="keywordflow">return</span> (ibuf2);
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="../../db/d79/scaling_8c.html#a0d1eed20e753ccdb1e713336252cd3d6">00119</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d1eed20e753ccdb1e713336252cd3d6">IMB_double_fast_x</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00122"></a>00122     <span class="keywordtype">int</span> *p1,*dest, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, col, do_rect, do_float;
<a name="l00123"></a>00123     <span class="keywordtype">float</span> *p1f, *destf;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     do_rect= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00129"></a>00129     do_float= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00130"></a>00130     
<a name="l00131"></a>00131     ibuf2 = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a439680f7777db0973e76f25001cff0cd">IMB_allocImBuf</a>(2 * ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> , ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> , ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a>, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#aface8662f09c3426342a256122974872">flags</a>);
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (ibuf2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     p1 = (<span class="keywordtype">int</span> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00135"></a>00135     dest=(<span class="keywordtype">int</span> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00136"></a>00136     p1f = (<span class="keywordtype">float</span> *)ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00137"></a>00137     destf = (<span class="keywordtype">float</span> *)ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="keywordflow">for</span> (i = ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>; i &gt; 0; i--) {
<a name="l00140"></a>00140         <span class="keywordflow">if</span> (do_rect) {
<a name="l00141"></a>00141             col = *p1++;
<a name="l00142"></a>00142             *dest++ = col;
<a name="l00143"></a>00143             *dest++ = col;
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145         <span class="keywordflow">if</span> (do_float) {
<a name="l00146"></a>00146             destf[0]= destf[4] = p1f[0];
<a name="l00147"></a>00147             destf[1]= destf[5] = p1f[1];
<a name="l00148"></a>00148             destf[2]= destf[6] = p1f[2];
<a name="l00149"></a>00149             destf[3]= destf[7] = p1f[3];
<a name="l00150"></a>00150             destf+= 8;
<a name="l00151"></a>00151             p1f+= 4;
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordflow">return</span> (ibuf2);
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a><a class="code" href="../../db/d79/scaling_8c.html#a36e30ccbc2f53eacd0c580ff110d301a">00158</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a36e30ccbc2f53eacd0c580ff110d301a">IMB_double_x</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00163"></a>00163     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     ibuf2 = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d1eed20e753ccdb1e713336252cd3d6">IMB_double_fast_x</a>(ibuf1);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <a class="code" href="../../d2/d4d/filter_8c.html#abe503308d48d7d44937f1e9330ae876f">imb_filterx</a>(ibuf2);
<a name="l00168"></a>00168     <span class="keywordflow">return</span> (ibuf2);
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="../../db/d79/scaling_8c.html#a8d57a8f8ad0de36ee0809d9388a8abfa">00172</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a8d57a8f8ad0de36ee0809d9388a8abfa">IMB_half_y</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00175"></a>00175     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *p1,*p2,*_p1,*dest;
<a name="l00176"></a>00176     <span class="keywordtype">short</span> a,r,<a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>,b;
<a name="l00177"></a>00177     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>,<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00178"></a>00178     <span class="keywordtype">int</span> do_rect, do_float;
<a name="l00179"></a>00179     <span class="keywordtype">float</span> af,rf,gf,bf,*p1f,*p2f,*_p1f,*destf;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     p1= p2= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00182"></a>00182     p1f= p2f= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> &lt;= 1) <span class="keywordflow">return</span>(<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a094bab2aa339f34922893e1d6d617c28">IMB_dupImBuf</a>(ibuf1));
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     do_rect= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00188"></a>00188     do_float= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     ibuf2 = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a439680f7777db0973e76f25001cff0cd">IMB_allocImBuf</a>(ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> , (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>) / 2 , ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a>, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#aface8662f09c3426342a256122974872">flags</a>);
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (ibuf2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     _p1 = (<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00194"></a>00194     dest=(<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00195"></a>00195     _p1f = (<span class="keywordtype">float</span> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00196"></a>00196     destf= (<span class="keywordtype">float</span> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keywordflow">for</span> (y=ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>; y&gt;0; y--) {
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (do_rect) {
<a name="l00200"></a>00200             p1 = _p1;
<a name="l00201"></a>00201             p2 = _p1 + (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 2);
<a name="l00202"></a>00202         }
<a name="l00203"></a>00203         <span class="keywordflow">if</span> (do_float) {
<a name="l00204"></a>00204             p1f = _p1f;
<a name="l00205"></a>00205             p2f = _p1f + (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 2);
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207         <span class="keywordflow">for</span> (x = ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>; x &gt; 0; x--) {
<a name="l00208"></a>00208             <span class="keywordflow">if</span> (do_rect) {
<a name="l00209"></a>00209                 a = *(p1++);
<a name="l00210"></a>00210                 b = *(p1++);
<a name="l00211"></a>00211                 g = *(p1++);
<a name="l00212"></a>00212                 r = *(p1++);
<a name="l00213"></a>00213                 a += *(p2++);
<a name="l00214"></a>00214                 b += *(p2++);
<a name="l00215"></a>00215                 g += *(p2++);
<a name="l00216"></a>00216                 r += *(p2++);
<a name="l00217"></a>00217                 *(dest++) = a &gt;&gt; 1;
<a name="l00218"></a>00218                 *(dest++) = b &gt;&gt; 1;
<a name="l00219"></a>00219                 *(dest++) = g &gt;&gt; 1;
<a name="l00220"></a>00220                 *(dest++) = r &gt;&gt; 1;
<a name="l00221"></a>00221             }
<a name="l00222"></a>00222             <span class="keywordflow">if</span> (do_float) {
<a name="l00223"></a>00223                 af = *(p1f++);
<a name="l00224"></a>00224                 bf = *(p1f++);
<a name="l00225"></a>00225                 gf = *(p1f++);
<a name="l00226"></a>00226                 rf = *(p1f++);
<a name="l00227"></a>00227                 af += *(p2f++);
<a name="l00228"></a>00228                 bf += *(p2f++);
<a name="l00229"></a>00229                 gf += *(p2f++);
<a name="l00230"></a>00230                 rf += *(p2f++);
<a name="l00231"></a>00231                 *(destf++) = 0.5f*af;
<a name="l00232"></a>00232                 *(destf++) = 0.5f*bf;
<a name="l00233"></a>00233                 *(destf++) = 0.5f*gf;
<a name="l00234"></a>00234                 *(destf++) = 0.5f*rf;
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         <span class="keywordflow">if</span> (do_rect) _p1 += (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 3);
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (do_float) _p1f += (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 3);
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     <span class="keywordflow">return</span> (ibuf2);
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="../../db/d79/scaling_8c.html#a79d97b199faef03d4750836da237d40a">00244</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a79d97b199faef03d4750836da237d40a">IMB_double_fast_y</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00247"></a>00247     <span class="keywordtype">int</span> *p1, *dest1, *dest2;
<a name="l00248"></a>00248     <span class="keywordtype">float</span> *p1f, *dest1f, *dest2f;
<a name="l00249"></a>00249     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>,<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00250"></a>00250     <span class="keywordtype">int</span> do_rect, do_float;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     do_rect= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00256"></a>00256     do_float= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     ibuf2 = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a439680f7777db0973e76f25001cff0cd">IMB_allocImBuf</a>(ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> , 2 * ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> , ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a>, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#aface8662f09c3426342a256122974872">flags</a>);
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (ibuf2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     p1 = (<span class="keywordtype">int</span> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00262"></a>00262     dest1= (<span class="keywordtype">int</span> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00263"></a>00263     p1f = (<span class="keywordtype">float</span> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00264"></a>00264     dest1f= (<span class="keywordtype">float</span> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">for</span> (y = ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>; y &gt; 0; y--) {
<a name="l00267"></a>00267         <span class="keywordflow">if</span> (do_rect) {
<a name="l00268"></a>00268             dest2 = dest1 + ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l00269"></a>00269             <span class="keywordflow">for</span> (x = ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>; x &gt; 0; x--) *dest1++ = *dest2++ = *p1++;
<a name="l00270"></a>00270             dest1 = dest2;
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         <span class="keywordflow">if</span> (do_float) {
<a name="l00273"></a>00273             dest2f = dest1f + (4*ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>);
<a name="l00274"></a>00274             <span class="keywordflow">for</span> (x = ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * 4; x &gt; 0; x--) *dest1f++ = *dest2f++ = *p1f++;
<a name="l00275"></a>00275             dest1f = dest2f;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     <span class="keywordflow">return</span> (ibuf2);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="../../db/d79/scaling_8c.html#a3ce321af079af601f3e47c65d4da7391">00282</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a3ce321af079af601f3e47c65d4da7391">IMB_double_y</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00287"></a>00287     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     ibuf2 = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a79d97b199faef03d4750836da237d40a">IMB_double_fast_y</a>(ibuf1);
<a name="l00290"></a>00290     
<a name="l00291"></a>00291     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a45e55b696e686f00be3ff9bba7d66a65">IMB_filtery</a>(ibuf2);
<a name="l00292"></a>00292     <span class="keywordflow">return</span> (ibuf2);
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="comment">/* result in ibuf2, scaling should be done correctly */</span>
<a name="l00296"></a><a class="code" href="../../db/d79/scaling_8c.html#a95896ca716e4d015642ca549c1ad20bb">00296</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d00/IMB__filter_8h.html#a95896ca716e4d015642ca549c1ad20bb">imb_onehalf_no_alloc</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2, <span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *p1, *p2 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *dest;
<a name="l00299"></a>00299     <span class="keywordtype">float</span> *p1f, *destf, *p2f = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00300"></a>00300     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>,<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00301"></a>00301     <span class="keyword">const</span> <span class="keywordtype">short</span> do_rect= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00302"></a>00302     <span class="keyword">const</span> <span class="keywordtype">short</span> do_float= (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (do_rect &amp;&amp; (ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00305"></a>00305         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4b968a3f7904d92ffe870afaf676a84c">imb_addrectImBuf</a>(ibuf2);
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     p1f = ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00309"></a>00309     destf=ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00310"></a>00310     p1 = (<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00311"></a>00311     dest=(<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="keywordflow">for</span> (y=ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;y&gt;0;y--) {
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (do_rect) p2 = p1 + (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 2);
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (do_float) p2f = p1f + (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;&lt; 2);
<a name="l00316"></a>00316         <span class="keywordflow">for</span> (x=ibuf2-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;x&gt;0;x--) {
<a name="l00317"></a>00317             <span class="keywordflow">if</span> (do_rect) {
<a name="l00318"></a>00318                 dest[0] = (p1[0] + p2[0] + p1[4] + p2[4]) &gt;&gt; 2;
<a name="l00319"></a>00319                 dest[1] = (p1[1] + p2[1] + p1[5] + p2[5]) &gt;&gt; 2;
<a name="l00320"></a>00320                 dest[2] = (p1[2] + p2[2] + p1[6] + p2[6]) &gt;&gt; 2;
<a name="l00321"></a>00321                 dest[3] = (p1[3] + p2[3] + p1[7] + p2[7]) &gt;&gt; 2;
<a name="l00322"></a>00322                 p1 += 8; 
<a name="l00323"></a>00323                 p2 += 8; 
<a name="l00324"></a>00324                 dest += 4;
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326             <span class="keywordflow">if</span> (do_float) {
<a name="l00327"></a>00327                 destf[0] = 0.25f*(p1f[0] + p2f[0] + p1f[4] + p2f[4]);
<a name="l00328"></a>00328                 destf[1] = 0.25f*(p1f[1] + p2f[1] + p1f[5] + p2f[5]);
<a name="l00329"></a>00329                 destf[2] = 0.25f*(p1f[2] + p2f[2] + p1f[6] + p2f[6]);
<a name="l00330"></a>00330                 destf[3] = 0.25f*(p1f[3] + p2f[3] + p1f[7] + p2f[7]);
<a name="l00331"></a>00331                 p1f += 8; 
<a name="l00332"></a>00332                 p2f += 8; 
<a name="l00333"></a>00333                 destf += 4;
<a name="l00334"></a>00334             }
<a name="l00335"></a>00335         }
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (do_rect) p1=p2;
<a name="l00337"></a>00337         <span class="keywordflow">if</span> (do_float) p1f=p2f;
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &amp; 1) {
<a name="l00339"></a>00339             <span class="keywordflow">if</span> (do_rect) p1+=4;
<a name="l00340"></a>00340             <span class="keywordflow">if</span> (do_float) p1f+=4;
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343     
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="../../db/d79/scaling_8c.html#a1f8cdbaa86c1944c717ee0307c47f6dc">00346</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a1f8cdbaa86c1944c717ee0307c47f6dc">IMB_onehalf</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf1)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf2;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (ibuf1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00352"></a>00352     
<a name="l00353"></a>00353     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &lt;= 1) <span class="keywordflow">return</span>(<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a8d57a8f8ad0de36ee0809d9388a8abfa">IMB_half_y</a>(ibuf1));
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> &lt;= 1) <span class="keywordflow">return</span>(<a class="code" href="../../db/d49/IMB__imbuf_8h.html#aa40839198ff393879b8b6d4d2d371b72">IMB_half_x</a>(ibuf1));
<a name="l00355"></a>00355     
<a name="l00356"></a>00356     ibuf2=<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a439680f7777db0973e76f25001cff0cd">IMB_allocImBuf</a>((ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>)/2, (ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>)/2, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a>, ibuf1-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#aface8662f09c3426342a256122974872">flags</a>);
<a name="l00357"></a>00357     <span class="keywordflow">if</span> (ibuf2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00358"></a>00358     
<a name="l00359"></a>00359     <a class="code" href="../../df/d00/IMB__filter_8h.html#a95896ca716e4d015642ca549c1ad20bb">imb_onehalf_no_alloc</a>(ibuf2, ibuf1);
<a name="l00360"></a>00360     
<a name="l00361"></a>00361     <span class="keywordflow">return</span> (ibuf2);
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">/* q_scale_linear_interpolation helper functions */</span>
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="../../db/d79/scaling_8c.html#a3f3e84643d4875a682e01e6ec483a8f4">00366</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#a3f3e84643d4875a682e01e6ec483a8f4">enlarge_picture_byte</a>(
<a name="l00367"></a>00367     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* src, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* dst, <span class="keywordtype">int</span> src_width, 
<a name="l00368"></a>00368     <span class="keywordtype">int</span> src_height, <span class="keywordtype">int</span> dst_width, <span class="keywordtype">int</span> dst_height)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370     <span class="keywordtype">double</span> ratiox = (double) (dst_width - 1.0) 
<a name="l00371"></a>00371         / (double) (src_width - 1.001);
<a name="l00372"></a>00372     <span class="keywordtype">double</span> ratioy = (double) (dst_height - 1.0) 
<a name="l00373"></a>00373         / (double) (src_height - 1.001);
<a name="l00374"></a>00374     uintptr_t x_src, dx_src, x_dst;
<a name="l00375"></a>00375     uintptr_t y_src, dy_src, y_dst;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     dx_src = 65536.0 / ratiox;
<a name="l00378"></a>00378     dy_src = 65536.0 / ratioy;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     y_src = 0;
<a name="l00381"></a>00381     <span class="keywordflow">for</span> (y_dst = 0; y_dst &lt; dst_height; y_dst++) {
<a name="l00382"></a>00382         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* line1 = src + (y_src &gt;&gt; 16) * 4 * src_width;
<a name="l00383"></a>00383         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* line2 = line1 + 4 * src_width;
<a name="l00384"></a>00384         uintptr_t weight1y = 65536 - (y_src &amp; 0xffff);
<a name="l00385"></a>00385         uintptr_t weight2y = 65536 - weight1y;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="keywordflow">if</span> ((y_src &gt;&gt; 16) == src_height - 1) {
<a name="l00388"></a>00388             line2 = line1;
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         x_src = 0;
<a name="l00392"></a>00392         <span class="keywordflow">for</span> (x_dst = 0; x_dst &lt; dst_width; x_dst++) {
<a name="l00393"></a>00393             uintptr_t weight1x = 65536 - (x_src &amp; 0xffff);
<a name="l00394"></a>00394             uintptr_t weight2x = 65536 - weight1x;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> = (x_src &gt;&gt; 16) * 4;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             *dst++ = ((((line1[<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>] * weight1y) &gt;&gt; 16) 
<a name="l00399"></a>00399                    * weight1x) &gt;&gt; 16)
<a name="l00400"></a>00400                 + ((((line2[<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>] * weight2y) &gt;&gt; 16) 
<a name="l00401"></a>00401                     * weight1x) &gt;&gt; 16)
<a name="l00402"></a>00402                 + ((((line1[4 + <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>] * weight1y) &gt;&gt; 16) 
<a name="l00403"></a>00403                    * weight2x) &gt;&gt; 16)
<a name="l00404"></a>00404                 + ((((line2[4 + <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>] * weight2y) &gt;&gt; 16) 
<a name="l00405"></a>00405                     * weight2x) &gt;&gt; 16);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407             *dst++ = ((((line1[x + 1] * weight1y) &gt;&gt; 16) 
<a name="l00408"></a>00408                    * weight1x) &gt;&gt; 16)
<a name="l00409"></a>00409                 + ((((line2[x + 1] * weight2y) &gt;&gt; 16) 
<a name="l00410"></a>00410                     * weight1x) &gt;&gt; 16)
<a name="l00411"></a>00411                 + ((((line1[4 + x + 1] * weight1y) &gt;&gt; 16) 
<a name="l00412"></a>00412                    * weight2x) &gt;&gt; 16)
<a name="l00413"></a>00413                 + ((((line2[4 + x + 1] * weight2y) &gt;&gt; 16) 
<a name="l00414"></a>00414                     * weight2x) &gt;&gt; 16);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416             *dst++ = ((((line1[x + 2] * weight1y) &gt;&gt; 16) 
<a name="l00417"></a>00417                    * weight1x) &gt;&gt; 16)
<a name="l00418"></a>00418                 + ((((line2[x + 2] * weight2y) &gt;&gt; 16) 
<a name="l00419"></a>00419                     * weight1x) &gt;&gt; 16)
<a name="l00420"></a>00420                 + ((((line1[4 + x + 2] * weight1y) &gt;&gt; 16) 
<a name="l00421"></a>00421                    * weight2x) &gt;&gt; 16)
<a name="l00422"></a>00422                 + ((((line2[4 + x + 2] * weight2y) &gt;&gt; 16) 
<a name="l00423"></a>00423                     * weight2x) &gt;&gt; 16);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425             *dst++ = ((((line1[x + 3] * weight1y) &gt;&gt; 16) 
<a name="l00426"></a>00426                    * weight1x) &gt;&gt; 16)
<a name="l00427"></a>00427                 + ((((line2[x + 3] * weight2y) &gt;&gt; 16) 
<a name="l00428"></a>00428                     * weight1x) &gt;&gt; 16)
<a name="l00429"></a>00429                 + ((((line1[4 + x + 3] * weight1y) &gt;&gt; 16) 
<a name="l00430"></a>00430                    * weight2x) &gt;&gt; 16)
<a name="l00431"></a>00431                 + ((((line2[4 + x + 3] * weight2y) &gt;&gt; 16) 
<a name="l00432"></a>00432                     * weight2x) &gt;&gt; 16);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434             x_src += dx_src;
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436         y_src += dy_src;
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="../../da/da1/structscale__outpix__byte.html">00440</a> <span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a> {
<a name="l00441"></a><a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">00441</a>     uintptr_t <a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a>;
<a name="l00442"></a><a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">00442</a>     uintptr_t <a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a>;
<a name="l00443"></a><a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">00443</a>     uintptr_t <a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a>;
<a name="l00444"></a><a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">00444</a>     uintptr_t <a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a>;
<a name="l00445"></a>00445 
<a name="l00446"></a><a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">00446</a>     uintptr_t <a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a>;
<a name="l00447"></a>00447 };
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="../../db/d79/scaling_8c.html#a5e4548e1d08596314b8f395041fad060">00449</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#a5e4548e1d08596314b8f395041fad060">shrink_picture_byte</a>(
<a name="l00450"></a>00450     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* src, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* dst, <span class="keywordtype">int</span> src_width, 
<a name="l00451"></a>00451     <span class="keywordtype">int</span> src_height, <span class="keywordtype">int</span> dst_width, <span class="keywordtype">int</span> dst_height)
<a name="l00452"></a>00452 {
<a name="l00453"></a>00453     <span class="keywordtype">double</span> ratiox = (double) (dst_width) / (double) (src_width);
<a name="l00454"></a>00454     <span class="keywordtype">double</span> ratioy = (double) (dst_height) / (double) (src_height);
<a name="l00455"></a>00455     uintptr_t x_src, dx_dst, x_dst;
<a name="l00456"></a>00456     uintptr_t y_src, dy_dst, y_dst;
<a name="l00457"></a>00457     intptr_t y_counter;
<a name="l00458"></a>00458     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * dst_begin = dst;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     <span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a> * dst_line1 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00461"></a>00461     <span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a> * dst_line2 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     dst_line1 = (<span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(
<a name="l00464"></a>00464         (dst_width + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a>), 
<a name="l00465"></a>00465         &quot;shrink_picture_byte 1&quot;);
<a name="l00466"></a>00466     dst_line2 = (<span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(
<a name="l00467"></a>00467         (dst_width + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a>),
<a name="l00468"></a>00468         &quot;shrink_picture_byte 2&quot;);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     dx_dst = 65536.0 * ratiox;
<a name="l00471"></a>00471     dy_dst = 65536.0 * ratioy;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     y_dst = 0;
<a name="l00474"></a>00474     y_counter = 65536;
<a name="l00475"></a>00475     <span class="keywordflow">for</span> (y_src = 0; y_src &lt; src_height; y_src++) {
<a name="l00476"></a>00476         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* line = src + y_src * 4 * src_width;
<a name="l00477"></a>00477         uintptr_t weight1y = 65535 - (y_dst &amp; 0xffff);
<a name="l00478"></a>00478         uintptr_t weight2y = 65535 - weight1y;
<a name="l00479"></a>00479         x_dst = 0;
<a name="l00480"></a>00480         <span class="keywordflow">for</span> (x_src = 0; x_src &lt; src_width; x_src++) {
<a name="l00481"></a>00481             uintptr_t weight1x = 65535 - (x_dst &amp; 0xffff);
<a name="l00482"></a>00482             uintptr_t weight2x = 65535 - weight1x;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484             uintptr_t x = x_dst &gt;&gt; 16;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486             uintptr_t w;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488             w = (weight1y * weight1x) &gt;&gt; 16;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490             <span class="comment">/* ensure correct rounding, without this you get ugly banding, or too low color values (ton) */</span>
<a name="l00491"></a>00491             dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a> += (line[0] * w + 32767) &gt;&gt; 16;
<a name="l00492"></a>00492             dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a> += (line[1] * w + 32767) &gt;&gt; 16;
<a name="l00493"></a>00493             dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a> += (line[2] * w + 32767) &gt;&gt; 16;
<a name="l00494"></a>00494             dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a> += (line[3] * w + 32767) &gt;&gt; 16;
<a name="l00495"></a>00495             dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a> += w;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497             w = (weight2y * weight1x) &gt;&gt; 16;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499             dst_line2[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a> += (line[0] * w + 32767) &gt;&gt; 16;
<a name="l00500"></a>00500             dst_line2[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a> += (line[1] * w + 32767) &gt;&gt; 16;
<a name="l00501"></a>00501             dst_line2[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a> += (line[2] * w + 32767) &gt;&gt; 16;
<a name="l00502"></a>00502             dst_line2[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a> += (line[3] * w + 32767) &gt;&gt; 16;
<a name="l00503"></a>00503             dst_line2[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a> += w;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505             w = (weight1y * weight2x) &gt;&gt; 16;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507             dst_line1[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a> += (line[0] * w + 32767) &gt;&gt; 16;
<a name="l00508"></a>00508             dst_line1[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a> += (line[1] * w + 32767) &gt;&gt; 16;
<a name="l00509"></a>00509             dst_line1[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a> += (line[2] * w + 32767) &gt;&gt; 16;
<a name="l00510"></a>00510             dst_line1[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a> += (line[3] * w + 32767) &gt;&gt; 16;
<a name="l00511"></a>00511             dst_line1[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a> += w;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513             w = (weight2y * weight2x) &gt;&gt; 16;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515             dst_line2[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a> += (line[0] * w + 32767) &gt;&gt; 16;
<a name="l00516"></a>00516             dst_line2[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a> += (line[1] * w + 32767) &gt;&gt; 16;
<a name="l00517"></a>00517             dst_line2[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a> += (line[2] * w + 32767) &gt;&gt; 16;
<a name="l00518"></a>00518             dst_line2[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a> += (line[3] * w + 32767) &gt;&gt; 16;
<a name="l00519"></a>00519             dst_line2[x+1].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a> += w;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521             x_dst += dx_dst;
<a name="l00522"></a>00522             line += 4;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         y_dst += dy_dst;
<a name="l00526"></a>00526         y_counter -= dy_dst;
<a name="l00527"></a>00527         <span class="keywordflow">if</span> (y_counter &lt; 0) {
<a name="l00528"></a>00528             <span class="keywordtype">int</span> val;
<a name="l00529"></a>00529             uintptr_t x;
<a name="l00530"></a>00530             <span class="keyword">struct </span><a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a> * temp;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532             y_counter += 65536;
<a name="l00533"></a>00533             
<a name="l00534"></a>00534             <span class="keywordflow">for</span> (x=0; x &lt; dst_width; x++) {
<a name="l00535"></a>00535                 uintptr_t f =  0x80000000UL / dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a>;
<a name="l00536"></a>00536                 *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00537"></a>00537                 *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00538"></a>00538                 *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00539"></a>00539                 *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541             memset(dst_line1, 0, dst_width *
<a name="l00542"></a>00542                    <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../da/da1/structscale__outpix__byte.html">scale_outpix_byte</a>));
<a name="l00543"></a>00543             temp = dst_line1;
<a name="l00544"></a>00544             dst_line1 = dst_line2;
<a name="l00545"></a>00545             dst_line2 = temp;
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="keywordflow">if</span> (dst - dst_begin &lt; dst_width * dst_height * 4) {
<a name="l00549"></a>00549         <span class="keywordtype">int</span> val;
<a name="l00550"></a>00550         uintptr_t x;
<a name="l00551"></a>00551         <span class="keywordflow">for</span> (x = 0; x &lt; dst_width; x++) {
<a name="l00552"></a>00552             uintptr_t f = 0x80000000UL / dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aa4a11fe1b40c98b5deeaff86da10d00e">weight</a>;
<a name="l00553"></a>00553             *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a28b4790d8e7f3e64d3f78fb7935b7b16">r</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00554"></a>00554             *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#aabb0d208ec69ee90f441f7bdedf1ced8">g</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00555"></a>00555             *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a75e8dd3d71d1f42bf9943586f68d3a9f">b</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00556"></a>00556             *dst++ = (val= (dst_line1[x].<a class="code" href="../../da/da1/structscale__outpix__byte.html#a434458e6cc079b48ded90d68f3a5449d">a</a> * f) &gt;&gt; 15) &gt; 255 ? 255: val;
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(dst_line1);
<a name="l00560"></a>00560     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(dst_line2);
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a><a class="code" href="../../db/d79/scaling_8c.html#a6a315f3be7a08eaa8c0db2b5584761c2">00564</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#a6a315f3be7a08eaa8c0db2b5584761c2">q_scale_byte</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out, <span class="keywordtype">int</span> in_width, 
<a name="l00565"></a>00565              <span class="keywordtype">int</span> in_height, <span class="keywordtype">int</span> dst_width, <span class="keywordtype">int</span> dst_height)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567     <span class="keywordflow">if</span> (dst_width &gt; in_width &amp;&amp; dst_height &gt; in_height) {
<a name="l00568"></a>00568         <a class="code" href="../../db/d79/scaling_8c.html#a3f3e84643d4875a682e01e6ec483a8f4">enlarge_picture_byte</a>(in, out, in_width, in_height,
<a name="l00569"></a>00569                      dst_width, dst_height);
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dst_width &lt; in_width &amp;&amp; dst_height &lt; in_height) {
<a name="l00572"></a>00572         <a class="code" href="../../db/d79/scaling_8c.html#a5e4548e1d08596314b8f395041fad060">shrink_picture_byte</a>(in, out, in_width, in_height,
<a name="l00573"></a>00573                     dst_width, dst_height);
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="../../db/d79/scaling_8c.html#acd298a14fc9ad461142ffe3a696c776e">00577</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#acd298a14fc9ad461142ffe3a696c776e">enlarge_picture_float</a>(
<a name="l00578"></a>00578     <span class="keywordtype">float</span>* src, <span class="keywordtype">float</span>* dst, <span class="keywordtype">int</span> src_width, 
<a name="l00579"></a>00579     <span class="keywordtype">int</span> src_height, <span class="keywordtype">int</span> dst_width, <span class="keywordtype">int</span> dst_height)
<a name="l00580"></a>00580 {
<a name="l00581"></a>00581     <span class="keywordtype">double</span> ratiox = (double) (dst_width - 1.0) 
<a name="l00582"></a>00582         / (double) (src_width - 1.001);
<a name="l00583"></a>00583     <span class="keywordtype">double</span> ratioy = (double) (dst_height - 1.0) 
<a name="l00584"></a>00584         / (double) (src_height - 1.001);
<a name="l00585"></a>00585     uintptr_t x_dst;
<a name="l00586"></a>00586     uintptr_t y_dst;
<a name="l00587"></a>00587     <span class="keywordtype">double</span> x_src, dx_src;
<a name="l00588"></a>00588     <span class="keywordtype">double</span> y_src, dy_src;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     dx_src = 1.0 / ratiox;
<a name="l00591"></a>00591     dy_src = 1.0 / ratioy;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     y_src = 0;
<a name="l00594"></a>00594     <span class="keywordflow">for</span> (y_dst = 0; y_dst &lt; dst_height; y_dst++) {
<a name="l00595"></a>00595         <span class="keywordtype">float</span>* line1 = src + ((int) y_src) * 4 * src_width;
<a name="l00596"></a>00596         <span class="keywordtype">float</span>* line2 = line1 + 4 * src_width;
<a name="l00597"></a>00597         <span class="keyword">const</span> <span class="keywordtype">float</span> weight1y = (float)(1.0 - (y_src - (<span class="keywordtype">int</span>) y_src));
<a name="l00598"></a>00598         <span class="keyword">const</span> <span class="keywordtype">float</span> weight2y = 1.0f - weight1y;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>) y_src == src_height - 1) {
<a name="l00601"></a>00601             line2 = line1;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604         x_src = 0;
<a name="l00605"></a>00605         <span class="keywordflow">for</span> (x_dst = 0; x_dst &lt; dst_width; x_dst++) {
<a name="l00606"></a>00606             <span class="keyword">const</span> <span class="keywordtype">float</span> weight1x = (float)(1.0 - (x_src - (<span class="keywordtype">int</span>) x_src));
<a name="l00607"></a>00607             <span class="keyword">const</span> <span class="keywordtype">float</span> weight2x = (float)(1.0f - weight1x);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609             <span class="keyword">const</span> <span class="keywordtype">float</span> w11 = weight1y * weight1x;
<a name="l00610"></a>00610             <span class="keyword">const</span> <span class="keywordtype">float</span> w21 = weight2y * weight1x;
<a name="l00611"></a>00611             <span class="keyword">const</span> <span class="keywordtype">float</span> w12 = weight1y * weight2x;
<a name="l00612"></a>00612             <span class="keyword">const</span> <span class="keywordtype">float</span> w22 = weight2y * weight2x;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614             uintptr_t x = ((int) x_src) * 4;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616             *dst++ =  line1[x]     * w11    
<a name="l00617"></a>00617                 + line2[x]     * w21
<a name="l00618"></a>00618                 + line1[4 + x] * w12 
<a name="l00619"></a>00619                 + line2[4 + x] * w22;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621             *dst++ =  line1[x + 1] * w11 
<a name="l00622"></a>00622                 + line2[x + 1] * w21
<a name="l00623"></a>00623                 + line1[4 + x + 1] * w12
<a name="l00624"></a>00624                 + line2[4 + x + 1] * w22;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626             *dst++ =  line1[x + 2] * w11 
<a name="l00627"></a>00627                 + line2[x + 2] * w21
<a name="l00628"></a>00628                 + line1[4 + x + 2] * w12  
<a name="l00629"></a>00629                 + line2[4 + x + 2] * w22;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631             *dst++ =  line1[x + 3] * w11 
<a name="l00632"></a>00632                 + line2[x + 3] * w21
<a name="l00633"></a>00633                 + line1[4 + x + 3] * w12  
<a name="l00634"></a>00634                 + line2[4 + x + 3] * w22;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636             x_src += dx_src;
<a name="l00637"></a>00637         }
<a name="l00638"></a>00638         y_src += dy_src;
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a><a class="code" href="../../d2/dff/structscale__outpix__float.html">00642</a> <span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a> {
<a name="l00643"></a><a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">00643</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a>;
<a name="l00644"></a><a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">00644</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a>;
<a name="l00645"></a><a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">00645</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a>;
<a name="l00646"></a><a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">00646</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a>;
<a name="l00647"></a>00647 
<a name="l00648"></a><a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">00648</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a>;
<a name="l00649"></a>00649 };
<a name="l00650"></a>00650 
<a name="l00651"></a><a class="code" href="../../db/d79/scaling_8c.html#ac48825bd612fb077732fd565e988b3cc">00651</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#ac48825bd612fb077732fd565e988b3cc">shrink_picture_float</a>(
<a name="l00652"></a>00652     <span class="keywordtype">float</span>* src, <span class="keywordtype">float</span>* dst, <span class="keywordtype">int</span> src_width, 
<a name="l00653"></a>00653     <span class="keywordtype">int</span> src_height, <span class="keywordtype">int</span> dst_width, <span class="keywordtype">int</span> dst_height)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655     <span class="keywordtype">double</span> ratiox = (double) (dst_width) / (double) (src_width);
<a name="l00656"></a>00656     <span class="keywordtype">double</span> ratioy = (double) (dst_height) / (double) (src_height);
<a name="l00657"></a>00657     uintptr_t x_src;
<a name="l00658"></a>00658     uintptr_t y_src;
<a name="l00659"></a>00659         <span class="keywordtype">float</span> dx_dst, x_dst;
<a name="l00660"></a>00660     <span class="keywordtype">float</span> dy_dst, y_dst;
<a name="l00661"></a>00661     <span class="keywordtype">float</span> y_counter;
<a name="l00662"></a>00662     <span class="keywordtype">float</span> * dst_begin = dst;
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     <span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a> * dst_line1;
<a name="l00665"></a>00665     <span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a> * dst_line2;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     dst_line1 = (<span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(
<a name="l00668"></a>00668         (dst_width + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a>), 
<a name="l00669"></a>00669         &quot;shrink_picture_float 1&quot;);
<a name="l00670"></a>00670     dst_line2 = (<span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(
<a name="l00671"></a>00671         (dst_width + 1) * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a>),
<a name="l00672"></a>00672         &quot;shrink_picture_float 2&quot;);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     dx_dst = ratiox;
<a name="l00675"></a>00675     dy_dst = ratioy;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     y_dst = 0;
<a name="l00678"></a>00678     y_counter = 1.0;
<a name="l00679"></a>00679     <span class="keywordflow">for</span> (y_src = 0; y_src &lt; src_height; y_src++) {
<a name="l00680"></a>00680         <span class="keywordtype">float</span>* line = src + y_src * 4 * src_width;
<a name="l00681"></a>00681         uintptr_t weight1y = 1.0f - (y_dst - (int) y_dst);
<a name="l00682"></a>00682         uintptr_t weight2y = 1.0f - weight1y;
<a name="l00683"></a>00683         x_dst = 0;
<a name="l00684"></a>00684         <span class="keywordflow">for</span> (x_src = 0; x_src &lt; src_width; x_src++) {
<a name="l00685"></a>00685             uintptr_t weight1x = 1.0f - (x_dst - (int) x_dst);
<a name="l00686"></a>00686             uintptr_t weight2x = 1.0f - weight1x;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688             uintptr_t x = (int) x_dst;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690             <span class="keywordtype">float</span> w;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692             w = weight1y * weight1x;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694             dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a> += line[0] * w;
<a name="l00695"></a>00695             dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a> += line[1] * w;
<a name="l00696"></a>00696             dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a> += line[2] * w;
<a name="l00697"></a>00697             dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a> += line[3] * w;
<a name="l00698"></a>00698             dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a> += w;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700             w = weight2y * weight1x;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702             dst_line2[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a> += line[0] * w;
<a name="l00703"></a>00703             dst_line2[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a> += line[1] * w;
<a name="l00704"></a>00704             dst_line2[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a> += line[2] * w;
<a name="l00705"></a>00705             dst_line2[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a> += line[3] * w;
<a name="l00706"></a>00706             dst_line2[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a> += w;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708             w = weight1y * weight2x;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710             dst_line1[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a> += line[0] * w;
<a name="l00711"></a>00711             dst_line1[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a> += line[1] * w;
<a name="l00712"></a>00712             dst_line1[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a> += line[2] * w;
<a name="l00713"></a>00713             dst_line1[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a> += line[3] * w;
<a name="l00714"></a>00714             dst_line1[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a> += w;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716             w = weight2y * weight2x;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718             dst_line2[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a> += line[0] * w;
<a name="l00719"></a>00719             dst_line2[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a> += line[1] * w;
<a name="l00720"></a>00720             dst_line2[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a> += line[2] * w;
<a name="l00721"></a>00721             dst_line2[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a> += line[3] * w;
<a name="l00722"></a>00722             dst_line2[x+1].<a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a> += w;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724             x_dst += dx_dst;
<a name="l00725"></a>00725             line += 4;
<a name="l00726"></a>00726         }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728         y_dst += dy_dst;
<a name="l00729"></a>00729         y_counter -= dy_dst;
<a name="l00730"></a>00730         <span class="keywordflow">if</span> (y_counter &lt; 0) {
<a name="l00731"></a>00731             uintptr_t x;
<a name="l00732"></a>00732             <span class="keyword">struct </span><a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a> * temp;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734             y_counter += 1.0f;
<a name="l00735"></a>00735             
<a name="l00736"></a>00736             <span class="keywordflow">for</span> (x=0; x &lt; dst_width; x++) {
<a name="l00737"></a>00737                 <span class="keywordtype">float</span> f = 1.0f / dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a>;
<a name="l00738"></a>00738                 *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a> * f;
<a name="l00739"></a>00739                 *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a> * f;
<a name="l00740"></a>00740                 *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a> * f;
<a name="l00741"></a>00741                 *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a> * f;
<a name="l00742"></a>00742             }
<a name="l00743"></a>00743             memset(dst_line1, 0, dst_width *
<a name="l00744"></a>00744                    <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d2/dff/structscale__outpix__float.html">scale_outpix_float</a>));
<a name="l00745"></a>00745             temp = dst_line1;
<a name="l00746"></a>00746             dst_line1 = dst_line2;
<a name="l00747"></a>00747             dst_line2 = temp;
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (dst - dst_begin &lt; dst_width * dst_height * 4) {
<a name="l00751"></a>00751         uintptr_t x;
<a name="l00752"></a>00752         <span class="keywordflow">for</span> (x = 0; x &lt; dst_width; x++) {
<a name="l00753"></a>00753             <span class="keywordtype">float</span> f = 1.0f / dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#a2ab8f2a15d610216ca14dd3cdb02dd48">weight</a>;
<a name="l00754"></a>00754             *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#aa41ca01f6cb0aa30861ddfdc76ef3884">r</a> * f;
<a name="l00755"></a>00755             *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#af5301f0e17fcec2f8c9799fec6238f31">g</a> * f;
<a name="l00756"></a>00756             *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ac11cd8a0a3f10dd8a811c753755ac07d">b</a> * f;
<a name="l00757"></a>00757             *dst++ = dst_line1[x].<a class="code" href="../../d2/dff/structscale__outpix__float.html#ab6fb729e70b25d083132eff9229f1643">a</a> * f;
<a name="l00758"></a>00758         }
<a name="l00759"></a>00759     }
<a name="l00760"></a>00760     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(dst_line1);
<a name="l00761"></a>00761     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(dst_line2);
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="../../db/d79/scaling_8c.html#a50aa722be1dff39ab7e9db809a06c999">00765</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#a50aa722be1dff39ab7e9db809a06c999">q_scale_float</a>(<span class="keywordtype">float</span>* in, <span class="keywordtype">float</span>* out, <span class="keywordtype">int</span> in_width, 
<a name="l00766"></a>00766              <span class="keywordtype">int</span> in_height, <span class="keywordtype">int</span> dst_width, <span class="keywordtype">int</span> dst_height)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <span class="keywordflow">if</span> (dst_width &gt; in_width &amp;&amp; dst_height &gt; in_height) {
<a name="l00769"></a>00769         <a class="code" href="../../db/d79/scaling_8c.html#acd298a14fc9ad461142ffe3a696c776e">enlarge_picture_float</a>(in, out, in_width, in_height,
<a name="l00770"></a>00770                       dst_width, dst_height);
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dst_width &lt; in_width &amp;&amp; dst_height &lt; in_height) {
<a name="l00773"></a>00773         <a class="code" href="../../db/d79/scaling_8c.html#ac48825bd612fb077732fd565e988b3cc">shrink_picture_float</a>(in, out, in_width, in_height,
<a name="l00774"></a>00774                      dst_width, dst_height);
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00799"></a><a class="code" href="../../db/d79/scaling_8c.html#a124b8f0742d47979253d81c1739b5ca4">00799</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d79/scaling_8c.html#a124b8f0742d47979253d81c1739b5ca4">q_scale_linear_interpolation</a>(
<a name="l00800"></a>00800     <span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> newx, <span class="keywordtype">int</span> newy)
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802     <span class="keywordflow">if</span> ((newx &gt;= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &amp;&amp; newy &lt;= ibuf-&gt;y) ||
<a name="l00803"></a>00803         (newx &lt;= ibuf-&gt;x &amp;&amp; newy &gt;= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>)) {
<a name="l00804"></a>00804         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) {
<a name="l00808"></a>00808         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * newrect =
<a name="l00809"></a>00809                 <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * newy * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <span class="stringliteral">&quot;q_scale rect&quot;</span>);
<a name="l00810"></a>00810         <a class="code" href="../../db/d79/scaling_8c.html#a6a315f3be7a08eaa8c0db2b5584761c2">q_scale_byte</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>, newrect, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>,
<a name="l00811"></a>00811                      newx, newy);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4660d436da5d4c67faacaf2fa2b9989e">imb_freerectImBuf</a>(ibuf);
<a name="l00814"></a>00814         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>;
<a name="l00815"></a>00815         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *) newrect;
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) {
<a name="l00818"></a>00818         <span class="keywordtype">float</span> * newrect =
<a name="l00819"></a>00819                 <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * newy * 4 *<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),
<a name="l00820"></a>00820                             <span class="stringliteral">&quot;q_scale rectfloat&quot;</span>);
<a name="l00821"></a>00821         <a class="code" href="../../db/d79/scaling_8c.html#a50aa722be1dff39ab7e9db809a06c999">q_scale_float</a>(ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>, newrect, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>,
<a name="l00822"></a>00822                       newx, newy);
<a name="l00823"></a>00823         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l00824"></a>00824         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#acfab05c5428143166a6fdab0aba64ea0" title="Flag defining the components of the ImBuf struct.">IB_rectfloat</a>;
<a name="l00825"></a>00825         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> = newrect;
<a name="l00826"></a>00826     }
<a name="l00827"></a>00827     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> = newx;
<a name="l00828"></a>00828     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> = newy;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00831"></a>00831 }
<a name="l00832"></a>00832 
<a name="l00833"></a><a class="code" href="../../db/d79/scaling_8c.html#a852740f0d33c57d3b4deaa8a9c0aa0e3">00833</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d79/scaling_8c.html#a852740f0d33c57d3b4deaa8a9c0aa0e3">scaledownx</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> newx)
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835     <span class="keyword">const</span> <span class="keywordtype">int</span> do_rect= (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00836"></a>00836     <span class="keyword">const</span> <span class="keywordtype">int</span> do_float= (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00837"></a>00837     <span class="keyword">const</span> <span class="keywordtype">size_t</span> rect_size= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * 4;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>, *_newrect, *newrect;
<a name="l00840"></a>00840     <span class="keywordtype">float</span> *rectf, *_newrectf, *newrectf;
<a name="l00841"></a>00841     <span class="keywordtype">float</span> sample, <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>, val[4], nval[4], valf[4], nvalf[4];
<a name="l00842"></a>00842     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, <a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844     rectf= _newrectf= newrectf= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l00845"></a>00845     rect=_newrect= newrect= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l00846"></a>00846     nval[0]=  nval[1]= nval[2]= nval[3]= 0.0f;
<a name="l00847"></a>00847     nvalf[0]=nvalf[1]=nvalf[2]=nvalf[3]= 0.0f;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <span class="keywordflow">if</span> (!do_rect &amp;&amp; !do_float) <span class="keywordflow">return</span> (ibuf);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (do_rect) {
<a name="l00852"></a>00852         _newrect = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) * 4, <span class="stringliteral">&quot;scaledownx&quot;</span>);
<a name="l00853"></a>00853         <span class="keywordflow">if</span> (_newrect==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(ibuf);
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (do_float) {
<a name="l00856"></a>00856         _newrectf = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 4, <span class="stringliteral">&quot;scaledownxf&quot;</span>);
<a name="l00857"></a>00857         <span class="keywordflow">if</span> (_newrectf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00858"></a>00858             <span class="keywordflow">if</span> (_newrect) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(_newrect);
<a name="l00859"></a>00859             <span class="keywordflow">return</span>(ibuf);
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     add = (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> - 0.01) / newx;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <span class="keywordflow">if</span> (do_rect) {
<a name="l00866"></a>00866         rect = (<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00867"></a>00867         newrect = _newrect;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869     <span class="keywordflow">if</span> (do_float) {
<a name="l00870"></a>00870         rectf = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00871"></a>00871         newrectf = _newrectf;
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873         
<a name="l00874"></a>00874     <span class="keywordflow">for</span> (y = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>; y &gt; 0; y--) {
<a name="l00875"></a>00875         sample = 0.0f;
<a name="l00876"></a>00876         val[0]=  val[1]= val[2]= val[3]= 0.0f;
<a name="l00877"></a>00877         valf[0]=valf[1]=valf[2]=valf[3]= 0.0f;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879         <span class="keywordflow">for</span> (x = newx; x &gt; 0; x--) {
<a name="l00880"></a>00880             <span class="keywordflow">if</span> (do_rect) {
<a name="l00881"></a>00881                 nval[0] = - val[0] * sample;
<a name="l00882"></a>00882                 nval[1] = - val[1] * sample;
<a name="l00883"></a>00883                 nval[2] = - val[2] * sample;
<a name="l00884"></a>00884                 nval[3] = - val[3] * sample;
<a name="l00885"></a>00885             }
<a name="l00886"></a>00886             <span class="keywordflow">if</span> (do_float) {
<a name="l00887"></a>00887                 nvalf[0] = - valf[0] * sample;
<a name="l00888"></a>00888                 nvalf[1] = - valf[1] * sample;
<a name="l00889"></a>00889                 nvalf[2] = - valf[2] * sample;
<a name="l00890"></a>00890                 nvalf[3] = - valf[3] * sample;
<a name="l00891"></a>00891             }
<a name="l00892"></a>00892             
<a name="l00893"></a>00893             sample += <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895             <span class="keywordflow">while</span> (sample &gt;= 1.0f) {
<a name="l00896"></a>00896                 sample -= 1.0f;
<a name="l00897"></a>00897                 
<a name="l00898"></a>00898                 <span class="keywordflow">if</span> (do_rect) {
<a name="l00899"></a>00899                     nval[0] += rect[0];
<a name="l00900"></a>00900                     nval[1] += rect[1];
<a name="l00901"></a>00901                     nval[2] += rect[2];
<a name="l00902"></a>00902                     nval[3] += rect[3];
<a name="l00903"></a>00903                     rect += 4;
<a name="l00904"></a>00904                 }
<a name="l00905"></a>00905                 <span class="keywordflow">if</span> (do_float) {
<a name="l00906"></a>00906                     nvalf[0] += rectf[0];
<a name="l00907"></a>00907                     nvalf[1] += rectf[1];
<a name="l00908"></a>00908                     nvalf[2] += rectf[2];
<a name="l00909"></a>00909                     nvalf[3] += rectf[3];
<a name="l00910"></a>00910                     rectf += 4;
<a name="l00911"></a>00911                 }
<a name="l00912"></a>00912             }
<a name="l00913"></a>00913             
<a name="l00914"></a>00914             <span class="keywordflow">if</span> (do_rect) {
<a name="l00915"></a>00915                 val[0]= rect[0];val[1]= rect[1];val[2]= rect[2];val[3]= rect[3];
<a name="l00916"></a>00916                 rect += 4;
<a name="l00917"></a>00917                 
<a name="l00918"></a>00918                 newrect[0] = ((nval[0] + sample * val[0])/add + 0.5f);
<a name="l00919"></a>00919                 newrect[1] = ((nval[1] + sample * val[1])/add + 0.5f);
<a name="l00920"></a>00920                 newrect[2] = ((nval[2] + sample * val[2])/add + 0.5f);
<a name="l00921"></a>00921                 newrect[3] = ((nval[3] + sample * val[3])/add + 0.5f);
<a name="l00922"></a>00922                 
<a name="l00923"></a>00923                 newrect += 4;
<a name="l00924"></a>00924             }
<a name="l00925"></a>00925             <span class="keywordflow">if</span> (do_float) {
<a name="l00926"></a>00926                 
<a name="l00927"></a>00927                 valf[0]= rectf[0];valf[1]= rectf[1];valf[2]= rectf[2];valf[3]= rectf[3];
<a name="l00928"></a>00928                 rectf += 4;
<a name="l00929"></a>00929                 
<a name="l00930"></a>00930                 newrectf[0] = ((nvalf[0] + sample * valf[0])/add);
<a name="l00931"></a>00931                 newrectf[1] = ((nvalf[1] + sample * valf[1])/add);
<a name="l00932"></a>00932                 newrectf[2] = ((nvalf[2] + sample * valf[2])/add);
<a name="l00933"></a>00933                 newrectf[3] = ((nvalf[3] + sample * valf[3])/add);
<a name="l00934"></a>00934                 
<a name="l00935"></a>00935                 newrectf += 4;
<a name="l00936"></a>00936             }
<a name="l00937"></a>00937             
<a name="l00938"></a>00938             sample -= 1.0f;
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <span class="keywordflow">if</span> (do_rect) {
<a name="l00943"></a>00943         <span class="comment">// printf(&quot;%ld %ld\n&quot;, (uchar *)rect - ((uchar *)ibuf-&gt;rect), rect_size);</span>
<a name="l00944"></a>00944         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *)rect - ((<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) == rect_size); <span class="comment">/* see bug [#26502] */</span>
<a name="l00945"></a>00945         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4660d436da5d4c67faacaf2fa2b9989e">imb_freerectImBuf</a>(ibuf);
<a name="l00946"></a>00946         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>;
<a name="l00947"></a>00947         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *) _newrect;
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     <span class="keywordflow">if</span> (do_float) {
<a name="l00950"></a>00950         <span class="comment">// printf(&quot;%ld %ld\n&quot;, rectf - ibuf-&gt;rect_float, rect_size);</span>
<a name="l00951"></a>00951         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((rectf - ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) == rect_size); <span class="comment">/* see bug [#26502] */</span>
<a name="l00952"></a>00952         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l00953"></a>00953         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#acfab05c5428143166a6fdab0aba64ea0" title="Flag defining the components of the ImBuf struct.">IB_rectfloat</a>;
<a name="l00954"></a>00954         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> = _newrectf;
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956     (void)rect_size; <span class="comment">/* UNUSED in release builds */</span>
<a name="l00957"></a>00957     
<a name="l00958"></a>00958     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> = newx;
<a name="l00959"></a>00959     <span class="keywordflow">return</span>(ibuf);
<a name="l00960"></a>00960 }
<a name="l00961"></a>00961 
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="../../db/d79/scaling_8c.html#afa1c58bc0a2acd4eef4ee9d35f96c363">00963</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d79/scaling_8c.html#afa1c58bc0a2acd4eef4ee9d35f96c363">scaledowny</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> newy)
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965     <span class="keyword">const</span> <span class="keywordtype">int</span> do_rect= (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00966"></a>00966     <span class="keyword">const</span> <span class="keywordtype">int</span> do_float= (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00967"></a>00967     <span class="keyword">const</span> <span class="keywordtype">size_t</span> rect_size= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * 4;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>, *_newrect, *newrect;
<a name="l00970"></a>00970     <span class="keywordtype">float</span> *rectf, *_newrectf, *newrectf;
<a name="l00971"></a>00971     <span class="keywordtype">float</span> sample, <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>, val[4], nval[4], valf[4], nvalf[4];
<a name="l00972"></a>00972     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, <a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, skipx;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     rectf= _newrectf= newrectf= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l00975"></a>00975     rect= _newrect= newrect= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l00976"></a>00976     nval[0]=  nval[1]= nval[2]= nval[3]= 0.0f;
<a name="l00977"></a>00977     nvalf[0]=nvalf[1]=nvalf[2]=nvalf[3]= 0.0f;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (!do_rect &amp;&amp; !do_float) <span class="keywordflow">return</span> (ibuf);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (do_rect) {
<a name="l00982"></a>00982         _newrect = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newy * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) * 4, <span class="stringliteral">&quot;scaledowny&quot;</span>);
<a name="l00983"></a>00983         <span class="keywordflow">if</span> (_newrect==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(ibuf);
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (do_float) {
<a name="l00986"></a>00986         _newrectf = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newy * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 4, <span class="stringliteral">&quot;scaledownyf&quot;</span>);
<a name="l00987"></a>00987         <span class="keywordflow">if</span> (_newrectf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00988"></a>00988             <span class="keywordflow">if</span> (_newrect) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(_newrect);
<a name="l00989"></a>00989             <span class="keywordflow">return</span>(ibuf);
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     add = (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> - 0.01) / newy;
<a name="l00994"></a>00994     skipx = 4 * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     <span class="keywordflow">for</span> (x = skipx - 4; x &gt;= 0; x -= 4) {
<a name="l00997"></a>00997         <span class="keywordflow">if</span> (do_rect) {
<a name="l00998"></a>00998             rect = ((<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) + <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l00999"></a>00999             newrect = _newrect + <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01000"></a>01000         }
<a name="l01001"></a>01001         <span class="keywordflow">if</span> (do_float) {
<a name="l01002"></a>01002             rectf = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> + <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01003"></a>01003             newrectf = _newrectf + <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01004"></a>01004         }
<a name="l01005"></a>01005         
<a name="l01006"></a>01006         sample = 0.0f;
<a name="l01007"></a>01007         val[0]=  val[1]= val[2]= val[3]= 0.0f;
<a name="l01008"></a>01008         valf[0]=valf[1]=valf[2]=valf[3]= 0.0f;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010         <span class="keywordflow">for</span> (y = newy; y &gt; 0; y--) {
<a name="l01011"></a>01011             <span class="keywordflow">if</span> (do_rect) {
<a name="l01012"></a>01012                 nval[0] = - val[0] * sample;
<a name="l01013"></a>01013                 nval[1] = - val[1] * sample;
<a name="l01014"></a>01014                 nval[2] = - val[2] * sample;
<a name="l01015"></a>01015                 nval[3] = - val[3] * sample;
<a name="l01016"></a>01016             }
<a name="l01017"></a>01017             <span class="keywordflow">if</span> (do_float) {
<a name="l01018"></a>01018                 nvalf[0] = - valf[0] * sample;
<a name="l01019"></a>01019                 nvalf[1] = - valf[1] * sample;
<a name="l01020"></a>01020                 nvalf[2] = - valf[2] * sample;
<a name="l01021"></a>01021                 nvalf[3] = - valf[3] * sample;
<a name="l01022"></a>01022             }
<a name="l01023"></a>01023             
<a name="l01024"></a>01024             sample += <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l01025"></a>01025 
<a name="l01026"></a>01026             <span class="keywordflow">while</span> (sample &gt;= 1.0f) {
<a name="l01027"></a>01027                 sample -= 1.0f;
<a name="l01028"></a>01028                 
<a name="l01029"></a>01029                 <span class="keywordflow">if</span> (do_rect) {
<a name="l01030"></a>01030                     nval[0] += rect[0];
<a name="l01031"></a>01031                     nval[1] += rect[1];
<a name="l01032"></a>01032                     nval[2] += rect[2];
<a name="l01033"></a>01033                     nval[3] += rect[3];
<a name="l01034"></a>01034                     rect += skipx;
<a name="l01035"></a>01035                 }
<a name="l01036"></a>01036                 <span class="keywordflow">if</span> (do_float) {
<a name="l01037"></a>01037                     nvalf[0] += rectf[0];
<a name="l01038"></a>01038                     nvalf[1] += rectf[1];
<a name="l01039"></a>01039                     nvalf[2] += rectf[2];
<a name="l01040"></a>01040                     nvalf[3] += rectf[3];
<a name="l01041"></a>01041                     rectf += skipx;
<a name="l01042"></a>01042                 }
<a name="l01043"></a>01043             }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045             <span class="keywordflow">if</span> (do_rect) {
<a name="l01046"></a>01046                 val[0]= rect[0];val[1]= rect[1];val[2]= rect[2];val[3]= rect[3];
<a name="l01047"></a>01047                 rect += skipx;
<a name="l01048"></a>01048                 
<a name="l01049"></a>01049                 newrect[0] = ((nval[0] + sample * val[0])/add + 0.5f);
<a name="l01050"></a>01050                 newrect[1] = ((nval[1] + sample * val[1])/add + 0.5f);
<a name="l01051"></a>01051                 newrect[2] = ((nval[2] + sample * val[2])/add + 0.5f);
<a name="l01052"></a>01052                 newrect[3] = ((nval[3] + sample * val[3])/add + 0.5f);
<a name="l01053"></a>01053                 
<a name="l01054"></a>01054                 newrect += skipx;
<a name="l01055"></a>01055             }
<a name="l01056"></a>01056             <span class="keywordflow">if</span> (do_float) {
<a name="l01057"></a>01057                 
<a name="l01058"></a>01058                 valf[0]= rectf[0];valf[1]= rectf[1];valf[2]= rectf[2];valf[3]= rectf[3];
<a name="l01059"></a>01059                 rectf += skipx;
<a name="l01060"></a>01060                 
<a name="l01061"></a>01061                 newrectf[0] = ((nvalf[0] + sample * valf[0])/add);
<a name="l01062"></a>01062                 newrectf[1] = ((nvalf[1] + sample * valf[1])/add);
<a name="l01063"></a>01063                 newrectf[2] = ((nvalf[2] + sample * valf[2])/add);
<a name="l01064"></a>01064                 newrectf[3] = ((nvalf[3] + sample * valf[3])/add);
<a name="l01065"></a>01065                 
<a name="l01066"></a>01066                 newrectf += skipx;
<a name="l01067"></a>01067             }
<a name="l01068"></a>01068             
<a name="l01069"></a>01069             sample -= 1.0f;
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071     }   
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (do_rect) {
<a name="l01074"></a>01074         <span class="comment">// printf(&quot;%ld %ld\n&quot;, (uchar *)rect - ((uchar *)ibuf-&gt;rect), rect_size);</span>
<a name="l01075"></a>01075         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *)rect - ((<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) == rect_size); <span class="comment">/* see bug [#26502] */</span>
<a name="l01076"></a>01076         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4660d436da5d4c67faacaf2fa2b9989e">imb_freerectImBuf</a>(ibuf);
<a name="l01077"></a>01077         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>;
<a name="l01078"></a>01078         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *) _newrect;
<a name="l01079"></a>01079     }
<a name="l01080"></a>01080     <span class="keywordflow">if</span> (do_float) {
<a name="l01081"></a>01081         <span class="comment">// printf(&quot;%ld %ld\n&quot;, rectf - ibuf-&gt;rect_float, rect_size);</span>
<a name="l01082"></a>01082         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((rectf - ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) == rect_size); <span class="comment">/* see bug [#26502] */</span>
<a name="l01083"></a>01083         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l01084"></a>01084         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#acfab05c5428143166a6fdab0aba64ea0" title="Flag defining the components of the ImBuf struct.">IB_rectfloat</a>;
<a name="l01085"></a>01085         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> = (<span class="keywordtype">float</span> *) _newrectf;
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087     (void)rect_size; <span class="comment">/* UNUSED in release builds */</span>
<a name="l01088"></a>01088     
<a name="l01089"></a>01089     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> = newy;
<a name="l01090"></a>01090     <span class="keywordflow">return</span>(ibuf);
<a name="l01091"></a>01091 }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093 
<a name="l01094"></a><a class="code" href="../../db/d79/scaling_8c.html#a71bd1791332f2bb81af828484af5244f">01094</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d79/scaling_8c.html#a71bd1791332f2bb81af828484af5244f">scaleupx</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> newx)
<a name="l01095"></a>01095 {
<a name="l01096"></a>01096     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>,*_newrect=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,*newrect;
<a name="l01097"></a>01097     <span class="keywordtype">float</span> *rectf,*_newrectf=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,*newrectf;
<a name="l01098"></a>01098     <span class="keywordtype">float</span> sample,<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l01099"></a>01099     <span class="keywordtype">float</span> val_a,nval_a,diff_a;
<a name="l01100"></a>01100     <span class="keywordtype">float</span> val_b,nval_b,diff_b;
<a name="l01101"></a>01101     <span class="keywordtype">float</span> val_g,nval_g,diff_g;
<a name="l01102"></a>01102     <span class="keywordtype">float</span> val_r,nval_r,diff_r;
<a name="l01103"></a>01103     <span class="keywordtype">float</span> val_af,nval_af,diff_af;
<a name="l01104"></a>01104     <span class="keywordtype">float</span> val_bf,nval_bf,diff_bf;
<a name="l01105"></a>01105     <span class="keywordtype">float</span> val_gf,nval_gf,diff_gf;
<a name="l01106"></a>01106     <span class="keywordtype">float</span> val_rf,nval_rf,diff_rf;
<a name="l01107"></a>01107     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>,<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, do_rect = 0, do_float = 0;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     val_a = nval_a = diff_a = val_b = nval_b = diff_b = 0;
<a name="l01110"></a>01110     val_g = nval_g = diff_g = val_r = nval_r = diff_r = 0;
<a name="l01111"></a>01111     val_af = nval_af = diff_af = val_bf = nval_bf = diff_bf = 0;
<a name="l01112"></a>01112     val_gf = nval_gf = diff_gf = val_rf = nval_rf = diff_rf = 0;
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (ibuf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01114"></a>01114     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (ibuf);
<a name="l01115"></a>01115 
<a name="l01116"></a>01116     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) {
<a name="l01117"></a>01117         do_rect = 1;
<a name="l01118"></a>01118         _newrect = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <span class="stringliteral">&quot;scaleupx&quot;</span>);
<a name="l01119"></a>01119         <span class="keywordflow">if</span> (_newrect==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(ibuf);
<a name="l01120"></a>01120     }
<a name="l01121"></a>01121     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) {
<a name="l01122"></a>01122         do_float = 1;
<a name="l01123"></a>01123         _newrectf = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 4, <span class="stringliteral">&quot;scaleupxf&quot;</span>);
<a name="l01124"></a>01124         <span class="keywordflow">if</span> (_newrectf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01125"></a>01125             <span class="keywordflow">if</span> (_newrect) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(_newrect);
<a name="l01126"></a>01126             <span class="keywordflow">return</span>(ibuf);
<a name="l01127"></a>01127         }
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     add = (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> - 1.001) / (newx - 1.0);
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     rect = (<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l01133"></a>01133     rectf = (<span class="keywordtype">float</span> *) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l01134"></a>01134     newrect = _newrect;
<a name="l01135"></a>01135     newrectf = _newrectf;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <span class="keywordflow">for</span> (y = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>; y &gt; 0; y--) {
<a name="l01138"></a>01138 
<a name="l01139"></a>01139         sample = 0;
<a name="l01140"></a>01140         
<a name="l01141"></a>01141         <span class="keywordflow">if</span> (do_rect) {
<a name="l01142"></a>01142             val_a = rect[0];
<a name="l01143"></a>01143             nval_a = rect[4];
<a name="l01144"></a>01144             diff_a = nval_a - val_a;
<a name="l01145"></a>01145             val_a += 0.5f;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147             val_b = rect[1];
<a name="l01148"></a>01148             nval_b = rect[5];
<a name="l01149"></a>01149             diff_b = nval_b - val_b;
<a name="l01150"></a>01150             val_b += 0.5f;
<a name="l01151"></a>01151 
<a name="l01152"></a>01152             val_g = rect[2];
<a name="l01153"></a>01153             nval_g = rect[6];
<a name="l01154"></a>01154             diff_g = nval_g - val_g;
<a name="l01155"></a>01155             val_g += 0.5f;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157             val_r = rect[3];
<a name="l01158"></a>01158             nval_r = rect[7];
<a name="l01159"></a>01159             diff_r = nval_r - val_r;
<a name="l01160"></a>01160             val_r += 0.5f;
<a name="l01161"></a>01161 
<a name="l01162"></a>01162             rect += 8;
<a name="l01163"></a>01163         }
<a name="l01164"></a>01164         <span class="keywordflow">if</span> (do_float) {
<a name="l01165"></a>01165             val_af = rectf[0];
<a name="l01166"></a>01166             nval_af = rectf[4];
<a name="l01167"></a>01167             diff_af = nval_af - val_af;
<a name="l01168"></a>01168     
<a name="l01169"></a>01169             val_bf = rectf[1];
<a name="l01170"></a>01170             nval_bf = rectf[5];
<a name="l01171"></a>01171             diff_bf = nval_bf - val_bf;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173             val_gf = rectf[2];
<a name="l01174"></a>01174             nval_gf = rectf[6];
<a name="l01175"></a>01175             diff_gf = nval_gf - val_gf;
<a name="l01176"></a>01176 
<a name="l01177"></a>01177             val_rf = rectf[3];
<a name="l01178"></a>01178             nval_rf = rectf[7];
<a name="l01179"></a>01179             diff_rf = nval_rf - val_rf;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181             rectf += 8;
<a name="l01182"></a>01182         }
<a name="l01183"></a>01183         <span class="keywordflow">for</span> (x = newx; x &gt; 0; x--) {
<a name="l01184"></a>01184             <span class="keywordflow">if</span> (sample &gt;= 1.0f) {
<a name="l01185"></a>01185                 sample -= 1.0f;
<a name="l01186"></a>01186 
<a name="l01187"></a>01187                 <span class="keywordflow">if</span> (do_rect) {
<a name="l01188"></a>01188                     val_a = nval_a;
<a name="l01189"></a>01189                     nval_a = rect[0];
<a name="l01190"></a>01190                     diff_a = nval_a - val_a;
<a name="l01191"></a>01191                     val_a += 0.5f;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193                     val_b = nval_b;
<a name="l01194"></a>01194                     nval_b = rect[1];
<a name="l01195"></a>01195                     diff_b = nval_b - val_b;
<a name="l01196"></a>01196                     val_b += 0.5f;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198                     val_g = nval_g;
<a name="l01199"></a>01199                     nval_g = rect[2];
<a name="l01200"></a>01200                     diff_g = nval_g - val_g;
<a name="l01201"></a>01201                     val_g += 0.5f;
<a name="l01202"></a>01202 
<a name="l01203"></a>01203                     val_r = nval_r;
<a name="l01204"></a>01204                     nval_r = rect[3];
<a name="l01205"></a>01205                     diff_r = nval_r - val_r;
<a name="l01206"></a>01206                     val_r += 0.5f;
<a name="l01207"></a>01207                     rect += 4;
<a name="l01208"></a>01208                 }
<a name="l01209"></a>01209                 <span class="keywordflow">if</span> (do_float) {
<a name="l01210"></a>01210                     val_af = nval_af;
<a name="l01211"></a>01211                     nval_af = rectf[0];
<a name="l01212"></a>01212                     diff_af = nval_af - val_af;
<a name="l01213"></a>01213     
<a name="l01214"></a>01214                     val_bf = nval_bf;
<a name="l01215"></a>01215                     nval_bf = rectf[1];
<a name="l01216"></a>01216                     diff_bf = nval_bf - val_bf;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218                     val_gf = nval_gf;
<a name="l01219"></a>01219                     nval_gf = rectf[2];
<a name="l01220"></a>01220                     diff_gf = nval_gf - val_gf;
<a name="l01221"></a>01221 
<a name="l01222"></a>01222                     val_rf = nval_rf;
<a name="l01223"></a>01223                     nval_rf = rectf[3];
<a name="l01224"></a>01224                     diff_rf = nval_rf - val_rf;
<a name="l01225"></a>01225                     rectf += 4;
<a name="l01226"></a>01226                 }
<a name="l01227"></a>01227             }
<a name="l01228"></a>01228             <span class="keywordflow">if</span> (do_rect) {
<a name="l01229"></a>01229                 newrect[0] = val_a + sample * diff_a;
<a name="l01230"></a>01230                 newrect[1] = val_b + sample * diff_b;
<a name="l01231"></a>01231                 newrect[2] = val_g + sample * diff_g;
<a name="l01232"></a>01232                 newrect[3] = val_r + sample * diff_r;
<a name="l01233"></a>01233                 newrect += 4;
<a name="l01234"></a>01234             }
<a name="l01235"></a>01235             <span class="keywordflow">if</span> (do_float) {
<a name="l01236"></a>01236                 newrectf[0] = val_af + sample * diff_af;
<a name="l01237"></a>01237                 newrectf[1] = val_bf + sample * diff_bf;
<a name="l01238"></a>01238                 newrectf[2] = val_gf + sample * diff_gf;
<a name="l01239"></a>01239                 newrectf[3] = val_rf + sample * diff_rf;
<a name="l01240"></a>01240                 newrectf += 4;
<a name="l01241"></a>01241             }
<a name="l01242"></a>01242             sample += <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246     <span class="keywordflow">if</span> (do_rect) {
<a name="l01247"></a>01247         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4660d436da5d4c67faacaf2fa2b9989e">imb_freerectImBuf</a>(ibuf);
<a name="l01248"></a>01248         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>;
<a name="l01249"></a>01249         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *) _newrect;
<a name="l01250"></a>01250     }
<a name="l01251"></a>01251     <span class="keywordflow">if</span> (do_float) {
<a name="l01252"></a>01252         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l01253"></a>01253         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#acfab05c5428143166a6fdab0aba64ea0" title="Flag defining the components of the ImBuf struct.">IB_rectfloat</a>;
<a name="l01254"></a>01254         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> = (<span class="keywordtype">float</span> *) _newrectf;
<a name="l01255"></a>01255     }
<a name="l01256"></a>01256     
<a name="l01257"></a>01257     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> = newx;
<a name="l01258"></a>01258     <span class="keywordflow">return</span>(ibuf);
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01261"></a><a class="code" href="../../db/d79/scaling_8c.html#ad1645b48f37f25698b547938dd9c143e">01261</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d79/scaling_8c.html#ad1645b48f37f25698b547938dd9c143e">scaleupy</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> newy)
<a name="l01262"></a>01262 {
<a name="l01263"></a>01263     <a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>,*_newrect=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,*newrect;
<a name="l01264"></a>01264     <span class="keywordtype">float</span> *rectf,*_newrectf=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,*newrectf;
<a name="l01265"></a>01265     <span class="keywordtype">float</span> sample,<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l01266"></a>01266     <span class="keywordtype">float</span> val_a,nval_a,diff_a;
<a name="l01267"></a>01267     <span class="keywordtype">float</span> val_b,nval_b,diff_b;
<a name="l01268"></a>01268     <span class="keywordtype">float</span> val_g,nval_g,diff_g;
<a name="l01269"></a>01269     <span class="keywordtype">float</span> val_r,nval_r,diff_r;
<a name="l01270"></a>01270     <span class="keywordtype">float</span> val_af,nval_af,diff_af;
<a name="l01271"></a>01271     <span class="keywordtype">float</span> val_bf,nval_bf,diff_bf;
<a name="l01272"></a>01272     <span class="keywordtype">float</span> val_gf,nval_gf,diff_gf;
<a name="l01273"></a>01273     <span class="keywordtype">float</span> val_rf,nval_rf,diff_rf;
<a name="l01274"></a>01274     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>,<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, do_rect = 0, do_float = 0, skipx;
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     val_a = nval_a = diff_a = val_b = nval_b = diff_b = 0;
<a name="l01277"></a>01277     val_g = nval_g = diff_g = val_r = nval_r = diff_r = 0;
<a name="l01278"></a>01278     val_af = nval_af = diff_af = val_bf = nval_bf = diff_bf = 0;
<a name="l01279"></a>01279     val_gf = nval_gf = diff_gf = val_rf = nval_rf = diff_rf = 0;
<a name="l01280"></a>01280     <span class="keywordflow">if</span> (ibuf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01281"></a>01281     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (ibuf);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) {
<a name="l01284"></a>01284         do_rect = 1;
<a name="l01285"></a>01285         _newrect = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * newy * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <span class="stringliteral">&quot;scaleupy&quot;</span>);
<a name="l01286"></a>01286         <span class="keywordflow">if</span> (_newrect==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(ibuf);
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) {
<a name="l01289"></a>01289         do_float = 1;
<a name="l01290"></a>01290         _newrectf = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * newy * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 4, <span class="stringliteral">&quot;scaleupyf&quot;</span>);
<a name="l01291"></a>01291         <span class="keywordflow">if</span> (_newrectf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01292"></a>01292             <span class="keywordflow">if</span> (_newrect) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(_newrect);
<a name="l01293"></a>01293             <span class="keywordflow">return</span>(ibuf);
<a name="l01294"></a>01294         }
<a name="l01295"></a>01295     }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297     add = (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> - 1.001) / (newy - 1.0);
<a name="l01298"></a>01298     skipx = 4 * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01299"></a>01299 
<a name="l01300"></a>01300     rect = (<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l01301"></a>01301     rectf = (<span class="keywordtype">float</span> *) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l01302"></a>01302     newrect = _newrect;
<a name="l01303"></a>01303     newrectf = _newrectf;
<a name="l01304"></a>01304 
<a name="l01305"></a>01305     <span class="keywordflow">for</span> (x = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>; x &gt; 0; x--) {
<a name="l01306"></a>01306 
<a name="l01307"></a>01307         sample = 0;
<a name="l01308"></a>01308         <span class="keywordflow">if</span> (do_rect) {
<a name="l01309"></a>01309             rect = ((<a class="code" href="../../d1/db5/imbuf_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) + 4*(x-1);
<a name="l01310"></a>01310             newrect = _newrect + 4*(x-1);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312             val_a = rect[0];
<a name="l01313"></a>01313             nval_a = rect[skipx];
<a name="l01314"></a>01314             diff_a = nval_a - val_a;
<a name="l01315"></a>01315             val_a += 0.5f;
<a name="l01316"></a>01316 
<a name="l01317"></a>01317             val_b = rect[1];
<a name="l01318"></a>01318             nval_b = rect[skipx+1];
<a name="l01319"></a>01319             diff_b = nval_b - val_b;
<a name="l01320"></a>01320             val_b += 0.5f;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322             val_g = rect[2];
<a name="l01323"></a>01323             nval_g = rect[skipx+2];
<a name="l01324"></a>01324             diff_g = nval_g - val_g;
<a name="l01325"></a>01325             val_g += 0.5f;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327             val_r = rect[3];
<a name="l01328"></a>01328             nval_r = rect[skipx+4];
<a name="l01329"></a>01329             diff_r = nval_r - val_r;
<a name="l01330"></a>01330             val_r += 0.5f;
<a name="l01331"></a>01331 
<a name="l01332"></a>01332             rect += 2*skipx;
<a name="l01333"></a>01333         }
<a name="l01334"></a>01334         <span class="keywordflow">if</span> (do_float) {
<a name="l01335"></a>01335             rectf = ((<span class="keywordtype">float</span> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) + 4*(x-1);
<a name="l01336"></a>01336             newrectf = _newrectf + 4*(x-1);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338             val_af = rectf[0];
<a name="l01339"></a>01339             nval_af = rectf[skipx];
<a name="l01340"></a>01340             diff_af = nval_af - val_af;
<a name="l01341"></a>01341     
<a name="l01342"></a>01342             val_bf = rectf[1];
<a name="l01343"></a>01343             nval_bf = rectf[skipx+1];
<a name="l01344"></a>01344             diff_bf = nval_bf - val_bf;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346             val_gf = rectf[2];
<a name="l01347"></a>01347             nval_gf = rectf[skipx+2];
<a name="l01348"></a>01348             diff_gf = nval_gf - val_gf;
<a name="l01349"></a>01349 
<a name="l01350"></a>01350             val_rf = rectf[3];
<a name="l01351"></a>01351             nval_rf = rectf[skipx+3];
<a name="l01352"></a>01352             diff_rf = nval_rf - val_rf;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354             rectf += 2*skipx;
<a name="l01355"></a>01355         }
<a name="l01356"></a>01356         
<a name="l01357"></a>01357         <span class="keywordflow">for</span> (y = newy; y &gt; 0; y--) {
<a name="l01358"></a>01358             <span class="keywordflow">if</span> (sample &gt;= 1.0f) {
<a name="l01359"></a>01359                 sample -= 1.0f;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361                 <span class="keywordflow">if</span> (do_rect) {
<a name="l01362"></a>01362                     val_a = nval_a;
<a name="l01363"></a>01363                     nval_a = rect[0];
<a name="l01364"></a>01364                     diff_a = nval_a - val_a;
<a name="l01365"></a>01365                     val_a += 0.5f;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367                     val_b = nval_b;
<a name="l01368"></a>01368                     nval_b = rect[1];
<a name="l01369"></a>01369                     diff_b = nval_b - val_b;
<a name="l01370"></a>01370                     val_b += 0.5f;
<a name="l01371"></a>01371 
<a name="l01372"></a>01372                     val_g = nval_g;
<a name="l01373"></a>01373                     nval_g = rect[2];
<a name="l01374"></a>01374                     diff_g = nval_g - val_g;
<a name="l01375"></a>01375                     val_g += 0.5f;
<a name="l01376"></a>01376 
<a name="l01377"></a>01377                     val_r = nval_r;
<a name="l01378"></a>01378                     nval_r = rect[3];
<a name="l01379"></a>01379                     diff_r = nval_r - val_r;
<a name="l01380"></a>01380                     val_r += 0.5f;
<a name="l01381"></a>01381                     rect += skipx;
<a name="l01382"></a>01382                 }
<a name="l01383"></a>01383                 <span class="keywordflow">if</span> (do_float) {
<a name="l01384"></a>01384                     val_af = nval_af;
<a name="l01385"></a>01385                     nval_af = rectf[0];
<a name="l01386"></a>01386                     diff_af = nval_af - val_af;
<a name="l01387"></a>01387     
<a name="l01388"></a>01388                     val_bf = nval_bf;
<a name="l01389"></a>01389                     nval_bf = rectf[1];
<a name="l01390"></a>01390                     diff_bf = nval_bf - val_bf;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392                     val_gf = nval_gf;
<a name="l01393"></a>01393                     nval_gf = rectf[2];
<a name="l01394"></a>01394                     diff_gf = nval_gf - val_gf;
<a name="l01395"></a>01395 
<a name="l01396"></a>01396                     val_rf = nval_rf;
<a name="l01397"></a>01397                     nval_rf = rectf[3];
<a name="l01398"></a>01398                     diff_rf = nval_rf - val_rf;
<a name="l01399"></a>01399                     rectf += skipx;
<a name="l01400"></a>01400                 }
<a name="l01401"></a>01401             }
<a name="l01402"></a>01402             <span class="keywordflow">if</span> (do_rect) {
<a name="l01403"></a>01403                 newrect[0] = val_a + sample * diff_a;
<a name="l01404"></a>01404                 newrect[1] = val_b + sample * diff_b;
<a name="l01405"></a>01405                 newrect[2] = val_g + sample * diff_g;
<a name="l01406"></a>01406                 newrect[3] = val_r + sample * diff_r;
<a name="l01407"></a>01407                 newrect += skipx;
<a name="l01408"></a>01408             }
<a name="l01409"></a>01409             <span class="keywordflow">if</span> (do_float) {
<a name="l01410"></a>01410                 newrectf[0] = val_af + sample * diff_af;
<a name="l01411"></a>01411                 newrectf[1] = val_bf + sample * diff_bf;
<a name="l01412"></a>01412                 newrectf[2] = val_gf + sample * diff_gf;
<a name="l01413"></a>01413                 newrectf[3] = val_rf + sample * diff_rf;
<a name="l01414"></a>01414                 newrectf += skipx;
<a name="l01415"></a>01415             }
<a name="l01416"></a>01416             sample += <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l01417"></a>01417         }
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420     <span class="keywordflow">if</span> (do_rect) {
<a name="l01421"></a>01421         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4660d436da5d4c67faacaf2fa2b9989e">imb_freerectImBuf</a>(ibuf);
<a name="l01422"></a>01422         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>;
<a name="l01423"></a>01423         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *) _newrect;
<a name="l01424"></a>01424     }
<a name="l01425"></a>01425     <span class="keywordflow">if</span> (do_float) {
<a name="l01426"></a>01426         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l01427"></a>01427         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#acfab05c5428143166a6fdab0aba64ea0" title="Flag defining the components of the ImBuf struct.">IB_rectfloat</a>;
<a name="l01428"></a>01428         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> = (<span class="keywordtype">float</span> *) _newrectf;
<a name="l01429"></a>01429     }
<a name="l01430"></a>01430     
<a name="l01431"></a>01431     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> = newy;
<a name="l01432"></a>01432     <span class="keywordflow">return</span>(ibuf);
<a name="l01433"></a>01433 }
<a name="l01434"></a>01434 
<a name="l01435"></a>01435 
<a name="l01436"></a>01436 <span class="comment">/* no float buf needed here! */</span>
<a name="l01437"></a><a class="code" href="../../db/d79/scaling_8c.html#a07513af588c8ce7f770f6334a7de4e74">01437</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d79/scaling_8c.html#a07513af588c8ce7f770f6334a7de4e74">scalefast_Z_ImBuf</a>(<a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> newx, <span class="keywordtype">int</span> newy)
<a name="l01438"></a>01438 {
<a name="l01439"></a>01439     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>, *_newrect, *newrect;
<a name="l01440"></a>01440     <span class="keywordtype">int</span> <a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, <a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l01441"></a>01441     <span class="keywordtype">int</span> ofsx, ofsy, stepx, stepy;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad9ce21fd6e42e77267839eb56d1c60f6">zbuf</a>) {
<a name="l01444"></a>01444         _newrect = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * newy * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <span class="stringliteral">&quot;z rect&quot;</span>);
<a name="l01445"></a>01445         <span class="keywordflow">if</span> (_newrect==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01446"></a>01446         
<a name="l01447"></a>01447         stepx = (65536.0 * (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> - 1.0) / (newx - 1.0)) + 0.5;
<a name="l01448"></a>01448         stepy = (65536.0 * (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> - 1.0) / (newy - 1.0)) + 0.5;
<a name="l01449"></a>01449         ofsy = 32768;
<a name="l01450"></a>01450 
<a name="l01451"></a>01451         newrect = _newrect;
<a name="l01452"></a>01452     
<a name="l01453"></a>01453         <span class="keywordflow">for</span> (y = newy; y &gt; 0; y--) {
<a name="l01454"></a>01454             rect = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*) ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad9ce21fd6e42e77267839eb56d1c60f6">zbuf</a>;
<a name="l01455"></a>01455             rect += (ofsy &gt;&gt; 16) * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01456"></a>01456             ofsy += stepy;
<a name="l01457"></a>01457             ofsx = 32768;
<a name="l01458"></a>01458             <span class="keywordflow">for</span> (x = newx; x &gt; 0; x--) {
<a name="l01459"></a>01459                 *newrect++ = rect[ofsx &gt;&gt; 16];
<a name="l01460"></a>01460                 ofsx += stepx;
<a name="l01461"></a>01461             }
<a name="l01462"></a>01462         }
<a name="l01463"></a>01463     
<a name="l01464"></a>01464         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a5729d32561fe474e6f0fca415a8d47f2">IMB_freezbufImBuf</a>(ibuf);
<a name="l01465"></a>01465         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a608c787ed430e12abfb59fda71486191" title="Flag defining the components of the ImBuf struct.">IB_zbuf</a>;
<a name="l01466"></a>01466         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad9ce21fd6e42e77267839eb56d1c60f6">zbuf</a> = (<span class="keywordtype">int</span>*) _newrect;
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468 }
<a name="l01469"></a>01469 
<a name="l01470"></a><a class="code" href="../../db/d79/scaling_8c.html#a226fb5e14b1905126cf30a6e7cba2498">01470</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a226fb5e14b1905126cf30a6e7cba2498">IMB_scaleImBuf</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> * ibuf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newy)
<a name="l01471"></a>01471 {
<a name="l01472"></a>01472     <span class="keywordflow">if</span> (ibuf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01473"></a>01473     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> (ibuf);
<a name="l01474"></a>01474     
<a name="l01475"></a>01475     <span class="keywordflow">if</span> (newx == ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &amp;&amp; newy == ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>) { <span class="keywordflow">return</span> ibuf; }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <span class="comment">/* scaleup / scaledown functions below change ibuf-&gt;x and ibuf-&gt;y</span>
<a name="l01478"></a>01478 <span class="comment">     * so we first scale the Z-buffer (if any) */</span>
<a name="l01479"></a>01479     <a class="code" href="../../db/d79/scaling_8c.html#a07513af588c8ce7f770f6334a7de4e74">scalefast_Z_ImBuf</a>(ibuf, newx, newy);
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     <span class="comment">/* try to scale common cases in a fast way */</span>
<a name="l01482"></a>01482     <span class="comment">/* disabled, quality loss is inacceptable, see report #18609  (ton) */</span>
<a name="l01483"></a>01483     <span class="keywordflow">if</span> (0 &amp;&amp; <a class="code" href="../../db/d79/scaling_8c.html#a124b8f0742d47979253d81c1739b5ca4">q_scale_linear_interpolation</a>(ibuf, newx, newy)) {
<a name="l01484"></a>01484         <span class="keywordflow">return</span> ibuf;
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486 
<a name="l01487"></a>01487     <span class="keywordflow">if</span> (newx &lt; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>) <span class="keywordflow">if</span> (newx) <a class="code" href="../../db/d79/scaling_8c.html#a852740f0d33c57d3b4deaa8a9c0aa0e3">scaledownx</a>(ibuf,newx);
<a name="l01488"></a>01488     <span class="keywordflow">if</span> (newy &lt; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>) <span class="keywordflow">if</span> (newy) <a class="code" href="../../db/d79/scaling_8c.html#afa1c58bc0a2acd4eef4ee9d35f96c363">scaledowny</a>(ibuf,newy);
<a name="l01489"></a>01489     <span class="keywordflow">if</span> (newx &gt; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>) <span class="keywordflow">if</span> (newx) <a class="code" href="../../db/d79/scaling_8c.html#a71bd1791332f2bb81af828484af5244f">scaleupx</a>(ibuf,newx);
<a name="l01490"></a>01490     <span class="keywordflow">if</span> (newy &gt; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>) <span class="keywordflow">if</span> (newy) <a class="code" href="../../db/d79/scaling_8c.html#ad1645b48f37f25698b547938dd9c143e">scaleupy</a>(ibuf,newy);
<a name="l01491"></a>01491     
<a name="l01492"></a>01492     <span class="keywordflow">return</span>(ibuf);
<a name="l01493"></a>01493 }
<a name="l01494"></a>01494 
<a name="l01495"></a><a class="code" href="../../db/d0a/structimbufRGBA.html">01495</a> <span class="keyword">struct </span><a class="code" href="../../db/d0a/structimbufRGBA.html">imbufRGBA</a> {
<a name="l01496"></a><a class="code" href="../../db/d0a/structimbufRGBA.html#a3972981c8191c8546875c58b02f63a1b">01496</a>     <span class="keywordtype">float</span> <a class="code" href="../../db/d0a/structimbufRGBA.html#a3972981c8191c8546875c58b02f63a1b">r</a>, <a class="code" href="../../db/d0a/structimbufRGBA.html#af082aafefca90bac549eb8bc62532678">g</a>, <a class="code" href="../../db/d0a/structimbufRGBA.html#aad04723ee8fdb2e830df5d9561bff248">b</a>, <a class="code" href="../../db/d0a/structimbufRGBA.html#a306bac5afe8b2514807b790511df5914">a</a>;
<a name="l01497"></a>01497 };
<a name="l01498"></a>01498 
<a name="l01499"></a><a class="code" href="../../db/d79/scaling_8c.html#a861e356514b5fe806f5e29d2758fdc4a">01499</a> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a861e356514b5fe806f5e29d2758fdc4a">IMB_scalefastImBuf</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newy)
<a name="l01500"></a>01500 {
<a name="l01501"></a>01501     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>,*_newrect,*newrect;
<a name="l01502"></a>01502     <span class="keyword">struct </span><a class="code" href="../../db/d0a/structimbufRGBA.html">imbufRGBA</a> *rectf, *_newrectf, *newrectf;
<a name="l01503"></a>01503     <span class="keywordtype">int</span> x,y, do_float=0, do_rect=0;
<a name="l01504"></a>01504     <span class="keywordtype">int</span> ofsx,ofsy,stepx,stepy;
<a name="l01505"></a>01505 
<a name="l01506"></a>01506     rect = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; _newrect = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; newrect = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01507"></a>01507     rectf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; _newrectf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; newrectf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01508"></a>01508 
<a name="l01509"></a>01509     <span class="keywordflow">if</span> (ibuf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01510"></a>01510     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) do_rect = 1;
<a name="l01511"></a>01511     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) do_float = 1;
<a name="l01512"></a>01512     <span class="keywordflow">if</span> (do_rect==0 &amp;&amp; do_float==0) <span class="keywordflow">return</span>(ibuf);
<a name="l01513"></a>01513     
<a name="l01514"></a>01514     <span class="keywordflow">if</span> (newx == ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &amp;&amp; newy == ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>) <span class="keywordflow">return</span>(ibuf);
<a name="l01515"></a>01515     
<a name="l01516"></a>01516     <span class="keywordflow">if</span> (do_rect) {
<a name="l01517"></a>01517         _newrect = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * newy * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <span class="stringliteral">&quot;scalefastimbuf&quot;</span>);
<a name="l01518"></a>01518         <span class="keywordflow">if</span> (_newrect==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>(ibuf);
<a name="l01519"></a>01519         newrect = _newrect;
<a name="l01520"></a>01520     }
<a name="l01521"></a>01521     
<a name="l01522"></a>01522     <span class="keywordflow">if</span> (do_float) {
<a name="l01523"></a>01523         _newrectf = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newx * newy * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 4, <span class="stringliteral">&quot;scalefastimbuf f&quot;</span>);
<a name="l01524"></a>01524         <span class="keywordflow">if</span> (_newrectf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01525"></a>01525             <span class="keywordflow">if</span> (_newrect) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(_newrect);
<a name="l01526"></a>01526             <span class="keywordflow">return</span>(ibuf);
<a name="l01527"></a>01527         }
<a name="l01528"></a>01528         newrectf = _newrectf;
<a name="l01529"></a>01529     }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531     stepx = (65536.0 * (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> - 1.0) / (newx - 1.0)) + 0.5;
<a name="l01532"></a>01532     stepy = (65536.0 * (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> - 1.0) / (newy - 1.0)) + 0.5;
<a name="l01533"></a>01533     ofsy = 32768;
<a name="l01534"></a>01534 
<a name="l01535"></a>01535     <span class="keywordflow">for</span> (y = newy; y &gt; 0; y--) {
<a name="l01536"></a>01536         <span class="keywordflow">if</span> (do_rect) {
<a name="l01537"></a>01537             rect = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l01538"></a>01538             rect += (ofsy &gt;&gt; 16) * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01539"></a>01539         }
<a name="l01540"></a>01540         <span class="keywordflow">if</span> (do_float) {
<a name="l01541"></a>01541             rectf = (<span class="keyword">struct </span><a class="code" href="../../db/d0a/structimbufRGBA.html">imbufRGBA</a> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l01542"></a>01542             rectf += (ofsy &gt;&gt; 16) * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01543"></a>01543         }
<a name="l01544"></a>01544         ofsy += stepy;
<a name="l01545"></a>01545         ofsx = 32768;
<a name="l01546"></a>01546         
<a name="l01547"></a>01547         <span class="keywordflow">if</span> (do_rect) {
<a name="l01548"></a>01548             <span class="keywordflow">for</span> (x = newx; x&gt;0; x--) {
<a name="l01549"></a>01549                 *newrect++ = rect[ofsx &gt;&gt; 16];
<a name="l01550"></a>01550                 ofsx += stepx;
<a name="l01551"></a>01551             }
<a name="l01552"></a>01552         }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554         <span class="keywordflow">if</span> (do_float) {
<a name="l01555"></a>01555             ofsx = 32768;
<a name="l01556"></a>01556             <span class="keywordflow">for</span> (x = newx; x&gt;0; x--) {
<a name="l01557"></a>01557                 *newrectf++ = rectf[ofsx &gt;&gt; 16];
<a name="l01558"></a>01558                 ofsx += stepx;
<a name="l01559"></a>01559             }
<a name="l01560"></a>01560         }
<a name="l01561"></a>01561     }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     <span class="keywordflow">if</span> (do_rect) {
<a name="l01564"></a>01564         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4660d436da5d4c67faacaf2fa2b9989e">imb_freerectImBuf</a>(ibuf);
<a name="l01565"></a>01565         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>;
<a name="l01566"></a>01566         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> = _newrect;
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568     
<a name="l01569"></a>01569     <span class="keywordflow">if</span> (do_float) {
<a name="l01570"></a>01570         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l01571"></a>01571         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ad147239b291e76fa3a1b21b9b773e942">mall</a> |= <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#acfab05c5428143166a6fdab0aba64ea0" title="Flag defining the components of the ImBuf struct.">IB_rectfloat</a>;
<a name="l01572"></a>01572         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> = (<span class="keywordtype">float</span> *)_newrectf;
<a name="l01573"></a>01573     }
<a name="l01574"></a>01574     
<a name="l01575"></a>01575     <a class="code" href="../../db/d79/scaling_8c.html#a07513af588c8ce7f770f6334a7de4e74">scalefast_Z_ImBuf</a>(ibuf, newx, newy);
<a name="l01576"></a>01576     
<a name="l01577"></a>01577     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> = newx;
<a name="l01578"></a>01578     ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> = newy;
<a name="l01579"></a>01579     <span class="keywordflow">return</span>(ibuf);
<a name="l01580"></a>01580 }
<a name="l01581"></a>01581 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:53 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

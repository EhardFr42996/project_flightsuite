<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: path_util.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">path_util.c</div>  </div>
</div>
<div class="contents">
<a href="../../db/dae/path__util_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * various string, file, list operations.</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d43/DNA__listBase_8h.html" title="These structs are the foundation for all linked lists in the library system.">DNA_listBase.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d63/BLI__fileops_8h.html" title="File and directory operations.">BLI_fileops.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dd9/BLI__path__util_8h.html">BLI_path_util.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db3/BLI__string_8h.html">BLI_string.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d83/BLI__string__utf8_8h.html">BLI_string_utf8.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/ddf/BKE__blender_8h.html" title="Blender util stuff.">BKE_blender.h</a>&quot;</span>    <span class="comment">// BLENDER_VERSION</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de1/GHOST__Path-api_8h.html">GHOST_Path-api.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#if defined WIN32 &amp;&amp; !defined _LIBC  || defined __sun</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;<a class="code" href="../../d0/dbc/BLI__fnmatch_8h.html">BLI_fnmatch.h</a>&quot;</span> <span class="comment">/* use fnmatch included in blenlib */</span>
<a name="l00057"></a>00057 <span class="preprocessor">#else</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#  ifndef _GNU_SOURCE</span>
<a name="l00059"></a><a class="code" href="../../db/dae/path__util_8c.html#a369266c24eacffb87046522897a570d5">00059</a> <span class="preprocessor"></span><span class="preprocessor">#    define _GNU_SOURCE</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;fnmatch.h&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#endif</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d5/d45/utf__winfunc_8h.html">utf_winfunc.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#  include &lt;io.h&gt;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#  ifdef _WIN32_IE</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#    undef _WIN32_IE</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#  define _WIN32_IE 0x0501</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;windows.h&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#  include &lt;shlobj.h&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#  include &quot;<a class="code" href="../../d9/ded/BLI__winstuff_8h.html" title="Compatibility-like things for windows.">BLI_winstuff.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#else </span><span class="comment">/* non windows */</span>
<a name="l00075"></a>00075 <span class="preprocessor">#  ifdef WITH_BINRELOC</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#    include &quot;binreloc.h&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#  endif</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* WIN32 */</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">/* standard paths */</span>
<a name="l00081"></a>00081 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#  define BLENDER_USER_FORMAT       &quot;%s\\Blender Foundation\\Blender\\%s&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#  define BLENDER_SYSTEM_FORMAT     &quot;%s\\Blender Foundation\\Blender\\%s&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#elif defined(__APPLE__)</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">#  define BLENDER_USER_FORMAT           &quot;%s/Blender/%s&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">#  define BLENDER_SYSTEM_FORMAT         &quot;%s/Blender/%s&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#else </span><span class="comment">/* UNIX */</span>
<a name="l00088"></a>00088 <span class="preprocessor">#  ifndef WITH_XDG_USER_DIRS </span><span class="comment">/* oldschool unix ~/.blender/ */</span>
<a name="l00089"></a><a class="code" href="../../db/dae/path__util_8c.html#aac9656feee74b3b9e415358022726074">00089</a> <span class="preprocessor">#    define BLENDER_USER_FORMAT         &quot;%s/.blender/%s&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">#  else </span><span class="comment">/* new XDG ~/blender/.config/ */</span>
<a name="l00091"></a>00091 <span class="preprocessor">#    define BLENDER_USER_FORMAT         &quot;%s/blender/%s&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#  endif // WITH_XDG_USER_DIRS</span>
<a name="l00093"></a><a class="code" href="../../db/dae/path__util_8c.html#a14de03d3290637cbccf633c3dd06ca46">00093</a> <span class="preprocessor"></span><span class="preprocessor">#  define BLENDER_SYSTEM_FORMAT         &quot;%s/blender/%s&quot;</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>
<a name="l00096"></a>00096 <span class="comment">/* local */</span>
<a name="l00097"></a><a class="code" href="../../db/dae/path__util_8c.html#abc46ebc660c246137ca013eb8f3a6042">00097</a> <span class="preprocessor">#define UNIQUE_NAME_MAX 128</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a><a class="code" href="../../db/dae/path__util_8c.html#a7edcb98ebb0717f55578f5e2c6ca1b3a">00099</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../db/dae/path__util_8c.html#a7edcb98ebb0717f55578f5e2c6ca1b3a">bprogname</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];    <span class="comment">/* path to program executable */</span>
<a name="l00100"></a><a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">00100</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">bprogdir</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];     <span class="comment">/* path in which executable is located */</span>
<a name="l00101"></a><a class="code" href="../../db/dae/path__util_8c.html#a98e40567bb9ae52181cabaaf6803a0a8">00101</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../db/dae/path__util_8c.html#a98e40567bb9ae52181cabaaf6803a0a8">btempdir</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];     <span class="comment">/* temporary directory */</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#ae2d7725f0ae39460acf3620efe5746f6">add_win32_extension</a>(<span class="keywordtype">char</span> *name);
<a name="l00104"></a>00104 <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/dae/path__util_8c.html#ab50361e4d90c8984731d87dd30bd2c19">blender_version_decimal</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> ver);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">/* implementation */</span>
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="../../db/dae/path__util_8c.html#acaab03593ac35ea13fd43ad049ad4d9c">00108</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad1455f1d2df23ea66d7b1bf46adff870">BLI_stringdec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>, <span class="keywordtype">char</span> *head, <span class="keywordtype">char</span> *tail, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *numlen)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, len2, lenlslash = 0, nums = 0, nume = 0;
<a name="l00111"></a>00111     <span class="keywordtype">short</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, found = 0;
<a name="l00112"></a>00112     <span class="keywordtype">char</span> *lslash = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(<span class="keywordtype">string</span>);
<a name="l00113"></a>00113     len2 = len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="keywordtype">string</span>);
<a name="l00114"></a>00114     <span class="keywordflow">if</span> (lslash)
<a name="l00115"></a>00115         lenlslash= (int)(lslash - <span class="keywordtype">string</span>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="keywordflow">while</span> (len &gt; lenlslash &amp;&amp; <span class="keywordtype">string</span>[--len] != <span class="charliteral">&#39;.&#39;</span>) {};
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (len == lenlslash &amp;&amp; <span class="keywordtype">string</span>[len] != <span class="charliteral">&#39;.&#39;</span>) len = len2;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="keywordflow">for</span> (i = len - 1; i &gt;= lenlslash; i--) {
<a name="l00121"></a>00121         <span class="keywordflow">if</span> (isdigit(<span class="keywordtype">string</span>[i])) {
<a name="l00122"></a>00122             <span class="keywordflow">if</span> (found) {
<a name="l00123"></a>00123                 nums = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00124"></a>00124             }
<a name="l00125"></a>00125             <span class="keywordflow">else</span> {
<a name="l00126"></a>00126                 nume = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00127"></a>00127                 nums = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00128"></a>00128                 found = 1;
<a name="l00129"></a>00129             }
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131         <span class="keywordflow">else</span> {
<a name="l00132"></a>00132             <span class="keywordflow">if</span> (found) <span class="keywordflow">break</span>;
<a name="l00133"></a>00133         }
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (found) {
<a name="l00136"></a>00136         <span class="keywordflow">if</span> (tail) strcpy(tail, &amp;<span class="keywordtype">string</span>[nume+1]);
<a name="l00137"></a>00137         <span class="keywordflow">if</span> (head) {
<a name="l00138"></a>00138             strcpy(head,<span class="keywordtype">string</span>);
<a name="l00139"></a>00139             head[nums]=0;
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (numlen) *numlen = nume-nums+1;
<a name="l00142"></a>00142         <span class="keywordflow">return</span> ((<span class="keywordtype">int</span>)atoi(&amp;(<span class="keywordtype">string</span>[nums])));
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (tail) strcpy(tail, <span class="keywordtype">string</span> + len);
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (head) {
<a name="l00146"></a>00146         strncpy(head, <span class="keywordtype">string</span>, len);
<a name="l00147"></a>00147         head[<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (numlen) *numlen=0;
<a name="l00150"></a>00150     <span class="keywordflow">return</span> 0;
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="../../db/dae/path__util_8c.html#a9cb5dd722995bcaf96c1fabef98be6bc">00154</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9cb5dd722995bcaf96c1fabef98be6bc">BLI_stringenc</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *head, <span class="keyword">const</span> <span class="keywordtype">char</span> *tail, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> numlen, <span class="keywordtype">int</span> pic)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <span class="keywordtype">char</span> fmtstr[16]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (pic &lt; 0) pic= 0;
<a name="l00158"></a>00158     sprintf(fmtstr, <span class="stringliteral">&quot;%%s%%.%dd%%s&quot;</span>, numlen);
<a name="l00159"></a>00159     sprintf(<span class="keywordtype">string</span>, fmtstr, head, pic, tail);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">/* Foo.001 -&gt; &quot;Foo&quot;, 1</span>
<a name="l00163"></a>00163 <span class="comment"> * Returns the length of &quot;Foo&quot; */</span>
<a name="l00164"></a><a class="code" href="../../db/dae/path__util_8c.html#ad663a2d737c722b9567f70fb488036ad">00164</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(<span class="keywordtype">char</span> *<a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>, <span class="keywordtype">int</span> *nr, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> delim)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166     <span class="keywordtype">int</span> a;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     *nr= 0;
<a name="l00169"></a>00169     a= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(name);
<a name="l00170"></a>00170     memcpy(left, name, (a + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (a&gt;1 &amp;&amp; name[a-1]==delim) <span class="keywordflow">return</span> a;
<a name="l00173"></a>00173     
<a name="l00174"></a>00174     <span class="keywordflow">while</span> (a--) {
<a name="l00175"></a>00175         <span class="keywordflow">if</span> ( name[a]==delim ) {
<a name="l00176"></a>00176             left[a]= 0;
<a name="l00177"></a>00177             *nr= atol(name+a+1);
<a name="l00178"></a>00178             <span class="comment">/* casting down to an int, can overflow for large numbers */</span>
<a name="l00179"></a>00179             <span class="keywordflow">if</span> (*nr &lt; 0)
<a name="l00180"></a>00180                 *nr= 0;
<a name="l00181"></a>00181             <span class="keywordflow">return</span> a;
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         <span class="keywordflow">if</span> ( isdigit(name[a])==0 ) <span class="keywordflow">break</span>;
<a name="l00184"></a>00184         
<a name="l00185"></a>00185         left[a]= 0;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordflow">for</span> (a= 0; name[a]; a++)
<a name="l00189"></a>00189         left[a]= name[a];
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="keywordflow">return</span> a;
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="../../db/dae/path__util_8c.html#a717769604e1e8805086b2f60e2e8fe2d">00194</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a717769604e1e8805086b2f60e2e8fe2d">BLI_newname</a>(<span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keywordtype">char</span> head[<a class="code" href="../../db/dae/path__util_8c.html#abc46ebc660c246137ca013eb8f3a6042">UNIQUE_NAME_MAX</a>], tail[<a class="code" href="../../db/dae/path__util_8c.html#abc46ebc660c246137ca013eb8f3a6042">UNIQUE_NAME_MAX</a>];
<a name="l00197"></a>00197     <span class="keywordtype">int</span> pic;
<a name="l00198"></a>00198     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> digits;
<a name="l00199"></a>00199     
<a name="l00200"></a>00200     pic = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad1455f1d2df23ea66d7b1bf46adff870">BLI_stringdec</a>(name, head, tail, &amp;digits);
<a name="l00201"></a>00201     
<a name="l00202"></a>00202     <span class="comment">/* are we going from 100 -&gt; 99 or from 10 -&gt; 9 */</span>
<a name="l00203"></a>00203     <span class="keywordflow">if</span> (add &lt; 0 &amp;&amp; digits &lt; 4 &amp;&amp; digits &gt; 0) {
<a name="l00204"></a>00204         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../d0/dbc/namespaceKDL.html#a82c1904677c13464d30566d25edc9034">exp</a>;
<a name="l00205"></a>00205         exp = 1;
<a name="l00206"></a>00206         <span class="keywordflow">for</span> (i = digits; i &gt; 1; i--) exp *= 10;
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (pic &gt;= exp &amp;&amp; (pic + add) &lt; exp) digits--;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209     
<a name="l00210"></a>00210     pic += <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>;
<a name="l00211"></a>00211     
<a name="l00212"></a>00212     <span class="keywordflow">if</span> (digits==4 &amp;&amp; pic&lt;0) pic= 0;
<a name="l00213"></a>00213     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9cb5dd722995bcaf96c1fabef98be6bc">BLI_stringenc</a>(name, head, tail, digits, pic);
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="../../db/dae/path__util_8c.html#a55d85aa9be3dcae052659d317bdc962b">00218</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a55d85aa9be3dcae052659d317bdc962b">BLI_uniquename_cb</a>(<span class="keywordtype">int</span> (*unique_check)(<span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *), <span class="keywordtype">void</span> *arg, <span class="keyword">const</span> <span class="keywordtype">char</span> defname[], <span class="keywordtype">char</span> delim, <span class="keywordtype">char</span> *name, <span class="keywordtype">short</span> name_len)
<a name="l00219"></a>00219 {
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (name[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l00221"></a>00221         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(name, defname, name_len);
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (unique_check(arg, name)) {
<a name="l00225"></a>00225         <span class="keywordtype">char</span>    numstr[16];
<a name="l00226"></a>00226         <span class="keywordtype">char</span>    tempname[<a class="code" href="../../db/dae/path__util_8c.html#abc46ebc660c246137ca013eb8f3a6042">UNIQUE_NAME_MAX</a>];
<a name="l00227"></a>00227         <span class="keywordtype">char</span>    <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>[<a class="code" href="../../db/dae/path__util_8c.html#abc46ebc660c246137ca013eb8f3a6042">UNIQUE_NAME_MAX</a>];
<a name="l00228"></a>00228         <span class="keywordtype">int</span>     number;
<a name="l00229"></a>00229         <span class="keywordtype">int</span>     <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(left, &amp;number, name, delim);
<a name="l00230"></a>00230         <span class="keywordflow">do</span> {
<a name="l00231"></a>00231             <span class="keywordtype">int</span> numlen= <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(numstr, <span class="keyword">sizeof</span>(numstr), <span class="stringliteral">&quot;%c%03d&quot;</span>, delim, ++number);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233             <span class="comment">/* highly unlikely the string only has enough room for the number</span>
<a name="l00234"></a>00234 <span class="comment">             * but support anyway */</span>
<a name="l00235"></a>00235             <span class="keywordflow">if</span> ((len == 0) || (numlen &gt;= name_len)) {
<a name="l00236"></a>00236                 <span class="comment">/* number is know not to be utf-8 */</span>
<a name="l00237"></a>00237                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(tempname, numstr, name_len);
<a name="l00238"></a>00238             }
<a name="l00239"></a>00239             <span class="keywordflow">else</span> {
<a name="l00240"></a>00240                 <span class="keywordtype">char</span> *tempname_buf;
<a name="l00241"></a>00241                 tempname[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00242"></a>00242                 tempname_buf = <a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#aa2bf9fb4c3ddb6f55934ad7a18b7e8e8">BLI_strncat_utf8</a>(tempname, left, name_len - numlen);
<a name="l00243"></a>00243                 memcpy(tempname_buf, numstr, numlen + 1);
<a name="l00244"></a>00244             }
<a name="l00245"></a>00245         } <span class="keywordflow">while</span> (unique_check(arg, tempname));
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(name, tempname, name_len);
<a name="l00248"></a>00248         
<a name="l00249"></a>00249         <span class="keywordflow">return</span> 1;
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251     
<a name="l00252"></a>00252     <span class="keywordflow">return</span> 0;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">/* little helper macro for BLI_uniquename */</span>
<a name="l00256"></a>00256 <span class="preprocessor">#ifndef GIVE_STRADDR</span>
<a name="l00257"></a><a class="code" href="../../db/dae/path__util_8c.html#a28d29bd4fd2904731659242346398ae7">00257</a> <span class="preprocessor"></span><span class="preprocessor">    #define GIVE_STRADDR(data, offset) ( ((char *)data) + offset )</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>
<a name="l00260"></a>00260 <span class="comment">/* Generic function to set a unique name. It is only designed to be used in situations</span>
<a name="l00261"></a>00261 <span class="comment"> * where the name is part of the struct, and also that the name is at most UNIQUE_NAME_MAX chars long.</span>
<a name="l00262"></a>00262 <span class="comment"> * </span>
<a name="l00263"></a>00263 <span class="comment"> * For places where this is used, see constraint.c for example...</span>
<a name="l00264"></a>00264 <span class="comment"> *</span>
<a name="l00265"></a>00265 <span class="comment"> *  name_offs: should be calculated using offsetof(structname, membername) macro from stddef.h</span>
<a name="l00266"></a>00266 <span class="comment"> *  len: maximum length of string (to prevent overflows, etc.)</span>
<a name="l00267"></a>00267 <span class="comment"> *  defname: the name that should be used by default if none is specified already</span>
<a name="l00268"></a>00268 <span class="comment"> *  delim: the character which acts as a delimiter between parts of the name</span>
<a name="l00269"></a>00269 <span class="comment"> */</span>
<a name="l00270"></a><a class="code" href="../../db/dae/path__util_8c.html#a0702943f025fb07580c9d1d295b70eab">00270</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a0702943f025fb07580c9d1d295b70eab">uniquename_find_dupe</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list, <span class="keywordtype">void</span> *vlink, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">short</span> name_offs)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <a class="code" href="../../df/d0c/structLink.html">Link</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keywordflow">for</span> (link = list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>) {
<a name="l00275"></a>00275         <span class="keywordflow">if</span> (link != vlink) {
<a name="l00276"></a>00276             <span class="keywordflow">if</span> (!strcmp(<a class="code" href="../../db/dae/path__util_8c.html#a28d29bd4fd2904731659242346398ae7">GIVE_STRADDR</a>(link, name_offs), name)) {
<a name="l00277"></a>00277                 <span class="keywordflow">return</span> 1;
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="keywordflow">return</span> 0;
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="../../db/dae/path__util_8c.html#a49b219aaeb76f281fe0d6dc1a8f99699">00285</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a49b219aaeb76f281fe0d6dc1a8f99699">uniquename_unique_check</a>(<span class="keywordtype">void</span> *arg, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287     <span class="keyword">struct </span>{<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb; <span class="keywordtype">void</span> *vlink; <span class="keywordtype">short</span> name_offs;} *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= arg;
<a name="l00288"></a>00288     <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a0702943f025fb07580c9d1d295b70eab">uniquename_find_dupe</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;lb, <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;vlink, name, <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;name_offs);
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="../../db/dae/path__util_8c.html#a51cdfd28b3e17614ce7fa828c5e92930">00291</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a584e08e337965c8bb232cf7ff28a0e13">BLI_uniquename</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list, <span class="keywordtype">void</span> *vlink, <span class="keyword">const</span> <span class="keywordtype">char</span> defname[], <span class="keywordtype">char</span> delim, <span class="keywordtype">short</span> name_offs, <span class="keywordtype">short</span> name_len)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <span class="keyword">struct </span>{<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb; <span class="keywordtype">void</span> *vlink; <span class="keywordtype">short</span> name_offs;} <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l00294"></a>00294     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.lb= list;
<a name="l00295"></a>00295     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.vlink= vlink;
<a name="l00296"></a>00296     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.name_offs= name_offs;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>((name_len &gt; 1) &amp;&amp; (name_len &lt;= <a class="code" href="../../db/dae/path__util_8c.html#abc46ebc660c246137ca013eb8f3a6042">UNIQUE_NAME_MAX</a>));
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">/* See if we are given an empty string */</span>
<a name="l00301"></a>00301     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, vlink, defname))
<a name="l00302"></a>00302         <span class="keywordflow">return</span>;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a55d85aa9be3dcae052659d317bdc962b">BLI_uniquename_cb</a>(<a class="code" href="../../db/dae/path__util_8c.html#a49b219aaeb76f281fe0d6dc1a8f99699">uniquename_unique_check</a>, &amp;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, defname, delim, <a class="code" href="../../db/dae/path__util_8c.html#a28d29bd4fd2904731659242346398ae7">GIVE_STRADDR</a>(vlink, name_offs), name_len);
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="comment">/* ******************** string encoding ***************** */</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="comment">/* This is quite an ugly function... its purpose is to</span>
<a name="l00312"></a>00312 <span class="comment"> * take the dir name, make it absolute, and clean it up, replacing</span>
<a name="l00313"></a>00313 <span class="comment"> * excess file entry stuff (like /tmp/../tmp/../)</span>
<a name="l00314"></a>00314 <span class="comment"> * note that dir isn&#39;t protected for max string names... </span>
<a name="l00315"></a>00315 <span class="comment"> * </span>
<a name="l00316"></a>00316 <span class="comment"> * If relbase is NULL then its ignored</span>
<a name="l00317"></a>00317 <span class="comment"> */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="../../db/dae/path__util_8c.html#a832a55b87c848fbe44df52a9cd789a83">00319</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *relabase, <span class="keywordtype">char</span> *dir)
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     ptrdiff_t a;
<a name="l00322"></a>00322     <span class="keywordtype">char</span> *start, *eind;
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (relabase) {
<a name="l00324"></a>00324         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(dir, relabase);
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <span class="keywordflow">else</span> {
<a name="l00327"></a>00327         <span class="keywordflow">if</span> (dir[0]==<span class="charliteral">&#39;/&#39;</span> &amp;&amp; dir[1]==<span class="charliteral">&#39;/&#39;</span>) {
<a name="l00328"></a>00328             <span class="keywordflow">if</span> (dir[2]== <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l00329"></a>00329                 <span class="keywordflow">return</span>; <span class="comment">/* path is &quot;//&quot; - cant clean it */</span>
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331             dir = dir+2; <span class="comment">/* skip the first // */</span>
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     
<a name="l00335"></a>00335     <span class="comment">/* Note</span>
<a name="l00336"></a>00336 <span class="comment">     *   memmove(start, eind, strlen(eind) + 1);</span>
<a name="l00337"></a>00337 <span class="comment">     * is the same as</span>
<a name="l00338"></a>00338 <span class="comment">     *   strcpy( start, eind ); </span>
<a name="l00339"></a>00339 <span class="comment">     * except strcpy should not be used because there is overlap,</span>
<a name="l00340"></a>00340 <span class="comment">     * so use memmove&#39;s slightly more obscure syntax - Campbell</span>
<a name="l00341"></a>00341 <span class="comment">     */</span>
<a name="l00342"></a>00342     
<a name="l00343"></a>00343 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>    
<a name="l00345"></a>00345     <span class="comment">/* Note, this should really be moved to the file selector,</span>
<a name="l00346"></a>00346 <span class="comment">     * since this function is used in many areas */</span>
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (strcmp(dir, <span class="stringliteral">&quot;.&quot;</span>)==0) {  <span class="comment">/* happens for example in FILE_MAIN */</span>
<a name="l00348"></a>00348         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa17eb556eb4f390c64a7cdc7d1ae2b70">get_default_root</a>(dir);
<a name="l00349"></a>00349         <span class="keywordflow">return</span>;
<a name="l00350"></a>00350     }   
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="keywordflow">while</span> ( (start = strstr(dir, <span class="stringliteral">&quot;\\..\\&quot;</span>)) ) {
<a name="l00353"></a>00353         eind = start + <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="stringliteral">&quot;\\..\\&quot;</span>) - 1;
<a name="l00354"></a>00354         a = start-dir-1;
<a name="l00355"></a>00355         <span class="keywordflow">while</span> (a&gt;0) {
<a name="l00356"></a>00356             <span class="keywordflow">if</span> (dir[a] == <span class="charliteral">&#39;\\&#39;</span>) <span class="keywordflow">break</span>;
<a name="l00357"></a>00357             a--;
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359         <span class="keywordflow">if</span> (a&lt;0) {
<a name="l00360"></a>00360             <span class="keywordflow">break</span>;
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         <span class="keywordflow">else</span> {
<a name="l00363"></a>00363             memmove(dir + a, eind, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(eind) + 1);
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">while</span> ( (start = strstr(dir,<span class="stringliteral">&quot;\\.\\&quot;</span>)) ) {
<a name="l00368"></a>00368         eind = start + <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="stringliteral">&quot;\\.\\&quot;</span>) - 1;
<a name="l00369"></a>00369         memmove(start, eind, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(eind) + 1);
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keywordflow">while</span> ( (start = strstr(dir,<span class="stringliteral">&quot;\\\\&quot;</span> )) ) {
<a name="l00373"></a>00373         eind = start + <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="stringliteral">&quot;\\\\&quot;</span>) - 1;
<a name="l00374"></a>00374         memmove(start, eind, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(eind) + 1);
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376 <span class="preprocessor">#else</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (dir[0]==<span class="charliteral">&#39;.&#39;</span>) {  <span class="comment">/* happens, for example in FILE_MAIN */</span>
<a name="l00378"></a>00378         dir[0]= <span class="charliteral">&#39;/&#39;</span>;
<a name="l00379"></a>00379         dir[1]= 0;
<a name="l00380"></a>00380         <span class="keywordflow">return</span>;
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">/* support for odd paths: eg /../home/me --&gt; /home/me</span>
<a name="l00384"></a>00384 <span class="comment">     * this is a valid path in blender but we cant handle this the usual way below</span>
<a name="l00385"></a>00385 <span class="comment">     * simply strip this prefix then evaluate the path as usual. pythons os.path.normpath() does this */</span>
<a name="l00386"></a>00386     <span class="keywordflow">while</span> ((strncmp(dir, <span class="stringliteral">&quot;/../&quot;</span>, 4)==0)) {
<a name="l00387"></a>00387         memmove(dir, dir + 4, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(dir + 4) + 1);
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <span class="keywordflow">while</span> ( (start = strstr(dir, <span class="stringliteral">&quot;/../&quot;</span>)) ) {
<a name="l00391"></a>00391         eind = start + (4 - 1) <span class="comment">/* strlen(&quot;/../&quot;) - 1 */</span>;
<a name="l00392"></a>00392         a = start-dir-1;
<a name="l00393"></a>00393         <span class="keywordflow">while</span> (a&gt;0) {
<a name="l00394"></a>00394             <span class="keywordflow">if</span> (dir[a] == <span class="charliteral">&#39;/&#39;</span>) <span class="keywordflow">break</span>;
<a name="l00395"></a>00395             a--;
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397         <span class="keywordflow">if</span> (a&lt;0) {
<a name="l00398"></a>00398             <span class="keywordflow">break</span>;
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400         <span class="keywordflow">else</span> {
<a name="l00401"></a>00401             memmove(dir+a, eind, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(eind) + 1);
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">while</span> ( (start = strstr(dir,<span class="stringliteral">&quot;/./&quot;</span>)) ) {
<a name="l00406"></a>00406         eind = start + (3 - 1) <span class="comment">/* strlen(&quot;/./&quot;) - 1 */</span>;
<a name="l00407"></a>00407         memmove(start, eind, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(eind) + 1);
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keywordflow">while</span> ( (start = strstr(dir,<span class="stringliteral">&quot;//&quot;</span> )) ) {
<a name="l00411"></a>00411         eind = start + (2 - 1) <span class="comment">/* strlen(&quot;//&quot;) - 1 */</span>;
<a name="l00412"></a>00412         memmove(start, eind, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(eind) + 1);
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 <span class="preprocessor">#endif</span>
<a name="l00415"></a>00415 <span class="preprocessor"></span>}
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="../../db/dae/path__util_8c.html#a7fcb2651a621a0b5e761fbe2a6add270">00417</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a7fcb2651a621a0b5e761fbe2a6add270">BLI_cleanup_dir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *relabase, <span class="keywordtype">char</span> *dir)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(relabase, dir);
<a name="l00420"></a>00420     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab80bd3eb1d5a53807b777f4912b34cd9">BLI_add_slash</a>(dir);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="../../db/dae/path__util_8c.html#a713a444e8676ca0660db4acd57329eac">00424</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a713a444e8676ca0660db4acd57329eac">BLI_cleanup_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *relabase, <span class="keywordtype">char</span> *dir)
<a name="l00425"></a>00425 {
<a name="l00426"></a>00426     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(relabase, dir);
<a name="l00427"></a>00427     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a204b2fde5671546457feea1dd2a78a28">BLI_del_slash</a>(dir);
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a><a class="code" href="../../db/dae/path__util_8c.html#a885e6044163b103a6c8e811d17286bb6">00430</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a885e6044163b103a6c8e811d17286bb6">BLI_path_rel</a>(<span class="keywordtype">char</span> *file, <span class="keyword">const</span> <span class="keywordtype">char</span> *relfile)
<a name="l00431"></a>00431 {
<a name="l00432"></a>00432     <span class="keywordtype">char</span> * lslash;
<a name="l00433"></a>00433     <span class="keywordtype">char</span> temp[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00434"></a>00434     <span class="keywordtype">char</span> res[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00435"></a>00435     
<a name="l00436"></a>00436     <span class="comment">/* if file is already relative, bail out */</span>
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (file[0]==<span class="charliteral">&#39;/&#39;</span> &amp;&amp; file[1]==<span class="charliteral">&#39;/&#39;</span>) <span class="keywordflow">return</span>;
<a name="l00438"></a>00438     
<a name="l00439"></a>00439     <span class="comment">/* also bail out if relative path is not set */</span>
<a name="l00440"></a>00440     <span class="keywordflow">if</span> (relfile[0] == 0) <span class="keywordflow">return</span>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d3/db3/BLI__string_8h.html#a4657f9ca919c8124abd611331344d5eb">BLI_strnlen</a>(relfile, 3) &gt; 2 &amp;&amp; relfile[1] != <span class="charliteral">&#39;:&#39;</span>) {
<a name="l00444"></a>00444         <span class="keywordtype">char</span>* ptemp;
<a name="l00445"></a>00445         <span class="comment">/* fix missing volume name in relative base,</span>
<a name="l00446"></a>00446 <span class="comment">         * can happen with old recent-files.txt files */</span>
<a name="l00447"></a>00447         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa17eb556eb4f390c64a7cdc7d1ae2b70">get_default_root</a>(temp);
<a name="l00448"></a>00448         ptemp = &amp;temp[2];
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (relfile[0] != <span class="charliteral">&#39;\\&#39;</span> &amp;&amp; relfile[0] != <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00450"></a>00450             ptemp++;
<a name="l00451"></a>00451         }
<a name="l00452"></a>00452         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ptemp, relfile, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>-3);
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <span class="keywordflow">else</span> {
<a name="l00455"></a>00455         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(temp, relfile, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (<a class="code" href="../../d3/db3/BLI__string_8h.html#a4657f9ca919c8124abd611331344d5eb">BLI_strnlen</a>(file, 3) &gt; 2) {
<a name="l00459"></a>00459         <span class="keywordflow">if</span> ( temp[1] == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; file[1] == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; temp[0] != file[0] )
<a name="l00460"></a>00460             <span class="keywordflow">return</span>;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 <span class="preprocessor">#else</span>
<a name="l00463"></a>00463 <span class="preprocessor"></span>    <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(temp, relfile, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00464"></a>00464 <span class="preprocessor">#endif</span>
<a name="l00465"></a>00465 <span class="preprocessor"></span>
<a name="l00466"></a>00466     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(temp, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l00467"></a>00467     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(file, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l00468"></a>00468     
<a name="l00469"></a>00469     <span class="comment">/* remove /./ which confuse the following slash counting... */</span>
<a name="l00470"></a>00470     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, file);
<a name="l00471"></a>00471     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, temp);
<a name="l00472"></a>00472     
<a name="l00473"></a>00473     <span class="comment">/* the last slash in the file indicates where the path part ends */</span>
<a name="l00474"></a>00474     lslash = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(temp);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keywordflow">if</span> (lslash) {
<a name="l00477"></a>00477         <span class="comment">/* find the prefix of the filename that is equal for both filenames.</span>
<a name="l00478"></a>00478 <span class="comment">         * This is replaced by the two slashes at the beginning */</span>
<a name="l00479"></a>00479         <span class="keywordtype">char</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>= temp;
<a name="l00480"></a>00480         <span class="keywordtype">char</span> *q= file;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>        <span class="keywordflow">while</span> (tolower(*p) == tolower(*q))
<a name="l00484"></a>00484 <span class="preprocessor">#else</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span>        <span class="keywordflow">while</span> (*p == *q)
<a name="l00486"></a>00486 <span class="preprocessor">#endif</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>        {
<a name="l00488"></a>00488             ++<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>; ++q;
<a name="l00489"></a>00489             <span class="comment">/* don&#39;t search beyond the end of the string</span>
<a name="l00490"></a>00490 <span class="comment">             * in the rare case they match */</span>
<a name="l00491"></a>00491             <span class="keywordflow">if</span> ((*p==<span class="charliteral">&#39;\0&#39;</span>) || (*q==<span class="charliteral">&#39;\0&#39;</span>)) {
<a name="l00492"></a>00492                 <span class="keywordflow">break</span>;
<a name="l00493"></a>00493             }
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="comment">/* we might have passed the slash when the beginning of a dir matches </span>
<a name="l00497"></a>00497 <span class="comment">         * so we rewind. Only check on the actual filename</span>
<a name="l00498"></a>00498 <span class="comment">         */</span>
<a name="l00499"></a>00499         <span class="keywordflow">if</span> (*q != <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00500"></a>00500             <span class="keywordflow">while</span> ( (q &gt;= file) &amp;&amp; (*q != <span class="charliteral">&#39;/&#39;</span>) ) { --q; --<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>; }
<a name="l00501"></a>00501         } 
<a name="l00502"></a>00502         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00503"></a>00503             <span class="keywordflow">while</span> ( (p &gt;= temp) &amp;&amp; (*p != <span class="charliteral">&#39;/&#39;</span>) ) { --<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>; --q; }
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505         
<a name="l00506"></a>00506         strcpy(res, <span class="stringliteral">&quot;//&quot;</span>);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="comment">/* p now points to the slash that is at the beginning of the part</span>
<a name="l00509"></a>00509 <span class="comment">         * where the path is different from the relative path. </span>
<a name="l00510"></a>00510 <span class="comment">         * We count the number of directories we need to go up in the</span>
<a name="l00511"></a>00511 <span class="comment">         * hierarchy to arrive at the common &#39;prefix&#39; of the path</span>
<a name="l00512"></a>00512 <span class="comment">         */</span>
<a name="l00513"></a>00513         <span class="keywordflow">while</span> (p &amp;&amp; p &lt; lslash) {
<a name="l00514"></a>00514             <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;/&#39;</span>) 
<a name="l00515"></a>00515                 strcat(res, <span class="stringliteral">&quot;../&quot;</span>);
<a name="l00516"></a>00516             ++<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00517"></a>00517         }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         strcat(res, q+1); <span class="comment">/* don&#39;t copy the slash at the beginning */</span>
<a name="l00520"></a>00520         
<a name="l00521"></a>00521 <span class="preprocessor">#ifdef  WIN32</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span>        <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(res+2, <span class="charliteral">&#39;/&#39;</span>, <span class="charliteral">&#39;\\&#39;</span>);
<a name="l00523"></a>00523 <span class="preprocessor">#endif</span>
<a name="l00524"></a>00524 <span class="preprocessor"></span>        strcpy(file, res);
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="../../db/dae/path__util_8c.html#a2bd669ec2a93ce9b453b83a179b8002c">00528</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a2bd669ec2a93ce9b453b83a179b8002c">BLI_has_parent</a>(<span class="keywordtype">char</span> *path)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00531"></a>00531     <span class="keywordtype">int</span> slashes = 0;
<a name="l00532"></a>00532     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ac5cc14a14ce0088944f22aae8baf8083">BLI_clean</a>(path);
<a name="l00533"></a>00533     len = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab80bd3eb1d5a53807b777f4912b34cd9">BLI_add_slash</a>(path) - 1;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keywordflow">while</span> (len&gt;=0) {
<a name="l00536"></a>00536         <span class="keywordflow">if</span> ((path[len] == <span class="charliteral">&#39;\\&#39;</span>) || (path[len] == <span class="charliteral">&#39;/&#39;</span>))
<a name="l00537"></a>00537             slashes++;
<a name="l00538"></a>00538         len--;
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540     <span class="keywordflow">return</span> slashes &gt; 1;
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a><a class="code" href="../../db/dae/path__util_8c.html#a286d1c9a8dd8e3d947274afa9c4fba9e">00543</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a286d1c9a8dd8e3d947274afa9c4fba9e">BLI_parent_dir</a>(<span class="keywordtype">char</span> *path)
<a name="l00544"></a>00544 {
<a name="l00545"></a>00545     <span class="keyword">static</span> <span class="keywordtype">char</span> parent_dir[]= {<span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;.&#39;</span>, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>, <span class="charliteral">&#39;\0&#39;</span>}; <span class="comment">/* &quot;../&quot; or &quot;..\\&quot; */</span>
<a name="l00546"></a>00546     <span class="keywordtype">char</span> tmp[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>+4];
<a name="l00547"></a>00547     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(tmp, path, <span class="keyword">sizeof</span>(tmp)-4);
<a name="l00548"></a>00548     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab80bd3eb1d5a53807b777f4912b34cd9">BLI_add_slash</a>(tmp);
<a name="l00549"></a>00549     strcat(tmp, parent_dir);
<a name="l00550"></a>00550     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a7fcb2651a621a0b5e761fbe2a6add270">BLI_cleanup_dir</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, tmp);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a91f9e9d5868a3b3e5756809d6cae1a75">BLI_testextensie</a>(tmp, parent_dir)) {
<a name="l00553"></a>00553         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, tmp, <span class="keyword">sizeof</span>(tmp));    
<a name="l00554"></a>00554         <span class="keywordflow">return</span> 1;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">else</span> {
<a name="l00557"></a>00557         <span class="keywordflow">return</span> 0;
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="../../db/dae/path__util_8c.html#aadae86cadaee7cec69cf09709f145f8b">00561</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#aadae86cadaee7cec69cf09709f145f8b">stringframe_chars</a>(<span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> *char_start, <span class="keywordtype">int</span> *char_end)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563     <span class="keywordtype">int</span> ch_sta, ch_end, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00564"></a>00564     <span class="comment">/* Insert current frame: file### -&gt; file001 */</span>
<a name="l00565"></a>00565     ch_sta = ch_end = 0;
<a name="l00566"></a>00566     <span class="keywordflow">for</span> (i = 0; path[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] != <span class="charliteral">&#39;\0&#39;</span>; i++) {
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (path[i] == <span class="charliteral">&#39;\\&#39;</span> || path[i] == <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00568"></a>00568             ch_end = 0; <span class="comment">/* this is a directory name, don&#39;t use any hashes we found */</span>
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (path[i] == <span class="charliteral">&#39;#&#39;</span>) {
<a name="l00571"></a>00571             ch_sta = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00572"></a>00572             ch_end = ch_sta+1;
<a name="l00573"></a>00573             <span class="keywordflow">while</span> (path[ch_end] == <span class="charliteral">&#39;#&#39;</span>) {
<a name="l00574"></a>00574                 ch_end++;
<a name="l00575"></a>00575             }
<a name="l00576"></a>00576             i = ch_end-1; <span class="comment">/* keep searching */</span>
<a name="l00577"></a>00577             
<a name="l00578"></a>00578             <span class="comment">/* don&#39;t break, there may be a slash after this that invalidates the previous #&#39;s */</span>
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582     <span class="keywordflow">if</span> (ch_end) {
<a name="l00583"></a>00583         *char_start= ch_sta;
<a name="l00584"></a>00584         *char_end= ch_end;
<a name="l00585"></a>00585         <span class="keywordflow">return</span> 1;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587     <span class="keywordflow">else</span> {
<a name="l00588"></a>00588         *char_start= -1;
<a name="l00589"></a>00589         *char_end= -1;
<a name="l00590"></a>00590         <span class="keywordflow">return</span> 0;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a><a class="code" href="../../db/dae/path__util_8c.html#ab1a2172c6f2ad6002935e0f1c4efa10a">00594</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/dae/path__util_8c.html#ab1a2172c6f2ad6002935e0f1c4efa10a">ensure_digits</a>(<span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> digits)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596     <span class="keywordtype">char</span> *file= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(path);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (file==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00599"></a>00599         file= path;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (strrchr(file, <span class="charliteral">&#39;#&#39;</span>) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00602"></a>00602         <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(file);
<a name="l00603"></a>00603 
<a name="l00604"></a>00604         <span class="keywordflow">while</span> (digits--) {
<a name="l00605"></a>00605             file[len++]= <span class="charliteral">&#39;#&#39;</span>;
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607         file[<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a><a class="code" href="../../db/dae/path__util_8c.html#a57e90c5ab9a8c42672bb881833b4bde0">00611</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a57e90c5ab9a8c42672bb881833b4bde0">BLI_path_frame</a>(<span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> frame, <span class="keywordtype">int</span> digits)
<a name="l00612"></a>00612 {
<a name="l00613"></a>00613     <span class="keywordtype">int</span> ch_sta, ch_end;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keywordflow">if</span> (digits)
<a name="l00616"></a>00616         <a class="code" href="../../db/dae/path__util_8c.html#ab1a2172c6f2ad6002935e0f1c4efa10a">ensure_digits</a>(path, digits);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#aadae86cadaee7cec69cf09709f145f8b">stringframe_chars</a>(path, &amp;ch_sta, &amp;ch_end)) { <span class="comment">/* warning, ch_end is the last # +1 */</span>
<a name="l00619"></a>00619         <span class="keywordtype">char</span> tmp[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00620"></a>00620         sprintf(tmp, <span class="stringliteral">&quot;%.*s%.*d%s&quot;</span>, ch_sta, path, ch_end-ch_sta, frame, path+ch_end);
<a name="l00621"></a>00621         strcpy(path, tmp);
<a name="l00622"></a>00622         <span class="keywordflow">return</span> 1;
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624     <span class="keywordflow">return</span> 0;
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a><a class="code" href="../../db/dae/path__util_8c.html#acf99a9639ead04586a847f03b9543bdb">00627</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#acf99a9639ead04586a847f03b9543bdb">BLI_path_frame_range</a>(<span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> sta, <span class="keywordtype">int</span> end, <span class="keywordtype">int</span> digits)
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629     <span class="keywordtype">int</span> ch_sta, ch_end;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (digits)
<a name="l00632"></a>00632         <a class="code" href="../../db/dae/path__util_8c.html#ab1a2172c6f2ad6002935e0f1c4efa10a">ensure_digits</a>(path, digits);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#aadae86cadaee7cec69cf09709f145f8b">stringframe_chars</a>(path, &amp;ch_sta, &amp;ch_end)) { <span class="comment">/* warning, ch_end is the last # +1 */</span>
<a name="l00635"></a>00635         <span class="keywordtype">char</span> tmp[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00636"></a>00636         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(tmp, <span class="keyword">sizeof</span>(tmp),
<a name="l00637"></a>00637                      <span class="stringliteral">&quot;%.*s%.*d-%.*d%s&quot;</span>,
<a name="l00638"></a>00638                      ch_sta, path, ch_end-ch_sta, sta, ch_end-ch_sta, end, path+ch_end);
<a name="l00639"></a>00639         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, tmp, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00640"></a>00640         <span class="keywordflow">return</span> 1;
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642     <span class="keywordflow">return</span> 0;
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="../../db/dae/path__util_8c.html#a779fd31715eb05e3322500e3426b03a2">00645</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(<span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *basepath)
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647     <span class="keywordtype">int</span> wasrelative = (strncmp(path, <span class="stringliteral">&quot;//&quot;</span>, 2)==0);
<a name="l00648"></a>00648     <span class="keywordtype">char</span> tmp[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00649"></a>00649     <span class="keywordtype">char</span> base[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00650"></a>00650 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>    <span class="keywordtype">char</span> vol[3] = {<span class="charliteral">&#39;\0&#39;</span>, <span class="charliteral">&#39;\0&#39;</span>, <span class="charliteral">&#39;\0&#39;</span>};
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(vol, path, 3);
<a name="l00654"></a>00654     <span class="comment">/* we are checking here if we have an absolute path that is not in the current</span>
<a name="l00655"></a>00655 <span class="comment">     * blend file as a lib main - we are basically checking for the case that a </span>
<a name="l00656"></a>00656 <span class="comment">     * UNIX root &#39;/&#39; is passed.</span>
<a name="l00657"></a>00657 <span class="comment">     */</span>
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (!wasrelative &amp;&amp; (vol[1] != <span class="charliteral">&#39;:&#39;</span> &amp;&amp; (vol[0] == <span class="charliteral">&#39;\0&#39;</span> || vol[0] == <span class="charliteral">&#39;/&#39;</span> || vol[0] == <span class="charliteral">&#39;\\&#39;</span>))) {
<a name="l00659"></a>00659         <span class="keywordtype">char</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = path;
<a name="l00660"></a>00660         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa17eb556eb4f390c64a7cdc7d1ae2b70">get_default_root</a>(tmp);
<a name="l00661"></a>00661         <span class="comment">// get rid of the slashes at the beginning of the path</span>
<a name="l00662"></a>00662         <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39;\\&#39;</span> || *p == <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00663"></a>00663             p++;
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665         strcat(tmp, p);
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667     <span class="keywordflow">else</span> {
<a name="l00668"></a>00668         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(tmp, path, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670 <span class="preprocessor">#else</span>
<a name="l00671"></a>00671 <span class="preprocessor"></span>    <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(tmp, path, <span class="keyword">sizeof</span>(tmp));
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     <span class="comment">/* Check for loading a windows path on a posix system</span>
<a name="l00674"></a>00674 <span class="comment">     * in this case, there is no use in trying C:/ since it </span>
<a name="l00675"></a>00675 <span class="comment">     * will never exist on a unix os.</span>
<a name="l00676"></a>00676 <span class="comment">     * </span>
<a name="l00677"></a>00677 <span class="comment">     * Add a / prefix and lowercase the driveletter, remove the :</span>
<a name="l00678"></a>00678 <span class="comment">     * C:\foo.JPG -&gt; /c/foo.JPG */</span>
<a name="l00679"></a>00679     
<a name="l00680"></a>00680     <span class="keywordflow">if</span> (isalpha(tmp[0]) &amp;&amp; tmp[1] == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; (tmp[2]==<span class="charliteral">&#39;\\&#39;</span> || tmp[2]==<span class="charliteral">&#39;/&#39;</span>) ) {
<a name="l00681"></a>00681         tmp[1] = tolower(tmp[0]); <span class="comment">/* replace &#39;:&#39; with driveletter */</span>
<a name="l00682"></a>00682         tmp[0] = <span class="charliteral">&#39;/&#39;</span>; 
<a name="l00683"></a>00683         <span class="comment">/* &#39;\&#39; the slash will be converted later */</span>
<a name="l00684"></a>00684     }
<a name="l00685"></a>00685     
<a name="l00686"></a>00686 <span class="preprocessor">#endif</span>
<a name="l00687"></a>00687 <span class="preprocessor"></span>
<a name="l00688"></a>00688     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(base, basepath, <span class="keyword">sizeof</span>(base));
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="comment">/* file component is ignored, so don&#39;t bother with the trailing slash */</span>
<a name="l00691"></a>00691     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, base);
<a name="l00692"></a>00692     
<a name="l00693"></a>00693     <span class="comment">/* push slashes into unix mode - strings entering this part are</span>
<a name="l00694"></a>00694 <span class="comment">     * potentially messed up: having both back- and forward slashes.</span>
<a name="l00695"></a>00695 <span class="comment">     * Here we push into one conform direction, and at the end we</span>
<a name="l00696"></a>00696 <span class="comment">     * push them into the system specific dir. This ensures uniformity</span>
<a name="l00697"></a>00697 <span class="comment">     * of paths and solving some problems (and prevent potential future</span>
<a name="l00698"></a>00698 <span class="comment">     * ones) -jesterKing. */</span>
<a name="l00699"></a>00699     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(tmp, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l00700"></a>00700     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(base, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);   
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="comment">/* Paths starting with // will get the blend file as their base,</span>
<a name="l00703"></a>00703 <span class="comment">     * this isn&#39;t standard in any os but is used in blender all over the place */</span>
<a name="l00704"></a>00704     <span class="keywordflow">if</span> (wasrelative) {
<a name="l00705"></a>00705         <span class="keywordtype">char</span> *lslash= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(base);
<a name="l00706"></a>00706         <span class="keywordflow">if</span> (lslash) {
<a name="l00707"></a>00707             <span class="keywordtype">int</span> baselen= (int) (lslash-base) + 1;
<a name="l00708"></a>00708             <span class="comment">/* use path for temp storage here, we copy back over it right away */</span>
<a name="l00709"></a>00709             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, tmp+2, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00710"></a>00710             
<a name="l00711"></a>00711             memcpy(tmp, base, baselen);
<a name="l00712"></a>00712             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(tmp+baselen, path, <span class="keyword">sizeof</span>(tmp)-baselen);
<a name="l00713"></a>00713             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, tmp, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715         <span class="keywordflow">else</span> {
<a name="l00716"></a>00716             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, tmp+2, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719     <span class="keywordflow">else</span> {
<a name="l00720"></a>00720         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, tmp, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a832a55b87c848fbe44df52a9cd789a83">BLI_cleanup_path</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, path);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00726"></a>00726 <span class="preprocessor"></span>    <span class="comment">/* skip first two chars, which in case of</span>
<a name="l00727"></a>00727 <span class="comment">     * absolute path will be drive:/blabla and</span>
<a name="l00728"></a>00728 <span class="comment">     * in case of relpath //blabla/. So relpath</span>
<a name="l00729"></a>00729 <span class="comment">     * // will be retained, rest will be nice and</span>
<a name="l00730"></a>00730 <span class="comment">     * shiny win32 backward slashes :) -jesterKing</span>
<a name="l00731"></a>00731 <span class="comment">     */</span>
<a name="l00732"></a>00732     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(path+2, <span class="charliteral">&#39;/&#39;</span>, <span class="charliteral">&#39;\\&#39;</span>);
<a name="l00733"></a>00733 <span class="preprocessor">#endif</span>
<a name="l00734"></a>00734 <span class="preprocessor"></span>    
<a name="l00735"></a>00735     <span class="keywordflow">return</span> wasrelative;
<a name="l00736"></a>00736 }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="comment">/*</span>
<a name="l00740"></a>00740 <span class="comment"> * Should only be done with command line paths.</span>
<a name="l00741"></a>00741 <span class="comment"> * this is NOT something blenders internal paths support like the // prefix</span>
<a name="l00742"></a>00742 <span class="comment"> */</span>
<a name="l00743"></a><a class="code" href="../../db/dae/path__util_8c.html#ae15c5cd6991743dea46f7bb0d3ab2221">00743</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae15c5cd6991743dea46f7bb0d3ab2221">BLI_path_cwd</a>(<span class="keywordtype">char</span> *path)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745     <span class="keywordtype">int</span> wasrelative = 1;
<a name="l00746"></a>00746     <span class="keywordtype">int</span> filelen = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(path);
<a name="l00747"></a>00747     
<a name="l00748"></a>00748 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00749"></a>00749 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (filelen &gt;= 3 &amp;&amp; path[1] == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; (path[2] == <span class="charliteral">&#39;\\&#39;</span> || path[2] == <span class="charliteral">&#39;/&#39;</span>))
<a name="l00750"></a>00750         wasrelative = 0;
<a name="l00751"></a>00751 <span class="preprocessor">#else</span>
<a name="l00752"></a>00752 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (filelen &gt;= 2 &amp;&amp; path[0] == <span class="charliteral">&#39;/&#39;</span>)
<a name="l00753"></a>00753         wasrelative = 0;
<a name="l00754"></a>00754 <span class="preprocessor">#endif</span>
<a name="l00755"></a>00755 <span class="preprocessor"></span>    
<a name="l00756"></a>00756     <span class="keywordflow">if</span> (wasrelative==1) {
<a name="l00757"></a>00757         <span class="keywordtype">char</span> cwd[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>]= <span class="stringliteral">&quot;&quot;</span>;
<a name="l00758"></a>00758         <a class="code" href="../../d2/d63/BLI__fileops_8h.html#af7f0f41c24f0b71a1da5568272855485">BLI_current_working_dir</a>(cwd, <span class="keyword">sizeof</span>(cwd)); <span class="comment">/* in case the full path to the blend isn&#39;t used */</span>
<a name="l00759"></a>00759         
<a name="l00760"></a>00760         <span class="keywordflow">if</span> (cwd[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l00761"></a>00761             printf( <span class="stringliteral">&quot;Could not get the current working directory - $PWD for an unknown reason.&quot;</span>);
<a name="l00762"></a>00762         }
<a name="l00763"></a>00763         <span class="keywordflow">else</span> {
<a name="l00764"></a>00764             <span class="comment">/* uses the blend path relative to cwd important for loading relative linked files.</span>
<a name="l00765"></a>00765 <span class="comment">             *</span>
<a name="l00766"></a>00766 <span class="comment">             * cwd should contain c:\ etc on win32 so the relbase can be NULL</span>
<a name="l00767"></a>00767 <span class="comment">             * relbase being NULL also prevents // being misunderstood as relative to the current</span>
<a name="l00768"></a>00768 <span class="comment">             * blend file which isn&#39;t a feature we want to use in this case since were dealing</span>
<a name="l00769"></a>00769 <span class="comment">             * with a path from the command line, rather than from inside Blender */</span>
<a name="l00770"></a>00770 
<a name="l00771"></a>00771             <span class="keywordtype">char</span> origpath[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00772"></a>00772             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(origpath, path, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00773"></a>00773             
<a name="l00774"></a>00774             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a6f32ac1a463a6322c25cb5c1615c4b1c">BLI_make_file_string</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, path, cwd, origpath); 
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777     
<a name="l00778"></a>00778     <span class="keywordflow">return</span> wasrelative;
<a name="l00779"></a>00779 }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 <span class="comment">/* &#39;di&#39;s filename component is moved into &#39;fi&#39;, di is made a dir path */</span>
<a name="l00783"></a><a class="code" href="../../db/dae/path__util_8c.html#a9587680f8895016dd21016fcecb476b0">00783</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9587680f8895016dd21016fcecb476b0">BLI_splitdirstring</a>(<span class="keywordtype">char</span> *di, <span class="keywordtype">char</span> *fi)
<a name="l00784"></a>00784 {
<a name="l00785"></a>00785     <span class="keywordtype">char</span> *lslash= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(di);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (lslash) {
<a name="l00788"></a>00788         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fi, lslash+1, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a40b3bb1f7d7c8c9bbf4e0ed92564e73e">FILE_MAXFILE</a>);
<a name="l00789"></a>00789         *(lslash+1)=0;
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791     <span class="keywordflow">else</span> {
<a name="l00792"></a>00792         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fi, di, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a40b3bb1f7d7c8c9bbf4e0ed92564e73e">FILE_MAXFILE</a>);
<a name="l00793"></a>00793         di[0]= 0;
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="../../db/dae/path__util_8c.html#afd2b13a404ba638ff559735c31d6e54e">00797</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#afd2b13a404ba638ff559735c31d6e54e">BLI_getlastdir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* dir, <span class="keywordtype">char</span> *last, <span class="keyword">const</span> <span class="keywordtype">size_t</span> maxlen)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799     <span class="keyword">const</span> <span class="keywordtype">char</span> *s = dir;
<a name="l00800"></a>00800     <span class="keyword">const</span> <span class="keywordtype">char</span> *lslash = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00801"></a>00801     <span class="keyword">const</span> <span class="keywordtype">char</span> *prevslash = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00802"></a>00802     <span class="keywordflow">while</span> (*s) {
<a name="l00803"></a>00803         <span class="keywordflow">if</span> ((*s == <span class="charliteral">&#39;\\&#39;</span>) || (*s == <span class="charliteral">&#39;/&#39;</span>)) {
<a name="l00804"></a>00804             prevslash = lslash;
<a name="l00805"></a>00805             lslash = s;
<a name="l00806"></a>00806         }
<a name="l00807"></a>00807         s++;
<a name="l00808"></a>00808     }
<a name="l00809"></a>00809     <span class="keywordflow">if</span> (prevslash) {
<a name="l00810"></a>00810         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(last, prevslash+1, maxlen);
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812     <span class="keywordflow">else</span> {
<a name="l00813"></a>00813         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(last, dir, maxlen);
<a name="l00814"></a>00814     }
<a name="l00815"></a>00815 }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817 <span class="comment">/* This is now only used to really get the user&#39;s default document folder */</span>
<a name="l00818"></a>00818 <span class="comment">/* On Windows I chose the &#39;Users/&lt;MyUserName&gt;/Documents&#39; since it&#39;s used</span>
<a name="l00819"></a>00819 <span class="comment"> * as default location to save documents */</span>
<a name="l00820"></a><a class="code" href="../../db/dae/path__util_8c.html#a4995ef235d7273c4de2a77fbbc792575">00820</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a4995ef235d7273c4de2a77fbbc792575">BLI_getDefaultDocumentFolder</a>(<span class="keywordtype">void</span>)
<a name="l00821"></a>00821 {
<a name="l00822"></a>00822 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00823"></a>00823 <span class="preprocessor"></span>
<a name="l00824"></a>00824 <span class="preprocessor">#ifdef WITH_XDG_USER_DIRS</span>
<a name="l00825"></a>00825 <span class="preprocessor"></span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *xdg_documents_dir= getenv(<span class="stringliteral">&quot;XDG_DOCUMENTS_DIR&quot;</span>);
<a name="l00826"></a>00826         <span class="keywordflow">if</span> (xdg_documents_dir) {
<a name="l00827"></a>00827             <span class="keywordflow">return</span> xdg_documents_dir;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829 <span class="preprocessor">#endif</span>
<a name="l00830"></a>00830 <span class="preprocessor"></span>
<a name="l00831"></a>00831         <span class="keywordflow">return</span> getenv(<span class="stringliteral">&quot;HOME&quot;</span>);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 <span class="preprocessor">#else </span><span class="comment">/* Windows */</span>
<a name="l00834"></a>00834         <span class="keyword">static</span> <span class="keywordtype">char</span> documentfolder[<a class="code" href="../../d9/ded/BLI__winstuff_8h.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>];
<a name="l00835"></a>00835         <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a353c9eb45b9a42d2dfdde7aa31a2a643">HRESULT</a> hResult;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837         <span class="comment">/* Check for %HOME% env var */</span>
<a name="l00838"></a>00838         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dee/utf__winfunc_8c.html#a869c293254adbef7cf6741953fd96336">uput_getenv</a>(<span class="stringliteral">&quot;HOME&quot;</span>,documentfolder,<a class="code" href="../../d9/ded/BLI__winstuff_8h.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>)) {
<a name="l00839"></a>00839             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(documentfolder)) <span class="keywordflow">return</span> documentfolder;
<a name="l00840"></a>00840         }
<a name="l00841"></a>00841                 
<a name="l00842"></a>00842         <span class="comment">/* add user profile support for WIN 2K / NT.</span>
<a name="l00843"></a>00843 <span class="comment">         * This is %APPDATA%, which translates to either</span>
<a name="l00844"></a>00844 <span class="comment">         * %USERPROFILE%\Application Data or since Vista</span>
<a name="l00845"></a>00845 <span class="comment">         * to %USERPROFILE%\AppData\Roaming</span>
<a name="l00846"></a>00846 <span class="comment">         */</span>
<a name="l00847"></a>00847         hResult = SHGetFolderPath(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, CSIDL_PERSONAL, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, SHGFP_TYPE_CURRENT, documentfolder);
<a name="l00848"></a>00848         
<a name="l00849"></a>00849         <span class="keywordflow">if</span> (hResult == <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>) {
<a name="l00850"></a>00850             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(documentfolder)) <span class="keywordflow">return</span> documentfolder;
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852         
<a name="l00853"></a>00853         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00854"></a>00854 <span class="preprocessor">#endif </span><span class="comment">/* WIN32 */</span>
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 <span class="comment">/* NEW stuff, to be cleaned up when fully migrated */</span>
<a name="l00858"></a>00858 <span class="comment">/* ************************************************************* */</span>
<a name="l00859"></a>00859 <span class="comment">/* ************************************************************* */</span>
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="comment">// #define PATH_DEBUG2</span>
<a name="l00862"></a>00862 
<a name="l00863"></a><a class="code" href="../../db/dae/path__util_8c.html#ab50361e4d90c8984731d87dd30bd2c19">00863</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/dae/path__util_8c.html#ab50361e4d90c8984731d87dd30bd2c19">blender_version_decimal</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> ver)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865     <span class="keyword">static</span> <span class="keywordtype">char</span> version_str[5];
<a name="l00866"></a>00866     sprintf(version_str, <span class="stringliteral">&quot;%d.%02d&quot;</span>, ver/100, ver%100);
<a name="l00867"></a>00867     <span class="keywordflow">return</span> version_str;
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">00870</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(<span class="keywordtype">char</span> *targetpath, <span class="keyword">const</span> <span class="keywordtype">char</span> *path_base, <span class="keyword">const</span> <span class="keywordtype">char</span> *path_sep, <span class="keyword">const</span> <span class="keywordtype">char</span> *folder_name)
<a name="l00871"></a>00871 {
<a name="l00872"></a>00872     <span class="keywordtype">char</span> tmppath[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00873"></a>00873     
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (path_sep)   <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(tmppath, <span class="keyword">sizeof</span>(tmppath), path_base, path_sep);
<a name="l00875"></a>00875     <span class="keywordflow">else</span>            <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(tmppath, path_base, <span class="keyword">sizeof</span>(tmppath));
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <span class="comment">/* rare cases folder_name is omitted (when looking for ~/.blender/2.xx dir only) */</span>
<a name="l00878"></a>00878     <span class="keywordflow">if</span> (folder_name)
<a name="l00879"></a>00879         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a6f32ac1a463a6322c25cb5c1615c4b1c">BLI_make_file_string</a>(<span class="stringliteral">&quot;/&quot;</span>, targetpath, tmppath, folder_name);
<a name="l00880"></a>00880     <span class="keywordflow">else</span>
<a name="l00881"></a>00881         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(targetpath, tmppath, <span class="keyword">sizeof</span>(tmppath));
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(targetpath)) {
<a name="l00884"></a>00884 <span class="preprocessor">#ifdef PATH_DEBUG2</span>
<a name="l00885"></a>00885 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;\tpath found: %s\n&quot;</span>, targetpath);
<a name="l00886"></a>00886 <span class="preprocessor">#endif</span>
<a name="l00887"></a>00887 <span class="preprocessor"></span>        <span class="keywordflow">return</span> 1;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889     <span class="keywordflow">else</span> {
<a name="l00890"></a>00890 <span class="preprocessor">#ifdef PATH_DEBUG2</span>
<a name="l00891"></a>00891 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;\tpath missing: %s\n&quot;</span>, targetpath);
<a name="l00892"></a>00892 <span class="preprocessor">#endif</span>
<a name="l00893"></a>00893 <span class="preprocessor"></span>        <span class="comment">//targetpath[0] = &#39;\0&#39;;</span>
<a name="l00894"></a>00894         <span class="keywordflow">return</span> 0;
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896 }
<a name="l00897"></a>00897 
<a name="l00898"></a><a class="code" href="../../db/dae/path__util_8c.html#a77c8f380514a1beb2f2a1b1587195a1b">00898</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a77c8f380514a1beb2f2a1b1587195a1b">test_env_path</a>(<span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *envvar)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900     <span class="keyword">const</span> <span class="keywordtype">char</span> *env = envvar?getenv(envvar):<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00901"></a>00901     <span class="keywordflow">if</span> (!env) <span class="keywordflow">return</span> 0;
<a name="l00902"></a>00902     
<a name="l00903"></a>00903     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(env)) {
<a name="l00904"></a>00904         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, env, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00905"></a>00905         <span class="keywordflow">return</span> 1;
<a name="l00906"></a>00906     }
<a name="l00907"></a>00907     <span class="keywordflow">else</span> {
<a name="l00908"></a>00908         path[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00909"></a>00909         <span class="keywordflow">return</span> 0;
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
<a name="l00913"></a><a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">00913</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(<span class="keywordtype">char</span> *targetpath, <span class="keyword">const</span> <span class="keywordtype">char</span> *folder_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *subfolder_name, <span class="keyword">const</span> <span class="keywordtype">int</span> ver)
<a name="l00914"></a>00914 {
<a name="l00915"></a>00915     <span class="keywordtype">char</span> relfolder[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00916"></a>00916     
<a name="l00917"></a>00917 <span class="preprocessor">#ifdef PATH_DEBUG2</span>
<a name="l00918"></a>00918 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;get_path_local...\n&quot;</span>);
<a name="l00919"></a>00919 <span class="preprocessor">#endif</span>
<a name="l00920"></a>00920 <span class="preprocessor"></span>
<a name="l00921"></a>00921     <span class="keywordflow">if</span> (folder_name) {
<a name="l00922"></a>00922         <span class="keywordflow">if</span> (subfolder_name) {
<a name="l00923"></a>00923             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(relfolder, <span class="keyword">sizeof</span>(relfolder), folder_name, subfolder_name);
<a name="l00924"></a>00924         }
<a name="l00925"></a>00925         <span class="keywordflow">else</span> {
<a name="l00926"></a>00926             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(relfolder, folder_name, <span class="keyword">sizeof</span>(relfolder));
<a name="l00927"></a>00927         }
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929     <span class="keywordflow">else</span> {
<a name="l00930"></a>00930         relfolder[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="comment">/* try EXECUTABLE_DIR/2.5x/folder_name - new default directory for local blender installed files */</span>
<a name="l00934"></a>00934     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, <a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">bprogdir</a>, <a class="code" href="../../db/dae/path__util_8c.html#ab50361e4d90c8984731d87dd30bd2c19">blender_version_decimal</a>(ver), relfolder))
<a name="l00935"></a>00935         <span class="keywordflow">return</span> 1;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937     <span class="keywordflow">return</span> 0;
<a name="l00938"></a>00938 }
<a name="l00939"></a>00939 
<a name="l00940"></a><a class="code" href="../../db/dae/path__util_8c.html#a9310262754f18405fe6201a10519868f">00940</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a9310262754f18405fe6201a10519868f">is_portable_install</a>(<span class="keywordtype">void</span>)
<a name="l00941"></a>00941 {
<a name="l00942"></a>00942     <span class="comment">/* detect portable install by the existance of config folder */</span>
<a name="l00943"></a>00943     <span class="keyword">const</span> <span class="keywordtype">int</span> ver= <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a5dffb3de6e078b72298ed826456c2272">BLENDER_VERSION</a>;
<a name="l00944"></a>00944     <span class="keywordtype">char</span> path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(path, <span class="stringliteral">&quot;config&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ver);
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00949"></a><a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">00949</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(<span class="keywordtype">char</span> *targetpath, <span class="keyword">const</span> <span class="keywordtype">char</span> *folder_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *subfolder_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *envvar, <span class="keyword">const</span> <span class="keywordtype">int</span> ver)
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951     <span class="keywordtype">char</span> user_path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00952"></a>00952     <span class="keyword">const</span> <span class="keywordtype">char</span> *user_base_path;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="comment">/* for portable install, user path is always local */</span>
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a9310262754f18405fe6201a10519868f">is_portable_install</a>())
<a name="l00956"></a>00956         <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(targetpath, folder_name, subfolder_name, ver);
<a name="l00957"></a>00957     
<a name="l00958"></a>00958     user_path[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a77c8f380514a1beb2f2a1b1587195a1b">test_env_path</a>(user_path, envvar)) {
<a name="l00961"></a>00961         <span class="keywordflow">if</span> (subfolder_name) {
<a name="l00962"></a>00962             <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, user_path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, subfolder_name);
<a name="l00963"></a>00963         }
<a name="l00964"></a>00964         <span class="keywordflow">else</span> {
<a name="l00965"></a>00965             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(targetpath, user_path, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00966"></a>00966             <span class="keywordflow">return</span> 1;
<a name="l00967"></a>00967         }
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     user_base_path = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="../../dd/de1/GHOST__Path-api_8h.html#a17eec1d1b27e9454c76df644a0cfb87d">GHOST_getUserDir</a>();
<a name="l00971"></a>00971     <span class="keywordflow">if</span> (user_base_path) {
<a name="l00972"></a>00972         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(user_path, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <a class="code" href="../../db/dae/path__util_8c.html#aac9656feee74b3b9e415358022726074">BLENDER_USER_FORMAT</a>, user_base_path, <a class="code" href="../../db/dae/path__util_8c.html#ab50361e4d90c8984731d87dd30bd2c19">blender_version_decimal</a>(ver));
<a name="l00973"></a>00973     }
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     <span class="keywordflow">if</span> (!user_path[0])
<a name="l00976"></a>00976         <span class="keywordflow">return</span> 0;
<a name="l00977"></a>00977     
<a name="l00978"></a>00978 <span class="preprocessor">#ifdef PATH_DEBUG2</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;get_path_user: %s\n&quot;</span>, user_path);
<a name="l00980"></a>00980 <span class="preprocessor">#endif</span>
<a name="l00981"></a>00981 <span class="preprocessor"></span>    
<a name="l00982"></a>00982     <span class="keywordflow">if</span> (subfolder_name) {
<a name="l00983"></a>00983         <span class="comment">/* try $HOME/folder_name/subfolder_name */</span>
<a name="l00984"></a>00984         <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, user_path, folder_name, subfolder_name);
<a name="l00985"></a>00985     }
<a name="l00986"></a>00986     <span class="keywordflow">else</span> {
<a name="l00987"></a>00987         <span class="comment">/* try $HOME/folder_name */</span>
<a name="l00988"></a>00988         <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, user_path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, folder_name);
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990 }
<a name="l00991"></a>00991 
<a name="l00992"></a><a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">00992</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">get_path_system</a>(<span class="keywordtype">char</span> *targetpath, <span class="keyword">const</span> <span class="keywordtype">char</span> *folder_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *subfolder_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *envvar, <span class="keyword">const</span> <span class="keywordtype">int</span> ver)
<a name="l00993"></a>00993 {
<a name="l00994"></a>00994     <span class="keywordtype">char</span> system_path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00995"></a>00995     <span class="keyword">const</span> <span class="keywordtype">char</span> *system_base_path;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <span class="comment">/* first allow developer only overrides to the system path</span>
<a name="l00999"></a>00999 <span class="comment">     * these are only used when running blender from source */</span>
<a name="l01000"></a>01000     <span class="keywordtype">char</span> cwd[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01001"></a>01001     <span class="keywordtype">char</span> relfolder[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01002"></a>01002 
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (folder_name) {
<a name="l01004"></a>01004         <span class="keywordflow">if</span> (subfolder_name) {
<a name="l01005"></a>01005             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(relfolder, <span class="keyword">sizeof</span>(relfolder), folder_name, subfolder_name);
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007         <span class="keywordflow">else</span> {
<a name="l01008"></a>01008             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(relfolder, folder_name, <span class="keyword">sizeof</span>(relfolder));
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011     <span class="keywordflow">else</span> {
<a name="l01012"></a>01012         relfolder[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     <span class="comment">/* try CWD/release/folder_name */</span>
<a name="l01016"></a>01016     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#af7f0f41c24f0b71a1da5568272855485">BLI_current_working_dir</a>(cwd, <span class="keyword">sizeof</span>(cwd))) {
<a name="l01017"></a>01017         <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, cwd, <span class="stringliteral">&quot;release&quot;</span>, relfolder)) {
<a name="l01018"></a>01018             <span class="keywordflow">return</span> 1;
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020     }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     <span class="comment">/* try EXECUTABLE_DIR/release/folder_name */</span>
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, <a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">bprogdir</a>, <span class="stringliteral">&quot;release&quot;</span>, relfolder))
<a name="l01024"></a>01024         <span class="keywordflow">return</span> 1;
<a name="l01025"></a>01025     <span class="comment">/* end developer overrides */</span>
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 
<a name="l01028"></a>01028 
<a name="l01029"></a>01029     system_path[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a77c8f380514a1beb2f2a1b1587195a1b">test_env_path</a>(system_path, envvar)) {
<a name="l01032"></a>01032         <span class="keywordflow">if</span> (subfolder_name) {
<a name="l01033"></a>01033             <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, system_path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, subfolder_name);
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035         <span class="keywordflow">else</span> {
<a name="l01036"></a>01036             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(targetpath, system_path, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l01037"></a>01037             <span class="keywordflow">return</span> 1;
<a name="l01038"></a>01038         }
<a name="l01039"></a>01039     }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     system_base_path = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="../../dd/de1/GHOST__Path-api_8h.html#af9afc4126db50b6009a6f21db50773c1">GHOST_getSystemDir</a>();
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (system_base_path) {
<a name="l01043"></a>01043         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(system_path, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <a class="code" href="../../db/dae/path__util_8c.html#a14de03d3290637cbccf633c3dd06ca46">BLENDER_SYSTEM_FORMAT</a>, system_base_path, <a class="code" href="../../db/dae/path__util_8c.html#ab50361e4d90c8984731d87dd30bd2c19">blender_version_decimal</a>(ver));
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045     
<a name="l01046"></a>01046     <span class="keywordflow">if</span> (!system_path[0])
<a name="l01047"></a>01047         <span class="keywordflow">return</span> 0;
<a name="l01048"></a>01048     
<a name="l01049"></a>01049 <span class="preprocessor">#ifdef PATH_DEBUG2</span>
<a name="l01050"></a>01050 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;get_path_system: %s\n&quot;</span>, system_path);
<a name="l01051"></a>01051 <span class="preprocessor">#endif</span>
<a name="l01052"></a>01052 <span class="preprocessor"></span>    
<a name="l01053"></a>01053     <span class="keywordflow">if</span> (subfolder_name) {
<a name="l01054"></a>01054         <span class="comment">/* try $BLENDERPATH/folder_name/subfolder_name */</span>
<a name="l01055"></a>01055         <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, system_path, folder_name, subfolder_name);
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057     <span class="keywordflow">else</span> {
<a name="l01058"></a>01058         <span class="comment">/* try $BLENDERPATH/folder_name */</span>
<a name="l01059"></a>01059         <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a04b7706dc81e6b29e327b9ce19279d09">test_path</a>(targetpath, system_path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, folder_name);
<a name="l01060"></a>01060     }
<a name="l01061"></a>01061 }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 <span class="comment">/* get a folder out of the &#39;folder_id&#39; presets for paths */</span>
<a name="l01064"></a>01064 <span class="comment">/* returns the path if found, NULL string if not */</span>
<a name="l01065"></a><a class="code" href="../../db/dae/path__util_8c.html#aa02248f4e3a842e5f97260f947d6cbf5">01065</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aa02248f4e3a842e5f97260f947d6cbf5">BLI_get_folder</a>(<span class="keywordtype">int</span> folder_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *subfolder)
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067     <span class="keyword">const</span> <span class="keywordtype">int</span> ver= <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a5dffb3de6e078b72298ed826456c2272">BLENDER_VERSION</a>;
<a name="l01068"></a>01068     <span class="keyword">static</span> <span class="keywordtype">char</span> path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01069"></a>01069     
<a name="l01070"></a>01070     <span class="keywordflow">switch</span> (folder_id) {
<a name="l01071"></a>01071         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a10929aa32f1ac1a1cc5f14aede22f2e6">BLENDER_DATAFILES</a>:     <span class="comment">/* general case */</span>
<a name="l01072"></a>01072             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_DATAFILES&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01073"></a>01073             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, ver)) <span class="keywordflow">break</span>;
<a name="l01074"></a>01074             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">get_path_system</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_SYSTEM_DATAFILES&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01075"></a>01075             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01076"></a>01076             
<a name="l01077"></a>01077         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a37305b36b02af95a083719821abc1d07">BLENDER_USER_DATAFILES</a>:
<a name="l01078"></a>01078             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_DATAFILES&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01079"></a>01079             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01080"></a>01080             
<a name="l01081"></a>01081         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a5e5b80e8cbd8a2296b13d14f9b1f3467">BLENDER_SYSTEM_DATAFILES</a>:
<a name="l01082"></a>01082             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, ver)) <span class="keywordflow">break</span>;
<a name="l01083"></a>01083             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">get_path_system</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_SYSTEM_DATAFILES&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01084"></a>01084             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01085"></a>01085             
<a name="l01086"></a>01086         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a088e1683ae79c007f96a61df1b5c3832">BLENDER_USER_AUTOSAVE</a>:
<a name="l01087"></a>01087             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;autosave&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_DATAFILES&quot;</span>, ver))  <span class="keywordflow">break</span>;
<a name="l01088"></a>01088             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a637136ebeb2c8676285a55bf13e8145a">BLENDER_USER_CONFIG</a>:
<a name="l01091"></a>01091             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;config&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_CONFIG&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01092"></a>01092             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01093"></a>01093             
<a name="l01094"></a>01094         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a81ca604e72260364c6696da10a5408a6">BLENDER_USER_SCRIPTS</a>:
<a name="l01095"></a>01095             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;scripts&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_SCRIPTS&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01096"></a>01096             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01097"></a>01097             
<a name="l01098"></a>01098         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a090f1dab96f249aa46ab13d406bf02a2">BLENDER_SYSTEM_SCRIPTS</a>:
<a name="l01099"></a>01099             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(path, <span class="stringliteral">&quot;scripts&quot;</span>, subfolder, ver)) <span class="keywordflow">break</span>;
<a name="l01100"></a>01100             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">get_path_system</a>(path, <span class="stringliteral">&quot;scripts&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_SYSTEM_SCRIPTS&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01101"></a>01101             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01102"></a>01102             
<a name="l01103"></a>01103         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aad9cce64900f2ad840e7ab10be1b9960">BLENDER_SYSTEM_PYTHON</a>:
<a name="l01104"></a>01104             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(path, <span class="stringliteral">&quot;python&quot;</span>, subfolder, ver)) <span class="keywordflow">break</span>;
<a name="l01105"></a>01105             <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">get_path_system</a>(path, <span class="stringliteral">&quot;python&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_SYSTEM_PYTHON&quot;</span>, ver)) <span class="keywordflow">break</span>;
<a name="l01106"></a>01106             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01107"></a>01107     }
<a name="l01108"></a>01108     
<a name="l01109"></a>01109     <span class="keywordflow">return</span> path;
<a name="l01110"></a>01110 }
<a name="l01111"></a>01111 
<a name="l01112"></a><a class="code" href="../../db/dae/path__util_8c.html#a8a11da4ccf9089a0a2200e337f6b9850">01112</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a8a11da4ccf9089a0a2200e337f6b9850">BLI_get_user_folder_notest</a>(<span class="keywordtype">int</span> folder_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *subfolder)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114     <span class="keyword">const</span> <span class="keywordtype">int</span> ver= <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a5dffb3de6e078b72298ed826456c2272">BLENDER_VERSION</a>;
<a name="l01115"></a>01115     <span class="keyword">static</span> <span class="keywordtype">char</span> path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="keywordflow">switch</span> (folder_id) {
<a name="l01118"></a>01118         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a37305b36b02af95a083719821abc1d07">BLENDER_USER_DATAFILES</a>:
<a name="l01119"></a>01119             <a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;datafiles&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_DATAFILES&quot;</span>, ver);
<a name="l01120"></a>01120             <span class="keywordflow">break</span>;
<a name="l01121"></a>01121         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a637136ebeb2c8676285a55bf13e8145a">BLENDER_USER_CONFIG</a>:
<a name="l01122"></a>01122             <a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;config&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_CONFIG&quot;</span>, ver);
<a name="l01123"></a>01123             <span class="keywordflow">break</span>;
<a name="l01124"></a>01124         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a088e1683ae79c007f96a61df1b5c3832">BLENDER_USER_AUTOSAVE</a>:
<a name="l01125"></a>01125             <a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;autosave&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_AUTOSAVE&quot;</span>, ver);
<a name="l01126"></a>01126             <span class="keywordflow">break</span>;
<a name="l01127"></a>01127         <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a81ca604e72260364c6696da10a5408a6">BLENDER_USER_SCRIPTS</a>:
<a name="l01128"></a>01128             <a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <span class="stringliteral">&quot;scripts&quot;</span>, subfolder, <span class="stringliteral">&quot;BLENDER_USER_SCRIPTS&quot;</span>, ver);
<a name="l01129"></a>01129             <span class="keywordflow">break</span>;
<a name="l01130"></a>01130     }
<a name="l01131"></a>01131     <span class="keywordflow">if</span> (<span class="charliteral">&#39;\0&#39;</span> == path[0]) {
<a name="l01132"></a>01132         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134     <span class="keywordflow">return</span> path;
<a name="l01135"></a>01135 }
<a name="l01136"></a>01136 
<a name="l01137"></a><a class="code" href="../../db/dae/path__util_8c.html#a2d45fdb5b2e7511c16f48f9064b2c82f">01137</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a2d45fdb5b2e7511c16f48f9064b2c82f">BLI_get_folder_create</a>(<span class="keywordtype">int</span> folder_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *subfolder)
<a name="l01138"></a>01138 {
<a name="l01139"></a>01139     <span class="keywordtype">char</span> *path;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     <span class="comment">/* only for user folders */</span>
<a name="l01142"></a>01142     <span class="keywordflow">if</span> (!<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(folder_id, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a37305b36b02af95a083719821abc1d07">BLENDER_USER_DATAFILES</a>, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a637136ebeb2c8676285a55bf13e8145a">BLENDER_USER_CONFIG</a>, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a81ca604e72260364c6696da10a5408a6">BLENDER_USER_SCRIPTS</a>, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a088e1683ae79c007f96a61df1b5c3832">BLENDER_USER_AUTOSAVE</a>))
<a name="l01143"></a>01143         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01144"></a>01144     
<a name="l01145"></a>01145     path = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aa02248f4e3a842e5f97260f947d6cbf5">BLI_get_folder</a>(folder_id, subfolder);
<a name="l01146"></a>01146     
<a name="l01147"></a>01147     <span class="keywordflow">if</span> (!path) {
<a name="l01148"></a>01148         path = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a8a11da4ccf9089a0a2200e337f6b9850">BLI_get_user_folder_notest</a>(folder_id, subfolder);
<a name="l01149"></a>01149         <span class="keywordflow">if</span> (path) <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a44e7a7091e4cf3ecce692fdc4216657e">BLI_dir_create_recursive</a>(path);
<a name="l01150"></a>01150     }
<a name="l01151"></a>01151     
<a name="l01152"></a>01152     <span class="keywordflow">return</span> path;
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a><a class="code" href="../../db/dae/path__util_8c.html#aec571363fa29985a3c43474caeb30145">01155</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aec571363fa29985a3c43474caeb30145">BLI_get_folder_version</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">int</span> ver, <span class="keyword">const</span> <span class="keywordtype">int</span> do_check)
<a name="l01156"></a>01156 {
<a name="l01157"></a>01157     <span class="keyword">static</span> <span class="keywordtype">char</span> path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01158"></a>01158     <span class="keywordtype">int</span> ok;
<a name="l01159"></a>01159     <span class="keywordflow">switch</span>(<span class="keywordtype">id</span>) {
<a name="l01160"></a>01160     <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0b995ea3387b9ef07d3d3036edd611b4">BLENDER_RESOURCE_PATH_USER</a>:
<a name="l01161"></a>01161         ok= <a class="code" href="../../db/dae/path__util_8c.html#a5a8451e16726a6d557a32497787284cf">get_path_user</a>(path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ver);
<a name="l01162"></a>01162         <span class="keywordflow">break</span>;
<a name="l01163"></a>01163     <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a02c4f2001c1c85f5819e52bc1b8d2ba0">BLENDER_RESOURCE_PATH_LOCAL</a>:
<a name="l01164"></a>01164         ok= <a class="code" href="../../db/dae/path__util_8c.html#a314832f0fc57d30988cfae5e18a580ae">get_path_local</a>(path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ver);
<a name="l01165"></a>01165         <span class="keywordflow">break</span>;
<a name="l01166"></a>01166     <span class="keywordflow">case</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af89699a8497fd3311f17d42db64dfca9">BLENDER_RESOURCE_PATH_SYSTEM</a>:
<a name="l01167"></a>01167         ok= <a class="code" href="../../db/dae/path__util_8c.html#a919545d93c9e5e25418053c951ed29d5">get_path_system</a>(path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ver);
<a name="l01168"></a>01168         <span class="keywordflow">break</span>;
<a name="l01169"></a>01169     <span class="keywordflow">default</span>:
<a name="l01170"></a>01170         path[0]= <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* in case do_check is false */</span>
<a name="l01171"></a>01171         ok= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01172"></a>01172         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(!<span class="stringliteral">&quot;incorrect ID&quot;</span>);
<a name="l01173"></a>01173     }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     <span class="keywordflow">if</span> ((ok == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp; do_check) {
<a name="l01176"></a>01176         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="keywordflow">return</span> path;
<a name="l01180"></a>01180 }
<a name="l01181"></a>01181 
<a name="l01182"></a>01182 <span class="comment">/* End new stuff */</span>
<a name="l01183"></a>01183 <span class="comment">/* ************************************************************* */</span>
<a name="l01184"></a>01184 <span class="comment">/* ************************************************************* */</span>
<a name="l01185"></a>01185 
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="preprocessor">#ifdef PATH_DEBUG</span>
<a name="l01189"></a>01189 <span class="preprocessor"></span><span class="preprocessor">#undef PATH_DEBUG</span>
<a name="l01190"></a>01190 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01191"></a>01191 <span class="preprocessor"></span>
<a name="l01192"></a><a class="code" href="../../db/dae/path__util_8c.html#ad94f01f110e6ccf320c2de51fb5f5870">01192</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad94f01f110e6ccf320c2de51fb5f5870">BLI_setenv</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *env, <span class="keyword">const</span> <span class="keywordtype">char</span>*val)
<a name="l01193"></a>01193 {
<a name="l01194"></a>01194     <span class="comment">/* free windows */</span>
<a name="l01195"></a>01195 <span class="preprocessor">#if (defined(WIN32) || defined(WIN64)) &amp;&amp; defined(FREE_WINDOWS)</span>
<a name="l01196"></a>01196 <span class="preprocessor"></span>    <span class="keywordtype">char</span> *envstr= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * (<a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(env) + <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(val) + 2), <span class="stringliteral">&quot;envstr&quot;</span>); <span class="comment">/* one for = another for \0 */</span>
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     sprintf(envstr, <span class="stringliteral">&quot;%s=%s&quot;</span>, env, val);
<a name="l01199"></a>01199     putenv(envstr);
<a name="l01200"></a>01200     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(envstr);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     <span class="comment">/* non-free windows */</span>
<a name="l01203"></a>01203 <span class="preprocessor">#elif (defined(WIN32) || defined(WIN64)) </span><span class="comment">/* not free windows */</span>
<a name="l01204"></a>01204     <a class="code" href="../../d2/dee/utf__winfunc_8c.html#a8d29e02418e1ab0297524cf78f06ffc8">uputenv</a>(env, val);
<a name="l01205"></a>01205 
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 <span class="preprocessor">#else</span>
<a name="l01208"></a>01208 <span class="preprocessor"></span>    <span class="comment">/* linux/osx/bsd */</span>
<a name="l01209"></a>01209     setenv(env, val, 1);
<a name="l01210"></a>01210 <span class="preprocessor">#endif</span>
<a name="l01211"></a>01211 <span class="preprocessor"></span>}
<a name="l01212"></a>01212 
<a name="l01213"></a>01213 
<a name="l01218"></a><a class="code" href="../../db/dae/path__util_8c.html#ade02d3594bb104dce6c383f5a0369802">01218</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ade02d3594bb104dce6c383f5a0369802">BLI_setenv_if_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *env, <span class="keyword">const</span> <span class="keywordtype">char</span>* val)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220     <span class="keywordflow">if</span> (getenv(env) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01221"></a>01221         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad94f01f110e6ccf320c2de51fb5f5870">BLI_setenv</a>(env, val);
<a name="l01222"></a>01222 }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 
<a name="l01225"></a><a class="code" href="../../db/dae/path__util_8c.html#ac5cc14a14ce0088944f22aae8baf8083">01225</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ac5cc14a14ce0088944f22aae8baf8083">BLI_clean</a>(<span class="keywordtype">char</span> *path)
<a name="l01226"></a>01226 {
<a name="l01227"></a>01227     <span class="keywordflow">if</span> (path==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01230"></a>01230 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (path &amp;&amp; <a class="code" href="../../d3/db3/BLI__string_8h.html#a4657f9ca919c8124abd611331344d5eb">BLI_strnlen</a>(path, 3) &gt; 2) {
<a name="l01231"></a>01231         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(path+2, <span class="charliteral">&#39;/&#39;</span>, <span class="charliteral">&#39;\\&#39;</span>);
<a name="l01232"></a>01232     }
<a name="l01233"></a>01233 <span class="preprocessor">#else</span>
<a name="l01234"></a>01234 <span class="preprocessor"></span>    <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(path, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l01235"></a>01235 <span class="preprocessor">#endif</span>
<a name="l01236"></a>01236 <span class="preprocessor"></span>}
<a name="l01237"></a>01237 
<a name="l01238"></a><a class="code" href="../../db/dae/path__util_8c.html#a0c64a0da4bbdfdadcd214a72f27ea773">01238</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>, <span class="keywordtype">char</span> from, <span class="keywordtype">char</span> to) 
<a name="l01239"></a>01239 {
<a name="l01240"></a>01240     <span class="keywordflow">if</span> (<span class="keywordtype">string</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01241"></a>01241     <span class="keywordflow">while</span> (*<span class="keywordtype">string</span> != 0) {
<a name="l01242"></a>01242         <span class="keywordflow">if</span> (*<span class="keywordtype">string</span> == from) *<span class="keywordtype">string</span> = to;
<a name="l01243"></a>01243         <span class="keywordtype">string</span>++;
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a><a class="code" href="../../db/dae/path__util_8c.html#a4f97a05fb660074e6e9db56e511e3a50">01247</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a4f97a05fb660074e6e9db56e511e3a50">BLI_make_exist</a>(<span class="keywordtype">char</span> *dir)
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249     <span class="keywordtype">int</span> a;
<a name="l01250"></a>01250 
<a name="l01251"></a>01251     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(dir, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a12dd7a71bec8476cbb2512ee35744a22">ALTSEP</a>, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>);
<a name="l01252"></a>01252 
<a name="l01253"></a>01253     a = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(dir);
<a name="l01254"></a>01254 
<a name="l01255"></a>01255     <span class="keywordflow">while</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(dir) == 0) {
<a name="l01256"></a>01256         a --;
<a name="l01257"></a>01257         <span class="keywordflow">while</span> (dir[a] != <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>) {
<a name="l01258"></a>01258             a--;
<a name="l01259"></a>01259             <span class="keywordflow">if</span> (a &lt;= 0) <span class="keywordflow">break</span>;
<a name="l01260"></a>01260         }
<a name="l01261"></a>01261         <span class="keywordflow">if</span> (a &gt;= 0) {
<a name="l01262"></a>01262             dir[a+1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01263"></a>01263         }
<a name="l01264"></a>01264         <span class="keywordflow">else</span> {
<a name="l01265"></a>01265 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01266"></a>01266 <span class="preprocessor"></span>            <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa17eb556eb4f390c64a7cdc7d1ae2b70">get_default_root</a>(dir);
<a name="l01267"></a>01267 <span class="preprocessor">#else</span>
<a name="l01268"></a>01268 <span class="preprocessor"></span>            strcpy(dir,<span class="stringliteral">&quot;/&quot;</span>);
<a name="l01269"></a>01269 <span class="preprocessor">#endif</span>
<a name="l01270"></a>01270 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
<a name="l01271"></a>01271         }
<a name="l01272"></a>01272     }
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01275"></a><a class="code" href="../../db/dae/path__util_8c.html#a050025994d6d5f2183dad14b383d0854">01275</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a050025994d6d5f2183dad14b383d0854">BLI_make_existing_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01276"></a>01276 {
<a name="l01277"></a>01277     <span class="keywordtype">char</span> di[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], fi[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a40b3bb1f7d7c8c9bbf4e0ed92564e73e">FILE_MAXFILE</a>];
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(di, name, <span class="keyword">sizeof</span>(di));
<a name="l01280"></a>01280     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9587680f8895016dd21016fcecb476b0">BLI_splitdirstring</a>(di, fi);
<a name="l01281"></a>01281     
<a name="l01282"></a>01282     <span class="comment">/* test exist */</span>
<a name="l01283"></a>01283     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a0bf59749f87b0f283c37e27e72029591">BLI_exists</a>(di) == 0) {
<a name="l01284"></a>01284         <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a44e7a7091e4cf3ecce692fdc4216657e">BLI_dir_create_recursive</a>(di);
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 
<a name="l01289"></a><a class="code" href="../../db/dae/path__util_8c.html#a6f32ac1a463a6322c25cb5c1615c4b1c">01289</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a6f32ac1a463a6322c25cb5c1615c4b1c">BLI_make_file_string</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *relabase, <span class="keywordtype">char</span> *<span class="keywordtype">string</span>,  <span class="keyword">const</span> <span class="keywordtype">char</span> *dir, <span class="keyword">const</span> <span class="keywordtype">char</span> *file)
<a name="l01290"></a>01290 {
<a name="l01291"></a>01291     <span class="keywordtype">int</span> sl;
<a name="l01292"></a>01292 
<a name="l01293"></a>01293     <span class="keywordflow">if</span> (<span class="keywordtype">string</span>) {
<a name="l01294"></a>01294         <span class="comment">/* ensure this is always set even if dir/file are NULL */</span>
<a name="l01295"></a>01295         <span class="keywordtype">string</span>[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, dir, file)) {
<a name="l01298"></a>01298             <span class="keywordflow">return</span>; <span class="comment">/* We don&#39;t want any NULLs */</span>
<a name="l01299"></a>01299         }
<a name="l01300"></a>01300     }
<a name="l01301"></a>01301     <span class="keywordflow">else</span> {
<a name="l01302"></a>01302         <span class="keywordflow">return</span>; <span class="comment">/* string is NULL, probably shouldnt happen but return anyway */</span>
<a name="l01303"></a>01303     }
<a name="l01304"></a>01304 
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     <span class="comment">/* we first push all slashes into unix mode, just to make sure we don&#39;t get</span>
<a name="l01307"></a>01307 <span class="comment">     * any mess with slashes later on. -jesterKing */</span>
<a name="l01308"></a>01308     <span class="comment">/* constant strings can be passed for those parameters - don&#39;t change them - elubie */</span>
<a name="l01309"></a>01309 <span class="preprocessor">#if 0</span>
<a name="l01310"></a>01310 <span class="preprocessor"></span>    <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(relabase, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l01311"></a>01311     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(dir, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l01312"></a>01312     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a0c64a0da4bbdfdadcd214a72f27ea773">BLI_char_switch</a>(file, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>);
<a name="l01313"></a>01313 <span class="preprocessor">#endif</span>
<a name="l01314"></a>01314 <span class="preprocessor"></span>
<a name="l01315"></a>01315     <span class="comment">/* Resolve relative references */</span>   
<a name="l01316"></a>01316     <span class="keywordflow">if</span> (relabase &amp;&amp; dir[0] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; dir[1] == <span class="charliteral">&#39;/&#39;</span>) {
<a name="l01317"></a>01317         <span class="keywordtype">char</span> *lslash;
<a name="l01318"></a>01318         
<a name="l01319"></a>01319         <span class="comment">/* Get the file name, chop everything past the last slash (ie. the filename) */</span>
<a name="l01320"></a>01320         strcpy(<span class="keywordtype">string</span>, relabase);
<a name="l01321"></a>01321         
<a name="l01322"></a>01322         lslash= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(<span class="keywordtype">string</span>);
<a name="l01323"></a>01323         <span class="keywordflow">if</span> (lslash) *(lslash+1)= 0;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325         dir+=2; <span class="comment">/* Skip over the relative reference */</span>
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01328"></a>01328 <span class="preprocessor"></span>    <span class="keywordflow">else</span> {
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (<a class="code" href="../../d3/db3/BLI__string_8h.html#a4657f9ca919c8124abd611331344d5eb">BLI_strnlen</a>(dir, 3) &gt;= 2 &amp;&amp; dir[1] == <span class="charliteral">&#39;:&#39;</span> ) {
<a name="l01330"></a>01330             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(<span class="keywordtype">string</span>, dir, 3);
<a name="l01331"></a>01331             dir += 2;
<a name="l01332"></a>01332         }
<a name="l01333"></a>01333         <span class="keywordflow">else</span> { <span class="comment">/* no drive specified */</span>
<a name="l01334"></a>01334             <span class="comment">/* first option: get the drive from the relabase if it has one */</span>
<a name="l01335"></a>01335             <span class="keywordflow">if</span> (relabase &amp;&amp; <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(relabase) &gt;= 2 &amp;&amp; relabase[1] == <span class="charliteral">&#39;:&#39;</span> ) {
<a name="l01336"></a>01336                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(<span class="keywordtype">string</span>, relabase, 3);   
<a name="l01337"></a>01337                 <span class="keywordtype">string</span>[2] = <span class="charliteral">&#39;\\&#39;</span>;
<a name="l01338"></a>01338                 <span class="keywordtype">string</span>[3] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01339"></a>01339             }
<a name="l01340"></a>01340             <span class="keywordflow">else</span> { <span class="comment">/* we&#39;re out of luck here, guessing the first valid drive, usually c:\ */</span>
<a name="l01341"></a>01341                 <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa17eb556eb4f390c64a7cdc7d1ae2b70">get_default_root</a>(<span class="keywordtype">string</span>);
<a name="l01342"></a>01342             }
<a name="l01343"></a>01343             
<a name="l01344"></a>01344             <span class="comment">/* ignore leading slashes */</span>
<a name="l01345"></a>01345             <span class="keywordflow">while</span> (*dir == <span class="charliteral">&#39;/&#39;</span> || *dir == <span class="charliteral">&#39;\\&#39;</span>) dir++;
<a name="l01346"></a>01346         }
<a name="l01347"></a>01347     }
<a name="l01348"></a>01348 <span class="preprocessor">#endif</span>
<a name="l01349"></a>01349 <span class="preprocessor"></span>
<a name="l01350"></a>01350     strcat(<span class="keywordtype">string</span>, dir);
<a name="l01351"></a>01351 
<a name="l01352"></a>01352     <span class="comment">/* Make sure string ends in one (and only one) slash */</span> 
<a name="l01353"></a>01353     <span class="comment">/* first trim all slashes from the end of the string */</span>
<a name="l01354"></a>01354     sl = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="keywordtype">string</span>);
<a name="l01355"></a>01355     <span class="keywordflow">while</span> (sl&gt;0 &amp;&amp; ( <span class="keywordtype">string</span>[sl-1] == <span class="charliteral">&#39;/&#39;</span> || <span class="keywordtype">string</span>[sl-1] == <span class="charliteral">&#39;\\&#39;</span>) ) {
<a name="l01356"></a>01356         <span class="keywordtype">string</span>[sl-1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01357"></a>01357         sl--;
<a name="l01358"></a>01358     }
<a name="l01359"></a>01359     <span class="comment">/* since we&#39;ve now removed all slashes, put back one slash at the end. */</span>
<a name="l01360"></a>01360     strcat(<span class="keywordtype">string</span>, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l01361"></a>01361     
<a name="l01362"></a>01362     <span class="keywordflow">while</span> (*file &amp;&amp; (*file == <span class="charliteral">&#39;/&#39;</span> || *file == <span class="charliteral">&#39;\\&#39;</span>)) <span class="comment">/* Trim slashes from the front of file */</span>
<a name="l01363"></a>01363         file++;
<a name="l01364"></a>01364         
<a name="l01365"></a>01365     strcat (<span class="keywordtype">string</span>, file);
<a name="l01366"></a>01366     
<a name="l01367"></a>01367     <span class="comment">/* Push all slashes to the system preferred direction */</span>
<a name="l01368"></a>01368     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ac5cc14a14ce0088944f22aae8baf8083">BLI_clean</a>(<span class="keywordtype">string</span>);
<a name="l01369"></a>01369 }
<a name="l01370"></a>01370 
<a name="l01371"></a><a class="code" href="../../db/dae/path__util_8c.html#a91f9e9d5868a3b3e5756809d6cae1a75">01371</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a91f9e9d5868a3b3e5756809d6cae1a75">BLI_testextensie</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext)
<a name="l01372"></a>01372 {
<a name="l01373"></a>01373     <span class="keywordtype">short</span> a, b;
<a name="l01374"></a>01374     <span class="keywordtype">int</span> retval;
<a name="l01375"></a>01375     
<a name="l01376"></a>01376     a= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01377"></a>01377     b= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ext);
<a name="l01378"></a>01378     
<a name="l01379"></a>01379     <span class="keywordflow">if</span> (a==0 || b==0 || b&gt;=a) {
<a name="l01380"></a>01380         retval = 0;
<a name="l01381"></a>01381     }
<a name="l01382"></a>01382     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/db3/BLI__string_8h.html#a25282665ccb1b357b39bd978e4a59739">BLI_strcasecmp</a>(ext, str + a - b)) {
<a name="l01383"></a>01383         retval = 0; 
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385     <span class="keywordflow">else</span> {
<a name="l01386"></a>01386         retval = 1;
<a name="l01387"></a>01387     }
<a name="l01388"></a>01388     
<a name="l01389"></a>01389     <span class="keywordflow">return</span> (retval);
<a name="l01390"></a>01390 }
<a name="l01391"></a>01391 
<a name="l01392"></a><a class="code" href="../../db/dae/path__util_8c.html#aeeedac7b0ad04a708eb449dc6b7373c0">01392</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aeeedac7b0ad04a708eb449dc6b7373c0">BLI_testextensie_array</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> **ext_array)
<a name="l01393"></a>01393 {
<a name="l01394"></a>01394     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;
<a name="l01395"></a>01395     <span class="keywordflow">while</span> (ext_array[i]) {
<a name="l01396"></a>01396         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a91f9e9d5868a3b3e5756809d6cae1a75">BLI_testextensie</a>(str, ext_array[i])) {
<a name="l01397"></a>01397             <span class="keywordflow">return</span> 1;
<a name="l01398"></a>01398         }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400         i++;
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402     <span class="keywordflow">return</span> 0;
<a name="l01403"></a>01403 }
<a name="l01404"></a>01404 
<a name="l01405"></a>01405 <span class="comment">/* semicolon separated wildcards, eg:</span>
<a name="l01406"></a>01406 <span class="comment"> *  &#39;*.zip;*.py;*.exe&#39; */</span>
<a name="l01407"></a><a class="code" href="../../db/dae/path__util_8c.html#a412be96a9562aee069aa6420172e8f62">01407</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a412be96a9562aee069aa6420172e8f62">BLI_testextensie_glob</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext_fnmatch)
<a name="l01408"></a>01408 {
<a name="l01409"></a>01409     <span class="keyword">const</span> <span class="keywordtype">char</span> *ext_step= ext_fnmatch;
<a name="l01410"></a>01410     <span class="keywordtype">char</span> pattern[16];
<a name="l01411"></a>01411 
<a name="l01412"></a>01412     <span class="keywordflow">while</span> (ext_step[0]) {
<a name="l01413"></a>01413         <span class="keywordtype">char</span> *ext_next;
<a name="l01414"></a>01414         <span class="keywordtype">int</span> len_ext;
<a name="l01415"></a>01415 
<a name="l01416"></a>01416         <span class="keywordflow">if</span> ((ext_next=strchr(ext_step, <span class="charliteral">&#39;;&#39;</span>))) {
<a name="l01417"></a>01417             len_ext= (int)(ext_next - ext_step) + 1;
<a name="l01418"></a>01418         }
<a name="l01419"></a>01419         <span class="keywordflow">else</span> {
<a name="l01420"></a>01420             len_ext= <span class="keyword">sizeof</span>(pattern);
<a name="l01421"></a>01421         }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(pattern, ext_step, len_ext);
<a name="l01424"></a>01424 
<a name="l01425"></a>01425         <span class="keywordflow">if</span> (fnmatch(pattern, str, <a class="code" href="../../d0/dbc/BLI__fnmatch_8h.html#ad41e3158a654dd4dfdab19d97745698a">FNM_CASEFOLD</a>)==0) {
<a name="l01426"></a>01426             <span class="keywordflow">return</span> 1;
<a name="l01427"></a>01427         }
<a name="l01428"></a>01428         ext_step += len_ext;
<a name="l01429"></a>01429     }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431     <span class="keywordflow">return</span> 0;
<a name="l01432"></a>01432 }
<a name="l01433"></a>01433 
<a name="l01434"></a>01434 
<a name="l01435"></a><a class="code" href="../../db/dae/path__util_8c.html#afa3da8cc53a62041acbb98eb6a9805c4">01435</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#afa3da8cc53a62041acbb98eb6a9805c4">BLI_replace_extension</a>(<span class="keywordtype">char</span> *path, <span class="keywordtype">size_t</span> maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext)
<a name="l01436"></a>01436 {
<a name="l01437"></a>01437     <span class="keywordtype">size_t</span> path_len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(path);
<a name="l01438"></a>01438     <span class="keywordtype">size_t</span> ext_len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ext);
<a name="l01439"></a>01439     <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#a831c6b6852c6d34448e30a88c34539fd">ssize_t</a> a;
<a name="l01440"></a>01440 
<a name="l01441"></a>01441     <span class="keywordflow">for</span> (a= path_len - 1; a &gt;= 0; a--) {
<a name="l01442"></a>01442         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(path[a], <span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;/&#39;</span>, <span class="charliteral">&#39;\\&#39;</span>)) {
<a name="l01443"></a>01443             <span class="keywordflow">break</span>;
<a name="l01444"></a>01444         }
<a name="l01445"></a>01445     }
<a name="l01446"></a>01446 
<a name="l01447"></a>01447     <span class="keywordflow">if</span> ((a &lt; 0) || (path[a] != <span class="charliteral">&#39;.&#39;</span>)) {
<a name="l01448"></a>01448         a= path_len;
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <span class="keywordflow">if</span> (a + ext_len &gt;= maxlen)
<a name="l01452"></a>01452         <span class="keywordflow">return</span> 0;
<a name="l01453"></a>01453 
<a name="l01454"></a>01454     memcpy(path+a, ext, ext_len + 1);
<a name="l01455"></a>01455     <span class="keywordflow">return</span> 1;
<a name="l01456"></a>01456 }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 <span class="comment">/* strip&#39;s trailing &#39;.&#39;s and adds the extension only when needed */</span>
<a name="l01459"></a><a class="code" href="../../db/dae/path__util_8c.html#ae5e609274296921b40b35a59959ec5a7">01459</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae5e609274296921b40b35a59959ec5a7">BLI_ensure_extension</a>(<span class="keywordtype">char</span> *path, <span class="keywordtype">size_t</span> maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext)
<a name="l01460"></a>01460 {
<a name="l01461"></a>01461     <span class="keywordtype">size_t</span> path_len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(path);
<a name="l01462"></a>01462     <span class="keywordtype">size_t</span> ext_len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ext);
<a name="l01463"></a>01463     <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#a831c6b6852c6d34448e30a88c34539fd">ssize_t</a> a;
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     <span class="comment">/* first check the extension is alread there */</span>
<a name="l01466"></a>01466     <span class="keywordflow">if</span> (    (ext_len &lt;= path_len) &amp;&amp;
<a name="l01467"></a>01467             (strcmp(path + (path_len - ext_len), ext) == 0))
<a name="l01468"></a>01468     {
<a name="l01469"></a>01469         <span class="keywordflow">return</span> 1;
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <span class="keywordflow">for</span> (a= path_len - 1; a &gt;= 0; a--) {
<a name="l01473"></a>01473         <span class="keywordflow">if</span> (path[a] == <span class="charliteral">&#39;.&#39;</span>) {
<a name="l01474"></a>01474             path[a]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01475"></a>01475         }
<a name="l01476"></a>01476         <span class="keywordflow">else</span> {
<a name="l01477"></a>01477             <span class="keywordflow">break</span>;
<a name="l01478"></a>01478         }
<a name="l01479"></a>01479     }
<a name="l01480"></a>01480     a++;
<a name="l01481"></a>01481 
<a name="l01482"></a>01482     <span class="keywordflow">if</span> (a + ext_len &gt;= maxlen)
<a name="l01483"></a>01483         <span class="keywordflow">return</span> 0;
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     memcpy(path+a, ext, ext_len + 1);
<a name="l01486"></a>01486     <span class="keywordflow">return</span> 1;
<a name="l01487"></a>01487 }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489 <span class="comment">/* Converts &quot;/foo/bar.txt&quot; to &quot;/foo/&quot; and &quot;bar.txt&quot;</span>
<a name="l01490"></a>01490 <span class="comment"> * - wont change &#39;string&#39;</span>
<a name="l01491"></a>01491 <span class="comment"> * - wont create any directories</span>
<a name="l01492"></a>01492 <span class="comment"> * - dosnt use CWD, or deal with relative paths.</span>
<a name="l01493"></a>01493 <span class="comment"> * - Only fill&#39;s in *dir and *file when they are non NULL</span>
<a name="l01494"></a>01494 <span class="comment"> * */</span>
<a name="l01495"></a><a class="code" href="../../db/dae/path__util_8c.html#ae9bf85f6bb0df0bb8fcc352e870e32b8">01495</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae9bf85f6bb0df0bb8fcc352e870e32b8">BLI_split_dirfile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>, <span class="keywordtype">char</span> *dir, <span class="keywordtype">char</span> *file, <span class="keyword">const</span> <span class="keywordtype">size_t</span> dirlen, <span class="keyword">const</span> <span class="keywordtype">size_t</span> filelen)
<a name="l01496"></a>01496 {
<a name="l01497"></a>01497     <span class="keywordtype">char</span> *lslash_str = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(<span class="keywordtype">string</span>);
<a name="l01498"></a>01498     <span class="keywordtype">size_t</span> lslash= lslash_str ? (size_t)(lslash_str - <span class="keywordtype">string</span>) + 1 : 0;
<a name="l01499"></a>01499 
<a name="l01500"></a>01500     <span class="keywordflow">if</span> (dir) {
<a name="l01501"></a>01501         <span class="keywordflow">if</span> (lslash) {
<a name="l01502"></a>01502             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(dir, <span class="keywordtype">string</span>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(dirlen, lslash + 1)); <span class="comment">/* +1 to include the slash and the last char */</span>
<a name="l01503"></a>01503         }
<a name="l01504"></a>01504         <span class="keywordflow">else</span> {
<a name="l01505"></a>01505             dir[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01506"></a>01506         }
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508     
<a name="l01509"></a>01509     <span class="keywordflow">if</span> (file) {
<a name="l01510"></a>01510         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(file, <span class="keywordtype">string</span>+lslash, filelen);
<a name="l01511"></a>01511     }
<a name="l01512"></a>01512 }
<a name="l01513"></a>01513 
<a name="l01514"></a><a class="code" href="../../db/dae/path__util_8c.html#a295e8cb30935da1afb1713d0d4b493c9">01514</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a295e8cb30935da1afb1713d0d4b493c9">BLI_split_dir_part</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>, <span class="keywordtype">char</span> *dir, <span class="keyword">const</span> <span class="keywordtype">size_t</span> dirlen)
<a name="l01515"></a>01515 {
<a name="l01516"></a>01516     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae9bf85f6bb0df0bb8fcc352e870e32b8">BLI_split_dirfile</a>(<span class="keywordtype">string</span>, dir, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, dirlen, 0);
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 
<a name="l01519"></a><a class="code" href="../../db/dae/path__util_8c.html#aeb23a21e0676b508c4cd49afbb445c55">01519</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aeb23a21e0676b508c4cd49afbb445c55">BLI_split_file_part</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>, <span class="keywordtype">char</span> *file, <span class="keyword">const</span> <span class="keywordtype">size_t</span> filelen)
<a name="l01520"></a>01520 {
<a name="l01521"></a>01521     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae9bf85f6bb0df0bb8fcc352e870e32b8">BLI_split_dirfile</a>(<span class="keywordtype">string</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, file, 0, filelen);
<a name="l01522"></a>01522 }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 <span class="comment">/* simple appending of filename to dir, does not check for valid path! */</span>
<a name="l01525"></a><a class="code" href="../../db/dae/path__util_8c.html#acfc78d2e5949a76eb9c30e82f0065e03">01525</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">size_t</span> maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *dir, <span class="keyword">const</span> <span class="keywordtype">char</span> *file)
<a name="l01526"></a>01526 {
<a name="l01527"></a>01527     <span class="keywordtype">size_t</span> dirlen= <a class="code" href="../../d3/db3/BLI__string_8h.html#a4657f9ca919c8124abd611331344d5eb">BLI_strnlen</a>(dir, maxlen);
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     <span class="keywordflow">if</span> (dst != dir) {
<a name="l01530"></a>01530         <span class="keywordflow">if</span> (dirlen  == maxlen) {
<a name="l01531"></a>01531             memcpy(dst, dir, dirlen);
<a name="l01532"></a>01532             dst[dirlen - 1]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01533"></a>01533             <span class="keywordflow">return</span>; <span class="comment">/* dir fills the path */</span>
<a name="l01534"></a>01534         }
<a name="l01535"></a>01535         <span class="keywordflow">else</span> {
<a name="l01536"></a>01536             memcpy(dst, dir, dirlen + 1);
<a name="l01537"></a>01537         }
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540     <span class="keywordflow">if</span> (dirlen + 1 &gt;= maxlen) {
<a name="l01541"></a>01541         <span class="keywordflow">return</span>; <span class="comment">/* fills the path */</span>
<a name="l01542"></a>01542     }
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <span class="comment">/* inline BLI_add_slash */</span>
<a name="l01545"></a>01545     <span class="keywordflow">if</span> ((dirlen &gt; 0) &amp;&amp; (dst[dirlen - 1] != <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>)) {
<a name="l01546"></a>01546         dst[dirlen++] = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>;
<a name="l01547"></a>01547         dst[dirlen  ] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01548"></a>01548     }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550     <span class="keywordflow">if</span> (dirlen &gt;= maxlen) {
<a name="l01551"></a>01551         <span class="keywordflow">return</span>; <span class="comment">/* fills the path */</span>
<a name="l01552"></a>01552     }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554     <span class="keywordflow">if</span> (file == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01555"></a>01555         <span class="keywordflow">return</span>;
<a name="l01556"></a>01556     }
<a name="l01557"></a>01557 
<a name="l01558"></a>01558     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(dst + dirlen, file, maxlen - dirlen);
<a name="l01559"></a>01559 }
<a name="l01560"></a>01560 
<a name="l01561"></a>01561 <span class="comment">/* like pythons os.path.basename( ) */</span>
<a name="l01562"></a><a class="code" href="../../db/dae/path__util_8c.html#ab7fd82fa983b947c076e585e30e7c262">01562</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab7fd82fa983b947c076e585e30e7c262">BLI_path_basename</a>(<span class="keywordtype">char</span> *path)
<a name="l01563"></a>01563 {
<a name="l01564"></a>01564     <span class="keywordtype">char</span> *filename= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(path);
<a name="l01565"></a>01565     <span class="keywordflow">return</span> filename ? filename + 1 : path;
<a name="l01566"></a>01566 }
<a name="l01567"></a>01567 
<a name="l01594"></a><a class="code" href="../../db/dae/path__util_8c.html#a7725591bafa083465d606ba3066b46f3">01594</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a7725591bafa083465d606ba3066b46f3">BKE_rebase_path</a>(<span class="keywordtype">char</span> *<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>, <span class="keywordtype">size_t</span> abs_len, <span class="keywordtype">char</span> *rel, <span class="keywordtype">size_t</span> rel_len, <span class="keyword">const</span> <span class="keywordtype">char</span> *base_dir, <span class="keyword">const</span> <span class="keywordtype">char</span> *src_dir, <span class="keyword">const</span> <span class="keywordtype">char</span> *dest_dir)
<a name="l01595"></a>01595 {
<a name="l01596"></a>01596     <span class="keywordtype">char</span> path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01597"></a>01597     <span class="keywordtype">char</span> dir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01598"></a>01598     <span class="keywordtype">char</span> base[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01599"></a>01599     <span class="keywordtype">char</span> blend_dir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];   <span class="comment">/* directory, where current .blend file resides */</span>
<a name="l01600"></a>01600     <span class="keywordtype">char</span> dest_path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01601"></a>01601     <span class="keywordtype">char</span> rel_dir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01602"></a>01602     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01603"></a>01603 
<a name="l01604"></a>01604     <span class="keywordflow">if</span> (abs)
<a name="l01605"></a>01605         abs[0]= 0;
<a name="l01606"></a>01606 
<a name="l01607"></a>01607     <span class="keywordflow">if</span> (rel)
<a name="l01608"></a>01608         rel[0]= 0;
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a295e8cb30935da1afb1713d0d4b493c9">BLI_split_dir_part</a>(base_dir, blend_dir, <span class="keyword">sizeof</span>(blend_dir));
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     <span class="keywordflow">if</span> (src_dir[0]==<span class="charliteral">&#39;\0&#39;</span>)
<a name="l01613"></a>01613         <span class="keywordflow">return</span> 0;
<a name="l01614"></a>01614 
<a name="l01615"></a>01615     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(path, src_dir, <span class="keyword">sizeof</span>(path));
<a name="l01616"></a>01616 
<a name="l01617"></a>01617     <span class="comment">/* expand &quot;//&quot; in filename and get absolute path */</span>
<a name="l01618"></a>01618     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(path, base_dir);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620     <span class="comment">/* get the directory part */</span>
<a name="l01621"></a>01621     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae9bf85f6bb0df0bb8fcc352e870e32b8">BLI_split_dirfile</a>(path, dir, base, <span class="keyword">sizeof</span>(dir), <span class="keyword">sizeof</span>(base));
<a name="l01622"></a>01622 
<a name="l01623"></a>01623     len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(blend_dir);
<a name="l01624"></a>01624 
<a name="l01625"></a>01625     rel_dir[0] = 0;
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     <span class="comment">/* if image is &quot;below&quot; current .blend file directory */</span>
<a name="l01628"></a>01628     <span class="keywordflow">if</span> (!strncmp(path, blend_dir, len)) {
<a name="l01629"></a>01629 
<a name="l01630"></a>01630         <span class="comment">/* if image is _in_ current .blend file directory */</span>
<a name="l01631"></a>01631         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>(dir, blend_dir) == 0) {
<a name="l01632"></a>01632             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(dest_path, <span class="keyword">sizeof</span>(dest_path), dest_dir, base);
<a name="l01633"></a>01633         }
<a name="l01634"></a>01634         <span class="comment">/* &quot;below&quot; */</span>
<a name="l01635"></a>01635         <span class="keywordflow">else</span> {
<a name="l01636"></a>01636             <span class="comment">/* rel = image_path_dir - blend_dir */</span>
<a name="l01637"></a>01637             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(rel_dir, dir + len, <span class="keyword">sizeof</span>(rel_dir));
<a name="l01638"></a>01638 
<a name="l01639"></a>01639             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(dest_path, <span class="keyword">sizeof</span>(dest_path), dest_dir, rel_dir);
<a name="l01640"></a>01640             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(dest_path, <span class="keyword">sizeof</span>(dest_path), dest_path, base);
<a name="l01641"></a>01641         }
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644     <span class="comment">/* image is out of current directory */</span>
<a name="l01645"></a>01645     <span class="keywordflow">else</span> {
<a name="l01646"></a>01646         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(dest_path, <span class="keyword">sizeof</span>(dest_path), dest_dir, base);
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649     <span class="keywordflow">if</span> (abs)
<a name="l01650"></a>01650         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(abs, dest_path, abs_len);
<a name="l01651"></a>01651 
<a name="l01652"></a>01652     <span class="keywordflow">if</span> (rel) {
<a name="l01653"></a>01653         strncat(rel, rel_dir, rel_len);
<a name="l01654"></a>01654         strncat(rel, base, rel_len);
<a name="l01655"></a>01655     }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657     <span class="comment">/* return 2 if src=dest */</span>
<a name="l01658"></a>01658     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>(path, dest_path) == 0) {
<a name="l01659"></a>01659         <span class="comment">// if (G.debug &amp; G_DEBUG) printf(&quot;%s and %s are the same file\n&quot;, path, dest_path);</span>
<a name="l01660"></a>01660         <span class="keywordflow">return</span> 2;
<a name="l01661"></a>01661     }
<a name="l01662"></a>01662 
<a name="l01663"></a>01663     <span class="keywordflow">return</span> 1;
<a name="l01664"></a>01664 }
<a name="l01665"></a>01665 
<a name="l01666"></a><a class="code" href="../../db/dae/path__util_8c.html#a72677b740d029b80368d78d9b5ee45b2">01666</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a72677b740d029b80368d78d9b5ee45b2">BLI_first_slash</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>)
<a name="l01667"></a>01667 {
<a name="l01668"></a>01668     <span class="keywordtype">char</span> *ffslash, *fbslash;
<a name="l01669"></a>01669     
<a name="l01670"></a>01670     ffslash= strchr(<span class="keywordtype">string</span>, <span class="charliteral">&#39;/&#39;</span>);   
<a name="l01671"></a>01671     fbslash= strchr(<span class="keywordtype">string</span>, <span class="charliteral">&#39;\\&#39;</span>);
<a name="l01672"></a>01672     
<a name="l01673"></a>01673     <span class="keywordflow">if</span> (!ffslash) <span class="keywordflow">return</span> fbslash;
<a name="l01674"></a>01674     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fbslash) <span class="keywordflow">return</span> ffslash;
<a name="l01675"></a>01675     
<a name="l01676"></a>01676     <span class="keywordflow">if</span> ((intptr_t)ffslash &lt; (intptr_t)fbslash) <span class="keywordflow">return</span> ffslash;
<a name="l01677"></a>01677     <span class="keywordflow">else</span> <span class="keywordflow">return</span> fbslash;
<a name="l01678"></a>01678 }
<a name="l01679"></a>01679 
<a name="l01680"></a><a class="code" href="../../db/dae/path__util_8c.html#a007cee68196100b8d0d2afbbfc59df23">01680</a> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>)
<a name="l01681"></a>01681 {
<a name="l01682"></a>01682     <span class="keywordtype">char</span> *lfslash, *lbslash;
<a name="l01683"></a>01683     
<a name="l01684"></a>01684     lfslash= strrchr(<span class="keywordtype">string</span>, <span class="charliteral">&#39;/&#39;</span>);  
<a name="l01685"></a>01685     lbslash= strrchr(<span class="keywordtype">string</span>, <span class="charliteral">&#39;\\&#39;</span>);
<a name="l01686"></a>01686 
<a name="l01687"></a>01687     <span class="keywordflow">if</span> (!lfslash) <span class="keywordflow">return</span> lbslash; 
<a name="l01688"></a>01688     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!lbslash) <span class="keywordflow">return</span> lfslash;
<a name="l01689"></a>01689     
<a name="l01690"></a>01690     <span class="keywordflow">if</span> ((intptr_t)lfslash &lt; (intptr_t)lbslash) <span class="keywordflow">return</span> lbslash;
<a name="l01691"></a>01691     <span class="keywordflow">else</span> <span class="keywordflow">return</span> lfslash;
<a name="l01692"></a>01692 }
<a name="l01693"></a>01693 
<a name="l01694"></a>01694 <span class="comment">/* adds a slash if there isn&#39;t one there already */</span>
<a name="l01695"></a><a class="code" href="../../db/dae/path__util_8c.html#ab80bd3eb1d5a53807b777f4912b34cd9">01695</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab80bd3eb1d5a53807b777f4912b34cd9">BLI_add_slash</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>)
<a name="l01696"></a>01696 {
<a name="l01697"></a>01697     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="keywordtype">string</span>);
<a name="l01698"></a>01698     <span class="keywordflow">if</span> (len==0 || <span class="keywordtype">string</span>[len-1] != <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>) {
<a name="l01699"></a>01699         <span class="keywordtype">string</span>[<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>] = <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>;
<a name="l01700"></a>01700         <span class="keywordtype">string</span>[len+1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01701"></a>01701         <span class="keywordflow">return</span> len+1;
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703     <span class="keywordflow">return</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01706"></a>01706 <span class="comment">/* removes a slash if there is one */</span>
<a name="l01707"></a><a class="code" href="../../db/dae/path__util_8c.html#a204b2fde5671546457feea1dd2a78a28">01707</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a204b2fde5671546457feea1dd2a78a28">BLI_del_slash</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>)
<a name="l01708"></a>01708 {
<a name="l01709"></a>01709     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(<span class="keywordtype">string</span>);
<a name="l01710"></a>01710     <span class="keywordflow">while</span> (len) {
<a name="l01711"></a>01711         <span class="keywordflow">if</span> (<span class="keywordtype">string</span>[len-1] == <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>) {
<a name="l01712"></a>01712             <span class="keywordtype">string</span>[len-1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01713"></a>01713             len--;
<a name="l01714"></a>01714         }
<a name="l01715"></a>01715         <span class="keywordflow">else</span> {
<a name="l01716"></a>01716             <span class="keywordflow">break</span>;
<a name="l01717"></a>01717         }
<a name="l01718"></a>01718     }
<a name="l01719"></a>01719 }
<a name="l01720"></a>01720 
<a name="l01721"></a><a class="code" href="../../db/dae/path__util_8c.html#ae2d7725f0ae39460acf3620efe5746f6">01721</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/dae/path__util_8c.html#ae2d7725f0ae39460acf3620efe5746f6">add_win32_extension</a>(<span class="keywordtype">char</span> *name)
<a name="l01722"></a>01722 {
<a name="l01723"></a>01723     <span class="keywordtype">int</span> retval = 0;
<a name="l01724"></a>01724     <span class="keywordtype">int</span> type;
<a name="l01725"></a>01725 
<a name="l01726"></a>01726     type = <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a0bf59749f87b0f283c37e27e72029591">BLI_exists</a>(name);
<a name="l01727"></a>01727     <span class="keywordflow">if</span> ((type == 0) || <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#a8b545e50cb6e6bd55ed72564bf52cacc">S_ISDIR</a>(type)) {
<a name="l01728"></a>01728 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01729"></a>01729 <span class="preprocessor"></span>        <span class="keywordtype">char</span> filename[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01730"></a>01730         <span class="keywordtype">char</span> ext[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01731"></a>01731         <span class="keyword">const</span> <span class="keywordtype">char</span> *extensions = getenv(<span class="stringliteral">&quot;PATHEXT&quot;</span>);
<a name="l01732"></a>01732         <span class="keywordflow">if</span> (extensions) {
<a name="l01733"></a>01733             <span class="keywordtype">char</span> *temp;
<a name="l01734"></a>01734             <span class="keywordflow">do</span> {
<a name="l01735"></a>01735                 strcpy(filename, name);
<a name="l01736"></a>01736                 temp = strstr(extensions, <span class="stringliteral">&quot;;&quot;</span>);
<a name="l01737"></a>01737                 <span class="keywordflow">if</span> (temp) {
<a name="l01738"></a>01738                     strncpy(ext, extensions, temp - extensions);
<a name="l01739"></a>01739                     ext[temp - extensions] = 0;
<a name="l01740"></a>01740                     extensions = temp + 1;
<a name="l01741"></a>01741                     strcat(filename, ext);
<a name="l01742"></a>01742                 }
<a name="l01743"></a>01743                 <span class="keywordflow">else</span> {
<a name="l01744"></a>01744                     strcat(filename, extensions);
<a name="l01745"></a>01745                 }
<a name="l01746"></a>01746 
<a name="l01747"></a>01747                 type = <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a0bf59749f87b0f283c37e27e72029591">BLI_exists</a>(filename);
<a name="l01748"></a>01748                 <span class="keywordflow">if</span> (type &amp;&amp; (! <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#a8b545e50cb6e6bd55ed72564bf52cacc">S_ISDIR</a>(type))) {
<a name="l01749"></a>01749                     retval = 1;
<a name="l01750"></a>01750                     strcpy(name, filename);
<a name="l01751"></a>01751                     <span class="keywordflow">break</span>;
<a name="l01752"></a>01752                 }
<a name="l01753"></a>01753             } <span class="keywordflow">while</span> (temp);
<a name="l01754"></a>01754         }
<a name="l01755"></a>01755 <span class="preprocessor">#endif</span>
<a name="l01756"></a>01756 <span class="preprocessor"></span>    }
<a name="l01757"></a>01757     <span class="keywordflow">else</span> {
<a name="l01758"></a>01758         retval = 1;
<a name="l01759"></a>01759     }
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     <span class="keywordflow">return</span> (retval);
<a name="l01762"></a>01762 }
<a name="l01763"></a>01763 
<a name="l01776"></a><a class="code" href="../../db/dae/path__util_8c.html#add8893d60c0b9e5772e833fbf30f3ba1">01776</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/dae/path__util_8c.html#add8893d60c0b9e5772e833fbf30f3ba1">bli_where_am_i</a>(<span class="keywordtype">char</span> *fullname, <span class="keyword">const</span> <span class="keywordtype">size_t</span> maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01777"></a>01777 {
<a name="l01778"></a>01778     <span class="keywordtype">char</span> filename[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01779"></a>01779     <span class="keyword">const</span> <span class="keywordtype">char</span> *path = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *temp;
<a name="l01780"></a>01780 
<a name="l01781"></a>01781 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01782"></a>01782 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *separator = <span class="stringliteral">&quot;;&quot;</span>;
<a name="l01783"></a>01783 <span class="preprocessor">#else</span>
<a name="l01784"></a>01784 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *separator = <span class="stringliteral">&quot;:&quot;</span>;
<a name="l01785"></a>01785 <span class="preprocessor">#endif</span>
<a name="l01786"></a>01786 <span class="preprocessor"></span>
<a name="l01787"></a>01787     
<a name="l01788"></a>01788 <span class="preprocessor">#ifdef WITH_BINRELOC</span>
<a name="l01789"></a>01789 <span class="preprocessor"></span>    <span class="comment">/* linux uses binreloc since argv[0] is not reliable, call br_init( NULL ) first */</span>
<a name="l01790"></a>01790     path = br_find_exe( <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l01791"></a>01791     <span class="keywordflow">if</span> (path) {
<a name="l01792"></a>01792         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, path, maxlen);
<a name="l01793"></a>01793         free((<span class="keywordtype">void</span> *)path);
<a name="l01794"></a>01794         <span class="keywordflow">return</span>;
<a name="l01795"></a>01795     }
<a name="l01796"></a>01796 <span class="preprocessor">#endif</span>
<a name="l01797"></a>01797 <span class="preprocessor"></span>
<a name="l01798"></a>01798 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01799"></a>01799 <span class="preprocessor"></span>    <span class="keywordtype">wchar_t</span> * fullname_16 = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(maxlen*<span class="keyword">sizeof</span>(<span class="keywordtype">wchar_t</span>), <span class="stringliteral">&quot;ProgramPath&quot;</span>);
<a name="l01800"></a>01800     <span class="keywordflow">if</span> (GetModuleFileNameW(0, fullname_16, maxlen)) {
<a name="l01801"></a>01801         <a class="code" href="../../d6/d8a/utfconv_8c.html#af9219db4af1878313bcd54a8dc7822ec">conv_utf_16_to_8</a>(fullname_16,fullname, maxlen);
<a name="l01802"></a>01802         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a0bf59749f87b0f283c37e27e72029591">BLI_exists</a>(fullname)) {
<a name="l01803"></a>01803             printf(<span class="stringliteral">&quot;path can&#39;t be found: \&quot;%.*s\&quot;\n&quot;</span>, maxlen, fullname);
<a name="l01804"></a>01804             MessageBox(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;path contains invalid characters or is too long (see console)&quot;</span>, <span class="stringliteral">&quot;Error&quot;</span>, MB_OK);
<a name="l01805"></a>01805         }
<a name="l01806"></a>01806         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fullname_16);
<a name="l01807"></a>01807         <span class="keywordflow">return</span>;
<a name="l01808"></a>01808     }
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fullname_16);
<a name="l01811"></a>01811 <span class="preprocessor">#endif</span>
<a name="l01812"></a>01812 <span class="preprocessor"></span>
<a name="l01813"></a>01813     <span class="comment">/* unix and non linux */</span>
<a name="l01814"></a>01814     <span class="keywordflow">if</span> (name &amp;&amp; name[0]) {
<a name="l01815"></a>01815 
<a name="l01816"></a>01816         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, name, maxlen);
<a name="l01817"></a>01817         <span class="keywordflow">if</span> (name[0] == <span class="charliteral">&#39;.&#39;</span>) {
<a name="l01818"></a>01818             <span class="keywordtype">char</span> wdir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>]= <span class="stringliteral">&quot;&quot;</span>;
<a name="l01819"></a>01819             <a class="code" href="../../d2/d63/BLI__fileops_8h.html#af7f0f41c24f0b71a1da5568272855485">BLI_current_working_dir</a>(wdir, <span class="keyword">sizeof</span>(wdir));     <span class="comment">/* backup cwd to restore after */</span>
<a name="l01820"></a>01820 
<a name="l01821"></a>01821             <span class="comment">// not needed but avoids annoying /./ in name</span>
<a name="l01822"></a>01822             <span class="keywordflow">if</span> (name[1]==<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a95cf1ca63ff303311d342d1a53d51f38">SEP</a>)
<a name="l01823"></a>01823                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(fullname, maxlen, wdir, name+2);
<a name="l01824"></a>01824             <span class="keywordflow">else</span>
<a name="l01825"></a>01825                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(fullname, maxlen, wdir, name);
<a name="l01826"></a>01826 
<a name="l01827"></a>01827             <a class="code" href="../../db/dae/path__util_8c.html#ae2d7725f0ae39460acf3620efe5746f6">add_win32_extension</a>(fullname); <span class="comment">/* XXX, doesnt respect length */</span>
<a name="l01828"></a>01828         }
<a name="l01829"></a>01829         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(name)) {
<a name="l01830"></a>01830             <span class="comment">// full path</span>
<a name="l01831"></a>01831             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, name, maxlen);
<a name="l01832"></a>01832             <a class="code" href="../../db/dae/path__util_8c.html#ae2d7725f0ae39460acf3620efe5746f6">add_win32_extension</a>(fullname);
<a name="l01833"></a>01833         }
<a name="l01834"></a>01834         <span class="keywordflow">else</span> {
<a name="l01835"></a>01835             <span class="comment">// search for binary in $PATH</span>
<a name="l01836"></a>01836             path = getenv(<span class="stringliteral">&quot;PATH&quot;</span>);
<a name="l01837"></a>01837             <span class="keywordflow">if</span> (path) {
<a name="l01838"></a>01838                 <span class="keywordflow">do</span> {
<a name="l01839"></a>01839                     temp = strstr(path, separator);
<a name="l01840"></a>01840                     <span class="keywordflow">if</span> (temp) {
<a name="l01841"></a>01841                         strncpy(filename, path, temp - path);
<a name="l01842"></a>01842                         filename[temp - path] = 0;
<a name="l01843"></a>01843                         path = temp + 1;
<a name="l01844"></a>01844                     }
<a name="l01845"></a>01845                     <span class="keywordflow">else</span> {
<a name="l01846"></a>01846                         strncpy(filename, path, <span class="keyword">sizeof</span>(filename));
<a name="l01847"></a>01847                     }
<a name="l01848"></a>01848                     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(fullname, maxlen, fullname, name);
<a name="l01849"></a>01849                     <span class="keywordflow">if</span> (<a class="code" href="../../db/dae/path__util_8c.html#ae2d7725f0ae39460acf3620efe5746f6">add_win32_extension</a>(filename)) {
<a name="l01850"></a>01850                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, filename, maxlen);
<a name="l01851"></a>01851                         <span class="keywordflow">break</span>;
<a name="l01852"></a>01852                     }
<a name="l01853"></a>01853                 } <span class="keywordflow">while</span> (temp);
<a name="l01854"></a>01854             }
<a name="l01855"></a>01855         }
<a name="l01856"></a>01856 <span class="preprocessor">#if defined(DEBUG)</span>
<a name="l01857"></a>01857 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (strcmp(name, fullname)) {
<a name="l01858"></a>01858             printf(<span class="stringliteral">&quot;guessing &#39;%s&#39; == &#39;%s&#39;\n&quot;</span>, name, fullname);
<a name="l01859"></a>01859         }
<a name="l01860"></a>01860 <span class="preprocessor">#endif</span>
<a name="l01861"></a>01861 <span class="preprocessor"></span>    }
<a name="l01862"></a>01862 }
<a name="l01863"></a>01863 
<a name="l01864"></a><a class="code" href="../../db/dae/path__util_8c.html#ad6c45a1a34986019f58523b779225c61">01864</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad6c45a1a34986019f58523b779225c61">BLI_init_program_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *argv0)
<a name="l01865"></a>01865 {
<a name="l01866"></a>01866     <a class="code" href="../../db/dae/path__util_8c.html#add8893d60c0b9e5772e833fbf30f3ba1">bli_where_am_i</a>(<a class="code" href="../../db/dae/path__util_8c.html#a7edcb98ebb0717f55578f5e2c6ca1b3a">bprogname</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../db/dae/path__util_8c.html#a7edcb98ebb0717f55578f5e2c6ca1b3a">bprogname</a>), argv0);
<a name="l01867"></a>01867     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a295e8cb30935da1afb1713d0d4b493c9">BLI_split_dir_part</a>(<a class="code" href="../../db/dae/path__util_8c.html#a7edcb98ebb0717f55578f5e2c6ca1b3a">bprogname</a>, <a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">bprogdir</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">bprogdir</a>));
<a name="l01868"></a>01868 }
<a name="l01869"></a>01869 
<a name="l01870"></a><a class="code" href="../../db/dae/path__util_8c.html#ad42958c8b20fcaff27c123ef906fedaa">01870</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad42958c8b20fcaff27c123ef906fedaa">BLI_program_path</a>(<span class="keywordtype">void</span>)
<a name="l01871"></a>01871 {
<a name="l01872"></a>01872     <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a7edcb98ebb0717f55578f5e2c6ca1b3a">bprogname</a>;
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01875"></a><a class="code" href="../../db/dae/path__util_8c.html#a9b76c6f862557434d849811fc983d1b9">01875</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9b76c6f862557434d849811fc983d1b9">BLI_program_dir</a>(<span class="keywordtype">void</span>)
<a name="l01876"></a>01876 {
<a name="l01877"></a>01877     <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a0a81665b7eb1eb35f13cd963f182383b">bprogdir</a>;
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01890"></a><a class="code" href="../../db/dae/path__util_8c.html#af23537fa1ab0114004caeb46177eab2c">01890</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../db/dae/path__util_8c.html#af23537fa1ab0114004caeb46177eab2c">BLI_where_is_temp</a>(<span class="keywordtype">char</span> *fullname, <span class="keyword">const</span> <span class="keywordtype">size_t</span> maxlen, <span class="keywordtype">char</span> *userdir)
<a name="l01891"></a>01891 {
<a name="l01892"></a>01892     fullname[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01893"></a>01893     
<a name="l01894"></a>01894     <span class="keywordflow">if</span> (userdir &amp;&amp; <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(userdir)) {
<a name="l01895"></a>01895         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, userdir, maxlen);
<a name="l01896"></a>01896     }
<a name="l01897"></a>01897     
<a name="l01898"></a>01898     
<a name="l01899"></a>01899 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01900"></a>01900 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (fullname[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l01901"></a>01901         <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp = getenv(<span class="stringliteral">&quot;TEMP&quot;</span>); <span class="comment">/* Windows */</span>
<a name="l01902"></a>01902         <span class="keywordflow">if</span> (tmp &amp;&amp; <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(tmp)) {
<a name="l01903"></a>01903             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, tmp, maxlen);
<a name="l01904"></a>01904         }
<a name="l01905"></a>01905     }
<a name="l01906"></a>01906 <span class="preprocessor">#else</span>
<a name="l01907"></a>01907 <span class="preprocessor"></span>    <span class="comment">/* Other OS&#39;s - Try TMP and TMPDIR */</span>
<a name="l01908"></a>01908     <span class="keywordflow">if</span> (fullname[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l01909"></a>01909         <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp = getenv(<span class="stringliteral">&quot;TMP&quot;</span>);
<a name="l01910"></a>01910         <span class="keywordflow">if</span> (tmp &amp;&amp; <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(tmp)) {
<a name="l01911"></a>01911             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, tmp, maxlen);
<a name="l01912"></a>01912         }
<a name="l01913"></a>01913     }
<a name="l01914"></a>01914     
<a name="l01915"></a>01915     <span class="keywordflow">if</span> (fullname[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l01916"></a>01916         <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp = getenv(<span class="stringliteral">&quot;TMPDIR&quot;</span>);
<a name="l01917"></a>01917         <span class="keywordflow">if</span> (tmp &amp;&amp; <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a841e4d10028c67189a6a94066947046c">BLI_is_dir</a>(tmp)) {
<a name="l01918"></a>01918             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, tmp, maxlen);
<a name="l01919"></a>01919         }
<a name="l01920"></a>01920     }
<a name="l01921"></a>01921 <span class="preprocessor">#endif  </span>
<a name="l01922"></a>01922 <span class="preprocessor"></span>    
<a name="l01923"></a>01923     <span class="keywordflow">if</span> (fullname[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l01924"></a>01924         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fullname, <span class="stringliteral">&quot;/tmp/&quot;</span>, maxlen);
<a name="l01925"></a>01925     }
<a name="l01926"></a>01926     <span class="keywordflow">else</span> {
<a name="l01927"></a>01927         <span class="comment">/* add a trailing slash if needed */</span>
<a name="l01928"></a>01928         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab80bd3eb1d5a53807b777f4912b34cd9">BLI_add_slash</a>(fullname);
<a name="l01929"></a>01929 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01930"></a>01930 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (userdir &amp;&amp; userdir != fullname) {
<a name="l01931"></a>01931             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(userdir, fullname, maxlen); <span class="comment">/* also set user pref to show %TEMP%. /tmp/ is just plain confusing for Windows users. */</span>
<a name="l01932"></a>01932         }
<a name="l01933"></a>01933 <span class="preprocessor">#endif</span>
<a name="l01934"></a>01934 <span class="preprocessor"></span>    }
<a name="l01935"></a>01935 }
<a name="l01936"></a>01936 
<a name="l01937"></a><a class="code" href="../../db/dae/path__util_8c.html#a41c2b20d97cbc8e7901bd699e126b005">01937</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a41c2b20d97cbc8e7901bd699e126b005">BLI_init_temporary_dir</a>(<span class="keywordtype">char</span> *userdir)
<a name="l01938"></a>01938 {
<a name="l01939"></a>01939     <a class="code" href="../../db/dae/path__util_8c.html#af23537fa1ab0114004caeb46177eab2c">BLI_where_is_temp</a>(<a class="code" href="../../db/dae/path__util_8c.html#a98e40567bb9ae52181cabaaf6803a0a8">btempdir</a>, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, userdir);
<a name="l01940"></a>01940 }
<a name="l01941"></a>01941 
<a name="l01942"></a><a class="code" href="../../db/dae/path__util_8c.html#a86a333bbabf398f4d08f0a845f8d358e">01942</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a86a333bbabf398f4d08f0a845f8d358e">BLI_temporary_dir</a>(<span class="keywordtype">void</span>)
<a name="l01943"></a>01943 {
<a name="l01944"></a>01944     <span class="keywordflow">return</span> <a class="code" href="../../db/dae/path__util_8c.html#a98e40567bb9ae52181cabaaf6803a0a8">btempdir</a>;
<a name="l01945"></a>01945 }
<a name="l01946"></a>01946 
<a name="l01947"></a><a class="code" href="../../db/dae/path__util_8c.html#ab734206a6b0d3fe705bd3271fc1ed570">01947</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ab734206a6b0d3fe705bd3271fc1ed570">BLI_system_temporary_dir</a>(<span class="keywordtype">char</span> *dir)
<a name="l01948"></a>01948 {
<a name="l01949"></a>01949     <a class="code" href="../../db/dae/path__util_8c.html#af23537fa1ab0114004caeb46177eab2c">BLI_where_is_temp</a>(dir, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01950"></a>01950 }
<a name="l01951"></a>01951 
<a name="l01952"></a>01952 <span class="preprocessor">#ifdef WITH_ICONV</span>
<a name="l01953"></a>01953 <span class="preprocessor"></span>
<a name="l01954"></a>01954 <span class="keywordtype">void</span> BLI_string_to_utf8(<span class="keywordtype">char</span> *original, <span class="keywordtype">char</span> *utf_8, <span class="keyword">const</span> <span class="keywordtype">char</span> *code)
<a name="l01955"></a>01955 {
<a name="l01956"></a>01956     <span class="keywordtype">size_t</span> inbytesleft=<a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(original);
<a name="l01957"></a>01957     <span class="keywordtype">size_t</span> outbytesleft=512;
<a name="l01958"></a>01958     <span class="keywordtype">size_t</span> rv=0;
<a name="l01959"></a>01959     iconv_t cd;
<a name="l01960"></a>01960     
<a name="l01961"></a>01961     <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == code) {
<a name="l01962"></a>01962         code = locale_charset();
<a name="l01963"></a>01963     }
<a name="l01964"></a>01964     cd=iconv_open(<span class="stringliteral">&quot;UTF-8&quot;</span>, code);
<a name="l01965"></a>01965 
<a name="l01966"></a>01966     <span class="keywordflow">if</span> (cd == (iconv_t)(-1)) {
<a name="l01967"></a>01967         printf(<span class="stringliteral">&quot;iconv_open Error&quot;</span>);
<a name="l01968"></a>01968         *utf_8=<span class="charliteral">&#39;\0&#39;</span>;
<a name="l01969"></a>01969         <span class="keywordflow">return</span>;
<a name="l01970"></a>01970     }
<a name="l01971"></a>01971     rv=iconv(cd, &amp;original, &amp;inbytesleft, &amp;utf_8, &amp;outbytesleft);
<a name="l01972"></a>01972     <span class="keywordflow">if</span> (rv == (<span class="keywordtype">size_t</span>) -1) {
<a name="l01973"></a>01973         printf(<span class="stringliteral">&quot;iconv Error\n&quot;</span>);
<a name="l01974"></a>01974         <span class="keywordflow">return</span>;
<a name="l01975"></a>01975     }
<a name="l01976"></a>01976     *utf_8 = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01977"></a>01977     iconv_close(cd);
<a name="l01978"></a>01978 }
<a name="l01979"></a>01979 <span class="preprocessor">#endif // WITH_ICONV</span>
<a name="l01980"></a>01980 <span class="preprocessor"></span>
<a name="l01981"></a>01981 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:44 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

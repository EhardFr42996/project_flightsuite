<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: uvproject.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">uvproject.c</div>  </div>
</div>
<div class="contents">
<a href="../../df/dd5/uvproject_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d0c/BLI__uvproject_8h.html">BLI_uvproject.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html">00035</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> {
<a name="l00036"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#a0bae29a99487d5c985935013a0c3814f">00036</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#a0bae29a99487d5c985935013a0c3814f">camangle</a>;
<a name="l00037"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">00037</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a>;
<a name="l00038"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">00038</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#af1e7cc15bf2ff4b087a617682d7c0578">xasp</a>, <a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">yasp</a>;
<a name="l00039"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#a5648f8fd6a08cd996a1c29a6f3c38cbb">00039</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#a31d88b7d331f708d094d0c6111908749">shiftx</a>, <a class="code" href="../../dc/dca/structUvCameraInfo.html#a5648f8fd6a08cd996a1c29a6f3c38cbb">shifty</a>;
<a name="l00040"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">00040</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>[4][4];
<a name="l00041"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#a9a89a5b95b135547f32ed38add31879c">00041</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#a9a89a5b95b135547f32ed38add31879c">caminv</a>[4][4];
<a name="l00042"></a><a class="code" href="../../dc/dca/structUvCameraInfo.html#a744efc994c8bdd5f6262c7f37eee6c4a">00042</a>     <span class="keywordtype">short</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#abc01acd60c61fe6f3c1f7e732f8d476c">do_persp</a>, <a class="code" href="../../dc/dca/structUvCameraInfo.html#aa9aa215dfe4f684b0ee34fa89b860a21">do_pano</a>, <a class="code" href="../../dc/dca/structUvCameraInfo.html#a744efc994c8bdd5f6262c7f37eee6c4a">do_rotmat</a>;
<a name="l00043"></a>00043 } <a class="code" href="../../df/dd5/uvproject_8c.html#a3eccc56a20fcca35b9b8f05be413b41a">UvCameraInfo</a>;
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="../../df/dd5/uvproject_8c.html#aec4002539468d7307751e5425f03fe15">00045</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#aa0e0ea7d1c900c6ef135554d3317f380">project_from_camera</a>(<span class="keywordtype">float</span> target[2], <span class="keywordtype">float</span> source[3], <a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> *uci)
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047     <span class="keywordtype">float</span> pv4[4];
<a name="l00048"></a>00048 
<a name="l00049"></a>00049     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pv4, source);
<a name="l00050"></a>00050     pv4[3] = 1.0;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <span class="comment">/* rotmat is the object matrix in this case */</span>
<a name="l00053"></a>00053     <span class="keywordflow">if</span> (uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a744efc994c8bdd5f6262c7f37eee6c4a">do_rotmat</a>)
<a name="l00054"></a>00054         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>, pv4);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056     <span class="comment">/* caminv is the inverse camera matrix */</span>
<a name="l00057"></a>00057     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a9a89a5b95b135547f32ed38add31879c">caminv</a>, pv4);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="keywordflow">if</span> (uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#aa9aa215dfe4f684b0ee34fa89b860a21">do_pano</a>) {
<a name="l00060"></a>00060         <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a> = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#ab616618cf09fc0ef5c0ec0d9e5825f58">atan2f</a>(pv4[0], -pv4[2]) / ((float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 2.0f); <span class="comment">/* angle around the camera */</span>
<a name="l00061"></a>00061         <span class="keywordflow">if</span> (uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#abc01acd60c61fe6f3c1f7e732f8d476c">do_persp</a> == 0) {
<a name="l00062"></a>00062             target[0] = <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>; <span class="comment">/* no correct method here, just map to  0-1 */</span>
<a name="l00063"></a>00063             target[1] = pv4[1] / uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a>;
<a name="l00064"></a>00064         }
<a name="l00065"></a>00065         <span class="keywordflow">else</span> {
<a name="l00066"></a>00066             <span class="keywordtype">float</span> <a class="code" href="../../d4/d26/gim__geom__types_8h.html#a1862092cd9b18b2c82100e6573758ae6" title="Double vector 2D.">vec2d</a>[2]; <span class="comment">/* 2D position from the camera */</span>
<a name="l00067"></a>00067             vec2d[0] = pv4[0];
<a name="l00068"></a>00068             vec2d[1] = pv4[2];
<a name="l00069"></a>00069             target[0] = angle * ((float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a0bae29a99487d5c985935013a0c3814f">camangle</a>);
<a name="l00070"></a>00070             target[1] = pv4[1] / (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a524206121dfa19c9c14423f3a96fcb2b">len_v2</a>(vec2d) * (uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a> * 2.0f));
<a name="l00071"></a>00071         }
<a name="l00072"></a>00072     }
<a name="l00073"></a>00073     <span class="keywordflow">else</span> {
<a name="l00074"></a>00074         <span class="keywordflow">if</span> (pv4[2] == 0.0f)
<a name="l00075"></a>00075             pv4[2] = 0.00001f; <span class="comment">/* don&#39;t allow div by 0 */</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         <span class="keywordflow">if</span> (uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#abc01acd60c61fe6f3c1f7e732f8d476c">do_persp</a> == 0) {
<a name="l00078"></a>00078             target[0] = (pv4[0] / uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a>);
<a name="l00079"></a>00079             target[1] = (pv4[1] / uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a>);
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081         <span class="keywordflow">else</span> {
<a name="l00082"></a>00082             target[0] = (-pv4[0] * ((1.0f / uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a>) / pv4[2])) / 2.0f;
<a name="l00083"></a>00083             target[1] = (-pv4[1] * ((1.0f / uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a>) / pv4[2])) / 2.0f;
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     target[0] *= uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#af1e7cc15bf2ff4b087a617682d7c0578">xasp</a>;
<a name="l00088"></a>00088     target[1] *= uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">yasp</a>;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="comment">/* adds camera shift + 0.5 */</span>
<a name="l00091"></a>00091     target[0] += uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a31d88b7d331f708d094d0c6111908749">shiftx</a>;
<a name="l00092"></a>00092     target[1] += uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5648f8fd6a08cd996a1c29a6f3c38cbb">shifty</a>;
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/* could rv3d-&gt;persmat */</span>
<a name="l00096"></a><a class="code" href="../../df/dd5/uvproject_8c.html#a2e7336af0afa99804b813a647bef9737">00096</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#a2e7336af0afa99804b813a647bef9737">project_from_view</a>(<span class="keywordtype">float</span> target[2], <span class="keywordtype">float</span> source[3], <span class="keywordtype">float</span> persmat[4][4], <span class="keywordtype">float</span> rotmat[4][4], <span class="keywordtype">float</span> winx, <span class="keywordtype">float</span> winy)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <span class="keywordtype">float</span> pv[3], pv4[4], x = 0.0, y = 0.0;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(pv, rotmat, source);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pv4, source);
<a name="l00103"></a>00103     pv4[3] = 1.0;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="comment">/* rotmat is the object matrix in this case */</span>
<a name="l00106"></a>00106     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(rotmat, pv4);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="comment">/* almost project_short */</span>
<a name="l00109"></a>00109     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(persmat, pv4);
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(pv4[3]) &gt; 0.00001f) { <span class="comment">/* avoid division by zero */</span>
<a name="l00111"></a>00111         target[0] = winx / 2.0f + (winx / 2.0f) * pv4[0] / pv4[3];
<a name="l00112"></a>00112         target[1] = winy / 2.0f + (winy / 2.0f) * pv4[1] / pv4[3];
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     <span class="keywordflow">else</span> {
<a name="l00115"></a>00115         <span class="comment">/* scaling is lost but give a valid result */</span>
<a name="l00116"></a>00116         target[0] = winx / 2.0f + (winx / 2.0f) * pv4[0];
<a name="l00117"></a>00117         target[1] = winy / 2.0f + (winy / 2.0f) * pv4[1];
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="comment">/* v3d-&gt;persmat seems to do this funky scaling */</span>
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (winx &gt; winy) {
<a name="l00122"></a>00122         y = (winx - winy) / 2.0f;
<a name="l00123"></a>00123         winy = winx;
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125     <span class="keywordflow">else</span> {
<a name="l00126"></a>00126         x = (winy - winx) / 2.0f;
<a name="l00127"></a>00127         winx = winy;
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     target[0] = (x + target[0]) / winx;
<a name="l00131"></a>00131     target[1] = (y + target[1]) / winy;
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <span class="comment">/* &#39;rotmat&#39; can be obedit-&gt;obmat when uv project is used.</span>
<a name="l00135"></a>00135 <span class="comment"> * &#39;winx&#39; and &#39;winy&#39; can be from scene-&gt;r.xsch/ysch */</span>
<a name="l00136"></a><a class="code" href="../../df/dd5/uvproject_8c.html#a15a07f1cc5e8bf7ea91f34c43433b3d0">00136</a> <a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> *<a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#a8d81ee39c6502a048907d0547fd21d5b">project_camera_info</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">float</span>(*rotmat)[4], <span class="keywordtype">float</span> winx, <span class="keywordtype">float</span> winy)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> uci;
<a name="l00139"></a>00139     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *camera = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#aa9aa215dfe4f684b0ee34fa89b860a21">do_pano</a> = (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> &amp; <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a2cc8f6e08560c47032ee909c2d7cc2ea">CAM_PANORAMA</a>);
<a name="l00142"></a>00142     uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#abc01acd60c61fe6f3c1f7e732f8d476c">do_persp</a> = (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#abd4c2c91f9398b35caaa737a7bc6da3b">type</a> == <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a536998ae3a08d2731455a7a7964393a6">CAM_PERSP</a>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a0bae29a99487d5c985935013a0c3814f">camangle</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aa70637ba49b8a76d953fb3d676eec7eb">focallength_to_fov</a>(camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>, camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#acdf39c5ffbd9b9363fd230256a6a5bef">sensor_x</a>) / 2.0f;
<a name="l00145"></a>00145     uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5929b8689ecf8dafc0c51a16cb5279b0">camsize</a> = uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#abc01acd60c61fe6f3c1f7e732f8d476c">do_persp</a> ? <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a8399002c5cbbff754c83f8b9ac3d77e8">tanf</a>(uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a0bae29a99487d5c985935013a0c3814f">camangle</a>) : camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">/* account for scaled cameras */</span>
<a name="l00148"></a>00148     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a9a89a5b95b135547f32ed38add31879c">caminv</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00149"></a>00149     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a927af9664e9476288c23d0f5e59c4edc">normalize_m4</a>(uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a9a89a5b95b135547f32ed38add31879c">caminv</a>);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a64a4f057663e6d9174264739ac12fd34">invert_m4</a>(uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a9a89a5b95b135547f32ed38add31879c">caminv</a>)) {
<a name="l00152"></a>00152         <a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> *uci_pt;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="comment">/* normal projection */</span>
<a name="l00155"></a>00155         <span class="keywordflow">if</span> (rotmat) {
<a name="l00156"></a>00156             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>, rotmat);
<a name="l00157"></a>00157             uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a744efc994c8bdd5f6262c7f37eee6c4a">do_rotmat</a> = 1;
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159         <span class="keywordflow">else</span> {
<a name="l00160"></a>00160             uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a744efc994c8bdd5f6262c7f37eee6c4a">do_rotmat</a> = 0;
<a name="l00161"></a>00161         }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="comment">/* also make aspect ratio adjustment factors */</span>
<a name="l00164"></a>00164         <span class="keywordflow">if</span> (winx &gt; winy) {
<a name="l00165"></a>00165             uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#af1e7cc15bf2ff4b087a617682d7c0578">xasp</a> = 1.0f;
<a name="l00166"></a>00166             uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">yasp</a> = winx / winy;
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168         <span class="keywordflow">else</span> {
<a name="l00169"></a>00169             uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#af1e7cc15bf2ff4b087a617682d7c0578">xasp</a> = winy / winx;
<a name="l00170"></a>00170             uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">yasp</a> = 1.0f;
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <span class="comment">/* include 0.5f here to move the UVs into the center */</span>
<a name="l00174"></a>00174         uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a31d88b7d331f708d094d0c6111908749">shiftx</a> = 0.5f - (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a69e033fd80e2390b579d43d81b79f1c7">shiftx</a> * uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#af1e7cc15bf2ff4b087a617682d7c0578">xasp</a>);
<a name="l00175"></a>00175         uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a5648f8fd6a08cd996a1c29a6f3c38cbb">shifty</a> = 0.5f - (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ae9ed1d789ff2218ca0c0f2170353d563">shifty</a> * uci.<a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">yasp</a>);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         uci_pt = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a>), <span class="stringliteral">&quot;UvCameraInfo&quot;</span>);
<a name="l00178"></a>00178         *uci_pt = uci;
<a name="l00179"></a>00179         <span class="keywordflow">return</span> uci_pt;
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="../../df/dd5/uvproject_8c.html#a918298b4b425a1e33e2f4d23bb5c8e0f">00185</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#a918298b4b425a1e33e2f4d23bb5c8e0f">project_from_view_ortho</a>(<span class="keywordtype">float</span> target[2], <span class="keywordtype">float</span> source[3], <span class="keywordtype">float</span> rotmat[4][4])
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187     <span class="keywordtype">float</span> pv[3];
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(pv, rotmat, source);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment">/* ortho projection */</span>
<a name="l00192"></a>00192     target[0] = -pv[0];
<a name="l00193"></a>00193     target[1] = pv[2];
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="../../df/dd5/uvproject_8c.html#a8a0c7d6d76901dcf37f07fd99106db9e">00196</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#aca2a1572bad604f72b3766f3cd4bdeec">project_camera_info_scale</a>(<a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> *uci, <span class="keywordtype">float</span> scale_x, <span class="keywordtype">float</span> scale_y)
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198     uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#af1e7cc15bf2ff4b087a617682d7c0578">xasp</a> *= scale_x;
<a name="l00199"></a>00199     uci-&gt;<a class="code" href="../../dc/dca/structUvCameraInfo.html#a926412b93a7ebd10b3ffdf4c095ec6bd">yasp</a> *= scale_y;
<a name="l00200"></a>00200 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:02 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: wm_event_system.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">wm_event_system.c</div>  </div>
</div>
<div class="contents">
<a href="../../df/db0/wm__event__system_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2007 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * </span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Blender Foundation</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d43/DNA__listBase_8h.html" title="These structs are the foundation for all linked lists in the library system.">DNA_listBase.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html">DNA_windowmanager_types.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de4/DNA__userdef__types_8h.html">DNA_userdef_types.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d51/GHOST__C-api_8h.html" title="GHOST C-API function and type declarations.">GHOST_C-api.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/ddf/BKE__blender_8h.html" title="Blender util stuff.">BKE_blender.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d95/BKE__idprop_8h.html">BKE_idprop.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/db1/BKE__sound_8h.html">BKE_sound.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../db/db9/ED__fileselect_8h.html">ED_fileselect.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dd7/ED__info_8h.html">ED_info.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d53/ED__render_8h.html">ED_render.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/df1/ED__util_8h.html">ED_util.h</a>&quot;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd6/wm_8h.html">wm.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d6b/wm__window_8h.html">wm_window.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d44/wm__event__system_8h.html">wm_event_system.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d40/wm__event__types_8h.html">wm_event_types.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dfb/wm__draw_8h.html">wm_draw.h</a>&quot;</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a52d92ec307f4142a03e738e96e8237d6">wm_operator_call_internal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports,
<a name="l00086"></a>00086                                      <span class="keywordtype">short</span> context, <span class="keywordtype">short</span> poll_only);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* ************ event management ************** */</span>
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a615cbf4171217a997c566bfab4969b6f">00090</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event_to_add)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<span class="keyword">event</span> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a>), <span class="stringliteral">&quot;wmEvent&quot;</span>);
<a name="l00093"></a>00093     
<a name="l00094"></a>00094     *<span class="keyword">event</span> = *event_to_add;
<a name="l00095"></a>00095     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>, event);
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="../../de/d44/wm__event__system_8h.html#ac9182bd2ae46daa1aab656d70edfd12f">00098</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ac9182bd2ae46daa1aab656d70edfd12f">wm_event_free</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>) {
<a name="l00101"></a>00101         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7df1658c9f61db247e65141d1e64a336">customdatafree</a>) {
<a name="l00102"></a>00102             <span class="comment">/* note: pointer to listbase struct elsewhere */</span>
<a name="l00103"></a>00103             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a276cd44fa9cab09b621a83980b335b47">custom</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3a1b2b37da9cfd337ee6eed0a8d27f11">EVT_DATA_LISTBASE</a>)
<a name="l00104"></a>00104                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>);
<a name="l00105"></a>00105             <span class="keywordflow">else</span>
<a name="l00106"></a>00106                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>);
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(event);
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="../../de/d44/wm__event__system_8h.html#a673c41499d28d22984dbd15dc605229f">00112</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a673c41499d28d22984dbd15dc605229f">wm_event_free_all</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event;
<a name="l00115"></a>00115     
<a name="l00116"></a>00116     <span class="keywordflow">while</span> ((event = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)) {
<a name="l00117"></a>00117         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>, event);
<a name="l00118"></a>00118         <a class="code" href="../../df/db0/wm__event__system_8c.html#ac9182bd2ae46daa1aab656d70edfd12f">wm_event_free</a>(event);
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">/* ********************* notifiers, listeners *************** */</span>
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a238446cfb53ec5615efebed1cc84eb0b">00124</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a238446cfb53ec5615efebed1cc84eb0b">wm_test_duplicate_notifier</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <span class="keywordtype">void</span> *reference)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *note;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="keywordflow">for</span> (note = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; note; note = note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#aed47cb8e7dde2f40fb63bffec3ab44b5">next</a>)
<a name="l00129"></a>00129         <span class="keywordflow">if</span> ((note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> | note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> | note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#abee9ae8d3103b68a62a877e4f7091c14">subtype</a> | note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a1127cef43584875c4ec84b1d3b7dc655">action</a>) == type &amp;&amp; note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> == reference)
<a name="l00130"></a>00130             <span class="keywordflow">return</span> 1;
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     <span class="keywordflow">return</span> 0;
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">/* XXX: in future, which notifiers to send to other windows? */</span>
<a name="l00136"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">00136</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <span class="keywordtype">void</span> *reference)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *note = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a>), <span class="stringliteral">&quot;notifier&quot;</span>);
<a name="l00139"></a>00139     
<a name="l00140"></a>00140     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a97b3fac1b9ffb6612448d76891e1f67a">wm</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00141"></a>00141     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a97b3fac1b9ffb6612448d76891e1f67a">wm</a>-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>, note);
<a name="l00142"></a>00142     
<a name="l00143"></a>00143     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae8024df3ef630e2dd95cbc6084856571">window</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00144"></a>00144     
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C))
<a name="l00146"></a>00146         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a2468d7326422d6a5d277c846ce93547d">swinid</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C)-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>;
<a name="l00147"></a>00147     
<a name="l00148"></a>00148     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#ab7a9c6880d36978ebc85e21e69648858">NOTE_CATEGORY</a>;
<a name="l00149"></a>00149     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a776b8be6c7a001643ef889d2ee387499">NOTE_DATA</a>;
<a name="l00150"></a>00150     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#abee9ae8d3103b68a62a877e4f7091c14">subtype</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#aa9c285162f92295e3b8b001e5e88d83f">NOTE_SUBTYPE</a>;
<a name="l00151"></a>00151     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a1127cef43584875c4ec84b1d3b7dc655">action</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a34604fdaed9499533a6a5f5ffb5c1ae6">NOTE_ACTION</a>;
<a name="l00152"></a>00152     
<a name="l00153"></a>00153     note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> = reference;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a2d4bab7477e1a026061d578f19247457">00156</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <span class="keywordtype">void</span> *reference)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l00159"></a>00159     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1c415972a9fb2c7ce05e14d83affa0d8">wm</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="keywordflow">if</span> (wm &amp;&amp; !<a class="code" href="../../df/db0/wm__event__system_8c.html#a238446cfb53ec5615efebed1cc84eb0b">wm_test_duplicate_notifier</a>(wm, type, reference)) {
<a name="l00162"></a>00162         <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *note = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a>), <span class="stringliteral">&quot;notifier&quot;</span>);
<a name="l00163"></a>00163         
<a name="l00164"></a>00164         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a97b3fac1b9ffb6612448d76891e1f67a">wm</a> = wm;
<a name="l00165"></a>00165         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a97b3fac1b9ffb6612448d76891e1f67a">wm</a>-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>, note);
<a name="l00166"></a>00166         
<a name="l00167"></a>00167         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#ab7a9c6880d36978ebc85e21e69648858">NOTE_CATEGORY</a>;
<a name="l00168"></a>00168         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a776b8be6c7a001643ef889d2ee387499">NOTE_DATA</a>;
<a name="l00169"></a>00169         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#abee9ae8d3103b68a62a877e4f7091c14">subtype</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#aa9c285162f92295e3b8b001e5e88d83f">NOTE_SUBTYPE</a>;
<a name="l00170"></a>00170         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a1127cef43584875c4ec84b1d3b7dc655">action</a> = type &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a34604fdaed9499533a6a5f5ffb5c1ae6">NOTE_ACTION</a>;
<a name="l00171"></a>00171         
<a name="l00172"></a>00172         note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> = reference;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a138c97ba42f817ee34b9d975540f6937">00176</a> <span class="keyword">static</span> <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a138c97ba42f817ee34b9d975540f6937">wm_notifier_next</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *note = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00179"></a>00179     
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (note) <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>, note);
<a name="l00181"></a>00181     <span class="keywordflow">return</span> note;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">/* called in mainloop */</span>
<a name="l00185"></a><a class="code" href="../../de/d44/wm__event__system_8h.html#ae07f870fa6be64adb86a6f76923c8924">00185</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ae07f870fa6be64adb86a6f76923c8924">wm_event_do_notifiers</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00188"></a>00188     <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *note, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00189"></a>00189     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l00190"></a>00190     uint64_t win_combine_v3d_datamask = 0;
<a name="l00191"></a>00191     
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (wm == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00193"></a>00193         <span class="keywordflow">return</span>;
<a name="l00194"></a>00194     
<a name="l00195"></a>00195     <span class="comment">/* cache &amp; catch WM level notifiers, such as frame change, scene/screen set */</span>
<a name="l00196"></a>00196     <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l00197"></a>00197         <span class="keywordtype">int</span> do_anim = 0;
<a name="l00198"></a>00198         
<a name="l00199"></a>00199         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l00200"></a>00200         
<a name="l00201"></a>00201         <span class="keywordflow">for</span> (note = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; note; note = next) {
<a name="l00202"></a>00202             next = note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#aed47cb8e7dde2f40fb63bffec3ab44b5">next</a>;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a2401e8c966e41d3d8dec9d54fd68c630">NC_WM</a>) {
<a name="l00205"></a>00205                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a166393c0222fcb6591ea603f36d8654c">ND_FILEREAD</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#ab1971a34df0d5f42b549ad2980385e10">ND_FILESAVE</a>)) {
<a name="l00206"></a>00206                     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a3d768f736d940df5ad6b3f95f28c3de0">file_saved</a> = 1;
<a name="l00207"></a>00207                     <a class="code" href="../../d7/d6e/wm__window_8c.html#a499f04b3bfe24b1ffe383ccdd1ae9e5f">wm_window_title</a>(wm, win);
<a name="l00208"></a>00208                 }
<a name="l00209"></a>00209                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a4737908aff6c8a9990a575570edcd9e5">ND_DATACHANGED</a>)
<a name="l00210"></a>00210                     <a class="code" href="../../d7/d6e/wm__window_8c.html#a499f04b3bfe24b1ffe383ccdd1ae9e5f">wm_window_title</a>(wm, win);
<a name="l00211"></a>00211             }
<a name="l00212"></a>00212             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae8024df3ef630e2dd95cbc6084856571">window</a> == win) {
<a name="l00213"></a>00213                 <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a>) {
<a name="l00214"></a>00214                     <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a024a1d387080576fe2eb4b5cfd30efd8">ND_SCREENBROWSE</a>) {
<a name="l00215"></a>00215                         <a class="code" href="../../d1/d12/ED__screen_8h.html#a5055a39580a193e017808b6f51a0c8a3">ED_screen_set</a>(C, note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a>);  <span class="comment">// XXX hrms, think this over!</span>
<a name="l00216"></a>00216                         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>)
<a name="l00217"></a>00217                             printf(<span class="stringliteral">&quot;%s: screen set %p\n&quot;</span>, __func__, note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a>);
<a name="l00218"></a>00218                     }
<a name="l00219"></a>00219                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a9a73baf3e1573cc377e6368cae4b8fd5">ND_SCREENDELETE</a>) {
<a name="l00220"></a>00220                         <a class="code" href="../../d1/d12/ED__screen_8h.html#ad9eb1577eba36376f3c8144dedfbc710">ED_screen_delete</a>(C, note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a>);   <span class="comment">// XXX hrms, think this over!</span>
<a name="l00221"></a>00221                         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>)
<a name="l00222"></a>00222                             printf(<span class="stringliteral">&quot;%s: screen delete %p\n&quot;</span>, __func__, note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a>);
<a name="l00223"></a>00223                     }
<a name="l00224"></a>00224                 }
<a name="l00225"></a>00225             }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae8024df3ef630e2dd95cbc6084856571">window</a> == win ||
<a name="l00228"></a>00228                 (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae8024df3ef630e2dd95cbc6084856571">window</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> == <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C))))
<a name="l00229"></a>00229             {
<a name="l00230"></a>00230                 <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>) {
<a name="l00231"></a>00231                     <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a93a7b7f4bba572e9176db2aa580d7aa9">ND_FRAME</a>)
<a name="l00232"></a>00232                         do_anim = 1;
<a name="l00233"></a>00233                 }
<a name="l00234"></a>00234             }
<a name="l00235"></a>00235             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a94fe4335845faafd0b969e89a13d8c76">ELEM5</a>(note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a2401e8c966e41d3d8dec9d54fd68c630">NC_WM</a>)) {
<a name="l00236"></a>00236                 <a class="code" href="../../d0/dd7/ED__info_8h.html#ae6b0bc095b43af741d3c403e8e966fa5">ED_info_stats_clear</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C));
<a name="l00237"></a>00237                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#af1c384817f70d0a752fc68681535fcc9">NC_SPACE</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a1942092916fdc7c089a6d191c71d6f5b">ND_SPACE_INFO</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00238"></a>00238             }
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (do_anim) {
<a name="l00241"></a>00241 
<a name="l00242"></a>00242             <span class="comment">/* XXX, quick frame changes can cause a crash if framechange and rendering</span>
<a name="l00243"></a>00243 <span class="comment">             * collide (happens on slow scenes), scene_update_for_newframe can be called</span>
<a name="l00244"></a>00244 <span class="comment">             * twice which can depgraph update the same object at once */</span>
<a name="l00245"></a>00245             <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rendering) {
<a name="l00246"></a>00246 
<a name="l00247"></a>00247                 <span class="comment">/* depsgraph gets called, might send more notifiers */</span>
<a name="l00248"></a>00248                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a064a1225eaf305ae55dc93b0d35fbf82">ED_update_for_newframe</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C), win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>, 1);
<a name="l00249"></a>00249             }
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252     
<a name="l00253"></a>00253     <span class="comment">/* the notifiers are sent without context, to keep it clean */</span>
<a name="l00254"></a>00254     <span class="keywordflow">while</span> ( (note = <a class="code" href="../../df/db0/wm__event__system_8c.html#a138c97ba42f817ee34b9d975540f6937">wm_notifier_next</a>(wm)) ) {
<a name="l00255"></a>00255         <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l00256"></a>00256             
<a name="l00257"></a>00257             <span class="comment">/* filter out notifiers */</span>
<a name="l00258"></a>00258             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a> &amp;&amp; note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> &amp;&amp; note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> != win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>) ;
<a name="l00259"></a>00259             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a> &amp;&amp; note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> &amp;&amp; note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#ae6b35e6d9d11657a5ee311b72ea3de5d">reference</a> != win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>) ;
<a name="l00260"></a>00260             <span class="keywordflow">else</span> {
<a name="l00261"></a>00261                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00262"></a>00262                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264                 <span class="comment">/* XXX context in notifiers? */</span>
<a name="l00265"></a>00265                 <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267                 <span class="comment">/* printf(&quot;notifier win %d screen %s cat %x\n&quot;, win-&gt;winid, win-&gt;screen-&gt;id.name+2, note-&gt;category); */</span>
<a name="l00268"></a>00268                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a0b98d841c6a5e0ef5b2187f982f01a29">ED_screen_do_listen</a>(C, note);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270                 <span class="keywordflow">for</span> (ar = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l00271"></a>00271                     <a class="code" href="../../d1/d12/ED__screen_8h.html#afd9cb6fd3a47a4588d00602500cd4cfb">ED_region_do_listen</a>(ar, note);
<a name="l00272"></a>00272                 }
<a name="l00273"></a>00273                 
<a name="l00274"></a>00274                 <span class="keywordflow">for</span> (sa = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l00275"></a>00275                     <a class="code" href="../../d1/d12/ED__screen_8h.html#a77e17cb49f42c8f3975f9ae89a0284b8">ED_area_do_listen</a>(sa, note);
<a name="l00276"></a>00276                     <span class="keywordflow">for</span> (ar = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l00277"></a>00277                         <a class="code" href="../../d1/d12/ED__screen_8h.html#afd9cb6fd3a47a4588d00602500cd4cfb">ED_region_do_listen</a>(ar, note);
<a name="l00278"></a>00278                     }
<a name="l00279"></a>00279                 }
<a name="l00280"></a>00280             }
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282         
<a name="l00283"></a>00283         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(note);
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285     
<a name="l00286"></a>00286     <span class="comment">/* combine datamasks so 1 win doesn&#39;t disable UV&#39;s in another [#26448] */</span>
<a name="l00287"></a>00287     <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l00288"></a>00288         win_combine_v3d_datamask |= <a class="code" href="../../d8/d6a/ED__view3d_8h.html#acea0129ba5bb9e2e2adc7b6fa644b1ba">ED_view3d_screen_datamask</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>);
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="comment">/* cached: editor refresh callbacks now, they get context */</span>
<a name="l00292"></a>00292     <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l00293"></a>00293         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00294"></a>00294         
<a name="l00295"></a>00295         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l00296"></a>00296         <span class="keywordflow">for</span> (sa = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l00297"></a>00297             <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ad5ba6eb55de1ca8200b4829a3fc1a566">do_refresh</a>) {
<a name="l00298"></a>00298                 <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sa);
<a name="l00299"></a>00299                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a587db188a62ef706857926eca9cdaff3">ED_area_do_refresh</a>(C, sa);
<a name="l00300"></a>00300             }
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302         
<a name="l00303"></a>00303         <span class="comment">/* XXX make lock in future, or separated derivedmesh users in scene */</span>
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rendering) {
<a name="l00305"></a>00305             <span class="comment">/* depsgraph &amp; animation: update tagged datablocks */</span>
<a name="l00306"></a>00306             <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain = <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308             <span class="comment">/* copied to set&#39;s in scene_update_tagged_recursive() */</span>
<a name="l00309"></a>00309             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a3a4f81e0f2023f6834ccb638ed26cd0c">customdata_mask</a> = win_combine_v3d_datamask;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311             <span class="comment">/* XXX, hack so operators can enforce datamasks [#26482], gl render */</span>
<a name="l00312"></a>00312             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a3a4f81e0f2023f6834ccb638ed26cd0c">customdata_mask</a> |= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a174dd84bce4450b19e545a4e625920e4">customdata_mask_modal</a>;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314             <a class="code" href="../../d8/d53/BKE__scene_8h.html#af5a89c5f90e68841a7f06e0239f6bcae">scene_update_tagged</a>(bmain, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>);
<a name="l00315"></a>00315         }
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a2dfa757b9be8ede8a1044c3f5dac6a81">00321</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a2dfa757b9be8ede8a1044c3f5dac6a81">wm_event_always_pass</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323     <span class="comment">/* some events we always pass on, to ensure proper communication */</span>
<a name="l00324"></a>00324     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe0cd1c5e97107d1df74e15a9ea3c682">ISTIMER</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) || (<span class="keyword">event</span>-&gt;type == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aedc39a0f069c3164e42a4ab800df57d4">WINDEACTIVATE</a>);
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="comment">/* ********************* ui handler ******************* */</span>
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#ab22211f5839a39a0e4a49d45321ba0a7">00329</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ab22211f5839a39a0e4a49d45321ba0a7">wm_handler_ui_call</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">int</span> always_pass)
<a name="l00330"></a>00330 {
<a name="l00331"></a>00331     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00332"></a>00332     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *region = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00333"></a>00333     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *menu = <a class="code" href="../../df/d01/BKE__context_8h.html#a2753b66475f5c46f20ba08a747dd019d">CTX_wm_menu</a>(C);
<a name="l00334"></a>00334     <span class="keyword">static</span> <span class="keywordtype">int</span> do_wheel_ui = 1;
<a name="l00335"></a>00335     <span class="keywordtype">int</span> is_wheel = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>);
<a name="l00336"></a>00336     <span class="keywordtype">int</span> retval;
<a name="l00337"></a>00337     
<a name="l00338"></a>00338     <span class="comment">/* UI is quite aggressive with swallowing events, like scrollwheel */</span>
<a name="l00339"></a>00339     <span class="comment">/* I realize this is not extremely nice code... when UI gets keymaps it can be maybe smarter */</span>
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (do_wheel_ui == 0) {
<a name="l00341"></a>00341         <span class="keywordflow">if</span> (is_wheel)
<a name="l00342"></a>00342             <span class="keywordflow">return</span> <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a>;
<a name="l00343"></a>00343         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a2dfa757b9be8ede8a1044c3f5dac6a81">wm_event_always_pass</a>(event) == 0)
<a name="l00344"></a>00344             do_wheel_ui = 1;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346     
<a name="l00347"></a>00347     <span class="comment">/* we set context to where ui handler came from */</span>
<a name="l00348"></a>00348     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9c59ce912d8a1c2a8bdde580e38e23b4">ui_area</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9c59ce912d8a1c2a8bdde580e38e23b4">ui_area</a>);
<a name="l00349"></a>00349     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a09f78ad35020e7779a4965cc22de87d2">ui_region</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a09f78ad35020e7779a4965cc22de87d2">ui_region</a>);
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ac7403aada39c85bd5bfd56da978abd27">ui_menu</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#a472d961c6c917b76140a73038341676e">CTX_wm_menu_set</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ac7403aada39c85bd5bfd56da978abd27">ui_menu</a>);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     retval = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a>(C, event, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a190cb3c5434af0dc7b7cffe03d5878b4">ui_userdata</a>);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="comment">/* putting back screen context */</span>
<a name="l00355"></a>00355     <span class="keywordflow">if</span> ((retval != <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>) || always_pass) {
<a name="l00356"></a>00356         <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area);
<a name="l00357"></a>00357         <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, region);
<a name="l00358"></a>00358         <a class="code" href="../../df/d01/BKE__context_8h.html#a472d961c6c917b76140a73038341676e">CTX_wm_menu_set</a>(C, menu);
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360     <span class="keywordflow">else</span> {
<a name="l00361"></a>00361         <span class="comment">/* this special cases is for areas and regions that get removed */</span>
<a name="l00362"></a>00362         <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00363"></a>00363         <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00364"></a>00364         <a class="code" href="../../df/d01/BKE__context_8h.html#a472d961c6c917b76140a73038341676e">CTX_wm_menu_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>)
<a name="l00368"></a>00368         <span class="keywordflow">return</span> <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>;
<a name="l00369"></a>00369     
<a name="l00370"></a>00370     <span class="comment">/* event not handled in UI, if wheel then we temporarily disable it */</span>
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (is_wheel)
<a name="l00372"></a>00372         do_wheel_ui = 0;
<a name="l00373"></a>00373     
<a name="l00374"></a>00374     <span class="keywordflow">return</span> <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a>;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a4a846576fd198015a059e3f46c5dfccc">00377</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a4a846576fd198015a059e3f46c5dfccc">wm_handler_ui_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00380"></a>00380     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00381"></a>00381     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, *nexthandler;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (!ar)
<a name="l00384"></a>00384         <span class="keywordflow">return</span>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="keywordflow">for</span> (handler = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = nexthandler) {
<a name="l00387"></a>00387         nexthandler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a>) {
<a name="l00390"></a>00390             <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> <span class="keyword">event</span> = *(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);
<a name="l00391"></a>00391             <span class="keyword">event</span>.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#acd3c0daf8c9c1c59de98513ee0a1127a">EVT_BUT_CANCEL</a>;
<a name="l00392"></a>00392             handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a>(C, &amp;event, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a190cb3c5434af0dc7b7cffe03d5878b4">ui_userdata</a>);
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">/* ********************* operators ******************* */</span>
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a1dce92478d3b1a4500492874ea784cdd">00399</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a9a97e0b7a1e43624abb8a0d37d21f161">WM_operator_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401     <a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html">wmOperatorTypeMacro</a> *otmacro;
<a name="l00402"></a>00402     
<a name="l00403"></a>00403     <span class="keywordflow">for</span> (otmacro = ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#af6ae4868d49a32a04ae409bdf31f5bc4">macro</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; otmacro; otmacro = otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#aa004c90cec9a18f64ee550209fd1deaa">next</a>) {
<a name="l00404"></a>00404         <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot_macro = <a class="code" href="../../d6/dae/wm__operators_8c.html#a10ed9150324ef83e52559b8cb5293c4b">WM_operatortype_find</a>(otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#a3a82b0c4f849b6795d81d46cbd321dd9">idname</a>, 0);
<a name="l00405"></a>00405         
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (0 == <a class="code" href="../../df/db0/wm__event__system_8c.html#a9a97e0b7a1e43624abb8a0d37d21f161">WM_operator_poll</a>(C, ot_macro))
<a name="l00407"></a>00407             <span class="keywordflow">return</span> 0;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409     
<a name="l00410"></a>00410     <span class="comment">/* python needs operator type, so we added exception for it */</span>
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa1f05e6fd919eacb38061df904fc881e">pyop_poll</a>)
<a name="l00412"></a>00412         <span class="keywordflow">return</span> ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa1f05e6fd919eacb38061df904fc881e">pyop_poll</a>(C, ot);
<a name="l00413"></a>00413     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a>)
<a name="l00414"></a>00414         <span class="keywordflow">return</span> ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a>(C);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">return</span> 1;
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="comment">/* sets up the new context and calls &#39;wm_operator_invoke()&#39; with poll_only */</span>
<a name="l00420"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a2c926b7604cccbdb392411f8af2bd0a6">00420</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aeb1f169a042c3a55aeaa8792b243c950">WM_operator_poll_context</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <span class="keywordtype">int</span> context)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a52d92ec307f4142a03e738e96e8237d6">wm_operator_call_internal</a>(C, ot, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a45f2018e66c5fc3ab29db1d1843652a1">00425</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a45f2018e66c5fc3ab29db1d1843652a1">wm_operator_print</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427     <span class="comment">/* context is needed for enum function */</span>
<a name="l00428"></a>00428     <span class="keywordtype">char</span> *buf = <a class="code" href="../../d6/dae/wm__operators_8c.html#adba96297a2bbfe848074b1bcef44b7e3">WM_operator_pystring</a>(C, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, 1);
<a name="l00429"></a>00429     printf(<span class="stringliteral">&quot;%s\n&quot;</span>, buf);
<a name="l00430"></a>00430     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(buf);
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 <span class="comment">/* for debugging only, getting inspecting events manually is tedious */</span>
<a name="l00434"></a>00434 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span>
<a name="l00436"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a9272bfe42ee5695558dde01c88392b03">00436</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a302698acf1efd6d236fe539684c6e06b">WM_event_print</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438     <span class="keywordflow">if</span> (event) {
<a name="l00439"></a>00439         <span class="keyword">const</span> <span class="keywordtype">char</span> *unknown = <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l00440"></a>00440         <span class="keyword">const</span> <span class="keywordtype">char</span> *type_id = unknown;
<a name="l00441"></a>00441         <span class="keyword">const</span> <span class="keywordtype">char</span> *val_id = unknown;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443         <a class="code" href="../../d3/d10/rna__access_8c.html#a669f2ff5cb19fa232da9195d128f5452">RNA_enum_identifier</a>(<a class="code" href="../../df/dbf/rna__wm_8c.html#a26884efb5be8812e06b3c40104a62ff6">event_type_items</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, &amp;type_id);
<a name="l00444"></a>00444         <a class="code" href="../../d3/d10/rna__access_8c.html#a669f2ff5cb19fa232da9195d128f5452">RNA_enum_identifier</a>(<a class="code" href="../../df/dbf/rna__wm_8c.html#aee7b276920bc1bcdfe8cd565bfc97889">event_value_items</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>, &amp;val_id);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         printf(<span class="stringliteral">&quot;wmEvent - type:%d/%s, val:%d/%s, &quot;</span>
<a name="l00447"></a>00447                <span class="stringliteral">&quot;shift:%d, ctrl:%d, alt:%d, oskey:%d, keymodifier:%d, &quot;</span>
<a name="l00448"></a>00448                <span class="stringliteral">&quot;mouse:(%d,%d), ascii:&#39;%c&#39;, utf8:&#39;%.*s&#39;, &quot;</span>
<a name="l00449"></a>00449                <span class="stringliteral">&quot;keymap_idname:%s, pointer:%p\n&quot;</span>,
<a name="l00450"></a>00450                event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, type_id, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>, val_id,
<a name="l00451"></a>00451                event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a>,
<a name="l00452"></a>00452                event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#af3606467f06540b8776a50419af70a71">ascii</a>,
<a name="l00453"></a>00453                <a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#ac28dea96012eef5bd4cd541b9f447bef">BLI_str_utf8_size</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>), event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>,
<a name="l00454"></a>00454                event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a46a393a4a06349cc74da76e86a826533">keymap_idname</a>, (<span class="keywordtype">void</span> *)event);
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456     <span class="keywordflow">else</span> {
<a name="l00457"></a>00457         printf(<span class="stringliteral">&quot;wmEvent - NULL\n&quot;</span>);
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="preprocessor">#endif </span><span class="comment">/* NDEBUG */</span>
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">/* (caller_owns_reports == TRUE) when called from python */</span>
<a name="l00464"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a2b0e04b4b589ee017bfd1e6565533512">00464</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a2b0e04b4b589ee017bfd1e6565533512">wm_operator_reports</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> retval, <span class="keywordtype">int</span> caller_owns_reports)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466     <span class="keywordflow">if</span> (caller_owns_reports == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) { <span class="comment">/* popup */</span>
<a name="l00467"></a>00467         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#af4a8f2f776b099673ecbc6f04bf5db31">list</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00468"></a>00468             <span class="comment">/* FIXME, temp setting window, see other call to uiPupMenuReports for why */</span>
<a name="l00469"></a>00469             <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win_prev = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00470"></a>00470             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area_prev = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00471"></a>00471             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar_prev = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473             <span class="keywordflow">if</span> (win_prev == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00474"></a>00474                 <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C)-&gt;windows.first);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a268031d65eb6174627e5b3486fb69f41">uiPupMenuReports</a>(C, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478             <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win_prev);
<a name="l00479"></a>00479             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area_prev);
<a name="l00480"></a>00480             <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar_prev);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     
<a name="l00484"></a>00484     <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>) {
<a name="l00485"></a>00485         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635ac6d954ef18e204c4b9694976304f6e32">G_DEBUG_WM</a>) {
<a name="l00486"></a>00486             <span class="comment">/* todo - this print may double up, might want to check more flags then the FINISHED */</span>
<a name="l00487"></a>00487             <a class="code" href="../../df/db0/wm__event__system_8c.html#a45f2018e66c5fc3ab29db1d1843652a1">wm_operator_print</a>(C, op);
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (caller_owns_reports == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00491"></a>00491             <a class="code" href="../../d2/d40/BKE__report_8h.html#a205dcc4a8b9bd1f17b616909e2eeefc3">BKE_reports_print</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a76f8d8fc6936034b9eadc3a8f38648b9">RPT_DEBUG</a>); <span class="comment">/* print out reports to console. */</span>
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>) {
<a name="l00495"></a>00495             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background == 0) { <span class="comment">/* ends up printing these in the terminal, gets annoying */</span>
<a name="l00496"></a>00496                 <span class="comment">/* Report the python string representation of the operator */</span>
<a name="l00497"></a>00497                 <span class="keywordtype">char</span> *buf = <a class="code" href="../../d6/dae/wm__operators_8c.html#adba96297a2bbfe848074b1bcef44b7e3">WM_operator_pystring</a>(C, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, 1);
<a name="l00498"></a>00498                 <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#ac83792b6e00e841cdb896c9c0230bde7">CTX_wm_reports</a>(C), <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a54b98a6ef6a4e924cfc444b90c8c4f8a">RPT_OPERATOR</a>, buf);
<a name="l00499"></a>00499                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(buf);
<a name="l00500"></a>00500             }
<a name="l00501"></a>00501         }
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="comment">/* if the caller owns them, handle this */</span>
<a name="l00505"></a>00505     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#af4a8f2f776b099673ecbc6f04bf5db31">list</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> &amp;&amp; (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#a1b957177626886c8feb4bf4c6ea1fa1b">flag</a> &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861a263f6baf5c1ed61c5f82df9ee2d23bb5">RPT_OP_HOLD</a>) == 0) {
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00508"></a>00508         <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *wm_reports = <a class="code" href="../../df/d01/BKE__context_8h.html#ac83792b6e00e841cdb896c9c0230bde7">CTX_wm_reports</a>(C);
<a name="l00509"></a>00509         <a class="code" href="../../d4/d3f/structReportTimerInfo.html">ReportTimerInfo</a> *rti;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511         <span class="comment">/* add reports to the global list, otherwise they are not seen */</span>
<a name="l00512"></a>00512         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(&amp;wm_reports-&gt;<a class="code" href="../../df/df0/structReportList.html#af4a8f2f776b099673ecbc6f04bf5db31">list</a>, &amp;op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#af4a8f2f776b099673ecbc6f04bf5db31">list</a>);
<a name="l00513"></a>00513         
<a name="l00514"></a>00514         <span class="comment">/* After adding reports to the global list, reset the report timer. */</span>
<a name="l00515"></a>00515         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(wm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, wm_reports-&gt;<a class="code" href="../../df/df0/structReportList.html#ac65127a29493297881520cb6a06be0fd">reporttimer</a>);
<a name="l00516"></a>00516         
<a name="l00517"></a>00517         <span class="comment">/* Records time since last report was added */</span>
<a name="l00518"></a>00518         wm_reports-&gt;<a class="code" href="../../df/df0/structReportList.html#ac65127a29493297881520cb6a06be0fd">reporttimer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(wm, <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../d1/d40/wm__event__types_8h.html#aab9947e2b869b9ef85eec8c00e583597">TIMERREPORT</a>, 0.05);
<a name="l00519"></a>00519         
<a name="l00520"></a>00520         rti = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d3f/structReportTimerInfo.html">ReportTimerInfo</a>), <span class="stringliteral">&quot;ReportTimerInfo&quot;</span>);
<a name="l00521"></a>00521         wm_reports-&gt;<a class="code" href="../../df/df0/structReportList.html#ac65127a29493297881520cb6a06be0fd">reporttimer</a>-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a7e5850b6474f3948cb59cbd188ce68a6">customdata</a> = rti;
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">/* this function is mainly to check that the rules for freeing</span>
<a name="l00526"></a>00526 <span class="comment"> * an operator are kept in sync.</span>
<a name="l00527"></a>00527 <span class="comment"> */</span>
<a name="l00528"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a8cfab85e7fa1af62deb63790f5ef788f">00528</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a8cfab85e7fa1af62deb63790f5ef788f">wm_operator_register_check</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530     <span class="keywordflow">return</span> wm &amp;&amp; (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a> == 0) &amp;&amp; (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>);
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a585ba36e914a6f3fb424c32977655a05">00533</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a585ba36e914a6f3fb424c32977655a05">wm_operator_finished</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> repeat)
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="comment">/* we don&#39;t want to do undo pushes for operators that are being</span>
<a name="l00540"></a>00540 <span class="comment">     * called from operators that already do an undo push. usually</span>
<a name="l00541"></a>00541 <span class="comment">     * this will happen for python operators that call C operators */</span>
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a> == 0)
<a name="l00543"></a>00543         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l00544"></a>00544             <a class="code" href="../../d6/df1/ED__util_8h.html#ac0d011fe1f79af98f6bd968b95b247e2">ED_undo_push_op</a>(C, op);
<a name="l00545"></a>00545     
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (repeat == 0) {
<a name="l00547"></a>00547         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635ac6d954ef18e204c4b9694976304f6e32">G_DEBUG_WM</a>) {
<a name="l00548"></a>00548             <span class="keywordtype">char</span> *buf = <a class="code" href="../../d6/dae/wm__operators_8c.html#adba96297a2bbfe848074b1bcef44b7e3">WM_operator_pystring</a>(C, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, 1);
<a name="l00549"></a>00549             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#ac83792b6e00e841cdb896c9c0230bde7">CTX_wm_reports</a>(C), <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a54b98a6ef6a4e924cfc444b90c8c4f8a">RPT_OPERATOR</a>, buf);
<a name="l00550"></a>00550             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(buf);
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a8cfab85e7fa1af62deb63790f5ef788f">wm_operator_register_check</a>(wm, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>))
<a name="l00554"></a>00554             <a class="code" href="../../d6/d0e/wm_8c.html#a72e600bd38a6ac5ead6f623ea86f5a79">wm_operator_register</a>(C, op);
<a name="l00555"></a>00555         <span class="keywordflow">else</span>
<a name="l00556"></a>00556             <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(op);
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="comment">/* if repeat is true, it doesn&#39;t register again, nor does it free */</span>
<a name="l00561"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#ab446b2c678c7fb06225974a648767713">00561</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ab446b2c678c7fb06225974a648767713">wm_operator_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> repeat)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00564"></a>00564     <span class="keywordtype">int</span> retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00565"></a>00565     
<a name="l00566"></a>00566     <a class="code" href="../../df/d01/BKE__context_8h.html#adb80273514fd122e9b437f8849ced258">CTX_wm_operator_poll_msg_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00567"></a>00567     
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (op == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00569"></a>00569         <span class="keywordflow">return</span> retval;
<a name="l00570"></a>00570     
<a name="l00571"></a>00571     <span class="keywordflow">if</span> (0 == <a class="code" href="../../df/db0/wm__event__system_8c.html#a9a97e0b7a1e43624abb8a0d37d21f161">WM_operator_poll</a>(C, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>))
<a name="l00572"></a>00572         <span class="keywordflow">return</span> retval;
<a name="l00573"></a>00573     
<a name="l00574"></a>00574     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>) {
<a name="l00575"></a>00575         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l00576"></a>00576             wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         retval = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>(C, op);
<a name="l00579"></a>00579         <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aee6c70fc4e0bf180b577cd0c27409feb">OPERATOR_RETVAL_CHECK</a>(retval);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a> &amp;&amp; <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm)
<a name="l00582"></a>00582             wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584     
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (retval &amp; (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a> | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>) &amp;&amp; repeat == 0)
<a name="l00586"></a>00586         <a class="code" href="../../df/db0/wm__event__system_8c.html#a2b0e04b4b589ee017bfd1e6565533512">wm_operator_reports</a>(C, op, retval, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00587"></a>00587     
<a name="l00588"></a>00588     <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>) {
<a name="l00589"></a>00589         <span class="keywordflow">if</span> (repeat) {
<a name="l00590"></a>00590             <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a> == 0) { <span class="comment">/* not called by py script */</span>
<a name="l00591"></a>00591                 <a class="code" href="../../df/db0/wm__event__system_8c.html#ae1a3f72b7e9647f032260ca19711a649">WM_operator_last_properties_store</a>(op);
<a name="l00592"></a>00592             }
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594         <a class="code" href="../../df/db0/wm__event__system_8c.html#a585ba36e914a6f3fb424c32977655a05">wm_operator_finished</a>(C, op, repeat);
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repeat == 0) {
<a name="l00597"></a>00597         <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(op);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599     
<a name="l00600"></a>00600     <span class="keywordflow">return</span> retval | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a0e8f49e7337ce9cbbb8364daa1b5780f">OPERATOR_HANDLED</a>;
<a name="l00601"></a>00601     
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="comment">/* simply calls exec with basic checks */</span>
<a name="l00605"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#aa32eb91f9cad31ed93315591a2e78078">00605</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aa32eb91f9cad31ed93315591a2e78078">wm_operator_exec_notest</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607     <span class="keywordtype">int</span> retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <span class="keywordflow">if</span> (op == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00610"></a>00610         <span class="keywordflow">return</span> retval;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     retval = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>(C, op);
<a name="l00613"></a>00613     <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aee6c70fc4e0bf180b577cd0c27409feb">OPERATOR_RETVAL_CHECK</a>(retval);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keywordflow">return</span> retval;
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618 <span class="comment">/* for running operators with frozen context (modal handlers, menus)</span>
<a name="l00619"></a>00619 <span class="comment"> *</span>
<a name="l00620"></a>00620 <span class="comment"> * warning: do not use this within an operator to call its self! [#29537] */</span>
<a name="l00621"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a5c08273c0b326dbb5f1d712f444fe4e5">00621</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aadd5a7416410ad4472b8a1cceac6c862">WM_operator_call</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00622"></a>00622 {
<a name="l00623"></a>00623     <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ab446b2c678c7fb06225974a648767713">wm_operator_exec</a>(C, op, 0);
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="comment">/* this is intended to be used when an invoke operator wants to call exec on its self</span>
<a name="l00627"></a>00627 <span class="comment"> * and is basically like running op-&gt;type-&gt;exec() directly, no poll checks no freeing,</span>
<a name="l00628"></a>00628 <span class="comment"> * since we assume whoever called invokle will take care of that */</span>
<a name="l00629"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a1833551d195b7a579d2ca26adfb7d47d">00629</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a6cde76037b89d561f3de248c1ce0da30">WM_operator_call_notest</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631     <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aa32eb91f9cad31ed93315591a2e78078">wm_operator_exec_notest</a>(C, op);
<a name="l00632"></a>00632 }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 <span class="comment">/* do this operator again, put here so it can share above code */</span>
<a name="l00635"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#ac2c8b3cee04cef232286886ba31f242c">00635</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a6728b0ddf1a1f8de8db21dd705d4c8a4">WM_operator_repeat</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00636"></a>00636 {
<a name="l00637"></a>00637     <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ab446b2c678c7fb06225974a648767713">wm_operator_exec</a>(C, op, 1);
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 <span class="comment">/* TRUE if WM_operator_repeat can run</span>
<a name="l00640"></a>00640 <span class="comment"> * simple check for now but may become more involved.</span>
<a name="l00641"></a>00641 <span class="comment"> * To be sure the operator can run call WM_operator_poll(C, op-&gt;type) also, since this call</span>
<a name="l00642"></a>00642 <span class="comment"> * checks if WM_operator_repeat() can run at all, not that it WILL run at any time. */</span>
<a name="l00643"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a191d5a8b1adb14375c98af882925534f">00643</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a191d5a8b1adb14375c98af882925534f">WM_operator_repeat_check</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00644"></a>00644 {
<a name="l00645"></a>00645     <span class="keywordflow">return</span> op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00646"></a>00646 }
<a name="l00647"></a>00647 
<a name="l00648"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a5a6923f79673723c46890c5613ade87b">00648</a> <span class="keyword">static</span> <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a5a6923f79673723c46890c5613ade87b">wm_operator_create</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650     <span class="comment">/* XXX operatortype names are static still. for debug */</span>
<a name="l00651"></a>00651     <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a>), ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l00652"></a>00652     
<a name="l00653"></a>00653     <span class="comment">/* XXX adding new operator could be function, only happens here now */</span>
<a name="l00654"></a>00654     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a> = ot;
<a name="l00655"></a>00655     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a42b15acb4df45b846c38202a208c0c32">idname</a>, ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a0abf71757e44887f91524ccec1d0327e">OP_MAX_TYPENAME</a>);
<a name="l00656"></a>00656     
<a name="l00657"></a>00657     <span class="comment">/* initialize properties, either copy or create */</span>
<a name="l00658"></a>00658     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a>), <span class="stringliteral">&quot;wmOperatorPtrRNA&quot;</span>);
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (properties &amp;&amp; properties-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>) {
<a name="l00660"></a>00660         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a> = <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ae80f703da3b22ff05299c00760d1d8cc">IDP_CopyProperty</a>(properties-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>);
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662     <span class="keywordflow">else</span> {
<a name="l00663"></a>00663         <a class="code" href="../../df/d2e/unionIDPropertyTemplate.html">IDPropertyTemplate</a> val = {0};
<a name="l00664"></a>00664         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a> = <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ab2130fe4ddfd0002e655dbee991d517e">IDP_New</a>(<a class="code" href="../../d3/dfb/DNA__ID_8h.html#abf4b8c1027c684282b432b3c8033a2de">IDP_GROUP</a>, &amp;val, <span class="stringliteral">&quot;wmOperatorProperties&quot;</span>);
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>, ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <span class="comment">/* initialize error reports */</span>
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (reports) {
<a name="l00670"></a>00670         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a> = reports; <span class="comment">/* must be initialized already */</span>
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     <span class="keywordflow">else</span> {
<a name="l00673"></a>00673         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/df0/structReportList.html">ReportList</a>), <span class="stringliteral">&quot;wmOperatorReportList&quot;</span>);
<a name="l00674"></a>00674         <a class="code" href="../../d2/d40/BKE__report_8h.html#af5b01bb6a9ddfb55fadc44aee9a0d5a5">BKE_reports_init</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861aca8f7314453dc576fbdca03031b66430">RPT_STORE</a> | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861ac9c8917a54b2a03d788a80a0c44dd0c1">RPT_FREE</a>);
<a name="l00675"></a>00675     }
<a name="l00676"></a>00676     
<a name="l00677"></a>00677     <span class="comment">/* recursive filling of operator macro list */</span>
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#af6ae4868d49a32a04ae409bdf31f5bc4">macro</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00679"></a>00679         <span class="keyword">static</span> <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *motherop = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00680"></a>00680         <a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html">wmOperatorTypeMacro</a> *otmacro;
<a name="l00681"></a>00681         <span class="keywordtype">int</span> root = 0;
<a name="l00682"></a>00682         
<a name="l00683"></a>00683         <span class="comment">/* ensure all ops are in execution order in 1 list */</span>
<a name="l00684"></a>00684         <span class="keywordflow">if</span> (motherop == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00685"></a>00685             motherop = op;
<a name="l00686"></a>00686             root = 1;
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689         
<a name="l00690"></a>00690         <span class="comment">/* if properties exist, it will contain everything needed */</span>
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (properties) {
<a name="l00692"></a>00692             otmacro = ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#af6ae4868d49a32a04ae409bdf31f5bc4">macro</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694             <a class="code" href="../../de/ddf/RNA__access_8h.html#a0969a790d2bade8d53b911a425188202">RNA_STRUCT_BEGIN</a>(properties, prop)
<a name="l00695"></a>00695             {
<a name="l00696"></a>00696 
<a name="l00697"></a>00697                 <span class="keywordflow">if</span> (otmacro == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00698"></a>00698                     <span class="keywordflow">break</span>;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700                 <span class="comment">/* skip invalid properties */</span>
<a name="l00701"></a>00701                 <span class="keywordflow">if</span> (strcmp(<a class="code" href="../../d3/d10/rna__access_8c.html#ad6f3c9684a8786587872fc6baf17dfc9">RNA_property_identifier</a>(prop), otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#a3a82b0c4f849b6795d81d46cbd321dd9">idname</a>) == 0) {
<a name="l00702"></a>00702                     <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *otm = <a class="code" href="../../d6/dae/wm__operators_8c.html#a10ed9150324ef83e52559b8cb5293c4b">WM_operatortype_find</a>(otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#a3a82b0c4f849b6795d81d46cbd321dd9">idname</a>, 0);
<a name="l00703"></a>00703                     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> someptr = <a class="code" href="../../d3/d10/rna__access_8c.html#a575c543a2a1f509f371bc1cee4fbe4d7">RNA_property_pointer_get</a>(properties, prop);
<a name="l00704"></a>00704                     <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *opm = <a class="code" href="../../df/db0/wm__event__system_8c.html#a5a6923f79673723c46890c5613ade87b">wm_operator_create</a>(wm, otm, &amp;someptr, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706                     <a class="code" href="../../d5/d95/BKE__idprop_8h.html#a999c9d0caeaae5ed4feb905b0294ce51">IDP_ReplaceGroupInGroup</a>(opm-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a>, otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#ac978eece95e002c2e31a93e345823873">properties</a>);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;motherop-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a9a7c7d3c99ae780e6f016f59d446ee6f">macro</a>, opm);
<a name="l00709"></a>00709                     opm-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a> = motherop; <span class="comment">/* pointer to mom, for modal() */</span>
<a name="l00710"></a>00710 
<a name="l00711"></a>00711                     otmacro = otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#aa004c90cec9a18f64ee550209fd1deaa">next</a>;
<a name="l00712"></a>00712                 }
<a name="l00713"></a>00713             }
<a name="l00714"></a>00714             <a class="code" href="../../de/ddf/RNA__access_8h.html#a187bb3c525d1f0717e3c27837eaae8e1">RNA_STRUCT_END</a>;
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716         <span class="keywordflow">else</span> {
<a name="l00717"></a>00717             <span class="keywordflow">for</span> (otmacro = ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#af6ae4868d49a32a04ae409bdf31f5bc4">macro</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; otmacro; otmacro = otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#aa004c90cec9a18f64ee550209fd1deaa">next</a>) {
<a name="l00718"></a>00718                 <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *otm = <a class="code" href="../../d6/dae/wm__operators_8c.html#a10ed9150324ef83e52559b8cb5293c4b">WM_operatortype_find</a>(otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#a3a82b0c4f849b6795d81d46cbd321dd9">idname</a>, 0);
<a name="l00719"></a>00719                 <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *opm = <a class="code" href="../../df/db0/wm__event__system_8c.html#a5a6923f79673723c46890c5613ade87b">wm_operator_create</a>(wm, otm, otmacro-&gt;<a class="code" href="../../d0/d03/structwmOperatorTypeMacro.html#a908e9cb80b94d1f383b4a2af8c96a6ee">ptr</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;motherop-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a9a7c7d3c99ae780e6f016f59d446ee6f">macro</a>, opm);
<a name="l00722"></a>00722                 opm-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a> = motherop; <span class="comment">/* pointer to mom, for modal() */</span>
<a name="l00723"></a>00723             }
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725         
<a name="l00726"></a>00726         <span class="keywordflow">if</span> (root)
<a name="l00727"></a>00727             motherop = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729     
<a name="l00730"></a>00730     <a class="code" href="../../d6/dae/wm__operators_8c.html#a0aeb6e26429b1fce4f2e86e585c765bb">WM_operator_properties_sanitize</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, 0);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="keywordflow">return</span> op;
<a name="l00733"></a>00733 }
<a name="l00734"></a>00734 
<a name="l00735"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">00735</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00736"></a>00736 {
<a name="l00737"></a>00737     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00738"></a>00738     <span class="keywordflow">if</span> (ar) {
<a name="l00739"></a>00739         <span class="comment">/* compatibility convention */</span>
<a name="l00740"></a>00740         <span class="keyword">event</span>-&gt;mval[0] = <span class="keyword">event</span>-&gt;x - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00741"></a>00741         <span class="keyword">event</span>-&gt;mval[1] = <span class="keyword">event</span>-&gt;y - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     <span class="keywordflow">else</span> {
<a name="l00744"></a>00744         <span class="comment">/* these values are invalid (avoid odd behavior by relying on old mval values) */</span>
<a name="l00745"></a>00745         <span class="keyword">event</span>-&gt;mval[0] = -1;
<a name="l00746"></a>00746         <span class="keyword">event</span>-&gt;mval[1] = -1;
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="preprocessor">#if 0 </span><span class="comment">/* disabling for 2.63 release, since we keep getting reports some menu items are leaving props undefined */</span>
<a name="l00751"></a>00751 <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a5d4f335ef446af750b1b7b8de40d3883">WM_operator_last_properties_init</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00752"></a>00752 {
<a name="l00753"></a>00753     <span class="keywordtype">int</span> change = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a>) {
<a name="l00756"></a>00756         <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *iterprop;
<a name="l00757"></a>00757 
<a name="l00758"></a>00758         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635ac6d954ef18e204c4b9694976304f6e32">G_DEBUG_WM</a>) {
<a name="l00759"></a>00759             printf(<span class="stringliteral">&quot;%s: loading previous properties for &#39;%s&#39;\n&quot;</span>, __func__, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762         iterprop = <a class="code" href="../../d3/d10/rna__access_8c.html#ae962a8cfab91f9848e59a0f2b2401816">RNA_struct_iterator_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>);
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         <a class="code" href="../../de/ddf/RNA__access_8h.html#a56f71b443d06f31f83fe3dfdf07fd4c4">RNA_PROP_BEGIN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, itemptr, iterprop) {
<a name="l00765"></a>00765             <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop = itemptr.data;
<a name="l00766"></a>00766             <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d10/rna__access_8c.html#a977a3c85a8d6d0a8b126e99a4955c634">RNA_property_flag</a>(prop) &amp; <a class="code" href="../../de/d7e/RNA__types_8h.html#ae770cf51782953d602fb7ec23d3f2411ac49bd36c069e337f7ee269c672ef1332">PROP_SKIP_SAVE</a>) == 0) {
<a name="l00767"></a>00767                 <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop)) { <span class="comment">/* don&#39;t override a setting already set */</span>
<a name="l00768"></a>00768                     <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier = <a class="code" href="../../d3/d10/rna__access_8c.html#ad6f3c9684a8786587872fc6baf17dfc9">RNA_property_identifier</a>(prop);
<a name="l00769"></a>00769                     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *idp_src = <a class="code" href="../../d5/d95/BKE__idprop_8h.html#abf2facca64e1d32419686163fb1b0414">IDP_GetPropertyFromGroup</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a>, identifier);
<a name="l00770"></a>00770                     <span class="keywordflow">if</span> (idp_src) {
<a name="l00771"></a>00771                         <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *idp_dst = <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ae80f703da3b22ff05299c00760d1d8cc">IDP_CopyProperty</a>(idp_src);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773                         <span class="comment">/* note - in the future this may need to be done recursively,</span>
<a name="l00774"></a>00774 <span class="comment">                         * but for now RNA doesn&#39;t access nested operators */</span>
<a name="l00775"></a>00775                         idp_dst-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a08c840175d6551e2d7f8fb564729fad7">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab3fe456283e35aa75a314fa16103444a">IDP_FLAG_GHOST</a>;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777                         <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ae4314a271f0a3b1432acb6457bbe7161">IDP_ReplaceInGroup</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a>, idp_dst);
<a name="l00778"></a>00778                         change = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00779"></a>00779                     }
<a name="l00780"></a>00780                 }
<a name="l00781"></a>00781             }
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783         <a class="code" href="../../de/ddf/RNA__access_8h.html#a00c9cc0174c79826c145c3e235e2b689">RNA_PROP_END</a>;
<a name="l00784"></a>00784     }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786     <span class="keywordflow">return</span> change;
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ae1a3f72b7e9647f032260ca19711a649">WM_operator_last_properties_store</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00790"></a>00790 {
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a>) {
<a name="l00792"></a>00792         <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ac700fa8a94927f66ebc0c0e12378bbd1">IDP_FreeProperty</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a>);
<a name="l00793"></a>00793         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a>);
<a name="l00794"></a>00794         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00795"></a>00795     }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a>) {
<a name="l00798"></a>00798         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635ac6d954ef18e204c4b9694976304f6e32">G_DEBUG_WM</a>) {
<a name="l00799"></a>00799             printf(<span class="stringliteral">&quot;%s: storing properties for &#39;%s&#39;\n&quot;</span>, __func__, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l00800"></a>00800         }
<a name="l00801"></a>00801         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a3e20ade978bdcc42f0fa478d495121f5">last_properties</a> = <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ae80f703da3b22ff05299c00760d1d8cc">IDP_CopyProperty</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a0e68a5b267788bac6caa07cad1c05b2c">properties</a>);
<a name="l00802"></a>00802         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804     <span class="keywordflow">else</span> {
<a name="l00805"></a>00805         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 <span class="preprocessor">#else</span>
<a name="l00810"></a>00810 <span class="preprocessor"></span>
<a name="l00811"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a5d4f335ef446af750b1b7b8de40d3883">00811</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a5d4f335ef446af750b1b7b8de40d3883">WM_operator_last_properties_init</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#ae1a3f72b7e9647f032260ca19711a649">00816</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ae1a3f72b7e9647f032260ca19711a649">WM_operator_last_properties_store</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00817"></a>00817 {
<a name="l00818"></a>00818     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="preprocessor">#endif</span>
<a name="l00822"></a>00822 <span class="preprocessor"></span>
<a name="l00823"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">00823</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">wm_operator_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports, <span class="keywordtype">short</span> poll_only)
<a name="l00824"></a>00824 {
<a name="l00825"></a>00825     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00826"></a>00826     <span class="keywordtype">int</span> retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <span class="comment">/* this is done because complicated setup is done to call this function that is better not duplicated */</span>
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (poll_only)
<a name="l00830"></a>00830         <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a9a97e0b7a1e43624abb8a0d37d21f161">WM_operator_poll</a>(C, ot);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a9a97e0b7a1e43624abb8a0d37d21f161">WM_operator_poll</a>(C, ot)) {
<a name="l00833"></a>00833         <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op = <a class="code" href="../../df/db0/wm__event__system_8c.html#a5a6923f79673723c46890c5613ade87b">wm_operator_create</a>(wm, ot, properties, reports); <span class="comment">/* if reports==NULL, theyll be initialized */</span>
<a name="l00834"></a>00834         <span class="keyword">const</span> <span class="keywordtype">short</span> is_nested_call = (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a> != 0);
<a name="l00835"></a>00835         
<a name="l00836"></a>00836         <span class="comment">/* initialize setting from previous run */</span>
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (!is_nested_call) { <span class="comment">/* not called by py script */</span>
<a name="l00838"></a>00838             <a class="code" href="../../df/db0/wm__event__system_8c.html#a5d4f335ef446af750b1b7b8de40d3883">WM_operator_last_properties_init</a>(op);
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         <span class="keywordflow">if</span> ((<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>) &amp;&amp; event &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> != <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l00842"></a>00842             printf(<span class="stringliteral">&quot;%s: handle evt %d win %d op %s\n&quot;</span>, __func__, event ? event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> : 0, <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C)-&gt;subwinactive, ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l00843"></a>00843         }
<a name="l00844"></a>00844         
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> &amp;&amp; event) {
<a name="l00846"></a>00846             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(C, event);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848             <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l00849"></a>00849                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851             retval = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a>(C, op, event);
<a name="l00852"></a>00852             <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aee6c70fc4e0bf180b577cd0c27409feb">OPERATOR_RETVAL_CHECK</a>(retval);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854             <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a> &amp;&amp; <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm)
<a name="l00855"></a>00855                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l00856"></a>00856         }
<a name="l00857"></a>00857         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>) {
<a name="l00858"></a>00858             <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l00859"></a>00859                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861             retval = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>(C, op);
<a name="l00862"></a>00862             <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aee6c70fc4e0bf180b577cd0c27409feb">OPERATOR_RETVAL_CHECK</a>(retval);
<a name="l00863"></a>00863 
<a name="l00864"></a>00864             <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a> &amp;&amp; <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm)
<a name="l00865"></a>00865                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l00866"></a>00866         }
<a name="l00867"></a>00867         <span class="keywordflow">else</span> {
<a name="l00868"></a>00868             <span class="comment">/* debug, important to leave a while, should never happen */</span>
<a name="l00869"></a>00869             printf(<span class="stringliteral">&quot;invalid operator call &#39;%s&#39;\n&quot;</span>, ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871         
<a name="l00872"></a>00872         <span class="comment">/* Note, if the report is given as an argument then assume the caller will deal with displaying them</span>
<a name="l00873"></a>00873 <span class="comment">         * currently python only uses this */</span>
<a name="l00874"></a>00874         <span class="keywordflow">if</span> (!(retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a0e8f49e7337ce9cbbb8364daa1b5780f">OPERATOR_HANDLED</a>) &amp;&amp; (retval &amp; (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a> | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>))) {
<a name="l00875"></a>00875             <span class="comment">/* only show the report if the report list was not given in the function */</span>
<a name="l00876"></a>00876             <a class="code" href="../../df/db0/wm__event__system_8c.html#a2b0e04b4b589ee017bfd1e6565533512">wm_operator_reports</a>(C, op, retval, (reports != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l00877"></a>00877         }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879         <span class="keywordflow">if</span> (retval &amp; OPERATOR_HANDLED)
<a name="l00880"></a>00880             ;  <span class="comment">/* do nothing, wm_operator_exec() has been called somewhere */</span>
<a name="l00881"></a>00881         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>) {
<a name="l00882"></a>00882             <span class="keywordflow">if</span> (!is_nested_call) { <span class="comment">/* not called by py script */</span>
<a name="l00883"></a>00883                 <a class="code" href="../../df/db0/wm__event__system_8c.html#ae1a3f72b7e9647f032260ca19711a649">WM_operator_last_properties_store</a>(op);
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885             <a class="code" href="../../df/db0/wm__event__system_8c.html#a585ba36e914a6f3fb424c32977655a05">wm_operator_finished</a>(C, op, 0);
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>) {
<a name="l00888"></a>00888             <span class="comment">/* grab cursor during blocking modal ops (X11)</span>
<a name="l00889"></a>00889 <span class="comment">             * Also check for macro</span>
<a name="l00890"></a>00890 <span class="comment">             */</span>
<a name="l00891"></a>00891             <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a> || (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a> &amp;&amp; op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>)) {
<a name="l00892"></a>00892                 <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>[4] = {-1, -1, -1, -1};
<a name="l00893"></a>00893                 <span class="keywordtype">int</span> wrap;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895                 <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>) {
<a name="l00896"></a>00896                     wrap = (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a6dcdc3e6aeed2189048e53e258a1e567">USER_CONTINUOUS_MOUSE</a>) &amp;&amp;
<a name="l00897"></a>00897                            ((op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a35bd8a794de1255fb28e1714d98a3cef">flag</a> &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#abf5683fb9d8a0917930bcff65a2586fe">OP_GRAB_POINTER</a>) || (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#ac9470de8419174a032e9097a5ec317fd">OPTYPE_GRAB_POINTER</a>));
<a name="l00898"></a>00898                 }
<a name="l00899"></a>00899                 <span class="keywordflow">else</span> {
<a name="l00900"></a>00900                     wrap = (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a6dcdc3e6aeed2189048e53e258a1e567">USER_CONTINUOUS_MOUSE</a>) &amp;&amp;
<a name="l00901"></a>00901                            ((op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a35bd8a794de1255fb28e1714d98a3cef">flag</a> &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#abf5683fb9d8a0917930bcff65a2586fe">OP_GRAB_POINTER</a>) || (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#ac9470de8419174a032e9097a5ec317fd">OPTYPE_GRAB_POINTER</a>));
<a name="l00902"></a>00902                 }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904                 <span class="comment">/* exception, cont. grab in header is annoying */</span>
<a name="l00905"></a>00905                 <span class="keywordflow">if</span> (wrap) {
<a name="l00906"></a>00906                     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00907"></a>00907                     <span class="keywordflow">if</span> (ar &amp;&amp; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2ab7e0b51ce129a8b256dc705a06c4c4e8">RGN_TYPE_HEADER</a>) {
<a name="l00908"></a>00908                         wrap = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00909"></a>00909                     }
<a name="l00910"></a>00910                 }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912                 <span class="keywordflow">if</span> (wrap) {
<a name="l00913"></a>00913                     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *winrect = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00914"></a>00914                     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00915"></a>00915                     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917                     <span class="keywordflow">if</span> (ar &amp;&amp; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a> &amp;&amp; event &amp;&amp;
<a name="l00918"></a>00918                         <a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l00919"></a>00919                     {
<a name="l00920"></a>00920                         winrect = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>;
<a name="l00921"></a>00921                     }
<a name="l00922"></a>00922                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa) {
<a name="l00923"></a>00923                         winrect = &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>;
<a name="l00924"></a>00924                     }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926                     <span class="keywordflow">if</span> (winrect) {
<a name="l00927"></a>00927                         bounds[0] = winrect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00928"></a>00928                         bounds[1] = winrect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>;
<a name="l00929"></a>00929                         bounds[2] = winrect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>;
<a name="l00930"></a>00930                         bounds[3] = winrect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00931"></a>00931                     }
<a name="l00932"></a>00932                 }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934                 <a class="code" href="../../de/d3c/wm__cursors_8c.html#aba6c2bcfe61d68f45da87fbb6c82765c">WM_cursor_grab</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), wrap, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, bounds);
<a name="l00935"></a>00935             }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937             <span class="comment">/* cancel UI handlers, typically tooltips that can hang around</span>
<a name="l00938"></a>00938 <span class="comment">             * while dragging the view or worse, that stay there permanently</span>
<a name="l00939"></a>00939 <span class="comment">             * after the modal operator has swallowed all events and passed</span>
<a name="l00940"></a>00940 <span class="comment">             * none to the UI handler */</span>
<a name="l00941"></a>00941             <a class="code" href="../../df/db0/wm__event__system_8c.html#a4a846576fd198015a059e3f46c5dfccc">wm_handler_ui_cancel</a>(C);
<a name="l00942"></a>00942         }
<a name="l00943"></a>00943         <span class="keywordflow">else</span> {
<a name="l00944"></a>00944             <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(op);
<a name="l00945"></a>00945         }
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     <span class="keywordflow">return</span> retval;
<a name="l00949"></a>00949 }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951 <span class="comment">/* WM_operator_name_call is the main accessor function</span>
<a name="l00952"></a>00952 <span class="comment"> * this is for python to access since its done the operator lookup</span>
<a name="l00953"></a>00953 <span class="comment"> * </span>
<a name="l00954"></a>00954 <span class="comment"> * invokes operator in context */</span>
<a name="l00955"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a52d92ec307f4142a03e738e96e8237d6">00955</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a52d92ec307f4142a03e738e96e8237d6">wm_operator_call_internal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports,
<a name="l00956"></a>00956                                      <span class="keywordtype">short</span> context, <span class="keywordtype">short</span> poll_only)
<a name="l00957"></a>00957 {
<a name="l00958"></a>00958     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00959"></a>00959     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event;
<a name="l00960"></a>00960     
<a name="l00961"></a>00961     <span class="keywordtype">int</span> retval;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <a class="code" href="../../df/d01/BKE__context_8h.html#adb80273514fd122e9b437f8849ced258">CTX_wm_operator_poll_msg_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="comment">/* dummie test */</span>
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (ot &amp;&amp; C) {
<a name="l00967"></a>00967         <span class="keywordflow">switch</span> (context) {
<a name="l00968"></a>00968             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>:
<a name="l00969"></a>00969             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a0a4b36fb214cf9c59486cd041c118bd6">WM_OP_INVOKE_REGION_WIN</a>:
<a name="l00970"></a>00970             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a3b999b22146add79c8d70bd94766d798">WM_OP_INVOKE_AREA</a>:
<a name="l00971"></a>00971             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a31f9a9093119792c53e4d38d2d3fdff8">WM_OP_INVOKE_SCREEN</a>:
<a name="l00972"></a>00972                 <span class="comment">/* window is needed for invoke, cancel operator */</span>
<a name="l00973"></a>00973                 <span class="keywordflow">if</span> (window == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00974"></a>00974                     <span class="keywordflow">return</span> 0;
<a name="l00975"></a>00975                 <span class="keywordflow">else</span>
<a name="l00976"></a>00976                     <span class="keyword">event</span> = window-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>;
<a name="l00977"></a>00977                 <span class="keywordflow">break</span>;
<a name="l00978"></a>00978             <span class="keywordflow">default</span>:
<a name="l00979"></a>00979                 <span class="keyword">event</span> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00980"></a>00980         }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982         <span class="keywordflow">switch</span> (context) {
<a name="l00983"></a>00983             
<a name="l00984"></a>00984             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a2a694a68c0f6fabd97bc24a2cd8286cb">WM_OP_EXEC_REGION_WIN</a>:
<a name="l00985"></a>00985             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a0a4b36fb214cf9c59486cd041c118bd6">WM_OP_INVOKE_REGION_WIN</a>: 
<a name="l00986"></a>00986             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ac12d143a0979427b40580e5178e3670d">WM_OP_EXEC_REGION_CHANNELS</a>:
<a name="l00987"></a>00987             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ac144b37e89302bf5de89723ef8550fdc">WM_OP_INVOKE_REGION_CHANNELS</a>:
<a name="l00988"></a>00988             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a8bf8379e955d041653c4af693f40fb01">WM_OP_EXEC_REGION_PREVIEW</a>:
<a name="l00989"></a>00989             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39aa93577a23c349f192df34c69a25c557a">WM_OP_INVOKE_REGION_PREVIEW</a>:
<a name="l00990"></a>00990             {
<a name="l00991"></a>00991                 <span class="comment">/* forces operator to go to the region window/channels/preview, for header menus</span>
<a name="l00992"></a>00992 <span class="comment">                 * but we stay in the same region if we are already in one </span>
<a name="l00993"></a>00993 <span class="comment">                 */</span>
<a name="l00994"></a>00994                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00995"></a>00995                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00996"></a>00996                 <span class="keywordtype">int</span> <a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>;
<a name="l00997"></a>00997                 
<a name="l00998"></a>00998                 <span class="keywordflow">switch</span> (context) {
<a name="l00999"></a>00999                     <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ac12d143a0979427b40580e5178e3670d">WM_OP_EXEC_REGION_CHANNELS</a>:
<a name="l01000"></a>01000                     <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ac144b37e89302bf5de89723ef8550fdc">WM_OP_INVOKE_REGION_CHANNELS</a>:
<a name="l01001"></a>01001                         type = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a065baa7d4590b7259b08da664c894389">RGN_TYPE_CHANNELS</a>;
<a name="l01002"></a>01002                         <span class="keywordflow">break</span>;
<a name="l01003"></a>01003                     
<a name="l01004"></a>01004                     <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a8bf8379e955d041653c4af693f40fb01">WM_OP_EXEC_REGION_PREVIEW</a>:
<a name="l01005"></a>01005                     <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39aa93577a23c349f192df34c69a25c557a">WM_OP_INVOKE_REGION_PREVIEW</a>:
<a name="l01006"></a>01006                         type = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a9c229d954ba6692b9ea76f4a444a6ad5">RGN_TYPE_PREVIEW</a>;
<a name="l01007"></a>01007                         <span class="keywordflow">break</span>;
<a name="l01008"></a>01008                     
<a name="l01009"></a>01009                     <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a2a694a68c0f6fabd97bc24a2cd8286cb">WM_OP_EXEC_REGION_WIN</a>:
<a name="l01010"></a>01010                     <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a0a4b36fb214cf9c59486cd041c118bd6">WM_OP_INVOKE_REGION_WIN</a>: 
<a name="l01011"></a>01011                     <span class="keywordflow">default</span>:
<a name="l01012"></a>01012                         type = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>;
<a name="l01013"></a>01013                         <span class="keywordflow">break</span>;
<a name="l01014"></a>01014                 }
<a name="l01015"></a>01015                 
<a name="l01016"></a>01016                 <span class="keywordflow">if</span> (!(ar &amp;&amp; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == type) &amp;&amp; area) {
<a name="l01017"></a>01017                     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar1 = <a class="code" href="../../d7/da3/BKE__screen_8h.html#a5094bc7dbca089e838bcd5fc9bcb52a7">BKE_area_find_region_type</a>(area, type);
<a name="l01018"></a>01018                     <span class="keywordflow">if</span> (ar1)
<a name="l01019"></a>01019                         <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar1);
<a name="l01020"></a>01020                 }
<a name="l01021"></a>01021                 
<a name="l01022"></a>01022                 retval = <a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">wm_operator_invoke</a>(C, ot, event, properties, reports, poll_only);
<a name="l01023"></a>01023                 
<a name="l01024"></a>01024                 <span class="comment">/* set region back */</span>
<a name="l01025"></a>01025                 <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l01026"></a>01026                 
<a name="l01027"></a>01027                 <span class="keywordflow">return</span> retval;
<a name="l01028"></a>01028             }
<a name="l01029"></a>01029             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ad7b067dac689d3f5b3afb8a46d37a7ff">WM_OP_EXEC_AREA</a>:
<a name="l01030"></a>01030             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a3b999b22146add79c8d70bd94766d798">WM_OP_INVOKE_AREA</a>:
<a name="l01031"></a>01031             {
<a name="l01032"></a>01032                 <span class="comment">/* remove region from context */</span>
<a name="l01033"></a>01033                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01034"></a>01034 
<a name="l01035"></a>01035                 <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01036"></a>01036                 retval = <a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">wm_operator_invoke</a>(C, ot, event, properties, reports, poll_only);
<a name="l01037"></a>01037                 <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039                 <span class="keywordflow">return</span> retval;
<a name="l01040"></a>01040             }
<a name="l01041"></a>01041             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a91eea8abf73553c0f2601a1c6c24d605">WM_OP_EXEC_SCREEN</a>:
<a name="l01042"></a>01042             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a31f9a9093119792c53e4d38d2d3fdff8">WM_OP_INVOKE_SCREEN</a>:
<a name="l01043"></a>01043             {
<a name="l01044"></a>01044                 <span class="comment">/* remove region + area from context */</span>
<a name="l01045"></a>01045                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01046"></a>01046                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01047"></a>01047 
<a name="l01048"></a>01048                 <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01049"></a>01049                 <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01050"></a>01050                 retval = <a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">wm_operator_invoke</a>(C, ot, event, properties, reports, poll_only);
<a name="l01051"></a>01051                 <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area);
<a name="l01052"></a>01052                 <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l01053"></a>01053 
<a name="l01054"></a>01054                 <span class="keywordflow">return</span> retval;
<a name="l01055"></a>01055             }
<a name="l01056"></a>01056             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ad2fa38d3cd3b0844e4a1b33bbf5f918c">WM_OP_EXEC_DEFAULT</a>:
<a name="l01057"></a>01057             <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>:
<a name="l01058"></a>01058                 <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">wm_operator_invoke</a>(C, ot, event, properties, reports, poll_only);
<a name="l01059"></a>01059         }
<a name="l01060"></a>01060     }
<a name="l01061"></a>01061     
<a name="l01062"></a>01062     <span class="keywordflow">return</span> 0;
<a name="l01063"></a>01063 }
<a name="l01064"></a>01064 
<a name="l01065"></a>01065 
<a name="l01066"></a>01066 <span class="comment">/* invokes operator in context */</span>
<a name="l01067"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a6385ee2a646975642d6136d78e314762">01067</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *opstring, <span class="keywordtype">int</span> context, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties)
<a name="l01068"></a>01068 {
<a name="l01069"></a>01069     <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot = <a class="code" href="../../d6/dae/wm__operators_8c.html#a10ed9150324ef83e52559b8cb5293c4b">WM_operatortype_find</a>(opstring, 0);
<a name="l01070"></a>01070     <span class="keywordflow">if</span> (ot)
<a name="l01071"></a>01071         <span class="keywordflow">return</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a52d92ec307f4142a03e738e96e8237d6">wm_operator_call_internal</a>(C, ot, properties, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">return</span> 0;
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 <span class="comment">/* Similar to WM_operator_name_call called with WM_OP_EXEC_DEFAULT context.</span>
<a name="l01077"></a>01077 <span class="comment"> * - wmOperatorType is used instead of operator name since python already has the operator type</span>
<a name="l01078"></a>01078 <span class="comment"> * - poll() must be called by python before this runs.</span>
<a name="l01079"></a>01079 <span class="comment"> * - reports can be passed to this function (so python can report them as exceptions)</span>
<a name="l01080"></a>01080 <span class="comment"> */</span>
<a name="l01081"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#af5b1d76f019a327a7be275b915d903a9">01081</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a1bfcb02dc02115d5e9ceb0c69631571d">WM_operator_call_py</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <span class="keywordtype">int</span> context, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083     <span class="keywordtype">int</span> retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 <span class="preprocessor">#if 0</span>
<a name="l01086"></a>01086 <span class="preprocessor"></span>    <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op;
<a name="l01087"></a>01087     op = <a class="code" href="../../df/db0/wm__event__system_8c.html#a5a6923f79673723c46890c5613ade87b">wm_operator_create</a>(wm, ot, properties, reports);
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>) {
<a name="l01090"></a>01090         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01091"></a>01091             wm-&gt;op_undo_depth++;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093         retval = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>(C, op);
<a name="l01094"></a>01094         <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aee6c70fc4e0bf180b577cd0c27409feb">OPERATOR_RETVAL_CHECK</a>(retval);
<a name="l01095"></a>01095 
<a name="l01096"></a>01096         <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a> &amp;&amp; <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm)
<a name="l01097"></a>01097             wm-&gt;op_undo_depth--;
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099     <span class="keywordflow">else</span>
<a name="l01100"></a>01100         printf(<span class="stringliteral">&quot;error \&quot;%s\&quot; operator has no exec function, python cannot call it\n&quot;</span>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a>);
<a name="l01101"></a>01101 <span class="preprocessor">#endif</span>
<a name="l01102"></a>01102 <span class="preprocessor"></span>
<a name="l01103"></a>01103     <span class="comment">/* not especially nice using undo depth here, its used so py never</span>
<a name="l01104"></a>01104 <span class="comment">     * triggers undo or stores operators last used state.</span>
<a name="l01105"></a>01105 <span class="comment">     *</span>
<a name="l01106"></a>01106 <span class="comment">     * we could have some more obvious way of doing this like passing a flag.</span>
<a name="l01107"></a>01107 <span class="comment">     */</span>
<a name="l01108"></a>01108     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01109"></a>01109     <span class="keywordflow">if</span> (wm) wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111     retval = <a class="code" href="../../df/db0/wm__event__system_8c.html#a52d92ec307f4142a03e738e96e8237d6">wm_operator_call_internal</a>(C, ot, properties, reports, context, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01112"></a>01112     
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (wm &amp;&amp; (wm == <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C))) wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115     <span class="comment">/* keep the reports around if needed later */</span>
<a name="l01116"></a>01116     <span class="keywordflow">if</span> ((retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>) ||
<a name="l01117"></a>01117         ((retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>) &amp;&amp; <a class="code" href="../../df/db0/wm__event__system_8c.html#a8cfab85e7fa1af62deb63790f5ef788f">wm_operator_register_check</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), ot)))
<a name="l01118"></a>01118     {
<a name="l01119"></a>01119         reports-&gt;<a class="code" href="../../df/df0/structReportList.html#a1b957177626886c8feb4bf4c6ea1fa1b">flag</a> |= <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861ac9c8917a54b2a03d788a80a0c44dd0c1">RPT_FREE</a>; <span class="comment">/* let blender manage freeing */</span>
<a name="l01120"></a>01120     }
<a name="l01121"></a>01121     
<a name="l01122"></a>01122     <span class="keywordflow">return</span> retval;
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="comment">/* ********************* handlers *************** */</span>
<a name="l01127"></a>01127 
<a name="l01128"></a>01128 <span class="comment">/* future extra customadata free? */</span>
<a name="l01129"></a><a class="code" href="../../de/d44/wm__event__system_8h.html#ade5963989869828e5bd52a0e579d4be3">01129</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler)
<a name="l01130"></a>01130 {
<a name="l01131"></a>01131     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(handler);
<a name="l01132"></a>01132 }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 <span class="comment">/* only set context when area/region is part of screen */</span>
<a name="l01135"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a154d5b7afbb196ef19c78598239e4f59">01135</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a154d5b7afbb196ef19c78598239e4f59">wm_handler_op_context</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler)
<a name="l01136"></a>01136 {
<a name="l01137"></a>01137     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01138"></a>01138     
<a name="l01139"></a>01139     <span class="keywordflow">if</span> (screen &amp;&amp; handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>) {
<a name="l01140"></a>01140         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a66bd3c402abc66089576e2e965468a42">op_area</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01141"></a>01141             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01142"></a>01142         <span class="keywordflow">else</span> {
<a name="l01143"></a>01143             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01144"></a>01144             
<a name="l01145"></a>01145             <span class="keywordflow">for</span> (sa = screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>)
<a name="l01146"></a>01146                 <span class="keywordflow">if</span> (sa == handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a66bd3c402abc66089576e2e965468a42">op_area</a>)
<a name="l01147"></a>01147                     <span class="keywordflow">break</span>;
<a name="l01148"></a>01148             <span class="keywordflow">if</span> (sa == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01149"></a>01149                 <span class="comment">/* when changing screen layouts with running modal handlers (like render display), this</span>
<a name="l01150"></a>01150 <span class="comment">                 * is not an error to print */</span>
<a name="l01151"></a>01151                 <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01152"></a>01152                     printf(<span class="stringliteral">&quot;internal error: handler (%s) has invalid area\n&quot;</span>, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l01153"></a>01153             }
<a name="l01154"></a>01154             <span class="keywordflow">else</span> {
<a name="l01155"></a>01155                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01156"></a>01156                 <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sa);
<a name="l01157"></a>01157                 <span class="keywordflow">for</span> (ar = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01158"></a>01158                     <span class="keywordflow">if</span> (ar == handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aea5bb90811d38a19b3784437ea596e12">op_region</a>)
<a name="l01159"></a>01159                         <span class="keywordflow">break</span>;
<a name="l01160"></a>01160                 <span class="comment">/* XXX no warning print here, after full-area and back regions are remade */</span>
<a name="l01161"></a>01161                 <span class="keywordflow">if</span> (ar)
<a name="l01162"></a>01162                     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l01163"></a>01163             }
<a name="l01164"></a>01164         }
<a name="l01165"></a>01165     }
<a name="l01166"></a>01166 }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168 <span class="comment">/* called on exit or remove area, only here call cancel callback */</span>
<a name="l01169"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#ab4916736e4c1f1b05389615cbe68c0bb">01169</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>)
<a name="l01170"></a>01170 {
<a name="l01171"></a>01171     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l01172"></a>01172     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01173"></a>01173     
<a name="l01174"></a>01174     <span class="comment">/* C is zero on freeing database, modal handlers then already were freed */</span>
<a name="l01175"></a>01175     <span class="keywordflow">while</span> ((handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)) {
<a name="l01176"></a>01176         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l01177"></a>01177         
<a name="l01178"></a>01178         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>) {
<a name="l01179"></a>01179             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a>) {
<a name="l01180"></a>01180                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01181"></a>01181                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *region = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01182"></a>01182                 
<a name="l01183"></a>01183                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a154d5b7afbb196ef19c78598239e4f59">wm_handler_op_context</a>(C, handler);
<a name="l01184"></a>01184 
<a name="l01185"></a>01185                 <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01186"></a>01186                     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188                 handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190                 <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01191"></a>01191                     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193                 <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area);
<a name="l01194"></a>01194                 <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, region);
<a name="l01195"></a>01195             }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197             <a class="code" href="../../de/d3c/wm__cursors_8c.html#a2867b8dc5deb9d551abadd74d402fb14">WM_cursor_ungrab</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l01198"></a>01198             <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01199"></a>01199         }
<a name="l01200"></a>01200         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa6c35bb61beab7ba18b2551325762676">ui_remove</a>) {
<a name="l01201"></a>01201             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01202"></a>01202             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *region = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01203"></a>01203             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *menu = <a class="code" href="../../df/d01/BKE__context_8h.html#a2753b66475f5c46f20ba08a747dd019d">CTX_wm_menu</a>(C);
<a name="l01204"></a>01204             
<a name="l01205"></a>01205             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9c59ce912d8a1c2a8bdde580e38e23b4">ui_area</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9c59ce912d8a1c2a8bdde580e38e23b4">ui_area</a>);
<a name="l01206"></a>01206             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a09f78ad35020e7779a4965cc22de87d2">ui_region</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a09f78ad35020e7779a4965cc22de87d2">ui_region</a>);
<a name="l01207"></a>01207             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ac7403aada39c85bd5bfd56da978abd27">ui_menu</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#a472d961c6c917b76140a73038341676e">CTX_wm_menu_set</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ac7403aada39c85bd5bfd56da978abd27">ui_menu</a>);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209             handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa6c35bb61beab7ba18b2551325762676">ui_remove</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a190cb3c5434af0dc7b7cffe03d5878b4">ui_userdata</a>);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area);
<a name="l01212"></a>01212             <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, region);
<a name="l01213"></a>01213             <a class="code" href="../../df/d01/BKE__context_8h.html#a472d961c6c917b76140a73038341676e">CTX_wm_menu_set</a>(C, menu);
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216         <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 <span class="comment">/* do userdef mappings */</span>
<a name="l01221"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a2e6d2aa684dabbe319cd5476b9b511ae">01221</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a2e6d2aa684dabbe319cd5476b9b511ae">WM_userdef_event_map</a>(<span class="keywordtype">int</span> kmitype)
<a name="l01222"></a>01222 {
<a name="l01223"></a>01223     <span class="keywordflow">switch</span> (kmitype) {
<a name="l01224"></a>01224         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a89bae51e6e6473f10cc5d4ef5b1312da">SELECTMOUSE</a>:
<a name="l01225"></a>01225             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a59a76e2a3582e7eb4d48ed6495380c0c">USER_LMOUSESELECT</a>)
<a name="l01226"></a>01226                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>;
<a name="l01227"></a>01227             <span class="keywordflow">else</span>
<a name="l01228"></a>01228                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>;
<a name="l01229"></a>01229             
<a name="l01230"></a>01230         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#acf30d15993b89343dd0b029bc8fc7eee">ACTIONMOUSE</a>:
<a name="l01231"></a>01231             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a59a76e2a3582e7eb4d48ed6495380c0c">USER_LMOUSESELECT</a>)
<a name="l01232"></a>01232                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>;
<a name="l01233"></a>01233             <span class="keywordflow">else</span>
<a name="l01234"></a>01234                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>;
<a name="l01235"></a>01235             
<a name="l01236"></a>01236         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3c41d070a90b207d618058b1fb5350c7">WHEELOUTMOUSE</a>:
<a name="l01237"></a>01237             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a3d7bbff672d4115b7a45082144a4674e">USER_WHEELZOOMDIR</a>)
<a name="l01238"></a>01238                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>;
<a name="l01239"></a>01239             <span class="keywordflow">else</span>
<a name="l01240"></a>01240                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>;
<a name="l01241"></a>01241             
<a name="l01242"></a>01242         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68fca273375360faf8a1f122cfe1a37c">WHEELINMOUSE</a>:
<a name="l01243"></a>01243             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a3d7bbff672d4115b7a45082144a4674e">USER_WHEELZOOMDIR</a>)
<a name="l01244"></a>01244                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>;
<a name="l01245"></a>01245             <span class="keywordflow">else</span>
<a name="l01246"></a>01246                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>;
<a name="l01247"></a>01247             
<a name="l01248"></a>01248         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99cc67918f581e69d545dd536f372de5">EVT_TWEAK_A</a>:
<a name="l01249"></a>01249             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a59a76e2a3582e7eb4d48ed6495380c0c">USER_LMOUSESELECT</a>)
<a name="l01250"></a>01250                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68017306864d5fdc47f7f1de55d948ef">EVT_TWEAK_R</a>;
<a name="l01251"></a>01251             <span class="keywordflow">else</span>
<a name="l01252"></a>01252                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4834ccdca786c15b0f3520f69a98b7f">EVT_TWEAK_L</a>;
<a name="l01253"></a>01253             
<a name="l01254"></a>01254         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa25262ce2d3aada0f05c046ba31d6926">EVT_TWEAK_S</a>:
<a name="l01255"></a>01255             <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a59a76e2a3582e7eb4d48ed6495380c0c">USER_LMOUSESELECT</a>)
<a name="l01256"></a>01256                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4834ccdca786c15b0f3520f69a98b7f">EVT_TWEAK_L</a>;
<a name="l01257"></a>01257             <span class="keywordflow">else</span>
<a name="l01258"></a>01258                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68017306864d5fdc47f7f1de55d948ef">EVT_TWEAK_R</a>;
<a name="l01259"></a>01259     }
<a name="l01260"></a>01260     
<a name="l01261"></a>01261     <span class="keywordflow">return</span> kmitype;
<a name="l01262"></a>01262 }
<a name="l01263"></a>01263 
<a name="l01264"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a5bd2ae3a9abe5e0c9473c7a5a6d43e1c">01264</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a5bd2ae3a9abe5e0c9473c7a5a6d43e1c">wm_eventemulation</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01265"></a>01265 {
<a name="l01266"></a>01266     <span class="keyword">static</span> <span class="keywordtype">int</span> mmb_emulated = 0; <span class="comment">/* this should be in a data structure somwhere */</span>
<a name="l01267"></a>01267     
<a name="l01268"></a>01268     <span class="comment">/* middlemouse emulation */</span>
<a name="l01269"></a>01269     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a19f043fda335f6207e2a3c0675e63cf9">USER_TWOBUTTONMOUSE</a>) {
<a name="l01270"></a>01270         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> || mmb_emulated == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)) {
<a name="l01271"></a>01271             <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>;
<a name="l01272"></a>01272             <span class="keyword">event</span>-&gt;alt = 0;
<a name="l01273"></a>01273             mmb_emulated = <span class="keyword">event</span>-&gt;val;
<a name="l01274"></a>01274         }
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276 
<a name="l01277"></a>01277 <span class="preprocessor">#ifdef __APPLE__</span>
<a name="l01278"></a>01278 <span class="preprocessor"></span>    <span class="comment">/* rightmouse emulation */</span>
<a name="l01279"></a>01279     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a19f043fda335f6207e2a3c0675e63cf9">USER_TWOBUTTONMOUSE</a>) {
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a> || mmb_emulated == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)) {
<a name="l01281"></a>01281             <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>;
<a name="l01282"></a>01282             <span class="keyword">event</span>-&gt;oskey = 0;
<a name="l01283"></a>01283             mmb_emulated = <span class="keyword">event</span>-&gt;val;
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286 <span class="preprocessor">#endif</span>
<a name="l01287"></a>01287 <span class="preprocessor"></span>
<a name="l01288"></a>01288     <span class="comment">/* numpad emulation */</span>
<a name="l01289"></a>01289     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#af8cdcb455f0c5714ac22b92302875839">USER_NONUMPAD</a>) {
<a name="l01290"></a>01290         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01291"></a>01291             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a18fef1c6c42114045de29186f96e1878">ZEROKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a04cfc47c84309660da78fc8a479679c3">PAD0</a>; <span class="keywordflow">break</span>;
<a name="l01292"></a>01292             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab9fb6b3cb0a4d451b63de95c43f0c71c">ONEKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a01d2fb85e309555aba53cd538c19e8f6">PAD1</a>; <span class="keywordflow">break</span>;
<a name="l01293"></a>01293             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a514ead02a18560423d79e5c1e8cdea52">TWOKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99e5b4d67a9e666386ddf2101b962d6f">PAD2</a>; <span class="keywordflow">break</span>;
<a name="l01294"></a>01294             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc29e796f859c8e645a294b10c7fe2cb">THREEKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad219dd30c4b1c517b3ded1a3da26018f">PAD3</a>; <span class="keywordflow">break</span>;
<a name="l01295"></a>01295             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3d15f5dababa2ad8fb0c2a744e0c5207">FOURKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a59adfc10114409298d29e8a34f9420aa">PAD4</a>; <span class="keywordflow">break</span>;
<a name="l01296"></a>01296             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6d42a1643aaa139744c0a9a164622fd2">FIVEKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab1c311ab4886ead1cae73e276ee76371">PAD5</a>; <span class="keywordflow">break</span>;
<a name="l01297"></a>01297             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab710951e04d672ce9f23292a4d55126b">SIXKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2b9bf38285d3ef4cc630ba4b1ed1d41c">PAD6</a>; <span class="keywordflow">break</span>;
<a name="l01298"></a>01298             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9e76fe8ee785f01500ad44394cd6e66e">SEVENKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a1cb7f7860cae61be1831169aa1d8ba06">PAD7</a>; <span class="keywordflow">break</span>;
<a name="l01299"></a>01299             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a27ea2a95deee54dc8c7ce9f9db4b2387">EIGHTKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#abbff1efb9138f1ccbe1f01fd17b912d8">PAD8</a>; <span class="keywordflow">break</span>;
<a name="l01300"></a>01300             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a06009c2bd60552b82b76d219409ba513">NINEKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a4c06e7c1830872541a40dc04cdd2b589">PAD9</a>; <span class="keywordflow">break</span>;
<a name="l01301"></a>01301             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32aa9ced052bfd4e51f37e3f872adfb8">MINUSKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>; <span class="keywordflow">break</span>;
<a name="l01302"></a>01302             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6622a89438c3591abe1430569e645a33">EQUALKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>; <span class="keywordflow">break</span>;
<a name="l01303"></a>01303             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a02007f618028364a8c4118d8d2d5ff42">BACKSLASHKEY</a>: <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5c34cf5cadbf3ffd60ca6b3b8ec14605">PADSLASHKEY</a>; <span class="keywordflow">break</span>;
<a name="l01304"></a>01304         }
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306 }
<a name="l01307"></a>01307 
<a name="l01308"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a331a052f434f1bd44be9cf7542badde8">01308</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a331a052f434f1bd44be9cf7542badde8">wm_eventmatch</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *winevent, <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi)
<a name="l01309"></a>01309 {
<a name="l01310"></a>01310     <span class="keywordtype">int</span> kmitype = <a class="code" href="../../df/db0/wm__event__system_8c.html#a2e6d2aa684dabbe319cd5476b9b511ae">WM_userdef_event_map</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a>);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae87cf259d931977dc4cae5e3dc3b3e21">flag</a> &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#acd1b074f6acb16afd0e11d526bf788dc">KMI_INACTIVE</a>) <span class="keywordflow">return</span> 0;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314     <span class="comment">/* the matching rules */</span>
<a name="l01315"></a>01315     <span class="keywordflow">if</span> (kmitype == <a class="code" href="../../d4/ddc/WM__types_8h.html#a97515ae3e2dca930951cbeb7fb021d46">KM_TEXTINPUT</a>)
<a name="l01316"></a>01316         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#ac61fa68f19773080e70cdc4956150c29">ISTEXTINPUT</a>(winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) &amp;&amp; (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#af3606467f06540b8776a50419af70a71">ascii</a> || winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0])) <span class="keywordflow">return</span> 1;
<a name="l01317"></a>01317     <span class="keywordflow">if</span> (kmitype != <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>)
<a name="l01318"></a>01318         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> != kmitype) <span class="keywordflow">return</span> 0;
<a name="l01319"></a>01319     
<a name="l01320"></a>01320     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a484ea38a77ce4b2cdb230e14bd62076c">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>)
<a name="l01321"></a>01321         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a484ea38a77ce4b2cdb230e14bd62076c">val</a>) <span class="keywordflow">return</span> 0;
<a name="l01322"></a>01322     
<a name="l01323"></a>01323     <span class="comment">/* modifiers also check bits, so it allows modifier order */</span>
<a name="l01324"></a>01324     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae67828f5d20eb5086c74fd527b35caa1">shift</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>)
<a name="l01325"></a>01325         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae67828f5d20eb5086c74fd527b35caa1">shift</a> &amp;&amp; !(winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> &amp; kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae67828f5d20eb5086c74fd527b35caa1">shift</a>)) <span class="keywordflow">return</span> 0;
<a name="l01326"></a>01326     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae9e45d7a5444ba2d07b18e2dd32be37c">ctrl</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>)
<a name="l01327"></a>01327         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae9e45d7a5444ba2d07b18e2dd32be37c">ctrl</a> &amp;&amp; !(winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> &amp; kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae9e45d7a5444ba2d07b18e2dd32be37c">ctrl</a>)) <span class="keywordflow">return</span> 0;
<a name="l01328"></a>01328     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#acb8f59949206fdb449c3ca9bcb2547ee">alt</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>)
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#acb8f59949206fdb449c3ca9bcb2547ee">alt</a> &amp;&amp; !(winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> &amp; kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#acb8f59949206fdb449c3ca9bcb2547ee">alt</a>)) <span class="keywordflow">return</span> 0;
<a name="l01330"></a>01330     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#aaa6678273bab5fbfe274a8a6ffc9c5af">oskey</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>)
<a name="l01331"></a>01331         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#aaa6678273bab5fbfe274a8a6ffc9c5af">oskey</a> &amp;&amp; !(winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a> &amp; kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#aaa6678273bab5fbfe274a8a6ffc9c5af">oskey</a>)) <span class="keywordflow">return</span> 0;
<a name="l01332"></a>01332     
<a name="l01333"></a>01333     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a6bb1e80cb8ebb6d69b64216b87b9e633">keymodifier</a>)
<a name="l01334"></a>01334         <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a6bb1e80cb8ebb6d69b64216b87b9e633">keymodifier</a>) <span class="keywordflow">return</span> 0;
<a name="l01335"></a>01335         
<a name="l01336"></a>01336     <span class="comment">/* key modifiers always check when event has it */</span>
<a name="l01337"></a>01337     <span class="comment">/* otherwise regular keypresses with keymodifier still work */</span>
<a name="l01338"></a>01338     <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a>)
<a name="l01339"></a>01339         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#ac61fa68f19773080e70cdc4956150c29">ISTEXTINPUT</a>(winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)) 
<a name="l01340"></a>01340             <span class="keywordflow">if</span> (winevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> != kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a6bb1e80cb8ebb6d69b64216b87b9e633">keymodifier</a>) <span class="keywordflow">return</span> 0;
<a name="l01341"></a>01341     
<a name="l01342"></a>01342     <span class="keywordflow">return</span> 1;
<a name="l01343"></a>01343 }
<a name="l01344"></a>01344 
<a name="l01345"></a>01345 
<a name="l01346"></a>01346 <span class="comment">/* operator exists */</span>
<a name="l01347"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#af23cf8a4f51eb202dbd9bac8b43fd6de">01347</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#af23cf8a4f51eb202dbd9bac8b43fd6de">wm_event_modalkeymap</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01348"></a>01348 {
<a name="l01349"></a>01349     <span class="comment">/* support for modal keymap in macros */</span>
<a name="l01350"></a>01350     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>)
<a name="l01351"></a>01351         op = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0d13d4a55c5ec3e0b6121a7b8add67ea">modalkeymap</a>) {
<a name="l01354"></a>01354         <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a5d7466bc7e94c53b52260316d84b72ad">WM_keymap_active</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0d13d4a55c5ec3e0b6121a7b8add67ea">modalkeymap</a>);
<a name="l01355"></a>01355         <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l01356"></a>01356 
<a name="l01357"></a>01357         <span class="keywordflow">for</span> (kmi = keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a0ae48f8a4481c3faf008d60d6d61b4ad">items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmi; kmi = kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a5cb105349fd3c21f73142d637602a75e">next</a>) {
<a name="l01358"></a>01358             <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a331a052f434f1bd44be9cf7542badde8">wm_eventmatch</a>(event, kmi)) {
<a name="l01359"></a>01359                     
<a name="l01360"></a>01360                 <span class="keyword">event</span>-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5ec351ea2051b0b75965a8ad0a7b4a6c">EVT_MODAL_MAP</a>;
<a name="l01361"></a>01361                 <span class="keyword">event</span>-&gt;val = kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a06331283ff29944b3c6849ce1a8ebb86">propvalue</a>;
<a name="l01362"></a>01362             }
<a name="l01363"></a>01363         }
<a name="l01364"></a>01364     }
<a name="l01365"></a>01365 }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367 <span class="comment">/* Warning: this function removes a modal handler, when finished */</span>
<a name="l01368"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a253d6a58a244c9f65fa266c3389f13bd">01368</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a253d6a58a244c9f65fa266c3389f13bd">wm_handler_operator_call</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>, <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler,
<a name="l01369"></a>01369                                     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *properties)
<a name="l01370"></a>01370 {
<a name="l01371"></a>01371     <span class="keywordtype">int</span> retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01372"></a>01372     
<a name="l01373"></a>01373     <span class="comment">/* derived, modal or blocking operator */</span>
<a name="l01374"></a>01374     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>) {
<a name="l01375"></a>01375         <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>;
<a name="l01376"></a>01376         <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>;
<a name="l01377"></a>01377 
<a name="l01378"></a>01378         <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a>) {
<a name="l01379"></a>01379             <span class="comment">/* we set context to where modal handler came from */</span>
<a name="l01380"></a>01380             <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01381"></a>01381             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01382"></a>01382             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *region = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01383"></a>01383             
<a name="l01384"></a>01384             <a class="code" href="../../df/db0/wm__event__system_8c.html#a154d5b7afbb196ef19c78598239e4f59">wm_handler_op_context</a>(C, handler);
<a name="l01385"></a>01385             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(C, event);
<a name="l01386"></a>01386             <a class="code" href="../../df/db0/wm__event__system_8c.html#af23cf8a4f51eb202dbd9bac8b43fd6de">wm_event_modalkeymap</a>(C, op, event);
<a name="l01387"></a>01387             
<a name="l01388"></a>01388             <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01389"></a>01389                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l01390"></a>01390 
<a name="l01391"></a>01391             retval = ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a>(C, op, event);
<a name="l01392"></a>01392             <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aee6c70fc4e0bf180b577cd0c27409feb">OPERATOR_RETVAL_CHECK</a>(retval);
<a name="l01393"></a>01393 
<a name="l01394"></a>01394             <span class="comment">/* when this is _not_ the case the modal modifier may have loaded</span>
<a name="l01395"></a>01395 <span class="comment">             * a new blend file (demo mode does this), so we have to assume</span>
<a name="l01396"></a>01396 <span class="comment">             * the event, operator etc have all been freed. - campbell */</span>
<a name="l01397"></a>01397             <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm) {
<a name="l01398"></a>01398 
<a name="l01399"></a>01399                 <span class="keywordflow">if</span> (ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01400"></a>01400                     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l01401"></a>01401 
<a name="l01402"></a>01402                 <span class="comment">/* putting back screen context, reval can pass trough after modal failures! */</span>
<a name="l01403"></a>01403                 <span class="keywordflow">if</span> ((retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>) || <a class="code" href="../../df/db0/wm__event__system_8c.html#a2dfa757b9be8ede8a1044c3f5dac6a81">wm_event_always_pass</a>(event)) {
<a name="l01404"></a>01404                     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area);
<a name="l01405"></a>01405                     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, region);
<a name="l01406"></a>01406                 }
<a name="l01407"></a>01407                 <span class="keywordflow">else</span> {
<a name="l01408"></a>01408                     <span class="comment">/* this special cases is for areas and regions that get removed */</span>
<a name="l01409"></a>01409                     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01410"></a>01410                     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01411"></a>01411                 }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413                 <span class="keywordflow">if</span> (retval &amp; (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a> | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>))
<a name="l01414"></a>01414                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a2b0e04b4b589ee017bfd1e6565533512">wm_operator_reports</a>(C, op, retval, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01415"></a>01415 
<a name="l01416"></a>01416                 <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>) {
<a name="l01417"></a>01417                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a585ba36e914a6f3fb424c32977655a05">wm_operator_finished</a>(C, op, 0);
<a name="l01418"></a>01418                     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01419"></a>01419                 }
<a name="l01420"></a>01420                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (retval &amp; (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a> | OPERATOR_FINISHED)) {
<a name="l01421"></a>01421                     <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(op);
<a name="l01422"></a>01422                     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01423"></a>01423                 }
<a name="l01424"></a>01424 
<a name="l01425"></a>01425                 <span class="comment">/* remove modal handler, operator itself should have been canceled and freed */</span>
<a name="l01426"></a>01426                 <span class="keywordflow">if</span> (retval &amp; (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a> | OPERATOR_FINISHED)) {
<a name="l01427"></a>01427                     <a class="code" href="../../de/d3c/wm__cursors_8c.html#a2867b8dc5deb9d551abadd74d402fb14">WM_cursor_ungrab</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l01428"></a>01428 
<a name="l01429"></a>01429                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l01430"></a>01430                     <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l01431"></a>01431 
<a name="l01432"></a>01432                     <span class="comment">/* prevent silly errors from operator users */</span>
<a name="l01433"></a>01433                     <span class="comment">//retval &amp;= ~OPERATOR_PASS_THROUGH;</span>
<a name="l01434"></a>01434                 }
<a name="l01435"></a>01435             }
<a name="l01436"></a>01436             
<a name="l01437"></a>01437         }
<a name="l01438"></a>01438         <span class="keywordflow">else</span>
<a name="l01439"></a>01439             printf(<span class="stringliteral">&quot;wm_handler_operator_call error\n&quot;</span>);
<a name="l01440"></a>01440     }
<a name="l01441"></a>01441     <span class="keywordflow">else</span> {
<a name="l01442"></a>01442         <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot = <a class="code" href="../../d6/dae/wm__operators_8c.html#a10ed9150324ef83e52559b8cb5293c4b">WM_operatortype_find</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a46a393a4a06349cc74da76e86a826533">keymap_idname</a>, 0);
<a name="l01443"></a>01443 
<a name="l01444"></a>01444         <span class="keywordflow">if</span> (ot)
<a name="l01445"></a>01445             retval = <a class="code" href="../../df/db0/wm__event__system_8c.html#aa101dfe3a32d4f449337a58fe05a7415">wm_operator_invoke</a>(C, ot, event, properties, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01446"></a>01446     }
<a name="l01447"></a>01447     <span class="comment">/* Finished and pass through flag as handled */</span>
<a name="l01448"></a>01448 
<a name="l01449"></a>01449     <span class="comment">/* Finished and pass through flag as handled */</span>
<a name="l01450"></a>01450     <span class="keywordflow">if</span> (retval == (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a> | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>))
<a name="l01451"></a>01451         <span class="keywordflow">return</span> <a class="code" href="../../de/d44/wm__event__system_8h.html#a06e38888c3d7296fd383034186dbf723">WM_HANDLER_HANDLED</a>;
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     <span class="comment">/* Modal unhandled, break */</span>
<a name="l01454"></a>01454     <span class="keywordflow">if</span> (retval == (<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a> | <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>))
<a name="l01455"></a>01455         <span class="keywordflow">return</span> (<a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a> | <a class="code" href="../../de/d44/wm__event__system_8h.html#addaa819a62de5c4328b1e8aadc1946d2">WM_HANDLER_MODAL</a>);
<a name="l01456"></a>01456 
<a name="l01457"></a>01457     <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>)
<a name="l01458"></a>01458         <span class="keywordflow">return</span> <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a>;
<a name="l01459"></a>01459 
<a name="l01460"></a>01460     <span class="keywordflow">return</span> <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>;
<a name="l01461"></a>01461 }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463 <span class="comment">/* fileselect handlers are only in the window queue, so it&#39;s save to switch screens or area types */</span>
<a name="l01464"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a9881ee8ff7961e92e2ee1a827b0e46cf">01464</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a9881ee8ff7961e92e2ee1a827b0e46cf">wm_handler_fileselect_call</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>, <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01465"></a>01465 {
<a name="l01466"></a>01466     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01467"></a>01467     <a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *sfile;
<a name="l01468"></a>01468     <span class="keywordtype">int</span> action = <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a>;
<a name="l01469"></a>01469     
<a name="l01470"></a>01470     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> != <a class="code" href="../../d1/d40/wm__event__types_8h.html#a12b3eec44d42dec79689daa7540937df">EVT_FILESELECT</a>)
<a name="l01471"></a>01471         <span class="keywordflow">return</span> action;
<a name="l01472"></a>01472     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> != (<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>)
<a name="l01473"></a>01473         <span class="keywordflow">return</span> action;
<a name="l01474"></a>01474     
<a name="l01475"></a>01475     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>) {
<a name="l01476"></a>01476         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac8e642cf8e13a756dbb7884acf519ef0">EVT_FILESELECT_OPEN</a>: 
<a name="l01477"></a>01477         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae2b9e7e8ff4a154d3e678b2eefdb1bcd">EVT_FILESELECT_FULL_OPEN</a>: 
<a name="l01478"></a>01478         {
<a name="l01479"></a>01479             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01480"></a>01480                 
<a name="l01481"></a>01481             <span class="comment">/* sa can be null when window A is active, but mouse is over window B */</span>
<a name="l01482"></a>01482             <span class="comment">/* in this case, open file select in original window A */</span>
<a name="l01483"></a>01483             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a66bd3c402abc66089576e2e965468a42">op_area</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01484"></a>01484                 <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01485"></a>01485                 sa = (<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *)screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01486"></a>01486             }
<a name="l01487"></a>01487             <span class="keywordflow">else</span> {
<a name="l01488"></a>01488                 sa = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a66bd3c402abc66089576e2e965468a42">op_area</a>;
<a name="l01489"></a>01489             }
<a name="l01490"></a>01490                     
<a name="l01491"></a>01491             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac8e642cf8e13a756dbb7884acf519ef0">EVT_FILESELECT_OPEN</a>) {
<a name="l01492"></a>01492                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a1768c9e14c6c8f09f1b8175ca1d7f3cf">ED_area_newspace</a>(C, sa, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>);     <span class="comment">/* &#39;sa&#39; is modified in-place */</span>
<a name="l01493"></a>01493             }
<a name="l01494"></a>01494             <span class="keywordflow">else</span> {
<a name="l01495"></a>01495                 sa = <a class="code" href="../../d1/d12/ED__screen_8h.html#a5f595c7eca6737f06e997f7f45cd5d3a">ED_screen_full_newspace</a>(C, sa, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>);    <span class="comment">/* sets context */</span>
<a name="l01496"></a>01496             }
<a name="l01497"></a>01497 
<a name="l01498"></a>01498             <span class="comment">/* note, getting the &#39;sa&#39; back from the context causes a nasty bug where the newly created</span>
<a name="l01499"></a>01499 <span class="comment">             * &#39;sa&#39; != CTX_wm_area(C). removed the line below and set &#39;sa&#39; in the &#39;if&#39; above */</span>
<a name="l01500"></a>01500             <span class="comment">/* sa = CTX_wm_area(C); */</span>
<a name="l01501"></a>01501 
<a name="l01502"></a>01502             <span class="comment">/* settings for filebrowser, sfile is not operator owner but sends events */</span>
<a name="l01503"></a>01503             sfile = (<a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *)sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01504"></a>01504             sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a5ef6059fa41acf4330598c19a62918ff">op</a> = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>;
<a name="l01505"></a>01505 
<a name="l01506"></a>01506             <a class="code" href="../../db/db9/ED__fileselect_8h.html#a93272b924e691d76e6479457963cc2f5">ED_fileselect_set_params</a>(sfile);
<a name="l01507"></a>01507                 
<a name="l01508"></a>01508             action = <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>;
<a name="l01509"></a>01509         }
<a name="l01510"></a>01510         <span class="keywordflow">break</span>;
<a name="l01511"></a>01511             
<a name="l01512"></a>01512         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab86275c636dc8e3b3aeb94494d3293c1">EVT_FILESELECT_EXEC</a>:
<a name="l01513"></a>01513         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8c272fc867c9ef3db753b6964363e788">EVT_FILESELECT_CANCEL</a>:
<a name="l01514"></a>01514         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a31e97382f9dad7bc85cbf3a24dd4a08a">EVT_FILESELECT_EXTERNAL_CANCEL</a>:
<a name="l01515"></a>01515         {
<a name="l01516"></a>01516             <span class="comment">/* XXX validate area and region? */</span>
<a name="l01517"></a>01517             <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01518"></a>01518 
<a name="l01519"></a>01519             <span class="comment">/* remlink now, for load file case before removing*/</span>
<a name="l01520"></a>01520             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l01521"></a>01521                 
<a name="l01522"></a>01522             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d1/d40/wm__event__types_8h.html#a31e97382f9dad7bc85cbf3a24dd4a08a">EVT_FILESELECT_EXTERNAL_CANCEL</a>) {
<a name="l01523"></a>01523                 <span class="keywordflow">if</span> (screen != handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a5e734569adb8e149100c1fe9d7f3f75a">filescreen</a>) {
<a name="l01524"></a>01524                     <a class="code" href="../../d1/d12/ED__screen_8h.html#a445dee5183a248ba3f77cf1e56240819">ED_screen_full_prevspace</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l01525"></a>01525                 }
<a name="l01526"></a>01526                 <span class="keywordflow">else</span> {
<a name="l01527"></a>01527                     <a class="code" href="../../d1/d12/ED__screen_8h.html#ad402cde74964d06df69a976c69bafb9a">ED_area_prevspace</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l01528"></a>01528                 }
<a name="l01529"></a>01529             }
<a name="l01530"></a>01530                 
<a name="l01531"></a>01531             <a class="code" href="../../df/db0/wm__event__system_8c.html#a154d5b7afbb196ef19c78598239e4f59">wm_handler_op_context</a>(C, handler);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533             <span class="comment">/* needed for uiPupMenuReports */</span>
<a name="l01534"></a>01534 
<a name="l01535"></a>01535             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab86275c636dc8e3b3aeb94494d3293c1">EVT_FILESELECT_EXEC</a>) {
<a name="l01536"></a>01536 <span class="preprocessor">#if 0               // use REDALERT now</span>
<a name="l01537"></a>01537 <span class="preprocessor"></span>
<a name="l01538"></a>01538                 <span class="comment">/* a bit weak, might become arg for WM_event_fileselect? */</span>
<a name="l01539"></a>01539                 <span class="comment">/* XXX also extension code in image-save doesnt work for this yet */</span>
<a name="l01540"></a>01540                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;check_existing&quot;</span>) &amp;&amp;
<a name="l01541"></a>01541                     <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;check_existing&quot;</span>)) {
<a name="l01542"></a>01542                     <span class="keywordtype">char</span> *path = <a class="code" href="../../d3/d10/rna__access_8c.html#afeb202c69e280217f90b9504ad559876">RNA_string_get_alloc</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;filepath&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l01543"></a>01543                     <span class="comment">/* this gives ownership to pupmenu */</span>
<a name="l01544"></a>01544                     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8189c52b37a62cbf18d6e03393b4c6b0">uiPupMenuSaveOver</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>, (path) ? path : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01545"></a>01545                     <span class="keywordflow">if</span> (path)
<a name="l01546"></a>01546                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(path);
<a name="l01547"></a>01547                 }
<a name="l01548"></a>01548                 <span class="keywordflow">else</span>
<a name="l01549"></a>01549 <span class="preprocessor">#endif</span>
<a name="l01550"></a>01550 <span class="preprocessor"></span>                {
<a name="l01551"></a>01551                     <span class="keywordtype">int</span> retval;
<a name="l01552"></a>01552                         
<a name="l01553"></a>01553                     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01554"></a>01554                         wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l01555"></a>01555                         
<a name="l01556"></a>01556                     retval = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01557"></a>01557 
<a name="l01558"></a>01558                     <span class="comment">/* XXX check this carefully, CTX_wm_manager(C) == wm is a bit hackish */</span>
<a name="l01559"></a>01559                     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a> &amp;&amp; <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm)
<a name="l01560"></a>01560                         wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l01561"></a>01561 
<a name="l01562"></a>01562                     <span class="keywordflow">if</span> (retval &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>)
<a name="l01563"></a>01563                         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635ac6d954ef18e204c4b9694976304f6e32">G_DEBUG_WM</a>)
<a name="l01564"></a>01564                             <a class="code" href="../../df/db0/wm__event__system_8c.html#a45f2018e66c5fc3ab29db1d1843652a1">wm_operator_print</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01565"></a>01565 
<a name="l01566"></a>01566                     <span class="comment">/* XXX check this carefully, CTX_wm_manager(C) == wm is a bit hackish */</span>
<a name="l01567"></a>01567                     <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C) == wm &amp;&amp; wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a> == 0)
<a name="l01568"></a>01568                         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01569"></a>01569                             <a class="code" href="../../d6/df1/ED__util_8h.html#ac0d011fe1f79af98f6bd968b95b247e2">ED_undo_push_op</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01570"></a>01570 
<a name="l01571"></a>01571                     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#af4a8f2f776b099673ecbc6f04bf5db31">list</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l01572"></a>01572 
<a name="l01573"></a>01573                         <span class="comment">/* FIXME, temp setting window, this is really bad!</span>
<a name="l01574"></a>01574 <span class="comment">                         * only have because lib linking errors need to be seen by users :(</span>
<a name="l01575"></a>01575 <span class="comment">                         * it can be removed without breaking anything but then no linking errors - campbell */</span>
<a name="l01576"></a>01576                         <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win_prev = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01577"></a>01577                         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area_prev = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01578"></a>01578                         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar_prev = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01579"></a>01579 
<a name="l01580"></a>01580                         <span class="keywordflow">if</span> (win_prev == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01581"></a>01581                             <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C)-&gt;windows.first);
<a name="l01582"></a>01582 
<a name="l01583"></a>01583                         handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#aa06c3e301eab769a20c7070ce25c0ecd">printlevel</a> = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>;
<a name="l01584"></a>01584                         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a268031d65eb6174627e5b3486fb69f41">uiPupMenuReports</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>);
<a name="l01585"></a>01585 
<a name="l01586"></a>01586                         <span class="comment">/* XXX - copied from &#39;wm_operator_finished()&#39; */</span>
<a name="l01587"></a>01587                         <span class="comment">/* add reports to the global list, otherwise they are not seen */</span>
<a name="l01588"></a>01588                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(&amp;<a class="code" href="../../df/d01/BKE__context_8h.html#ac83792b6e00e841cdb896c9c0230bde7">CTX_wm_reports</a>(C)-&gt;list, &amp;handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>-&gt;<a class="code" href="../../df/df0/structReportList.html#af4a8f2f776b099673ecbc6f04bf5db31">list</a>);
<a name="l01589"></a>01589 
<a name="l01590"></a>01590                         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win_prev);
<a name="l01591"></a>01591                         <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, area_prev);
<a name="l01592"></a>01592                         <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar_prev);
<a name="l01593"></a>01593                     }
<a name="l01594"></a>01594 
<a name="l01595"></a>01595                     <span class="keywordflow">if</span> (retval &amp; OPERATOR_FINISHED) {
<a name="l01596"></a>01596                         <a class="code" href="../../df/db0/wm__event__system_8c.html#ae1a3f72b7e9647f032260ca19711a649">WM_operator_last_properties_store</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01597"></a>01597                     }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599                     <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01600"></a>01600                 }
<a name="l01601"></a>01601             }
<a name="l01602"></a>01602             <span class="keywordflow">else</span> {
<a name="l01603"></a>01603                 <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a>) {
<a name="l01604"></a>01604                     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01605"></a>01605                         wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>++;
<a name="l01606"></a>01606 
<a name="l01607"></a>01607                     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a>(C, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01608"></a>01608                 
<a name="l01609"></a>01609                     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> &amp; <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>)
<a name="l01610"></a>01610                         wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>--;
<a name="l01611"></a>01611                 }
<a name="l01612"></a>01612                 
<a name="l01613"></a>01613                 <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l01614"></a>01614             }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01617"></a>01617 
<a name="l01618"></a>01618             <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620             action = <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>;
<a name="l01621"></a>01621         }
<a name="l01622"></a>01622         <span class="keywordflow">break</span>;
<a name="l01623"></a>01623     }
<a name="l01624"></a>01624     
<a name="l01625"></a>01625     <span class="keywordflow">return</span> action;
<a name="l01626"></a>01626 }
<a name="l01627"></a>01627 
<a name="l01628"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a23d3ea92c1daeb84cb938f057c6f85c9">01628</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a23d3ea92c1daeb84cb938f057c6f85c9">handler_boundbox_test</a>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630     <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9a7b3a86b851ee5409bf50ed5b29c576">bbwin</a>) {
<a name="l01631"></a>01631         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a55f6cf46678dad00ea6949e6e02cc23a">bblocal</a>) {
<a name="l01632"></a>01632             <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect = *handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a55f6cf46678dad00ea6949e6e02cc23a">bblocal</a>;
<a name="l01633"></a>01633             <a class="code" href="../../d5/d44/BLI__rect_8h.html#a17840fabe97064de133e44216f7cc9c3">BLI_translate_rcti</a>(&amp;rect, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9a7b3a86b851ee5409bf50ed5b29c576">bbwin</a>-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9a7b3a86b851ee5409bf50ed5b29c576">bbwin</a>-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l01634"></a>01634 
<a name="l01635"></a>01635             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;rect, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l01636"></a>01636                 <span class="keywordflow">return</span> 1;
<a name="l01637"></a>01637             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> &amp;&amp; <a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;rect, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>))
<a name="l01638"></a>01638                 <span class="keywordflow">return</span> 1;
<a name="l01639"></a>01639             <span class="keywordflow">else</span>
<a name="l01640"></a>01640                 <span class="keywordflow">return</span> 0;
<a name="l01641"></a>01641         }
<a name="l01642"></a>01642         <span class="keywordflow">else</span> {
<a name="l01643"></a>01643             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9a7b3a86b851ee5409bf50ed5b29c576">bbwin</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l01644"></a>01644                 <span class="keywordflow">return</span> 1;
<a name="l01645"></a>01645             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> &amp;&amp; <a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9a7b3a86b851ee5409bf50ed5b29c576">bbwin</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>))
<a name="l01646"></a>01646                 <span class="keywordflow">return</span> 1;
<a name="l01647"></a>01647             <span class="keywordflow">else</span>
<a name="l01648"></a>01648                 <span class="keywordflow">return</span> 0;
<a name="l01649"></a>01649         }
<a name="l01650"></a>01650     }
<a name="l01651"></a>01651     <span class="keywordflow">return</span> 1;
<a name="l01652"></a>01652 }
<a name="l01653"></a>01653 
<a name="l01654"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a47356e8c94a0dc52317d61c122e2bf88">01654</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a47356e8c94a0dc52317d61c122e2bf88">wm_action_not_handled</a>(<span class="keywordtype">int</span> action)
<a name="l01655"></a>01655 {
<a name="l01656"></a>01656     <span class="keywordflow">return</span> action == <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a> || action == (<a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a> | <a class="code" href="../../de/d44/wm__event__system_8h.html#addaa819a62de5c4328b1e8aadc1946d2">WM_HANDLER_MODAL</a>);
<a name="l01657"></a>01657 }
<a name="l01658"></a>01658 
<a name="l01659"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">01659</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>)
<a name="l01660"></a>01660 {
<a name="l01661"></a>01661     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01662"></a>01662     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, *nexthandler;
<a name="l01663"></a>01663     <span class="keywordtype">int</span> action = <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a>;
<a name="l01664"></a>01664     <span class="keywordtype">int</span> always_pass;
<a name="l01665"></a>01665 
<a name="l01666"></a>01666     <span class="keywordflow">if</span> (handlers == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> action;
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     <span class="comment">/* modal handlers can get removed in this loop, we keep the loop this way */</span>
<a name="l01669"></a>01669     <span class="keywordflow">for</span> (handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = nexthandler) {
<a name="l01670"></a>01670         
<a name="l01671"></a>01671         nexthandler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>;
<a name="l01672"></a>01672         
<a name="l01673"></a>01673         <span class="comment">/* during this loop, ui handlers for nested menus can tag multiple handlers free */</span>
<a name="l01674"></a>01674         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa98d7f32c6f58fbdc8de63a713113ac8">flag</a> &amp; <a class="code" href="../../de/d44/wm__event__system_8h.html#af73d708d6d94420bd6e821daab960396">WM_HANDLER_DO_FREE</a>) ;
<a name="l01675"></a>01675         <span class="comment">/* optional boundbox */</span>
<a name="l01676"></a>01676         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a23d3ea92c1daeb84cb938f057c6f85c9">handler_boundbox_test</a>(handler, event)) {
<a name="l01677"></a>01677             <span class="comment">/* in advance to avoid access to freed event on window close */</span>
<a name="l01678"></a>01678             always_pass = <a class="code" href="../../df/db0/wm__event__system_8c.html#a2dfa757b9be8ede8a1044c3f5dac6a81">wm_event_always_pass</a>(event);
<a name="l01679"></a>01679         
<a name="l01680"></a>01680             <span class="comment">/* modal+blocking handler */</span>
<a name="l01681"></a>01681             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa98d7f32c6f58fbdc8de63a713113ac8">flag</a> &amp; <a class="code" href="../../de/d44/wm__event__system_8h.html#a24c3c60aa591ff426e9d4c26b4312062">WM_HANDLER_BLOCKING</a>)
<a name="l01682"></a>01682                 action |= <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>;
<a name="l01683"></a>01683 
<a name="l01684"></a>01684             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8b146bb6c683af409df4dad30e68b81">keymap</a>) {
<a name="l01685"></a>01685                 <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a5d7466bc7e94c53b52260316d84b72ad">WM_keymap_active</a>(wm, handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8b146bb6c683af409df4dad30e68b81">keymap</a>);
<a name="l01686"></a>01686                 <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l01687"></a>01687                 
<a name="l01688"></a>01688                 <span class="keywordflow">if</span> (!keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a6bd6ed052aac9fe1b3ae3b18143b77c1">poll</a> || keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a6bd6ed052aac9fe1b3ae3b18143b77c1">poll</a>(C)) {
<a name="l01689"></a>01689                     <span class="keywordflow">for</span> (kmi = keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a0ae48f8a4481c3faf008d60d6d61b4ad">items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmi; kmi = kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a5cb105349fd3c21f73142d637602a75e">next</a>) {
<a name="l01690"></a>01690                         <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a331a052f434f1bd44be9cf7542badde8">wm_eventmatch</a>(event, kmi)) {
<a name="l01691"></a>01691 
<a name="l01692"></a>01692                             <span class="comment">/* weak, but allows interactive callback to not use rawkey */</span>
<a name="l01693"></a>01693                             <span class="keyword">event</span>-&gt;keymap_idname = kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af2857f00bdd109a9a110c8816d9b0ce8">idname</a>;
<a name="l01694"></a>01694 
<a name="l01695"></a>01695                             action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a253d6a58a244c9f65fa266c3389f13bd">wm_handler_operator_call</a>(C, handlers, handler, event, kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a17c86417e0dedf1a101de028ec6a2bd6">ptr</a>);
<a name="l01696"></a>01696                             <span class="keywordflow">if</span> (action &amp; <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>)  <span class="comment">/* not always_pass here, it denotes removed handler */</span>
<a name="l01697"></a>01697                                 <span class="keywordflow">break</span>;
<a name="l01698"></a>01698                         }
<a name="l01699"></a>01699                     }
<a name="l01700"></a>01700                 }
<a name="l01701"></a>01701             }
<a name="l01702"></a>01702             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a>) {
<a name="l01703"></a>01703                 action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#ab22211f5839a39a0e4a49d45321ba0a7">wm_handler_ui_call</a>(C, handler, event, always_pass);
<a name="l01704"></a>01704             }
<a name="l01705"></a>01705             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a964ff57109210de5a2129509b1f42346">type</a> == <a class="code" href="../../de/d44/wm__event__system_8h.html#a282841548f1d79a386bbeb4172ebf942a8024d0a2a90a846271cf5e4388f1faac">WM_HANDLER_FILESELECT</a>) {
<a name="l01706"></a>01706                 <span class="comment">/* screen context changes here */</span>
<a name="l01707"></a>01707                 action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a9881ee8ff7961e92e2ee1a827b0e46cf">wm_handler_fileselect_call</a>(C, handlers, handler, event);
<a name="l01708"></a>01708             }
<a name="l01709"></a>01709             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#accf98440df7cb867af8548c5312fd0a9">dropboxes</a>) {
<a name="l01710"></a>01710                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a36a2a96ac408860328476aeefa4f81c4">EVT_DROP</a>) {
<a name="l01711"></a>01711                     <a class="code" href="../../da/d4b/structwmDropBox.html">wmDropBox</a> *drop = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#accf98440df7cb867af8548c5312fd0a9">dropboxes</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01712"></a>01712                     <span class="keywordflow">for</span> (; drop; drop = drop-&gt;<a class="code" href="../../da/d4b/structwmDropBox.html#a1af64a4c58c7e68f3293f40dc3fad921">next</a>) {
<a name="l01713"></a>01713                         <span class="comment">/* other drop custom types allowed */</span>
<a name="l01714"></a>01714                         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a276cd44fa9cab09b621a83980b335b47">custom</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3a1b2b37da9cfd337ee6eed0a8d27f11">EVT_DATA_LISTBASE</a>) {
<a name="l01715"></a>01715                             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>;
<a name="l01716"></a>01716                             <a class="code" href="../../d2/d7a/structwmDrag.html">wmDrag</a> *drag;
<a name="l01717"></a>01717                             
<a name="l01718"></a>01718                             for (drag = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; drag; drag = drag-&gt;next) {
<a name="l01719"></a>01719                                 <span class="keywordflow">if</span> (drop-&gt;<a class="code" href="../../da/d4b/structwmDropBox.html#ab8600c9e6d19652657e917c52ddf487a">poll</a>(C, drag, event)) {
<a name="l01720"></a>01720                                     
<a name="l01721"></a>01721                                     drop-&gt;<a class="code" href="../../da/d4b/structwmDropBox.html#a933c3d7c5fb1bff8c3b1005bae18c4dc">copy</a>(drag, drop);
<a name="l01722"></a>01722                                     
<a name="l01723"></a>01723                                     <span class="comment">/* free the drags before calling operator */</span>
<a name="l01724"></a>01724                                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>);
<a name="l01725"></a>01725                                     <span class="keyword">event</span>-&gt;customdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01726"></a>01726                                     <span class="keyword">event</span>-&gt;custom = 0;
<a name="l01727"></a>01727                                     
<a name="l01728"></a>01728                                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, drop-&gt;<a class="code" href="../../da/d4b/structwmDropBox.html#a5d0a2ff74a60b32a43d47259b0ca350c">ot</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, drop-&gt;<a class="code" href="../../da/d4b/structwmDropBox.html#a03734083277cfc111aed2b3a211d603a">opcontext</a>, drop-&gt;<a class="code" href="../../da/d4b/structwmDropBox.html#afd695008bb8938a900a6d971f803f17e">ptr</a>);
<a name="l01729"></a>01729                                     action |= <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>;
<a name="l01730"></a>01730                                     
<a name="l01731"></a>01731                                     <span class="comment">/* XXX fileread case */</span>
<a name="l01732"></a>01732                                     <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01733"></a>01733                                         <span class="keywordflow">return</span> action;
<a name="l01734"></a>01734                                     
<a name="l01735"></a>01735                                     <span class="comment">/* escape from drag loop, got freed */</span>
<a name="l01736"></a>01736                                     <span class="keywordflow">break</span>;
<a name="l01737"></a>01737                                 }
<a name="l01738"></a>01738                             }
<a name="l01739"></a>01739                         }
<a name="l01740"></a>01740                     }
<a name="l01741"></a>01741                 }
<a name="l01742"></a>01742             }
<a name="l01743"></a>01743             <span class="keywordflow">else</span> {
<a name="l01744"></a>01744                 <span class="comment">/* modal, swallows all */</span>
<a name="l01745"></a>01745                 action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a253d6a58a244c9f65fa266c3389f13bd">wm_handler_operator_call</a>(C, handlers, handler, event, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01746"></a>01746             }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748             <span class="keywordflow">if</span> (action &amp; <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>) {
<a name="l01749"></a>01749                 <span class="keywordflow">if</span> (always_pass)
<a name="l01750"></a>01750                     action &amp;= ~WM_HANDLER_BREAK;
<a name="l01751"></a>01751                 <span class="keywordflow">else</span>
<a name="l01752"></a>01752                     <span class="keywordflow">break</span>;
<a name="l01753"></a>01753             }
<a name="l01754"></a>01754         }
<a name="l01755"></a>01755         
<a name="l01756"></a>01756         <span class="comment">/* XXX fileread case, if the wm is freed then the handler&#39;s</span>
<a name="l01757"></a>01757 <span class="comment">         * will have been too so the code below need not run. */</span>
<a name="l01758"></a>01758         <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01759"></a>01759             <span class="keywordflow">return</span> action;
<a name="l01760"></a>01760         }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762         <span class="comment">/* XXX code this for all modal ops, and ensure free only happens here */</span>
<a name="l01763"></a>01763         
<a name="l01764"></a>01764         <span class="comment">/* modal ui handler can be tagged to be freed */</span> 
<a name="l01765"></a>01765         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(handlers, handler) != -1) { <span class="comment">/* could be freed already by regular modal ops */</span>
<a name="l01766"></a>01766             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa98d7f32c6f58fbdc8de63a713113ac8">flag</a> &amp; <a class="code" href="../../de/d44/wm__event__system_8h.html#af73d708d6d94420bd6e821daab960396">WM_HANDLER_DO_FREE</a>) {
<a name="l01767"></a>01767                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l01768"></a>01768                 <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l01769"></a>01769             }
<a name="l01770"></a>01770         }
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772 
<a name="l01773"></a>01773     <span class="comment">/* test for CLICK event */</span>
<a name="l01774"></a>01774     <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a47356e8c94a0dc52317d61c122e2bf88">wm_action_not_handled</a>(action) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l01775"></a>01775         <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01776"></a>01776 
<a name="l01777"></a>01777         <span class="keywordflow">if</span> (win &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa04341fdd4096c2769931d25ab98f747">prevtype</a> == event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abd9d62c7e1c80240d2e48d696ec7fbee">prevval</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l01778"></a>01778             <span class="comment">/* test for double click first,</span>
<a name="l01779"></a>01779 <span class="comment">             * note1: this can be problematic because single click operators can get the</span>
<a name="l01780"></a>01780 <span class="comment">             *   double click event but then with old mouse coords which is highly confusing,</span>
<a name="l01781"></a>01781 <span class="comment">             *   so check for mouse moves too.</span>
<a name="l01782"></a>01782 <span class="comment">             * note2: the first click event will be handled but still used to create a</span>
<a name="l01783"></a>01783 <span class="comment">             *   double click event if clicking again quickly.</span>
<a name="l01784"></a>01784 <span class="comment">             *   If no double click events are found it will fallback to a single click.</span>
<a name="l01785"></a>01785 <span class="comment">             *   So a double click event can result in 2 successive single click calls</span>
<a name="l01786"></a>01786 <span class="comment">             *   if its not handled by the keymap - campbell */</span>
<a name="l01787"></a>01787             <span class="keywordflow">if</span> ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> - win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a02baeec71c08370879978cea3ebd2dfe">prevclickx</a>)) &lt;= 2 &amp;&amp;
<a name="l01788"></a>01788                 (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> - win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a5d73c649291556a500da7568e7eb6048">prevclicky</a>)) &lt;= 2 &amp;&amp;
<a name="l01789"></a>01789                 ((<a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>() - win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a67851b237a17837ea08a6d2f9bf9c9e5">prevclicktime</a>) * 1000 &lt; <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.dbl_click_time))
<a name="l01790"></a>01790             {
<a name="l01791"></a>01791                 <span class="keyword">event</span>-&gt;val = <a class="code" href="../../d4/ddc/WM__types_8h.html#ae89767e57e90cc08246deb93ef284450">KM_DBL_CLICK</a>;
<a name="l01792"></a>01792                 <span class="comment">/* removed this because in cases where we&#39;re this is used as a single click</span>
<a name="l01793"></a>01793 <span class="comment">                 * event, this will give old coords,</span>
<a name="l01794"></a>01794 <span class="comment">                 * since the distance is checked above, using new coords should be ok. */</span>
<a name="l01795"></a>01795                 <span class="comment">//   event-&gt;x = win-&gt;eventstate-&gt;prevclickx;</span>
<a name="l01796"></a>01796                 <span class="comment">//   event-&gt;y = win-&gt;eventstate-&gt;prevclicky;</span>
<a name="l01797"></a>01797                 action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(C, event, handlers);
<a name="l01798"></a>01798             }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800             <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a47356e8c94a0dc52317d61c122e2bf88">wm_action_not_handled</a>(action)) {
<a name="l01801"></a>01801                 <span class="keyword">event</span>-&gt;val = <a class="code" href="../../d4/ddc/WM__types_8h.html#a27a741e4aa9eb2aff034283d2062df51">KM_CLICK</a>;
<a name="l01802"></a>01802                 action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(C, event, handlers);
<a name="l01803"></a>01803             }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805 
<a name="l01806"></a>01806             <span class="comment">/* revert value if not handled */</span>
<a name="l01807"></a>01807             <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a47356e8c94a0dc52317d61c122e2bf88">wm_action_not_handled</a>(action)) {
<a name="l01808"></a>01808                 <span class="keyword">event</span>-&gt;val = <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>;
<a name="l01809"></a>01809             }
<a name="l01810"></a>01810         }
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812     
<a name="l01813"></a>01813     <span class="keywordflow">if</span> (action == (<a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a> | <a class="code" href="../../de/d44/wm__event__system_8h.html#addaa819a62de5c4328b1e8aadc1946d2">WM_HANDLER_MODAL</a>))
<a name="l01814"></a>01814         <a class="code" href="../../de/d3c/wm__cursors_8c.html#aac5a367a6bcc50327c2eeabd40cd3109">wm_cursor_arrow_move</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), event);
<a name="l01815"></a>01815 
<a name="l01816"></a>01816     <span class="keywordflow">return</span> action;
<a name="l01817"></a>01817 }
<a name="l01818"></a>01818 
<a name="l01819"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#ad17a6507d03dee1ad04e7ef1f83b5f71">01819</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#ad17a6507d03dee1ad04e7ef1f83b5f71">wm_event_inside_i</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *rect)
<a name="l01820"></a>01820 {
<a name="l01821"></a>01821     <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a2dfa757b9be8ede8a1044c3f5dac6a81">wm_event_always_pass</a>(event))
<a name="l01822"></a>01822         <span class="keywordflow">return</span> 1;
<a name="l01823"></a>01823     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(rect, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l01824"></a>01824         <span class="keywordflow">return</span> 1;
<a name="l01825"></a>01825     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l01826"></a>01826         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(rect, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>)) {
<a name="l01827"></a>01827             <span class="keywordflow">return</span> 1;
<a name="l01828"></a>01828         }
<a name="l01829"></a>01829         <span class="keywordflow">return</span> 0;
<a name="l01830"></a>01830     }
<a name="l01831"></a>01831     <span class="keywordflow">return</span> 0;
<a name="l01832"></a>01832 }
<a name="l01833"></a>01833 
<a name="l01834"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a928119b2356b1faaa9bbb5865f4cbd11">01834</a> <span class="keyword">static</span> <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a928119b2356b1faaa9bbb5865f4cbd11">area_event_inside</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01835"></a>01835 {
<a name="l01836"></a>01836     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01837"></a>01837     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01838"></a>01838     
<a name="l01839"></a>01839     <span class="keywordflow">if</span> (screen)
<a name="l01840"></a>01840         <span class="keywordflow">for</span> (sa = screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>)
<a name="l01841"></a>01841             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>, x, y))
<a name="l01842"></a>01842                 <span class="keywordflow">return</span> sa;
<a name="l01843"></a>01843     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01844"></a>01844 }
<a name="l01845"></a>01845 
<a name="l01846"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a8baacefd1d1c8df4a41bfb05225a5057">01846</a> <span class="keyword">static</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a8baacefd1d1c8df4a41bfb05225a5057">region_event_inside</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01847"></a>01847 {
<a name="l01848"></a>01848     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01849"></a>01849     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01850"></a>01850     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01851"></a>01851     
<a name="l01852"></a>01852     <span class="keywordflow">if</span> (screen &amp;&amp; area)
<a name="l01853"></a>01853         <span class="keywordflow">for</span> (ar = area-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01854"></a>01854             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>, x, y))
<a name="l01855"></a>01855                 <span class="keywordflow">return</span> ar;
<a name="l01856"></a>01856     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01857"></a>01857 }
<a name="l01858"></a>01858 
<a name="l01859"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a0f6853ad9545ccd33ee2a470a6063122">01859</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a0f6853ad9545ccd33ee2a470a6063122">wm_paintcursor_tag</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../db/d6d/structwmPaintCursor.html">wmPaintCursor</a> *pc, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar)
<a name="l01860"></a>01860 {
<a name="l01861"></a>01861     <span class="keywordflow">if</span> (ar) {
<a name="l01862"></a>01862         <span class="keywordflow">for</span> (; pc; pc = pc-&gt;<a class="code" href="../../db/d6d/structwmPaintCursor.html#a055298860c91581e2585efe795bbef1a">next</a>) {
<a name="l01863"></a>01863             <span class="keywordflow">if</span> (pc-&gt;<a class="code" href="../../db/d6d/structwmPaintCursor.html#a5dee3b224993543d67270ee162c3ad59">poll</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || pc-&gt;<a class="code" href="../../db/d6d/structwmPaintCursor.html#a5dee3b224993543d67270ee162c3ad59">poll</a>(C)) {
<a name="l01864"></a>01864                 <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01865"></a>01865                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a07a44585fdf2bb667904c50983911330">do_draw_paintcursor</a> = 1;
<a name="l01866"></a>01866                 <a class="code" href="../../db/dc4/wm__draw_8c.html#a43e42bdc77596e652a1d400c7897d572">wm_tag_redraw_overlay</a>(win, ar);
<a name="l01867"></a>01867             }
<a name="l01868"></a>01868         }
<a name="l01869"></a>01869     }
<a name="l01870"></a>01870 }
<a name="l01871"></a>01871 
<a name="l01872"></a>01872 <span class="comment">/* called on mousemove, check updates for paintcursors */</span>
<a name="l01873"></a>01873 <span class="comment">/* context was set on active area and region */</span>
<a name="l01874"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#af6c21cabc402a2f2f5032b4b9f6774ff">01874</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#af6c21cabc402a2f2f5032b4b9f6774ff">wm_paintcursor_test</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01875"></a>01875 {
<a name="l01876"></a>01876     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01877"></a>01877     
<a name="l01878"></a>01878     <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#ab21769011ad4bce8e9b56e4c2b637d54">paintcursors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l01879"></a>01879         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01880"></a>01880         
<a name="l01881"></a>01881         <span class="keywordflow">if</span> (ar)
<a name="l01882"></a>01882             <a class="code" href="../../df/db0/wm__event__system_8c.html#a0f6853ad9545ccd33ee2a470a6063122">wm_paintcursor_tag</a>(C, wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#ab21769011ad4bce8e9b56e4c2b637d54">paintcursors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, ar);
<a name="l01883"></a>01883         
<a name="l01884"></a>01884         <span class="comment">/* if previous position was not in current region, we have to set a temp new context */</span>
<a name="l01885"></a>01885         <span class="keywordflow">if</span> (ar == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || !<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>)) {
<a name="l01886"></a>01886             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01887"></a>01887             
<a name="l01888"></a>01888             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/db0/wm__event__system_8c.html#a928119b2356b1faaa9bbb5865f4cbd11">area_event_inside</a>(C, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>));
<a name="l01889"></a>01889             <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/db0/wm__event__system_8c.html#a8baacefd1d1c8df4a41bfb05225a5057">region_event_inside</a>(C, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>));
<a name="l01890"></a>01890 
<a name="l01891"></a>01891             <a class="code" href="../../df/db0/wm__event__system_8c.html#a0f6853ad9545ccd33ee2a470a6063122">wm_paintcursor_tag</a>(C, wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#ab21769011ad4bce8e9b56e4c2b637d54">paintcursors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C));
<a name="l01892"></a>01892             
<a name="l01893"></a>01893             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sa);
<a name="l01894"></a>01894             <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l01895"></a>01895         }
<a name="l01896"></a>01896     }
<a name="l01897"></a>01897 }
<a name="l01898"></a>01898 
<a name="l01899"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a73c7e7e5fef62d4e4dd61969d2d4e679">01899</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a73c7e7e5fef62d4e4dd61969d2d4e679">wm_event_drag_test</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01900"></a>01900 {
<a name="l01901"></a>01901     <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01902"></a>01902     
<a name="l01903"></a>01903     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>)
<a name="l01904"></a>01904         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aad77a53a797c640b83724cab63f6b9fa">do_draw_drag</a> = 1;
<a name="l01905"></a>01905     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l01906"></a>01906         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>);
<a name="l01907"></a>01907         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aad77a53a797c640b83724cab63f6b9fa">do_draw_drag</a> = 1;
<a name="l01908"></a>01908     }
<a name="l01909"></a>01909     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l01910"></a>01910         <span class="keyword">event</span>-&gt;type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a36a2a96ac408860328476aeefa4f81c4">EVT_DROP</a>;
<a name="l01911"></a>01911         
<a name="l01912"></a>01912         <span class="comment">/* create customdata, first free existing */</span>
<a name="l01913"></a>01913         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>) {
<a name="l01914"></a>01914             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7df1658c9f61db247e65141d1e64a336">customdatafree</a>)
<a name="l01915"></a>01915                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>);
<a name="l01916"></a>01916         }
<a name="l01917"></a>01917         
<a name="l01918"></a>01918         <span class="keyword">event</span>-&gt;custom = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3a1b2b37da9cfd337ee6eed0a8d27f11">EVT_DATA_LISTBASE</a>;
<a name="l01919"></a>01919         <span class="keyword">event</span>-&gt;customdata = &amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>;
<a name="l01920"></a>01920         <span class="keyword">event</span>-&gt;customdatafree = 1;
<a name="l01921"></a>01921         
<a name="l01922"></a>01922         <span class="comment">/* clear drop icon */</span>
<a name="l01923"></a>01923         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aad77a53a797c640b83724cab63f6b9fa">do_draw_drag</a> = 1;
<a name="l01924"></a>01924         
<a name="l01925"></a>01925         <span class="comment">/* restore cursor (disabled, see wm_dragdrop.c) */</span>
<a name="l01926"></a>01926         <span class="comment">// WM_cursor_restore(win);</span>
<a name="l01927"></a>01927     }
<a name="l01928"></a>01928     
<a name="l01929"></a>01929     <span class="comment">/* overlap fails otherwise */</span>
<a name="l01930"></a>01930     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aad77a53a797c640b83724cab63f6b9fa">do_draw_drag</a>)
<a name="l01931"></a>01931         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a6b5dd98c6208a6594d8183e4dc0f06dd">drawmethod</a> == <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#ade99d0c6adf1f912db1920d489f90f3e">USER_DRAW_OVERLAP</a>)
<a name="l01932"></a>01932             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#af42ea7fb025800a97c3a1fe3e5f24c5e">do_draw</a> = 1;
<a name="l01933"></a>01933     
<a name="l01934"></a>01934 }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 <span class="comment">/* called in main loop */</span>
<a name="l01937"></a>01937 <span class="comment">/* goes over entire hierarchy:  events -&gt; window -&gt; screen -&gt; area -&gt; region */</span>
<a name="l01938"></a><a class="code" href="../../de/d44/wm__event__system_8h.html#a24e9628c95d9f6c25ca8d4278bc03106">01938</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a24e9628c95d9f6c25ca8d4278bc03106">wm_event_do_handlers</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l01939"></a>01939 {
<a name="l01940"></a>01940     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01941"></a>01941     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     <span class="comment">/* update key configuration before handling events */</span>
<a name="l01944"></a>01944     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a41524afb7dc28a4bc2ad37bf24cd7e53">WM_keyconfig_update</a>(wm);
<a name="l01945"></a>01945 
<a name="l01946"></a>01946     <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l01947"></a>01947         <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event;
<a name="l01948"></a>01948         
<a name="l01949"></a>01949         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01950"></a>01950             <a class="code" href="../../df/db0/wm__event__system_8c.html#a673c41499d28d22984dbd15dc605229f">wm_event_free_all</a>(win);
<a name="l01951"></a>01951         <span class="keywordflow">else</span> {
<a name="l01952"></a>01952             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>;
<a name="l01953"></a>01953             
<a name="l01954"></a>01954             <span class="keywordflow">if</span> (scene) {
<a name="l01955"></a>01955                 <span class="keywordtype">int</span> playing = <a class="code" href="../../d2/db1/BKE__sound_8h.html#ad0fef16f96baf25e95c1c8adef36a436">sound_scene_playing</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>);
<a name="l01956"></a>01956                 
<a name="l01957"></a>01957                 <span class="keywordflow">if</span> (playing != -1) {
<a name="l01958"></a>01958                     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l01959"></a>01959                     <a class="code" href="../../df/d01/BKE__context_8h.html#aa738b861d07dd99111174d4aa273cb5c">CTX_wm_screen_set</a>(C, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>);
<a name="l01960"></a>01960                     <a class="code" href="../../df/d01/BKE__context_8h.html#a197223f1af3429bb18e22f71ef4d4b60">CTX_data_scene_set</a>(C, scene);
<a name="l01961"></a>01961                     
<a name="l01962"></a>01962                     <span class="keywordflow">if</span> (((playing == 1) &amp;&amp; (!win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>)) || ((playing == 0) &amp;&amp; (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>))) {
<a name="l01963"></a>01963                         <a class="code" href="../../d1/d12/ED__screen_8h.html#a7286a9603fb0eced0d7a074cd18f20e4">ED_screen_animation_play</a>(C, -1, 1);
<a name="l01964"></a>01964                     }
<a name="l01965"></a>01965                     
<a name="l01966"></a>01966                     <span class="keywordflow">if</span> (playing == 0) {
<a name="l01967"></a>01967                         <span class="keywordtype">float</span> time = <a class="code" href="../../d2/db1/BKE__sound_8h.html#a4aede8d7c7c9a37ce7eea52979406581">sound_sync_scene</a>(scene);
<a name="l01968"></a>01968                         <span class="keywordflow">if</span> (finite(time)) {
<a name="l01969"></a>01969                             <span class="keywordtype">int</span> ncfra = <a class="code" href="../../d2/db1/BKE__sound_8h.html#a4aede8d7c7c9a37ce7eea52979406581">sound_sync_scene</a>(scene) * (float)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a> + 0.5f;
<a name="l01970"></a>01970                             <span class="keywordflow">if</span> (ncfra != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>) {
<a name="l01971"></a>01971                                 scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a> = ncfra;
<a name="l01972"></a>01972                                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a064a1225eaf305ae55dc93b0d35fbf82">ED_update_for_newframe</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C), scene, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>, 1);
<a name="l01973"></a>01973                                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01974"></a>01974                             }
<a name="l01975"></a>01975                         }
<a name="l01976"></a>01976                     }
<a name="l01977"></a>01977                     
<a name="l01978"></a>01978                     <a class="code" href="../../df/d01/BKE__context_8h.html#a197223f1af3429bb18e22f71ef4d4b60">CTX_data_scene_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01979"></a>01979                     <a class="code" href="../../df/d01/BKE__context_8h.html#aa738b861d07dd99111174d4aa273cb5c">CTX_wm_screen_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01980"></a>01980                     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01981"></a>01981                 }
<a name="l01982"></a>01982             }
<a name="l01983"></a>01983         }
<a name="l01984"></a>01984         
<a name="l01985"></a>01985         <span class="keywordflow">while</span> ( (event = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) ) {
<a name="l01986"></a>01986             <span class="keywordtype">int</span> action = <a class="code" href="../../de/d44/wm__event__system_8h.html#ad8797cb0955b66df1c9177e7a6da4e4f">WM_HANDLER_CONTINUE</a>;
<a name="l01987"></a>01987 
<a name="l01988"></a>01988             <span class="keywordflow">if</span> ((<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>) &amp;&amp; event &amp;&amp; !<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99234bdab7c4336e174cd0db37044412">INBETWEEN_MOUSEMOVE</a>)) {
<a name="l01989"></a>01989                 printf(<span class="stringliteral">&quot;%s: pass on evt %d val %d\n&quot;</span>, __func__, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>);
<a name="l01990"></a>01990             }
<a name="l01991"></a>01991 
<a name="l01992"></a>01992             <a class="code" href="../../df/db0/wm__event__system_8c.html#a5bd2ae3a9abe5e0c9473c7a5a6d43e1c">wm_eventemulation</a>(event);
<a name="l01993"></a>01993 
<a name="l01994"></a>01994             <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l01995"></a>01995             
<a name="l01996"></a>01996             <span class="comment">/* we let modal handlers get active area/region, also wm_paintcursor_test needs it */</span>
<a name="l01997"></a>01997             <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/db0/wm__event__system_8c.html#a928119b2356b1faaa9bbb5865f4cbd11">area_event_inside</a>(C, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>));
<a name="l01998"></a>01998             <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/db0/wm__event__system_8c.html#a8baacefd1d1c8df4a41bfb05225a5057">region_event_inside</a>(C, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>));
<a name="l01999"></a>01999             
<a name="l02000"></a>02000             <span class="comment">/* MVC demands to not draw in event handlers... but we need to leave it for ogl selecting etc */</span>
<a name="l02001"></a>02001             <a class="code" href="../../d7/d6e/wm__window_8c.html#ab9efa312329cc56778c1dc48d782341c">wm_window_make_drawable</a>(C, win);
<a name="l02002"></a>02002             
<a name="l02003"></a>02003             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(C, event);
<a name="l02004"></a>02004 
<a name="l02005"></a>02005             <span class="comment">/* first we do priority handlers, modal + some limited keymaps */</span>
<a name="l02006"></a>02006             action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(C, event, &amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>);
<a name="l02007"></a>02007             
<a name="l02008"></a>02008             <span class="comment">/* fileread case */</span>
<a name="l02009"></a>02009             <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02010"></a>02010                 <span class="keywordflow">return</span>;
<a name="l02011"></a>02011             
<a name="l02012"></a>02012             <span class="comment">/* check dragging, creates new event or frees, adds draw tag */</span>
<a name="l02013"></a>02013             <a class="code" href="../../df/db0/wm__event__system_8c.html#a73c7e7e5fef62d4e4dd61969d2d4e679">wm_event_drag_test</a>(wm, win, event);
<a name="l02014"></a>02014             
<a name="l02015"></a>02015             <span class="comment">/* builtin tweak, if action is break it removes tweak */</span>
<a name="l02016"></a>02016             <a class="code" href="../../d6/dae/wm__operators_8c.html#aed5fe580b5a7314cf81ffadde518ec6b">wm_tweakevent_test</a>(C, event, action);
<a name="l02017"></a>02017 
<a name="l02018"></a>02018             <span class="keywordflow">if</span> ((action &amp; <a class="code" href="../../de/d44/wm__event__system_8h.html#ad47aa5fab7570b0cecf810d0a7bc2a41">WM_HANDLER_BREAK</a>) == 0) {
<a name="l02019"></a>02019                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l02020"></a>02020                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l02021"></a>02021                 <span class="keywordtype">int</span> doit = 0;
<a name="l02022"></a>02022     
<a name="l02023"></a>02023                 <span class="comment">/* Note: setting subwin active should be done here, after modal handlers have been done */</span>
<a name="l02024"></a>02024                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l02025"></a>02025                     <span class="comment">/* state variables in screen, cursors. Also used in wm_draw.c, fails for modal handlers though */</span>
<a name="l02026"></a>02026                     <a class="code" href="../../d1/d12/ED__screen_8h.html#ab3f30bd970ebe9bdc248ca329a5cbd9e">ED_screen_set_subwinactive</a>(C, event);   
<a name="l02027"></a>02027                     <span class="comment">/* for regions having custom cursors */</span>
<a name="l02028"></a>02028                     <a class="code" href="../../df/db0/wm__event__system_8c.html#af6c21cabc402a2f2f5032b4b9f6774ff">wm_paintcursor_test</a>(C, event);
<a name="l02029"></a>02029                 }
<a name="l02030"></a>02030                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a923a119e6e59562806b30dd6a899d19f">NDOF_MOTION</a>) {
<a name="l02031"></a>02031                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a3fedf480c7474b10dbb03ac1c1376cf7">addmousemove</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02032"></a>02032                 }
<a name="l02033"></a>02033 
<a name="l02034"></a>02034                 <span class="keywordflow">for</span> (sa = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l02035"></a>02035                     <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#ad17a6507d03dee1ad04e7ef1f83b5f71">wm_event_inside_i</a>(event, &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>)) {
<a name="l02036"></a>02036                         <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sa);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038                         <span class="keywordflow">if</span> ((action &amp; WM_HANDLER_BREAK) == 0) {
<a name="l02039"></a>02039                             <span class="keywordflow">for</span> (ar = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l02040"></a>02040                                 <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#ad17a6507d03dee1ad04e7ef1f83b5f71">wm_event_inside_i</a>(event, &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>)) {
<a name="l02041"></a>02041                                     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l02042"></a>02042                                     
<a name="l02043"></a>02043                                     <span class="comment">/* call even on non mouse events, since the */</span>
<a name="l02044"></a>02044                                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(C, event);
<a name="l02045"></a>02045 
<a name="l02046"></a>02046                                     <span class="comment">/* does polls for drop regions and checks uibuts */</span>
<a name="l02047"></a>02047                                     <span class="comment">/* need to be here to make sure region context is true */</span>
<a name="l02048"></a>02048                                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a36a2a96ac408860328476aeefa4f81c4">EVT_DROP</a>)) {
<a name="l02049"></a>02049                                         <a class="code" href="../../db/df3/wm__dragdrop_8c.html#aca5661d2cc52fb405b53994eb7f26fdb">wm_drags_check_ops</a>(C, event);
<a name="l02050"></a>02050                                     }
<a name="l02051"></a>02051                                     
<a name="l02052"></a>02052                                     action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(C, event, &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>);
<a name="l02053"></a>02053 
<a name="l02054"></a>02054                                     <span class="comment">/* fileread case (python), [#29489] */</span>
<a name="l02055"></a>02055                                     <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02056"></a>02056                                         <span class="keywordflow">return</span>;
<a name="l02057"></a>02057 
<a name="l02058"></a>02058                                     doit |= (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>));
<a name="l02059"></a>02059                                     
<a name="l02060"></a>02060                                     <span class="keywordflow">if</span> (action &amp; WM_HANDLER_BREAK)
<a name="l02061"></a>02061                                         <span class="keywordflow">break</span>;
<a name="l02062"></a>02062                                 }
<a name="l02063"></a>02063                             }
<a name="l02064"></a>02064                         }
<a name="l02065"></a>02065 
<a name="l02066"></a>02066                         <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02067"></a>02067 
<a name="l02068"></a>02068                         <span class="keywordflow">if</span> ((action &amp; WM_HANDLER_BREAK) == 0) {
<a name="l02069"></a>02069                             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(C, event); <span class="comment">/* only invalidates event-&gt;mval in this case */</span>
<a name="l02070"></a>02070                             action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(C, event, &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a01c01609c538278ac956593f749365e3">handlers</a>);
<a name="l02071"></a>02071                         }
<a name="l02072"></a>02072                         <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02073"></a>02073 
<a name="l02074"></a>02074                         <span class="comment">/* NOTE: do not escape on WM_HANDLER_BREAK, mousemove needs handled for previous area */</span>
<a name="l02075"></a>02075                     }
<a name="l02076"></a>02076                 }
<a name="l02077"></a>02077                 
<a name="l02078"></a>02078                 <span class="keywordflow">if</span> ((action &amp; WM_HANDLER_BREAK) == 0) {
<a name="l02079"></a>02079                     <span class="comment">/* also some non-modal handlers need active area/region */</span>
<a name="l02080"></a>02080                     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, <a class="code" href="../../df/db0/wm__event__system_8c.html#a928119b2356b1faaa9bbb5865f4cbd11">area_event_inside</a>(C, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>));
<a name="l02081"></a>02081                     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, <a class="code" href="../../df/db0/wm__event__system_8c.html#a8baacefd1d1c8df4a41bfb05225a5057">region_event_inside</a>(C, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>));
<a name="l02082"></a>02082 
<a name="l02083"></a>02083                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a7c1df5df5d7fbac5bb88313ba836ae">wm_region_mouse_co</a>(C, event);
<a name="l02084"></a>02084 
<a name="l02085"></a>02085                     action |= <a class="code" href="../../df/db0/wm__event__system_8c.html#a454215e3eb99e1d248c04562e5b6a672">wm_handlers_do</a>(C, event, &amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>);
<a name="l02086"></a>02086 
<a name="l02087"></a>02087                     <span class="comment">/* fileread case */</span>
<a name="l02088"></a>02088                     <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02089"></a>02089                         <span class="keywordflow">return</span>;
<a name="l02090"></a>02090                 }
<a name="l02091"></a>02091 
<a name="l02092"></a>02092                 <span class="comment">/* XXX hrmf, this gives reliable previous mouse coord for area change, feels bad? </span>
<a name="l02093"></a>02093 <span class="comment">                 * doing it on ghost queue gives errors when mousemoves go over area borders */</span>
<a name="l02094"></a>02094                 <span class="keywordflow">if</span> (doit &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a> != win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>) {
<a name="l02095"></a>02095                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l02096"></a>02096                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a> = <span class="keyword">event</span>-&gt;y;
<a name="l02097"></a>02097                     <span class="comment">//printf(&quot;win-&gt;eventstate-&gt;prev = %d %d\n&quot;, event-&gt;x, event-&gt;y);</span>
<a name="l02098"></a>02098                 }
<a name="l02099"></a>02099                 <span class="keywordflow">else</span> {
<a name="l02100"></a>02100                     <span class="comment">//printf(&quot;not setting prev to %d %d\n&quot;, event-&gt;x, event-&gt;y);</span>
<a name="l02101"></a>02101                 }
<a name="l02102"></a>02102             }
<a name="l02103"></a>02103             
<a name="l02104"></a>02104             <span class="comment">/* store last event for this window */</span>
<a name="l02105"></a>02105             <span class="comment">/* mousemove and timer events don&#39;t overwrite last type */</span>
<a name="l02106"></a>02106             <span class="keywordflow">if</span> (!<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99234bdab7c4336e174cd0db37044412">INBETWEEN_MOUSEMOVE</a>) &amp;&amp; !<a class="code" href="../../d1/d40/wm__event__types_8h.html#abe0cd1c5e97107d1df74e15a9ea3c682">ISTIMER</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)) {
<a name="l02107"></a>02107                 <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a47356e8c94a0dc52317d61c122e2bf88">wm_action_not_handled</a>(action)) {
<a name="l02108"></a>02108                     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa04341fdd4096c2769931d25ab98f747">prevtype</a> == event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l02109"></a>02109                         <span class="comment">/* set click time on first click (press -&gt; release) */</span>
<a name="l02110"></a>02110                         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abd9d62c7e1c80240d2e48d696ec7fbee">prevval</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l02111"></a>02111                             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a67851b237a17837ea08a6d2f9bf9c9e5">prevclicktime</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l02112"></a>02112                             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a02baeec71c08370879978cea3ebd2dfe">prevclickx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l02113"></a>02113                             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a5d73c649291556a500da7568e7eb6048">prevclicky</a> = <span class="keyword">event</span>-&gt;y;
<a name="l02114"></a>02114                         }
<a name="l02115"></a>02115                     }
<a name="l02116"></a>02116                     <span class="keywordflow">else</span> {
<a name="l02117"></a>02117                         <span class="comment">/* reset click time if event type not the same */</span>
<a name="l02118"></a>02118                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a67851b237a17837ea08a6d2f9bf9c9e5">prevclicktime</a> = 0;
<a name="l02119"></a>02119                     }
<a name="l02120"></a>02120 
<a name="l02121"></a>02121                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abd9d62c7e1c80240d2e48d696ec7fbee">prevval</a> = <span class="keyword">event</span>-&gt;val;
<a name="l02122"></a>02122                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa04341fdd4096c2769931d25ab98f747">prevtype</a> = <span class="keyword">event</span>-&gt;type;
<a name="l02123"></a>02123                 }
<a name="l02124"></a>02124                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a27a741e4aa9eb2aff034283d2062df51">KM_CLICK</a>) { <span class="comment">/* keep click for double click later */</span>
<a name="l02125"></a>02125                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa04341fdd4096c2769931d25ab98f747">prevtype</a> = <span class="keyword">event</span>-&gt;type;
<a name="l02126"></a>02126                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abd9d62c7e1c80240d2e48d696ec7fbee">prevval</a> = <span class="keyword">event</span>-&gt;val;
<a name="l02127"></a>02127                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a67851b237a17837ea08a6d2f9bf9c9e5">prevclicktime</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l02128"></a>02128                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a02baeec71c08370879978cea3ebd2dfe">prevclickx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l02129"></a>02129                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a5d73c649291556a500da7568e7eb6048">prevclicky</a> = <span class="keyword">event</span>-&gt;y;
<a name="l02130"></a>02130                 }
<a name="l02131"></a>02131                 <span class="keywordflow">else</span> { <span class="comment">/* reset if not */</span>
<a name="l02132"></a>02132                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa04341fdd4096c2769931d25ab98f747">prevtype</a> = -1;
<a name="l02133"></a>02133                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abd9d62c7e1c80240d2e48d696ec7fbee">prevval</a> = 0;
<a name="l02134"></a>02134                     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a67851b237a17837ea08a6d2f9bf9c9e5">prevclicktime</a> = 0;
<a name="l02135"></a>02135                 }
<a name="l02136"></a>02136             }
<a name="l02137"></a>02137 
<a name="l02138"></a>02138             <span class="comment">/* unlink and free here, blender-quit then frees all */</span>
<a name="l02139"></a>02139             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>, event);
<a name="l02140"></a>02140             <a class="code" href="../../df/db0/wm__event__system_8c.html#ac9182bd2ae46daa1aab656d70edfd12f">wm_event_free</a>(event);
<a name="l02141"></a>02141             
<a name="l02142"></a>02142         }
<a name="l02143"></a>02143         
<a name="l02144"></a>02144         <span class="comment">/* only add mousemove when queue was read entirely */</span>
<a name="l02145"></a>02145         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a3fedf480c7474b10dbb03ac1c1376cf7">addmousemove</a> &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>) {
<a name="l02146"></a>02146             <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> tevent = *(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);
<a name="l02147"></a>02147             <span class="comment">//printf(&quot;adding MOUSEMOVE %d %d\n&quot;, tevent.x, tevent.y);</span>
<a name="l02148"></a>02148             tevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>;
<a name="l02149"></a>02149             tevent.<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> = tevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>;
<a name="l02150"></a>02150             tevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a> = tevent.<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>;
<a name="l02151"></a>02151             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;tevent);
<a name="l02152"></a>02152             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a3fedf480c7474b10dbb03ac1c1376cf7">addmousemove</a> = 0;
<a name="l02153"></a>02153         }
<a name="l02154"></a>02154         
<a name="l02155"></a>02155         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02156"></a>02156     }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158     <span class="comment">/* update key configuration after handling events */</span>
<a name="l02159"></a>02159     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a41524afb7dc28a4bc2ad37bf24cd7e53">WM_keyconfig_update</a>(wm);
<a name="l02160"></a>02160 }
<a name="l02161"></a>02161 
<a name="l02162"></a>02162 <span class="comment">/* ********** filesector handling ************ */</span>
<a name="l02163"></a>02163 
<a name="l02164"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a780d8068e62b24c5ae977db33f334299">02164</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#af2c841ce7d02145a9cf4af19d2e46cce">WM_event_fileselect_event</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">void</span> *ophandle, <span class="keywordtype">int</span> eventval)
<a name="l02165"></a>02165 {
<a name="l02166"></a>02166     <span class="comment">/* add to all windows! */</span>
<a name="l02167"></a>02167     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l02168"></a>02168     
<a name="l02169"></a>02169     <span class="keywordflow">for</span> (win = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C)-&gt;windows.first; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l02170"></a>02170         <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> <span class="keyword">event</span> = *win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>;
<a name="l02171"></a>02171         
<a name="l02172"></a>02172         <span class="keyword">event</span>.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a12b3eec44d42dec79689daa7540937df">EVT_FILESELECT</a>;
<a name="l02173"></a>02173         <span class="keyword">event</span>.val = eventval;
<a name="l02174"></a>02174         <span class="keyword">event</span>.customdata = ophandle;     <span class="comment">// only as void pointer type check</span>
<a name="l02175"></a>02175 
<a name="l02176"></a>02176         <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02177"></a>02177     }
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180 <span class="comment">/* operator is supposed to have a filled &quot;path&quot; property */</span>
<a name="l02181"></a>02181 <span class="comment">/* optional property: filetype (XXX enum?) */</span>
<a name="l02182"></a>02182 
<a name="l02183"></a>02183 <span class="comment">/* Idea is to keep a handler alive on window queue, owning the operator.</span>
<a name="l02184"></a>02184 <span class="comment"> * The filewindow can send event to make it execute, thus ensuring</span>
<a name="l02185"></a>02185 <span class="comment"> * executing happens outside of lower level queues, with UI refreshed.</span>
<a name="l02186"></a>02186 <span class="comment"> * Should also allow multiwin solutions */</span>
<a name="l02187"></a>02187 
<a name="l02188"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a426ed64a8716a3933891f2e739e3c99a">02188</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a2e41929a4b0d2175609f19e7a3626a42">WM_event_add_fileselect</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02189"></a>02189 {
<a name="l02190"></a>02190     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, *handlernext;
<a name="l02191"></a>02191     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l02192"></a>02192     <span class="keywordtype">int</span> full = 1;    <span class="comment">// XXX preset?</span>
<a name="l02193"></a>02193 
<a name="l02194"></a>02194     <span class="comment">/* only allow 1 file selector open per window */</span>
<a name="l02195"></a>02195     <span class="keywordflow">for</span> (handler = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = handlernext) {
<a name="l02196"></a>02196         handlernext = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>;
<a name="l02197"></a>02197         
<a name="l02198"></a>02198         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a964ff57109210de5a2129509b1f42346">type</a> == <a class="code" href="../../de/d44/wm__event__system_8h.html#a282841548f1d79a386bbeb4172ebf942a8024d0a2a90a846271cf5e4388f1faac">WM_HANDLER_FILESELECT</a>) {
<a name="l02199"></a>02199             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>)
<a name="l02200"></a>02200                 <a class="code" href="../../d6/d0e/wm_8c.html#acac7d9c42b651635f6b69db4f53a4977">WM_operator_free</a>(handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>);
<a name="l02201"></a>02201             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, handler);
<a name="l02202"></a>02202             <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l02203"></a>02203         }
<a name="l02204"></a>02204     }
<a name="l02205"></a>02205     
<a name="l02206"></a>02206     handler = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a>), <span class="stringliteral">&quot;fileselect handler&quot;</span>);
<a name="l02207"></a>02207     
<a name="l02208"></a>02208     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a964ff57109210de5a2129509b1f42346">type</a> = <a class="code" href="../../de/d44/wm__event__system_8h.html#a282841548f1d79a386bbeb4172ebf942a8024d0a2a90a846271cf5e4388f1faac">WM_HANDLER_FILESELECT</a>;
<a name="l02209"></a>02209     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> = op;
<a name="l02210"></a>02210     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a66bd3c402abc66089576e2e965468a42">op_area</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l02211"></a>02211     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aea5bb90811d38a19b3784437ea596e12">op_region</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l02212"></a>02212     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a5e734569adb8e149100c1fe9d7f3f75a">filescreen</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l02213"></a>02213     
<a name="l02214"></a>02214     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, handler);
<a name="l02215"></a>02215     
<a name="l02216"></a>02216     <span class="comment">/* check props once before invoking if check is available</span>
<a name="l02217"></a>02217 <span class="comment">     * ensures initial properties are valid */</span>
<a name="l02218"></a>02218     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a6f75ff0089a22e585a90313decbda6cb">check</a>) {
<a name="l02219"></a>02219         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a6f75ff0089a22e585a90313decbda6cb">check</a>(C, op); <span class="comment">/* ignore return value */</span>
<a name="l02220"></a>02220     }
<a name="l02221"></a>02221 
<a name="l02222"></a>02222     <a class="code" href="../../df/db0/wm__event__system_8c.html#af2c841ce7d02145a9cf4af19d2e46cce">WM_event_fileselect_event</a>(C, op, full ? <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae2b9e7e8ff4a154d3e678b2eefdb1bcd">EVT_FILESELECT_FULL_OPEN</a> : <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac8e642cf8e13a756dbb7884acf519ef0">EVT_FILESELECT_OPEN</a>);
<a name="l02223"></a>02223 }
<a name="l02224"></a>02224 
<a name="l02225"></a>02225 <span class="preprocessor">#if 0</span>
<a name="l02226"></a>02226 <span class="preprocessor"></span><span class="comment">/* lets not expose struct outside wm? */</span>
<a name="l02227"></a>02227 <span class="keyword">static</span> <span class="keywordtype">void</span> WM_event_set_handler_flag(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, <span class="keywordtype">int</span> <a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a>)
<a name="l02228"></a>02228 {
<a name="l02229"></a>02229     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa98d7f32c6f58fbdc8de63a713113ac8">flag</a> = <a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a>;
<a name="l02230"></a>02230 }
<a name="l02231"></a>02231 <span class="preprocessor">#endif</span>
<a name="l02232"></a>02232 <span class="preprocessor"></span>
<a name="l02233"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a9ac3073ccf68be40f221ce9ce0187bb9">02233</a> <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02234"></a>02234 {
<a name="l02235"></a>02235     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a>), <span class="stringliteral">&quot;event modal handler&quot;</span>);
<a name="l02236"></a>02236     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l02237"></a>02237     
<a name="l02238"></a>02238     <span class="comment">/* operator was part of macro */</span>
<a name="l02239"></a>02239     <span class="keywordflow">if</span> (op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>) {
<a name="l02240"></a>02240         <span class="comment">/* give the mother macro to the handler */</span>
<a name="l02241"></a>02241         handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a>;
<a name="l02242"></a>02242         <span class="comment">/* mother macro opm becomes the macro element */</span>
<a name="l02243"></a>02243         handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab44f9d18a19b9d374215fa5518f1050e">opm</a> = op;
<a name="l02244"></a>02244     }
<a name="l02245"></a>02245     <span class="keywordflow">else</span>
<a name="l02246"></a>02246         handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a> = op;
<a name="l02247"></a>02247     
<a name="l02248"></a>02248     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a66bd3c402abc66089576e2e965468a42">op_area</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);       <span class="comment">/* means frozen screen context for modal handlers! */</span>
<a name="l02249"></a>02249     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aea5bb90811d38a19b3784437ea596e12">op_region</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l02250"></a>02250     
<a name="l02251"></a>02251     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, handler);
<a name="l02252"></a>02252 
<a name="l02253"></a>02253     <span class="keywordflow">return</span> handler;
<a name="l02254"></a>02254 }
<a name="l02255"></a>02255 
<a name="l02256"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#abde46f96a54b3969d1a22ee65437970f">02256</a> <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a966bbb5f2ccdc15546e0725efa379595">WM_event_add_keymap_handler</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>, <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap)
<a name="l02257"></a>02257 {
<a name="l02258"></a>02258     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l02259"></a>02259 
<a name="l02260"></a>02260     <span class="keywordflow">if</span> (!keymap) {
<a name="l02261"></a>02261         printf(<span class="stringliteral">&quot;WM_event_add_keymap_handler called with NULL keymap\n&quot;</span>);
<a name="l02262"></a>02262         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02263"></a>02263     }
<a name="l02264"></a>02264 
<a name="l02265"></a>02265     <span class="comment">/* only allow same keymap once */</span>
<a name="l02266"></a>02266     <span class="keywordflow">for</span> (handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>)
<a name="l02267"></a>02267         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8b146bb6c683af409df4dad30e68b81">keymap</a> == keymap)
<a name="l02268"></a>02268             <span class="keywordflow">return</span> handler;
<a name="l02269"></a>02269     
<a name="l02270"></a>02270     handler = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a>), <span class="stringliteral">&quot;event keymap handler&quot;</span>);
<a name="l02271"></a>02271     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(handlers, handler);
<a name="l02272"></a>02272     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8b146bb6c683af409df4dad30e68b81">keymap</a> = keymap;
<a name="l02273"></a>02273 
<a name="l02274"></a>02274     <span class="keywordflow">return</span> handler;
<a name="l02275"></a>02275 }
<a name="l02276"></a>02276 
<a name="l02277"></a>02277 <span class="comment">/* priorities not implemented yet, for time being just insert in begin of list */</span>
<a name="l02278"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a8b773ea239ebe4927c89d3acbb192377">02278</a> <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a8b773ea239ebe4927c89d3acbb192377">WM_event_add_keymap_handler_priority</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>, <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(priority))
<a name="l02279"></a>02279 {
<a name="l02280"></a>02280     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l02281"></a>02281     
<a name="l02282"></a>02282     <a class="code" href="../../df/db0/wm__event__system_8c.html#a22174210a11c6e8f5817be325ccccafd">WM_event_remove_keymap_handler</a>(handlers, keymap);
<a name="l02283"></a>02283     
<a name="l02284"></a>02284     handler = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a>), <span class="stringliteral">&quot;event keymap handler&quot;</span>);
<a name="l02285"></a>02285     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(handlers, handler);
<a name="l02286"></a>02286     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8b146bb6c683af409df4dad30e68b81">keymap</a> = keymap;
<a name="l02287"></a>02287     
<a name="l02288"></a>02288     <span class="keywordflow">return</span> handler;
<a name="l02289"></a>02289 }
<a name="l02290"></a>02290 
<a name="l02291"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a7285b40f9bfa3b16e5706651ae4a375a">02291</a> <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a07410adb0dfab098b8ec3d8a26e4a6d6">WM_event_add_keymap_handler_bb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *bblocal, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *bbwin)
<a name="l02292"></a>02292 {
<a name="l02293"></a>02293     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler = <a class="code" href="../../df/db0/wm__event__system_8c.html#a966bbb5f2ccdc15546e0725efa379595">WM_event_add_keymap_handler</a>(handlers, keymap);
<a name="l02294"></a>02294     
<a name="l02295"></a>02295     <span class="keywordflow">if</span> (handler) {
<a name="l02296"></a>02296         handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a55f6cf46678dad00ea6949e6e02cc23a">bblocal</a> = bblocal;
<a name="l02297"></a>02297         handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9a7b3a86b851ee5409bf50ed5b29c576">bbwin</a> = bbwin;
<a name="l02298"></a>02298     }
<a name="l02299"></a>02299     <span class="keywordflow">return</span> handler;
<a name="l02300"></a>02300 }
<a name="l02301"></a>02301 
<a name="l02302"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a22174210a11c6e8f5817be325ccccafd">02302</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a22174210a11c6e8f5817be325ccccafd">WM_event_remove_keymap_handler</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap)
<a name="l02303"></a>02303 {
<a name="l02304"></a>02304     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l02305"></a>02305     
<a name="l02306"></a>02306     <span class="keywordflow">for</span> (handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>) {
<a name="l02307"></a>02307         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8b146bb6c683af409df4dad30e68b81">keymap</a> == keymap) {
<a name="l02308"></a>02308             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l02309"></a>02309             <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l02310"></a>02310             <span class="keywordflow">break</span>;
<a name="l02311"></a>02311         }
<a name="l02312"></a>02312     }
<a name="l02313"></a>02313 }
<a name="l02314"></a>02314 
<a name="l02315"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#aee879a05c38567d71054117111d1269c">02315</a> <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#aee879a05c38567d71054117111d1269c">WM_event_add_ui_handler</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers,
<a name="l02316"></a>02316                                         <a class="code" href="../../d4/ddc/WM__types_8h.html#ae9caee1228f9a13520cea51cce4174f2">wmUIHandlerFunc</a> func, <a class="code" href="../../d4/ddc/WM__types_8h.html#a6232d145a649e774c8234b25ad5abe2f">wmUIHandlerRemoveFunc</a> <span class="keyword">remove</span>, <span class="keywordtype">void</span> *userdata)
<a name="l02317"></a>02317 {
<a name="l02318"></a>02318     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a>), <span class="stringliteral">&quot;event ui handler&quot;</span>);
<a name="l02319"></a>02319     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a> = func;
<a name="l02320"></a>02320     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa6c35bb61beab7ba18b2551325762676">ui_remove</a> = <span class="keyword">remove</span>;
<a name="l02321"></a>02321     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a190cb3c5434af0dc7b7cffe03d5878b4">ui_userdata</a> = userdata;
<a name="l02322"></a>02322     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9c59ce912d8a1c2a8bdde580e38e23b4">ui_area</a> = (<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>) ? <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02323"></a>02323     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a09f78ad35020e7779a4965cc22de87d2">ui_region</a> = (<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>) ? <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02324"></a>02324     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ac7403aada39c85bd5bfd56da978abd27">ui_menu</a> = (<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>) ? <a class="code" href="../../df/d01/BKE__context_8h.html#a2753b66475f5c46f20ba08a747dd019d">CTX_wm_menu</a>(C) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02325"></a>02325     
<a name="l02326"></a>02326     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(handlers, handler);
<a name="l02327"></a>02327     
<a name="l02328"></a>02328     <span class="keywordflow">return</span> handler;
<a name="l02329"></a>02329 }
<a name="l02330"></a>02330 
<a name="l02331"></a>02331 <span class="comment">/* set &quot;postpone&quot; for win-&gt;modalhandlers, this is in a running for () loop in wm_handlers_do() */</span>
<a name="l02332"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#afc2ec15f399f4b8643985f893c59d3d6">02332</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#aa4559ef4b4b539b84f096c57577ff9a6">WM_event_remove_ui_handler</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers,
<a name="l02333"></a>02333                                 <a class="code" href="../../d4/ddc/WM__types_8h.html#ae9caee1228f9a13520cea51cce4174f2">wmUIHandlerFunc</a> func, <a class="code" href="../../d4/ddc/WM__types_8h.html#a6232d145a649e774c8234b25ad5abe2f">wmUIHandlerRemoveFunc</a> <span class="keyword">remove</span>, <span class="keywordtype">void</span> *userdata, <span class="keywordtype">int</span> postpone)
<a name="l02334"></a>02334 {
<a name="l02335"></a>02335     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l02336"></a>02336     
<a name="l02337"></a>02337     <span class="keywordflow">for</span> (handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>) {
<a name="l02338"></a>02338         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a> == func &amp;&amp; handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa6c35bb61beab7ba18b2551325762676">ui_remove</a> == <span class="keyword">remove</span> &amp;&amp; handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a190cb3c5434af0dc7b7cffe03d5878b4">ui_userdata</a> == userdata) {
<a name="l02339"></a>02339             <span class="comment">/* handlers will be freed in wm_handlers_do() */</span>
<a name="l02340"></a>02340             <span class="keywordflow">if</span> (postpone) {
<a name="l02341"></a>02341                 handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#aa98d7f32c6f58fbdc8de63a713113ac8">flag</a> |= <a class="code" href="../../de/d44/wm__event__system_8h.html#af73d708d6d94420bd6e821daab960396">WM_HANDLER_DO_FREE</a>;
<a name="l02342"></a>02342             }
<a name="l02343"></a>02343             <span class="keywordflow">else</span> {
<a name="l02344"></a>02344                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l02345"></a>02345                 <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l02346"></a>02346             }
<a name="l02347"></a>02347             <span class="keywordflow">break</span>;
<a name="l02348"></a>02348         }
<a name="l02349"></a>02349     }
<a name="l02350"></a>02350 }
<a name="l02351"></a>02351 
<a name="l02352"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a7f2e53bc1860bc5c8a86d662536731d4">02352</a> <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a1c0385af2587f3e0ce0f4bf38ed49c47">WM_event_add_dropbox_handler</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../db/df3/wm__dragdrop_8c.html#ad885fb6d3f38d6c8d9bc40dde201f171">dropboxes</a>)
<a name="l02353"></a>02353 {
<a name="l02354"></a>02354     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l02355"></a>02355 
<a name="l02356"></a>02356     <span class="comment">/* only allow same dropbox once */</span>
<a name="l02357"></a>02357     <span class="keywordflow">for</span> (handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>)
<a name="l02358"></a>02358         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#accf98440df7cb867af8548c5312fd0a9">dropboxes</a> == dropboxes)
<a name="l02359"></a>02359             <span class="keywordflow">return</span> handler;
<a name="l02360"></a>02360     
<a name="l02361"></a>02361     handler = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a>), <span class="stringliteral">&quot;dropbox handler&quot;</span>);
<a name="l02362"></a>02362     
<a name="l02363"></a>02363     <span class="comment">/* dropbox stored static, no free or copy */</span>
<a name="l02364"></a>02364     handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#accf98440df7cb867af8548c5312fd0a9">dropboxes</a> = <a class="code" href="../../db/df3/wm__dragdrop_8c.html#ad885fb6d3f38d6c8d9bc40dde201f171">dropboxes</a>;
<a name="l02365"></a>02365     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(handlers, handler);
<a name="l02366"></a>02366     
<a name="l02367"></a>02367     <span class="keywordflow">return</span> handler;
<a name="l02368"></a>02368 }
<a name="l02369"></a>02369 
<a name="l02370"></a>02370 <span class="comment">/* XXX solution works, still better check the real cause (ton) */</span>
<a name="l02371"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a74a77aac73e4bc76ca4468928f0c0dc3">02371</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a407191cc97e1da1806df311c21bf2c9e">WM_event_remove_area_handler</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <span class="keywordtype">void</span> *area)
<a name="l02372"></a>02372 {
<a name="l02373"></a>02373     <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler, *nexthandler;
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     <span class="keywordflow">for</span> (handler = handlers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = nexthandler) {
<a name="l02376"></a>02376         nexthandler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>;
<a name="l02377"></a>02377         <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a964ff57109210de5a2129509b1f42346">type</a> != <a class="code" href="../../de/d44/wm__event__system_8h.html#a282841548f1d79a386bbeb4172ebf942a8024d0a2a90a846271cf5e4388f1faac">WM_HANDLER_FILESELECT</a>) {
<a name="l02378"></a>02378             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a9c59ce912d8a1c2a8bdde580e38e23b4">ui_area</a> == area) {
<a name="l02379"></a>02379                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l02380"></a>02380                 <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l02381"></a>02381             }
<a name="l02382"></a>02382         }
<a name="l02383"></a>02383     }
<a name="l02384"></a>02384 }
<a name="l02385"></a>02385 
<a name="l02386"></a>02386 <span class="preprocessor">#if 0</span>
<a name="l02387"></a>02387 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> WM_event_remove_handler(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler)
<a name="l02388"></a>02388 {
<a name="l02389"></a>02389     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(handlers, handler);
<a name="l02390"></a>02390     <a class="code" href="../../df/db0/wm__event__system_8c.html#ade5963989869828e5bd52a0e579d4be3">wm_event_free_handler</a>(handler);
<a name="l02391"></a>02391 }
<a name="l02392"></a>02392 <span class="preprocessor">#endif</span>
<a name="l02393"></a>02393 <span class="preprocessor"></span>
<a name="l02394"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#ae908571a39255584e47c9b34a3267a71">02394</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a1d397b4836b1aa453112a4cc59550686">WM_event_add_mousemove</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l02395"></a>02395 {
<a name="l02396"></a>02396     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l02397"></a>02397     
<a name="l02398"></a>02398     window-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a3fedf480c7474b10dbb03ac1c1376cf7">addmousemove</a> = 1;
<a name="l02399"></a>02399 }
<a name="l02400"></a>02400 
<a name="l02401"></a>02401 <span class="comment">/* for modal callbacks, check configuration for how to interpret exit with tweaks  */</span>
<a name="l02402"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a05dbb978f7c1dde2cf63b4cc799885d6">02402</a> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a1ace0e2c65b82dbce97462f4559ec380">WM_modal_tweak_exit</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *evt, <span class="keywordtype">int</span> tweak_event)
<a name="l02403"></a>02403 {
<a name="l02404"></a>02404     <span class="comment">/* if the release-confirm userpref setting is enabled, </span>
<a name="l02405"></a>02405 <span class="comment">     * tweak events can be canceled when mouse is released</span>
<a name="l02406"></a>02406 <span class="comment">     */</span>
<a name="l02407"></a>02407     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a239501c2be23902217ae583df3a4483a">USER_RELEASECONFIRM</a>) {
<a name="l02408"></a>02408         <span class="comment">/* option on, so can exit with km-release */</span>
<a name="l02409"></a>02409         <span class="keywordflow">if</span> (evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l02410"></a>02410             <span class="keywordflow">switch</span> (tweak_event) {
<a name="l02411"></a>02411                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4834ccdca786c15b0f3520f69a98b7f">EVT_TWEAK_L</a>:
<a name="l02412"></a>02412                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5c390c3396b1d7081a12667fac5b87dc">EVT_TWEAK_M</a>:
<a name="l02413"></a>02413                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68017306864d5fdc47f7f1de55d948ef">EVT_TWEAK_R</a>:
<a name="l02414"></a>02414                     <span class="keywordflow">return</span> 1;
<a name="l02415"></a>02415             }
<a name="l02416"></a>02416         }
<a name="l02417"></a>02417         <span class="keywordflow">else</span> {
<a name="l02418"></a>02418             <span class="comment">/* if the initial event wasn&#39;t a tweak event then</span>
<a name="l02419"></a>02419 <span class="comment">             * ignore USER_RELEASECONFIRM setting: see [#26756] */</span>
<a name="l02420"></a>02420             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(tweak_event, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4834ccdca786c15b0f3520f69a98b7f">EVT_TWEAK_L</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5c390c3396b1d7081a12667fac5b87dc">EVT_TWEAK_M</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68017306864d5fdc47f7f1de55d948ef">EVT_TWEAK_R</a>) == 0) {
<a name="l02421"></a>02421                 <span class="keywordflow">return</span> 1;
<a name="l02422"></a>02422             }
<a name="l02423"></a>02423         }
<a name="l02424"></a>02424     }
<a name="l02425"></a>02425     <span class="keywordflow">else</span> {
<a name="l02426"></a>02426         <span class="comment">/* this is fine as long as not doing km-release, otherwise</span>
<a name="l02427"></a>02427 <span class="comment">         * some items (i.e. markers) being tweaked may end up getting</span>
<a name="l02428"></a>02428 <span class="comment">         * dropped all over</span>
<a name="l02429"></a>02429 <span class="comment">         */</span>
<a name="l02430"></a>02430         <span class="keywordflow">if</span> (evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>)
<a name="l02431"></a>02431             <span class="keywordflow">return</span> 1;
<a name="l02432"></a>02432     }
<a name="l02433"></a>02433     
<a name="l02434"></a>02434     <span class="keywordflow">return</span> 0;
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437 <span class="comment">/* ********************* ghost stuff *************** */</span>
<a name="l02438"></a>02438 
<a name="l02439"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a31153547a568ea4fef6abceb32d28904">02439</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a31153547a568ea4fef6abceb32d28904">convert_key</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7">GHOST_TKey</a> key) 
<a name="l02440"></a>02440 {
<a name="l02441"></a>02441     <span class="keywordflow">if</span> (key &gt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ac738a848a1ce0727576895b6774f896c">GHOST_kKeyA</a> &amp;&amp; key &lt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a113c35ac6c210f4d6efd48b61becea3f">GHOST_kKeyZ</a>) {
<a name="l02442"></a>02442         <span class="keywordflow">return</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#a746a67a50a93dd2cac52c218ef94a218">AKEY</a> + ((<span class="keywordtype">int</span>) key - <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ac738a848a1ce0727576895b6774f896c">GHOST_kKeyA</a>));
<a name="l02443"></a>02443     }
<a name="l02444"></a>02444     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key &gt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a46b468be9b573203e874789e3f976c5e">GHOST_kKey0</a> &amp;&amp; key &lt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aa1dfc9eff0a4ab08e831588557bec705">GHOST_kKey9</a>) {
<a name="l02445"></a>02445         <span class="keywordflow">return</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#a18fef1c6c42114045de29186f96e1878">ZEROKEY</a> + ((<span class="keywordtype">int</span>) key - <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a46b468be9b573203e874789e3f976c5e">GHOST_kKey0</a>));
<a name="l02446"></a>02446     }
<a name="l02447"></a>02447     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key &gt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7abc3c193ef98a03a520af67ed6ef353bc">GHOST_kKeyNumpad0</a> &amp;&amp; key &lt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ab5668e32465452848cff1711931acc85">GHOST_kKeyNumpad9</a>) {
<a name="l02448"></a>02448         <span class="keywordflow">return</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#a04cfc47c84309660da78fc8a479679c3">PAD0</a> + ((<span class="keywordtype">int</span>) key - <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7abc3c193ef98a03a520af67ed6ef353bc">GHOST_kKeyNumpad0</a>));
<a name="l02449"></a>02449     }
<a name="l02450"></a>02450     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key &gt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a5fb355cab438db46ea799559234b8a98">GHOST_kKeyF1</a> &amp;&amp; key &lt;= <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a479114f9f15b5442b84363d761b69e75">GHOST_kKeyF19</a>) {
<a name="l02451"></a>02451         <span class="keywordflow">return</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#aa5db595ca499413029c93f3f257eb382">F1KEY</a> + ((<span class="keywordtype">int</span>) key - <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a5fb355cab438db46ea799559234b8a98">GHOST_kKeyF1</a>));
<a name="l02452"></a>02452     }
<a name="l02453"></a>02453     <span class="keywordflow">else</span> {
<a name="l02454"></a>02454         <span class="keywordflow">switch</span> (key) {
<a name="l02455"></a>02455             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a459f5439691a6bb7f56352e660dc8520">GHOST_kKeyBackSpace</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a>;
<a name="l02456"></a>02456             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a70f0adece896e1d47c451d92c055fac9">GHOST_kKeyTab</a>:             <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a67d5864c4d46748f0c7ee7a4fc30561d">TABKEY</a>;
<a name="l02457"></a>02457             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a86dd24f3d25d03204f9b6d67acf25872">GHOST_kKeyLinefeed</a>:        <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae3bbf21d063017d4bdc6573327a5d346">LINEFEEDKEY</a>;
<a name="l02458"></a>02458             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a5822c5d70b219a739493e2c560cab3e3">GHOST_kKeyClear</a>:           <span class="keywordflow">return</span> 0;
<a name="l02459"></a>02459             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a28485b67cd039df93d9bb057e2f5882f">GHOST_kKeyEnter</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>;
<a name="l02460"></a>02460 
<a name="l02461"></a>02461             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ad67892cf266ddee19b73cdba119b0bec">GHOST_kKeyEsc</a>:             <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>;
<a name="l02462"></a>02462             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7afd992670b632d231c5116190f1667b66">GHOST_kKeySpace</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a59b43db62ffa0d14bb076092d862d2cd">SPACEKEY</a>;
<a name="l02463"></a>02463             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a11537b3cb728b3ebd1e8cec05cbb3ee9">GHOST_kKeyQuote</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abc7ca286a0b3442e2190de6b18757729">QUOTEKEY</a>;
<a name="l02464"></a>02464             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a76fd6a1b4174261d6bb64e15216e386b">GHOST_kKeyComma</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adf608dfdafc6ae0e69128d9d207f33ed">COMMAKEY</a>;
<a name="l02465"></a>02465             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a3d57ea96a7499d318d2edb8518b9d6e9">GHOST_kKeyMinus</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32aa9ced052bfd4e51f37e3f872adfb8">MINUSKEY</a>;
<a name="l02466"></a>02466             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a9582d50457a60ed40e15e98ba52e61d2">GHOST_kKeyPeriod</a>:          <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af6576ca1700245fc5c150e84b000bc40">PERIODKEY</a>;
<a name="l02467"></a>02467             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ad992130897953745809794ecb6c9d0ff">GHOST_kKeySlash</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5b426a6dc91c359d9930f2054f43c6c7">SLASHKEY</a>;
<a name="l02468"></a>02468 
<a name="l02469"></a>02469             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a0b476f2571b80839e3440a4679c2ac5e">GHOST_kKeySemicolon</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9edb38061f4dd02393b3b6040d5ad0ff">SEMICOLONKEY</a>;
<a name="l02470"></a>02470             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aa56e5e5ccc47f4c657810a3a464e44e7">GHOST_kKeyEqual</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6622a89438c3591abe1430569e645a33">EQUALKEY</a>;
<a name="l02471"></a>02471 
<a name="l02472"></a>02472             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a6c4b5fae902552187eaa5c63ec3c1fb3">GHOST_kKeyLeftBracket</a>:     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4a7a1736031c3ddabd4982b98bbb355">LEFTBRACKETKEY</a>;
<a name="l02473"></a>02473             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a777cd013b4e20cdbb7890ae042452f4b">GHOST_kKeyRightBracket</a>:    <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a65322ad6168f54d2bdbbbc5e392f4db3">RIGHTBRACKETKEY</a>;
<a name="l02474"></a>02474             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a7d24cc4f17540eb52342b48fe186c8da">GHOST_kKeyBackslash</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a02007f618028364a8c4118d8d2d5ff42">BACKSLASHKEY</a>;
<a name="l02475"></a>02475             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a163051d941985a5d99fd8f441c140557">GHOST_kKeyAccentGrave</a>:     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a70187f9debfd7574ad1b356e168d4348">ACCENTGRAVEKEY</a>;
<a name="l02476"></a>02476 
<a name="l02477"></a>02477             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aef2c01413fb34ea291b1786b3073cfe2">GHOST_kKeyLeftShift</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8bb00d0e3bbc5c558edcef2b6c7d549c">LEFTSHIFTKEY</a>;
<a name="l02478"></a>02478             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a266dc81a499755df58a6dd28517685c6">GHOST_kKeyRightShift</a>:      <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a60ddce316227eaa9586286cca0e085f5">RIGHTSHIFTKEY</a>;
<a name="l02479"></a>02479             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a6c1164e35e71efead55cb6d113ad664f">GHOST_kKeyLeftControl</a>:     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad025960542c5698bad7efc649c641897">LEFTCTRLKEY</a>;
<a name="l02480"></a>02480             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ad43a63fa6a75d17e4fc73d27284d9494">GHOST_kKeyRightControl</a>:    <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aacc3c8c5f05ebb7eeca8e4da6dc9c969">RIGHTCTRLKEY</a>;
<a name="l02481"></a>02481             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a7d8c22a7083c0cdad6e957882937b39f">GHOST_kKeyOS</a>:              <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afe82868e971ef6b4aff6eabc84090c20">OSKEY</a>;
<a name="l02482"></a>02482             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a1ef1177814e1aed94435442820848278">GHOST_kKeyLeftAlt</a>:         <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a40ea4d6b0d8ed13cc872f87fb6d4559b">LEFTALTKEY</a>;
<a name="l02483"></a>02483             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a8d0e638dbd0c98ec57b266256b169a8e">GHOST_kKeyRightAlt</a>:        <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac92a400a2afe72bfc979d23307b29a26">RIGHTALTKEY</a>;
<a name="l02484"></a>02484 
<a name="l02485"></a>02485             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a3a031f89f2a8755f9922a7382f1ed285">GHOST_kKeyCapsLock</a>:        <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aeac42513548f4e3068c6e343f968593e">CAPSLOCKKEY</a>;
<a name="l02486"></a>02486             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a26d7d9ac105828136670373d810ecca4">GHOST_kKeyNumLock</a>:         <span class="keywordflow">return</span> 0;
<a name="l02487"></a>02487             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ad8dc514f0ec68be04d71c8b3e401819f">GHOST_kKeyScrollLock</a>:      <span class="keywordflow">return</span> 0;
<a name="l02488"></a>02488 
<a name="l02489"></a>02489             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aa365d72dfc3dba0c8081455a57d372ac">GHOST_kKeyLeftArrow</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a10c4c00065059a135492a87a229162af">LEFTARROWKEY</a>;
<a name="l02490"></a>02490             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a2c62a62f8ae33d172a47eb1be9e15c96">GHOST_kKeyRightArrow</a>:      <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a00226d1726c5da69413ce5e368332f0f">RIGHTARROWKEY</a>;
<a name="l02491"></a>02491             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ab82065f2dffda9b9ca8cda6495c5e134">GHOST_kKeyUpArrow</a>:         <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>;
<a name="l02492"></a>02492             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a5187e67847a5cd7762c54f1cc12051b9">GHOST_kKeyDownArrow</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>;
<a name="l02493"></a>02493 
<a name="l02494"></a>02494             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a6ad6550ce631e7c8e50e96db3f53a481">GHOST_kKeyPrintScreen</a>:     <span class="keywordflow">return</span> 0;
<a name="l02495"></a>02495             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a38d39044933eb7cabccdacf1e24b30bb">GHOST_kKeyPause</a>:           <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab6f292e309b6dfeec4680e86cabeeae7">PAUSEKEY</a>;
<a name="l02496"></a>02496 
<a name="l02497"></a>02497             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a06099cf06cae5262b76c5f01177d8e8b">GHOST_kKeyInsert</a>:          <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a4b243137c3e7f898a2a47f69e30c169b">INSERTKEY</a>;
<a name="l02498"></a>02498             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ab9d83696b88446c1ba09e33bf3cf22cd">GHOST_kKeyDelete</a>:          <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adb5ce1680b5ec047cfc1f0de10f4e3f0">DELKEY</a>;
<a name="l02499"></a>02499             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ab09623721e6989f5b9a1f46466309fb7">GHOST_kKeyHome</a>:            <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9ab826a2e86a9ccd0095979fc4726119">HOMEKEY</a>;
<a name="l02500"></a>02500             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7ab813a21b41a284f7cec941d62715ee9e">GHOST_kKeyEnd</a>:             <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5ef1f3d0ca3b2e83d0ddefcacceaa4d7">ENDKEY</a>;
<a name="l02501"></a>02501             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aa1c04a0e7bbd6662df4787ad0402e310">GHOST_kKeyUpPage</a>:          <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>;
<a name="l02502"></a>02502             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a4dd8d9b10464b972802e0684cf36f214">GHOST_kKeyDownPage</a>:        <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>;
<a name="l02503"></a>02503 
<a name="l02504"></a>02504             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a5bad1217530b7244fd5c62b79f0aaa04">GHOST_kKeyNumpadPeriod</a>:    <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab45280c6bf516a0393fb11baf0047244">PADPERIOD</a>;
<a name="l02505"></a>02505             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aeab93db4f40c58eb7ba22d50aec6a24c">GHOST_kKeyNumpadEnter</a>:     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>;
<a name="l02506"></a>02506             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a9d3f8794e011f802893b0662c77b08bf">GHOST_kKeyNumpadPlus</a>:      <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>;
<a name="l02507"></a>02507             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aeb4ea38d753dd07dbde1fe37a20dcc5b">GHOST_kKeyNumpadMinus</a>:     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>;
<a name="l02508"></a>02508             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a62c5d196b2633b2fbcd3600eec588587">GHOST_kKeyNumpadAsterisk</a>:  <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c76f316d8f6a531d937567438196037">PADASTERKEY</a>;
<a name="l02509"></a>02509             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a2b3f1baa5e7df092004744e9de1ccff8">GHOST_kKeyNumpadSlash</a>:     <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5c34cf5cadbf3ffd60ca6b3b8ec14605">PADSLASHKEY</a>;
<a name="l02510"></a>02510 
<a name="l02511"></a>02511             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a508905d1da7e62d3af90c718cf1617ed">GHOST_kKeyGrLess</a>:          <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a933f777b10f940f5f970dbbd3f92ca96">GRLESSKEY</a>;
<a name="l02512"></a>02512 
<a name="l02513"></a>02513             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a0db78d827b03ea27d0be8d820c33a857">GHOST_kKeyMediaPlay</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a0360fd83f8cff7f601dd6bba88938af7">MEDIAPLAY</a>;
<a name="l02514"></a>02514             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a44d924137f0ccdfe3d84ff1a5c146df9">GHOST_kKeyMediaStop</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4c1df7226da6c750b209441a1b7a1ff">MEDIASTOP</a>;
<a name="l02515"></a>02515             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7acaa01d5c879e6adfed08d9120df31e6e">GHOST_kKeyMediaFirst</a>:      <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abfa429ef1f1ed7b926703d38294a02e5">MEDIAFIRST</a>;
<a name="l02516"></a>02516             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7af580d56359853bb09a76807aace5a885">GHOST_kKeyMediaLast</a>:       <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab6bf801ccdec8498bc8a5e5c92591302">MEDIALAST</a>;
<a name="l02517"></a>02517             
<a name="l02518"></a>02518             <span class="keywordflow">default</span>:
<a name="l02519"></a>02519                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5d76c3da830c0293189ec5e266bc3cac">UNKNOWNKEY</a>;  <span class="comment">/* GHOST_kKeyUnknown */</span>
<a name="l02520"></a>02520         }
<a name="l02521"></a>02521     }
<a name="l02522"></a>02522 }
<a name="l02523"></a>02523 
<a name="l02524"></a>02524 <span class="comment">/* adds customdata to event */</span>
<a name="l02525"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">02525</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">update_tablet_data</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02526"></a>02526 {
<a name="l02527"></a>02527     <span class="keyword">const</span> <a class="code" href="../../d6/da4/structGHOST__TabletData.html">GHOST_TabletData</a> *td = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aae234b65bcb891d596f9d0d2e2b6ebc0">GHOST_GetTabletData</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l02528"></a>02528     
<a name="l02529"></a>02529     <span class="comment">/* if there&#39;s tablet data from an active tablet device then add it */</span>
<a name="l02530"></a>02530     <span class="keywordflow">if</span> ((td != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; td-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a> != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a57004bc9c30cdaaee1e4cd968aacb2b9a45103b9e5bb871499bcc83acfdd7191f">GHOST_kTabletModeNone</a>) {
<a name="l02531"></a>02531         <span class="keyword">struct </span><a class="code" href="../../d3/d0b/structwmTabletData.html">wmTabletData</a> *wmtab = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d0b/structwmTabletData.html">wmTabletData</a>), <span class="stringliteral">&quot;customdata tablet&quot;</span>);
<a name="l02532"></a>02532         
<a name="l02533"></a>02533         wmtab-&gt;<a class="code" href="../../d3/d0b/structwmTabletData.html#a25cff19785a3b589057c8d8324420cbd">Active</a> = (int)td-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a>;
<a name="l02534"></a>02534         wmtab-&gt;<a class="code" href="../../d3/d0b/structwmTabletData.html#a6456330e282f7e3e622d09741b3ddb60">Pressure</a> = td-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a901ed84334874122d01cceed78a7c276">Pressure</a>;
<a name="l02535"></a>02535         wmtab-&gt;<a class="code" href="../../d3/d0b/structwmTabletData.html#a097bafce26273f7cde84165b67852faa">Xtilt</a> = td-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a727105dd178d62d1945c3bcf1d7a1ced">Xtilt</a>;
<a name="l02536"></a>02536         wmtab-&gt;<a class="code" href="../../d3/d0b/structwmTabletData.html#a82e9748942d63544fd4c6b3b4d1247a3">Ytilt</a> = td-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#acf15dee6213e645b1fbf17c9d9aaf880">Ytilt</a>;
<a name="l02537"></a>02537         
<a name="l02538"></a>02538         event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a276cd44fa9cab09b621a83980b335b47">custom</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a0dbe462839c84a02b2d3698e720ed27d">EVT_DATA_TABLET</a>;
<a name="l02539"></a>02539         event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> = wmtab;
<a name="l02540"></a>02540         event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7df1658c9f61db247e65141d1e64a336">customdatafree</a> = 1;
<a name="l02541"></a>02541     } 
<a name="l02542"></a>02542 }
<a name="l02543"></a>02543 
<a name="l02544"></a>02544 <span class="comment">/* adds customdata to event */</span>
<a name="l02545"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a833fcf255f02d1aabf1bebf76e5a3972">02545</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a833fcf255f02d1aabf1bebf76e5a3972">attach_ndof_data</a>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keyword">const</span> <a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html">GHOST_TEventNDOFMotionData</a> *ghost)
<a name="l02546"></a>02546 {
<a name="l02547"></a>02547     <a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a>), <span class="stringliteral">&quot;customdata NDOF&quot;</span>);
<a name="l02548"></a>02548 
<a name="l02549"></a>02549     <span class="keyword">const</span> <span class="keywordtype">float</span> s = <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.ndof_sensitivity;
<a name="l02550"></a>02550 
<a name="l02551"></a>02551     data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#afa0d9d20afe97f71d41e7ebbd7de2056">tx</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#aced880269d6534ef06f8b73807cf688e">tx</a>;
<a name="l02552"></a>02552 
<a name="l02553"></a>02553     data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#adbb24381ea1b0b0405358e226cb17821">rx</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a64b52f3bd56066420ddec5a5d04cac2d">rx</a>;
<a name="l02554"></a>02554     data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a0cb2beee8753d77ec40c99a0d2f538f7">ry</a>;
<a name="l02555"></a>02555     data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa9da03746244002310e657db239f37c3">rz</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#af2a00714b628c1b1e6047e0c5767a13c">rz</a>;
<a name="l02556"></a>02556 
<a name="l02557"></a>02557     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.ndof_flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a106db9b839f1ed4b926d7f7bd29d5d00">NDOF_ZOOM_UPDOWN</a>) {
<a name="l02558"></a>02558         <span class="comment">/* rotate so Y is where Z was */</span>
<a name="l02559"></a>02559         data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#a61cd10fcd760e19ea94a6b97e2a95914">ty</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a99c83cfe55cb6008b5cc274d426bc562">tz</a>;
<a name="l02560"></a>02560         data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aac13192221de90afd1e56343ff4b275f">tz</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a6282e70d972d5af25acb826ec96f4577">ty</a>;
<a name="l02561"></a>02561         <span class="comment">/* maintain handed-ness? or just do what feels right? */</span>
<a name="l02562"></a>02562 
<a name="l02563"></a>02563         <span class="comment">/* should this affect rotation also?</span>
<a name="l02564"></a>02564 <span class="comment">         * initial guess is &#39;yes&#39;, but get user feedback immediately!</span>
<a name="l02565"></a>02565 <span class="comment">         */</span>
<a name="l02566"></a>02566 <span class="preprocessor">#if 0</span>
<a name="l02567"></a>02567 <span class="preprocessor"></span>        <span class="comment">/* after turning this on, my guess becomes &#39;no&#39; */</span>
<a name="l02568"></a>02568         data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#af2a00714b628c1b1e6047e0c5767a13c">rz</a>;
<a name="l02569"></a>02569         data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa9da03746244002310e657db239f37c3">rz</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a0cb2beee8753d77ec40c99a0d2f538f7">ry</a>;
<a name="l02570"></a>02570 <span class="preprocessor">#endif</span>
<a name="l02571"></a>02571 <span class="preprocessor"></span>    }
<a name="l02572"></a>02572     <span class="keywordflow">else</span> {
<a name="l02573"></a>02573         data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#a61cd10fcd760e19ea94a6b97e2a95914">ty</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a6282e70d972d5af25acb826ec96f4577">ty</a>;
<a name="l02574"></a>02574         data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aac13192221de90afd1e56343ff4b275f">tz</a> = s * ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a99c83cfe55cb6008b5cc274d426bc562">tz</a>;
<a name="l02575"></a>02575     }
<a name="l02576"></a>02576 
<a name="l02577"></a>02577     data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa8200706e79acb437464a7df7d8a6511">dt</a> = ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#aa924357c2bc392a54319ae77fb9ee558">dt</a>;
<a name="l02578"></a>02578 
<a name="l02579"></a>02579     data-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#a207a7708c488bb531d4db4009bb6c0c9">progress</a> = (<a class="code" href="../../d4/ddc/WM__types_8h.html#adfbdcd3481ba4d74760ad12b48b2a936">wmProgress</a>) ghost-&gt;<a class="code" href="../../db/d9a/structGHOST__TEventNDOFMotionData.html#a7833fa6c78f3b8b2059e2dee54187322">progress</a>;
<a name="l02580"></a>02580 
<a name="l02581"></a>02581     event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a276cd44fa9cab09b621a83980b335b47">custom</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac0582ae9ad4508dd57a4f4482553ed63">EVT_DATA_NDOF_MOTION</a>;
<a name="l02582"></a>02582     event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> = data;
<a name="l02583"></a>02583     event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7df1658c9f61db247e65141d1e64a336">customdatafree</a> = 1;
<a name="l02584"></a>02584 }
<a name="l02585"></a>02585 
<a name="l02586"></a>02586 <span class="comment">/* imperfect but probably usable... draw/enable drags to other windows */</span>
<a name="l02587"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a4c3486d74a2298c705248eb1b0fda235">02587</a> <span class="keyword">static</span> <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../df/db0/wm__event__system_8c.html#a4c3486d74a2298c705248eb1b0fda235">wm_event_cursor_other_windows</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *evt)
<a name="l02588"></a>02588 {
<a name="l02589"></a>02589     <span class="keywordtype">int</span> mx = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, my = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>;
<a name="l02590"></a>02590     
<a name="l02591"></a>02591     <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>)
<a name="l02592"></a>02592         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02593"></a>02593     
<a name="l02594"></a>02594     <span class="comment">/* top window bar... */</span>
<a name="l02595"></a>02595     <span class="keywordflow">if</span> (mx &lt; 0 || my &lt; 0 || mx &gt; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> || my &gt; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> + 30) {
<a name="l02596"></a>02596         <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *owin;
<a name="l02597"></a>02597         <a class="code" href="../../d6/d78/structwmEventHandler.html">wmEventHandler</a> *handler;
<a name="l02598"></a>02598         
<a name="l02599"></a>02599         <span class="comment">/* let&#39;s skip windows having modal handlers now */</span>
<a name="l02600"></a>02600         <span class="comment">/* potential XXX ugly... I wouldn&#39;t have added a modalhandlers list (introduced in rev 23331, ton) */</span>
<a name="l02601"></a>02601         <span class="keywordflow">for</span> (handler = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; handler; handler = handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a6fa193b24e5eb4b8ff10726667a91827">next</a>)
<a name="l02602"></a>02602             <span class="keywordflow">if</span> (handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#a18889268018439c404938d7fe542f715">ui_handle</a> || handler-&gt;<a class="code" href="../../d6/d78/structwmEventHandler.html#ad8a49179f75e191ed3219f91f9d8721c">op</a>)
<a name="l02603"></a>02603                 <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02604"></a>02604         
<a name="l02605"></a>02605         <span class="comment">/* to desktop space */</span>
<a name="l02606"></a>02606         mx += (int)win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a>;
<a name="l02607"></a>02607         my += (<span class="keywordtype">int</span>)win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a>;
<a name="l02608"></a>02608         
<a name="l02609"></a>02609         <span class="comment">/* check other windows to see if it has mouse inside */</span>
<a name="l02610"></a>02610         <span class="keywordflow">for</span> (owin = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; owin; owin = owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l02611"></a>02611             
<a name="l02612"></a>02612             <span class="keywordflow">if</span> (owin != win) {
<a name="l02613"></a>02613                 <span class="keywordflow">if</span> (mx - owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> &gt;= 0 &amp;&amp; my - owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> &gt;= 0 &amp;&amp;
<a name="l02614"></a>02614                     mx - owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> &lt;= owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> &amp;&amp; my - owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> &lt;= owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>) {
<a name="l02615"></a>02615                     evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = mx - (int)owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a>;
<a name="l02616"></a>02616                     evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = my - (<span class="keywordtype">int</span>)owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a>;
<a name="l02617"></a>02617                     
<a name="l02618"></a>02618                     <span class="keywordflow">return</span> owin;
<a name="l02619"></a>02619                 }
<a name="l02620"></a>02620             }
<a name="l02621"></a>02621         }
<a name="l02622"></a>02622     }
<a name="l02623"></a>02623     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02624"></a>02624 }
<a name="l02625"></a>02625 
<a name="l02626"></a>02626 <span class="comment">/* windows store own event queues, no bContext here */</span>
<a name="l02627"></a>02627 <span class="comment">/* time is in 1000s of seconds, from ghost */</span>
<a name="l02628"></a><a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">02628</a> <span class="keywordtype">void</span> <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(time), <span class="keywordtype">void</span> *customdata)
<a name="l02629"></a>02629 {
<a name="l02630"></a>02630     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *owin;
<a name="l02631"></a>02631     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> event, *evt = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>;
<a name="l02632"></a>02632 
<a name="l02633"></a>02633     <span class="comment">/* initialize and copy state (only mouse x y and modifiers) */</span>
<a name="l02634"></a>02634     <span class="keyword">event</span> = *evt;
<a name="l02635"></a>02635     
<a name="l02636"></a>02636     <span class="keywordflow">switch</span> (type) {
<a name="l02637"></a>02637         <span class="comment">/* mouse move */</span>
<a name="l02638"></a>02638         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a5145e18bf4e32ba74fe5ef5e46d073b3">GHOST_kEventCursorMove</a>: {
<a name="l02639"></a>02639             <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac3a700141c9a861934cce09d66af62cf">active</a>) {
<a name="l02640"></a>02640                 <a class="code" href="../../dc/dfd/structGHOST__TEventCursorData.html">GHOST_TEventCursorData</a> *cd = customdata;
<a name="l02641"></a>02641                 <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *lastevent = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l02642"></a>02642                 <span class="keywordtype">int</span> cx, cy;
<a name="l02643"></a>02643                 
<a name="l02644"></a>02644                 <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a255a7b25314a51c88026db1418d52eed">GHOST_ScreenToClient</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, cd-&gt;<a class="code" href="../../dc/dfd/structGHOST__TEventCursorData.html#acaed2bfc6eaec1d094cb3b0e663ef6a9">x</a>, cd-&gt;<a class="code" href="../../dc/dfd/structGHOST__TEventCursorData.html#a5d7d0171eeedbeb995297385410b0b56">y</a>, &amp;cx, &amp;cy);
<a name="l02645"></a>02645                 evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = cx;
<a name="l02646"></a>02646                 evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> - 1) - cy;
<a name="l02647"></a>02647                 
<a name="l02648"></a>02648                 <span class="keyword">event</span>.x = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>;
<a name="l02649"></a>02649                 <span class="keyword">event</span>.y = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>;
<a name="l02650"></a>02650 
<a name="l02651"></a>02651                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>;
<a name="l02652"></a>02652 
<a name="l02653"></a>02653                 <span class="comment">/* some painting operators want accurate mouse events, they can</span>
<a name="l02654"></a>02654 <span class="comment">                 * handle in between mouse move moves, others can happily ignore</span>
<a name="l02655"></a>02655 <span class="comment">                 * them for better performance */</span>
<a name="l02656"></a>02656                 <span class="keywordflow">if</span> (lastevent &amp;&amp; lastevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>)
<a name="l02657"></a>02657                     lastevent-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99234bdab7c4336e174cd0db37044412">INBETWEEN_MOUSEMOVE</a>;
<a name="l02658"></a>02658 
<a name="l02659"></a>02659                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">update_tablet_data</a>(win, &amp;event);
<a name="l02660"></a>02660                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02661"></a>02661 
<a name="l02662"></a>02662                 <span class="comment">//printf(&quot;sending MOUSEMOVE %d %d\n&quot;, event.x, event.y);</span>
<a name="l02663"></a>02663                 
<a name="l02664"></a>02664                 <span class="comment">/* also add to other window if event is there, this makes overdraws disappear nicely */</span>
<a name="l02665"></a>02665                 <span class="comment">/* it remaps mousecoord to other window in event */</span>
<a name="l02666"></a>02666                 owin = <a class="code" href="../../df/db0/wm__event__system_8c.html#a4c3486d74a2298c705248eb1b0fda235">wm_event_cursor_other_windows</a>(wm, win, &amp;event);
<a name="l02667"></a>02667                 <span class="keywordflow">if</span> (owin) {
<a name="l02668"></a>02668                     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> oevent = *(owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);
<a name="l02669"></a>02669                     
<a name="l02670"></a>02670                     oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = <span class="keyword">event</span>.x;
<a name="l02671"></a>02671                     oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = <span class="keyword">event</span>.y;
<a name="l02672"></a>02672                     oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>;
<a name="l02673"></a>02673                     
<a name="l02674"></a>02674                     <a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">update_tablet_data</a>(owin, &amp;oevent);
<a name="l02675"></a>02675                     <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(owin, &amp;oevent);
<a name="l02676"></a>02676                 }
<a name="l02677"></a>02677                 
<a name="l02678"></a>02678             }
<a name="l02679"></a>02679             <span class="keywordflow">break</span>;
<a name="l02680"></a>02680         }
<a name="l02681"></a>02681         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a814394c6c09ffe780fa4a484d759c633" title="Mouse wheel event.">GHOST_kEventTrackpad</a>: {
<a name="l02682"></a>02682             <a class="code" href="../../d3/d2e/structGHOST__TEventTrackpadData.html">GHOST_TEventTrackpadData</a> *pd = customdata;
<a name="l02683"></a>02683             <span class="keywordflow">switch</span> (pd-&gt;<a class="code" href="../../d3/d2e/structGHOST__TEventTrackpadData.html#a9297216f2e7df5ef141e1a95746ef951">subtype</a>) {
<a name="l02684"></a>02684                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a17bcf86444a2f5fbdd6cd723297d0b96a495517439b0d1713628ef03beb4fda33">GHOST_kTrackpadEventMagnify</a>:
<a name="l02685"></a>02685                     <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a87d179409a17bb20a1c248c84b170b55">MOUSEZOOM</a>;
<a name="l02686"></a>02686                     <span class="keywordflow">break</span>;
<a name="l02687"></a>02687                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a17bcf86444a2f5fbdd6cd723297d0b96acc4d28ea3b0882afe6d612964a3a7bb2">GHOST_kTrackpadEventRotate</a>:
<a name="l02688"></a>02688                     <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5de175d5a9bf0c93055956061957267a">MOUSEROTATE</a>;
<a name="l02689"></a>02689                     <span class="keywordflow">break</span>;
<a name="l02690"></a>02690                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a17bcf86444a2f5fbdd6cd723297d0b96acd69c0c2efb9ae2f3367377664704c06">GHOST_kTrackpadEventScroll</a>:
<a name="l02691"></a>02691                 <span class="keywordflow">default</span>:
<a name="l02692"></a>02692                     <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a65f114370656971c14863717d5364176">MOUSEPAN</a>;
<a name="l02693"></a>02693                     <span class="keywordflow">break</span>;
<a name="l02694"></a>02694             }
<a name="l02695"></a>02695 
<a name="l02696"></a>02696             {
<a name="l02697"></a>02697                 <span class="keywordtype">int</span> cx, cy;
<a name="l02698"></a>02698                 <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a255a7b25314a51c88026db1418d52eed">GHOST_ScreenToClient</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, pd-&gt;<a class="code" href="../../d3/d2e/structGHOST__TEventTrackpadData.html#a9c82e1c8618e868010387c2d7bcb60ac">x</a>, pd-&gt;<a class="code" href="../../d3/d2e/structGHOST__TEventTrackpadData.html#a815076bbd82e74210ba10a892f7a9513">y</a>, &amp;cx, &amp;cy);
<a name="l02699"></a>02699                 <span class="keyword">event</span>.x = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = cx;
<a name="l02700"></a>02700                 <span class="keyword">event</span>.y = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> - 1) - cy;
<a name="l02701"></a>02701             }
<a name="l02702"></a>02702 
<a name="l02703"></a>02703             <span class="comment">// Use prevx/prevy so we can calculate the delta later</span>
<a name="l02704"></a>02704             <span class="keyword">event</span>.prevx = <span class="keyword">event</span>.x - pd-&gt;<a class="code" href="../../d3/d2e/structGHOST__TEventTrackpadData.html#aac4e1a6fe77e33f204b504f6913a52f0">deltaX</a>;
<a name="l02705"></a>02705             <span class="keyword">event</span>.prevy = <span class="keyword">event</span>.y - (-pd-&gt;<a class="code" href="../../d3/d2e/structGHOST__TEventTrackpadData.html#ad4b49402d627e2d59d946d613f606618">deltaY</a>);
<a name="l02706"></a>02706             
<a name="l02707"></a>02707             <a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">update_tablet_data</a>(win, &amp;event);
<a name="l02708"></a>02708             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02709"></a>02709             <span class="keywordflow">break</span>;
<a name="l02710"></a>02710         }
<a name="l02711"></a>02711         <span class="comment">/* mouse button */</span>
<a name="l02712"></a>02712         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ab52b565c614eec0ab7ce45df7e0ff947" title="Mouse move event.">GHOST_kEventButtonDown</a>:
<a name="l02713"></a>02713         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a75edbc6f9ddd8ca9efe59af57f1855a1" title="Mouse button event.">GHOST_kEventButtonUp</a>: {
<a name="l02714"></a>02714             <a class="code" href="../../d6/d1f/structGHOST__TEventButtonData.html">GHOST_TEventButtonData</a> *bd = customdata;
<a name="l02715"></a>02715 
<a name="l02716"></a>02716             <span class="comment">/* Note!, this starts as 0/1 but later is converted to KM_PRESS/KM_RELEASE by tweak */</span>
<a name="l02717"></a>02717             <span class="keyword">event</span>.val = (type == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ab52b565c614eec0ab7ce45df7e0ff947" title="Mouse move event.">GHOST_kEventButtonDown</a>) ? <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> : <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>;
<a name="l02718"></a>02718             
<a name="l02719"></a>02719             <span class="keywordflow">if</span> (bd-&gt;<a class="code" href="../../d6/d1f/structGHOST__TEventButtonData.html#a0bfe0a08bee3a0b6c8b587c928cbb68c">button</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a91922f74fe0b8eb3c5e787ac2e62260da62a24d5e11509c7de7c8a8344f779095">GHOST_kButtonMaskLeft</a>)
<a name="l02720"></a>02720                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>;
<a name="l02721"></a>02721             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bd-&gt;<a class="code" href="../../d6/d1f/structGHOST__TEventButtonData.html#a0bfe0a08bee3a0b6c8b587c928cbb68c">button</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a91922f74fe0b8eb3c5e787ac2e62260da1747b8b44cf3420bf6c700c8ea82a29f">GHOST_kButtonMaskRight</a>)
<a name="l02722"></a>02722                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>;
<a name="l02723"></a>02723             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bd-&gt;<a class="code" href="../../d6/d1f/structGHOST__TEventButtonData.html#a0bfe0a08bee3a0b6c8b587c928cbb68c">button</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a91922f74fe0b8eb3c5e787ac2e62260da291ea64b62e0472bc7df938ebc48da92">GHOST_kButtonMaskButton4</a>)
<a name="l02724"></a>02724                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a46229765c60e2b506e5fa289acaef9da">BUTTON4MOUSE</a>;
<a name="l02725"></a>02725             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bd-&gt;<a class="code" href="../../d6/d1f/structGHOST__TEventButtonData.html#a0bfe0a08bee3a0b6c8b587c928cbb68c">button</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a91922f74fe0b8eb3c5e787ac2e62260dad53c3f1929e96f38b815b0bd5b43dc2a">GHOST_kButtonMaskButton5</a>)
<a name="l02726"></a>02726                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#aeebda33ae2c7cadc3f6ebd9d164b04cd">BUTTON5MOUSE</a>;
<a name="l02727"></a>02727             <span class="keywordflow">else</span>
<a name="l02728"></a>02728                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>;
<a name="l02729"></a>02729             
<a name="l02730"></a>02730             <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac3a700141c9a861934cce09d66af62cf">active</a> == 0) {
<a name="l02731"></a>02731                 <span class="keywordtype">int</span> cx, cy;
<a name="l02732"></a>02732                 
<a name="l02733"></a>02733                 <span class="comment">/* entering window, update mouse pos. (ghost sends win-activate *after* the mouseclick in window!) */</span>
<a name="l02734"></a>02734                 <a class="code" href="../../d7/d6e/wm__window_8c.html#ac47afd8f0d85eea4732713413efa0011">wm_get_cursor_position</a>(win, &amp;cx, &amp;cy);
<a name="l02735"></a>02735 
<a name="l02736"></a>02736                 <span class="keyword">event</span>.x = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = cx;
<a name="l02737"></a>02737                 <span class="keyword">event</span>.y = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = cy;
<a name="l02738"></a>02738             }
<a name="l02739"></a>02739             
<a name="l02740"></a>02740             <span class="comment">/* add to other window if event is there (not to both!) */</span>
<a name="l02741"></a>02741             owin = <a class="code" href="../../df/db0/wm__event__system_8c.html#a4c3486d74a2298c705248eb1b0fda235">wm_event_cursor_other_windows</a>(wm, win, &amp;event);
<a name="l02742"></a>02742             <span class="keywordflow">if</span> (owin) {
<a name="l02743"></a>02743                 <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> oevent = *(owin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);
<a name="l02744"></a>02744                 
<a name="l02745"></a>02745                 oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = <span class="keyword">event</span>.x;
<a name="l02746"></a>02746                 oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = <span class="keyword">event</span>.y;
<a name="l02747"></a>02747                 oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = <span class="keyword">event</span>.type;
<a name="l02748"></a>02748                 oevent.<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> = <span class="keyword">event</span>.val;
<a name="l02749"></a>02749                 
<a name="l02750"></a>02750                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">update_tablet_data</a>(owin, &amp;oevent);
<a name="l02751"></a>02751                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(owin, &amp;oevent);
<a name="l02752"></a>02752             }
<a name="l02753"></a>02753             <span class="keywordflow">else</span> {
<a name="l02754"></a>02754                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abdf11632b661c89355470e70e6e1c76c">update_tablet_data</a>(win, &amp;event);
<a name="l02755"></a>02755                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02756"></a>02756             }
<a name="l02757"></a>02757             
<a name="l02758"></a>02758             <span class="keywordflow">break</span>;
<a name="l02759"></a>02759         }
<a name="l02760"></a>02760         <span class="comment">/* keyboard */</span>
<a name="l02761"></a>02761         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044abdd4f5007ae125cb8172f22cae1a1dd1" title="N degree of freedom device button event.">GHOST_kEventKeyDown</a>:
<a name="l02762"></a>02762         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae6b90f2387a4b1a1906924872f9b4344">GHOST_kEventKeyUp</a>: {
<a name="l02763"></a>02763             <a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html">GHOST_TEventKeyData</a> *kd = customdata;
<a name="l02764"></a>02764             <span class="keyword">event</span>.type = <a class="code" href="../../df/db0/wm__event__system_8c.html#a31153547a568ea4fef6abceb32d28904">convert_key</a>(kd-&gt;<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a307b62b2a190392a7274e7a5357fc051">key</a>);
<a name="l02765"></a>02765             <span class="keyword">event</span>.ascii = kd-&gt;<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#ae3a4ca394c8e8170a8e13195e8b274f7">ascii</a>;
<a name="l02766"></a>02766             memcpy(event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>, kd-&gt;<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a8eb1160214f6258efe304412adf04afb">utf8_buf</a>, <span class="keyword">sizeof</span>(event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>)); <span class="comment">/* might be not null terminated*/</span>
<a name="l02767"></a>02767             <span class="keyword">event</span>.val = (type == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044abdd4f5007ae125cb8172f22cae1a1dd1" title="N degree of freedom device button event.">GHOST_kEventKeyDown</a>) ? <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> : <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>;
<a name="l02768"></a>02768             
<a name="l02769"></a>02769             <span class="comment">/* exclude arrow keys, esc, etc from text input */</span>
<a name="l02770"></a>02770             <span class="keywordflow">if</span> (type == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae6b90f2387a4b1a1906924872f9b4344">GHOST_kEventKeyUp</a>) {
<a name="l02771"></a>02771                 <span class="keyword">event</span>.ascii = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02772"></a>02772 
<a name="l02773"></a>02773                 <span class="comment">/* ghost should do this already for key up */</span>
<a name="l02774"></a>02774                 <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0]) {
<a name="l02775"></a>02775                     printf(<span class="stringliteral">&quot;%s: ghost on your platform is misbehaving, utf8 events on key up!\n&quot;</span>, __func__);
<a name="l02776"></a>02776                 }
<a name="l02777"></a>02777                 <span class="keyword">event</span>.utf8_buf[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02778"></a>02778             }
<a name="l02779"></a>02779             <span class="keywordflow">else</span> {
<a name="l02780"></a>02780                 <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#af3606467f06540b8776a50419af70a71">ascii</a> &lt; 32 &amp;&amp; event.<a class="code" href="../../d5/d6c/structwmEvent.html#af3606467f06540b8776a50419af70a71">ascii</a> &gt; 0)
<a name="l02781"></a>02781                     <span class="keyword">event</span>.ascii = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02782"></a>02782                 <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0] &lt; 32 &amp;&amp; event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0] &gt; 0)
<a name="l02783"></a>02783                     <span class="keyword">event</span>.utf8_buf[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02784"></a>02784             }
<a name="l02785"></a>02785 
<a name="l02786"></a>02786             <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0]) {
<a name="l02787"></a>02787                 <span class="keywordflow">if</span> (<a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#ac28dea96012eef5bd4cd541b9f447bef">BLI_str_utf8_size</a>(event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>) == -1) {
<a name="l02788"></a>02788                     printf(<span class="stringliteral">&quot;%s: ghost detected an invalid unicode character &#39;%d&#39;!\n&quot;</span>,
<a name="l02789"></a>02789                            __func__, (<span class="keywordtype">int</span>)(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)event.<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0]);
<a name="l02790"></a>02790                     <span class="keyword">event</span>.utf8_buf[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02791"></a>02791                 }
<a name="l02792"></a>02792             }
<a name="l02793"></a>02793 
<a name="l02794"></a>02794             <span class="comment">/* modifiers */</span>
<a name="l02795"></a>02795             <span class="comment">/* assigning both first and second is strange - campbell */</span>
<a name="l02796"></a>02796             <span class="keywordflow">switch</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l02797"></a>02797                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8bb00d0e3bbc5c558edcef2b6c7d549c">LEFTSHIFTKEY</a>: <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a60ddce316227eaa9586286cca0e085f5">RIGHTSHIFTKEY</a>:
<a name="l02798"></a>02798                     <span class="keyword">event</span>.shift = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> = (<span class="keyword">event</span>.val == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) ?
<a name="l02799"></a>02799                                                ((evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) ? (<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a08c68f7174ebe9b32915bc11fd61a480">KM_MOD_SECOND</a>) : <a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>) :
<a name="l02800"></a>02800                                                <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02801"></a>02801                     <span class="keywordflow">break</span>;
<a name="l02802"></a>02802                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad025960542c5698bad7efc649c641897">LEFTCTRLKEY</a>: <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aacc3c8c5f05ebb7eeca8e4da6dc9c969">RIGHTCTRLKEY</a>:
<a name="l02803"></a>02803                     <span class="keyword">event</span>.ctrl = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> = (<span class="keyword">event</span>.val == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) ?
<a name="l02804"></a>02804                                              ((evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) ? (<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a08c68f7174ebe9b32915bc11fd61a480">KM_MOD_SECOND</a>) : <a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>) :
<a name="l02805"></a>02805                                              <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02806"></a>02806                     <span class="keywordflow">break</span>;
<a name="l02807"></a>02807                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a40ea4d6b0d8ed13cc872f87fb6d4559b">LEFTALTKEY</a>: <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac92a400a2afe72bfc979d23307b29a26">RIGHTALTKEY</a>:
<a name="l02808"></a>02808                     <span class="keyword">event</span>.alt = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> = (<span class="keyword">event</span>.val == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) ?
<a name="l02809"></a>02809                                            ((evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) ? (<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a08c68f7174ebe9b32915bc11fd61a480">KM_MOD_SECOND</a>) : <a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>) :
<a name="l02810"></a>02810                                            <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02811"></a>02811                     <span class="keywordflow">break</span>;
<a name="l02812"></a>02812                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afe82868e971ef6b4aff6eabc84090c20">OSKEY</a>:
<a name="l02813"></a>02813                     <span class="keyword">event</span>.oskey = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a> = (<span class="keyword">event</span>.val == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) ?
<a name="l02814"></a>02814                                                ((evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> || evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) ? (<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a08c68f7174ebe9b32915bc11fd61a480">KM_MOD_SECOND</a>) : <a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>) :
<a name="l02815"></a>02815                                                <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02816"></a>02816                     <span class="keywordflow">break</span>;
<a name="l02817"></a>02817                 <span class="keywordflow">default</span>:
<a name="l02818"></a>02818                     <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> &amp;&amp; event.<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> == 0)
<a name="l02819"></a>02819                         evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> = <span class="keyword">event</span>.type;  <span class="comment">/* only set in eventstate, for next event */</span>
<a name="l02820"></a>02820                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a> &amp;&amp; event.<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> == event.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)
<a name="l02821"></a>02821                         <span class="keyword">event</span>.keymodifier = evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> = 0;
<a name="l02822"></a>02822                     <span class="keywordflow">break</span>;
<a name="l02823"></a>02823             }
<a name="l02824"></a>02824 
<a name="l02825"></a>02825             <span class="comment">/* this case happens on some systems that on holding a key pressed,</span>
<a name="l02826"></a>02826 <span class="comment">             * generate press events without release, we still want to keep the</span>
<a name="l02827"></a>02827 <span class="comment">             * modifier in win-&gt;eventstate, but for the press event of the same</span>
<a name="l02828"></a>02828 <span class="comment">             * key we don&#39;t want the key modifier */</span>
<a name="l02829"></a>02829             <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> == event.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)
<a name="l02830"></a>02830                 <span class="keyword">event</span>.keymodifier = 0;
<a name="l02831"></a>02831             <span class="comment">/* this case happened with an external numpad, it&#39;s not really clear</span>
<a name="l02832"></a>02832 <span class="comment">             * why, but it&#39;s also impossible to map a key modifier to an unknwon</span>
<a name="l02833"></a>02833 <span class="comment">             * key, so it shouldn&#39;t harm */</span>
<a name="l02834"></a>02834             <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5d76c3da830c0293189ec5e266bc3cac">UNKNOWNKEY</a>)
<a name="l02835"></a>02835                 <span class="keyword">event</span>.keymodifier = 0;
<a name="l02836"></a>02836             
<a name="l02837"></a>02837             <span class="comment">/* if test_break set, it catches this. XXX Keep global for now? */</span>
<a name="l02838"></a>02838             <span class="keywordflow">if</span> (event.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>)
<a name="l02839"></a>02839                 <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.afbreek = 1;
<a name="l02840"></a>02840             
<a name="l02841"></a>02841             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02842"></a>02842             
<a name="l02843"></a>02843             <span class="keywordflow">break</span>;
<a name="l02844"></a>02844         }
<a name="l02845"></a>02845             
<a name="l02846"></a>02846         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a026e138bb864a3e121d569e400585fa7" title="Mouse button event.">GHOST_kEventWheel</a>: {
<a name="l02847"></a>02847             <a class="code" href="../../dd/dc2/structGHOST__TEventWheelData.html">GHOST_TEventWheelData</a> *wheelData = customdata;
<a name="l02848"></a>02848             
<a name="l02849"></a>02849             <span class="keywordflow">if</span> (wheelData-&gt;<a class="code" href="../../dd/dc2/structGHOST__TEventWheelData.html#a93de67f18b5b112726581ab45785456c">z</a> &gt; 0)
<a name="l02850"></a>02850                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>;
<a name="l02851"></a>02851             <span class="keywordflow">else</span>
<a name="l02852"></a>02852                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>;
<a name="l02853"></a>02853             
<a name="l02854"></a>02854             <span class="keyword">event</span>.val = <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>;
<a name="l02855"></a>02855             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02856"></a>02856             
<a name="l02857"></a>02857             <span class="keywordflow">break</span>;
<a name="l02858"></a>02858         }
<a name="l02859"></a>02859         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a0549560e783a576142db546bbf8f45c2">GHOST_kEventTimer</a>: {
<a name="l02860"></a>02860             <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>;
<a name="l02861"></a>02861             <span class="keyword">event</span>.custom = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a72ea9959a22a0ce665e6130c8e0f7815">EVT_DATA_TIMER</a>;
<a name="l02862"></a>02862             <span class="keyword">event</span>.customdata = customdata;
<a name="l02863"></a>02863             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02864"></a>02864 
<a name="l02865"></a>02865             <span class="keywordflow">break</span>;
<a name="l02866"></a>02866         }
<a name="l02867"></a>02867 
<a name="l02868"></a>02868         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044aebcdc0032234a4609cefd5b86c1f6ad6" title="Trackpad event.">GHOST_kEventNDOFMotion</a>: {
<a name="l02869"></a>02869             <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a923a119e6e59562806b30dd6a899d19f">NDOF_MOTION</a>;
<a name="l02870"></a>02870             <a class="code" href="../../df/db0/wm__event__system_8c.html#a833fcf255f02d1aabf1bebf76e5a3972">attach_ndof_data</a>(&amp;event, customdata);
<a name="l02871"></a>02871             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02872"></a>02872 
<a name="l02873"></a>02873             <span class="comment">//printf(&quot;sending NDOF_MOTION, prev = %d %d\n&quot;, event.x, event.y);</span>
<a name="l02874"></a>02874 
<a name="l02875"></a>02875             <span class="keywordflow">break</span>;
<a name="l02876"></a>02876         }
<a name="l02877"></a>02877 
<a name="l02878"></a>02878         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ace034eb6831ece4b80deb86278b163d6" title="N degree of freedom device motion event.">GHOST_kEventNDOFButton</a>: {
<a name="l02879"></a>02879             <a class="code" href="../../dd/d69/structGHOST__TEventNDOFButtonData.html">GHOST_TEventNDOFButtonData</a> *e = customdata;
<a name="l02880"></a>02880 
<a name="l02881"></a>02881             <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#af9e099c537bf634041abbe01e4c83422aa2d89e306cf2bddbeba4afdf6a521f35">NDOF_BUTTON_NONE</a> + e-&gt;<a class="code" href="../../dd/d69/structGHOST__TEventNDOFButtonData.html#a00b7c910db447d20d506624a82d7e3fd">button</a>;
<a name="l02882"></a>02882 
<a name="l02883"></a>02883             <span class="keywordflow">switch</span> (e-&gt;<a class="code" href="../../dd/d69/structGHOST__TEventNDOFButtonData.html#a586032a13aecb6830ab0998d532583eb">action</a>) {
<a name="l02884"></a>02884                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a9f8ab19529dfc408813087eb5a313acda08ecf203eded95123f9fa89eba726e70">GHOST_kPress</a>:
<a name="l02885"></a>02885                     <span class="keyword">event</span>.val = <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>;
<a name="l02886"></a>02886                     <span class="keywordflow">break</span>;
<a name="l02887"></a>02887                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a9f8ab19529dfc408813087eb5a313acda6ef6cc23312a035bf589337b510d6a97">GHOST_kRelease</a>:
<a name="l02888"></a>02888                     <span class="keyword">event</span>.val = <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>;
<a name="l02889"></a>02889                     <span class="keywordflow">break</span>;
<a name="l02890"></a>02890             }
<a name="l02891"></a>02891 
<a name="l02892"></a>02892             <span class="keyword">event</span>.custom = 0;
<a name="l02893"></a>02893             <span class="keyword">event</span>.customdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02894"></a>02894 
<a name="l02895"></a>02895             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02896"></a>02896 
<a name="l02897"></a>02897             <span class="keywordflow">break</span>;
<a name="l02898"></a>02898         }
<a name="l02899"></a>02899 
<a name="l02900"></a>02900         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae223bb43cb8d9a6adea8339e5786dde1">GHOST_kEventUnknown</a>:
<a name="l02901"></a>02901         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044afd9a4befb21f7f141cbe0ed8db841cbf">GHOST_kNumEventTypes</a>:
<a name="l02902"></a>02902             <span class="keywordflow">break</span>;
<a name="l02903"></a>02903 
<a name="l02904"></a>02904         <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ab191770e1a2ec5901296f0c41c699aff">GHOST_kEventWindowDeactivate</a>: {
<a name="l02905"></a>02905             <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#aedc39a0f069c3164e42a4ab800df57d4">WINDEACTIVATE</a>;
<a name="l02906"></a>02906             <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l02907"></a>02907 
<a name="l02908"></a>02908             <span class="keywordflow">break</span>;
<a name="l02909"></a>02909             
<a name="l02910"></a>02910         }
<a name="l02911"></a>02911 
<a name="l02912"></a>02912     }
<a name="l02913"></a>02913 
<a name="l02914"></a>02914     <span class="comment">/* Handy when debugging checking events */</span>
<a name="l02915"></a>02915     <span class="comment">/* WM_event_print(&amp;event); */</span>
<a name="l02916"></a>02916 
<a name="l02917"></a>02917 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:04 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: BL_KetsjiEmbedStart.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">BL_KetsjiEmbedStart.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../df/d43/BL__KetsjiEmbedStart_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> * Blender&#39;s Ketsji startpoint</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(FREE_WINDOWS)</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="comment">// don&#39;t show stl-warnings</span>
<a name="l00040"></a>00040 <span class="preprocessor">#pragma warning (disable:4786)</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;GL/glew.h&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d77/KX__BlenderGL_8h.html">KX_BlenderGL.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd5/KX__BlenderCanvas_8h.html">KX_BlenderCanvas.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d99/KX__BlenderKeyboardDevice_8h.html">KX_BlenderKeyboardDevice.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d02/KX__BlenderMouseDevice_8h.html">KX_BlenderMouseDevice.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d11/KX__BlenderRenderTools_8h.html">KX_BlenderRenderTools.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d10/KX__BlenderSystem_8h.html" title="Blender System embedding. Needed when gameengine runs embedded within Blender.">KX_BlenderSystem.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4a/BL__Material_8h.html">BL_Material.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html">KX_KetsjiEngine.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc5/KX__BlenderSceneConverter_8h.html">KX_BlenderSceneConverter.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de4/KX__PythonInit_8h.html">KX_PythonInit.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d82/KX__PyConstraintBinding_8h.html">KX_PyConstraintBinding.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d21/RAS__GLExtensionManager_8h.html">RAS_GLExtensionManager.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de1/RAS__OpenGLRasterizer_8h.html">RAS_OpenGLRasterizer.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d87/RAS__VAOpenGLRasterizer_8h.html">RAS_VAOpenGLRasterizer.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8b/RAS__ListRasterizer_8h.html">RAS_ListRasterizer.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d28/NG__LoopBackNetworkDeviceInterface_8h.html" title="LoopbackNetworkDeviceInterface derived from NG_NetworkDeviceInterface.">NG_LoopBackNetworkDeviceInterface.h</a>&quot;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d4a/BL__System_8h.html">BL_System.h</a>&quot;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../da/deb/GPU__extensions_8h.html">GPU_extensions.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d8e/Value_8h.html">Value.h</a>&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00074"></a>00074 <span class="preprocessor">#endif</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>    <span class="comment">/***/</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html">DNA_view3d_types.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de4/DNA__userdef__types_8h.html">DNA_userdef_types.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html">DNA_windowmanager_types.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="comment">/* #include &quot;BKE_screen.h&quot; */</span> <span class="comment">/* cant include this because of &#39;new&#39; function name */</span>
<a name="l00083"></a>00083 <span class="keyword">extern</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/da3/BKE__screen_8h.html#ad44cf5c73ea1bdce9fd1010d755c8c9e">BKE_screen_view3d_zoom_to_fac</a>(<span class="keywordtype">float</span> camzoom);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">//XXX #include &quot;BIF_screen.h&quot;</span>
<a name="l00087"></a>00087 <span class="comment">//XXX #include &quot;BIF_scrarea.h&quot;</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d01/BLO__readfile_8h.html" title="external readfile function prototypes.">BLO_readfile.h</a>&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d48/BKE__ipo_8h.html">BKE_ipo.h</a>&quot;</span>
<a name="l00094"></a>00094     <span class="comment">/***/</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">//XXX #include &quot;BSE_headerbuttons.h&quot;</span>
<a name="l00097"></a>00097 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00098"></a>00098 <span class="preprocessor">#include &quot;../../blender/windowmanager/WM_types.h&quot;</span>
<a name="l00099"></a>00099 <span class="preprocessor">#include &quot;../../blender/windowmanager/wm_window.h&quot;</span>
<a name="l00100"></a>00100 <span class="preprocessor">#include &quot;../../blender/windowmanager/wm_event_system.h&quot;</span>
<a name="l00101"></a>00101 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>}
<a name="l00103"></a>00103 <span class="preprocessor">#endif</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a>00105 <span class="preprocessor">#ifdef WITH_AUDASPACE</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;<a class="code" href="../../da/d82/AUD__C-API_8h.html">AUD_C-API.h</a>&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#  include &quot;<a class="code" href="../../d2/d09/AUD__I3DDevice_8h.html">AUD_I3DDevice.h</a>&quot;</span>
<a name="l00108"></a>00108 <span class="preprocessor">#  include &quot;<a class="code" href="../../d7/d20/AUD__IDevice_8h.html">AUD_IDevice.h</a>&quot;</span>
<a name="l00109"></a>00109 <span class="preprocessor">#endif</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>
<a name="l00111"></a><a class="code" href="../../df/d43/BL__KetsjiEmbedStart_8cpp.html#aff6279ba2b07986ac5d2c71204615c28">00111</a> <span class="keyword">static</span> <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *<a class="code" href="../../df/d43/BL__KetsjiEmbedStart_8cpp.html#aff6279ba2b07986ac5d2c71204615c28">load_game_data</a>(<span class="keywordtype">char</span> *filename)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113     <a class="code" href="../../df/df0/structReportList.html">ReportList</a> reports;
<a name="l00114"></a>00114     <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd;
<a name="l00115"></a>00115     
<a name="l00116"></a>00116     <a class="code" href="../../d2/d40/BKE__report_8h.html#af5b01bb6a9ddfb55fadc44aee9a0d5a5">BKE_reports_init</a>(&amp;reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861aca8f7314453dc576fbdca03031b66430">RPT_STORE</a>);
<a name="l00117"></a>00117     bfd= <a class="code" href="../../da/d01/BLO__readfile_8h.html#ae5744dac8d441e0dcc0986765184f721">BLO_read_from_file</a>(filename, &amp;reports);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (!bfd) {
<a name="l00120"></a>00120         printf(<span class="stringliteral">&quot;Loading %s failed: &quot;</span>, filename);
<a name="l00121"></a>00121         <a class="code" href="../../d2/d40/BKE__report_8h.html#a205dcc4a8b9bd1f17b616909e2eeefc3">BKE_reports_print</a>(&amp;reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>);
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <a class="code" href="../../d2/d40/BKE__report_8h.html#aa126c5bc2c816eab9e77a6fc81d6baaa">BKE_reports_clear</a>(&amp;reports);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="keywordflow">return</span> bfd;
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a><a class="code" href="../../dc/d4a/BL__System_8h.html#a1fe14f4a94ae15f91f85c1899b9daef2">00129</a> <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="../../df/d43/BL__KetsjiEmbedStart_8cpp.html#a539ce6f7af15b10ce596073ac2c3eaca">StartKetsjiShell</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">struct</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *cam_frame, <span class="keywordtype">int</span> always_use_expand_framing)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131     <span class="comment">/* context values */</span>
<a name="l00132"></a>00132     <span class="keyword">struct </span><a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00133"></a>00133     <span class="keyword">struct </span><a class="code" href="../../d9/d27/structScene.html">Scene</a> *startscene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00134"></a>00134     <span class="keyword">struct </span><a class="code" href="../../d0/dc0/structMain.html">Main</a>* maggie1= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <a class="code" href="../../d9/d14/classRAS__Rect.html">RAS_Rect</a> area_rect;
<a name="l00138"></a>00138     area_rect.<a class="code" href="../../d9/d14/classRAS__Rect.html#a60769af413d5aa21953894d7f9f9a65b">SetLeft</a>(cam_frame-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>);
<a name="l00139"></a>00139     area_rect.<a class="code" href="../../d9/d14/classRAS__Rect.html#ad9ff07fd3b17ef8cb14b53ba6fde9ea1">SetBottom</a>(cam_frame-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00140"></a>00140     area_rect.<a class="code" href="../../d9/d14/classRAS__Rect.html#a856c8b0d6b0c9da7bad0ef488f0013c8">SetRight</a>(cam_frame-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>);
<a name="l00141"></a>00141     area_rect.<a class="code" href="../../d9/d14/classRAS__Rect.html#a28fc341abd84ddfab90457ba137368db">SetTop</a>(cam_frame-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="keywordtype">int</span> exitrequested = <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083aea0edd15c753e92d00ba3128d170fe3b">KX_EXIT_REQUEST_NO_REQUEST</a>;
<a name="l00144"></a>00144     <a class="code" href="../../d0/dc0/structMain.html">Main</a>* blenderdata = maggie1;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordtype">char</span>* startscenename = startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2;
<a name="l00147"></a>00147     <span class="keywordtype">char</span> pathname[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#af231ebb113f3f085906d83d6424abefb">FILE_MAXDIR</a>+<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a40b3bb1f7d7c8c9bbf4e0ed92564e73e">FILE_MAXFILE</a>], oldsce[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#af231ebb113f3f085906d83d6424abefb">FILE_MAXDIR</a>+<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a40b3bb1f7d7c8c9bbf4e0ed92564e73e">FILE_MAXFILE</a>];
<a name="l00148"></a>00148     <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a> exitstring = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00149"></a>00149     <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(pathname, blenderdata-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, <span class="keyword">sizeof</span>(pathname));
<a name="l00152"></a>00152     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(oldsce, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, <span class="keyword">sizeof</span>(oldsce));
<a name="l00153"></a>00153 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>    resetGamePythonPath(); <span class="comment">// need this so running a second time wont use an old blendfiles path</span>
<a name="l00155"></a>00155     setGamePythonPath(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="comment">// Acquire Python&#39;s GIL (global interpreter lock)</span>
<a name="l00158"></a>00158     <span class="comment">// so we can safely run Python code and API calls</span>
<a name="l00159"></a>00159     PyGILState_STATE gilstate = PyGILState_Ensure();
<a name="l00160"></a>00160     
<a name="l00161"></a>00161     PyObject *pyGlobalDict = PyDict_New(); <span class="comment">/* python utility storage, spans blend file loading */</span>
<a name="l00162"></a>00162 <span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>    
<a name="l00164"></a>00164     <a class="code" href="../../da/d4e/namespacebgl.html#ad5111b9c91366e314e0eadf9dcd227f4">bgl::InitExtensions</a>(<span class="keyword">true</span>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">// VBO code for derived mesh is not compatible with BGE (couldn&#39;t find why), so disable</span>
<a name="l00167"></a>00167     <span class="keywordtype">int</span> disableVBO = (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.gameflags &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a35658fa9236ac49f61aba961d3773b9b">USER_DISABLE_VBO</a>);
<a name="l00168"></a>00168     <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.gameflags |= <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a35658fa9236ac49f61aba961d3773b9b">USER_DISABLE_VBO</a>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="comment">// Globals to be carried on over blender files</span>
<a name="l00171"></a>00171     <a class="code" href="../../d5/d57/structGlobalSettings.html">GlobalSettings</a> gs;
<a name="l00172"></a>00172     gs.<a class="code" href="../../d5/d57/structGlobalSettings.html#a2d139d7e07c4f16ed22595501e97f891">matmode</a>= startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6cede4314df04c85946a10fbd7e109f0">matmode</a>;
<a name="l00173"></a>00173     gs.<a class="code" href="../../d5/d57/structGlobalSettings.html#a1f2c0520890ebe2d5e219962ada22af4">glslflag</a>= startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="keywordflow">do</span>
<a name="l00176"></a>00176     {
<a name="l00177"></a>00177         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C);
<a name="l00178"></a>00178         <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= <a class="code" href="../../df/d01/BKE__context_8h.html#af03543cb8e3fa2c39bb777962a6eae13">CTX_wm_region_view3d</a>(C);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">// get some preferences</span>
<a name="l00181"></a>00181         <a class="code" href="../../dc/d4a/BL__System_8h.html#a14ad21f63f97245f17d100854950b35d">SYS_SystemHandle</a> syshandle = <a class="code" href="../../d7/d58/BL__System_8cpp.html#a6d6d836bf4ccaeb2ba849cf528ddff32">SYS_GetSystem</a>();
<a name="l00182"></a>00182         <span class="keywordtype">bool</span> properties = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;show_properties&quot;</span>, 0) != 0);
<a name="l00183"></a>00183         <span class="keywordtype">bool</span> usefixed = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;fixedtime&quot;</span>, 0) != 0);
<a name="l00184"></a>00184         <span class="keywordtype">bool</span> profile = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;show_profile&quot;</span>, 0) != 0);
<a name="l00185"></a>00185         <span class="keywordtype">bool</span> frameRate = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;show_framerate&quot;</span>, 0) != 0);
<a name="l00186"></a>00186         <span class="keywordtype">bool</span> animation_record = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;animation_record&quot;</span>, 0) != 0);
<a name="l00187"></a>00187         <span class="keywordtype">bool</span> displaylists = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;displaylists&quot;</span>, 0) != 0);
<a name="l00188"></a>00188 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span>        <span class="keywordtype">bool</span> nodepwarnings = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;ignore_deprecation_warnings&quot;</span>, 0) != 0);
<a name="l00190"></a>00190 <span class="preprocessor">#endif</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>        <span class="keywordtype">bool</span> novertexarrays = (<a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle, <span class="stringliteral">&quot;novertexarrays&quot;</span>, 0) != 0);
<a name="l00192"></a>00192         <span class="keywordtype">bool</span> mouse_state = startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a531eb9d1f494e687b8a9e661ce798e33">GAME_SHOW_MOUSE</a>;
<a name="l00193"></a>00193         <span class="keywordtype">bool</span> restrictAnimFPS = startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#add2d3795424a51abb39ad0cc23e63e89">GAME_RESTRICT_ANIM_UPDATES</a>;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (animation_record) usefixed= <span class="keyword">false</span>; <span class="comment">/* override since you don&#39;t want to run full-speed for sim recording */</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         <span class="comment">// create the canvas, rasterizer and rendertools</span>
<a name="l00198"></a>00198         <a class="code" href="../../d5/df6/classRAS__ICanvas.html">RAS_ICanvas</a>* canvas = <span class="keyword">new</span> <a class="code" href="../../dc/d37/classKX__BlenderCanvas.html">KX_BlenderCanvas</a>(win, area_rect, ar);
<a name="l00199"></a>00199         
<a name="l00200"></a>00200         <span class="comment">// default mouse state set on render panel</span>
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (mouse_state)
<a name="l00202"></a>00202             canvas-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a471ed747fc3612c98d22948788740199">SetMouseState</a>(<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a058c226f33eba2d4b168c58808368cd6ad528b796eee76effea0d29c6e3623492">RAS_ICanvas::MOUSE_NORMAL</a>);
<a name="l00203"></a>00203         <span class="keywordflow">else</span>
<a name="l00204"></a>00204             canvas-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a471ed747fc3612c98d22948788740199">SetMouseState</a>(<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a058c226f33eba2d4b168c58808368cd6a02917735af02702e3698f94e10fccc05">RAS_ICanvas::MOUSE_INVISIBLE</a>);
<a name="l00205"></a>00205         <a class="code" href="../../d0/d53/classRAS__IRenderTools.html">RAS_IRenderTools</a>* rendertools = <span class="keyword">new</span> <a class="code" href="../../dd/dcf/classKX__BlenderRenderTools.html">KX_BlenderRenderTools</a>();
<a name="l00206"></a>00206         <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasterizer = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00207"></a>00207         
<a name="l00208"></a>00208         <span class="keywordflow">if</span> (displaylists) {
<a name="l00209"></a>00209             <span class="keywordflow">if</span> (GLEW_VERSION_1_1 &amp;&amp; !novertexarrays)
<a name="l00210"></a>00210                 rasterizer = <span class="keyword">new</span> <a class="code" href="../../d1/dcc/classRAS__ListRasterizer.html">RAS_ListRasterizer</a>(canvas, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00211"></a>00211             <span class="keywordflow">else</span>
<a name="l00212"></a>00212                 rasterizer = <span class="keyword">new</span> <a class="code" href="../../d1/dcc/classRAS__ListRasterizer.html">RAS_ListRasterizer</a>(canvas);
<a name="l00213"></a>00213         }
<a name="l00214"></a>00214         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GLEW_VERSION_1_1 &amp;&amp; !novertexarrays)
<a name="l00215"></a>00215             rasterizer = <span class="keyword">new</span> <a class="code" href="../../d9/dd2/classRAS__VAOpenGLRasterizer.html">RAS_VAOpenGLRasterizer</a>(canvas, <span class="keyword">false</span>);
<a name="l00216"></a>00216         <span class="keywordflow">else</span>
<a name="l00217"></a>00217             rasterizer = <span class="keyword">new</span> <a class="code" href="../../dd/d38/classRAS__OpenGLRasterizer.html">RAS_OpenGLRasterizer</a>(canvas);
<a name="l00218"></a>00218         
<a name="l00219"></a>00219         <span class="comment">// create the inputdevices</span>
<a name="l00220"></a>00220         <a class="code" href="../../d1/d7b/classKX__BlenderKeyboardDevice.html">KX_BlenderKeyboardDevice</a>* keyboarddevice = <span class="keyword">new</span> <a class="code" href="../../d1/d7b/classKX__BlenderKeyboardDevice.html">KX_BlenderKeyboardDevice</a>();
<a name="l00221"></a>00221         <a class="code" href="../../df/dc3/classKX__BlenderMouseDevice.html">KX_BlenderMouseDevice</a>* mousedevice = <span class="keyword">new</span> <a class="code" href="../../df/dc3/classKX__BlenderMouseDevice.html">KX_BlenderMouseDevice</a>();
<a name="l00222"></a>00222         
<a name="l00223"></a>00223         <span class="comment">// create a networkdevice</span>
<a name="l00224"></a>00224         <a class="code" href="../../d4/d8b/classNG__NetworkDeviceInterface.html">NG_NetworkDeviceInterface</a>* networkdevice = <span class="keyword">new</span>
<a name="l00225"></a>00225             <a class="code" href="../../d5/d59/classNG__LoopBackNetworkDeviceInterface.html">NG_LoopBackNetworkDeviceInterface</a>();
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="comment">//</span>
<a name="l00228"></a>00228         <span class="comment">// create a ketsji/blendersystem (only needed for timing and stuff)</span>
<a name="l00229"></a>00229         <a class="code" href="../../d6/dc2/classKX__BlenderSystem.html">KX_BlenderSystem</a>* kxsystem = <span class="keyword">new</span> <a class="code" href="../../d6/dc2/classKX__BlenderSystem.html">KX_BlenderSystem</a>();
<a name="l00230"></a>00230         
<a name="l00231"></a>00231         <span class="comment">// create the ketsjiengine</span>
<a name="l00232"></a>00232         <a class="code" href="../../db/dcd/classKX__KetsjiEngine.html">KX_KetsjiEngine</a>* ketsjiengine = <span class="keyword">new</span> <a class="code" href="../../db/dcd/classKX__KetsjiEngine.html">KX_KetsjiEngine</a>(kxsystem);
<a name="l00233"></a>00233         
<a name="l00234"></a>00234         <span class="comment">// set the devices</span>
<a name="l00235"></a>00235         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a2bae4db43489ef4d67c7e7b4502af415">SetKeyboardDevice</a>(keyboarddevice);
<a name="l00236"></a>00236         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a347dea69005cbef99c739e415d1505c0">SetMouseDevice</a>(mousedevice);
<a name="l00237"></a>00237         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ae346246360afb2b5d229f77c5151fead">SetNetworkDevice</a>(networkdevice);
<a name="l00238"></a>00238         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a1141f6c547f0e99c1d7d35c13d47eb01">SetCanvas</a>(canvas);
<a name="l00239"></a>00239         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#aca486c045b3474386d565a64ea0b0b87">SetRenderTools</a>(rendertools);
<a name="l00240"></a>00240         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#aec60727a6fa48bee1ab6346436a8fd81">SetRasterizer</a>(rasterizer);
<a name="l00241"></a>00241         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a5a288b4a7a7e8c3968b697cb33861d98">SetUseFixedTime</a>(usefixed);
<a name="l00242"></a>00242         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a6cbbff94b3698dccd3fae2cd473b30af">SetTimingDisplay</a>(frameRate, profile, properties);
<a name="l00243"></a>00243         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a23e7af7a55f0ce986617e85373a50e9b">SetRestrictAnimationFPS</a>(restrictAnimFPS);
<a name="l00244"></a>00244         <a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a1287643f2020f9f2ae5a03d8520f5520">KX_KetsjiEngine::SetExitKey</a>(<a class="code" href="../../d6/df2/BL__BlenderDataConversion_8cpp.html#ae2b32182320ed60b35a763383403fb91">ConvertKeyCode</a>(startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a2f6932759dc1dd4f11a97189aa38f088">exitkey</a>));
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="comment">//set the global settings (carried over if restart/load new files)</span>
<a name="l00247"></a>00247         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a842a36cadd6e436234a6933d3fd69118">SetGlobalSettings</a>(&amp;gs);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00250"></a>00250 <span class="preprocessor"></span>        CValue::SetDeprecationWarnings(nodepwarnings);
<a name="l00251"></a>00251 <span class="preprocessor">#endif</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>
<a name="l00253"></a>00253         <span class="comment">//lock frame and camera enabled - storing global values</span>
<a name="l00254"></a>00254         <span class="keywordtype">int</span> tmp_lay= startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a>;
<a name="l00255"></a>00255         <a class="code" href="../../de/de7/structObject.html">Object</a> *tmp_camera = startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a9b985c482e62755068cdd28ed0d50e50">scenelock</a>==0) {
<a name="l00258"></a>00258             startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a45ac0a23240ec719b0952d62190e9130">lay</a>;
<a name="l00259"></a>00259             startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>;
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         <span class="comment">// some blender stuff</span>
<a name="l00263"></a>00263         <span class="keywordtype">float</span> camzoom;
<a name="l00264"></a>00264         <span class="keywordtype">int</span> draw_letterbox = 0;
<a name="l00265"></a>00265         
<a name="l00266"></a>00266         <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>==<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a>) {
<a name="l00267"></a>00267             <span class="keywordflow">if</span> (startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a34977b1d08733c52f698196768472f8a">type</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac9999786bf7378a4a82b2836e906378c">SCE_GAMEFRAMING_BARS</a>) { <span class="comment">/* Letterbox */</span>
<a name="l00268"></a>00268                 camzoom = 1.0f;
<a name="l00269"></a>00269                 draw_letterbox = 1;
<a name="l00270"></a>00270             }
<a name="l00271"></a>00271             <span class="keywordflow">else</span> {
<a name="l00272"></a>00272                 camzoom = 1.0f / <a class="code" href="../../d7/da3/BKE__screen_8h.html#ad44cf5c73ea1bdce9fd1010d755c8c9e">BKE_screen_view3d_zoom_to_fac</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a9b348c353599b475e71f720ef3a0351f">camzoom</a>);
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275         <span class="keywordflow">else</span> {
<a name="l00276"></a>00276             camzoom = 2.0;
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#afa8fbc77da72254c67bd9f40deefbb54">SetDrawType</a>(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a>);
<a name="l00281"></a>00281         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ad1102ad9e8da40673ac6c763854bf7a9">SetCameraZoom</a>(camzoom);
<a name="l00282"></a>00282         
<a name="l00283"></a>00283         <span class="comment">// if we got an exitcode 3 (KX_EXIT_REQUEST_START_OTHER_GAME) load a different file</span>
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (exitrequested == <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083adb487890d2ead15a16e6a1cc0a0bbb2c">KX_EXIT_REQUEST_START_OTHER_GAME</a> || exitrequested == <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083a20e4bc6912f6ec1a57cd2919241663ef">KX_EXIT_REQUEST_RESTART_GAME</a>)
<a name="l00285"></a>00285         {
<a name="l00286"></a>00286             exitrequested = <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083aea0edd15c753e92d00ba3128d170fe3b">KX_EXIT_REQUEST_NO_REQUEST</a>;
<a name="l00287"></a>00287             <span class="keywordflow">if</span> (bfd) <a class="code" href="../../da/d01/BLO__readfile_8h.html#afc5520463f861111b0e51e2613bdab3d">BLO_blendfiledata_free</a>(bfd);
<a name="l00288"></a>00288             
<a name="l00289"></a>00289             <span class="keywordtype">char</span> basedpath[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00290"></a>00290             <span class="comment">// base the actuator filename with respect</span>
<a name="l00291"></a>00291             <span class="comment">// to the original file working directory</span>
<a name="l00292"></a>00292 
<a name="l00293"></a>00293             <span class="keywordflow">if</span> (exitstring != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00294"></a>00294                 strcpy(basedpath, exitstring.<a class="code" href="../../d6/dce/classSTR__String.html#afeffc6dcb168d23d9c821890f7d92b3d">Ptr</a>());
<a name="l00295"></a>00295 
<a name="l00296"></a>00296             <span class="comment">// load relative to the last loaded file, this used to be relative</span>
<a name="l00297"></a>00297             <span class="comment">// to the first file but that makes no sense, relative paths in</span>
<a name="l00298"></a>00298             <span class="comment">// blend files should be relative to that file, not some other file</span>
<a name="l00299"></a>00299             <span class="comment">// that happened to be loaded first</span>
<a name="l00300"></a>00300             <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(basedpath, pathname);
<a name="l00301"></a>00301             bfd = <a class="code" href="../../df/d43/BL__KetsjiEmbedStart_8cpp.html#aff6279ba2b07986ac5d2c71204615c28">load_game_data</a>(basedpath);
<a name="l00302"></a>00302             
<a name="l00303"></a>00303             <span class="comment">// if it wasn&#39;t loaded, try it forced relative</span>
<a name="l00304"></a>00304             <span class="keywordflow">if</span> (!bfd)
<a name="l00305"></a>00305             {
<a name="l00306"></a>00306                 <span class="comment">// just add &quot;//&quot; in front of it</span>
<a name="l00307"></a>00307                 <span class="keywordtype">char</span> temppath[242];
<a name="l00308"></a>00308                 strcpy(temppath, <span class="stringliteral">&quot;//&quot;</span>);
<a name="l00309"></a>00309                 strcat(temppath, basedpath);
<a name="l00310"></a>00310                 
<a name="l00311"></a>00311                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(temppath, pathname);
<a name="l00312"></a>00312                 bfd = <a class="code" href="../../df/d43/BL__KetsjiEmbedStart_8cpp.html#aff6279ba2b07986ac5d2c71204615c28">load_game_data</a>(temppath);
<a name="l00313"></a>00313             }
<a name="l00314"></a>00314             
<a name="l00315"></a>00315             <span class="comment">// if we got a loaded blendfile, proceed</span>
<a name="l00316"></a>00316             <span class="keywordflow">if</span> (bfd)
<a name="l00317"></a>00317             {
<a name="l00318"></a>00318                 blenderdata = bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>;
<a name="l00319"></a>00319                 startscenename = bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> + 2;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321                 <span class="keywordflow">if</span> (blenderdata) {
<a name="l00322"></a>00322                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, blenderdata-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name));
<a name="l00323"></a>00323                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(pathname, blenderdata-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, <span class="keyword">sizeof</span>(pathname));
<a name="l00324"></a>00324 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>                    setGamePythonPath(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00326"></a>00326 <span class="preprocessor">#endif</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>                }
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329             <span class="comment">// else forget it, we can&#39;t find it</span>
<a name="l00330"></a>00330             <span class="keywordflow">else</span>
<a name="l00331"></a>00331             {
<a name="l00332"></a>00332                 exitrequested = <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083a0694a1c5365a51e80152e3ea391d6d09">KX_EXIT_REQUEST_QUIT_GAME</a>;
<a name="l00333"></a>00333             }
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>= bfd ? bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a> : (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a07f40c87b9211c9d5fef01d4a4e9054d">BLI_findstring</a>(&amp;blenderdata-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>, startscenename, offsetof(<a class="code" href="../../d8/d7e/structID.html">ID</a>, <a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>) + 2);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (scene)
<a name="l00339"></a>00339         {
<a name="l00340"></a>00340             <span class="keywordtype">int</span> startFrame = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l00341"></a>00341             ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a5cf5c44909225aa16bb56412892a60a0">SetAnimRecordMode</a>(animation_record, startFrame);
<a name="l00342"></a>00342             
<a name="l00343"></a>00343             <span class="comment">// Quad buffered needs a special window.</span>
<a name="l00344"></a>00344             <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ac2cf122f92bac27e00590265209d6e58">stereoflag</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a04acbf84fc1ebc7753e9e70d7e20574b">STEREO_ENABLED</a>) {
<a name="l00345"></a>00345                 <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a> != <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a40a4df42bdb050d883d4ff0a40558dc8ad1d61a9957252a54bcfb0372a9e41d04">RAS_IRasterizer::RAS_STEREO_QUADBUFFERED</a>)
<a name="l00346"></a>00346                     rasterizer-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1938989a3e96dfff9a57b61c9ab8d668">SetStereoMode</a>((<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a40a4df42bdb050d883d4ff0a40558dc8">RAS_IRasterizer::StereoMode</a>) scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a>);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348                 rasterizer-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#aa2a3d9b3a11b2d1cf1e4abab5a135266">SetEyeSeparation</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6753d20785372215b27ee4598a779563">eyeseparation</a>);
<a name="l00349"></a>00349             }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351             rasterizer-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a2e3813ecb2c9e1a393b99e8095d380ee">SetBackColor</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a8615a14326b7510d84c4055c66f3db22">col</a>[0], scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a8615a14326b7510d84c4055c66f3db22">col</a>[1], scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a8615a14326b7510d84c4055c66f3db22">col</a>[2], 0.0f);
<a name="l00352"></a>00352         }
<a name="l00353"></a>00353         
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (exitrequested != <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083a0694a1c5365a51e80152e3ea391d6d09">KX_EXIT_REQUEST_QUIT_GAME</a>)
<a name="l00355"></a>00355         {
<a name="l00356"></a>00356             <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a>)
<a name="l00357"></a>00357             {
<a name="l00358"></a>00358                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a1eee9342d78fd026cd41c79c94bfc977">EnableCameraOverride</a>(startscenename);
<a name="l00359"></a>00359                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ae7bf872724b6fcb9eef44ecbe4464756">SetCameraOverrideUseOrtho</a>((rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#af086af25ae5c28a12be8eb6f7687c6dd">RV3D_ORTHO</a>));
<a name="l00360"></a>00360                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#abdc7d0e8a5ea5da242f0d03d709ce801">SetCameraOverrideProjectionMatrix</a>(<a class="code" href="../../d5/de3/classMT__CmMatrix4x4.html">MT_CmMatrix4x4</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#af0a3443cecc10c7a942137d9d234af6f">winmat</a>));
<a name="l00361"></a>00361                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ac45c67dd3d4fafb8238ded6b3a71a4ac">SetCameraOverrideViewMatrix</a>(<a class="code" href="../../d5/de3/classMT__CmMatrix4x4.html">MT_CmMatrix4x4</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>));
<a name="l00362"></a>00362                 <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#af086af25ae5c28a12be8eb6f7687c6dd">RV3D_ORTHO</a>)
<a name="l00363"></a>00363                 {
<a name="l00364"></a>00364                     ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a81622e15798e4b9956214e0939de0d76">SetCameraOverrideClipping</a>(-v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#af51cbdca30d806138c2b3a734b4df2b5">far</a>, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#af51cbdca30d806138c2b3a734b4df2b5">far</a>);
<a name="l00365"></a>00365                 }
<a name="l00366"></a>00366                 <span class="keywordflow">else</span>
<a name="l00367"></a>00367                 {
<a name="l00368"></a>00368                     ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a81622e15798e4b9956214e0939de0d76">SetCameraOverrideClipping</a>(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aba3819f92b7807dcb98e1bc8605be7cb">near</a>, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#af51cbdca30d806138c2b3a734b4df2b5">far</a>);
<a name="l00369"></a>00369                 }
<a name="l00370"></a>00370                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a3f8d10277d9e0e02838b1f4587882494">SetCameraOverrideLens</a>(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a11bb79c913de7b38d21b9a3bece7c767">lens</a>);
<a name="l00371"></a>00371             }
<a name="l00372"></a>00372             
<a name="l00373"></a>00373             <span class="comment">// create a scene converter, create and convert the startingscene</span>
<a name="l00374"></a>00374             <a class="code" href="../../d7/dfb/classKX__ISceneConverter.html">KX_ISceneConverter</a>* sceneconverter = <span class="keyword">new</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html">KX_BlenderSceneConverter</a>(blenderdata, ketsjiengine);
<a name="l00375"></a>00375             ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#aa7fe8015e2c9ad861445cfef78b3d56b">SetSceneConverter</a>(sceneconverter);
<a name="l00376"></a>00376             sceneconverter-&gt;<a class="code" href="../../d7/dfb/classKX__ISceneConverter.html#a876fa6054861347717b258b80dcdb85a">addInitFromFrame</a>=<span class="keyword">false</span>;
<a name="l00377"></a>00377             <span class="keywordflow">if</span> (always_use_expand_framing)
<a name="l00378"></a>00378                 sceneconverter-&gt;<a class="code" href="../../d7/dfb/classKX__ISceneConverter.html#ae8e4d0f53a65bd6223b246179d2a1880">SetAlwaysUseExpandFraming</a>(<span class="keyword">true</span>);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380             <span class="keywordtype">bool</span> usemat = <span class="keyword">false</span>, useglslmat = <span class="keyword">false</span>;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382             <span class="keywordflow">if</span> (GLEW_ARB_multitexture &amp;&amp; GLEW_VERSION_1_1)
<a name="l00383"></a>00383                 usemat = <span class="keyword">true</span>;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385             <span class="keywordflow">if</span> (<a class="code" href="../../da/deb/GPU__extensions_8h.html#a6fb5a77a1e2ad67b049c9ffa2d59e5f2">GPU_glsl_support</a>())
<a name="l00386"></a>00386                 useglslmat = <span class="keyword">true</span>;
<a name="l00387"></a>00387             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gs.<a class="code" href="../../d5/d57/structGlobalSettings.html#a2d139d7e07c4f16ed22595501e97f891">matmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a488f8a5dafd4bf3954c021a5a9ffecc6">GAME_MAT_GLSL</a>)
<a name="l00388"></a>00388                 usemat = <span class="keyword">false</span>;
<a name="l00389"></a>00389 
<a name="l00390"></a>00390             <span class="keywordflow">if</span> (usemat &amp;&amp; (gs.<a class="code" href="../../d5/d57/structGlobalSettings.html#a2d139d7e07c4f16ed22595501e97f891">matmode</a> != <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac0494c33e52af8307259b23830a6d918">GAME_MAT_TEXFACE</a>))
<a name="l00391"></a>00391                 sceneconverter-&gt;<a class="code" href="../../d7/dfb/classKX__ISceneConverter.html#a0b71c9301e13aab64d19cf3cc150c5c8">SetMaterials</a>(<span class="keyword">true</span>);
<a name="l00392"></a>00392             <span class="keywordflow">if</span> (useglslmat &amp;&amp; (gs.<a class="code" href="../../d5/d57/structGlobalSettings.html#a2d139d7e07c4f16ed22595501e97f891">matmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a488f8a5dafd4bf3954c021a5a9ffecc6">GAME_MAT_GLSL</a>))
<a name="l00393"></a>00393                 sceneconverter-&gt;<a class="code" href="../../d7/dfb/classKX__ISceneConverter.html#ac561f6ced82850b2b20ca1d96d8b247f">SetGLSLMaterials</a>(<span class="keyword">true</span>);
<a name="l00394"></a>00394                     
<a name="l00395"></a>00395             <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* startscene = <span class="keyword">new</span> <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>(keyboarddevice,
<a name="l00396"></a>00396                 mousedevice,
<a name="l00397"></a>00397                 networkdevice,
<a name="l00398"></a>00398                 startscenename,
<a name="l00399"></a>00399                 scene,
<a name="l00400"></a>00400                 canvas);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span>            <span class="comment">// some python things</span>
<a name="l00404"></a>00404             PyObject *gameLogic, *gameLogic_keys;
<a name="l00405"></a>00405             setupGamePython(ketsjiengine, startscene, blenderdata, pyGlobalDict, &amp;gameLogic, &amp;gameLogic_keys, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00406"></a>00406 <span class="preprocessor">#endif // WITH_PYTHON</span>
<a name="l00407"></a>00407 <span class="preprocessor"></span>
<a name="l00408"></a>00408             <span class="comment">//initialize Dome Settings</span>
<a name="l00409"></a>00409             <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ac2cf122f92bac27e00590265209d6e58">stereoflag</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a05deaaea1e95267145eb91590f3e26d5">STEREO_DOME</a>)
<a name="l00410"></a>00410                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a2f19dce7d590372130e8aa9a86047a32" title="Dome functions.">InitDome</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#acd7cb7ca7c8b775320f4c2736afefc67">res</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a9f8ab404d203646e515e256f9aaae20a">mode</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a73bc19da37560a524ede1435ab9f3a64">angle</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a0580190e61baa3d56f1cb4b57a68b032">resbuf</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a0ffd41b1ff60a6db279a7adf0b4d6bc3">tilt</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a66ee375e57bb5216b7317965976aaadf">warptext</a>);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412             <span class="comment">// initialize 3D Audio Settings</span>
<a name="l00413"></a>00413             <a class="code" href="../../dd/d01/classAUD__I3DDevice.html">AUD_I3DDevice</a>* dev = <a class="code" href="../../d3/ddf/AUD__C-API_8cpp.html#a8d4184e307ebb5fce5765ea8d6b709aa">AUD_get3DDevice</a>();
<a name="l00414"></a>00414             <span class="keywordflow">if</span> (dev)
<a name="l00415"></a>00415             {
<a name="l00416"></a>00416                 dev-&gt;<a class="code" href="../../dd/d01/classAUD__I3DDevice.html#a72282fc48b6cd96174bb58ad1b2e56dc">setSpeedOfSound</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a9ea9a0d7307a8c05e8428a8e5656240f">speed_of_sound</a>);
<a name="l00417"></a>00417                 dev-&gt;<a class="code" href="../../dd/d01/classAUD__I3DDevice.html#ac216f029cb54911deda7716b5c2c3981">setDopplerFactor</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a6dd724c9a669d3564bbe354c091eb82b">doppler_factor</a>);
<a name="l00418"></a>00418                 dev-&gt;<a class="code" href="../../dd/d01/classAUD__I3DDevice.html#a513f6f203cc5425d0932d9b4f85fd27a">setDistanceModel</a>(<a class="code" href="../../da/dbe/AUD__Space_8h.html#a141fdd831b085fad6a6f8927990970ac" title="Possible distance models for the 3D device.">AUD_DistanceModel</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a7a974ec87d9bd47263b8d5fc8f06eea9">distance_model</a>));
<a name="l00419"></a>00419             }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421             <span class="comment">// from see blender.c:</span>
<a name="l00422"></a>00422             <span class="comment">// FIXME: this version patching should really be part of the file-reading code,</span>
<a name="l00423"></a>00423             <span class="comment">// but we still get too many unrelated data-corruption crashes otherwise...</span>
<a name="l00424"></a>00424             <span class="keywordflow">if</span> (blenderdata-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250)
<a name="l00425"></a>00425                 <a class="code" href="../../db/d48/BKE__ipo_8h.html#aa3fcf10503e305a71e9df87ff61e8bab">do_versions_ipos_to_animato</a>(blenderdata);
<a name="l00426"></a>00426 
<a name="l00427"></a>00427             <span class="keywordflow">if</span> (sceneconverter)
<a name="l00428"></a>00428             {
<a name="l00429"></a>00429                 <span class="comment">// convert and add scene</span>
<a name="l00430"></a>00430                 sceneconverter-&gt;<a class="code" href="../../d7/dfb/classKX__ISceneConverter.html#a65fe00e4cea8491de8c21de3fd498766">ConvertScene</a>(
<a name="l00431"></a>00431                     startscene,
<a name="l00432"></a>00432                     rendertools,
<a name="l00433"></a>00433                     canvas);
<a name="l00434"></a>00434                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a2d9a0ae59fdcaff814f06f6ca3caa6b1">AddScene</a>(startscene);
<a name="l00435"></a>00435                 
<a name="l00436"></a>00436                 <span class="comment">// init the rasterizer</span>
<a name="l00437"></a>00437                 rasterizer-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a4eb5bdfd41c06d9e882f914479a70fd2">Init</a>();
<a name="l00438"></a>00438                 
<a name="l00439"></a>00439                 <span class="comment">// start the engine</span>
<a name="l00440"></a>00440                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#adb06ae66bcfe292769e1b6022b11b077">StartEngine</a>(<span class="keyword">true</span>);
<a name="l00441"></a>00441                 
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                 <span class="comment">// Set the animation playback rate for ipo&#39;s and actions</span>
<a name="l00444"></a>00444                 <span class="comment">// the framerate below should patch with FPS macro defined in blendef.h</span>
<a name="l00445"></a>00445                 <span class="comment">// Could be in StartEngine set the framerate, we need the scene to do this</span>
<a name="l00446"></a>00446                 ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#afccb078e7e0f7eae07b9c7dbf74fb54f">SetAnimFrameRate</a>(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>);
<a name="l00447"></a>00447                 
<a name="l00448"></a>00448                 <span class="comment">// the mainloop</span>
<a name="l00449"></a>00449                 printf(<span class="stringliteral">&quot;\nBlender Game Engine Started\n&quot;</span>);
<a name="l00450"></a>00450                 <span class="keywordflow">while</span> (!exitrequested)
<a name="l00451"></a>00451                 {
<a name="l00452"></a>00452                     <span class="comment">// first check if we want to exit</span>
<a name="l00453"></a>00453                     exitrequested = ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#aabc78f9942fdb5d026961e5724307fcd">GetExitCode</a>();
<a name="l00454"></a>00454                     
<a name="l00455"></a>00455                     <span class="comment">// kick the engine</span>
<a name="l00456"></a>00456                     <span class="keywordtype">bool</span> render = ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a2d4e91f2534f4682f6cd114e9b9e6378" title="returns true if an update happened to indicate -&gt; Render">NextFrame</a>();
<a name="l00457"></a>00457                     
<a name="l00458"></a>00458                     <span class="keywordflow">if</span> (render)
<a name="l00459"></a>00459                     {
<a name="l00460"></a>00460                         <span class="keywordflow">if</span> (draw_letterbox) {
<a name="l00461"></a>00461                             <span class="comment">// Clear screen to border color</span>
<a name="l00462"></a>00462                             <span class="comment">// We do this here since we set the canvas to be within the frames. This means the engine</span>
<a name="l00463"></a>00463                             <span class="comment">// itself is unaware of the extra space, so we clear the whole region for it.</span>
<a name="l00464"></a>00464                             glClearColor(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a8615a14326b7510d84c4055c66f3db22">col</a>[0], scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a8615a14326b7510d84c4055c66f3db22">col</a>[1], scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a>.<a class="code" href="../../d2/d08/structGameFraming.html#a8615a14326b7510d84c4055c66f3db22">col</a>[2], 1.0f);
<a name="l00465"></a>00465                             glViewport(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>,
<a name="l00466"></a>00466                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00467"></a>00467                             glClear(GL_COLOR_BUFFER_BIT);
<a name="l00468"></a>00468                         }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                         <span class="comment">// render the frame</span>
<a name="l00471"></a>00471                         ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a74b4f809edf5287401c6e47ec56d8202">Render</a>();
<a name="l00472"></a>00472                     }
<a name="l00473"></a>00473                     
<a name="l00474"></a>00474                     <a class="code" href="../../d7/d6e/wm__window_8c.html#a9f47df4134fc0a4a009014a2626543b5">wm_window_process_events_nosleep</a>();
<a name="l00475"></a>00475                     
<a name="l00476"></a>00476                     <span class="comment">// test for the ESC key</span>
<a name="l00477"></a>00477                     <span class="comment">//XXX while (qtest())</span>
<a name="l00478"></a>00478                     <span class="keywordflow">while</span>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event= (<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *)win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l00479"></a>00479                     {
<a name="l00480"></a>00480                         <span class="keywordtype">short</span> val = 0;
<a name="l00481"></a>00481                         <span class="comment">//unsigned short event = 0; //XXX extern_qread(&amp;val);</span>
<a name="l00482"></a>00482                         
<a name="l00483"></a>00483                         <span class="keywordflow">if</span> (keyboarddevice-&gt;<a class="code" href="../../d1/d7b/classKX__BlenderKeyboardDevice.html#acc48d481527d8cce716ec9e1e002f0cf">ConvertBlenderEvent</a>(event-&gt;type,event-&gt;val))
<a name="l00484"></a>00484                             exitrequested = <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083a3358d217ee3c28544b28906f8052f134">KX_EXIT_REQUEST_BLENDER_ESC</a>;
<a name="l00485"></a>00485                         
<a name="l00486"></a>00486                             <span class="comment">/* Coordinate conversion... where</span>
<a name="l00487"></a>00487 <span class="comment">                            * should this really be?</span>
<a name="l00488"></a>00488 <span class="comment">                        */</span>
<a name="l00489"></a>00489                         <span class="keywordflow">if</span> (event-&gt;type==<a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l00490"></a>00490                             <span class="comment">/* Note, not nice! XXX 2.5 event hack */</span>
<a name="l00491"></a>00491                             val = <span class="keyword">event</span>-&gt;x - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00492"></a>00492                             mousedevice-&gt;<a class="code" href="../../df/dc3/classKX__BlenderMouseDevice.html#adda729b654f9972af119c98797a7eb6d">ConvertBlenderEvent</a>(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a463b518d1bb06480753f0ce4eec9744c">MOUSEX</a>, val);
<a name="l00493"></a>00493                             
<a name="l00494"></a>00494                             val = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a> - (<span class="keyword">event</span>-&gt;y - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>) - 1;
<a name="l00495"></a>00495                             mousedevice-&gt;<a class="code" href="../../df/dc3/classKX__BlenderMouseDevice.html#adda729b654f9972af119c98797a7eb6d">ConvertBlenderEvent</a>(<a class="code" href="../../d1/d40/wm__event__types_8h.html#afa852cd657d63f893daafc3cc8787cd5">MOUSEY</a>, val);
<a name="l00496"></a>00496                         }
<a name="l00497"></a>00497                         <span class="keywordflow">else</span> {
<a name="l00498"></a>00498                             mousedevice-&gt;<a class="code" href="../../df/dc3/classKX__BlenderMouseDevice.html#adda729b654f9972af119c98797a7eb6d">ConvertBlenderEvent</a>(event-&gt;type,event-&gt;val);
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                         
<a name="l00501"></a>00501                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>, event);
<a name="l00502"></a>00502                         <a class="code" href="../../df/db0/wm__event__system_8c.html#ac9182bd2ae46daa1aab656d70edfd12f">wm_event_free</a>(event);
<a name="l00503"></a>00503                     }
<a name="l00504"></a>00504                     
<a name="l00505"></a>00505                     <span class="keywordflow">if</span> (win != <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C)) {
<a name="l00506"></a>00506                         exitrequested= <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083ae3d3fbdf6d1864d2d436055293d12032">KX_EXIT_REQUEST_OUTSIDE</a>; <span class="comment">/* window closed while bge runs */</span>
<a name="l00507"></a>00507                     }
<a name="l00508"></a>00508                 }
<a name="l00509"></a>00509                 printf(<span class="stringliteral">&quot;Blender Game Engine Finished\n&quot;</span>);
<a name="l00510"></a>00510                 exitstring = ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a443f1d7b437a08764220dec4b8497a92">GetExitString</a>();
<a name="l00511"></a>00511                 gs = *(ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a1593fce61e739ed329adae3a00eed9ec">GetGlobalSettings</a>());
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 
<a name="l00514"></a>00514                 <span class="comment">// when exiting the mainloop</span>
<a name="l00515"></a>00515 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00516"></a>00516 <span class="preprocessor"></span>                <span class="comment">// Clears the dictionary by hand:</span>
<a name="l00517"></a>00517                 <span class="comment">// This prevents, extra references to global variables</span>
<a name="l00518"></a>00518                 <span class="comment">// inside the GameLogic dictionary when the python interpreter is finalized.</span>
<a name="l00519"></a>00519                 <span class="comment">// which allows the scene to safely delete them :)</span>
<a name="l00520"></a>00520                 <span class="comment">// see: (space.c)-&gt;start_game</span>
<a name="l00521"></a>00521                 
<a name="l00522"></a>00522                 <span class="comment">//PyDict_Clear(PyModule_GetDict(gameLogic));</span>
<a name="l00523"></a>00523                 
<a name="l00524"></a>00524                 <span class="comment">// Keep original items, means python plugins will autocomplete members</span>
<a name="l00525"></a>00525                 PyObject *gameLogic_keys_new = PyDict_Keys(PyModule_GetDict(gameLogic));
<a name="l00526"></a>00526                 <span class="keyword">const</span> Py_ssize_t numitems= PyList_GET_SIZE(gameLogic_keys_new);
<a name="l00527"></a>00527                 Py_ssize_t listIndex;
<a name="l00528"></a>00528                 <span class="keywordflow">for</span> (listIndex=0; listIndex &lt; numitems; listIndex++)  {
<a name="l00529"></a>00529                     PyObject* item = PyList_GET_ITEM(gameLogic_keys_new, listIndex);
<a name="l00530"></a>00530                     <span class="keywordflow">if</span> (!PySequence_Contains(gameLogic_keys, item)) {
<a name="l00531"></a>00531                         PyDict_DelItem( PyModule_GetDict(gameLogic), item);
<a name="l00532"></a>00532                     }
<a name="l00533"></a>00533                 }
<a name="l00534"></a>00534                 Py_DECREF(gameLogic_keys_new);
<a name="l00535"></a>00535                 gameLogic_keys_new = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00536"></a>00536 <span class="preprocessor">#endif</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span>                ketsjiengine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a76da8c473ed3da6ed063b160deef8ec4">StopEngine</a>();
<a name="l00538"></a>00538 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span>                exitGamePythonScripting();
<a name="l00540"></a>00540 <span class="preprocessor">#endif</span>
<a name="l00541"></a>00541 <span class="preprocessor"></span>                networkdevice-&gt;<a class="code" href="../../d4/d8b/classNG__NetworkDeviceInterface.html#a2f95d130bfac029101dc0082a8005964">Disconnect</a>();
<a name="l00542"></a>00542             }
<a name="l00543"></a>00543             <span class="keywordflow">if</span> (sceneconverter)
<a name="l00544"></a>00544             {
<a name="l00545"></a>00545                 <span class="keyword">delete</span> sceneconverter;
<a name="l00546"></a>00546                 sceneconverter = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00547"></a>00547             }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00550"></a>00550 <span class="preprocessor"></span>            Py_DECREF(gameLogic_keys);
<a name="l00551"></a>00551             gameLogic_keys = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00552"></a>00552 <span class="preprocessor">#endif</span>
<a name="l00553"></a>00553 <span class="preprocessor"></span>        }
<a name="l00554"></a>00554         <span class="comment">//lock frame and camera enabled - restoring global values</span>
<a name="l00555"></a>00555         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a9b985c482e62755068cdd28ed0d50e50">scenelock</a>==0) {
<a name="l00556"></a>00556             startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a>= tmp_lay;
<a name="l00557"></a>00557             startscene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>= tmp_camera;
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <span class="keywordflow">if</span> (exitrequested != <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083ae3d3fbdf6d1864d2d436055293d12032">KX_EXIT_REQUEST_OUTSIDE</a>)
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562             <span class="comment">// set the cursor back to normal</span>
<a name="l00563"></a>00563             canvas-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a471ed747fc3612c98d22948788740199">SetMouseState</a>(<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a058c226f33eba2d4b168c58808368cd6ad528b796eee76effea0d29c6e3623492">RAS_ICanvas::MOUSE_NORMAL</a>);
<a name="l00564"></a>00564         }
<a name="l00565"></a>00565         
<a name="l00566"></a>00566         <span class="comment">// clean up some stuff</span>
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (ketsjiengine)
<a name="l00568"></a>00568         {
<a name="l00569"></a>00569             <span class="keyword">delete</span> ketsjiengine;
<a name="l00570"></a>00570             ketsjiengine = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572         <span class="keywordflow">if</span> (kxsystem)
<a name="l00573"></a>00573         {
<a name="l00574"></a>00574             <span class="keyword">delete</span> kxsystem;
<a name="l00575"></a>00575             kxsystem = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         <span class="keywordflow">if</span> (networkdevice)
<a name="l00578"></a>00578         {
<a name="l00579"></a>00579             <span class="keyword">delete</span> networkdevice;
<a name="l00580"></a>00580             networkdevice = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582         <span class="keywordflow">if</span> (keyboarddevice)
<a name="l00583"></a>00583         {
<a name="l00584"></a>00584             <span class="keyword">delete</span> keyboarddevice;
<a name="l00585"></a>00585             keyboarddevice = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (mousedevice)
<a name="l00588"></a>00588         {
<a name="l00589"></a>00589             <span class="keyword">delete</span> mousedevice;
<a name="l00590"></a>00590             mousedevice = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592         <span class="keywordflow">if</span> (rasterizer)
<a name="l00593"></a>00593         {
<a name="l00594"></a>00594             <span class="keyword">delete</span> rasterizer;
<a name="l00595"></a>00595             rasterizer = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597         <span class="keywordflow">if</span> (rendertools)
<a name="l00598"></a>00598         {
<a name="l00599"></a>00599             <span class="keyword">delete</span> rendertools;
<a name="l00600"></a>00600             rendertools = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00601"></a>00601         }
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (canvas)
<a name="l00603"></a>00603         {
<a name="l00604"></a>00604             <span class="keyword">delete</span> canvas;
<a name="l00605"></a>00605             canvas = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608         <span class="comment">// stop all remaining playing sounds</span>
<a name="l00609"></a>00609         <a class="code" href="../../d3/ddf/AUD__C-API_8cpp.html#a9e06d17c68309a67d290549ce3eec9de">AUD_getDevice</a>()-&gt;stopAll();
<a name="l00610"></a>00610     
<a name="l00611"></a>00611     } <span class="keywordflow">while</span> (exitrequested == <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083a20e4bc6912f6ec1a57cd2919241663ef">KX_EXIT_REQUEST_RESTART_GAME</a> || exitrequested == <a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html#af64b3e15210953e83ae987670565f083adb487890d2ead15a16e6a1cc0a0bbb2c">KX_EXIT_REQUEST_START_OTHER_GAME</a>);
<a name="l00612"></a>00612     
<a name="l00613"></a>00613     <span class="keywordflow">if</span> (!disableVBO)
<a name="l00614"></a>00614         <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.gameflags &amp;= ~<a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a35658fa9236ac49f61aba961d3773b9b">USER_DISABLE_VBO</a>;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <span class="keywordflow">if</span> (bfd) <a class="code" href="../../da/d01/BLO__readfile_8h.html#afc5520463f861111b0e51e2613bdab3d">BLO_blendfiledata_free</a>(bfd);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, oldsce, <span class="keyword">sizeof</span>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name));
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00621"></a>00621 <span class="preprocessor"></span>    Py_DECREF(pyGlobalDict);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="comment">// Release Python&#39;s GIL</span>
<a name="l00624"></a>00624     PyGILState_Release(gilstate);
<a name="l00625"></a>00625 <span class="preprocessor">#endif</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>
<a name="l00627"></a>00627 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:02 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

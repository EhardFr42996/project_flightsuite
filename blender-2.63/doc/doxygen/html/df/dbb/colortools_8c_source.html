<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: colortools.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">colortools.c</div>  </div>
</div>
<div class="contents">
<a href="../../df/dbb/colortools_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2005 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL/BL DUAL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../da/ddd/DNA__color__types_8h.html">DNA_color_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html">DNA_curve_types.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dca/BKE__colortools_8h.html">BKE_colortools.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dfc/BKE__curve_8h.html">BKE_curve.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">/* ********************************* color curve ********************* */</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/* ***************** operations on full struct ************* */</span>
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="../../df/dbb/colortools_8c.html#a03b38182cdde8c2600247e4cc7582f37">00059</a> <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *<a class="code" href="../../d4/dca/BKE__colortools_8h.html#a0fe6bbbc391a99f155add4272972ba6d">curvemapping_add</a>(<span class="keywordtype">int</span> tot, <span class="keywordtype">float</span> minx, <span class="keywordtype">float</span> miny, <span class="keywordtype">float</span> maxx, <span class="keywordtype">float</span> maxy)
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061     <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap;
<a name="l00062"></a>00062     <span class="keywordtype">int</span> a;
<a name="l00063"></a>00063     <span class="keywordtype">float</span> clipminx, clipminy, clipmaxx, clipmaxy;
<a name="l00064"></a>00064     
<a name="l00065"></a>00065     cumap= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a>), <span class="stringliteral">&quot;new curvemap&quot;</span>);
<a name="l00066"></a>00066     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a>= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a8649d5f9bc9f67e68cf78ffaa5b8695b">CUMA_DO_CLIP</a>;
<a name="l00067"></a>00067     <span class="keywordflow">if</span> (tot==4) cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a42253f3512ecfa1a9d852cbab168d744">cur</a>= 3;      <span class="comment">/* rhms, hack for &#39;col&#39; curve? */</span>
<a name="l00068"></a>00068     
<a name="l00069"></a>00069     clipminx = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(minx, maxx);
<a name="l00070"></a>00070     clipminy = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(miny, maxy);
<a name="l00071"></a>00071     clipmaxx = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(minx, maxx);
<a name="l00072"></a>00072     clipmaxy = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(miny, maxy);
<a name="l00073"></a>00073     
<a name="l00074"></a>00074     <a class="code" href="../../d5/d44/BLI__rect_8h.html#a37ad8ed090965186176d4752bc1f94fb">BLI_init_rctf</a>(&amp;cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>, clipminx, clipmaxx, clipminy, clipmaxy);
<a name="l00075"></a>00075     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>;
<a name="l00076"></a>00076     
<a name="l00077"></a>00077     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[0]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[1]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[2]= 1.0f;
<a name="l00078"></a>00078     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[0]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[1]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[2]= 1.0f;
<a name="l00079"></a>00079     
<a name="l00080"></a>00080     <span class="keywordflow">for</span> (a=0; a&lt;tot; a++) {
<a name="l00081"></a>00081         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#ab8bdb4a30d4ac21edb9c7f0fe4784c9c">flag</a>= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a53e0b7a779b29f4940c4eae3fd37ad8d">CUMA_EXTEND_EXTRAPOLATE</a>;
<a name="l00082"></a>00082         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 2;
<a name="l00083"></a>00083         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(2*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <span class="stringliteral">&quot;curve points&quot;</span>);
<a name="l00084"></a>00084         
<a name="l00085"></a>00085         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= minx;
<a name="l00086"></a>00086         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= miny;
<a name="l00087"></a>00087         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= maxx;
<a name="l00088"></a>00088         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= maxy;
<a name="l00089"></a>00089     }   
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#adf3f306b2001b72a3a2328cdd3303e32">changed_timestamp</a> = 0;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="keywordflow">return</span> cumap;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="../../df/dbb/colortools_8c.html#a787dff7deaa08ed788c1b2f5b7af5cd7">00096</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a2814c1eea529822b51a36d9cfe3348cf">curvemapping_free</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <span class="keywordtype">int</span> a;
<a name="l00099"></a>00099     
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (cumap) {
<a name="l00101"></a>00101         <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a03be79f4468bc6e046fbc08cb1f3f98c">CM_TOT</a>; a++) {
<a name="l00102"></a>00102             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00103"></a>00103             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>);
<a name="l00104"></a>00104             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>);
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cumap);
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="../../df/dbb/colortools_8c.html#a4b62fa85273b1464cb4bf08d39e9fec1">00110</a> <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *<a class="code" href="../../d4/dca/BKE__colortools_8h.html#abf02c86e7ad7564ba85ff1adc9c34641">curvemapping_copy</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     <span class="keywordtype">int</span> a;
<a name="l00113"></a>00113     
<a name="l00114"></a>00114     <span class="keywordflow">if</span> (cumap) {
<a name="l00115"></a>00115         <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumapn= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cumap);
<a name="l00116"></a>00116         <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a03be79f4468bc6e046fbc08cb1f3f98c">CM_TOT</a>; a++) {
<a name="l00117"></a>00117             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>) 
<a name="l00118"></a>00118                 cumapn-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00119"></a>00119             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>) 
<a name="l00120"></a>00120                 cumapn-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>);
<a name="l00121"></a>00121             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>) 
<a name="l00122"></a>00122                 cumapn-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>);
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124         <span class="keywordflow">return</span> cumapn;
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a><a class="code" href="../../df/dbb/colortools_8c.html#a774cef30790f1bc13725180fc02b1ded">00129</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ada939d01e9436006abd067b30fab2e28">curvemapping_set_black_white</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keyword">const</span> <span class="keywordtype">float</span> black[3], <span class="keyword">const</span> <span class="keywordtype">float</span> white[3])
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131     <span class="keywordtype">int</span> a;
<a name="l00132"></a>00132     
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (white)
<a name="l00134"></a>00134         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>, white);
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (black)
<a name="l00136"></a>00136         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>, black);
<a name="l00137"></a>00137     
<a name="l00138"></a>00138     <span class="keywordflow">for</span> (a=0; a&lt;3; a++) {
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[a]==cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[a])
<a name="l00140"></a>00140             cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[a]= 0.0f;
<a name="l00141"></a>00141         <span class="keywordflow">else</span>
<a name="l00142"></a>00142             cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[a]= 1.0f/(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[a] - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[a]);
<a name="l00143"></a>00143     }   
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="comment">/* ***************** operations on single curve ************* */</span>
<a name="l00147"></a>00147 <span class="comment">/* ********** NOTE: requires curvemapping_changed() call after ******** */</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/* removes with flag set */</span>
<a name="l00150"></a><a class="code" href="../../df/dbb/colortools_8c.html#a4bff465e26c6326a2d42504bddacf559">00150</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a5b0d2428f6b29f1224361bd544c5f847">curvemap_remove</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <span class="keywordtype">int</span> flag)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152     <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>)*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <span class="stringliteral">&quot;curve points&quot;</span>);
<a name="l00153"></a>00153     <span class="keywordtype">int</span> a, b, removed=0;
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <span class="comment">/* well, lets keep the two outer points! */</span>
<a name="l00156"></a>00156     cmp[0]= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0];
<a name="l00157"></a>00157     <span class="keywordflow">for</span> (a=1, b=1; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1; a++) {
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (!(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp; flag)) {
<a name="l00159"></a>00159             cmp[b]= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[a];
<a name="l00160"></a>00160             b++;
<a name="l00161"></a>00161         }
<a name="l00162"></a>00162         <span class="keywordflow">else</span> removed++;
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164     cmp[b]= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[a];
<a name="l00165"></a>00165     
<a name="l00166"></a>00166     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00167"></a>00167     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>= cmp;
<a name="l00168"></a>00168     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a> -= removed;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="../../df/dbb/colortools_8c.html#aa235a9aa55d101ced97b7dda72ca6ebf">00171</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ae48b9a497fcc469e409457538eb9bdec">curvemap_insert</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y)
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173     <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>+1)*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <span class="stringliteral">&quot;curve points&quot;</span>);
<a name="l00174"></a>00174     <span class="keywordtype">int</span> a, b, foundloc= 0;
<a name="l00175"></a>00175         
<a name="l00176"></a>00176     <span class="comment">/* insert fragments of the old one and the new point to the new curve */</span>
<a name="l00177"></a>00177     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>++;
<a name="l00178"></a>00178     <span class="keywordflow">for</span> (a=0, b=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; a++) {
<a name="l00179"></a>00179         <span class="keywordflow">if</span> ((x &lt; cuma-&gt;curve[a].x) &amp;&amp; !foundloc) {
<a name="l00180"></a>00180             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= x;
<a name="l00181"></a>00181             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= y;
<a name="l00182"></a>00182             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>;
<a name="l00183"></a>00183             foundloc= 1;
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185         <span class="keywordflow">else</span> {
<a name="l00186"></a>00186             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[b].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>;
<a name="l00187"></a>00187             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[b].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00188"></a>00188             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[b].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>;
<a name="l00189"></a>00189             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp;= ~<a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>; <span class="comment">/* make sure old points don&#39;t remain selected */</span>
<a name="l00190"></a>00190             cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7b5718c32a3fd548301ca5d05ab6e8ac">shorty</a>= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[b].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7b5718c32a3fd548301ca5d05ab6e8ac">shorty</a>;
<a name="l00191"></a>00191             b++;
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">/* free old curve and replace it with new one */</span>
<a name="l00196"></a>00196     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00197"></a>00197     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>= cmp;
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="../../df/dbb/colortools_8c.html#a02622ab3fa3ba6e83a0546b0f5c547c7">00200</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ac3ec3c6480f50624abef2aa621aba9b1">curvemap_reset</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <a class="code" href="../../da/d10/structrctf.html">rctf</a> *clipr, <span class="keywordtype">int</span> preset, <span class="keywordtype">int</span> slope)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>)
<a name="l00203"></a>00203         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keywordflow">switch</span>(preset) {
<a name="l00206"></a>00206         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceab43f7b14706115e66df1ba82ad101cc0">CURVE_PRESET_LINE</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 2; <span class="keywordflow">break</span>;
<a name="l00207"></a>00207         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceac45c6b5cfc04c4b021c95fa17347f561">CURVE_PRESET_SHARP</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 4; <span class="keywordflow">break</span>;
<a name="l00208"></a>00208         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea8880071f13cceaa7a4341aee8e65bbe3">CURVE_PRESET_SMOOTH</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 4; <span class="keywordflow">break</span>;
<a name="l00209"></a>00209         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceaf3f2083415bc39c05b577f56a1587f9f">CURVE_PRESET_MAX</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 2; <span class="keywordflow">break</span>;
<a name="l00210"></a>00210         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cead8fd66fcefe7739074247d62c9cca13b">CURVE_PRESET_MID9</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 9; <span class="keywordflow">break</span>;
<a name="l00211"></a>00211         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea93695877631e181f22315a907b3b152c">CURVE_PRESET_ROUND</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 4; <span class="keywordflow">break</span>;
<a name="l00212"></a>00212         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea0717b4ec6e578d6e908c4634072f09f7">CURVE_PRESET_ROOT</a>: cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>= 4; <span class="keywordflow">break</span>;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <span class="stringliteral">&quot;curve points&quot;</span>);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">switch</span>(preset) {
<a name="l00218"></a>00218         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceab43f7b14706115e66df1ba82ad101cc0">CURVE_PRESET_LINE</a>:
<a name="l00219"></a>00219             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l00220"></a>00220             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>;
<a name="l00221"></a>00221             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>= 0;
<a name="l00222"></a>00222             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l00223"></a>00223             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l00224"></a>00224             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>= 0;
<a name="l00225"></a>00225             <span class="keywordflow">break</span>;
<a name="l00226"></a>00226         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceac45c6b5cfc04c4b021c95fa17347f561">CURVE_PRESET_SHARP</a>:
<a name="l00227"></a>00227             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0;
<a name="l00228"></a>00228             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 1;
<a name="l00229"></a>00229             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.25;
<a name="l00230"></a>00230             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.50;
<a name="l00231"></a>00231             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.75;
<a name="l00232"></a>00232             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.04;
<a name="l00233"></a>00233             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 1;
<a name="l00234"></a>00234             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0;
<a name="l00235"></a>00235             <span class="keywordflow">break</span>;
<a name="l00236"></a>00236         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea8880071f13cceaa7a4341aee8e65bbe3">CURVE_PRESET_SMOOTH</a>:
<a name="l00237"></a>00237             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0;
<a name="l00238"></a>00238             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 1;
<a name="l00239"></a>00239             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.25;
<a name="l00240"></a>00240             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.94;
<a name="l00241"></a>00241             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.75;
<a name="l00242"></a>00242             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.06;
<a name="l00243"></a>00243             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 1;
<a name="l00244"></a>00244             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0;
<a name="l00245"></a>00245             <span class="keywordflow">break</span>;
<a name="l00246"></a>00246         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceaf3f2083415bc39c05b577f56a1587f9f">CURVE_PRESET_MAX</a>:
<a name="l00247"></a>00247             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0;
<a name="l00248"></a>00248             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 1;
<a name="l00249"></a>00249             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 1;
<a name="l00250"></a>00250             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 1;
<a name="l00251"></a>00251             <span class="keywordflow">break</span>;
<a name="l00252"></a>00252         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cead8fd66fcefe7739074247d62c9cca13b">CURVE_PRESET_MID9</a>:
<a name="l00253"></a>00253             {
<a name="l00254"></a>00254                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00255"></a>00255                 <span class="keywordflow">for</span> (i=0; i &lt; cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; i++)
<a name="l00256"></a>00256                 {
<a name="l00257"></a>00257                     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= i / ((float)cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1);
<a name="l00258"></a>00258                     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.5;
<a name="l00259"></a>00259                 }
<a name="l00260"></a>00260             }
<a name="l00261"></a>00261             <span class="keywordflow">break</span>;
<a name="l00262"></a>00262         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea93695877631e181f22315a907b3b152c">CURVE_PRESET_ROUND</a>:
<a name="l00263"></a>00263             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0;
<a name="l00264"></a>00264             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 1;
<a name="l00265"></a>00265             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.5;
<a name="l00266"></a>00266             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.90;
<a name="l00267"></a>00267             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.86;
<a name="l00268"></a>00268             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.5;
<a name="l00269"></a>00269             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 1;
<a name="l00270"></a>00270             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0;
<a name="l00271"></a>00271             <span class="keywordflow">break</span>;
<a name="l00272"></a>00272         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea0717b4ec6e578d6e908c4634072f09f7">CURVE_PRESET_ROOT</a>:
<a name="l00273"></a>00273             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0;
<a name="l00274"></a>00274             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 1;
<a name="l00275"></a>00275             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.25;
<a name="l00276"></a>00276             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.95;
<a name="l00277"></a>00277             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 0.75;
<a name="l00278"></a>00278             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[2].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0.44;
<a name="l00279"></a>00279             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>= 1;
<a name="l00280"></a>00280             cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[3].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= 0;
<a name="l00281"></a>00281             <span class="keywordflow">break</span>;
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="comment">/* mirror curve in x direction to have positive slope</span>
<a name="l00285"></a>00285 <span class="comment">     * rather than default negative slope */</span>
<a name="l00286"></a>00286     <span class="keywordflow">if</span> (slope == <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a3f661a1286c9eae498b8e25041407840">CURVEMAP_SLOPE_POSITIVE</a>) {
<a name="l00287"></a>00287         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, last=cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1;
<a name="l00288"></a>00288         <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *newpoints= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00289"></a>00289         
<a name="l00290"></a>00290         <span class="keywordflow">for</span> (i=0; i&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; i++) {
<a name="l00291"></a>00291             newpoints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> = cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[last-<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293         
<a name="l00294"></a>00294         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00295"></a>00295         cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a> = newpoints;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     
<a name="l00298"></a>00298     <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>) {
<a name="l00299"></a>00299         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>);
<a name="l00300"></a>00300         cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="comment">/* if type==1: vector, else auto */</span>
<a name="l00305"></a><a class="code" href="../../df/dbb/colortools_8c.html#a308502d1886d035dbde877406982ffcf">00305</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a38317d5a425c0583c43400bbbab82ff9">curvemap_sethandle</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <span class="keywordtype">int</span> type)
<a name="l00306"></a>00306 {
<a name="l00307"></a>00307     <span class="keywordtype">int</span> a;
<a name="l00308"></a>00308     
<a name="l00309"></a>00309     <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; a++) {
<a name="l00310"></a>00310         <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>) {
<a name="l00311"></a>00311             <span class="keywordflow">if</span> (type) cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> |= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a07c8042d8d5b4b556e5c1a19d09439f9">CUMA_VECTOR</a>;
<a name="l00312"></a>00312             <span class="keywordflow">else</span> cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp;= ~<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a07c8042d8d5b4b556e5c1a19d09439f9">CUMA_VECTOR</a>;
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="comment">/* *********************** Making the tables and display ************** */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="comment">/* reduced copy of garbled calchandleNurb() code in curve.c */</span>
<a name="l00320"></a><a class="code" href="../../df/dbb/colortools_8c.html#a29ddd048df00b414b5aa289bc0abde49">00320</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dbb/colortools_8c.html#a29ddd048df00b414b5aa289bc0abde49">calchandle_curvemap</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *prev, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mode))
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322     <span class="keywordtype">float</span> *p1,*p2,*p3,pt[3];
<a name="l00323"></a>00323     <span class="keywordtype">float</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>,len_a, len_b;
<a name="l00324"></a>00324     <span class="keywordtype">float</span> dvec_a[2], dvec_b[2];
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==0 &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==0) {
<a name="l00327"></a>00327         <span class="keywordflow">return</span>;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329     
<a name="l00330"></a>00330     p2= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l00331"></a>00331     
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (prev==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00333"></a>00333         p3= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l00334"></a>00334         pt[0]= 2.0f*p2[0] - p3[0];
<a name="l00335"></a>00335         pt[1]= 2.0f*p2[1] - p3[1];
<a name="l00336"></a>00336         p1= pt;
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338     <span class="keywordflow">else</span> {
<a name="l00339"></a>00339         p1= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341     
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (next==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00343"></a>00343         p1= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l00344"></a>00344         pt[0]= 2.0f*p2[0] - p1[0];
<a name="l00345"></a>00345         pt[1]= 2.0f*p2[1] - p1[1];
<a name="l00346"></a>00346         p3= pt;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348     <span class="keywordflow">else</span> {
<a name="l00349"></a>00349         p3= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(dvec_a, p2, p1);
<a name="l00353"></a>00353     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(dvec_b, p3, p2);
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     len_a= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a524206121dfa19c9c14423f3a96fcb2b">len_v2</a>(dvec_a);
<a name="l00356"></a>00356     len_b= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a524206121dfa19c9c14423f3a96fcb2b">len_v2</a>(dvec_b);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (len_a==0.0f) len_a=1.0f;
<a name="l00359"></a>00359     <span class="keywordflow">if</span> (len_b==0.0f) len_b=1.0f;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a> || bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) { <span class="comment">/* auto */</span>
<a name="l00362"></a>00362         <span class="keywordtype">float</span> tvec[2];
<a name="l00363"></a>00363         tvec[0]= dvec_b[0]/len_b + dvec_a[0]/len_a;
<a name="l00364"></a>00364         tvec[1]= dvec_b[1]/len_b + dvec_a[1]/len_a;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         len= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a524206121dfa19c9c14423f3a96fcb2b">len_v2</a>(tvec) * 2.5614f;
<a name="l00367"></a>00367         <span class="keywordflow">if</span> (len!=0.0f) {
<a name="l00368"></a>00368             
<a name="l00369"></a>00369             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) {
<a name="l00370"></a>00370                 len_a/=<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00371"></a>00371                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a218a17997f38270105521035d564589d">madd_v2_v2v2fl</a>(p2-3, p2, tvec, -len_a);
<a name="l00372"></a>00372             }
<a name="l00373"></a>00373             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) {
<a name="l00374"></a>00374                 len_b/=<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00375"></a>00375                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a218a17997f38270105521035d564589d">madd_v2_v2v2fl</a>(p2+3, p2, tvec,  len_b);
<a name="l00376"></a>00376             }
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {    <span class="comment">/* vector */</span>
<a name="l00381"></a>00381         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a218a17997f38270105521035d564589d">madd_v2_v2v2fl</a>(p2-3, p2, dvec_a, -1.0f/3.0f);
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {
<a name="l00384"></a>00384         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a218a17997f38270105521035d564589d">madd_v2_v2v2fl</a>(p2+3, p2, dvec_b,  1.0f/3.0f);
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 <span class="comment">/* in X, out Y. </span>
<a name="l00389"></a>00389 <span class="comment"> * X is presumed to be outside first or last */</span>
<a name="l00390"></a><a class="code" href="../../df/dbb/colortools_8c.html#ad52268a6558bcd028610c0db3a59089a">00390</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../df/dbb/colortools_8c.html#ad52268a6558bcd028610c0db3a59089a">curvemap_calc_extend</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <span class="keywordtype">float</span> x, <span class="keyword">const</span> <span class="keywordtype">float</span> first[2], <span class="keyword">const</span> <span class="keywordtype">float</span> last[2])
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (x &lt;= first[0]) {
<a name="l00393"></a>00393         <span class="keywordflow">if</span> ((cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#ab8bdb4a30d4ac21edb9c7f0fe4784c9c">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a53e0b7a779b29f4940c4eae3fd37ad8d">CUMA_EXTEND_EXTRAPOLATE</a>)==0) {
<a name="l00394"></a>00394             <span class="comment">/* no extrapolate */</span>
<a name="l00395"></a>00395             <span class="keywordflow">return</span> first[1];
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397         <span class="keywordflow">else</span> {
<a name="l00398"></a>00398             <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[0]==0.0f)
<a name="l00399"></a>00399                 <span class="keywordflow">return</span> first[1] + cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[1]*10000.0f;
<a name="l00400"></a>00400             <span class="keywordflow">else</span>
<a name="l00401"></a>00401                 <span class="keywordflow">return</span> first[1] + cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[1]*(x - first[0])/cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[0];
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt;= last[0]) {
<a name="l00405"></a>00405         <span class="keywordflow">if</span> ((cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#ab8bdb4a30d4ac21edb9c7f0fe4784c9c">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a53e0b7a779b29f4940c4eae3fd37ad8d">CUMA_EXTEND_EXTRAPOLATE</a>)==0) {
<a name="l00406"></a>00406             <span class="comment">/* no extrapolate */</span>
<a name="l00407"></a>00407             <span class="keywordflow">return</span> last[1];
<a name="l00408"></a>00408         }
<a name="l00409"></a>00409         <span class="keywordflow">else</span> {
<a name="l00410"></a>00410             <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[0]==0.0f)
<a name="l00411"></a>00411                 <span class="keywordflow">return</span> last[1] - cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[1]*10000.0f;
<a name="l00412"></a>00412             <span class="keywordflow">else</span>
<a name="l00413"></a>00413                 <span class="keywordflow">return</span> last[1] + cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[1]*(x - last[0])/cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[0];
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416     <span class="keywordflow">return</span> 0.0f;
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="comment">/* only creates a table for a single channel in CurveMapping */</span>
<a name="l00420"></a><a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">00420</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">curvemap_make_table</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <a class="code" href="../../da/d10/structrctf.html">rctf</a> *clipr)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>;
<a name="l00423"></a>00423     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l00424"></a>00424     <span class="keywordtype">float</span> *fp, *allpoints, *lastpoint, curf, range;
<a name="l00425"></a>00425     <span class="keywordtype">int</span> a, totpoint;
<a name="l00426"></a>00426     
<a name="l00427"></a>00427     <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00428"></a>00428     
<a name="l00429"></a>00429     <span class="comment">/* default rect also is table range */</span>
<a name="l00430"></a>00430     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a6fdeb6d625342ce814ad62a572494650">mintable</a>= clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l00431"></a>00431     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0e05a562a0ba18a9ef8a4f901bbb6f46">maxtable</a>= clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l00432"></a>00432     
<a name="l00433"></a>00433     <span class="comment">/* hrmf... we now rely on blender ipo beziers, these are more advanced */</span>
<a name="l00434"></a>00434     bezt= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;beztarr&quot;</span>);
<a name="l00435"></a>00435     
<a name="l00436"></a>00436     <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; a++) {
<a name="l00437"></a>00437         cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a6fdeb6d625342ce814ad62a572494650">mintable</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a6fdeb6d625342ce814ad62a572494650">mintable</a>, cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>);
<a name="l00438"></a>00438         cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0e05a562a0ba18a9ef8a4f901bbb6f46">maxtable</a>= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0e05a562a0ba18a9ef8a4f901bbb6f46">maxtable</a>, cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>);
<a name="l00439"></a>00439         bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0]= cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>;
<a name="l00440"></a>00440         bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1]= cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00441"></a>00441         <span class="keywordflow">if</span> (cmp[a].flag &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a07c8042d8d5b4b556e5c1a19d09439f9">CUMA_VECTOR</a>)
<a name="l00442"></a>00442             bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>;
<a name="l00443"></a>00443         <span class="keywordflow">else</span>
<a name="l00444"></a>00444             bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446     
<a name="l00447"></a>00447     <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; a++) {
<a name="l00448"></a>00448         <span class="keywordflow">if</span> (a==0)
<a name="l00449"></a>00449             <a class="code" href="../../df/dbb/colortools_8c.html#a29ddd048df00b414b5aa289bc0abde49">calchandle_curvemap</a>(bezt, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bezt+1, 0);
<a name="l00450"></a>00450         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a==cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1)
<a name="l00451"></a>00451             <a class="code" href="../../df/dbb/colortools_8c.html#a29ddd048df00b414b5aa289bc0abde49">calchandle_curvemap</a>(bezt+a, bezt+a-1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l00452"></a>00452         <span class="keywordflow">else</span>
<a name="l00453"></a>00453             <a class="code" href="../../df/dbb/colortools_8c.html#a29ddd048df00b414b5aa289bc0abde49">calchandle_curvemap</a>(bezt+a, bezt+a-1, bezt+a+1, 0);
<a name="l00454"></a>00454     }
<a name="l00455"></a>00455     
<a name="l00456"></a>00456     <span class="comment">/* first and last handle need correction, instead of pointing to center of next/prev, </span>
<a name="l00457"></a>00457 <span class="comment">     * we let it point to the closest handle */</span>
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>&gt;2) {
<a name="l00459"></a>00459         <span class="keywordtype">float</span> hlen, nlen, vec[3];
<a name="l00460"></a>00460         
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (bezt[0].h2==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) {
<a name="l00462"></a>00462             
<a name="l00463"></a>00463             hlen= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(bezt[0].vec[1], bezt[0].vec[2]); <span class="comment">/* original handle length */</span>
<a name="l00464"></a>00464             <span class="comment">/* clip handle point */</span>
<a name="l00465"></a>00465             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, bezt[1].vec[0]);
<a name="l00466"></a>00466             <span class="keywordflow">if</span> (vec[0] &lt; bezt[0].vec[1][0])
<a name="l00467"></a>00467                 vec[0]= bezt[0].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0];
<a name="l00468"></a>00468             
<a name="l00469"></a>00469             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, bezt[0].vec[1]);
<a name="l00470"></a>00470             nlen= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(vec);
<a name="l00471"></a>00471             <span class="keywordflow">if</span> (nlen&gt;FLT_EPSILON) {
<a name="l00472"></a>00472                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, hlen/nlen);
<a name="l00473"></a>00473                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(bezt[0].vec[2], vec, bezt[0].vec[1]);
<a name="l00474"></a>00474                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(bezt[0].vec[0], bezt[0].vec[1], vec);
<a name="l00475"></a>00475             }
<a name="l00476"></a>00476         }
<a name="l00477"></a>00477         a= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1;
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (bezt[a].h2==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) {
<a name="l00479"></a>00479             
<a name="l00480"></a>00480             hlen= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(bezt[a].vec[1], bezt[a].vec[0]); <span class="comment">/* original handle length */</span>
<a name="l00481"></a>00481             <span class="comment">/* clip handle point */</span>
<a name="l00482"></a>00482             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, bezt[a-1].vec[2]);
<a name="l00483"></a>00483             <span class="keywordflow">if</span> (vec[0] &gt; bezt[a].vec[1][0])
<a name="l00484"></a>00484                 vec[0]= bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0];
<a name="l00485"></a>00485             
<a name="l00486"></a>00486             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, bezt[a].vec[1]);
<a name="l00487"></a>00487             nlen= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(vec);
<a name="l00488"></a>00488             <span class="keywordflow">if</span> (nlen&gt;FLT_EPSILON) {
<a name="l00489"></a>00489                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, hlen/nlen);
<a name="l00490"></a>00490                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(bezt[a].vec[0], vec, bezt[a].vec[1]);
<a name="l00491"></a>00491                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(bezt[a].vec[2], bezt[a].vec[1], vec);
<a name="l00492"></a>00492             }
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494     }   
<a name="l00495"></a>00495     <span class="comment">/* make the bezier curve */</span>
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>)
<a name="l00497"></a>00497         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>);
<a name="l00498"></a>00498     totpoint= (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1)*<a class="code" href="../../da/ddd/DNA__color__types_8h.html#acfa61687333d19b1ed22e1de225b8767">CM_RESOL</a>;
<a name="l00499"></a>00499     fp= allpoints= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(totpoint*2*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;table&quot;</span>);
<a name="l00500"></a>00500     
<a name="l00501"></a>00501     <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1; a++, fp += 2*<a class="code" href="../../da/ddd/DNA__color__types_8h.html#acfa61687333d19b1ed22e1de225b8767">CM_RESOL</a>) {
<a name="l00502"></a>00502         <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1f8abee2136c70ce678fb55a8f881060">correct_bezpart</a>(bezt[a].vec[1], bezt[a].vec[2], bezt[a+1].vec[0], bezt[a+1].vec[1]);
<a name="l00503"></a>00503         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a44c2709924870c4af9d9268f691a63e0">forward_diff_bezier</a>(bezt[a].vec[1][0], bezt[a].vec[2][0], bezt[a+1].vec[0][0], bezt[a+1].vec[1][0], fp, <a class="code" href="../../da/ddd/DNA__color__types_8h.html#acfa61687333d19b1ed22e1de225b8767">CM_RESOL</a>-1, 2*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));   
<a name="l00504"></a>00504         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a44c2709924870c4af9d9268f691a63e0">forward_diff_bezier</a>(bezt[a].vec[1][1], bezt[a].vec[2][1], bezt[a+1].vec[0][1], bezt[a+1].vec[1][1], fp+1, <a class="code" href="../../da/ddd/DNA__color__types_8h.html#acfa61687333d19b1ed22e1de225b8767">CM_RESOL</a>-1, 2*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506     
<a name="l00507"></a>00507     <span class="comment">/* store first and last handle for extrapolation, unit length */</span>
<a name="l00508"></a>00508     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[0]= bezt[0].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][0] - bezt[0].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0];
<a name="l00509"></a>00509     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[1]= bezt[0].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1] - bezt[0].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l00510"></a>00510     range= <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[0]*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[0] + cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[1]*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[1]);
<a name="l00511"></a>00511     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[0]/= range;
<a name="l00512"></a>00512     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#acf81e60220bfdbc4c7ea1647c757fc76">ext_in</a>[1]/= range;
<a name="l00513"></a>00513     
<a name="l00514"></a>00514     a= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1;
<a name="l00515"></a>00515     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[0]= bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0] - bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][0];
<a name="l00516"></a>00516     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[1]= bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] - bezt[a].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1];
<a name="l00517"></a>00517     range= <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[0]*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[0] + cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[1]*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[1]);
<a name="l00518"></a>00518     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[0]/= range;
<a name="l00519"></a>00519     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#abb64cb9878e61a6153a6e2f561cfd87e">ext_out</a>[1]/= range;
<a name="l00520"></a>00520     
<a name="l00521"></a>00521     <span class="comment">/* cleanup */</span>
<a name="l00522"></a>00522     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bezt);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     range= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a713d891362c19d4e6bbf6e9ea2b4fd73">CM_TABLEDIV</a>*(cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0e05a562a0ba18a9ef8a4f901bbb6f46">maxtable</a> - cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a6fdeb6d625342ce814ad62a572494650">mintable</a>);
<a name="l00525"></a>00525     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a60e050edd4b9decb6adcdfda7d574d96">range</a>= 1.0f/range;
<a name="l00526"></a>00526     
<a name="l00527"></a>00527     <span class="comment">/* now make a table with CM_TABLE equal x distances */</span>
<a name="l00528"></a>00528     fp= allpoints;
<a name="l00529"></a>00529     lastpoint= allpoints + 2*(totpoint-1);
<a name="l00530"></a>00530     cmp= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>+1)*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <span class="stringliteral">&quot;dist table&quot;</span>);
<a name="l00531"></a>00531     
<a name="l00532"></a>00532     <span class="keywordflow">for</span> (a=0; a&lt;=<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>; a++) {
<a name="l00533"></a>00533         curf= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a6fdeb6d625342ce814ad62a572494650">mintable</a> + range*(float)a;
<a name="l00534"></a>00534         cmp[a].x= curf;
<a name="l00535"></a>00535         
<a name="l00536"></a>00536         <span class="comment">/* get the first x coordinate larger than curf */</span>
<a name="l00537"></a>00537         <span class="keywordflow">while</span> (curf &gt;= fp[0] &amp;&amp; fp!=lastpoint) {
<a name="l00538"></a>00538             fp+=2;
<a name="l00539"></a>00539         }
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (fp==allpoints || (curf &gt;= fp[0] &amp;&amp; fp==lastpoint))
<a name="l00541"></a>00541             cmp[a].y= <a class="code" href="../../df/dbb/colortools_8c.html#ad52268a6558bcd028610c0db3a59089a">curvemap_calc_extend</a>(cuma, curf, allpoints, lastpoint);
<a name="l00542"></a>00542         <span class="keywordflow">else</span> {
<a name="l00543"></a>00543             <span class="keywordtype">float</span> fac1= fp[0] - fp[-2];
<a name="l00544"></a>00544             <span class="keywordtype">float</span> fac2= fp[0] - curf;
<a name="l00545"></a>00545             <span class="keywordflow">if</span> (fac1 &gt; FLT_EPSILON)
<a name="l00546"></a>00546                 fac1= fac2/fac1;
<a name="l00547"></a>00547             <span class="keywordflow">else</span>
<a name="l00548"></a>00548                 fac1= 0.0f;
<a name="l00549"></a>00549             cmp[a].y= fac1*fp[-1] + (1.0f-fac1)*fp[1];
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552     
<a name="l00553"></a>00553     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(allpoints);
<a name="l00554"></a>00554     cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>= cmp;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="comment">/* call when you do images etc, needs restore too. also verifies tables */</span>
<a name="l00558"></a>00558 <span class="comment">/* it uses a flag to prevent premul or free to happen twice */</span>
<a name="l00559"></a><a class="code" href="../../df/dbb/colortools_8c.html#add4bf8af29e6a848e8b64c61544a1b81">00559</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ad9d2df14ef13674d8aeecd581ec067f9">curvemapping_premultiply</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">int</span> restore)
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561     <span class="keywordtype">int</span> a;
<a name="l00562"></a>00562     
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (restore) {
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a7cb97e9000a38ccb80a39c8cf7816466">CUMA_PREMULLED</a>) {
<a name="l00565"></a>00565             <span class="keywordflow">for</span> (a=0; a&lt;3; a++) {
<a name="l00566"></a>00566                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>);
<a name="l00567"></a>00567                 cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>;
<a name="l00568"></a>00568                 cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00569"></a>00569             }
<a name="l00570"></a>00570             
<a name="l00571"></a>00571             cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> &amp;= ~<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a7cb97e9000a38ccb80a39c8cf7816466">CUMA_PREMULLED</a>;
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574     <span class="keywordflow">else</span> {
<a name="l00575"></a>00575         <span class="keywordflow">if</span> ((cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a7cb97e9000a38ccb80a39c8cf7816466">CUMA_PREMULLED</a>)==0) {
<a name="l00576"></a>00576             <span class="comment">/* verify and copy */</span>
<a name="l00577"></a>00577             <span class="keywordflow">for</span> (a=0; a&lt;3; a++) {
<a name="l00578"></a>00578                 <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00579"></a>00579                     <a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">curvemap_make_table</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+a, &amp;cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>);
<a name="l00580"></a>00580                 cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>;
<a name="l00581"></a>00581                 cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>+1)*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <span class="stringliteral">&quot;premul table&quot;</span>);
<a name="l00582"></a>00582                 memcpy(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>, cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>, (<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>+1)*<span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>));
<a name="l00583"></a>00583             }
<a name="l00584"></a>00584             
<a name="l00585"></a>00585             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[3].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00586"></a>00586                 <a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">curvemap_make_table</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+3, &amp;cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>);
<a name="l00587"></a>00587         
<a name="l00588"></a>00588             <span class="comment">/* premul */</span>
<a name="l00589"></a>00589             <span class="keywordflow">for</span> (a=0; a&lt;3; a++) {
<a name="l00590"></a>00590                 <span class="keywordtype">int</span> b;
<a name="l00591"></a>00591                 <span class="keywordflow">for</span> (b=0; b&lt;=<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>; b++) {
<a name="l00592"></a>00592                     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[b].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+3, cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[b].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>);
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594             }
<a name="l00595"></a>00595             
<a name="l00596"></a>00596             cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> |= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a7cb97e9000a38ccb80a39c8cf7816466">CUMA_PREMULLED</a>;
<a name="l00597"></a>00597         }
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="../../df/dbb/colortools_8c.html#a04594aa5c5364dcb4c1da5790ec503fe">00601</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../df/dbb/colortools_8c.html#a04594aa5c5364dcb4c1da5790ec503fe">sort_curvepoints</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *a1, <span class="keyword">const</span> <span class="keywordtype">void</span> *a2)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *x1=a1, *x2=a2;
<a name="l00604"></a>00604     
<a name="l00605"></a>00605     <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> &gt; x2-&gt;x ) <span class="keywordflow">return</span> 1;
<a name="l00606"></a>00606     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> &lt; x2-&gt;x) <span class="keywordflow">return</span> -1;
<a name="l00607"></a>00607     <span class="keywordflow">return</span> 0;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="comment">/* ************************ more CurveMapping calls *************** */</span>
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="comment">/* note; only does current curvemap! */</span>
<a name="l00613"></a><a class="code" href="../../df/dbb/colortools_8c.html#abfa3678f7201d0740c7a84091b78043e">00613</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#af77727c97a9f13c114da3e7dc320f41e">curvemapping_changed</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">int</span> rem_doubles)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615     <a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a42253f3512ecfa1a9d852cbab168d744">cur</a>;
<a name="l00616"></a>00616     <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp= cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>;
<a name="l00617"></a>00617     <a class="code" href="../../da/d10/structrctf.html">rctf</a> *clipr= &amp;cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>;
<a name="l00618"></a>00618     <span class="keywordtype">float</span> <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a>= 0.01f*(clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00619"></a>00619     <span class="keywordtype">float</span> dx= 0.0f, dy= 0.0f;
<a name="l00620"></a>00620     <span class="keywordtype">int</span> a;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#adf3f306b2001b72a3a2328cdd3303e32">changed_timestamp</a>++;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="comment">/* clamp with clip */</span>
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a8649d5f9bc9f67e68cf78ffaa5b8695b">CUMA_DO_CLIP</a>) {
<a name="l00626"></a>00626         <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; a++) {
<a name="l00627"></a>00627             <span class="keywordflow">if</span> (cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>) {
<a name="l00628"></a>00628                 <span class="keywordflow">if</span> (cmp[a].x &lt; clipr-&gt;xmin)
<a name="l00629"></a>00629                     dx= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(dx, cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> - clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00630"></a>00630                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> &gt; clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>)
<a name="l00631"></a>00631                     dx= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(dx, cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> - clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>);
<a name="l00632"></a>00632                 <span class="keywordflow">if</span> (cmp[a].y &lt; clipr-&gt;ymin)
<a name="l00633"></a>00633                     dy= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(dy, cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> - clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00634"></a>00634                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> &gt; clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>)
<a name="l00635"></a>00635                     dy= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(dy, cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> - clipr-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00636"></a>00636             }
<a name="l00637"></a>00637         }
<a name="l00638"></a>00638         <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>; a++) {
<a name="l00639"></a>00639             <span class="keywordflow">if</span> (cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>) {
<a name="l00640"></a>00640                 cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> -= dx;
<a name="l00641"></a>00641                 cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> -= dy;
<a name="l00642"></a>00642             }
<a name="l00643"></a>00643         }
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     
<a name="l00646"></a>00646     
<a name="l00647"></a>00647     qsort(cmp, cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a>), <a class="code" href="../../df/dbb/colortools_8c.html#a04594aa5c5364dcb4c1da5790ec503fe">sort_curvepoints</a>);
<a name="l00648"></a>00648     
<a name="l00649"></a>00649     <span class="comment">/* remove doubles, threshold set on 1% of default range */</span>
<a name="l00650"></a>00650     <span class="keywordflow">if</span> (rem_doubles &amp;&amp; cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>&gt;2) {
<a name="l00651"></a>00651         <span class="keywordflow">for</span> (a=0; a&lt;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1; a++) {
<a name="l00652"></a>00652             dx= cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> - cmp[a+1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>;
<a name="l00653"></a>00653             dy= cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> - cmp[a+1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00654"></a>00654             <span class="keywordflow">if</span> ( <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(dx*dx + dy*dy) &lt; thresh ) {
<a name="l00655"></a>00655                 <span class="keywordflow">if</span> (a==0) {
<a name="l00656"></a>00656                     cmp[a+1].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>|= 2;
<a name="l00657"></a>00657                     <span class="keywordflow">if</span> (cmp[a+1].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>)
<a name="l00658"></a>00658                         cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> |= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>;
<a name="l00659"></a>00659                 }
<a name="l00660"></a>00660                 <span class="keywordflow">else</span> {
<a name="l00661"></a>00661                     cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a>|= 2;
<a name="l00662"></a>00662                     <span class="keywordflow">if</span> (cmp[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>)
<a name="l00663"></a>00663                         cmp[a+1].<a class="code" href="../../df/dff/structCurveMapPoint.html#a7eb4e20eb7d509b42d294e2cfdee3bfd">flag</a> |= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#adb1520c80c81fe4a8289cc4f84389d06">CUMA_SELECT</a>;
<a name="l00664"></a>00664                 }
<a name="l00665"></a>00665                 <span class="keywordflow">break</span>;  <span class="comment">/* we assume 1 deletion per edit is ok */</span>
<a name="l00666"></a>00666             }
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668         <span class="keywordflow">if</span> (a != cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>-1)
<a name="l00669"></a>00669             <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a5b0d2428f6b29f1224361bd544c5f847">curvemap_remove</a>(cuma, 2);
<a name="l00670"></a>00670     }   
<a name="l00671"></a>00671     <a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">curvemap_make_table</a>(cuma, clipr);
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="comment">/* table should be verified */</span>
<a name="l00675"></a><a class="code" href="../../df/dbb/colortools_8c.html#a02f856cb997ceca743c95fa17b81f30e">00675</a> <span class="keywordtype">float</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(<a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma, <span class="keywordtype">float</span> value)
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677     <span class="keywordtype">float</span> fi;
<a name="l00678"></a>00678     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     <span class="comment">/* index in table */</span>
<a name="l00681"></a>00681     fi= (value-cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a6fdeb6d625342ce814ad62a572494650">mintable</a>)*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a60e050edd4b9decb6adcdfda7d574d96">range</a>;
<a name="l00682"></a>00682     i= (<span class="keywordtype">int</span>)fi;
<a name="l00683"></a>00683     
<a name="l00684"></a>00684     <span class="comment">/* fi is table float index and should check against table range i.e. [0.0 CM_TABLE] */</span>
<a name="l00685"></a>00685     <span class="keywordflow">if</span> (fi&lt;0.0f || fi&gt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>)
<a name="l00686"></a>00686         <span class="keywordflow">return</span> <a class="code" href="../../df/dbb/colortools_8c.html#ad52268a6558bcd028610c0db3a59089a">curvemap_calc_extend</a>(cuma, value, &amp;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>, &amp;cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[CM_TABLE].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>);
<a name="l00687"></a>00687     <span class="keywordflow">else</span> {
<a name="l00688"></a>00688         <span class="keywordflow">if</span> (i&lt;0) <span class="keywordflow">return</span> cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (i&gt;=CM_TABLE) <span class="keywordflow">return</span> cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00690"></a>00690         
<a name="l00691"></a>00691         fi= fi-(float)i;
<a name="l00692"></a>00692         <span class="keywordflow">return</span> (1.0f-fi)*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> + (fi)*cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[i+1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>; 
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="comment">/* works with curve &#39;cur&#39; */</span>
<a name="l00697"></a><a class="code" href="../../df/dbb/colortools_8c.html#acd225a10773800a17c4f9cfa722f319a">00697</a> <span class="keywordtype">float</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">int</span> cur, <span class="keywordtype">float</span> value)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     <a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+cur;
<a name="l00700"></a>00700     
<a name="l00701"></a>00701     <span class="comment">/* allocate or bail out */</span>
<a name="l00702"></a>00702     <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00703"></a>00703         <a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">curvemap_make_table</a>(cuma, &amp;cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>);
<a name="l00704"></a>00704         <span class="keywordflow">if</span> (cuma-&gt;<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00705"></a>00705             <span class="keywordflow">return</span> 1.0f-value;
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707     <span class="keywordflow">return</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(cuma, value);
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">/* vector case */</span>
<a name="l00711"></a><a class="code" href="../../df/dbb/colortools_8c.html#af9406c77d523165eecabc61aa2b9d3b5">00711</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a74f6d9534671c98fade827d01e36be99">curvemapping_evaluate3F</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">float</span> vecout[3], <span class="keyword">const</span> <span class="keywordtype">float</span> vecin[3])
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713     vecout[0]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 0, vecin[0]);
<a name="l00714"></a>00714     vecout[1]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 1, vecin[1]);
<a name="l00715"></a>00715     vecout[2]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 2, vecin[2]);
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="comment">/* RGB case, no black/white points, no premult */</span>
<a name="l00719"></a><a class="code" href="../../df/dbb/colortools_8c.html#af8e332fbb69b49d688ad18a37c6c8d05">00719</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#acba14269c27fb578cd3ec206af4f94d9">curvemapping_evaluateRGBF</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">float</span> vecout[3], <span class="keyword">const</span> <span class="keywordtype">float</span> vecin[3])
<a name="l00720"></a>00720 {
<a name="l00721"></a>00721     vecout[0]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 0, <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 3, vecin[0]));
<a name="l00722"></a>00722     vecout[1]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 1, <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 3, vecin[1]));
<a name="l00723"></a>00723     vecout[2]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 2, <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a24a039a3e10ecfb8a0cfefc9811f4830">curvemapping_evaluateF</a>(cumap, 3, vecin[2]));
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 <span class="comment">/* RGB with black/white points and premult. tables are checked */</span>
<a name="l00728"></a><a class="code" href="../../df/dbb/colortools_8c.html#a554973fe43f0a56c184afb85a6e1bc56">00728</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a02747b515e5e0de9921f4da5a571b9f7">curvemapping_evaluate_premulRGBF</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">float</span> vecout[3], <span class="keyword">const</span> <span class="keywordtype">float</span> vecin[3])
<a name="l00729"></a>00729 {
<a name="l00730"></a>00730     <span class="keywordtype">float</span> fac;
<a name="l00731"></a>00731     
<a name="l00732"></a>00732     fac= (vecin[0] - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[0])*cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[0];
<a name="l00733"></a>00733     vecout[0]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>, fac);
<a name="l00734"></a>00734     
<a name="l00735"></a>00735     fac= (vecin[1] - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[1])*cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[1];
<a name="l00736"></a>00736     vecout[1]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+1, fac);
<a name="l00737"></a>00737     
<a name="l00738"></a>00738     fac= (vecin[2] - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[2])*cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a9354c583ed6d425a0ab3f3de4015b0b6">bwmul</a>[2];
<a name="l00739"></a>00739     vecout[2]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+2, fac);
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 <span class="comment">/* only used for image editor curves */</span>
<a name="l00744"></a><a class="code" href="../../df/dbb/colortools_8c.html#a14bc2c7452f5f18d3a7f188c3baa053c">00744</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ae3fb9641167ce7ffd372d731605f4348">curvemapping_do_ibuf</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf)
<a name="l00745"></a>00745 {
<a name="l00746"></a>00746     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *tmpbuf;
<a name="l00747"></a>00747     <span class="keywordtype">int</span> pixel;
<a name="l00748"></a>00748     <span class="keywordtype">float</span> *pix_in;
<a name="l00749"></a>00749     <span class="keywordtype">float</span> col[3];
<a name="l00750"></a>00750     <span class="keywordtype">int</span> stride= 4;
<a name="l00751"></a>00751     <span class="keywordtype">float</span> *pix_out;
<a name="l00752"></a>00752     
<a name="l00753"></a>00753     <span class="keywordflow">if</span> (ibuf==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00754"></a>00754         <span class="keywordflow">return</span>;
<a name="l00755"></a>00755     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00756"></a>00756         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0484659502ef804f57a4dd6c9d3b6d6c">IMB_float_from_rect</a>(ibuf);
<a name="l00757"></a>00757     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00758"></a>00758         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4b968a3f7904d92ffe870afaf676a84c">imb_addrectImBuf</a>(ibuf);
<a name="l00759"></a>00759     
<a name="l00760"></a>00760     <span class="keywordflow">if</span> (!ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> || !ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>)
<a name="l00761"></a>00761         <span class="keywordflow">return</span>;
<a name="l00762"></a>00762     
<a name="l00763"></a>00763     <span class="comment">/* work on a temp buffer, so can color manage afterwards.</span>
<a name="l00764"></a>00764 <span class="comment">     * No worse off memory wise than comp nodes */</span>
<a name="l00765"></a>00765     tmpbuf = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a094bab2aa339f34922893e1d6d617c28">IMB_dupImBuf</a>(ibuf);
<a name="l00766"></a>00766     
<a name="l00767"></a>00767     <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ad9d2df14ef13674d8aeecd581ec067f9">curvemapping_premultiply</a>(cumap, 0);
<a name="l00768"></a>00768     
<a name="l00769"></a>00769     pix_in= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00770"></a>00770     pix_out= tmpbuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>)
<a name="l00773"></a>00773         stride= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>;
<a name="l00774"></a>00774     
<a name="l00775"></a>00775     <span class="keywordflow">for</span> (pixel= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>*ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>; pixel&gt;0; pixel--, pix_in+=stride, pix_out+=stride) {
<a name="l00776"></a>00776         <span class="keywordflow">if</span> (stride&lt;3) {
<a name="l00777"></a>00777             col[0]= <a class="code" href="../../d4/dca/BKE__colortools_8h.html#abe13df4d47857b270429e2be2a7a0798">curvemap_evaluateF</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>, *pix_in);
<a name="l00778"></a>00778             
<a name="l00779"></a>00779             pix_out[1]= pix_out[2]= pix_out[3]= pix_out[0]= col[0];
<a name="l00780"></a>00780         }
<a name="l00781"></a>00781         <span class="keywordflow">else</span> {
<a name="l00782"></a>00782             <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a02747b515e5e0de9921f4da5a571b9f7">curvemapping_evaluate_premulRGBF</a>(cumap, col, pix_in);
<a name="l00783"></a>00783             pix_out[0]= col[0];
<a name="l00784"></a>00784             pix_out[1]= col[1];
<a name="l00785"></a>00785             pix_out[2]= col[2];
<a name="l00786"></a>00786             <span class="keywordflow">if</span> (stride&gt;3)
<a name="l00787"></a>00787                 pix_out[3]= pix_in[3];
<a name="l00788"></a>00788             <span class="keywordflow">else</span>
<a name="l00789"></a>00789                 pix_out[3]= 1.f;
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792     
<a name="l00793"></a>00793     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a3af34b4b5c6b91ddf5b872fcb9e2d66c">IMB_rect_from_float</a>(tmpbuf);
<a name="l00794"></a>00794     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *, tmpbuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>);
<a name="l00795"></a>00795     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(tmpbuf);
<a name="l00796"></a>00796     
<a name="l00797"></a>00797     <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ad9d2df14ef13674d8aeecd581ec067f9">curvemapping_premultiply</a>(cumap, 1);
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a><a class="code" href="../../df/dbb/colortools_8c.html#aa3fbb479e4fc6b84cafee221b2acec38">00800</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a2999f03ca87f3cc00b93626874f07e75">curvemapping_RGBA_does_something</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap)
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802     <span class="keywordtype">int</span> a;
<a name="l00803"></a>00803     
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[0]!=0.0f) <span class="keywordflow">return</span> 1;
<a name="l00805"></a>00805     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[1]!=0.0f) <span class="keywordflow">return</span> 1;
<a name="l00806"></a>00806     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abe65d7070e469add475cbd0c619fd21d">black</a>[2]!=0.0f) <span class="keywordflow">return</span> 1;
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[0]!=1.0f) <span class="keywordflow">return</span> 1;
<a name="l00808"></a>00808     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[1]!=1.0f) <span class="keywordflow">return</span> 1;
<a name="l00809"></a>00809     <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a97dbb7bbe74df4e0d3df0e2daf19173b">white</a>[2]!=1.0f) <span class="keywordflow">return</span> 1;
<a name="l00810"></a>00810     
<a name="l00811"></a>00811     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a03be79f4468bc6e046fbc08cb1f3f98c">CM_TOT</a>; a++) {
<a name="l00812"></a>00812         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>) {
<a name="l00813"></a>00813             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>!=2)  <span class="keywordflow">return</span> 1;
<a name="l00814"></a>00814             
<a name="l00815"></a>00815             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> != 0.0f) <span class="keywordflow">return</span> 1;
<a name="l00816"></a>00816             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[0].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> != 0.0f) <span class="keywordflow">return</span> 1;
<a name="l00817"></a>00817             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a> != 1.0f) <span class="keywordflow">return</span> 1;
<a name="l00818"></a>00818             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>[1].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a> != 1.0f) <span class="keywordflow">return</span> 1;
<a name="l00819"></a>00819         }
<a name="l00820"></a>00820     }
<a name="l00821"></a>00821     <span class="keywordflow">return</span> 0;
<a name="l00822"></a>00822 }
<a name="l00823"></a>00823 
<a name="l00824"></a><a class="code" href="../../df/dbb/colortools_8c.html#ac922bdbab1cc9150545ecf5945816dca">00824</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a42d6a337419141c095383cdb94a3a413">curvemapping_initialize</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap)
<a name="l00825"></a>00825 {
<a name="l00826"></a>00826     <span class="keywordtype">int</span> a;
<a name="l00827"></a>00827     
<a name="l00828"></a>00828     <span class="keywordflow">if</span> (cumap==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00829"></a>00829     
<a name="l00830"></a>00830     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a03be79f4468bc6e046fbc08cb1f3f98c">CM_TOT</a>; a++) {
<a name="l00831"></a>00831         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00832"></a>00832             <a class="code" href="../../df/dbb/colortools_8c.html#a035ad3f4f8e59cf52c985e6331464dba">curvemap_make_table</a>(cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>+a, &amp;cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>);
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834 }
<a name="l00835"></a>00835 
<a name="l00836"></a><a class="code" href="../../df/dbb/colortools_8c.html#a20c05f586a054d959e40b06bf041b6cd">00836</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a28cd77fcee6d0e28245dcddfa4a1c299">curvemapping_table_RGBA</a>(<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap, <span class="keywordtype">float</span> **<a class="code" href="../../d2/d41/classarray.html">array</a>, <span class="keywordtype">int</span> *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00837"></a>00837 {
<a name="l00838"></a>00838     <span class="keywordtype">int</span> a;
<a name="l00839"></a>00839     
<a name="l00840"></a>00840     *size = <a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>+1;
<a name="l00841"></a>00841     *array = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*(*size)*4, <span class="stringliteral">&quot;CurveMapping&quot;</span>);
<a name="l00842"></a>00842     <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a42d6a337419141c095383cdb94a3a413">curvemapping_initialize</a>(cumap);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844     <span class="keywordflow">for</span> (a=0; a&lt;*<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; a++) {
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[0].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>)
<a name="l00846"></a>00846             (*array)[a*4+0]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[0].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00847"></a>00847         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[1].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>)
<a name="l00848"></a>00848             (*array)[a*4+1]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[1].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00849"></a>00849         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[2].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>)
<a name="l00850"></a>00850             (*array)[a*4+2]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[2].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00851"></a>00851         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[3].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>)
<a name="l00852"></a>00852             (*array)[a*4+3]= cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[3].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>[a].<a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>;
<a name="l00853"></a>00853     }
<a name="l00854"></a>00854 }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856 <span class="comment">/* ***************** Histogram **************** */</span>
<a name="l00857"></a>00857 
<a name="l00858"></a><a class="code" href="../../df/dbb/colortools_8c.html#a310703e61bc9c5c982789e8fe0a98752">00858</a> <span class="preprocessor">#define INV_255     (1.f/255.f)</span>
<a name="l00859"></a>00859 <span class="preprocessor"></span>
<a name="l00860"></a><a class="code" href="../../df/dbb/colortools_8c.html#a4607fd0c298c9128dc76b0abc7f017b8">00860</a> <a class="code" href="../../d4/d17/BKE__cloth_8h.html#a2cbaeebd38552ec1c070a6dff2bed2aa">DO_INLINE</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dbb/colortools_8c.html#a4607fd0c298c9128dc76b0abc7f017b8">get_bin_float</a>(<span class="keywordtype">float</span> f)
<a name="l00861"></a>00861 {
<a name="l00862"></a>00862     <span class="keywordtype">int</span> bin= (int)((f*255.0f) + 0.5f);  <span class="comment">/* 0.5 to prevent quantisation differences */</span>
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="comment">/* note: clamp integer instead of float to avoid problems with NaN */</span>
<a name="l00865"></a>00865     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(bin, 0, 255);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="keywordflow">return</span> bin;
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="../../df/dbb/colortools_8c.html#a25e7267ea097c7458a93d5e5f728b11a">00870</a> <a class="code" href="../../d4/d17/BKE__cloth_8h.html#a2cbaeebd38552ec1c070a6dff2bed2aa">DO_INLINE</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dbb/colortools_8c.html#a25e7267ea097c7458a93d5e5f728b11a">save_sample_line</a>(<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes, <span class="keyword">const</span> <span class="keywordtype">int</span> idx, <span class="keyword">const</span> <span class="keywordtype">float</span> fx, <span class="keyword">const</span> <span class="keywordtype">float</span> rgb[3], <span class="keyword">const</span> <span class="keywordtype">float</span> ycc[3])
<a name="l00871"></a>00871 {
<a name="l00872"></a>00872     <span class="keywordtype">float</span> yuv[3];
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <span class="comment">/* vectorscope*/</span>
<a name="l00875"></a>00875     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#ad139f29cd591f92b82fcba59e66ae1b4">rgb_to_yuv</a>(rgb[0], rgb[1], rgb[2], &amp;yuv[0], &amp;yuv[1], &amp;yuv[2]);
<a name="l00876"></a>00876     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>[idx + 0] = yuv[1];
<a name="l00877"></a>00877     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>[idx + 1] = yuv[2];
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="comment">/* waveform */</span>
<a name="l00880"></a>00880     <span class="keywordflow">switch</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a28496f7a310589fd800ae67ba697c54e">wavefrm_mode</a>) {
<a name="l00881"></a>00881         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a648eacded1b9abbf6a0e672dcfa597c6">SCOPES_WAVEFRM_RGB</a>:
<a name="l00882"></a>00882             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>[idx + 0] = fx;
<a name="l00883"></a>00883             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>[idx + 1] = rgb[0];
<a name="l00884"></a>00884             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>[idx + 0] = fx;
<a name="l00885"></a>00885             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>[idx + 1] = rgb[1];
<a name="l00886"></a>00886             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>[idx + 0] = fx;
<a name="l00887"></a>00887             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>[idx + 1] = rgb[2];
<a name="l00888"></a>00888             <span class="keywordflow">break</span>;
<a name="l00889"></a>00889         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#ab853ea8bc504e435de28ed818b939680">SCOPES_WAVEFRM_LUMA</a>:
<a name="l00890"></a>00890             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>[idx + 0] = fx;
<a name="l00891"></a>00891             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>[idx + 1] = ycc[0];
<a name="l00892"></a>00892             <span class="keywordflow">break</span>;
<a name="l00893"></a>00893         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a41171417596130a2306a709435d12d38">SCOPES_WAVEFRM_YCC_JPEG</a>:
<a name="l00894"></a>00894         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a9bc1b194625e84428ae6b3d1ad794b21">SCOPES_WAVEFRM_YCC_709</a>:
<a name="l00895"></a>00895         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a78e166fba844d88ecb1a0d8f6072273e">SCOPES_WAVEFRM_YCC_601</a>:
<a name="l00896"></a>00896             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>[idx + 0] = fx;
<a name="l00897"></a>00897             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>[idx + 1] = ycc[0];
<a name="l00898"></a>00898             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>[idx + 0] = fx;
<a name="l00899"></a>00899             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>[idx + 1] = ycc[1];
<a name="l00900"></a>00900             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>[idx + 0] = fx;
<a name="l00901"></a>00901             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>[idx + 1] = ycc[2];
<a name="l00902"></a>00902             <span class="keywordflow">break</span>;
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904 }
<a name="l00905"></a>00905 
<a name="l00906"></a><a class="code" href="../../df/dbb/colortools_8c.html#a3695b01cf0a96f36657778b7313b14b4">00906</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a7b0474f829316ca0ddf9ca0e3a2edc46">scopes_update</a>(<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> use_color_management)
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908     <span class="keywordtype">int</span> <a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>, <a class="code" href="../../df/dff/structCurveMapPoint.html#ad00139b75f5fe65b70d3dfe1c6e7eb6d">y</a>, c;
<a name="l00909"></a>00909     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n, nl;
<a name="l00910"></a>00910     <span class="keywordtype">double</span> <a class="code" href="../../d7/d35/meshtools_8c.html#aaa0035357cda6d6d6d0e6831ce7c869a">div</a>, divl;
<a name="l00911"></a>00911     <span class="keywordtype">float</span> *rf=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00912"></a>00912     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *rc=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00913"></a>00913     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *bin_r, *bin_g, *bin_b, *bin_lum;
<a name="l00914"></a>00914     <span class="keywordtype">int</span> savedlines, saveline;
<a name="l00915"></a>00915     <span class="keywordtype">float</span> rgb[3], ycc[3], luma;
<a name="l00916"></a>00916     <span class="keywordtype">int</span> ycc_mode=-1;
<a name="l00917"></a>00917     <span class="keyword">const</span> <span class="keywordtype">short</span> is_float = (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a46e0b437a82b65c4a1834daf9bc692a4">ok</a> == 1 ) <span class="keywordflow">return</span>;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#aa36a62911184433ef4d0395a1e04bfff">ymax</a> == 0.f) scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#aa36a62911184433ef4d0395a1e04bfff">ymax</a> = 1.f;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="comment">/* hmmmm */</span>
<a name="l00926"></a>00926     <span class="keywordflow">if</span> (!(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>, 3, 4))) <span class="keywordflow">return</span>;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#a0050c38c1ea977412ac24f4618317677">channels</a> = 3;
<a name="l00929"></a>00929     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#a5fafc7f45c5204b858bb072494f6ccf7">x_resolution</a> = 256;
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="keywordflow">switch</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a28496f7a310589fd800ae67ba697c54e">wavefrm_mode</a>) {
<a name="l00932"></a>00932         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a648eacded1b9abbf6a0e672dcfa597c6">SCOPES_WAVEFRM_RGB</a>:
<a name="l00933"></a>00933             ycc_mode = -1;
<a name="l00934"></a>00934             <span class="keywordflow">break</span>;
<a name="l00935"></a>00935         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#ab853ea8bc504e435de28ed818b939680">SCOPES_WAVEFRM_LUMA</a>:
<a name="l00936"></a>00936         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a41171417596130a2306a709435d12d38">SCOPES_WAVEFRM_YCC_JPEG</a>:
<a name="l00937"></a>00937             ycc_mode = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a3519ca5a552b1d5de3b4bebc83c4c128">BLI_YCC_JFIF_0_255</a>;
<a name="l00938"></a>00938             <span class="keywordflow">break</span>;
<a name="l00939"></a>00939         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a78e166fba844d88ecb1a0d8f6072273e">SCOPES_WAVEFRM_YCC_601</a>:
<a name="l00940"></a>00940             ycc_mode = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7a53917c3eb54a9730ec1be83c95e503">BLI_YCC_ITU_BT601</a>;
<a name="l00941"></a>00941             <span class="keywordflow">break</span>;
<a name="l00942"></a>00942         <span class="keywordflow">case</span> <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a9bc1b194625e84428ae6b3d1ad794b21">SCOPES_WAVEFRM_YCC_709</a>:
<a name="l00943"></a>00943             ycc_mode = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#af95dc166bb4cb507e4831c063325afa5">BLI_YCC_ITU_BT709</a>;
<a name="l00944"></a>00944             <span class="keywordflow">break</span>;
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     <span class="comment">/* temp table to count pix value for histo */</span>
<a name="l00948"></a>00948     bin_r = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(256 * <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), <span class="stringliteral">&quot;temp historgram bins&quot;</span>);
<a name="l00949"></a>00949     bin_g = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(256 * <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), <span class="stringliteral">&quot;temp historgram bins&quot;</span>);
<a name="l00950"></a>00950     bin_b = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(256 * <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), <span class="stringliteral">&quot;temp historgram bins&quot;</span>);
<a name="l00951"></a>00951     bin_lum = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(256 * <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), <span class="stringliteral">&quot;temp historgram bins&quot;</span>);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="comment">/* convert to number of lines with logarithmic scale */</span>
<a name="l00954"></a>00954     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac41e5964de751715fd2aad56d6e87f2e">sample_lines</a> = (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#acb513ef7540604d7ea5c68832b3ddc24">accuracy</a>*0.01f) * (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#acb513ef7540604d7ea5c68832b3ddc24">accuracy</a>*0.01f) * ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00955"></a>00955     
<a name="l00956"></a>00956     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a4237dba740eb98bc39bd660666bedeea">sample_full</a>)
<a name="l00957"></a>00957         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac41e5964de751715fd2aad56d6e87f2e">sample_lines</a> = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     <span class="comment">/* scan the image */</span>
<a name="l00960"></a>00960     savedlines=0;
<a name="l00961"></a>00961     <span class="keywordflow">for</span> (c=0; c&lt;3; c++) {
<a name="l00962"></a>00962         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][0]=25500.0f;
<a name="l00963"></a>00963         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][1]=-25500.0f;
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965     
<a name="l00966"></a>00966     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0b415fbc0c482e0971add36b5044b8e0">waveform_tot</a> = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>*scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac41e5964de751715fd2aad56d6e87f2e">sample_lines</a>;
<a name="l00967"></a>00967     
<a name="l00968"></a>00968     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>)
<a name="l00969"></a>00969         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>);
<a name="l00970"></a>00970     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>)
<a name="l00971"></a>00971         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>);
<a name="l00972"></a>00972     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>)
<a name="l00973"></a>00973         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>);
<a name="l00974"></a>00974     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>)
<a name="l00975"></a>00975         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>);
<a name="l00976"></a>00976     
<a name="l00977"></a>00977     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0b415fbc0c482e0971add36b5044b8e0">waveform_tot</a> * 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;waveform point channel 1&quot;</span>);
<a name="l00978"></a>00978     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0b415fbc0c482e0971add36b5044b8e0">waveform_tot</a> * 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;waveform point channel 2&quot;</span>);
<a name="l00979"></a>00979     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0b415fbc0c482e0971add36b5044b8e0">waveform_tot</a> * 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;waveform point channel 3&quot;</span>);
<a name="l00980"></a>00980     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0b415fbc0c482e0971add36b5044b8e0">waveform_tot</a> * 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;vectorscope point channel&quot;</span>);
<a name="l00981"></a>00981     
<a name="l00982"></a>00982     <span class="keywordflow">if</span> (is_float)
<a name="l00983"></a>00983         rf = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>;
<a name="l00984"></a>00984     <span class="keywordflow">else</span>
<a name="l00985"></a>00985         rc = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     for (y = 0; y &lt; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>; y++) {
<a name="l00988"></a>00988         <span class="keywordflow">if</span> (savedlines&lt;scopes-&gt;sample_lines &amp;&amp; y&gt;=((savedlines)*ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>)/(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac41e5964de751715fd2aad56d6e87f2e">sample_lines</a>+1)) {
<a name="l00989"></a>00989             saveline = 1;
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991         <span class="keywordflow">else</span> {
<a name="l00992"></a>00992             saveline = 0;
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994         <span class="keywordflow">for</span> (x = 0; x &lt; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>; x++) {
<a name="l00995"></a>00995 
<a name="l00996"></a>00996             <span class="keywordflow">if</span> (is_float) {
<a name="l00997"></a>00997                 <span class="keywordflow">if</span> (use_color_management)
<a name="l00998"></a>00998                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#ac0586614af7cf4cfa2c1718015b85383">linearrgb_to_srgb_v3_v3</a>(rgb, rf);
<a name="l00999"></a>00999                 <span class="keywordflow">else</span>
<a name="l01000"></a>01000                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(rgb, rf);
<a name="l01001"></a>01001             }
<a name="l01002"></a>01002             <span class="keywordflow">else</span> {
<a name="l01003"></a>01003                 <span class="keywordflow">for</span> (c=0; c&lt;3; c++)
<a name="l01004"></a>01004                     rgb[c] = rc[c] * <a class="code" href="../../df/dbb/colortools_8c.html#a310703e61bc9c5c982789e8fe0a98752">INV_255</a>;
<a name="l01005"></a>01005             }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007             <span class="comment">/* we still need luma for histogram */</span>
<a name="l01008"></a>01008             luma = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#ae01a5d537c3a638ab0c898b81981a27e">rgb_to_luma</a>(rgb);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010             <span class="comment">/* check for min max */</span>
<a name="l01011"></a>01011             <span class="keywordflow">if</span> (ycc_mode == -1 ) {
<a name="l01012"></a>01012                 <span class="keywordflow">for</span> (c=0; c&lt;3; c++) {
<a name="l01013"></a>01013                     <span class="keywordflow">if</span> (rgb[c] &lt; scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][0]) scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][0] = rgb[c];
<a name="l01014"></a>01014                     <span class="keywordflow">if</span> (rgb[c] &gt; scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][1]) scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][1] = rgb[c];
<a name="l01015"></a>01015                 }
<a name="l01016"></a>01016             }
<a name="l01017"></a>01017             <span class="keywordflow">else</span> {
<a name="l01018"></a>01018                 <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a43837f1db8d7b78399aa41204ac20f46">rgb_to_ycc</a>(rgb[0],rgb[1],rgb[2],&amp;ycc[0],&amp;ycc[1],&amp;ycc[2], ycc_mode);
<a name="l01019"></a>01019                 <span class="keywordflow">for</span> (c=0; c&lt;3; c++) {
<a name="l01020"></a>01020                     ycc[c] *=<a class="code" href="../../df/dbb/colortools_8c.html#a310703e61bc9c5c982789e8fe0a98752">INV_255</a>;
<a name="l01021"></a>01021                     <span class="keywordflow">if</span> (ycc[c] &lt; scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][0]) scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][0] = ycc[c];
<a name="l01022"></a>01022                     <span class="keywordflow">if</span> (ycc[c] &gt; scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][1]) scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#aab2c4f2582d1666b3051d2407e9bf868">minmax</a>[c][1] = ycc[c];
<a name="l01023"></a>01023                 }
<a name="l01024"></a>01024             }
<a name="l01025"></a>01025             <span class="comment">/* increment count for histo*/</span>
<a name="l01026"></a>01026             bin_r[ <a class="code" href="../../df/dbb/colortools_8c.html#a4607fd0c298c9128dc76b0abc7f017b8">get_bin_float</a>(rgb[0]) ] += 1;
<a name="l01027"></a>01027             bin_g[ <a class="code" href="../../df/dbb/colortools_8c.html#a4607fd0c298c9128dc76b0abc7f017b8">get_bin_float</a>(rgb[1]) ] += 1;
<a name="l01028"></a>01028             bin_b[ <a class="code" href="../../df/dbb/colortools_8c.html#a4607fd0c298c9128dc76b0abc7f017b8">get_bin_float</a>(rgb[2]) ] += 1;
<a name="l01029"></a>01029             bin_lum[ <a class="code" href="../../df/dbb/colortools_8c.html#a4607fd0c298c9128dc76b0abc7f017b8">get_bin_float</a>(luma) ] += 1;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031             <span class="comment">/* save sample if needed */</span>
<a name="l01032"></a>01032             <span class="keywordflow">if</span> (saveline) {
<a name="l01033"></a>01033                 <span class="keyword">const</span> <span class="keywordtype">float</span> fx = (float)x / (<span class="keywordtype">float</span>)ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l01034"></a>01034                 <span class="keyword">const</span> <span class="keywordtype">int</span> idx = 2*(ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>*savedlines+<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>);
<a name="l01035"></a>01035                 <a class="code" href="../../df/dbb/colortools_8c.html#a25e7267ea097c7458a93d5e5f728b11a">save_sample_line</a>(scopes, idx, fx, rgb, ycc);
<a name="l01036"></a>01036             }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038             rf+= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>;
<a name="l01039"></a>01039             rc+= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>;
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041         <span class="keywordflow">if</span> (saveline)
<a name="l01042"></a>01042             savedlines +=1;
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     <span class="comment">/* convert hist data to float (proportional to max count) */</span>
<a name="l01046"></a>01046     n=0;
<a name="l01047"></a>01047     nl=0;
<a name="l01048"></a>01048     <span class="keywordflow">for</span> (x=0; x&lt;256; x++) {
<a name="l01049"></a>01049         <span class="keywordflow">if</span> (bin_r[x] &gt; n)
<a name="l01050"></a>01050             n = bin_r[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>];
<a name="l01051"></a>01051         <span class="keywordflow">if</span> (bin_g[x] &gt; n)
<a name="l01052"></a>01052             n = bin_g[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>];
<a name="l01053"></a>01053         <span class="keywordflow">if</span> (bin_b[x] &gt; n)
<a name="l01054"></a>01054             n = bin_b[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>];
<a name="l01055"></a>01055         <span class="keywordflow">if</span> (bin_lum[x] &gt; nl)
<a name="l01056"></a>01056             nl = bin_lum[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>];
<a name="l01057"></a>01057     }
<a name="l01058"></a>01058     div = 1.0/(double)n;
<a name="l01059"></a>01059     divl = 1.0/(double)nl;
<a name="l01060"></a>01060     <span class="keywordflow">for</span> (x=0; x&lt;256; x++) {
<a name="l01061"></a>01061         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#a98fe942996e6e97046475e3c8c26abf5">data_r</a>[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] = bin_r[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] * <a class="code" href="../../d7/d35/meshtools_8c.html#aaa0035357cda6d6d6d0e6831ce7c869a">div</a>;
<a name="l01062"></a>01062         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#aef06ab5d471910d1656df2cf933422fb">data_g</a>[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] = bin_g[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] * <a class="code" href="../../d7/d35/meshtools_8c.html#aaa0035357cda6d6d6d0e6831ce7c869a">div</a>;
<a name="l01063"></a>01063         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#ad6b3dd51a648ab15f1e2de154f1310db">data_b</a>[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] = bin_b[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] * <a class="code" href="../../d7/d35/meshtools_8c.html#aaa0035357cda6d6d6d0e6831ce7c869a">div</a>;
<a name="l01064"></a>01064         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#a797e8fe830f9d465340118495bda5316">data_luma</a>[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] = bin_lum[<a class="code" href="../../df/dff/structCurveMapPoint.html#ac3df3f983158221ce011fe7f925e6f05">x</a>] * divl;
<a name="l01065"></a>01065     }
<a name="l01066"></a>01066     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bin_r);
<a name="l01067"></a>01067     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bin_g);
<a name="l01068"></a>01068     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bin_b);
<a name="l01069"></a>01069     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bin_lum);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a46e0b437a82b65c4a1834daf9bc692a4">ok</a> = 1;
<a name="l01072"></a>01072 }
<a name="l01073"></a>01073 
<a name="l01074"></a><a class="code" href="../../df/dbb/colortools_8c.html#aecfd3b38fa363e7afcd7557ec06b3411">01074</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ab948bc0ef1790cbbca188395a7216124">scopes_free</a>(<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes)
<a name="l01075"></a>01075 {
<a name="l01076"></a>01076     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>) {
<a name="l01077"></a>01077         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a>);
<a name="l01078"></a>01078         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01079"></a>01079     }
<a name="l01080"></a>01080     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>) {
<a name="l01081"></a>01081         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a>);
<a name="l01082"></a>01082         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>) {
<a name="l01085"></a>01085         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a>);
<a name="l01086"></a>01086         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01087"></a>01087     }
<a name="l01088"></a>01088     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>) {
<a name="l01089"></a>01089         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a>);
<a name="l01090"></a>01090         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092 }
<a name="l01093"></a>01093 
<a name="l01094"></a><a class="code" href="../../df/dbb/colortools_8c.html#aa6c7f94ce29120cd5d4873f12d623352">01094</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a928b75fffc5a17a4c05e812a136bb04d">scopes_new</a>(<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes)
<a name="l01095"></a>01095 {
<a name="l01096"></a>01096     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#acb513ef7540604d7ea5c68832b3ddc24">accuracy</a>=30.0;
<a name="l01097"></a>01097     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#a5377b31aa3f6e7802a267cd036b20543">mode</a>=<a class="code" href="../../da/ddd/DNA__color__types_8h.html#ae90c38b3c4d6f4d4aafd0aaa5eb52805">HISTO_MODE_RGB</a>;
<a name="l01098"></a>01098     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a6eafcfad38a077c7c6107cd6217959b2">wavefrm_alpha</a>=0.3;
<a name="l01099"></a>01099     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab70fb5bf67ebadcc7198cc07ce319825">vecscope_alpha</a>=0.3;
<a name="l01100"></a>01100     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0bb974670482bc2c2cdf8babc571ab7f">wavefrm_height</a>= 100;
<a name="l01101"></a>01101     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a60c7ca02c8e7129c0498d956c4657d27">vecscope_height</a>= 100;
<a name="l01102"></a>01102     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#afaa3bff81c3b3caf078721856de37c75">hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#aa745e9495c4fb8768c0f1bfb65415030">height</a>= 100;
<a name="l01103"></a>01103     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a46e0b437a82b65c4a1834daf9bc692a4">ok</a>= 0;
<a name="l01104"></a>01104     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01105"></a>01105     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01106"></a>01106     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01107"></a>01107     scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01108"></a>01108 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:11 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

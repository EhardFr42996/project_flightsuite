<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: transform.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">transform.c</div>  </div>
</div>
<div class="contents">
<a href="../../d8/d27/transform_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#else</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#include &lt;io.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#endif</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html">DNA_constraint_types.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html">DNA_movieclip_types.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>        <span class="comment">/* PET modes            */</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d71/BIF__glutil_8h.html">BIF_glutil.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de6/BKE__nla_8h.html">BKE_nla.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/BKE__bmesh_8h.html" title="BMesh modeler structure and functions.">BKE_bmesh.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dca/BKE__particle_8h.html">BKE_particle.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/BKE__pointcache_8h.html">BKE_pointcache.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d47/BKE__unit_8h.html">BKE_unit.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d53/ED__image_8h.html">ED_image.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../da/df9/ED__keyframing_8h.html">ED_keyframing.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d5f/ED__space__api_8h.html">ED_space_api.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd6/ED__mesh_8h.html">ED_mesh.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dbe/ED__clip_8h.html">ED_clip.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d31/BLI__linklist_8h.html" title="Routines for working with singly linked lists of &#39;links&#39; - pointers to other data.">BLI_linklist.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d1a/BLI__smallhash_8h.html">BLI_smallhash.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d6c/BLI__array_8h.html">BLI_array.h</a>&quot;</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">//#include &quot;blendef.h&quot;</span>
<a name="l00093"></a>00093 <span class="comment">//</span>
<a name="l00094"></a>00094 <span class="comment">//#include &quot;mydevice.h&quot;</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d80/transform_8h.html">transform.h</a>&quot;</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a19f34d1d9dd68e425b759d696f75f940">drawTransformApply</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">struct</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">void</span> *arg);
<a name="l00101"></a>00101 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a70aba5d402c4d15ec2a5463f14faba8c">doEdgeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> perc);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">/* ************************** SPACE DEPENDANT CODE **************************** */</span>
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="../../d2/d80/transform_8h.html#abe8c1415473ba2c5ff0c240a0adfad25">00105</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#abe8c1415473ba2c5ff0c240a0adfad25">setTransformViewMatrices</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l00108"></a>00108         <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l00111"></a>00111         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2dd8c0b6b07389026e51c74f22d6f70b">viewinv</a>, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>);
<a name="l00112"></a>00112         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac1ac1825013b89a628b0a8ed2c11e029">persmat</a>, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8ab36b8b8caeec087fd9595c33e90775">persmat</a>);
<a name="l00113"></a>00113         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#af5fed4fdcf40c6ac8bcac00275df04d8">persinv</a>, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ac8b049c589a4159afee5f4d0114dbed7">persinv</a>);
<a name="l00114"></a>00114         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a32829b792f54258663c560080b174019">persp</a> = rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>;
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116     <span class="keywordflow">else</span> {
<a name="l00117"></a>00117         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>);
<a name="l00118"></a>00118         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2dd8c0b6b07389026e51c74f22d6f70b">viewinv</a>);
<a name="l00119"></a>00119         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac1ac1825013b89a628b0a8ed2c11e029">persmat</a>);
<a name="l00120"></a>00120         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#af5fed4fdcf40c6ac8bcac00275df04d8">persinv</a>);
<a name="l00121"></a>00121         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a32829b792f54258663c560080b174019">persp</a> = <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#af086af25ae5c28a12be8eb6f7687c6dd">RV3D_ORTHO</a>;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <a class="code" href="../../d2/d80/transform_8h.html#a3d3873bddbc9335f3993aaf687871fae">calculateCenter2D</a>(t);
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="../../d8/d27/transform_8c.html#a352751da2d4ba809f50a66142540e9ab">00127</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a352751da2d4ba809f50a66142540e9ab">convertViewVec2D</a>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d, <span class="keywordtype">float</span> vec[3], <span class="keywordtype">int</span> dx, <span class="keywordtype">int</span> dy)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129     <span class="keywordtype">float</span> divx, divy;
<a name="l00130"></a>00130     
<a name="l00131"></a>00131     divx= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00132"></a>00132     divy= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     vec[0]= (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) * dx / divx;
<a name="l00135"></a>00135     vec[1]= (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) * dy / divy;
<a name="l00136"></a>00136     vec[2]= 0.0f;
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="../../d2/d80/transform_8h.html#adf462e30d0f58bb96a6fa04662e3f97a">00139</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#adf462e30d0f58bb96a6fa04662e3f97a">convertViewVec</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> r_vec[3], <span class="keywordtype">int</span> dx, <span class="keywordtype">int</span> dy)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) &amp;&amp; (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>)) {
<a name="l00142"></a>00142         <span class="keywordtype">float</span> mval_f[2];
<a name="l00143"></a>00143         mval_f[0] = dx;
<a name="l00144"></a>00144         mval_f[1] = dy;
<a name="l00145"></a>00145         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ae4c98073cdfe1ff7ff50c08cb53b4228">ED_view3d_win_to_delta</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>, mval_f, r_vec);
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l00148"></a>00148         <span class="keywordtype">float</span> aspx, aspy;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         <a class="code" href="../../d8/d27/transform_8c.html#a352751da2d4ba809f50a66142540e9ab">convertViewVec2D</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, r_vec, dx, dy);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <a class="code" href="../../de/d53/ED__image_8h.html#aad1989be279911287243afb19ac98dee">ED_space_image_uv_aspect</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, &amp;aspx, &amp;aspy);
<a name="l00153"></a>00153         r_vec[0] *= aspx;
<a name="l00154"></a>00154         r_vec[1] *= aspy;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>)) {
<a name="l00157"></a>00157         <a class="code" href="../../d8/d27/transform_8c.html#a352751da2d4ba809f50a66142540e9ab">convertViewVec2D</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, r_vec, dx, dy);
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>)) {
<a name="l00160"></a>00160         <a class="code" href="../../d8/d27/transform_8c.html#a352751da2d4ba809f50a66142540e9ab">convertViewVec2D</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, r_vec, dx, dy);
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l00163"></a>00163         <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>;
<a name="l00164"></a>00164         <span class="keywordtype">float</span> divx, divy;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         divx = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>-v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00167"></a>00167         divy = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>-v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         r_vec[0] = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>)*(dx)/divx;
<a name="l00170"></a>00170         r_vec[1] = (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>)*(dy)/divy;
<a name="l00171"></a>00171         r_vec[2] = 0.0f;
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173     <span class="keywordflow">else</span> {
<a name="l00174"></a>00174         printf(<span class="stringliteral">&quot;%s: called in an invalid context\n&quot;</span>, __func__);
<a name="l00175"></a>00175         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(r_vec);
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a><a class="code" href="../../d2/d80/transform_8h.html#aef669f8489b01fcab46ccd288d46f91e">00179</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aef669f8489b01fcab46ccd288d46f91e">projectIntView</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">int</span> adr[2])
<a name="l00180"></a>00180 {
<a name="l00181"></a>00181     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>)
<a name="l00183"></a>00183             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a3f4393c9c8a64399c8a2b6c1980ff260">project_int_noclip</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>, vec, adr);
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l00186"></a>00186         <span class="keywordtype">float</span> aspx, aspy, v[2];
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         <a class="code" href="../../de/d53/ED__image_8h.html#aad1989be279911287243afb19ac98dee">ED_space_image_uv_aspect</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, &amp;aspx, &amp;aspy);
<a name="l00189"></a>00189         v[0]= vec[0]/aspx;
<a name="l00190"></a>00190         v[1]= vec[1]/aspy;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <a class="code" href="../../d5/d63/UI__view2d_8h.html#aa16ac5e71fe909468df26b217762283d">UI_view2d_to_region_no_clip</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, v[0], v[1], adr, adr+1);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l00195"></a>00195         <span class="keywordtype">int</span> out[2] = {0, 0};
<a name="l00196"></a>00196 <span class="preprocessor">#if 0</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>        <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *sact = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#aa9c9b1bb84c77908e70219d39ed8696c">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#af4dbf3f7801297d71ef69d77c2724d0eacde1cfa09bf766b2900162ef04d5aa1d">SACTION_DRAWTIME</a>) {
<a name="l00200"></a>00200             <span class="comment">//vec[0] = vec[0]/((t-&gt;scene-&gt;r.frs_sec / t-&gt;scene-&gt;r.frs_sec_base));</span>
<a name="l00201"></a>00201             <span class="comment">/* same as below */</span>
<a name="l00202"></a>00202             <a class="code" href="../../d5/d63/UI__view2d_8h.html#aa16ac5e71fe909468df26b217762283d">UI_view2d_to_region_no_clip</a>((<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, vec[0], vec[1], out, out+1);
<a name="l00203"></a>00203         } 
<a name="l00204"></a>00204         <span class="keywordflow">else</span>
<a name="l00205"></a>00205 <span class="preprocessor">#endif</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>        {
<a name="l00207"></a>00207             <a class="code" href="../../d5/d63/UI__view2d_8h.html#aa16ac5e71fe909468df26b217762283d">UI_view2d_to_region_no_clip</a>((<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, vec[0], vec[1], out, out+1);
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         adr[0]= out[0];
<a name="l00211"></a>00211         adr[1]= out[1];
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>)) {
<a name="l00214"></a>00214         <span class="keywordtype">int</span> out[2] = {0, 0};
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <a class="code" href="../../d5/d63/UI__view2d_8h.html#aa16ac5e71fe909468df26b217762283d">UI_view2d_to_region_no_clip</a>((<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, vec[0], vec[1], out, out+1);
<a name="l00217"></a>00217         adr[0]= out[0];
<a name="l00218"></a>00218         adr[1]= out[1];
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) { <span class="comment">/* XXX not tested yet, but should work */</span>
<a name="l00221"></a>00221         <span class="keywordtype">int</span> out[2] = {0, 0};
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <a class="code" href="../../d5/d63/UI__view2d_8h.html#aa16ac5e71fe909468df26b217762283d">UI_view2d_to_region_no_clip</a>((<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, vec[0], vec[1], out, out+1);
<a name="l00224"></a>00224         adr[0]= out[0];
<a name="l00225"></a>00225         adr[1]= out[1];
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l00228"></a>00228         <a class="code" href="../../d5/d63/UI__view2d_8h.html#aa16ac5e71fe909468df26b217762283d">UI_view2d_to_region_no_clip</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>, vec[0], vec[1], adr, adr+1);
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="../../d2/d80/transform_8h.html#ad9de692f67cb479efe8f385ec42990f7">00232</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ad9de692f67cb479efe8f385ec42990f7">projectFloatView</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">float</span> adr[2])
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <span class="keywordflow">switch</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>) {
<a name="l00235"></a>00235         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>:
<a name="l00236"></a>00236         {
<a name="l00237"></a>00237             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l00238"></a>00238                 <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a4551d98f490ec042932367ef422a8ba1">project_float_noclip</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>, vec, adr);
<a name="l00239"></a>00239                 <span class="keywordflow">return</span>;
<a name="l00240"></a>00240             }
<a name="l00241"></a>00241             <span class="keywordflow">break</span>;
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>:
<a name="l00244"></a>00244         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>:
<a name="l00245"></a>00245         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>:
<a name="l00246"></a>00246         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>:
<a name="l00247"></a>00247         {
<a name="l00248"></a>00248             <span class="keywordtype">int</span> a[2];
<a name="l00249"></a>00249             <a class="code" href="../../d8/d27/transform_8c.html#aef669f8489b01fcab46ccd288d46f91e">projectIntView</a>(t, vec, a);
<a name="l00250"></a>00250             adr[0] = a[0];
<a name="l00251"></a>00251             adr[1] = a[1];
<a name="l00252"></a>00252             <span class="keywordflow">return</span>;
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab56b423771c4d41aa565151535978954">zero_v2</a>(adr);
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="../../d2/d80/transform_8h.html#aa4c74f319c54fa9d81e08a1f3b707c24">00259</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aa4c74f319c54fa9d81e08a1f3b707c24">applyAspectRatio</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> *vec)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) &amp;&amp; (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>==<a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>)) {
<a name="l00262"></a>00262         <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00263"></a>00263         <span class="keywordtype">float</span> aspx, aspy;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span> ((sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a709bfa31c46b65c637a31a5a004f9c48">SI_COORDFLOATS</a>)==0) {
<a name="l00266"></a>00266             <span class="keywordtype">int</span> width, height;
<a name="l00267"></a>00267             <a class="code" href="../../de/d53/ED__image_8h.html#a72aa9c6d1d329f0fce3b5c65b8698318">ED_space_image_size</a>(sima, &amp;width, &amp;height);
<a name="l00268"></a>00268 
<a name="l00269"></a>00269             vec[0] *= width;
<a name="l00270"></a>00270             vec[1] *= height;
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <a class="code" href="../../de/d53/ED__image_8h.html#aad1989be279911287243afb19ac98dee">ED_space_image_uv_aspect</a>(sima, &amp;aspx, &amp;aspy);
<a name="l00274"></a>00274         vec[0] /= aspx;
<a name="l00275"></a>00275         vec[1] /= aspy;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a><a class="code" href="../../d2/d80/transform_8h.html#a33b82d9fef7a019051c5cdee843ce919">00279</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a33b82d9fef7a019051c5cdee843ce919">removeAspectRatio</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> *vec)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) &amp;&amp; (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>==<a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>)) {
<a name="l00282"></a>00282         <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00283"></a>00283         <span class="keywordtype">float</span> aspx, aspy;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285         <span class="keywordflow">if</span> ((sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a709bfa31c46b65c637a31a5a004f9c48">SI_COORDFLOATS</a>)==0) {
<a name="l00286"></a>00286             <span class="keywordtype">int</span> width, height;
<a name="l00287"></a>00287             <a class="code" href="../../de/d53/ED__image_8h.html#a72aa9c6d1d329f0fce3b5c65b8698318">ED_space_image_size</a>(sima, &amp;width, &amp;height);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289             vec[0] /= width;
<a name="l00290"></a>00290             vec[1] /= height;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293         <a class="code" href="../../de/d53/ED__image_8h.html#aad1989be279911287243afb19ac98dee">ED_space_image_uv_aspect</a>(sima, &amp;aspx, &amp;aspy);
<a name="l00294"></a>00294         vec[0] *= aspx;
<a name="l00295"></a>00295         vec[1] *= aspy;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="../../d8/d27/transform_8c.html#ab855f84c4a3ac18752b5dbed497fb6b3">00299</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ab855f84c4a3ac18752b5dbed497fb6b3">viewRedrawForce</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l00300"></a>00300 {
<a name="l00301"></a>00301     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>)
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303         <span class="comment">/* Do we need more refined tags? */</span>
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>)
<a name="l00305"></a>00305             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a72e1ed3dc8d04e8bc84328ec6ef6ce80">ND_POSE</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00306"></a>00306         <span class="keywordflow">else</span>
<a name="l00307"></a>00307             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aad6e17340eb558c0caa7c874dc0812f3">ND_TRANSFORM</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00308"></a>00308         
<a name="l00309"></a>00309         <span class="comment">/* for realtime animation record - send notifiers recognised by animation editors */</span>
<a name="l00310"></a>00310         <span class="comment">// XXX: is this notifier a lame duck?</span>
<a name="l00311"></a>00311         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab13dbb868e48dc3b4053343f3c2a8bd8">animtimer</a>) &amp;&amp; <a class="code" href="../../da/df9/ED__keyframing_8h.html#abccc93bdd6b764e5636de59e671d5112">IS_AUTOKEY_ON</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>))
<a name="l00312"></a>00312             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00313"></a>00313         
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l00316"></a>00316         <span class="comment">//SpaceAction *saction= (SpaceAction *)t-&gt;sa-&gt;spacedata.first;</span>
<a name="l00317"></a>00317         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l00320"></a>00320         <span class="comment">//SpaceIpo *sipo= (SpaceIpo *)t-&gt;sa-&gt;spacedata.first;</span>
<a name="l00321"></a>00321         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l00324"></a>00324         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l00327"></a>00327         <span class="comment">//ED_area_tag_redraw(t-&gt;sa);</span>
<a name="l00328"></a>00328         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#af1c384817f70d0a752fc68681535fcc9">NC_SPACE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a62af2dc91969d53ec0d02d8230b20b0a">ND_SPACE_NODE_VIEW</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l00331"></a>00331         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a008505fc0cf87d3aed5472593449c793">ND_SEQUENCER</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l00334"></a>00334         <span class="comment">// XXX how to deal with lock?</span>
<a name="l00335"></a>00335         <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a>*)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00336"></a>00336         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a0893ac8e618be47c31334a0804c5b598">lock</a>) <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00337"></a>00337         <span class="keywordflow">else</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>);
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l00340"></a>00340         <a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *sc = (<a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a>*)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00341"></a>00341         <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip = <a class="code" href="../../d6/dbe/ED__clip_8h.html#abdc3da548a748cedabcec52330b193c3">ED_space_clip</a>(sc);
<a name="l00342"></a>00342 
<a name="l00343"></a>00343         <span class="comment">/* objects could be parented to tracking data, so send this for viewport refresh */</span>
<a name="l00344"></a>00344         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aad6e17340eb558c0caa7c874dc0812f3">ND_TRANSFORM</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a50b8b6ff8b8949b158250fdc6f315408">NC_MOVIECLIP</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, clip);
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a><a class="code" href="../../d8/d27/transform_8c.html#aa9d916bed77ce25f1fb50452b4fbbe5f">00350</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aa9d916bed77ce25f1fb50452b4fbbe5f">viewRedrawPost</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00353"></a>00353     
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l00355"></a>00355         <span class="comment">/* if autokeying is enabled, send notifiers that keyframes were added */</span>
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (<a class="code" href="../../da/df9/ED__keyframing_8h.html#abccc93bdd6b764e5636de59e671d5112">IS_AUTOKEY_ON</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>))
<a name="l00357"></a>00357             <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00358"></a>00358         
<a name="l00359"></a>00359         <span class="comment">/* XXX temp, first hack to get auto-render in compositor work (ton) */</span>
<a name="l00360"></a>00360         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0532954a4c396a77b6a4d3b411a78447">ND_TRANSFORM_DONE</a>, <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C));
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363     
<a name="l00364"></a>00364 <span class="preprocessor">#if 0 // TRANSFORM_FIX_ME</span>
<a name="l00365"></a>00365 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l00366"></a>00366         allqueue(<a class="code" href="../../d5/d05/interface__templates_8c.html#a8fc8fa69ab2cd7d90c2b6399e2fb47bc">REDRAWBUTSOBJECT</a>, 0);
<a name="l00367"></a>00367         allqueue(REDRAWVIEW3D, 0);
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l00370"></a>00370         allqueue(REDRAWIMAGE, 0);
<a name="l00371"></a>00371         allqueue(REDRAWVIEW3D, 0);
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>)) {
<a name="l00374"></a>00374         allqueue(REDRAWVIEW3D, 0);
<a name="l00375"></a>00375         allqueue(<a class="code" href="../../d5/d05/interface__templates_8c.html#a0c38a4c5c366a654b7bdb4f7125b2d70">REDRAWACTION</a>, 0);
<a name="l00376"></a>00376         allqueue(<a class="code" href="../../d5/d05/interface__templates_8c.html#ab8d41497f4db8b1112263845757564b5">REDRAWNLA</a>, 0);
<a name="l00377"></a>00377         allqueue(<a class="code" href="../../d5/d05/interface__templates_8c.html#a7e16771221d356dbe6792dd99ab5b02e">REDRAWIPO</a>, 0);
<a name="l00378"></a>00378         allqueue(REDRAWTIME, 0);
<a name="l00379"></a>00379         allqueue(<a class="code" href="../../d5/d05/interface__templates_8c.html#a8fc8fa69ab2cd7d90c2b6399e2fb47bc">REDRAWBUTSOBJECT</a>, 0);
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     scrarea_queue_headredraw(curarea);
<a name="l00383"></a>00383 <span class="preprocessor">#endif</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>}
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="comment">/* ************************** TRANSFORMATIONS **************************** */</span>
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="../../d8/d27/transform_8c.html#a4f6f83ed9d251c67a16b46e70025159d">00388</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#a4f6f83ed9d251c67a16b46e70025159d">BIF_selectOrientation</a>(<span class="keywordtype">void</span>)
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390 <span class="preprocessor">#if 0 // TRANSFORM_FIX_ME</span>
<a name="l00391"></a>00391 <span class="preprocessor"></span>    <span class="keywordtype">short</span> val;
<a name="l00392"></a>00392     <span class="keywordtype">char</span> *str_menu = <a class="code" href="../../d8/df2/ED__transform_8h.html#a8e7bbdd4da1af6c92123751809395214">BIF_menustringTransformOrientation</a>(<span class="stringliteral">&quot;Orientation&quot;</span>);
<a name="l00393"></a>00393     val= <a class="code" href="../../d6/db5/object__edit_8c.html#a6f935fee7a3c6e413fac3693c8305992">pupmenu</a>(str_menu);
<a name="l00394"></a>00394     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(str_menu);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (val &gt;= 0) {
<a name="l00397"></a>00397         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.vd-&gt;twmode = val;
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399 <span class="preprocessor">#endif</span>
<a name="l00400"></a>00400 <span class="preprocessor"></span>}
<a name="l00401"></a>00401 
<a name="l00402"></a><a class="code" href="../../d8/d27/transform_8c.html#af05d2375f2524fe55305d6548fc87127">00402</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#af05d2375f2524fe55305d6548fc87127">view_editmove</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404 <span class="preprocessor">#if 0 // TRANSFORM_FIX_ME</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>    <span class="keywordtype">int</span> refresh = 0;
<a name="l00406"></a>00406     <span class="comment">/* Regular:   Zoom in */</span>
<a name="l00407"></a>00407     <span class="comment">/* Shift:     Scroll up */</span>
<a name="l00408"></a>00408     <span class="comment">/* Ctrl:      Scroll right */</span>
<a name="l00409"></a>00409     <span class="comment">/* Alt-Shift: Rotate up */</span>
<a name="l00410"></a>00410     <span class="comment">/* Alt-Ctrl:  Rotate right */</span>
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="comment">/* only work in 3D window for now</span>
<a name="l00413"></a>00413 <span class="comment">     * In the end, will have to send to event to a 2D window handler instead</span>
<a name="l00414"></a>00414 <span class="comment">     */</span>
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (Trans.flag &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>)
<a name="l00416"></a>00416         <span class="keywordflow">return</span>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">switch</span>(event) {
<a name="l00419"></a>00419         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>:
<a name="l00420"></a>00420 
<a name="l00421"></a>00421             <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#a11197f539a6c26a82ccf53f080e48851">LR_SHIFTKEY</a> ) {
<a name="l00422"></a>00422                 <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#ada29714be189b880b820b83d725fa623">LR_ALTKEY</a> ) {
<a name="l00423"></a>00423                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp;= ~<a class="code" href="../../db/da9/text__python_8c.html#a11197f539a6c26a82ccf53f080e48851">LR_SHIFTKEY</a>;
<a name="l00424"></a>00424                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a99e5b4d67a9e666386ddf2101b962d6f">PAD2</a>);
<a name="l00425"></a>00425                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual |= <a class="code" href="../../db/da9/text__python_8c.html#a11197f539a6c26a82ccf53f080e48851">LR_SHIFTKEY</a>;
<a name="l00426"></a>00426                 }
<a name="l00427"></a>00427                 <span class="keywordflow">else</span> {
<a name="l00428"></a>00428                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a99e5b4d67a9e666386ddf2101b962d6f">PAD2</a>);
<a name="l00429"></a>00429                 }
<a name="l00430"></a>00430             }
<a name="l00431"></a>00431             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#afbe06b1cdfff4d615d6fa164c1002131">LR_CTRLKEY</a> ) {
<a name="l00432"></a>00432                 <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#ada29714be189b880b820b83d725fa623">LR_ALTKEY</a> ) {
<a name="l00433"></a>00433                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp;= ~<a class="code" href="../../db/da9/text__python_8c.html#afbe06b1cdfff4d615d6fa164c1002131">LR_CTRLKEY</a>;
<a name="l00434"></a>00434                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a59adfc10114409298d29e8a34f9420aa">PAD4</a>);
<a name="l00435"></a>00435                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual |= <a class="code" href="../../db/da9/text__python_8c.html#afbe06b1cdfff4d615d6fa164c1002131">LR_CTRLKEY</a>;
<a name="l00436"></a>00436                 }
<a name="l00437"></a>00437                 <span class="keywordflow">else</span> {
<a name="l00438"></a>00438                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a59adfc10114409298d29e8a34f9420aa">PAD4</a>);
<a name="l00439"></a>00439                 }
<a name="l00440"></a>00440             }
<a name="l00441"></a>00441             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a3d7bbff672d4115b7a45082144a4674e">USER_WHEELZOOMDIR</a>)
<a name="l00442"></a>00442                 persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>);
<a name="l00443"></a>00443             <span class="keywordflow">else</span>
<a name="l00444"></a>00444                 persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446             refresh = 1;
<a name="l00447"></a>00447             <span class="keywordflow">break</span>;
<a name="l00448"></a>00448         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>:
<a name="l00449"></a>00449             <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#a11197f539a6c26a82ccf53f080e48851">LR_SHIFTKEY</a> ) {
<a name="l00450"></a>00450                 <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#ada29714be189b880b820b83d725fa623">LR_ALTKEY</a> ) {
<a name="l00451"></a>00451                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp;= ~<a class="code" href="../../db/da9/text__python_8c.html#a11197f539a6c26a82ccf53f080e48851">LR_SHIFTKEY</a>;
<a name="l00452"></a>00452                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#abbff1efb9138f1ccbe1f01fd17b912d8">PAD8</a>);
<a name="l00453"></a>00453                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual |= <a class="code" href="../../db/da9/text__python_8c.html#a11197f539a6c26a82ccf53f080e48851">LR_SHIFTKEY</a>;
<a name="l00454"></a>00454                 }
<a name="l00455"></a>00455                 <span class="keywordflow">else</span> {
<a name="l00456"></a>00456                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#abbff1efb9138f1ccbe1f01fd17b912d8">PAD8</a>);
<a name="l00457"></a>00457                 }
<a name="l00458"></a>00458             }
<a name="l00459"></a>00459             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#afbe06b1cdfff4d615d6fa164c1002131">LR_CTRLKEY</a> ) {
<a name="l00460"></a>00460                 <span class="keywordflow">if</span> ( <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp; <a class="code" href="../../db/da9/text__python_8c.html#ada29714be189b880b820b83d725fa623">LR_ALTKEY</a> ) {
<a name="l00461"></a>00461                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual &amp;= ~<a class="code" href="../../db/da9/text__python_8c.html#afbe06b1cdfff4d615d6fa164c1002131">LR_CTRLKEY</a>;
<a name="l00462"></a>00462                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a2b9bf38285d3ef4cc630ba4b1ed1d41c">PAD6</a>);
<a name="l00463"></a>00463                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.qual |= <a class="code" href="../../db/da9/text__python_8c.html#afbe06b1cdfff4d615d6fa164c1002131">LR_CTRLKEY</a>;
<a name="l00464"></a>00464                 }
<a name="l00465"></a>00465                 <span class="keywordflow">else</span> {
<a name="l00466"></a>00466                     persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a2b9bf38285d3ef4cc630ba4b1ed1d41c">PAD6</a>);
<a name="l00467"></a>00467                 }
<a name="l00468"></a>00468             }
<a name="l00469"></a>00469             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a3d7bbff672d4115b7a45082144a4674e">USER_WHEELZOOMDIR</a>)
<a name="l00470"></a>00470                 persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>);
<a name="l00471"></a>00471             <span class="keywordflow">else</span>
<a name="l00472"></a>00472                 persptoetsen(<a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474             refresh = 1;
<a name="l00475"></a>00475             <span class="keywordflow">break</span>;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordflow">if</span> (refresh)
<a name="l00479"></a>00479         <a class="code" href="../../d8/d27/transform_8c.html#abe8c1415473ba2c5ff0c240a0adfad25">setTransformViewMatrices</a>(&amp;Trans);
<a name="l00480"></a>00480 <span class="preprocessor">#endif</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>}
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 <span class="comment">/* ************************************************* */</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="comment">/* NOTE: these defines are saved in keymap files, do not change values but just add new ones */</span>
<a name="l00486"></a><a class="code" href="../../d8/d27/transform_8c.html#a9e39f4ec2e81c23e66cd957bb725072a">00486</a> <span class="preprocessor">#define TFM_MODAL_CANCEL        1</span>
<a name="l00487"></a><a class="code" href="../../d8/d27/transform_8c.html#af39ac69a692b009969beee0e8dfd42d3">00487</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_CONFIRM       2</span>
<a name="l00488"></a><a class="code" href="../../d8/d27/transform_8c.html#ab579e76e5b2681eb3236d71f68bec7f7">00488</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_TRANSLATE     3</span>
<a name="l00489"></a><a class="code" href="../../d8/d27/transform_8c.html#a34ef5dd9f6a2a792e6dfc92d11dfa1c4">00489</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_ROTATE        4</span>
<a name="l00490"></a><a class="code" href="../../d8/d27/transform_8c.html#ac2a6783d085a37a6636ce8c7b298a7cf">00490</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_RESIZE        5</span>
<a name="l00491"></a><a class="code" href="../../d8/d27/transform_8c.html#a6a172c1b98bdadd58c2ac8c48dfd5585">00491</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_SNAP_INV_ON   6</span>
<a name="l00492"></a><a class="code" href="../../d8/d27/transform_8c.html#a3560079990be0f9586cf1e1bbdee0302">00492</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_SNAP_INV_OFF  7</span>
<a name="l00493"></a><a class="code" href="../../d8/d27/transform_8c.html#a3abd1d638ec99d706e9f1ca5707ca4f8">00493</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_SNAP_TOGGLE   8</span>
<a name="l00494"></a><a class="code" href="../../d8/d27/transform_8c.html#a8e01db7d53be010b1b60ebd9cd41dc62">00494</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_AXIS_X        9</span>
<a name="l00495"></a><a class="code" href="../../d8/d27/transform_8c.html#ae8630cc646db5811b311e7efa476188f">00495</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_AXIS_Y        10</span>
<a name="l00496"></a><a class="code" href="../../d8/d27/transform_8c.html#a1af32cdb958236d696d9015e22273e48">00496</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_AXIS_Z        11</span>
<a name="l00497"></a><a class="code" href="../../d8/d27/transform_8c.html#a20a66034b8a6dceb2ddc41b368759099">00497</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_PLANE_X       12</span>
<a name="l00498"></a><a class="code" href="../../d8/d27/transform_8c.html#a7380273aa7ba76cda567febcf61549b8">00498</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_PLANE_Y       13</span>
<a name="l00499"></a><a class="code" href="../../d8/d27/transform_8c.html#a86cb9c41bcfa5b949c6661d9e7f6f42d">00499</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_PLANE_Z       14</span>
<a name="l00500"></a><a class="code" href="../../d8/d27/transform_8c.html#a426c318e285756c71d20333deafe5cbb">00500</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_CONS_OFF      15</span>
<a name="l00501"></a><a class="code" href="../../d8/d27/transform_8c.html#af444a000b3c283930b16fde3ad018ba6">00501</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_ADD_SNAP      16</span>
<a name="l00502"></a><a class="code" href="../../d8/d27/transform_8c.html#a63fa2f1e0501d33ecefded844a49501a">00502</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_REMOVE_SNAP   17</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span><span class="comment">/*  18 and 19 used by numinput, defined in transform.h</span>
<a name="l00504"></a>00504 <span class="comment"> * */</span>
<a name="l00505"></a><a class="code" href="../../d8/d27/transform_8c.html#aa0c7e697ce00aa0bec36418970a7b6f1">00505</a> <span class="preprocessor">#define TFM_MODAL_PROPSIZE_UP   20</span>
<a name="l00506"></a><a class="code" href="../../d8/d27/transform_8c.html#adc268d1455af1457e179a25e29056bfb">00506</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_PROPSIZE_DOWN 21</span>
<a name="l00507"></a><a class="code" href="../../d8/d27/transform_8c.html#ac2bef0d9ea2bddb446423fb02e1dfc1d">00507</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_AUTOIK_LEN_INC 22</span>
<a name="l00508"></a><a class="code" href="../../d8/d27/transform_8c.html#ac00d9f0ea1df1d25d34ba4f556cb1393">00508</a> <span class="preprocessor"></span><span class="preprocessor">#define TFM_MODAL_AUTOIK_LEN_DEC 23</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>
<a name="l00510"></a>00510 <span class="comment">/* called in transform_ops.c, on each regeneration of keymaps */</span>
<a name="l00511"></a><a class="code" href="../../d2/d80/transform_8h.html#aba4dcd9d0bc81fb336a69dbf6d03a238">00511</a> <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a>* <a class="code" href="../../d8/d27/transform_8c.html#a0b9bd0c3f72938bcb30dc1c1964a6554">transform_modal_keymap</a>(<a class="code" href="../../d3/df7/structwmKeyConfig.html">wmKeyConfig</a> *keyconf)
<a name="l00512"></a>00512 {
<a name="l00513"></a>00513     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> modal_items[] = {
<a name="l00514"></a>00514     {<a class="code" href="../../d8/d27/transform_8c.html#a9e39f4ec2e81c23e66cd957bb725072a">TFM_MODAL_CANCEL</a>, <span class="stringliteral">&quot;CANCEL&quot;</span>, 0, <span class="stringliteral">&quot;Cancel&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00515"></a>00515     {<a class="code" href="../../d8/d27/transform_8c.html#af39ac69a692b009969beee0e8dfd42d3">TFM_MODAL_CONFIRM</a>, <span class="stringliteral">&quot;CONFIRM&quot;</span>, 0, <span class="stringliteral">&quot;Confirm&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00516"></a>00516     {<a class="code" href="../../d8/d27/transform_8c.html#ab579e76e5b2681eb3236d71f68bec7f7">TFM_MODAL_TRANSLATE</a>, <span class="stringliteral">&quot;TRANSLATE&quot;</span>, 0, <span class="stringliteral">&quot;Translate&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00517"></a>00517     {<a class="code" href="../../d8/d27/transform_8c.html#a34ef5dd9f6a2a792e6dfc92d11dfa1c4">TFM_MODAL_ROTATE</a>, <span class="stringliteral">&quot;ROTATE&quot;</span>, 0, <span class="stringliteral">&quot;Rotate&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00518"></a>00518     {<a class="code" href="../../d8/d27/transform_8c.html#ac2a6783d085a37a6636ce8c7b298a7cf">TFM_MODAL_RESIZE</a>, <span class="stringliteral">&quot;RESIZE&quot;</span>, 0, <span class="stringliteral">&quot;Resize&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00519"></a>00519     {<a class="code" href="../../d8/d27/transform_8c.html#a6a172c1b98bdadd58c2ac8c48dfd5585">TFM_MODAL_SNAP_INV_ON</a>, <span class="stringliteral">&quot;SNAP_INV_ON&quot;</span>, 0, <span class="stringliteral">&quot;Invert Snap On&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00520"></a>00520     {<a class="code" href="../../d8/d27/transform_8c.html#a3560079990be0f9586cf1e1bbdee0302">TFM_MODAL_SNAP_INV_OFF</a>, <span class="stringliteral">&quot;SNAP_INV_OFF&quot;</span>, 0, <span class="stringliteral">&quot;Invert Snap Off&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00521"></a>00521     {<a class="code" href="../../d8/d27/transform_8c.html#a3abd1d638ec99d706e9f1ca5707ca4f8">TFM_MODAL_SNAP_TOGGLE</a>, <span class="stringliteral">&quot;SNAP_TOGGLE&quot;</span>, 0, <span class="stringliteral">&quot;Snap Toggle&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00522"></a>00522     {<a class="code" href="../../d8/d27/transform_8c.html#a8e01db7d53be010b1b60ebd9cd41dc62">TFM_MODAL_AXIS_X</a>, <span class="stringliteral">&quot;AXIS_X&quot;</span>, 0, <span class="stringliteral">&quot;Orientation X axis&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00523"></a>00523     {<a class="code" href="../../d8/d27/transform_8c.html#ae8630cc646db5811b311e7efa476188f">TFM_MODAL_AXIS_Y</a>, <span class="stringliteral">&quot;AXIS_Y&quot;</span>, 0, <span class="stringliteral">&quot;Orientation Y axis&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00524"></a>00524     {<a class="code" href="../../d8/d27/transform_8c.html#a1af32cdb958236d696d9015e22273e48">TFM_MODAL_AXIS_Z</a>, <span class="stringliteral">&quot;AXIS_Z&quot;</span>, 0, <span class="stringliteral">&quot;Orientation Z axis&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00525"></a>00525     {<a class="code" href="../../d8/d27/transform_8c.html#a20a66034b8a6dceb2ddc41b368759099">TFM_MODAL_PLANE_X</a>, <span class="stringliteral">&quot;PLANE_X&quot;</span>, 0, <span class="stringliteral">&quot;Orientation X plane&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00526"></a>00526     {<a class="code" href="../../d8/d27/transform_8c.html#a7380273aa7ba76cda567febcf61549b8">TFM_MODAL_PLANE_Y</a>, <span class="stringliteral">&quot;PLANE_Y&quot;</span>, 0, <span class="stringliteral">&quot;Orientation Y plane&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00527"></a>00527     {<a class="code" href="../../d8/d27/transform_8c.html#a86cb9c41bcfa5b949c6661d9e7f6f42d">TFM_MODAL_PLANE_Z</a>, <span class="stringliteral">&quot;PLANE_Z&quot;</span>, 0, <span class="stringliteral">&quot;Orientation Z plane&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00528"></a>00528     {<a class="code" href="../../d8/d27/transform_8c.html#a426c318e285756c71d20333deafe5cbb">TFM_MODAL_CONS_OFF</a>, <span class="stringliteral">&quot;CONS_OFF&quot;</span>, 0, <span class="stringliteral">&quot;Remove Constraints&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00529"></a>00529     {<a class="code" href="../../d8/d27/transform_8c.html#af444a000b3c283930b16fde3ad018ba6">TFM_MODAL_ADD_SNAP</a>, <span class="stringliteral">&quot;ADD_SNAP&quot;</span>, 0, <span class="stringliteral">&quot;Add Snap Point&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00530"></a>00530     {<a class="code" href="../../d8/d27/transform_8c.html#a63fa2f1e0501d33ecefded844a49501a">TFM_MODAL_REMOVE_SNAP</a>, <span class="stringliteral">&quot;REMOVE_SNAP&quot;</span>, 0, <span class="stringliteral">&quot;Remove Last Snap Point&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00531"></a>00531     {<a class="code" href="../../db/d36/ED__numinput_8h.html#ad39b3d648303e920c4264214996e16af">NUM_MODAL_INCREMENT_UP</a>, <span class="stringliteral">&quot;INCREMENT_UP&quot;</span>, 0, <span class="stringliteral">&quot;Numinput Increment Up&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00532"></a>00532     {<a class="code" href="../../db/d36/ED__numinput_8h.html#a7ef4504c129bdb0dd25f230a50685a5c">NUM_MODAL_INCREMENT_DOWN</a>, <span class="stringliteral">&quot;INCREMENT_DOWN&quot;</span>, 0, <span class="stringliteral">&quot;Numinput Increment Down&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00533"></a>00533     {<a class="code" href="../../d8/d27/transform_8c.html#aa0c7e697ce00aa0bec36418970a7b6f1">TFM_MODAL_PROPSIZE_UP</a>, <span class="stringliteral">&quot;PROPORTIONAL_SIZE_UP&quot;</span>, 0, <span class="stringliteral">&quot;Increase Proportional Influence&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00534"></a>00534     {<a class="code" href="../../d8/d27/transform_8c.html#adc268d1455af1457e179a25e29056bfb">TFM_MODAL_PROPSIZE_DOWN</a>, <span class="stringliteral">&quot;PROPORTIONAL_SIZE_DOWN&quot;</span>, 0, <span class="stringliteral">&quot;Decrease Proportional Influence&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00535"></a>00535     {<a class="code" href="../../d8/d27/transform_8c.html#ac2bef0d9ea2bddb446423fb02e1dfc1d">TFM_MODAL_AUTOIK_LEN_INC</a>, <span class="stringliteral">&quot;AUTOIK_CHAIN_LEN_UP&quot;</span>, 0, <span class="stringliteral">&quot;Increase Max AutoIK Chain Length&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00536"></a>00536     {<a class="code" href="../../d8/d27/transform_8c.html#ac00d9f0ea1df1d25d34ba4f556cb1393">TFM_MODAL_AUTOIK_LEN_DEC</a>, <span class="stringliteral">&quot;AUTOIK_CHAIN_LEN_DOWN&quot;</span>, 0, <span class="stringliteral">&quot;Decrease Max AutoIK Chain Length&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00537"></a>00537     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l00538"></a>00538     
<a name="l00539"></a>00539     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap= <a class="code" href="../../d7/d78/wm__keymap_8c.html#a6d008f32aa2e883408e43ea060d7b87c">WM_modalkeymap_get</a>(keyconf, <span class="stringliteral">&quot;Transform Modal Map&quot;</span>);
<a name="l00540"></a>00540     
<a name="l00541"></a>00541     <span class="comment">/* this function is called for each spacetype, only needs to add map once */</span>
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (keymap &amp;&amp; keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a57f97680d51c38bebb32d9dd4a546fd4">modal_items</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00543"></a>00543     
<a name="l00544"></a>00544     keymap= <a class="code" href="../../d7/d78/wm__keymap_8c.html#aba987a8051ff9224f3793af46ad80ef0">WM_modalkeymap_add</a>(keyconf, <span class="stringliteral">&quot;Transform Modal Map&quot;</span>, modal_items);
<a name="l00545"></a>00545     
<a name="l00546"></a>00546     <span class="comment">/* items for modal map */</span>
<a name="l00547"></a>00547     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>,    <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a9e39f4ec2e81c23e66cd957bb725072a">TFM_MODAL_CANCEL</a>);
<a name="l00548"></a>00548     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#af39ac69a692b009969beee0e8dfd42d3">TFM_MODAL_CONFIRM</a>);
<a name="l00549"></a>00549     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#af39ac69a692b009969beee0e8dfd42d3">TFM_MODAL_CONFIRM</a>);
<a name="l00550"></a>00550     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#af39ac69a692b009969beee0e8dfd42d3">TFM_MODAL_CONFIRM</a>);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac4133479f03eb38f20b64e5a1d73ab0a">GKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#ab579e76e5b2681eb3236d71f68bec7f7">TFM_MODAL_TRANSLATE</a>);
<a name="l00553"></a>00553     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9fb42765696ec2a77dff4bc1267864c3">RKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#a34ef5dd9f6a2a792e6dfc92d11dfa1c4">TFM_MODAL_ROTATE</a>);
<a name="l00554"></a>00554     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32a2e419731c7ff93211038f83bb4acc">SKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#ac2a6783d085a37a6636ce8c7b298a7cf">TFM_MODAL_RESIZE</a>);
<a name="l00555"></a>00555     
<a name="l00556"></a>00556     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a67d5864c4d46748f0c7ee7a4fc30561d">TABKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a3abd1d638ec99d706e9f1ca5707ca4f8">TFM_MODAL_SNAP_TOGGLE</a>);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad025960542c5698bad7efc649c641897">LEFTCTRLKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a6a172c1b98bdadd58c2ac8c48dfd5585">TFM_MODAL_SNAP_INV_ON</a>);
<a name="l00559"></a>00559     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad025960542c5698bad7efc649c641897">LEFTCTRLKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a3560079990be0f9586cf1e1bbdee0302">TFM_MODAL_SNAP_INV_OFF</a>);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aacc3c8c5f05ebb7eeca8e4da6dc9c969">RIGHTCTRLKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a6a172c1b98bdadd58c2ac8c48dfd5585">TFM_MODAL_SNAP_INV_ON</a>);
<a name="l00562"></a>00562     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aacc3c8c5f05ebb7eeca8e4da6dc9c969">RIGHTCTRLKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a3d6df9a8fc4231a9444e40c95043109f">KM_ANY</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a3560079990be0f9586cf1e1bbdee0302">TFM_MODAL_SNAP_INV_OFF</a>);
<a name="l00563"></a>00563     
<a name="l00564"></a>00564     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a746a67a50a93dd2cac52c218ef94a218">AKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#af444a000b3c283930b16fde3ad018ba6">TFM_MODAL_ADD_SNAP</a>);
<a name="l00565"></a>00565     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a746a67a50a93dd2cac52c218ef94a218">AKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#afa066cdfa1a8af7a98e45c83860b4abe">KM_ALT</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#a63fa2f1e0501d33ecefded844a49501a">TFM_MODAL_REMOVE_SNAP</a>);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#aa0c7e697ce00aa0bec36418970a7b6f1">TFM_MODAL_PROPSIZE_UP</a>);
<a name="l00568"></a>00568     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#adc268d1455af1457e179a25e29056bfb">TFM_MODAL_PROPSIZE_DOWN</a>);
<a name="l00569"></a>00569     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#aa0c7e697ce00aa0bec36418970a7b6f1">TFM_MODAL_PROPSIZE_UP</a>);
<a name="l00570"></a>00570     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0, <a class="code" href="../../d8/d27/transform_8c.html#adc268d1455af1457e179a25e29056bfb">TFM_MODAL_PROPSIZE_DOWN</a>);
<a name="l00571"></a>00571     
<a name="l00572"></a>00572     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#ac2bef0d9ea2bddb446423fb02e1dfc1d">TFM_MODAL_AUTOIK_LEN_INC</a>);
<a name="l00573"></a>00573     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#ac00d9f0ea1df1d25d34ba4f556cb1393">TFM_MODAL_AUTOIK_LEN_DEC</a>);
<a name="l00574"></a>00574     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#ac2bef0d9ea2bddb446423fb02e1dfc1d">TFM_MODAL_AUTOIK_LEN_INC</a>);
<a name="l00575"></a>00575     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a2f9326009327f701d94d0056c11848d7">WM_modalkeymap_add_item</a>(keymap, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>, 0, <a class="code" href="../../d8/d27/transform_8c.html#ac00d9f0ea1df1d25d34ba4f556cb1393">TFM_MODAL_AUTOIK_LEN_DEC</a>);
<a name="l00576"></a>00576     
<a name="l00577"></a>00577     <span class="keywordflow">return</span> keymap;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="../../d2/d80/transform_8h.html#a306fa1ff1a23beca472d17125dc355e5">00581</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#accdbf18650229bc1ceb650a05b8d5dfe">transformEvent</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00582"></a>00582 {
<a name="l00583"></a>00583     <span class="keywordtype">float</span> mati[3][3]= <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a9351eb4f9017989083e1d3a7369fc9ed">MAT3_UNITY</a>;
<a name="l00584"></a>00584     <span class="keywordtype">char</span> cmode = <a class="code" href="../../d2/d80/transform_8h.html#a3351044bd305e5b9b6977c04043f39f3">constraintModeToChar</a>(t);
<a name="l00585"></a>00585     <span class="keywordtype">int</span> handled = 1;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a978de1dab432a413bc59b260fc9ff8c9">handleMouseInput</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, event);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>)
<a name="l00590"></a>00590     {
<a name="l00591"></a>00591         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a54b0f4faa4a732efb2d67110ac12a9e5">MOD_CONSTRAINT_SELECT</a>)
<a name="l00592"></a>00592             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> |= <a class="code" href="../../d2/d80/transform_8h.html#aea63165526bdb5831523a971bb843f1b">CON_SELECT</a>;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a61f53fd66f5167cc8e68279a88d719a0">copy_v2_v2_int</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <span class="comment">// t-&gt;redraw |= TREDRAW_SOFT; /* Use this for soft redraw. Might cause flicker in object mode */</span>
<a name="l00597"></a>00597         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> == <a class="code" href="../../d2/d80/transform_8h.html#acb57f5e71b75350ca336aca01d168d69">TRANS_STARTING</a>) {
<a name="l00601"></a>00601             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a3a94d1a89ea3f29eefdcac58bbc3845f">TRANS_RUNNING</a>;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604         <a class="code" href="../../d2/d80/transform_8h.html#a49b2f7f203c2510d79f4709f8c22cae8">applyMouseInput</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         <span class="comment">// Snapping mouse move events</span>
<a name="l00607"></a>00607         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a54d3efc9a40c6a2888af12b69ed0d221">handleSnapping</a>(t, event);
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <span class="comment">/* handle modal keymap first */</span>
<a name="l00611"></a>00611     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5ec351ea2051b0b75965a8ad0a7b4a6c">EVT_MODAL_MAP</a>) {
<a name="l00612"></a>00612         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>) {
<a name="l00613"></a>00613             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a9e39f4ec2e81c23e66cd957bb725072a">TFM_MODAL_CANCEL</a>:
<a name="l00614"></a>00614                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l00615"></a>00615                 <span class="keywordflow">break</span>;
<a name="l00616"></a>00616             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#af39ac69a692b009969beee0e8dfd42d3">TFM_MODAL_CONFIRM</a>:
<a name="l00617"></a>00617                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#aea194444de4ea92edf4d927305106e83">TRANS_CONFIRM</a>;
<a name="l00618"></a>00618                 <span class="keywordflow">break</span>;
<a name="l00619"></a>00619             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#ab579e76e5b2681eb3236d71f68bec7f7">TFM_MODAL_TRANSLATE</a>:
<a name="l00620"></a>00620                 <span class="comment">/* only switch when... */</span>
<a name="l00621"></a>00621                 <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a002f81b26542b400faa00b3e7209fbbf">TFM_RESIZE</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>) ) {
<a name="l00622"></a>00622                     <a class="code" href="../../d2/d80/transform_8h.html#a310eeef95fd01a8bb9c220466ddc5e72">resetTransRestrictions</a>(t);
<a name="l00623"></a>00623                     <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00624"></a>00624                     <a class="code" href="../../d8/d27/transform_8c.html#a6e79b804b31355f3c48c4e6455b18ba6">initTranslation</a>(t);
<a name="l00625"></a>00625                     <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// need to reinit after mode change</span>
<a name="l00626"></a>00626                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00627"></a>00627                 }
<a name="l00628"></a>00628                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> == <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>) {
<a name="l00629"></a>00629                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a>&amp;<a class="code" href="../../d8/df2/ED__transform_8h.html#aa845d497ca7d08b6ff5673425c7674ae">CTX_MOVIECLIP</a>) {
<a name="l00630"></a>00630                         <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632                         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a>^= <a class="code" href="../../d2/d80/transform_8h.html#a729478100f8a8a11b9a1bcb84256f4e4">T_ALT_TRANSFORM</a>;
<a name="l00633"></a>00633                         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00634"></a>00634                     }
<a name="l00635"></a>00635                 }
<a name="l00636"></a>00636                 <span class="keywordflow">break</span>;
<a name="l00637"></a>00637             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a34ef5dd9f6a2a792e6dfc92d11dfa1c4">TFM_MODAL_ROTATE</a>:
<a name="l00638"></a>00638                 <span class="comment">/* only switch when... */</span>
<a name="l00639"></a>00639                 <span class="keywordflow">if</span> (!(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> &amp; <a class="code" href="../../d8/df2/ED__transform_8h.html#ad72aa2d5f0a19fb0e785f5ca7ceb200f">CTX_TEXTURE</a>) &amp;&amp; !(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> &amp; <a class="code" href="../../d8/df2/ED__transform_8h.html#aa845d497ca7d08b6ff5673425c7674ae">CTX_MOVIECLIP</a>)) {
<a name="l00640"></a>00640                     <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a002f81b26542b400faa00b3e7209fbbf">TFM_RESIZE</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>) ) {
<a name="l00641"></a>00641                         
<a name="l00642"></a>00642                         <a class="code" href="../../d2/d80/transform_8h.html#a310eeef95fd01a8bb9c220466ddc5e72">resetTransRestrictions</a>(t);
<a name="l00643"></a>00643                         
<a name="l00644"></a>00644                         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> == <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>) {
<a name="l00645"></a>00645                             <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00646"></a>00646                             <a class="code" href="../../d8/d27/transform_8c.html#a4f667262c34ee4cae1bace342cd02872">initTrackball</a>(t);
<a name="l00647"></a>00647                         }
<a name="l00648"></a>00648                         <span class="keywordflow">else</span> {
<a name="l00649"></a>00649                             <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00650"></a>00650                             <a class="code" href="../../d8/d27/transform_8c.html#adc9eb52f311d8812a078a63adbba18f8">initRotation</a>(t);
<a name="l00651"></a>00651                         }
<a name="l00652"></a>00652                         <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// need to reinit after mode change</span>
<a name="l00653"></a>00653                         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00654"></a>00654                     }
<a name="l00655"></a>00655                 }
<a name="l00656"></a>00656                 <span class="keywordflow">break</span>;
<a name="l00657"></a>00657             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#ac2a6783d085a37a6636ce8c7b298a7cf">TFM_MODAL_RESIZE</a>:
<a name="l00658"></a>00658                 <span class="comment">/* only switch when... */</span>
<a name="l00659"></a>00659                 <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>) ) {
<a name="l00660"></a>00660                     <a class="code" href="../../d2/d80/transform_8h.html#a310eeef95fd01a8bb9c220466ddc5e72">resetTransRestrictions</a>(t);
<a name="l00661"></a>00661                     <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00662"></a>00662                     <a class="code" href="../../d8/d27/transform_8c.html#a07a126d25aafc67aae1b520d37d4b656">initResize</a>(t);
<a name="l00663"></a>00663                     <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// need to reinit after mode change</span>
<a name="l00664"></a>00664                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00665"></a>00665                 }
<a name="l00666"></a>00666                 <span class="keywordflow">break</span>;
<a name="l00667"></a>00667                 
<a name="l00668"></a>00668             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a6a172c1b98bdadd58c2ac8c48dfd5585">TFM_MODAL_SNAP_INV_ON</a>:
<a name="l00669"></a>00669                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> |= <a class="code" href="../../d2/d80/transform_8h.html#adc896c2472a2c2ee0479aa7c2b81fd00">MOD_SNAP_INVERT</a>;
<a name="l00670"></a>00670                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00671"></a>00671                 <span class="keywordflow">break</span>;
<a name="l00672"></a>00672             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a3560079990be0f9586cf1e1bbdee0302">TFM_MODAL_SNAP_INV_OFF</a>:
<a name="l00673"></a>00673                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp;= ~<a class="code" href="../../d2/d80/transform_8h.html#adc896c2472a2c2ee0479aa7c2b81fd00">MOD_SNAP_INVERT</a>;
<a name="l00674"></a>00674                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00675"></a>00675                 <span class="keywordflow">break</span>;
<a name="l00676"></a>00676             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a3abd1d638ec99d706e9f1ca5707ca4f8">TFM_MODAL_SNAP_TOGGLE</a>:
<a name="l00677"></a>00677                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> ^= <a class="code" href="../../d2/d80/transform_8h.html#a73e5c7c6238faf4462f864974093e60d">MOD_SNAP</a>;
<a name="l00678"></a>00678                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00679"></a>00679                 <span class="keywordflow">break</span>;
<a name="l00680"></a>00680             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a8e01db7d53be010b1b60ebd9cd41dc62">TFM_MODAL_AXIS_X</a>:
<a name="l00681"></a>00681                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l00682"></a>00682                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;X&#39;</span>) {
<a name="l00683"></a>00683                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00684"></a>00684                     }
<a name="l00685"></a>00685                     <span class="keywordflow">else</span> {
<a name="l00686"></a>00686                         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>) {
<a name="l00687"></a>00687                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>), <span class="stringliteral">&quot;along X&quot;</span>);
<a name="l00688"></a>00688                         }
<a name="l00689"></a>00689                         <span class="keywordflow">else</span> {
<a name="l00690"></a>00690                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>), <span class="stringliteral">&quot;along %s X&quot;</span>);
<a name="l00691"></a>00691                         }
<a name="l00692"></a>00692                     }
<a name="l00693"></a>00693                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695                 <span class="keywordflow">break</span>;
<a name="l00696"></a>00696             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#ae8630cc646db5811b311e7efa476188f">TFM_MODAL_AXIS_Y</a>:
<a name="l00697"></a>00697                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l00698"></a>00698                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Y&#39;</span>) {
<a name="l00699"></a>00699                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00700"></a>00700                     }
<a name="l00701"></a>00701                     <span class="keywordflow">else</span> {
<a name="l00702"></a>00702                         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>) {
<a name="l00703"></a>00703                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;along Y&quot;</span>);
<a name="l00704"></a>00704                         }
<a name="l00705"></a>00705                         <span class="keywordflow">else</span> {
<a name="l00706"></a>00706                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;along %s Y&quot;</span>);
<a name="l00707"></a>00707                         }
<a name="l00708"></a>00708                     }
<a name="l00709"></a>00709                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00710"></a>00710                 }
<a name="l00711"></a>00711                 <span class="keywordflow">break</span>;
<a name="l00712"></a>00712             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a1af32cdb958236d696d9015e22273e48">TFM_MODAL_AXIS_Z</a>:
<a name="l00713"></a>00713                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>))== 0) {
<a name="l00714"></a>00714                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Z&#39;</span>) {
<a name="l00715"></a>00715                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00716"></a>00716                     }
<a name="l00717"></a>00717                     <span class="keywordflow">else</span> {
<a name="l00718"></a>00718                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;along %s Z&quot;</span>);
<a name="l00719"></a>00719                     }
<a name="l00720"></a>00720                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00721"></a>00721                 }
<a name="l00722"></a>00722                 <span class="keywordflow">break</span>;
<a name="l00723"></a>00723             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a20a66034b8a6dceb2ddc41b368759099">TFM_MODAL_PLANE_X</a>:
<a name="l00724"></a>00724                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>))== 0) {
<a name="l00725"></a>00725                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;X&#39;</span>) {
<a name="l00726"></a>00726                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00727"></a>00727                     }
<a name="l00728"></a>00728                     <span class="keywordflow">else</span> {
<a name="l00729"></a>00729                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>|<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;locking %s X&quot;</span>);
<a name="l00730"></a>00730                     }
<a name="l00731"></a>00731                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00732"></a>00732                 }
<a name="l00733"></a>00733                 <span class="keywordflow">break</span>;
<a name="l00734"></a>00734             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a7380273aa7ba76cda567febcf61549b8">TFM_MODAL_PLANE_Y</a>:
<a name="l00735"></a>00735                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>))== 0) {
<a name="l00736"></a>00736                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Y&#39;</span>) {
<a name="l00737"></a>00737                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00738"></a>00738                     }
<a name="l00739"></a>00739                     <span class="keywordflow">else</span> {
<a name="l00740"></a>00740                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>|<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;locking %s Y&quot;</span>);
<a name="l00741"></a>00741                     }
<a name="l00742"></a>00742                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00743"></a>00743                 }
<a name="l00744"></a>00744                 <span class="keywordflow">break</span>;
<a name="l00745"></a>00745             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a86cb9c41bcfa5b949c6661d9e7f6f42d">TFM_MODAL_PLANE_Z</a>:
<a name="l00746"></a>00746                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>))== 0) {
<a name="l00747"></a>00747                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Z&#39;</span>) {
<a name="l00748"></a>00748                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00749"></a>00749                     }
<a name="l00750"></a>00750                     <span class="keywordflow">else</span> {
<a name="l00751"></a>00751                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>|<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;locking %s Z&quot;</span>);
<a name="l00752"></a>00752                     }
<a name="l00753"></a>00753                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00754"></a>00754                 }
<a name="l00755"></a>00755                 <span class="keywordflow">break</span>;
<a name="l00756"></a>00756             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a426c318e285756c71d20333deafe5cbb">TFM_MODAL_CONS_OFF</a>:
<a name="l00757"></a>00757                 <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l00758"></a>00758                     <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00759"></a>00759                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00760"></a>00760                 }
<a name="l00761"></a>00761                 <span class="keywordflow">break</span>;
<a name="l00762"></a>00762             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#af444a000b3c283930b16fde3ad018ba6">TFM_MODAL_ADD_SNAP</a>:
<a name="l00763"></a>00763                 <a class="code" href="../../d2/d80/transform_8h.html#a3d07ad420101d5689bd0699345c7a3c8">addSnapPoint</a>(t);
<a name="l00764"></a>00764                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00765"></a>00765                 <span class="keywordflow">break</span>;
<a name="l00766"></a>00766             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#a63fa2f1e0501d33ecefded844a49501a">TFM_MODAL_REMOVE_SNAP</a>:
<a name="l00767"></a>00767                 <a class="code" href="../../d2/d80/transform_8h.html#a619e3c1e6d1bfd8e49ea6219ad720a4b">removeSnapPoint</a>(t);
<a name="l00768"></a>00768                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00769"></a>00769                 <span class="keywordflow">break</span>;
<a name="l00770"></a>00770             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#aa0c7e697ce00aa0bec36418970a7b6f1">TFM_MODAL_PROPSIZE_UP</a>:
<a name="l00771"></a>00771                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>) {
<a name="l00772"></a>00772                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>*= 1.1f;
<a name="l00773"></a>00773                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a32829b792f54258663c560080b174019">persp</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#af086af25ae5c28a12be8eb6f7687c6dd">RV3D_ORTHO</a>)
<a name="l00774"></a>00774                         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>, ((<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>)-&gt;far);
<a name="l00775"></a>00775                     <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l00776"></a>00776                 }
<a name="l00777"></a>00777                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00778"></a>00778                 <span class="keywordflow">break</span>;
<a name="l00779"></a>00779             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#adc268d1455af1457e179a25e29056bfb">TFM_MODAL_PROPSIZE_DOWN</a>:
<a name="l00780"></a>00780                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>) {
<a name="l00781"></a>00781                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>*= 0.90909090f;
<a name="l00782"></a>00782                     <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l00783"></a>00783                 }
<a name="l00784"></a>00784                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00785"></a>00785                 <span class="keywordflow">break</span>;
<a name="l00786"></a>00786             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#ac2bef0d9ea2bddb446423fb02e1dfc1d">TFM_MODAL_AUTOIK_LEN_INC</a>:
<a name="l00787"></a>00787                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab2bc160056f077a7f09a10a00cf9c07">T_AUTOIK</a>)
<a name="l00788"></a>00788                     <a class="code" href="../../d2/d80/transform_8h.html#a04cb94193fb7c2106f85b4d52b7af74e">transform_autoik_update</a>(t, 1);
<a name="l00789"></a>00789                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00790"></a>00790                 <span class="keywordflow">break</span>;
<a name="l00791"></a>00791             <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#ac00d9f0ea1df1d25d34ba4f556cb1393">TFM_MODAL_AUTOIK_LEN_DEC</a>:
<a name="l00792"></a>00792                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab2bc160056f077a7f09a10a00cf9c07">T_AUTOIK</a>) 
<a name="l00793"></a>00793                     <a class="code" href="../../d2/d80/transform_8h.html#a04cb94193fb7c2106f85b4d52b7af74e">transform_autoik_update</a>(t, -1);
<a name="l00794"></a>00794                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00795"></a>00795                 <span class="keywordflow">break</span>;
<a name="l00796"></a>00796             <span class="keywordflow">default</span>:
<a name="l00797"></a>00797                 handled = 0;
<a name="l00798"></a>00798                 <span class="keywordflow">break</span>;
<a name="l00799"></a>00799         }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801         <span class="comment">// Modal numinput events</span>
<a name="l00802"></a>00802         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#ac0c74aa4cdf6c6f0650a165f030c09b8">handleNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), event);
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804     <span class="comment">/* else do non-mapped events */</span>
<a name="l00805"></a>00805     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l00806"></a>00806         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l00807"></a>00807         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l00808"></a>00808             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l00809"></a>00809             <span class="keywordflow">break</span>;
<a name="l00810"></a>00810         <span class="comment">/* enforce redraw of transform when modifiers are used */</span>
<a name="l00811"></a>00811         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8bb00d0e3bbc5c558edcef2b6c7d549c">LEFTSHIFTKEY</a>:
<a name="l00812"></a>00812         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a60ddce316227eaa9586286cca0e085f5">RIGHTSHIFTKEY</a>:
<a name="l00813"></a>00813             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>;
<a name="l00814"></a>00814             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00815"></a>00815             <span class="keywordflow">break</span>;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a59b43db62ffa0d14bb076092d862d2cd">SPACEKEY</a>:
<a name="l00818"></a>00818             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l00819"></a>00819 <span class="preprocessor">#if 0 // TRANSFORM_FIX_ME</span>
<a name="l00820"></a>00820 <span class="preprocessor"></span>                <span class="keywordtype">int</span> mval[2];
<a name="l00821"></a>00821 
<a name="l00822"></a>00822                 getmouseco_sc(mval);
<a name="l00823"></a>00823                 <a class="code" href="../../d8/df2/ED__transform_8h.html#a4f6f83ed9d251c67a16b46e70025159d">BIF_selectOrientation</a>();
<a name="l00824"></a>00824                 <a class="code" href="../../d2/d80/transform_8h.html#a8b89354f6c85e7aec3df4626c9ac4e77">calc_manipulator_stats</a>(curarea);
<a name="l00825"></a>00825                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae913d49905789e8a81479471c879258e">spacemtx</a>, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.vd-&gt;twmat);
<a name="l00826"></a>00826                 warp_pointer(mval[0], mval[1]);
<a name="l00827"></a>00827 <span class="preprocessor">#endif</span>
<a name="l00828"></a>00828 <span class="preprocessor"></span>            }
<a name="l00829"></a>00829             <span class="keywordflow">else</span> {
<a name="l00830"></a>00830                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#aea194444de4ea92edf4d927305106e83">TRANS_CONFIRM</a>;
<a name="l00831"></a>00831             }
<a name="l00832"></a>00832             <span class="keywordflow">break</span>;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l00835"></a>00835             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l00836"></a>00836                 <span class="comment">/* exception for switching to dolly, or trackball, in camera view */</span>
<a name="l00837"></a>00837                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af49c29e9c2b4b7085969054af006a5ee">T_CAMERA</a>) {
<a name="l00838"></a>00838                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>==<a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>)
<a name="l00839"></a>00839                         <a class="code" href="../../d2/d80/transform_8h.html#aab783006a7aabfe80ebfd7d0cdd8f130">setLocalConstraint</a>(t, (<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;along local Z&quot;</span>);
<a name="l00840"></a>00840                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>==<a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>) {
<a name="l00841"></a>00841                         <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00842"></a>00842                         <a class="code" href="../../d8/d27/transform_8c.html#a4f667262c34ee4cae1bace342cd02872">initTrackball</a>(t);
<a name="l00843"></a>00843                     }
<a name="l00844"></a>00844                 }
<a name="l00845"></a>00845                 <span class="keywordflow">else</span> {
<a name="l00846"></a>00846                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a54b0f4faa4a732efb2d67110ac12a9e5">MOD_CONSTRAINT_SELECT</a>;
<a name="l00847"></a>00847                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l00848"></a>00848                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00849"></a>00849                     }
<a name="l00850"></a>00850                     <span class="keywordflow">else</span> {
<a name="l00851"></a>00851                         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) {
<a name="l00852"></a>00852                             <a class="code" href="../../d2/d80/transform_8h.html#afe2d11bb4b9d08ef2204daaa34a15231">initSelectConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae913d49905789e8a81479471c879258e">spacemtx</a>);
<a name="l00853"></a>00853                         }
<a name="l00854"></a>00854                         <span class="keywordflow">else</span> {
<a name="l00855"></a>00855                             <span class="comment">/* bit hackish... but it prevents mmb select to print the orientation from menu */</span>
<a name="l00856"></a>00856                             strcpy(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#acd4cdbf718344943066539a54cfd4870">spacename</a>, <span class="stringliteral">&quot;global&quot;</span>);
<a name="l00857"></a>00857                             <a class="code" href="../../d2/d80/transform_8h.html#afe2d11bb4b9d08ef2204daaa34a15231">initSelectConstraint</a>(t, mati);
<a name="l00858"></a>00858                         }
<a name="l00859"></a>00859                         <a class="code" href="../../d2/d80/transform_8h.html#a9407ab9a7d1af3248290500612a318ef">postSelectConstraint</a>(t);
<a name="l00860"></a>00860                     }
<a name="l00861"></a>00861                 }
<a name="l00862"></a>00862                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00863"></a>00863             }
<a name="l00864"></a>00864             <span class="keywordflow">break</span>;
<a name="l00865"></a>00865         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>:
<a name="l00866"></a>00866             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l00867"></a>00867             <span class="keywordflow">break</span>;
<a name="l00868"></a>00868         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>:
<a name="l00869"></a>00869         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>:
<a name="l00870"></a>00870             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#aea194444de4ea92edf4d927305106e83">TRANS_CONFIRM</a>;
<a name="l00871"></a>00871             <span class="keywordflow">break</span>;
<a name="l00872"></a>00872         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac4133479f03eb38f20b64e5a1d73ab0a">GKEY</a>:
<a name="l00873"></a>00873             <span class="comment">/* only switch when... */</span>
<a name="l00874"></a>00874             <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a002f81b26542b400faa00b3e7209fbbf">TFM_RESIZE</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>) ) {
<a name="l00875"></a>00875                 <a class="code" href="../../d2/d80/transform_8h.html#a310eeef95fd01a8bb9c220466ddc5e72">resetTransRestrictions</a>(t);
<a name="l00876"></a>00876                 <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00877"></a>00877                 <a class="code" href="../../d8/d27/transform_8c.html#a6e79b804b31355f3c48c4e6455b18ba6">initTranslation</a>(t);
<a name="l00878"></a>00878                 <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// need to reinit after mode change</span>
<a name="l00879"></a>00879                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00880"></a>00880             }
<a name="l00881"></a>00881             <span class="keywordflow">break</span>;
<a name="l00882"></a>00882         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32a2e419731c7ff93211038f83bb4acc">SKEY</a>:
<a name="l00883"></a>00883             <span class="comment">/* only switch when... */</span>
<a name="l00884"></a>00884             <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>) ) {
<a name="l00885"></a>00885                 <a class="code" href="../../d2/d80/transform_8h.html#a310eeef95fd01a8bb9c220466ddc5e72">resetTransRestrictions</a>(t);
<a name="l00886"></a>00886                 <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00887"></a>00887                 <a class="code" href="../../d8/d27/transform_8c.html#a07a126d25aafc67aae1b520d37d4b656">initResize</a>(t);
<a name="l00888"></a>00888                 <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// need to reinit after mode change</span>
<a name="l00889"></a>00889                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00890"></a>00890             }
<a name="l00891"></a>00891             <span class="keywordflow">break</span>;
<a name="l00892"></a>00892         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9fb42765696ec2a77dff4bc1267864c3">RKEY</a>:
<a name="l00893"></a>00893             <span class="comment">/* only switch when... */</span>
<a name="l00894"></a>00894             <span class="keywordflow">if</span> (!(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> &amp; <a class="code" href="../../d8/df2/ED__transform_8h.html#ad72aa2d5f0a19fb0e785f5ca7ceb200f">CTX_TEXTURE</a>) &amp;&amp; !(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> &amp; <a class="code" href="../../d8/df2/ED__transform_8h.html#aa845d497ca7d08b6ff5673425c7674ae">CTX_MOVIECLIP</a>)) {
<a name="l00895"></a>00895                 <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a002f81b26542b400faa00b3e7209fbbf">TFM_RESIZE</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>) ) {
<a name="l00896"></a>00896 
<a name="l00897"></a>00897                     <a class="code" href="../../d2/d80/transform_8h.html#a310eeef95fd01a8bb9c220466ddc5e72">resetTransRestrictions</a>(t);
<a name="l00898"></a>00898 
<a name="l00899"></a>00899                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> == <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>) {
<a name="l00900"></a>00900                         <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00901"></a>00901                         <a class="code" href="../../d8/d27/transform_8c.html#a4f667262c34ee4cae1bace342cd02872">initTrackball</a>(t);
<a name="l00902"></a>00902                     }
<a name="l00903"></a>00903                     <span class="keywordflow">else</span> {
<a name="l00904"></a>00904                         <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t);
<a name="l00905"></a>00905                         <a class="code" href="../../d8/d27/transform_8c.html#adc9eb52f311d8812a078a63adbba18f8">initRotation</a>(t);
<a name="l00906"></a>00906                     }
<a name="l00907"></a>00907                     <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// need to reinit after mode change</span>
<a name="l00908"></a>00908                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00909"></a>00909                 }
<a name="l00910"></a>00910             }
<a name="l00911"></a>00911             <span class="keywordflow">break</span>;
<a name="l00912"></a>00912         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a39f146afd78004fead59358c29028292">CKEY</a>:
<a name="l00913"></a>00913             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l00914"></a>00914                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> ^= <a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>;
<a name="l00915"></a>00915                 <a class="code" href="../../d2/d80/transform_8h.html#a346b7ff10e72154ac31ebc114ed66708">sort_trans_data_dist</a>(t);
<a name="l00916"></a>00916                 <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l00917"></a>00917                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a>= 1;
<a name="l00918"></a>00918             }
<a name="l00919"></a>00919             <span class="keywordflow">else</span> {
<a name="l00920"></a>00920                 <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00921"></a>00921                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00922"></a>00922             }
<a name="l00923"></a>00923             <span class="keywordflow">break</span>;
<a name="l00924"></a>00924         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a16a045703cd7faafcbab3abe5953c4a2">XKEY</a>:
<a name="l00925"></a>00925             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l00926"></a>00926                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>) {
<a name="l00927"></a>00927                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;X&#39;</span>) {
<a name="l00928"></a>00928                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00929"></a>00929                     }
<a name="l00930"></a>00930                     <span class="keywordflow">else</span> {
<a name="l00931"></a>00931                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>), <span class="stringliteral">&quot;along X&quot;</span>);
<a name="l00932"></a>00932                     }
<a name="l00933"></a>00933                 }
<a name="l00934"></a>00934                 <span class="keywordflow">else</span> {
<a name="l00935"></a>00935                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;X&#39;</span>) {
<a name="l00936"></a>00936                         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a5589b8da1ed72aecc3c1c8f0323ae4d2">orientation</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>) {
<a name="l00937"></a>00937                             <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00938"></a>00938                         }
<a name="l00939"></a>00939                         <span class="keywordflow">else</span> {
<a name="l00940"></a>00940                             <span class="keywordtype">short</span> orientation = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a> ? t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a> : <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a17c41aec25bdd515bc4da118237035ee">V3D_MANIP_LOCAL</a>;
<a name="l00941"></a>00941                             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>) == 0)
<a name="l00942"></a>00942                                 <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, orientation, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>), <span class="stringliteral">&quot;along %s X&quot;</span>);
<a name="l00943"></a>00943                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>)
<a name="l00944"></a>00944                                 <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, orientation, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>|<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;locking %s X&quot;</span>);
<a name="l00945"></a>00945                         }
<a name="l00946"></a>00946                     }
<a name="l00947"></a>00947                     <span class="keywordflow">else</span> {
<a name="l00948"></a>00948                         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>) == 0)
<a name="l00949"></a>00949                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>), <span class="stringliteral">&quot;along %s X&quot;</span>);
<a name="l00950"></a>00950                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>)
<a name="l00951"></a>00951                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>|<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;locking %s X&quot;</span>);
<a name="l00952"></a>00952                     }
<a name="l00953"></a>00953                 }
<a name="l00954"></a>00954                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956             <span class="keywordflow">break</span>;
<a name="l00957"></a>00957         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af58b3779d0b9691c9a871cc1ff0b880c">YKEY</a>:
<a name="l00958"></a>00958             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l00959"></a>00959                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>) {
<a name="l00960"></a>00960                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Y&#39;</span>) {
<a name="l00961"></a>00961                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00962"></a>00962                     }
<a name="l00963"></a>00963                     <span class="keywordflow">else</span> {
<a name="l00964"></a>00964                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;along Y&quot;</span>);
<a name="l00965"></a>00965                     }
<a name="l00966"></a>00966                 }
<a name="l00967"></a>00967                 <span class="keywordflow">else</span> {
<a name="l00968"></a>00968                     <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Y&#39;</span>) {
<a name="l00969"></a>00969                         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a5589b8da1ed72aecc3c1c8f0323ae4d2">orientation</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>) {
<a name="l00970"></a>00970                             <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00971"></a>00971                         }
<a name="l00972"></a>00972                         <span class="keywordflow">else</span> {
<a name="l00973"></a>00973                             <span class="keywordtype">short</span> orientation = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a> ? t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a> : <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a17c41aec25bdd515bc4da118237035ee">V3D_MANIP_LOCAL</a>;
<a name="l00974"></a>00974                             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>) == 0)
<a name="l00975"></a>00975                                 <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, orientation, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;along %s Y&quot;</span>);
<a name="l00976"></a>00976                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>)
<a name="l00977"></a>00977                                 <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, orientation, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>|<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;locking %s Y&quot;</span>);
<a name="l00978"></a>00978                         }
<a name="l00979"></a>00979                     }
<a name="l00980"></a>00980                     <span class="keywordflow">else</span> {
<a name="l00981"></a>00981                         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>) == 0)
<a name="l00982"></a>00982                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;along %s Y&quot;</span>);
<a name="l00983"></a>00983                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>)
<a name="l00984"></a>00984                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>|<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;locking %s Y&quot;</span>);
<a name="l00985"></a>00985                     }
<a name="l00986"></a>00986                 }
<a name="l00987"></a>00987                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l00988"></a>00988             }
<a name="l00989"></a>00989             <span class="keywordflow">break</span>;
<a name="l00990"></a>00990         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5387e52eccf782cebe3b5eb2ca7655e1">ZKEY</a>:
<a name="l00991"></a>00991             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>))==0) {
<a name="l00992"></a>00992                 <span class="keywordflow">if</span> (cmode == <span class="charliteral">&#39;Z&#39;</span>) {
<a name="l00993"></a>00993                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a5589b8da1ed72aecc3c1c8f0323ae4d2">orientation</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>) {
<a name="l00994"></a>00994                         <a class="code" href="../../d2/d80/transform_8h.html#aa157d5984a66da568fa709a9299037be">stopConstraint</a>(t);
<a name="l00995"></a>00995                     }
<a name="l00996"></a>00996                     <span class="keywordflow">else</span> {
<a name="l00997"></a>00997                         <span class="keywordtype">short</span> orientation = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a> ? t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a> : <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a17c41aec25bdd515bc4da118237035ee">V3D_MANIP_LOCAL</a>;
<a name="l00998"></a>00998                         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>) == 0)
<a name="l00999"></a>00999                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, orientation, (<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;along %s Z&quot;</span>);
<a name="l01000"></a>01000                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>)
<a name="l01001"></a>01001                             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, orientation, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>|<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;locking %s Z&quot;</span>);
<a name="l01002"></a>01002                     }
<a name="l01003"></a>01003                 }
<a name="l01004"></a>01004                 <span class="keywordflow">else</span> {
<a name="l01005"></a>01005                     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>) == 0)
<a name="l01006"></a>01006                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>), <span class="stringliteral">&quot;along %s Z&quot;</span>);
<a name="l01007"></a>01007                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>)
<a name="l01008"></a>01008                         <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a032eaff95208f4d9f714315bf35cd411">V3D_MANIP_GLOBAL</a>, (<a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>|<a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>), <span class="stringliteral">&quot;locking %s Z&quot;</span>);
<a name="l01009"></a>01009                 }
<a name="l01010"></a>01010                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l01011"></a>01011             }
<a name="l01012"></a>01012             <span class="keywordflow">break</span>;
<a name="l01013"></a>01013         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac20849472da73fdbe2fea6acca2b70da">OKEY</a>:
<a name="l01014"></a>01014             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) {
<a name="l01015"></a>01015                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a96b09fc42650d2e8d38a1c2fae9732a9">prop_mode</a> = (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a96b09fc42650d2e8d38a1c2fae9732a9">prop_mode</a> + 1) % <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ab9479ad1f59cd9867d65ce13cbaa41b7">PROP_MODE_MAX</a>;
<a name="l01016"></a>01016                 <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l01017"></a>01017                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l01018"></a>01018             }
<a name="l01019"></a>01019             <span class="keywordflow">break</span>;
<a name="l01020"></a>01020         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>:
<a name="l01021"></a>01021             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>) {
<a name="l01022"></a>01022                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a> *= 1.1f;
<a name="l01023"></a>01023                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a32829b792f54258663c560080b174019">persp</a> != <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#af086af25ae5c28a12be8eb6f7687c6dd">RV3D_ORTHO</a>)
<a name="l01024"></a>01024                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>, ((<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>)-&gt;far);
<a name="l01025"></a>01025                 <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l01026"></a>01026             }
<a name="l01027"></a>01027             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a>= 1;
<a name="l01028"></a>01028             <span class="keywordflow">break</span>;
<a name="l01029"></a>01029         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>:
<a name="l01030"></a>01030         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>:
<a name="l01031"></a>01031             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab2bc160056f077a7f09a10a00cf9c07">T_AUTOIK</a>) {
<a name="l01032"></a>01032                 <a class="code" href="../../d2/d80/transform_8h.html#a04cb94193fb7c2106f85b4d52b7af74e">transform_autoik_update</a>(t, 1);
<a name="l01033"></a>01033             }
<a name="l01034"></a>01034             <span class="keywordflow">else</span> <a class="code" href="../../d8/d27/transform_8c.html#af05d2375f2524fe55305d6548fc87127">view_editmove</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>);
<a name="l01035"></a>01035             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a>= 1;
<a name="l01036"></a>01036             <span class="keywordflow">break</span>;
<a name="l01037"></a>01037         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>:
<a name="l01038"></a>01038             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>) {
<a name="l01039"></a>01039                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>*= 0.90909090f;
<a name="l01040"></a>01040                 <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a>= 1;
<a name="l01043"></a>01043             <span class="keywordflow">break</span>;
<a name="l01044"></a>01044         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>:
<a name="l01045"></a>01045         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>:
<a name="l01046"></a>01046             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab2bc160056f077a7f09a10a00cf9c07">T_AUTOIK</a>) {
<a name="l01047"></a>01047                 <a class="code" href="../../d2/d80/transform_8h.html#a04cb94193fb7c2106f85b4d52b7af74e">transform_autoik_update</a>(t, -1);
<a name="l01048"></a>01048             }
<a name="l01049"></a>01049             <span class="keywordflow">else</span> <a class="code" href="../../d8/d27/transform_8c.html#af05d2375f2524fe55305d6548fc87127">view_editmove</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>);
<a name="l01050"></a>01050             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a>= 1;
<a name="l01051"></a>01051             <span class="keywordflow">break</span>;
<a name="l01052"></a>01052         <span class="keywordflow">default</span>:
<a name="l01053"></a>01053             handled = 0;
<a name="l01054"></a>01054             <span class="keywordflow">break</span>;
<a name="l01055"></a>01055         }
<a name="l01056"></a>01056 
<a name="l01057"></a>01057         <span class="comment">// Numerical input events</span>
<a name="l01058"></a>01058         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#ac0c74aa4cdf6c6f0650a165f030c09b8">handleNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), event);
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         <span class="comment">// Snapping key events</span>
<a name="l01061"></a>01061         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a54d3efc9a40c6a2888af12b69ed0d221">handleSnapping</a>(t, event);
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     }
<a name="l01064"></a>01064     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l01065"></a>01065         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01066"></a>01066         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8bb00d0e3bbc5c558edcef2b6c7d549c">LEFTSHIFTKEY</a>:
<a name="l01067"></a>01067         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a60ddce316227eaa9586286cca0e085f5">RIGHTSHIFTKEY</a>:
<a name="l01068"></a>01068             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp;= ~<a class="code" href="../../d2/d80/transform_8h.html#a4019caa3f01740a937358a0052302a91">MOD_CONSTRAINT_PLANE</a>;
<a name="l01069"></a>01069             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l01070"></a>01070             <span class="keywordflow">break</span>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l01073"></a>01073             <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>)==0) {
<a name="l01074"></a>01074                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp;= ~<a class="code" href="../../d2/d80/transform_8h.html#a54b0f4faa4a732efb2d67110ac12a9e5">MOD_CONSTRAINT_SELECT</a>;
<a name="l01075"></a>01075                 <a class="code" href="../../d2/d80/transform_8h.html#a9407ab9a7d1af3248290500612a318ef">postSelectConstraint</a>(t);
<a name="l01076"></a>01076                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l01077"></a>01077             }
<a name="l01078"></a>01078             <span class="keywordflow">break</span>;
<a name="l01079"></a>01079 <span class="comment">//      case LEFTMOUSE:</span>
<a name="l01080"></a>01080 <span class="comment">//      case RIGHTMOUSE:</span>
<a name="l01081"></a>01081 <span class="comment">//          if (WM_modal_tweak_exit(event, t-&gt;event_type))</span>
<a name="l01083"></a>01083 <span class="comment"></span><span class="comment">//              t-&gt;state = TRANS_CONFIRM;</span>
<a name="l01084"></a>01084 <span class="comment">//          break;</span>
<a name="l01085"></a>01085         <span class="keywordflow">default</span>:
<a name="l01086"></a>01086             handled = 0;
<a name="l01087"></a>01087             <span class="keywordflow">break</span>;
<a name="l01088"></a>01088         }
<a name="l01089"></a>01089 
<a name="l01090"></a>01090         <span class="comment">/* confirm transform if launch key is released after mouse move */</span>
<a name="l01091"></a>01091         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ae458604cddf6ea7a24e924430502aa77">T_RELEASE_CONFIRM</a>)
<a name="l01092"></a>01092         {
<a name="l01093"></a>01093             <span class="comment">/* XXX Keyrepeat bug in Xorg fucks this up, will test when fixed */</span>
<a name="l01094"></a>01094             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> &amp;&amp; (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> || t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>))
<a name="l01095"></a>01095             {
<a name="l01096"></a>01096                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#aea194444de4ea92edf4d927305106e83">TRANS_CONFIRM</a>;
<a name="l01097"></a>01097             }
<a name="l01098"></a>01098         }
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     <span class="comment">// Per transform event, if present</span>
<a name="l01102"></a>01102     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a121f0ea8f17d1530ab5031f3ae53e47b">handleEvent</a>)
<a name="l01103"></a>01103         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a121f0ea8f17d1530ab5031f3ae53e47b">handleEvent</a>(t, event);
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     <span class="keywordflow">if</span> (handled || t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a>)
<a name="l01106"></a>01106         <span class="keywordflow">return</span> 0;
<a name="l01107"></a>01107     <span class="keywordflow">else</span>
<a name="l01108"></a>01108         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01109"></a>01109 }
<a name="l01110"></a>01110 
<a name="l01111"></a><a class="code" href="../../d8/d27/transform_8c.html#af936d392bdb25cea0f604897cec69068">01111</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#a09f26a8418433796a1f30b72e7ca3f95">calculateTransformCenter</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">int</span> centerMode, <span class="keywordtype">float</span> *vec)
<a name="l01112"></a>01112 {
<a name="l01113"></a>01113     <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a>), <span class="stringliteral">&quot;TransInfo data&quot;</span>);
<a name="l01114"></a>01114     <span class="keywordtype">int</span> success = 1;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a3a94d1a89ea3f29eefdcac58bbc3845f">TRANS_RUNNING</a>;
<a name="l01117"></a>01117 
<a name="l01118"></a>01118     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#a041bd47d760dd2c3f537403a05c2a151">CTX_NONE</a>;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ad8432a55c71a2ffa288111835b33e57f">TFM_DUMMY</a>;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     <a class="code" href="../../d2/d80/transform_8h.html#a18ee9fb00d7e3cd303abdefcf470fce0">initTransInfo</a>(C, t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);    <span class="comment">// internal data, mouse, vectors</span>
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     <a class="code" href="../../d2/d80/transform_8h.html#a2aea39b28385d35663b1abdee373ac81">createTransData</a>(C, t);              <span class="comment">// make TransData structs from selection</span>
<a name="l01125"></a>01125 
<a name="l01126"></a>01126     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0c9e2a1ae5acee970c6b8e16b96f09bd">around</a> = centerMode;             <span class="comment">// override userdefined mode</span>
<a name="l01127"></a>01127 
<a name="l01128"></a>01128     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a> == 0) {
<a name="l01129"></a>01129         success = 0;
<a name="l01130"></a>01130     }
<a name="l01131"></a>01131     <span class="keywordflow">else</span> {
<a name="l01132"></a>01132         success = 1;
<a name="l01133"></a>01133 
<a name="l01134"></a>01134         <a class="code" href="../../d2/d80/transform_8h.html#a0494c7a122871d263e60b00330d8d9c0">calculateCenter</a>(t);
<a name="l01135"></a>01135 
<a name="l01136"></a>01136         <span class="comment">// Copy center from constraint center. Transform center can be local</span>
<a name="l01137"></a>01137         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#ac3e0f85e46dfe703064fd2c1d7e3af99">center</a>);
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     <span class="comment">/* aftertrans does insert ipos and action channels, and clears base flags, doesnt read transdata */</span>
<a name="l01142"></a>01142     <a class="code" href="../../d2/d80/transform_8h.html#ac14f6ce00e8c7da3ac332c542c284c8e">special_aftertrans_update</a>(C, t);
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     <a class="code" href="../../d2/d80/transform_8h.html#a3bd4c39c4b3758f6283c4eb65729ef25">postTrans</a>(C, t);
<a name="l01145"></a>01145 
<a name="l01146"></a>01146     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(t);
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="keywordflow">return</span> success;
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a><a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60">01151</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l01152"></a><a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">01152</a>     <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>,
<a name="l01153"></a><a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">01153</a>     <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>,
<a name="l01154"></a><a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60adb45120aafd37a973140edee24708065">01154</a>     <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60adb45120aafd37a973140edee24708065">LEFT</a>,
<a name="l01155"></a><a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aec8379af7490bb9eaaf579cf17876f38">01155</a>     <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aec8379af7490bb9eaaf579cf17876f38">RIGHT</a>
<a name="l01156"></a>01156 } <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60">ArrowDirection</a>;
<a name="l01157"></a><a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">01157</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60">ArrowDirection</a> d, <span class="keywordtype">short</span> offset, <span class="keywordtype">short</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>, <span class="keywordtype">short</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l01158"></a>01158 {
<a name="l01159"></a>01159     <span class="keywordflow">switch</span>(d)
<a name="l01160"></a>01160     {
<a name="l01161"></a>01161         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60adb45120aafd37a973140edee24708065">LEFT</a>:
<a name="l01162"></a>01162             offset = -offset;
<a name="l01163"></a>01163             length = -<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>;
<a name="l01164"></a>01164             size = -<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01165"></a>01165         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aec8379af7490bb9eaaf579cf17876f38">RIGHT</a>:
<a name="l01166"></a>01166             glBegin(GL_LINES);
<a name="l01167"></a>01167             glVertex2s( offset, 0);
<a name="l01168"></a>01168             glVertex2s( offset + length, 0);
<a name="l01169"></a>01169             glVertex2s( offset + length, 0);
<a name="l01170"></a>01170             glVertex2s( offset + length - size, -size);
<a name="l01171"></a>01171             glVertex2s( offset + length, 0);
<a name="l01172"></a>01172             glVertex2s( offset + length - size,  size);
<a name="l01173"></a>01173             glEnd();
<a name="l01174"></a>01174             <span class="keywordflow">break</span>;
<a name="l01175"></a>01175         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>:
<a name="l01176"></a>01176             offset = -offset;
<a name="l01177"></a>01177             length = -<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>;
<a name="l01178"></a>01178             size = -<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01179"></a>01179         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>:
<a name="l01180"></a>01180             glBegin(GL_LINES);
<a name="l01181"></a>01181             glVertex2s( 0, offset);
<a name="l01182"></a>01182             glVertex2s( 0, offset + length);
<a name="l01183"></a>01183             glVertex2s( 0, offset + length);
<a name="l01184"></a>01184             glVertex2s(-size, offset + length - size);
<a name="l01185"></a>01185             glVertex2s( 0, offset + length);
<a name="l01186"></a>01186             glVertex2s( size, offset + length - size);
<a name="l01187"></a>01187             glEnd();
<a name="l01188"></a>01188             <span class="keywordflow">break</span>;
<a name="l01189"></a>01189     }
<a name="l01190"></a>01190 }
<a name="l01191"></a>01191 
<a name="l01192"></a><a class="code" href="../../d8/d27/transform_8c.html#a3dda5c25a4989f72ebfa91eeeb775551">01192</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a3dda5c25a4989f72ebfa91eeeb775551">drawArrowHead</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60">ArrowDirection</a> d, <span class="keywordtype">short</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l01193"></a>01193 {
<a name="l01194"></a>01194     <span class="keywordflow">switch</span>(d)
<a name="l01195"></a>01195     {
<a name="l01196"></a>01196         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60adb45120aafd37a973140edee24708065">LEFT</a>:
<a name="l01197"></a>01197             size = -<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01198"></a>01198         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aec8379af7490bb9eaaf579cf17876f38">RIGHT</a>:
<a name="l01199"></a>01199             glBegin(GL_LINES);
<a name="l01200"></a>01200             glVertex2s( 0, 0);
<a name="l01201"></a>01201             glVertex2s( -size, -size);
<a name="l01202"></a>01202             glVertex2s( 0, 0);
<a name="l01203"></a>01203             glVertex2s( -size,  size);
<a name="l01204"></a>01204             glEnd();
<a name="l01205"></a>01205             <span class="keywordflow">break</span>;
<a name="l01206"></a>01206         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>:
<a name="l01207"></a>01207             size = -<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01208"></a>01208         <span class="keywordflow">case</span> <a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>:
<a name="l01209"></a>01209             glBegin(GL_LINES);
<a name="l01210"></a>01210             glVertex2s( 0, 0);
<a name="l01211"></a>01211             glVertex2s(-size, -size);
<a name="l01212"></a>01212             glVertex2s( 0, 0);
<a name="l01213"></a>01213             glVertex2s( size, -size);
<a name="l01214"></a>01214             glEnd();
<a name="l01215"></a>01215             <span class="keywordflow">break</span>;
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217 }
<a name="l01218"></a>01218 
<a name="l01219"></a><a class="code" href="../../d8/d27/transform_8c.html#a23647158c6671f07227b73705452e532">01219</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a23647158c6671f07227b73705452e532">drawArc</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>, <span class="keywordtype">float</span> angle_start, <span class="keywordtype">float</span> angle_end, <span class="keywordtype">int</span> segments)
<a name="l01220"></a>01220 {
<a name="l01221"></a>01221     <span class="keywordtype">float</span> delta = (angle_end - angle_start) / segments;
<a name="l01222"></a>01222     <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     glBegin(GL_LINE_STRIP);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     <span class="keywordflow">for</span> ( angle = angle_start; angle &lt; angle_end; angle += delta)
<a name="l01227"></a>01227     {
<a name="l01228"></a>01228         glVertex2f( <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle) * size, <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle) * size);
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230     glVertex2f( <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle_end) * size, <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle_end) * size);
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     glEnd();
<a name="l01233"></a>01233 }
<a name="l01234"></a>01234 
<a name="l01235"></a><a class="code" href="../../d8/d27/transform_8c.html#aaa5e607b6ca3b6f4092f2040f0410760">01235</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#aaa5e607b6ca3b6f4092f2040f0410760">helpline_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l01236"></a>01236 {
<a name="l01237"></a>01237     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01238"></a>01238     
<a name="l01239"></a>01239     <span class="keywordflow">if</span> (ar &amp;&amp; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>)
<a name="l01240"></a>01240         <span class="keywordflow">return</span> 1;
<a name="l01241"></a>01241     <span class="keywordflow">return</span> 0;
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a><a class="code" href="../../d8/d27/transform_8c.html#a6ceacec40a8acd204eaad9f2cd372d67">01244</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a6ceacec40a8acd204eaad9f2cd372d67">drawHelpline</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">void</span> *customdata)
<a name="l01245"></a>01245 {
<a name="l01246"></a>01246     <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t = (<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a>*)customdata;
<a name="l01247"></a>01247 
<a name="l01248"></a>01248     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5c376c715d784432dab607415b79cf30">helpline</a> != <a class="code" href="../../d2/d80/transform_8h.html#a077c1d355b12e578ccbb606b7470f3f4">HLP_NONE</a> &amp;&amp; !(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab6649125ab53f55ea9674b26e23a47e">T_USES_MANIPULATOR</a>))
<a name="l01249"></a>01249     {
<a name="l01250"></a>01250         <span class="keywordtype">float</span> vecrot[3], cent[2];
<a name="l01251"></a>01251         <span class="keywordtype">int</span> mval[2];
<a name="l01252"></a>01252 
<a name="l01253"></a>01253         mval[0]= x;
<a name="l01254"></a>01254         mval[1]= y;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vecrot, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>);
<a name="l01257"></a>01257         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a246046d89b8b7707a9eee55d84b8ecba">T_EDIT</a>) {
<a name="l01258"></a>01258             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>;
<a name="l01259"></a>01259             <span class="keywordflow">if</span> (ob) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, vecrot);
<a name="l01260"></a>01260         }
<a name="l01261"></a>01261         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>) {
<a name="l01262"></a>01262             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob=t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aefcd6d2b51a3fa9ab4479e0f84928c57">poseobj</a>;
<a name="l01263"></a>01263             <span class="keywordflow">if</span> (ob) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, vecrot);
<a name="l01264"></a>01264         }
<a name="l01265"></a>01265 
<a name="l01266"></a>01266         <a class="code" href="../../d8/d27/transform_8c.html#ad9de692f67cb479efe8f385ec42990f7">projectFloatView</a>(t, vecrot, cent);  <span class="comment">// no overflow in extreme cases</span>
<a name="l01267"></a>01267 
<a name="l01268"></a>01268         glPushMatrix();
<a name="l01269"></a>01269 
<a name="l01270"></a>01270         <span class="keywordflow">switch</span>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5c376c715d784432dab607415b79cf30">helpline</a>)
<a name="l01271"></a>01271         {
<a name="l01272"></a>01272             <span class="keywordflow">case</span> <a class="code" href="../../d2/d80/transform_8h.html#a2077e17f38a6806d43653818a67a78c1">HLP_SPRING</a>:
<a name="l01273"></a>01273                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l01274"></a>01274 
<a name="l01275"></a>01275                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l01276"></a>01276                 glBegin(GL_LINE_STRIP);
<a name="l01277"></a>01277                 glVertex2iv(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>);
<a name="l01278"></a>01278                 glVertex2fv(cent);
<a name="l01279"></a>01279                 glEnd();
<a name="l01280"></a>01280 
<a name="l01281"></a>01281                 glTranslatef(mval[0], mval[1], 0);
<a name="l01282"></a>01282                 glRotatef(-<a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#ab616618cf09fc0ef5c0ec0d9e5825f58">atan2f</a>(cent[0] - t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[0], cent[1] - t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[1])), 0, 0, 1);
<a name="l01283"></a>01283 
<a name="l01284"></a>01284                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l01285"></a>01285                 glLineWidth(3.0);
<a name="l01286"></a>01286                 <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>, 5, 10, 5);
<a name="l01287"></a>01287                 <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>, 5, 10, 5);
<a name="l01288"></a>01288                 glLineWidth(1.0);
<a name="l01289"></a>01289                 <span class="keywordflow">break</span>;
<a name="l01290"></a>01290             <span class="keywordflow">case</span> <a class="code" href="../../d2/d80/transform_8h.html#ab7e9268b0e6f3a228da98b764a2a2a15">HLP_HARROW</a>:
<a name="l01291"></a>01291                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l01292"></a>01292 
<a name="l01293"></a>01293                 glTranslatef(mval[0], mval[1], 0);
<a name="l01294"></a>01294 
<a name="l01295"></a>01295                 glLineWidth(3.0);
<a name="l01296"></a>01296                 <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aec8379af7490bb9eaaf579cf17876f38">RIGHT</a>, 5, 10, 5);
<a name="l01297"></a>01297                 <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60adb45120aafd37a973140edee24708065">LEFT</a>, 5, 10, 5);
<a name="l01298"></a>01298                 glLineWidth(1.0);
<a name="l01299"></a>01299                 <span class="keywordflow">break</span>;
<a name="l01300"></a>01300             <span class="keywordflow">case</span> <a class="code" href="../../d2/d80/transform_8h.html#ac293d5e1b4ee8037c27baa73ac821e6b">HLP_VARROW</a>:
<a name="l01301"></a>01301                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303                 glTranslatef(mval[0], mval[1], 0);
<a name="l01304"></a>01304 
<a name="l01305"></a>01305                 glLineWidth(3.0);
<a name="l01306"></a>01306                 glBegin(GL_LINES);
<a name="l01307"></a>01307                 <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>, 5, 10, 5);
<a name="l01308"></a>01308                 <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>, 5, 10, 5);
<a name="l01309"></a>01309                 glLineWidth(1.0);
<a name="l01310"></a>01310                 <span class="keywordflow">break</span>;
<a name="l01311"></a>01311             <span class="keywordflow">case</span> <a class="code" href="../../d2/d80/transform_8h.html#a4c63ccc3c8c9cb0e0333c39da375f107">HLP_ANGLE</a>:
<a name="l01312"></a>01312                 {
<a name="l01313"></a>01313                     <span class="keywordtype">float</span> dx = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[0] - cent[0], dy = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[1] - cent[1];
<a name="l01314"></a>01314                     <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a> = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#ab616618cf09fc0ef5c0ec0d9e5825f58">atan2f</a>(dy, dx);
<a name="l01315"></a>01315                     <span class="keywordtype">float</span> dist = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(dx*dx + dy*dy);
<a name="l01316"></a>01316                     <span class="keywordtype">float</span> delta_angle = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(15.0f / dist, (<span class="keywordtype">float</span>)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/4.0f);
<a name="l01317"></a>01317                     <span class="keywordtype">float</span> spacing_angle = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(5.0f / dist, (<span class="keywordtype">float</span>)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/12.0f);
<a name="l01318"></a>01318                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l01319"></a>01319 
<a name="l01320"></a>01320                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l01321"></a>01321                     glBegin(GL_LINE_STRIP);
<a name="l01322"></a>01322                     glVertex2iv(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>);
<a name="l01323"></a>01323                     glVertex2fv(cent);
<a name="l01324"></a>01324                     glEnd();
<a name="l01325"></a>01325 
<a name="l01326"></a>01326                     glTranslatef(cent[0] - t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[0] + mval[0], cent[1] - t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[1] + mval[1], 0);
<a name="l01327"></a>01327 
<a name="l01328"></a>01328                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l01329"></a>01329                     glLineWidth(3.0);
<a name="l01330"></a>01330                     <a class="code" href="../../d8/d27/transform_8c.html#a23647158c6671f07227b73705452e532">drawArc</a>(dist, angle - delta_angle, angle - spacing_angle, 10);
<a name="l01331"></a>01331                     <a class="code" href="../../d8/d27/transform_8c.html#a23647158c6671f07227b73705452e532">drawArc</a>(dist, angle + spacing_angle, angle + delta_angle, 10);
<a name="l01332"></a>01332 
<a name="l01333"></a>01333                     glPushMatrix();
<a name="l01334"></a>01334 
<a name="l01335"></a>01335                     glTranslatef(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle - delta_angle) * dist, <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle - delta_angle) * dist, 0);
<a name="l01336"></a>01336                     glRotatef(<a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(angle - delta_angle), 0, 0, 1);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338                     <a class="code" href="../../d8/d27/transform_8c.html#a3dda5c25a4989f72ebfa91eeeb775551">drawArrowHead</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>, 5);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340                     glPopMatrix();
<a name="l01341"></a>01341 
<a name="l01342"></a>01342                     glTranslatef(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle + delta_angle) * dist, <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle + delta_angle) * dist, 0);
<a name="l01343"></a>01343                     glRotatef(<a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(angle + delta_angle), 0, 0, 1);
<a name="l01344"></a>01344 
<a name="l01345"></a>01345                     <a class="code" href="../../d8/d27/transform_8c.html#a3dda5c25a4989f72ebfa91eeeb775551">drawArrowHead</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>, 5);
<a name="l01346"></a>01346 
<a name="l01347"></a>01347                     glLineWidth(1.0);
<a name="l01348"></a>01348                     <span class="keywordflow">break</span>;
<a name="l01349"></a>01349                 }
<a name="l01350"></a>01350                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d80/transform_8h.html#a2a05a54c0748971e04f801c51d9e1c77">HLP_TRACKBALL</a>:
<a name="l01351"></a>01351                 {
<a name="l01352"></a>01352                     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[3], col2[3];
<a name="l01353"></a>01353                     <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a295ee87ce46db238cf7fd0adeddcf83d">TH_GRID</a>, col);
<a name="l01354"></a>01354 
<a name="l01355"></a>01355                     glTranslatef(mval[0], mval[1], 0);
<a name="l01356"></a>01356 
<a name="l01357"></a>01357                     glLineWidth(3.0);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359                     <a class="code" href="../../de/d96/UI__resources_8h.html#a0987940839c284639e62eaa495a117a3">UI_make_axis_color</a>(col, col2, <span class="charliteral">&#39;X&#39;</span>);
<a name="l01360"></a>01360                     glColor3ubv((GLubyte *)col2);
<a name="l01361"></a>01361 
<a name="l01362"></a>01362                     <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aec8379af7490bb9eaaf579cf17876f38">RIGHT</a>, 5, 10, 5);
<a name="l01363"></a>01363                     <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60adb45120aafd37a973140edee24708065">LEFT</a>, 5, 10, 5);
<a name="l01364"></a>01364 
<a name="l01365"></a>01365                     <a class="code" href="../../de/d96/UI__resources_8h.html#a0987940839c284639e62eaa495a117a3">UI_make_axis_color</a>(col, col2, <span class="charliteral">&#39;Y&#39;</span>);
<a name="l01366"></a>01366                     glColor3ubv((GLubyte *)col2);
<a name="l01367"></a>01367 
<a name="l01368"></a>01368                     <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60aba595d8bca8bc5e67c37c0a9d89becfa">UP</a>, 5, 10, 5);
<a name="l01369"></a>01369                     <a class="code" href="../../d8/d27/transform_8c.html#a8db5ea35e2002b00fcb7970a0b7e73c6">drawArrow</a>(<a class="code" href="../../d8/d27/transform_8c.html#afb8fed80ba8a91efa17a9889f856fd60a9b0b4a95b99523966e0e34ffdadac9da">DOWN</a>, 5, 10, 5);
<a name="l01370"></a>01370                     glLineWidth(1.0);
<a name="l01371"></a>01371                     <span class="keywordflow">break</span>;
<a name="l01372"></a>01372                 }
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375         glPopMatrix();
<a name="l01376"></a>01376     }
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01379"></a><a class="code" href="../../d8/d27/transform_8c.html#a13069ba25d5e3462fedf3cbd57f1a4e4">01379</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a13069ba25d5e3462fedf3cbd57f1a4e4">drawTransformView</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">struct</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ar), <span class="keywordtype">void</span> *arg)
<a name="l01380"></a>01380 {
<a name="l01381"></a>01381     <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t = arg;
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     <a class="code" href="../../d2/d80/transform_8h.html#a37ce8f1dc6cc883488baf9e845e25551">drawConstraint</a>(t);
<a name="l01384"></a>01384     <a class="code" href="../../d2/d80/transform_8h.html#a4d9cfc518bcf4471c6e5c12e3164f700">drawPropCircle</a>(C, t);
<a name="l01385"></a>01385     <a class="code" href="../../d2/d80/transform_8h.html#a78ee7b9fe39b07585a236950789cf97a">drawSnapping</a>(C, t);
<a name="l01386"></a>01386 }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 <span class="preprocessor">#if 0</span>
<a name="l01389"></a>01389 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> drawTransformPixel(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <span class="keyword">struct</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ar), <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(arg))
<a name="l01390"></a>01390 {
<a name="l01391"></a>01391 <span class="comment">//  TransInfo *t = arg;</span>
<a name="l01392"></a>01392 <span class="comment">//</span>
<a name="l01393"></a>01393 <span class="comment">//  drawHelpline(C, t-&gt;mval[0], t-&gt;mval[1], t);</span>
<a name="l01394"></a>01394 }
<a name="l01395"></a>01395 <span class="preprocessor">#endif</span>
<a name="l01396"></a>01396 <span class="preprocessor"></span>
<a name="l01397"></a><a class="code" href="../../d2/d80/transform_8h.html#aa07864e3c3a582885a8de5fb59bd67fd">01397</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a7dd8309191968a11e30ac8f5ce8c0881">saveTransform</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01398"></a>01398 {
<a name="l01399"></a>01399     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l01400"></a>01400     <span class="keywordtype">int</span> constraint_axis[3] = {0, 0, 0};
<a name="l01401"></a>01401     <span class="keywordtype">int</span> proportional = 0;
<a name="l01402"></a>01402     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404     <span class="comment">// Save back mode in case we&#39;re in the generic operator</span>
<a name="l01405"></a>01405     <span class="keywordflow">if</span> ((prop= <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>))) {
<a name="l01406"></a>01406         <a class="code" href="../../d3/d10/rna__access_8c.html#a557c923d4a24b42363256f33a6fb9205">RNA_property_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>);
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408 
<a name="l01409"></a>01409     <span class="keywordflow">if</span> ((prop= <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;value&quot;</span>))) {
<a name="l01410"></a>01410         <span class="keywordtype">float</span> *values= (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a7a2ceb90fc29195a2388ff3ab6c9afdc">T_AUTOVALUES</a>) ? t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab4cbd79b83d7177d1e31f0c22db98c4f">auto_values</a> : t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>;
<a name="l01411"></a>01411         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d3/d10/rna__access_8c.html#a2b969ea1007e1516895f65336025e529">RNA_property_array_check</a>(prop)) {
<a name="l01412"></a>01412             <a class="code" href="../../d3/d10/rna__access_8c.html#ab7ca0e1bc4c13dcd06cdd992ca60917f">RNA_property_float_set_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, values);
<a name="l01413"></a>01413         }
<a name="l01414"></a>01414         <span class="keywordflow">else</span> {
<a name="l01415"></a>01415             <a class="code" href="../../d3/d10/rna__access_8c.html#abdb7455ec63efacab0c1d5b9fb25b0b0">RNA_property_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, values[0]);
<a name="l01416"></a>01416         }
<a name="l01417"></a>01417     }
<a name="l01418"></a>01418 
<a name="l01419"></a>01419     <span class="comment">/* convert flag to enum */</span>
<a name="l01420"></a>01420     <span class="keywordflow">switch</span>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>))
<a name="l01421"></a>01421     {
<a name="l01422"></a>01422     <span class="keywordflow">case</span> (<a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>):
<a name="l01423"></a>01423         proportional = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aec9bf670333f03d75dd61b89b1b33705">PROP_EDIT_CONNECTED</a>;
<a name="l01424"></a>01424         <span class="keywordflow">break</span>;
<a name="l01425"></a>01425     <span class="keywordflow">case</span> <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>:
<a name="l01426"></a>01426         proportional = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1e5e87440ff10af2ec3806ce44fe9811">PROP_EDIT_ON</a>;
<a name="l01427"></a>01427         <span class="keywordflow">break</span>;
<a name="l01428"></a>01428     <span class="keywordflow">default</span>:
<a name="l01429"></a>01429         proportional = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae50855981921972af6050721fa10e24c">PROP_EDIT_OFF</a>;
<a name="l01430"></a>01430     }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432     <span class="comment">// If modal, save settings back in scene if not set as operator argument</span>
<a name="l01433"></a>01433     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a14a5f9214badde85a38e6382a04575e8">T_MODAL</a>) {
<a name="l01434"></a>01434 
<a name="l01435"></a>01435         <span class="comment">/* save settings if not set in operator */</span>
<a name="l01436"></a>01436         <span class="keywordflow">if</span> ( (prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional&quot;</span>)) &amp;&amp; !<a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01437"></a>01437         {
<a name="l01438"></a>01438             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>)
<a name="l01439"></a>01439                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a58e182ff7a3973603a2195f3c5a841cd">proportional</a> = proportional;
<a name="l01440"></a>01440             <span class="keywordflow">else</span>
<a name="l01441"></a>01441                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#af437ac50d568b0e25e5237e9fa75eb84">proportional_objects</a> = (proportional != <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae50855981921972af6050721fa10e24c">PROP_EDIT_OFF</a>);
<a name="l01442"></a>01442         }
<a name="l01443"></a>01443 
<a name="l01444"></a>01444         <span class="keywordflow">if</span> ( (prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional_size&quot;</span>)) &amp;&amp; !<a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01445"></a>01445         {
<a name="l01446"></a>01446             ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a6848be823e78cd9918fa67fb0f1de0ff">proportional_size</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>;
<a name="l01447"></a>01447         }
<a name="l01448"></a>01448 
<a name="l01449"></a>01449         <span class="keywordflow">if</span> ( (prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional_edit_falloff&quot;</span>)) &amp;&amp; !<a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01450"></a>01450         {
<a name="l01451"></a>01451             ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a6e185edb0dfa53b903a5094c7ef1100a">prop_mode</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a96b09fc42650d2e8d38a1c2fae9732a9">prop_mode</a>;
<a name="l01452"></a>01452         }
<a name="l01453"></a>01453         
<a name="l01454"></a>01454         <span class="comment">/* do we check for parameter? */</span>
<a name="l01455"></a>01455         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a73e5c7c6238faf4462f864974093e60d">MOD_SNAP</a>) {
<a name="l01456"></a>01456             ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a753542d0c510180f622f335a359c9b43">snap_flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3b43ed19c4ceb5efbb2d20215536819d">SCE_SNAP</a>;
<a name="l01457"></a>01457         }
<a name="l01458"></a>01458         <span class="keywordflow">else</span> {
<a name="l01459"></a>01459             ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a753542d0c510180f622f335a359c9b43">snap_flag</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3b43ed19c4ceb5efbb2d20215536819d">SCE_SNAP</a>;
<a name="l01460"></a>01460         }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l01463"></a>01463             <span class="keywordflow">if</span> ( (prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint_orientation&quot;</span>)) &amp;&amp; !<a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01464"></a>01464             {
<a name="l01465"></a>01465                 <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>;
<a name="l01466"></a>01466     
<a name="l01467"></a>01467                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a452d75e2b468b56009a1cca1fe8422d3">twmode</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>;
<a name="l01468"></a>01468             }
<a name="l01469"></a>01469         }
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471     
<a name="l01472"></a>01472     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional&quot;</span>))
<a name="l01473"></a>01473     {
<a name="l01474"></a>01474         <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional&quot;</span>, proportional);
<a name="l01475"></a>01475         <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional_edit_falloff&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a96b09fc42650d2e8d38a1c2fae9732a9">prop_mode</a>);
<a name="l01476"></a>01476         <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;proportional_size&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>);
<a name="l01477"></a>01477     }
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     <span class="keywordflow">if</span> ((prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;axis&quot;</span>)))
<a name="l01480"></a>01480     {
<a name="l01481"></a>01481         <a class="code" href="../../d3/d10/rna__access_8c.html#ab7ca0e1bc4c13dcd06cdd992ca60917f">RNA_property_float_set_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l01482"></a>01482     }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <span class="keywordflow">if</span> ((prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mirror&quot;</span>)))
<a name="l01485"></a>01485     {
<a name="l01486"></a>01486         <a class="code" href="../../d3/d10/rna__access_8c.html#a007e3f02d7d262b9cf7865abd6647db3">RNA_property_boolean_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9aa3be50bbe7b3d361d1d5ad7c9b5975">T_MIRROR</a>);
<a name="l01487"></a>01487     }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489     <span class="keywordflow">if</span> ((prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint_axis&quot;</span>)))
<a name="l01490"></a>01490     {
<a name="l01491"></a>01491         <span class="comment">/* constraint orientation can be global, event if user selects something else</span>
<a name="l01492"></a>01492 <span class="comment">         * so use the orientation in the constraint if set</span>
<a name="l01493"></a>01493 <span class="comment">         * */</span>
<a name="l01494"></a>01494         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l01495"></a>01495             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint_orientation&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a5589b8da1ed72aecc3c1c8f0323ae4d2">orientation</a>);
<a name="l01496"></a>01496         }
<a name="l01497"></a>01497         <span class="keywordflow">else</span> {
<a name="l01498"></a>01498             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint_orientation&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>);
<a name="l01499"></a>01499         }
<a name="l01500"></a>01500 
<a name="l01501"></a>01501         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>)
<a name="l01502"></a>01502         {
<a name="l01503"></a>01503             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>) {
<a name="l01504"></a>01504                 constraint_axis[0] = 1;
<a name="l01505"></a>01505             }
<a name="l01506"></a>01506             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>) {
<a name="l01507"></a>01507                 constraint_axis[1] = 1;
<a name="l01508"></a>01508             }
<a name="l01509"></a>01509             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>) {
<a name="l01510"></a>01510                 constraint_axis[2] = 1;
<a name="l01511"></a>01511             }
<a name="l01512"></a>01512         }
<a name="l01513"></a>01513 
<a name="l01514"></a>01514         <a class="code" href="../../d3/d10/rna__access_8c.html#a131f6d2a8690b568ccb41f7311d007d7">RNA_property_boolean_set_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, constraint_axis);
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516 }
<a name="l01517"></a>01517 
<a name="l01518"></a>01518 <span class="comment">/* note: caller needs to free &#39;t&#39; on a 0 return */</span>
<a name="l01519"></a><a class="code" href="../../d2/d80/transform_8h.html#a9e85caf8236d9fd4a879d7b5d37a5f8a">01519</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a38b2bcdd820d8822885bffd41d5e5a95">initTransform</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">int</span> mode)
<a name="l01520"></a>01520 {
<a name="l01521"></a>01521     <span class="keywordtype">int</span> <a class="code" href="../../d3/d77/cycles__test_8cpp.html#ae5dd30972ef2b22e7bb03125f3c4a8c8">options</a> = 0;
<a name="l01522"></a>01522     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l01523"></a>01523 
<a name="l01524"></a>01524     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab147be1bcf7368b26b64315c86559dd4">context</a> = <a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526     <span class="comment">/* added initialize, for external calls to set stuff in TransInfo, like undo string */</span>
<a name="l01527"></a>01527 
<a name="l01528"></a>01528     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#acb57f5e71b75350ca336aca01d168d69">TRANS_STARTING</a>;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="keywordflow">if</span> ( (prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;texture_space&quot;</span>)) &amp;&amp; <a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01531"></a>01531     {
<a name="l01532"></a>01532         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a4a0d200b12ded21d24676dcff67732">RNA_property_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop)) {
<a name="l01533"></a>01533             options |= <a class="code" href="../../d8/df2/ED__transform_8h.html#ad72aa2d5f0a19fb0e785f5ca7ceb200f">CTX_TEXTURE</a>;
<a name="l01534"></a>01534         }
<a name="l01535"></a>01535     }
<a name="l01536"></a>01536     
<a name="l01537"></a>01537     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> = <a class="code" href="../../d3/d77/cycles__test_8cpp.html#ae5dd30972ef2b22e7bb03125f3c4a8c8">options</a>;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = mode;
<a name="l01540"></a>01540 
<a name="l01541"></a>01541     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> = <span class="keyword">event</span> ? <span class="keyword">event</span>-&gt;type : -1;
<a name="l01542"></a>01542 
<a name="l01543"></a>01543     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a68017306864d5fdc47f7f1de55d948ef">EVT_TWEAK_R</a>)
<a name="l01544"></a>01544     {
<a name="l01545"></a>01545         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>;
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae4834ccdca786c15b0f3520f69a98b7f">EVT_TWEAK_L</a>) {
<a name="l01548"></a>01548         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>;
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550 
<a name="l01551"></a>01551     <span class="comment">// XXX Remove this when wm_operator_call_internal doesn&#39;t use window-&gt;eventstate (which can have type = 0)</span>
<a name="l01552"></a>01552     <span class="comment">// For manipulator only, so assume LEFTMOUSE</span>
<a name="l01553"></a>01553     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> == 0)
<a name="l01554"></a>01554     {
<a name="l01555"></a>01555         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae36ace937fe5ab309dc4ef3f35aed01b">launch_event</a> = <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>;
<a name="l01556"></a>01556     }
<a name="l01557"></a>01557 
<a name="l01558"></a>01558     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d80/transform_8h.html#a18ee9fb00d7e3cd303abdefcf470fce0">initTransInfo</a>(C, t, op, event))                    <span class="comment">// internal data, mouse, vectors</span>
<a name="l01559"></a>01559     {
<a name="l01560"></a>01560         <span class="keywordflow">return</span> 0;
<a name="l01561"></a>01561     }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>)
<a name="l01564"></a>01564     {
<a name="l01565"></a>01565         <span class="comment">//calc_manipulator_stats(curarea);</span>
<a name="l01566"></a>01566         <a class="code" href="../../d2/d80/transform_8h.html#adf3c227559b7a4229ef53c2416eabd2d">initTransformOrientation</a>(C, t);
<a name="l01567"></a>01567 
<a name="l01568"></a>01568         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#afd89b54480e7edb8cebe85016c2aec0f">draw_handle_apply</a> = <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a48864a13f19218cbd1ff98b7fe9eb958">ED_region_draw_cb_activate</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <a class="code" href="../../d8/d27/transform_8c.html#a19f34d1d9dd68e425b759d696f75f940">drawTransformApply</a>, t, <a class="code" href="../../d0/d5f/ED__space__api_8h.html#afbab0cee361ee5097843d87297280597">REGION_DRAW_PRE_VIEW</a>);
<a name="l01569"></a>01569         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#afb9d8413beab4cc5101d1c44d3c48616">draw_handle_view</a> = <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a48864a13f19218cbd1ff98b7fe9eb958">ED_region_draw_cb_activate</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <a class="code" href="../../d8/d27/transform_8c.html#a13069ba25d5e3462fedf3cbd57f1a4e4">drawTransformView</a>, t, <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a3e6b57328ed92de959be772232b63718">REGION_DRAW_POST_VIEW</a>);
<a name="l01570"></a>01570         <span class="comment">//t-&gt;draw_handle_pixel = ED_region_draw_cb_activate(t-&gt;ar-&gt;type, drawTransformPixel, t, REGION_DRAW_POST_PIXEL);</span>
<a name="l01571"></a>01571         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a533aca325c114522b29b9a6f5b0e0513">draw_handle_cursor</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a734142166fb62b582767fbe4974c70d4">WM_paint_cursor_activate</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../d8/d27/transform_8c.html#aaa5e607b6ca3b6f4092f2040f0410760">helpline_poll</a>, <a class="code" href="../../d8/d27/transform_8c.html#a6ceacec40a8acd204eaad9f2cd372d67">drawHelpline</a>, t);
<a name="l01572"></a>01572     }
<a name="l01573"></a>01573     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l01574"></a>01574         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae913d49905789e8a81479471c879258e">spacemtx</a>);
<a name="l01575"></a>01575         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#afb9d8413beab4cc5101d1c44d3c48616">draw_handle_view</a> = <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a48864a13f19218cbd1ff98b7fe9eb958">ED_region_draw_cb_activate</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <a class="code" href="../../d8/d27/transform_8c.html#a13069ba25d5e3462fedf3cbd57f1a4e4">drawTransformView</a>, t, <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a3e6b57328ed92de959be772232b63718">REGION_DRAW_POST_VIEW</a>);
<a name="l01576"></a>01576         <span class="comment">//t-&gt;draw_handle_pixel = ED_region_draw_cb_activate(t-&gt;ar-&gt;type, drawTransformPixel, t, REGION_DRAW_POST_PIXEL);</span>
<a name="l01577"></a>01577         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a533aca325c114522b29b9a6f5b0e0513">draw_handle_cursor</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a734142166fb62b582767fbe4974c70d4">WM_paint_cursor_activate</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../d8/d27/transform_8c.html#aaa5e607b6ca3b6f4092f2040f0410760">helpline_poll</a>, <a class="code" href="../../d8/d27/transform_8c.html#a6ceacec40a8acd204eaad9f2cd372d67">drawHelpline</a>, t);
<a name="l01578"></a>01578     }
<a name="l01579"></a>01579     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l01580"></a>01580         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae913d49905789e8a81479471c879258e">spacemtx</a>);
<a name="l01581"></a>01581         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#afb9d8413beab4cc5101d1c44d3c48616">draw_handle_view</a> = <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a48864a13f19218cbd1ff98b7fe9eb958">ED_region_draw_cb_activate</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <a class="code" href="../../d8/d27/transform_8c.html#a13069ba25d5e3462fedf3cbd57f1a4e4">drawTransformView</a>, t, <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a3e6b57328ed92de959be772232b63718">REGION_DRAW_POST_VIEW</a>);
<a name="l01582"></a>01582         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> |= <a class="code" href="../../d8/df2/ED__transform_8h.html#aa845d497ca7d08b6ff5673425c7674ae">CTX_MOVIECLIP</a>;
<a name="l01583"></a>01583     }
<a name="l01584"></a>01584     <span class="keywordflow">else</span>
<a name="l01585"></a>01585         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae913d49905789e8a81479471c879258e">spacemtx</a>);
<a name="l01586"></a>01586 
<a name="l01587"></a>01587     <a class="code" href="../../d2/d80/transform_8h.html#a2aea39b28385d35663b1abdee373ac81">createTransData</a>(C, t);          <span class="comment">// make TransData structs from selection</span>
<a name="l01588"></a>01588 
<a name="l01589"></a>01589     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a> == 0) {
<a name="l01590"></a>01590         <a class="code" href="../../d2/d80/transform_8h.html#a3bd4c39c4b3758f6283c4eb65729ef25">postTrans</a>(C, t);
<a name="l01591"></a>01591         <span class="keywordflow">return</span> 0;
<a name="l01592"></a>01592     }
<a name="l01593"></a>01593 
<a name="l01594"></a>01594     <span class="comment">/* Stupid code to have Ctrl-Click on manipulator work ok */</span>
<a name="l01595"></a>01595     <span class="keywordflow">if</span> (event)
<a name="l01596"></a>01596     {
<a name="l01597"></a>01597         <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a5d7466bc7e94c53b52260316d84b72ad">WM_keymap_active</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0d13d4a55c5ec3e0b6121a7b8add67ea">modalkeymap</a>);
<a name="l01598"></a>01598         <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l01599"></a>01599 
<a name="l01600"></a>01600         <span class="keywordflow">for</span> (kmi = keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a0ae48f8a4481c3faf008d60d6d61b4ad">items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmi; kmi = kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a5cb105349fd3c21f73142d637602a75e">next</a>)
<a name="l01601"></a>01601         {
<a name="l01602"></a>01602             <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a06331283ff29944b3c6849ce1a8ebb86">propvalue</a> == <a class="code" href="../../d8/d27/transform_8c.html#a6a172c1b98bdadd58c2ac8c48dfd5585">TFM_MODAL_SNAP_INV_ON</a> &amp;&amp; kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a484ea38a77ce4b2cdb230e14bd62076c">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l01603"></a>01603             {
<a name="l01604"></a>01604                 <span class="keywordflow">if</span> ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad025960542c5698bad7efc649c641897">LEFTCTRLKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aacc3c8c5f05ebb7eeca8e4da6dc9c969">RIGHTCTRLKEY</a>) &amp;&amp;   event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>)  ||
<a name="l01605"></a>01605                     (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8bb00d0e3bbc5c558edcef2b6c7d549c">LEFTSHIFTKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a60ddce316227eaa9586286cca0e085f5">RIGHTSHIFTKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) ||
<a name="l01606"></a>01606                     (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a40ea4d6b0d8ed13cc872f87fb6d4559b">LEFTALTKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac92a400a2afe72bfc979d23307b29a26">RIGHTALTKEY</a>) &amp;&amp;     event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>)   ||
<a name="l01607"></a>01607                     ((kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#afe82868e971ef6b4aff6eabc84090c20">OSKEY</a>) &amp;&amp;                         event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) )
<a name="l01608"></a>01608                 {
<a name="l01609"></a>01609                     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> |= <a class="code" href="../../d2/d80/transform_8h.html#adc896c2472a2c2ee0479aa7c2b81fd00">MOD_SNAP_INVERT</a>;
<a name="l01610"></a>01610                 }
<a name="l01611"></a>01611                 <span class="keywordflow">break</span>;
<a name="l01612"></a>01612             }
<a name="l01613"></a>01613         }
<a name="l01614"></a>01614 
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617     <a class="code" href="../../d2/d80/transform_8h.html#aee40fe7cf86f9060724395c6fb86bba8">initSnapping</a>(t, op); <span class="comment">// Initialize snapping data AFTER mode flags</span>
<a name="l01618"></a>01618 
<a name="l01619"></a>01619     <span class="comment">/* EVIL! posemode code can switch translation to rotate when 1 bone is selected. will be removed (ton) */</span>
<a name="l01620"></a>01620     <span class="comment">/* EVIL2: we gave as argument also texture space context bit... was cleared */</span>
<a name="l01621"></a>01621     <span class="comment">/* EVIL3: extend mode for animation editors also switches modes... but is best way to avoid duplicate code */</span>
<a name="l01622"></a>01622     mode = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>;
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     <a class="code" href="../../d2/d80/transform_8h.html#aa2bd1c59bbb681af3c1bf95be8c2f0a1">calculatePropRatio</a>(t);
<a name="l01625"></a>01625     <a class="code" href="../../d2/d80/transform_8h.html#a0494c7a122871d263e60b00330d8d9c0">calculateCenter</a>(t);
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     <a class="code" href="../../d2/d80/transform_8h.html#aff34b6d705cb678da8665da376ff4871">initMouseInput</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a22c3f79fec827b320741386a95e7b848">center2d</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>);
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     <span class="keywordflow">switch</span> (mode) {
<a name="l01630"></a>01630     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>:
<a name="l01631"></a>01631         <a class="code" href="../../d8/d27/transform_8c.html#a6e79b804b31355f3c48c4e6455b18ba6">initTranslation</a>(t);
<a name="l01632"></a>01632         <span class="keywordflow">break</span>;
<a name="l01633"></a>01633     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>:
<a name="l01634"></a>01634         <a class="code" href="../../d8/d27/transform_8c.html#adc9eb52f311d8812a078a63adbba18f8">initRotation</a>(t);
<a name="l01635"></a>01635         <span class="keywordflow">break</span>;
<a name="l01636"></a>01636     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a002f81b26542b400faa00b3e7209fbbf">TFM_RESIZE</a>:
<a name="l01637"></a>01637         <a class="code" href="../../d8/d27/transform_8c.html#a07a126d25aafc67aae1b520d37d4b656">initResize</a>(t);
<a name="l01638"></a>01638         <span class="keywordflow">break</span>;
<a name="l01639"></a>01639     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84aa28b932311967ca44afb77bd8c32bedd">TFM_TOSPHERE</a>:
<a name="l01640"></a>01640         <a class="code" href="../../d8/d27/transform_8c.html#ac9a5b9fd8568ee7e098ca5b7572c2783">initToSphere</a>(t);
<a name="l01641"></a>01641         <span class="keywordflow">break</span>;
<a name="l01642"></a>01642     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a15c6eda45582a1df441e4cd64b9e7c06">TFM_SHEAR</a>:
<a name="l01643"></a>01643         <a class="code" href="../../d8/d27/transform_8c.html#a0ad3b443ff63fa8b4c9f90ccdfc8d0cd">initShear</a>(t);
<a name="l01644"></a>01644         <span class="keywordflow">break</span>;
<a name="l01645"></a>01645     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ab714178c6f2de480e83acc0ec3fd0efe">TFM_WARP</a>:
<a name="l01646"></a>01646         <a class="code" href="../../d8/d27/transform_8c.html#a59a3772457b2d74674afc8a19effea29">initWarp</a>(t);
<a name="l01647"></a>01647         <span class="keywordflow">break</span>;
<a name="l01648"></a>01648     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a191c2991f97ac68b33be89878cd8d86f">TFM_SHRINKFATTEN</a>:
<a name="l01649"></a>01649         <a class="code" href="../../d8/d27/transform_8c.html#aa43c3f0349a06ef13264e13911f762ad">initShrinkFatten</a>(t);
<a name="l01650"></a>01650         <span class="keywordflow">break</span>;
<a name="l01651"></a>01651     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a8d6349d11b4188bf4d957c10e451a8bd">TFM_TILT</a>:
<a name="l01652"></a>01652         <a class="code" href="../../d8/d27/transform_8c.html#a91d0de62670dd363356c3f7bd1b3139c">initTilt</a>(t);
<a name="l01653"></a>01653         <span class="keywordflow">break</span>;
<a name="l01654"></a>01654     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a837dbbd86a29c6809df24fd80f59cd6e">TFM_CURVE_SHRINKFATTEN</a>:
<a name="l01655"></a>01655         <a class="code" href="../../d8/d27/transform_8c.html#a735b795c4ed02759da1de006f8ef1730">initCurveShrinkFatten</a>(t);
<a name="l01656"></a>01656         <span class="keywordflow">break</span>;
<a name="l01657"></a>01657     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>:
<a name="l01658"></a>01658         <a class="code" href="../../d8/d27/transform_8c.html#a4f667262c34ee4cae1bace342cd02872">initTrackball</a>(t);
<a name="l01659"></a>01659         <span class="keywordflow">break</span>;
<a name="l01660"></a>01660     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84addf8f91b42daedefc3789151d2d14b14">TFM_PUSHPULL</a>:
<a name="l01661"></a>01661         <a class="code" href="../../d8/d27/transform_8c.html#a036b4f8336d693b469dd0ea8aa95b82d">initPushPull</a>(t);
<a name="l01662"></a>01662         <span class="keywordflow">break</span>;
<a name="l01663"></a>01663     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a44ed7ad28b293b571e2bbeb66eaed103">TFM_CREASE</a>:
<a name="l01664"></a>01664         <a class="code" href="../../d8/d27/transform_8c.html#adfba3849d89398f23123994fa6f1e413">initCrease</a>(t);
<a name="l01665"></a>01665         <span class="keywordflow">break</span>;
<a name="l01666"></a>01666     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a085de28577dde02621dca82419fbe37e">TFM_BONESIZE</a>:
<a name="l01667"></a>01667         {   <span class="comment">/* used for both B-Bone width (bonesize) as for deform-dist (envelope) */</span>
<a name="l01668"></a>01668             <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aefcd6d2b51a3fa9ab4479e0f84928c57">poseobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01669"></a>01669             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#acb03dde243f37c1d33c6e3e9d4c84e4f">drawtype</a>==<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ae65894ad70dde0a4d4cc7ccd7395a97ea710c9b5e305a75948f7e5ec67bfae47c">ARM_ENVELOPE</a>)
<a name="l01670"></a>01670                 <a class="code" href="../../d8/d27/transform_8c.html#abe3247638587346a3a06654de1ffa41c">initBoneEnvelope</a>(t);
<a name="l01671"></a>01671             <span class="keywordflow">else</span>
<a name="l01672"></a>01672                 <a class="code" href="../../d8/d27/transform_8c.html#a24e9e16adb2237e3175bb3752d32a542">initBoneSize</a>(t);
<a name="l01673"></a>01673         }
<a name="l01674"></a>01674         <span class="keywordflow">break</span>;
<a name="l01675"></a>01675     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a540332390ec15a5ba7e8e4bb72112332">TFM_BONE_ENVELOPE</a>:
<a name="l01676"></a>01676         <a class="code" href="../../d8/d27/transform_8c.html#abe3247638587346a3a06654de1ffa41c">initBoneEnvelope</a>(t);
<a name="l01677"></a>01677         <span class="keywordflow">break</span>;
<a name="l01678"></a>01678     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a023180aa474073c43bdaa34da21dfc1b">TFM_EDGE_SLIDE</a>:
<a name="l01679"></a>01679         <a class="code" href="../../d8/d27/transform_8c.html#af42e9a267926b484569394c5cd0f0b89">initEdgeSlide</a>(t);
<a name="l01680"></a>01680         <span class="keywordflow">break</span>;
<a name="l01681"></a>01681     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a6385405fb82e713908aedcf53e68251f">TFM_BONE_ROLL</a>:
<a name="l01682"></a>01682         <a class="code" href="../../d8/d27/transform_8c.html#a77838f76c12b6bdfaa558240b3b8b44e">initBoneRoll</a>(t);
<a name="l01683"></a>01683         <span class="keywordflow">break</span>;
<a name="l01684"></a>01684     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a1b694290143ef696dc875fbfc781fe95">TFM_TIME_TRANSLATE</a>:
<a name="l01685"></a>01685         <a class="code" href="../../d8/d27/transform_8c.html#a5b3196a7c1967e92a5d888fe721a7eeb">initTimeTranslate</a>(t);
<a name="l01686"></a>01686         <span class="keywordflow">break</span>;
<a name="l01687"></a>01687     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a2dc512af3f5d8730985575cf15748841">TFM_TIME_SLIDE</a>:
<a name="l01688"></a>01688         <a class="code" href="../../d8/d27/transform_8c.html#a86bf3028e20e2047ec9fddd0b1a2d215">initTimeSlide</a>(t);
<a name="l01689"></a>01689         <span class="keywordflow">break</span>;
<a name="l01690"></a>01690     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a5b7e90511827ddaaab5b2b804ef0177d">TFM_TIME_SCALE</a>:
<a name="l01691"></a>01691         <a class="code" href="../../d8/d27/transform_8c.html#a336a039ecb2fbc4d76bba024b820c3dd">initTimeScale</a>(t);
<a name="l01692"></a>01692         <span class="keywordflow">break</span>;
<a name="l01693"></a>01693     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a601bceb28daf878239c1814105845ece">TFM_TIME_DUPLICATE</a>:
<a name="l01694"></a>01694         <span class="comment">/* same as TFM_TIME_EXTEND, but we need the mode info for later </span>
<a name="l01695"></a>01695 <span class="comment">         * so that duplicate-culling will work properly</span>
<a name="l01696"></a>01696 <span class="comment">         */</span>
<a name="l01697"></a>01697         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>))
<a name="l01698"></a>01698             <a class="code" href="../../d8/d27/transform_8c.html#a6e79b804b31355f3c48c4e6455b18ba6">initTranslation</a>(t);
<a name="l01699"></a>01699         <span class="keywordflow">else</span>
<a name="l01700"></a>01700             <a class="code" href="../../d8/d27/transform_8c.html#a5b3196a7c1967e92a5d888fe721a7eeb">initTimeTranslate</a>(t);
<a name="l01701"></a>01701         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = mode;
<a name="l01702"></a>01702         <span class="keywordflow">break</span>;
<a name="l01703"></a>01703     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a706b1fa0521fa60980f124620afc8e1d">TFM_TIME_EXTEND</a>:
<a name="l01704"></a>01704         <span class="comment">/* now that transdata has been made, do like for TFM_TIME_TRANSLATE (for most Animation</span>
<a name="l01705"></a>01705 <span class="comment">         * Editors because they have only 1D transforms for time values) or TFM_TRANSLATION</span>
<a name="l01706"></a>01706 <span class="comment">         * (for Graph/NLA Editors only since they uses &#39;standard&#39; transforms to get 2D movement)</span>
<a name="l01707"></a>01707 <span class="comment">         * depending on which editor this was called from</span>
<a name="l01708"></a>01708 <span class="comment">         */</span>
<a name="l01709"></a>01709         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>))
<a name="l01710"></a>01710             <a class="code" href="../../d8/d27/transform_8c.html#a6e79b804b31355f3c48c4e6455b18ba6">initTranslation</a>(t);
<a name="l01711"></a>01711         <span class="keywordflow">else</span>
<a name="l01712"></a>01712             <a class="code" href="../../d8/d27/transform_8c.html#a5b3196a7c1967e92a5d888fe721a7eeb">initTimeTranslate</a>(t);
<a name="l01713"></a>01713         <span class="keywordflow">break</span>;
<a name="l01714"></a>01714     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a2f96c8512b5167e00ca16bc9cdfaed07">TFM_BAKE_TIME</a>:
<a name="l01715"></a>01715         <a class="code" href="../../d8/d27/transform_8c.html#af8a997f5dce1304f0a28d9dd72185ea2">initBakeTime</a>(t);
<a name="l01716"></a>01716         <span class="keywordflow">break</span>;
<a name="l01717"></a>01717     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac5109c981e187de7d75671ef34505cc8">TFM_MIRROR</a>:
<a name="l01718"></a>01718         <a class="code" href="../../d8/d27/transform_8c.html#a9965370aafec7b6840eb7e3815dee606">initMirror</a>(t);
<a name="l01719"></a>01719         <span class="keywordflow">break</span>;
<a name="l01720"></a>01720     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a4a3c031c77de58b7d984fb5dfde45b46">TFM_BEVEL</a>:
<a name="l01721"></a>01721         <a class="code" href="../../d8/d27/transform_8c.html#ad9d08f67e21176f01ab2a95f205fe610">initBevel</a>(t);
<a name="l01722"></a>01722         <span class="keywordflow">break</span>;
<a name="l01723"></a>01723     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a590f4425e877e8a8b68d98ad4534f108">TFM_BWEIGHT</a>:
<a name="l01724"></a>01724         <a class="code" href="../../d8/d27/transform_8c.html#a4a543ca7efb64817582c6b509fd451fb">initBevelWeight</a>(t);
<a name="l01725"></a>01725         <span class="keywordflow">break</span>;
<a name="l01726"></a>01726     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a5a38fdb7a0df02c03960f43a2aa3cbda">TFM_ALIGN</a>:
<a name="l01727"></a>01727         <a class="code" href="../../d8/d27/transform_8c.html#a17f38756607704d507c51f003c050bdd">initAlign</a>(t);
<a name="l01728"></a>01728         <span class="keywordflow">break</span>;
<a name="l01729"></a>01729     <span class="keywordflow">case</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a99c8163ce8b76094fb35573279eeb7a0">TFM_SEQ_SLIDE</a>:
<a name="l01730"></a>01730         <a class="code" href="../../d8/d27/transform_8c.html#a671392b31cbdaa3b20be3f74610cbe52">initSeqSlide</a>(t);
<a name="l01731"></a>01731         <span class="keywordflow">break</span>;
<a name="l01732"></a>01732     }
<a name="l01733"></a>01733 
<a name="l01734"></a>01734     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> == <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>)
<a name="l01735"></a>01735     {
<a name="l01736"></a>01736         <a class="code" href="../../d2/d80/transform_8h.html#a3bd4c39c4b3758f6283c4eb65729ef25">postTrans</a>(C, t);
<a name="l01737"></a>01737         <span class="keywordflow">return</span> 0;
<a name="l01738"></a>01738     }
<a name="l01739"></a>01739 
<a name="l01740"></a>01740 
<a name="l01741"></a>01741     <span class="comment">/* overwrite initial values if operator supplied a non-null vector */</span>
<a name="l01742"></a>01742     <span class="keywordflow">if</span> ( (prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;value&quot;</span>)) &amp;&amp; <a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01743"></a>01743     {
<a name="l01744"></a>01744         <span class="keywordtype">float</span> values[4]= {0}; <span class="comment">/* in case value isn&#39;t length 4, avoid uninitialized memory  */</span>
<a name="l01745"></a>01745 
<a name="l01746"></a>01746         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a2b969ea1007e1516895f65336025e529">RNA_property_array_check</a>(prop)) {
<a name="l01747"></a>01747             <a class="code" href="../../d3/d10/rna__access_8c.html#a5d95f86ccce314676ae750034fb56709">RNA_float_get_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;value&quot;</span>, values);
<a name="l01748"></a>01748         }
<a name="l01749"></a>01749         <span class="keywordflow">else</span> {
<a name="l01750"></a>01750             values[0]= <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;value&quot;</span>);
<a name="l01751"></a>01751         }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a097c602b13da72154b19976046f63ef3">copy_v4_v4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, values);
<a name="l01754"></a>01754         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a097c602b13da72154b19976046f63ef3">copy_v4_v4</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab4cbd79b83d7177d1e31f0c22db98c4f">auto_values</a>, values);
<a name="l01755"></a>01755         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a7a2ceb90fc29195a2388ff3ab6c9afdc">T_AUTOVALUES</a>;
<a name="l01756"></a>01756     }
<a name="l01757"></a>01757 
<a name="l01758"></a>01758     <span class="comment">/* Transformation axis from operator */</span>
<a name="l01759"></a>01759     <span class="keywordflow">if</span> ((prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;axis&quot;</span>)) &amp;&amp; <a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01760"></a>01760     {
<a name="l01761"></a>01761         <a class="code" href="../../d3/d10/rna__access_8c.html#a151557228dae14af24d5e1b57495642b">RNA_property_float_get_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l01762"></a>01762         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l01763"></a>01763         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4e999d7181d5b65ea1350a3dc14d93e0">axis_orig</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l01764"></a>01764     }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766     <span class="comment">/* Constraint init from operator */</span>
<a name="l01767"></a>01767     <span class="keywordflow">if</span> ((prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint_axis&quot;</span>)) &amp;&amp; <a class="code" href="../../d3/d10/rna__access_8c.html#aea62b52ab1ded987e5f473c820a26fd8">RNA_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop))
<a name="l01768"></a>01768     {
<a name="l01769"></a>01769         <span class="keywordtype">int</span> constraint_axis[3];
<a name="l01770"></a>01770 
<a name="l01771"></a>01771         <a class="code" href="../../d3/d10/rna__access_8c.html#af3af416215c3d866744c965e6d4faa10">RNA_property_boolean_get_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, prop, constraint_axis);
<a name="l01772"></a>01772 
<a name="l01773"></a>01773         <span class="keywordflow">if</span> (constraint_axis[0] || constraint_axis[1] || constraint_axis[2])
<a name="l01774"></a>01774         {
<a name="l01775"></a>01775             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> |= <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777             <span class="keywordflow">if</span> (constraint_axis[0]) {
<a name="l01778"></a>01778                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ad10dc9946d4e7113c5d4700e3ab4c64c">CON_AXIS0</a>;
<a name="l01779"></a>01779             }
<a name="l01780"></a>01780             <span class="keywordflow">if</span> (constraint_axis[1]) {
<a name="l01781"></a>01781                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a43d0a3c213d3a8387f1e5e875519908f">CON_AXIS1</a>;
<a name="l01782"></a>01782             }
<a name="l01783"></a>01783             <span class="keywordflow">if</span> (constraint_axis[2]) {
<a name="l01784"></a>01784                 t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a56ef052a3cc61cd84a05ec30a30f066e">CON_AXIS2</a>;
<a name="l01785"></a>01785             }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787             <a class="code" href="../../d2/d80/transform_8h.html#a05d15cb0a860740c89e5cfc9c6c3fecc">setUserConstraint</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae293075a26084c167e6a05a8429a9342">current_orientation</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a>, <span class="stringliteral">&quot;%s&quot;</span>);
<a name="l01788"></a>01788         }
<a name="l01789"></a>01789     }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab147be1bcf7368b26b64315c86559dd4">context</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01792"></a>01792 
<a name="l01793"></a>01793     <span class="keywordflow">return</span> 1;
<a name="l01794"></a>01794 }
<a name="l01795"></a>01795 
<a name="l01796"></a><a class="code" href="../../d2/d80/transform_8h.html#a46133d2d1cb69d34ab6f85c522382adb">01796</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a2d8f012f96bde080e76fe72dda9aff4d">transformApply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l01797"></a>01797 {
<a name="l01798"></a>01798     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab147be1bcf7368b26b64315c86559dd4">context</a> = <a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>;
<a name="l01799"></a>01799 
<a name="l01800"></a>01800     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>) || (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#afd89b54480e7edb8cebe85016c2aec0f">draw_handle_apply</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a6237160832c1da030108b31651044a3f">TREDRAW_SOFT</a>)))
<a name="l01801"></a>01801     {
<a name="l01802"></a>01802         <a class="code" href="../../d2/d80/transform_8h.html#ae43cc434d7c27e490b3f646dacc1eaf4">selectConstraint</a>(t);
<a name="l01803"></a>01803         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a>) {
<a name="l01804"></a>01804             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>);  <span class="comment">// calls recalcData()</span>
<a name="l01805"></a>01805             <a class="code" href="../../d8/d27/transform_8c.html#ab855f84c4a3ac18752b5dbed497fb6b3">viewRedrawForce</a>(C, t);
<a name="l01806"></a>01806         }
<a name="l01807"></a>01807         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> = <a class="code" href="../../d2/d80/transform_8h.html#ae3938b4df4396af42dfa5f41bd596d48">TREDRAW_NOTHING</a>;
<a name="l01808"></a>01808     }
<a name="l01809"></a>01809     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a6237160832c1da030108b31651044a3f">TREDRAW_SOFT</a>) {
<a name="l01810"></a>01810         <a class="code" href="../../d8/d27/transform_8c.html#ab855f84c4a3ac18752b5dbed497fb6b3">viewRedrawForce</a>(C, t);
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     <span class="comment">/* If auto confirm is on, break after one pass */</span>
<a name="l01814"></a>01814     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6c459a7b07358748e582bb7858fc132d">options</a> &amp; <a class="code" href="../../d8/df2/ED__transform_8h.html#afa43ef3a3f8ce51fdcf9ca29b0f0ac3b">CTX_AUTOCONFIRM</a>)
<a name="l01815"></a>01815     {
<a name="l01816"></a>01816         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#aea194444de4ea92edf4d927305106e83">TRANS_CONFIRM</a>;
<a name="l01817"></a>01817     }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819     <span class="keywordflow">if</span> (<a class="code" href="../../db/d45/BKE__pointcache_8h.html#a34764119fdcd6197dceb78b4181e6e3b">BKE_ptcache_get_continue_physics</a>())
<a name="l01820"></a>01820     {
<a name="l01821"></a>01821         <span class="comment">// TRANSFORM_FIX_ME</span>
<a name="l01822"></a>01822         <span class="comment">//do_screenhandlers(G.curscreen);</span>
<a name="l01823"></a>01823         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l01824"></a>01824     }
<a name="l01825"></a>01825 
<a name="l01826"></a>01826     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab147be1bcf7368b26b64315c86559dd4">context</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01827"></a>01827 }
<a name="l01828"></a>01828 
<a name="l01829"></a><a class="code" href="../../d8/d27/transform_8c.html#a8aef8e357e73583b65943e7aa296c86b">01829</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a19f34d1d9dd68e425b759d696f75f940">drawTransformApply</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keyword">struct</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ar), <span class="keywordtype">void</span> *arg)
<a name="l01830"></a>01830 {
<a name="l01831"></a>01831     <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t = arg;
<a name="l01832"></a>01832 
<a name="l01833"></a>01833     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a6237160832c1da030108b31651044a3f">TREDRAW_SOFT</a>) {
<a name="l01834"></a>01834         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a513964da2e62c5001a6ead0ab7835d08">redraw</a> |= <a class="code" href="../../d2/d80/transform_8h.html#ae23fbf88718c932a0f222518ca9e8f61">TREDRAW_HARD</a>;
<a name="l01835"></a>01835         <a class="code" href="../../d8/d27/transform_8c.html#a2d8f012f96bde080e76fe72dda9aff4d">transformApply</a>((<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *)C, t);
<a name="l01836"></a>01836     }
<a name="l01837"></a>01837 }
<a name="l01838"></a>01838 
<a name="l01839"></a><a class="code" href="../../d2/d80/transform_8h.html#a20f078067cdb8a1973341c145f346667">01839</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#afeb29f1590717cb65c9e462d6ba1cad8">transformEnd</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l01840"></a>01840 {
<a name="l01841"></a>01841     <span class="keywordtype">int</span> exit_code = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab147be1bcf7368b26b64315c86559dd4">context</a> = <a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>;
<a name="l01844"></a>01844 
<a name="l01845"></a>01845     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> != <a class="code" href="../../d2/d80/transform_8h.html#acb57f5e71b75350ca336aca01d168d69">TRANS_STARTING</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> != <a class="code" href="../../d2/d80/transform_8h.html#a3a94d1a89ea3f29eefdcac58bbc3845f">TRANS_RUNNING</a>)
<a name="l01846"></a>01846     {
<a name="l01847"></a>01847         <span class="comment">/* handle restoring objects */</span>
<a name="l01848"></a>01848         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> == <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>)
<a name="l01849"></a>01849         {
<a name="l01850"></a>01850             <span class="comment">/* exception, edge slide transformed UVs too */</span>
<a name="l01851"></a>01851             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a>==<a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a023180aa474073c43bdaa34da21dfc1b">TFM_EDGE_SLIDE</a>)
<a name="l01852"></a>01852                 <a class="code" href="../../d8/d27/transform_8c.html#a70aba5d402c4d15ec2a5463f14faba8c">doEdgeSlide</a>(t, 0.0f);
<a name="l01853"></a>01853             
<a name="l01854"></a>01854             exit_code = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01855"></a>01855             <a class="code" href="../../d2/d80/transform_8h.html#a88f1dbab7489040597c8cad6a0b44199">restoreTransObjects</a>(t); <span class="comment">// calls recalcData()</span>
<a name="l01856"></a>01856         }
<a name="l01857"></a>01857         <span class="keywordflow">else</span> {
<a name="l01858"></a>01858             exit_code = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01859"></a>01859         }
<a name="l01860"></a>01860 
<a name="l01861"></a>01861         <span class="comment">/* aftertrans does insert keyframes, and clears base flags, doesnt read transdata */</span>
<a name="l01862"></a>01862         <a class="code" href="../../d2/d80/transform_8h.html#ac14f6ce00e8c7da3ac332c542c284c8e">special_aftertrans_update</a>(C, t);
<a name="l01863"></a>01863 
<a name="l01864"></a>01864         <span class="comment">/* free data */</span>
<a name="l01865"></a>01865         <a class="code" href="../../d2/d80/transform_8h.html#a3bd4c39c4b3758f6283c4eb65729ef25">postTrans</a>(C, t);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867         <span class="comment">/* send events out for redraws */</span>
<a name="l01868"></a>01868         <a class="code" href="../../d8/d27/transform_8c.html#aa9d916bed77ce25f1fb50452b4fbbe5f">viewRedrawPost</a>(C, t);
<a name="l01869"></a>01869 
<a name="l01870"></a>01870         <span class="comment">/*  Undo as last, certainly after special_trans_update! */</span>
<a name="l01871"></a>01871 
<a name="l01872"></a>01872         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> == <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>) {
<a name="l01873"></a>01873 <span class="comment">//          if (t-&gt;undostr) ED_undo_push(C, t-&gt;undostr);</span>
<a name="l01874"></a>01874         }
<a name="l01875"></a>01875         <span class="keywordflow">else</span> {
<a name="l01876"></a>01876 <span class="comment">//          if (t-&gt;undostr) ED_undo_push(C, t-&gt;undostr);</span>
<a name="l01877"></a>01877 <span class="comment">//          else ED_undo_push(C, transform_to_undostr(t));</span>
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a350c90814327d33d01856da840b3a4bc">undostr</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01880"></a>01880 
<a name="l01881"></a>01881         <a class="code" href="../../d8/d27/transform_8c.html#ab855f84c4a3ac18752b5dbed497fb6b3">viewRedrawForce</a>(C, t);
<a name="l01882"></a>01882     }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab147be1bcf7368b26b64315c86559dd4">context</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01885"></a>01885 
<a name="l01886"></a>01886     <span class="keywordflow">return</span> exit_code;
<a name="l01887"></a>01887 }
<a name="l01888"></a>01888 
<a name="l01889"></a>01889 <span class="comment">/* ************************** TRANSFORM LOCKS **************************** */</span>
<a name="l01890"></a>01890 
<a name="l01891"></a><a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">01891</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">protectedTransBits</a>(<span class="keywordtype">short</span> protectflag, <span class="keywordtype">float</span> *vec)
<a name="l01892"></a>01892 {
<a name="l01893"></a>01893     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a7bd0615d3d1b4abbf6bdd1a384444ce3">OB_LOCK_LOCX</a>)
<a name="l01894"></a>01894         vec[0]= 0.0f;
<a name="l01895"></a>01895     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8f462951f76927f5fe4579691b011919">OB_LOCK_LOCY</a>)
<a name="l01896"></a>01896         vec[1]= 0.0f;
<a name="l01897"></a>01897     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a00a97ff22933307b29929585715e9e78">OB_LOCK_LOCZ</a>)
<a name="l01898"></a>01898         vec[2]= 0.0f;
<a name="l01899"></a>01899 }
<a name="l01900"></a>01900 
<a name="l01901"></a><a class="code" href="../../d8/d27/transform_8c.html#af062722085fdd489cdfdc58201b7bfc8">01901</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#af062722085fdd489cdfdc58201b7bfc8">protectedSizeBits</a>(<span class="keywordtype">short</span> protectflag, <span class="keywordtype">float</span> *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l01902"></a>01902 {
<a name="l01903"></a>01903     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#adeeb69ce54fa6721347d823226c9041e">OB_LOCK_SCALEX</a>)
<a name="l01904"></a>01904         size[0]= 1.0f;
<a name="l01905"></a>01905     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#adb3decebd5d9a0ed8d70b6fe30b07ae9">OB_LOCK_SCALEY</a>)
<a name="l01906"></a>01906         size[1]= 1.0f;
<a name="l01907"></a>01907     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac98049e7ab4c0fc185141c18b36bc85e">OB_LOCK_SCALEZ</a>)
<a name="l01908"></a>01908         size[2]= 1.0f;
<a name="l01909"></a>01909 }
<a name="l01910"></a>01910 
<a name="l01911"></a><a class="code" href="../../d8/d27/transform_8c.html#a4593879871add5aad9c7d17925fa7468">01911</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a4593879871add5aad9c7d17925fa7468">protectedRotateBits</a>(<span class="keywordtype">short</span> protectflag, <span class="keywordtype">float</span> *eul, <span class="keywordtype">float</span> *oldeul)
<a name="l01912"></a>01912 {
<a name="l01913"></a>01913     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>)
<a name="l01914"></a>01914         eul[0]= oldeul[0];
<a name="l01915"></a>01915     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>)
<a name="l01916"></a>01916         eul[1]= oldeul[1];
<a name="l01917"></a>01917     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>)
<a name="l01918"></a>01918         eul[2]= oldeul[2];
<a name="l01919"></a>01919 }
<a name="l01920"></a>01920 
<a name="l01921"></a>01921 
<a name="l01922"></a>01922 <span class="comment">/* this function only does the delta rotation */</span>
<a name="l01923"></a>01923 <span class="comment">/* axis-angle is usually internally stored as quats... */</span>
<a name="l01924"></a><a class="code" href="../../d8/d27/transform_8c.html#ab0a21b98ca5665d8f2d50ecbfd3bc800">01924</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ab0a21b98ca5665d8f2d50ecbfd3bc800">protectedAxisAngleBits</a>(<span class="keywordtype">short</span> protectflag, <span class="keywordtype">float</span> axis[3], <span class="keywordtype">float</span> *<a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>, <span class="keywordtype">float</span> oldAxis[3], <span class="keywordtype">float</span> oldAngle)
<a name="l01925"></a>01925 {
<a name="l01926"></a>01926     <span class="comment">/* check that protection flags are set */</span>
<a name="l01927"></a>01927     <span class="keywordflow">if</span> ((protectflag &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa54bdcc6d4b9be00a167a4d49264b1f1">OB_LOCK_ROTW</a>)) == 0)
<a name="l01928"></a>01928         <span class="keywordflow">return</span>;
<a name="l01929"></a>01929     
<a name="l01930"></a>01930     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a7479805656af00b23511bc1dbac25a76">OB_LOCK_ROT4D</a>) {
<a name="l01931"></a>01931         <span class="comment">/* axis-angle getting limited as 4D entities that they are... */</span>
<a name="l01932"></a>01932         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa54bdcc6d4b9be00a167a4d49264b1f1">OB_LOCK_ROTW</a>)
<a name="l01933"></a>01933             *angle= oldAngle;
<a name="l01934"></a>01934         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>)
<a name="l01935"></a>01935             axis[0]= oldAxis[0];
<a name="l01936"></a>01936         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>)
<a name="l01937"></a>01937             axis[1]= oldAxis[1];
<a name="l01938"></a>01938         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>)
<a name="l01939"></a>01939             axis[2]= oldAxis[2];
<a name="l01940"></a>01940     }
<a name="l01941"></a>01941     <span class="keywordflow">else</span> {
<a name="l01942"></a>01942         <span class="comment">/* axis-angle get limited with euler... */</span>
<a name="l01943"></a>01943         <span class="keywordtype">float</span> eul[3], oldeul[3];
<a name="l01944"></a>01944         
<a name="l01945"></a>01945         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aa12d17f2566056509d7d2eeb880496d9">axis_angle_to_eulO</a>( eul, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a4aa95d9f8c95e703a90ba8afe1a3c4bda7c3f7a4cf435a4a3bba131a862e322fa">EULER_ORDER_DEFAULT</a>,axis, *angle);
<a name="l01946"></a>01946         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aa12d17f2566056509d7d2eeb880496d9">axis_angle_to_eulO</a>( oldeul, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a4aa95d9f8c95e703a90ba8afe1a3c4bda7c3f7a4cf435a4a3bba131a862e322fa">EULER_ORDER_DEFAULT</a>,oldAxis, oldAngle);
<a name="l01947"></a>01947         
<a name="l01948"></a>01948         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>)
<a name="l01949"></a>01949             eul[0]= oldeul[0];
<a name="l01950"></a>01950         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>)
<a name="l01951"></a>01951             eul[1]= oldeul[1];
<a name="l01952"></a>01952         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>)
<a name="l01953"></a>01953             eul[2]= oldeul[2];
<a name="l01954"></a>01954         
<a name="l01955"></a>01955         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a3b7c5f2e7add29b1531d78cab51baefd">eulO_to_axis_angle</a>( axis, angle,eul, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a4aa95d9f8c95e703a90ba8afe1a3c4bda7c3f7a4cf435a4a3bba131a862e322fa">EULER_ORDER_DEFAULT</a>);
<a name="l01956"></a>01956         
<a name="l01957"></a>01957         <span class="comment">/* when converting to axis-angle, we need a special exception for the case when there is no axis */</span>
<a name="l01958"></a>01958         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#acc074658bb6b51cde503721347a81b33">IS_EQF</a>(axis[0], axis[1]) &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#acc074658bb6b51cde503721347a81b33">IS_EQF</a>(axis[1], axis[2])) {
<a name="l01959"></a>01959             <span class="comment">/* for now, rotate around y-axis then (so that it simply becomes the roll) */</span>
<a name="l01960"></a>01960             axis[1]= 1.0f;
<a name="l01961"></a>01961         }
<a name="l01962"></a>01962     }
<a name="l01963"></a>01963 }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965 <span class="comment">/* this function only does the delta rotation */</span>
<a name="l01966"></a><a class="code" href="../../d8/d27/transform_8c.html#ad39a76ecee6f4b98996da38d053548f9">01966</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ad39a76ecee6f4b98996da38d053548f9">protectedQuaternionBits</a>(<span class="keywordtype">short</span> protectflag, <span class="keywordtype">float</span> *quat, <span class="keywordtype">float</span> *oldquat)
<a name="l01967"></a>01967 {
<a name="l01968"></a>01968     <span class="comment">/* check that protection flags are set */</span>
<a name="l01969"></a>01969     <span class="keywordflow">if</span> ((protectflag &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa54bdcc6d4b9be00a167a4d49264b1f1">OB_LOCK_ROTW</a>)) == 0)
<a name="l01970"></a>01970         <span class="keywordflow">return</span>;
<a name="l01971"></a>01971     
<a name="l01972"></a>01972     <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a7479805656af00b23511bc1dbac25a76">OB_LOCK_ROT4D</a>) {
<a name="l01973"></a>01973         <span class="comment">/* quaternions getting limited as 4D entities that they are... */</span>
<a name="l01974"></a>01974         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa54bdcc6d4b9be00a167a4d49264b1f1">OB_LOCK_ROTW</a>)
<a name="l01975"></a>01975             quat[0]= oldquat[0];
<a name="l01976"></a>01976         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>)
<a name="l01977"></a>01977             quat[1]= oldquat[1];
<a name="l01978"></a>01978         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>)
<a name="l01979"></a>01979             quat[2]= oldquat[2];
<a name="l01980"></a>01980         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>)
<a name="l01981"></a>01981             quat[3]= oldquat[3];
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983     <span class="keywordflow">else</span> {
<a name="l01984"></a>01984         <span class="comment">/* quaternions get limited with euler... (compatibility mode) */</span>
<a name="l01985"></a>01985         <span class="keywordtype">float</span> eul[3], oldeul[3], nquat[4], noldquat[4];
<a name="l01986"></a>01986         <span class="keywordtype">float</span> qlen;
<a name="l01987"></a>01987 
<a name="l01988"></a>01988         qlen= <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ac6d9c2d913e7b6f0686db690ba55bc3e">normalize_qt_qt</a>(nquat, quat);
<a name="l01989"></a>01989         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ac6d9c2d913e7b6f0686db690ba55bc3e">normalize_qt_qt</a>(noldquat, oldquat);
<a name="l01990"></a>01990 
<a name="l01991"></a>01991         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a838c7ee5a2545c145c04787921175aad">quat_to_eul</a>(eul, nquat);
<a name="l01992"></a>01992         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a838c7ee5a2545c145c04787921175aad">quat_to_eul</a>(oldeul, noldquat);
<a name="l01993"></a>01993 
<a name="l01994"></a>01994         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c5f8cb59dda9f6e6f825189ecaec592">OB_LOCK_ROTX</a>)
<a name="l01995"></a>01995             eul[0]= oldeul[0];
<a name="l01996"></a>01996         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ace10ab1587f74395e9ad3cdd707b5fc6">OB_LOCK_ROTY</a>)
<a name="l01997"></a>01997             eul[1]= oldeul[1];
<a name="l01998"></a>01998         <span class="keywordflow">if</span> (protectflag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae914b3064cb1efb7cb6392287cc1d3de">OB_LOCK_ROTZ</a>)
<a name="l01999"></a>01999             eul[2]= oldeul[2];
<a name="l02000"></a>02000 
<a name="l02001"></a>02001         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a731eaf3dcfda22e037709a61a0377dff">eul_to_quat</a>( quat,eul);
<a name="l02002"></a>02002 
<a name="l02003"></a>02003         <span class="comment">/* restore original quat size */</span>
<a name="l02004"></a>02004         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a3ed59d039b7a6d8110efe9d4e83a84ef">mul_qt_fl</a>(quat, qlen);
<a name="l02005"></a>02005         
<a name="l02006"></a>02006         <span class="comment">/* quaternions flip w sign to accumulate rotations correctly */</span>
<a name="l02007"></a>02007         <span class="keywordflow">if</span> ( (nquat[0]&lt;0.0f &amp;&amp; quat[0]&gt;0.0f) || (nquat[0]&gt;0.0f &amp;&amp; quat[0]&lt;0.0f) ) {
<a name="l02008"></a>02008             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a3ed59d039b7a6d8110efe9d4e83a84ef">mul_qt_fl</a>(quat, -1.0f);
<a name="l02009"></a>02009         }
<a name="l02010"></a>02010     }
<a name="l02011"></a>02011 }
<a name="l02012"></a>02012 
<a name="l02013"></a>02013 <span class="comment">/* ******************* TRANSFORM LIMITS ********************** */</span>
<a name="l02014"></a>02014 
<a name="l02015"></a><a class="code" href="../../d8/d27/transform_8c.html#a1c9d744099e6fdc3a4b84e9d2f804d28">02015</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a1c9d744099e6fdc3a4b84e9d2f804d28">constraintTransLim</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td)
<a name="l02016"></a>02016 {
<a name="l02017"></a>02017     <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a490590d77b5a962296650143d48ea1fa">con</a>) {
<a name="l02018"></a>02018         <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *ctiLoc= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#afa957f3f4fcd2514aa758638b4e6dcd9">get_constraint_typeinfo</a>(<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aacf7ad78cacd4f1d8e999ef0ab64caf6">CONSTRAINT_TYPE_LOCLIMIT</a>);
<a name="l02019"></a>02019         <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *ctiDist= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#afa957f3f4fcd2514aa758638b4e6dcd9">get_constraint_typeinfo</a>(<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a93f32e658d1d1a07eae1680fa573e7ec">CONSTRAINT_TYPE_DISTLIMIT</a>);
<a name="l02020"></a>02020         
<a name="l02021"></a>02021         <a class="code" href="../../d0/d58/structbConstraintOb.html">bConstraintOb</a> cob= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02022"></a>02022         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02023"></a>02023         <span class="keywordtype">float</span> ctime = (float)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l02024"></a>02024         
<a name="l02025"></a>02025         <span class="comment">/* Make a temporary bConstraintOb for using these limit constraints</span>
<a name="l02026"></a>02026 <span class="comment">         *  - they only care that cob-&gt;matrix is correctly set ;-)</span>
<a name="l02027"></a>02027 <span class="comment">         *  - current space should be local</span>
<a name="l02028"></a>02028 <span class="comment">         */</span>
<a name="l02029"></a>02029         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02030"></a>02030         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>[3], td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>);
<a name="l02031"></a>02031         
<a name="l02032"></a>02032         <span class="comment">/* Evaluate valid constraints */</span>
<a name="l02033"></a>02033         <span class="keywordflow">for</span> (con= td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a490590d77b5a962296650143d48ea1fa">con</a>; con; con= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02034"></a>02034             <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02035"></a>02035             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02036"></a>02036             <span class="keywordtype">float</span> tmat[4][4];
<a name="l02037"></a>02037             
<a name="l02038"></a>02038             <span class="comment">/* only consider constraint if enabled */</span>
<a name="l02039"></a>02039             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>) <span class="keywordflow">continue</span>;
<a name="l02040"></a>02040             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adf4a50693080c1083d828f2e88da3156">enforce</a> == 0.0f) <span class="keywordflow">continue</span>;
<a name="l02041"></a>02041             
<a name="l02042"></a>02042             <span class="comment">/* only use it if it&#39;s tagged for this purpose (and the right type) */</span>
<a name="l02043"></a>02043             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aacf7ad78cacd4f1d8e999ef0ab64caf6">CONSTRAINT_TYPE_LOCLIMIT</a>) {
<a name="l02044"></a>02044                 <a class="code" href="../../da/d9a/structbLocLimitConstraint.html">bLocLimitConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02045"></a>02045                 
<a name="l02046"></a>02046                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../da/d9a/structbLocLimitConstraint.html#af8b7de1edd9f84c62642d1c61d02e1af">flag2</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a9348ade14fc76c7f2b8884331287bb3fa178c6bbfb7e84c4849f410b189408e52">LIMIT_TRANSFORM</a>)==0)
<a name="l02047"></a>02047                     <span class="keywordflow">continue</span>;
<a name="l02048"></a>02048                 cti = ctiLoc;
<a name="l02049"></a>02049             }
<a name="l02050"></a>02050             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a93f32e658d1d1a07eae1680fa573e7ec">CONSTRAINT_TYPE_DISTLIMIT</a>) {
<a name="l02051"></a>02051                 <a class="code" href="../../db/d81/structbDistLimitConstraint.html">bDistLimitConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02052"></a>02052                 
<a name="l02053"></a>02053                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../db/d81/structbDistLimitConstraint.html#a7a2385ccaa81416c67f71e1a203773ad">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#acb1dca145fda226802f85a239460b94aaa8bbb0867130a32e438e819f4e3b24fa">LIMITDIST_TRANSFORM</a>)==0)
<a name="l02054"></a>02054                     <span class="keywordflow">continue</span>;
<a name="l02055"></a>02055                 cti = ctiDist;
<a name="l02056"></a>02056             }
<a name="l02057"></a>02057             
<a name="l02058"></a>02058             <span class="keywordflow">if</span> (cti) {
<a name="l02059"></a>02059                 <span class="comment">/* do space conversions */</span>
<a name="l02060"></a>02060                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>) {
<a name="l02061"></a>02061                     <span class="comment">/* just multiply by td-&gt;mtx (this should be ok) */</span>
<a name="l02062"></a>02062                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(tmat, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02063"></a>02063                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad9a7248dd2f3d52b786c2476b05daa76">mul_m4_m3m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, tmat);
<a name="l02064"></a>02064                 }
<a name="l02065"></a>02065                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> != <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>) {
<a name="l02066"></a>02066                     <span class="comment">/* skip... incompatable spacetype */</span>
<a name="l02067"></a>02067                     <span class="keywordflow">continue</span>;
<a name="l02068"></a>02068                 }
<a name="l02069"></a>02069                 
<a name="l02070"></a>02070                 <span class="comment">/* get constraint targets if needed */</span>
<a name="l02071"></a>02071                 <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a070a81ab1d9b5dfa61d234d179473e36">get_constraint_targets_for_solving</a>(con, &amp;cob, &amp;targets, ctime);
<a name="l02072"></a>02072                 
<a name="l02073"></a>02073                 <span class="comment">/* do constraint */</span>
<a name="l02074"></a>02074                 cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a650a74feed693d7e971e335202464561">evaluate_constraint</a>(con, &amp;cob, &amp;targets);
<a name="l02075"></a>02075                 
<a name="l02076"></a>02076                 <span class="comment">/* convert spaces again */</span>
<a name="l02077"></a>02077                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>) {
<a name="l02078"></a>02078                     <span class="comment">/* just multiply by td-&gt;mtx (this should be ok) */</span>
<a name="l02079"></a>02079                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(tmat, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02080"></a>02080                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad9a7248dd2f3d52b786c2476b05daa76">mul_m4_m3m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, tmat);
<a name="l02081"></a>02081                 }
<a name="l02082"></a>02082                 
<a name="l02083"></a>02083                 <span class="comment">/* free targets list */</span>
<a name="l02084"></a>02084                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;targets);
<a name="l02085"></a>02085             }
<a name="l02086"></a>02086         }
<a name="l02087"></a>02087         
<a name="l02088"></a>02088         <span class="comment">/* copy results from cob-&gt;matrix */</span>
<a name="l02089"></a>02089         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>[3]);
<a name="l02090"></a>02090     }
<a name="l02091"></a>02091 }
<a name="l02092"></a>02092 
<a name="l02093"></a><a class="code" href="../../d8/d27/transform_8c.html#a61dc882fbc5a6f4e5518cf873da457e0">02093</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a61dc882fbc5a6f4e5518cf873da457e0">constraintob_from_transdata</a>(<a class="code" href="../../d0/d58/structbConstraintOb.html">bConstraintOb</a> *cob, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td)
<a name="l02094"></a>02094 {
<a name="l02095"></a>02095     <span class="comment">/* Make a temporary bConstraintOb for use by limit constraints</span>
<a name="l02096"></a>02096 <span class="comment">     *  - they only care that cob-&gt;matrix is correctly set ;-)</span>
<a name="l02097"></a>02097 <span class="comment">     *  - current space should be local</span>
<a name="l02098"></a>02098 <span class="comment">     */</span>
<a name="l02099"></a>02099     memset(cob, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d58/structbConstraintOb.html">bConstraintOb</a>));
<a name="l02100"></a>02100     <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>)
<a name="l02101"></a>02101     {
<a name="l02102"></a>02102         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca3fd6f41388cbe0f034332712de0e0798">ROT_MODE_QUAT</a>) {
<a name="l02103"></a>02103             <span class="comment">/* quats */</span>
<a name="l02104"></a>02104             <span class="comment">/* objects and bones do normalization first too, otherwise</span>
<a name="l02105"></a>02105 <span class="comment">             * we don&#39;t necessarily end up with a rotation matrix, and</span>
<a name="l02106"></a>02106 <span class="comment">             * then conversion back to quat gives a different result */</span>
<a name="l02107"></a>02107             <span class="keywordtype">float</span> quat[4];
<a name="l02108"></a>02108             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ac6d9c2d913e7b6f0686db690ba55bc3e">normalize_qt_qt</a>(quat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>);
<a name="l02109"></a>02109             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aff22852eb07b63a696ea49fa09958bf6">quat_to_mat4</a>(cob-&gt;<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, quat);
<a name="l02110"></a>02110         }
<a name="l02111"></a>02111         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca6fd1324ea35af2fbf6879b35d73ea547">ROT_MODE_AXISANGLE</a>) {
<a name="l02112"></a>02112             <span class="comment">/* axis angle */</span>
<a name="l02113"></a>02113             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#abbca82aeb9f99a9f85cbdd8739da08b9">axis_angle_to_mat4</a>(cob-&gt;<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, &amp;td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>[1], td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>[0]);
<a name="l02114"></a>02114         }
<a name="l02115"></a>02115         <span class="keywordflow">else</span> {
<a name="l02116"></a>02116             <span class="comment">/* eulers */</span>
<a name="l02117"></a>02117             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ae5ecbb1664954bd9e541db9253b1a7e7">eulO_to_mat4</a>(cob-&gt;<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a674420ebad81620080fee75e0dd13e2e">rot</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a>);
<a name="l02118"></a>02118         }
<a name="l02119"></a>02119     }
<a name="l02120"></a>02120 }
<a name="l02121"></a>02121 
<a name="l02122"></a><a class="code" href="../../d8/d27/transform_8c.html#abd7d9ba574380268a970371fca70d212">02122</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#abd7d9ba574380268a970371fca70d212">constraintRotLim</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(t), <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td)
<a name="l02123"></a>02123 {
<a name="l02124"></a>02124     <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a490590d77b5a962296650143d48ea1fa">con</a>) {
<a name="l02125"></a>02125         <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#afa957f3f4fcd2514aa758638b4e6dcd9">get_constraint_typeinfo</a>(<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a5dbe292ea3b5603f1d949964a243ba81">CONSTRAINT_TYPE_ROTLIMIT</a>);
<a name="l02126"></a>02126         <a class="code" href="../../d0/d58/structbConstraintOb.html">bConstraintOb</a> cob;
<a name="l02127"></a>02127         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02128"></a>02128         <span class="keywordtype">int</span> dolimit = 0;
<a name="l02129"></a>02129         
<a name="l02130"></a>02130         <span class="comment">/* Evaluate valid constraints */</span>
<a name="l02131"></a>02131         <span class="keywordflow">for</span> (con= td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a490590d77b5a962296650143d48ea1fa">con</a>; con; con= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02132"></a>02132             <span class="comment">/* only consider constraint if enabled */</span>
<a name="l02133"></a>02133             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>) <span class="keywordflow">continue</span>;
<a name="l02134"></a>02134             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adf4a50693080c1083d828f2e88da3156">enforce</a> == 0.0f) <span class="keywordflow">continue</span>;
<a name="l02135"></a>02135             
<a name="l02136"></a>02136             <span class="comment">/* we&#39;re only interested in Limit-Rotation constraints */</span>
<a name="l02137"></a>02137             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a5dbe292ea3b5603f1d949964a243ba81">CONSTRAINT_TYPE_ROTLIMIT</a>) {
<a name="l02138"></a>02138                 <a class="code" href="../../db/d16/structbRotLimitConstraint.html">bRotLimitConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02139"></a>02139                 <span class="keywordtype">float</span> tmat[4][4];
<a name="l02140"></a>02140                 
<a name="l02141"></a>02141                 <span class="comment">/* only use it if it&#39;s tagged for this purpose */</span>
<a name="l02142"></a>02142                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#a805d5d7f7599fb0e946c445afba3fc9a">flag2</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a9348ade14fc76c7f2b8884331287bb3fa178c6bbfb7e84c4849f410b189408e52">LIMIT_TRANSFORM</a>)==0)
<a name="l02143"></a>02143                     <span class="keywordflow">continue</span>;
<a name="l02144"></a>02144 
<a name="l02145"></a>02145                 <span class="comment">/* skip incompatable spacetypes */</span>
<a name="l02146"></a>02146                 <span class="keywordflow">if</span> (!<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>))
<a name="l02147"></a>02147                     <span class="keywordflow">continue</span>;
<a name="l02148"></a>02148 
<a name="l02149"></a>02149                 <span class="comment">/* only do conversion if necessary, to preserve quats and eulers */</span>
<a name="l02150"></a>02150                 <span class="keywordflow">if</span> (!dolimit) {
<a name="l02151"></a>02151                     <a class="code" href="../../d8/d27/transform_8c.html#a61dc882fbc5a6f4e5518cf873da457e0">constraintob_from_transdata</a>(&amp;cob, td);
<a name="l02152"></a>02152                     dolimit= 1;
<a name="l02153"></a>02153                 }
<a name="l02154"></a>02154                 
<a name="l02155"></a>02155                 <span class="comment">/* do space conversions */</span>
<a name="l02156"></a>02156                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>) {
<a name="l02157"></a>02157                     <span class="comment">/* just multiply by td-&gt;mtx (this should be ok) */</span>
<a name="l02158"></a>02158                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(tmat, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02159"></a>02159                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad9a7248dd2f3d52b786c2476b05daa76">mul_m4_m3m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, tmat);
<a name="l02160"></a>02160                 }
<a name="l02161"></a>02161                 
<a name="l02162"></a>02162                 <span class="comment">/* do constraint */</span>
<a name="l02163"></a>02163                 cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a650a74feed693d7e971e335202464561">evaluate_constraint</a>(con, &amp;cob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02164"></a>02164                 
<a name="l02165"></a>02165                 <span class="comment">/* convert spaces again */</span>
<a name="l02166"></a>02166                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>) {
<a name="l02167"></a>02167                     <span class="comment">/* just multiply by td-&gt;mtx (this should be ok) */</span>
<a name="l02168"></a>02168                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(tmat, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02169"></a>02169                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad9a7248dd2f3d52b786c2476b05daa76">mul_m4_m3m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, tmat);
<a name="l02170"></a>02170                 }
<a name="l02171"></a>02171             }
<a name="l02172"></a>02172         }
<a name="l02173"></a>02173         
<a name="l02174"></a>02174         <span class="keywordflow">if</span> (dolimit) {
<a name="l02175"></a>02175             <span class="comment">/* copy results from cob-&gt;matrix */</span>
<a name="l02176"></a>02176             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca3fd6f41388cbe0f034332712de0e0798">ROT_MODE_QUAT</a>) {
<a name="l02177"></a>02177                 <span class="comment">/* quats */</span>
<a name="l02178"></a>02178                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad76b90158227d13beb93cf29952f78a9">mat4_to_quat</a>( td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>,cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02179"></a>02179             }
<a name="l02180"></a>02180             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca6fd1324ea35af2fbf6879b35d73ea547">ROT_MODE_AXISANGLE</a>) {
<a name="l02181"></a>02181                 <span class="comment">/* axis angle */</span>
<a name="l02182"></a>02182                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a3795fcda1516668077d728c3ba319f40">mat4_to_axis_angle</a>( &amp;td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>[1], &amp;td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>[0],cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02183"></a>02183             }
<a name="l02184"></a>02184             <span class="keywordflow">else</span> {
<a name="l02185"></a>02185                 <span class="comment">/* eulers */</span>
<a name="l02186"></a>02186                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a4baf6d531a682ae3eba58e56c27374a4">mat4_to_eulO</a>( td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a674420ebad81620080fee75e0dd13e2e">rot</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a>,cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02187"></a>02187             }
<a name="l02188"></a>02188         }
<a name="l02189"></a>02189     }
<a name="l02190"></a>02190 }
<a name="l02191"></a>02191 
<a name="l02192"></a><a class="code" href="../../d8/d27/transform_8c.html#ab5f98707fa386fa10fbc9a3fb203d417">02192</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ab5f98707fa386fa10fbc9a3fb203d417">constraintSizeLim</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td)
<a name="l02193"></a>02193 {
<a name="l02194"></a>02194     <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a490590d77b5a962296650143d48ea1fa">con</a> &amp;&amp; td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>) {
<a name="l02195"></a>02195         <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#afa957f3f4fcd2514aa758638b4e6dcd9">get_constraint_typeinfo</a>(<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aca95934ef8542fe449181c527d483d5b">CONSTRAINT_TYPE_SIZELIMIT</a>);
<a name="l02196"></a>02196         <a class="code" href="../../d0/d58/structbConstraintOb.html">bConstraintOb</a> cob= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02197"></a>02197         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02198"></a>02198         
<a name="l02199"></a>02199         <span class="comment">/* Make a temporary bConstraintOb for using these limit constraints</span>
<a name="l02200"></a>02200 <span class="comment">         *  - they only care that cob-&gt;matrix is correctly set ;-)</span>
<a name="l02201"></a>02201 <span class="comment">         *  - current space should be local</span>
<a name="l02202"></a>02202 <span class="comment">         */</span>
<a name="l02203"></a>02203         <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9a574ba156a0ec5e46649c0e0a0bf180">TD_SINGLESIZE</a>) &amp;&amp; !(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>)) {
<a name="l02204"></a>02204             <span class="comment">/* scale val and reset size */</span>
<a name="l02205"></a>02205             <span class="keywordflow">return</span>; <span class="comment">// TODO: fix this case</span>
<a name="l02206"></a>02206         }
<a name="l02207"></a>02207         <span class="keywordflow">else</span> {
<a name="l02208"></a>02208             <span class="comment">/* Reset val if SINGLESIZE but using a constraint */</span>
<a name="l02209"></a>02209             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9a574ba156a0ec5e46649c0e0a0bf180">TD_SINGLESIZE</a>)
<a name="l02210"></a>02210                 <span class="keywordflow">return</span>;
<a name="l02211"></a>02211             
<a name="l02212"></a>02212             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8a7511e7f02ac7530280787b7dd5597b">size_to_mat4</a>( cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>,td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>);
<a name="l02213"></a>02213         }
<a name="l02214"></a>02214         
<a name="l02215"></a>02215         <span class="comment">/* Evaluate valid constraints */</span>
<a name="l02216"></a>02216         <span class="keywordflow">for</span> (con= td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a490590d77b5a962296650143d48ea1fa">con</a>; con; con= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02217"></a>02217             <span class="comment">/* only consider constraint if enabled */</span>
<a name="l02218"></a>02218             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>) <span class="keywordflow">continue</span>;
<a name="l02219"></a>02219             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adf4a50693080c1083d828f2e88da3156">enforce</a> == 0.0f) <span class="keywordflow">continue</span>;
<a name="l02220"></a>02220             
<a name="l02221"></a>02221             <span class="comment">/* we&#39;re only interested in Limit-Scale constraints */</span>
<a name="l02222"></a>02222             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aca95934ef8542fe449181c527d483d5b">CONSTRAINT_TYPE_SIZELIMIT</a>) {
<a name="l02223"></a>02223                 <a class="code" href="../../dc/dc1/structbSizeLimitConstraint.html">bSizeLimitConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02224"></a>02224                 <span class="keywordtype">float</span> tmat[4][4];
<a name="l02225"></a>02225                 
<a name="l02226"></a>02226                 <span class="comment">/* only use it if it&#39;s tagged for this purpose */</span>
<a name="l02227"></a>02227                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../dc/dc1/structbSizeLimitConstraint.html#ac7b6259e645d3980a5647ed06fce3a68">flag2</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a9348ade14fc76c7f2b8884331287bb3fa178c6bbfb7e84c4849f410b189408e52">LIMIT_TRANSFORM</a>)==0)
<a name="l02228"></a>02228                     <span class="keywordflow">continue</span>;
<a name="l02229"></a>02229                 
<a name="l02230"></a>02230                 <span class="comment">/* do space conversions */</span>
<a name="l02231"></a>02231                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>) {
<a name="l02232"></a>02232                     <span class="comment">/* just multiply by td-&gt;mtx (this should be ok) */</span>
<a name="l02233"></a>02233                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(tmat, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02234"></a>02234                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad9a7248dd2f3d52b786c2476b05daa76">mul_m4_m3m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, tmat);
<a name="l02235"></a>02235                 }
<a name="l02236"></a>02236                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> != <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>) {
<a name="l02237"></a>02237                     <span class="comment">/* skip... incompatable spacetype */</span>
<a name="l02238"></a>02238                     <span class="keywordflow">continue</span>;
<a name="l02239"></a>02239                 }
<a name="l02240"></a>02240                 
<a name="l02241"></a>02241                 <span class="comment">/* do constraint */</span>
<a name="l02242"></a>02242                 cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a650a74feed693d7e971e335202464561">evaluate_constraint</a>(con, &amp;cob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02243"></a>02243                 
<a name="l02244"></a>02244                 <span class="comment">/* convert spaces again */</span>
<a name="l02245"></a>02245                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a7c47938357a8f04d9f8cbbd12dd44e70">CONSTRAINT_SPACE_WORLD</a>) {
<a name="l02246"></a>02246                     <span class="comment">/* just multiply by td-&gt;mtx (this should be ok) */</span>
<a name="l02247"></a>02247                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(tmat, cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02248"></a>02248                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad9a7248dd2f3d52b786c2476b05daa76">mul_m4_m3m4</a>(cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, tmat);
<a name="l02249"></a>02249                 }
<a name="l02250"></a>02250             }
<a name="l02251"></a>02251         }
<a name="l02252"></a>02252         
<a name="l02253"></a>02253         <span class="comment">/* copy results from cob-&gt;matrix */</span>
<a name="l02254"></a>02254         <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9a574ba156a0ec5e46649c0e0a0bf180">TD_SINGLESIZE</a>) &amp;&amp; !(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>)) {
<a name="l02255"></a>02255             <span class="comment">/* scale val and reset size */</span>
<a name="l02256"></a>02256             <span class="keywordflow">return</span>; <span class="comment">// TODO: fix this case</span>
<a name="l02257"></a>02257         }
<a name="l02258"></a>02258         <span class="keywordflow">else</span> {
<a name="l02259"></a>02259             <span class="comment">/* Reset val if SINGLESIZE but using a constraint */</span>
<a name="l02260"></a>02260             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9a574ba156a0ec5e46649c0e0a0bf180">TD_SINGLESIZE</a>)
<a name="l02261"></a>02261                 <span class="keywordflow">return</span>;
<a name="l02262"></a>02262             
<a name="l02263"></a>02263             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a245c1bf7630bef5c065994ea56751d21">mat4_to_size</a>( td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>,cob.<a class="code" href="../../d0/d58/structbConstraintOb.html#a5dcaeabfc27b6dbc64713c7cba45e760">matrix</a>);
<a name="l02264"></a>02264         }
<a name="l02265"></a>02265     }
<a name="l02266"></a>02266 }
<a name="l02267"></a>02267 
<a name="l02268"></a>02268 <span class="comment">/* ************************** WARP *************************** */</span>
<a name="l02269"></a>02269 
<a name="l02270"></a><a class="code" href="../../d8/d27/transform_8c.html#a84b406ebfdbbfb5cccca3712e772439f">02270</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a84b406ebfdbbfb5cccca3712e772439f">postInputWarp</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> values[3])
<a name="l02271"></a>02271 {
<a name="l02272"></a>02272     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(values, (<span class="keywordtype">float</span>)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 2));
<a name="l02273"></a>02273 
<a name="l02274"></a>02274     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>) <span class="comment">/* non-null value indicates reversed input */</span>
<a name="l02275"></a>02275     {
<a name="l02276"></a>02276         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9ac9a5dd319bfe481c973431de10a815">negate_v3</a>(values);
<a name="l02277"></a>02277     }
<a name="l02278"></a>02278 }
<a name="l02279"></a>02279 
<a name="l02280"></a><a class="code" href="../../d2/d80/transform_8h.html#a59a3772457b2d74674afc8a19effea29">02280</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a59a3772457b2d74674afc8a19effea29">initWarp</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l02281"></a>02281 {
<a name="l02282"></a>02282     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3];
<a name="l02283"></a>02283     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02284"></a>02284     
<a name="l02285"></a>02285     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ab714178c6f2de480e83acc0ec3fd0efe">TFM_WARP</a>;
<a name="l02286"></a>02286     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a9b92a945d52d642c9a01a4ca2feeeead">Warp</a>;
<a name="l02287"></a>02287     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a121f0ea8f17d1530ab5031f3ae53e47b">handleEvent</a> = <a class="code" href="../../d8/d27/transform_8c.html#ad769a29a9db58e73977914faa7c1d086">handleEventWarp</a>;
<a name="l02288"></a>02288     
<a name="l02289"></a>02289     <a class="code" href="../../d2/d80/transform_8h.html#a0a49975611db08b07d9227200d0858ac">setInputPostFct</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d8/d27/transform_8c.html#a84b406ebfdbbfb5cccca3712e772439f">postInputWarp</a>);
<a name="l02290"></a>02290     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a84b806ef199827ee6360eb245462bceb">INPUT_HORIZONTAL_RATIO</a>);
<a name="l02291"></a>02291     
<a name="l02292"></a>02292     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l02293"></a>02293     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l02294"></a>02294     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l02295"></a>02295     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 5.0f / 180.0f * (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l02296"></a>02296     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 1.0f / 180.0f * (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l02297"></a>02297     
<a name="l02298"></a>02298     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = 1.0f;
<a name="l02299"></a>02299 
<a name="l02300"></a>02300     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l02301"></a>02301     
<a name="l02302"></a>02302     <span class="comment">/* we need min/max in view space */</span>
<a name="l02303"></a>02303     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++) {
<a name="l02304"></a>02304         <span class="keywordtype">float</span> center[3];
<a name="l02305"></a>02305         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(center, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>[i].<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l02306"></a>02306         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>[i].<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, center);
<a name="l02307"></a>02307         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>, center);
<a name="l02308"></a>02308         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(center, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>[3]);
<a name="l02309"></a>02309         <span class="keywordflow">if</span> (i)
<a name="l02310"></a>02310             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1acf828d012587ed9c356f8a591a04f5">minmax_v3v3_v3</a>(min, max, center);
<a name="l02311"></a>02311         <span class="keywordflow">else</span> {
<a name="l02312"></a>02312             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(max, center);
<a name="l02313"></a>02313             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(min, center);
<a name="l02314"></a>02314         }
<a name="l02315"></a>02315     }
<a name="l02316"></a>02316 
<a name="l02317"></a>02317     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, min, max);
<a name="l02318"></a>02318 
<a name="l02319"></a>02319     <span class="keywordflow">if</span> (max[0] == min[0]) max[0] += 0.1f; <span class="comment">/* not optimal, but flipping is better than invalid garbage (i.e. division by zero!) */</span>
<a name="l02320"></a>02320     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1b45814c11dea4bd0d14d50a134192eb">val</a>= (max[0]-min[0])/2.0f; <span class="comment">/* t-&gt;val is X dimension projected boundbox */</span>
<a name="l02321"></a>02321 }
<a name="l02322"></a>02322 
<a name="l02323"></a><a class="code" href="../../d2/d80/transform_8h.html#a66fcf2953abc17c7290a543cdfa9d9f8">02323</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#ad769a29a9db58e73977914faa7c1d086">handleEventWarp</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02324"></a>02324 {
<a name="l02325"></a>02325     <span class="keywordtype">int</span> status = 0;
<a name="l02326"></a>02326     
<a name="l02327"></a>02327     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l02328"></a>02328     {
<a name="l02329"></a>02329         <span class="comment">// Use customData pointer to signal warp direction</span>
<a name="l02330"></a>02330         <span class="keywordflow">if</span>  (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02331"></a>02331             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> = (<span class="keywordtype">void</span>*)1;
<a name="l02332"></a>02332         <span class="keywordflow">else</span>
<a name="l02333"></a>02333             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02334"></a>02334         
<a name="l02335"></a>02335         status = 1;
<a name="l02336"></a>02336     }
<a name="l02337"></a>02337     
<a name="l02338"></a>02338     <span class="keywordflow">return</span> status;
<a name="l02339"></a>02339 }
<a name="l02340"></a>02340 
<a name="l02341"></a><a class="code" href="../../d8/d27/transform_8c.html#a9b92a945d52d642c9a01a4ca2feeeead">02341</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a9b92a945d52d642c9a01a4ca2feeeead">Warp</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l02342"></a>02342 {
<a name="l02343"></a>02343     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l02344"></a>02344     <span class="keywordtype">float</span> vec[3], circumfac, dist, phi0, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>, *curs, cursor[3], gcursor[3];
<a name="l02345"></a>02345     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02346"></a>02346     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l02347"></a>02347     
<a name="l02348"></a>02348     curs= <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a56c6dfa9088d0f90552a67074a359c97">give_cursor</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>);
<a name="l02349"></a>02349     <span class="comment">/*</span>
<a name="l02350"></a>02350 <span class="comment">     * gcursor is the one used for helpline.</span>
<a name="l02351"></a>02351 <span class="comment">     * It has to be in the same space as the drawing loop</span>
<a name="l02352"></a>02352 <span class="comment">     * (that means it needs to be in the object&#39;s space when in edit mode and</span>
<a name="l02353"></a>02353 <span class="comment">     *  in global space in object mode)</span>
<a name="l02354"></a>02354 <span class="comment">     *</span>
<a name="l02355"></a>02355 <span class="comment">     * cursor is used for calculations.</span>
<a name="l02356"></a>02356 <span class="comment">     * It needs to be in view space, but we need to take object&#39;s offset</span>
<a name="l02357"></a>02357 <span class="comment">     * into account if in Edit mode.</span>
<a name="l02358"></a>02358 <span class="comment">     */</span>
<a name="l02359"></a>02359     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cursor, curs);
<a name="l02360"></a>02360     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(gcursor, cursor);
<a name="l02361"></a>02361     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a246046d89b8b7707a9eee55d84b8ecba">T_EDIT</a>) {
<a name="l02362"></a>02362         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(cursor, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l02363"></a>02363         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(gcursor, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l02364"></a>02364         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, gcursor);
<a name="l02365"></a>02365     }
<a name="l02366"></a>02366     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>, cursor);
<a name="l02367"></a>02367     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(cursor, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>[3]);
<a name="l02368"></a>02368     
<a name="l02369"></a>02369     <span class="comment">/* amount of radians for warp */</span>
<a name="l02370"></a>02370     circumfac = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l02371"></a>02371     
<a name="l02372"></a>02372     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;circumfac);
<a name="l02373"></a>02373     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;circumfac);
<a name="l02374"></a>02374     
<a name="l02375"></a>02375     <span class="comment">/* header print for NumInput */</span>
<a name="l02376"></a>02376     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l02377"></a>02377         <span class="keywordtype">char</span> c[20];
<a name="l02378"></a>02378         
<a name="l02379"></a>02379         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l02380"></a>02380         
<a name="l02381"></a>02381         sprintf(str, <span class="stringliteral">&quot;Warp: %s&quot;</span>, c);
<a name="l02382"></a>02382 
<a name="l02383"></a>02383         circumfac = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(circumfac);
<a name="l02384"></a>02384     }
<a name="l02385"></a>02385     <span class="keywordflow">else</span> {
<a name="l02386"></a>02386         <span class="comment">/* default header print */</span>
<a name="l02387"></a>02387         sprintf(str, <span class="stringliteral">&quot;Warp: %.3f&quot;</span>, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(circumfac));
<a name="l02388"></a>02388     }
<a name="l02389"></a>02389     
<a name="l02390"></a>02390     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = circumfac;
<a name="l02391"></a>02391 
<a name="l02392"></a>02392     circumfac /= 2; <span class="comment">/* only need 180 on each side to make 360 */</span>
<a name="l02393"></a>02393     
<a name="l02394"></a>02394     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l02395"></a>02395         <span class="keywordtype">float</span> loc[3];
<a name="l02396"></a>02396         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l02397"></a>02397             <span class="keywordflow">break</span>;
<a name="l02398"></a>02398         
<a name="l02399"></a>02399         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l02400"></a>02400             <span class="keywordflow">continue</span>;
<a name="l02401"></a>02401         
<a name="l02402"></a>02402         <span class="comment">/* translate point to center, rotate in such a way that outline==distance */</span>
<a name="l02403"></a>02403         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>);
<a name="l02404"></a>02404         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, vec);
<a name="l02405"></a>02405         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>, vec);
<a name="l02406"></a>02406         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>[3]);
<a name="l02407"></a>02407         
<a name="l02408"></a>02408         dist= vec[0]-cursor[0];
<a name="l02409"></a>02409         
<a name="l02410"></a>02410         <span class="comment">/* t-&gt;val is X dimension projected boundbox */</span>
<a name="l02411"></a>02411         phi0= (circumfac*dist/t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1b45814c11dea4bd0d14d50a134192eb">val</a>);
<a name="l02412"></a>02412         
<a name="l02413"></a>02413         vec[1]= (vec[1]-cursor[1]);
<a name="l02414"></a>02414         
<a name="l02415"></a>02415         co= (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(phi0);
<a name="l02416"></a>02416         si= (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(phi0);
<a name="l02417"></a>02417         loc[0]= -si*vec[1]+cursor[0];
<a name="l02418"></a>02418         loc[1]= co*vec[1]+cursor[1];
<a name="l02419"></a>02419         loc[2]= vec[2];
<a name="l02420"></a>02420         
<a name="l02421"></a>02421         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2dd8c0b6b07389026e51c74f22d6f70b">viewinv</a>, loc);
<a name="l02422"></a>02422         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(loc, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2dd8c0b6b07389026e51c74f22d6f70b">viewinv</a>[3]);
<a name="l02423"></a>02423         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, loc);
<a name="l02424"></a>02424         
<a name="l02425"></a>02425         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(loc, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>);
<a name="l02426"></a>02426         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(loc, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02427"></a>02427         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, loc);
<a name="l02428"></a>02428     }
<a name="l02429"></a>02429     
<a name="l02430"></a>02430     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l02431"></a>02431     
<a name="l02432"></a>02432     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l02433"></a>02433     
<a name="l02434"></a>02434     <span class="keywordflow">return</span> 1;
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437 <span class="comment">/* ************************** SHEAR *************************** */</span>
<a name="l02438"></a>02438 
<a name="l02439"></a><a class="code" href="../../d8/d27/transform_8c.html#a81b893560f7df6edc0bf637183c1f3ac">02439</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a81b893560f7df6edc0bf637183c1f3ac">postInputShear</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(t), <span class="keywordtype">float</span> values[3])
<a name="l02440"></a>02440 {
<a name="l02441"></a>02441     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(values, 0.05f);
<a name="l02442"></a>02442 }
<a name="l02443"></a>02443 
<a name="l02444"></a><a class="code" href="../../d2/d80/transform_8h.html#a0ad3b443ff63fa8b4c9f90ccdfc8d0cd">02444</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a0ad3b443ff63fa8b4c9f90ccdfc8d0cd">initShear</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l02445"></a>02445 {
<a name="l02446"></a>02446     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a15c6eda45582a1df441e4cd64b9e7c06">TFM_SHEAR</a>;
<a name="l02447"></a>02447     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a0a72ac359e89ebed2e3c84288816a44b">Shear</a>;
<a name="l02448"></a>02448     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a121f0ea8f17d1530ab5031f3ae53e47b">handleEvent</a> = <a class="code" href="../../d8/d27/transform_8c.html#ab741b6f003dec7d2734d6f3f44701d65">handleEventShear</a>;
<a name="l02449"></a>02449     
<a name="l02450"></a>02450     <a class="code" href="../../d2/d80/transform_8h.html#a0a49975611db08b07d9227200d0858ac">setInputPostFct</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d8/d27/transform_8c.html#a81b893560f7df6edc0bf637183c1f3ac">postInputShear</a>);
<a name="l02451"></a>02451     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717abffb16375233b400cec720cd3bd0db4f">INPUT_HORIZONTAL_ABSOLUTE</a>);
<a name="l02452"></a>02452     
<a name="l02453"></a>02453     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l02454"></a>02454     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l02455"></a>02455     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l02456"></a>02456     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l02457"></a>02457     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l02458"></a>02458     
<a name="l02459"></a>02459     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = 0.1f;
<a name="l02460"></a>02460 
<a name="l02461"></a>02461     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l02462"></a>02462 }
<a name="l02463"></a>02463 
<a name="l02464"></a><a class="code" href="../../d2/d80/transform_8h.html#a4c895a19cd8eec3c456e14ac258608d7">02464</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#ab741b6f003dec7d2734d6f3f44701d65">handleEventShear</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02465"></a>02465 {
<a name="l02466"></a>02466     <span class="keywordtype">int</span> status = 0;
<a name="l02467"></a>02467     
<a name="l02468"></a>02468     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l02469"></a>02469     {
<a name="l02470"></a>02470         <span class="comment">// Use customData pointer to signal Shear direction</span>
<a name="l02471"></a>02471         <span class="keywordflow">if</span>  (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02472"></a>02472         {
<a name="l02473"></a>02473             <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a38c8b680b9828bf1ebdf8388ed6cbc3d">INPUT_VERTICAL_ABSOLUTE</a>);
<a name="l02474"></a>02474             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> = (<span class="keywordtype">void</span>*)1;
<a name="l02475"></a>02475         }
<a name="l02476"></a>02476         <span class="keywordflow">else</span> {
<a name="l02477"></a>02477             <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717abffb16375233b400cec720cd3bd0db4f">INPUT_HORIZONTAL_ABSOLUTE</a>);
<a name="l02478"></a>02478             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02479"></a>02479         }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481         status = 1;
<a name="l02482"></a>02482     }
<a name="l02483"></a>02483     
<a name="l02484"></a>02484     <span class="keywordflow">return</span> status;
<a name="l02485"></a>02485 }
<a name="l02486"></a>02486 
<a name="l02487"></a>02487 
<a name="l02488"></a><a class="code" href="../../d8/d27/transform_8c.html#a0a72ac359e89ebed2e3c84288816a44b">02488</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a0a72ac359e89ebed2e3c84288816a44b">Shear</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l02489"></a>02489 {
<a name="l02490"></a>02490     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l02491"></a>02491     <span class="keywordtype">float</span> vec[3];
<a name="l02492"></a>02492     <span class="keywordtype">float</span> smat[3][3], tmat[3][3], totmat[3][3], persmat[3][3], persinv[3][3];
<a name="l02493"></a>02493     <span class="keywordtype">float</span> value;
<a name="l02494"></a>02494     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02495"></a>02495     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l02496"></a>02496     
<a name="l02497"></a>02497     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(persmat, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#accf066e930422d8cb76021727eae2340">viewmat</a>);
<a name="l02498"></a>02498     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#acc9f8cab0ea2c5993f2c9bdeaca6b788">invert_m3_m3</a>(persinv, persmat);
<a name="l02499"></a>02499     
<a name="l02500"></a>02500     value = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l02501"></a>02501     
<a name="l02502"></a>02502     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;value);
<a name="l02503"></a>02503     
<a name="l02504"></a>02504     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;value);
<a name="l02505"></a>02505     
<a name="l02506"></a>02506     <span class="comment">/* header print for NumInput */</span>
<a name="l02507"></a>02507     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l02508"></a>02508         <span class="keywordtype">char</span> c[20];
<a name="l02509"></a>02509         
<a name="l02510"></a>02510         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l02511"></a>02511         
<a name="l02512"></a>02512         sprintf(str, <span class="stringliteral">&quot;Shear: %s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02513"></a>02513     }
<a name="l02514"></a>02514     <span class="keywordflow">else</span> {
<a name="l02515"></a>02515         <span class="comment">/* default header print */</span>
<a name="l02516"></a>02516         sprintf(str, <span class="stringliteral">&quot;Shear: %.3f %s&quot;</span>, value, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518     
<a name="l02519"></a>02519     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = value;
<a name="l02520"></a>02520 
<a name="l02521"></a>02521     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(smat);
<a name="l02522"></a>02522     
<a name="l02523"></a>02523     <span class="comment">// Custom data signals shear direction</span>
<a name="l02524"></a>02524     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02525"></a>02525         smat[1][0] = value;
<a name="l02526"></a>02526     <span class="keywordflow">else</span>
<a name="l02527"></a>02527         smat[0][1] = value;
<a name="l02528"></a>02528     
<a name="l02529"></a>02529     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat, smat, persmat);
<a name="l02530"></a>02530     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(totmat, persinv, tmat);
<a name="l02531"></a>02531     
<a name="l02532"></a>02532     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l02533"></a>02533         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l02534"></a>02534             <span class="keywordflow">break</span>;
<a name="l02535"></a>02535         
<a name="l02536"></a>02536         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l02537"></a>02537             <span class="keywordflow">continue</span>;
<a name="l02538"></a>02538         
<a name="l02539"></a>02539         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>) {
<a name="l02540"></a>02540             <span class="keywordtype">float</span> mat3[3][3];
<a name="l02541"></a>02541             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat3, totmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>);
<a name="l02542"></a>02542             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, mat3);
<a name="l02543"></a>02543         }
<a name="l02544"></a>02544         <span class="keywordflow">else</span> {
<a name="l02545"></a>02545             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(tmat, totmat);
<a name="l02546"></a>02546         }
<a name="l02547"></a>02547         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>);
<a name="l02548"></a>02548         
<a name="l02549"></a>02549         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tmat, vec);
<a name="l02550"></a>02550         
<a name="l02551"></a>02551         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>);
<a name="l02552"></a>02552         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l02553"></a>02553         
<a name="l02554"></a>02554         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02555"></a>02555         
<a name="l02556"></a>02556         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l02557"></a>02557     }
<a name="l02558"></a>02558     
<a name="l02559"></a>02559     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l02560"></a>02560     
<a name="l02561"></a>02561     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l02562"></a>02562 
<a name="l02563"></a>02563     <span class="keywordflow">return</span> 1;
<a name="l02564"></a>02564 }
<a name="l02565"></a>02565 
<a name="l02566"></a>02566 <span class="comment">/* ************************** RESIZE *************************** */</span>
<a name="l02567"></a>02567 
<a name="l02568"></a><a class="code" href="../../d2/d80/transform_8h.html#a07a126d25aafc67aae1b520d37d4b656">02568</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a07a126d25aafc67aae1b520d37d4b656">initResize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l02569"></a>02569 {
<a name="l02570"></a>02570     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a002f81b26542b400faa00b3e7209fbbf">TFM_RESIZE</a>;
<a name="l02571"></a>02571     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a61fb480b32da61677754964105468145">Resize</a>;
<a name="l02572"></a>02572     
<a name="l02573"></a>02573     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717af5a1aee27afb7eb9480efb62537b200f">INPUT_SPRING_FLIP</a>);
<a name="l02574"></a>02574     
<a name="l02575"></a>02575     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a565eee5b9aa63ea848efc1eaad663e2f">T_NULL_ONE</a>;
<a name="l02576"></a>02576     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a5189689ce82ddb58ae0268d4ecffe392">NUM_NULL_ONE</a>;
<a name="l02577"></a>02577     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a108ce79c68b61418552662195d2f4574">NUM_AFFECT_ALL</a>;
<a name="l02578"></a>02578     <span class="keywordflow">if</span> (!t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>) {
<a name="l02579"></a>02579         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a15ccdebb168cc175d28e714d88d1aac1">T_NO_ZERO</a>;
<a name="l02580"></a>02580         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a77106b4c3fc9144e9f2f6465211f79c6">NUM_NO_ZERO</a>;
<a name="l02581"></a>02581     }
<a name="l02582"></a>02582     
<a name="l02583"></a>02583     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 2;
<a name="l02584"></a>02584     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 2;
<a name="l02585"></a>02585     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l02586"></a>02586     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l02587"></a>02587     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l02588"></a>02588 
<a name="l02589"></a>02589     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l02590"></a>02590 }
<a name="l02591"></a>02591 
<a name="l02592"></a><a class="code" href="../../d8/d27/transform_8c.html#a3b0997801bfc3f1fd8a59ad68c27bbfc">02592</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a3b0997801bfc3f1fd8a59ad68c27bbfc">headerResize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> vec[3], <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l02593"></a>02593 {
<a name="l02594"></a>02594     <span class="keywordtype">char</span> tvec[60];
<a name="l02595"></a>02595     <span class="keywordtype">char</span> *spos= <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l02596"></a>02596     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l02597"></a>02597         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l02598"></a>02598     }
<a name="l02599"></a>02599     <span class="keywordflow">else</span> {
<a name="l02600"></a>02600         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(&amp;tvec[0],  20, <span class="stringliteral">&quot;%.4f&quot;</span>, vec[0]);
<a name="l02601"></a>02601         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(&amp;tvec[20], 20, <span class="stringliteral">&quot;%.4f&quot;</span>, vec[1]);
<a name="l02602"></a>02602         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(&amp;tvec[40], 20, <span class="stringliteral">&quot;%.4f&quot;</span>, vec[2]);
<a name="l02603"></a>02603     }
<a name="l02604"></a>02604     
<a name="l02605"></a>02605     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l02606"></a>02606         <span class="keywordflow">switch</span>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a>) {
<a name="l02607"></a>02607         <span class="keywordflow">case</span> 0:
<a name="l02608"></a>02608             spos += sprintf(spos, <span class="stringliteral">&quot;Scale: %s%s %s&quot;</span>, &amp;tvec[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02609"></a>02609             <span class="keywordflow">break</span>;
<a name="l02610"></a>02610         <span class="keywordflow">case</span> 1:
<a name="l02611"></a>02611             spos += sprintf(spos, <span class="stringliteral">&quot;Scale: %s : %s%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02612"></a>02612             <span class="keywordflow">break</span>;
<a name="l02613"></a>02613         <span class="keywordflow">case</span> 2:
<a name="l02614"></a>02614             spos += sprintf(spos, <span class="stringliteral">&quot;Scale: %s : %s : %s%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], &amp;tvec[40], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02615"></a>02615         }
<a name="l02616"></a>02616     }
<a name="l02617"></a>02617     <span class="keywordflow">else</span> {
<a name="l02618"></a>02618         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>)
<a name="l02619"></a>02619             spos += sprintf(spos, <span class="stringliteral">&quot;Scale X: %s   Y: %s%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02620"></a>02620         <span class="keywordflow">else</span>
<a name="l02621"></a>02621             spos += sprintf(spos, <span class="stringliteral">&quot;Scale X: %s   Y: %s  Z: %s%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], &amp;tvec[40], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02622"></a>02622     }
<a name="l02623"></a>02623     
<a name="l02624"></a>02624     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>)) {
<a name="l02625"></a>02625         spos += sprintf(spos, <span class="stringliteral">&quot; Proportional size: %.2f&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>);
<a name="l02626"></a>02626     }
<a name="l02627"></a>02627 
<a name="l02628"></a>02628     (void)spos;
<a name="l02629"></a>02629 }
<a name="l02630"></a>02630 
<a name="l02631"></a><a class="code" href="../../d8/d27/transform_8c.html#a8c4a9e5e4622948245de4ec0b5d38329">02631</a> <span class="preprocessor">#define SIGN(a)     (a&lt;-FLT_EPSILON?1:a&gt;FLT_EPSILON?2:3)</span>
<a name="l02632"></a><a class="code" href="../../d8/d27/transform_8c.html#a9b93a407a0a407298123c7ab2bb75eaa">02632</a> <span class="preprocessor"></span><span class="preprocessor">#define VECSIGNFLIP(a, b) ((SIGN(a[0]) &amp; SIGN(b[0]))==0 || (SIGN(a[1]) &amp; SIGN(b[1]))==0 || (SIGN(a[2]) &amp; SIGN(b[2]))==0)</span>
<a name="l02633"></a>02633 <span class="preprocessor"></span>
<a name="l02634"></a>02634 <span class="comment">/* smat is reference matrix, only scaled */</span>
<a name="l02635"></a><a class="code" href="../../d8/d27/transform_8c.html#aa9240d760049d7f8c619ac2a0c7df940">02635</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aa9240d760049d7f8c619ac2a0c7df940">TransMat3ToSize</a>( <span class="keywordtype">float</span> mat[][3], <span class="keywordtype">float</span> smat[][3], <span class="keywordtype">float</span> *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l02636"></a>02636 {
<a name="l02637"></a>02637     <span class="keywordtype">float</span> vec[3];
<a name="l02638"></a>02638     
<a name="l02639"></a>02639     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, mat[0]);
<a name="l02640"></a>02640     size[0]= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec);
<a name="l02641"></a>02641     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, mat[1]);
<a name="l02642"></a>02642     size[1]= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec);
<a name="l02643"></a>02643     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, mat[2]);
<a name="l02644"></a>02644     size[2]= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec);
<a name="l02645"></a>02645     
<a name="l02646"></a>02646     <span class="comment">/* first tried with dotproduct... but the sign flip is crucial */</span>
<a name="l02647"></a>02647     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d27/transform_8c.html#a9b93a407a0a407298123c7ab2bb75eaa">VECSIGNFLIP</a>(mat[0], smat[0]) ) size[0]= -size[0];
<a name="l02648"></a>02648     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d27/transform_8c.html#a9b93a407a0a407298123c7ab2bb75eaa">VECSIGNFLIP</a>(mat[1], smat[1]) ) size[1]= -size[1];
<a name="l02649"></a>02649     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d27/transform_8c.html#a9b93a407a0a407298123c7ab2bb75eaa">VECSIGNFLIP</a>(mat[2], smat[2]) ) size[2]= -size[2];
<a name="l02650"></a>02650 }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652 
<a name="l02653"></a><a class="code" href="../../d8/d27/transform_8c.html#afbcc17bd4187f92a6de768cb6294f37f">02653</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#afbcc17bd4187f92a6de768cb6294f37f">ElementResize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td, <span class="keywordtype">float</span> mat[3][3])
<a name="l02654"></a>02654 {
<a name="l02655"></a>02655     <span class="keywordtype">float</span> tmat[3][3], smat[3][3], center[3];
<a name="l02656"></a>02656     <span class="keywordtype">float</span> vec[3];
<a name="l02657"></a>02657     
<a name="l02658"></a>02658     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a246046d89b8b7707a9eee55d84b8ecba">T_EDIT</a>) {
<a name="l02659"></a>02659         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(smat, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>);
<a name="l02660"></a>02660         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, smat);
<a name="l02661"></a>02661     }
<a name="l02662"></a>02662     <span class="keywordflow">else</span> {
<a name="l02663"></a>02663         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(tmat, mat);
<a name="l02664"></a>02664     }
<a name="l02665"></a>02665     
<a name="l02666"></a>02666     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>) {
<a name="l02667"></a>02667         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>(t, td, tmat);
<a name="l02668"></a>02668     }
<a name="l02669"></a>02669     
<a name="l02670"></a>02670     <span class="comment">/* local constraint shouldn&#39;t alter center */</span>
<a name="l02671"></a>02671     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0c9e2a1ae5acee970c6b8e16b96f09bd">around</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5e37cb5cb6e4bc87eaffb8a738f79c91">V3D_LOCAL</a>) &amp;&amp;
<a name="l02672"></a>02672             (   (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>)) ||
<a name="l02673"></a>02673                 ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a246046d89b8b7707a9eee55d84b8ecba">T_EDIT</a>) &amp;&amp; (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a028ef4069c952a4242cbda17cd0992d5">settings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; (<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad6cb358a5c5612c639f998b0601e0865">SCE_SELECT_EDGE</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>))) ||
<a name="l02674"></a>02674                 (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>))
<a name="l02675"></a>02675             )
<a name="l02676"></a>02676     {
<a name="l02677"></a>02677         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(center, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l02678"></a>02678     }
<a name="l02679"></a>02679     <span class="keywordflow">else</span> {
<a name="l02680"></a>02680         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(center, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>);
<a name="l02681"></a>02681     }
<a name="l02682"></a>02682 
<a name="l02683"></a>02683     <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>) {
<a name="l02684"></a>02684         <span class="keywordtype">float</span> fsize[3];
<a name="l02685"></a>02685         
<a name="l02686"></a>02686         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a5d983bf9e639c6e81a0c06341ba1675f">T_TEXTURE</a>|<a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>)) {
<a name="l02687"></a>02687             <span class="keywordtype">float</span> obsizemat[3][3];
<a name="l02688"></a>02688             <span class="comment">// Reorient the size mat to fit the oriented object.</span>
<a name="l02689"></a>02689             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(obsizemat, tmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>);
<a name="l02690"></a>02690             <span class="comment">//print_m3(&quot;obsizemat&quot;, obsizemat);</span>
<a name="l02691"></a>02691             <a class="code" href="../../d8/d27/transform_8c.html#aa9240d760049d7f8c619ac2a0c7df940">TransMat3ToSize</a>(obsizemat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>, fsize);
<a name="l02692"></a>02692             <span class="comment">//print_v3(&quot;fsize&quot;, fsize);</span>
<a name="l02693"></a>02693         }
<a name="l02694"></a>02694         <span class="keywordflow">else</span> {
<a name="l02695"></a>02695             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a9ead24f03defe7d768b91d1ce11f6ea2">mat3_to_size</a>( fsize,tmat);
<a name="l02696"></a>02696         }
<a name="l02697"></a>02697         
<a name="l02698"></a>02698         <a class="code" href="../../d8/d27/transform_8c.html#af062722085fdd489cdfdc58201b7bfc8">protectedSizeBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, fsize);
<a name="l02699"></a>02699         
<a name="l02700"></a>02700         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ad3a1f582392fa620921c51d73d3e13db">T_V3D_ALIGN</a>)==0) {   <span class="comment">// align mode doesn&#39;t resize objects itself</span>
<a name="l02701"></a>02701             <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9a574ba156a0ec5e46649c0e0a0bf180">TD_SINGLESIZE</a>) &amp;&amp; !(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>)) {
<a name="l02702"></a>02702                 <span class="comment">/* scale val and reset size */</span>
<a name="l02703"></a>02703                  *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> * (1 + (fsize[0] - 1) * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02704"></a>02704                 
<a name="l02705"></a>02705                 td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>[0] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a66dd63cd9c4e154247148bc3a239ffb2">isize</a>[0];
<a name="l02706"></a>02706                 td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>[1] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a66dd63cd9c4e154247148bc3a239ffb2">isize</a>[1];
<a name="l02707"></a>02707                 td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>[2] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a66dd63cd9c4e154247148bc3a239ffb2">isize</a>[2];
<a name="l02708"></a>02708              }
<a name="l02709"></a>02709             <span class="keywordflow">else</span> {
<a name="l02710"></a>02710                 <span class="comment">/* Reset val if SINGLESIZE but using a constraint */</span>
<a name="l02711"></a>02711                 <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a9a574ba156a0ec5e46649c0e0a0bf180">TD_SINGLESIZE</a>)
<a name="l02712"></a>02712                      *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>;
<a name="l02713"></a>02713                 
<a name="l02714"></a>02714                 td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>[0] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a66dd63cd9c4e154247148bc3a239ffb2">isize</a>[0] * (1 + (fsize[0] - 1) * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02715"></a>02715                 td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>[1] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a66dd63cd9c4e154247148bc3a239ffb2">isize</a>[1] * (1 + (fsize[1] - 1) * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02716"></a>02716                 td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>[2] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a66dd63cd9c4e154247148bc3a239ffb2">isize</a>[2] * (1 + (fsize[2] - 1) * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02717"></a>02717             }
<a name="l02718"></a>02718         }
<a name="l02719"></a>02719         
<a name="l02720"></a>02720         <a class="code" href="../../d8/d27/transform_8c.html#ab5f98707fa386fa10fbc9a3fb203d417">constraintSizeLim</a>(t, td);
<a name="l02721"></a>02721     }
<a name="l02722"></a>02722     
<a name="l02723"></a>02723     <span class="comment">/* For individual element center, Editmode need to use iloc */</span>
<a name="l02724"></a>02724     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a242b050c360ba1db9ba0314675f82b33">T_POINTS</a>)
<a name="l02725"></a>02725         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, center);
<a name="l02726"></a>02726     <span class="keywordflow">else</span>
<a name="l02727"></a>02727         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>, center);
<a name="l02728"></a>02728     
<a name="l02729"></a>02729     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tmat, vec);
<a name="l02730"></a>02730     
<a name="l02731"></a>02731     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, center);
<a name="l02732"></a>02732     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a242b050c360ba1db9ba0314675f82b33">T_POINTS</a>)
<a name="l02733"></a>02733         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>);
<a name="l02734"></a>02734     <span class="keywordflow">else</span>
<a name="l02735"></a>02735         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l02736"></a>02736     
<a name="l02737"></a>02737     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l02738"></a>02738     
<a name="l02739"></a>02739     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>)) {
<a name="l02740"></a>02740         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, vec);
<a name="l02741"></a>02741     }
<a name="l02742"></a>02742     
<a name="l02743"></a>02743     <a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">protectedTransBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, vec);
<a name="l02744"></a>02744     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l02745"></a>02745     
<a name="l02746"></a>02746     <a class="code" href="../../d8/d27/transform_8c.html#a1c9d744099e6fdc3a4b84e9d2f804d28">constraintTransLim</a>(t, td);
<a name="l02747"></a>02747 }
<a name="l02748"></a>02748 
<a name="l02749"></a><a class="code" href="../../d2/d80/transform_8h.html#a61fb480b32da61677754964105468145">02749</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a61fb480b32da61677754964105468145">Resize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l02750"></a>02750 {
<a name="l02751"></a>02751     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td;
<a name="l02752"></a>02752     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3], mat[3][3];
<a name="l02753"></a>02753     <span class="keywordtype">float</span> ratio;
<a name="l02754"></a>02754     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02755"></a>02755     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[200];
<a name="l02756"></a>02756     
<a name="l02757"></a>02757     <span class="comment">/* for manipulator, center handle, the scaling can&#39;t be done relative to center */</span>
<a name="l02758"></a>02758     <span class="keywordflow">if</span> ( (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab6649125ab53f55ea9674b26e23a47e">T_USES_MANIPULATOR</a>) &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a>==0)
<a name="l02759"></a>02759     {
<a name="l02760"></a>02760         ratio = 1.0f - ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0] - mval[0]) + (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[1] - mval[1]))/100.0f;
<a name="l02761"></a>02761     }
<a name="l02762"></a>02762     <span class="keywordflow">else</span> {
<a name="l02763"></a>02763         ratio = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l02764"></a>02764     }
<a name="l02765"></a>02765     
<a name="l02766"></a>02766     size[0] = size[1] = size[2] = ratio;
<a name="l02767"></a>02767     
<a name="l02768"></a>02768     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, size);
<a name="l02769"></a>02769     
<a name="l02770"></a>02770     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l02771"></a>02771         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, size);
<a name="l02772"></a>02772         <a class="code" href="../../d2/d80/transform_8h.html#aa7f2dd2ccc101be762b979b81e48bef9">constraintNumInput</a>(t, size);
<a name="l02773"></a>02773     }
<a name="l02774"></a>02774     
<a name="l02775"></a>02775     <a class="code" href="../../d2/d80/transform_8h.html#a11dd25226a3aa484eedc0790bf8c4456">applySnapping</a>(t, size);
<a name="l02776"></a>02776     
<a name="l02777"></a>02777     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a7a2ceb90fc29195a2388ff3ab6c9afdc">T_AUTOVALUES</a>)
<a name="l02778"></a>02778     {
<a name="l02779"></a>02779         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(size, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab4cbd79b83d7177d1e31f0c22db98c4f">auto_values</a>);
<a name="l02780"></a>02780     }
<a name="l02781"></a>02781     
<a name="l02782"></a>02782     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, size);
<a name="l02783"></a>02783     
<a name="l02784"></a>02784     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a32ceca78461c61d0dbda46632ccb0f8f">size_to_mat3</a>( mat,size);
<a name="l02785"></a>02785     
<a name="l02786"></a>02786     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>) {
<a name="l02787"></a>02787         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, mat);
<a name="l02788"></a>02788     }
<a name="l02789"></a>02789     
<a name="l02790"></a>02790     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ada2c79f2f02698e3152a1a9428e912b9">mat</a>, mat);    <span class="comment">// used in manipulator</span>
<a name="l02791"></a>02791     
<a name="l02792"></a>02792     <a class="code" href="../../d8/d27/transform_8c.html#a3b0997801bfc3f1fd8a59ad68c27bbfc">headerResize</a>(t, size, str);
<a name="l02793"></a>02793     
<a name="l02794"></a>02794     <span class="keywordflow">for</span> (i = 0, td=t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>; i &lt; t-&gt;total; i++, td++) {
<a name="l02795"></a>02795         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l02796"></a>02796             <span class="keywordflow">break</span>;
<a name="l02797"></a>02797         
<a name="l02798"></a>02798         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l02799"></a>02799             <span class="keywordflow">continue</span>;
<a name="l02800"></a>02800         
<a name="l02801"></a>02801         <a class="code" href="../../d8/d27/transform_8c.html#afbcc17bd4187f92a6de768cb6294f37f">ElementResize</a>(t, td, mat);
<a name="l02802"></a>02802     }
<a name="l02803"></a>02803     
<a name="l02804"></a>02804     <span class="comment">/* evil hack - redo resize if cliping needed */</span>
<a name="l02805"></a>02805     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ac06b6fabff39b7c4e6ec02f5ee22b005">T_CLIP_UV</a> &amp;&amp; <a class="code" href="../../d2/d80/transform_8h.html#a2653bdd7248c118c6e44868b4060c1fd">clipUVTransform</a>(t, size, 1)) {
<a name="l02806"></a>02806         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a32ceca78461c61d0dbda46632ccb0f8f">size_to_mat3</a>( mat,size);
<a name="l02807"></a>02807         
<a name="l02808"></a>02808         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>)
<a name="l02809"></a>02809             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, mat);
<a name="l02810"></a>02810         
<a name="l02811"></a>02811         <span class="keywordflow">for</span> (i = 0, td=t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>; i &lt; t-&gt;total; i++, td++)
<a name="l02812"></a>02812             <a class="code" href="../../d8/d27/transform_8c.html#afbcc17bd4187f92a6de768cb6294f37f">ElementResize</a>(t, td, mat);
<a name="l02813"></a>02813     }
<a name="l02814"></a>02814     
<a name="l02815"></a>02815     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l02816"></a>02816     
<a name="l02817"></a>02817     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l02818"></a>02818     
<a name="l02819"></a>02819     <span class="keywordflow">return</span> 1;
<a name="l02820"></a>02820 }
<a name="l02821"></a>02821 
<a name="l02822"></a>02822 <span class="comment">/* ************************** TOSPHERE *************************** */</span>
<a name="l02823"></a>02823 
<a name="l02824"></a><a class="code" href="../../d2/d80/transform_8h.html#ac9a5b9fd8568ee7e098ca5b7572c2783">02824</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ac9a5b9fd8568ee7e098ca5b7572c2783">initToSphere</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l02825"></a>02825 {
<a name="l02826"></a>02826     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l02827"></a>02827     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02828"></a>02828     
<a name="l02829"></a>02829     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84aa28b932311967ca44afb77bd8c32bedd">TFM_TOSPHERE</a>;
<a name="l02830"></a>02830     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a785348f3e38ef0f8a14326501d3e8664">ToSphere</a>;
<a name="l02831"></a>02831     
<a name="l02832"></a>02832     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a84b806ef199827ee6360eb245462bceb">INPUT_HORIZONTAL_RATIO</a>);
<a name="l02833"></a>02833     
<a name="l02834"></a>02834     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l02835"></a>02835     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l02836"></a>02836     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l02837"></a>02837     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l02838"></a>02838     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l02839"></a>02839     
<a name="l02840"></a>02840     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l02841"></a>02841 
<a name="l02842"></a>02842     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a5189689ce82ddb58ae0268d4ecffe392">NUM_NULL_ONE</a> | <a class="code" href="../../db/d36/ED__numinput_8h.html#ae2bd11d04444099d90f9ed424e6ef1d4">NUM_NO_NEGATIVE</a>;
<a name="l02843"></a>02843     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l02844"></a>02844     
<a name="l02845"></a>02845     <span class="comment">// Calculate average radius</span>
<a name="l02846"></a>02846     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l02847"></a>02847         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1b45814c11dea4bd0d14d50a134192eb">val</a> += <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>);
<a name="l02848"></a>02848     }
<a name="l02849"></a>02849     
<a name="l02850"></a>02850     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1b45814c11dea4bd0d14d50a134192eb">val</a> /= (float)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>;
<a name="l02851"></a>02851 }
<a name="l02852"></a>02852 
<a name="l02853"></a><a class="code" href="../../d8/d27/transform_8c.html#a785348f3e38ef0f8a14326501d3e8664">02853</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a785348f3e38ef0f8a14326501d3e8664">ToSphere</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l02854"></a>02854 {
<a name="l02855"></a>02855     <span class="keywordtype">float</span> vec[3];
<a name="l02856"></a>02856     <span class="keywordtype">float</span> ratio, radius;
<a name="l02857"></a>02857     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02858"></a>02858     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[64];
<a name="l02859"></a>02859     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l02860"></a>02860     
<a name="l02861"></a>02861     ratio = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l02862"></a>02862     
<a name="l02863"></a>02863     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;ratio);
<a name="l02864"></a>02864     
<a name="l02865"></a>02865     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;ratio);
<a name="l02866"></a>02866     
<a name="l02867"></a>02867     <span class="keywordflow">if</span> (ratio &lt; 0)
<a name="l02868"></a>02868         ratio = 0.0f;
<a name="l02869"></a>02869     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ratio &gt; 1)
<a name="l02870"></a>02870         ratio = 1.0f;
<a name="l02871"></a>02871     
<a name="l02872"></a>02872     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = ratio;
<a name="l02873"></a>02873 
<a name="l02874"></a>02874     <span class="comment">/* header print for NumInput */</span>
<a name="l02875"></a>02875     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l02876"></a>02876         <span class="keywordtype">char</span> c[20];
<a name="l02877"></a>02877         
<a name="l02878"></a>02878         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l02879"></a>02879         
<a name="l02880"></a>02880         sprintf(str, <span class="stringliteral">&quot;To Sphere: %s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02881"></a>02881     }
<a name="l02882"></a>02882     <span class="keywordflow">else</span> {
<a name="l02883"></a>02883         <span class="comment">/* default header print */</span>
<a name="l02884"></a>02884         sprintf(str, <span class="stringliteral">&quot;To Sphere: %.4f %s&quot;</span>, ratio, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l02885"></a>02885     }
<a name="l02886"></a>02886     
<a name="l02887"></a>02887     
<a name="l02888"></a>02888     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l02889"></a>02889         <span class="keywordtype">float</span> tratio;
<a name="l02890"></a>02890         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l02891"></a>02891             <span class="keywordflow">break</span>;
<a name="l02892"></a>02892         
<a name="l02893"></a>02893         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l02894"></a>02894             <span class="keywordflow">continue</span>;
<a name="l02895"></a>02895         
<a name="l02896"></a>02896         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>);
<a name="l02897"></a>02897         
<a name="l02898"></a>02898         radius = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec);
<a name="l02899"></a>02899         
<a name="l02900"></a>02900         tratio = ratio * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>;
<a name="l02901"></a>02901         
<a name="l02902"></a>02902         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, radius * (1.0f - tratio) + t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1b45814c11dea4bd0d14d50a134192eb">val</a> * tratio);
<a name="l02903"></a>02903         
<a name="l02904"></a>02904         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, vec);
<a name="l02905"></a>02905     }
<a name="l02906"></a>02906     
<a name="l02907"></a>02907     
<a name="l02908"></a>02908     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l02909"></a>02909     
<a name="l02910"></a>02910     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l02911"></a>02911     
<a name="l02912"></a>02912     <span class="keywordflow">return</span> 1;
<a name="l02913"></a>02913 }
<a name="l02914"></a>02914 
<a name="l02915"></a>02915 <span class="comment">/* ************************** ROTATION *************************** */</span>
<a name="l02916"></a>02916 
<a name="l02917"></a>02917 
<a name="l02918"></a><a class="code" href="../../d8/d27/transform_8c.html#a2f5f0490a550a28527b9d9b02f22a329">02918</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a2f5f0490a550a28527b9d9b02f22a329">postInputRotation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> values[3])
<a name="l02919"></a>02919 {
<a name="l02920"></a>02920     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>) {
<a name="l02921"></a>02921         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>, values);
<a name="l02922"></a>02922     }
<a name="l02923"></a>02923 }
<a name="l02924"></a>02924 
<a name="l02925"></a><a class="code" href="../../d2/d80/transform_8h.html#adc9eb52f311d8812a078a63adbba18f8">02925</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#adc9eb52f311d8812a078a63adbba18f8">initRotation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l02926"></a>02926 {
<a name="l02927"></a>02927     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a507ca8d0d38d73e72777c15a79491cc1">TFM_ROTATION</a>;
<a name="l02928"></a>02928     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a47ba954f955f9b498d27f1c6973b91ad">Rotation</a>;
<a name="l02929"></a>02929     
<a name="l02930"></a>02930     <a class="code" href="../../d2/d80/transform_8h.html#a0a49975611db08b07d9227200d0858ac">setInputPostFct</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d8/d27/transform_8c.html#a2f5f0490a550a28527b9d9b02f22a329">postInputRotation</a>);
<a name="l02931"></a>02931     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717adb08b6b8c2e8258d470aa8a584ef8dc2">INPUT_ANGLE</a>);
<a name="l02932"></a>02932     
<a name="l02933"></a>02933     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l02934"></a>02934     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l02935"></a>02935     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l02936"></a>02936     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = (float)((5.0/180)*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l02937"></a>02937     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.2f;
<a name="l02938"></a>02938     
<a name="l02939"></a>02939     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = 1.0f;
<a name="l02940"></a>02940 
<a name="l02941"></a>02941     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>)
<a name="l02942"></a>02942         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l02943"></a>02943 
<a name="l02944"></a>02944     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a728bb3f38e925644683c9ace0cee4977">negate_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2dd8c0b6b07389026e51c74f22d6f70b">viewinv</a>[2]);
<a name="l02945"></a>02945     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l02946"></a>02946 
<a name="l02947"></a>02947     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4e999d7181d5b65ea1350a3dc14d93e0">axis_orig</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l02948"></a>02948 }
<a name="l02949"></a>02949 
<a name="l02950"></a><a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">02950</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">ElementRotation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td, <span class="keywordtype">float</span> mat[3][3], <span class="keywordtype">short</span> around)
<a name="l02951"></a>02951 {
<a name="l02952"></a>02952     <span class="keywordtype">float</span> vec[3], totmat[3][3], smat[3][3];
<a name="l02953"></a>02953     <span class="keywordtype">float</span> eul[3], fmat[3][3], quat[4];
<a name="l02954"></a>02954     <span class="keywordtype">float</span> *center = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>;
<a name="l02955"></a>02955 
<a name="l02956"></a>02956     <span class="comment">/* local constraint shouldn&#39;t alter center */</span>
<a name="l02957"></a>02957     <span class="keywordflow">if</span> (around == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5e37cb5cb6e4bc87eaffb8a738f79c91">V3D_LOCAL</a>) {
<a name="l02958"></a>02958         <span class="keywordflow">if</span> (    (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>)) ||
<a name="l02959"></a>02959                 (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a028ef4069c952a4242cbda17cd0992d5">settings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; (<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad6cb358a5c5612c639f998b0601e0865">SCE_SELECT_EDGE</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>)) ||
<a name="l02960"></a>02960                 (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>))
<a name="l02961"></a>02961         {
<a name="l02962"></a>02962             center = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>;
<a name="l02963"></a>02963         }
<a name="l02964"></a>02964     }
<a name="l02965"></a>02965 
<a name="l02966"></a>02966     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a242b050c360ba1db9ba0314675f82b33">T_POINTS</a>) {
<a name="l02967"></a>02967         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(totmat, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>);
<a name="l02968"></a>02968         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(smat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, totmat);
<a name="l02969"></a>02969         
<a name="l02970"></a>02970         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, center);
<a name="l02971"></a>02971         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(smat, vec);
<a name="l02972"></a>02972         
<a name="l02973"></a>02973         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, vec, center);
<a name="l02974"></a>02974         
<a name="l02975"></a>02975         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec,td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>,td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>);
<a name="l02976"></a>02976         <a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">protectedTransBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, vec);
<a name="l02977"></a>02977         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l02978"></a>02978         
<a name="l02979"></a>02979         
<a name="l02980"></a>02980         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a745fb120b1ed74acd95970a4b48873e7">TD_USEQUAT</a>) {
<a name="l02981"></a>02981             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a19aaec2780694478b53edec408c38c30">mul_serie_m3</a>(fmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02982"></a>02982             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a176f538ccb9db7cc95d7699264508b26">mat3_to_quat</a>( quat,fmat);   <span class="comment">// Actual transform</span>
<a name="l02983"></a>02983             
<a name="l02984"></a>02984             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>) {
<a name="l02985"></a>02985                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>, quat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aadce7bca0d39f4e051c1bc72a9ab7fb7">iquat</a>);
<a name="l02986"></a>02986                 
<a name="l02987"></a>02987                 <span class="comment">/* is there a reason not to have this here? -jahka */</span>
<a name="l02988"></a>02988                 <a class="code" href="../../d8/d27/transform_8c.html#ad39a76ecee6f4b98996da38d053548f9">protectedQuaternionBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aadce7bca0d39f4e051c1bc72a9ab7fb7">iquat</a>);
<a name="l02989"></a>02989             }
<a name="l02990"></a>02990         }
<a name="l02991"></a>02991     }
<a name="l03004"></a>03004     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>) {
<a name="l03005"></a>03005         <span class="keywordtype">float</span> pmtx[3][3], imtx[3][3];
<a name="l03006"></a>03006         
<a name="l03007"></a>03007         <span class="comment">// Extract and invert armature object matrix</span>
<a name="l03008"></a>03008         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(pmtx, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aefcd6d2b51a3fa9ab4479e0f84928c57">poseobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l03009"></a>03009         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#acc9f8cab0ea2c5993f2c9bdeaca6b788">invert_m3_m3</a>(imtx, pmtx);
<a name="l03010"></a>03010         
<a name="l03011"></a>03011         <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aa220e3379207ebeda990811126bcb7fa">TD_NO_LOC</a>) == 0)
<a name="l03012"></a>03012         {
<a name="l03013"></a>03013             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>, center);
<a name="l03014"></a>03014             
<a name="l03015"></a>03015             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(pmtx, vec);   <span class="comment">// To Global space</span>
<a name="l03016"></a>03016             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mat, vec);        <span class="comment">// Applying rotation</span>
<a name="l03017"></a>03017             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(imtx, vec);   <span class="comment">// To Local space</span>
<a name="l03018"></a>03018             
<a name="l03019"></a>03019             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, center);
<a name="l03020"></a>03020             <span class="comment">/* vec now is the location where the object has to be */</span>
<a name="l03021"></a>03021             
<a name="l03022"></a>03022             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>); <span class="comment">// Translation needed from the initial location</span>
<a name="l03023"></a>03023             
<a name="l03024"></a>03024             <span class="comment">/* special exception, see TD_PBONE_LOCAL_MTX definition comments */</span>
<a name="l03025"></a>03025             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ac13d47dd98ce805a098c96ce3fb9cf60">TD_PBONE_LOCAL_MTX_P</a>) {
<a name="l03026"></a>03026                 <span class="comment">/* do nothing */</span>
<a name="l03027"></a>03027             }
<a name="l03028"></a>03028             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a1404001a6b64e1c3212b75b561c494e6">TD_PBONE_LOCAL_MTX_C</a>) {
<a name="l03029"></a>03029                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(pmtx, vec);   <span class="comment">// To Global space</span>
<a name="l03030"></a>03030                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a8eb108262d0327f4524ccbae9782a5ce">l_smtx</a>, vec);<span class="comment">// To Pose space (Local Location)</span>
<a name="l03031"></a>03031             }
<a name="l03032"></a>03032             <span class="keywordflow">else</span> {
<a name="l03033"></a>03033                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(pmtx, vec);   <span class="comment">// To Global space</span>
<a name="l03034"></a>03034                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, vec);<span class="comment">// To Pose space</span>
<a name="l03035"></a>03035             }
<a name="l03036"></a>03036 
<a name="l03037"></a>03037             <a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">protectedTransBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, vec);
<a name="l03038"></a>03038             
<a name="l03039"></a>03039             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l03040"></a>03040             
<a name="l03041"></a>03041             <a class="code" href="../../d8/d27/transform_8c.html#a1c9d744099e6fdc3a4b84e9d2f804d28">constraintTransLim</a>(t, td);
<a name="l03042"></a>03042         }
<a name="l03043"></a>03043         
<a name="l03044"></a>03044         <span class="comment">/* rotation */</span>
<a name="l03045"></a>03045         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ad3a1f582392fa620921c51d73d3e13db">T_V3D_ALIGN</a>)==0) { <span class="comment">// align mode doesn&#39;t rotate objects itself</span>
<a name="l03046"></a>03046             <span class="comment">/* euler or quaternion/axis-angle? */</span>
<a name="l03047"></a>03047             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca3fd6f41388cbe0f034332712de0e0798">ROT_MODE_QUAT</a>) {
<a name="l03048"></a>03048                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a19aaec2780694478b53edec408c38c30">mul_serie_m3</a>(fmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03049"></a>03049                 
<a name="l03050"></a>03050                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a176f538ccb9db7cc95d7699264508b26">mat3_to_quat</a>( quat,fmat);   <span class="comment">// Actual transform</span>
<a name="l03051"></a>03051                 
<a name="l03052"></a>03052                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>, quat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aadce7bca0d39f4e051c1bc72a9ab7fb7">iquat</a>);
<a name="l03053"></a>03053                 <span class="comment">/* this function works on end result */</span>
<a name="l03054"></a>03054                 <a class="code" href="../../d8/d27/transform_8c.html#ad39a76ecee6f4b98996da38d053548f9">protectedQuaternionBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aadce7bca0d39f4e051c1bc72a9ab7fb7">iquat</a>);
<a name="l03055"></a>03055                 
<a name="l03056"></a>03056             }
<a name="l03057"></a>03057             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca6fd1324ea35af2fbf6879b35d73ea547">ROT_MODE_AXISANGLE</a>) {
<a name="l03058"></a>03058                 <span class="comment">/* calculate effect based on quats */</span>
<a name="l03059"></a>03059                 <span class="keywordtype">float</span> iquat[4], tquat[4];
<a name="l03060"></a>03060                 
<a name="l03061"></a>03061                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(iquat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aea74b8b60f31a475b88ec285ee821b97">irotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a8ccedeb1d1f6b4b01088ce4705dc64ef">irotAngle</a>);
<a name="l03062"></a>03062                 
<a name="l03063"></a>03063                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a19aaec2780694478b53edec408c38c30">mul_serie_m3</a>(fmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03064"></a>03064                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a176f538ccb9db7cc95d7699264508b26">mat3_to_quat</a>( quat,fmat);   <span class="comment">// Actual transform</span>
<a name="l03065"></a>03065                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(tquat, quat, iquat);
<a name="l03066"></a>03066                 
<a name="l03067"></a>03067                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95e79b80f962335b7165103f7f0f12bf">quat_to_axis_angle</a>( td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a0c2c175aaa59a97cd7272db976167833">rotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#af0a7b90c32726fede9d10146be1de36c">rotAngle</a>,tquat); 
<a name="l03068"></a>03068                 
<a name="l03069"></a>03069                 <span class="comment">/* this function works on end result */</span>
<a name="l03070"></a>03070                 <a class="code" href="../../d8/d27/transform_8c.html#ab0a21b98ca5665d8f2d50ecbfd3bc800">protectedAxisAngleBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a0c2c175aaa59a97cd7272db976167833">rotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#af0a7b90c32726fede9d10146be1de36c">rotAngle</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aea74b8b60f31a475b88ec285ee821b97">irotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a8ccedeb1d1f6b4b01088ce4705dc64ef">irotAngle</a>);
<a name="l03071"></a>03071             }
<a name="l03072"></a>03072             <span class="keywordflow">else</span> { 
<a name="l03073"></a>03073                 <span class="keywordtype">float</span> eulmat[3][3];
<a name="l03074"></a>03074                 
<a name="l03075"></a>03075                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(totmat, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>);
<a name="l03076"></a>03076                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(smat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, totmat);
<a name="l03077"></a>03077                 
<a name="l03078"></a>03078                 <span class="comment">/* calculate the total rotatation in eulers */</span>
<a name="l03079"></a>03079                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#ab5e9b718a4ef820028075375fcdf3c55">irot</a>);
<a name="l03080"></a>03080                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aa6973857a6a1d26c0155bb21f4b6de01">eulO_to_mat3</a>( eulmat,eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a>);
<a name="l03081"></a>03081                 
<a name="l03082"></a>03082                 <span class="comment">/* mat = transform, obmat = bone rotation */</span>
<a name="l03083"></a>03083                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(fmat, smat, eulmat);
<a name="l03084"></a>03084                 
<a name="l03085"></a>03085                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aecda43d4ff738267956af5f39ac70681">mat3_to_compatible_eulO</a>( eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a674420ebad81620080fee75e0dd13e2e">rot</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a>,fmat);
<a name="l03086"></a>03086                 
<a name="l03087"></a>03087                 <span class="comment">/* and apply (to end result only) */</span>
<a name="l03088"></a>03088                 <a class="code" href="../../d8/d27/transform_8c.html#a4593879871add5aad9c7d17925fa7468">protectedRotateBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#ab5e9b718a4ef820028075375fcdf3c55">irot</a>);
<a name="l03089"></a>03089                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a674420ebad81620080fee75e0dd13e2e">rot</a>, eul);
<a name="l03090"></a>03090             }
<a name="l03091"></a>03091             
<a name="l03092"></a>03092             <a class="code" href="../../d8/d27/transform_8c.html#abd7d9ba574380268a970371fca70d212">constraintRotLim</a>(t, td);
<a name="l03093"></a>03093         }
<a name="l03094"></a>03094     }
<a name="l03095"></a>03095     <span class="keywordflow">else</span> {
<a name="l03096"></a>03096         <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aa220e3379207ebeda990811126bcb7fa">TD_NO_LOC</a>) == 0)
<a name="l03097"></a>03097         {
<a name="l03098"></a>03098             <span class="comment">/* translation */</span>
<a name="l03099"></a>03099             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>, center);
<a name="l03100"></a>03100             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mat, vec);
<a name="l03101"></a>03101             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, center);
<a name="l03102"></a>03102             <span class="comment">/* vec now is the location where the object has to be */</span>
<a name="l03103"></a>03103             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l03104"></a>03104             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, vec);
<a name="l03105"></a>03105             
<a name="l03106"></a>03106             <a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">protectedTransBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, vec);
<a name="l03107"></a>03107             
<a name="l03108"></a>03108             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l03109"></a>03109         }
<a name="l03110"></a>03110         
<a name="l03111"></a>03111         
<a name="l03112"></a>03112         <a class="code" href="../../d8/d27/transform_8c.html#a1c9d744099e6fdc3a4b84e9d2f804d28">constraintTransLim</a>(t, td);
<a name="l03113"></a>03113         
<a name="l03114"></a>03114         <span class="comment">/* rotation */</span>
<a name="l03115"></a>03115         <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ad3a1f582392fa620921c51d73d3e13db">T_V3D_ALIGN</a>)==0) { <span class="comment">// align mode doesn&#39;t rotate objects itself</span>
<a name="l03116"></a>03116             <span class="comment">/* euler or quaternion? */</span>
<a name="l03117"></a>03117                <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca3fd6f41388cbe0f034332712de0e0798">ROT_MODE_QUAT</a>) || (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a745fb120b1ed74acd95970a4b48873e7">TD_USEQUAT</a>)) {
<a name="l03118"></a>03118                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a19aaec2780694478b53edec408c38c30">mul_serie_m3</a>(fmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03119"></a>03119                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a176f538ccb9db7cc95d7699264508b26">mat3_to_quat</a>( quat,fmat);   <span class="comment">// Actual transform</span>
<a name="l03120"></a>03120                 
<a name="l03121"></a>03121                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>, quat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aadce7bca0d39f4e051c1bc72a9ab7fb7">iquat</a>);
<a name="l03122"></a>03122                 <span class="comment">/* this function works on end result */</span>
<a name="l03123"></a>03123                 <a class="code" href="../../d8/d27/transform_8c.html#ad39a76ecee6f4b98996da38d053548f9">protectedQuaternionBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aadce7bca0d39f4e051c1bc72a9ab7fb7">iquat</a>);
<a name="l03124"></a>03124             }
<a name="l03125"></a>03125             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca6fd1324ea35af2fbf6879b35d73ea547">ROT_MODE_AXISANGLE</a>) {
<a name="l03126"></a>03126                 <span class="comment">/* calculate effect based on quats */</span>
<a name="l03127"></a>03127                 <span class="keywordtype">float</span> iquat[4], tquat[4];
<a name="l03128"></a>03128                 
<a name="l03129"></a>03129                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(iquat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aea74b8b60f31a475b88ec285ee821b97">irotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a8ccedeb1d1f6b4b01088ce4705dc64ef">irotAngle</a>);
<a name="l03130"></a>03130                 
<a name="l03131"></a>03131                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a19aaec2780694478b53edec408c38c30">mul_serie_m3</a>(fmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03132"></a>03132                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a176f538ccb9db7cc95d7699264508b26">mat3_to_quat</a>( quat,fmat);   <span class="comment">// Actual transform</span>
<a name="l03133"></a>03133                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(tquat, quat, iquat);
<a name="l03134"></a>03134                 
<a name="l03135"></a>03135                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95e79b80f962335b7165103f7f0f12bf">quat_to_axis_angle</a>( td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a0c2c175aaa59a97cd7272db976167833">rotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#af0a7b90c32726fede9d10146be1de36c">rotAngle</a>,tquat); 
<a name="l03136"></a>03136                 
<a name="l03137"></a>03137                 <span class="comment">/* this function works on end result */</span>
<a name="l03138"></a>03138                 <a class="code" href="../../d8/d27/transform_8c.html#ab0a21b98ca5665d8f2d50ecbfd3bc800">protectedAxisAngleBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a0c2c175aaa59a97cd7272db976167833">rotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#af0a7b90c32726fede9d10146be1de36c">rotAngle</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#aea74b8b60f31a475b88ec285ee821b97">irotAxis</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a8ccedeb1d1f6b4b01088ce4705dc64ef">irotAngle</a>);
<a name="l03139"></a>03139             }
<a name="l03140"></a>03140             <span class="keywordflow">else</span> {
<a name="l03141"></a>03141                 <span class="keywordtype">float</span> obmat[3][3];
<a name="l03142"></a>03142                 
<a name="l03143"></a>03143                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(totmat, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>);
<a name="l03144"></a>03144                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(smat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, totmat);
<a name="l03145"></a>03145                 
<a name="l03146"></a>03146                 <span class="comment">/* calculate the total rotatation in eulers */</span>
<a name="l03147"></a>03147                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#ab5e9b718a4ef820028075375fcdf3c55">irot</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a1a7f668dc1be8ae70a6550c0aedbe435">drot</a>); <span class="comment">/* we have to correct for delta rot */</span>
<a name="l03148"></a>03148                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aa6973857a6a1d26c0155bb21f4b6de01">eulO_to_mat3</a>( obmat,eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a>);
<a name="l03149"></a>03149                 <span class="comment">/* mat = transform, obmat = object rotation */</span>
<a name="l03150"></a>03150                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(fmat, smat, obmat);
<a name="l03151"></a>03151                 
<a name="l03152"></a>03152                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aecda43d4ff738267956af5f39ac70681">mat3_to_compatible_eulO</a>( eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a674420ebad81620080fee75e0dd13e2e">rot</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a903194635f2656cf1265a19aaaf630fa">rotOrder</a>,fmat);
<a name="l03153"></a>03153                 
<a name="l03154"></a>03154                 <span class="comment">/* correct back for delta rot */</span>
<a name="l03155"></a>03155                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(eul, eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a1a7f668dc1be8ae70a6550c0aedbe435">drot</a>);
<a name="l03156"></a>03156                 
<a name="l03157"></a>03157                 <span class="comment">/* and apply */</span>
<a name="l03158"></a>03158                 <a class="code" href="../../d8/d27/transform_8c.html#a4593879871add5aad9c7d17925fa7468">protectedRotateBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, eul, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#ab5e9b718a4ef820028075375fcdf3c55">irot</a>);
<a name="l03159"></a>03159                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a674420ebad81620080fee75e0dd13e2e">rot</a>, eul);
<a name="l03160"></a>03160             }
<a name="l03161"></a>03161             
<a name="l03162"></a>03162             <a class="code" href="../../d8/d27/transform_8c.html#abd7d9ba574380268a970371fca70d212">constraintRotLim</a>(t, td);
<a name="l03163"></a>03163         }
<a name="l03164"></a>03164     }
<a name="l03165"></a>03165 }
<a name="l03166"></a>03166 
<a name="l03167"></a><a class="code" href="../../d8/d27/transform_8c.html#a56eb84036b8d07c1774cd8b85a45d08f">03167</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a56eb84036b8d07c1774cd8b85a45d08f">applyRotation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>, <span class="keywordtype">float</span> axis[3])
<a name="l03168"></a>03168 {
<a name="l03169"></a>03169     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03170"></a>03170     <span class="keywordtype">float</span> mat[3][3];
<a name="l03171"></a>03171     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03172"></a>03172     
<a name="l03173"></a>03173     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( mat,axis, angle);
<a name="l03174"></a>03174     
<a name="l03175"></a>03175     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03176"></a>03176         
<a name="l03177"></a>03177         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03178"></a>03178             <span class="keywordflow">break</span>;
<a name="l03179"></a>03179         
<a name="l03180"></a>03180         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03181"></a>03181             <span class="keywordflow">continue</span>;
<a name="l03182"></a>03182         
<a name="l03183"></a>03183         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>) {
<a name="l03184"></a>03184             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>(t, td, axis, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03185"></a>03185             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( mat,axis, angle * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l03186"></a>03186         }
<a name="l03187"></a>03187         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>) {
<a name="l03188"></a>03188             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( mat,axis, angle * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l03189"></a>03189         }
<a name="l03190"></a>03190         
<a name="l03191"></a>03191         <a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">ElementRotation</a>(t, td, mat, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0c9e2a1ae5acee970c6b8e16b96f09bd">around</a>);
<a name="l03192"></a>03192     }
<a name="l03193"></a>03193 }
<a name="l03194"></a>03194 
<a name="l03195"></a><a class="code" href="../../d8/d27/transform_8c.html#a47ba954f955f9b498d27f1c6973b91ad">03195</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a47ba954f955f9b498d27f1c6973b91ad">Rotation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03196"></a>03196 {
<a name="l03197"></a>03197     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[128], *spos= <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l03198"></a>03198     
<a name="l03199"></a>03199     <span class="keywordtype">float</span> <span class="keyword">final</span>;
<a name="l03200"></a>03200 
<a name="l03201"></a>03201     <span class="keyword">final</span> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l03202"></a>03202     
<a name="l03203"></a>03203     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;<span class="keyword">final</span>);
<a name="l03204"></a>03204     
<a name="l03205"></a>03205     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>) {
<a name="l03206"></a>03206         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03207"></a>03207     }
<a name="l03208"></a>03208     <span class="keywordflow">else</span> {
<a name="l03209"></a>03209         <span class="comment">/* reset axis if constraint is not set */</span>
<a name="l03210"></a>03210         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4e999d7181d5b65ea1350a3dc14d93e0">axis_orig</a>);
<a name="l03211"></a>03211     }
<a name="l03212"></a>03212     
<a name="l03213"></a>03213     <a class="code" href="../../d2/d80/transform_8h.html#a11dd25226a3aa484eedc0790bf8c4456">applySnapping</a>(t, &amp;<span class="keyword">final</span>);
<a name="l03214"></a>03214     
<a name="l03215"></a>03215     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03216"></a>03216         <span class="keywordtype">char</span> c[20];
<a name="l03217"></a>03217         
<a name="l03218"></a>03218         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;<span class="keyword">final</span>);
<a name="l03219"></a>03219         
<a name="l03220"></a>03220         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03221"></a>03221         
<a name="l03222"></a>03222         spos+= sprintf(spos, <span class="stringliteral">&quot;Rot: %s %s %s&quot;</span>, &amp;c[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03223"></a>03223 
<a name="l03224"></a>03224         <span class="comment">/* Clamp between -180 and 180 */</span>
<a name="l03225"></a>03225         <span class="keyword">final</span>= <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad7f64ab2e0be23226666ed15b9304390">angle_wrap_rad</a>(<a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(<span class="keyword">final</span>));
<a name="l03226"></a>03226     }
<a name="l03227"></a>03227     <span class="keywordflow">else</span> {
<a name="l03228"></a>03228         spos += sprintf(spos, <span class="stringliteral">&quot;Rot: %.2f%s %s&quot;</span>, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<span class="keyword">final</span>), t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03229"></a>03229     }
<a name="l03230"></a>03230     
<a name="l03231"></a>03231     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>)) {
<a name="l03232"></a>03232         spos += sprintf(spos, <span class="stringliteral">&quot; Proportional size: %.2f&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>);
<a name="l03233"></a>03233     }
<a name="l03234"></a>03234     (void)spos;
<a name="l03235"></a>03235 
<a name="l03236"></a>03236     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = <span class="keyword">final</span>;
<a name="l03237"></a>03237     
<a name="l03238"></a>03238     <a class="code" href="../../d8/d27/transform_8c.html#a56eb84036b8d07c1774cd8b85a45d08f">applyRotation</a>(t, <span class="keyword">final</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aae725746bb2fa7b54fae9fec376f31e3">axis</a>);
<a name="l03239"></a>03239     
<a name="l03240"></a>03240     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03241"></a>03241     
<a name="l03242"></a>03242     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03243"></a>03243     
<a name="l03244"></a>03244     <span class="keywordflow">return</span> 1;
<a name="l03245"></a>03245 }
<a name="l03246"></a>03246 
<a name="l03247"></a>03247 
<a name="l03248"></a>03248 <span class="comment">/* ************************** TRACKBALL *************************** */</span>
<a name="l03249"></a>03249 
<a name="l03250"></a><a class="code" href="../../d2/d80/transform_8h.html#a4f667262c34ee4cae1bace342cd02872">03250</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a4f667262c34ee4cae1bace342cd02872">initTrackball</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03251"></a>03251 {
<a name="l03252"></a>03252     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84adf02cf85670a85ecf434ef5b3e6d681e">TFM_TRACKBALL</a>;
<a name="l03253"></a>03253     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#aae1e28d8135d495423ecf398866cbf0a">Trackball</a>;
<a name="l03254"></a>03254 
<a name="l03255"></a>03255     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a271321693acce66b9244125ff518c138">INPUT_TRACKBALL</a>);
<a name="l03256"></a>03256 
<a name="l03257"></a>03257     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 1;
<a name="l03258"></a>03258     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 1;
<a name="l03259"></a>03259     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03260"></a>03260     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = (float)((5.0/180)*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l03261"></a>03261     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.2f;
<a name="l03262"></a>03262 
<a name="l03263"></a>03263     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = 1.0f;
<a name="l03264"></a>03264 
<a name="l03265"></a>03265     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l03266"></a>03266 }
<a name="l03267"></a>03267 
<a name="l03268"></a><a class="code" href="../../d8/d27/transform_8c.html#af39433ab9f305a98c41d18b2cd8d7959">03268</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#af39433ab9f305a98c41d18b2cd8d7959">applyTrackball</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> axis1[3], <span class="keywordtype">float</span> axis2[3], <span class="keywordtype">float</span> angles[2])
<a name="l03269"></a>03269 {
<a name="l03270"></a>03270     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03271"></a>03271     <span class="keywordtype">float</span> mat[3][3], smat[3][3], totmat[3][3];
<a name="l03272"></a>03272     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03273"></a>03273 
<a name="l03274"></a>03274     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( smat,axis1, angles[0]);
<a name="l03275"></a>03275     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( totmat,axis2, angles[1]);
<a name="l03276"></a>03276 
<a name="l03277"></a>03277     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat, smat, totmat);
<a name="l03278"></a>03278 
<a name="l03279"></a>03279     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03280"></a>03280         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03281"></a>03281             <span class="keywordflow">break</span>;
<a name="l03282"></a>03282 
<a name="l03283"></a>03283         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03284"></a>03284             <span class="keywordflow">continue</span>;
<a name="l03285"></a>03285 
<a name="l03286"></a>03286         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>) {
<a name="l03287"></a>03287             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( smat,axis1, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a> * angles[0]);
<a name="l03288"></a>03288             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( totmat,axis2, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a> * angles[1]);
<a name="l03289"></a>03289 
<a name="l03290"></a>03290             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat, smat, totmat);
<a name="l03291"></a>03291         }
<a name="l03292"></a>03292 
<a name="l03293"></a>03293         <a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">ElementRotation</a>(t, td, mat, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0c9e2a1ae5acee970c6b8e16b96f09bd">around</a>);
<a name="l03294"></a>03294     }
<a name="l03295"></a>03295 }
<a name="l03296"></a>03296 
<a name="l03297"></a><a class="code" href="../../d8/d27/transform_8c.html#aae1e28d8135d495423ecf398866cbf0a">03297</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#aae1e28d8135d495423ecf398866cbf0a">Trackball</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03298"></a>03298 {
<a name="l03299"></a>03299     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[128], *spos= <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l03300"></a>03300     <span class="keywordtype">float</span> axis1[3], axis2[3];
<a name="l03301"></a>03301     <span class="keywordtype">float</span> mat[3][3], totmat[3][3], smat[3][3];
<a name="l03302"></a>03302     <span class="keywordtype">float</span> phi[2];
<a name="l03303"></a>03303 
<a name="l03304"></a>03304     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(axis1, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#af5fed4fdcf40c6ac8bcac00275df04d8">persinv</a>[0]);
<a name="l03305"></a>03305     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(axis2, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#af5fed4fdcf40c6ac8bcac00275df04d8">persinv</a>[1]);
<a name="l03306"></a>03306     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(axis1);
<a name="l03307"></a>03307     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(axis2);
<a name="l03308"></a>03308 
<a name="l03309"></a>03309     phi[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l03310"></a>03310     phi[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[1];
<a name="l03311"></a>03311 
<a name="l03312"></a>03312     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, phi);
<a name="l03313"></a>03313 
<a name="l03314"></a>03314     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03315"></a>03315         <span class="keywordtype">char</span> c[40];
<a name="l03316"></a>03316 
<a name="l03317"></a>03317         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, phi);
<a name="l03318"></a>03318 
<a name="l03319"></a>03319         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03320"></a>03320 
<a name="l03321"></a>03321         spos += sprintf(spos, <span class="stringliteral">&quot;Trackball: %s %s %s&quot;</span>, &amp;c[0], &amp;c[20], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03322"></a>03322 
<a name="l03323"></a>03323         phi[0] = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(phi[0]);
<a name="l03324"></a>03324         phi[1] = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(phi[1]);
<a name="l03325"></a>03325     }
<a name="l03326"></a>03326     <span class="keywordflow">else</span> {
<a name="l03327"></a>03327         spos += sprintf(spos, <span class="stringliteral">&quot;Trackball: %.2f %.2f %s&quot;</span>, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(phi[0]), <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(phi[1]), t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03328"></a>03328     }
<a name="l03329"></a>03329 
<a name="l03330"></a>03330     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>)) {
<a name="l03331"></a>03331         spos += sprintf(spos, <span class="stringliteral">&quot; Proportional size: %.2f&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>);
<a name="l03332"></a>03332     }
<a name="l03333"></a>03333     (void)spos;
<a name="l03334"></a>03334 
<a name="l03335"></a>03335     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( smat,axis1, phi[0]);
<a name="l03336"></a>03336     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>( totmat,axis2, phi[1]);
<a name="l03337"></a>03337 
<a name="l03338"></a>03338     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat, smat, totmat);
<a name="l03339"></a>03339 
<a name="l03340"></a>03340     <span class="comment">// TRANSFORM_FIX_ME</span>
<a name="l03341"></a>03341     <span class="comment">//copy_m3_m3(t-&gt;mat, mat);  // used in manipulator</span>
<a name="l03342"></a>03342 
<a name="l03343"></a>03343     <a class="code" href="../../d8/d27/transform_8c.html#af39433ab9f305a98c41d18b2cd8d7959">applyTrackball</a>(t, axis1, axis2, phi);
<a name="l03344"></a>03344 
<a name="l03345"></a>03345     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03346"></a>03346 
<a name="l03347"></a>03347     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03348"></a>03348 
<a name="l03349"></a>03349     <span class="keywordflow">return</span> 1;
<a name="l03350"></a>03350 }
<a name="l03351"></a>03351 
<a name="l03352"></a>03352 <span class="comment">/* ************************** TRANSLATION *************************** */</span>
<a name="l03353"></a>03353 
<a name="l03354"></a><a class="code" href="../../d2/d80/transform_8h.html#a6e79b804b31355f3c48c4e6455b18ba6">03354</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a6e79b804b31355f3c48c4e6455b18ba6">initTranslation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03355"></a>03355 {
<a name="l03356"></a>03356     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l03357"></a>03357         <span class="comment">/* this space uses time translate */</span>
<a name="l03358"></a>03358         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l03359"></a>03359     }
<a name="l03360"></a>03360 
<a name="l03361"></a>03361     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>;
<a name="l03362"></a>03362     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#acb82f96e2666723b581caf75c103db1e">Translation</a>;
<a name="l03363"></a>03363 
<a name="l03364"></a>03364     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a6438d03c74f97b2a22a7ab443f5b8de0">INPUT_VECTOR</a>);
<a name="l03365"></a>03365 
<a name="l03366"></a>03366     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>)? 1: 2;
<a name="l03367"></a>03367     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> = 0;
<a name="l03368"></a>03368     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a>;
<a name="l03369"></a>03369 
<a name="l03370"></a>03370     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l03371"></a>03371         <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l03372"></a>03372 
<a name="l03373"></a>03373         <span class="keywordflow">if</span> (rv3d) {
<a name="l03374"></a>03374             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03375"></a>03375             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a977e0f2bd3b4f04e9f46534104461bf9">gridview</a> * 1.0f;
<a name="l03376"></a>03376             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l03377"></a>03377         }
<a name="l03378"></a>03378     }
<a name="l03379"></a>03379     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>)) {
<a name="l03380"></a>03380         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03381"></a>03381         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.125f;
<a name="l03382"></a>03382         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 0.0625f;
<a name="l03383"></a>03383     }
<a name="l03384"></a>03384     <span class="keywordflow">else</span> {
<a name="l03385"></a>03385         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03386"></a>03386         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 1.0f;
<a name="l03387"></a>03387     }
<a name="l03388"></a>03388 
<a name="l03389"></a>03389     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03390"></a>03390 }
<a name="l03391"></a>03391 
<a name="l03392"></a><a class="code" href="../../d8/d27/transform_8c.html#a9979ee47787a11d3a17b523cf37e4f2a">03392</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a9979ee47787a11d3a17b523cf37e4f2a">headerTranslation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> vec[3], <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l03393"></a>03393 {
<a name="l03394"></a>03394     <span class="keywordtype">char</span> *spos= <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l03395"></a>03395     <span class="keywordtype">char</span> tvec[60];
<a name="l03396"></a>03396     <span class="keywordtype">char</span> distvec[20];
<a name="l03397"></a>03397     <span class="keywordtype">char</span> autoik[20];
<a name="l03398"></a>03398     <span class="keywordtype">float</span> dist;
<a name="l03399"></a>03399 
<a name="l03400"></a>03400     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03401"></a>03401         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l03402"></a>03402         dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a3d8f88106d084f72a4631270391b0e76">val</a>);
<a name="l03403"></a>03403     }
<a name="l03404"></a>03404     <span class="keywordflow">else</span> {
<a name="l03405"></a>03405         <span class="keywordtype">float</span> dvec[3];
<a name="l03406"></a>03406 
<a name="l03407"></a>03407         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(dvec, vec);
<a name="l03408"></a>03408         <a class="code" href="../../d8/d27/transform_8c.html#aa4c74f319c54fa9d81e08a1f3b707c24">applyAspectRatio</a>(t, dvec);
<a name="l03409"></a>03409 
<a name="l03410"></a>03410         dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(vec);
<a name="l03411"></a>03411         <span class="keywordflow">if</span> (!(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>) &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>) {
<a name="l03412"></a>03412             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, do_split= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a712401d436782196ec57ac7403e3acec">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a20c7f8b1b0fa45b52b8fba9094c9cab8">USER_UNIT_OPT_SPLIT</a> ? 1:0;
<a name="l03413"></a>03413 
<a name="l03414"></a>03414             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
<a name="l03415"></a>03415                 <a class="code" href="../../dd/d47/BKE__unit_8h.html#ab08be762576ac9db1443315105ccf396">bUnit_AsString</a>(&amp;tvec[i*20], 20, dvec[i]*t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a>, 4, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>, <a class="code" href="../../dd/d47/BKE__unit_8h.html#a4779c1dd27e30d714b820dfc6adfb66b">B_UNIT_LENGTH</a>, do_split, 1);
<a name="l03416"></a>03416         }
<a name="l03417"></a>03417         <span class="keywordflow">else</span> {
<a name="l03418"></a>03418             sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%.4f&quot;</span>, dvec[0]);
<a name="l03419"></a>03419             sprintf(&amp;tvec[20], <span class="stringliteral">&quot;%.4f&quot;</span>, dvec[1]);
<a name="l03420"></a>03420             sprintf(&amp;tvec[40], <span class="stringliteral">&quot;%.4f&quot;</span>, dvec[2]);
<a name="l03421"></a>03421         }
<a name="l03422"></a>03422     }
<a name="l03423"></a>03423 
<a name="l03424"></a>03424     <span class="keywordflow">if</span> (!(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>) &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>)
<a name="l03425"></a>03425         <a class="code" href="../../dd/d47/BKE__unit_8h.html#ab08be762576ac9db1443315105ccf396">bUnit_AsString</a>(distvec, <span class="keyword">sizeof</span>(distvec), dist*t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a>, 4, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>, <a class="code" href="../../dd/d47/BKE__unit_8h.html#a4779c1dd27e30d714b820dfc6adfb66b">B_UNIT_LENGTH</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a712401d436782196ec57ac7403e3acec">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a20c7f8b1b0fa45b52b8fba9094c9cab8">USER_UNIT_OPT_SPLIT</a>, 0);
<a name="l03426"></a>03426     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( dist &gt; 1e10f || dist &lt; -1e10f )   <span class="comment">/* prevent string buffer overflow */</span>
<a name="l03427"></a>03427         sprintf(distvec, <span class="stringliteral">&quot;%.4e&quot;</span>, dist);
<a name="l03428"></a>03428     <span class="keywordflow">else</span>
<a name="l03429"></a>03429         sprintf(distvec, <span class="stringliteral">&quot;%.4f&quot;</span>, dist);
<a name="l03430"></a>03430 
<a name="l03431"></a>03431     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab2bc160056f077a7f09a10a00cf9c07">T_AUTOIK</a>) {
<a name="l03432"></a>03432         <span class="keywordtype">short</span> chainlen= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a028ef4069c952a4242cbda17cd0992d5">settings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aecc64dc09cfd7d8ad1df522e4648ab11">autoik_chainlen</a>;
<a name="l03433"></a>03433 
<a name="l03434"></a>03434         <span class="keywordflow">if</span> (chainlen)
<a name="l03435"></a>03435             sprintf(autoik, <span class="stringliteral">&quot;AutoIK-Len: %d&quot;</span>, chainlen);
<a name="l03436"></a>03436         <span class="keywordflow">else</span>
<a name="l03437"></a>03437             autoik[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l03438"></a>03438     }
<a name="l03439"></a>03439     <span class="keywordflow">else</span>
<a name="l03440"></a>03440         autoik[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l03441"></a>03441 
<a name="l03442"></a>03442     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l03443"></a>03443         <span class="keywordflow">switch</span>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a>) {
<a name="l03444"></a>03444         <span class="keywordflow">case</span> 0:
<a name="l03445"></a>03445             spos += sprintf(spos, <span class="stringliteral">&quot;D: %s (%s)%s %s  %s&quot;</span>, &amp;tvec[0], distvec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>, &amp;autoik[0]);
<a name="l03446"></a>03446             <span class="keywordflow">break</span>;
<a name="l03447"></a>03447         <span class="keywordflow">case</span> 1:
<a name="l03448"></a>03448             spos += sprintf(spos, <span class="stringliteral">&quot;D: %s   D: %s (%s)%s %s  %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], distvec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>, &amp;autoik[0]);
<a name="l03449"></a>03449             <span class="keywordflow">break</span>;
<a name="l03450"></a>03450         <span class="keywordflow">case</span> 2:
<a name="l03451"></a>03451             spos += sprintf(spos, <span class="stringliteral">&quot;D: %s   D: %s  D: %s (%s)%s %s  %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], &amp;tvec[40], distvec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>, &amp;autoik[0]);
<a name="l03452"></a>03452         }
<a name="l03453"></a>03453     }
<a name="l03454"></a>03454     <span class="keywordflow">else</span> {
<a name="l03455"></a>03455         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>)
<a name="l03456"></a>03456             spos += sprintf(spos, <span class="stringliteral">&quot;Dx: %s   Dy: %s (%s)%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], distvec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03457"></a>03457         <span class="keywordflow">else</span>
<a name="l03458"></a>03458             spos += sprintf(spos, <span class="stringliteral">&quot;Dx: %s   Dy: %s  Dz: %s (%s)%s %s  %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], &amp;tvec[40], distvec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>, &amp;autoik[0]);
<a name="l03459"></a>03459     }
<a name="l03460"></a>03460     
<a name="l03461"></a>03461     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#a8aec81a91aedfb0ec425f1e9c41da2a2">T_PROP_EDIT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a04a255482ff8afe45ce0602b179a9e04">T_PROP_CONNECTED</a>)) {
<a name="l03462"></a>03462         spos += sprintf(spos, <span class="stringliteral">&quot; Proportional size: %.2f&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4faad83488dc6b4c5360aa91e9b35885">prop_size</a>);
<a name="l03463"></a>03463     }
<a name="l03464"></a>03464     (void)spos;
<a name="l03465"></a>03465 }
<a name="l03466"></a>03466 
<a name="l03467"></a><a class="code" href="../../d8/d27/transform_8c.html#a32e66fef711a65a46274bdc002688126">03467</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a32e66fef711a65a46274bdc002688126">applyTranslation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> vec[3])
<a name="l03468"></a>03468 {
<a name="l03469"></a>03469     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03470"></a>03470     <span class="keywordtype">float</span> tvec[3];
<a name="l03471"></a>03471     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03472"></a>03472 
<a name="l03473"></a>03473     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03474"></a>03474         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03475"></a>03475             <span class="keywordflow">break</span>;
<a name="l03476"></a>03476         
<a name="l03477"></a>03477         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03478"></a>03478             <span class="keywordflow">continue</span>;
<a name="l03479"></a>03479         
<a name="l03480"></a>03480         <span class="comment">/* handle snapping rotation before doing the translation */</span>
<a name="l03481"></a>03481         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d80/transform_8h.html#af9056bbc363d6f96ec806e4e778a1915">usingSnappingNormal</a>(t)) {
<a name="l03482"></a>03482             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d80/transform_8h.html#a07755415ce0a1fc12fe2c9f379714018">validSnappingNormal</a>(t)) {
<a name="l03483"></a>03483                 <span class="keywordtype">float</span> *original_normal = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>[2];
<a name="l03484"></a>03484                 <span class="keywordtype">float</span> axis[3];
<a name="l03485"></a>03485                 <span class="keywordtype">float</span> quat[4];
<a name="l03486"></a>03486                 <span class="keywordtype">float</span> mat[3][3];
<a name="l03487"></a>03487                 <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l03488"></a>03488                 
<a name="l03489"></a>03489                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(axis, original_normal, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6b095e2878426665c2a2806a267d3c30">tsnap</a>.<a class="code" href="../../db/dff/structTransSnap.html#a289dd16440b0bf0e30f652f56bfe41ae">snapNormal</a>);
<a name="l03490"></a>03490                 angle = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a0b0ac0cef781c9d0eb9e57e3702f76db">saacos</a>(<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(original_normal, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6b095e2878426665c2a2806a267d3c30">tsnap</a>.<a class="code" href="../../db/dff/structTransSnap.html#a289dd16440b0bf0e30f652f56bfe41ae">snapNormal</a>));
<a name="l03491"></a>03491                 
<a name="l03492"></a>03492                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(quat, axis, angle);
<a name="l03493"></a>03493                 
<a name="l03494"></a>03494                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ae0343d0ff2af81f054d3916277409507">quat_to_mat3</a>( mat,quat);
<a name="l03495"></a>03495                 
<a name="l03496"></a>03496                 <a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">ElementRotation</a>(t, td, mat, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5e37cb5cb6e4bc87eaffb8a738f79c91">V3D_LOCAL</a>);
<a name="l03497"></a>03497             }
<a name="l03498"></a>03498             <span class="keywordflow">else</span> {
<a name="l03499"></a>03499                 <span class="keywordtype">float</span> mat[3][3];
<a name="l03500"></a>03500                 
<a name="l03501"></a>03501                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(mat);
<a name="l03502"></a>03502                 
<a name="l03503"></a>03503                 <a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">ElementRotation</a>(t, td, mat, <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5e37cb5cb6e4bc87eaffb8a738f79c91">V3D_LOCAL</a>);
<a name="l03504"></a>03504             }
<a name="l03505"></a>03505         }
<a name="l03506"></a>03506         
<a name="l03507"></a>03507         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a1836b66b0b71ca0acc31ef2255cc266c">applyVec</a>) {
<a name="l03508"></a>03508             <span class="keywordtype">float</span> pvec[3];
<a name="l03509"></a>03509             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a1836b66b0b71ca0acc31ef2255cc266c">applyVec</a>(t, td, vec, tvec, pvec);
<a name="l03510"></a>03510         }
<a name="l03511"></a>03511         <span class="keywordflow">else</span> {
<a name="l03512"></a>03512             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(tvec, vec);
<a name="l03513"></a>03513         }
<a name="l03514"></a>03514         
<a name="l03515"></a>03515         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, tvec);
<a name="l03516"></a>03516         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(tvec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l03517"></a>03517         
<a name="l03518"></a>03518         <a class="code" href="../../d8/d27/transform_8c.html#a7dd6714f83ace23c17d606792f56af85">protectedTransBits</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a2ca379cb716bc3f4f30978168cb453ec">protectflag</a>, tvec);
<a name="l03519"></a>03519         
<a name="l03520"></a>03520         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>)
<a name="l03521"></a>03521             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, tvec);
<a name="l03522"></a>03522         
<a name="l03523"></a>03523         <a class="code" href="../../d8/d27/transform_8c.html#a1c9d744099e6fdc3a4b84e9d2f804d28">constraintTransLim</a>(t, td);
<a name="l03524"></a>03524     }
<a name="l03525"></a>03525 }
<a name="l03526"></a>03526 
<a name="l03527"></a>03527 <span class="comment">/* uses t-&gt;vec to store actual translation in */</span>
<a name="l03528"></a><a class="code" href="../../d8/d27/transform_8c.html#acb82f96e2666723b581caf75c103db1e">03528</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#acb82f96e2666723b581caf75c103db1e">Translation</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03529"></a>03529 {
<a name="l03530"></a>03530     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[250];
<a name="l03531"></a>03531 
<a name="l03532"></a>03532     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l03533"></a>03533         <span class="keywordtype">float</span> pvec[3] = {0.0f, 0.0f, 0.0f};
<a name="l03534"></a>03534         <span class="keywordtype">float</span> tvec[3];
<a name="l03535"></a>03535         <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03536"></a>03536             <a class="code" href="../../d8/d27/transform_8c.html#a33b82d9fef7a019051c5cdee843ce919">removeAspectRatio</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03537"></a>03537         }
<a name="l03538"></a>03538         <a class="code" href="../../d2/d80/transform_8h.html#a11dd25226a3aa484eedc0790bf8c4456">applySnapping</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03539"></a>03539         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a1836b66b0b71ca0acc31ef2255cc266c">applyVec</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, tvec, pvec);
<a name="l03540"></a>03540         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, tvec);
<a name="l03541"></a>03541         <a class="code" href="../../d8/d27/transform_8c.html#a9979ee47787a11d3a17b523cf37e4f2a">headerTranslation</a>(t, pvec, str);
<a name="l03542"></a>03542     }
<a name="l03543"></a>03543     <span class="keywordflow">else</span> {
<a name="l03544"></a>03544         <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03545"></a>03545         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03546"></a>03546         <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03547"></a>03547             <a class="code" href="../../d8/d27/transform_8c.html#a33b82d9fef7a019051c5cdee843ce919">removeAspectRatio</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03548"></a>03548         }
<a name="l03549"></a>03549         <a class="code" href="../../d2/d80/transform_8h.html#a11dd25226a3aa484eedc0790bf8c4456">applySnapping</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03550"></a>03550         <a class="code" href="../../d8/d27/transform_8c.html#a9979ee47787a11d3a17b523cf37e4f2a">headerTranslation</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, str);
<a name="l03551"></a>03551     }
<a name="l03552"></a>03552 
<a name="l03553"></a>03553     <a class="code" href="../../d8/d27/transform_8c.html#a32e66fef711a65a46274bdc002688126">applyTranslation</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03554"></a>03554 
<a name="l03555"></a>03555     <span class="comment">/* evil hack - redo translation if clipping needed */</span>
<a name="l03556"></a>03556     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ac06b6fabff39b7c4e6ec02f5ee22b005">T_CLIP_UV</a> &amp;&amp; <a class="code" href="../../d2/d80/transform_8h.html#a2653bdd7248c118c6e44868b4060c1fd">clipUVTransform</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, 0))
<a name="l03557"></a>03557         <a class="code" href="../../d8/d27/transform_8c.html#a32e66fef711a65a46274bdc002688126">applyTranslation</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l03558"></a>03558 
<a name="l03559"></a>03559     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03560"></a>03560 
<a name="l03561"></a>03561     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03562"></a>03562 
<a name="l03563"></a>03563     <span class="keywordflow">return</span> 1;
<a name="l03564"></a>03564 }
<a name="l03565"></a>03565 
<a name="l03566"></a>03566 <span class="comment">/* ************************** SHRINK/FATTEN *************************** */</span>
<a name="l03567"></a>03567 
<a name="l03568"></a><a class="code" href="../../d2/d80/transform_8h.html#aa43c3f0349a06ef13264e13911f762ad">03568</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aa43c3f0349a06ef13264e13911f762ad">initShrinkFatten</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03569"></a>03569 {
<a name="l03570"></a>03570     <span class="comment">// If not in mesh edit mode, fallback to Resize</span>
<a name="l03571"></a>03571     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l03572"></a>03572         <a class="code" href="../../d8/d27/transform_8c.html#a07a126d25aafc67aae1b520d37d4b656">initResize</a>(t);
<a name="l03573"></a>03573     }
<a name="l03574"></a>03574     <span class="keywordflow">else</span> {
<a name="l03575"></a>03575         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a191c2991f97ac68b33be89878cd8d86f">TFM_SHRINKFATTEN</a>;
<a name="l03576"></a>03576         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#aeb7d39aa6f662c9bf5ee5cad685f6839">ShrinkFatten</a>;
<a name="l03577"></a>03577 
<a name="l03578"></a>03578         <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a38c8b680b9828bf1ebdf8388ed6cbc3d">INPUT_VERTICAL_ABSOLUTE</a>);
<a name="l03579"></a>03579 
<a name="l03580"></a>03580         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l03581"></a>03581         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l03582"></a>03582         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03583"></a>03583         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 1.0f;
<a name="l03584"></a>03584         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l03585"></a>03585 
<a name="l03586"></a>03586         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03587"></a>03587 
<a name="l03588"></a>03588         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l03589"></a>03589     }
<a name="l03590"></a>03590 }
<a name="l03591"></a>03591 
<a name="l03592"></a>03592 
<a name="l03593"></a>03593 
<a name="l03594"></a><a class="code" href="../../d8/d27/transform_8c.html#aeb7d39aa6f662c9bf5ee5cad685f6839">03594</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#aeb7d39aa6f662c9bf5ee5cad685f6839">ShrinkFatten</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03595"></a>03595 {
<a name="l03596"></a>03596     <span class="keywordtype">float</span> vec[3];
<a name="l03597"></a>03597     <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l03598"></a>03598     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03599"></a>03599     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[64];
<a name="l03600"></a>03600     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03601"></a>03601 
<a name="l03602"></a>03602     distance = -t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l03603"></a>03603 
<a name="l03604"></a>03604     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;distance);
<a name="l03605"></a>03605 
<a name="l03606"></a>03606     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;distance);
<a name="l03607"></a>03607 
<a name="l03608"></a>03608     <span class="comment">/* header print for NumInput */</span>
<a name="l03609"></a>03609     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03610"></a>03610         <span class="keywordtype">char</span> c[20];
<a name="l03611"></a>03611 
<a name="l03612"></a>03612         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03613"></a>03613 
<a name="l03614"></a>03614         sprintf(str, <span class="stringliteral">&quot;Shrink/Fatten: %s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03615"></a>03615     }
<a name="l03616"></a>03616     <span class="keywordflow">else</span> {
<a name="l03617"></a>03617         <span class="comment">/* default header print */</span>
<a name="l03618"></a>03618         sprintf(str, <span class="stringliteral">&quot;Shrink/Fatten: %.4f %s&quot;</span>, distance, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03619"></a>03619     }
<a name="l03620"></a>03620 
<a name="l03621"></a>03621     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l03622"></a>03622 
<a name="l03623"></a>03623     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03624"></a>03624         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03625"></a>03625             <span class="keywordflow">break</span>;
<a name="l03626"></a>03626 
<a name="l03627"></a>03627         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03628"></a>03628             <span class="keywordflow">continue</span>;
<a name="l03629"></a>03629 
<a name="l03630"></a>03630         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>[2]);
<a name="l03631"></a>03631         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, distance);
<a name="l03632"></a>03632         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l03633"></a>03633 
<a name="l03634"></a>03634         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l03635"></a>03635     }
<a name="l03636"></a>03636 
<a name="l03637"></a>03637     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03638"></a>03638 
<a name="l03639"></a>03639     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03640"></a>03640 
<a name="l03641"></a>03641     <span class="keywordflow">return</span> 1;
<a name="l03642"></a>03642 }
<a name="l03643"></a>03643 
<a name="l03644"></a>03644 <span class="comment">/* ************************** TILT *************************** */</span>
<a name="l03645"></a>03645 
<a name="l03646"></a><a class="code" href="../../d2/d80/transform_8h.html#a91d0de62670dd363356c3f7bd1b3139c">03646</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a91d0de62670dd363356c3f7bd1b3139c">initTilt</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03647"></a>03647 {
<a name="l03648"></a>03648     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a8d6349d11b4188bf4d957c10e451a8bd">TFM_TILT</a>;
<a name="l03649"></a>03649     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#aad89724dc63b017fdba8c48fe91dc818">Tilt</a>;
<a name="l03650"></a>03650 
<a name="l03651"></a>03651     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717adb08b6b8c2e8258d470aa8a584ef8dc2">INPUT_ANGLE</a>);
<a name="l03652"></a>03652 
<a name="l03653"></a>03653     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l03654"></a>03654     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l03655"></a>03655     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03656"></a>03656     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = (float)((5.0/180)*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l03657"></a>03657     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.2f;
<a name="l03658"></a>03658 
<a name="l03659"></a>03659     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03660"></a>03660 
<a name="l03661"></a>03661     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a1990c83884ffae79ea451e8449fbd447">T_NO_PROJECT</a>;
<a name="l03662"></a>03662 }
<a name="l03663"></a>03663 
<a name="l03664"></a>03664 
<a name="l03665"></a>03665 
<a name="l03666"></a><a class="code" href="../../d8/d27/transform_8c.html#aad89724dc63b017fdba8c48fe91dc818">03666</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#aad89724dc63b017fdba8c48fe91dc818">Tilt</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03667"></a>03667 {
<a name="l03668"></a>03668     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03669"></a>03669     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03670"></a>03670     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l03671"></a>03671 
<a name="l03672"></a>03672     <span class="keywordtype">float</span> <span class="keyword">final</span>;
<a name="l03673"></a>03673 
<a name="l03674"></a>03674     <span class="keyword">final</span> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l03675"></a>03675 
<a name="l03676"></a>03676     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;<span class="keyword">final</span>);
<a name="l03677"></a>03677 
<a name="l03678"></a>03678     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03679"></a>03679         <span class="keywordtype">char</span> c[20];
<a name="l03680"></a>03680 
<a name="l03681"></a>03681         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;<span class="keyword">final</span>);
<a name="l03682"></a>03682 
<a name="l03683"></a>03683         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03684"></a>03684 
<a name="l03685"></a>03685         sprintf(str, <span class="stringliteral">&quot;Tilt: %s %s&quot;</span>, &amp;c[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03686"></a>03686 
<a name="l03687"></a>03687         <span class="keyword">final</span> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(<span class="keyword">final</span>);
<a name="l03688"></a>03688     }
<a name="l03689"></a>03689     <span class="keywordflow">else</span> {
<a name="l03690"></a>03690         sprintf(str, <span class="stringliteral">&quot;Tilt: %.2f %s&quot;</span>, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<span class="keyword">final</span>), t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03691"></a>03691     }
<a name="l03692"></a>03692 
<a name="l03693"></a>03693     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03694"></a>03694         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03695"></a>03695             <span class="keywordflow">break</span>;
<a name="l03696"></a>03696 
<a name="l03697"></a>03697         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03698"></a>03698             <span class="keywordflow">continue</span>;
<a name="l03699"></a>03699 
<a name="l03700"></a>03700         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) {
<a name="l03701"></a>03701             *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> + <span class="keyword">final</span> * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>;
<a name="l03702"></a>03702         }
<a name="l03703"></a>03703     }
<a name="l03704"></a>03704 
<a name="l03705"></a>03705     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03706"></a>03706 
<a name="l03707"></a>03707     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03708"></a>03708 
<a name="l03709"></a>03709     <span class="keywordflow">return</span> 1;
<a name="l03710"></a>03710 }
<a name="l03711"></a>03711 
<a name="l03712"></a>03712 
<a name="l03713"></a>03713 <span class="comment">/* ******************** Curve Shrink/Fatten *************** */</span>
<a name="l03714"></a>03714 
<a name="l03715"></a><a class="code" href="../../d2/d80/transform_8h.html#a735b795c4ed02759da1de006f8ef1730">03715</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a735b795c4ed02759da1de006f8ef1730">initCurveShrinkFatten</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03716"></a>03716 {
<a name="l03717"></a>03717     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a837dbbd86a29c6809df24fd80f59cd6e">TFM_CURVE_SHRINKFATTEN</a>;
<a name="l03718"></a>03718     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a83c1adb4f4887f5ea5fb37a7a7989fee">CurveShrinkFatten</a>;
<a name="l03719"></a>03719 
<a name="l03720"></a>03720     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a5b42afa90afd26c0413c018bf3402821">INPUT_SPRING</a>);
<a name="l03721"></a>03721 
<a name="l03722"></a>03722     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l03723"></a>03723     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l03724"></a>03724     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03725"></a>03725     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l03726"></a>03726     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l03727"></a>03727 
<a name="l03728"></a>03728     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03729"></a>03729 
<a name="l03730"></a>03730     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a15ccdebb168cc175d28e714d88d1aac1">T_NO_ZERO</a>;
<a name="l03731"></a>03731     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a77106b4c3fc9144e9f2f6465211f79c6">NUM_NO_ZERO</a>;
<a name="l03732"></a>03732 
<a name="l03733"></a>03733     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l03734"></a>03734 }
<a name="l03735"></a>03735 
<a name="l03736"></a><a class="code" href="../../d8/d27/transform_8c.html#a83c1adb4f4887f5ea5fb37a7a7989fee">03736</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a83c1adb4f4887f5ea5fb37a7a7989fee">CurveShrinkFatten</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03737"></a>03737 {
<a name="l03738"></a>03738     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03739"></a>03739     <span class="keywordtype">float</span> ratio;
<a name="l03740"></a>03740     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03741"></a>03741     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l03742"></a>03742 
<a name="l03743"></a>03743     ratio = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l03744"></a>03744 
<a name="l03745"></a>03745     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;ratio);
<a name="l03746"></a>03746 
<a name="l03747"></a>03747     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;ratio);
<a name="l03748"></a>03748 
<a name="l03749"></a>03749     <span class="comment">/* header print for NumInput */</span>
<a name="l03750"></a>03750     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03751"></a>03751         <span class="keywordtype">char</span> c[20];
<a name="l03752"></a>03752 
<a name="l03753"></a>03753         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03754"></a>03754         sprintf(str, <span class="stringliteral">&quot;Shrink/Fatten: %s&quot;</span>, c);
<a name="l03755"></a>03755     }
<a name="l03756"></a>03756     <span class="keywordflow">else</span> {
<a name="l03757"></a>03757         sprintf(str, <span class="stringliteral">&quot;Shrink/Fatten: %3f&quot;</span>, ratio);
<a name="l03758"></a>03758     }
<a name="l03759"></a>03759 
<a name="l03760"></a>03760     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03761"></a>03761         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03762"></a>03762             <span class="keywordflow">break</span>;
<a name="l03763"></a>03763 
<a name="l03764"></a>03764         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03765"></a>03765             <span class="keywordflow">continue</span>;
<a name="l03766"></a>03766 
<a name="l03767"></a>03767         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) {
<a name="l03768"></a>03768             <span class="comment">// *td-&gt;val= ratio;</span>
<a name="l03769"></a>03769             *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>= td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>*ratio;
<a name="l03770"></a>03770             <span class="keywordflow">if</span> (*td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &lt;= 0.0f) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = 0.001f;
<a name="l03771"></a>03771         }
<a name="l03772"></a>03772     }
<a name="l03773"></a>03773 
<a name="l03774"></a>03774     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03775"></a>03775 
<a name="l03776"></a>03776     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03777"></a>03777 
<a name="l03778"></a>03778     <span class="keywordflow">return</span> 1;
<a name="l03779"></a>03779 }
<a name="l03780"></a>03780 
<a name="l03781"></a>03781 <span class="comment">/* ************************** PUSH/PULL *************************** */</span>
<a name="l03782"></a>03782 
<a name="l03783"></a><a class="code" href="../../d2/d80/transform_8h.html#a036b4f8336d693b469dd0ea8aa95b82d">03783</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a036b4f8336d693b469dd0ea8aa95b82d">initPushPull</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03784"></a>03784 {
<a name="l03785"></a>03785     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84addf8f91b42daedefc3789151d2d14b14">TFM_PUSHPULL</a>;
<a name="l03786"></a>03786     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#afd9d5dfd02e7e120f7e6c725a2371d69">PushPull</a>;
<a name="l03787"></a>03787 
<a name="l03788"></a>03788     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a38c8b680b9828bf1ebdf8388ed6cbc3d">INPUT_VERTICAL_ABSOLUTE</a>);
<a name="l03789"></a>03789 
<a name="l03790"></a>03790     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l03791"></a>03791     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l03792"></a>03792     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03793"></a>03793     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 1.0f;
<a name="l03794"></a>03794     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l03795"></a>03795 
<a name="l03796"></a>03796     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03797"></a>03797 }
<a name="l03798"></a>03798 
<a name="l03799"></a>03799 
<a name="l03800"></a><a class="code" href="../../d8/d27/transform_8c.html#afd9d5dfd02e7e120f7e6c725a2371d69">03800</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#afd9d5dfd02e7e120f7e6c725a2371d69">PushPull</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03801"></a>03801 {
<a name="l03802"></a>03802     <span class="keywordtype">float</span> vec[3], axis[3];
<a name="l03803"></a>03803     <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l03804"></a>03804     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03805"></a>03805     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[128];
<a name="l03806"></a>03806     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03807"></a>03807 
<a name="l03808"></a>03808     distance = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l03809"></a>03809 
<a name="l03810"></a>03810     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;distance);
<a name="l03811"></a>03811 
<a name="l03812"></a>03812     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;distance);
<a name="l03813"></a>03813 
<a name="l03814"></a>03814     <span class="comment">/* header print for NumInput */</span>
<a name="l03815"></a>03815     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03816"></a>03816         <span class="keywordtype">char</span> c[20];
<a name="l03817"></a>03817 
<a name="l03818"></a>03818         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03819"></a>03819 
<a name="l03820"></a>03820         sprintf(str, <span class="stringliteral">&quot;Push/Pull: %s%s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03821"></a>03821     }
<a name="l03822"></a>03822     <span class="keywordflow">else</span> {
<a name="l03823"></a>03823         <span class="comment">/* default header print */</span>
<a name="l03824"></a>03824         sprintf(str, <span class="stringliteral">&quot;Push/Pull: %.4f%s %s&quot;</span>, distance, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l03825"></a>03825     }
<a name="l03826"></a>03826 
<a name="l03827"></a>03827     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l03828"></a>03828 
<a name="l03829"></a>03829     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l03830"></a>03830         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, axis, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03831"></a>03831     }
<a name="l03832"></a>03832 
<a name="l03833"></a>03833     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03834"></a>03834         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l03835"></a>03835             <span class="keywordflow">break</span>;
<a name="l03836"></a>03836 
<a name="l03837"></a>03837         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l03838"></a>03838             <span class="keywordflow">continue</span>;
<a name="l03839"></a>03839 
<a name="l03840"></a>03840         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l03841"></a>03841         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a> &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l03842"></a>03842             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3566387acaf08e61db7bee28ec44b310">applyRot</a>(t, td, axis, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03843"></a>03843             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d80/transform_8h.html#a58794df9f2031dcc3676e9ebea1ce714">isLockConstraint</a>(t)) {
<a name="l03844"></a>03844                 <span class="keywordtype">float</span> dvec[3];
<a name="l03845"></a>03845                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a0a8ff93b28d3d1f8e81650662fbb496d">project_v3_v3v3</a>(dvec, vec, axis);
<a name="l03846"></a>03846                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(vec, dvec);
<a name="l03847"></a>03847             }
<a name="l03848"></a>03848             <span class="keywordflow">else</span> {
<a name="l03849"></a>03849                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a0a8ff93b28d3d1f8e81650662fbb496d">project_v3_v3v3</a>(vec, vec, axis);
<a name="l03850"></a>03850             }
<a name="l03851"></a>03851         }
<a name="l03852"></a>03852         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec);
<a name="l03853"></a>03853         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, distance);
<a name="l03854"></a>03854         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l03855"></a>03855 
<a name="l03856"></a>03856         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>, vec);
<a name="l03857"></a>03857     }
<a name="l03858"></a>03858 
<a name="l03859"></a>03859     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03860"></a>03860 
<a name="l03861"></a>03861     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03862"></a>03862 
<a name="l03863"></a>03863     <span class="keywordflow">return</span> 1;
<a name="l03864"></a>03864 }
<a name="l03865"></a>03865 
<a name="l03866"></a>03866 <span class="comment">/* ************************** BEVEL **************************** */</span>
<a name="l03867"></a>03867 
<a name="l03868"></a><a class="code" href="../../d2/d80/transform_8h.html#ad9d08f67e21176f01ab2a95f205fe610">03868</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ad9d08f67e21176f01ab2a95f205fe610">initBevel</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03869"></a>03869 {
<a name="l03870"></a>03870     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a2e8777d95719cb1cfe24636ebce9b7c1">Bevel</a>;
<a name="l03871"></a>03871     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a121f0ea8f17d1530ab5031f3ae53e47b">handleEvent</a> = <a class="code" href="../../d8/d27/transform_8c.html#a0ddd47fa6c1ff1dc6bd675fcd19c3b1d">handleEventBevel</a>;
<a name="l03872"></a>03872 
<a name="l03873"></a>03873     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717abffb16375233b400cec720cd3bd0db4f">INPUT_HORIZONTAL_ABSOLUTE</a>);
<a name="l03874"></a>03874 
<a name="l03875"></a>03875     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a4a3c031c77de58b7d984fb5dfde45b46">TFM_BEVEL</a>;
<a name="l03876"></a>03876     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l03877"></a>03877     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#ae2bd11d04444099d90f9ed424e6ef1d4">NUM_NO_NEGATIVE</a>;
<a name="l03878"></a>03878 
<a name="l03879"></a>03879     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l03880"></a>03880     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l03881"></a>03881     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03882"></a>03882     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l03883"></a>03883     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l03884"></a>03884 
<a name="l03885"></a>03885     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03886"></a>03886 
<a name="l03887"></a>03887     <span class="comment">/* DON&#39;T KNOW WHY THIS IS NEEDED */</span>
<a name="l03888"></a>03888     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;imval[0] == 0 &amp;&amp; <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;imval[1] == 0) {
<a name="l03889"></a>03889         <span class="comment">/* save the initial mouse co */</span>
<a name="l03890"></a>03890         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;imval[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0];
<a name="l03891"></a>03891         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;imval[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[1];
<a name="l03892"></a>03892     }
<a name="l03893"></a>03893     <span class="keywordflow">else</span> {
<a name="l03894"></a>03894         <span class="comment">/* restore the mouse co from a previous call to initTransform() */</span>
<a name="l03895"></a>03895         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0] = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;imval[0];
<a name="l03896"></a>03896         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[1] = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;imval[1];
<a name="l03897"></a>03897     }
<a name="l03898"></a>03898 }
<a name="l03899"></a>03899 
<a name="l03900"></a><a class="code" href="../../d2/d80/transform_8h.html#a9ac13e826cb2b5129fee99bb1b419a7d">03900</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a0ddd47fa6c1ff1dc6bd675fcd19c3b1d">handleEventBevel</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03901"></a>03901 {
<a name="l03902"></a>03902     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03903"></a>03903         <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh) <span class="keywordflow">return</span> 0;
<a name="l03904"></a>03904 
<a name="l03905"></a>03905         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l03906"></a>03906         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l03907"></a>03907             <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;options ^= <a class="code" href="../../de/dc1/BKE__bmesh_8h.html#ac7d6788ec4cf4da6e9789c122df86d9a">BME_BEVEL_VERT</a>;
<a name="l03908"></a>03908             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l03909"></a>03909             <span class="keywordflow">return</span> 1;
<a name="l03910"></a>03910         <span class="comment">//case PADPLUSKEY:</span>
<a name="l03911"></a>03911         <span class="comment">//  G.editBMesh-&gt;options ^= BME_BEVEL_RES;</span>
<a name="l03912"></a>03912         <span class="comment">//  G.editBMesh-&gt;res += 1;</span>
<a name="l03913"></a>03913         <span class="comment">//  if (G.editBMesh-&gt;res &gt; 4) {</span>
<a name="l03914"></a>03914         <span class="comment">//      G.editBMesh-&gt;res = 4;</span>
<a name="l03915"></a>03915         <span class="comment">//  }</span>
<a name="l03916"></a>03916         <span class="comment">//  t-&gt;state = TRANS_CANCEL;</span>
<a name="l03917"></a>03917         <span class="comment">//  return 1;</span>
<a name="l03918"></a>03918         <span class="comment">//case PADMINUS:</span>
<a name="l03919"></a>03919         <span class="comment">//  G.editBMesh-&gt;options ^= BME_BEVEL_RES;</span>
<a name="l03920"></a>03920         <span class="comment">//  G.editBMesh-&gt;res -= 1;</span>
<a name="l03921"></a>03921         <span class="comment">//  if (G.editBMesh-&gt;res &lt; 0) {</span>
<a name="l03922"></a>03922         <span class="comment">//      G.editBMesh-&gt;res = 0;</span>
<a name="l03923"></a>03923         <span class="comment">//  }</span>
<a name="l03924"></a>03924         <span class="comment">//  t-&gt;state = TRANS_CANCEL;</span>
<a name="l03925"></a>03925         <span class="comment">//  return 1;</span>
<a name="l03926"></a>03926         <span class="keywordflow">default</span>:
<a name="l03927"></a>03927             <span class="keywordflow">return</span> 0;
<a name="l03928"></a>03928         }
<a name="l03929"></a>03929     }
<a name="l03930"></a>03930     <span class="keywordflow">return</span> 0;
<a name="l03931"></a>03931 }
<a name="l03932"></a>03932 
<a name="l03933"></a><a class="code" href="../../d8/d27/transform_8c.html#a2e8777d95719cb1cfe24636ebce9b7c1">03933</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a2e8777d95719cb1cfe24636ebce9b7c1">Bevel</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l03934"></a>03934 {
<a name="l03935"></a>03935     <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>,d;
<a name="l03936"></a>03936     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03937"></a>03937     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[128];
<a name="l03938"></a>03938     <span class="keyword">const</span> <span class="keywordtype">char</span> *mode;
<a name="l03939"></a>03939     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l03940"></a>03940 
<a name="l03941"></a>03941     mode = (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.editBMesh-&gt;options &amp; <a class="code" href="../../de/dc1/BKE__bmesh_8h.html#ac7d6788ec4cf4da6e9789c122df86d9a">BME_BEVEL_VERT</a>) ? <span class="stringliteral">&quot;verts only&quot;</span> : <span class="stringliteral">&quot;normal&quot;</span>;
<a name="l03942"></a>03942     distance = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] / 4; <span class="comment">/* 4 just seemed a nice value to me, nothing special */</span>
<a name="l03943"></a>03943 
<a name="l03944"></a>03944     distance = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(distance);
<a name="l03945"></a>03945 
<a name="l03946"></a>03946     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;distance);
<a name="l03947"></a>03947 
<a name="l03948"></a>03948     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;distance);
<a name="l03949"></a>03949 
<a name="l03950"></a>03950     <span class="comment">/* header print for NumInput */</span>
<a name="l03951"></a>03951     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l03952"></a>03952         <span class="keywordtype">char</span> c[20];
<a name="l03953"></a>03953 
<a name="l03954"></a>03954         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l03955"></a>03955 
<a name="l03956"></a>03956         sprintf(str, <span class="stringliteral">&quot;Bevel - Dist: %s, Mode: %s (MMB to toggle))&quot;</span>, c, mode);
<a name="l03957"></a>03957     }
<a name="l03958"></a>03958     <span class="keywordflow">else</span> {
<a name="l03959"></a>03959         <span class="comment">/* default header print */</span>
<a name="l03960"></a>03960         sprintf(str, <span class="stringliteral">&quot;Bevel - Dist: %.4f, Mode: %s (MMB to toggle))&quot;</span>, distance, mode);
<a name="l03961"></a>03961     }
<a name="l03962"></a>03962 
<a name="l03963"></a>03963     <span class="keywordflow">if</span> (distance &lt; 0) distance = -<a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l03964"></a>03964     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l03965"></a>03965         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>[1][0] &gt; 0 &amp;&amp; distance &gt; td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>[1][0]) {
<a name="l03966"></a>03966             d = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>[1][0];
<a name="l03967"></a>03967         }
<a name="l03968"></a>03968         <span class="keywordflow">else</span> {
<a name="l03969"></a>03969             d = <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l03970"></a>03970         }
<a name="l03971"></a>03971         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>[0], (*td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) * d);
<a name="l03972"></a>03972     }
<a name="l03973"></a>03973 
<a name="l03974"></a>03974     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l03975"></a>03975 
<a name="l03976"></a>03976     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l03977"></a>03977 
<a name="l03978"></a>03978     <span class="keywordflow">return</span> 1;
<a name="l03979"></a>03979 }
<a name="l03980"></a>03980 
<a name="l03981"></a>03981 <span class="comment">/* ************************** BEVEL WEIGHT *************************** */</span>
<a name="l03982"></a>03982 
<a name="l03983"></a><a class="code" href="../../d2/d80/transform_8h.html#a4a543ca7efb64817582c6b509fd451fb">03983</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a4a543ca7efb64817582c6b509fd451fb">initBevelWeight</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l03984"></a>03984 {
<a name="l03985"></a>03985     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a590f4425e877e8a8b68d98ad4534f108">TFM_BWEIGHT</a>;
<a name="l03986"></a>03986     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a182c369869263e261841553998520b2a">BevelWeight</a>;
<a name="l03987"></a>03987 
<a name="l03988"></a>03988     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a5b42afa90afd26c0413c018bf3402821">INPUT_SPRING</a>);
<a name="l03989"></a>03989 
<a name="l03990"></a>03990     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l03991"></a>03991     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l03992"></a>03992     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l03993"></a>03993     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l03994"></a>03994     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l03995"></a>03995 
<a name="l03996"></a>03996     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l03997"></a>03997 
<a name="l03998"></a>03998     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a1990c83884ffae79ea451e8449fbd447">T_NO_PROJECT</a>;
<a name="l03999"></a>03999 }
<a name="l04000"></a>04000 
<a name="l04001"></a><a class="code" href="../../d8/d27/transform_8c.html#a182c369869263e261841553998520b2a">04001</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a182c369869263e261841553998520b2a">BevelWeight</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l04002"></a>04002 {
<a name="l04003"></a>04003     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l04004"></a>04004     <span class="keywordtype">float</span> weight;
<a name="l04005"></a>04005     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l04006"></a>04006     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l04007"></a>04007 
<a name="l04008"></a>04008     weight = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l04009"></a>04009 
<a name="l04010"></a>04010     weight -= 1.0f;
<a name="l04011"></a>04011     <span class="keywordflow">if</span> (weight &gt; 1.0f) weight = 1.0f;
<a name="l04012"></a>04012 
<a name="l04013"></a>04013     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;weight);
<a name="l04014"></a>04014 
<a name="l04015"></a>04015     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;weight);
<a name="l04016"></a>04016 
<a name="l04017"></a>04017     <span class="comment">/* header print for NumInput */</span>
<a name="l04018"></a>04018     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l04019"></a>04019         <span class="keywordtype">char</span> c[20];
<a name="l04020"></a>04020 
<a name="l04021"></a>04021         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l04022"></a>04022 
<a name="l04023"></a>04023         <span class="keywordflow">if</span> (weight &gt;= 0.0f)
<a name="l04024"></a>04024             sprintf(str, <span class="stringliteral">&quot;Bevel Weight: +%s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04025"></a>04025         <span class="keywordflow">else</span>
<a name="l04026"></a>04026             sprintf(str, <span class="stringliteral">&quot;Bevel Weight: %s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04027"></a>04027     }
<a name="l04028"></a>04028     <span class="keywordflow">else</span> {
<a name="l04029"></a>04029         <span class="comment">/* default header print */</span>
<a name="l04030"></a>04030         <span class="keywordflow">if</span> (weight &gt;= 0.0f)
<a name="l04031"></a>04031             sprintf(str, <span class="stringliteral">&quot;Bevel Weight: +%.3f %s&quot;</span>, weight, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04032"></a>04032         <span class="keywordflow">else</span>
<a name="l04033"></a>04033             sprintf(str, <span class="stringliteral">&quot;Bevel Weight: %.3f %s&quot;</span>, weight, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04034"></a>04034     }
<a name="l04035"></a>04035 
<a name="l04036"></a>04036     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l04037"></a>04037         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l04038"></a>04038             <span class="keywordflow">break</span>;
<a name="l04039"></a>04039 
<a name="l04040"></a>04040         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) {
<a name="l04041"></a>04041             *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> + weight * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>;
<a name="l04042"></a>04042             <span class="keywordflow">if</span> (*td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &lt; 0.0f) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = 0.0f;
<a name="l04043"></a>04043             <span class="keywordflow">if</span> (*td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &gt; 1.0f) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = 1.0f;
<a name="l04044"></a>04044         }
<a name="l04045"></a>04045     }
<a name="l04046"></a>04046 
<a name="l04047"></a>04047     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l04048"></a>04048 
<a name="l04049"></a>04049     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l04050"></a>04050 
<a name="l04051"></a>04051     <span class="keywordflow">return</span> 1;
<a name="l04052"></a>04052 }
<a name="l04053"></a>04053 
<a name="l04054"></a>04054 <span class="comment">/* ************************** CREASE *************************** */</span>
<a name="l04055"></a>04055 
<a name="l04056"></a><a class="code" href="../../d2/d80/transform_8h.html#adfba3849d89398f23123994fa6f1e413">04056</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#adfba3849d89398f23123994fa6f1e413">initCrease</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l04057"></a>04057 {
<a name="l04058"></a>04058     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a44ed7ad28b293b571e2bbeb66eaed103">TFM_CREASE</a>;
<a name="l04059"></a>04059     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a2bd510a620469da16be94fe96317f9f9">Crease</a>;
<a name="l04060"></a>04060 
<a name="l04061"></a>04061     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a5b42afa90afd26c0413c018bf3402821">INPUT_SPRING</a>);
<a name="l04062"></a>04062 
<a name="l04063"></a>04063     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l04064"></a>04064     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l04065"></a>04065     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l04066"></a>04066     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l04067"></a>04067     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l04068"></a>04068 
<a name="l04069"></a>04069     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l04070"></a>04070 
<a name="l04071"></a>04071     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a1990c83884ffae79ea451e8449fbd447">T_NO_PROJECT</a>;
<a name="l04072"></a>04072 }
<a name="l04073"></a>04073 
<a name="l04074"></a><a class="code" href="../../d8/d27/transform_8c.html#a2bd510a620469da16be94fe96317f9f9">04074</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a2bd510a620469da16be94fe96317f9f9">Crease</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l04075"></a>04075 {
<a name="l04076"></a>04076     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l04077"></a>04077     <span class="keywordtype">float</span> crease;
<a name="l04078"></a>04078     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l04079"></a>04079     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l04080"></a>04080 
<a name="l04081"></a>04081     crease = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l04082"></a>04082 
<a name="l04083"></a>04083     crease -= 1.0f;
<a name="l04084"></a>04084     <span class="keywordflow">if</span> (crease &gt; 1.0f) crease = 1.0f;
<a name="l04085"></a>04085 
<a name="l04086"></a>04086     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;crease);
<a name="l04087"></a>04087 
<a name="l04088"></a>04088     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;crease);
<a name="l04089"></a>04089 
<a name="l04090"></a>04090     <span class="comment">/* header print for NumInput */</span>
<a name="l04091"></a>04091     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l04092"></a>04092         <span class="keywordtype">char</span> c[20];
<a name="l04093"></a>04093 
<a name="l04094"></a>04094         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l04095"></a>04095 
<a name="l04096"></a>04096         <span class="keywordflow">if</span> (crease &gt;= 0.0f)
<a name="l04097"></a>04097             sprintf(str, <span class="stringliteral">&quot;Crease: +%s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04098"></a>04098         <span class="keywordflow">else</span>
<a name="l04099"></a>04099             sprintf(str, <span class="stringliteral">&quot;Crease: %s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04100"></a>04100     }
<a name="l04101"></a>04101     <span class="keywordflow">else</span> {
<a name="l04102"></a>04102         <span class="comment">/* default header print */</span>
<a name="l04103"></a>04103         <span class="keywordflow">if</span> (crease &gt;= 0.0f)
<a name="l04104"></a>04104             sprintf(str, <span class="stringliteral">&quot;Crease: +%.3f %s&quot;</span>, crease, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04105"></a>04105         <span class="keywordflow">else</span>
<a name="l04106"></a>04106             sprintf(str, <span class="stringliteral">&quot;Crease: %.3f %s&quot;</span>, crease, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04107"></a>04107     }
<a name="l04108"></a>04108 
<a name="l04109"></a>04109     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l04110"></a>04110         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l04111"></a>04111             <span class="keywordflow">break</span>;
<a name="l04112"></a>04112 
<a name="l04113"></a>04113         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l04114"></a>04114             <span class="keywordflow">continue</span>;
<a name="l04115"></a>04115 
<a name="l04116"></a>04116         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) {
<a name="l04117"></a>04117             *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> + crease * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>;
<a name="l04118"></a>04118             <span class="keywordflow">if</span> (*td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &lt; 0.0f) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = 0.0f;
<a name="l04119"></a>04119             <span class="keywordflow">if</span> (*td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &gt; 1.0f) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = 1.0f;
<a name="l04120"></a>04120         }
<a name="l04121"></a>04121     }
<a name="l04122"></a>04122 
<a name="l04123"></a>04123     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l04124"></a>04124 
<a name="l04125"></a>04125     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l04126"></a>04126 
<a name="l04127"></a>04127     <span class="keywordflow">return</span> 1;
<a name="l04128"></a>04128 }
<a name="l04129"></a>04129 
<a name="l04130"></a>04130 <span class="comment">/* ******************** EditBone (B-bone) width scaling *************** */</span>
<a name="l04131"></a>04131 
<a name="l04132"></a><a class="code" href="../../d2/d80/transform_8h.html#a24e9e16adb2237e3175bb3752d32a542">04132</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a24e9e16adb2237e3175bb3752d32a542">initBoneSize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l04133"></a>04133 {
<a name="l04134"></a>04134     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a085de28577dde02621dca82419fbe37e">TFM_BONESIZE</a>;
<a name="l04135"></a>04135     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a1712209f6a971c22f9bcaf55c102ba29">BoneSize</a>;
<a name="l04136"></a>04136 
<a name="l04137"></a>04137     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717af5a1aee27afb7eb9480efb62537b200f">INPUT_SPRING_FLIP</a>);
<a name="l04138"></a>04138 
<a name="l04139"></a>04139     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 2;
<a name="l04140"></a>04140     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 2;
<a name="l04141"></a>04141     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a5189689ce82ddb58ae0268d4ecffe392">NUM_NULL_ONE</a>;
<a name="l04142"></a>04142     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a108ce79c68b61418552662195d2f4574">NUM_AFFECT_ALL</a>;
<a name="l04143"></a>04143     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l04144"></a>04144     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l04145"></a>04145     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l04146"></a>04146 
<a name="l04147"></a>04147     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l04148"></a>04148 }
<a name="l04149"></a>04149 
<a name="l04150"></a><a class="code" href="../../d8/d27/transform_8c.html#aadeaf31ded150a6792f98bc72dcf8a0a">04150</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aadeaf31ded150a6792f98bc72dcf8a0a">headerBoneSize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> vec[3], <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l04151"></a>04151 {
<a name="l04152"></a>04152     <span class="keywordtype">char</span> tvec[60];
<a name="l04153"></a>04153     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l04154"></a>04154         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l04155"></a>04155     }
<a name="l04156"></a>04156     <span class="keywordflow">else</span> {
<a name="l04157"></a>04157         sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%.4f&quot;</span>, vec[0]);
<a name="l04158"></a>04158         sprintf(&amp;tvec[20], <span class="stringliteral">&quot;%.4f&quot;</span>, vec[1]);
<a name="l04159"></a>04159         sprintf(&amp;tvec[40], <span class="stringliteral">&quot;%.4f&quot;</span>, vec[2]);
<a name="l04160"></a>04160     }
<a name="l04161"></a>04161 
<a name="l04162"></a>04162     <span class="comment">/* hmm... perhaps the y-axis values don&#39;t need to be shown? */</span>
<a name="l04163"></a>04163     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l04164"></a>04164         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> == 0)
<a name="l04165"></a>04165             sprintf(str, <span class="stringliteral">&quot;ScaleB: %s%s %s&quot;</span>, &amp;tvec[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04166"></a>04166         <span class="keywordflow">else</span>
<a name="l04167"></a>04167             sprintf(str, <span class="stringliteral">&quot;ScaleB: %s : %s : %s%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], &amp;tvec[40], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04168"></a>04168     }
<a name="l04169"></a>04169     <span class="keywordflow">else</span> {
<a name="l04170"></a>04170         sprintf(str, <span class="stringliteral">&quot;ScaleB X: %s  Y: %s  Z: %s%s %s&quot;</span>, &amp;tvec[0], &amp;tvec[20], &amp;tvec[40], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l04171"></a>04171     }
<a name="l04172"></a>04172 }
<a name="l04173"></a>04173 
<a name="l04174"></a><a class="code" href="../../d8/d27/transform_8c.html#a504e8e447babde939dbbee16054d1d18">04174</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a504e8e447babde939dbbee16054d1d18">ElementBoneSize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td, <span class="keywordtype">float</span> mat[3][3])
<a name="l04175"></a>04175 {
<a name="l04176"></a>04176     <span class="keywordtype">float</span> tmat[3][3], smat[3][3], oldy;
<a name="l04177"></a>04177     <span class="keywordtype">float</span> sizemat[3][3];
<a name="l04178"></a>04178 
<a name="l04179"></a>04179     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(smat, mat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a80b093770603a8f81d955f710fbe58bc">mtx</a>);
<a name="l04180"></a>04180     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a08f2830dcbc5091bcbff063cb0fc3cd4">smtx</a>, smat);
<a name="l04181"></a>04181 
<a name="l04182"></a>04182     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>) {
<a name="l04183"></a>04183         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>(t, td, tmat);
<a name="l04184"></a>04184     }
<a name="l04185"></a>04185 
<a name="l04186"></a>04186     <span class="comment">/* we&#39;ve tucked the scale in loc */</span>
<a name="l04187"></a>04187     oldy= td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>[1];
<a name="l04188"></a>04188     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a32ceca78461c61d0dbda46632ccb0f8f">size_to_mat3</a>( sizemat,td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>);
<a name="l04189"></a>04189     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat, tmat, sizemat);
<a name="l04190"></a>04190     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a9ead24f03defe7d768b91d1ce11f6ea2">mat3_to_size</a>( td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>,tmat);
<a name="l04191"></a>04191     td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>[1]= oldy;
<a name="l04192"></a>04192 }
<a name="l04193"></a>04193 
<a name="l04194"></a><a class="code" href="../../d2/d80/transform_8h.html#a1712209f6a971c22f9bcaf55c102ba29">04194</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a1712209f6a971c22f9bcaf55c102ba29">BoneSize</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l04195"></a>04195 {
<a name="l04196"></a>04196     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l04197"></a>04197     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3], mat[3][3];
<a name="l04198"></a>04198     <span class="keywordtype">float</span> ratio;
<a name="l04199"></a>04199     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l04200"></a>04200     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[60];
<a name="l04201"></a>04201     
<a name="l04202"></a>04202     <span class="comment">// TRANSFORM_FIX_ME MOVE TO MOUSE INPUT</span>
<a name="l04203"></a>04203     <span class="comment">/* for manipulator, center handle, the scaling can&#39;t be done relative to center */</span>
<a name="l04204"></a>04204     <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#aab6649125ab53f55ea9674b26e23a47e">T_USES_MANIPULATOR</a>) &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a>==0) {
<a name="l04205"></a>04205         ratio = 1.0f - ((t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0] - mval[0]) + (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[1] - mval[1]))/100.0f;
<a name="l04206"></a>04206     }
<a name="l04207"></a>04207     <span class="keywordflow">else</span> {
<a name="l04208"></a>04208         ratio = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l04209"></a>04209     }
<a name="l04210"></a>04210     
<a name="l04211"></a>04211     size[0] = size[1] = size[2] = ratio;
<a name="l04212"></a>04212     
<a name="l04213"></a>04213     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, size);
<a name="l04214"></a>04214     
<a name="l04215"></a>04215     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l04216"></a>04216         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, size);
<a name="l04217"></a>04217         <a class="code" href="../../d2/d80/transform_8h.html#aa7f2dd2ccc101be762b979b81e48bef9">constraintNumInput</a>(t, size);
<a name="l04218"></a>04218     }
<a name="l04219"></a>04219     
<a name="l04220"></a>04220     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a32ceca78461c61d0dbda46632ccb0f8f">size_to_mat3</a>( mat,size);
<a name="l04221"></a>04221     
<a name="l04222"></a>04222     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>) {
<a name="l04223"></a>04223         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, mat);
<a name="l04224"></a>04224     }
<a name="l04225"></a>04225     
<a name="l04226"></a>04226     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ada2c79f2f02698e3152a1a9428e912b9">mat</a>, mat);    <span class="comment">// used in manipulator</span>
<a name="l04227"></a>04227     
<a name="l04228"></a>04228     <a class="code" href="../../d8/d27/transform_8c.html#aadeaf31ded150a6792f98bc72dcf8a0a">headerBoneSize</a>(t, size, str);
<a name="l04229"></a>04229     
<a name="l04230"></a>04230     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l04231"></a>04231         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l04232"></a>04232             <span class="keywordflow">break</span>;
<a name="l04233"></a>04233         
<a name="l04234"></a>04234         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l04235"></a>04235             <span class="keywordflow">continue</span>;
<a name="l04236"></a>04236         
<a name="l04237"></a>04237         <a class="code" href="../../d8/d27/transform_8c.html#a504e8e447babde939dbbee16054d1d18">ElementBoneSize</a>(t, td, mat);
<a name="l04238"></a>04238     }
<a name="l04239"></a>04239     
<a name="l04240"></a>04240     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l04241"></a>04241     
<a name="l04242"></a>04242     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l04243"></a>04243     
<a name="l04244"></a>04244     <span class="keywordflow">return</span> 1;
<a name="l04245"></a>04245 }
<a name="l04246"></a>04246 
<a name="l04247"></a>04247 
<a name="l04248"></a>04248 <span class="comment">/* ******************** EditBone envelope *************** */</span>
<a name="l04249"></a>04249 
<a name="l04250"></a><a class="code" href="../../d2/d80/transform_8h.html#abe3247638587346a3a06654de1ffa41c">04250</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#abe3247638587346a3a06654de1ffa41c">initBoneEnvelope</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l04251"></a>04251 {
<a name="l04252"></a>04252     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a540332390ec15a5ba7e8e4bb72112332">TFM_BONE_ENVELOPE</a>;
<a name="l04253"></a>04253     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a609273e3f259fef80936c9d63bd1e150">BoneEnvelope</a>;
<a name="l04254"></a>04254     
<a name="l04255"></a>04255     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a5b42afa90afd26c0413c018bf3402821">INPUT_SPRING</a>);
<a name="l04256"></a>04256     
<a name="l04257"></a>04257     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l04258"></a>04258     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l04259"></a>04259     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l04260"></a>04260     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l04261"></a>04261     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l04262"></a>04262     
<a name="l04263"></a>04263     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l04264"></a>04264 
<a name="l04265"></a>04265     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a1990c83884ffae79ea451e8449fbd447">T_NO_PROJECT</a>;
<a name="l04266"></a>04266 }
<a name="l04267"></a>04267 
<a name="l04268"></a><a class="code" href="../../d8/d27/transform_8c.html#a609273e3f259fef80936c9d63bd1e150">04268</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a609273e3f259fef80936c9d63bd1e150">BoneEnvelope</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l04269"></a>04269 {
<a name="l04270"></a>04270     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l04271"></a>04271     <span class="keywordtype">float</span> ratio;
<a name="l04272"></a>04272     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l04273"></a>04273     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l04274"></a>04274     
<a name="l04275"></a>04275     ratio = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l04276"></a>04276     
<a name="l04277"></a>04277     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;ratio);
<a name="l04278"></a>04278     
<a name="l04279"></a>04279     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;ratio);
<a name="l04280"></a>04280     
<a name="l04281"></a>04281     <span class="comment">/* header print for NumInput */</span>
<a name="l04282"></a>04282     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l04283"></a>04283         <span class="keywordtype">char</span> c[20];
<a name="l04284"></a>04284         
<a name="l04285"></a>04285         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l04286"></a>04286         sprintf(str, <span class="stringliteral">&quot;Envelope: %s&quot;</span>, c);
<a name="l04287"></a>04287     }
<a name="l04288"></a>04288     <span class="keywordflow">else</span> {
<a name="l04289"></a>04289         sprintf(str, <span class="stringliteral">&quot;Envelope: %3f&quot;</span>, ratio);
<a name="l04290"></a>04290     }
<a name="l04291"></a>04291     
<a name="l04292"></a>04292     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l04293"></a>04293         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l04294"></a>04294             <span class="keywordflow">break</span>;
<a name="l04295"></a>04295         
<a name="l04296"></a>04296         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l04297"></a>04297             <span class="keywordflow">continue</span>;
<a name="l04298"></a>04298         
<a name="l04299"></a>04299         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) {
<a name="l04300"></a>04300             <span class="comment">/* if the old/original value was 0.0f, then just use ratio */</span>
<a name="l04301"></a>04301             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>)
<a name="l04302"></a>04302                 *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>= td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>*ratio;
<a name="l04303"></a>04303             <span class="keywordflow">else</span>
<a name="l04304"></a>04304                 *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>= ratio;
<a name="l04305"></a>04305         }
<a name="l04306"></a>04306     }
<a name="l04307"></a>04307     
<a name="l04308"></a>04308     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l04309"></a>04309     
<a name="l04310"></a>04310     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l04311"></a>04311     
<a name="l04312"></a>04312     <span class="keywordflow">return</span> 1;
<a name="l04313"></a>04313 }
<a name="l04314"></a>04314 
<a name="l04315"></a>04315 <span class="comment">/* ********************  Edge Slide   *************** */</span>
<a name="l04316"></a><a class="code" href="../../d8/d27/transform_8c.html#a100e38d9c85803bbc9c51ae1608761d8">04316</a> <span class="keyword">static</span> <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *<a class="code" href="../../d8/d27/transform_8c.html#a100e38d9c85803bbc9c51ae1608761d8">get_other_edge</a>(<a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v, <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e)
<a name="l04317"></a>04317 {
<a name="l04318"></a>04318     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l04319"></a>04319     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e2;
<a name="l04320"></a>04320 
<a name="l04321"></a>04321     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (e2, &amp;iter, v, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fae7bcabb6ce8c89d63c863eae870b97eb">BM_EDGES_OF_VERT</a>) {
<a name="l04322"></a>04322         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e2, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) &amp;&amp; e2 != e)
<a name="l04323"></a>04323             <span class="keywordflow">return</span> e2;
<a name="l04324"></a>04324     }
<a name="l04325"></a>04325 
<a name="l04326"></a>04326     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04327"></a>04327 }
<a name="l04328"></a>04328 
<a name="l04329"></a><a class="code" href="../../d8/d27/transform_8c.html#a349ab49d654a1b10b7dbfa5a48862f21">04329</a> <span class="keyword">static</span> <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *<a class="code" href="../../d8/d27/transform_8c.html#a349ab49d654a1b10b7dbfa5a48862f21">get_next_loop</a>(<a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v, <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l,
<a name="l04330"></a>04330                              <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *olde, <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *nexte, <span class="keywordtype">float</span> vec[3])
<a name="l04331"></a>04331 {
<a name="l04332"></a>04332     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *firstl;
<a name="l04333"></a>04333     <span class="keywordtype">float</span> a[3] = {0.0<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, 0.0f, 0.0f}, n[3] = {0.0f, 0.0f, 0.0f};
<a name="l04334"></a>04334     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;
<a name="l04335"></a>04335 
<a name="l04336"></a>04336     firstl = l;
<a name="l04337"></a>04337     <span class="keywordflow">do</span> {
<a name="l04338"></a>04338         l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04339"></a>04339         <span class="keywordflow">if</span> (l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a> == l)
<a name="l04340"></a>04340             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04341"></a>04341         
<a name="l04342"></a>04342         <span class="keywordflow">if</span> (l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a> == nexte) {
<a name="l04343"></a>04343             <span class="keywordflow">if</span> (i) {
<a name="l04344"></a>04344                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(a, 1.0f / (<span class="keywordtype">float</span>)i);
<a name="l04345"></a>04345             }
<a name="l04346"></a>04346             <span class="keywordflow">else</span> {
<a name="l04347"></a>04347                 <span class="keywordtype">float</span> f1[3], f2[3], f3[3];
<a name="l04348"></a>04348 
<a name="l04349"></a>04349                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(f1, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(olde, v)-&gt;<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l04350"></a>04350                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(f2, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(nexte, v)-&gt;<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l04351"></a>04351 
<a name="l04352"></a>04352                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(f3, f1, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a9401deff8be300468964ca48850ff702">no</a>);
<a name="l04353"></a>04353                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(a, f2, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a9401deff8be300468964ca48850ff702">no</a>);
<a name="l04354"></a>04354                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(a, -1.0f);
<a name="l04355"></a>04355 
<a name="l04356"></a>04356                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(a, f3);
<a name="l04357"></a>04357                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(a, 0.5f);
<a name="l04358"></a>04358             }
<a name="l04359"></a>04359             
<a name="l04360"></a>04360             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, a);
<a name="l04361"></a>04361             <span class="keywordflow">return</span> l;
<a name="l04362"></a>04362         }
<a name="l04363"></a>04363         <span class="keywordflow">else</span> {
<a name="l04364"></a>04364             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(n, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v)-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l04365"></a>04365             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(a, a, n);
<a name="l04366"></a>04366             i += 1;
<a name="l04367"></a>04367         }
<a name="l04368"></a>04368 
<a name="l04369"></a>04369         <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v)-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a> == nexte) {
<a name="l04370"></a>04370             <span class="keywordflow">if</span> (i)
<a name="l04371"></a>04371                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(a, 1.0f / (<span class="keywordtype">float</span>)i);
<a name="l04372"></a>04372             
<a name="l04373"></a>04373             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, a);
<a name="l04374"></a>04374             <span class="keywordflow">return</span> <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04375"></a>04375         }
<a name="l04376"></a>04376         
<a name="l04377"></a>04377         l = l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>;
<a name="l04378"></a>04378     } <span class="keywordflow">while</span> (l != firstl); 
<a name="l04379"></a>04379 
<a name="l04380"></a>04380     <span class="keywordflow">if</span> (i)
<a name="l04381"></a>04381         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(a, 1.0f / (<span class="keywordtype">float</span>)i);
<a name="l04382"></a>04382     
<a name="l04383"></a>04383     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, a);
<a name="l04384"></a>04384     
<a name="l04385"></a>04385     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04386"></a>04386 }
<a name="l04387"></a>04387 
<a name="l04388"></a><a class="code" href="../../d8/d27/transform_8c.html#ae4294af26780b84abbca8ce02b0eab54">04388</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#ae4294af26780b84abbca8ce02b0eab54">createSlideVerts</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l04389"></a>04389 {
<a name="l04390"></a>04390     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04391"></a>04391     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>;
<a name="l04392"></a>04392     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l04393"></a>04393     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, iter2;
<a name="l04394"></a>04394     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e, *e1 <span class="comment">/*, *ee, *le */</span> <span class="comment">/* UNUSED */</span>;
<a name="l04395"></a>04395     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v, *v2, *first;
<a name="l04396"></a>04396     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l, *l1, *l2;
<a name="l04397"></a>04397     <a class="code" href="../../db/d31/structTransDataSlideVert.html">TransDataSlideVert</a> *sv_array;
<a name="l04398"></a>04398     <a class="code" href="../../d4/df5/structBMBVHTree.html">BMBVHTree</a> *btree = <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#a48e8437ae244ebfcff2902ddf6b4dcd4">BMBVH_NewBVH</a>(em, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04399"></a>04399     <a class="code" href="../../dc/d55/structSmallHash.html">SmallHash</a> <a class="code" href="../../d7/d35/meshtools_8c.html#ae0806484720dd424e53ea053a3cd1309">table</a>;
<a name="l04400"></a>04400     <a class="code" href="../../d0/db2/structSlideData.html">SlideData</a> *sld = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*sld), <span class="stringliteral">&quot;sld&quot;</span>);
<a name="l04401"></a>04401     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a> ? t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04402"></a>04402     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a> ? t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* background mode support */</span>
<a name="l04403"></a>04403     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#abc0cd6ba2b602243fcbdee0a4f77e3b3">ar</a>;
<a name="l04404"></a>04404     <span class="keywordtype">float</span> projectMat[4][4];
<a name="l04405"></a>04405     <span class="keywordtype">float</span> start[3] = {0.0f, 0.0f, 0.0f}, dir[3], end[3] = {0.0f, 0.0f, 0.0f};
<a name="l04406"></a>04406     <span class="keywordtype">float</span> vec[3], vec2[3], lastvec[3] <span class="comment">/*, size, dis=0.0, z */</span> <span class="comment">/* UNUSED */</span>;
<a name="l04407"></a>04407     <span class="keywordtype">int</span> numsel, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j;
<a name="l04408"></a>04408 
<a name="l04409"></a>04409     <span class="keywordflow">if</span> (!v3d) {
<a name="l04410"></a>04410         <span class="comment">/* ok, let&#39;s try to survive this */</span>
<a name="l04411"></a>04411         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(projectMat);
<a name="l04412"></a>04412     }
<a name="l04413"></a>04413     <span class="keywordflow">else</span> {
<a name="l04414"></a>04414         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a282c83136349eb4ba6c6dfb330a14440">ED_view3d_ob_project_mat_get</a>(rv3d, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>, projectMat);
<a name="l04415"></a>04415     }
<a name="l04416"></a>04416     
<a name="l04417"></a>04417     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#adb506e86ea88d91f7aa829eebe582a21">BLI_smallhash_init</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ad999075d659c36c45315e42c2736dc67">vhash</a>);
<a name="l04418"></a>04418     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#adb506e86ea88d91f7aa829eebe582a21">BLI_smallhash_init</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>);
<a name="l04419"></a>04419     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#adb506e86ea88d91f7aa829eebe582a21">BLI_smallhash_init</a>(&amp;table);
<a name="l04420"></a>04420     
<a name="l04421"></a>04421     <span class="comment">/*ensure valid selection*/</span>
<a name="l04422"></a>04422     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l04423"></a>04423         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l04424"></a>04424             numsel = 0;
<a name="l04425"></a>04425             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (e, &amp;iter2, v, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fae7bcabb6ce8c89d63c863eae870b97eb">BM_EDGES_OF_VERT</a>) {
<a name="l04426"></a>04426                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l04427"></a>04427                     <span class="comment">/* BMESH_TODO: this is probably very evil,</span>
<a name="l04428"></a>04428 <span class="comment">                     * set v-&gt;e to a selected edge*/</span>
<a name="l04429"></a>04429                     v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a8af18783bda7bed16775802118c7e642">e</a> = e;
<a name="l04430"></a>04430 
<a name="l04431"></a>04431                     numsel++;
<a name="l04432"></a>04432                 }
<a name="l04433"></a>04433             }
<a name="l04434"></a>04434 
<a name="l04435"></a>04435             <span class="keywordflow">if</span> (numsel == 0 || numsel &gt; 2) {
<a name="l04436"></a>04436                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sld);
<a name="l04437"></a>04437                 <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#abd50e6411b00a38414d8401d9d0fbdde">BMBVH_FreeBVH</a>(btree);
<a name="l04438"></a>04438                 <span class="keywordflow">return</span> 0; <span class="comment">/* invalid edge selection */</span>
<a name="l04439"></a>04439             }
<a name="l04440"></a>04440         }
<a name="l04441"></a>04441     }
<a name="l04442"></a>04442 
<a name="l04443"></a>04443     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (e, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l04444"></a>04444         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l04445"></a>04445             <span class="keywordflow">if</span> (!<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a9bad43a7121faed827bf90d7d3007be3">BM_edge_is_manifold</a>(e)) {
<a name="l04446"></a>04446                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sld);
<a name="l04447"></a>04447                 <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#abd50e6411b00a38414d8401d9d0fbdde">BMBVH_FreeBVH</a>(btree);
<a name="l04448"></a>04448                 <span class="keywordflow">return</span> 0; <span class="comment">/* can only handle exactly 2 faces around each edge */</span>
<a name="l04449"></a>04449             }
<a name="l04450"></a>04450         }
<a name="l04451"></a>04451     }
<a name="l04452"></a>04452 
<a name="l04453"></a>04453     j = 0;
<a name="l04454"></a>04454     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l04455"></a>04455         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l04456"></a>04456             <a class="code" href="../../d8/d74/bmesh__inline_8h.html#ae3e692a09518f835ef5b770ecff8acd2">BM_elem_flag_enable</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04457"></a>04457             <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a7653b1eabbbd01be256a007a7e410147">BLI_smallhash_insert</a>(&amp;table, (uintptr_t)v, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa6f58f8bcd4649b89458079eae9b1a1f">SET_INT_IN_POINTER</a>(j));
<a name="l04458"></a>04458             j += 1;
<a name="l04459"></a>04459         }
<a name="l04460"></a>04460         <span class="keywordflow">else</span> {
<a name="l04461"></a>04461             <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0d62b989e13c71d9bd5c2ae3f4477591">BM_elem_flag_disable</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04462"></a>04462         }
<a name="l04463"></a>04463     }
<a name="l04464"></a>04464 
<a name="l04465"></a>04465     <span class="keywordflow">if</span> (!j) {
<a name="l04466"></a>04466         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sld);
<a name="l04467"></a>04467         <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#abd50e6411b00a38414d8401d9d0fbdde">BMBVH_FreeBVH</a>(btree);
<a name="l04468"></a>04468         <span class="keywordflow">return</span> 0;
<a name="l04469"></a>04469     }
<a name="l04470"></a>04470 
<a name="l04471"></a>04471     sv_array = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/d31/structTransDataSlideVert.html">TransDataSlideVert</a>) * j, <span class="stringliteral">&quot;sv_array&quot;</span>);
<a name="l04472"></a>04472 
<a name="l04473"></a>04473     j = 0;
<a name="l04474"></a>04474     <span class="keywordflow">while</span> (1) {
<a name="l04475"></a>04475         v = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04476"></a>04476         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l04477"></a>04477             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>))
<a name="l04478"></a>04478                 <span class="keywordflow">break</span>;
<a name="l04479"></a>04479 
<a name="l04480"></a>04480         }
<a name="l04481"></a>04481 
<a name="l04482"></a>04482         <span class="keywordflow">if</span> (!v)
<a name="l04483"></a>04483             <span class="keywordflow">break</span>;
<a name="l04484"></a>04484 
<a name="l04485"></a>04485         <span class="keywordflow">if</span> (!v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a8af18783bda7bed16775802118c7e642">e</a>)
<a name="l04486"></a>04486             <span class="keywordflow">continue</span>;
<a name="l04487"></a>04487         
<a name="l04488"></a>04488         first = v;
<a name="l04489"></a>04489 
<a name="l04490"></a>04490         <span class="comment">/*walk along the edge loop*/</span>
<a name="l04491"></a>04491         e = v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a8af18783bda7bed16775802118c7e642">e</a>;
<a name="l04492"></a>04492 
<a name="l04493"></a>04493         <span class="comment">/*first, rewind*/</span>
<a name="l04494"></a>04494         numsel = 0;
<a name="l04495"></a>04495         <span class="keywordflow">do</span> {
<a name="l04496"></a>04496             e = <a class="code" href="../../d8/d27/transform_8c.html#a100e38d9c85803bbc9c51ae1608761d8">get_other_edge</a>(v, e);
<a name="l04497"></a>04497             <span class="keywordflow">if</span> (!e) {
<a name="l04498"></a>04498                 e = v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a8af18783bda7bed16775802118c7e642">e</a>;
<a name="l04499"></a>04499                 <span class="keywordflow">break</span>;
<a name="l04500"></a>04500             }
<a name="l04501"></a>04501 
<a name="l04502"></a>04502             numsel += 1;
<a name="l04503"></a>04503 
<a name="l04504"></a>04504             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(e, v), <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>))
<a name="l04505"></a>04505                 <span class="keywordflow">break</span>;
<a name="l04506"></a>04506 
<a name="l04507"></a>04507             v = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(e, v);
<a name="l04508"></a>04508         } <span class="keywordflow">while</span> (e != first-&gt;<a class="code" href="../../df/d18/structBMVert.html#a8af18783bda7bed16775802118c7e642">e</a>);
<a name="l04509"></a>04509 
<a name="l04510"></a>04510         <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0d62b989e13c71d9bd5c2ae3f4477591">BM_elem_flag_disable</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04511"></a>04511 
<a name="l04512"></a>04512         l1 = l2 = l = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04513"></a>04513         l1 = e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>;
<a name="l04514"></a>04514         l2 = e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>;
<a name="l04515"></a>04515 
<a name="l04516"></a>04516         l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l1-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l1-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04517"></a>04517         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v)-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l04518"></a>04518 
<a name="l04519"></a>04519         <span class="keywordflow">if</span> (l2 != l1) {
<a name="l04520"></a>04520             l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l2-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l2-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04521"></a>04521             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec2, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v)-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l04522"></a>04522         }
<a name="l04523"></a>04523         <span class="keywordflow">else</span> {
<a name="l04524"></a>04524             l2 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04525"></a>04525         }
<a name="l04526"></a>04526 
<a name="l04527"></a>04527         <span class="comment">/*iterate over the loop*/</span>
<a name="l04528"></a>04528         first = v;
<a name="l04529"></a>04529         <span class="keywordflow">do</span> {
<a name="l04530"></a>04530             <a class="code" href="../../db/d31/structTransDataSlideVert.html">TransDataSlideVert</a> *sv = sv_array + j;
<a name="l04531"></a>04531 
<a name="l04532"></a>04532             sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#af3e2c3c3da1e1a3b11817030e799f272">v</a> = v;
<a name="l04533"></a>04533             sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a3a92d312db315f6aa94923a4f8af5fe1">origvert</a> = *v;
<a name="l04534"></a>04534             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a31a56ecaaa1f5f9fceedf04d8e6f74b8">upvec</a>, vec);
<a name="l04535"></a>04535             <span class="keywordflow">if</span> (l2)
<a name="l04536"></a>04536                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a8ac8650bc16bd7442f391cf411806b0f">downvec</a>, vec2);
<a name="l04537"></a>04537 
<a name="l04538"></a>04538             l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l1-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l1-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04539"></a>04539             sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a7141f7f9553be8c31320f0837f7f1d42">up</a> = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04540"></a>04540 
<a name="l04541"></a>04541             <span class="keywordflow">if</span> (l2) {
<a name="l04542"></a>04542                 l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l2-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l2-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04543"></a>04543                 sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a537d51bd6350af7cca0d3e60c383bae0">down</a> = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04544"></a>04544             }
<a name="l04545"></a>04545 
<a name="l04546"></a>04546             v2=v, v = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(e, v);
<a name="l04547"></a>04547 
<a name="l04548"></a>04548             e1 = e;
<a name="l04549"></a>04549             e = <a class="code" href="../../d8/d27/transform_8c.html#a100e38d9c85803bbc9c51ae1608761d8">get_other_edge</a>(v, e);
<a name="l04550"></a>04550             <span class="keywordflow">if</span> (!e) {
<a name="l04551"></a>04551                 <span class="comment">//v2=v, v = BM_edge_other_vert(l1-&gt;e, v);</span>
<a name="l04552"></a>04552 
<a name="l04553"></a>04553                 sv = sv_array + j + 1;
<a name="l04554"></a>04554                 sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#af3e2c3c3da1e1a3b11817030e799f272">v</a> = v;
<a name="l04555"></a>04555                 sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a3a92d312db315f6aa94923a4f8af5fe1">origvert</a> = *v;
<a name="l04556"></a>04556                 
<a name="l04557"></a>04557                 l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l1-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l1-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04558"></a>04558                 sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a7141f7f9553be8c31320f0837f7f1d42">up</a> = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04559"></a>04559                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a31a56ecaaa1f5f9fceedf04d8e6f74b8">upvec</a>, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v)-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, v-&gt;co);
<a name="l04560"></a>04560 
<a name="l04561"></a>04561                 <span class="keywordflow">if</span> (l2) {
<a name="l04562"></a>04562                     l = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a01cc24309f04206082c6b4198d46912c" title="Other Loop in Face Sharing an Edge.">BM_face_other_edge_loop</a>(l2-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, l2-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04563"></a>04563                     sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a537d51bd6350af7cca0d3e60c383bae0">down</a> = <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v);
<a name="l04564"></a>04564                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a8ac8650bc16bd7442f391cf411806b0f">downvec</a>, <a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a6501db69bc091830bc1c0aa160502804">BM_edge_other_vert</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, v)-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, v-&gt;co);
<a name="l04565"></a>04565                 }
<a name="l04566"></a>04566 
<a name="l04567"></a>04567                 <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0d62b989e13c71d9bd5c2ae3f4477591">BM_elem_flag_disable</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04568"></a>04568                 <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0d62b989e13c71d9bd5c2ae3f4477591">BM_elem_flag_disable</a>(v2, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04569"></a>04569                 
<a name="l04570"></a>04570                 j += 2;
<a name="l04571"></a>04571                 <span class="keywordflow">break</span>;
<a name="l04572"></a>04572             }
<a name="l04573"></a>04573 
<a name="l04574"></a>04574             l1 = <a class="code" href="../../d8/d27/transform_8c.html#a349ab49d654a1b10b7dbfa5a48862f21">get_next_loop</a>(v, l1, e1, e, vec);
<a name="l04575"></a>04575             l2 = l2 ? <a class="code" href="../../d8/d27/transform_8c.html#a349ab49d654a1b10b7dbfa5a48862f21">get_next_loop</a>(v, l2, e1, e, vec2) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04576"></a>04576 
<a name="l04577"></a>04577             j += 1;
<a name="l04578"></a>04578 
<a name="l04579"></a>04579             <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0d62b989e13c71d9bd5c2ae3f4477591">BM_elem_flag_disable</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04580"></a>04580             <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0d62b989e13c71d9bd5c2ae3f4477591">BM_elem_flag_disable</a>(v2, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462ab2324d74ff6431a7851b74c3591044fb">BM_ELEM_TAG</a>);
<a name="l04581"></a>04581         } <span class="keywordflow">while</span> (e != first-&gt;<a class="code" href="../../df/d18/structBMVert.html#a8af18783bda7bed16775802118c7e642">e</a> &amp;&amp; l1);
<a name="l04582"></a>04582     }
<a name="l04583"></a>04583 
<a name="l04584"></a>04584     <span class="comment">//EDBM_flag_disable_all(em, BM_ELEM_SELECT);</span>
<a name="l04585"></a>04585 
<a name="l04586"></a>04586     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ab555da9fdba40aa2f378332895f7eb20">sv</a> = sv_array;
<a name="l04587"></a>04587     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#aec8d44c33c976c159a877f34bf30fc03">totsv</a> = j;
<a name="l04588"></a>04588     
<a name="l04589"></a>04589     <span class="comment">/*find mouse vector*/</span>
<a name="l04590"></a>04590     <span class="comment">/* dis = z = -1.0f; */</span> <span class="comment">/* UNUSED */</span>
<a name="l04591"></a>04591     <span class="comment">/* size = 50.0; */</span> <span class="comment">/* UNUSED */</span>
<a name="l04592"></a>04592     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(lastvec); <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(dir);
<a name="l04593"></a>04593     <span class="comment">/* ee = le = NULL; */</span> <span class="comment">/* UNUSED */</span>
<a name="l04594"></a>04594     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (e, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l04595"></a>04595         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l04596"></a>04596             <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter2;
<a name="l04597"></a>04597             <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e2;
<a name="l04598"></a>04598             <span class="keywordtype">float</span> vec1[3], dis2, mval[2] = {t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[1]}, d;
<a name="l04599"></a>04599                         
<a name="l04600"></a>04600             <span class="comment">/* search cross edges for visible edge to the mouse cursor,</span>
<a name="l04601"></a>04601 <span class="comment">             * then use the shared vertex to calculate screen vector*/</span>
<a name="l04602"></a>04602             dis2 = -1.0f;
<a name="l04603"></a>04603             <span class="keywordflow">for</span> (i=0; i&lt;2; i++) {
<a name="l04604"></a>04604                 v = i?e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>:e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>;
<a name="l04605"></a>04605                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (e2, &amp;iter2, v, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fae7bcabb6ce8c89d63c863eae870b97eb">BM_EDGES_OF_VERT</a>) {
<a name="l04606"></a>04606                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e2, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l04607"></a>04607                         <span class="keywordflow">continue</span>;
<a name="l04608"></a>04608                     
<a name="l04609"></a>04609                     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d90/editmesh__bvh_8c.html#a489f8a177334b1ac17b05be3013d0f49">BMBVH_EdgeVisible</a>(btree, e2, ar, v3d, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>))
<a name="l04610"></a>04610                         <span class="keywordflow">continue</span>;
<a name="l04611"></a>04611                     
<a name="l04612"></a>04612                     j = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#afe52e69b7f74d4e0319b467db917c08c">GET_INT_FROM_POINTER</a>(<a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;table, (uintptr_t)v));
<a name="l04613"></a>04613 
<a name="l04614"></a>04614                     <span class="keywordflow">if</span> (sv_array[j].down) {
<a name="l04615"></a>04615                         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a256cdf9578ebe9cce1a87158bb8ba39d">ED_view3d_project_float_v3</a>(ar, sv_array[j].down-&gt;co, vec1, projectMat);
<a name="l04616"></a>04616                     }
<a name="l04617"></a>04617                     <span class="keywordflow">else</span> {
<a name="l04618"></a>04618                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(vec1, v-&gt;co, sv_array[j].<a class="code" href="../../db/d31/structTransDataSlideVert.html#a8ac8650bc16bd7442f391cf411806b0f">downvec</a>);
<a name="l04619"></a>04619                         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a256cdf9578ebe9cce1a87158bb8ba39d">ED_view3d_project_float_v3</a>(ar, vec1, vec1, projectMat);
<a name="l04620"></a>04620                     }
<a name="l04621"></a>04621                     
<a name="l04622"></a>04622                     <span class="keywordflow">if</span> (sv_array[j].up) {
<a name="l04623"></a>04623                         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a256cdf9578ebe9cce1a87158bb8ba39d">ED_view3d_project_float_v3</a>(ar, sv_array[j].up-&gt;co, vec2, projectMat);
<a name="l04624"></a>04624                     }
<a name="l04625"></a>04625                     <span class="keywordflow">else</span> {
<a name="l04626"></a>04626                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(vec1, v-&gt;co, sv_array[j].<a class="code" href="../../db/d31/structTransDataSlideVert.html#a31a56ecaaa1f5f9fceedf04d8e6f74b8">upvec</a>);
<a name="l04627"></a>04627                         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a256cdf9578ebe9cce1a87158bb8ba39d">ED_view3d_project_float_v3</a>(ar, vec2, vec2, projectMat);
<a name="l04628"></a>04628                     }
<a name="l04629"></a>04629 
<a name="l04630"></a>04630                     d = <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#acb707a79a8f4aaebf941caec9f14725a">dist_to_line_segment_v2</a>(mval, vec1, vec2);
<a name="l04631"></a>04631                     <span class="keywordflow">if</span> (dis2 == -1.0f || d &lt; dis2) {
<a name="l04632"></a>04632                         dis2 = d;
<a name="l04633"></a>04633                         <span class="comment">/* ee = e2; */</span> <span class="comment">/* UNUSED */</span>
<a name="l04634"></a>04634                         <span class="comment">/* size = len_v3v3(vec1, vec2); */</span> <span class="comment">/* UNUSED */</span>
<a name="l04635"></a>04635                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(dir, vec1, vec2);
<a name="l04636"></a>04636                     }
<a name="l04637"></a>04637                 }
<a name="l04638"></a>04638             }
<a name="l04639"></a>04639         }
<a name="l04640"></a>04640     }
<a name="l04641"></a>04641 
<a name="l04642"></a>04642     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#a68746e93c455f1bab695793467cdbf84" title="BMesh Begin Edit.">bmesh_edit_begin</a>(bm, <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac038a1e8b1ad739c47df10a3bc02d465">BMO_OP_FLAG_UNTAN_MULTIRES</a>);
<a name="l04643"></a>04643 
<a name="l04644"></a>04644     <span class="comment">/*create copies of faces for customdata projection*/</span>
<a name="l04645"></a>04645     sv_array = sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ab555da9fdba40aa2f378332895f7eb20">sv</a>;
<a name="l04646"></a>04646     <span class="keywordflow">for</span> (i=0; i&lt;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#aec8d44c33c976c159a877f34bf30fc03">totsv</a>; i++, sv_array++) {
<a name="l04647"></a>04647         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> fiter, liter;
<a name="l04648"></a>04648         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f;
<a name="l04649"></a>04649         <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l04650"></a>04650         
<a name="l04651"></a>04651         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (f, &amp;fiter, sv_array-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#af3e2c3c3da1e1a3b11817030e799f272">v</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa37651dfdb90919510896eeccfbcc9cf4">BM_FACES_OF_VERT</a>) {
<a name="l04652"></a>04652             
<a name="l04653"></a>04653             <span class="keywordflow">if</span> (!<a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a2f3abe3f63e4d2bb67ca9546d2bb2b34">BLI_smallhash_haskey</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)f)) {
<a name="l04654"></a>04654                 <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *copyf = <a class="code" href="../../d0/de5/bmesh__core_8c.html#a97cbe02f10a3c4e448dc487d9cacefed">BM_face_copy</a>(bm, f, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04655"></a>04655                 
<a name="l04656"></a>04656                 <a class="code" href="../../d5/def/bmesh__marking_8c.html#a1fa6831f1e900dac7a2d426f3a5c1f76" title="Select Face.">BM_face_select_set</a>(bm, copyf, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l04657"></a>04657                 <a class="code" href="../../d8/d74/bmesh__inline_8h.html#ae3e692a09518f835ef5b770ecff8acd2">BM_elem_flag_enable</a>(copyf, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>);
<a name="l04658"></a>04658                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, copyf, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l04659"></a>04659                     <a class="code" href="../../d5/def/bmesh__marking_8c.html#aa30fa3c2c4755442886ab2373f3d80ac" title="Select Vert.">BM_vert_select_set</a>(bm, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l04660"></a>04660                     <a class="code" href="../../d8/d74/bmesh__inline_8h.html#ae3e692a09518f835ef5b770ecff8acd2">BM_elem_flag_enable</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>);
<a name="l04661"></a>04661                     <a class="code" href="../../d5/def/bmesh__marking_8c.html#a36117bf878409d6e7a6025d5fc7d2c50" title="Select Edge.">BM_edge_select_set</a>(bm, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l04662"></a>04662                     <a class="code" href="../../d8/d74/bmesh__inline_8h.html#ae3e692a09518f835ef5b770ecff8acd2">BM_elem_flag_enable</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>);
<a name="l04663"></a>04663                 }
<a name="l04664"></a>04664 
<a name="l04665"></a>04665                 <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a7653b1eabbbd01be256a007a7e410147">BLI_smallhash_insert</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)f, copyf);
<a name="l04666"></a>04666             }
<a name="l04667"></a>04667         }
<a name="l04668"></a>04668 
<a name="l04669"></a>04669         <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a7653b1eabbbd01be256a007a7e410147">BLI_smallhash_insert</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ad999075d659c36c45315e42c2736dc67">vhash</a>, (uintptr_t)sv_array-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#af3e2c3c3da1e1a3b11817030e799f272">v</a>, sv_array);
<a name="l04670"></a>04670     }
<a name="l04671"></a>04671     
<a name="l04672"></a>04672     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a76c0621e1693d0c63c3086c34fb7b77c">origfaces_init</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l04673"></a>04673     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#adf794e99fd704fa0e207196e21de3d99">em</a> = em;
<a name="l04674"></a>04674     
<a name="l04675"></a>04675     <span class="comment">/*zero out start*/</span>
<a name="l04676"></a>04676     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(start);
<a name="l04677"></a>04677     
<a name="l04678"></a>04678     <span class="comment">/*dir holds a vector along edge loop*/</span>
<a name="l04679"></a>04679     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(end, dir);
<a name="l04680"></a>04680     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(end, 0.5);
<a name="l04681"></a>04681     
<a name="l04682"></a>04682     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#aae0557c3862cfd353d5085c1d9c29b1c">start</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[0] + start[0];
<a name="l04683"></a>04683     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#aae0557c3862cfd353d5085c1d9c29b1c">start</a>[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[1] + start[1];
<a name="l04684"></a>04684 
<a name="l04685"></a>04685     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a14b48fc2fc4472e0d392ffb23090e7ac">end</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[0] + end[0];
<a name="l04686"></a>04686     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a14b48fc2fc4472e0d392ffb23090e7ac">end</a>[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a2024d266b0b3ddbba689808bafa40df7">mval</a>[1] + end[1];
<a name="l04687"></a>04687     
<a name="l04688"></a>04688     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ae135aebf3fbc3a76e6c4c707defde7fe">perc</a> = 0.0f;
<a name="l04689"></a>04689     
<a name="l04690"></a>04690     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> = sld;
<a name="l04691"></a>04691     
<a name="l04692"></a>04692     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#ab728193f2b04960d5cc53bc255d59193">BLI_smallhash_release</a>(&amp;table);
<a name="l04693"></a>04693     <a class="code" href="../../d4/d90/editmesh__bvh_8c.html#abd50e6411b00a38414d8401d9d0fbdde">BMBVH_FreeBVH</a>(btree);
<a name="l04694"></a>04694     
<a name="l04695"></a>04695     <span class="keywordflow">return</span> 1;
<a name="l04696"></a>04696 }
<a name="l04697"></a>04697 
<a name="l04698"></a><a class="code" href="../../d2/d80/transform_8h.html#ad1d07906f55895e997ef2a3de6d108a8">04698</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ad1d07906f55895e997ef2a3de6d108a8">projectSVData</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">int</span> <span class="keyword">final</span>)
<a name="l04699"></a>04699 {
<a name="l04700"></a>04700     <a class="code" href="../../d0/db2/structSlideData.html">SlideData</a> *sld = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>;
<a name="l04701"></a>04701     <a class="code" href="../../db/d31/structTransDataSlideVert.html">TransDataSlideVert</a> *sv;
<a name="l04702"></a>04702     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#adf794e99fd704fa0e207196e21de3d99">em</a>;
<a name="l04703"></a>04703     <a class="code" href="../../dc/d55/structSmallHash.html">SmallHash</a> visit;
<a name="l04704"></a>04704     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l04705"></a>04705 
<a name="l04706"></a>04706     <span class="keywordflow">if</span> (!em)
<a name="l04707"></a>04707         <span class="keywordflow">return</span>;
<a name="l04708"></a>04708     
<a name="l04709"></a>04709     <span class="keywordflow">if</span> (!(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a028ef4069c952a4242cbda17cd0992d5">settings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aaaa787d3689a8689c817f053d3b3e863">UVCALC_TRANSFORM_CORRECT</a>))
<a name="l04710"></a>04710         <span class="keywordflow">return</span>;
<a name="l04711"></a>04711 
<a name="l04712"></a>04712     <span class="comment">/* don&#39;t do this at all for non-basis shape keys, too easy to</span>
<a name="l04713"></a>04713 <span class="comment">     * accidentally break uv maps or vertex colors then */</span>
<a name="l04714"></a>04714     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a33e727e71ff97a478d7704fd5dbeb1b2">shapenr</a> &gt; 1)
<a name="l04715"></a>04715         <span class="keywordflow">return</span>;
<a name="l04716"></a>04716 
<a name="l04717"></a>04717     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#adb506e86ea88d91f7aa829eebe582a21">BLI_smallhash_init</a>(&amp;visit);
<a name="l04718"></a>04718     
<a name="l04719"></a>04719     <span class="keywordflow">for</span> (i=0, sv = sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ab555da9fdba40aa2f378332895f7eb20">sv</a>; i &lt; sld-&gt;totsv; sv++, i++) {
<a name="l04720"></a>04720         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> fiter;
<a name="l04721"></a>04721         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f;
<a name="l04722"></a>04722         
<a name="l04723"></a>04723 
<a name="l04724"></a>04724         <span class="comment">/* BMESH_TODO, this interpolates between vertex/loops which are not moved</span>
<a name="l04725"></a>04725 <span class="comment">         * (are only apart of a face attached to a slide vert), couldn&#39;t we iterate BM_LOOPS_OF_VERT</span>
<a name="l04726"></a>04726 <span class="comment">         * here and only iterpolate those? */</span>
<a name="l04727"></a>04727         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (f, &amp;fiter, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#af3e2c3c3da1e1a3b11817030e799f272">v</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa37651dfdb90919510896eeccfbcc9cf4">BM_FACES_OF_VERT</a>) {
<a name="l04728"></a>04728             <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> liter;
<a name="l04729"></a>04729             <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l04730"></a>04730 
<a name="l04731"></a>04731             <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f_copy;      <span class="comment">/* the copy of &#39;f&#39; */</span>
<a name="l04732"></a>04732             <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f_copy_flip; <span class="comment">/* the copy of &#39;f&#39; or detect if we need to flip to the shorter side. */</span>
<a name="l04733"></a>04733 
<a name="l04734"></a>04734             <span class="keywordtype">char</span> is_sel, is_hide;
<a name="l04735"></a>04735 
<a name="l04736"></a>04736             
<a name="l04737"></a>04737             <span class="keywordflow">if</span> (<a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a2f3abe3f63e4d2bb67ca9546d2bb2b34">BLI_smallhash_haskey</a>(&amp;visit, (uintptr_t)f))
<a name="l04738"></a>04738                 <span class="keywordflow">continue</span>;
<a name="l04739"></a>04739             
<a name="l04740"></a>04740             <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a7653b1eabbbd01be256a007a7e410147">BLI_smallhash_insert</a>(&amp;visit, (uintptr_t)f, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04741"></a>04741             
<a name="l04742"></a>04742             <span class="comment">/* the face attributes of the copied face will get</span>
<a name="l04743"></a>04743 <span class="comment">             * copied over, so its necessary to save the selection</span>
<a name="l04744"></a>04744 <span class="comment">             * and hidden state*/</span>
<a name="l04745"></a>04745             is_sel = <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(f, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>);
<a name="l04746"></a>04746             is_hide = <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(f, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>);
<a name="l04747"></a>04747             
<a name="l04748"></a>04748             f_copy = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)f);
<a name="l04749"></a>04749             
<a name="l04750"></a>04750             <span class="comment">/* project onto copied projection face */</span>
<a name="l04751"></a>04751             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, f, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l04752"></a>04752                 f_copy_flip = f_copy;
<a name="l04753"></a>04753 
<a name="l04754"></a>04754                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) || <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a7566c73bc0e246e2b6db70c5e2284102">prev</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l04755"></a>04755                     <span class="comment">/* the loop is attached of the selected edges that are sliding */</span>
<a name="l04756"></a>04756                     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l_ed_sel = l;
<a name="l04757"></a>04757                     
<a name="l04758"></a>04758                     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a37f32bdf99c1763a272342a3c83b5f51">e</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l04759"></a>04759                         l_ed_sel = l_ed_sel-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a7566c73bc0e246e2b6db70c5e2284102">prev</a>;
<a name="l04760"></a>04760                     
<a name="l04761"></a>04761                     <span class="keywordflow">if</span> (sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ae135aebf3fbc3a76e6c4c707defde7fe">perc</a> &lt; 0.0f) {
<a name="l04762"></a>04762                         <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a5d72f79547e15fae1d9a3cabcc585918">BM_vert_in_face</a>(l_ed_sel-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a537d51bd6350af7cca0d3e60c383bae0">down</a>)) {
<a name="l04763"></a>04763                             f_copy_flip = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)l_ed_sel-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>);
<a name="l04764"></a>04764                         }
<a name="l04765"></a>04765                     }
<a name="l04766"></a>04766                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ae135aebf3fbc3a76e6c4c707defde7fe">perc</a> &gt; 0.0f) {
<a name="l04767"></a>04767                         <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a5d72f79547e15fae1d9a3cabcc585918">BM_vert_in_face</a>(l_ed_sel-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a7141f7f9553be8c31320f0837f7f1d42">up</a>)) {
<a name="l04768"></a>04768                             f_copy_flip = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)l_ed_sel-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>);
<a name="l04769"></a>04769                         }
<a name="l04770"></a>04770                     }
<a name="l04771"></a>04771 
<a name="l04772"></a>04772                     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(f_copy_flip != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04773"></a>04773                     <span class="keywordflow">if</span> (!f_copy_flip) {
<a name="l04774"></a>04774                         <span class="keywordflow">continue</span>;  <span class="comment">/* shouldn&#39;t happen, but protection */</span>
<a name="l04775"></a>04775                     }
<a name="l04776"></a>04776                 }
<a name="l04777"></a>04777                 <span class="keywordflow">else</span> {
<a name="l04778"></a>04778                     <span class="comment">/* the loop is attached to only one vertex and not a selected edge,</span>
<a name="l04779"></a>04779 <span class="comment">                     * this means we have to find a selected edges face going in the right direction</span>
<a name="l04780"></a>04780 <span class="comment">                     * to copy from else we get bad distortion see: [#31080] */</span>
<a name="l04781"></a>04781                     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> eiter;
<a name="l04782"></a>04782                     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e_sel;
<a name="l04783"></a>04783 
<a name="l04784"></a>04784                     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (e_sel, &amp;eiter, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fae7bcabb6ce8c89d63c863eae870b97eb">BM_EDGES_OF_VERT</a>) {
<a name="l04785"></a>04785                         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e_sel, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {;
<a name="l04786"></a>04786                             <span class="keywordflow">break</span>;
<a name="l04787"></a>04787                         }
<a name="l04788"></a>04788                     }
<a name="l04789"></a>04789 
<a name="l04790"></a>04790                     <span class="keywordflow">if</span> (e_sel) {
<a name="l04791"></a>04791                         <span class="comment">/* warning if the UV&#39;s are not contiguous, this will copy from the _wrong_ UVs</span>
<a name="l04792"></a>04792 <span class="comment">                         * in fact whenever the face being copied is not &#39;f_copy&#39; this can happen,</span>
<a name="l04793"></a>04793 <span class="comment">                         * we could be a lot smarter about this but would need to deal with every UV channel or</span>
<a name="l04794"></a>04794 <span class="comment">                         * add a way to mask out lauers when calling #BM_loop_interp_from_face() */</span>
<a name="l04795"></a>04795                         <span class="keywordflow">if</span> (sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ae135aebf3fbc3a76e6c4c707defde7fe">perc</a> &lt; 0.0f) {
<a name="l04796"></a>04796                             <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a5d72f79547e15fae1d9a3cabcc585918">BM_vert_in_face</a>(e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a537d51bd6350af7cca0d3e60c383bae0">down</a>)) {
<a name="l04797"></a>04797                                 f_copy_flip = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>);
<a name="l04798"></a>04798                             }
<a name="l04799"></a>04799                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a5d72f79547e15fae1d9a3cabcc585918">BM_vert_in_face</a>(e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a537d51bd6350af7cca0d3e60c383bae0">down</a>)) {
<a name="l04800"></a>04800                                 f_copy_flip = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>);
<a name="l04801"></a>04801                             }
<a name="l04802"></a>04802 
<a name="l04803"></a>04803                         }
<a name="l04804"></a>04804                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ae135aebf3fbc3a76e6c4c707defde7fe">perc</a> &gt; 0.0f) {
<a name="l04805"></a>04805                             <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a5d72f79547e15fae1d9a3cabcc585918">BM_vert_in_face</a>(e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a7141f7f9553be8c31320f0837f7f1d42">up</a>)) {
<a name="l04806"></a>04806                                 f_copy_flip = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>);
<a name="l04807"></a>04807                             }
<a name="l04808"></a>04808                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/ddf/bmesh__queries_8c.html#a5d72f79547e15fae1d9a3cabcc585918">BM_vert_in_face</a>(e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>, sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a7141f7f9553be8c31320f0837f7f1d42">up</a>)) {
<a name="l04809"></a>04809                                 f_copy_flip = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1f86774d630d0120541671e054f1e1ce">BLI_smallhash_lookup</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, (uintptr_t)e_sel-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab9029150e1f571daf0c3e21c0bf6f797">l</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a4dc79205ddd30671e16a96fefca84d3c">radial_next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>);
<a name="l04810"></a>04810                             }
<a name="l04811"></a>04811                         }
<a name="l04812"></a>04812                     }
<a name="l04813"></a>04813 
<a name="l04814"></a>04814                 }
<a name="l04815"></a>04815                 
<a name="l04816"></a>04816                 <span class="comment">/* only loop data, no vertex data since that contains shape keys,</span>
<a name="l04817"></a>04817 <span class="comment">                 * and we do not want to mess up other shape keys */</span>
<a name="l04818"></a>04818                 <a class="code" href="../../de/d02/bmesh__interp_8c.html#a13b3d458d0896f980ea51f7179f471e3">BM_loop_interp_from_face</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, l, f_copy_flip, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l04819"></a>04819 
<a name="l04820"></a>04820                 <span class="keywordflow">if</span> (<span class="keyword">final</span>) {
<a name="l04821"></a>04821                     <a class="code" href="../../de/d02/bmesh__interp_8c.html#a962ab946b8eacdc63b030ab253a454dc">BM_loop_interp_multires</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, l, f_copy_flip);
<a name="l04822"></a>04822                     <span class="keywordflow">if</span> (f_copy != f_copy_flip) {
<a name="l04823"></a>04823                         <a class="code" href="../../de/d02/bmesh__interp_8c.html#a962ab946b8eacdc63b030ab253a454dc">BM_loop_interp_multires</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, l, f_copy);
<a name="l04824"></a>04824                     }
<a name="l04825"></a>04825                 }
<a name="l04826"></a>04826             }
<a name="l04827"></a>04827             
<a name="l04828"></a>04828             <span class="comment">/* make sure face-attributes are correct (e.g. MTexPoly) */</span>
<a name="l04829"></a>04829             <a class="code" href="../../da/dd9/bmesh__construct_8c.html#aba9609d213e7cb739f94d879a0167785">BM_elem_attrs_copy</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, f_copy, f);
<a name="l04830"></a>04830             
<a name="l04831"></a>04831             <span class="comment">/* restore selection and hidden flags */</span>
<a name="l04832"></a>04832             <a class="code" href="../../d5/def/bmesh__marking_8c.html#a1fa6831f1e900dac7a2d426f3a5c1f76" title="Select Face.">BM_face_select_set</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, f, is_sel);
<a name="l04833"></a>04833             <span class="keywordflow">if</span> (!is_hide) {
<a name="l04834"></a>04834                 <span class="comment">/* this check is a workaround for bug, see note - [#30735],</span>
<a name="l04835"></a>04835 <span class="comment">                 * without this edge can be hidden and selected */</span>
<a name="l04836"></a>04836                 <a class="code" href="../../d9/d94/bmesh__marking_8h.html#a5e6bbde136e3a1819af4af1b9a2e41c6">BM_elem_hide_set</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, f, is_hide);
<a name="l04837"></a>04837             }
<a name="l04838"></a>04838         }
<a name="l04839"></a>04839     }
<a name="l04840"></a>04840     
<a name="l04841"></a>04841     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#ab728193f2b04960d5cc53bc255d59193">BLI_smallhash_release</a>(&amp;visit);
<a name="l04842"></a>04842 }
<a name="l04843"></a>04843 
<a name="l04844"></a><a class="code" href="../../d2/d80/transform_8h.html#a37c10b3241160642d33ed185ea7909cf">04844</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a37c10b3241160642d33ed185ea7909cf">freeSlideTempFaces</a>(<a class="code" href="../../d0/db2/structSlideData.html">SlideData</a> *sld)
<a name="l04845"></a>04845 {
<a name="l04846"></a>04846     <span class="keywordflow">if</span> (sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a76c0621e1693d0c63c3086c34fb7b77c">origfaces_init</a>) {
<a name="l04847"></a>04847         <a class="code" href="../../d3/dd3/structSmallHashIter.html">SmallHashIter</a> hiter;
<a name="l04848"></a>04848         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *copyf;
<a name="l04849"></a>04849 
<a name="l04850"></a>04850         copyf = <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#a1e138e23cb4b60a7fc8901341ef47046">BLI_smallhash_iternew</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>, &amp;hiter, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04851"></a>04851         <span class="keywordflow">for</span> (; copyf; copyf=<a class="code" href="../../db/d1a/BLI__smallhash_8h.html#af44fb53c68aba0159b2ec9e7bb72b027">BLI_smallhash_iternext</a>(&amp;hiter, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l04852"></a>04852             <a class="code" href="../../d0/de5/bmesh__core_8c.html#a1502cbe32cf87f9b10f6067b53547f4a">BM_face_verts_kill</a>(sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#adf794e99fd704fa0e207196e21de3d99">em</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, copyf);
<a name="l04853"></a>04853         }
<a name="l04854"></a>04854 
<a name="l04855"></a>04855         <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#ab728193f2b04960d5cc53bc255d59193">BLI_smallhash_release</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a887071fd9cc3a9a4d570b5d335b5688e">origfaces</a>);
<a name="l04856"></a>04856 
<a name="l04857"></a>04857         sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a76c0621e1693d0c63c3086c34fb7b77c">origfaces_init</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l04858"></a>04858     }
<a name="l04859"></a>04859 }
<a name="l04860"></a>04860 
<a name="l04861"></a>04861 
<a name="l04862"></a><a class="code" href="../../d2/d80/transform_8h.html#adb3c98ce09f95c380c7bb2fc303085df">04862</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#adb3c98ce09f95c380c7bb2fc303085df">freeSlideVerts</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l04863"></a>04863 {
<a name="l04864"></a>04864     <a class="code" href="../../d0/db2/structSlideData.html">SlideData</a> *sld = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>;
<a name="l04865"></a>04865     
<a name="l04866"></a>04866 <span class="preprocessor">#if 0 </span><span class="comment">/*BMESH_TODO*/</span>
<a name="l04867"></a>04867     <span class="keywordflow">if</span> (me-&gt;drawflag &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#aeb85e9b1a8be0380f6b5d3cf6714f7f2">ME_DRAWEXTRA_EDGELEN</a>) {
<a name="l04868"></a>04868         <a class="code" href="../../db/d31/structTransDataSlideVert.html">TransDataSlideVert</a> *sv;
<a name="l04869"></a>04869         <a class="code" href="../../d7/deb/structLinkNode.html">LinkNode</a> *look = sld-&gt;vertlist;
<a name="l04870"></a>04870         <a class="code" href="../../df/da0/structGHash.html">GHash</a> *vertgh = sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ad999075d659c36c45315e42c2736dc67">vhash</a>;
<a name="l04871"></a>04871         <span class="keywordflow">while</span> (look) {
<a name="l04872"></a>04872             sv  = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(vertgh,(<a class="code" href="../../d8/d13/structEditVert.html">EditVert</a>*)look-&gt;<a class="code" href="../../d7/deb/structLinkNode.html#a0cbae9a354b6f652667f7d5ccee2d733">link</a>);
<a name="l04873"></a>04873             <span class="keywordflow">if</span> (sv != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04874"></a>04874                 sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a7141f7f9553be8c31320f0837f7f1d42">up</a>-&gt;f &amp;= !<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04875"></a>04875                 sv-&gt;<a class="code" href="../../db/d31/structTransDataSlideVert.html#a537d51bd6350af7cca0d3e60c383bae0">down</a>-&gt;f &amp;= !<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04876"></a>04876             }
<a name="l04877"></a>04877             look = look-&gt;<a class="code" href="../../d7/deb/structLinkNode.html#a8dfad71be4e66058ae9b9a97383e128c">next</a>;
<a name="l04878"></a>04878         }
<a name="l04879"></a>04879     }
<a name="l04880"></a>04880 <span class="preprocessor">#endif</span>
<a name="l04881"></a>04881 <span class="preprocessor"></span>    
<a name="l04882"></a>04882     <span class="keywordflow">if</span> (!sld)
<a name="l04883"></a>04883         <span class="keywordflow">return</span>;
<a name="l04884"></a>04884     
<a name="l04885"></a>04885     <a class="code" href="../../d8/d27/transform_8c.html#a37c10b3241160642d33ed185ea7909cf">freeSlideTempFaces</a>(sld);
<a name="l04886"></a>04886 
<a name="l04887"></a>04887     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#a6d4af0462544ffd2ce81c0ec225ae415" title="BMesh End Edit.">bmesh_edit_end</a>(sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#adf794e99fd704fa0e207196e21de3d99">em</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d5/d70/bmesh__operator__api_8h.html#ac038a1e8b1ad739c47df10a3bc02d465">BMO_OP_FLAG_UNTAN_MULTIRES</a>);
<a name="l04888"></a>04888 
<a name="l04889"></a>04889     <a class="code" href="../../db/d1a/BLI__smallhash_8h.html#ab728193f2b04960d5cc53bc255d59193">BLI_smallhash_release</a>(&amp;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ad999075d659c36c45315e42c2736dc67">vhash</a>);
<a name="l04890"></a>04890     
<a name="l04891"></a>04891     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ab555da9fdba40aa2f378332895f7eb20">sv</a>);
<a name="l04892"></a>04892     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sld);
<a name="l04893"></a>04893     
<a name="l04894"></a>04894     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04895"></a>04895     
<a name="l04896"></a>04896     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l04897"></a>04897 }
<a name="l04898"></a>04898 
<a name="l04899"></a><a class="code" href="../../d2/d80/transform_8h.html#af42e9a267926b484569394c5cd0f0b89">04899</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#af42e9a267926b484569394c5cd0f0b89">initEdgeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l04900"></a>04900 {
<a name="l04901"></a>04901     <a class="code" href="../../d0/db2/structSlideData.html">SlideData</a> *sld;
<a name="l04902"></a>04902 
<a name="l04903"></a>04903     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a023180aa474073c43bdaa34da21dfc1b">TFM_EDGE_SLIDE</a>;
<a name="l04904"></a>04904     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#af4f765496d6529743c6c8cb198f58ee3">EdgeSlide</a>;
<a name="l04905"></a>04905     
<a name="l04906"></a>04906     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d27/transform_8c.html#ae4294af26780b84abbca8ce02b0eab54">createSlideVerts</a>(t)) {
<a name="l04907"></a>04907         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a>= <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l04908"></a>04908         <span class="keywordflow">return</span>;
<a name="l04909"></a>04909     }
<a name="l04910"></a>04910     
<a name="l04911"></a>04911     sld = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>;
<a name="l04912"></a>04912 
<a name="l04913"></a>04913     <span class="keywordflow">if</span> (!sld)
<a name="l04914"></a>04914         <span class="keywordflow">return</span>;
<a name="l04915"></a>04915 
<a name="l04916"></a>04916     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5b005f321a3ea6265c1df6f3a218e9f0">customFree</a> = <a class="code" href="../../d8/d27/transform_8c.html#adb3c98ce09f95c380c7bb2fc303085df">freeSlideVerts</a>;
<a name="l04917"></a>04917 
<a name="l04918"></a>04918     <span class="comment">/* set custom point first if you want value to be initialized by init */</span>
<a name="l04919"></a>04919     <a class="code" href="../../d2/d80/transform_8h.html#acd3cc3d0daf80c872971b2038a89b621">setCustomPoints</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#a14b48fc2fc4472e0d392ffb23090e7ac">end</a>, sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#aae0557c3862cfd353d5085c1d9c29b1c">start</a>);
<a name="l04920"></a>04920     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717aac439335cbccfffd703c36ed8b0616d1">INPUT_CUSTOM_RATIO</a>);
<a name="l04921"></a>04921     
<a name="l04922"></a>04922     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l04923"></a>04923     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l04924"></a>04924     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l04925"></a>04925     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 0.1f;
<a name="l04926"></a>04926     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l04927"></a>04927 
<a name="l04928"></a>04928     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l04929"></a>04929 
<a name="l04930"></a>04930     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a1990c83884ffae79ea451e8449fbd447">T_NO_PROJECT</a>;
<a name="l04931"></a>04931 }
<a name="l04932"></a>04932 
<a name="l04933"></a><a class="code" href="../../d8/d27/transform_8c.html#a70aba5d402c4d15ec2a5463f14faba8c">04933</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a70aba5d402c4d15ec2a5463f14faba8c">doEdgeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> perc)
<a name="l04934"></a>04934 {
<a name="l04935"></a>04935     <a class="code" href="../../d0/db2/structSlideData.html">SlideData</a> *sld = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>;
<a name="l04936"></a>04936     <a class="code" href="../../db/d31/structTransDataSlideVert.html">TransDataSlideVert</a> *svlist = sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ab555da9fdba40aa2f378332895f7eb20">sv</a>, *sv;
<a name="l04937"></a>04937     <span class="keywordtype">float</span> vec[3];
<a name="l04938"></a>04938     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l04939"></a>04939 
<a name="l04940"></a>04940     sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#ae135aebf3fbc3a76e6c4c707defde7fe">perc</a> = perc;
<a name="l04941"></a>04941 
<a name="l04942"></a>04942     sv = svlist;
<a name="l04943"></a>04943     <span class="keywordflow">for</span> (i=0; i&lt;sld-&gt;<a class="code" href="../../d0/db2/structSlideData.html#aec8d44c33c976c159a877f34bf30fc03">totsv</a>; i++, sv++) {
<a name="l04944"></a>04944         <span class="keywordflow">if</span> (perc &gt; 0.0f) {
<a name="l04945"></a>04945             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, sv-&gt;upvec);
<a name="l04946"></a>04946             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, perc);
<a name="l04947"></a>04947             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(sv-&gt;v-&gt;co, sv-&gt;origvert.co, vec);
<a name="l04948"></a>04948         }
<a name="l04949"></a>04949         <span class="keywordflow">else</span> {
<a name="l04950"></a>04950             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, sv-&gt;downvec);
<a name="l04951"></a>04951             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, -perc);
<a name="l04952"></a>04952             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(sv-&gt;v-&gt;co, sv-&gt;origvert.co, vec);
<a name="l04953"></a>04953         }
<a name="l04954"></a>04954     }
<a name="l04955"></a>04955     
<a name="l04956"></a>04956     <a class="code" href="../../d8/d27/transform_8c.html#ad1d07906f55895e997ef2a3de6d108a8">projectSVData</a>(t, 0);
<a name="l04957"></a>04957     
<a name="l04958"></a>04958     <span class="keywordflow">return</span> 1;
<a name="l04959"></a>04959 }
<a name="l04960"></a>04960 
<a name="l04961"></a><a class="code" href="../../d8/d27/transform_8c.html#af4f765496d6529743c6c8cb198f58ee3">04961</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#af4f765496d6529743c6c8cb198f58ee3">EdgeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l04962"></a>04962 {
<a name="l04963"></a>04963     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l04964"></a>04964     <span class="keywordtype">float</span> <span class="keyword">final</span>;
<a name="l04965"></a>04965 
<a name="l04966"></a>04966     <span class="keyword">final</span> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l04967"></a>04967 
<a name="l04968"></a>04968     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;<span class="keyword">final</span>);
<a name="l04969"></a>04969 
<a name="l04970"></a>04970     <span class="comment">/* only do this so out of range values are not displayed */</span>
<a name="l04971"></a>04971     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(<span class="keyword">final</span>, -1.0f, 1.0f);
<a name="l04972"></a>04972 
<a name="l04973"></a>04973     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l04974"></a>04974         <span class="keywordtype">char</span> c[20];
<a name="l04975"></a>04975 
<a name="l04976"></a>04976         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;<span class="keyword">final</span>);
<a name="l04977"></a>04977 
<a name="l04978"></a>04978         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l04979"></a>04979 
<a name="l04980"></a>04980         sprintf(str, <span class="stringliteral">&quot;Edge Slide: %s&quot;</span>, &amp;c[0]);
<a name="l04981"></a>04981     }
<a name="l04982"></a>04982     <span class="keywordflow">else</span> {
<a name="l04983"></a>04983         sprintf(str, <span class="stringliteral">&quot;Edge Slide: %.2f&quot;</span>, <span class="keyword">final</span>);
<a name="l04984"></a>04984     }
<a name="l04985"></a>04985 
<a name="l04986"></a>04986     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(<span class="keyword">final</span>, -1.0f, 1.0f);
<a name="l04987"></a>04987 
<a name="l04988"></a>04988     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = <span class="keyword">final</span>;
<a name="l04989"></a>04989 
<a name="l04990"></a>04990     <span class="comment">/*do stuff here*/</span>
<a name="l04991"></a>04991     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>)
<a name="l04992"></a>04992         <a class="code" href="../../d8/d27/transform_8c.html#a70aba5d402c4d15ec2a5463f14faba8c">doEdgeSlide</a>(t, <span class="keyword">final</span>);
<a name="l04993"></a>04993     <span class="keywordflow">else</span> {
<a name="l04994"></a>04994         strcpy(str, <span class="stringliteral">&quot;Invalid Edge Selection&quot;</span>);
<a name="l04995"></a>04995         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l04996"></a>04996     }
<a name="l04997"></a>04997 
<a name="l04998"></a>04998     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l04999"></a>04999 
<a name="l05000"></a>05000     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05001"></a>05001 
<a name="l05002"></a>05002     <span class="keywordflow">return</span> 1;
<a name="l05003"></a>05003 }
<a name="l05004"></a>05004 
<a name="l05005"></a>05005 <span class="comment">/* ******************** EditBone roll *************** */</span>
<a name="l05006"></a>05006 
<a name="l05007"></a><a class="code" href="../../d2/d80/transform_8h.html#a77838f76c12b6bdfaa558240b3b8b44e">05007</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a77838f76c12b6bdfaa558240b3b8b44e">initBoneRoll</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05008"></a>05008 {
<a name="l05009"></a>05009     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a6385405fb82e713908aedcf53e68251f">TFM_BONE_ROLL</a>;
<a name="l05010"></a>05010     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#aac268573be2cd3bed575ce3ac3a7169e">BoneRoll</a>;
<a name="l05011"></a>05011 
<a name="l05012"></a>05012     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717adb08b6b8c2e8258d470aa8a584ef8dc2">INPUT_ANGLE</a>);
<a name="l05013"></a>05013 
<a name="l05014"></a>05014     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l05015"></a>05015     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l05016"></a>05016     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l05017"></a>05017     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = (float)((5.0/180)*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l05018"></a>05018     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.2f;
<a name="l05019"></a>05019 
<a name="l05020"></a>05020     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = 1.0f;
<a name="l05021"></a>05021 
<a name="l05022"></a>05022     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a1990c83884ffae79ea451e8449fbd447">T_NO_PROJECT</a>;
<a name="l05023"></a>05023 }
<a name="l05024"></a>05024 
<a name="l05025"></a><a class="code" href="../../d8/d27/transform_8c.html#aac268573be2cd3bed575ce3ac3a7169e">05025</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#aac268573be2cd3bed575ce3ac3a7169e">BoneRoll</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l05026"></a>05026 {
<a name="l05027"></a>05027     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05028"></a>05028     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05029"></a>05029     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l05030"></a>05030 
<a name="l05031"></a>05031     <span class="keywordtype">float</span> <span class="keyword">final</span>;
<a name="l05032"></a>05032 
<a name="l05033"></a>05033     <span class="keyword">final</span> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05034"></a>05034 
<a name="l05035"></a>05035     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;<span class="keyword">final</span>);
<a name="l05036"></a>05036 
<a name="l05037"></a>05037     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l05038"></a>05038         <span class="keywordtype">char</span> c[20];
<a name="l05039"></a>05039 
<a name="l05040"></a>05040         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;<span class="keyword">final</span>);
<a name="l05041"></a>05041 
<a name="l05042"></a>05042         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l05043"></a>05043 
<a name="l05044"></a>05044         sprintf(str, <span class="stringliteral">&quot;Roll: %s&quot;</span>, &amp;c[0]);
<a name="l05045"></a>05045 
<a name="l05046"></a>05046         <span class="keyword">final</span> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(<span class="keyword">final</span>);
<a name="l05047"></a>05047     }
<a name="l05048"></a>05048     <span class="keywordflow">else</span> {
<a name="l05049"></a>05049         sprintf(str, <span class="stringliteral">&quot;Roll: %.2f&quot;</span>, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<span class="keyword">final</span>));
<a name="l05050"></a>05050     }
<a name="l05051"></a>05051 
<a name="l05052"></a>05052     <span class="comment">/* set roll values */</span>
<a name="l05053"></a>05053     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l05054"></a>05054         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l05055"></a>05055             <span class="keywordflow">break</span>;
<a name="l05056"></a>05056 
<a name="l05057"></a>05057         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l05058"></a>05058             <span class="keywordflow">continue</span>;
<a name="l05059"></a>05059 
<a name="l05060"></a>05060         *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> - <span class="keyword">final</span>;
<a name="l05061"></a>05061     }
<a name="l05062"></a>05062 
<a name="l05063"></a>05063     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05064"></a>05064 
<a name="l05065"></a>05065     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05066"></a>05066 
<a name="l05067"></a>05067     <span class="keywordflow">return</span> 1;
<a name="l05068"></a>05068 }
<a name="l05069"></a>05069 
<a name="l05070"></a>05070 <span class="comment">/* ************************** BAKE TIME ******************* */</span>
<a name="l05071"></a>05071 
<a name="l05072"></a><a class="code" href="../../d2/d80/transform_8h.html#af8a997f5dce1304f0a28d9dd72185ea2">05072</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#af8a997f5dce1304f0a28d9dd72185ea2">initBakeTime</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05073"></a>05073 {
<a name="l05074"></a>05074     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#aeda73d220b55f31a3078485d2714bff7">BakeTime</a>;
<a name="l05075"></a>05075     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717ad635d6b1496fa2fba6f87068d4193246">INPUT_NONE</a>);
<a name="l05076"></a>05076 
<a name="l05077"></a>05077     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l05078"></a>05078     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = 0;
<a name="l05079"></a>05079     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l05080"></a>05080     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = 1.0f;
<a name="l05081"></a>05081     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] * 0.1f;
<a name="l05082"></a>05082 
<a name="l05083"></a>05083     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l05084"></a>05084 }
<a name="l05085"></a>05085 
<a name="l05086"></a><a class="code" href="../../d2/d80/transform_8h.html#aeda73d220b55f31a3078485d2714bff7">05086</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#aeda73d220b55f31a3078485d2714bff7">BakeTime</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l05087"></a>05087 {
<a name="l05088"></a>05088     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05089"></a>05089     <span class="keywordtype">float</span> time;
<a name="l05090"></a>05090     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05091"></a>05091     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[50];
<a name="l05092"></a>05092 
<a name="l05093"></a>05093     <span class="keywordtype">float</span> fac = 0.1f;
<a name="l05094"></a>05094 
<a name="l05095"></a>05095     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>.<a class="code" href="../../dd/d4e/structMouseInput.html#a4dc5999fc6200da6f0ff4ca2cf349748">precision</a>) {
<a name="l05096"></a>05096         <span class="comment">/* calculate ratio for shiftkey pos, and for total, and blend these for precision */</span>
<a name="l05097"></a>05097         time= (float)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a22c3f79fec827b320741386a95e7b848">center2d</a>[0] - t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>.<a class="code" href="../../dd/d4e/structMouseInput.html#a75650813265aa661a92a43d099bd87a8">precision_mval</a>[0]) * fac;
<a name="l05098"></a>05098         time+= 0.1f*((float)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a22c3f79fec827b320741386a95e7b848">center2d</a>[0]*fac - mval[0]) -time);
<a name="l05099"></a>05099     }
<a name="l05100"></a>05100     <span class="keywordflow">else</span> {
<a name="l05101"></a>05101         time = (float)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a22c3f79fec827b320741386a95e7b848">center2d</a>[0] - mval[0])*fac;
<a name="l05102"></a>05102     }
<a name="l05103"></a>05103 
<a name="l05104"></a>05104     <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, &amp;time);
<a name="l05105"></a>05105 
<a name="l05106"></a>05106     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;time);
<a name="l05107"></a>05107 
<a name="l05108"></a>05108     <span class="comment">/* header print for NumInput */</span>
<a name="l05109"></a>05109     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l05110"></a>05110         <span class="keywordtype">char</span> c[20];
<a name="l05111"></a>05111 
<a name="l05112"></a>05112         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), c);
<a name="l05113"></a>05113 
<a name="l05114"></a>05114         <span class="keywordflow">if</span> (time &gt;= 0.0f)
<a name="l05115"></a>05115             sprintf(str, <span class="stringliteral">&quot;Time: +%s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l05116"></a>05116         <span class="keywordflow">else</span>
<a name="l05117"></a>05117             sprintf(str, <span class="stringliteral">&quot;Time: %s %s&quot;</span>, c, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l05118"></a>05118     }
<a name="l05119"></a>05119     <span class="keywordflow">else</span> {
<a name="l05120"></a>05120         <span class="comment">/* default header print */</span>
<a name="l05121"></a>05121         <span class="keywordflow">if</span> (time &gt;= 0.0f)
<a name="l05122"></a>05122             sprintf(str, <span class="stringliteral">&quot;Time: +%.3f %s&quot;</span>, time, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l05123"></a>05123         <span class="keywordflow">else</span>
<a name="l05124"></a>05124             sprintf(str, <span class="stringliteral">&quot;Time: %.3f %s&quot;</span>, time, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5d0be6f8bbac9592164840a64e85f395">proptext</a>);
<a name="l05125"></a>05125     }
<a name="l05126"></a>05126 
<a name="l05127"></a>05127     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l05128"></a>05128         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l05129"></a>05129             <span class="keywordflow">break</span>;
<a name="l05130"></a>05130 
<a name="l05131"></a>05131         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l05132"></a>05132             <span class="keywordflow">continue</span>;
<a name="l05133"></a>05133 
<a name="l05134"></a>05134         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>) {
<a name="l05135"></a>05135             *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> + time * td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>;
<a name="l05136"></a>05136             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a> &amp;&amp; *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &lt; *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a32ba887e9f77526ce376ef6c7906c3f1">size</a>;
<a name="l05137"></a>05137             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a> &amp;&amp; *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> &gt; *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>) *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> = *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a8ca976d4bc354b1725ce678e9e94ff9a">ext</a>-&gt;<a class="code" href="../../d3/d50/structTransDataExtension.html#a9ac401ab3524ecc656ccefcc4ee95816">quat</a>;
<a name="l05138"></a>05138         }
<a name="l05139"></a>05139     }
<a name="l05140"></a>05140 
<a name="l05141"></a>05141     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05142"></a>05142 
<a name="l05143"></a>05143     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05144"></a>05144 
<a name="l05145"></a>05145     <span class="keywordflow">return</span> 1;
<a name="l05146"></a>05146 }
<a name="l05147"></a>05147 
<a name="l05148"></a>05148 <span class="comment">/* ************************** MIRROR *************************** */</span>
<a name="l05149"></a>05149 
<a name="l05150"></a><a class="code" href="../../d2/d80/transform_8h.html#a9965370aafec7b6840eb7e3815dee606">05150</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a9965370aafec7b6840eb7e3815dee606">initMirror</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05151"></a>05151 {
<a name="l05152"></a>05152     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a9bdf8056b257d3622a9b25b9f3e7b35a">Mirror</a>;
<a name="l05153"></a>05153     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717ad635d6b1496fa2fba6f87068d4193246">INPUT_NONE</a>);
<a name="l05154"></a>05154 
<a name="l05155"></a>05155     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a565eee5b9aa63ea848efc1eaad663e2f">T_NULL_ONE</a>;
<a name="l05156"></a>05156     <span class="keywordflow">if</span> (!t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a391b0d885429735b87c73369c9fd068d">obedit</a>) {
<a name="l05157"></a>05157         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a15ccdebb168cc175d28e714d88d1aac1">T_NO_ZERO</a>;
<a name="l05158"></a>05158     }
<a name="l05159"></a>05159 }
<a name="l05160"></a>05160 
<a name="l05161"></a><a class="code" href="../../d8/d27/transform_8c.html#a9bdf8056b257d3622a9b25b9f3e7b35a">05161</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a9bdf8056b257d3622a9b25b9f3e7b35a">Mirror</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l05162"></a>05162 {
<a name="l05163"></a>05163     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td;
<a name="l05164"></a>05164     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3], mat[3][3];
<a name="l05165"></a>05165     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05166"></a>05166     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[200];
<a name="l05167"></a>05167 
<a name="l05168"></a>05168     <span class="comment">/*</span>
<a name="l05169"></a>05169 <span class="comment">     * OPTIMIZATION:</span>
<a name="l05170"></a>05170 <span class="comment">     * This still recalcs transformation on mouse move</span>
<a name="l05171"></a>05171 <span class="comment">     * while it should only recalc on constraint change</span>
<a name="l05172"></a>05172 <span class="comment">     * */</span>
<a name="l05173"></a>05173 
<a name="l05174"></a>05174     <span class="comment">/* if an axis has been selected */</span>
<a name="l05175"></a>05175     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l05176"></a>05176         size[0] = size[1] = size[2] = -1;
<a name="l05177"></a>05177 
<a name="l05178"></a>05178         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a32ceca78461c61d0dbda46632ccb0f8f">size_to_mat3</a>( mat,size);
<a name="l05179"></a>05179 
<a name="l05180"></a>05180         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>) {
<a name="l05181"></a>05181             t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a3f2cbdffe2ac34abafd58b7ee849fe76">applySize</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, mat);
<a name="l05182"></a>05182         }
<a name="l05183"></a>05183 
<a name="l05184"></a>05184         sprintf(str, <span class="stringliteral">&quot;Mirror%s&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>);
<a name="l05185"></a>05185 
<a name="l05186"></a>05186         <span class="keywordflow">for</span> (i = 0, td=t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>; i &lt; t-&gt;total; i++, td++) {
<a name="l05187"></a>05187             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l05188"></a>05188                 <span class="keywordflow">break</span>;
<a name="l05189"></a>05189 
<a name="l05190"></a>05190             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l05191"></a>05191                 <span class="keywordflow">continue</span>;
<a name="l05192"></a>05192 
<a name="l05193"></a>05193             <a class="code" href="../../d8/d27/transform_8c.html#afbcc17bd4187f92a6de768cb6294f37f">ElementResize</a>(t, td, mat);
<a name="l05194"></a>05194         }
<a name="l05195"></a>05195 
<a name="l05196"></a>05196         <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05197"></a>05197 
<a name="l05198"></a>05198         <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05199"></a>05199     }
<a name="l05200"></a>05200     <span class="keywordflow">else</span> {
<a name="l05201"></a>05201         size[0] = size[1] = size[2] = 1;
<a name="l05202"></a>05202 
<a name="l05203"></a>05203         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a32ceca78461c61d0dbda46632ccb0f8f">size_to_mat3</a>( mat,size);
<a name="l05204"></a>05204 
<a name="l05205"></a>05205         <span class="keywordflow">for</span> (i = 0, td=t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>; i &lt; t-&gt;total; i++, td++) {
<a name="l05206"></a>05206             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l05207"></a>05207                 <span class="keywordflow">break</span>;
<a name="l05208"></a>05208 
<a name="l05209"></a>05209             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l05210"></a>05210                 <span class="keywordflow">continue</span>;
<a name="l05211"></a>05211 
<a name="l05212"></a>05212             <a class="code" href="../../d8/d27/transform_8c.html#afbcc17bd4187f92a6de768cb6294f37f">ElementResize</a>(t, td, mat);
<a name="l05213"></a>05213         }
<a name="l05214"></a>05214 
<a name="l05215"></a>05215         <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05216"></a>05216 
<a name="l05217"></a>05217         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#ada09a5cfb89b90213eae588a97f216eb">T_2D_EDIT</a>)
<a name="l05218"></a>05218             <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, <span class="stringliteral">&quot;Select a mirror axis (X, Y)&quot;</span>);
<a name="l05219"></a>05219         <span class="keywordflow">else</span>
<a name="l05220"></a>05220             <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, <span class="stringliteral">&quot;Select a mirror axis (X, Y, Z)&quot;</span>);
<a name="l05221"></a>05221     }
<a name="l05222"></a>05222 
<a name="l05223"></a>05223     <span class="keywordflow">return</span> 1;
<a name="l05224"></a>05224 }
<a name="l05225"></a>05225 
<a name="l05226"></a>05226 <span class="comment">/* ************************** ALIGN *************************** */</span>
<a name="l05227"></a>05227 
<a name="l05228"></a><a class="code" href="../../d2/d80/transform_8h.html#a17f38756607704d507c51f003c050bdd">05228</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a17f38756607704d507c51f003c050bdd">initAlign</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05229"></a>05229 {
<a name="l05230"></a>05230     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#af0fd97384ecf6e788c17608fe7e6ec84">T_NO_CONSTRAINT</a>;
<a name="l05231"></a>05231 
<a name="l05232"></a>05232     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#add61255c83535de98ac95acf2327064d">Align</a>;
<a name="l05233"></a>05233 
<a name="l05234"></a>05234     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717ad635d6b1496fa2fba6f87068d4193246">INPUT_NONE</a>);
<a name="l05235"></a>05235 }
<a name="l05236"></a>05236 
<a name="l05237"></a><a class="code" href="../../d8/d27/transform_8c.html#add61255c83535de98ac95acf2327064d">05237</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#add61255c83535de98ac95acf2327064d">Align</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l05238"></a>05238 {
<a name="l05239"></a>05239     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05240"></a>05240     <span class="keywordtype">float</span> center[3];
<a name="l05241"></a>05241     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05242"></a>05242 
<a name="l05243"></a>05243     <span class="comment">/* saving original center */</span>
<a name="l05244"></a>05244     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(center, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>);
<a name="l05245"></a>05245 
<a name="l05246"></a>05246     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++)
<a name="l05247"></a>05247     {
<a name="l05248"></a>05248         <span class="keywordtype">float</span> mat[3][3], invmat[3][3];
<a name="l05249"></a>05249 
<a name="l05250"></a>05250         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l05251"></a>05251             <span class="keywordflow">break</span>;
<a name="l05252"></a>05252 
<a name="l05253"></a>05253         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l05254"></a>05254             <span class="keywordflow">continue</span>;
<a name="l05255"></a>05255 
<a name="l05256"></a>05256         <span class="comment">/* around local centers */</span>
<a name="l05257"></a>05257         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> &amp; (<a class="code" href="../../d2/d80/transform_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>|<a class="code" href="../../d2/d80/transform_8h.html#a3ff300f116681287e7d8cd85df543c31">T_POSE</a>)) {
<a name="l05258"></a>05258             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l05259"></a>05259         }
<a name="l05260"></a>05260         <span class="keywordflow">else</span> {
<a name="l05261"></a>05261             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a028ef4069c952a4242cbda17cd0992d5">settings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>) {
<a name="l05262"></a>05262                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a9e939d37bfce48120fdb7ee832fe2284">center</a>);
<a name="l05263"></a>05263             }
<a name="l05264"></a>05264         }
<a name="l05265"></a>05265 
<a name="l05266"></a>05266         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#acc9f8cab0ea2c5993f2c9bdeaca6b788">invert_m3_m3</a>(invmat, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a60afa9e6d9cb55ec8c65800560bb98fe">axismtx</a>);
<a name="l05267"></a>05267 
<a name="l05268"></a>05268         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ae913d49905789e8a81479471c879258e">spacemtx</a>, invmat);
<a name="l05269"></a>05269 
<a name="l05270"></a>05270         <a class="code" href="../../d8/d27/transform_8c.html#a4e32ddc4d9cb39f71d2d2576cd439367">ElementRotation</a>(t, td, mat, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0c9e2a1ae5acee970c6b8e16b96f09bd">around</a>);
<a name="l05271"></a>05271     }
<a name="l05272"></a>05272 
<a name="l05273"></a>05273     <span class="comment">/* restoring original center */</span>
<a name="l05274"></a>05274     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, center);
<a name="l05275"></a>05275 
<a name="l05276"></a>05276     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05277"></a>05277 
<a name="l05278"></a>05278     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, <span class="stringliteral">&quot;Align&quot;</span>);
<a name="l05279"></a>05279 
<a name="l05280"></a>05280     <span class="keywordflow">return</span> 1;
<a name="l05281"></a>05281 }
<a name="l05282"></a>05282 
<a name="l05283"></a>05283 <span class="comment">/* ************************** SEQ SLIDE *************************** */</span>
<a name="l05284"></a>05284 
<a name="l05285"></a><a class="code" href="../../d2/d80/transform_8h.html#a671392b31cbdaa3b20be3f74610cbe52">05285</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a671392b31cbdaa3b20be3f74610cbe52">initSeqSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05286"></a>05286 {
<a name="l05287"></a>05287     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#ab76da3463168af0739e20daa102ef41d">SeqSlide</a>;
<a name="l05288"></a>05288 
<a name="l05289"></a>05289     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717a6438d03c74f97b2a22a7ab443f5b8de0">INPUT_VECTOR</a>);
<a name="l05290"></a>05290 
<a name="l05291"></a>05291     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 1;
<a name="l05292"></a>05292     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> = 0;
<a name="l05293"></a>05293     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a>;
<a name="l05294"></a>05294 
<a name="l05295"></a>05295     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l05296"></a>05296     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = floor(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a071df993e13c05fc37e6f9a82c0679f5">frs_sec</a> / t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a11e6b08a8678f04813637f658e867193">frs_sec_base</a>);
<a name="l05297"></a>05297     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 10.0f;
<a name="l05298"></a>05298 
<a name="l05299"></a>05299     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l05300"></a>05300 }
<a name="l05301"></a>05301 
<a name="l05302"></a><a class="code" href="../../d8/d27/transform_8c.html#adca351512530e06e339e9fa6faacb394">05302</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#adca351512530e06e339e9fa6faacb394">headerSeqSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> val[2], <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l05303"></a>05303 {
<a name="l05304"></a>05304     <span class="keywordtype">char</span> tvec[60];
<a name="l05305"></a>05305 
<a name="l05306"></a>05306     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l05307"></a>05307         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l05308"></a>05308     }
<a name="l05309"></a>05309     <span class="keywordflow">else</span> {
<a name="l05310"></a>05310         sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%.0f, %.0f&quot;</span>, val[0], val[1]);
<a name="l05311"></a>05311     }
<a name="l05312"></a>05312 
<a name="l05313"></a>05313     sprintf(str, <span class="stringliteral">&quot;Sequence Slide: %s%s&quot;</span>, &amp;tvec[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2e048249b704fc47f6917e8c3aa6e8d3">text</a>);
<a name="l05314"></a>05314 }
<a name="l05315"></a>05315 
<a name="l05316"></a><a class="code" href="../../d8/d27/transform_8c.html#a536c305cc5b8b5e38390eed5f6a4269c">05316</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a536c305cc5b8b5e38390eed5f6a4269c">applySeqSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> val[2])
<a name="l05317"></a>05317 {
<a name="l05318"></a>05318     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05319"></a>05319     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05320"></a>05320 
<a name="l05321"></a>05321     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l05322"></a>05322         <span class="keywordtype">float</span> tvec[2];
<a name="l05323"></a>05323 
<a name="l05324"></a>05324         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a8637c70841473236542100fc2232f56b">TD_NOACTION</a>)
<a name="l05325"></a>05325             <span class="keywordflow">break</span>;
<a name="l05326"></a>05326 
<a name="l05327"></a>05327         <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a537c7c46c9c0113cb3db76014255ea7b">TD_SKIP</a>)
<a name="l05328"></a>05328             <span class="keywordflow">continue</span>;
<a name="l05329"></a>05329 
<a name="l05330"></a>05330         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(tvec, val);
<a name="l05331"></a>05331 
<a name="l05332"></a>05332         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5c6d272cb16304939dbe77dacc77b3b0">mul_v2_fl</a>(tvec, td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a3d2f95d2d681cd7c46524bd3d7938a51">factor</a>);
<a name="l05333"></a>05333 
<a name="l05334"></a>05334         td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>[0] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>[0] + tvec[0];
<a name="l05335"></a>05335         td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a38440ac891ed6817c930a0cd74812395">loc</a>[1] = td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a7a02938ecead0795dc7a578703d8ea4a">iloc</a>[1] + tvec[1];
<a name="l05336"></a>05336     }
<a name="l05337"></a>05337 }
<a name="l05338"></a>05338 
<a name="l05339"></a><a class="code" href="../../d8/d27/transform_8c.html#ab76da3463168af0739e20daa102ef41d">05339</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#ab76da3463168af0739e20daa102ef41d">SeqSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l05340"></a>05340 {
<a name="l05341"></a>05341     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[200];
<a name="l05342"></a>05342 
<a name="l05343"></a>05343     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a2663c010254d765613faa19d22fab949">mode</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#abe6ad7a39946029ddf0363bd1a202b6e">CON_APPLY</a>) {
<a name="l05344"></a>05344         <span class="keywordtype">float</span> pvec[3] = {0.0f, 0.0f, 0.0f};
<a name="l05345"></a>05345         <span class="keywordtype">float</span> tvec[3];
<a name="l05346"></a>05346         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#add55067f78d8b531ffcd1f94a9d7420e">con</a>.<a class="code" href="../../d9/d35/structTransCon.html#a1836b66b0b71ca0acc31ef2255cc266c">applyVec</a>(t, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, tvec, pvec);
<a name="l05347"></a>05347         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, tvec);
<a name="l05348"></a>05348     }
<a name="l05349"></a>05349     <span class="keywordflow">else</span> {
<a name="l05350"></a>05350         <a class="code" href="../../d2/d80/transform_8h.html#ab91a317295131088f61a723357966c52">snapGrid</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l05351"></a>05351         <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l05352"></a>05352     }
<a name="l05353"></a>05353 
<a name="l05354"></a>05354     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = floor(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] + 0.5f);
<a name="l05355"></a>05355     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[1] = floor(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[1] + 0.5f);
<a name="l05356"></a>05356 
<a name="l05357"></a>05357     <a class="code" href="../../d8/d27/transform_8c.html#adca351512530e06e339e9fa6faacb394">headerSeqSlide</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>, str);
<a name="l05358"></a>05358     <a class="code" href="../../d8/d27/transform_8c.html#a536c305cc5b8b5e38390eed5f6a4269c">applySeqSlide</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>);
<a name="l05359"></a>05359 
<a name="l05360"></a>05360     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05361"></a>05361 
<a name="l05362"></a>05362     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05363"></a>05363 
<a name="l05364"></a>05364     <span class="keywordflow">return</span> 1;
<a name="l05365"></a>05365 }
<a name="l05366"></a>05366 
<a name="l05367"></a>05367 <span class="comment">/* ************************** ANIM EDITORS - TRANSFORM TOOLS *************************** */</span>
<a name="l05368"></a>05368 
<a name="l05369"></a>05369 <span class="comment">/* ---------------- Special Helpers for Various Settings ------------- */</span>
<a name="l05370"></a>05370 
<a name="l05371"></a>05371 
<a name="l05372"></a>05372 <span class="comment">/* This function returns the snapping &#39;mode&#39; for Animation Editors only</span>
<a name="l05373"></a>05373 <span class="comment"> * We cannot use the standard snapping due to NLA-strip scaling complexities.</span>
<a name="l05374"></a>05374 <span class="comment"> */</span>
<a name="l05375"></a>05375 <span class="comment">// XXX these modifier checks should be keymappable</span>
<a name="l05376"></a><a class="code" href="../../d8/d27/transform_8c.html#a3a6ed67c130e61a2eca4a0dde08c9f6d">05376</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d8/d27/transform_8c.html#a3a6ed67c130e61a2eca4a0dde08c9f6d">getAnimEdit_SnapMode</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05377"></a>05377 {
<a name="l05378"></a>05378     <span class="keywordtype">short</span> autosnap= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80da256e68ebc04fa1e7294bcf71c67d870f">SACTSNAP_OFF</a>;
<a name="l05379"></a>05379     
<a name="l05380"></a>05380     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l05381"></a>05381         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05382"></a>05382         
<a name="l05383"></a>05383         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (saction)
<a name="l05384"></a>05384             autosnap= saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#ae9227fbb8c3fe17e7abdaee5ffc533fe">autosnap</a>;
<a name="l05385"></a>05385     }
<a name="l05386"></a>05386     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l05387"></a>05387         <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05388"></a>05388         
<a name="l05389"></a>05389         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (sipo)
<a name="l05390"></a>05390             autosnap= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a8ddd7ffb9a5028e877633d4a2830dd50">autosnap</a>;
<a name="l05391"></a>05391     }
<a name="l05392"></a>05392     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l05393"></a>05393         <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05394"></a>05394         
<a name="l05395"></a>05395         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (snla)
<a name="l05396"></a>05396             autosnap= snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#a3df211992f234d0bebd62cb836ab5a7f">autosnap</a>;
<a name="l05397"></a>05397     }
<a name="l05398"></a>05398     <span class="keywordflow">else</span> {
<a name="l05399"></a>05399         autosnap= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80da256e68ebc04fa1e7294bcf71c67d870f">SACTSNAP_OFF</a>;
<a name="l05400"></a>05400     }
<a name="l05401"></a>05401     
<a name="l05402"></a>05402     <span class="comment">/* toggle autosnap on/off </span>
<a name="l05403"></a>05403 <span class="comment">     *  - when toggling on, prefer nearest frame over 1.0 frame increments</span>
<a name="l05404"></a>05404 <span class="comment">     */</span>
<a name="l05405"></a>05405     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ad0f3dbc77a3e6acefdb107c8ac244e69">modifiers</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#adc896c2472a2c2ee0479aa7c2b81fd00">MOD_SNAP_INVERT</a>) {
<a name="l05406"></a>05406         <span class="keywordflow">if</span> (autosnap)
<a name="l05407"></a>05407             autosnap= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80da256e68ebc04fa1e7294bcf71c67d870f">SACTSNAP_OFF</a>;
<a name="l05408"></a>05408         <span class="keywordflow">else</span>
<a name="l05409"></a>05409             autosnap= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dabb28c3972c6e6afc95d25b1d67c87998">SACTSNAP_FRAME</a>;
<a name="l05410"></a>05410     }
<a name="l05411"></a>05411 
<a name="l05412"></a>05412     <span class="keywordflow">return</span> autosnap;
<a name="l05413"></a>05413 }
<a name="l05414"></a>05414 
<a name="l05415"></a>05415 <span class="comment">/* This function is used for testing if an Animation Editor is displaying</span>
<a name="l05416"></a>05416 <span class="comment"> * its data in frames or seconds (and the data needing to be edited as such).</span>
<a name="l05417"></a>05417 <span class="comment"> * Returns 1 if in seconds, 0 if in frames</span>
<a name="l05418"></a>05418 <span class="comment"> */</span>
<a name="l05419"></a><a class="code" href="../../d8/d27/transform_8c.html#ad389d5ba94d0bdd2f91cfbb4772e7bca">05419</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d8/d27/transform_8c.html#ad389d5ba94d0bdd2f91cfbb4772e7bca">getAnimEdit_DrawTime</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05420"></a>05420 {
<a name="l05421"></a>05421     <span class="keywordtype">short</span> drawtime;
<a name="l05422"></a>05422 
<a name="l05423"></a>05423     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l05424"></a>05424         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05425"></a>05425         
<a name="l05426"></a>05426         drawtime = (saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#aa9c9b1bb84c77908e70219d39ed8696c">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#af4dbf3f7801297d71ef69d77c2724d0eacde1cfa09bf766b2900162ef04d5aa1d">SACTION_DRAWTIME</a>)? 1 : 0;
<a name="l05427"></a>05427     }
<a name="l05428"></a>05428     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l05429"></a>05429         <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05430"></a>05430         
<a name="l05431"></a>05431         drawtime = (snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#a026bff4124990f5b220dd2bb9636fbd9">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aad643ab4745b4dfdb884ec4c627b9552">SNLA_DRAWTIME</a>)? 1 : 0;
<a name="l05432"></a>05432     }
<a name="l05433"></a>05433     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l05434"></a>05434         <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05435"></a>05435         
<a name="l05436"></a>05436         drawtime = (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a51dd48a32323cb3efe4bf9ae6ec8a0b3">SIPO_DRAWTIME</a>)? 1 : 0;
<a name="l05437"></a>05437     }   
<a name="l05438"></a>05438     <span class="keywordflow">else</span> {
<a name="l05439"></a>05439         drawtime = 0;
<a name="l05440"></a>05440     }
<a name="l05441"></a>05441 
<a name="l05442"></a>05442     <span class="keywordflow">return</span> drawtime;
<a name="l05443"></a>05443 }
<a name="l05444"></a>05444 
<a name="l05445"></a>05445 
<a name="l05446"></a>05446 <span class="comment">/* This function is used by Animation Editor specific transform functions to do</span>
<a name="l05447"></a>05447 <span class="comment"> * the Snap Keyframe to Nearest Frame/Marker</span>
<a name="l05448"></a>05448 <span class="comment"> */</span>
<a name="l05449"></a><a class="code" href="../../d8/d27/transform_8c.html#aa447bc129805286dd2349eb676b9af41">05449</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#aa447bc129805286dd2349eb676b9af41">doAnimEdit_SnapFrame</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td, <a class="code" href="../../d1/da4/structTransData2D.html">TransData2D</a> *td2d, <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt, <span class="keywordtype">short</span> autosnap)
<a name="l05450"></a>05450 {
<a name="l05451"></a>05451     <span class="comment">/* snap key to nearest frame? */</span>
<a name="l05452"></a>05452     <span class="keywordflow">if</span> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dabb28c3972c6e6afc95d25b1d67c87998">SACTSNAP_FRAME</a>) {
<a name="l05453"></a>05453 
<a name="l05454"></a>05454 <span class="preprocessor">#if 0   </span><span class="comment">/* &#39;doTime&#39; disabled for now */</span>
<a name="l05455"></a>05455 
<a name="l05456"></a>05456         <span class="keyword">const</span> <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>;
<a name="l05457"></a>05457         <span class="keyword">const</span> <span class="keywordtype">short</span> doTime= 0; <span class="comment">//getAnimEdit_DrawTime(t); // NOTE: this works, but may be confusing behavior given the option&#39;s label, hence disabled</span>
<a name="l05458"></a>05458         <span class="keyword">const</span> <span class="keywordtype">double</span> secf= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>;
<a name="l05459"></a>05459 <span class="preprocessor">#endif</span>
<a name="l05460"></a>05460 <span class="preprocessor"></span>        <span class="keywordtype">double</span> val;
<a name="l05461"></a>05461         
<a name="l05462"></a>05462         <span class="comment">/* convert frame to nla-action time (if needed) */</span>
<a name="l05463"></a>05463         <span class="keywordflow">if</span> (adt)
<a name="l05464"></a>05464             val= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>), <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l05465"></a>05465         <span class="keywordflow">else</span>
<a name="l05466"></a>05466             val= *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>);
<a name="l05467"></a>05467         
<a name="l05468"></a>05468 <span class="preprocessor">#if 0   </span><span class="comment">/* &#39;doTime&#39; disabled for now */</span>
<a name="l05469"></a>05469 
<a name="l05470"></a>05470         <span class="comment">/* do the snapping to nearest frame/second */</span>
<a name="l05471"></a>05471         <span class="keywordflow">if</span> (doTime) {
<a name="l05472"></a>05472             val= (float)( floor((val/secf) + 0.5f) * secf );
<a name="l05473"></a>05473         }
<a name="l05474"></a>05474         <span class="keywordflow">else</span>
<a name="l05475"></a>05475 <span class="preprocessor">#endif</span>
<a name="l05476"></a>05476 <span class="preprocessor"></span>        {
<a name="l05477"></a>05477             val= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(val+0.5f);
<a name="l05478"></a>05478         }
<a name="l05479"></a>05479         
<a name="l05480"></a>05480         <span class="comment">/* convert frame out of nla-action time */</span>
<a name="l05481"></a>05481         <span class="keywordflow">if</span> (adt)
<a name="l05482"></a>05482             *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>)= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, val, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l05483"></a>05483         <span class="keywordflow">else</span>
<a name="l05484"></a>05484             *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>)= val;
<a name="l05485"></a>05485     }
<a name="l05486"></a>05486     <span class="comment">/* snap key to nearest marker? */</span>
<a name="l05487"></a>05487     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80da9ae0b824576ec622ecb336ba29cdf2b9">SACTSNAP_MARKER</a>) {
<a name="l05488"></a>05488         <span class="keywordtype">float</span> val;
<a name="l05489"></a>05489         
<a name="l05490"></a>05490         <span class="comment">/* convert frame to nla-action time (if needed) */</span>
<a name="l05491"></a>05491         <span class="keywordflow">if</span> (adt)
<a name="l05492"></a>05492             val= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>), <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l05493"></a>05493         <span class="keywordflow">else</span>
<a name="l05494"></a>05494             val= *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>);
<a name="l05495"></a>05495         
<a name="l05496"></a>05496         <span class="comment">/* snap to nearest marker */</span>
<a name="l05497"></a>05497         <span class="comment">// TODO: need some more careful checks for where data comes from</span>
<a name="l05498"></a>05498         val= (float)<a class="code" href="../../df/d12/anim__markers_8c.html#a7797c7d360bcb81e2d2c66f49fe6ac8a">ED_markers_find_nearest_marker_time</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#ad75df026c409d765b297e18f988b9d93">markers</a>, val);
<a name="l05499"></a>05499         
<a name="l05500"></a>05500         <span class="comment">/* convert frame out of nla-action time */</span>
<a name="l05501"></a>05501         <span class="keywordflow">if</span> (adt)
<a name="l05502"></a>05502             *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>)= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, val, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l05503"></a>05503         <span class="keywordflow">else</span>
<a name="l05504"></a>05504             *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>)= val;
<a name="l05505"></a>05505     }
<a name="l05506"></a>05506     
<a name="l05507"></a>05507     <span class="comment">/* if the handles are to be moved too (as side-effect of keyframes moving, to keep the general effect) </span>
<a name="l05508"></a>05508 <span class="comment">     * offset them by the same amount so that the general angles are maintained (i.e. won&#39;t change while </span>
<a name="l05509"></a>05509 <span class="comment">     * handles are free-to-roam and keyframes are snap-locked)</span>
<a name="l05510"></a>05510 <span class="comment">     */</span>
<a name="l05511"></a>05511     <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#a043bd9d65c4493bcd53d57595619d651">TD_MOVEHANDLE1</a>) &amp;&amp; td2d-&gt;<a class="code" href="../../d1/da4/structTransData2D.html#a60e526859cabe340bc26a67af8ea894b">h1</a>) {
<a name="l05512"></a>05512         td2d-&gt;<a class="code" href="../../d1/da4/structTransData2D.html#a60e526859cabe340bc26a67af8ea894b">h1</a>[0] = td2d-&gt;<a class="code" href="../../d1/da4/structTransData2D.html#a2daa32c4ea4a43122d7ea507b0a9807d">ih1</a>[0] + *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> - td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>;
<a name="l05513"></a>05513     }
<a name="l05514"></a>05514     <span class="keywordflow">if</span> ((td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a5aa009eca4e2750ba23d1c505f5b1cb5">flag</a> &amp; <a class="code" href="../../d2/d80/transform_8h.html#adc2b80f61bb862a85d415fa82cc5944c">TD_MOVEHANDLE2</a>) &amp;&amp; td2d-&gt;<a class="code" href="../../d1/da4/structTransData2D.html#ae085af0115713e2f5fe54be833a6d684">h2</a>) {
<a name="l05515"></a>05515         td2d-&gt;<a class="code" href="../../d1/da4/structTransData2D.html#ae085af0115713e2f5fe54be833a6d684">h2</a>[0] = td2d-&gt;<a class="code" href="../../d1/da4/structTransData2D.html#a20da4c5ddab6f4e0efc78d2e94a4d94d">ih2</a>[0] + *td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a> - td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>;
<a name="l05516"></a>05516     }
<a name="l05517"></a>05517 }
<a name="l05518"></a>05518 
<a name="l05519"></a>05519 <span class="comment">/* ----------------- Translation ----------------------- */</span>
<a name="l05520"></a>05520 
<a name="l05521"></a><a class="code" href="../../d2/d80/transform_8h.html#a5b3196a7c1967e92a5d888fe721a7eeb">05521</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a5b3196a7c1967e92a5d888fe721a7eeb">initTimeTranslate</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05522"></a>05522 {
<a name="l05523"></a>05523     <span class="comment">/* this tool is only really available in the Action Editor... */</span>
<a name="l05524"></a>05524     <span class="keywordflow">if</span> (!<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>)) {
<a name="l05525"></a>05525         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l05526"></a>05526     }
<a name="l05527"></a>05527 
<a name="l05528"></a>05528     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a1b694290143ef696dc875fbfc781fe95">TFM_TIME_TRANSLATE</a>;
<a name="l05529"></a>05529     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#ad202598888d93a3d69d54fea7ceae7c1">TimeTranslate</a>;
<a name="l05530"></a>05530 
<a name="l05531"></a>05531     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717ad635d6b1496fa2fba6f87068d4193246">INPUT_NONE</a>);
<a name="l05532"></a>05532 
<a name="l05533"></a>05533     <span class="comment">/* num-input has max of (n-1) */</span>
<a name="l05534"></a>05534     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l05535"></a>05535     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> = 0;
<a name="l05536"></a>05536     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a>;
<a name="l05537"></a>05537 
<a name="l05538"></a>05538     <span class="comment">/* initialize snap like for everything else */</span>
<a name="l05539"></a>05539     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l05540"></a>05540     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 1.0f;
<a name="l05541"></a>05541 
<a name="l05542"></a>05542     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l05543"></a>05543 }
<a name="l05544"></a>05544 
<a name="l05545"></a><a class="code" href="../../d8/d27/transform_8c.html#ab2ed1f518386d4c57ad53fc7ced23088">05545</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ab2ed1f518386d4c57ad53fc7ced23088">headerTimeTranslate</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l05546"></a>05546 {
<a name="l05547"></a>05547     <span class="keywordtype">char</span> tvec[60];
<a name="l05548"></a>05548 
<a name="l05549"></a>05549     <span class="comment">/* if numeric input is active, use results from that, otherwise apply snapping to result */</span>
<a name="l05550"></a>05550     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l05551"></a>05551         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l05552"></a>05552     }
<a name="l05553"></a>05553     <span class="keywordflow">else</span> {
<a name="l05554"></a>05554         <span class="keyword">const</span> <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>;
<a name="l05555"></a>05555         <span class="keyword">const</span> <span class="keywordtype">short</span> autosnap= <a class="code" href="../../d8/d27/transform_8c.html#a3a6ed67c130e61a2eca4a0dde08c9f6d">getAnimEdit_SnapMode</a>(t);
<a name="l05556"></a>05556         <span class="keyword">const</span> <span class="keywordtype">short</span> doTime = <a class="code" href="../../d8/d27/transform_8c.html#ad389d5ba94d0bdd2f91cfbb4772e7bca">getAnimEdit_DrawTime</a>(t);
<a name="l05557"></a>05557         <span class="keyword">const</span> <span class="keywordtype">double</span> secf= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>;
<a name="l05558"></a>05558         <span class="keywordtype">float</span> val = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05559"></a>05559         
<a name="l05560"></a>05560         <span class="comment">/* apply snapping + frame-&gt;seconds conversions */</span>
<a name="l05561"></a>05561         <span class="keywordflow">if</span> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dab82b024a60e07c793c07a9cb6bd31536">SACTSNAP_STEP</a>) {
<a name="l05562"></a>05562             <span class="keywordflow">if</span> (doTime)
<a name="l05563"></a>05563                 val= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>((<span class="keywordtype">double</span>)val/secf + 0.5f);
<a name="l05564"></a>05564             <span class="keywordflow">else</span>
<a name="l05565"></a>05565                 val= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(val + 0.5f);
<a name="l05566"></a>05566         }
<a name="l05567"></a>05567         <span class="keywordflow">else</span> {
<a name="l05568"></a>05568             <span class="keywordflow">if</span> (doTime)
<a name="l05569"></a>05569                 val= (float)((<span class="keywordtype">double</span>)val / secf);
<a name="l05570"></a>05570         }
<a name="l05571"></a>05571         
<a name="l05572"></a>05572         <span class="keywordflow">if</span> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dabb28c3972c6e6afc95d25b1d67c87998">SACTSNAP_FRAME</a>)
<a name="l05573"></a>05573             sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%d.00 (%.4f)&quot;</span>, (<span class="keywordtype">int</span>)val, val);
<a name="l05574"></a>05574         <span class="keywordflow">else</span>
<a name="l05575"></a>05575             sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%.4f&quot;</span>, val);
<a name="l05576"></a>05576     }
<a name="l05577"></a>05577 
<a name="l05578"></a>05578     sprintf(str, <span class="stringliteral">&quot;DeltaX: %s&quot;</span>, &amp;tvec[0]);
<a name="l05579"></a>05579 }
<a name="l05580"></a>05580 
<a name="l05581"></a><a class="code" href="../../d8/d27/transform_8c.html#a981e461d860eae66fd7763888d46550d">05581</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a981e461d860eae66fd7763888d46550d">applyTimeTranslate</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sval))
<a name="l05582"></a>05582 {
<a name="l05583"></a>05583     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05584"></a>05584     <a class="code" href="../../d1/da4/structTransData2D.html">TransData2D</a> *td2d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a887cca1d1d048a87c61be634a2ccb8ea">data2d</a>;
<a name="l05585"></a>05585     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>;
<a name="l05586"></a>05586     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05587"></a>05587 
<a name="l05588"></a>05588     <span class="keyword">const</span> <span class="keywordtype">short</span> doTime= <a class="code" href="../../d8/d27/transform_8c.html#ad389d5ba94d0bdd2f91cfbb4772e7bca">getAnimEdit_DrawTime</a>(t);
<a name="l05589"></a>05589     <span class="keyword">const</span> <span class="keywordtype">double</span> secf= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>;
<a name="l05590"></a>05590 
<a name="l05591"></a>05591     <span class="keyword">const</span> <span class="keywordtype">short</span> autosnap= <a class="code" href="../../d8/d27/transform_8c.html#a3a6ed67c130e61a2eca4a0dde08c9f6d">getAnimEdit_SnapMode</a>(t);
<a name="l05592"></a>05592 
<a name="l05593"></a>05593     <span class="keywordtype">float</span> deltax, val <span class="comment">/* , valprev */</span>;
<a name="l05594"></a>05594 
<a name="l05595"></a>05595     <span class="comment">/* it doesn&#39;t matter whether we apply to t-&gt;data or t-&gt;data2d, but t-&gt;data2d is more convenient */</span>
<a name="l05596"></a>05596     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++, td2d++) {
<a name="l05597"></a>05597         <span class="comment">/* it is assumed that td-&gt;extra is a pointer to the AnimData,</span>
<a name="l05598"></a>05598 <span class="comment">         * whose active action is where this keyframe comes from</span>
<a name="l05599"></a>05599 <span class="comment">         * (this is only valid when not in NLA)</span>
<a name="l05600"></a>05600 <span class="comment">         */</span>
<a name="l05601"></a>05601         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> != <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) ? td-&gt;extra : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05602"></a>05602 
<a name="l05603"></a>05603         <span class="comment">/* valprev = *td-&gt;val; */</span> <span class="comment">/* UNUSED */</span>
<a name="l05604"></a>05604 
<a name="l05605"></a>05605         <span class="comment">/* check if any need to apply nla-mapping */</span>
<a name="l05606"></a>05606         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (adt &amp;&amp; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> != <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l05607"></a>05607             deltax = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05608"></a>05608 
<a name="l05609"></a>05609             <span class="keywordflow">if</span> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dab82b024a60e07c793c07a9cb6bd31536">SACTSNAP_STEP</a>) {
<a name="l05610"></a>05610                 <span class="keywordflow">if</span> (doTime)
<a name="l05611"></a>05611                     deltax= (float)( floor((deltax/secf) + 0.5f) * secf );
<a name="l05612"></a>05612                 <span class="keywordflow">else</span>
<a name="l05613"></a>05613                     deltax= (float)( floor(deltax + 0.5f) );
<a name="l05614"></a>05614             }
<a name="l05615"></a>05615 
<a name="l05616"></a>05616             val = <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, td-&gt;ival, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l05617"></a>05617             val += deltax;
<a name="l05618"></a>05618             *(td-&gt;val) = <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, val, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l05619"></a>05619         }
<a name="l05620"></a>05620         <span class="keywordflow">else</span> {
<a name="l05621"></a>05621             deltax = val = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05622"></a>05622 
<a name="l05623"></a>05623             <span class="keywordflow">if</span> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dab82b024a60e07c793c07a9cb6bd31536">SACTSNAP_STEP</a>) {
<a name="l05624"></a>05624                 <span class="keywordflow">if</span> (doTime)
<a name="l05625"></a>05625                     val= (float)( floor((deltax/secf) + 0.5f) * secf );
<a name="l05626"></a>05626                 <span class="keywordflow">else</span>
<a name="l05627"></a>05627                     val= (float)( floor(val + 0.5f) );
<a name="l05628"></a>05628             }
<a name="l05629"></a>05629 
<a name="l05630"></a>05630             *(td-&gt;val) = td-&gt;ival + val;
<a name="l05631"></a>05631         }
<a name="l05632"></a>05632 
<a name="l05633"></a>05633         <span class="comment">/* apply nearest snapping */</span>
<a name="l05634"></a>05634         <a class="code" href="../../d8/d27/transform_8c.html#aa447bc129805286dd2349eb676b9af41">doAnimEdit_SnapFrame</a>(t, td, td2d, adt, autosnap);
<a name="l05635"></a>05635     }
<a name="l05636"></a>05636 }
<a name="l05637"></a>05637 
<a name="l05638"></a><a class="code" href="../../d2/d80/transform_8h.html#ad202598888d93a3d69d54fea7ceae7c1">05638</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#ad202598888d93a3d69d54fea7ceae7c1">TimeTranslate</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l05639"></a>05639 {
<a name="l05640"></a>05640     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = (<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>;
<a name="l05641"></a>05641     <span class="keywordtype">float</span> cval[2], sval[2];
<a name="l05642"></a>05642     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[200];
<a name="l05643"></a>05643 
<a name="l05644"></a>05644     <span class="comment">/* calculate translation amount from mouse movement - in &#39;time-grid space&#39; */</span>
<a name="l05645"></a>05645     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, mval[0], mval[0], &amp;cval[0], &amp;cval[1]);
<a name="l05646"></a>05646     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0], &amp;sval[0], &amp;sval[1]);
<a name="l05647"></a>05647 
<a name="l05648"></a>05648     <span class="comment">/* we only need to calculate effect for time (applyTimeTranslate only needs that) */</span>
<a name="l05649"></a>05649     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = cval[0] - sval[0];
<a name="l05650"></a>05650 
<a name="l05651"></a>05651     <span class="comment">/* handle numeric-input stuff */</span>
<a name="l05652"></a>05652     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05653"></a>05653     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0]);
<a name="l05654"></a>05654     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0];
<a name="l05655"></a>05655     <a class="code" href="../../d8/d27/transform_8c.html#ab2ed1f518386d4c57ad53fc7ced23088">headerTimeTranslate</a>(t, <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);
<a name="l05656"></a>05656 
<a name="l05657"></a>05657     <a class="code" href="../../d8/d27/transform_8c.html#a981e461d860eae66fd7763888d46550d">applyTimeTranslate</a>(t, sval[0]);
<a name="l05658"></a>05658 
<a name="l05659"></a>05659     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05660"></a>05660 
<a name="l05661"></a>05661     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);
<a name="l05662"></a>05662 
<a name="l05663"></a>05663     <span class="keywordflow">return</span> 1;
<a name="l05664"></a>05664 }
<a name="l05665"></a>05665 
<a name="l05666"></a>05666 <span class="comment">/* ----------------- Time Slide ----------------------- */</span>
<a name="l05667"></a>05667 
<a name="l05668"></a><a class="code" href="../../d2/d80/transform_8h.html#a86bf3028e20e2047ec9fddd0b1a2d215">05668</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a86bf3028e20e2047ec9fddd0b1a2d215">initTimeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05669"></a>05669 {
<a name="l05670"></a>05670     <span class="comment">/* this tool is only really available in the Action Editor... */</span>
<a name="l05671"></a>05671     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l05672"></a>05672         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05673"></a>05673 
<a name="l05674"></a>05674         <span class="comment">/* set flag for drawing stuff */</span>
<a name="l05675"></a>05675         saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#aa9c9b1bb84c77908e70219d39ed8696c">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#af4dbf3f7801297d71ef69d77c2724d0ea60327c92b8bab2686c936ec519ce34ce">SACTION_MOVING</a>;
<a name="l05676"></a>05676     }
<a name="l05677"></a>05677     <span class="keywordflow">else</span> {
<a name="l05678"></a>05678         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l05679"></a>05679     }
<a name="l05680"></a>05680 
<a name="l05681"></a>05681 
<a name="l05682"></a>05682     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a2dc512af3f5d8730985575cf15748841">TFM_TIME_SLIDE</a>;
<a name="l05683"></a>05683     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#ade638b92864326e966066547165ae80e">TimeSlide</a>;
<a name="l05684"></a>05684     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a788ceaa06af8388c0781a4970940360e">T_FREE_CUSTOMDATA</a>;
<a name="l05685"></a>05685 
<a name="l05686"></a>05686     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717ad635d6b1496fa2fba6f87068d4193246">INPUT_NONE</a>);
<a name="l05687"></a>05687 
<a name="l05688"></a>05688     <span class="comment">/* num-input has max of (n-1) */</span>
<a name="l05689"></a>05689     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l05690"></a>05690     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> = 0;
<a name="l05691"></a>05691     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a>;
<a name="l05692"></a>05692 
<a name="l05693"></a>05693     <span class="comment">/* initialize snap like for everything else */</span>
<a name="l05694"></a>05694     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l05695"></a>05695     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 1.0f;
<a name="l05696"></a>05696 
<a name="l05697"></a>05697     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l05698"></a>05698 }
<a name="l05699"></a>05699 
<a name="l05700"></a><a class="code" href="../../d8/d27/transform_8c.html#ad31988897976491b4f6be78635640a95">05700</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ad31988897976491b4f6be78635640a95">headerTimeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> sval, <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l05701"></a>05701 {
<a name="l05702"></a>05702     <span class="keywordtype">char</span> tvec[60];
<a name="l05703"></a>05703 
<a name="l05704"></a>05704     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>)) {
<a name="l05705"></a>05705         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l05706"></a>05706     }
<a name="l05707"></a>05707     <span class="keywordflow">else</span> {
<a name="l05708"></a>05708         <span class="keywordtype">float</span> minx= *((<span class="keywordtype">float</span> *)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>));
<a name="l05709"></a>05709         <span class="keywordtype">float</span> maxx= *((<span class="keywordtype">float</span> *)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>) + 1);
<a name="l05710"></a>05710         <span class="keywordtype">float</span> cval= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05711"></a>05711         <span class="keywordtype">float</span> val;
<a name="l05712"></a>05712 
<a name="l05713"></a>05713         val= 2.0f*(cval-sval) / (maxx-minx);
<a name="l05714"></a>05714         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(val, -1.0f, 1.0f);
<a name="l05715"></a>05715 
<a name="l05716"></a>05716         sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%.4f&quot;</span>, val);
<a name="l05717"></a>05717     }
<a name="l05718"></a>05718 
<a name="l05719"></a>05719     sprintf(str, <span class="stringliteral">&quot;TimeSlide: %s&quot;</span>, &amp;tvec[0]);
<a name="l05720"></a>05720 }
<a name="l05721"></a>05721 
<a name="l05722"></a><a class="code" href="../../d8/d27/transform_8c.html#a4122e7c4ba9967691981befe966e42fe">05722</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a4122e7c4ba9967691981befe966e42fe">applyTimeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">float</span> sval)
<a name="l05723"></a>05723 {
<a name="l05724"></a>05724     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05725"></a>05725     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05726"></a>05726 
<a name="l05727"></a>05727     <span class="keywordtype">float</span> minx= *((<span class="keywordtype">float</span> *)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>));
<a name="l05728"></a>05728     <span class="keywordtype">float</span> maxx= *((<span class="keywordtype">float</span> *)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>) + 1);
<a name="l05729"></a>05729 
<a name="l05730"></a>05730     <span class="comment">/* set value for drawing black line */</span>
<a name="l05731"></a>05731     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l05732"></a>05732         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05733"></a>05733         <span class="keywordtype">float</span> cvalf = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05734"></a>05734 
<a name="l05735"></a>05735         saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a1b2e5dd00b7b3aadef2aa0c574d2efd2">timeslide</a>= cvalf;
<a name="l05736"></a>05736     }
<a name="l05737"></a>05737 
<a name="l05738"></a>05738     <span class="comment">/* it doesn&#39;t matter whether we apply to t-&gt;data or t-&gt;data2d, but t-&gt;data2d is more convenient */</span>
<a name="l05739"></a>05739     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++) {
<a name="l05740"></a>05740         <span class="comment">/* it is assumed that td-&gt;extra is a pointer to the AnimData,</span>
<a name="l05741"></a>05741 <span class="comment">         * whose active action is where this keyframe comes from</span>
<a name="l05742"></a>05742 <span class="comment">         * (this is only valid when not in NLA)</span>
<a name="l05743"></a>05743 <span class="comment">         */</span>
<a name="l05744"></a>05744         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> != <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) ? td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a774f74133e2a2bf3f1087fcbbe2f566c">extra</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05745"></a>05745         <span class="keywordtype">float</span> cval = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05746"></a>05746 
<a name="l05747"></a>05747         <span class="comment">/* apply NLA-mapping to necessary values */</span>
<a name="l05748"></a>05748         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (adt)
<a name="l05749"></a>05749             cval= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, cval, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l05750"></a>05750 
<a name="l05751"></a>05751         <span class="comment">/* only apply to data if in range */</span>
<a name="l05752"></a>05752         <span class="keywordflow">if</span> ((sval &gt; minx) &amp;&amp; (sval &lt; maxx)) {
<a name="l05753"></a>05753             <span class="keywordtype">float</span> cvalc= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(cval, minx, maxx);
<a name="l05754"></a>05754             <span class="keywordtype">float</span> timefac;
<a name="l05755"></a>05755 
<a name="l05756"></a>05756             <span class="comment">/* left half? */</span>
<a name="l05757"></a>05757             <span class="keywordflow">if</span> (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> &lt; sval) {
<a name="l05758"></a>05758                 timefac= (sval - td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a>) / (sval - minx);
<a name="l05759"></a>05759                 *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>)= cvalc - timefac * (cvalc - minx);
<a name="l05760"></a>05760             }
<a name="l05761"></a>05761             <span class="keywordflow">else</span> {
<a name="l05762"></a>05762                 timefac= (td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#a36524cdc4e09bcd399a3c382f30b3d4b">ival</a> - sval) / (maxx - sval);
<a name="l05763"></a>05763                 *(td-&gt;<a class="code" href="../../d6/dc0/structTransData.html#adc3cccd7b43eb9fca0c2d214e746f259">val</a>)= cvalc + timefac * (maxx - cvalc);
<a name="l05764"></a>05764             }
<a name="l05765"></a>05765         }
<a name="l05766"></a>05766     }
<a name="l05767"></a>05767 }
<a name="l05768"></a>05768 
<a name="l05769"></a><a class="code" href="../../d2/d80/transform_8h.html#ade638b92864326e966066547165ae80e">05769</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#ade638b92864326e966066547165ae80e">TimeSlide</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l05770"></a>05770 {
<a name="l05771"></a>05771     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = (<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *)t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a1ba2869af8ef8e20c97973db7e77c3a8">view</a>;
<a name="l05772"></a>05772     <span class="keywordtype">float</span> cval[2], sval[2];
<a name="l05773"></a>05773     <span class="keywordtype">float</span> minx= *((<span class="keywordtype">float</span> *)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>));
<a name="l05774"></a>05774     <span class="keywordtype">float</span> maxx= *((<span class="keywordtype">float</span> *)(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09365c474e2cf3b570c4cca90fd797ec">customData</a>) + 1);
<a name="l05775"></a>05775     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[200];
<a name="l05776"></a>05776 
<a name="l05777"></a>05777     <span class="comment">/* calculate mouse co-ordinates */</span>
<a name="l05778"></a>05778     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, mval[0], mval[1], &amp;cval[0], &amp;cval[1]);
<a name="l05779"></a>05779     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[0], t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[1], &amp;sval[0], &amp;sval[1]);
<a name="l05780"></a>05780 
<a name="l05781"></a>05781     <span class="comment">/* t-&gt;values[0] stores cval[0], which is the current mouse-pointer location (in frames) */</span>
<a name="l05782"></a>05782     <span class="comment">// XXX Need to be able to repeat this</span>
<a name="l05783"></a>05783     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = cval[0];
<a name="l05784"></a>05784 
<a name="l05785"></a>05785     <span class="comment">/* handle numeric-input stuff */</span>
<a name="l05786"></a>05786     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0] = 2.0f*(cval[0]-sval[0]) / (maxx-minx);
<a name="l05787"></a>05787     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0]);
<a name="l05788"></a>05788     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = (maxx-minx) * t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0] / 2.0f + sval[0];
<a name="l05789"></a>05789 
<a name="l05790"></a>05790     <a class="code" href="../../d8/d27/transform_8c.html#ad31988897976491b4f6be78635640a95">headerTimeSlide</a>(t, sval[0], str);
<a name="l05791"></a>05791     <a class="code" href="../../d8/d27/transform_8c.html#a4122e7c4ba9967691981befe966e42fe">applyTimeSlide</a>(t, sval[0]);
<a name="l05792"></a>05792 
<a name="l05793"></a>05793     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05794"></a>05794 
<a name="l05795"></a>05795     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05796"></a>05796 
<a name="l05797"></a>05797     <span class="keywordflow">return</span> 1;
<a name="l05798"></a>05798 }
<a name="l05799"></a>05799 
<a name="l05800"></a>05800 <span class="comment">/* ----------------- Scaling ----------------------- */</span>
<a name="l05801"></a>05801 
<a name="l05802"></a><a class="code" href="../../d2/d80/transform_8h.html#a336a039ecb2fbc4d76bba024b820c3dd">05802</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#a336a039ecb2fbc4d76bba024b820c3dd">initTimeScale</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05803"></a>05803 {
<a name="l05804"></a>05804     <span class="keywordtype">int</span> center[2];
<a name="l05805"></a>05805 
<a name="l05806"></a>05806     <span class="comment">/* this tool is only really available in the Action Editor</span>
<a name="l05807"></a>05807 <span class="comment">     * AND NLA Editor (for strip scaling)</span>
<a name="l05808"></a>05808 <span class="comment">     */</span>
<a name="l05809"></a>05809     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) == 0) {
<a name="l05810"></a>05810         t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aea5cdfb0718277c23e7506b2c3d56952">state</a> = <a class="code" href="../../d2/d80/transform_8h.html#a74ae88a79979b68b5c7354d7d56a8dc9">TRANS_CANCEL</a>;
<a name="l05811"></a>05811     }
<a name="l05812"></a>05812 
<a name="l05813"></a>05813     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab1c1f995b48bb6b0986d2dda3349cae6">mode</a> = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84a5b7e90511827ddaaab5b2b804ef0177d">TFM_TIME_SCALE</a>;
<a name="l05814"></a>05814     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aff72dd7c5c8f19d3b68e3d945b1fbd94">transform</a> = <a class="code" href="../../d8/d27/transform_8c.html#a38ae707e2f7f9871edbaebe074584997">TimeScale</a>;
<a name="l05815"></a>05815 
<a name="l05816"></a>05816     <span class="comment">/* recalculate center2d to use CFRA and mouse Y, since that&#39;s</span>
<a name="l05817"></a>05817 <span class="comment">     * what is used in time scale */</span>
<a name="l05818"></a>05818     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l05819"></a>05819     <a class="code" href="../../d8/d27/transform_8c.html#aef669f8489b01fcab46ccd288d46f91e">projectIntView</a>(t, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a4ca0d151bd334842aca43a2ad7f37979">center</a>, center);
<a name="l05820"></a>05820     center[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>[1];
<a name="l05821"></a>05821 
<a name="l05822"></a>05822     <span class="comment">/* force a reinit with the center2d used here */</span>
<a name="l05823"></a>05823     <a class="code" href="../../d2/d80/transform_8h.html#aff34b6d705cb678da8665da376ff4871">initMouseInput</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, center, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a0bb1abe89509d5f56d3e43ffcb25543a">imval</a>);
<a name="l05824"></a>05824 
<a name="l05825"></a>05825     <a class="code" href="../../d2/d80/transform_8h.html#ae42149e1abb33ae08296ff9f6bc1c43e">initMouseInputMode</a>(t, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac00ee93f9ae1f5f565559b33e47e47d9">mouse</a>, <a class="code" href="../../d2/d80/transform_8h.html#a099812ceff67cab94a55533105aa9717af5a1aee27afb7eb9480efb62537b200f">INPUT_SPRING_FLIP</a>);
<a name="l05826"></a>05826 
<a name="l05827"></a>05827     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a9b2befec7ca57a06b493ba86b754caa6">flag</a> |= <a class="code" href="../../d2/d80/transform_8h.html#a565eee5b9aa63ea848efc1eaad663e2f">T_NULL_ONE</a>;
<a name="l05828"></a>05828     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> |= <a class="code" href="../../db/d36/ED__numinput_8h.html#a5189689ce82ddb58ae0268d4ecffe392">NUM_NULL_ONE</a>;
<a name="l05829"></a>05829 
<a name="l05830"></a>05830     <span class="comment">/* num-input has max of (n-1) */</span>
<a name="l05831"></a>05831     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a> = 0;
<a name="l05832"></a>05832     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#ae419dcf116a65cf38ef80b525d40d101">flag</a> = 0;
<a name="l05833"></a>05833     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#a27618f1e3c3462027bf070b0c1a42ef2">idx_max</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a6db8bfb6453b1574dedf7ec132b9d2f0">idx_max</a>;
<a name="l05834"></a>05834 
<a name="l05835"></a>05835     <span class="comment">/* initialize snap like for everything else */</span>
<a name="l05836"></a>05836     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[0] = 0.0f;
<a name="l05837"></a>05837     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[2] = 1.0f;
<a name="l05838"></a>05838 
<a name="l05839"></a>05839     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>.<a class="code" href="../../d9/d39/structNumInput.html#aeda7ca250b70cedebb2d4a0e13f11318">increment</a> = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a09adad6d7b12a7a1b1df808d3915edb5">snap</a>[1];
<a name="l05840"></a>05840 }
<a name="l05841"></a>05841 
<a name="l05842"></a><a class="code" href="../../d8/d27/transform_8c.html#ae0f720ad33e747340a677a318257c060">05842</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ae0f720ad33e747340a677a318257c060">headerTimeScale</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l05843"></a>05843 {
<a name="l05844"></a>05844     <span class="keywordtype">char</span> tvec[60];
<a name="l05845"></a>05845 
<a name="l05846"></a>05846     <span class="keywordflow">if</span> (<a class="code" href="../../db/d36/ED__numinput_8h.html#ad4f90597655d7ca3c6f1cce8c60e6fae">hasNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>))
<a name="l05847"></a>05847         <a class="code" href="../../db/d36/ED__numinput_8h.html#a391400dba5957c523f9cea33d03d6115">outputNumInput</a>(&amp;(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>), tvec);
<a name="l05848"></a>05848     <span class="keywordflow">else</span>
<a name="l05849"></a>05849         sprintf(&amp;tvec[0], <span class="stringliteral">&quot;%.4f&quot;</span>, t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0]);
<a name="l05850"></a>05850 
<a name="l05851"></a>05851     sprintf(str, <span class="stringliteral">&quot;ScaleX: %s&quot;</span>, &amp;tvec[0]);
<a name="l05852"></a>05852 }
<a name="l05853"></a>05853 
<a name="l05854"></a><a class="code" href="../../d8/d27/transform_8c.html#ae7f28759914b3f5c513329af8021a58c">05854</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/transform_8c.html#ae7f28759914b3f5c513329af8021a58c">applyTimeScale</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t)
<a name="l05855"></a>05855 {
<a name="l05856"></a>05856     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#adb9e829dc854299fef6de4fe815fca8f">scene</a>;
<a name="l05857"></a>05857     <a class="code" href="../../d6/dc0/structTransData.html">TransData</a> *td = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ac75a26569a9563ad153f8a4c8fe19592">data</a>;
<a name="l05858"></a>05858     <a class="code" href="../../d1/da4/structTransData2D.html">TransData2D</a> *td2d = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a887cca1d1d048a87c61be634a2ccb8ea">data2d</a>;
<a name="l05859"></a>05859     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l05860"></a>05860 
<a name="l05861"></a>05861     <span class="keyword">const</span> <span class="keywordtype">short</span> autosnap= <a class="code" href="../../d8/d27/transform_8c.html#a3a6ed67c130e61a2eca4a0dde08c9f6d">getAnimEdit_SnapMode</a>(t);
<a name="l05862"></a>05862     <span class="keyword">const</span> <span class="keywordtype">short</span> doTime= <a class="code" href="../../d8/d27/transform_8c.html#ad389d5ba94d0bdd2f91cfbb4772e7bca">getAnimEdit_DrawTime</a>(t);
<a name="l05863"></a>05863     <span class="keyword">const</span> <span class="keywordtype">double</span> secf= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>;
<a name="l05864"></a>05864 
<a name="l05865"></a>05865 
<a name="l05866"></a>05866     <span class="keywordflow">for</span> (i = 0 ; i &lt; t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a89ea08ffb986abd2ca1ba41326f1a79c">total</a>; i++, td++, td2d++) {
<a name="l05867"></a>05867         <span class="comment">/* it is assumed that td-&gt;extra is a pointer to the AnimData,</span>
<a name="l05868"></a>05868 <span class="comment">         * whose active action is where this keyframe comes from</span>
<a name="l05869"></a>05869 <span class="comment">         * (this is only valid when not in NLA)</span>
<a name="l05870"></a>05870 <span class="comment">         */</span>
<a name="l05871"></a>05871         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= (t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a212c46ebfd66c3f2d699e98e48a09e52">spacetype</a> != <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) ? td-&gt;extra : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05872"></a>05872         <span class="keywordtype">float</span> startx= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>;
<a name="l05873"></a>05873         <span class="keywordtype">float</span> fac= t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05874"></a>05874 
<a name="l05875"></a>05875         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (autosnap == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dab82b024a60e07c793c07a9cb6bd31536">SACTSNAP_STEP</a>) {
<a name="l05876"></a>05876             <span class="keywordflow">if</span> (doTime)
<a name="l05877"></a>05877                 fac= (float)( floor(fac/secf + 0.5f) * secf );
<a name="l05878"></a>05878             <span class="keywordflow">else</span>
<a name="l05879"></a>05879                 fac= (float)( floor(fac + 0.5f) );
<a name="l05880"></a>05880         }
<a name="l05881"></a>05881 
<a name="l05882"></a>05882         <span class="comment">/* check if any need to apply nla-mapping */</span>
<a name="l05883"></a>05883         <span class="keywordflow">if</span> (adt)
<a name="l05884"></a>05884             startx= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, startx, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l05885"></a>05885 
<a name="l05886"></a>05886         <span class="comment">/* now, calculate the new value */</span>
<a name="l05887"></a>05887         *(td-&gt;val) = td-&gt;ival - startx;
<a name="l05888"></a>05888         *(td-&gt;val) *= fac;
<a name="l05889"></a>05889         *(td-&gt;val) += startx;
<a name="l05890"></a>05890 
<a name="l05891"></a>05891         <span class="comment">/* apply nearest snapping */</span>
<a name="l05892"></a>05892         <a class="code" href="../../d8/d27/transform_8c.html#aa447bc129805286dd2349eb676b9af41">doAnimEdit_SnapFrame</a>(t, td, td2d, adt, autosnap);
<a name="l05893"></a>05893     }
<a name="l05894"></a>05894 }
<a name="l05895"></a>05895 
<a name="l05896"></a><a class="code" href="../../d8/d27/transform_8c.html#a38ae707e2f7f9871edbaebe074584997">05896</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/transform_8c.html#a38ae707e2f7f9871edbaebe074584997">TimeScale</a>(<a class="code" href="../../db/d6b/structTransInfo.html">TransInfo</a> *t, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]))
<a name="l05897"></a>05897 {
<a name="l05898"></a>05898     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[200];
<a name="l05899"></a>05899     
<a name="l05900"></a>05900     <span class="comment">/* handle numeric-input stuff */</span>
<a name="l05901"></a>05901     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0];
<a name="l05902"></a>05902     <a class="code" href="../../db/d36/ED__numinput_8h.html#a9be96dcce39f29ef904abec135996cb5">applyNumInput</a>(&amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a8af3c9e3e4baa98e376884dc88c4363a">num</a>, &amp;t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0]);
<a name="l05903"></a>05903     t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#a5aabb257edd4c1d6b7a3b86138a32aef">values</a>[0] = t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#aafd2596a0d1e9bc1bbe73fbfee671c3d">vec</a>[0];
<a name="l05904"></a>05904     <a class="code" href="../../d8/d27/transform_8c.html#ae0f720ad33e747340a677a318257c060">headerTimeScale</a>(t, str);
<a name="l05905"></a>05905 
<a name="l05906"></a>05906     <a class="code" href="../../d8/d27/transform_8c.html#ae7f28759914b3f5c513329af8021a58c">applyTimeScale</a>(t);
<a name="l05907"></a>05907 
<a name="l05908"></a>05908     <a class="code" href="../../d2/d80/transform_8h.html#a26c9b141cb8848b1c2f7e994ec2b9ad2">recalcData</a>(t);
<a name="l05909"></a>05909 
<a name="l05910"></a>05910     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(t-&gt;<a class="code" href="../../db/d6b/structTransInfo.html#ab9a6bdecb3b6d03618728ab2126f3177">sa</a>, str);
<a name="l05911"></a>05911 
<a name="l05912"></a>05912     <span class="keywordflow">return</span> 1;
<a name="l05913"></a>05913 }
<a name="l05914"></a>05914 
<a name="l05915"></a>05915 <span class="comment">/* ************************************ */</span>
<a name="l05916"></a>05916 
<a name="l05917"></a><a class="code" href="../../d8/d27/transform_8c.html#afcee395c11077c93ade23b3e8763cf8b">05917</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/df2/ED__transform_8h.html#a170ba07583a23f83ea232b439dbc7881">BIF_TransformSetUndo</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>))
<a name="l05918"></a>05918 {
<a name="l05919"></a>05919     <span class="comment">// TRANSFORM_FIX_ME</span>
<a name="l05920"></a>05920     <span class="comment">//Trans.undostr= str;</span>
<a name="l05921"></a>05921 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:00 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: action_select.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">action_select.c</div>  </div>
</div>
<div class="contents">
<a href="../../d8/d27/action__select_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Contributor(s): Joshua Leung</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html">BLI_dlrbTree.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html">DNA_gpencil_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de6/BKE__nla_8h.html">BKE_nla.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d6f/ED__anim__api_8h.html">ED_anim_api.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dea/ED__gpencil_8h.html">ED_gpencil.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/df9/ED__keyframes__draw_8h.html">ED_keyframes_draw.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html">ED_keyframes_edit.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d02/action__intern_8h.html">action_intern.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/* ************************************************************************** */</span>
<a name="l00070"></a>00070 <span class="comment">/* KEYFRAMES STUFF */</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/* ******************** Deselect All Operator ***************************** */</span>
<a name="l00073"></a>00073 <span class="comment">/* This operator works in one of three ways:</span>
<a name="l00074"></a>00074 <span class="comment"> *  1) (de)select all (AKEY) - test if select all or deselect all</span>
<a name="l00075"></a>00075 <span class="comment"> *  2) invert all (CTRL-IKEY) - invert selection of all keyframes</span>
<a name="l00076"></a>00076 <span class="comment"> *  3) (de)select all - no testing is done; only for use internal tools as normal function...</span>
<a name="l00077"></a>00077 <span class="comment"> */</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/* Deselects keyframes in the action editor</span>
<a name="l00080"></a>00080 <span class="comment"> *  - This is called by the deselect all operator, as well as other ones!</span>
<a name="l00081"></a>00081 <span class="comment"> *</span>
<a name="l00082"></a>00082 <span class="comment"> *  - test: check if select or deselect all</span>
<a name="l00083"></a>00083 <span class="comment"> *  - sel: how to select keyframes (SELECT_*)</span>
<a name="l00084"></a>00084 <span class="comment"> */</span>
<a name="l00085"></a><a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">00085</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">deselect_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> test, <span class="keywordtype">short</span> sel)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00088"></a>00088     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00089"></a>00089     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00090"></a>00090     
<a name="l00091"></a>00091     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00092"></a>00092     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> test_cb, sel_cb;
<a name="l00093"></a>00093     
<a name="l00094"></a>00094     <span class="comment">/* determine type-based settings */</span>
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00096"></a>00096         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00097"></a>00097     <span class="keywordflow">else</span>
<a name="l00098"></a>00098         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00099"></a>00099     
<a name="l00100"></a>00100     <span class="comment">/* filter data */</span>
<a name="l00101"></a>00101     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00102"></a>00102     
<a name="l00103"></a>00103     <span class="comment">/* init BezTriple looping data */</span>
<a name="l00104"></a>00104     test_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39aa3a47676c0cdcc866536e24fe737afdb">BEZT_OK_SELECTED</a>);
<a name="l00105"></a>00105     
<a name="l00106"></a>00106     <span class="comment">/* See if we should be selecting or deselecting */</span>
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (test) {
<a name="l00108"></a>00108         <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00109"></a>00109             <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>) {
<a name="l00110"></a>00110                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a392897cecd3df80fd295fb0b615d91b9">is_gplayer_frame_selected</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>)) {
<a name="l00111"></a>00111                     sel= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>;
<a name="l00112"></a>00112                     <span class="keywordflow">break</span>;
<a name="l00113"></a>00113                 }
<a name="l00114"></a>00114             }
<a name="l00115"></a>00115             <span class="keywordflow">else</span> {
<a name="l00116"></a>00116                 <span class="keywordflow">if</span> (<a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, test_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00117"></a>00117                     sel= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>;
<a name="l00118"></a>00118                     <span class="keywordflow">break</span>;
<a name="l00119"></a>00119                 }
<a name="l00120"></a>00120             }
<a name="l00121"></a>00121         }
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     
<a name="l00124"></a>00124     <span class="comment">/* convert sel to selectmode, and use that to get editor */</span>
<a name="l00125"></a>00125     sel_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(sel);
<a name="l00126"></a>00126     
<a name="l00127"></a>00127     <span class="comment">/* Now set the flags */</span>
<a name="l00128"></a>00128     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>)
<a name="l00130"></a>00130             <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#ac9c0b51365b3beebf5e5928956de09bf">set_gplayer_frame_selection</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, sel);
<a name="l00131"></a>00131         <span class="keywordflow">else</span>
<a name="l00132"></a>00132             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sel_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); 
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134     
<a name="l00135"></a>00135     <span class="comment">/* Cleanup */</span>
<a name="l00136"></a>00136     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment">/* ------------------- */</span>
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="../../d8/d27/action__select_8c.html#a9e7a687a4c1e49f6343c8b1f704f3ccf">00141</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#a9e7a687a4c1e49f6343c8b1f704f3ccf">actkeys_deselectall_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00144"></a>00144     
<a name="l00145"></a>00145     <span class="comment">/* get editor data */</span>
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00147"></a>00147         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00148"></a>00148         
<a name="l00149"></a>00149     <span class="comment">/* &#39;standard&#39; behavior - check if selected, then apply relevant selection */</span>
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;invert&quot;</span>))
<a name="l00151"></a>00151         <a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">deselect_action_keys</a>(&amp;ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>);
<a name="l00152"></a>00152     <span class="keywordflow">else</span>
<a name="l00153"></a>00153         <a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">deselect_action_keys</a>(&amp;ac, 1, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <span class="comment">/* set notifier that keyframe selection have changed */</span>
<a name="l00156"></a>00156     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00157"></a>00157     
<a name="l00158"></a>00158     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160  
<a name="l00161"></a><a class="code" href="../../d8/d27/action__select_8c.html#af7f1376ad258c36201d891cf87519ba7">00161</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#a1fd14f88c8046928806e8b6a9d7d36ea">ACTION_OT_select_all_toggle</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="comment">/* identifiers */</span>
<a name="l00164"></a>00164     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select All&quot;</span>;
<a name="l00165"></a>00165     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_all_toggle&quot;</span>;
<a name="l00166"></a>00166     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle selection of all keyframes&quot;</span>;
<a name="l00167"></a>00167     
<a name="l00168"></a>00168     <span class="comment">/* api callbacks */</span>
<a name="l00169"></a>00169     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#a9e7a687a4c1e49f6343c8b1f704f3ccf">actkeys_deselectall_exec</a>;
<a name="l00170"></a>00170     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00171"></a>00171     
<a name="l00172"></a>00172     <span class="comment">/* flags */</span>
<a name="l00173"></a>00173     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00174"></a>00174     
<a name="l00175"></a>00175     <span class="comment">/* props */</span>
<a name="l00176"></a>00176     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;invert&quot;</span>, 0, <span class="stringliteral">&quot;Invert&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="comment">/* ******************** Border Select Operator **************************** */</span>
<a name="l00180"></a>00180 <span class="comment">/* This operator currently works in one of three ways:</span>
<a name="l00181"></a>00181 <span class="comment"> *  -&gt; BKEY     - 1) all keyframes within region are selected (ACTKEYS_BORDERSEL_ALLKEYS)</span>
<a name="l00182"></a>00182 <span class="comment"> *  -&gt; ALT-BKEY - depending on which axis of the region was larger...</span>
<a name="l00183"></a>00183 <span class="comment"> *      -&gt; 2) x-axis, so select all frames within frame range (ACTKEYS_BORDERSEL_FRAMERANGE)</span>
<a name="l00184"></a>00184 <span class="comment"> *      -&gt; 3) y-axis, so select all frames within channels that region included (ACTKEYS_BORDERSEL_CHANNELS)</span>
<a name="l00185"></a>00185 <span class="comment"> */</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="comment">/* defines for borderselect mode */</span>
<a name="l00188"></a>00188 <span class="keyword">enum</span> {
<a name="l00189"></a><a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da200b91cf1cb633e9327bb28d9da342d9">00189</a>     <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da200b91cf1cb633e9327bb28d9da342d9">ACTKEYS_BORDERSEL_ALLKEYS</a>   = 0,
<a name="l00190"></a><a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829dade3c5ddc4f34f0a59248416a85c1c9e2">00190</a>     <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829dade3c5ddc4f34f0a59248416a85c1c9e2">ACTKEYS_BORDERSEL_FRAMERANGE</a>,
<a name="l00191"></a><a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da974f9efd1164d3012932d12aadcb5104">00191</a>     <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da974f9efd1164d3012932d12aadcb5104">ACTKEYS_BORDERSEL_CHANNELS</a>,
<a name="l00192"></a>00192 } <span class="comment">/*eActKeys_BorderSelect_Mode*/</span>;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="../../d8/d27/action__select_8c.html#a129d5fde9a376ab55082958ff2ff467e">00195</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#a129d5fde9a376ab55082958ff2ff467e">borderselect_action</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect, <span class="keywordtype">short</span> mode, <span class="keywordtype">short</span> selectmode)
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00198"></a>00198     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00199"></a>00199     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00200"></a>00200     
<a name="l00201"></a>00201     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked;
<a name="l00202"></a>00202     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb, select_cb;
<a name="l00203"></a>00203     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00204"></a>00204     <a class="code" href="../../da/d10/structrctf.html">rctf</a> rectf;
<a name="l00205"></a>00205     <span class="keywordtype">float</span> ymin=0, ymax=(float)(-<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a5f1dc2b776e0b2291eb5bf63d69cc2a7">ACHANNEL_HEIGHT_HALF</a>);
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="comment">/* convert mouse coordinates to frame ranges and channel coordinates corrected for view pan/zoom */</span>
<a name="l00208"></a>00208     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>+2, &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00209"></a>00209     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>, rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>-2, &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00210"></a>00210     
<a name="l00211"></a>00211     <span class="comment">/* filter data */</span>
<a name="l00212"></a>00212     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a9c037c92ba2a5b6b36ace05f6933fadf">ANIMFILTER_LIST_CHANNELS</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00213"></a>00213     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00214"></a>00214     
<a name="l00215"></a>00215     <span class="comment">/* get beztriple editing/validation funcs  */</span>
<a name="l00216"></a>00216     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(selectmode);
<a name="l00217"></a>00217     
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(mode, <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829dade3c5ddc4f34f0a59248416a85c1c9e2">ACTKEYS_BORDERSEL_FRAMERANGE</a>, <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da200b91cf1cb633e9327bb28d9da342d9">ACTKEYS_BORDERSEL_ALLKEYS</a>))
<a name="l00219"></a>00219         ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a2cb87e66a2560d4e0d141bbb4dddd837">BEZT_OK_FRAMERANGE</a>);
<a name="l00220"></a>00220     <span class="keywordflow">else</span>
<a name="l00221"></a>00221         ok_cb= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00222"></a>00222         
<a name="l00223"></a>00223     <span class="comment">/* init editing data */</span>
<a name="l00224"></a>00224     memset(&amp;ked, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a>));
<a name="l00225"></a>00225     
<a name="l00226"></a>00226     <span class="comment">/* loop over data, doing border select */</span>
<a name="l00227"></a>00227     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00228"></a>00228         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00229"></a>00229         
<a name="l00230"></a>00230         <span class="comment">/* get new vertical minimum extent of channel */</span>
<a name="l00231"></a>00231         ymin= ymax - <a class="code" href="../../df/d6f/ED__anim__api_8h.html#ace7eea0a257948b6a1342a5dfe914380">ACHANNEL_STEP</a>;
<a name="l00232"></a>00232         
<a name="l00233"></a>00233         <span class="comment">/* set horizontal range (if applicable) */</span>
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(mode, <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829dade3c5ddc4f34f0a59248416a85c1c9e2">ACTKEYS_BORDERSEL_FRAMERANGE</a>, <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da200b91cf1cb633e9327bb28d9da342d9">ACTKEYS_BORDERSEL_ALLKEYS</a>)) {
<a name="l00235"></a>00235             <span class="comment">/* if channel is mapped in NLA, apply correction */</span>
<a name="l00236"></a>00236             <span class="keywordflow">if</span> (adt) {
<a name="l00237"></a>00237                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l00238"></a>00238                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a>= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, rectf.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l00239"></a>00239             }
<a name="l00240"></a>00240             <span class="keywordflow">else</span> {
<a name="l00241"></a>00241                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l00242"></a>00242                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a>= rectf.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l00243"></a>00243             }
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245         
<a name="l00246"></a>00246         <span class="comment">/* perform vertical suitability check (if applicable) */</span>
<a name="l00247"></a>00247         <span class="keywordflow">if</span> ( (mode == <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829dade3c5ddc4f34f0a59248416a85c1c9e2">ACTKEYS_BORDERSEL_FRAMERANGE</a>) || 
<a name="l00248"></a>00248             !((ymax &lt; rectf.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) || (ymin &gt; rectf.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>)) )
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250             <span class="comment">/* loop over data selecting */</span>
<a name="l00251"></a>00251             <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>)
<a name="l00252"></a>00252                 <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a18f293b22ba10b0e4403171dd47a1e96">borderselect_gplayer_frames</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rectf.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, selectmode);
<a name="l00253"></a>00253             <span class="keywordflow">else</span>
<a name="l00254"></a>00254                 <a class="code" href="../../db/d71/keyframes__edit_8c.html#ac3c68ea095bf4e030872ea4a46ab99d9">ANIM_animchannel_keyframes_loop</a>(&amp;ked, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a>, ale, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256         
<a name="l00257"></a>00257         <span class="comment">/* set minimum extent to be the maximum of the next channel */</span>
<a name="l00258"></a>00258         ymax=ymin;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     
<a name="l00261"></a>00261     <span class="comment">/* cleanup */</span>
<a name="l00262"></a>00262     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">/* ------------------- */</span>
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="../../d8/d27/action__select_8c.html#a1d2dbfc9b5b446e9b4394940df47f1c3">00267</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#a1d2dbfc9b5b446e9b4394940df47f1c3">actkeys_borderselect_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00270"></a>00270     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect;
<a name="l00271"></a>00271     <span class="keywordtype">short</span> mode=0, selectmode=0;
<a name="l00272"></a>00272     <span class="keywordtype">int</span> gesture_mode, extend;
<a name="l00273"></a>00273     
<a name="l00274"></a>00274     <span class="comment">/* get editor data */</span>
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00276"></a>00276         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="comment">/* clear all selection if not extending selection */</span>
<a name="l00279"></a>00279     extend= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>);
<a name="l00280"></a>00280     <span class="keywordflow">if</span> (!extend)
<a name="l00281"></a>00281         <a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">deselect_action_keys</a>(&amp;ac, 1, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>);
<a name="l00282"></a>00282     
<a name="l00283"></a>00283     <span class="comment">/* get settings from operator */</span>
<a name="l00284"></a>00284     rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;xmin&quot;</span>);
<a name="l00285"></a>00285     rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;ymin&quot;</span>);
<a name="l00286"></a>00286     rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;xmax&quot;</span>);
<a name="l00287"></a>00287     rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;ymax&quot;</span>);
<a name="l00288"></a>00288         
<a name="l00289"></a>00289     gesture_mode= <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;gesture_mode&quot;</span>);
<a name="l00290"></a>00290     <span class="keywordflow">if</span> (gesture_mode == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99328936c1f7e4fc8d4a889098d4d22d">GESTURE_MODAL_SELECT</a>)
<a name="l00291"></a>00291         selectmode = <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l00292"></a>00292     <span class="keywordflow">else</span>
<a name="l00293"></a>00293         selectmode = <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>;
<a name="l00294"></a>00294     
<a name="l00295"></a>00295     <span class="comment">/* selection &#39;mode&#39; depends on whether borderselect region only matters on one axis */</span>
<a name="l00296"></a>00296     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;axis_range&quot;</span>)) {
<a name="l00297"></a>00297         <span class="comment">/* mode depends on which axis of the range is larger to determine which axis to use </span>
<a name="l00298"></a>00298 <span class="comment">         *  - checking this in region-space is fine, as it&#39;s fundamentally still going to be a different rect size</span>
<a name="l00299"></a>00299 <span class="comment">         *  - the frame-range select option is favored over the channel one (x over y), as frame-range one is often</span>
<a name="l00300"></a>00300 <span class="comment">         *    used for tweaking timing when &quot;blocking&quot;, while channels is not that useful...</span>
<a name="l00301"></a>00301 <span class="comment">         */</span>
<a name="l00302"></a>00302         <span class="keywordflow">if</span> ((rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>) &gt;= (rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>))
<a name="l00303"></a>00303             mode= <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829dade3c5ddc4f34f0a59248416a85c1c9e2">ACTKEYS_BORDERSEL_FRAMERANGE</a>;
<a name="l00304"></a>00304         <span class="keywordflow">else</span>
<a name="l00305"></a>00305             mode= <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da974f9efd1164d3012932d12aadcb5104">ACTKEYS_BORDERSEL_CHANNELS</a>;
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307     <span class="keywordflow">else</span> 
<a name="l00308"></a>00308         mode= <a class="code" href="../../d8/d27/action__select_8c.html#a1b7b7893d940926615b39239ac05829da200b91cf1cb633e9327bb28d9da342d9">ACTKEYS_BORDERSEL_ALLKEYS</a>;
<a name="l00309"></a>00309     
<a name="l00310"></a>00310     <span class="comment">/* apply borderselect action */</span>
<a name="l00311"></a>00311     <a class="code" href="../../d8/d27/action__select_8c.html#a129d5fde9a376ab55082958ff2ff467e">borderselect_action</a>(&amp;ac, rect, mode, selectmode);
<a name="l00312"></a>00312     
<a name="l00313"></a>00313     <span class="comment">/* set notifier that keyframe selection have changed */</span>
<a name="l00314"></a>00314     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00315"></a>00315     
<a name="l00316"></a>00316     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00317"></a>00317 } 
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="../../d8/d27/action__select_8c.html#a8dbf2967bd4b8f738797d5c1e1ee3463">00319</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#a3677f73982d21342cb44fd633d57c35c">ACTION_OT_select_border</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="comment">/* identifiers */</span>
<a name="l00322"></a>00322     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Border Select&quot;</span>;
<a name="l00323"></a>00323     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_border&quot;</span>;
<a name="l00324"></a>00324     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select all keyframes within the specified region&quot;</span>;
<a name="l00325"></a>00325     
<a name="l00326"></a>00326     <span class="comment">/* api callbacks */</span>
<a name="l00327"></a>00327     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a8d45022b7baa1add659b6798c15601b1">WM_border_select_invoke</a>;
<a name="l00328"></a>00328     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#a1d2dbfc9b5b446e9b4394940df47f1c3">actkeys_borderselect_exec</a>;
<a name="l00329"></a>00329     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#ab6bb53ebc07c5ca59c0a1a687124de2b">WM_border_select_modal</a>;
<a name="l00330"></a>00330     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a30c4cae4bcb919d6519d9a1b5b77cdb0">WM_border_select_cancel</a>;
<a name="l00331"></a>00331     
<a name="l00332"></a>00332     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00333"></a>00333     
<a name="l00334"></a>00334     <span class="comment">/* flags */</span>
<a name="l00335"></a>00335     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00336"></a>00336     
<a name="l00337"></a>00337     <span class="comment">/* rna */</span>
<a name="l00338"></a>00338     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7df9a6eccb78facfa397098a5ad2bc4a">WM_operator_properties_gesture_border</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00339"></a>00339     
<a name="l00340"></a>00340     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;axis_range&quot;</span>, 0, <span class="stringliteral">&quot;Axis Range&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="comment">/* ******************** Column Select Operator **************************** */</span>
<a name="l00344"></a>00344 <span class="comment">/* This operator works in one of four ways:</span>
<a name="l00345"></a>00345 <span class="comment"> *  - 1) select all keyframes in the same frame as a selected one  (KKEY)</span>
<a name="l00346"></a>00346 <span class="comment"> *  - 2) select all keyframes in the same frame as the current frame marker (CTRL-KKEY)</span>
<a name="l00347"></a>00347 <span class="comment"> *  - 3) select all keyframes in the same frame as a selected markers (SHIFT-KKEY)</span>
<a name="l00348"></a>00348 <span class="comment"> *  - 4) select all keyframes that occur between selected markers (ALT-KKEY)</span>
<a name="l00349"></a>00349 <span class="comment"> */</span>
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">/* defines for column-select mode */</span>
<a name="l00352"></a><a class="code" href="../../d8/d27/action__select_8c.html#a8b1e5a19115dfa70e4d1f851567781e8">00352</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d8/d27/action__select_8c.html#a8b1e5a19115dfa70e4d1f851567781e8">prop_column_select_types</a>[] = {
<a name="l00353"></a>00353     {<a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dadadd93381c9d579ee872c58c70dffc249b">ACTKEYS_COLUMNSEL_KEYS</a>, <span class="stringliteral">&quot;KEYS&quot;</span>, 0, <span class="stringliteral">&quot;On Selected Keyframes&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00354"></a>00354     {<a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dada2a51deb310a0edaab982f33e65653ced">ACTKEYS_COLUMNSEL_CFRA</a>, <span class="stringliteral">&quot;CFRA&quot;</span>, 0, <span class="stringliteral">&quot;On Current Frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00355"></a>00355     {<a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dadab4902928632425c08a4175e14df89568">ACTKEYS_COLUMNSEL_MARKERS_COLUMN</a>, <span class="stringliteral">&quot;MARKERS_COLUMN&quot;</span>, 0, <span class="stringliteral">&quot;On Selected Markers&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00356"></a>00356     {<a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dada42e7a7785991bd8195e2ad32f6b3bd42">ACTKEYS_COLUMNSEL_MARKERS_BETWEEN</a>, <span class="stringliteral">&quot;MARKERS_BETWEEN&quot;</span>, 0, <span class="stringliteral">&quot;Between Min/Max Selected Markers&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00357"></a>00357     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00358"></a>00358 };
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="comment">/* ------------------- */</span> 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="comment">/* Selects all visible keyframes between the specified markers */</span>
<a name="l00363"></a>00363 <span class="comment">/* TODO, this is almost an _exact_ duplicate of a function of the same name in graph_select.c</span>
<a name="l00364"></a>00364 <span class="comment"> * should de-duplicate - campbell */</span>
<a name="l00365"></a><a class="code" href="../../d8/d27/action__select_8c.html#ab35639eb4ba5466732f49e6079f19584">00365</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#ab35639eb4ba5466732f49e6079f19584">markers_selectkeys_between</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00368"></a>00368     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00369"></a>00369     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00370"></a>00370     
<a name="l00371"></a>00371     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb, select_cb;
<a name="l00372"></a>00372     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00373"></a>00373     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00374"></a>00374     
<a name="l00375"></a>00375     <span class="comment">/* get extreme markers */</span>
<a name="l00376"></a>00376     <a class="code" href="../../df/d12/anim__markers_8c.html#a7cb68faae882cb7e57da326dc69530e4">ED_markers_get_minmax</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>, 1, &amp;min, &amp;max);
<a name="l00377"></a>00377     min -= 0.5f;
<a name="l00378"></a>00378     max += 0.5f;
<a name="l00379"></a>00379     
<a name="l00380"></a>00380     <span class="comment">/* get editing funcs + data */</span>
<a name="l00381"></a>00381     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a2cb87e66a2560d4e0d141bbb4dddd837">BEZT_OK_FRAMERANGE</a>);
<a name="l00382"></a>00382     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>; 
<a name="l00385"></a>00385     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a>= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00386"></a>00386     
<a name="l00387"></a>00387     <span class="comment">/* filter data */</span>
<a name="l00388"></a>00388     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY */</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00389"></a>00389     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00390"></a>00390     
<a name="l00391"></a>00391     <span class="comment">/* select keys in-between */</span>
<a name="l00392"></a>00392     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00393"></a>00393         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00394"></a>00394         
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (adt) {
<a name="l00396"></a>00396             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1);
<a name="l00397"></a>00397             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00398"></a>00398             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>) {
<a name="l00401"></a>00401             <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a18f293b22ba10b0e4403171dd47a1e96">borderselect_gplayer_frames</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, min, max, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403         <span class="keywordflow">else</span> {
<a name="l00404"></a>00404             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407     
<a name="l00408"></a>00408     <span class="comment">/* Cleanup */</span>
<a name="l00409"></a>00409     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="comment">/* Selects all visible keyframes in the same frames as the specified elements */</span>
<a name="l00414"></a><a class="code" href="../../d8/d27/action__select_8c.html#abc8275180d973268a8ea17b592432f09">00414</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#abc8275180d973268a8ea17b592432f09">columnselect_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode)
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00417"></a>00417     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00418"></a>00418     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00419"></a>00419     
<a name="l00420"></a>00420     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00421"></a>00421     <a class="code" href="../../db/d00/structCfraElem.html">CfraElem</a> *ce;
<a name="l00422"></a>00422     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> select_cb, ok_cb;
<a name="l00423"></a>00423     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00424"></a>00424     
<a name="l00425"></a>00425     <span class="comment">/* initialize keyframe editing data */</span>
<a name="l00426"></a>00426     
<a name="l00427"></a>00427     <span class="comment">/* build list of columns */</span>
<a name="l00428"></a>00428     <span class="keywordflow">switch</span> (mode) {
<a name="l00429"></a>00429         <span class="keywordflow">case</span> <a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dadadd93381c9d579ee872c58c70dffc249b">ACTKEYS_COLUMNSEL_KEYS</a>: <span class="comment">/* list of selected keys */</span>
<a name="l00430"></a>00430             <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) {
<a name="l00431"></a>00431                 filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a>);
<a name="l00432"></a>00432                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00433"></a>00433                 
<a name="l00434"></a>00434                 <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l00435"></a>00435                     <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a218485d02b4c03ada20a1adf8b4b4738">gplayer_make_cfra_list</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, &amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>, 1);
<a name="l00436"></a>00436             }
<a name="l00437"></a>00437             <span class="keywordflow">else</span> {
<a name="l00438"></a>00438                 filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span>);
<a name="l00439"></a>00439                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00440"></a>00440                 
<a name="l00441"></a>00441                 <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l00442"></a>00442                     <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d71/keyframes__edit_8c.html#ab01a4640feb02d522fa94fe1b06328cb">bezt_to_cfraelem</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00443"></a>00443             }
<a name="l00444"></a>00444             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00445"></a>00445             <span class="keywordflow">break</span>;
<a name="l00446"></a>00446             
<a name="l00447"></a>00447         <span class="keywordflow">case</span> <a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dada2a51deb310a0edaab982f33e65653ced">ACTKEYS_COLUMNSEL_CFRA</a>: <span class="comment">/* current frame */</span>
<a name="l00448"></a>00448             <span class="comment">/* make a single CfraElem for storing this */</span>
<a name="l00449"></a>00449             ce= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/d00/structCfraElem.html">CfraElem</a>), <span class="stringliteral">&quot;cfraElem&quot;</span>);
<a name="l00450"></a>00450             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>, ce);
<a name="l00451"></a>00451             
<a name="l00452"></a>00452             ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a>= (float)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>;
<a name="l00453"></a>00453             <span class="keywordflow">break</span>;
<a name="l00454"></a>00454             
<a name="l00455"></a>00455         <span class="keywordflow">case</span> <a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dadab4902928632425c08a4175e14df89568">ACTKEYS_COLUMNSEL_MARKERS_COLUMN</a>: <span class="comment">/* list of selected markers */</span>
<a name="l00456"></a>00456             <a class="code" href="../../df/d12/anim__markers_8c.html#a1d5d03257253a65f19e588ffe3b22036">ED_markers_make_cfra_list</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>, &amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l00457"></a>00457             <span class="keywordflow">break</span>;
<a name="l00458"></a>00458             
<a name="l00459"></a>00459         <span class="keywordflow">default</span>: <span class="comment">/* invalid option */</span>
<a name="l00460"></a>00460             <span class="keywordflow">return</span>;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462     
<a name="l00463"></a>00463     <span class="comment">/* set up BezTriple edit callbacks */</span>
<a name="l00464"></a>00464     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00465"></a>00465     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a4a09064815ad73e482e1293530e146cd">BEZT_OK_FRAME</a>);
<a name="l00466"></a>00466     
<a name="l00467"></a>00467     <span class="comment">/* loop through all of the keys and select additional keyframes</span>
<a name="l00468"></a>00468 <span class="comment">     * based on the keys found to be selected above</span>
<a name="l00469"></a>00469 <span class="comment">     */</span>
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00471"></a>00471         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a>);
<a name="l00472"></a>00472     <span class="keywordflow">else</span>
<a name="l00473"></a>00473         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span>);
<a name="l00474"></a>00474     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00475"></a>00475     
<a name="l00476"></a>00476     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00477"></a>00477         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00478"></a>00478         
<a name="l00479"></a>00479         <span class="comment">/* loop over cfraelems (stored in the KeyframeEditData-&gt;list)</span>
<a name="l00480"></a>00480 <span class="comment">         *  - we need to do this here, as we can apply fewer NLA-mapping conversions</span>
<a name="l00481"></a>00481 <span class="comment">         */</span>
<a name="l00482"></a>00482         <span class="keywordflow">for</span> (ce= ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ce; ce= ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#ab87202e5ec809b32216d4c8f5f2cde42">next</a>) {
<a name="l00483"></a>00483             <span class="comment">/* set frame for validation callback to refer to */</span>
<a name="l00484"></a>00484             <span class="keywordflow">if</span> (adt)
<a name="l00485"></a>00485                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a>, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l00486"></a>00486             <span class="keywordflow">else</span>
<a name="l00487"></a>00487                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a>;
<a name="l00488"></a>00488             
<a name="l00489"></a>00489             <span class="comment">/* select elements with frame number matching cfraelem */</span>
<a name="l00490"></a>00490             <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>)
<a name="l00491"></a>00491                 <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a5ea863b1ee98a2a17ee0c2d7b2a30a0f">select_gpencil_frame</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a>, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00492"></a>00492             <span class="keywordflow">else</span>
<a name="l00493"></a>00493                 <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496     
<a name="l00497"></a>00497     <span class="comment">/* free elements */</span>
<a name="l00498"></a>00498     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>);
<a name="l00499"></a>00499     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">/* ------------------- */</span>
<a name="l00503"></a>00503 
<a name="l00504"></a><a class="code" href="../../d8/d27/action__select_8c.html#a66e285b0a83a73258391c10dae364e3c">00504</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#a66e285b0a83a73258391c10dae364e3c">actkeys_columnselect_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00507"></a>00507     <span class="keywordtype">short</span> mode;
<a name="l00508"></a>00508     
<a name="l00509"></a>00509     <span class="comment">/* get editor data */</span>
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00511"></a>00511         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00512"></a>00512         
<a name="l00513"></a>00513     <span class="comment">/* action to take depends on the mode */</span>
<a name="l00514"></a>00514     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (mode == <a class="code" href="../../df/d02/action__intern_8h.html#a01aea4eb01aa6415eee118b5a5ee3dada42e7a7785991bd8195e2ad32f6b3bd42">ACTKEYS_COLUMNSEL_MARKERS_BETWEEN</a>)
<a name="l00517"></a>00517         <a class="code" href="../../d8/d27/action__select_8c.html#ab35639eb4ba5466732f49e6079f19584">markers_selectkeys_between</a>(&amp;ac);
<a name="l00518"></a>00518     <span class="keywordflow">else</span>
<a name="l00519"></a>00519         <a class="code" href="../../d8/d27/action__select_8c.html#abc8275180d973268a8ea17b592432f09">columnselect_action_keys</a>(&amp;ac, mode);
<a name="l00520"></a>00520     
<a name="l00521"></a>00521     <span class="comment">/* set notifier that keyframe selection have changed */</span>
<a name="l00522"></a>00522     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00523"></a>00523     
<a name="l00524"></a>00524     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526  
<a name="l00527"></a><a class="code" href="../../d8/d27/action__select_8c.html#a1fe8008d27a3e73c8667e36559f61301">00527</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#a575e037e16bd35690c362d75b9ae8fad">ACTION_OT_select_column</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529     <span class="comment">/* identifiers */</span>
<a name="l00530"></a>00530     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select All&quot;</span>;
<a name="l00531"></a>00531     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_column&quot;</span>;
<a name="l00532"></a>00532     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select all keyframes on the specified frame(s)&quot;</span>;
<a name="l00533"></a>00533     
<a name="l00534"></a>00534     <span class="comment">/* api callbacks */</span>
<a name="l00535"></a>00535     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#a66e285b0a83a73258391c10dae364e3c">actkeys_columnselect_exec</a>;
<a name="l00536"></a>00536     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00537"></a>00537     
<a name="l00538"></a>00538     <span class="comment">/* flags */</span>
<a name="l00539"></a>00539     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00540"></a>00540     
<a name="l00541"></a>00541     <span class="comment">/* props */</span>
<a name="l00542"></a>00542     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, prop_column_select_types, 0, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 <span class="comment">/* ******************** Select Linked Operator *********************** */</span>
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="../../d8/d27/action__select_8c.html#a437d42bc29ca8c0643cb4becc02882b1">00547</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#a437d42bc29ca8c0643cb4becc02882b1">actkeys_select_linked_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00550"></a>00550     
<a name="l00551"></a>00551     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00552"></a>00552     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00553"></a>00553     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb = <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39aa3a47676c0cdcc866536e24fe737afdb">BEZT_OK_SELECTED</a>);
<a name="l00556"></a>00556     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> sel_cb = <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00557"></a>00557     
<a name="l00558"></a>00558     <span class="comment">/* get editor data */</span>
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00560"></a>00560         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00561"></a>00561     
<a name="l00562"></a>00562     <span class="comment">/* loop through all of the keys and select additional keyframes based on these */</span>
<a name="l00563"></a>00563     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00564"></a>00564     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00565"></a>00565     
<a name="l00566"></a>00566     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00567"></a>00567         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00568"></a>00568         
<a name="l00569"></a>00569         <span class="comment">/* check if anything selected? */</span>
<a name="l00570"></a>00570         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ok_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00571"></a>00571             <span class="comment">/* select every keyframe in this curve then */</span>
<a name="l00572"></a>00572             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sel_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575     
<a name="l00576"></a>00576     <span class="comment">/* Cleanup */</span>
<a name="l00577"></a>00577     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00578"></a>00578     
<a name="l00579"></a>00579     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00580"></a>00580     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00581"></a>00581     
<a name="l00582"></a>00582     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00585"></a><a class="code" href="../../d8/d27/action__select_8c.html#ada7be047d27344586b3eab2329dd1dc1">00585</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#acbff6c2901bf3bc8b3232da69624bc24">ACTION_OT_select_linked</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <span class="comment">/* identifiers */</span>
<a name="l00588"></a>00588     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Linked&quot;</span>;
<a name="l00589"></a>00589     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_linked&quot;</span>;
<a name="l00590"></a>00590     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes occurring in the same F-Curves as selected ones&quot;</span>;
<a name="l00591"></a>00591     
<a name="l00592"></a>00592     <span class="comment">/* api callbacks */</span>
<a name="l00593"></a>00593     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#a437d42bc29ca8c0643cb4becc02882b1">actkeys_select_linked_exec</a>;
<a name="l00594"></a>00594     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00595"></a>00595     
<a name="l00596"></a>00596     <span class="comment">/* flags */</span>
<a name="l00597"></a>00597     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="comment">/* ******************** Select More/Less Operators *********************** */</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="comment">/* Common code to perform selection */</span>
<a name="l00603"></a><a class="code" href="../../d8/d27/action__select_8c.html#abcb14d0a0339556b81a317cf2a0f705a">00603</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#abcb14d0a0339556b81a317cf2a0f705a">select_moreless_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00606"></a>00606     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00607"></a>00607     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00608"></a>00608     
<a name="l00609"></a>00609     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00610"></a>00610     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> build_cb;
<a name="l00611"></a>00611     
<a name="l00612"></a>00612     
<a name="l00613"></a>00613     <span class="comment">/* init selmap building data */</span>
<a name="l00614"></a>00614     build_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ab471bd100d29dc73ad9a9756de7d8575">ANIM_editkeyframes_buildselmap</a>(mode);
<a name="l00615"></a>00615     
<a name="l00616"></a>00616     <span class="comment">/* loop through all of the keys and select additional keyframes based on these */</span>
<a name="l00617"></a>00617     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00618"></a>00618     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00619"></a>00619     
<a name="l00620"></a>00620     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00621"></a>00621         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00622"></a>00622         
<a name="l00623"></a>00623         <span class="comment">/* only continue if F-Curve has keyframes */</span>
<a name="l00624"></a>00624         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00625"></a>00625             <span class="keywordflow">continue</span>;
<a name="l00626"></a>00626         
<a name="l00627"></a>00627         <span class="comment">/* build up map of whether F-Curve&#39;s keyframes should be selected or not */</span>
<a name="l00628"></a>00628         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>, <span class="stringliteral">&quot;selmap actEdit more&quot;</span>);
<a name="l00629"></a>00629         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, build_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00630"></a>00630         
<a name="l00631"></a>00631         <span class="comment">/* based on this map, adjust the selection status of the keyframes */</span>
<a name="l00632"></a>00632         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d71/keyframes__edit_8c.html#a23529aac61a04e34f494fb916ff3687d">bezt_selmap_flush</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00633"></a>00633         
<a name="l00634"></a>00634         <span class="comment">/* free the selmap used here */</span>
<a name="l00635"></a>00635         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>);
<a name="l00636"></a>00636         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638     
<a name="l00639"></a>00639     <span class="comment">/* Cleanup */</span>
<a name="l00640"></a>00640     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00641"></a>00641 }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 <span class="comment">/* ----------------- */</span>
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="../../d8/d27/action__select_8c.html#afc850628c962c87c3afa45c19497aa22">00645</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#afc850628c962c87c3afa45c19497aa22">actkeys_select_more_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00648"></a>00648     
<a name="l00649"></a>00649     <span class="comment">/* get editor data */</span>
<a name="l00650"></a>00650     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00651"></a>00651         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00652"></a>00652     
<a name="l00653"></a>00653     <span class="comment">/* perform select changes */</span>
<a name="l00654"></a>00654     <a class="code" href="../../d8/d27/action__select_8c.html#abcb14d0a0339556b81a317cf2a0f705a">select_moreless_action_keys</a>(&amp;ac, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ace2d6e55f37527adb63d403141ec9cf4a3964dfb75cae2ecc21cde2d532fd952c">SELMAP_MORE</a>);
<a name="l00655"></a>00655     
<a name="l00656"></a>00656     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00657"></a>00657     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00658"></a>00658     
<a name="l00659"></a>00659     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00660"></a>00660 }
<a name="l00661"></a>00661 
<a name="l00662"></a><a class="code" href="../../d8/d27/action__select_8c.html#afe5464d04acbdb7f313065152c4937fc">00662</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#a441a98a4c6e437ae0c71ad9889c6c6a3">ACTION_OT_select_more</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00663"></a>00663 {
<a name="l00664"></a>00664     <span class="comment">/* identifiers */</span>
<a name="l00665"></a>00665     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select More&quot;</span>;
<a name="l00666"></a>00666     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_more&quot;</span>;
<a name="l00667"></a>00667     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes beside already selected ones&quot;</span>;
<a name="l00668"></a>00668     
<a name="l00669"></a>00669     <span class="comment">/* api callbacks */</span>
<a name="l00670"></a>00670     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#afc850628c962c87c3afa45c19497aa22">actkeys_select_more_exec</a>;
<a name="l00671"></a>00671     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     <span class="comment">/* flags */</span>
<a name="l00674"></a>00674     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 <span class="comment">/* ----------------- */</span>
<a name="l00678"></a>00678 
<a name="l00679"></a><a class="code" href="../../d8/d27/action__select_8c.html#afb50ba983ebbe6d999b081c56cc90c17">00679</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#afb50ba983ebbe6d999b081c56cc90c17">actkeys_select_less_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00680"></a>00680 {
<a name="l00681"></a>00681     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00682"></a>00682     
<a name="l00683"></a>00683     <span class="comment">/* get editor data */</span>
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00685"></a>00685         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00686"></a>00686     
<a name="l00687"></a>00687     <span class="comment">/* perform select changes */</span>
<a name="l00688"></a>00688     <a class="code" href="../../d8/d27/action__select_8c.html#abcb14d0a0339556b81a317cf2a0f705a">select_moreless_action_keys</a>(&amp;ac, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ace2d6e55f37527adb63d403141ec9cf4add3f60ed8b19160a4f0ab471ddcf83a0">SELMAP_LESS</a>);
<a name="l00689"></a>00689     
<a name="l00690"></a>00690     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00691"></a>00691     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00692"></a>00692     
<a name="l00693"></a>00693     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="../../d8/d27/action__select_8c.html#a33c754ffc29b101f091c41c6e6549998">00696</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#a766f8b9c7f8805c68ec7733aba73ed7c">ACTION_OT_select_less</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698     <span class="comment">/* identifiers */</span>
<a name="l00699"></a>00699     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Less&quot;</span>;
<a name="l00700"></a>00700     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_less&quot;</span>;
<a name="l00701"></a>00701     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Deselect keyframes on ends of selection islands&quot;</span>;
<a name="l00702"></a>00702     
<a name="l00703"></a>00703     <span class="comment">/* api callbacks */</span>
<a name="l00704"></a>00704     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#afb50ba983ebbe6d999b081c56cc90c17">actkeys_select_less_exec</a>;
<a name="l00705"></a>00705     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00706"></a>00706     
<a name="l00707"></a>00707     <span class="comment">/* flags */</span>
<a name="l00708"></a>00708     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711 <span class="comment">/* ******************** Select Left/Right Operator ************************* */</span>
<a name="l00712"></a>00712 <span class="comment">/* Select keyframes left/right of the current frame indicator */</span>
<a name="l00713"></a>00713 
<a name="l00714"></a>00714 <span class="comment">/* defines for left-right select tool */</span>
<a name="l00715"></a><a class="code" href="../../d8/d27/action__select_8c.html#a8474ce3f0d22c403cb43a4d067303997">00715</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d8/d27/action__select_8c.html#a8474ce3f0d22c403cb43a4d067303997">prop_actkeys_leftright_select_types</a>[] = {
<a name="l00716"></a>00716     {<a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aa12338f4126bcd473c7543c47d8f6985">ACTKEYS_LRSEL_TEST</a>, <span class="stringliteral">&quot;CHECK&quot;</span>, 0, <span class="stringliteral">&quot;Check if Select Left or Right&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00717"></a>00717     {<a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058ac9838d2b9549ced1e2be6ea36c91e5ab">ACTKEYS_LRSEL_LEFT</a>, <span class="stringliteral">&quot;LEFT&quot;</span>, 0, <span class="stringliteral">&quot;Before current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00718"></a>00718     {<a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aedb2e1502c68bf35d7480a023e185d4c">ACTKEYS_LRSEL_RIGHT</a>, <span class="stringliteral">&quot;RIGHT&quot;</span>, 0, <span class="stringliteral">&quot;After current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00719"></a>00719     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00720"></a>00720 };
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 <span class="comment">/* --------------------------------- */</span>
<a name="l00723"></a>00723 
<a name="l00724"></a><a class="code" href="../../d8/d27/action__select_8c.html#a7cf0113706e78bf03c4d96993fe5e7a4">00724</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#a7cf0113706e78bf03c4d96993fe5e7a4">actkeys_select_leftright</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> leftright, <span class="keywordtype">short</span> select_mode)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00727"></a>00727     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00728"></a>00728     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00729"></a>00729     
<a name="l00730"></a>00730     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb, select_cb;
<a name="l00731"></a>00731     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00732"></a>00732     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00733"></a>00733     
<a name="l00734"></a>00734     <span class="comment">/* if select mode is replace, deselect all keyframes (and channels) first */</span>
<a name="l00735"></a>00735     <span class="keywordflow">if</span> (select_mode==<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>) {
<a name="l00736"></a>00736         select_mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l00737"></a>00737         
<a name="l00738"></a>00738         <span class="comment">/* - deselect all other keyframes, so that just the newly selected remain</span>
<a name="l00739"></a>00739 <span class="comment">         * - channels aren&#39;t deselected, since we don&#39;t re-select any as a consequence</span>
<a name="l00740"></a>00740 <span class="comment">         */</span>
<a name="l00741"></a>00741         <a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">deselect_action_keys</a>(ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>);
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     
<a name="l00744"></a>00744     <span class="comment">/* set callbacks and editing data */</span>
<a name="l00745"></a>00745     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a2cb87e66a2560d4e0d141bbb4dddd837">BEZT_OK_FRAMERANGE</a>);
<a name="l00746"></a>00746     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(select_mode);
<a name="l00747"></a>00747     
<a name="l00748"></a>00748     <span class="keywordflow">if</span> (leftright == <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058ac9838d2b9549ced1e2be6ea36c91e5ab">ACTKEYS_LRSEL_LEFT</a>) {
<a name="l00749"></a>00749         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aee77b92451acc33c76f651b7385575b2">MINAFRAMEF</a>;
<a name="l00750"></a>00750         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a> = (float)(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a> + 0.1f);
<a name="l00751"></a>00751     } 
<a name="l00752"></a>00752     <span class="keywordflow">else</span> {
<a name="l00753"></a>00753         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a> = (float)(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a> - 0.1f);
<a name="l00754"></a>00754         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>;
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756     
<a name="l00757"></a>00757     <span class="comment">/* filter data */</span>
<a name="l00758"></a>00758     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00759"></a>00759         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00760"></a>00760     <span class="keywordflow">else</span>
<a name="l00761"></a>00761         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00762"></a>00762     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00763"></a>00763         
<a name="l00764"></a>00764     <span class="comment">/* select keys */</span>
<a name="l00765"></a>00765     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00766"></a>00766         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00767"></a>00767         
<a name="l00768"></a>00768         <span class="keywordflow">if</span> (adt) {
<a name="l00769"></a>00769             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1);
<a name="l00770"></a>00770             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00771"></a>00771             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l00772"></a>00772         }
<a name="l00773"></a>00773         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>) 
<a name="l00774"></a>00774             <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a18f293b22ba10b0e4403171dd47a1e96">borderselect_gplayer_frames</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>, ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a>, select_mode);
<a name="l00775"></a>00775         <span class="keywordflow">else</span>
<a name="l00776"></a>00776             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778     
<a name="l00779"></a>00779     <span class="comment">/* Sync marker support */</span>
<a name="l00780"></a>00780     <span class="keywordflow">if</span> (select_mode==<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>) {
<a name="l00781"></a>00781         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l00782"></a>00782         
<a name="l00783"></a>00783         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((saction) &amp;&amp; (saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#aa9c9b1bb84c77908e70219d39ed8696c">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#af4dbf3f7801297d71ef69d77c2724d0ea6bee9414dacdb2f4a670cac7a56ad7ee">SACTION_MARKERS_MOVE</a>)) {
<a name="l00784"></a>00784             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *markers = <a class="code" href="../../df/d12/anim__markers_8c.html#ae3e124b76e0b4a7730d335b549a30b3c">ED_animcontext_get_markers</a>(ac);
<a name="l00785"></a>00785             <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker;
<a name="l00786"></a>00786             
<a name="l00787"></a>00787             <span class="keywordflow">for</span> (marker= markers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; marker; marker= marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#ae24b020d13fed8c505c8c6405e31d6a6">next</a>) {
<a name="l00788"></a>00788                 <span class="keywordflow">if</span> (    ((leftright == <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058ac9838d2b9549ced1e2be6ea36c91e5ab">ACTKEYS_LRSEL_LEFT</a>) &amp;&amp; (marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a63f34b0e44a21b9e0a7d43d8cbc44700">frame</a> &lt; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>)) ||
<a name="l00789"></a>00789                     ((leftright == <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aedb2e1502c68bf35d7480a023e185d4c">ACTKEYS_LRSEL_RIGHT</a>) &amp;&amp; (marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a63f34b0e44a21b9e0a7d43d8cbc44700">frame</a> &gt;= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>)) ) 
<a name="l00790"></a>00790                 {
<a name="l00791"></a>00791                     marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a8ad106a9099071c271e3302fe042331a">flag</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l00792"></a>00792                 }
<a name="l00793"></a>00793                 <span class="keywordflow">else</span> {
<a name="l00794"></a>00794                     marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a8ad106a9099071c271e3302fe042331a">flag</a> &amp;= ~<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l00795"></a>00795                 }
<a name="l00796"></a>00796             }
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="comment">/* Cleanup */</span>
<a name="l00801"></a>00801     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00802"></a>00802 }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="comment">/* ----------------- */</span>
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="../../d8/d27/action__select_8c.html#adfbe98676e6fa27d23619433fc53cb04">00806</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#adfbe98676e6fa27d23619433fc53cb04">actkeys_select_leftright_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00809"></a>00809     <span class="keywordtype">short</span> leftright = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00810"></a>00810     <span class="keywordtype">short</span> selectmode;
<a name="l00811"></a>00811     
<a name="l00812"></a>00812     <span class="comment">/* get editor data */</span>
<a name="l00813"></a>00813     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00814"></a>00814         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00815"></a>00815     
<a name="l00816"></a>00816     <span class="comment">/* select mode is either replace (deselect all, then add) or add/extend */</span>
<a name="l00817"></a>00817     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>))
<a name="l00818"></a>00818         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>;
<a name="l00819"></a>00819     <span class="keywordflow">else</span>
<a name="l00820"></a>00820         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>;
<a name="l00821"></a>00821         
<a name="l00822"></a>00822     <span class="comment">/* if &quot;test&quot; mode is set, we don&#39;t have any info to set this with */</span>
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (leftright == <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aa12338f4126bcd473c7543c47d8f6985">ACTKEYS_LRSEL_TEST</a>)
<a name="l00824"></a>00824         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00825"></a>00825     
<a name="l00826"></a>00826     <span class="comment">/* do the selecting now */</span>
<a name="l00827"></a>00827     <a class="code" href="../../d8/d27/action__select_8c.html#a7cf0113706e78bf03c4d96993fe5e7a4">actkeys_select_leftright</a>(&amp;ac, leftright, selectmode);
<a name="l00828"></a>00828     
<a name="l00829"></a>00829     <span class="comment">/* set notifier that keyframe selection (and channels too) have changed */</span>
<a name="l00830"></a>00830     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ae33d7b6d741944268e2e95aa7416d97f">ND_ANIMCHAN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00831"></a>00831     
<a name="l00832"></a>00832     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00833"></a>00833 }
<a name="l00834"></a>00834 
<a name="l00835"></a><a class="code" href="../../d8/d27/action__select_8c.html#a9645e7d6886d597145543ce01d2d69de">00835</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#a9645e7d6886d597145543ce01d2d69de">actkeys_select_leftright_invoke</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00838"></a>00838     <span class="keywordtype">short</span> leftright = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00839"></a>00839     
<a name="l00840"></a>00840     <span class="comment">/* get editor data */</span>
<a name="l00841"></a>00841     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00842"></a>00842         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00843"></a>00843         
<a name="l00844"></a>00844     <span class="comment">/* handle mode-based testing */</span>
<a name="l00845"></a>00845     <span class="keywordflow">if</span> (leftright == <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aa12338f4126bcd473c7543c47d8f6985">ACTKEYS_LRSEL_TEST</a>) {
<a name="l00846"></a>00846         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00847"></a>00847         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>;
<a name="l00848"></a>00848         <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00849"></a>00849         <span class="keywordtype">float</span> x;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851         <span class="comment">/* determine which side of the current frame mouse is on */</span>
<a name="l00852"></a>00852         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1], &amp;x, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00853"></a>00853         <span class="keywordflow">if</span> (x &lt; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>)
<a name="l00854"></a>00854             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058ac9838d2b9549ced1e2be6ea36c91e5ab">ACTKEYS_LRSEL_LEFT</a>);
<a name="l00855"></a>00855         <span class="keywordflow">else</span>    
<a name="l00856"></a>00856             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aedb2e1502c68bf35d7480a023e185d4c">ACTKEYS_LRSEL_RIGHT</a>);
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858     
<a name="l00859"></a>00859     <span class="comment">/* perform selection */</span>
<a name="l00860"></a>00860     <span class="keywordflow">return</span> <a class="code" href="../../d8/d27/action__select_8c.html#adfbe98676e6fa27d23619433fc53cb04">actkeys_select_leftright_exec</a>(C, op);
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a><a class="code" href="../../d8/d27/action__select_8c.html#aab31ae8f0f08b9e545e66d67796f4bf2">00863</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#aeb272ffa64fda3a9ba3c28401d91c4cd">ACTION_OT_select_leftright</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865     <span class="comment">/* identifiers */</span>
<a name="l00866"></a>00866     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Left/Right&quot;</span>;
<a name="l00867"></a>00867     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_select_leftright&quot;</span>;
<a name="l00868"></a>00868     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes to the left or the right of the current frame&quot;</span>;
<a name="l00869"></a>00869     
<a name="l00870"></a>00870     <span class="comment">/* api callbacks  */</span>
<a name="l00871"></a>00871     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d8/d27/action__select_8c.html#a9645e7d6886d597145543ce01d2d69de">actkeys_select_leftright_invoke</a>;
<a name="l00872"></a>00872     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d8/d27/action__select_8c.html#adfbe98676e6fa27d23619433fc53cb04">actkeys_select_leftright_exec</a>;
<a name="l00873"></a>00873     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00874"></a>00874     
<a name="l00875"></a>00875     <span class="comment">/* flags */</span>
<a name="l00876"></a>00876     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00877"></a>00877     
<a name="l00878"></a>00878     <span class="comment">/* id-props */</span>
<a name="l00879"></a>00879     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, prop_actkeys_leftright_select_types, <a class="code" href="../../df/d02/action__intern_8h.html#a0ae1e3bf78c960c83e2d437efd802058aa12338f4126bcd473c7543c47d8f6985">ACTKEYS_LRSEL_TEST</a>, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00880"></a>00880     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;extend&quot;</span>, 0, <span class="stringliteral">&quot;Extend Select&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00881"></a>00881 }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <span class="comment">/* ******************** Mouse-Click Select Operator *********************** */</span>
<a name="l00884"></a>00884 <span class="comment">/* This operator works in one of three ways:</span>
<a name="l00885"></a>00885 <span class="comment"> *  - 1) keyframe under mouse - no special modifiers</span>
<a name="l00886"></a>00886 <span class="comment"> *  - 2) all keyframes on the same side of current frame indicator as mouse - ALT modifier</span>
<a name="l00887"></a>00887 <span class="comment"> *  - 3) column select all keyframes in frame under mouse - CTRL modifier</span>
<a name="l00888"></a>00888 <span class="comment"> *</span>
<a name="l00889"></a>00889 <span class="comment"> * In addition to these basic options, the SHIFT modifier can be used to toggle the </span>
<a name="l00890"></a>00890 <span class="comment"> * selection mode between replacing the selection (without) and inverting the selection (with).</span>
<a name="l00891"></a>00891 <span class="comment"> */</span>
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="comment">/* sensitivity factor for frame-selections */</span>
<a name="l00894"></a><a class="code" href="../../d8/d27/action__select_8c.html#a577353deaed89d85ddc4d3c4bfeb3ea7">00894</a> <span class="preprocessor">#define FRAME_CLICK_THRESH      0.1f</span>
<a name="l00895"></a>00895 <span class="preprocessor"></span>
<a name="l00896"></a>00896 <span class="comment">/* ------------------- */</span>
<a name="l00897"></a>00897  
<a name="l00898"></a>00898 <span class="comment">/* option 1) select keyframe directly under mouse */</span>
<a name="l00899"></a><a class="code" href="../../d8/d27/action__select_8c.html#ad05c3266fe4b795a2501c7f5890b14ef">00899</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#ad05c3266fe4b795a2501c7f5890b14ef">actkeys_mselect_single</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale, <span class="keywordtype">short</span> select_mode, <span class="keywordtype">float</span> selx)
<a name="l00900"></a>00900 {
<a name="l00901"></a>00901     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00902"></a>00902     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> select_cb, ok_cb;
<a name="l00903"></a>00903     
<a name="l00904"></a>00904     <span class="comment">/* get functions for selecting keyframes */</span>
<a name="l00905"></a>00905     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(select_mode);
<a name="l00906"></a>00906     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a4a09064815ad73e482e1293530e146cd">BEZT_OK_FRAME</a>);
<a name="l00907"></a>00907     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= selx;
<a name="l00908"></a>00908     
<a name="l00909"></a>00909     <span class="comment">/* select the nominated keyframe on the given frame */</span>
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>)
<a name="l00911"></a>00911         <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a5ea863b1ee98a2a17ee0c2d7b2a30a0f">select_gpencil_frame</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, selx, select_mode);
<a name="l00912"></a>00912     <span class="keywordflow">else</span>
<a name="l00913"></a>00913         <a class="code" href="../../db/d71/keyframes__edit_8c.html#ac3c68ea095bf4e030872ea4a46ab99d9">ANIM_animchannel_keyframes_loop</a>(&amp;ked, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a>, ale, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 <span class="comment">/* Option 2) Selects all the keyframes on either side of the current frame (depends on which side the mouse is on) */</span>
<a name="l00917"></a>00917 <span class="comment">/* (see actkeys_select_leftright) */</span>
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 <span class="comment">/* Option 3) Selects all visible keyframes in the same frame as the mouse click */</span>
<a name="l00920"></a><a class="code" href="../../d8/d27/action__select_8c.html#ab7a85285109216cca535f812c7fb040c">00920</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#ab7a85285109216cca535f812c7fb040c">actkeys_mselect_column</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> select_mode, <span class="keywordtype">float</span> selx)
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00923"></a>00923     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00924"></a>00924     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00925"></a>00925     
<a name="l00926"></a>00926     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> select_cb, ok_cb;
<a name="l00927"></a>00927     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00928"></a>00928     
<a name="l00929"></a>00929     <span class="comment">/* set up BezTriple edit callbacks */</span>
<a name="l00930"></a>00930     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(select_mode);
<a name="l00931"></a>00931     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a4a09064815ad73e482e1293530e146cd">BEZT_OK_FRAME</a>);
<a name="l00932"></a>00932     
<a name="l00933"></a>00933     <span class="comment">/* loop through all of the keys and select additional keyframes</span>
<a name="l00934"></a>00934 <span class="comment">     * based on the keys found to be selected above</span>
<a name="l00935"></a>00935 <span class="comment">     */</span>
<a name="l00936"></a>00936     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00937"></a>00937         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY */</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00938"></a>00938     <span class="keywordflow">else</span>
<a name="l00939"></a>00939         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00940"></a>00940     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00941"></a>00941     
<a name="l00942"></a>00942     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00943"></a>00943         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00944"></a>00944         
<a name="l00945"></a>00945         <span class="comment">/* set frame for validation callback to refer to */</span>
<a name="l00946"></a>00946         <span class="keywordflow">if</span> (adt)
<a name="l00947"></a>00947             ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, selx, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l00948"></a>00948         <span class="keywordflow">else</span>
<a name="l00949"></a>00949             ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= selx;
<a name="l00950"></a>00950         
<a name="l00951"></a>00951         <span class="comment">/* select elements with frame number matching cfra */</span>
<a name="l00952"></a>00952         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>)
<a name="l00953"></a>00953             <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a5ea863b1ee98a2a17ee0c2d7b2a30a0f">select_gpencil_frame</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, selx, select_mode);
<a name="l00954"></a>00954         <span class="keywordflow">else</span> 
<a name="l00955"></a>00955             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957     
<a name="l00958"></a>00958     <span class="comment">/* free elements */</span>
<a name="l00959"></a>00959     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>);
<a name="l00960"></a>00960     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962  
<a name="l00963"></a>00963 <span class="comment">/* ------------------- */</span>
<a name="l00964"></a>00964 
<a name="l00965"></a><a class="code" href="../../d8/d27/action__select_8c.html#a4e1c4e6ce3fb54a2c3378035639c8f6c">00965</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d27/action__select_8c.html#a4e1c4e6ce3fb54a2c3378035639c8f6c">mouse_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">short</span> select_mode, <span class="keywordtype">short</span> column)
<a name="l00966"></a>00966 {
<a name="l00967"></a>00967     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00968"></a>00968     <a class="code" href="../../d1/d5d/structDLRBT__Tree.html">DLRBT_Tree</a> anim_keys;
<a name="l00969"></a>00969     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00970"></a>00970     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00971"></a>00971     
<a name="l00972"></a>00972     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00973"></a>00973     <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00974"></a>00974     <span class="keywordtype">int</span> channel_index;
<a name="l00975"></a>00975     <span class="keywordtype">short</span> found = 0;
<a name="l00976"></a>00976     <span class="keywordtype">float</span> selx = 0.0f;
<a name="l00977"></a>00977     <span class="keywordtype">float</span> x, y;
<a name="l00978"></a>00978     <a class="code" href="../../da/d10/structrctf.html">rctf</a> rectf;
<a name="l00979"></a>00979     
<a name="l00980"></a>00980     <span class="comment">/* get dopesheet info */</span>
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a740590a7047b0cc256d5102bc12b562b">ANIMCONT_DOPESHEET</a>)
<a name="l00982"></a>00982         ads= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>;
<a name="l00983"></a>00983     
<a name="l00984"></a>00984     <span class="comment">/* use View2D to determine the index of the channel (i.e a row in the list) where keyframe was */</span>
<a name="l00985"></a>00985     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, mval[0], mval[1], &amp;x, &amp;y);
<a name="l00986"></a>00986     <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1957b956e648516cb2180e086b8f0f74">UI_view2d_listview_view_to_cell</a>(v2d, 0, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#ace7eea0a257948b6a1342a5dfe914380">ACHANNEL_STEP</a>, 0, (<span class="keywordtype">float</span>)<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a5f1dc2b776e0b2291eb5bf63d69cc2a7">ACHANNEL_HEIGHT_HALF</a>, x, y, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;channel_index);
<a name="l00987"></a>00987     
<a name="l00988"></a>00988     <span class="comment">/* x-range to check is +/- 7 (in screen/region-space) on either side of mouse click (size of keyframe icon) */</span>
<a name="l00989"></a>00989     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, mval[0]-7, mval[1], &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00990"></a>00990     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, mval[0]+7, mval[1], &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, &amp;rectf.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00991"></a>00991     
<a name="l00992"></a>00992     <span class="comment">/* filter data */</span>
<a name="l00993"></a>00993     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a9c037c92ba2a5b6b36ace05f6933fadf">ANIMFILTER_LIST_CHANNELS</a>);
<a name="l00994"></a>00994     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00995"></a>00995     
<a name="l00996"></a>00996     <span class="comment">/* try to get channel */</span>
<a name="l00997"></a>00997     ale= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;anim_data, channel_index);
<a name="l00998"></a>00998     <span class="keywordflow">if</span> (ale == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00999"></a>00999         <span class="comment">/* channel not found */</span>
<a name="l01000"></a>01000         printf(<span class="stringliteral">&quot;Error: animation channel (index = %d) not found in mouse_action_keys()\n&quot;</span>, channel_index);
<a name="l01001"></a>01001         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01002"></a>01002         <span class="keywordflow">return</span>;
<a name="l01003"></a>01003     }
<a name="l01004"></a>01004     <span class="keywordflow">else</span> {
<a name="l01005"></a>01005         <span class="comment">/* found match - must return here... */</span>
<a name="l01006"></a>01006         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l01007"></a>01007         <a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *ak, *akn=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01008"></a>01008         
<a name="l01009"></a>01009         <span class="comment">/* make list of keyframes */</span>
<a name="l01010"></a>01010         <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a252f6abeef3b6e861da84630cbdbb02b">BLI_dlrbTree_init</a>(&amp;anim_keys);
<a name="l01011"></a>01011         
<a name="l01012"></a>01012         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>) {
<a name="l01013"></a>01013             <span class="keywordflow">switch</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>) {
<a name="l01014"></a>01014                 <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a2e534455c996f92c6e4c07f747001038">ALE_SCE</a>:
<a name="l01015"></a>01015                 {
<a name="l01016"></a>01016                     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l01017"></a>01017                     <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a509a1ed892203dd7b0b72823d7b98437">scene_to_keylist</a>(ads, scene, &amp;anim_keys, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01018"></a>01018                 }
<a name="l01019"></a>01019                     <span class="keywordflow">break</span>;
<a name="l01020"></a>01020                 <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85adfd4f425b01285d4b196357e67b805b0">ALE_OB</a>:
<a name="l01021"></a>01021                 {
<a name="l01022"></a>01022                     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= (<a class="code" href="../../de/de7/structObject.html">Object</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l01023"></a>01023                     <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a2d5365a1339cbef0ec6cbe39a14ab37c">ob_to_keylist</a>(ads, ob, &amp;anim_keys, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01024"></a>01024                 }
<a name="l01025"></a>01025                     <span class="keywordflow">break</span>;
<a name="l01026"></a>01026                 <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>:
<a name="l01027"></a>01027                 {
<a name="l01028"></a>01028                     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act= (<a class="code" href="../../d1/d48/structbAction.html">bAction</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l01029"></a>01029                     <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a11e7d5582c4d4707bbb155dfc0fa5ea3">action_to_keylist</a>(adt, act, &amp;anim_keys, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01030"></a>01030                 }
<a name="l01031"></a>01031                     <span class="keywordflow">break</span>;
<a name="l01032"></a>01032                 <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a6072750eace5e2e8e8a0b0350df28b61">ALE_FCURVE</a>:
<a name="l01033"></a>01033                 {
<a name="l01034"></a>01034                     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l01035"></a>01035                     <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a9d18e6fc983df5018e97acd591c7ff33">fcurve_to_keylist</a>(adt, fcu, &amp;anim_keys, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01036"></a>01036                 }
<a name="l01037"></a>01037                     <span class="keywordflow">break</span>;
<a name="l01038"></a>01038             }
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a1ec0c4967d46aaf6b87c893c81221ed4">ANIMTYPE_SUMMARY</a>) {
<a name="l01041"></a>01041             <span class="comment">/* dopesheet summary covers everything */</span>
<a name="l01042"></a>01042             <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a183637bdb403eb6c23e45533cec953a8">summary_to_keylist</a>(ac, &amp;anim_keys, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a5745c87a6bad0a1dbe26b8d429774c35">ANIMTYPE_GROUP</a>) { 
<a name="l01045"></a>01045             <span class="comment">// TODO: why don&#39;t we just give groups key_data too?</span>
<a name="l01046"></a>01046             <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *agrp= (<a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01047"></a>01047             <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a05affdc6921e466d6505d4ca0774ac32">agroup_to_keylist</a>(adt, agrp, &amp;anim_keys, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>) {
<a name="l01050"></a>01050             <span class="comment">// TODO: why don&#39;t we just give gplayers key_data too?</span>
<a name="l01051"></a>01051             <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl = (<a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01052"></a>01052             <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#afca8aae3dd8799ffc57e04b2fd1495e4">gpl_to_keylist</a>(ads, gpl, &amp;anim_keys);
<a name="l01053"></a>01053         }
<a name="l01054"></a>01054         
<a name="l01055"></a>01055         <span class="comment">/* start from keyframe at root of BST, traversing until we find one within the range that was clicked on */</span>
<a name="l01056"></a>01056         <span class="keywordflow">for</span> (ak= anim_keys.<a class="code" href="../../d1/d5d/structDLRBT__Tree.html#ac6e167ec21709b3b24aa0d47f74fdf3f">root</a>; ak; ak= akn) {
<a name="l01057"></a>01057             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a7dadb214b740d4838066d84d83657e66">IN_RANGE</a>(ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a>, rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rectf.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>)) {
<a name="l01058"></a>01058                 <span class="comment">/* set the frame to use, and apply inverse-correction for NLA-mapping </span>
<a name="l01059"></a>01059 <span class="comment">                 * so that the frame will get selected by the selection functions without</span>
<a name="l01060"></a>01060 <span class="comment">                 * requiring to map each frame once again...</span>
<a name="l01061"></a>01061 <span class="comment">                 */</span>
<a name="l01062"></a>01062                 selx= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a>, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l01063"></a>01063                 found= 1;
<a name="l01064"></a>01064                 <span class="keywordflow">break</span>;
<a name="l01065"></a>01065             }
<a name="l01066"></a>01066             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a> &lt; rectf.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>)
<a name="l01067"></a>01067                 akn= ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a63326d0167f1a121d9e39691f042fed7">right</a>;
<a name="l01068"></a>01068             <span class="keywordflow">else</span>
<a name="l01069"></a>01069                 akn= ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a5b61d6f0aa7d4661cb947242375cf7b6">left</a>;
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071         
<a name="l01072"></a>01072         <span class="comment">/* remove active channel from list of channels for separate treatment (since it&#39;s needed later on) */</span>
<a name="l01073"></a>01073         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;anim_data, ale);
<a name="l01074"></a>01074         
<a name="l01075"></a>01075         <span class="comment">/* cleanup temporary lists */</span>
<a name="l01076"></a>01076         <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#af6bec977f19ccbbea32e1aec6ed00341">BLI_dlrbTree_free</a>(&amp;anim_keys);
<a name="l01077"></a>01077         
<a name="l01078"></a>01078         <span class="comment">/* free list of channels, since it&#39;s not used anymore */</span>
<a name="l01079"></a>01079         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081     
<a name="l01082"></a>01082     <span class="comment">/* for replacing selection, firstly need to clear existing selection */</span>
<a name="l01083"></a>01083     <span class="keywordflow">if</span> (select_mode == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>) {
<a name="l01084"></a>01084         <span class="comment">/* reset selection mode for next steps */</span>
<a name="l01085"></a>01085         select_mode = <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l01086"></a>01086         
<a name="l01087"></a>01087         <span class="comment">/* deselect all keyframes */</span>
<a name="l01088"></a>01088         <a class="code" href="../../d8/d27/action__select_8c.html#a0575e5102b72a5993581cbb0c06a8787">deselect_action_keys</a>(ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>);
<a name="l01089"></a>01089         
<a name="l01090"></a>01090         <span class="comment">/* highlight channel clicked on */</span>
<a name="l01091"></a>01091         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a7eb4a68e2a084c2412b8ca344b3c8b2a">ANIMCONT_ACTION</a>, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a740590a7047b0cc256d5102bc12b562b">ANIMCONT_DOPESHEET</a>)) {
<a name="l01092"></a>01092             <span class="comment">/* deselect all other channels first */</span>
<a name="l01093"></a>01093             <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#abe6a60e7cc2befcb9b2bd05decc44332">ANIM_deselect_anim_channels</a>(ac, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, 0, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a04957cf96d6816c3527b7f7dfb7d7ad7ab9039d7fc8065046cc579c779d0994ed">ACHANNEL_SETFLAG_CLEAR</a>);
<a name="l01094"></a>01094             
<a name="l01095"></a>01095             <span class="comment">/* Highlight Action-Group or F-Curve? */</span>
<a name="l01096"></a>01096             <span class="keywordflow">if</span> (ale &amp;&amp; ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>) {
<a name="l01097"></a>01097                 <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a5745c87a6bad0a1dbe26b8d429774c35">ANIMTYPE_GROUP</a>) {
<a name="l01098"></a>01098                     <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *agrp= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01099"></a>01099                     
<a name="l01100"></a>01100                     agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a5a04faf9cd6c23df183545e5842caf80">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a23623a6a10ec8ae24a77f37cf2093d1ea4e494b4850b6143bde5856f59a714929">AGRP_SELECTED</a>;
<a name="l01101"></a>01101                     <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#ae95b85a4cef48fc497c697f7c08596f6">ANIM_set_active_channel</a>(ac, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, filter, agrp, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a5745c87a6bad0a1dbe26b8d429774c35">ANIMTYPE_GROUP</a>);
<a name="l01102"></a>01102                 }   
<a name="l01103"></a>01103                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>) {
<a name="l01104"></a>01104                     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01105"></a>01105                     
<a name="l01106"></a>01106                     fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l01107"></a>01107                     <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#ae95b85a4cef48fc497c697f7c08596f6">ANIM_set_active_channel</a>(ac, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, filter, fcu, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>);
<a name="l01108"></a>01108                 }
<a name="l01109"></a>01109             }
<a name="l01110"></a>01110         }
<a name="l01111"></a>01111         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) {
<a name="l01112"></a>01112             <span class="comment">/* deselect all other channels first */</span>
<a name="l01113"></a>01113             <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#abe6a60e7cc2befcb9b2bd05decc44332">ANIM_deselect_anim_channels</a>(ac, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, 0, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a04957cf96d6816c3527b7f7dfb7d7ad7ab9039d7fc8065046cc579c779d0994ed">ACHANNEL_SETFLAG_CLEAR</a>);
<a name="l01114"></a>01114             
<a name="l01115"></a>01115             <span class="comment">/* Highlight GPencil Layer */</span>
<a name="l01116"></a>01116             <span class="keywordflow">if</span> ((ale &amp;&amp; ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>) &amp;&amp; (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>)) {
<a name="l01117"></a>01117                 <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl = ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01118"></a>01118                 
<a name="l01119"></a>01119                 gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#aed047c52577f6e0e3560c80bb65e1359">flag</a> |= <a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html#a997a4a9ce613e48f122e988e061e68e2">GP_LAYER_SELECT</a>;
<a name="l01120"></a>01120                 <span class="comment">//gpencil_layer_setactive(gpd, gpl);</span>
<a name="l01121"></a>01121             }
<a name="l01122"></a>01122         }
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124     
<a name="l01125"></a>01125     <span class="comment">/* only select keyframes if we clicked on a valid channel and hit something */</span>
<a name="l01126"></a>01126     <span class="keywordflow">if</span> (ale) {
<a name="l01127"></a>01127         <span class="keywordflow">if</span> (found) {
<a name="l01128"></a>01128             <span class="comment">/* apply selection to keyframes */</span>
<a name="l01129"></a>01129             <span class="keywordflow">if</span> (column) {
<a name="l01130"></a>01130                 <span class="comment">/* select all keyframes in the same frame as the one we hit on the active channel */</span>
<a name="l01131"></a>01131                 <a class="code" href="../../d8/d27/action__select_8c.html#ab7a85285109216cca535f812c7fb040c">actkeys_mselect_column</a>(ac, select_mode, selx);
<a name="l01132"></a>01132             }
<a name="l01133"></a>01133             <span class="keywordflow">else</span> {
<a name="l01134"></a>01134                 <span class="comment">/* select the nominated keyframe on the given frame */</span>
<a name="l01135"></a>01135                 <a class="code" href="../../d8/d27/action__select_8c.html#ad05c3266fe4b795a2501c7f5890b14ef">actkeys_mselect_single</a>(ac, ale, select_mode, selx);
<a name="l01136"></a>01136             }
<a name="l01137"></a>01137         }
<a name="l01138"></a>01138         
<a name="l01139"></a>01139         <span class="comment">/* free this channel */</span>
<a name="l01140"></a>01140         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ale);
<a name="l01141"></a>01141     }
<a name="l01142"></a>01142 }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 <span class="comment">/* handle clicking */</span>
<a name="l01145"></a><a class="code" href="../../d8/d27/action__select_8c.html#a53c5c2bd6e49b1bbabc083132ba32ed8">01145</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d27/action__select_8c.html#a53c5c2bd6e49b1bbabc083132ba32ed8">actkeys_clickselect_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01146"></a>01146 {
<a name="l01147"></a>01147     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01148"></a>01148     <span class="comment">/* ARegion *ar; */</span> <span class="comment">/* UNUSED */</span>
<a name="l01149"></a>01149     <span class="keywordtype">short</span> selectmode, column;
<a name="l01150"></a>01150     
<a name="l01151"></a>01151     <span class="comment">/* get editor data */</span>
<a name="l01152"></a>01152     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01153"></a>01153         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01154"></a>01154         
<a name="l01155"></a>01155     <span class="comment">/* get useful pointers from animation context data */</span>
<a name="l01156"></a>01156     <span class="comment">/* ar= ac.ar; */</span> <span class="comment">/* UNUSED */</span>
<a name="l01157"></a>01157 
<a name="l01158"></a>01158     <span class="comment">/* select mode is either replace (deselect all, then add) or add/extend */</span>
<a name="l01159"></a>01159     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>))
<a name="l01160"></a>01160         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>;
<a name="l01161"></a>01161     <span class="keywordflow">else</span>
<a name="l01162"></a>01162         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>;
<a name="l01163"></a>01163         
<a name="l01164"></a>01164     <span class="comment">/* column selection */</span>
<a name="l01165"></a>01165     column= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;column&quot;</span>);
<a name="l01166"></a>01166     
<a name="l01167"></a>01167     <span class="comment">/* select keyframe(s) based upon mouse position*/</span>
<a name="l01168"></a>01168     <a class="code" href="../../d8/d27/action__select_8c.html#a4e1c4e6ce3fb54a2c3378035639c8f6c">mouse_action_keys</a>(&amp;ac, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, selectmode, column);
<a name="l01169"></a>01169     
<a name="l01170"></a>01170     <span class="comment">/* set notifier that keyframe selection (and channels too) have changed */</span>
<a name="l01171"></a>01171     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ae33d7b6d741944268e2e95aa7416d97f">ND_ANIMCHAN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01172"></a>01172     
<a name="l01173"></a>01173     <span class="comment">/* for tweak grab to work */</span>
<a name="l01174"></a>01174     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01175"></a>01175 }
<a name="l01176"></a>01176  
<a name="l01177"></a><a class="code" href="../../d8/d27/action__select_8c.html#aeeebb5a37f65308f40c2812e141eea12">01177</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d02/action__intern_8h.html#a05423bfb8ed694e0798cef5084c01db5">ACTION_OT_clickselect</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01178"></a>01178 {
<a name="l01179"></a>01179     <span class="comment">/* identifiers */</span>
<a name="l01180"></a>01180     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Mouse Select Keys&quot;</span>;
<a name="l01181"></a>01181     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_clickselect&quot;</span>;
<a name="l01182"></a>01182     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes by clicking on them&quot;</span>;
<a name="l01183"></a>01183     
<a name="l01184"></a>01184     <span class="comment">/* api callbacks - absolutely no exec() this yet... */</span>
<a name="l01185"></a>01185     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d8/d27/action__select_8c.html#a53c5c2bd6e49b1bbabc083132ba32ed8">actkeys_clickselect_invoke</a>;
<a name="l01186"></a>01186     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01187"></a>01187     
<a name="l01188"></a>01188     <span class="comment">/* flags */</span>
<a name="l01189"></a>01189     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01190"></a>01190     
<a name="l01191"></a>01191     <span class="comment">/* id-props */</span>
<a name="l01192"></a>01192     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;extend&quot;</span>, 0, <span class="stringliteral">&quot;Extend Select&quot;</span>, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">// SHIFTKEY</span>
<a name="l01193"></a>01193     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;column&quot;</span>, 0, <span class="stringliteral">&quot;Column Select&quot;</span>, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">// ALTKEY</span>
<a name="l01194"></a>01194 }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">/* ************************************************************************** */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:53:55 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: solver_init.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">solver_init.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d8/dd5/solver__init_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - Free Surface Fluid Simulation with the Lattice Boltzmann Method</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Standard LBM Factory implementation</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *****************************************************************************/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d24/solver__class_8h.html">solver_class.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d75/solver__relax_8h.html">solver_relax.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="comment">// for geo init FGI_ defines</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d00/elbeem_8h.html">elbeem.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">// helper for 2d init</span>
<a name="l00020"></a><a class="code" href="../../d8/dd5/solver__init_8cpp.html#a57568d312ee64b00a955a41b7c3e06bc">00020</a> <span class="preprocessor">#define SWAPYZ(vec) { \</span>
<a name="l00021"></a>00021 <span class="preprocessor">        const LbmFloat tmp = (vec)[2]; \</span>
<a name="l00022"></a>00022 <span class="preprocessor">        (vec)[2] = (vec)[1]; (vec)[1] = tmp; }</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">/*****************************************************************************/</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/*****************************************************************************/</span>
<a name="l00030"></a>00030 <span class="preprocessor">#if LBMDIM==3</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00033"></a>00033     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> = 3;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035     <span class="comment">// Wi factors for collide step </span>
<a name="l00036"></a>00036     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abe6a39ba1e50208d675853cc10debf03">LbmFsgrSolver::cCollenZero</a>    = (1.0/3.0);
<a name="l00037"></a>00037     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a82d9a6f74914c741c31765d6eff32db5">LbmFsgrSolver::cCollenOne</a>     = (1.0/18.0);
<a name="l00038"></a>00038     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3f59834e89bf83f354e3c1caea3edced">LbmFsgrSolver::cCollenSqrtTwo</a> = (1.0/36.0);
<a name="l00039"></a>00039 
<a name="l00041"></a>00041     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8e029171cc14805c4f04aa91743ffb3" title="threshold value for filled/emptied cells">LbmFsgrSolver::cMagicNr2</a>    = 1.0005;
<a name="l00042"></a>00042     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae9bbff2f12d4d25dfc956eb29dc24652">LbmFsgrSolver::cMagicNr2Neg</a> = -0.0005;
<a name="l00043"></a>00043     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab4207419776fcaa26c6f0a1334dc3081">LbmFsgrSolver::cMagicNr</a>     = 1.010001;
<a name="l00044"></a>00044     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2a1137ede205ecb934934a977606f224">LbmFsgrSolver::cMagicNrNeg</a>  = -0.010001;
<a name="l00045"></a>00045 
<a name="l00047"></a>00047     <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">LbmFsgrSolver::cDfNum</a>      = 19;
<a name="l00049"></a>00049     <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">LbmFsgrSolver::cDirNum</a>     = 27;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051     <span class="comment">//const string LbmFsgrSolver::dfString[ cDfNum ] = { </span>
<a name="l00052"></a>00052     <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4fb3c32ebc0a125e41369eaa82e0178">LbmFsgrSolver::dfString</a>[ cDfNum ] = { 
<a name="l00053"></a>00053         <span class="stringliteral">&quot; C&quot;</span>, <span class="stringliteral">&quot; N&quot;</span>,<span class="stringliteral">&quot; S&quot;</span>,<span class="stringliteral">&quot; E&quot;</span>,<span class="stringliteral">&quot; W&quot;</span>,<span class="stringliteral">&quot; T&quot;</span>,<span class="stringliteral">&quot; B&quot;</span>,
<a name="l00054"></a>00054         <span class="stringliteral">&quot;NE&quot;</span>,<span class="stringliteral">&quot;NW&quot;</span>,<span class="stringliteral">&quot;SE&quot;</span>,<span class="stringliteral">&quot;SW&quot;</span>,
<a name="l00055"></a>00055         <span class="stringliteral">&quot;NT&quot;</span>,<span class="stringliteral">&quot;NB&quot;</span>,<span class="stringliteral">&quot;ST&quot;</span>,<span class="stringliteral">&quot;SB&quot;</span>,
<a name="l00056"></a>00056         <span class="stringliteral">&quot;ET&quot;</span>,<span class="stringliteral">&quot;EB&quot;</span>,<span class="stringliteral">&quot;WT&quot;</span>,<span class="stringliteral">&quot;WB&quot;</span>
<a name="l00057"></a>00057     };
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a56f8aa905db803ba957efc1421ca2022">LbmFsgrSolver::dfNorm</a>[ cDfNum ] = { 
<a name="l00060"></a>00060         cDirC, cDirN, cDirS, cDirE, cDirW, cDirT, cDirB, 
<a name="l00061"></a>00061         cDirNE, cDirNW, cDirSE, cDirSW, 
<a name="l00062"></a>00062         cDirNT, cDirNB, cDirST, cDirSB, 
<a name="l00063"></a>00063         cDirET, cDirEB, cDirWT, cDirWB
<a name="l00064"></a>00064     };
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7298c005477abe4727db7ddb2368ad7">LbmFsgrSolver::dfInv</a>[ cDfNum ] = { 
<a name="l00067"></a>00067         cDirC,  cDirS, cDirN, cDirW, cDirE, cDirB, cDirT,
<a name="l00068"></a>00068         cDirSW, cDirSE, cDirNW, cDirNE,
<a name="l00069"></a>00069         cDirSB, cDirST, cDirNB, cDirNT, 
<a name="l00070"></a>00070         cDirWB, cDirWT, cDirEB, cDirET
<a name="l00071"></a>00071     };
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a47a9bb9f1a6c7c3cd05f9bbebe473ce2">LbmFsgrSolver::dfRefX</a>[ cDfNum ] = { 
<a name="l00074"></a>00074         0,  0, 0, 0, 0, 0, 0,
<a name="l00075"></a>00075         cDirSE, cDirSW, cDirNE, cDirNW,
<a name="l00076"></a>00076         0, 0, 0, 0, 
<a name="l00077"></a>00077         cDirEB, cDirET, cDirWB, cDirWT
<a name="l00078"></a>00078     };
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a15e48bbfff329e4700257e6ff29ff34f">LbmFsgrSolver::dfRefY</a>[ cDfNum ] = { 
<a name="l00081"></a>00081         0,  0, 0, 0, 0, 0, 0,
<a name="l00082"></a>00082         cDirNW, cDirNE, cDirSW, cDirSE,
<a name="l00083"></a>00083         cDirNB, cDirNT, cDirSB, cDirST,
<a name="l00084"></a>00084         0, 0, 0, 0
<a name="l00085"></a>00085     };
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8cbfcdd8e3a307029550ff6390195624">LbmFsgrSolver::dfRefZ</a>[ cDfNum ] = { 
<a name="l00088"></a>00088         0,  0, 0, 0, 0, 0, 0,
<a name="l00089"></a>00089         0, 0, 0, 0, 
<a name="l00090"></a>00090         cDirST, cDirSB, cDirNT, cDirNB,
<a name="l00091"></a>00091         cDirWT, cDirWB, cDirET, cDirEB
<a name="l00092"></a>00092     };
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="comment">// Vector Order 3D:</span>
<a name="l00095"></a>00095     <span class="comment">//  0   1  2   3  4   5  6       7  8  9 10  11 12 13 14  15 16 17 18     19 20 21 22  23 24 25 26</span>
<a name="l00096"></a>00096     <span class="comment">//  0,  0, 0,  1,-1,  0, 0,      1,-1, 1,-1,  0, 0, 0, 0,  1, 1,-1,-1,     1,-1, 1,-1,  1,-1, 1,-1</span>
<a name="l00097"></a>00097     <span class="comment">//  0,  1,-1,  0, 0,  0, 0,      1, 1,-1,-1,  1, 1,-1,-1,  0, 0, 0, 0,     1, 1,-1,-1,  1, 1,-1,-1</span>
<a name="l00098"></a>00098     <span class="comment">//  0,  0, 0,  0, 0,  1,-1,      0, 0, 0, 0,  1,-1, 1,-1,  1,-1, 1,-1,     1, 1, 1, 1, -1,-1,-1,-1</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">LbmFsgrSolver::dfVecX</a>[ cDirNum ] = { 
<a name="l00101"></a>00101         0, 0,0, 1,-1, 0,0,
<a name="l00102"></a>00102         1,-1,1,-1,
<a name="l00103"></a>00103         0,0,0,0,
<a name="l00104"></a>00104         1,1,-1,-1,
<a name="l00105"></a>00105          1,-1, 1,-1,
<a name="l00106"></a>00106          1,-1, 1,-1,
<a name="l00107"></a>00107     };
<a name="l00108"></a>00108     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">LbmFsgrSolver::dfVecY</a>[ cDirNum ] = { 
<a name="l00109"></a>00109         0, 1,-1, 0,0,0,0,
<a name="l00110"></a>00110         1,1,-1,-1,
<a name="l00111"></a>00111         1,1,-1,-1,
<a name="l00112"></a>00112         0,0,0,0,
<a name="l00113"></a>00113          1, 1,-1,-1,
<a name="l00114"></a>00114          1, 1,-1,-1
<a name="l00115"></a>00115     };
<a name="l00116"></a>00116     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">LbmFsgrSolver::dfVecZ</a>[ cDirNum ] = { 
<a name="l00117"></a>00117         0, 0,0,0,0,1,-1,
<a name="l00118"></a>00118         0,0,0,0,
<a name="l00119"></a>00119         1,-1,1,-1,
<a name="l00120"></a>00120         1,-1,1,-1,
<a name="l00121"></a>00121          1, 1, 1, 1,
<a name="l00122"></a>00122         -1,-1,-1,-1
<a name="l00123"></a>00123     };
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">LbmFsgrSolver::dfDvecX</a>[ cDirNum ] = {
<a name="l00126"></a>00126         0, 0,0, 1,-1, 0,0,
<a name="l00127"></a>00127         1,-1,1,-1,
<a name="l00128"></a>00128         0,0,0,0,
<a name="l00129"></a>00129         1,1,-1,-1,
<a name="l00130"></a>00130          1,-1, 1,-1,
<a name="l00131"></a>00131          1,-1, 1,-1
<a name="l00132"></a>00132     };
<a name="l00133"></a>00133     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">LbmFsgrSolver::dfDvecY</a>[ cDirNum ] = {
<a name="l00134"></a>00134         0, 1,-1, 0,0,0,0,
<a name="l00135"></a>00135         1,1,-1,-1,
<a name="l00136"></a>00136         1,1,-1,-1,
<a name="l00137"></a>00137         0,0,0,0,
<a name="l00138"></a>00138          1, 1,-1,-1,
<a name="l00139"></a>00139          1, 1,-1,-1
<a name="l00140"></a>00140     };
<a name="l00141"></a>00141     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">LbmFsgrSolver::dfDvecZ</a>[ cDirNum ] = {
<a name="l00142"></a>00142         0, 0,0,0,0,1,-1,
<a name="l00143"></a>00143         0,0,0,0,
<a name="l00144"></a>00144         1,-1,1,-1,
<a name="l00145"></a>00145         1,-1,1,-1,
<a name="l00146"></a>00146          1, 1, 1, 1,
<a name="l00147"></a>00147         -1,-1,-1,-1
<a name="l00148"></a>00148     };
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">/* principal directions */</span>
<a name="l00151"></a>00151     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4f943c26b303a5ba55c1c417145cd537">LbmFsgrSolver::princDirX</a>[ 2*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> ] = { 
<a name="l00152"></a>00152         1,-1, 0,0, 0,0
<a name="l00153"></a>00153     };
<a name="l00154"></a>00154     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4048e92de85246f4b06909810ba470f5">LbmFsgrSolver::princDirY</a>[ 2*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> ] = { 
<a name="l00155"></a>00155         0,0, 1,-1, 0,0
<a name="l00156"></a>00156     };
<a name="l00157"></a>00157     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0b83b761e5a957cd9f879efa012634a9">LbmFsgrSolver::princDirZ</a>[ 2*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> ] = { 
<a name="l00158"></a>00158         0,0, 0,0, 1,-1
<a name="l00159"></a>00159     };
<a name="l00160"></a>00160 
<a name="l00162"></a>00162     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1f2cc9a7d3fb406276d961df9fa4b81a">LbmFsgrSolver::lesCoeffDiag</a>[ (cDimension-1)*(cDimension-1) ][ cDirNum ];
<a name="l00163"></a>00163     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa6f23be7f20ebe749c64ad049d16bf31">LbmFsgrSolver::lesCoeffOffdiag</a>[ cDimension ][ cDirNum ];
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a002d8d48f62d78a83487f8d356c33cd7">LbmFsgrSolver::dfLength</a>[ cDfNum ]= { 
<a name="l00167"></a>00167         cCollenZero,
<a name="l00168"></a>00168         cCollenOne, cCollenOne, cCollenOne, 
<a name="l00169"></a>00169         cCollenOne, cCollenOne, cCollenOne,
<a name="l00170"></a>00170         cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo, 
<a name="l00171"></a>00171         cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo, 
<a name="l00172"></a>00172         cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo
<a name="l00173"></a>00173     };
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">/* precalculated equilibrium dfs, inited in lbmsolver constructor */</span>
<a name="l00176"></a>00176     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">LbmFsgrSolver::dfEquil</a>[ <a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> ];
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="preprocessor">#else // end LBMDIM==3 , LBMDIM==2</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a>00180 <span class="comment">/*****************************************************************************/</span>
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> = 2;
<a name="l00185"></a>00185 
<a name="l00187"></a>00187         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abe6a39ba1e50208d675853cc10debf03">LbmFsgrSolver::cCollenZero</a>    = (4.0/9.0);
<a name="l00188"></a>00188         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a82d9a6f74914c741c31765d6eff32db5">LbmFsgrSolver::cCollenOne</a>     = (1.0/9.0);
<a name="l00189"></a>00189         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3f59834e89bf83f354e3c1caea3edced">LbmFsgrSolver::cCollenSqrtTwo</a> = (1.0/36.0);
<a name="l00190"></a>00190 
<a name="l00192"></a>00192         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8e029171cc14805c4f04aa91743ffb3" title="threshold value for filled/emptied cells">LbmFsgrSolver::cMagicNr2</a>    = 1.0005;
<a name="l00193"></a>00193         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae9bbff2f12d4d25dfc956eb29dc24652">LbmFsgrSolver::cMagicNr2Neg</a> = -0.0005;
<a name="l00194"></a>00194         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab4207419776fcaa26c6f0a1334dc3081">LbmFsgrSolver::cMagicNr</a>     = 1.010001;
<a name="l00195"></a>00195         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2a1137ede205ecb934934a977606f224">LbmFsgrSolver::cMagicNrNeg</a>  = -0.010001;
<a name="l00196"></a>00196 
<a name="l00198"></a>00198         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">LbmFsgrSolver::cDfNum</a>  = 9;
<a name="l00199"></a>00199         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">LbmFsgrSolver::cDirNum</a> = 9;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">//const string LbmFsgrSolver::dfString[ cDfNum ] = { </span>
<a name="l00202"></a>00202     <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4fb3c32ebc0a125e41369eaa82e0178">LbmFsgrSolver::dfString</a>[ cDfNum ] = { 
<a name="l00203"></a>00203         <span class="stringliteral">&quot; C&quot;</span>, 
<a name="l00204"></a>00204         <span class="stringliteral">&quot; N&quot;</span>,   <span class="stringliteral">&quot; S&quot;</span>, <span class="stringliteral">&quot; E&quot;</span>, <span class="stringliteral">&quot; W&quot;</span>,
<a name="l00205"></a>00205         <span class="stringliteral">&quot;NE&quot;</span>, <span class="stringliteral">&quot;NW&quot;</span>, <span class="stringliteral">&quot;SE&quot;</span>,<span class="stringliteral">&quot;SW&quot;</span> 
<a name="l00206"></a>00206     };
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a56f8aa905db803ba957efc1421ca2022">LbmFsgrSolver::dfNorm</a>[ cDfNum ] = { 
<a name="l00209"></a>00209         cDirC, 
<a name="l00210"></a>00210         cDirN,  cDirS,  cDirE,  cDirW,
<a name="l00211"></a>00211         cDirNE, cDirNW, cDirSE, cDirSW 
<a name="l00212"></a>00212     };
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7298c005477abe4727db7ddb2368ad7">LbmFsgrSolver::dfInv</a>[ cDfNum ] = { 
<a name="l00215"></a>00215         cDirC,  
<a name="l00216"></a>00216         cDirS,  cDirN,  cDirW,  cDirE,
<a name="l00217"></a>00217         cDirSW, cDirSE, cDirNW, cDirNE 
<a name="l00218"></a>00218     };
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a47a9bb9f1a6c7c3cd05f9bbebe473ce2">LbmFsgrSolver::dfRefX</a>[ cDfNum ] = { 
<a name="l00221"></a>00221         0,  
<a name="l00222"></a>00222         0,  0,  0,  0,
<a name="l00223"></a>00223         cDirSE, cDirSW, cDirNE, cDirNW 
<a name="l00224"></a>00224     };
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a15e48bbfff329e4700257e6ff29ff34f">LbmFsgrSolver::dfRefY</a>[ cDfNum ] = { 
<a name="l00227"></a>00227         0,  
<a name="l00228"></a>00228         0,  0,  0,  0,
<a name="l00229"></a>00229         cDirNW, cDirNE, cDirSW, cDirSE 
<a name="l00230"></a>00230     };
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8cbfcdd8e3a307029550ff6390195624">LbmFsgrSolver::dfRefZ</a>[ cDfNum ] = { 
<a name="l00233"></a>00233         0,  0, 0, 0, 0,
<a name="l00234"></a>00234         0, 0, 0, 0
<a name="l00235"></a>00235     };
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="comment">// Vector Order 2D:</span>
<a name="l00238"></a>00238     <span class="comment">// 0  1 2  3  4  5  6 7  8</span>
<a name="l00239"></a>00239     <span class="comment">// 0, 0,0, 1,-1, 1,-1,1,-1 </span>
<a name="l00240"></a>00240     <span class="comment">// 0, 1,-1, 0,0, 1,1,-1,-1 </span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">LbmFsgrSolver::dfVecX</a>[ cDirNum ] = { 
<a name="l00243"></a>00243         0, 
<a name="l00244"></a>00244         0,0, 1,-1,
<a name="l00245"></a>00245         1,-1,1,-1 
<a name="l00246"></a>00246     };
<a name="l00247"></a>00247     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">LbmFsgrSolver::dfVecY</a>[ cDirNum ] = { 
<a name="l00248"></a>00248         0, 
<a name="l00249"></a>00249         1,-1, 0,0,
<a name="l00250"></a>00250         1,1,-1,-1 
<a name="l00251"></a>00251     };
<a name="l00252"></a>00252     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">LbmFsgrSolver::dfVecZ</a>[ cDirNum ] = { 
<a name="l00253"></a>00253         0, 0,0,0,0, 0,0,0,0 
<a name="l00254"></a>00254     };
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">LbmFsgrSolver::dfDvecX</a>[ cDirNum ] = {
<a name="l00257"></a>00257         0, 
<a name="l00258"></a>00258         0,0, 1,-1,
<a name="l00259"></a>00259         1,-1,1,-1 
<a name="l00260"></a>00260     };
<a name="l00261"></a>00261     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">LbmFsgrSolver::dfDvecY</a>[ cDirNum ] = {
<a name="l00262"></a>00262         0, 
<a name="l00263"></a>00263         1,-1, 0,0,
<a name="l00264"></a>00264         1,1,-1,-1 
<a name="l00265"></a>00265     };
<a name="l00266"></a>00266     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">LbmFsgrSolver::dfDvecZ</a>[ cDirNum ] = {
<a name="l00267"></a>00267         0, 0,0,0,0, 0,0,0,0 
<a name="l00268"></a>00268     };
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4f943c26b303a5ba55c1c417145cd537">LbmFsgrSolver::princDirX</a>[ 2*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> ] = { 
<a name="l00271"></a>00271         1,-1, 0,0
<a name="l00272"></a>00272     };
<a name="l00273"></a>00273     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4048e92de85246f4b06909810ba470f5">LbmFsgrSolver::princDirY</a>[ 2*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> ] = { 
<a name="l00274"></a>00274         0,0, 1,-1
<a name="l00275"></a>00275     };
<a name="l00276"></a>00276     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0b83b761e5a957cd9f879efa012634a9">LbmFsgrSolver::princDirZ</a>[ 2*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7ab108b6f816953aeccf87751d2b1a9e" title="how many dimensions? UNUSED? replace by LBMDIM?">LbmFsgrSolver::cDimension</a> ] = { 
<a name="l00277"></a>00277         0,0, 0,0
<a name="l00278"></a>00278     };
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00282"></a>00282     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1f2cc9a7d3fb406276d961df9fa4b81a">LbmFsgrSolver::lesCoeffDiag</a>[ (cDimension-1)*(cDimension-1) ][ cDirNum ];
<a name="l00283"></a>00283     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa6f23be7f20ebe749c64ad049d16bf31">LbmFsgrSolver::lesCoeffOffdiag</a>[ cDimension ][ cDirNum ];
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a002d8d48f62d78a83487f8d356c33cd7">LbmFsgrSolver::dfLength</a>[ cDfNum ]= { 
<a name="l00287"></a>00287         cCollenZero,
<a name="l00288"></a>00288         cCollenOne, cCollenOne, cCollenOne, cCollenOne, 
<a name="l00289"></a>00289         cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo, cCollenSqrtTwo
<a name="l00290"></a>00290     };
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">/* precalculated equilibrium dfs, inited in lbmsolver constructor */</span>
<a name="l00293"></a>00293     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">LbmFsgrSolver::dfEquil</a>[ <a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> ];
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="comment">// D2Q9 end</span>
<a name="l00296"></a>00296 <span class="preprocessor">#endif  // LBMDIM==2</span>
<a name="l00297"></a>00297 <span class="preprocessor"></span>
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="comment">// required globals</span>
<a name="l00300"></a>00300 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a8557d7859f8e6298ad044884ae8212f1">glob_mpactive</a>;
<a name="l00301"></a>00301 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a>, <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a>;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="comment">/******************************************************************************</span>
<a name="l00305"></a>00305 <span class="comment"> * Lbm Constructor</span>
<a name="l00306"></a>00306 <span class="comment"> *****************************************************************************/</span>
<a name="l00307"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a437549efd8c854096f5db9ae193f6a75">00307</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a437549efd8c854096f5db9ae193f6a75" title="Constructor.">LbmFsgrSolver::LbmFsgrSolver</a>() :
<a name="l00308"></a>00308     <span class="comment">//D(),</span>
<a name="l00309"></a>00309     mCurrentMass(0.0), mCurrentVolume(0.0),
<a name="l00310"></a>00310     mNumProblems(0), 
<a name="l00311"></a>00311     mAvgMLSUPS(0.0), mAvgMLSUPSCnt(0.0),
<a name="l00312"></a>00312     mpPreviewSurface(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), 
<a name="l00313"></a>00313     mTimeAdap(true), mForceTimeStepReduce(false),
<a name="l00314"></a>00314     mFVHeight(0.0), mFVArea(1.0), mUpdateFVHeight(false),
<a name="l00315"></a>00315     mInitSurfaceSmoothing(0), mFsSurfGenSetting(0),
<a name="l00316"></a>00316     mTimestepReduceLock(0),
<a name="l00317"></a>00317     mTimeSwitchCounts(0), mTimeMaxvelStepCnt(0),
<a name="l00318"></a>00318     mSimulationTime(0.0), mLastSimTime(0.0),
<a name="l00319"></a>00319     mMinTimestep(0.0), mMaxTimestep(0.0),
<a name="l00320"></a>00320     mMaxNoCells(0), mMinNoCells(0), mAvgNumUsedCells(0),
<a name="l00321"></a>00321     mObjectSpeeds(), mObjectPartslips(), mObjectMassMovnd(),
<a name="l00322"></a>00322     mMOIVertices(), mMOIVerticesOld(), mMOINormals(),
<a name="l00323"></a>00323     mIsoWeightMethod(1),
<a name="l00324"></a>00324     mMaxRefine(1), 
<a name="l00325"></a>00325     mDfScaleUp(-1.0), mDfScaleDown(-1.0),
<a name="l00326"></a>00326     mInitialCsmago(0.02), <span class="comment">// set to 0.02 for mMaxRefine==0 below and default for fine level, coarser ones are 0.03</span>
<a name="l00327"></a>00327     mDebugOmegaRet(0.0),
<a name="l00328"></a>00328     mLastOmega(1e10), mLastGravity(1e10),
<a name="l00329"></a>00329     mNumInvIfTotal(0), mNumFsgrChanges(0),
<a name="l00330"></a>00330     mDisableStandingFluidInit(0),
<a name="l00331"></a>00331     mInit2dYZ(false),
<a name="l00332"></a>00332     mForceTadapRefine(-1), mCutoff(-1)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a> = <span class="keyword">new</span> <a class="code" href="../../d3/de0/classLbmControlData.html">LbmControlData</a>();
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>    mpTest = <span class="keyword">new</span> LbmTestdata();
<a name="l00338"></a>00338     mMpNum = mMpIndex = 0;
<a name="l00339"></a>00339     mOrgSizeX = 0;
<a name="l00340"></a>00340     mOrgStartX = 0.;
<a name="l00341"></a>00341     mOrgEndX = 0.;
<a name="l00342"></a>00342 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS!=1</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>    <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a> = <span class="keyword">new</span> <a class="code" href="../../db/db9/classIsoSurface.html" title="class to triangulate a scalar field, e.g. for">IsoSurface</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a> );
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   <span class="comment">// init equilibrium dist. func </span>
<a name="l00346"></a>00346   <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rho=1.0;
<a name="l00347"></a>00347   <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> {
<a name="l00348"></a>00348         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">dfEquil</a>[l] = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a25c5045bdb65c365067fbe6ca53a35a5">getCollideEq</a>( l,rho,  0.0, 0.0, 0.0);
<a name="l00349"></a>00349   }
<a name="l00350"></a>00350     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">dfEquil</a>[<a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>] = 1.;
<a name="l00351"></a>00351     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">dfEquil</a>[<a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>] = 1.;
<a name="l00352"></a>00352     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">dfEquil</a>[<a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>] = <a class="code" href="../../d1/d24/solver__class_8h.html#a604e06bc4a635aac711c4d0b29dfa1ef">FLUX_INIT</a>;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="comment">// init LES</span>
<a name="l00355"></a>00355     <span class="keywordtype">int</span> odm = 0;
<a name="l00356"></a>00356     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0; m&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>; m++) { 
<a name="l00357"></a>00357         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l00358"></a>00358             this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1f2cc9a7d3fb406276d961df9fa4b81a">lesCoeffDiag</a>[m][l] = 
<a name="l00359"></a>00359             this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa6f23be7f20ebe749c64ad049d16bf31">lesCoeffOffdiag</a>[m][l] = 0.0;
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0; m&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>; m++) { 
<a name="l00363"></a>00363         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0; n&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>; n++) { 
<a name="l00364"></a>00364             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=1; l&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l00365"></a>00365                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> em;
<a name="l00366"></a>00366                 <span class="keywordflow">switch</span>(m) {
<a name="l00367"></a>00367                     <span class="keywordflow">case</span> 0: em = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]; <span class="keywordflow">break</span>;
<a name="l00368"></a>00368                     <span class="keywordflow">case</span> 1: em = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]; <span class="keywordflow">break</span>;
<a name="l00369"></a>00369                     <span class="keywordflow">case</span> 2: em = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]; <span class="keywordflow">break</span>;
<a name="l00370"></a>00370                     <span class="keywordflow">default</span>: em = -1.0; <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;SMAGO1&quot;</span>,<span class="stringliteral">&quot;err m=&quot;</span>&lt;&lt;m, <a class="code" href="../../de/df0/utilities_8h.html#af2f6eab59be57681799dbee88ff4c4a7">SIMWORLD_GENERICERROR</a>);
<a name="l00371"></a>00371                 }
<a name="l00372"></a>00372                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> en;
<a name="l00373"></a>00373                 <span class="keywordflow">switch</span>(n) {
<a name="l00374"></a>00374                     <span class="keywordflow">case</span> 0: en = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]; <span class="keywordflow">break</span>;
<a name="l00375"></a>00375                     <span class="keywordflow">case</span> 1: en = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]; <span class="keywordflow">break</span>;
<a name="l00376"></a>00376                     <span class="keywordflow">case</span> 2: en = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]; <span class="keywordflow">break</span>;
<a name="l00377"></a>00377                     <span class="keywordflow">default</span>: en = -1.0; <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;SMAGO2&quot;</span>,<span class="stringliteral">&quot;err n=&quot;</span>&lt;&lt;n, <a class="code" href="../../de/df0/utilities_8h.html#af2f6eab59be57681799dbee88ff4c4a7">SIMWORLD_GENERICERROR</a>);
<a name="l00378"></a>00378                 }
<a name="l00379"></a>00379                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> coeff = em*en;
<a name="l00380"></a>00380                 <span class="keywordflow">if</span>(m==n) {
<a name="l00381"></a>00381                     this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1f2cc9a7d3fb406276d961df9fa4b81a">lesCoeffDiag</a>[m][l] = coeff;
<a name="l00382"></a>00382                 } <span class="keywordflow">else</span> {
<a name="l00383"></a>00383                     <span class="keywordflow">if</span>(m&gt;n) {
<a name="l00384"></a>00384                         this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa6f23be7f20ebe749c64ad049d16bf31">lesCoeffOffdiag</a>[odm][l] = coeff;
<a name="l00385"></a>00385                     }
<a name="l00386"></a>00386                 }
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389             <span class="keywordflow">if</span>(m==n) {
<a name="l00390"></a>00390             } <span class="keywordflow">else</span> {
<a name="l00391"></a>00391                 <span class="keywordflow">if</span>(m&gt;n) odm++;
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a80a908d9f984a5888a67b806d7e648a1" title="normalized vectors for all neighboring cell directions (for e.g. massdweight calc)">mDvecNrm</a>[0] = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(0.0);
<a name="l00397"></a>00397   <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l00398"></a>00398         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a80a908d9f984a5888a67b806d7e648a1" title="normalized vectors for all neighboring cell directions (for e.g. massdweight calc)">mDvecNrm</a>[l] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ac43d14a1c6daaaff84ddd054b5c4db7d">getNormalized</a>( 
<a name="l00399"></a>00399             <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7298c005477abe4727db7ddb2368ad7">dfInv</a>[l]], <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7298c005477abe4727db7ddb2368ad7">dfInv</a>[l]], <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7298c005477abe4727db7ddb2368ad7">dfInv</a>[l]] ) 
<a name="l00400"></a>00400             ) * -1.0; 
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="comment">// calculate gauss weights for restriction</span>
<a name="l00404"></a>00404     <span class="comment">//LbmFloat mGaussw[27];</span>
<a name="l00405"></a>00405     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> totGaussw = 0.0;
<a name="l00406"></a>00406     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> alpha = 1.0;
<a name="l00407"></a>00407     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gw = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(2.0*LBMDIM);
<a name="l00408"></a>00408 <span class="preprocessor">#if ELBEEM_PLUGIN!=1</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>    <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;coarseRestrictFromFine&quot;</span>, <span class="stringliteral">&quot;TCRFF_DFDEBUG2 test df/dir num!&quot;</span>);
<a name="l00410"></a>00410 <span class="preprocessor">#endif</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;(n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>); n++) { <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60387fa1b8899deb8c6a484ab35a2939">mGaussw</a>[n] = 0.0; }
<a name="l00412"></a>00412     <span class="comment">//for(int n=0;(n&lt;cDirNum); n++) { </span>
<a name="l00413"></a>00413     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;(n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>); n++) { 
<a name="l00414"></a>00414         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> d = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[n], <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[n], <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[n]));
<a name="l00415"></a>00415         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> w = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a74e69ce0b646f9188ada8ca358cf0c32">expf</a>( -alpha*d*d ) - <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a74e69ce0b646f9188ada8ca358cf0c32">expf</a>( -alpha*gw*gw );
<a name="l00416"></a>00416         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60387fa1b8899deb8c6a484ab35a2939">mGaussw</a>[n] = w;
<a name="l00417"></a>00417         totGaussw += w;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=0;(n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>); n++) { 
<a name="l00420"></a>00420         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60387fa1b8899deb8c6a484ab35a2939">mGaussw</a>[n] = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60387fa1b8899deb8c6a484ab35a2939">mGaussw</a>[n]/totGaussw;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 <span class="comment">/*****************************************************************************/</span>
<a name="l00426"></a>00426 <span class="comment">/* Destructor */</span>
<a name="l00427"></a>00427 <span class="comment">/*****************************************************************************/</span>
<a name="l00428"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a30665918c3822c33de007340c1353311">00428</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a30665918c3822c33de007340c1353311" title="Destructor.">LbmFsgrSolver::~LbmFsgrSolver</a>()
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430   <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#a0cb712be00a6c0fe651a2798abe4ab88">mInitDone</a>){ <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::LbmFsgrSolver&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;not inited...&quot;</span>,0); <span class="keywordflow">return</span>; }
<a name="l00431"></a>00431 <span class="preprocessor">#if COMPRESSGRIDS==1</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span>    <span class="keyword">delete</span> [] <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1];
<a name="l00433"></a>00433     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[0] = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00434"></a>00434 <span class="preprocessor">#endif // COMPRESSGRIDS==1</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span>
<a name="l00436"></a>00436     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00437"></a>00437         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;2; s++) {
<a name="l00438"></a>00438             <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mprsCells[s]) <span class="keyword">delete</span> [] <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[s];
<a name="l00439"></a>00439             <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].mprsFlags[s]) <span class="keyword">delete</span> [] <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[s];
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442     <span class="keyword">delete</span> <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>;
<a name="l00443"></a>00443     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>) <span class="keyword">delete</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>;
<a name="l00444"></a>00444     <span class="comment">// cleanup done during scene deletion...</span>
<a name="l00445"></a>00445     
<a name="l00446"></a>00446     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>) <span class="keyword">delete</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="comment">// always output performance estimate</span>
<a name="l00449"></a>00449     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::~LbmFsgrSolver&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot; Avg. MLSUPS:&quot;</span>&lt;&lt;(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2907db3903d0cd35906af14ee97df99d">mAvgMLSUPS</a>/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1bd3f16b8c7bf908c3ca3e7e06dbfb57">mAvgMLSUPSCnt</a>), 5);
<a name="l00450"></a>00450   <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#aee34210942d51f7babe9ad9d367e350f" title="debug output?">mSilent</a>) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::~LbmFsgrSolver&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Deleted...&quot;</span>,10);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 <span class="comment">/******************************************************************************</span>
<a name="l00457"></a>00457 <span class="comment"> * initilize variables fom attribute list </span>
<a name="l00458"></a>00458 <span class="comment"> *****************************************************************************/</span>
<a name="l00459"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5ba93df2b9b54373777c18c2333b6667">00459</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5ba93df2b9b54373777c18c2333b6667" title="initilize variables fom attribute list">LbmFsgrSolver::parseAttrList</a>()
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a3154928a8bb73508a8c651cb5bde4da2">LbmSolverInterface::parseStdAttrList</a>();
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <span class="keywordtype">string</span> matIso(<span class="stringliteral">&quot;default&quot;</span>);
<a name="l00464"></a>00464     matIso = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;material_surf&quot;</span>, matIso, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mpIso-&gt;material&quot;</span>, <span class="keyword">false</span> );
<a name="l00465"></a>00465     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a41270c547b85924e5812f6066f646c92">setMaterialName</a>( matIso );
<a name="l00466"></a>00466     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;surfacepreview&quot;</span>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mOutputSurfacePreview&quot;</span>, <span class="keyword">false</span> );
<a name="l00467"></a>00467     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cc8dd62ffb041fcb2068e7da4bb4e5c" title="use time adaptivity?">mTimeAdap</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;timeadap&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cc8dd62ffb041fcb2068e7da4bb4e5c" title="use time adaptivity?">mTimeAdap</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mTimeAdap&quot;</span>, <span class="keyword">false</span> );
<a name="l00468"></a>00468     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;domainbound&quot;</span>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mDomainBound&quot;</span>, <span class="keyword">false</span> );
<a name="l00469"></a>00469     <a class="code" href="../../db/dff/classLbmSolverInterface.html#af25e799a38280a056e6c671e9b04fb6b" title="part slip value for domain">mDomainPartSlipValue</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;domainpartslip&quot;</span>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#af25e799a38280a056e6c671e9b04fb6b" title="part slip value for domain">mDomainPartSlipValue</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mDomainPartSlipValue&quot;</span>, <span class="keyword">false</span> );
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aae6073b616274130e4ac707904d8b922" title="get isofield weights">mIsoWeightMethod</a>= <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;isoweightmethod&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aae6073b616274130e4ac707904d8b922" title="get isofield weights">mIsoWeightMethod</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mIsoWeightMethod&quot;</span>, <span class="keyword">false</span> );
<a name="l00472"></a>00472     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a39c6380bbad6fcd49c9406379400d74e" title="smoother surface initialization?">mInitSurfaceSmoothing</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;initsurfsmooth&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a39c6380bbad6fcd49c9406379400d74e" title="smoother surface initialization?">mInitSurfaceSmoothing</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mInitSurfaceSmoothing&quot;</span>, <span class="keyword">false</span> );
<a name="l00473"></a>00473     <a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;smoothsurface&quot;</span>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mSmoothSurface&quot;</span>, <span class="keyword">false</span> );
<a name="l00474"></a>00474     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;smoothnormals&quot;</span>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mSmoothNormals&quot;</span>, <span class="keyword">false</span> );
<a name="l00475"></a>00475     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;fssurfgen&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mFsSurfGenSetting&quot;</span>, <span class="keyword">false</span> );
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="comment">// refinement</span>
<a name="l00478"></a>00478     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5757f57ac502d30974ecd77ebbfe8c34" title="use refinement/coarsening?">mRefinementDesired</a>;
<a name="l00479"></a>00479     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>  = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;maxrefine&quot;</span>,  <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mMaxRefine&quot;</span>, <span class="keyword">false</span>);
<a name="l00480"></a>00480     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>&lt;0) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>=0;
<a name="l00481"></a>00481     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>&gt;<a class="code" href="../../d1/d24/solver__class_8h.html#a941a5274e5be5fa2452b380a17449c38" title="maxmimum no. of grid levels">FSGR_MAXNOOFLEVELS</a>) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>=<a class="code" href="../../d1/d24/solver__class_8h.html#a941a5274e5be5fa2452b380a17449c38" title="maxmimum no. of grid levels">FSGR_MAXNOOFLEVELS</a>-1;
<a name="l00482"></a>00482     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad012646c0df61548d43ee1090d906ca3" title="debug function to disable standing f init">mDisableStandingFluidInit</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;disable_stfluidinit&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad012646c0df61548d43ee1090d906ca3" title="debug function to disable standing f init">mDisableStandingFluidInit</a>,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mDisableStandingFluidInit&quot;</span>, <span class="keyword">false</span>);
<a name="l00483"></a>00483     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6ccfd5955d6fae383b7527bb2723a764" title="init 2d with skipped Y/Z coords">mInit2dYZ</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;init2dyz&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6ccfd5955d6fae383b7527bb2723a764" title="init 2d with skipped Y/Z coords">mInit2dYZ</a>,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mInit2dYZ&quot;</span>, <span class="keyword">false</span>);
<a name="l00484"></a>00484     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af37e074ce172193f02148c166518e220" title="debug function to force tadap syncing">mForceTadapRefine</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;forcetadaprefine&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af37e074ce172193f02148c166518e220" title="debug function to force tadap syncing">mForceTadapRefine</a>,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mForceTadapRefine&quot;</span>, <span class="keyword">false</span>);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="comment">// demo mode settings</span>
<a name="l00487"></a>00487     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abb0f406ebbf469e1153877413af0d573" title="fluid vol height">mFVHeight</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;fvolheight&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abb0f406ebbf469e1153877413af0d573" title="fluid vol height">mFVHeight</a>, <span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>,<span class="stringliteral">&quot;mFVHeight&quot;</span>, <span class="keyword">false</span> );
<a name="l00488"></a>00488     <span class="comment">// FIXME check needed?</span>
<a name="l00489"></a>00489     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a10b64cbe82425bfd2453000cfe7ef9dc">mFVArea</a>   = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;fvolarea&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a10b64cbe82425bfd2453000cfe7ef9dc">mFVArea</a>, <span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>,<span class="stringliteral">&quot;mFArea&quot;</span>, <span class="keyword">false</span> );
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">// debugging - skip some time...</span>
<a name="l00492"></a>00492     <span class="keywordtype">double</span> starttimeskip = 0.;
<a name="l00493"></a>00493     starttimeskip = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;forcestarttimeskip&quot;</span>, starttimeskip, <span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>,<span class="stringliteral">&quot;starttimeskip&quot;</span>, <span class="keyword">false</span> );
<a name="l00494"></a>00494     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a> += starttimeskip;
<a name="l00495"></a>00495     <span class="keywordflow">if</span>(starttimeskip&gt;0.) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::parseStdAttrList&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>,<span class="stringliteral">&quot;Used starttimeskip=&quot;</span>&lt;&lt;starttimeskip&lt;&lt;<span class="stringliteral">&quot;, t=&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>, 1);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a97756b3496baf57a65e7de699096b862">parseControldataAttrList</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00500"></a>00500 <span class="preprocessor"></span>    <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a> = 0;
<a name="l00501"></a>00501     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;use_testdata&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mUseTestdata&quot;</span>, <span class="keyword">false</span>);
<a name="l00502"></a>00502     mpTest-&gt;parseTestdataAttrList(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>);
<a name="l00503"></a>00503 <span class="preprocessor">#ifdef ELBEEM_PLUGIN</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span>    <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>=1; <span class="comment">// DEBUG</span>
<a name="l00505"></a>00505 <span class="preprocessor">#endif // ELBEEM_PLUGIN</span>
<a name="l00506"></a>00506 <span class="preprocessor"></span>
<a name="l00507"></a>00507     mMpNum = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;mpnum&quot;</span>,  mMpNum ,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mMpNum&quot;</span>, <span class="keyword">false</span>);
<a name="l00508"></a>00508     mMpIndex = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;mpindex&quot;</span>,  mMpIndex ,<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;mMpIndex&quot;</span>, <span class="keyword">false</span>);
<a name="l00509"></a>00509     <span class="keywordflow">if</span>(<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a8557d7859f8e6298ad044884ae8212f1">glob_mpactive</a>) {
<a name="l00510"></a>00510         <span class="comment">// used instead...</span>
<a name="l00511"></a>00511         mMpNum = <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a>;
<a name="l00512"></a>00512         mMpIndex = <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a>;
<a name="l00513"></a>00513     } <span class="keywordflow">else</span> {
<a name="l00514"></a>00514         <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a> = mMpNum;
<a name="l00515"></a>00515         <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a> = 0;
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::parseAttrList&quot;</span>,<span class="stringliteral">&quot; mpactive:&quot;</span>&lt;&lt;<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a8557d7859f8e6298ad044884ae8212f1">glob_mpactive</a>&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a>&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a>);
<a name="l00518"></a>00518     <span class="keywordflow">if</span>(mMpNum&gt;0) {
<a name="l00519"></a>00519         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>=1; <span class="comment">// needed in this case...</span>
<a name="l00520"></a>00520     }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::LBM_INCLUDE_TESTSOLVERS&quot;</span>,<span class="stringliteral">&quot;Active, mUseTestdata:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>);
<a name="l00523"></a>00523 <span class="preprocessor">#else // LBM_INCLUDE_TESTSOLVERS!=1</span>
<a name="l00524"></a>00524 <span class="preprocessor"></span>    <span class="comment">// not testsolvers, off by default</span>
<a name="l00525"></a>00525     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a> = 0;
<a name="l00526"></a>00526     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a10f9f663715f1587859a0106518a355c">mFarFieldSize</a>&gt;=2.) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>=1; <span class="comment">// equiv. to test solver check</span>
<a name="l00527"></a>00527 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS!=1</span>
<a name="l00528"></a>00528 <span class="preprocessor"></span>
<a name="l00529"></a>00529     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;csmago&quot;</span>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a>, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mInitialCsmago&quot;</span>, <span class="keyword">false</span> );
<a name="l00530"></a>00530     <span class="comment">// deprecated!</span>
<a name="l00531"></a>00531     <span class="keywordtype">float</span> mInitialCsmagoCoarse = 0.0;
<a name="l00532"></a>00532     mInitialCsmagoCoarse = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aac341fa61039056eecf68f3aefd6635e">mpSifAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;csmago_coarse&quot;</span>, mInitialCsmagoCoarse, <span class="stringliteral">&quot;SimulationLbm&quot;</span>,<span class="stringliteral">&quot;mInitialCsmagoCoarse&quot;</span>, <span class="keyword">false</span> );
<a name="l00533"></a>00533 <span class="preprocessor">#if USE_LES==1</span>
<a name="l00534"></a>00534 <span class="preprocessor"></span><span class="preprocessor">#else // USE_LES==1</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>    <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#aac9413fb9eeba06e80c56258d95b15d6">DM_WARNING</a>, <span class="stringliteral">&quot;LES model switched off!&quot;</span>,2);
<a name="l00536"></a>00536     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a> = 0.0;
<a name="l00537"></a>00537 <span class="preprocessor">#endif // USE_LES==1</span>
<a name="l00538"></a>00538 <span class="preprocessor"></span>}
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="comment">/******************************************************************************</span>
<a name="l00542"></a>00542 <span class="comment"> * (part of enabling chapter 6 of &quot;Free Surface Flows with Moving and Deforming Objects for LBM&quot;)</span>
<a name="l00543"></a>00543 <span class="comment"> *****************************************************************************/</span>
<a name="l00544"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a16d31471f6c485f8b893c3984c6ff7ca">00544</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a16d31471f6c485f8b893c3984c6ff7ca">LbmFsgrSolver::setSurfGenSettings</a>(<span class="keywordtype">short</span> value)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a> = value;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="comment">/******************************************************************************</span>
<a name="l00551"></a>00551 <span class="comment"> * Initialize omegas and forces on all levels (for init/timestep change)</span>
<a name="l00552"></a>00552 <span class="comment"> *****************************************************************************/</span>
<a name="l00553"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1eedd6b2c8bd318a4cdd4e868d41c1eb">00553</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1eedd6b2c8bd318a4cdd4e868d41c1eb" title="Initialize omegas and forces on all levels (for init/timestep change)">LbmFsgrSolver::initLevelOmegas</a>()
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555     <span class="comment">// no explicit settings</span>
<a name="l00556"></a>00556     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a05c2c96e47bd1e16cf283c1faecbb81a">mOmega</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad2da115601348e590176cee61a3178ee">calculateOmega</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>);
<a name="l00557"></a>00557     <a class="code" href="../../db/dff/classLbmSolverInterface.html#aaa58828936b2da1016a8074d6bdca32f">mGravity</a> = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ab7bb4a73d49cd7ad9e7a304f272ac7b6">calculateGravity</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) );
<a name="l00558"></a>00558     <a class="code" href="../../db/dff/classLbmSolverInterface.html#af5a5d5ee204709878b19fa80e6280d7e">mSurfaceTension</a> = 0.; <span class="comment">//mpParam-&gt;calculateSurfaceTension(); // unused</span>
<a name="l00559"></a>00559     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6ccfd5955d6fae383b7527bb2723a764" title="init 2d with skipped Y/Z coords">mInit2dYZ</a>) { <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a57568d312ee64b00a955a41b7c3e06bc">SWAPYZ</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aaa58828936b2da1016a8074d6bdca32f">mGravity</a>); }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <span class="comment">// check if last init was ok</span>
<a name="l00562"></a>00562     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gravDelta = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aaa58828936b2da1016a8074d6bdca32f">mGravity</a>-<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7006537d517844b481f420234d4651b">mLastGravity</a>);
<a name="l00563"></a>00563     <span class="comment">//errMsg(&quot;ChannelAnimDebug&quot;,&quot;t:&quot;&lt;&lt;mSimulationTime&lt;&lt;&quot; om:&quot;&lt;&lt;mOmega&lt;&lt;&quot; - lom:&quot;&lt;&lt;mLastOmega&lt;&lt;&quot; gv:&quot;&lt;&lt;mGravity&lt;&lt;&quot; - &quot;&lt;&lt;mLastGravity&lt;&lt;&quot; , &quot;&lt;&lt;gravDelta  );</span>
<a name="l00564"></a>00564     <span class="keywordflow">if</span>((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a05c2c96e47bd1e16cf283c1faecbb81a">mOmega</a> == <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a995fb2471db6427a7fa58c1ddbc61b10">mLastOmega</a>) &amp;&amp; (gravDelta&lt;=0.0)) <span class="keywordflow">return</span>;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a>&lt;=0.0) {
<a name="l00567"></a>00567         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a315bc020e2cf25a9079f63de8f626eaf" title="order of interpolation (0=always current/1=interpolate/2=always other)">OPT3D</a>==1) {
<a name="l00568"></a>00568             <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initLevelOmegas&quot;</span>,<span class="stringliteral">&quot;Csmago-LES = 0 not supported for optimized 3D version...&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>); 
<a name="l00569"></a>00569             <span class="keywordflow">return</span>;
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>  fineCsmago  = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a>;
<a name="l00574"></a>00574     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> coarseCsmago = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a>;
<a name="l00575"></a>00575     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxFineCsmago1    = 0.026; 
<a name="l00576"></a>00576     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxCoarseCsmago1  = 0.029; <span class="comment">// try stabilizing</span>
<a name="l00577"></a>00577     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxFineCsmago2    = 0.028; 
<a name="l00578"></a>00578     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxCoarseCsmago2  = 0.032; <span class="comment">// try stabilizing some more</span>
<a name="l00579"></a>00579     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>==1)&amp;&amp;(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a>&lt;maxFineCsmago1)) {
<a name="l00580"></a>00580         fineCsmago = maxFineCsmago1;
<a name="l00581"></a>00581         coarseCsmago = maxCoarseCsmago1;
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>&gt;1)&amp;&amp;(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0099615ea0c7367c766b67b037782444">mInitialCsmago</a>&lt;maxFineCsmago2)) {
<a name="l00584"></a>00584         fineCsmago = maxFineCsmago2;
<a name="l00585"></a>00585         coarseCsmago = maxCoarseCsmago2;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587         
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">// use Tau instead of Omega for calculations</span>
<a name="l00590"></a>00590     { <span class="comment">// init base level</span>
<a name="l00591"></a>00591         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00592"></a>00592         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>    = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a05c2c96e47bd1e16cf283c1faecbb81a">mOmega</a>;
<a name="l00593"></a>00593         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>();
<a name="l00594"></a>00594         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a5f850ad4e47f67fbd293d5e859e0eee0" title="smago params and precalculated values">lcsmago</a> = fineCsmago; <span class="comment">//CSMAGO_INITIAL;</span>
<a name="l00595"></a>00595         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7877621c35a71a7916968f28e55ec8d0">lcsmago_sqr</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a5f850ad4e47f67fbd293d5e859e0eee0" title="smago params and precalculated values">lcsmago</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a5f850ad4e47f67fbd293d5e859e0eee0" title="smago params and precalculated values">lcsmago</a>;
<a name="l00596"></a>00596         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ae7654c460960b7fb56dfbb8d3db5f22e">lcnu</a> = (2.0* (1.0/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>)-1.0) * (1.0/6.0);
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="comment">// init all sub levels</span>
<a name="l00600"></a>00600     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00601"></a>00601         <span class="comment">//mLevel[i].omega = 2.0 * (mLevel[i+1].omega-0.5) + 0.5;</span>
<a name="l00602"></a>00602         <span class="keywordtype">double</span> nomega = 0.5 * (  (1.0/(double)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].omega) -0.5) + 0.5;
<a name="l00603"></a>00603         nomega                = 1.0/nomega;
<a name="l00604"></a>00604         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>       = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)nomega;
<a name="l00605"></a>00605         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>    = 2.0 * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>;
<a name="l00606"></a>00606         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a5f850ad4e47f67fbd293d5e859e0eee0" title="smago params and precalculated values">lcsmago</a> = coarseCsmago;
<a name="l00607"></a>00607         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7877621c35a71a7916968f28e55ec8d0">lcsmago_sqr</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a5f850ad4e47f67fbd293d5e859e0eee0" title="smago params and precalculated values">lcsmago</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a5f850ad4e47f67fbd293d5e859e0eee0" title="smago params and precalculated values">lcsmago</a>;
<a name="l00608"></a>00608         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ae7654c460960b7fb56dfbb8d3db5f22e">lcnu</a>        = (2.0* (1.0/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>)-1.0) * (1.0/6.0);
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610     
<a name="l00611"></a>00611     <span class="comment">// for lbgk</span>
<a name="l00612"></a>00612     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aaa58828936b2da1016a8074d6bdca32f">mGravity</a> / <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>;
<a name="l00613"></a>00613     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00614"></a>00614         <span class="comment">// should be the same on all levels...</span>
<a name="l00615"></a>00615         <span class="comment">// for lbgk</span>
<a name="l00616"></a>00616         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a> = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a> * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>) * 2.0 / <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].omega;
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a995fb2471db6427a7fa58c1ddbc61b10">mLastOmega</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a05c2c96e47bd1e16cf283c1faecbb81a">mOmega</a>;
<a name="l00620"></a>00620     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad7006537d517844b481f420234d4651b">mLastGravity</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aaa58828936b2da1016a8074d6bdca32f">mGravity</a>;
<a name="l00621"></a>00621     <span class="comment">// debug? invalidate old values...</span>
<a name="l00622"></a>00622     <a class="code" href="../../db/dff/classLbmSolverInterface.html#aaa58828936b2da1016a8074d6bdca32f">mGravity</a> = -100.0;
<a name="l00623"></a>00623     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a05c2c96e47bd1e16cf283c1faecbb81a">mOmega</a> = -100.0;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00626"></a>00626         <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#aee34210942d51f7babe9ad9d367e350f" title="debug output?">mSilent</a>) {
<a name="l00627"></a>00627             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <span class="stringliteral">&quot;Level init &quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; - sizes:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lSizex&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lSizey&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lSizez&lt;&lt;<span class="stringliteral">&quot; offs:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lOffsx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lOffsy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lOffsz 
<a name="l00628"></a>00628                     &lt;&lt;<span class="stringliteral">&quot; omega:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].omega&lt;&lt;<span class="stringliteral">&quot; grav:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].gravity&lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00629"></a>00629                     &lt;&lt;<span class="stringliteral">&quot; cmsagp:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lcsmago&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>
<a name="l00630"></a>00630                     &lt;&lt; <span class="stringliteral">&quot; ss&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].timestep&lt;&lt;<span class="stringliteral">&quot; ns&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].nodeSize&lt;&lt;<span class="stringliteral">&quot; cs&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].simCellSize );
<a name="l00631"></a>00631         } <span class="keywordflow">else</span> {
<a name="l00632"></a>00632             <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#a0cb712be00a6c0fe651a2798abe4ab88">mInitDone</a>) {
<a name="l00633"></a>00633                 <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Level init &quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; - sizes:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lSizex&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lSizey&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].lSizez&lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00634"></a>00634                         &lt;&lt;<span class="stringliteral">&quot;omega:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].omega&lt;&lt;<span class="stringliteral">&quot; grav:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].gravity , 5);
<a name="l00635"></a>00635             }
<a name="l00636"></a>00636         }
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>&gt;0) {
<a name="l00639"></a>00639         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#afd13b945ab42fedc8082630dcd416014">mDfScaleUp</a>   = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0  ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>)* (1.0/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0  ].omega-1.0)/ (1.0/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>-1.0); <span class="comment">// yu</span>
<a name="l00640"></a>00640         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8906f23f33597c65bdbff4e5d64f901">mDfScaleDown</a> = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0  ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>)* (1.0/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0+1].omega-1.0)/ (1.0/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[0  ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>-1.0); <span class="comment">// yu</span>
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 <span class="comment">/******************************************************************************</span>
<a name="l00646"></a>00646 <span class="comment"> * Init Solver (values should be read from config file)</span>
<a name="l00647"></a>00647 <span class="comment"> *****************************************************************************/</span>
<a name="l00648"></a>00648 
<a name="l00650"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6220c330faaf77cc2ba833bbe2d8695a">00650</a> <span class="keywordtype">bool</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6220c330faaf77cc2ba833bbe2d8695a">LbmFsgrSolver::initializeSolverMemory</a>()
<a name="l00651"></a>00651 {
<a name="l00652"></a>00652   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Init start... &quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a0cb712be00a6c0fe651a2798abe4ab88">mInitDone</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;(<span class="keywordtype">void</span>*)<span class="keyword">this</span>,1);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="comment">// init cppf stage</span>
<a name="l00655"></a>00655     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>&gt;0) {
<a name="l00656"></a>00656         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a> *= <a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>;
<a name="l00657"></a>00657         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a> *= <a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>;
<a name="l00658"></a>00658         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a> *= <a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>;
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>==-1) {
<a name="l00661"></a>00661         <span class="comment">// all on</span>
<a name="l00662"></a>00662         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a> = 
<a name="l00663"></a>00663              <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba9ed95628d0cfb7cf24ef7f9bc980257e">fssgNormal</a>   | <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba861eeffb2b9ce624d831c5adb2566777">fssgNoNorth</a>  | <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba8239b482337fac4674d376c88f4820a3">fssgNoSouth</a>  | <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba5f86194cbe464dbed226f3fbac8dd344">fssgNoEast</a>   |
<a name="l00664"></a>00664              <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba5906559576900d234453a66c09dfc5de">fssgNoWest</a>   | <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba50171f62e677541cf66a9923f866aaf5">fssgNoTop</a>    | <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba21e04f8485678932af8da21b7deaff73">fssgNoBottom</a> | <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba9e79a075c2509a4f6f29ca96e80036c7">fssgNoObs</a>   ;
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <span class="comment">// size inits to force cubic cells and mult4 level dimensions</span>
<a name="l00668"></a>00668     <span class="comment">// and make sure we dont allocate too much...</span>
<a name="l00669"></a>00669     <span class="keywordtype">bool</span> memOk = <span class="keyword">false</span>;
<a name="l00670"></a>00670     <span class="keywordtype">int</span> orgSx = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>;
<a name="l00671"></a>00671     <span class="keywordtype">int</span> orgSy = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>;
<a name="l00672"></a>00672     <span class="keywordtype">int</span> orgSz = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>;
<a name="l00673"></a>00673     <span class="keywordtype">double</span> sizeReduction = 1.0;
<a name="l00674"></a>00674     <span class="keywordtype">double</span> memEstFromFunc = -1.0;
<a name="l00675"></a>00675     <span class="keywordtype">double</span> memEstFine = -1.0;
<a name="l00676"></a>00676     <span class="keywordtype">string</span> memreqStr(<span class="stringliteral">&quot;&quot;</span>);   
<a name="l00677"></a>00677     <span class="keywordtype">bool</span> firstMInit = <span class="keyword">true</span>;
<a name="l00678"></a>00678     <span class="keywordtype">int</span> minitTries=0;
<a name="l00679"></a>00679     <span class="keywordflow">while</span>(!memOk) {
<a name="l00680"></a>00680         minitTries++;
<a name="l00681"></a>00681         <a class="code" href="../../da/d9f/solver__interface_8cpp.html#aa17e883ed67ec4750a1ca90c1965dbb9">initGridSizes</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>,
<a name="l00682"></a>00682                 <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../d1/d24/solver__class_8h.html#adb2d9505bae635c86de4a47561d7d930">PARALLEL</a>);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684         <span class="comment">// MPT</span>
<a name="l00685"></a>00685 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00686"></a>00686 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(firstMInit) {
<a name="l00687"></a>00687             mrSetup();
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00690"></a>00690 <span class="preprocessor"></span>        firstMInit=<span class="keyword">false</span>;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692         <a class="code" href="../../da/d9f/solver__interface_8cpp.html#ad67209a8aa8d1d51b8b086cee02bd873">calculateMemreqEstimate</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>, 
<a name="l00693"></a>00693                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a10f9f663715f1587859a0106518a355c">mFarFieldSize</a>, &amp;memEstFromFunc, &amp;memEstFine, &amp;memreqStr );
<a name="l00694"></a>00694         
<a name="l00695"></a>00695         <span class="keywordtype">double</span> memLimit;
<a name="l00696"></a>00696         <span class="keywordtype">string</span> memLimStr(<span class="stringliteral">&quot;-&quot;</span>);
<a name="l00697"></a>00697         <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)==4) {
<a name="l00698"></a>00698             <span class="comment">// 32bit system, limit to 2GB</span>
<a name="l00699"></a>00699             memLimit = 2.0* 1024.0*1024.0*1024.0;
<a name="l00700"></a>00700             memLimStr = string(<span class="stringliteral">&quot;2GB&quot;</span>);
<a name="l00701"></a>00701         } <span class="keywordflow">else</span> {
<a name="l00702"></a>00702             <span class="comment">// 64bit, just take 16GB as limit for now...</span>
<a name="l00703"></a>00703             memLimit = 16.0* 1024.0*1024.0*1024.0;
<a name="l00704"></a>00704             memLimStr = string(<span class="stringliteral">&quot;16GB&quot;</span>);
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <span class="comment">// restrict max. chunk of 1 mem block to 1GB for windos</span>
<a name="l00708"></a>00708         <span class="keywordtype">bool</span> memBlockAllocProblem = <span class="keyword">false</span>;
<a name="l00709"></a>00709         <span class="keywordtype">double</span> maxDefaultMemChunk = 2.*1024.*1024.*1024.;
<a name="l00710"></a>00710         <span class="comment">//std::cerr&lt;&lt;&quot; memEstFine &quot;&lt;&lt; memEstFine &lt;&lt;&quot; maxWin:&quot; &lt;&lt;maxWinMemChunk &lt;&lt;&quot; maxMac:&quot; &lt;&lt;maxMacMemChunk ; // DEBUG</span>
<a name="l00711"></a>00711 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span>        <span class="keywordtype">double</span> maxWinMemChunk = 1100.*1024.*1024.;
<a name="l00713"></a>00713         <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)==4 &amp;&amp; memEstFine&gt;maxWinMemChunk) {
<a name="l00714"></a>00714             memBlockAllocProblem = <span class="keyword">true</span>;
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716 <span class="preprocessor">#endif // WIN32</span>
<a name="l00717"></a>00717 <span class="preprocessor"></span><span class="preprocessor">#ifdef __APPLE__</span>
<a name="l00718"></a>00718 <span class="preprocessor"></span>        <span class="keywordtype">double</span> maxMacMemChunk = 1200.*1024.*1024.;
<a name="l00719"></a>00719         <span class="keywordflow">if</span>(memEstFine&gt; maxMacMemChunk) {
<a name="l00720"></a>00720             memBlockAllocProblem = <span class="keyword">true</span>;
<a name="l00721"></a>00721         }
<a name="l00722"></a>00722 <span class="preprocessor">#endif // Mac</span>
<a name="l00723"></a>00723 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)==4 &amp;&amp; memEstFine&gt;maxDefaultMemChunk) {
<a name="l00724"></a>00724             <span class="comment">// max memory chunk for 32bit systems 2gig</span>
<a name="l00725"></a>00725             memBlockAllocProblem = <span class="keyword">true</span>;
<a name="l00726"></a>00726         }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728         <span class="keywordflow">if</span>(memEstFromFunc&gt;memLimit || memBlockAllocProblem) {
<a name="l00729"></a>00729             sizeReduction *= 0.9;
<a name="l00730"></a>00730             <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a> = (int)(orgSx * sizeReduction);
<a name="l00731"></a>00731             <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a> = (int)(orgSy * sizeReduction);
<a name="l00732"></a>00732             <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a> = (int)(orgSz * sizeReduction);
<a name="l00733"></a>00733             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#aac9413fb9eeba06e80c56258d95b15d6">DM_WARNING</a>,<span class="stringliteral">&quot;initGridSizes: memory limit exceeded &quot;</span>&lt;&lt;
<a name="l00734"></a>00734                     <span class="comment">//memEstFromFunc&lt;&lt;&quot;/&quot;&lt;&lt;memLimit&lt;&lt;&quot;, &quot;&lt;&lt;</span>
<a name="l00735"></a>00735                     <span class="comment">//memEstFine&lt;&lt;&quot;/&quot;&lt;&lt;maxWinMemChunk&lt;&lt;&quot;, &quot;&lt;&lt;</span>
<a name="l00736"></a>00736                     memreqStr&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;memLimStr&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;
<a name="l00737"></a>00737                     <span class="stringliteral">&quot;retrying: &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>,<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>,<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>)&lt;&lt;<span class="stringliteral">&quot; org:&quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(orgSx,orgSy,orgSz)
<a name="l00738"></a>00738                     , 3 );
<a name="l00739"></a>00739         } <span class="keywordflow">else</span> {
<a name="l00740"></a>00740             memOk = <span class="keyword">true</span>;
<a name="l00741"></a>00741         } 
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     
<a name="l00744"></a>00744     <a class="code" href="../../db/dff/classLbmSolverInterface.html#afb3d0e159ab86d50d2ac3850396618d9">mPreviewFactor</a> = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a> / (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>;
<a name="l00745"></a>00745   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;initGridSizes: Final domain size X:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>&lt;&lt;<span class="stringliteral">&quot; Y:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>&lt;&lt;<span class="stringliteral">&quot; Z:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>&lt;&lt;
<a name="l00746"></a>00746       <span class="stringliteral">&quot;, Domain: &quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>)&lt;&lt;
<a name="l00747"></a>00747       <span class="stringliteral">&quot;, PointerSize: &quot;</span>&lt;&lt; <span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) &lt;&lt; <span class="stringliteral">&quot;, IntSize: &quot;</span>&lt;&lt; <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) &lt;&lt;
<a name="l00748"></a>00748       <span class="stringliteral">&quot;, est. Mem.Req.: &quot;</span>&lt;&lt;memreqStr    ,2);
<a name="l00749"></a>00749     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a2f19b037c5136360f7e2de473a42489f">setSize</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>);
<a name="l00750"></a>00750     <span class="keywordflow">if</span>((minitTries&gt;1)&amp;&amp;(<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a>)) { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Warning!!!!!!!!!!!!!!! Original gridsize changed.........&quot;</span>); }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Definitions: &quot;</span>
<a name="l00753"></a>00753         &lt;&lt;<span class="stringliteral">&quot;LBM_EPSILON=&quot;</span>&lt;&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a0a6ff24e88963689483e35acbb53ca28">LBM_EPSILON</a>  &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00754"></a>00754         &lt;&lt;<span class="stringliteral">&quot;FSGR_STRICT_DEBUG=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a96bae72446ecaf0a3c3b9c81f2e4e966" title="debug coordinate accesses and the like? (much slower)">FSGR_STRICT_DEBUG</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00755"></a>00755         &lt;&lt;<span class="stringliteral">&quot;OPT3D=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a315bc020e2cf25a9079f63de8f626eaf" title="order of interpolation (0=always current/1=interpolate/2=always other)">OPT3D</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00756"></a>00756         &lt;&lt;<span class="stringliteral">&quot;COMPRESSGRIDS=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a3dd98af9430664de1c225dfe76153f29">COMPRESSGRIDS</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00757"></a>00757         &lt;&lt;<span class="stringliteral">&quot;MASS_INVALID=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#aef9a83cf18b423b2a5c9b9c792fd0b74" title="invalid mass value for unused mass data">MASS_INVALID</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00758"></a>00758         &lt;&lt;<span class="stringliteral">&quot;FSGR_LISTTRICK=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#abd80a1e015f762e24fcbcf92f54b9f65">FSGR_LISTTRICK</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00759"></a>00759         &lt;&lt;<span class="stringliteral">&quot;FSGR_LISTTTHRESHEMPTY=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a2c4cba3ed30749d7c5d13e205b7f2f42">FSGR_LISTTTHRESHEMPTY</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00760"></a>00760         &lt;&lt;<span class="stringliteral">&quot;FSGR_LISTTTHRESHFULL=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#aeffae4c0d0b0c858bfc55d1ec29cd2d0">FSGR_LISTTTHRESHFULL</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span>
<a name="l00761"></a>00761         &lt;&lt;<span class="stringliteral">&quot;FSGR_MAGICNR=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#aa35b84a0354fbc5fbb9cb6e8d1ddecdb">FSGR_MAGICNR</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span> 
<a name="l00762"></a>00762         &lt;&lt;<span class="stringliteral">&quot;USE_LES=&quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#aef26077d592460663103f3e5bf39d6b4" title="OPT3D quick LES on/off, only debug/benchmarking.">USE_LES</a> &lt;&lt;<span class="stringliteral">&quot; &quot;</span> 
<a name="l00763"></a>00763         ,10);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="comment">// perform 2D corrections...</span>
<a name="l00766"></a>00766     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a> == 2) <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a> = 1;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#aa8f0eaa100c08ad87f62d869477a7d26">setSimulationMaxSpeed</a>(0.0);
<a name="l00769"></a>00769     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abb0f406ebbf469e1153877413af0d573" title="fluid vol height">mFVHeight</a>&gt;0.0) <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a2954c3acbfcda93534cb17e0eb03a876">setFluidVolumeHeight</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abb0f406ebbf469e1153877413af0d573" title="fluid vol height">mFVHeight</a>);
<a name="l00770"></a>00770     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#acad1887c9d4a29052a86e1fd6631607f">setTadapLevels</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>+1 );
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af37e074ce172193f02148c166518e220" title="debug function to force tadap syncing">mForceTadapRefine</a>&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) {
<a name="l00773"></a>00773         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#acad1887c9d4a29052a86e1fd6631607f">setTadapLevels</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af37e074ce172193f02148c166518e220" title="debug function to force tadap syncing">mForceTadapRefine</a>+1 );
<a name="l00774"></a>00774         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Forcing a t-adap refine level of &quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af37e074ce172193f02148c166518e220" title="debug function to force tadap syncing">mForceTadapRefine</a>, 6);
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ae56423aa4fc6327fdbbc79f1b0ea959f">calculateAllMissingValues</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>, <span class="keyword">false</span>)) {
<a name="l00778"></a>00778         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Fatal: failed to init parameters! Aborting...&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00779"></a>00779         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="comment">// init vectors</span>
<a name="l00784"></a>00784     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00785"></a>00785         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ace67495a05cba245c2410347fe6d2b73">id</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00786"></a>00786         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a> = 0.0; 
<a name="l00787"></a>00787         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a64d427112a6782a30a22116f381265ae" title="node size on this level in simulation units">simCellSize</a> = 0.0; 
<a name="l00788"></a>00788         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a> = 0.0; 
<a name="l00789"></a>00789         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad0536908bc8373376933ec462b15c487" title="size this level was advanced to">time</a> = 0.0; 
<a name="l00790"></a>00790         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a> = 1.0;
<a name="l00791"></a>00791         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a> = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(0.0); 
<a name="l00792"></a>00792         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[0] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00793"></a>00793         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00794"></a>00794         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[0] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00795"></a>00795         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[1] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aed69d3b1808d245fd47e5a4a46e703fc">avgOmega</a> = 0.0; 
<a name="l00798"></a>00798         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a8eabc7924711e070189f16b21c1c3f94">avgOmegaCnt</a> = 0.0;
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     <span class="comment">// init sizes</span>
<a name="l00802"></a>00802     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>;
<a name="l00803"></a>00803     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>;
<a name="l00804"></a>00804     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>;
<a name="l00805"></a>00805     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00806"></a>00806         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>/2;
<a name="l00807"></a>00807         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>/2;
<a name="l00808"></a>00808         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>/2;
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811     <span class="comment">// safety check</span>
<a name="l00812"></a>00812     <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>) != <a class="code" href="../../d2/d3c/solver__interface_8h.html#ac7f4b773ee0bc8dc6be46514370d28a3">CellFlagTypeSize</a>) {
<a name="l00813"></a>00813         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Fatal Error: CellFlagType has wrong size! Is:&quot;</span>&lt;&lt;<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>)&lt;&lt;<span class="stringliteral">&quot;, should be:&quot;</span>&lt;&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#ac7f4b773ee0bc8dc6be46514370d28a3">CellFlagTypeSize</a>, <a class="code" href="../../de/df0/utilities_8h.html#af2f6eab59be57681799dbee88ff4c4a7">SIMWORLD_GENERICERROR</a>);
<a name="l00814"></a>00814         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="keywordtype">double</span> ownMemCheck = 0.0;
<a name="l00818"></a>00818     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a> = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[0]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0]) / (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>));
<a name="l00819"></a>00819     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a64d427112a6782a30a22116f381265ae" title="node size on this level in simulation units">simCellSize</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#aa7e8e09c77dc2d8edc1a19708688318e">getCellSize</a>();
<a name="l00820"></a>00820     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a81435c55b002d65b7e0ca201a1fef155">lcellfactor</a> = 1.0;
<a name="l00821"></a>00821     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a41a6a848ac1750ea79579492320f45b6">LONGINT</a> rcellSize = ((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>) *<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a>);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="preprocessor">#if COMPRESSGRIDS==0</span>
<a name="l00824"></a>00824 <span class="preprocessor"></span>    <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[0] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>[ rcellSize +4 ];
<a name="l00825"></a>00825     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>[ rcellSize +4 ];
<a name="l00826"></a>00826     ownMemCheck += 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>) * (rcellSize+4);
<a name="l00827"></a>00827 <span class="preprocessor">#else // COMPRESSGRIDS==0</span>
<a name="l00828"></a>00828 <span class="preprocessor"></span>    <a class="code" href="../../d2/d3c/solver__interface_8h.html#a41a6a848ac1750ea79579492320f45b6">LONGINT</a> compressOffset = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>*<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a>*2);
<a name="l00829"></a>00829     <span class="comment">// D int tmp = ( (rcellSize +compressOffset +4)/(1024*1024) )*4;</span>
<a name="l00830"></a>00830     <span class="comment">// D printf(&quot;Debug MEMMMM excee: %d\n&quot;, tmp);</span>
<a name="l00831"></a>00831     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>[ rcellSize +compressOffset +4 ];
<a name="l00832"></a>00832     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[0] = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1]+compressOffset;
<a name="l00833"></a>00833     ownMemCheck += <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>) * (rcellSize +compressOffset +4);
<a name="l00834"></a>00834 <span class="preprocessor">#endif // COMPRESSGRIDS==0</span>
<a name="l00835"></a>00835 <span class="preprocessor"></span>
<a name="l00836"></a>00836     <span class="keywordflow">if</span>(!<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].mprsCells[1] || !<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].mprsCells[0]) {
<a name="l00837"></a>00837         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Fatal: Couldnt allocate memory (1)! Aborting...&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00838"></a>00838         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841     <span class="comment">// +4 for safety ?</span>
<a name="l00842"></a>00842     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[0] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>[ rcellSize/<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> +4 ];
<a name="l00843"></a>00843     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[1] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>[ rcellSize/<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> +4 ];
<a name="l00844"></a>00844     ownMemCheck += 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>) * (rcellSize/<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> +4);
<a name="l00845"></a>00845     <span class="keywordflow">if</span>(!<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].mprsFlags[1] || !<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].mprsFlags[0]) {
<a name="l00846"></a>00846         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Fatal: Couldnt allocate memory (2)! Aborting...&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848 <span class="preprocessor">#if COMPRESSGRIDS==0</span>
<a name="l00849"></a>00849 <span class="preprocessor"></span>        <span class="keyword">delete</span>[] <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[0];
<a name="l00850"></a>00850         <span class="keyword">delete</span>[] <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1];
<a name="l00851"></a>00851 <span class="preprocessor">#else // COMPRESSGRIDS==0</span>
<a name="l00852"></a>00852 <span class="preprocessor"></span>        <span class="keyword">delete</span>[] <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1];
<a name="l00853"></a>00853 <span class="preprocessor">#endif // COMPRESSGRIDS==0</span>
<a name="l00854"></a>00854 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> lcfdimFac = 8.0;
<a name="l00858"></a>00858     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) lcfdimFac = 4.0;
<a name="l00859"></a>00859     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00860"></a>00860         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a> = 2.0 * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>;
<a name="l00861"></a>00861         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a64d427112a6782a30a22116f381265ae" title="node size on this level in simulation units">simCellSize</a> = 2.0 * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a64d427112a6782a30a22116f381265ae" title="node size on this level in simulation units">simCellSize</a>;
<a name="l00862"></a>00862         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a81435c55b002d65b7e0ca201a1fef155">lcellfactor</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a81435c55b002d65b7e0ca201a1fef155">lcellfactor</a> * lcfdimFac;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2){ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a> = 1; } <span class="comment">// 2D</span>
<a name="l00865"></a>00865         rcellSize = ((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>) *<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a>);
<a name="l00866"></a>00866         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[0] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>[ rcellSize/<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> +4 ];
<a name="l00867"></a>00867         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a9659e8412015f534c36d6ac3518879b0">mprsFlags</a>[1] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>[ rcellSize/<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> +4 ];
<a name="l00868"></a>00868         ownMemCheck += 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>) * (rcellSize/<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a> +4);
<a name="l00869"></a>00869         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[0] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>[ rcellSize +4 ];
<a name="l00870"></a>00870         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad76c25fba0b02f4a5c3d71976d10e8e8" title="level array">mprsCells</a>[1] = <span class="keyword">new</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>[ rcellSize +4 ];
<a name="l00871"></a>00871         ownMemCheck += 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>) * (rcellSize+4);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <span class="comment">// isosurface memory, use orig res values</span>
<a name="l00875"></a>00875     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a10f9f663715f1587859a0106518a355c">mFarFieldSize</a>&gt;0.) {
<a name="l00876"></a>00876         ownMemCheck += (double)( (3*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)+<span class="keyword">sizeof</span>(float)) * ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+2)*(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>+2)*(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>+2)) );
<a name="l00877"></a>00877     } <span class="keywordflow">else</span> {
<a name="l00878"></a>00878         <span class="comment">// ignore 3 int slices...</span>
<a name="l00879"></a>00879         ownMemCheck += (double)( (              <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)) * ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+2)*(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>+2)*(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>+2)) );
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="comment">// sanity check</span>
<a name="l00883"></a>00883 <span class="preprocessor">#if ELBEEM_PLUGIN!=1</span>
<a name="l00884"></a>00884 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(1.0-ownMemCheck/memEstFromFunc)&gt;0.01) {
<a name="l00885"></a>00885         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Sanity Error - memory estimate is off! real:&quot;</span>&lt;&lt;ownMemCheck&lt;&lt;<span class="stringliteral">&quot; vs. estimate:&quot;</span>&lt;&lt;memEstFromFunc );
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887 <span class="preprocessor">#endif // ELBEEM_PLUGIN!=1</span>
<a name="l00888"></a>00888 <span class="preprocessor"></span>    
<a name="l00889"></a>00889     <span class="comment">// init sizes for _all_ levels</span>
<a name="l00890"></a>00890     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00891"></a>00891         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a0c1985355b137e52a8a5d4190a0f4c93">lOffsx</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>;
<a name="l00892"></a>00892         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a1aa1abfdb211d7fca4ebc0623b2600b5">lOffsy</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a0c1985355b137e52a8a5d4190a0f4c93">lOffsx</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>;
<a name="l00893"></a>00893         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a68ee47767f9fecbc82ed59c36c5f2bfe">lOffsz</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a1aa1abfdb211d7fca4ebc0623b2600b5">lOffsy</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>;
<a name="l00894"></a>00894     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>  = 0;
<a name="l00895"></a>00895     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a969dc4eebe3ff743980e099cad72240a" title="target/other set of dist funcs">setOther</a> = 1;
<a name="l00896"></a>00896     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a71ed2e9133bd4102bf1d3be8e29b97a0" title="step count">lsteps</a> = 0;
<a name="l00897"></a>00897     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2fd0a63e02aeb6ca2b93e19040fbd07f" title="mass&amp;volume for this level">lmass</a> = 0.0;
<a name="l00898"></a>00898     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ad24148aecd9abb90cd0100eabb440703">lvolume</a> = 0.0;
<a name="l00899"></a>00899     }
<a name="l00900"></a>00900 
<a name="l00901"></a>00901     <span class="comment">// calc omega, force for all levels</span>
<a name="l00902"></a>00902     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1eedd6b2c8bd318a4cdd4e868d41c1eb" title="Initialize omegas and forces on all levels (for init/timestep change)">initLevelOmegas</a>();
<a name="l00903"></a>00903     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af54e1db87b22ae425684466e014f16f6" title="smallest and largest step size so far">mMinTimestep</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>();
<a name="l00904"></a>00904     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa8adf8187f0332ae52746f563d6c792f">mMaxTimestep</a> = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>();
<a name="l00905"></a>00905 
<a name="l00906"></a>00906     <span class="comment">// init isosurf</span>
<a name="l00907"></a>00907     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ae609708b28ce808a819a4a867b359b40" title="set iso level value for surface reconstruction">setIsolevel</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a> );
<a name="l00908"></a>00908 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00909"></a>00909 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>) {
<a name="l00910"></a>00910         mpTest-&gt;setMaterialName( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a0bc9084c32b8662e4a2b58e0e2358688">getMaterialName</a>() );
<a name="l00911"></a>00911         <span class="keyword">delete</span> <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>;
<a name="l00912"></a>00912         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a> = mpTest;
<a name="l00913"></a>00913         <span class="keywordflow">if</span>(mpTest-&gt;mFarfMode&gt;0) { <span class="comment">// 3d off</span>
<a name="l00914"></a>00914             mpTest-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ae609708b28ce808a819a4a867b359b40" title="set iso level value for surface reconstruction">setIsolevel</a>(-100.0);
<a name="l00915"></a>00915         } <span class="keywordflow">else</span> {
<a name="l00916"></a>00916             mpTest-&gt;setIsolevel( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a> );
<a name="l00917"></a>00917         }
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS!=1</span>
<a name="l00920"></a>00920 <span class="preprocessor"></span>    <span class="comment">// approximate feature size with mesh resolution</span>
<a name="l00921"></a>00921     <span class="keywordtype">float</span> featureSize = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[ <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a> ].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>*0.5;
<a name="l00922"></a>00922     <span class="comment">// smooth vars defined in solver_interface, set by simulation object</span>
<a name="l00923"></a>00923     <span class="comment">// reset for invalid values...</span>
<a name="l00924"></a>00924     <span class="keywordflow">if</span>((<a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a>&lt;0.)||(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a>&gt;50.)) <a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a> = 1.;
<a name="l00925"></a>00925     <span class="keywordflow">if</span>((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a>&lt;0.)||(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a>&gt;50.)) <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a> = 1.;
<a name="l00926"></a>00926     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ae3e8f06d51e5164798683e964ebe6626" title="set loop subdiv num">setSmoothSurface</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a> * featureSize );
<a name="l00927"></a>00927     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#af7ea603143e2c46b6e55d9ba6e954581">setSmoothNormals</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a> * featureSize );
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <span class="comment">// init iso weight values mIsoWeightMethod</span>
<a name="l00930"></a>00930     <span class="keywordtype">int</span> wcnt = 0;
<a name="l00931"></a>00931     <span class="keywordtype">float</span> totw = 0.0;
<a name="l00932"></a>00932     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ak=-1;ak&lt;=1;ak++) 
<a name="l00933"></a>00933         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> aj=-1;aj&lt;=1;aj++) 
<a name="l00934"></a>00934             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ai=-1;ai&lt;=1;ai++)  {
<a name="l00935"></a>00935                 <span class="keywordflow">switch</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aae6073b616274130e4ac707904d8b922" title="get isofield weights">mIsoWeightMethod</a>) {
<a name="l00936"></a>00936                 <span class="keywordflow">case</span> 1: <span class="comment">// light smoothing</span>
<a name="l00937"></a>00937                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt] = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(3.0) - <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>( (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(ak*ak + aj*aj + ai*ai) );
<a name="l00938"></a>00938                     <span class="keywordflow">break</span>;
<a name="l00939"></a>00939                 <span class="keywordflow">case</span> 2: <span class="comment">// very light smoothing</span>
<a name="l00940"></a>00940                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt] = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(3.0) - <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>( (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(ak*ak + aj*aj + ai*ai) );
<a name="l00941"></a>00941                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt] *= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt];
<a name="l00942"></a>00942                     <span class="keywordflow">break</span>;
<a name="l00943"></a>00943                 <span class="keywordflow">case</span> 3: <span class="comment">// no smoothing</span>
<a name="l00944"></a>00944                     <span class="keywordflow">if</span>(ai==0 &amp;&amp; aj==0 &amp;&amp; ak==0) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt] = 1.0;
<a name="l00945"></a>00945                     <span class="keywordflow">else</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt] = 0.0;
<a name="l00946"></a>00946                     <span class="keywordflow">break</span>;
<a name="l00947"></a>00947                 <span class="keywordflow">default</span>: <span class="comment">// strong smoothing (=0)</span>
<a name="l00948"></a>00948                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt] = 1.0;
<a name="l00949"></a>00949                     <span class="keywordflow">break</span>;
<a name="l00950"></a>00950                 }
<a name="l00951"></a>00951                 totw += <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[wcnt];
<a name="l00952"></a>00952                 wcnt++;
<a name="l00953"></a>00953             }
<a name="l00954"></a>00954     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;27; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] /= totw;
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> isostart = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>);
<a name="l00957"></a>00957     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> isoend   = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>);
<a name="l00958"></a>00958     <span class="keywordtype">int</span> twodOff = 0; <span class="comment">// 2d slices</span>
<a name="l00959"></a>00959     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l00960"></a>00960         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> sn,se;
<a name="l00961"></a>00961         sn = isostart[2]+(isoend[2]-isostart[2])*0.5 - ((isoend[0]-isostart[0]) / (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+1.0))*0.5;
<a name="l00962"></a>00962         se = isostart[2]+(isoend[2]-isostart[2])*0.5 + ((isoend[0]-isostart[0]) / (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+1.0))*0.5;
<a name="l00963"></a>00963         isostart[2] = sn;
<a name="l00964"></a>00964         isoend[2] = se;
<a name="l00965"></a>00965         twodOff = 2;
<a name="l00966"></a>00966     }
<a name="l00967"></a>00967     <span class="keywordtype">int</span> isosx = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+2;
<a name="l00968"></a>00968     <span class="keywordtype">int</span> isosy = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>+2;
<a name="l00969"></a>00969     <span class="keywordtype">int</span> isosz = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>+2+twodOff;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">// MPT</span>
<a name="l00972"></a>00972 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00973"></a>00973 <span class="preprocessor"></span>    <span class="comment">//if( strstr( this-&gt;getName().c_str(), &quot;mpfluid1&quot; ) != NULL) {</span>
<a name="l00974"></a>00974     <span class="keywordflow">if</span>( (mMpNum&gt;0) &amp;&amp; (mMpIndex==0) ) {
<a name="l00975"></a>00975         <span class="comment">//? mpindex==0</span>
<a name="l00976"></a>00976         <span class="comment">// restore original value for node0</span>
<a name="l00977"></a>00977         isosx       = mOrgSizeX + 2;
<a name="l00978"></a>00978         isostart[0] = mOrgStartX;
<a name="l00979"></a>00979         isoend[0]   = mOrgEndX;
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>, <span class="stringliteral">&quot;MPT: gcon &quot;</span>&lt;&lt;mMpNum&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;mMpIndex&lt;&lt;<span class="stringliteral">&quot; src&quot;</span>&lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(mpTest-&gt;mGCMin.mSrcx,mpTest-&gt;mGCMin.mSrcy,mpTest-&gt;mGCMin.mSrcz)&lt;&lt;<span class="stringliteral">&quot; dst&quot;</span>
<a name="l00982"></a>00982             &lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(mpTest-&gt;mGCMin.mDstx,mpTest-&gt;mGCMin.mDsty,mpTest-&gt;mGCMin.mDstz)&lt;&lt;<span class="stringliteral">&quot; consize&quot;</span>
<a name="l00983"></a>00983             &lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(mpTest-&gt;mGCMin.mConSizex,mpTest-&gt;mGCMin.mConSizey,mpTest-&gt;mGCMin.mConSizez)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>);
<a name="l00984"></a>00984     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>, <span class="stringliteral">&quot;MPT: gcon &quot;</span>&lt;&lt;mMpNum&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;mMpIndex&lt;&lt;<span class="stringliteral">&quot; src&quot;</span>&lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(mpTest-&gt;mGCMax.mSrcx,mpTest-&gt;mGCMax.mSrcy,mpTest-&gt;mGCMax.mSrcz)&lt;&lt;<span class="stringliteral">&quot; dst&quot;</span>
<a name="l00985"></a>00985             &lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(mpTest-&gt;mGCMax.mDstx,mpTest-&gt;mGCMax.mDsty,mpTest-&gt;mGCMax.mDstz)&lt;&lt;<span class="stringliteral">&quot; consize&quot;</span>
<a name="l00986"></a>00986             &lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(mpTest-&gt;mGCMax.mConSizex,mpTest-&gt;mGCMax.mConSizey,mpTest-&gt;mGCMax.mConSizez)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>);
<a name="l00987"></a>00987 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00988"></a>00988 <span class="preprocessor"></span>
<a name="l00989"></a>00989     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot; SETISO &quot;</span>, <span class="stringliteral">&quot;iso &quot;</span>&lt;&lt;isostart&lt;&lt;<span class="stringliteral">&quot; - &quot;</span>&lt;&lt;isoend&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;(((isoend[0]-isostart[0]) / (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+1.0))*0.5)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>+1.0) );
<a name="l00990"></a>00990     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>, <span class="stringliteral">&quot;MPT: geo &quot;</span>&lt;&lt; <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>&lt;&lt;
<a name="l00991"></a>00991             <span class="stringliteral">&quot; grid:&quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>,<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>,<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>)&lt;&lt;<span class="stringliteral">&quot;,iso:&quot;</span>&lt;&lt; <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(isosx,isosy,isosz) );
<a name="l00992"></a>00992     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#acfad034e7a65ad02dcf333bbf40c2c9f" title="set geometry start (for renderer)">setStart</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(isostart) );
<a name="l00993"></a>00993     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#af58bcb992a468b8d9eb094e507f2402b" title="set geometry end (for renderer)">setEnd</a>(   <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(isoend) );
<a name="l00994"></a>00994     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> isodist = isoend-isostart;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     <span class="keywordtype">int</span> isosubs = <a class="code" href="../../db/dff/classLbmSolverInterface.html#aa2460ac421156a8870e24c4bc2f7f6be">mIsoSubdivs</a>;
<a name="l00997"></a>00997     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a10f9f663715f1587859a0106518a355c">mFarFieldSize</a>&gt;1.) {
<a name="l00998"></a>00998         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Warning - resetting isosubdivs, using fulledge!&quot;</span>);
<a name="l00999"></a>00999         isosubs = 1;
<a name="l01000"></a>01000         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ad7542a92593268db57eff73ac35066d5">setUseFulledgeArrays</a>(<span class="keyword">true</span>);
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a3821356da5a50b4d4ef2970d4bd98b04">setSubdivs</a>(isosubs);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a2a3235e3242374847b06c1e929732926">initializeIsosurface</a>( isosx,isosy,isosz, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(isodist) );
<a name="l01005"></a>01005 
<a name="l01006"></a>01006     <span class="comment">// reset iso field</span>
<a name="l01007"></a>01007     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ak=0;ak&lt;isosz;ak++) 
<a name="l01008"></a>01008         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> aj=0;aj&lt;isosy;aj++) 
<a name="l01009"></a>01009             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ai=0;ai&lt;isosx;ai++) { *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(ai,aj,ak) = 0.0; }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 
<a name="l01012"></a>01012   <span class="comment">/* init array (set all invalid first) */</span>
<a name="l01013"></a>01013     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a36a3f631fced45a55f755188c312cdd5">preinitGrids</a>();
<a name="l01014"></a>01014     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l01015"></a>01015         <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) {
<a name="l01016"></a>01016             <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,0) = 0, <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,0) = 0; <span class="comment">// reset for changeFlag usage</span>
<a name="l01017"></a>01017             <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#a2cc6fbed55bf09db6db2d9489f55ccaa">mAllfluid</a>) {
<a name="l01018"></a>01018                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>, -1.0, -1.0); 
<a name="l01019"></a>01019             } <span class="keywordflow">else</span> {
<a name="l01020"></a>01020                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>, 1.0, 1.0); 
<a name="l01021"></a>01021             }
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 
<a name="l01026"></a>01026     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l01027"></a>01027         <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a>) {
<a name="l01028"></a>01028             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::init&quot;</span>,<span class="stringliteral">&quot;No preview in 2D allowed!&quot;</span>);
<a name="l01029"></a>01029             <a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a> = 0; }
<a name="l01030"></a>01030     }
<a name="l01031"></a>01031     <span class="keywordflow">if</span>((<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a8557d7859f8e6298ad044884ae8212f1">glob_mpactive</a>) &amp;&amp; (<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a>&gt;0)) {
<a name="l01032"></a>01032         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a> = 0;
<a name="l01033"></a>01033     }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 <span class="preprocessor">#if LBM_USE_GUI==1</span>
<a name="l01036"></a>01036 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a>) {
<a name="l01037"></a>01037         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::init&quot;</span>,<span class="stringliteral">&quot;No preview in GUI mode... mOutputSurfacePreview=0&quot;</span>);
<a name="l01038"></a>01038         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a> = 0; }
<a name="l01039"></a>01039 <span class="preprocessor">#endif // LBM_USE_GUI==1</span>
<a name="l01040"></a>01040 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a>) {
<a name="l01041"></a>01041         <span class="comment">// same as normal one, but use reduced size</span>
<a name="l01042"></a>01042         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a> = <span class="keyword">new</span> <a class="code" href="../../db/db9/classIsoSurface.html" title="class to triangulate a scalar field, e.g. for">IsoSurface</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a> );
<a name="l01043"></a>01043         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a41270c547b85924e5812f6066f646c92">setMaterialName</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a0bc9084c32b8662e4a2b58e0e2358688">getMaterialName</a>() );
<a name="l01044"></a>01044         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ae609708b28ce808a819a4a867b359b40" title="set iso level value for surface reconstruction">setIsolevel</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a> );
<a name="l01045"></a>01045         <span class="comment">// usually dont display for rendering</span>
<a name="l01046"></a>01046         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a7c45fba265bf40ea261af78814f87e09">setVisible</a>( <span class="keyword">false</span> );
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#acfad034e7a65ad02dcf333bbf40c2c9f" title="set geometry start (for renderer)">setStart</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(isostart) );
<a name="l01049"></a>01049         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#af58bcb992a468b8d9eb094e507f2402b" title="set geometry end (for renderer)">setEnd</a>(   <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(isoend) );
<a name="l01050"></a>01050         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> pisodist = isoend-isostart;
<a name="l01051"></a>01051         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> pfac = <a class="code" href="../../db/dff/classLbmSolverInterface.html#afb3d0e159ab86d50d2ac3850396618d9">mPreviewFactor</a>;
<a name="l01052"></a>01052         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a2a3235e3242374847b06c1e929732926">initializeIsosurface</a>( (<span class="keywordtype">int</span>)(pfac*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>)+2, (<span class="keywordtype">int</span>)(pfac*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>)+2, (<span class="keywordtype">int</span>)(pfac*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>)+2, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(pisodist) );
<a name="l01053"></a>01053         <span class="comment">//mpPreviewSurface-&gt;setName( getName() + &quot;preview&quot; );</span>
<a name="l01054"></a>01054         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a444f6bbccaccf40d4ebb882ca9ef5889">setName</a>( <span class="stringliteral">&quot;preview&quot;</span> );
<a name="l01055"></a>01055     
<a name="l01056"></a>01056         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Preview with sizes &quot;</span>&lt;&lt;(pfac*mSizex)&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;(pfac*mSizey)&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;(pfac*mSizez)&lt;&lt;<span class="stringliteral">&quot; enabled&quot;</span>,10);
<a name="l01057"></a>01057     }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059     <span class="comment">// init defaults</span>
<a name="l01060"></a>01060     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#afccc2fe16943150260d515b244ea098f">mAvgNumUsedCells</a> = 0;
<a name="l01061"></a>01061     <a class="code" href="../../db/dff/classLbmSolverInterface.html#afa0c481ee5455284658a997804363f92">mFixMass</a>= 0.0;
<a name="l01062"></a>01062     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01063"></a>01063 }
<a name="l01064"></a>01064 
<a name="l01066"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8b3dffa8c2f63e129d77c1499c264cd5">01066</a> <span class="keywordtype">bool</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8b3dffa8c2f63e129d77c1499c264cd5">LbmFsgrSolver::initializeSolverGrids</a>() {
<a name="l01067"></a>01067   <span class="comment">/* init boundaries */</span>
<a name="l01068"></a>01068   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Boundary init...&quot;</span>,10);
<a name="l01069"></a>01069     <span class="comment">// init obstacles, and reinit time step size </span>
<a name="l01070"></a>01070     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a16faa722e02f903477984bfd3937e215" title="perform geometry init (if switched on)">initGeometryFlags</a>();
<a name="l01071"></a>01071     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa257ddf3865c461af52dcdd20f8ff955">mLastSimTime</a> = -1.0;
<a name="l01072"></a>01072     <span class="comment">// TODO check for invalid cells? nitGenericTestCases();</span>
<a name="l01073"></a>01073     
<a name="l01074"></a>01074     <span class="comment">// new - init noslip 1 everywhere...</span>
<a name="l01075"></a>01075     <span class="comment">// half fill boundary cells?</span>
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> domainBoundType = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01078"></a>01078     <span class="comment">// TODO use normal object types instad...</span>
<a name="l01079"></a>01079     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a>.find(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;free&quot;</span>)) != string::npos) {
<a name="l01080"></a>01080         domainBoundType = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a> | <a class="code" href="../../d2/d3c/solver__interface_8h.html#a84c56ca01be582fbb8ee0b2bef93b162">CFBndFreeslip</a>;
<a name="l01081"></a>01081     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Domain Boundary Type: FreeSlip, value:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a>,10);
<a name="l01082"></a>01082     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a>.find(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;part&quot;</span>)) != string::npos) {
<a name="l01083"></a>01083         domainBoundType = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a> | <a class="code" href="../../d2/d3c/solver__interface_8h.html#a41f6a5ce6d232424fccaea0c8f9b7816">CFBndPartslip</a>; <span class="comment">// part slip type</span>
<a name="l01084"></a>01084     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Domain Boundary Type: PartSlip (&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#af25e799a38280a056e6c671e9b04fb6b" title="part slip value for domain">mDomainPartSlipValue</a>&lt;&lt;<span class="stringliteral">&quot;), value:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a>,10);
<a name="l01085"></a>01085     } <span class="keywordflow">else</span> { 
<a name="l01086"></a>01086         domainBoundType = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a> | <a class="code" href="../../d2/d3c/solver__interface_8h.html#a52169459320fac69e44404feaa0a340e">CFBndNoslip</a>;
<a name="l01087"></a>01087     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Domain Boundary Type: NoSlip, value:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7a8f5e2ec2e3ba173b849781faae9cab" title="domain boundary free/no slip type">mDomainBound</a>,10);
<a name="l01088"></a>01088     }
<a name="l01089"></a>01089 
<a name="l01090"></a>01090     <span class="comment">// use ar[numobjs] as entry for domain (used e.g. for mDomainPartSlipValue in mObjectPartslips)</span>
<a name="l01091"></a>01091     <span class="keywordtype">int</span> domainobj = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>-&gt;size());
<a name="l01092"></a>01092     domainBoundType |= (domainobj&lt;&lt;24);
<a name="l01093"></a>01093     <span class="comment">//for(int i=0; i&lt;(int)(domainobj+0); i++) {</span>
<a name="l01094"></a>01094         <span class="comment">//errMsg(&quot;GEOIN&quot;,&quot;i&quot;&lt;&lt;i&lt;&lt;&quot; &quot;&lt;&lt;(*mpGiObjects)[i]-&gt;getName());</span>
<a name="l01095"></a>01095         <span class="comment">//if((*mpGiObjects)[i] == mpIso) { //check...</span>
<a name="l01096"></a>01096         <span class="comment">//} </span>
<a name="l01097"></a>01097     <span class="comment">//}</span>
<a name="l01098"></a>01098     <span class="comment">//errMsg(&quot;GEOIN&quot;,&quot; dm &quot;&lt;&lt;(domainBoundType&gt;&gt;24));</span>
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>;k++)
<a name="l01101"></a>01101     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {      
<a name="l01102"></a>01102             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,0,k, domainBoundType, 0.0, <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>); 
<a name="l01103"></a>01103             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].lSizey-1,k, domainBoundType, 0.0, <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>); 
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>;k++)
<a name="l01107"></a>01107     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>;j++) {
<a name="l01108"></a>01108             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, 0,j,k, domainBoundType, 0.0, <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>); 
<a name="l01109"></a>01109             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].lSizex-1,j,k, domainBoundType, 0.0, <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>); 
<a name="l01110"></a>01110             <span class="comment">// DEBUG BORDER!</span>
<a name="l01111"></a>01111             <span class="comment">//initEmptyCell(mMaxRefine, mLevel[mMaxRefine].lSizex-2,j,k, domainBoundType, 0.0, BND_FILL); </span>
<a name="l01112"></a>01112     }
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a> == 3) {
<a name="l01115"></a>01115         <span class="comment">// only for 3D</span>
<a name="l01116"></a>01116         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>;j++)
<a name="l01117"></a>01117             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {      
<a name="l01118"></a>01118                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0, domainBoundType, 0.0, <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>); 
<a name="l01119"></a>01119                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].lSizez-1, domainBoundType, 0.0, <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>); 
<a name="l01120"></a>01120             }
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122 
<a name="l01123"></a>01123     <span class="comment">// TEST!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11</span>
<a name="l01124"></a>01124   <span class="comment">/*for(int k=0;k&lt;mLevel[mMaxRefine].lSizez;k++)</span>
<a name="l01125"></a>01125 <span class="comment">    for(int j=0;j&lt;mLevel[mMaxRefine].lSizey;j++) {</span>
<a name="l01126"></a>01126 <span class="comment">            initEmptyCell(mMaxRefine, mLevel[mMaxRefine].lSizex-2,j,k, domainBoundType, 0.0, BND_FILL); </span>
<a name="l01127"></a>01127 <span class="comment">    }</span>
<a name="l01128"></a>01128 <span class="comment">  for(int k=0;k&lt;mLevel[mMaxRefine].lSizez;k++)</span>
<a name="l01129"></a>01129 <span class="comment">    for(int i=0;i&lt;mLevel[mMaxRefine].lSizex;i++) {      </span>
<a name="l01130"></a>01130 <span class="comment">            initEmptyCell(mMaxRefine, i,1,k, domainBoundType, 0.0, BND_FILL); </span>
<a name="l01131"></a>01131 <span class="comment">    }</span>
<a name="l01132"></a>01132 <span class="comment">    // */</span>
<a name="l01133"></a>01133 
<a name="l01134"></a>01134     <span class="comment">/*for(int ii=0; ii&lt;(int)po w_change?(2.0,mMaxRefine)-1; ii++) {</span>
<a name="l01135"></a>01135 <span class="comment">        errMsg(&quot;BNDTESTSYMM&quot;,&quot;set &quot;&lt;&lt;mLevel[mMaxRefine].lSizex-2-ii );</span>
<a name="l01136"></a>01136 <span class="comment">        for(int k=0;k&lt;mLevel[mMaxRefine].lSizez;k++)</span>
<a name="l01137"></a>01137 <span class="comment">            for(int j=0;j&lt;mLevel[mMaxRefine].lSizey;j++) {</span>
<a name="l01138"></a>01138 <span class="comment">                initEmptyCell(mMaxRefine, mLevel[mMaxRefine].lSizex-2-ii,j,k, domainBoundType, 0.0, BND_FILL);  // SYMM!? 2D?</span>
<a name="l01139"></a>01139 <span class="comment">            }</span>
<a name="l01140"></a>01140 <span class="comment">        for(int j=0;j&lt;mLevel[mMaxRefine].lSizey;j++)</span>
<a name="l01141"></a>01141 <span class="comment">            for(int i=0;i&lt;mLevel[mMaxRefine].lSizex;i++) {      </span>
<a name="l01142"></a>01142 <span class="comment">                initEmptyCell(mMaxRefine, i,j,mLevel[mMaxRefine].lSizez-2-ii, domainBoundType, 0.0, BND_FILL);   // SYMM!? 3D?</span>
<a name="l01143"></a>01143 <span class="comment">            }</span>
<a name="l01144"></a>01144 <span class="comment">    }</span>
<a name="l01145"></a>01145 <span class="comment">    // Symmetry tests */</span>
<a name="l01146"></a>01146     <span class="comment">// vortt</span>
<a name="l01147"></a>01147 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01148"></a>01148 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(( strstr( this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aebe73e6fbafee469315fb5d83f1c451c">getName</a>().c_str(), <span class="stringliteral">&quot;vorttfluid&quot;</span> ) != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2)) {
<a name="l01149"></a>01149         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;VORTT&quot;</span>,<span class="stringliteral">&quot;init&quot;</span>);
<a name="l01150"></a>01150         <span class="keywordtype">int</span> level=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01151"></a>01151         <span class="keywordtype">int</span> cx = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>/2;
<a name="l01152"></a>01152         <span class="keywordtype">int</span> cyo = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>/2;
<a name="l01153"></a>01153         <span class="keywordtype">int</span> sx = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>/8;
<a name="l01154"></a>01154         <span class="keywordtype">int</span> sy = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>/8;
<a name="l01155"></a>01155         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rho = 1.;
<a name="l01156"></a>01156         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rhomass = 1.;
<a name="l01157"></a>01157         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> uFactor = 0.15;
<a name="l01158"></a>01158         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> vdist = 1.0;
<a name="l01159"></a>01159 
<a name="l01160"></a>01160         <span class="keywordtype">int</span> cy1=cyo-(int)(vdist*sy);
<a name="l01161"></a>01161         <span class="keywordtype">int</span> cy2=cyo+(int)(vdist*sy);
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <span class="comment">//for(int j=cy-sy;j&lt;cy+sy;j++) for(int i=cx-sx;i&lt;cx+sx;i++) {      </span>
<a name="l01164"></a>01164         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++)
<a name="l01165"></a>01165             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01166"></a>01166                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> d1 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(cx,cy1,0.)-<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0));
<a name="l01167"></a>01167                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> d2 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(cx,cy2,0.)-<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0));
<a name="l01168"></a>01168                 <span class="keywordtype">bool</span> in1 = (d1&lt;=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(sx));
<a name="l01169"></a>01169                 <span class="keywordtype">bool</span> in2 = (d2&lt;=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(sx));
<a name="l01170"></a>01170                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> uvec(0.);
<a name="l01171"></a>01171               <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> v1 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ac43d14a1c6daaaff84ddd054b5c4db7d">getNormalized</a>( <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(cx,cy1,0.)-<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0), <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(0.,0.,1.)) )*  uFactor;
<a name="l01172"></a>01172               <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> v2 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ac43d14a1c6daaaff84ddd054b5c4db7d">getNormalized</a>( <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(cx,cy2,0.)-<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0), <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(0.,0.,1.)) )*  uFactor;
<a name="l01173"></a>01173                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> w1=1., w2=1.;
<a name="l01174"></a>01174                 <span class="keywordflow">if</span>(!in1) w1=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(sx)/(1.5*d1);
<a name="l01175"></a>01175                 <span class="keywordflow">if</span>(!in2) w2=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(sx)/(1.5*d2);
<a name="l01176"></a>01176                 <span class="keywordflow">if</span>(!in1) w1=0.; <span class="keywordflow">if</span>(!in2) w2=0.; <span class="comment">// sharp falloff</span>
<a name="l01177"></a>01177               uvec += v1*w1;
<a name="l01178"></a>01178               uvec += v2*w2;
<a name="l01179"></a>01179                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>, rho, rhomass, uvec );
<a name="l01180"></a>01180                 <span class="comment">//errMsg(&quot;VORTT&quot;,&quot;init uvec&quot;&lt;&lt;uvec);</span>
<a name="l01181"></a>01181             }
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     }
<a name="l01184"></a>01184 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01185"></a>01185 <span class="preprocessor"></span>
<a name="l01186"></a>01186     <span class="comment">//if(getGlobalBakeState()&lt;0) { CAUSE_PANIC; errMsg(&quot;LbmFsgrSolver::initialize&quot;,&quot;Got abort signal1, causing panic, aborting...&quot;); return false; }</span>
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <span class="comment">// prepare interface cells</span>
<a name="l01189"></a>01189     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a96c4b4fe659520095e9a66fa6739f62b" title="init part for all freesurface testcases">initFreeSurfaces</a>();
<a name="l01190"></a>01190     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8473f131eb087826a9322f2923a30944" title="init density gradient if enabled">initStandingFluidGradient</a>();
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     <span class="comment">// perform first step to init initial mass</span>
<a name="l01193"></a>01193     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> = 0.0;
<a name="l01194"></a>01194     <span class="keywordtype">int</span> inmCellCnt = 0;
<a name="l01195"></a>01195     <a class="code" href="../../d1/d24/solver__class_8h.html#a1cd53306465fab36f6bc4c1d8ef9d291">FSGR_FORIJK1</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) {
<a name="l01196"></a>01196         <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) {
<a name="l01197"></a>01197             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> fluidRho = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, 0); 
<a name="l01198"></a>01198             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { fluidRho += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, l); }
<a name="l01199"></a>01199             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> += fluidRho;
<a name="l01200"></a>01200             inmCellCnt ++;
<a name="l01201"></a>01201         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) {
<a name="l01202"></a>01202             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>);
<a name="l01203"></a>01203             inmCellCnt ++;
<a name="l01204"></a>01204         }
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadde2333da700e8b59fdec8ce3a2a21d">mCurrentVolume</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6e354059ddae9c48053b758729e04204" title="mass calculated during streaming step">mCurrentMass</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a>;
<a name="l01207"></a>01207 
<a name="l01208"></a>01208     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ParamVec</a> cspv = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a7241bf69c8d77e20c53567e0cb7c5b8b">calculateCellSize</a>();
<a name="l01209"></a>01209     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) cspv[2] = 1.0;
<a name="l01210"></a>01210     inmCellCnt = 1;
<a name="l01211"></a>01211     <span class="keywordtype">double</span> nrmMass = (double)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> / (<span class="keywordtype">double</span>)(inmCellCnt) *cspv[0]*cspv[1]*cspv[2] * 1000.0;
<a name="l01212"></a>01212     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Initial Mass:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a>&lt;&lt;<span class="stringliteral">&quot; normalized:&quot;</span>&lt;&lt;nrmMass, 3);
<a name="l01213"></a>01213     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> = 0.0; <span class="comment">// reset, and use actual value after first step</span>
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="comment">//mStartSymm = false;</span>
<a name="l01216"></a>01216 <span class="preprocessor">#if ELBEEM_PLUGIN!=1</span>
<a name="l01217"></a>01217 <span class="preprocessor"></span>    <span class="keywordflow">if</span>((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2)&amp;&amp;(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>&lt;200)) {
<a name="l01218"></a>01218         <span class="keywordflow">if</span>(!<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2346a3bd096d0ec6088bd13b9ce6179f" title="debugging">checkSymmetry</a>(<span class="stringliteral">&quot;init&quot;</span>)) {
<a name="l01219"></a>01219             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Unsymmetric init...&quot;</span>);
<a name="l01220"></a>01220         } <span class="keywordflow">else</span> {
<a name="l01221"></a>01221             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<span class="stringliteral">&quot;Symmetric init!&quot;</span>);
<a name="l01222"></a>01222         }
<a name="l01223"></a>01223     }
<a name="l01224"></a>01224 <span class="preprocessor">#endif // ELBEEM_PLUGIN!=1</span>
<a name="l01225"></a>01225 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01226"></a>01226 }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 
<a name="l01230"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aae9b3389485a8b0e82254611cf6eff6f">01230</a> <span class="keywordtype">bool</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aae9b3389485a8b0e82254611cf6eff6f">LbmFsgrSolver::initializeSolverPostinit</a>() {
<a name="l01231"></a>01231     <span class="comment">// coarsen region</span>
<a name="l01232"></a>01232     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> fsgrtstart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l01233"></a>01233     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>-1; lev&gt;=0; lev--) {
<a name="l01234"></a>01234         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Coarsening level &quot;</span>&lt;&lt;lev&lt;&lt;<span class="stringliteral">&quot;.&quot;</span>,8);
<a name="l01235"></a>01235         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4c7cb0e8a03c580e65ccc368dcb401e3">adaptGrid</a>(lev);
<a name="l01236"></a>01236         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a97c57a11db77306909c68df328272ca6" title="multi level functions">coarseRestrictFromFine</a>(lev);
<a name="l01237"></a>01237         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4c7cb0e8a03c580e65ccc368dcb401e3">adaptGrid</a>(lev);
<a name="l01238"></a>01238         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a97c57a11db77306909c68df328272ca6" title="multi level functions">coarseRestrictFromFine</a>(lev);
<a name="l01239"></a>01239     }
<a name="l01240"></a>01240     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a09fbef62264f98c4a5e7404e64045fce">markedClearList</a>();
<a name="l01241"></a>01241     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> fsgrtend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l01242"></a>01242     <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#aee34210942d51f7babe9ad9d367e350f" title="debug output?">mSilent</a>){ <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;FSGR init done (&quot;</span>&lt;&lt; <a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(fsgrtend-fsgrtstart)&lt;&lt;<span class="stringliteral">&quot;), changes:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a87046fc9adf1d49189af26539be2e3a6">mNumFsgrChanges</a> , 10 ); }
<a name="l01243"></a>01243     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a87046fc9adf1d49189af26539be2e3a6">mNumFsgrChanges</a> = 0;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>; l++) { 
<a name="l01246"></a>01246         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> area = 0.5 * 0.5 *0.5;
<a name="l01247"></a>01247         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) area = 0.5 * 0.5;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l]!=0) area *= 0.5;
<a name="l01250"></a>01250         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l]!=0) area *= 0.5;
<a name="l01251"></a>01251         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l]!=0) area *= 0.5;
<a name="l01252"></a>01252         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af4d5e1dd40dc1ca7ca25cf3903f1aee8">mFsgrCellArea</a>[l] = area;
<a name="l01253"></a>01253     } <span class="comment">// l</span>
<a name="l01254"></a>01254 
<a name="l01255"></a>01255     <span class="comment">// make sure both sets are ok</span>
<a name="l01256"></a>01256     <span class="comment">// copy from other to curr</span>
<a name="l01257"></a>01257     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l01258"></a>01258     <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) {
<a name="l01259"></a>01259         <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setOther) = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr);
<a name="l01260"></a>01260     } } <span class="comment">// first copy flags */</span>
<a name="l01261"></a>01261 
<a name="l01262"></a>01262 
<a name="l01263"></a>01263     <span class="comment">// old mpPreviewSurface init</span>
<a name="l01264"></a>01264     <span class="comment">//if(getGlobalBakeState()&lt;0) { CAUSE_PANIC; errMsg(&quot;LbmFsgrSolver::initialize&quot;,&quot;Got abort signal2, causing panic, aborting...&quot;); return false; }</span>
<a name="l01265"></a>01265     <span class="comment">// make sure fill fracs are right for first surface generation</span>
<a name="l01266"></a>01266     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4a51bdd784b2952e07310f442d291cd2">stepMain</a>();
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <span class="comment">// prepare once...</span>
<a name="l01269"></a>01269     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#af579a3aa71115b13aed8614565d80175">setParticles</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a96b365a3ed6985783709033fc3ebeb18">mPartDropMassSub</a>);
<a name="l01270"></a>01270   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Iso Settings, subdivs=&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a878b655662dd238176aba3ee13801695">getSubdivs</a>()&lt;&lt;<span class="stringliteral">&quot;, partsize=&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a96b365a3ed6985783709033fc3ebeb18">mPartDropMassSub</a>, 9);
<a name="l01271"></a>01271     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a392e35e14aa1e21488853086c0a50ff1" title="for raytracing, preprocess">prepareVisualization</a>();
<a name="l01272"></a>01272     <span class="comment">// copy again for stats counting</span>
<a name="l01273"></a>01273     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l01274"></a>01274     <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) {
<a name="l01275"></a>01275         <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setOther) = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr);
<a name="l01276"></a>01276     } } <span class="comment">// first copy flags */</span>
<a name="l01277"></a>01277 
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <span class="comment">// now really done...</span>
<a name="l01280"></a>01280   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;SurfaceGen: SmsOrg(&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aa5973de93444bdc4eb4468ccbe95f20d">mSmoothSurface</a>&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a9e1cd8c017bea2ef556a0eaffd121011">mSmoothNormals</a>&lt;&lt; <span class="comment">/*&quot;,&quot;&lt;&lt;featureSize&lt;&lt;*/</span> <span class="stringliteral">&quot;), Iso(&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a4bca62e3d31ad7bccfdbcfb72ab57aff">getSmoothSurface</a>()&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a7ef713f83ffc7b97b544d83732aada52">getSmoothNormals</a>()&lt;&lt;<span class="stringliteral">&quot;) &quot;</span>,10);
<a name="l01281"></a>01281   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Init done ... &quot;</span>,10);
<a name="l01282"></a>01282     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a0cb712be00a6c0fe651a2798abe4ab88">mInitDone</a> = 1;
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     <span class="comment">// init fluid control</span>
<a name="l01285"></a>01285     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a650a4f49f4f2c97e6f5202d86717c991">initCpdata</a>();
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01288"></a>01288 <span class="preprocessor"></span>    initTestdata();
<a name="l01289"></a>01289 <span class="preprocessor">#endif // ELBEEM_PLUGIN!=1</span>
<a name="l01290"></a>01290 <span class="preprocessor"></span>    <span class="comment">// not inited? dont use...</span>
<a name="l01291"></a>01291     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a883de517b6b8407dbd30c35169b53c84" title="border cutoff value">mCutoff</a>&lt;0) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a883de517b6b8407dbd30c35169b53c84" title="border cutoff value">mCutoff</a>=0;
<a name="l01292"></a>01292 
<a name="l01293"></a>01293     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aebd211baccbc8719a4e27b7c93c465e9">initParticles</a>();
<a name="l01294"></a>01294     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01295"></a>01295 }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297 
<a name="l01298"></a>01298 
<a name="l01299"></a>01299 <span class="comment">// macros for mov obj init</span>
<a name="l01300"></a>01300 <span class="preprocessor">#if LBMDIM==2</span>
<a name="l01301"></a>01301 <span class="preprocessor"></span>
<a name="l01302"></a>01302 <span class="preprocessor">#define POS2GRID_CHECK(vec,n) \</span>
<a name="l01303"></a>01303 <span class="preprocessor">                monTotal++;\</span>
<a name="l01304"></a>01304 <span class="preprocessor">                int k=(int)( ((vec)[n][2]-iniPos[2])/dvec[2] +0.0); \</span>
<a name="l01305"></a>01305 <span class="preprocessor">                if(k!=0) continue; \</span>
<a name="l01306"></a>01306 <span class="preprocessor">                const int i=(int)( ((vec)[n][0]-iniPos[0])/dvec[0] +0.0); \</span>
<a name="l01307"></a>01307 <span class="preprocessor">                if(i&lt;=0) continue; \</span>
<a name="l01308"></a>01308 <span class="preprocessor">                if(i&gt;=mLevel[level].lSizex-1) continue; \</span>
<a name="l01309"></a>01309 <span class="preprocessor">                const int j=(int)( ((vec)[n][1]-iniPos[1])/dvec[1] +0.0); \</span>
<a name="l01310"></a>01310 <span class="preprocessor">                if(j&lt;=0) continue; \</span>
<a name="l01311"></a>01311 <span class="preprocessor">                if(j&gt;=mLevel[level].lSizey-1) continue;  \</span>
<a name="l01312"></a>01312 <span class="preprocessor"></span>
<a name="l01313"></a>01313 <span class="preprocessor"></span><span class="preprocessor">#else // LBMDIM -&gt; 3</span>
<a name="l01314"></a><a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">01314</a> <span class="preprocessor"></span><span class="preprocessor">#define POS2GRID_CHECK(vec,n) \</span>
<a name="l01315"></a>01315 <span class="preprocessor">                monTotal++;\</span>
<a name="l01316"></a>01316 <span class="preprocessor">                const int i=(int)( ((vec)[n][0]-iniPos[0])/dvec[0] +0.0); \</span>
<a name="l01317"></a>01317 <span class="preprocessor">                if(i&lt;=0) continue; \</span>
<a name="l01318"></a>01318 <span class="preprocessor">                if(i&gt;=mLevel[level].lSizex-1) continue; \</span>
<a name="l01319"></a>01319 <span class="preprocessor">                const int j=(int)( ((vec)[n][1]-iniPos[1])/dvec[1] +0.0); \</span>
<a name="l01320"></a>01320 <span class="preprocessor">                if(j&lt;=0) continue; \</span>
<a name="l01321"></a>01321 <span class="preprocessor">                if(j&gt;=mLevel[level].lSizey-1) continue; \</span>
<a name="l01322"></a>01322 <span class="preprocessor">                const int k=(int)( ((vec)[n][2]-iniPos[2])/dvec[2] +0.0); \</span>
<a name="l01323"></a>01323 <span class="preprocessor">                if(k&lt;=0) continue; \</span>
<a name="l01324"></a>01324 <span class="preprocessor">                if(k&gt;=mLevel[level].lSizez-1) continue; \</span>
<a name="l01325"></a>01325 <span class="preprocessor"></span>
<a name="l01326"></a>01326 <span class="preprocessor"></span><span class="preprocessor">#endif // LBMDIM </span>
<a name="l01327"></a>01327 <span class="preprocessor"></span>
<a name="l01328"></a>01328 <span class="comment">// calculate object velocity from vert arrays in objvel vec</span>
<a name="l01329"></a><a class="code" href="../../d8/dd5/solver__init_8cpp.html#a2f910c532f4d286bf6068f83f23adaf6">01329</a> <span class="preprocessor">#define OBJVEL_CALC \</span>
<a name="l01330"></a>01330 <span class="preprocessor">                LbmVec objvel = vec2L((mMOIVertices[n]-mMOIVerticesOld[n]) /dvec); { \</span>
<a name="l01331"></a>01331 <span class="preprocessor">                const LbmFloat usqr = (objvel[0]*objvel[0]+objvel[1]*objvel[1]+objvel[2]*objvel[2])*1.5; \</span>
<a name="l01332"></a>01332 <span class="preprocessor">                USQRMAXCHECK(usqr, objvel[0],objvel[1],objvel[2], mMaxVlen, mMxvx,mMxvy,mMxvz); \</span>
<a name="l01333"></a>01333 <span class="preprocessor">                if(usqr&gt;maxusqr) { \</span>
<a name="l01334"></a>01334 <span class="preprocessor">                    </span><span class="comment">/* cutoff at maxVelVal */</span> \
<a name="l01335"></a>01335                     for(int jj=0; jj&lt;3; jj++) { \
<a name="l01336"></a>01336                         if(objvel[jj]&gt;0.) objvel[jj] =  maxVelVal;  \
<a name="l01337"></a>01337                         if(objvel[jj]&lt;0.) objvel[jj] = -maxVelVal; \
<a name="l01338"></a>01338                     } \
<a name="l01339"></a>01339                 } } \
<a name="l01340"></a>01340                 if(ntype&amp;(CFBndFreeslip)) { \
<a name="l01341"></a>01341                     const LbmFloat dp=dot(objvel, vec2L((*pNormals)[n]) ); \
<a name="l01342"></a>01342                     const LbmVec oldov=objvel; <span class="comment">/*DEBUG*/</span> \
<a name="l01343"></a>01343                     objvel = vec2L((*pNormals)[n]) *dp; \
<a name="l01344"></a>01344                     <span class="comment">/* if((j==24)&amp;&amp;(n%5==2)) errMsg(&quot;FSBT&quot;,&quot;n&quot;&lt;&lt;n&lt;&lt;&quot; v&quot;&lt;&lt;objvel&lt;&lt;&quot; nn&quot;&lt;&lt;(*pNormals)[n]&lt;&lt;&quot; dp&quot;&lt;&lt;dp&lt;&lt;&quot; oldov&quot;&lt;&lt;oldov ); */</span> \
<a name="l01345"></a>01345                 } \
<a name="l01346"></a>01346                 else if(ntype&amp;(CFBndPartslip)) { \
<a name="l01347"></a>01347                     const LbmFloat dp=dot(objvel, vec2L((*pNormals)[n]) ); \
<a name="l01348"></a>01348                     const LbmVec oldov=objvel; <span class="comment">/*DEBUG*/</span> \
<a name="l01349"></a>01349                     <span class="comment">/* if((j==24)&amp;&amp;(n%5==2)) errMsg(&quot;FSBT&quot;,&quot;n&quot;&lt;&lt;n&lt;&lt;&quot; v&quot;&lt;&lt;objvel&lt;&lt;&quot; nn&quot;&lt;&lt;(*pNormals)[n]&lt;&lt;&quot; dp&quot;&lt;&lt;dp&lt;&lt;&quot; oldov&quot;&lt;&lt;oldov ); */</span> \
<a name="l01350"></a>01350                     const LbmFloat partv = mObjectPartslips[OId]; \
<a name="l01351"></a>01351                     <span class="comment">/*errMsg(&quot;PARTSLIP_DEBUG&quot;,&quot;l=&quot;&lt;&lt;l&lt;&lt;&quot; ccel=&quot;&lt;&lt;RAC(ccel, dfInv[l] )&lt;&lt;&quot; partv=&quot;&lt;&lt;partv&lt;&lt;&quot;,id=&quot;&lt;&lt;(int)(mnbf&gt;&gt;24)&lt;&lt;&quot; newval=&quot;&lt;&lt;newval ); / part slip debug */</span> \
<a name="l01352"></a>01352                     <span class="comment">/* m[l] = (RAC(ccel, dfInv[l] ) ) * partv + newval * (1.-partv); part slip */</span> \
<a name="l01353"></a>01353                     objvel = objvel*partv + vec2L((*pNormals)[n]) *dp*(1.-partv); \
<a name="l01354"></a>01354                 }
<a name="l01355"></a>01355 
<a name="l01356"></a><a class="code" href="../../d8/dd5/solver__init_8cpp.html#aacf3bdb2f52d73d3e213f555c2c8c8c9">01356</a> <span class="preprocessor">#define TTT \</span>
<a name="l01357"></a>01357 <span class="preprocessor"></span>
<a name="l01358"></a>01358 <span class="preprocessor"></span>
<a name="l01359"></a>01359 <span class="comment">/*****************************************************************************/</span>
<a name="l01361"></a>01361 <span class="comment">/*****************************************************************************/</span>
<a name="l01362"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6afefacd79094e4c5fb6a3073145bcf3">01362</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6afefacd79094e4c5fb6a3073145bcf3" title="init moving obstacles for next sim step sim">LbmFsgrSolver::initMovingObstacles</a>(<span class="keywordtype">bool</span> staticInit) {
<a name="l01363"></a>01363     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> monstart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l01364"></a>01364 
<a name="l01365"></a>01365     <span class="comment">// movobj init</span>
<a name="l01366"></a>01366     <span class="keyword">const</span> <span class="keywordtype">int</span> level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01367"></a>01367     <span class="keyword">const</span> <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l01368"></a>01368     <span class="keyword">const</span> <span class="keywordtype">int</span> otherSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a969dc4eebe3ff743980e099cad72240a" title="target/other set of dist funcs">setOther</a>;
<a name="l01369"></a>01369     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> sourceTime = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>; <span class="comment">// should be equal to mLastSimTime!</span>
<a name="l01370"></a>01370     <span class="comment">// for debugging - check targetTime check during DEFAULT STREAM</span>
<a name="l01371"></a>01371     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> targetTime = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a> + <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>();
<a name="l01372"></a>01372     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa257ddf3865c461af52dcdd20f8ff955">mLastSimTime</a> == targetTime) {
<a name="l01373"></a>01373         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initMovingObstacles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#aac9413fb9eeba06e80c56258d95b15d6">DM_WARNING</a>,<span class="stringliteral">&quot;Called for same time! (t=&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>&lt;&lt;<span class="stringliteral">&quot; , targett=&quot;</span>&lt;&lt;targetTime&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>, 1);
<a name="l01374"></a>01374         <span class="keywordflow">return</span>;
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376     <span class="comment">//debMsgStd(&quot;LbmFsgrSolver::initMovingObstacles&quot;,DM_WARNING,&quot;time: &quot;&lt;&lt;mSimulationTime&lt;&lt;&quot; lasttt:&quot;&lt;&lt;mLastSimTime,10);</span>
<a name="l01377"></a>01377     <span class="comment">//if(mSimulationTime!=mLastSimTime) errMsg(&quot;LbmFsgrSolver::initMovingObstacles&quot;,&quot;time: &quot;&lt;&lt;mSimulationTime&lt;&lt;&quot; lasttt:&quot;&lt;&lt;mLastSimTime);</span>
<a name="l01378"></a>01378 
<a name="l01379"></a>01379     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxVelVal = 0.1666;
<a name="l01380"></a>01380     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxusqr = maxVelVal*maxVelVal*3. *1.5;
<a name="l01381"></a>01381 
<a name="l01382"></a>01382     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rhomass = 0.0;
<a name="l01383"></a>01383     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> otype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>; <span class="comment">// verify type of last step, might be non moving obs!</span>
<a name="l01384"></a>01384     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01385"></a>01385     <span class="comment">// WARNING - copied from geo init!</span>
<a name="l01386"></a>01386     <span class="keywordtype">int</span> numobjs = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>-&gt;size());
<a name="l01387"></a>01387     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dvec = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].nodeSize); <span class="comment">//dvec*1.0;</span>
<a name="l01388"></a>01388     <span class="comment">// 2d display as rectangles</span>
<a name="l01389"></a>01389     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> iniPos(0.0);
<a name="l01390"></a>01390     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l01391"></a>01391         dvec[2] = 1.0; 
<a name="l01392"></a>01392         iniPos = (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>( 0.0, 0.0, (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[2]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2])*0.5 ))-(dvec*0.0);
<a name="l01393"></a>01393     } <span class="keywordflow">else</span> {
<a name="l01394"></a>01394         iniPos = (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>( 0.0 ))-(dvec*0.0);
<a name="l01395"></a>01395     }
<a name="l01396"></a>01396     
<a name="l01397"></a>01397     <span class="keywordflow">if</span>( (<span class="keywordtype">int</span>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aed4465d269c7fe5bfe360d3fb443f201" title="moving object mass boundary condition values">mObjectMassMovnd</a>.size() &lt; numobjs) {
<a name="l01398"></a>01398         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aed4465d269c7fe5bfe360d3fb443f201" title="moving object mass boundary condition values">mObjectMassMovnd</a>.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numobjs; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01399"></a>01399             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aed4465d269c7fe5bfe360d3fb443f201" title="moving object mass boundary condition values">mObjectMassMovnd</a>.push_back(0.);
<a name="l01400"></a>01400         }
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402     
<a name="l01403"></a>01403     <span class="comment">// stats</span>
<a name="l01404"></a>01404     <span class="keywordtype">int</span> monPoints=0, monObsts=0, monFluids=0, monTotal=0, monTrafo=0;
<a name="l01405"></a>01405     <span class="keywordtype">int</span> nbored;
<a name="l01406"></a>01406     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> OId=0; OId&lt;numobjs; OId++) {
<a name="l01407"></a>01407         <a class="code" href="../../df/dc9/classntlGeometryObject.html">ntlGeometryObject</a> *obj = (*mpGiObjects)[OId];
<a name="l01408"></a>01408         <span class="keywordtype">bool</span> skip = <span class="keyword">false</span>;
<a name="l01409"></a>01409         <span class="keywordflow">if</span>(obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a4ce21e1f1ec7dcb750f4bc1dd3e87d55">getGeoInitId</a>() != <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9baab5805b5a1e6717c7589dab64684c">mLbmInitId</a>) skip=<span class="keyword">true</span>;
<a name="l01410"></a>01410         <span class="keywordflow">if</span>( (!staticInit) &amp;&amp; (!obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>()) ) skip=<span class="keyword">true</span>;
<a name="l01411"></a>01411         <span class="keywordflow">if</span>( ( staticInit) &amp;&amp; ( obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>()) ) skip=<span class="keyword">true</span>;
<a name="l01412"></a>01412         <span class="keywordflow">if</span>(skip) <span class="keywordflow">continue</span>;
<a name="l01413"></a>01413         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initMovingObstacles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot; obj &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; skip:&quot;</span>&lt;&lt;skip&lt;&lt;<span class="stringliteral">&quot;, static:&quot;</span>&lt;&lt;staticInit&lt;&lt;<span class="stringliteral">&quot; anim:&quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>()&lt;&lt;<span class="stringliteral">&quot; gid:&quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a4ce21e1f1ec7dcb750f4bc1dd3e87d55">getGeoInitId</a>()&lt;&lt;<span class="stringliteral">&quot; simgid:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a9baab5805b5a1e6717c7589dab64684c">mLbmInitId</a>, 10);
<a name="l01414"></a>01414 
<a name="l01415"></a>01415         <span class="keywordflow">if</span>( (obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>()&amp;<a class="code" href="../../d8/d00/elbeem_8h.html#a45da565376c7544c990b8b2f8771d213">FGI_ALLBOUNDS</a>) || 
<a name="l01416"></a>01416                 ((obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>()&amp;<a class="code" href="../../d8/d00/elbeem_8h.html#a51b010da5bd6ef1a80ad3b9a7be00e3a">FGI_FLUID</a>) &amp;&amp; staticInit) ) {
<a name="l01417"></a>01417 
<a name="l01418"></a>01418             otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01419"></a>01419             <span class="keywordflow">switch</span>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>()) {
<a name="l01420"></a>01420                 <span class="comment">/* case FGI_BNDPART: // old, use noslip for moving part/free objs</span>
<a name="l01421"></a>01421 <span class="comment">                case FGI_BNDFREE: </span>
<a name="l01422"></a>01422 <span class="comment">                    if(!staticInit) {</span>
<a name="l01423"></a>01423 <span class="comment">                        errMsg(&quot;LbmFsgrSolver::initMovingObstacles&quot;,&quot;Warning - moving free/part slip objects NYI &quot;&lt;&lt;obj-&gt;getName() );</span>
<a name="l01424"></a>01424 <span class="comment">                        otype = ntype = CFBnd|CFBndNoslip;</span>
<a name="l01425"></a>01425 <span class="comment">                    } else {</span>
<a name="l01426"></a>01426 <span class="comment">                        if(obj-&gt;getGeoInitType()==FGI_BNDPART) otype = ntype = CFBnd|CFBndPartslip;</span>
<a name="l01427"></a>01427 <span class="comment">                        if(obj-&gt;getGeoInitType()==FGI_BNDFREE) otype = ntype = CFBnd|CFBndFreeslip;</span>
<a name="l01428"></a>01428 <span class="comment">                    }</span>
<a name="l01429"></a>01429 <span class="comment">                    break; </span>
<a name="l01430"></a>01430 <span class="comment">                    // off */</span>
<a name="l01431"></a>01431                 <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#adfd63685e07b3a05e15253ac1dd88c53">FGI_BNDPART</a>: rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01432"></a>01432                     otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a41f6a5ce6d232424fccaea0c8f9b7816">CFBndPartslip</a>|(OId&lt;&lt;24);
<a name="l01433"></a>01433                     <span class="keywordflow">break</span>;
<a name="l01434"></a>01434                 <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a26267e2d9b47124e93188bb5e770524b">FGI_BNDFREE</a>: rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01435"></a>01435                     otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a84c56ca01be582fbb8ee0b2bef93b162">CFBndFreeslip</a>|(OId&lt;&lt;24);
<a name="l01436"></a>01436                     <span class="keywordflow">break</span>;
<a name="l01437"></a>01437                     <span class="comment">// off */</span>
<a name="l01438"></a>01438                 <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#ad0e7f1ed7626d8bd0701ec8f2e96aacd">FGI_BNDNO</a>:   rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01439"></a>01439                     otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a52169459320fac69e44404feaa0a340e">CFBndNoslip</a>|(OId&lt;&lt;24);
<a name="l01440"></a>01440                     <span class="keywordflow">break</span>;
<a name="l01441"></a>01441                 <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a51b010da5bd6ef1a80ad3b9a7be00e3a">FGI_FLUID</a>: 
<a name="l01442"></a>01442                     otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>; 
<a name="l01443"></a>01443                     <span class="keywordflow">break</span>;
<a name="l01444"></a>01444                 <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a981c60c9f2725cfc951630cf070fc646">FGI_MBNDINFLOW</a>: 
<a name="l01445"></a>01445                     otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a4329fc9838ec0a7bc80d0631dfd91289">CFMbndInflow</a>; 
<a name="l01446"></a>01446                     <span class="keywordflow">break</span>;
<a name="l01447"></a>01447                 <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#ae440d9b224ab18a3429b1fcb1dabccc8">FGI_MBNDOUTFLOW</a>: 
<a name="l01448"></a>01448                     otype = ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>; 
<a name="l01449"></a>01449                     <span class="keywordflow">break</span>;
<a name="l01450"></a>01450             }
<a name="l01451"></a>01451             <span class="keywordtype">int</span> wasActive = ((obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a3af1760d6e1672d64113f8eef2496fc6">getGeoActive</a>(sourceTime)&gt;0.)? 1:0);
<a name="l01452"></a>01452             <span class="keywordtype">int</span> active =    ((obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a3af1760d6e1672d64113f8eef2496fc6">getGeoActive</a>(targetTime)&gt;0.)? 1:0);
<a name="l01453"></a>01453             <span class="comment">//errMsg(&quot;GEOACTT&quot;,&quot; obj &quot;&lt;&lt;obj-&gt;getName()&lt;&lt;&quot; a:&quot;&lt;&lt;active&lt;&lt;&quot;,&quot;&lt;&lt;wasActive&lt;&lt;&quot;  s&quot;&lt;&lt;sourceTime&lt;&lt;&quot; t&quot;&lt;&lt;targetTime &lt;&lt;&quot; v&quot;&lt;&lt;mObjectSpeeds[OId] );</span>
<a name="l01454"></a>01454             <span class="comment">// skip inactive in/out flows</span>
<a name="l01455"></a>01455             <span class="keywordflow">if</span>(ntype==<a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initMovingObstacles&quot;</span>,<span class="stringliteral">&quot;Invalid obj type &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>()); <span class="keywordflow">continue</span>; }
<a name="l01456"></a>01456             <span class="keywordflow">if</span>((!active) &amp;&amp; (otype&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a4329fc9838ec0a7bc80d0631dfd91289">CFMbndInflow</a>)) ) <span class="keywordflow">continue</span>;
<a name="l01457"></a>01457 
<a name="l01458"></a>01458             <span class="comment">// copied from  recalculateObjectSpeeds</span>
<a name="l01459"></a>01459             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId] = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a6876e6f7f70128c9e931df8dffbf53da">calculateLattVelocityFromRw</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3354c71d4798004f2f6962993794ee76">vec2P</a>( (*<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>)[OId]-&gt;getInitialVelocity(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) )));
<a name="l01460"></a>01460             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initMovingObstacles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;id&quot;</span>&lt;&lt;OId&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; inivel set to &quot;</span>&lt;&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId]&lt;&lt;<span class="stringliteral">&quot;, unscaled:&quot;</span>&lt;&lt; (*mpGiObjects)[OId]-&gt;getInitialVelocity(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) ,10 );
<a name="l01461"></a>01461 
<a name="l01462"></a>01462             <span class="comment">//vector&lt;ntlVec3Gfx&gt; tNormals;</span>
<a name="l01463"></a>01463             vector&lt;ntlVec3Gfx&gt; *pNormals = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01464"></a>01464             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af35fa677eb3a8b75194a7416dad37a1c">mMOINormals</a>.clear();
<a name="l01465"></a>01465             <span class="keywordflow">if</span>(ntype&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a84c56ca01be582fbb8ee0b2bef93b162">CFBndFreeslip</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a41f6a5ce6d232424fccaea0c8f9b7816">CFBndPartslip</a>)) { pNormals = &amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#af35fa677eb3a8b75194a7416dad37a1c">mMOINormals</a>; }
<a name="l01466"></a>01466 
<a name="l01467"></a>01467             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.clear();
<a name="l01468"></a>01468             <span class="keywordflow">if</span>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">getMeshAnimated</a>()) { 
<a name="l01469"></a>01469                 <span class="comment">// do two full update</span>
<a name="l01470"></a>01470                 <span class="comment">// TODO tNormals handling!?</span>
<a name="l01471"></a>01471                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>.clear();
<a name="l01472"></a>01472                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a0d4d85f93933c9d954972cd098c3503b">initMovingPointsAnim</a>(sourceTime,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>, targetTime, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>, pNormals,  <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].nodeSize, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>);
<a name="l01473"></a>01473                 monTrafo += <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>.size();
<a name="l01474"></a>01474                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(sourceTime, &amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>,pNormals, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>.size(), false );
<a name="l01475"></a>01475                 monTrafo += <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size();
<a name="l01476"></a>01476                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(targetTime, &amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> <span class="comment">/* no old normals needed */</span>, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(), false );
<a name="l01477"></a>01477             } <span class="keywordflow">else</span> {
<a name="l01478"></a>01478                 <span class="comment">// only do transform update</span>
<a name="l01479"></a>01479                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a974c9cb8d51faacb695648c89089bd94">getMovingPoints</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,pNormals); <span class="comment">// mMOIVertices = mCachedMovPoints</span>
<a name="l01480"></a>01480                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>;
<a name="l01481"></a>01481                 <span class="comment">// WARNING - assumes mSimulationTime is global!?</span>
<a name="l01482"></a>01482                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(targetTime, &amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,pNormals, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(), false );
<a name="l01483"></a>01483                 monTrafo += <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size();
<a name="l01484"></a>01484 
<a name="l01485"></a>01485                 <span class="comment">// correct flags from last position, but extrapolate</span>
<a name="l01486"></a>01486                 <span class="comment">// velocity to next timestep</span>
<a name="l01487"></a>01487                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(sourceTime, &amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> <span class="comment">/* no old normals needed */</span>, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>.size(), false );
<a name="l01488"></a>01488                 monTrafo += <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>.size();
<a name="l01489"></a>01489             }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491             <span class="comment">// object types</span>
<a name="l01492"></a>01492             <span class="keywordflow">if</span>(ntype&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>){
<a name="l01493"></a>01493 
<a name="l01494"></a>01494                 <span class="comment">// check if object is moving at all</span>
<a name="l01495"></a>01495                 <span class="keywordflow">if</span>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>()) {
<a name="l01496"></a>01496                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> objMaxVel = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ad1f99d809bf8921c2de5e839fcd7270a">calculateMaxVel</a>(sourceTime,targetTime);
<a name="l01497"></a>01497                     <span class="comment">// FIXME?</span>
<a name="l01498"></a>01498                     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(objMaxVel)&gt;0.0) { ntype |= <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3da81e6afe79d9cbe4361ebb7d099172">CFBndMoving</a>; }
<a name="l01499"></a>01499                     <span class="comment">// get old type - CHECK FIXME , timestep could have changed - cause trouble?</span>
<a name="l01500"></a>01500                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> oldobjMaxVel = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ad1f99d809bf8921c2de5e839fcd7270a">calculateMaxVel</a>(sourceTime - <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>(),sourceTime);
<a name="l01501"></a>01501                     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(oldobjMaxVel)&gt;0.0) { otype |= <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3da81e6afe79d9cbe4361ebb7d099172">CFBndMoving</a>; }
<a name="l01502"></a>01502                 }
<a name="l01503"></a>01503                 <span class="keywordflow">if</span>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">getMeshAnimated</a>()) { ntype |= <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3da81e6afe79d9cbe4361ebb7d099172">CFBndMoving</a>; otype |= <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3da81e6afe79d9cbe4361ebb7d099172">CFBndMoving</a>; }
<a name="l01504"></a>01504                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> rflagnb[27];
<a name="l01505"></a>01505                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> massCheck = 0.;
<a name="l01506"></a>01506                 <span class="keywordtype">int</span> massReinits=0;              
<a name="l01507"></a>01507                 <span class="keywordtype">bool</span> fillCells = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aed4465d269c7fe5bfe360d3fb443f201" title="moving object mass boundary condition values">mObjectMassMovnd</a>[OId]&lt;=-1.);
<a name="l01508"></a>01508                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> impactCorrFactor = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a9c6ffd8061d5154834187cbd243d4406">getGeoImpactFactor</a>(targetTime);
<a name="l01509"></a>01509                 
<a name="l01510"></a>01510 
<a name="l01511"></a>01511                 <span class="comment">// first pass - set new obs. cells</span>
<a name="l01512"></a>01512                 <span class="keywordflow">if</span>(active) {
<a name="l01513"></a>01513                     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(); n++) {
<a name="l01514"></a>01514                         <span class="comment">//errMsg(&quot;initMovingObstacles_Debug&quot;,&quot;OId&quot;&lt;&lt;OId&lt;&lt;&quot; n&quot;&lt;&lt;n&lt;&lt;&quot; -&gt; &quot;&lt;&lt;PRINT_IJK);</span>
<a name="l01515"></a>01515                         <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,n);
<a name="l01516"></a>01516                         <span class="comment">//{ errMsg(&quot;initMovingObstacles_Debug&quot;,&quot;OId&quot;&lt;&lt;OId&lt;&lt;&quot; n&quot;&lt;&lt;n&lt;&lt;&quot; -&gt; &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot;, t=&quot;&lt;&lt;targetTime); }</span>
<a name="l01517"></a>01517                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>)==targetTime) <span class="keywordflow">continue</span>;
<a name="l01518"></a>01518                         monPoints++;
<a name="l01519"></a>01519                         
<a name="l01520"></a>01520                         <span class="comment">// check mass</span>
<a name="l01521"></a>01521                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>)) {
<a name="l01522"></a>01522                             <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> { massCheck -= <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, l); }
<a name="l01523"></a>01523                             massReinits++;
<a name="l01524"></a>01524                         }
<a name="l01525"></a>01525                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {
<a name="l01526"></a>01526                             massCheck -= <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>);
<a name="l01527"></a>01527                             massReinits++;
<a name="l01528"></a>01528                         }
<a name="l01529"></a>01529 
<a name="l01530"></a>01530                         <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) = ntype;
<a name="l01531"></a>01531                         <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l01532"></a>01532                             <span class="comment">//CellFlagType flag = RFLAG_NB(level, i,j,k,workSet,l);</span>
<a name="l01533"></a>01533                             rflagnb[l] = <a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet,l);
<a name="l01534"></a>01534                             <span class="keywordflow">if</span>(rflagnb[l]&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {
<a name="l01535"></a>01535                                 rflagnb[l] &amp;= (~<a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>); <span class="comment">// remove CFNoBndFluid flag</span>
<a name="l01536"></a>01536                                 <a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet,l) &amp;= rflagnb[l]; 
<a name="l01537"></a>01537                             }
<a name="l01538"></a>01538                         }
<a name="l01539"></a>01539                         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *dstCell = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet);
<a name="l01540"></a>01540                         <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,0) = 0.0;
<a name="l01541"></a>01541                         <span class="keywordflow">if</span>(ntype&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a3da81e6afe79d9cbe4361ebb7d099172">CFBndMoving</a>) {
<a name="l01542"></a>01542                             <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a2f910c532f4d286bf6068f83f23adaf6">OBJVEL_CALC</a>;
<a name="l01543"></a>01543                             
<a name="l01544"></a>01544                             <span class="comment">// compute fluid acceleration</span>
<a name="l01545"></a>01545                             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l01546"></a>01546                                 <span class="keywordflow">if</span>(rflagnb[l]&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) { 
<a name="l01547"></a>01547                                     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> ux = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]*objvel[0];
<a name="l01548"></a>01548                                     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> uy = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]*objvel[1];
<a name="l01549"></a>01549                                     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> uz = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]*objvel[2];
<a name="l01550"></a>01550 
<a name="l01551"></a>01551                                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> factor = 2. * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a002d8d48f62d78a83487f8d356c33cd7">dfLength</a>[l] * 3.0 * (ux+uy+uz); <span class="comment">// </span>
<a name="l01552"></a>01552                                     <span class="keywordflow">if</span>(ntype&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a84c56ca01be582fbb8ee0b2bef93b162">CFBndFreeslip</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a41f6a5ce6d232424fccaea0c8f9b7816">CFBndPartslip</a>)) {
<a name="l01553"></a>01553                                         <span class="comment">// missing, diag mass checks...</span>
<a name="l01554"></a>01554                                         <span class="comment">//if(l&lt;=LBMDIM*2) factor *= 1.4142;</span>
<a name="l01555"></a>01555                                         factor *= 2.0; <span class="comment">// TODO, optimize</span>
<a name="l01556"></a>01556                                     } <span class="keywordflow">else</span> {
<a name="l01557"></a>01557                                         factor *= 1.2; <span class="comment">// TODO, optimize</span>
<a name="l01558"></a>01558                                     }
<a name="l01559"></a>01559                                     factor *= impactCorrFactor; <span class="comment">// use manual tweaking channel</span>
<a name="l01560"></a>01560                                     <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,l) = factor;
<a name="l01561"></a>01561                                     massCheck += factor;
<a name="l01562"></a>01562                                 } <span class="keywordflow">else</span> {
<a name="l01563"></a>01563                                     <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,l) = 0.;
<a name="l01564"></a>01564                                 }
<a name="l01565"></a>01565                             }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567 <span class="preprocessor">#if NEWDIRVELMOTEST==1</span>
<a name="l01568"></a>01568 <span class="preprocessor"></span>                            <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,l) = 0.; }
<a name="l01569"></a>01569                             <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,<a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>)  = objvel[0];
<a name="l01570"></a>01570                             <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,<a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) = objvel[1];
<a name="l01571"></a>01571                             <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,<a class="code" href="../../d1/d24/solver__class_8h.html#acc5ec578ced5d032234e83703b4b352a">dC</a>)     = objvel[2];
<a name="l01572"></a>01572 <span class="preprocessor">#endif // NEWDIRVELMOTEST==1</span>
<a name="l01573"></a>01573 <span class="preprocessor"></span>                        } <span class="keywordflow">else</span> {
<a name="l01574"></a>01574                             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell,l) = 0.0; }
<a name="l01575"></a>01575                         }
<a name="l01576"></a>01576                         <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(dstCell, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>) = targetTime;
<a name="l01577"></a>01577                         <span class="comment">//errMsg(&quot;initMovingObstacles_Debug&quot;,&quot;OId&quot;&lt;&lt;OId&lt;&lt;&quot; n&quot;&lt;&lt;n&lt;&lt;&quot; -&gt; &quot;&lt;&lt;PRINT_IJK&quot; dflt=&quot;&lt;&lt;RAC(dstCell, dFlux) );</span>
<a name="l01578"></a>01578                         monObsts++;
<a name="l01579"></a>01579                     } <span class="comment">// points</span>
<a name="l01580"></a>01580                 } <span class="comment">// bnd, is active?</span>
<a name="l01581"></a>01581 
<a name="l01582"></a>01582                 <span class="comment">// second pass, remove old ones</span>
<a name="l01583"></a>01583                 <span class="comment">// warning - initEmptyCell et. al dont overwrite OId or persist flags...</span>
<a name="l01584"></a>01584                 <span class="keywordflow">if</span>(wasActive) {
<a name="l01585"></a>01585                     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>.size(); n++) {
<a name="l01586"></a>01586                         <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad006c8b3ea6d5d1df2b89e8222f0adad">mMOIVerticesOld</a>,n);
<a name="l01587"></a>01587                         monPoints++;
<a name="l01588"></a>01588                         <span class="keywordflow">if</span>((<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) == otype) &amp;&amp;
<a name="l01589"></a>01589                              (<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>) != targetTime)) {
<a name="l01590"></a>01590                             <span class="comment">// from mainloop</span>
<a name="l01591"></a>01591                             nbored = 0;
<a name="l01592"></a>01592                             <span class="comment">// TODO: optimize for OPT3D==0</span>
<a name="l01593"></a>01593                             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l01594"></a>01594                                 <span class="comment">//rflagnb[l] = RFLAG_NB(level, i,j,k,workSet,l);</span>
<a name="l01595"></a>01595                                 rflagnb[l] = <a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,otherSet,l); <span class="comment">// test use other set to not have loop dependance</span>
<a name="l01596"></a>01596                                 nbored |= rflagnb[l];
<a name="l01597"></a>01597                             } 
<a name="l01598"></a>01598                             <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> settype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01599"></a>01599                             <span class="keywordflow">if</span>(nbored&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) {
<a name="l01600"></a>01600                                 settype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#adce131aad1a8841dc1a68b7df4b1d828">CFNoInterpolSrc</a>; 
<a name="l01601"></a>01601                                 rhomass = 1.5;
<a name="l01602"></a>01602                                 <span class="keywordflow">if</span>(!fillCells) rhomass = 0.;
<a name="l01603"></a>01603 
<a name="l01604"></a>01604                                 <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a2f910c532f4d286bf6068f83f23adaf6">OBJVEL_CALC</a>;
<a name="l01605"></a>01605                                 <span class="keywordflow">if</span>(!(nbored&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) { settype=CFFluid|<a class="code" href="../../d2/d3c/solver__interface_8h.html#adce131aad1a8841dc1a68b7df4b1d828">CFNoInterpolSrc</a>; rhomass=1.; }
<a name="l01606"></a>01606 
<a name="l01607"></a>01607                                 <span class="comment">// new interpolate values</span>
<a name="l01608"></a>01608                                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> avgrho = 0.0;
<a name="l01609"></a>01609                                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> avgux = 0.0, avguy = 0.0, avguz = 0.0;
<a name="l01610"></a>01610                                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a95e2dca112073efe75e5855afccf8dc1" title="interpolate velocity and density at a given position">interpolateCellValues</a>(level,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet, avgrho,avgux,avguy,avguz);
<a name="l01611"></a>01611                                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, settype, avgrho, rhomass, <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(avgux,avguy,avguz) );
<a name="l01612"></a>01612                                 <span class="comment">//errMsg(&quot;NMOCIT&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; &quot;&lt;&lt;avgrho&lt;&lt;&quot; &quot;&lt;&lt;norm(LbmVec(avgux,avguy,avguz))&lt;&lt;&quot; &quot;&lt;&lt;LbmVec(avgux,avguy,avguz) );</span>
<a name="l01613"></a>01613                                 massCheck += rhomass;
<a name="l01614"></a>01614                             } <span class="keywordflow">else</span> {
<a name="l01615"></a>01615                                 settype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>; rhomass = 0.0;
<a name="l01616"></a>01616                                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, settype, 1., rhomass );
<a name="l01617"></a>01617                             }
<a name="l01618"></a>01618                             monFluids++;
<a name="l01619"></a>01619                             massReinits++;
<a name="l01620"></a>01620                         } <span class="comment">// flag &amp; simtime</span>
<a name="l01621"></a>01621                     }
<a name="l01622"></a>01622                 }  <span class="comment">// wasactive</span>
<a name="l01623"></a>01623 
<a name="l01624"></a>01624                 <span class="comment">// only compute mass transfer when init is done</span>
<a name="l01625"></a>01625                 <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a0cb712be00a6c0fe651a2798abe4ab88">mInitDone</a>) {
<a name="l01626"></a>01626                     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;initMov&quot;</span>,<span class="stringliteral">&quot;dccd\n\nMassd test &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; dccd massCheck=&quot;</span>&lt;&lt;massCheck&lt;&lt;<span class="stringliteral">&quot; massReinits&quot;</span>&lt;&lt;massReinits&lt;&lt;
<a name="l01627"></a>01627                         <span class="stringliteral">&quot; fillCells&quot;</span>&lt;&lt;fillCells&lt;&lt;<span class="stringliteral">&quot; massmovbnd:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aed4465d269c7fe5bfe360d3fb443f201" title="moving object mass boundary condition values">mObjectMassMovnd</a>[OId]&lt;&lt;<span class="stringliteral">&quot; inim:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> ); 
<a name="l01628"></a>01628                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aed4465d269c7fe5bfe360d3fb443f201" title="moving object mass boundary condition values">mObjectMassMovnd</a>[OId] += massCheck;
<a name="l01629"></a>01629                 }
<a name="l01630"></a>01630             } <span class="comment">// bnd, active</span>
<a name="l01631"></a>01631 
<a name="l01632"></a>01632             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ntype&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>){
<a name="l01633"></a>01633                 <span class="comment">// second static init pass</span>
<a name="l01634"></a>01634                 <span class="keywordflow">if</span>(staticInit) {
<a name="l01635"></a>01635                     <span class="comment">//debMsgStd(&quot;LbmFsgrSolver::initMovingObstacles&quot;,DM_MSG,&quot; obj &quot;&lt;&lt;obj-&gt;getName()&lt;&lt;&quot; verts&quot;&lt;&lt;mMOIVertices.size() ,9);</span>
<a name="l01636"></a>01636                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> setflflag = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>; <span class="comment">//|(OId&lt;&lt;24);</span>
<a name="l01637"></a>01637                     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(); n++) {
<a name="l01638"></a>01638                         <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,n);
<a name="l01639"></a>01639                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a4329fc9838ec0a7bc80d0631dfd91289">CFMbndInflow</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>)){ <span class="keywordflow">continue</span>; }
<a name="l01640"></a>01640                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) {
<a name="l01641"></a>01641                             <span class="comment">//changeFlag(level, i,j,k, workSet, setflflag);</span>
<a name="l01642"></a>01642                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, setflflag, 1., 1., <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId] );
<a name="l01643"></a>01643                         } 
<a name="l01644"></a>01644                         <span class="comment">//else if(RFLAG(level, i,j,k, workSet)&amp;(CFFluid|CFInter)) { changeFlag(level, i,j,k, workSet, RFLAG(level, i,j,k, workSet)|set2Flag); }</span>
<a name="l01645"></a>01645                     }
<a name="l01646"></a>01646                 } <span class="comment">// second static inflow pass</span>
<a name="l01647"></a>01647             } <span class="comment">// fluid</span>
<a name="l01648"></a>01648 
<a name="l01649"></a>01649             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ntype&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a4329fc9838ec0a7bc80d0631dfd91289">CFMbndInflow</a>){
<a name="l01650"></a>01650                 <span class="comment">// inflow pass - add new fluid cells</span>
<a name="l01651"></a>01651                 <span class="comment">// this is slightly different for standing inflows,</span>
<a name="l01652"></a>01652                 <span class="comment">// as the fluid is forced to the desired velocity inside as </span>
<a name="l01653"></a>01653                 <span class="comment">// well...</span>
<a name="l01654"></a>01654                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> iniRho = 1.0;
<a name="l01655"></a>01655                 <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> vel(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId]);
<a name="l01656"></a>01656                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> usqr = (vel[0]*vel[0]+vel[1]*vel[1]+vel[2]*vel[2])*1.5;
<a name="l01657"></a>01657                 <a class="code" href="../../d2/d75/solver__relax_8h.html#a1cfc8e7aa3da03d8b8eab3e1a93fc02d">USQRMAXCHECK</a>(usqr,vel[0],vel[1],vel[2], <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a52300efb79ae97f755da53d66026db05">mMaxVlen</a>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8df9c9df85b54438a6f3beb7ad470307" title="track max. velocity">mMxvx</a>,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a00506d50238e68b4a916c33de9d5b82d">mMxvy</a>,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a97efbfafd441bc2c300f38618356bec0">mMxvz</a>);
<a name="l01658"></a>01658                 <span class="comment">//errMsg(&quot;LbmFsgrSolver::initMovingObstacles&quot;,&quot;id&quot;&lt;&lt;OId&lt;&lt;&quot; &quot;&lt;&lt;obj-&gt;getName()&lt;&lt;&quot; inflow &quot;&lt;&lt;staticInit&lt;&lt;&quot; &quot;&lt;&lt;mMOIVertices.size() );</span>
<a name="l01659"></a>01659                 
<a name="l01660"></a>01660                 <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(); n++) {
<a name="l01661"></a>01661                     <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,n);
<a name="l01662"></a>01662                     <span class="comment">// TODO - also reinit interface cells !?</span>
<a name="l01663"></a>01663                     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)!=<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>) { 
<a name="l01664"></a>01664                         <span class="comment">// test prevent particle gen for inflow inter cells</span>
<a name="l01665"></a>01665                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) { <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) &amp;= (~<a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>); } <span class="comment">// remove CFNoBndFluid flag</span>
<a name="l01666"></a>01666                         <span class="keywordflow">continue</span>; }
<a name="l01667"></a>01667                     monFluids++;
<a name="l01668"></a>01668 
<a name="l01669"></a>01669                     <span class="comment">// TODO add OPT3D treatment</span>
<a name="l01670"></a>01670                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *tcel = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet);
<a name="l01671"></a>01671                     <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> { <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, l) = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a25c5045bdb65c365067fbe6ca53a35a5">getCollideEq</a>(l, iniRho,vel[0],vel[1],vel[2]); }
<a name="l01672"></a>01672                     <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) = <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) = iniRho;
<a name="l01673"></a>01673                     <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>) = <a class="code" href="../../d1/d24/solver__class_8h.html#a604e06bc4a635aac711c4d0b29dfa1ef">FLUX_INIT</a>;
<a name="l01674"></a>01674                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> setFlag = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>;
<a name="l01675"></a>01675                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1b0d31e6800625d63b6bd0423216c4f4">changeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, setFlag);
<a name="l01676"></a>01676                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> += iniRho;
<a name="l01677"></a>01677                 }
<a name="l01678"></a>01678                 <span class="comment">// second static init pass</span>
<a name="l01679"></a>01679                 <span class="keywordflow">if</span>(staticInit) {
<a name="l01680"></a>01680                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> set2Flag = CFMbndInflow|(OId&lt;&lt;24);
<a name="l01681"></a>01681                     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(); n++) {
<a name="l01682"></a>01682                         <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,n);
<a name="l01683"></a>01683                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(CFMbndInflow|<a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>)){ <span class="keywordflow">continue</span>; }
<a name="l01684"></a>01684                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) {
<a name="l01685"></a>01685                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a005ba763cb3d9b20d0342e46468d5dfa">forceChangeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, set2Flag);
<a name="l01686"></a>01686                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(CFFluid|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {
<a name="l01687"></a>01687                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a005ba763cb3d9b20d0342e46468d5dfa">forceChangeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, 
<a name="l01688"></a>01688                                     (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a9591bf74e6adf7af795aa16de41de2cd">CFNoPersistMask</a>)|set2Flag);
<a name="l01689"></a>01689                         }
<a name="l01690"></a>01690                     }
<a name="l01691"></a>01691                 } <span class="comment">// second static inflow pass</span>
<a name="l01692"></a>01692 
<a name="l01693"></a>01693             } <span class="comment">// inflow</span>
<a name="l01694"></a>01694 
<a name="l01695"></a>01695             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ntype&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>){
<a name="l01696"></a>01696                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> iniRho = 0.0;
<a name="l01697"></a>01697                 <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(); n++) {
<a name="l01698"></a>01698                     <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,n);
<a name="l01699"></a>01699                     <span class="comment">// FIXME check fluid/inter cells for non-static!?</span>
<a name="l01700"></a>01700                     <span class="keywordflow">if</span>(!(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(CFFluid|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>))) {
<a name="l01701"></a>01701                         <span class="keywordflow">if</span>((staticInit)&amp;&amp;(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)==<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) {
<a name="l01702"></a>01702                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a005ba763cb3d9b20d0342e46468d5dfa">forceChangeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, CFMbndOutflow); }
<a name="l01703"></a>01703                         <span class="keywordflow">continue</span>;
<a name="l01704"></a>01704                     }
<a name="l01705"></a>01705                     monFluids++;
<a name="l01706"></a>01706                     <span class="comment">// interface cell - might be double empty? FIXME check?</span>
<a name="l01707"></a>01707 
<a name="l01708"></a>01708                     <span class="comment">// remove fluid cells, shouldnt be here anyway</span>
<a name="l01709"></a>01709                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *tcel = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet);
<a name="l01710"></a>01710                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> fluidRho = <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel,0); <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { fluidRho += <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel,l); }
<a name="l01711"></a>01711                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cc016bc016cfca6a6e43801c066f7e">mInitialMass</a> -= fluidRho;
<a name="l01712"></a>01712                     <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) = <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) = iniRho;
<a name="l01713"></a>01713                     <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>) = <a class="code" href="../../d1/d24/solver__class_8h.html#a604e06bc4a635aac711c4d0b29dfa1ef">FLUX_INIT</a>;
<a name="l01714"></a>01714                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> setFlag = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>;
<a name="l01715"></a>01715                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1b0d31e6800625d63b6bd0423216c4f4">changeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, setFlag);
<a name="l01716"></a>01716 
<a name="l01717"></a>01717                     <span class="comment">// same as ifemptied for if below</span>
<a name="l01718"></a>01718                     <a class="code" href="../../d0/df9/structLbmPoint.html">LbmPoint</a> emptyp;
<a name="l01719"></a>01719                     emptyp.<a class="code" href="../../d0/df9/structLbmPoint.html#aabaaed0f34d022011b5ac3a255d1fd5d">x</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; emptyp.<a class="code" href="../../d0/df9/structLbmPoint.html#a516f69ea1f2d509eac6d931df4d2a019">y</a> = j; emptyp.<a class="code" href="../../d0/df9/structLbmPoint.html#a67c07375508ee8912bcae570493faca0">z</a> = k;
<a name="l01720"></a>01720                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7a025e0bbd9f5798f20ed9d302f362f9" title="list of the cells to empty at the end of the step">mListEmpty</a>.push_back( emptyp );
<a name="l01721"></a>01721                     <span class="comment">//calcCellsEmptied++;</span>
<a name="l01722"></a>01722                 } <span class="comment">// points</span>
<a name="l01723"></a>01723                 <span class="comment">// second static init pass</span>
<a name="l01724"></a>01724                 <span class="keywordflow">if</span>(staticInit) {
<a name="l01725"></a>01725                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> set2Flag = CFMbndOutflow|(OId&lt;&lt;24);
<a name="l01726"></a>01726                     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>.size(); n++) {
<a name="l01727"></a>01727                         <a class="code" href="../../d8/dd5/solver__init_8cpp.html#a3f8c6a02fe48400d029f3e7bab16065f">POS2GRID_CHECK</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd1fed8bb6496c8368a6c0560edbb45e" title="permanent movobj vert storage">mMOIVertices</a>,n);
<a name="l01728"></a>01728                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(CFMbndInflow|CFMbndOutflow)){ <span class="keywordflow">continue</span>; }
<a name="l01729"></a>01729                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) {
<a name="l01730"></a>01730                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a005ba763cb3d9b20d0342e46468d5dfa">forceChangeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, set2Flag);
<a name="l01731"></a>01731                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(CFFluid|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {
<a name="l01732"></a>01732                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a005ba763cb3d9b20d0342e46468d5dfa">forceChangeFlag</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, 
<a name="l01733"></a>01733                                     (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a9591bf74e6adf7af795aa16de41de2cd">CFNoPersistMask</a>)|set2Flag);
<a name="l01734"></a>01734                         }
<a name="l01735"></a>01735                     }
<a name="l01736"></a>01736                 } <span class="comment">// second static outflow pass</span>
<a name="l01737"></a>01737             } <span class="comment">// outflow</span>
<a name="l01738"></a>01738 
<a name="l01739"></a>01739         } <span class="comment">// allbound check</span>
<a name="l01740"></a>01740     } <span class="comment">// OId</span>
<a name="l01741"></a>01741 
<a name="l01742"></a>01742 
<a name="l01743"></a>01743     <span class="comment">/* { // DEBUG check</span>
<a name="l01744"></a>01744 <span class="comment">        int workSet = mLevel[level].setCurr;</span>
<a name="l01745"></a>01745 <span class="comment">        FSGR_FORIJK1(level) {</span>
<a name="l01746"></a>01746 <span class="comment">            if( (RFLAG(level,i,j,k, workSet) &amp; CFBndMoving) ) {</span>
<a name="l01747"></a>01747 <span class="comment">                if(QCELL(level, i,j,k, workSet, dFlux)!=targetTime) {</span>
<a name="l01748"></a>01748 <span class="comment">                    errMsg(&quot;lastt&quot;,&quot; old val!? at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; t=&quot;&lt;&lt;QCELL(level, i,j,k, workSet, dFlux)&lt;&lt;&quot; target=&quot;&lt;&lt;targetTime);</span>
<a name="l01749"></a>01749 <span class="comment">                }</span>
<a name="l01750"></a>01750 <span class="comment">            }</span>
<a name="l01751"></a>01751 <span class="comment">        }</span>
<a name="l01752"></a>01752 <span class="comment">    } // DEBUG */</span>
<a name="l01753"></a>01753     
<a name="l01754"></a>01754 <span class="preprocessor">#undef POS2GRID_CHECK</span>
<a name="l01755"></a>01755 <span class="preprocessor"></span>    <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> monend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l01756"></a>01756     <span class="keywordflow">if</span>(monend-monstart&gt;0) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initMovingObstacles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Total: &quot;</span>&lt;&lt;monTotal&lt;&lt;<span class="stringliteral">&quot; Points :&quot;</span>&lt;&lt;monPoints&lt;&lt;<span class="stringliteral">&quot; ObstInits:&quot;</span>&lt;&lt;monObsts&lt;&lt;<span class="stringliteral">&quot; FlInits:&quot;</span>&lt;&lt;monFluids&lt;&lt;<span class="stringliteral">&quot; Trafos:&quot;</span>&lt;&lt;monTotal&lt;&lt;<span class="stringliteral">&quot;, took &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(monend-monstart), 7);
<a name="l01757"></a>01757     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa257ddf3865c461af52dcdd20f8ff955">mLastSimTime</a> = targetTime;
<a name="l01758"></a>01758 }
<a name="l01759"></a>01759 
<a name="l01760"></a>01760 
<a name="l01761"></a>01761 <span class="comment">// geoinit position</span>
<a name="l01762"></a>01762 
<a name="l01763"></a><a class="code" href="../../d8/dd5/solver__init_8cpp.html#ae2b3ba6adcca405cd9ae9afc67e1ae9c">01763</a> <span class="preprocessor">#define GETPOS(i,j,k)  \</span>
<a name="l01764"></a>01764 <span class="preprocessor">    ntlVec3Gfx ggpos = \</span>
<a name="l01765"></a>01765 <span class="preprocessor">        ntlVec3Gfx( iniPos[0]+ dvec[0]*(gfxReal)(i), \</span>
<a name="l01766"></a>01766 <span class="preprocessor">                      iniPos[1]+ dvec[1]*(gfxReal)(j), \</span>
<a name="l01767"></a>01767 <span class="preprocessor">                      iniPos[2]+ dvec[2]*(gfxReal)(k) ); \</span>
<a name="l01768"></a>01768 <span class="preprocessor">  if((LBMDIM==2)&amp;&amp;(mInit2dYZ)) { SWAPYZ(ggpos); }</span>
<a name="l01769"></a>01769 <span class="preprocessor"></span>
<a name="l01770"></a>01770 <span class="comment">/*****************************************************************************/</span>
<a name="l01772"></a>01772 <span class="comment">/*****************************************************************************/</span>
<a name="l01773"></a>01773 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/dd5/solver__init_8cpp.html#ad1c3966def6cd34a97765a3bb4570fb7">globGeoInitDebug</a>; <span class="comment">//solver_interface</span>
<a name="l01774"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a16faa722e02f903477984bfd3937e215">01774</a> <span class="keywordtype">bool</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a16faa722e02f903477984bfd3937e215" title="perform geometry init (if switched on)">LbmFsgrSolver::initGeometryFlags</a>() {
<a name="l01775"></a>01775     <span class="keywordtype">int</span> level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01776"></a>01776     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> geotimestart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l01777"></a>01777     <a class="code" href="../../df/dc9/classntlGeometryObject.html">ntlGeometryObject</a> *pObj;
<a name="l01778"></a>01778     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dvec = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].nodeSize); <span class="comment">//dvec*1.0;</span>
<a name="l01779"></a>01779     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initGeometryFlags&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Performing geometry init (&quot;</span>&lt;&lt; <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9baab5805b5a1e6717c7589dab64684c">mLbmInitId</a> &lt;&lt;<span class="stringliteral">&quot;) v&quot;</span>&lt;&lt;dvec,3);
<a name="l01780"></a>01780     <span class="comment">// WARNING - copied to movobj init!</span>
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     <span class="comment">/* init object velocities, this has always to be called for init */</span>
<a name="l01783"></a>01783     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a40c230cabaef441a962d741afdc6b09d">initGeoTree</a>();
<a name="l01784"></a>01784     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a2cc6fbed55bf09db6db2d9489f55ccaa">mAllfluid</a>) { 
<a name="l01785"></a>01785         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9899e75fc2df7ed2091fec9c2490909f">freeGeoTree</a>();
<a name="l01786"></a>01786         <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     <span class="comment">// make sure moving obstacles are inited correctly</span>
<a name="l01789"></a>01789     <span class="comment">// preinit moving obj points</span>
<a name="l01790"></a>01790     <span class="keywordtype">int</span> numobjs = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>-&gt;size());
<a name="l01791"></a>01791     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> o=0; o&lt;numobjs; o++) {
<a name="l01792"></a>01792         <a class="code" href="../../df/dc9/classntlGeometryObject.html">ntlGeometryObject</a> *obj = (*mpGiObjects)[o];
<a name="l01793"></a>01793         <span class="comment">//debMsgStd(&quot;LbmFsgrSolver::initMovingObstacles&quot;,DM_MSG,&quot; obj &quot;&lt;&lt;obj-&gt;getName()&lt;&lt;&quot; type &quot;&lt;&lt;obj-&gt;getGeoInitType()&lt;&lt;&quot; anim&quot;&lt;&lt;obj-&gt;getIsAnimated()&lt;&lt;&quot; &quot;&lt;&lt;obj-&gt;getVolumeInit() ,9);</span>
<a name="l01794"></a>01794         <span class="keywordflow">if</span>(
<a name="l01795"></a>01795                 ((obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>()&amp;<a class="code" href="../../d8/d00/elbeem_8h.html#a45da565376c7544c990b8b2f8771d213">FGI_ALLBOUNDS</a>) &amp;&amp; (obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>())) ||
<a name="l01796"></a>01796                 (obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab638f219a521b8b19e8bddff347d17b8">getVolumeInit</a>()&amp;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#aadbad63b419747cf5182366ca4a231c0">VOLUMEINIT_SHELL</a>) ) {
<a name="l01797"></a>01797             <span class="keywordflow">if</span>(!obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">getMeshAnimated</a>()) { 
<a name="l01798"></a>01798                 <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initMovingObstacles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot; obj &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; type &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>()&lt;&lt;<span class="stringliteral">&quot; anim&quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>()&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab638f219a521b8b19e8bddff347d17b8">getVolumeInit</a>() ,9);
<a name="l01799"></a>01799                 obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a05010070584e1d1a5c5cebc5791b3c26">initMovingPoints</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].nodeSize);
<a name="l01800"></a>01800             }
<a name="l01801"></a>01801         }
<a name="l01802"></a>01802     }
<a name="l01803"></a>01803 
<a name="l01804"></a>01804     <span class="comment">// max speed init</span>
<a name="l01805"></a>01805     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> maxMovobjVelRw = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a08af2e011096d92886ef84154cc61f38">getGeoMaxMovementVelocity</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>() );
<a name="l01806"></a>01806     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> maxMovobjVel = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a6876e6f7f70128c9e931df8dffbf53da">calculateLattVelocityFromRw</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3354c71d4798004f2f6962993794ee76">vec2P</a>( maxMovobjVelRw )) );
<a name="l01807"></a>01807     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#aa8f0eaa100c08ad87f62d869477a7d26">setSimulationMaxSpeed</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(maxMovobjVel) + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].gravity) );
<a name="l01808"></a>01808     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> allowMax = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#adabdfa5ad1fdaae5517c0610c4a67c46">getTadapMaxSpeed</a>();  <span class="comment">// maximum allowed velocity</span>
<a name="l01809"></a>01809     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initGeometryFlags&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Maximum Velocity from geo init=&quot;</span>&lt;&lt; maxMovobjVel &lt;&lt;<span class="stringliteral">&quot; from mov. obj.=&quot;</span>&lt;&lt;maxMovobjVelRw&lt;&lt;<span class="stringliteral">&quot; , allowed Max=&quot;</span>&lt;&lt;allowMax ,5);
<a name="l01810"></a>01810     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a352a07d62c218dc7e8f8ce6526c752c2">getSimulationMaxSpeed</a>() &gt; allowMax) {
<a name="l01811"></a>01811         <span class="comment">// similar to adaptTimestep();</span>
<a name="l01812"></a>01812         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nextmax = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a352a07d62c218dc7e8f8ce6526c752c2">getSimulationMaxSpeed</a>();
<a name="l01813"></a>01813         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> newdt = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>() * (allowMax / nextmax); <span class="comment">// newtr</span>
<a name="l01814"></a>01814         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initGeometryFlags&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Performing reparametrization, newdt=&quot;</span>&lt;&lt; newdt&lt;&lt;<span class="stringliteral">&quot; prevdt=&quot;</span>&lt;&lt; <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>() &lt;&lt;<span class="stringliteral">&quot; &quot;</span>,5);
<a name="l01815"></a>01815         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a09d065df07cd4e772f9ae8bfffa1b0b6">setDesiredTimestep</a>( newdt );
<a name="l01816"></a>01816         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ae56423aa4fc6327fdbbc79f1b0ea959f">calculateAllMissingValues</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#aee34210942d51f7babe9ad9d367e350f" title="debug output?">mSilent</a> );
<a name="l01817"></a>01817         maxMovobjVel = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>( <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a6876e6f7f70128c9e931df8dffbf53da">calculateLattVelocityFromRw</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3354c71d4798004f2f6962993794ee76">vec2P</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a08af2e011096d92886ef84154cc61f38">getGeoMaxMovementVelocity</a>(
<a name="l01818"></a>01818                               <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>, <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>() )) ));
<a name="l01819"></a>01819         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initGeometryFlags&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;New maximum Velocity from geo init=&quot;</span>&lt;&lt; maxMovobjVel,5);
<a name="l01820"></a>01820     }
<a name="l01821"></a>01821     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a82c5192861cccab2c23bb463a6b200ff" title="init mObjectSpeeds for current parametrization">recalculateObjectSpeeds</a>();
<a name="l01822"></a>01822     <span class="comment">// */</span>
<a name="l01823"></a>01823 
<a name="l01824"></a>01824     <span class="comment">// init obstacles for first time step (requires obj speeds)</span>
<a name="l01825"></a>01825     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a6afefacd79094e4c5fb6a3073145bcf3" title="init moving obstacles for next sim step sim">initMovingObstacles</a>(<span class="keyword">true</span>);
<a name="l01826"></a>01826 
<a name="l01827"></a>01827     <span class="comment">/* set interface cells */</span>
<a name="l01828"></a>01828     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pos,iniPos; <span class="comment">// position of current cell</span>
<a name="l01829"></a>01829     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rhomass = 0.0;
<a name="l01830"></a>01830     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01831"></a>01831     <span class="keywordtype">int</span> savedNodes = 0;
<a name="l01832"></a>01832     <span class="keywordtype">int</span> OId = -1;
<a name="l01833"></a>01833     <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l01834"></a>01834 
<a name="l01835"></a>01835     <span class="comment">// 2d display as rectangles</span>
<a name="l01836"></a>01836     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l01837"></a>01837         dvec[2] = 0.0; 
<a name="l01838"></a>01838         iniPos =(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>( 0.0, 0.0, (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[2]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2])*0.5 ))+(dvec*0.5);
<a name="l01839"></a>01839         <span class="comment">//if(mInit2dYZ) { SWAPYZ(mGravity); for(int lev=0; lev&lt;=mMaxRefine; lev++){ SWAPYZ( mLevel[lev].gravity ); } }</span>
<a name="l01840"></a>01840     } <span class="keywordflow">else</span> {
<a name="l01841"></a>01841         iniPos =(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>( 0.0 ))+(dvec*0.5);
<a name="l01842"></a>01842     }
<a name="l01843"></a>01843 
<a name="l01844"></a>01844 
<a name="l01845"></a>01845     <span class="comment">// first init boundary conditions</span>
<a name="l01846"></a>01846     <span class="comment">// invalid cells are set to empty afterwards</span>
<a name="l01847"></a>01847     <span class="comment">// TODO use floop macros!?</span>
<a name="l01848"></a>01848     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(level); ++k) {
<a name="l01849"></a>01849         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++) {
<a name="l01850"></a>01850             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01851"></a>01851                 ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01852"></a>01852                 
<a name="l01853"></a>01853                 <a class="code" href="../../d8/dd5/solver__init_8cpp.html#ae2b3ba6adcca405cd9ae9afc67e1ae9c">GETPOS</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k);
<a name="l01854"></a>01854                 <span class="keyword">const</span> <span class="keywordtype">bool</span> inside = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a07db66516cc847d1ee83c55be457ce2b">geoInitCheckPointInside</a>( ggpos, <a class="code" href="../../d8/d00/elbeem_8h.html#a45da565376c7544c990b8b2f8771d213">FGI_ALLBOUNDS</a>, OId, distance);
<a name="l01855"></a>01855                 <span class="keywordflow">if</span>(inside) {
<a name="l01856"></a>01856                     pObj = (*mpGiObjects)[OId];
<a name="l01857"></a>01857                     <span class="keywordflow">switch</span>( pObj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>() ){
<a name="l01858"></a>01858                     <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a981c60c9f2725cfc951630cf070fc646">FGI_MBNDINFLOW</a>:  
<a name="l01859"></a>01859                       <span class="keywordflow">if</span>(! pObj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>() ) {
<a name="l01860"></a>01860                             rhomass = 1.0;
<a name="l01861"></a>01861                             ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a> | <a class="code" href="../../d2/d3c/solver__interface_8h.html#a4329fc9838ec0a7bc80d0631dfd91289">CFMbndInflow</a>;
<a name="l01862"></a>01862                         } <span class="keywordflow">else</span> {
<a name="l01863"></a>01863                             ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01864"></a>01864                         }
<a name="l01865"></a>01865                         <span class="keywordflow">break</span>;
<a name="l01866"></a>01866                     <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#ae440d9b224ab18a3429b1fcb1dabccc8">FGI_MBNDOUTFLOW</a>: 
<a name="l01867"></a>01867                       <span class="keywordflow">if</span>(! pObj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>() ) {
<a name="l01868"></a>01868                             rhomass = 0.0;
<a name="l01869"></a>01869                             ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>; 
<a name="l01870"></a>01870                         } <span class="keywordflow">else</span> {
<a name="l01871"></a>01871                             ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01872"></a>01872                         }
<a name="l01873"></a>01873                         <span class="keywordflow">break</span>;
<a name="l01874"></a>01874                     <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#ad0e7f1ed7626d8bd0701ec8f2e96aacd">FGI_BNDNO</a>: 
<a name="l01875"></a>01875                         rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01876"></a>01876                         ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a52169459320fac69e44404feaa0a340e">CFBndNoslip</a>; 
<a name="l01877"></a>01877                         <span class="keywordflow">break</span>;
<a name="l01878"></a>01878                     <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#adfd63685e07b3a05e15253ac1dd88c53">FGI_BNDPART</a>: 
<a name="l01879"></a>01879                         rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01880"></a>01880                         ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a41f6a5ce6d232424fccaea0c8f9b7816">CFBndPartslip</a>; <span class="keywordflow">break</span>;
<a name="l01881"></a>01881                     <span class="keywordflow">case</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a26267e2d9b47124e93188bb5e770524b">FGI_BNDFREE</a>: 
<a name="l01882"></a>01882                         rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01883"></a>01883                         ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a84c56ca01be582fbb8ee0b2bef93b162">CFBndFreeslip</a>; <span class="keywordflow">break</span>;
<a name="l01884"></a>01884                     <span class="keywordflow">default</span>: <span class="comment">// warn here?</span>
<a name="l01885"></a>01885                         rhomass = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l01886"></a>01886                         ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a52169459320fac69e44404feaa0a340e">CFBndNoslip</a>; <span class="keywordflow">break</span>;
<a name="l01887"></a>01887                     }
<a name="l01888"></a>01888                 }
<a name="l01889"></a>01889                 <span class="keywordflow">if</span>(ntype != <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>) {
<a name="l01890"></a>01890                     <span class="comment">// initDefaultCell</span>
<a name="l01891"></a>01891                     <span class="keywordflow">if</span>((ntype &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a4329fc9838ec0a7bc80d0631dfd91289">CFMbndInflow</a>) || (ntype &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#abbcc2b1313cb2b55a0a0bfe2ba51499d">CFMbndOutflow</a>) ) { }
<a name="l01892"></a>01892                     ntype |= (OId&lt;&lt;24); <span class="comment">// NEWTEST2</span>
<a name="l01893"></a>01893                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, ntype, rhomass, rhomass, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId] );
<a name="l01894"></a>01894                 }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896                 <span class="comment">// walk along x until hit for following inits</span>
<a name="l01897"></a>01897                 <span class="keywordflow">if</span>(distance&lt;=-1.0) { distance = 100.0; } <span class="comment">// FIXME dangerous</span>
<a name="l01898"></a>01898                 <span class="keywordflow">if</span>(distance&gt;=0.0) {
<a name="l01899"></a>01899                     <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> dcnt=dvec[0];
<a name="l01900"></a>01900                     <span class="keywordflow">while</span>(( dcnt&lt; distance-dvec[0] )&amp;&amp;(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizex-1)) {
<a name="l01901"></a>01901                         dcnt += dvec[0]; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++;
<a name="l01902"></a>01902                         savedNodes++;
<a name="l01903"></a>01903                         <span class="keywordflow">if</span>(ntype != <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>) {
<a name="l01904"></a>01904                             <span class="comment">// rho,mass,OId are still inited from above</span>
<a name="l01905"></a>01905                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, ntype, rhomass, rhomass, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId] );
<a name="l01906"></a>01906                         }
<a name="l01907"></a>01907                     }
<a name="l01908"></a>01908                 } 
<a name="l01909"></a>01909                 <span class="comment">// */</span>
<a name="l01910"></a>01910 
<a name="l01911"></a>01911             } 
<a name="l01912"></a>01912         } 
<a name="l01913"></a>01913     } <span class="comment">// zmax</span>
<a name="l01914"></a>01914     <span class="comment">// */</span>
<a name="l01915"></a>01915 
<a name="l01916"></a>01916     <span class="comment">// now init fluid layer</span>
<a name="l01917"></a>01917     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(level); ++k) {
<a name="l01918"></a>01918         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++) {
<a name="l01919"></a>01919             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01920"></a>01920                 <span class="keywordflow">if</span>(!(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr)==<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) <span class="keywordflow">continue</span>;
<a name="l01921"></a>01921                 ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>;
<a name="l01922"></a>01922                 <span class="keywordtype">int</span> inits = 0;
<a name="l01923"></a>01923                 <a class="code" href="../../d8/dd5/solver__init_8cpp.html#ae2b3ba6adcca405cd9ae9afc67e1ae9c">GETPOS</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k);
<a name="l01924"></a>01924                 <span class="keyword">const</span> <span class="keywordtype">bool</span> inside = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a07db66516cc847d1ee83c55be457ce2b">geoInitCheckPointInside</a>( ggpos, <a class="code" href="../../d8/d00/elbeem_8h.html#a51b010da5bd6ef1a80ad3b9a7be00e3a">FGI_FLUID</a>, OId, distance);
<a name="l01925"></a>01925                 <span class="keywordflow">if</span>(inside) {
<a name="l01926"></a>01926                     ntype = <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>;
<a name="l01927"></a>01927                 }
<a name="l01928"></a>01928                 <span class="keywordflow">if</span>(ntype != <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>) {
<a name="l01929"></a>01929                     <span class="comment">// initDefaultCell</span>
<a name="l01930"></a>01930                     rhomass = 1.0;
<a name="l01931"></a>01931                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, ntype, rhomass, rhomass, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId] );
<a name="l01932"></a>01932                     inits++;
<a name="l01933"></a>01933                 }
<a name="l01934"></a>01934 
<a name="l01935"></a>01935                 <span class="comment">// walk along x until hit for following inits</span>
<a name="l01936"></a>01936                 <span class="keywordflow">if</span>(distance&lt;=-1.0) { distance = 100.0; }
<a name="l01937"></a>01937                 <span class="keywordflow">if</span>(distance&gt;=0.0) {
<a name="l01938"></a>01938                     <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> dcnt=dvec[0];
<a name="l01939"></a>01939                     <span class="keywordflow">while</span>((dcnt&lt; distance )&amp;&amp;(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizex-1)) {
<a name="l01940"></a>01940                         dcnt += dvec[0]; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++;
<a name="l01941"></a>01941                         savedNodes++;
<a name="l01942"></a>01942                         <span class="keywordflow">if</span>(!(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr)==<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) <span class="keywordflow">continue</span>;
<a name="l01943"></a>01943                         <span class="keywordflow">if</span>(ntype != <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>) {
<a name="l01944"></a>01944                             <span class="comment">// rhomass are still inited from above</span>
<a name="l01945"></a>01945                             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, ntype, rhomass, rhomass, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[OId] );
<a name="l01946"></a>01946                             inits++;
<a name="l01947"></a>01947                         }
<a name="l01948"></a>01948                     }
<a name="l01949"></a>01949                 } <span class="comment">// distance&gt;0</span>
<a name="l01950"></a>01950                 
<a name="l01951"></a>01951             } 
<a name="l01952"></a>01952         } 
<a name="l01953"></a>01953     } <span class="comment">// zmax</span>
<a name="l01954"></a>01954 
<a name="l01955"></a>01955     <span class="comment">// reset invalid to empty again</span>
<a name="l01956"></a>01956     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(level); ++k) {
<a name="l01957"></a>01957         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++) {
<a name="l01958"></a>01958             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01959"></a>01959                 <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr)==<a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>) {
<a name="l01960"></a>01960                     <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setOther) = 
<a name="l01961"></a>01961                     <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr) = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>;
<a name="l01962"></a>01962                 }
<a name="l01963"></a>01963             }
<a name="l01964"></a>01964         }
<a name="l01965"></a>01965     }
<a name="l01966"></a>01966 
<a name="l01967"></a>01967     <a class="code" href="../../db/dff/classLbmSolverInterface.html#a9899e75fc2df7ed2091fec9c2490909f">freeGeoTree</a>();
<a name="l01968"></a>01968     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> geotimeend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l01969"></a>01969     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initGeometryFlags&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Geometry init done (&quot;</span>&lt;&lt; <a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(geotimeend-geotimestart)&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;savedNodes&lt;&lt;<span class="stringliteral">&quot;) &quot;</span> , 10 ); 
<a name="l01970"></a>01970     <span class="comment">//errMsg(&quot; SAVED &quot;,&quot; &quot;&lt;&lt;savedNodes&lt;&lt;&quot; of &quot;&lt;&lt;(mLevel[mMaxRefine].lSizex*mLevel[mMaxRefine].lSizey*mLevel[mMaxRefine].lSizez));</span>
<a name="l01971"></a>01971     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01972"></a>01972 }
<a name="l01973"></a>01973 
<a name="l01974"></a>01974 <span class="preprocessor">#undef GETPOS</span>
<a name="l01975"></a>01975 <span class="preprocessor"></span>
<a name="l01976"></a>01976 <span class="comment">/*****************************************************************************/</span>
<a name="l01977"></a>01977 <span class="comment">/* init part for all freesurface testcases */</span>
<a name="l01978"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a96c4b4fe659520095e9a66fa6739f62b">01978</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a96c4b4fe659520095e9a66fa6739f62b" title="init part for all freesurface testcases">LbmFsgrSolver::initFreeSurfaces</a>() {
<a name="l01979"></a>01979     <span class="keywordtype">double</span> interfaceFill = 0.45;   <span class="comment">// filling level of interface cells</span>
<a name="l01980"></a>01980     <span class="comment">//interfaceFill = 1.0; // DEUG!! GEOMTEST!!!!!!!!!!!!</span>
<a name="l01981"></a>01981 
<a name="l01982"></a>01982     <span class="comment">// set interface cells </span>
<a name="l01983"></a>01983     <a class="code" href="../../d1/d24/solver__class_8h.html#a1cd53306465fab36f6bc4c1d8ef9d291">FSGR_FORIJK1</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) {
<a name="l01984"></a>01984         <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a> )) {
<a name="l01985"></a>01985             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l01986"></a>01986                 <span class="keywordtype">int</span> ni=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l], nj=j+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l], nk=k+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l];
<a name="l01987"></a>01987                 <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, ni, nj, nk,  <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a> ) ) {
<a name="l01988"></a>01988                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> arho=0., aux=0., auy=0., auz=0.;
<a name="l01989"></a>01989                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a95e2dca112073efe75e5855afccf8dc1" title="interpolate velocity and density at a given position">interpolateCellValues</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, ni,nj,nk, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, arho,aux,auy,auz);
<a name="l01990"></a>01990                     <span class="comment">//errMsg(&quot;TINI&quot;,&quot; &quot;&lt;&lt;PRINT_VEC(ni,nj,nk)&lt;&lt;&quot; v&quot;&lt;&lt;LbmVec(aux,auy,auz) );</span>
<a name="l01991"></a>01991                     <span class="comment">// unnecessary? initEmptyCell(mMaxRefine, ni,nj,nk, CFInter, arho, interfaceFill);</span>
<a name="l01992"></a>01992                     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, ni,nj,nk, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>, arho, interfaceFill, <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(aux,auy,auz) );
<a name="l01993"></a>01993                 }
<a name="l01994"></a>01994             }
<a name="l01995"></a>01995         }
<a name="l01996"></a>01996     }
<a name="l01997"></a>01997 
<a name="l01998"></a>01998     <span class="comment">// remove invalid interface cells </span>
<a name="l01999"></a>01999     <a class="code" href="../../d1/d24/solver__class_8h.html#a1cd53306465fab36f6bc4c1d8ef9d291">FSGR_FORIJK1</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) {
<a name="l02000"></a>02000         <span class="comment">// remove invalid interface cells </span>
<a name="l02001"></a>02001         <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) ) {
<a name="l02002"></a>02002             <span class="keywordtype">int</span> delit = 0;
<a name="l02003"></a>02003             <span class="keywordtype">int</span> NBs = 0; <span class="comment">// neighbor flags or&#39;ed </span>
<a name="l02004"></a>02004             <span class="keywordtype">int</span> noEmptyNB = 1;
<a name="l02005"></a>02005 
<a name="l02006"></a>02006             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l02007"></a>02007                 <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a88aa5202b8731f9c3ac42fc4a8bf0d8c">RFLAG_NBINV</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr,l )&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a> ) ) {
<a name="l02008"></a>02008                     noEmptyNB = 0;
<a name="l02009"></a>02009                 }
<a name="l02010"></a>02010                 NBs |= <a class="code" href="../../d1/d24/solver__class_8h.html#a88aa5202b8731f9c3ac42fc4a8bf0d8c">RFLAG_NBINV</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, l);
<a name="l02011"></a>02011             }
<a name="l02012"></a>02012             <span class="comment">// remove cells with no fluid or interface neighbors</span>
<a name="l02013"></a>02013             <span class="keywordflow">if</span>((NBs &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>)==0) { delit = 1; }
<a name="l02014"></a>02014             <span class="keywordflow">if</span>((NBs &amp; CFInter)==0) { delit = 1; }
<a name="l02015"></a>02015             <span class="comment">// remove cells with no empty neighbors</span>
<a name="l02016"></a>02016             <span class="keywordflow">if</span>(noEmptyNB) { delit = 2; }
<a name="l02017"></a>02017 
<a name="l02018"></a>02018             <span class="comment">// now we can remove the cell </span>
<a name="l02019"></a>02019             <span class="keywordflow">if</span>(delit==1) {
<a name="l02020"></a>02020                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad6060e42a53b7ca7a271f0722f9ea5a8">initEmptyCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>, 1.0, 0.0);
<a name="l02021"></a>02021             }
<a name="l02022"></a>02022             <span class="keywordflow">if</span>(delit==2) {
<a name="l02023"></a>02023                 <span class="comment">//initEmptyCell(mMaxRefine, i,j,k, CFFluid, 1.0, 1.0);</span>
<a name="l02024"></a>02024                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> arho=0., aux=0., auy=0., auz=0.;
<a name="l02025"></a>02025                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a95e2dca112073efe75e5855afccf8dc1" title="interpolate velocity and density at a given position">interpolateCellValues</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, arho,aux,auy,auz);
<a name="l02026"></a>02026                 <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae57e52b22707458b3ce8238791fc2a89">initVelocityCell</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, CFFluid, arho,1., <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(aux,auy,auz) );
<a name="l02027"></a>02027             }
<a name="l02028"></a>02028         } <span class="comment">// interface </span>
<a name="l02029"></a>02029     } <span class="comment">// */</span>
<a name="l02030"></a>02030 
<a name="l02031"></a>02031     <span class="comment">// another brute force init, make sure the fill values are right...</span>
<a name="l02032"></a>02032     <span class="comment">// and make sure both sets are equal</span>
<a name="l02033"></a>02033     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l02034"></a>02034     <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) {
<a name="l02035"></a>02035         <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,0) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>)) ) { 
<a name="l02036"></a>02036             <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) = <a class="code" href="../../d1/d24/solver__class_8h.html#a7917dc04dfd1960cd80e59113e04bda8" title="fill value for boundary cells">BND_FILL</a>;
<a name="l02037"></a>02037             <span class="keywordflow">continue</span>;
<a name="l02038"></a>02038         }
<a name="l02039"></a>02039         <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,0) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) ) { 
<a name="l02040"></a>02040             <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) = 0.0;
<a name="l02041"></a>02041             <span class="keywordflow">continue</span>;
<a name="l02042"></a>02042         }
<a name="l02043"></a>02043     } }
<a name="l02044"></a>02044 
<a name="l02045"></a>02045     <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l02046"></a>02046     <span class="comment">// smoother surface...</span>
<a name="l02047"></a>02047     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a39c6380bbad6fcd49c9406379400d74e" title="smoother surface initialization?">mInitSurfaceSmoothing</a>&gt;0) {
<a name="l02048"></a>02048         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;Surface Smoothing init&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Performing &quot;</span>&lt;&lt;(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a39c6380bbad6fcd49c9406379400d74e" title="smoother surface initialization?">mInitSurfaceSmoothing</a>)&lt;&lt;<span class="stringliteral">&quot; smoothing timestep &quot;</span>,10);
<a name="l02049"></a>02049 <span class="preprocessor">#if COMPRESSGRIDS==1</span>
<a name="l02050"></a>02050 <span class="preprocessor"></span>        <span class="comment">//errFatal(&quot;NYI&quot;,&quot;COMPRESSGRIDS mInitSurfaceSmoothing&quot;,SIMWORLD_INITERROR); return;</span>
<a name="l02051"></a>02051 <span class="preprocessor">#endif // COMPRESSGRIDS==0</span>
<a name="l02052"></a>02052 <span class="preprocessor"></span>    }
<a name="l02053"></a>02053     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a39c6380bbad6fcd49c9406379400d74e" title="smoother surface initialization?">mInitSurfaceSmoothing</a>; s++) {
<a name="l02054"></a>02054         <span class="comment">//SGR_FORIJK1(mMaxRefine) {</span>
<a name="l02055"></a>02055 
<a name="l02056"></a>02056         <span class="keywordtype">int</span> kstart=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(), kend=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>);
<a name="l02057"></a>02057         <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l02058"></a>02058 <span class="preprocessor">#if COMPRESSGRIDS==0</span>
<a name="l02059"></a>02059 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=kstart;k&lt;kend;++k) {
<a name="l02060"></a>02060 <span class="preprocessor">#else // COMPRESSGRIDS==0</span>
<a name="l02061"></a>02061 <span class="preprocessor"></span>        <span class="keywordtype">int</span> kdir = 1; <span class="comment">// COMPRT ON</span>
<a name="l02062"></a>02062         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr==1) {
<a name="l02063"></a>02063             kdir = -1;
<a name="l02064"></a>02064             <span class="keywordtype">int</span> temp = kend;
<a name="l02065"></a>02065             kend = kstart-1;
<a name="l02066"></a>02066             kstart = temp-1;
<a name="l02067"></a>02067         } <span class="comment">// COMPRT</span>
<a name="l02068"></a>02068         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=kstart;k!=kend;k+=kdir) {
<a name="l02069"></a>02069 <span class="preprocessor">#endif // COMPRESSGRIDS==0</span>
<a name="l02070"></a>02070 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;++j) {
<a name="l02071"></a>02071         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l02072"></a>02072             <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) ) {
<a name="l02073"></a>02073                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> mass = 0.0;
<a name="l02074"></a>02074                 <span class="comment">//LbmFloat nbdiv;</span>
<a name="l02075"></a>02075                 <span class="comment">//FORDF0 {</span>
<a name="l02076"></a>02076                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0;(l&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>); l++) { 
<a name="l02077"></a>02077                     <span class="keywordtype">int</span> ni=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l], nj=j+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l], nk=k+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l];
<a name="l02078"></a>02078                     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, ni,nj,nk, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a> ){
<a name="l02079"></a>02079                         mass += 1.0;
<a name="l02080"></a>02080                     }
<a name="l02081"></a>02081                     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, ni,nj,nk, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a> ){
<a name="l02082"></a>02082                         mass += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, ni,nj,nk, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>);
<a name="l02083"></a>02083                     }
<a name="l02084"></a>02084                     <span class="comment">//nbdiv+=1.0;</span>
<a name="l02085"></a>02085                 }
<a name="l02086"></a>02086 
<a name="l02087"></a>02087                 <span class="comment">//errMsg(&quot; I &quot;, PRINT_IJK&lt;&lt;&quot; m&quot;&lt;&lt;mass );</span>
<a name="l02088"></a>02088                 <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setOther, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) = (mass/ ((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>) );
<a name="l02089"></a>02089                 <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setOther, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setOther, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>);
<a name="l02090"></a>02090             }
<a name="l02091"></a>02091         }}}
<a name="l02092"></a>02092 
<a name="l02093"></a>02093         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a969dc4eebe3ff743980e099cad72240a" title="target/other set of dist funcs">setOther</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l02094"></a>02094         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a> ^= 1;
<a name="l02095"></a>02095     }
<a name="l02096"></a>02096     <span class="comment">// copy back...?</span>
<a name="l02097"></a>02097 }
<a name="l02098"></a>02098 
<a name="l02099"></a>02099 <span class="comment">/*****************************************************************************/</span>
<a name="l02100"></a>02100 <span class="comment">/* init part for all freesurface testcases */</span>
<a name="l02101"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8473f131eb087826a9322f2923a30944">02101</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8473f131eb087826a9322f2923a30944" title="init density gradient if enabled">LbmFsgrSolver::initStandingFluidGradient</a>() {
<a name="l02102"></a>02102     <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l02103"></a>02103     <span class="comment">// standing fluid preinit</span>
<a name="l02104"></a>02104     <span class="keyword">const</span> <span class="keywordtype">int</span> debugStandingPreinit = 0;
<a name="l02105"></a>02105     <span class="keywordtype">int</span> haveStandingFluid = 0;
<a name="l02106"></a>02106 
<a name="l02107"></a>02107 <span class="preprocessor">#define STANDFLAGCHECK(iindex) \</span>
<a name="l02108"></a>02108 <span class="preprocessor">                if( ( (RFLAG(mMaxRefine,i,j,k,mLevel[mMaxRefine].setCurr) &amp; (CFInter)) ) || \</span>
<a name="l02109"></a>02109 <span class="preprocessor">                        ( (RFLAG(mMaxRefine,i,j,k,mLevel[mMaxRefine].setCurr) &amp; (CFEmpty)) ) ){  \</span>
<a name="l02110"></a>02110 <span class="preprocessor">                    if((iindex)&gt;1) { haveStandingFluid=(iindex); } \</span>
<a name="l02111"></a>02111 <span class="preprocessor">                    j = mLevel[mMaxRefine].lSizey; i=mLevel[mMaxRefine].lSizex; k=getForZMaxBnd(); \</span>
<a name="l02112"></a>02112 <span class="preprocessor">                    continue; \</span>
<a name="l02113"></a>02113 <span class="preprocessor">                } </span>
<a name="l02114"></a>02114 <span class="preprocessor"></span>    <span class="keywordtype">int</span> gravIndex[3] = {0,0,0};
<a name="l02115"></a>02115     <span class="keywordtype">int</span> gravDir[3] = {1,1,1};
<a name="l02116"></a>02116     <span class="keywordtype">int</span> maxGravComp = 1; <span class="comment">// by default y</span>
<a name="l02117"></a>02117     <span class="keywordtype">int</span> gravComp1 = 0; <span class="comment">// by default y</span>
<a name="l02118"></a>02118     <span class="keywordtype">int</span> gravComp2 = 2; <span class="comment">// by default y</span>
<a name="l02119"></a>02119     <span class="keywordflow">if</span>( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].gravity[0]) &gt; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].gravity[1]) ){ maxGravComp = 0; gravComp1=1; gravComp2=2; }
<a name="l02120"></a>02120     <span class="keywordflow">if</span>( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].gravity[2]) &gt; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].gravity[0]) ){ maxGravComp = 2; gravComp1=0; gravComp2=1; }
<a name="l02121"></a>02121 
<a name="l02122"></a>02122     <span class="keywordtype">int</span> gravIMin[3] = { 0 , 0 , 0 };
<a name="l02123"></a>02123     <span class="keywordtype">int</span> gravIMax[3] = {
<a name="l02124"></a>02124         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a> + 0,
<a name="l02125"></a>02125         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a> + 0,
<a name="l02126"></a>02126         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a> + 0 };
<a name="l02127"></a>02127     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) gravIMax[2] = 1;
<a name="l02128"></a>02128 
<a name="l02129"></a>02129     <span class="comment">//int gravDir = 1;</span>
<a name="l02130"></a>02130     <span class="keywordflow">if</span>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].gravity[maxGravComp] &gt; 0.0 ) {
<a name="l02131"></a>02131         <span class="comment">// swap directions</span>
<a name="l02132"></a>02132         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=maxGravComp;
<a name="l02133"></a>02133         <span class="keywordtype">int</span> tmp = gravIMin[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02134"></a>02134         gravIMin[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = gravIMax[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - 1;
<a name="l02135"></a>02135         gravIMax[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp - 1;
<a name="l02136"></a>02136         gravDir[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1;
<a name="l02137"></a>02137     }
<a name="l02138"></a>02138 <span class="preprocessor">#define PRINTGDIRS \</span>
<a name="l02139"></a>02139 <span class="preprocessor">    errMsg(&quot;Standing fp&quot;,&quot;X start=&quot;&lt;&lt;gravIMin[0]&lt;&lt;&quot; end=&quot;&lt;&lt;gravIMax[0]&lt;&lt;&quot; dir=&quot;&lt;&lt;gravDir[0] ); \</span>
<a name="l02140"></a>02140 <span class="preprocessor">    errMsg(&quot;Standing fp&quot;,&quot;Y start=&quot;&lt;&lt;gravIMin[1]&lt;&lt;&quot; end=&quot;&lt;&lt;gravIMax[1]&lt;&lt;&quot; dir=&quot;&lt;&lt;gravDir[1] ); \</span>
<a name="l02141"></a>02141 <span class="preprocessor">    errMsg(&quot;Standing fp&quot;,&quot;Z start=&quot;&lt;&lt;gravIMin[2]&lt;&lt;&quot; end=&quot;&lt;&lt;gravIMax[2]&lt;&lt;&quot; dir=&quot;&lt;&lt;gravDir[2] ); </span>
<a name="l02142"></a>02142 <span class="preprocessor"></span>    <span class="comment">// _PRINTGDIRS;</span>
<a name="l02143"></a>02143 
<a name="l02144"></a>02144     <span class="keywordtype">bool</span> gravAbort = <span class="keyword">false</span>;
<a name="l02145"></a>02145 <span class="preprocessor">#define GRAVLOOP \</span>
<a name="l02146"></a>02146 <span class="preprocessor">    gravAbort=false; \</span>
<a name="l02147"></a>02147 <span class="preprocessor">    for(gravIndex[2]= gravIMin[2];     (gravIndex[2]!=gravIMax[2])&amp;&amp;(!gravAbort);  gravIndex[2] += gravDir[2]) \</span>
<a name="l02148"></a>02148 <span class="preprocessor">        for(gravIndex[1]= gravIMin[1];   (gravIndex[1]!=gravIMax[1])&amp;&amp;(!gravAbort);  gravIndex[1] += gravDir[1]) \</span>
<a name="l02149"></a>02149 <span class="preprocessor">            for(gravIndex[0]= gravIMin[0]; (gravIndex[0]!=gravIMax[0])&amp;&amp;(!gravAbort);  gravIndex[0] += gravDir[0]) </span>
<a name="l02150"></a>02150 <span class="preprocessor"></span>
<a name="l02151"></a>02151     <a class="code" href="../../d8/dd5/solver__init_8cpp.html#acedd6f61f968df8e84b64abc0b5b004e">GRAVLOOP</a> {
<a name="l02152"></a>02152         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = gravIndex[0], j = gravIndex[1], k = gravIndex[2];
<a name="l02153"></a>02153         <span class="keywordflow">if</span>( ( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>,i,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) ) || 
<a name="l02154"></a>02154             ( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>,i,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a3da81e6afe79d9cbe4361ebb7d099172">CFBndMoving</a>)) ) || 
<a name="l02155"></a>02155                 ( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>,i,j,k,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) ) ) {  
<a name="l02156"></a>02156             <span class="keywordtype">int</span> fluidHeight = (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(gravIndex[maxGravComp] - gravIMin[maxGravComp]));
<a name="l02157"></a>02157             <span class="keywordflow">if</span>(debugStandingPreinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;Standing fp&quot;</span>,<span class="stringliteral">&quot;fh=&quot;</span>&lt;&lt;fluidHeight&lt;&lt;<span class="stringliteral">&quot; gmax=&quot;</span>&lt;&lt;gravIMax[maxGravComp]&lt;&lt;<span class="stringliteral">&quot; gi=&quot;</span>&lt;&lt;gravIndex[maxGravComp] );
<a name="l02158"></a>02158             <span class="keywordflow">if</span>(fluidHeight&gt;1) {
<a name="l02159"></a>02159                 haveStandingFluid = fluidHeight; <span class="comment">//gravIndex[maxGravComp]; </span>
<a name="l02160"></a>02160                 gravIMax[maxGravComp] = gravIndex[maxGravComp] + gravDir[maxGravComp];
<a name="l02161"></a>02161             }
<a name="l02162"></a>02162             gravAbort = <span class="keyword">true</span>; <span class="keywordflow">continue</span>; 
<a name="l02163"></a>02163         } 
<a name="l02164"></a>02164     } <span class="comment">// GRAVLOOP</span>
<a name="l02165"></a>02165     <span class="comment">// _PRINTGDIRS;</span>
<a name="l02166"></a>02166 
<a name="l02167"></a>02167     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> fluidHeight;
<a name="l02168"></a>02168     fluidHeight = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(gravIMax[maxGravComp]-gravIMin[maxGravComp]));
<a name="l02169"></a>02169 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l02170"></a>02170 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>) mpTest-&gt;mFluidHeight = (int)fluidHeight;
<a name="l02171"></a>02171 <span class="preprocessor">#endif // ELBEEM_PLUGIN!=1</span>
<a name="l02172"></a>02172 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(debugStandingPreinit) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;Standing fluid preinit&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;fheight=&quot;</span>&lt;&lt;fluidHeight&lt;&lt;<span class="stringliteral">&quot; min=&quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(gravIMin[0],gravIMin[1],   gravIMin[2])&lt;&lt;<span class="stringliteral">&quot; max=&quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(gravIMax[0], gravIMax[1],gravIMax[2])&lt;&lt;
<a name="l02173"></a>02173             <span class="stringliteral">&quot; mgc=&quot;</span>&lt;&lt;maxGravComp&lt;&lt;<span class="stringliteral">&quot; mc1=&quot;</span>&lt;&lt;gravComp1&lt;&lt;<span class="stringliteral">&quot; mc2=&quot;</span>&lt;&lt;gravComp2&lt;&lt;<span class="stringliteral">&quot; dir=&quot;</span>&lt;&lt;gravDir[maxGravComp]&lt;&lt;<span class="stringliteral">&quot; have=&quot;</span>&lt;&lt;haveStandingFluid ,10);
<a name="l02174"></a>02174                 
<a name="l02175"></a>02175     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad012646c0df61548d43ee1090d906ca3" title="debug function to disable standing f init">mDisableStandingFluidInit</a>) {
<a name="l02176"></a>02176         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;Standing fluid preinit&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Should be performed - but skipped due to mDisableStandingFluidInit flag set!&quot;</span>, 2);
<a name="l02177"></a>02177         haveStandingFluid=0;
<a name="l02178"></a>02178     }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180     <span class="comment">// copy flags and init , as no flags will be changed during grav init</span>
<a name="l02181"></a>02181     <span class="comment">// also important for corasening later on</span>
<a name="l02182"></a>02182     <span class="keyword">const</span> <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l02183"></a>02183     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> nbflag[<a class="code" href="../../d2/d3c/solver__interface_8h.html#a5b93395a4f54a13f465488eb134e010d">LBM_DFNUM</a>], nbored; 
<a name="l02184"></a>02184     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>();k&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>);++k) {
<a name="l02185"></a>02185         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;++j) {
<a name="l02186"></a>02186             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l02187"></a>02187                 <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d2/d75/solver__relax_8h.html#a7eab7803391ea704d84e0db95689a8f6">SRCS</a>(lev)) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>)) ) {
<a name="l02188"></a>02188                     nbored = 0;
<a name="l02189"></a>02189                     <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> {
<a name="l02190"></a>02190                         nbflag[l] = <a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d2/d75/solver__relax_8h.html#a7eab7803391ea704d84e0db95689a8f6">SRCS</a>(lev),l);
<a name="l02191"></a>02191                         nbored |= nbflag[l];
<a name="l02192"></a>02192                     } 
<a name="l02193"></a>02193                     <span class="keywordflow">if</span>(nbored&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>) {
<a name="l02194"></a>02194                         <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d2/d75/solver__relax_8h.html#a7eab7803391ea704d84e0db95689a8f6">SRCS</a>(lev)) &amp;= (~<a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>);
<a name="l02195"></a>02195                     } <span class="keywordflow">else</span> {
<a name="l02196"></a>02196                         <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d2/d75/solver__relax_8h.html#a7eab7803391ea704d84e0db95689a8f6">SRCS</a>(lev)) |= <a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>;
<a name="l02197"></a>02197                     }
<a name="l02198"></a>02198                 }
<a name="l02199"></a>02199                 <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d2/d75/solver__relax_8h.html#a6d9615b3101a3ac7b60bb3bd118e6878">TSET</a>(lev)) = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,<a class="code" href="../../d2/d75/solver__relax_8h.html#a7eab7803391ea704d84e0db95689a8f6">SRCS</a>(lev));
<a name="l02200"></a>02200     } } }
<a name="l02201"></a>02201 
<a name="l02202"></a>02202     <span class="keywordflow">if</span>(haveStandingFluid) {
<a name="l02203"></a>02203         <span class="keywordtype">int</span> rhoworkSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l02204"></a>02204         <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> timestart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); <span class="comment">// FIXME use user time here?</span>
<a name="l02205"></a>02205 
<a name="l02206"></a>02206         <a class="code" href="../../d8/dd5/solver__init_8cpp.html#acedd6f61f968df8e84b64abc0b5b004e">GRAVLOOP</a> {
<a name="l02207"></a>02207             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = gravIndex[0], j = gravIndex[1], k = gravIndex[2];
<a name="l02208"></a>02208             <span class="comment">//debMsgStd(&quot;Standing fluid preinit&quot;, DM_MSG, &quot; init check &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; &quot;&lt;&lt; haveStandingFluid, 1 );</span>
<a name="l02209"></a>02209             <span class="keywordflow">if</span>( ( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, i,j,k,rhoworkSet) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) ) ||
<a name="l02210"></a>02210                     ( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, i,j,k,rhoworkSet) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) ) ){ 
<a name="l02211"></a>02211                 <span class="comment">//gravAbort = true; </span>
<a name="l02212"></a>02212                 <span class="keywordflow">continue</span>;
<a name="l02213"></a>02213             }
<a name="l02214"></a>02214 
<a name="l02215"></a>02215             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rho = 1.0;
<a name="l02216"></a>02216             <span class="comment">// 1/6 velocity from denisty gradient, 1/2 for delta of two cells</span>
<a name="l02217"></a>02217             rho += 1.0* (fluidHeight-gravIndex[maxGravComp]) * 
<a name="l02218"></a>02218                 (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].gravity[maxGravComp])* (-3.0/1.0)*(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>); 
<a name="l02219"></a>02219             <span class="keywordflow">if</span>(debugStandingPreinit) 
<a name="l02220"></a>02220                 <span class="keywordflow">if</span>((gravIndex[gravComp1]==gravIMin[gravComp1]) &amp;&amp; (gravIndex[gravComp2]==gravIMin[gravComp2])) { 
<a name="l02221"></a>02221                     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;Standing fp&quot;</span>,<span class="stringliteral">&quot;gi=&quot;</span>&lt;&lt;gravIndex[maxGravComp]&lt;&lt;<span class="stringliteral">&quot; rho=&quot;</span>&lt;&lt;rho&lt;&lt;<span class="stringliteral">&quot; at &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#a0f456e0c862e871578fb308924863566">PRINT_IJK</a>); 
<a name="l02222"></a>02222                 }
<a name="l02223"></a>02223 
<a name="l02224"></a>02224             <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, i,j,k, rhoworkSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) ||
<a name="l02225"></a>02225                     (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, i,j,k, rhoworkSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) ) {
<a name="l02226"></a>02226                 <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> { <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, i,j,k, rhoworkSet, l) *= rho; }
<a name="l02227"></a>02227                 <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, i,j,k, rhoworkSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) *= rho;
<a name="l02228"></a>02228             }
<a name="l02229"></a>02229 
<a name="l02230"></a>02230         } <span class="comment">// GRAVLOOP</span>
<a name="l02231"></a>02231 
<a name="l02232"></a>02232         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;Standing fluid preinit&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Density gradient inited (max-rho:&quot;</span>&lt;&lt;
<a name="l02233"></a>02233             (1.0+ (fluidHeight) * (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].gravity[maxGravComp])* (-3.0/1.0)*(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].omega)) &lt;&lt;<span class="stringliteral">&quot;, h:&quot;</span>&lt;&lt; fluidHeight&lt;&lt;<span class="stringliteral">&quot;) &quot;</span>, 8);
<a name="l02234"></a>02234         
<a name="l02235"></a>02235         <span class="keywordtype">int</span> preinitSteps = (haveStandingFluid* ((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>)/3) );
<a name="l02236"></a>02236         preinitSteps = (haveStandingFluid&gt;&gt;2); <span class="comment">// not much use...?</span>
<a name="l02237"></a>02237         <span class="comment">//preinitSteps = 0;</span>
<a name="l02238"></a>02238         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;Standing fluid preinit&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Performing &quot;</span>&lt;&lt;preinitSteps&lt;&lt;<span class="stringliteral">&quot; prerelaxations &quot;</span>,10);
<a name="l02239"></a>02239         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;preinitSteps; s++) {
<a name="l02240"></a>02240             <span class="comment">// in solver main cpp</span>
<a name="l02241"></a>02241             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2306f5833f95152547078bc46a6851de">standingFluidPreinit</a>();
<a name="l02242"></a>02242         }
<a name="l02243"></a>02243 
<a name="l02244"></a>02244         <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> timeend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l02245"></a>02245         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;Standing fluid preinit&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot; done, &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(timeend-timestart), 9);
<a name="l02246"></a>02246 <span class="preprocessor">#undef  NBFLAG</span>
<a name="l02247"></a>02247 <span class="preprocessor"></span>    }
<a name="l02248"></a>02248 }
<a name="l02249"></a>02249 
<a name="l02250"></a>02250 
<a name="l02251"></a>02251 
<a name="l02252"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2346a3bd096d0ec6088bd13b9ce6179f">02252</a> <span class="keywordtype">bool</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2346a3bd096d0ec6088bd13b9ce6179f" title="debugging">LbmFsgrSolver::checkSymmetry</a>(<span class="keywordtype">string</span> idstring)
<a name="l02253"></a>02253 {
<a name="l02254"></a>02254     <span class="keywordtype">bool</span> erro = <span class="keyword">false</span>;
<a name="l02255"></a>02255     <span class="keywordtype">bool</span> symm = <span class="keyword">true</span>;
<a name="l02256"></a>02256     <span class="keywordtype">int</span> msgs = 0;
<a name="l02257"></a>02257     <span class="keyword">const</span> <span class="keywordtype">int</span> maxMsgs = 10;
<a name="l02258"></a>02258     <span class="keyword">const</span> <span class="keywordtype">bool</span> markCells = <span class="keyword">false</span>;
<a name="l02259"></a>02259 
<a name="l02260"></a>02260     <span class="comment">//for(int lev=0; lev&lt;=mMaxRefine; lev++) {</span>
<a name="l02261"></a>02261     { <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l02262"></a>02262 
<a name="l02263"></a>02263     <span class="comment">// no point if not symm.</span>
<a name="l02264"></a>02264     <span class="keywordflow">if</span>( (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex==<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey) &amp;&amp; (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex==<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizez)) {
<a name="l02265"></a>02265         <span class="comment">// ok</span>
<a name="l02266"></a>02266     } <span class="keywordflow">else</span> {
<a name="l02267"></a>02267         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02268"></a>02268     }
<a name="l02269"></a>02269 
<a name="l02270"></a>02270     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;2; s++) {
<a name="l02271"></a>02271     <a class="code" href="../../d1/d24/solver__class_8h.html#a1cd53306465fab36f6bc4c1d8ef9d291">FSGR_FORIJK1</a>(lev) {
<a name="l02272"></a>02272         <span class="keywordflow">if</span>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex/2)) {
<a name="l02273"></a>02273             <span class="keywordtype">int</span> inb = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1-<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>); 
<a name="l02274"></a>02274 
<a name="l02275"></a>02275             <span class="keywordflow">if</span>(lev==<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) inb -= 1;       <span class="comment">// FSGR_SYMM_T</span>
<a name="l02276"></a>02276 
<a name="l02277"></a>02277             <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,s) != <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, inb,j,k,s) ) { erro = <span class="keyword">true</span>;
<a name="l02278"></a>02278                 <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l02279"></a>02279                     <span class="keywordflow">if</span>(msgs&lt;maxMsgs) { msgs++;
<a name="l02280"></a>02280                         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;EFLAG&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a0f456e0c862e871578fb308924863566">PRINT_IJK</a>&lt;&lt;<span class="stringliteral">&quot;s&quot;</span>&lt;&lt;s&lt;&lt;<span class="stringliteral">&quot; flag &quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,s)&lt;&lt;<span class="stringliteral">&quot; , at &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(inb,j,k)&lt;&lt;<span class="stringliteral">&quot;s&quot;</span>&lt;&lt;s&lt;&lt;<span class="stringliteral">&quot; flag &quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, inb,j,k,s) );
<a name="l02281"></a>02281                     }
<a name="l02282"></a>02282                 }
<a name="l02283"></a>02283                 <span class="keywordflow">if</span>(markCells){ <a class="code" href="../../d1/d24/solver__class_8h.html#acb6b7fb0324ec761f88d893b53b5dd08">debugMarkCell</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k); <a class="code" href="../../d1/d24/solver__class_8h.html#acb6b7fb0324ec761f88d893b53b5dd08">debugMarkCell</a>(lev, inb,j,k); }
<a name="l02284"></a>02284                 symm = <span class="keyword">false</span>;
<a name="l02285"></a>02285             }
<a name="l02286"></a>02286             <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#acd49f494ee1c41252fbb631c3d754dd0">LBM_FLOATNEQ</a>(<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,s, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>), <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, inb,j,k,s, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>)) ) { erro = <span class="keyword">true</span>;
<a name="l02287"></a>02287                 <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l02288"></a>02288                     <span class="keywordflow">if</span>(msgs&lt;maxMsgs) { msgs++;
<a name="l02289"></a>02289                         <span class="comment">//debMsgDirect(&quot; mass1 &quot;&lt;&lt;QCELL(lev, i,j,k,s, dMass)&lt;&lt;&quot; mass2 &quot;&lt;&lt;QCELL(lev, inb,j,k,s, dMass) &lt;&lt;std::endl);</span>
<a name="l02290"></a>02290                         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;EMASS&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a0f456e0c862e871578fb308924863566">PRINT_IJK</a>&lt;&lt;<span class="stringliteral">&quot;s&quot;</span>&lt;&lt;s&lt;&lt;<span class="stringliteral">&quot; mass &quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,s, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>)&lt;&lt;<span class="stringliteral">&quot; , at &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(inb,j,k)&lt;&lt;<span class="stringliteral">&quot;s&quot;</span>&lt;&lt;s&lt;&lt;<span class="stringliteral">&quot; mass &quot;</span>&lt;&lt;<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, inb,j,k,s, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) );
<a name="l02291"></a>02291                     }
<a name="l02292"></a>02292                 }
<a name="l02293"></a>02293                 <span class="keywordflow">if</span>(markCells){ <a class="code" href="../../d1/d24/solver__class_8h.html#acb6b7fb0324ec761f88d893b53b5dd08">debugMarkCell</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k); <a class="code" href="../../d1/d24/solver__class_8h.html#acb6b7fb0324ec761f88d893b53b5dd08">debugMarkCell</a>(lev, inb,j,k); }
<a name="l02294"></a>02294                 symm = <span class="keyword">false</span>;
<a name="l02295"></a>02295             }
<a name="l02296"></a>02296 
<a name="l02297"></a>02297             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nbrho = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, s, <a class="code" href="../../d1/d24/solver__class_8h.html#acc5ec578ced5d032234e83703b4b352a">dC</a>);
<a name="l02298"></a>02298             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { nbrho += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, s, l); }
<a name="l02299"></a>02299             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> otrho = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, inb,j,k, s, <a class="code" href="../../d1/d24/solver__class_8h.html#acc5ec578ced5d032234e83703b4b352a">dC</a>);
<a name="l02300"></a>02300             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { otrho += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, inb,j,k, s, l); }
<a name="l02301"></a>02301             <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#acd49f494ee1c41252fbb631c3d754dd0">LBM_FLOATNEQ</a>(nbrho, otrho) ) { erro = <span class="keyword">true</span>;
<a name="l02302"></a>02302                 <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l02303"></a>02303                     <span class="keywordflow">if</span>(msgs&lt;maxMsgs) { msgs++;
<a name="l02304"></a>02304                         <span class="comment">//debMsgDirect(&quot; rho 1 &quot;&lt;&lt;nbrho &lt;&lt;&quot; rho 2 &quot;&lt;&lt;otrho  &lt;&lt;std::endl);</span>
<a name="l02305"></a>02305                         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ERHO &quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a0f456e0c862e871578fb308924863566">PRINT_IJK</a>&lt;&lt;<span class="stringliteral">&quot;s&quot;</span>&lt;&lt;s&lt;&lt;<span class="stringliteral">&quot; rho  &quot;</span>&lt;&lt;nbrho &lt;&lt;<span class="stringliteral">&quot; , at &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(inb,j,k)&lt;&lt;<span class="stringliteral">&quot;s&quot;</span>&lt;&lt;s&lt;&lt;<span class="stringliteral">&quot; rho  &quot;</span>&lt;&lt;otrho  );
<a name="l02306"></a>02306                     }
<a name="l02307"></a>02307                 }
<a name="l02308"></a>02308                 <span class="keywordflow">if</span>(markCells){ <a class="code" href="../../d1/d24/solver__class_8h.html#acb6b7fb0324ec761f88d893b53b5dd08">debugMarkCell</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k); <a class="code" href="../../d1/d24/solver__class_8h.html#acb6b7fb0324ec761f88d893b53b5dd08">debugMarkCell</a>(lev, inb,j,k); }
<a name="l02309"></a>02309                 symm = <span class="keyword">false</span>;
<a name="l02310"></a>02310             }
<a name="l02311"></a>02311         }
<a name="l02312"></a>02312     } }
<a name="l02313"></a>02313     } <span class="comment">// lev</span>
<a name="l02314"></a>02314     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> maxdiv =0.0;
<a name="l02315"></a>02315     <span class="keywordflow">if</span>(erro) {
<a name="l02316"></a>02316         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;SymCheck Failed!&quot;</span>, idstring&lt;&lt;<span class="stringliteral">&quot; rho maxdiv:&quot;</span>&lt;&lt; maxdiv );
<a name="l02317"></a>02317         <span class="comment">//if(LBMDIM==2) mPanic = true; </span>
<a name="l02318"></a>02318         <span class="comment">//return false;</span>
<a name="l02319"></a>02319     } <span class="keywordflow">else</span> {
<a name="l02320"></a>02320         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;SymCheck OK!&quot;</span>, idstring&lt;&lt;<span class="stringliteral">&quot; rho maxdiv:&quot;</span>&lt;&lt; maxdiv );
<a name="l02321"></a>02321     }
<a name="l02322"></a>02322     <span class="comment">// all ok...</span>
<a name="l02323"></a>02323     <span class="keywordflow">return</span> symm;
<a name="l02324"></a>02324 }<span class="comment">// */</span>
<a name="l02325"></a>02325 
<a name="l02326"></a>02326 
<a name="l02327"></a>02327 <span class="keywordtype">void</span> 
<a name="l02328"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a95e2dca112073efe75e5855afccf8dc1">02328</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a95e2dca112073efe75e5855afccf8dc1" title="interpolate velocity and density at a given position">LbmFsgrSolver::interpolateCellValues</a>(
<a name="l02329"></a>02329         <span class="keywordtype">int</span> level,<span class="keywordtype">int</span> ei,<span class="keywordtype">int</span> ej,<span class="keywordtype">int</span> ek,<span class="keywordtype">int</span> workSet, 
<a name="l02330"></a>02330         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;retrho, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;retux, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;retuy, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;retuz) 
<a name="l02331"></a>02331 {
<a name="l02332"></a>02332     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> avgrho = 0.0;
<a name="l02333"></a>02333     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> avgux = 0.0, avguy = 0.0, avguz = 0.0;
<a name="l02334"></a>02334     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cellcnt = 0.0;
<a name="l02335"></a>02335 
<a name="l02336"></a>02336     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> nbl=1; nbl&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a> ; ++nbl) {
<a name="l02337"></a>02337         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(level,ei,ej,ek,workSet,nbl) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#adce131aad1a8841dc1a68b7df4b1d828">CFNoInterpolSrc</a>) <span class="keywordflow">continue</span>;
<a name="l02338"></a>02338         <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(level,ei,ej,ek,workSet,nbl) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) ){
<a name="l02339"></a>02339                 <span class="comment">//((!(RFLAG_NB(level,ei,ej,ek,workSet,nbl) &amp; CFNoInterpolSrc) ) &amp;&amp;</span>
<a name="l02340"></a>02340                  <span class="comment">//(RFLAG_NB(level,ei,ej,ek,workSet,nbl) &amp; CFInter) ) { </span>
<a name="l02341"></a>02341             cellcnt += 1.0;
<a name="l02342"></a>02342             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> rl=0; rl&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a> ; ++rl) { 
<a name="l02343"></a>02343                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d9/d2b/solver__main_8cpp.html#aa96730acc0b9cdef51e0d524740ed899">nbdf</a> =  <a class="code" href="../../d1/d24/solver__class_8h.html#aa2ec3cc5ea4099c60265e7bc5a0aef15">QCELL_NB</a>(level,ei,ej,ek, workSet,nbl, rl);
<a name="l02344"></a>02344                 avgux  += (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[rl]*nbdf); 
<a name="l02345"></a>02345                 avguy  += (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[rl]*nbdf);  
<a name="l02346"></a>02346                 avguz  += (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[rl]*nbdf);  
<a name="l02347"></a>02347                 avgrho += nbdf;
<a name="l02348"></a>02348             }
<a name="l02349"></a>02349         }
<a name="l02350"></a>02350     }
<a name="l02351"></a>02351 
<a name="l02352"></a>02352     <span class="keywordflow">if</span>(cellcnt&lt;=0.0) {
<a name="l02353"></a>02353         <span class="comment">// no nbs? just use eq.</span>
<a name="l02354"></a>02354         avgrho = 1.0;
<a name="l02355"></a>02355         avgux = avguy = avguz = 0.0;
<a name="l02356"></a>02356         <span class="comment">//TTT mNumProblems++;</span>
<a name="l02357"></a>02357 <span class="preprocessor">#if ELBEEM_PLUGIN!=1</span>
<a name="l02358"></a>02358 <span class="preprocessor"></span>        <span class="comment">//mPanic=1; </span>
<a name="l02359"></a>02359         <span class="comment">// this can happen for worst case moving obj scenarios...</span>
<a name="l02360"></a>02360         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::interpolateCellValues&quot;</span>,<span class="stringliteral">&quot;Cellcnt&lt;=0.0 at &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(ei,ej,ek));
<a name="l02361"></a>02361 <span class="preprocessor">#endif // ELBEEM_PLUGIN</span>
<a name="l02362"></a>02362 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
<a name="l02363"></a>02363         <span class="comment">// init speed</span>
<a name="l02364"></a>02364         avgux /= cellcnt; avguy /= cellcnt; avguz /= cellcnt;
<a name="l02365"></a>02365         avgrho /= cellcnt;
<a name="l02366"></a>02366     }
<a name="l02367"></a>02367 
<a name="l02368"></a>02368     retrho = avgrho;
<a name="l02369"></a>02369     retux = avgux;
<a name="l02370"></a>02370     retuy = avguy;
<a name="l02371"></a>02371     retuz = avguz;
<a name="l02372"></a>02372 } <span class="comment">// interpolateCellValues</span>
<a name="l02373"></a>02373 
<a name="l02374"></a>02374 
<a name="l02375"></a>02375 <span class="comment">/******************************************************************************</span>
<a name="l02376"></a>02376 <span class="comment"> * instantiation</span>
<a name="l02377"></a>02377 <span class="comment"> *****************************************************************************/</span>
<a name="l02378"></a>02378 
<a name="l02380"></a><a class="code" href="../../d8/dd5/solver__init_8cpp.html#aea741e5546295d779197aabd21ce4d0f">02380</a> <a class="code" href="../../db/dff/classLbmSolverInterface.html">LbmSolverInterface</a>* <a class="code" href="../../db/dec/simulation__object_8cpp.html#aea741e5546295d779197aabd21ce4d0f" title="lbm factory functions">createSolver</a>() { <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a437549efd8c854096f5db9ae193f6a75" title="Constructor.">LbmFsgrSolver</a>(); }
<a name="l02381"></a>02381 
<a name="l02382"></a>02382 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:55 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

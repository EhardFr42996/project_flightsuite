<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: sculpt_uv.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">sculpt_uv.c</div>  </div>
</div>
<div class="contents">
<a href="../../d8/da6/sculpt__uv_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software  Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) Blender Foundation, 2002-2009</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Antony Riakiotakis</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * UV Sculpt tools</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d37/DNA__brush__types_8h.html">DNA_brush_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dc9/BKE__brush_8h.html">BKE_brush.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d86/BKE__paint_8h.html">BKE_paint.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d5e/BKE__customdata_8h.html" title="CustomData interface, see also DNA_customdata_types.h.">BKE_customdata.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html">BKE_tessmesh.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d53/ED__image_8h.html">ED_image.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd6/ED__mesh_8h.html">ED_mesh.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d6c/paint__intern_8h.html">paint_intern.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d48/uvedit__intern_8h.html">uvedit_intern.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">00071</a> <span class="preprocessor">#define MARK_BOUNDARY   1</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="../../d3/db1/structUvAdjacencyElement.html">00073</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/db1/structUvAdjacencyElement.html">UvAdjacencyElement</a> {
<a name="l00074"></a>00074     <span class="comment">/* pointer to original uvelement */</span>
<a name="l00075"></a><a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">00075</a>     <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>;
<a name="l00076"></a>00076     <span class="comment">/* uv pointer for convenience. Caution, this points to the original UVs! */</span>
<a name="l00077"></a><a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">00077</a>     <span class="keywordtype">float</span> *<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>;
<a name="l00078"></a>00078     <span class="comment">/* general use flag (Used to check if Element is boundary here) */</span>
<a name="l00079"></a><a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">00079</a>     <span class="keywordtype">char</span> <a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a>;
<a name="l00080"></a>00080 } <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a1256d6d8f95223d81d534ae89f3853d7">UvAdjacencyElement</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="../../d4/d1d/structUvEdge.html">00082</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> {
<a name="l00083"></a><a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">00083</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>;
<a name="l00084"></a><a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">00084</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>;
<a name="l00085"></a>00085     <span class="comment">/* general use flag (Used to check if edge is boundary here, and propagates to adjacency elements) */</span>
<a name="l00086"></a><a class="code" href="../../d4/d1d/structUvEdge.html#a554667b3ffc0461a89194b745f89bb1e">00086</a>     <span class="keywordtype">char</span> <a class="code" href="../../d4/d1d/structUvEdge.html#a554667b3ffc0461a89194b745f89bb1e">flag</a>;
<a name="l00087"></a>00087 } <a class="code" href="../../d8/da6/sculpt__uv_8c.html#af0c40e4c2ea65bfcb11bc3af3689fd37">UvEdge</a>;
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html">00089</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html">UVInitialStrokeElement</a> {
<a name="l00090"></a>00090     <span class="comment">/* index to unique uv */</span>
<a name="l00091"></a><a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a4b4db7a07e12cc1f6c86f03a2e57c17f">00091</a>     <span class="keywordtype">int</span> <a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a4b4db7a07e12cc1f6c86f03a2e57c17f">uv</a>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">/* strength of brush on initial position */</span>
<a name="l00094"></a><a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a102afd082627483080a96e665db2cfc3">00094</a>     <span class="keywordtype">float</span> <a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a102afd082627483080a96e665db2cfc3">strength</a>;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     <span class="comment">/* initial uv position */</span>
<a name="l00097"></a><a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a62d37cf0e5d91286f27e27418c054cbd">00097</a>     <span class="keywordtype">float</span> <a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a62d37cf0e5d91286f27e27418c054cbd">initial_uv</a>[2];
<a name="l00098"></a>00098 } <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a01527f3c890ee1a2bf0f9424538de1c2">UVInitialStrokeElement</a>;
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="../../dc/d7c/structUVInitialStroke.html">00100</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../dc/d7c/structUVInitialStroke.html">UVInitialStroke</a> {
<a name="l00101"></a>00101     <span class="comment">/* Initial Selection,for grab brushes for instance */</span>
<a name="l00102"></a><a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">00102</a>     <a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html">UVInitialStrokeElement</a> *<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="comment">/* total initially selected UVs*/</span>
<a name="l00105"></a><a class="code" href="../../dc/d7c/structUVInitialStroke.html#aa6d165c91d97877d30d43aea0e7bddae">00105</a>     <span class="keywordtype">int</span> <a class="code" href="../../dc/d7c/structUVInitialStroke.html#aa6d165c91d97877d30d43aea0e7bddae">totalInitialSelected</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="comment">/* initial mouse coordinates */</span>
<a name="l00108"></a><a class="code" href="../../dc/d7c/structUVInitialStroke.html#a38645cf146b483b31dbbdfa0eda83307">00108</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/d7c/structUVInitialStroke.html#a38645cf146b483b31dbbdfa0eda83307">init_coord</a>[2];
<a name="l00109"></a>00109 } <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ab1ae59ff148a0fd0cc3271b2588d62a3">UVInitialStroke</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">/* custom data for uv smoothing brush */</span>
<a name="l00113"></a><a class="code" href="../../d6/d46/structUvSculptData.html">00113</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> {
<a name="l00114"></a>00114     <span class="comment">/* Contains the first of each set of coincident uvs.</span>
<a name="l00115"></a>00115 <span class="comment">     * These will be used to perform smoothing on and propagate the changes</span>
<a name="l00116"></a>00116 <span class="comment">     * to their coincident uvs */</span>
<a name="l00117"></a><a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">00117</a>     <a class="code" href="../../d3/db1/structUvAdjacencyElement.html">UvAdjacencyElement</a> *<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">/* ...Is what it says */</span>
<a name="l00120"></a><a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">00120</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="comment">/* Edges used for adjacency info, used with laplacian smoothing */</span>
<a name="l00123"></a><a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">00123</a>     <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="comment">/* need I say more? */</span>
<a name="l00126"></a><a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">00126</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">totalUvEdges</a>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="comment">/* data for initial stroke, used by tools like grab */</span>
<a name="l00129"></a><a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">00129</a>     <a class="code" href="../../dc/d7c/structUVInitialStroke.html">UVInitialStroke</a> *<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">/* timer to be used for airbrush-type brush */</span>
<a name="l00132"></a><a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">00132</a>     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">timer</a>;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <span class="comment">/* to determine quickly adjacent uvs */</span>
<a name="l00135"></a><a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">00135</a>     <a class="code" href="../../db/d82/structUvElementMap.html">UvElementMap</a> *<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="comment">/* uvsmooth Paint for fast reference */</span>
<a name="l00138"></a><a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">00138</a>     <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> *<a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">uvsculpt</a>;
<a name="l00139"></a>00139     
<a name="l00140"></a>00140     <span class="comment">/* tool to use. duplicating here to change if modifier keys are pressed */</span>
<a name="l00141"></a><a class="code" href="../../d6/d46/structUvSculptData.html#aef85f55dbd2ed5e8f9e334fd211da5f8">00141</a>     <span class="keywordtype">char</span> <a class="code" href="../../d6/d46/structUvSculptData.html#aef85f55dbd2ed5e8f9e334fd211da5f8">tool</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">/* store invert flag here */</span>
<a name="l00144"></a><a class="code" href="../../d6/d46/structUvSculptData.html#a2dd82ca821912deb327a468d51244e56">00144</a>     <span class="keywordtype">char</span> <a class="code" href="../../d6/d46/structUvSculptData.html#a2dd82ca821912deb327a468d51244e56">invert</a>;
<a name="l00145"></a>00145 } <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a40ff7fd5a6d8666d010cb80645fc15a1">UvSculptData</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/*********** Improved Laplacian Relaxation Operator ************************/</span>
<a name="l00148"></a>00148 <span class="comment">/* original code by Raul Fernandez Hernandez &quot;farsthary&quot;                   *</span>
<a name="l00149"></a>00149 <span class="comment"> * adapted to uv smoothing by Antony Riakiatakis                           *</span>
<a name="l00150"></a>00150 <span class="comment"> ***************************************************************************/</span>
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="../../d7/d6a/structTemp__UvData.html">00152</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UvData</a> {
<a name="l00153"></a><a class="code" href="../../d7/d6a/structTemp__UvData.html#a2ed5b6f3265ff3892b37f6c6122090be">00153</a>     <span class="keywordtype">float</span> <a class="code" href="../../d7/d6a/structTemp__UvData.html#a2ed5b6f3265ff3892b37f6c6122090be">sum_co</a>[2], <a class="code" href="../../d7/d6a/structTemp__UvData.html#aa0b6d3de76527175bc647d0e8de6cb25">p</a>[2], <a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>[2], <a class="code" href="../../d7/d6a/structTemp__UvData.html#ad3026dc4f2504d271743cfc4428363e3">sum_b</a>[2];
<a name="l00154"></a><a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">00154</a>     <span class="keywordtype">int</span> <a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>;
<a name="l00155"></a>00155 } <a class="code" href="../../d8/da6/sculpt__uv_8c.html#aa8cf190b07c95649c07dc630d7dfdb0d">Temp_UVData</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#a027ac790f3b7d32829b43d8780fd28d7">00159</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a027ac790f3b7d32829b43d8780fd28d7">HC_relaxation_iteration_uv</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *sculptdata, <span class="keywordtype">float</span> mouse_coord[2],
<a name="l00160"></a>00160                                 <span class="keywordtype">float</span> alpha, <span class="keywordtype">float</span> radius, <span class="keywordtype">float</span> aspectRatio)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162     <a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UVData</a> *tmp_uvdata;
<a name="l00163"></a>00163     <span class="keywordtype">float</span> <a class="code" href="../../d0/dbc/namespaceKDL.html#a0227d72a9cfff5e6065944ebb04f9e77">diff</a>[2];
<a name="l00164"></a>00164     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00165"></a>00165     <span class="keywordtype">float</span> radius_root = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(radius);
<a name="l00166"></a>00166     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">uvsculpt</a>);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     tmp_uvdata = (<a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UVData</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UVData</a>), <span class="stringliteral">&quot;Temporal data&quot;</span>);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="comment">/* counting neighbors */</span>
<a name="l00171"></a>00171     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">totalUvEdges</a>; i++) {
<a name="l00172"></a>00172         <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *tmpedge = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00173"></a>00173         tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>++;
<a name="l00174"></a>00174         tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>++;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7f222b1bc110fa45434894fc9a919dec">add_v2_v2</a>(tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a2ed5b6f3265ff3892b37f6c6122090be">sum_co</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00177"></a>00177         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7f222b1bc110fa45434894fc9a919dec">add_v2_v2</a>(tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a2ed5b6f3265ff3892b37f6c6122090be">sum_co</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>; i++) {
<a name="l00181"></a>00181         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(diff, tmp_uvdata[i].sum_co);
<a name="l00182"></a>00182         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5c6d272cb16304939dbe77dacc77b3b0">mul_v2_fl</a>(diff, 1.f / tmp_uvdata[i].ncounter);
<a name="l00183"></a>00183         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(tmp_uvdata[i].<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, diff);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         tmp_uvdata[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>[0] = diff[0] - sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0];
<a name="l00186"></a>00186         tmp_uvdata[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>[1] = diff[1] - sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1];
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">totalUvEdges</a>; i++) {
<a name="l00190"></a>00190         <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *tmpedge = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00191"></a>00191         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7f222b1bc110fa45434894fc9a919dec">add_v2_v2</a>(tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#ad3026dc4f2504d271743cfc4428363e3">sum_b</a>, tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>);
<a name="l00192"></a>00192         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7f222b1bc110fa45434894fc9a919dec">add_v2_v2</a>(tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#ad3026dc4f2504d271743cfc4428363e3">sum_b</a>, tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>; i++) {
<a name="l00196"></a>00196         <span class="keywordtype">float</span> dist;
<a name="l00197"></a>00197         <span class="comment">/* This is supposed to happen only if &quot;Pin Edges&quot; is on, since we have initialization on stroke start</span>
<a name="l00198"></a>00198 <span class="comment">         * If ever uv brushes get their own mode we should check for toolsettings option too */</span>
<a name="l00199"></a>00199         <span class="keywordflow">if</span> ((sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> &amp; <a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">MARK_BOUNDARY</a>)) {
<a name="l00200"></a>00200             <span class="keywordflow">continue</span>;
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(diff, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>, mouse_coord);
<a name="l00204"></a>00204         diff[1] /= aspectRatio;
<a name="l00205"></a>00205         <span class="keywordflow">if</span> ((dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a03e71ae06120f598c068aad6970015c2">dot_v2v2</a>(diff, diff)) &lt;= radius) {
<a name="l00206"></a>00206             <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element;
<a name="l00207"></a>00207             <span class="keywordtype">float</span> strength;
<a name="l00208"></a>00208             strength = alpha * <a class="code" href="../../da/dc9/BKE__brush_8h.html#afcd6c828e3c28abab8e3aaf5f32b60d9">brush_curve_strength</a>(brush, <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(dist), radius_root);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210             sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0] = (1.0 - strength) * sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0] + strength * (tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#aa0b6d3de76527175bc647d0e8de6cb25">p</a>[0] - 0.5f * (tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>[0] + tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#ad3026dc4f2504d271743cfc4428363e3">sum_b</a>[0] / tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>));
<a name="l00211"></a>00211             sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1] = (1.0 - strength) * sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1] + strength * (tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#aa0b6d3de76527175bc647d0e8de6cb25">p</a>[1] - 0.5f * (tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#af2efee9653f66d1b61502e30a0a9c9f6">b</a>[1] + tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#ad3026dc4f2504d271743cfc4428363e3">sum_b</a>[1] / tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>));
<a name="l00212"></a>00212 
<a name="l00213"></a>00213             <span class="keywordflow">for</span> (element = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00214"></a>00214                 <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00215"></a>00215                 <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> &amp;&amp; element != sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>)
<a name="l00218"></a>00218                     <span class="keywordflow">break</span>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                 l = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00221"></a>00221                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00222"></a>00222                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00223"></a>00223             }
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tmp_uvdata);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="keywordflow">return</span>;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#ac5d5182ee8cc482a8181ac2ed1bca252">00232</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ac5d5182ee8cc482a8181ac2ed1bca252">laplacian_relaxation_iteration_uv</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *sculptdata, <span class="keywordtype">float</span> mouse_coord[2], <span class="keywordtype">float</span> alpha, <span class="keywordtype">float</span> radius, <span class="keywordtype">float</span> aspectRatio)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UVData</a> *tmp_uvdata;
<a name="l00235"></a>00235     <span class="keywordtype">float</span> <a class="code" href="../../d0/dbc/namespaceKDL.html#a0227d72a9cfff5e6065944ebb04f9e77">diff</a>[2];
<a name="l00236"></a>00236     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00237"></a>00237     <span class="keywordtype">float</span> radius_root = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(radius);
<a name="l00238"></a>00238     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">uvsculpt</a>);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     tmp_uvdata = (<a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UVData</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6a/structTemp__UvData.html">Temp_UVData</a>), <span class="stringliteral">&quot;Temporal data&quot;</span>);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="comment">/* counting neighbors */</span>
<a name="l00243"></a>00243     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">totalUvEdges</a>; i++) {
<a name="l00244"></a>00244         <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *tmpedge = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00245"></a>00245         tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>++;
<a name="l00246"></a>00246         tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a3f430f27815815aea9f1e590254a2751">ncounter</a>++;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7f222b1bc110fa45434894fc9a919dec">add_v2_v2</a>(tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a2ed5b6f3265ff3892b37f6c6122090be">sum_co</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00249"></a>00249         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7f222b1bc110fa45434894fc9a919dec">add_v2_v2</a>(tmp_uvdata[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#a2ed5b6f3265ff3892b37f6c6122090be">sum_co</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[tmpedge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">/* Original Lacplacian algorithm included removal of normal component of translation. here it is not</span>
<a name="l00253"></a>00253 <span class="comment">     * needed since we translate along the UV plane always.*/</span>
<a name="l00254"></a>00254     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>; i++) {
<a name="l00255"></a>00255         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(tmp_uvdata[i].<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, tmp_uvdata[i].sum_co);
<a name="l00256"></a>00256         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5c6d272cb16304939dbe77dacc77b3b0">mul_v2_fl</a>(tmp_uvdata[i].p, 1.f / tmp_uvdata[i].ncounter);
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>; i++) {
<a name="l00260"></a>00260         <span class="keywordtype">float</span> dist;
<a name="l00261"></a>00261         <span class="comment">/* This is supposed to happen only if &quot;Pin Edges&quot; is on, since we have initialization on stroke start</span>
<a name="l00262"></a>00262 <span class="comment">         * If ever uv brushes get their own mode we should check for toolsettings option too */</span>
<a name="l00263"></a>00263         <span class="keywordflow">if</span> ((sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> &amp; <a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">MARK_BOUNDARY</a>)) {
<a name="l00264"></a>00264             <span class="keywordflow">continue</span>;
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(diff, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>, mouse_coord);
<a name="l00268"></a>00268         diff[1] /= aspectRatio;
<a name="l00269"></a>00269         <span class="keywordflow">if</span> ((dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a03e71ae06120f598c068aad6970015c2">dot_v2v2</a>(diff, diff)) &lt;= radius) {
<a name="l00270"></a>00270             <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element;
<a name="l00271"></a>00271             <span class="keywordtype">float</span> strength;
<a name="l00272"></a>00272             strength = alpha * <a class="code" href="../../da/dc9/BKE__brush_8h.html#afcd6c828e3c28abab8e3aaf5f32b60d9">brush_curve_strength</a>(brush, <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(dist), radius_root);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274             sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0] = (1.0 - strength) * sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0] + strength * tmp_uvdata[i].<a class="code" href="../../d7/d6a/structTemp__UvData.html#aa0b6d3de76527175bc647d0e8de6cb25">p</a>[0];
<a name="l00275"></a>00275             sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1] = (1.0 - strength) * sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1] + strength * tmp_uvdata[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d7/d6a/structTemp__UvData.html#aa0b6d3de76527175bc647d0e8de6cb25">p</a>[1];
<a name="l00276"></a>00276 
<a name="l00277"></a>00277             <span class="keywordflow">for</span> (element = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00278"></a>00278                 <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00279"></a>00279                 <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281                 <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> &amp;&amp; element != sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>)
<a name="l00282"></a>00282                     <span class="keywordflow">break</span>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                 l = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00285"></a>00285                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00286"></a>00286                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00287"></a>00287             }
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tmp_uvdata);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <span class="keywordflow">return</span>;
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#a3c0acd093dae48780647dc3cf9fbf829">00297</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a3c0acd093dae48780647dc3cf9fbf829">uv_sculpt_stroke_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299     <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[2], radius, radius_root;
<a name="l00300"></a>00300     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00301"></a>00301     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00302"></a>00302     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00303"></a>00303     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tool;
<a name="l00304"></a>00304     <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *sculptdata = (<a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *)op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00305"></a>00305     <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima;
<a name="l00306"></a>00306     <span class="keywordtype">int</span> <a class="code" href="../../d6/d26/svm__invert_8h.html#a68699e276b6fc0d0278f5c6936c7e23d">invert</a>;
<a name="l00307"></a>00307     <span class="keywordtype">int</span> width, height;
<a name="l00308"></a>00308     <span class="keywordtype">float</span> aspectRatio;
<a name="l00309"></a>00309     <span class="keywordtype">float</span> alpha, zoomx, zoomy;
<a name="l00310"></a>00310     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">uvsculpt</a>);
<a name="l00311"></a>00311     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *toolsettings = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00312"></a>00312     tool = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#aef85f55dbd2ed5e8f9e334fd211da5f8">tool</a>;
<a name="l00313"></a>00313     <a class="code" href="../../d6/d26/svm__invert_8h.html#a68699e276b6fc0d0278f5c6936c7e23d">invert</a> = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a2dd82ca821912deb327a468d51244e56">invert</a> ? -1 : 1;
<a name="l00314"></a>00314     alpha = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a9259092b9744db0b14e8a59954356d20">brush_alpha</a>(scene, brush);
<a name="l00315"></a>00315     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1], &amp;co[0], &amp;co[1]);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     sima = <a class="code" href="../../df/d01/BKE__context_8h.html#ae04ae450dc98cc5d253c49530f5a2dd6">CTX_wm_space_image</a>(C);
<a name="l00318"></a>00318     <a class="code" href="../../de/d53/ED__image_8h.html#a72aa9c6d1d329f0fce3b5c65b8698318">ED_space_image_size</a>(sima, &amp;width, &amp;height);
<a name="l00319"></a>00319     <a class="code" href="../../de/d53/ED__image_8h.html#a6902c4f28acdbce0b7080dbbfbcbc4aa">ED_space_image_zoom</a>(sima, ar, &amp;zoomx, &amp;zoomy);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(scene, brush) / (width * zoomx);
<a name="l00322"></a>00322     aspectRatio = width / (float)height;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="comment">/* We will compare squares to save some computation */</span>
<a name="l00325"></a>00325     radius = radius * radius;
<a name="l00326"></a>00326     radius_root = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(radius);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="comment">/*</span>
<a name="l00329"></a>00329 <span class="comment">     * Pinch Tool</span>
<a name="l00330"></a>00330 <span class="comment">     */</span>
<a name="l00331"></a>00331     <span class="keywordflow">if</span> (tool == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4a85461e47780ff88252c44cb442ed9e">UV_SCULPT_TOOL_PINCH</a>) {
<a name="l00332"></a>00332         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00333"></a>00333         alpha *= <a class="code" href="../../d6/d26/svm__invert_8h.html#a68699e276b6fc0d0278f5c6936c7e23d">invert</a>;
<a name="l00334"></a>00334         <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>; i++) {
<a name="l00335"></a>00335             <span class="keywordtype">float</span> dist, <a class="code" href="../../d0/dbc/namespaceKDL.html#a0227d72a9cfff5e6065944ebb04f9e77">diff</a>[2];
<a name="l00336"></a>00336             <span class="comment">/* This is supposed to happen only if &quot;Lock Borders&quot; is on, since we have initialization on stroke start</span>
<a name="l00337"></a>00337 <span class="comment">             * If ever uv brushes get their own mode we should check for toolsettings option too */</span>
<a name="l00338"></a>00338             <span class="keywordflow">if</span> (sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> &amp; <a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">MARK_BOUNDARY</a>) {
<a name="l00339"></a>00339                 <span class="keywordflow">continue</span>;
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(diff, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>, co);
<a name="l00343"></a>00343             diff[1] /= aspectRatio;
<a name="l00344"></a>00344             <span class="keywordflow">if</span> ((dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a03e71ae06120f598c068aad6970015c2">dot_v2v2</a>(diff, diff)) &lt;= radius) {
<a name="l00345"></a>00345                 <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element;
<a name="l00346"></a>00346                 <span class="keywordtype">float</span> strength;
<a name="l00347"></a>00347                 strength = alpha * <a class="code" href="../../da/dc9/BKE__brush_8h.html#afcd6c828e3c28abab8e3aaf5f32b60d9">brush_curve_strength</a>(brush, <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(dist), radius_root);
<a name="l00348"></a>00348                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad56c6a83e4d51efce2881bb484c50221">normalize_v2</a>(diff);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350                 sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0] -= strength * diff[0] * 0.001;
<a name="l00351"></a>00351                 sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1] -= strength * diff[1] * 0.001;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                 <span class="keywordflow">for</span> (element = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00354"></a>00354                     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00355"></a>00355                     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357                     <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> &amp;&amp; element != sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>)
<a name="l00358"></a>00358                         <span class="keywordflow">break</span>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360                     l = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00361"></a>00361                     luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00362"></a>00362                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[i].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00363"></a>00363                 }
<a name="l00364"></a>00364             }
<a name="l00365"></a>00365         }
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="comment">/*</span>
<a name="l00369"></a>00369 <span class="comment">     * Smooth Tool</span>
<a name="l00370"></a>00370 <span class="comment">     */</span>
<a name="l00371"></a>00371     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tool == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a91a2aeeee89d848ba383a1b6c16eec70">UV_SCULPT_TOOL_RELAX</a>) {
<a name="l00372"></a>00372         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> method = toolsettings-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b4892991f80f5a7cf71463f5008c8b2">uv_relax_method</a>;
<a name="l00373"></a>00373         <span class="keywordflow">if</span> (method == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1c8864077c8c93684fff5397463a7c4c">UV_SCULPT_TOOL_RELAX_HC</a>) {
<a name="l00374"></a>00374             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a027ac790f3b7d32829b43d8780fd28d7">HC_relaxation_iteration_uv</a>(em, sculptdata, co, alpha, radius, aspectRatio);
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         <span class="keywordflow">else</span> {
<a name="l00377"></a>00377             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ac5d5182ee8cc482a8181ac2ed1bca252">laplacian_relaxation_iteration_uv</a>(em, sculptdata, co, alpha, radius, aspectRatio);
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="comment">/*</span>
<a name="l00382"></a>00382 <span class="comment">     * Grab Tool</span>
<a name="l00383"></a>00383 <span class="comment">     */</span>
<a name="l00384"></a>00384     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tool == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae7f58246c6082772e6d952cdbf994b00">UV_SCULPT_TOOL_GRAB</a>) {
<a name="l00385"></a>00385         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00386"></a>00386         <span class="keywordtype">float</span> <a class="code" href="../../d0/dbc/namespaceKDL.html#a0227d72a9cfff5e6065944ebb04f9e77">diff</a>[2];
<a name="l00387"></a>00387         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(diff, co, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#a38645cf146b483b31dbbdfa0eda83307">init_coord</a>);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="keywordflow">for</span> (i = 0; i &lt; sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#aa6d165c91d97877d30d43aea0e7bddae">totalInitialSelected</a>; i++) {
<a name="l00390"></a>00390             <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element;
<a name="l00391"></a>00391             <span class="keywordtype">int</span> uvindex = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a4b4db7a07e12cc1f6c86f03a2e57c17f">uv</a>;
<a name="l00392"></a>00392             <span class="keywordtype">float</span> strength = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a102afd082627483080a96e665db2cfc3">strength</a>;
<a name="l00393"></a>00393             sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[uvindex].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[0] = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a62d37cf0e5d91286f27e27418c054cbd">initial_uv</a>[0] + strength * diff[0];
<a name="l00394"></a>00394             sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[uvindex].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>[1] = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a62d37cf0e5d91286f27e27418c054cbd">initial_uv</a>[1] + strength * diff[1];
<a name="l00395"></a>00395 
<a name="l00396"></a>00396             <span class="keywordflow">for</span> (element = sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[uvindex].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00397"></a>00397                 <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00398"></a>00398                 <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400                 <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> &amp;&amp; element != sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[uvindex].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a>)
<a name="l00401"></a>00401                     <span class="keywordflow">break</span>;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403                 l = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00404"></a>00404                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00405"></a>00405                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[uvindex].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00406"></a>00406             }
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">00412</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">timer</a>) {
<a name="l00416"></a>00416         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">timer</a>);
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>) {
<a name="l00419"></a>00419         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a6bc4a87bc02cc601eccb1a8b49d1978c">EDBM_uv_element_map_free</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>);
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>) {
<a name="l00422"></a>00422         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>);
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>) {
<a name="l00425"></a>00425         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>);
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>) {
<a name="l00428"></a>00428         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>) {
<a name="l00429"></a>00429             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>);
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data);
<a name="l00435"></a>00435     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#a9ff27a2d02bcc2fe886fad27e2a6cccf">00438</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a9ff27a2d02bcc2fe886fad27e2a6cccf">uv_element_offset_from_face_get</a>(<a class="code" href="../../db/d82/structUvElementMap.html">UvElementMap</a> *map, <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa, <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l, <span class="keywordtype">int</span> island_index, <span class="keywordtype">int</span> doIslands)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440     <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element = <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a0d1a9b0359ee055b73b023c83082c75c">ED_uv_element_get</a>(map, efa, l);
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (!element || (doIslands &amp;&amp; element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> != island_index)) {
<a name="l00442"></a>00442         <span class="keywordflow">return</span> -1;
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444     <span class="keywordflow">return</span> element - map-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>;
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#a5812823165bdda048d35c3600ef350bd">00448</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a5812823165bdda048d35c3600ef350bd">uv_edge_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key)
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450     <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *edge = (<a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *)key;
<a name="l00451"></a>00451     <span class="keywordflow">return</span> (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a740dc6d654384d5ad7097ffb19d3427c">BLI_ghashutil_inthash</a>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa6f58f8bcd4649b89458079eae9b1a1f">SET_INT_IN_POINTER</a>(edge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>)) +
<a name="l00452"></a>00452             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a740dc6d654384d5ad7097ffb19d3427c">BLI_ghashutil_inthash</a>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa6f58f8bcd4649b89458079eae9b1a1f">SET_INT_IN_POINTER</a>(edge-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>)));
<a name="l00453"></a>00453 }
<a name="l00454"></a>00454 
<a name="l00455"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#ac98881595f7c7fdd5530aac442dd969a">00455</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ac98881595f7c7fdd5530aac442dd969a">uv_edge_compare</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *edge1 = (<a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *)a;
<a name="l00458"></a>00458     <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *edge2 = (<a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *)b;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     <span class="keywordflow">if</span> ((edge1-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a> == edge2-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>) &amp;&amp; (edge1-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a> == edge2-&gt;<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>)) {
<a name="l00461"></a>00461         <span class="keywordflow">return</span> 0;
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463     <span class="keywordflow">return</span> 1;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#a2b477f6da0f7fe6278160b89c4b71f68">00467</a> <span class="keyword">static</span> <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *<a class="code" href="../../d8/da6/sculpt__uv_8c.html#a2b477f6da0f7fe6278160b89c4b71f68">uv_sculpt_stroke_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00470"></a>00470     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00471"></a>00471     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l00472"></a>00472     <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*data), <span class="stringliteral">&quot;UV Smooth Brush Data&quot;</span>);
<a name="l00473"></a>00473     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00474"></a>00474     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordflow">if</span> (data) {
<a name="l00479"></a>00479         <span class="keywordtype">int</span> counter = 0, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00480"></a>00480         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00481"></a>00481         <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[2];
<a name="l00482"></a>00482         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00483"></a>00483         <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00484"></a>00484         <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00485"></a>00485         <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         <a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *edges;
<a name="l00488"></a>00488         <a class="code" href="../../df/da0/structGHash.html">GHash</a> *edgeHash;
<a name="l00489"></a>00489         <a class="code" href="../../d2/d31/structGHashIterator.html">GHashIterator</a> *ghi;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         <span class="keywordtype">int</span> do_island_optimization = !(ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#afd8aa6aceb5b943d136b8fe47a987960">uv_sculpt_settings</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8763332fa9a03450b702b42e55b55786">UV_SCULPT_ALL_ISLANDS</a>);
<a name="l00492"></a>00492         <span class="keywordtype">int</span> island_index = 0;
<a name="l00493"></a>00493         <span class="comment">/* Holds, for each UvElement in elementMap, a pointer to its unique uv.*/</span>
<a name="l00494"></a>00494         <span class="keywordtype">int</span> *uniqueUv;
<a name="l00495"></a>00495         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#aef85f55dbd2ed5e8f9e334fd211da5f8">tool</a> = (<a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>) == <a class="code" href="../../d3/d6c/paint__intern_8h.html#a5b20103cf8d6df4544d910252d289ebca6c33c8ffa0feae581e285a613e7a65fe">BRUSH_STROKE_SMOOTH</a>) ? <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a91a2aeeee89d848ba383a1b6c16eec70">UV_SCULPT_TOOL_RELAX</a> : ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#afb53178ba8cbe2f1eb093a01c43f7a1f">uv_sculpt_tool</a>;
<a name="l00496"></a>00496         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a2dd82ca821912deb327a468d51244e56">invert</a> = (<a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>) == <a class="code" href="../../d3/d6c/paint__intern_8h.html#a5b20103cf8d6df4544d910252d289ebca926aec666db20807f318239004b21835">BRUSH_STROKE_INVERT</a>) ? 1 : 0;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">uvsculpt</a> = &amp;ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ae213655363e0b6c06991bc62b04c346c">uvsculpt</a>-&gt;<a class="code" href="../../d6/dcf/structUvSculpt.html#acc76f2f5b6ea63dc6951b306d23e7426">paint</a>;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500         <span class="keywordflow">if</span> (do_island_optimization) {
<a name="l00501"></a>00501             <span class="comment">/* We will need island information */</span>
<a name="l00502"></a>00502             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a13290558e3abc572fcfb0c4f66a8c95f">uv_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8db57005d53c7c86557cdfd7915b76e5">UV_SYNC_SELECTION</a>) {
<a name="l00503"></a>00503                 data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8c285246807828c108526a4b68dbd1ea">EDBM_uv_element_map_create</a>(em, 0, 1);
<a name="l00504"></a>00504             }
<a name="l00505"></a>00505             <span class="keywordflow">else</span> {
<a name="l00506"></a>00506                 data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8c285246807828c108526a4b68dbd1ea">EDBM_uv_element_map_create</a>(em, 1, 1);
<a name="l00507"></a>00507             }
<a name="l00508"></a>00508         }
<a name="l00509"></a>00509         <span class="keywordflow">else</span> {
<a name="l00510"></a>00510             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a13290558e3abc572fcfb0c4f66a8c95f">uv_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8db57005d53c7c86557cdfd7915b76e5">UV_SYNC_SELECTION</a>) {
<a name="l00511"></a>00511                 data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8c285246807828c108526a4b68dbd1ea">EDBM_uv_element_map_create</a>(em, 0, 0);
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513             <span class="keywordflow">else</span> {
<a name="l00514"></a>00514                 data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8c285246807828c108526a4b68dbd1ea">EDBM_uv_element_map_create</a>(em, 1, 0);
<a name="l00515"></a>00515             }
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>) {
<a name="l00519"></a>00519             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00520"></a>00520             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523         <span class="comment">/* Mouse coordinates, useful for some functions like grab and sculpt all islands */</span>
<a name="l00524"></a>00524         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1], &amp;co[0], &amp;co[1]);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="comment">/* we need to find the active island here */</span>
<a name="l00527"></a>00527         <span class="keywordflow">if</span> (do_island_optimization) {
<a name="l00528"></a>00528             <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element;
<a name="l00529"></a>00529             <a class="code" href="../../d3/d52/structNearestHit.html">NearestHit</a> hit;
<a name="l00530"></a>00530             <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima = <a class="code" href="../../df/d01/BKE__context_8h.html#aa4730d536a7c5b2bb40d3dd4f0048807">CTX_data_edit_image</a>(C);
<a name="l00531"></a>00531             <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a1f9be1f3228e38fbe12afa5e22491318">uv_find_nearest_vert</a>(scene, ima, em, co, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;hit);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533             element = <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a0d1a9b0359ee055b73b023c83082c75c">ED_uv_element_get</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>, hit.<a class="code" href="../../d3/d52/structNearestHit.html#a64d074a7f0cf24b5395f08755e4a0077">efa</a>, hit.<a class="code" href="../../d3/d52/structNearestHit.html#a0ab8977f5051a873a09477cbffc124f8">l</a>);
<a name="l00534"></a>00534             island_index = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a>;
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         <span class="comment">/* Count &#39;unique&#39; uvs */</span>
<a name="l00539"></a>00539         <span class="keywordflow">for</span> (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ad14f2ef387d634c54b24702b6d721239">totalUVs</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00540"></a>00540             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a> &amp;&amp;
<a name="l00541"></a>00541                 (!do_island_optimization || data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> == island_index))
<a name="l00542"></a>00542             {
<a name="l00543"></a>00543                 counter++;
<a name="l00544"></a>00544             }
<a name="l00545"></a>00545         }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="comment">/* Allocate the unique uv buffers */</span>
<a name="l00548"></a>00548         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>) * counter, <span class="stringliteral">&quot;uv_brush_unique_uvs&quot;</span>);
<a name="l00549"></a>00549         uniqueUv = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*uniqueUv) * data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ad14f2ef387d634c54b24702b6d721239">totalUVs</a>, <span class="stringliteral">&quot;uv_brush_unique_uv_map&quot;</span>);
<a name="l00550"></a>00550         edgeHash = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d8/da6/sculpt__uv_8c.html#a5812823165bdda048d35c3600ef350bd">uv_edge_hash</a>, <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ac98881595f7c7fdd5530aac442dd969a">uv_edge_compare</a>, <span class="stringliteral">&quot;uv_brush_edge_hash&quot;</span>);
<a name="l00551"></a>00551         <span class="comment">/* we have at most totalUVs edges */</span>
<a name="l00552"></a>00552         edges = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*edges) * data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ad14f2ef387d634c54b24702b6d721239">totalUVs</a>, <span class="stringliteral">&quot;uv_brush_all_edges&quot;</span>);
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a> || !uniqueUv || !edgeHash || !edges) {
<a name="l00554"></a>00554             <span class="keywordflow">if</span> (edges) {
<a name="l00555"></a>00555                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(edges);
<a name="l00556"></a>00556             }
<a name="l00557"></a>00557             <span class="keywordflow">if</span> (uniqueUv) {
<a name="l00558"></a>00558                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(uniqueUv);
<a name="l00559"></a>00559             }
<a name="l00560"></a>00560             <span class="keywordflow">if</span> (edgeHash) {
<a name="l00561"></a>00561                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(edgeHash);
<a name="l00562"></a>00562             }
<a name="l00563"></a>00563             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00564"></a>00564             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a> = counter;
<a name="l00568"></a>00568         <span class="comment">/* So that we can use this as index for the UvElements */</span>
<a name="l00569"></a>00569         counter = -1;
<a name="l00570"></a>00570         <span class="comment">/* initialize the unique UVs */</span>
<a name="l00571"></a>00571         <span class="keywordflow">for</span> (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; bm-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00572"></a>00572             <a class="code" href="../../d6/de7/structUvElement.html">UvElement</a> *element = data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#ac123587826d1496a20e72f927d7bedbc">vert</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00573"></a>00573             <span class="keywordflow">for</span> (; element; element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>) {
<a name="l00574"></a>00574                 <span class="keywordflow">if</span> (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a>) {
<a name="l00575"></a>00575                     <span class="keywordflow">if</span> (do_island_optimization &amp;&amp; (element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a102fc4c37c27b6df29404dbb82078ca8">island</a> != island_index)) {
<a name="l00576"></a>00576                         <span class="comment">/* skip this uv if not on the active island */</span>
<a name="l00577"></a>00577                         <span class="keywordflow">for</span> (; element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a> &amp;&amp; !(element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>-&gt;<a class="code" href="../../d6/de7/structUvElement.html#a54c156c591a236582193382f25f9993d">separate</a>); element = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#abf6b8a2c90c6577aa0d5248f87d7c610">next</a>)
<a name="l00578"></a>00578                             ;
<a name="l00579"></a>00579                         <span class="keywordflow">continue</span>;
<a name="l00580"></a>00580                     }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582                     l = element-&gt;<a class="code" href="../../d6/de7/structUvElement.html#af057590c940b05d03e248b552feb2a33">l</a>;
<a name="l00583"></a>00583                     luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585                     counter++;
<a name="l00586"></a>00586                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[counter].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93ccd1e380a38ecea7f7b4d839c9db73">element</a> = element;
<a name="l00587"></a>00587                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[counter].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> = 0;
<a name="l00588"></a>00588                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[counter].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a> = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00589"></a>00589                 }
<a name="l00590"></a>00590                 <span class="comment">/* pointer arithmetic to the rescue, as always :)*/</span>
<a name="l00591"></a>00591                 uniqueUv[element - data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>-&gt;<a class="code" href="../../db/d82/structUvElementMap.html#a39b6245a4534291baccabafe314a4fd2">buf</a>] = counter;
<a name="l00592"></a>00592             }
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <span class="comment">/* Now, on to generate our uv connectivity data */</span>
<a name="l00597"></a>00597         counter = 0;
<a name="l00598"></a>00598         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00599"></a>00599             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00600"></a>00600                 <span class="keywordtype">int</span> offset1, itmp1 = <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a9ff27a2d02bcc2fe886fad27e2a6cccf">uv_element_offset_from_face_get</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>, efa, l, island_index, do_island_optimization);
<a name="l00601"></a>00601                 <span class="keywordtype">int</span> offset2, itmp2 = <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a9ff27a2d02bcc2fe886fad27e2a6cccf">uv_element_offset_from_face_get</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a95071308e164149aab757b1fadc2aba4">elementMap</a>, efa, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#af78d4a4546e654c1dcc6ebe6476ff0b0">next</a>, island_index, do_island_optimization);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603                 <span class="comment">/* Skip edge if not found(unlikely) or not on valid island */</span>
<a name="l00604"></a>00604                 <span class="keywordflow">if</span> (itmp1 == -1 || itmp2 == -1)
<a name="l00605"></a>00605                     <span class="keywordflow">continue</span>;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607                 offset1 = uniqueUv[itmp1];
<a name="l00608"></a>00608                 offset2 = uniqueUv[itmp2];
<a name="l00609"></a>00609 
<a name="l00610"></a>00610                 edges[counter].<a class="code" href="../../d4/d1d/structUvEdge.html#a554667b3ffc0461a89194b745f89bb1e">flag</a> = 0;
<a name="l00611"></a>00611                 <span class="comment">/* using an order policy, sort uvs according to address space. This avoids</span>
<a name="l00612"></a>00612 <span class="comment">                 * Having two different UvEdges with the same uvs on different positions  */</span>
<a name="l00613"></a>00613                 <span class="keywordflow">if</span> (offset1 &lt; offset2) {
<a name="l00614"></a>00614                     edges[counter].<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a> = offset1;
<a name="l00615"></a>00615                     edges[counter].<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a> = offset2;
<a name="l00616"></a>00616                 }
<a name="l00617"></a>00617                 <span class="keywordflow">else</span> {
<a name="l00618"></a>00618                     edges[counter].<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a> = offset2;
<a name="l00619"></a>00619                     edges[counter].<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a> = offset1;
<a name="l00620"></a>00620                 }
<a name="l00621"></a>00621                 <span class="comment">/* Hack! Set the value of the key to its flag. Now we can set the flag when an edge exists twice :) */</span>
<a name="l00622"></a>00622                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#aaf17fe206dcb6b7b222b670b2a9570c1">BLI_ghash_haskey</a>(edgeHash, &amp;edges[counter])) {
<a name="l00623"></a>00623                     <span class="keywordtype">char</span> *flag = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(edgeHash, &amp;edges[counter]);
<a name="l00624"></a>00624                     *flag = 1;
<a name="l00625"></a>00625                 }
<a name="l00626"></a>00626                 <span class="keywordflow">else</span> {
<a name="l00627"></a>00627                     <span class="comment">/* Hack mentioned */</span>
<a name="l00628"></a>00628                     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(edgeHash, &amp;edges[counter], &amp;edges[counter].flag);
<a name="l00629"></a>00629                 }
<a name="l00630"></a>00630                 counter++;
<a name="l00631"></a>00631             }
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(uniqueUv);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <span class="comment">/* Allocate connectivity data, we allocate edges once */</span>
<a name="l00637"></a>00637         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>) * <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2f636817c33fecf8de5e18f30fba0879">BLI_ghash_size</a>(edgeHash), <span class="stringliteral">&quot;uv_brush_edge_connectivity_data&quot;</span>);
<a name="l00638"></a>00638         <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>) {
<a name="l00639"></a>00639             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(edgeHash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00640"></a>00640             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(edges);
<a name="l00641"></a>00641             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00642"></a>00642             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00643"></a>00643         }
<a name="l00644"></a>00644         ghi = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#aab164acbea58512dc40c74238f48e0c0">BLI_ghashIterator_new</a>(edgeHash);
<a name="l00645"></a>00645         <span class="keywordflow">if</span> (!ghi) {
<a name="l00646"></a>00646             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(edgeHash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00647"></a>00647             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(edges);
<a name="l00648"></a>00648             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00649"></a>00649             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00650"></a>00650         }
<a name="l00651"></a>00651         <span class="comment">/* fill the edges with data */</span>
<a name="l00652"></a>00652         <span class="keywordflow">for</span> (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; !<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a0eff6b7b74d72e06f7c125da5a46a5f1">BLI_ghashIterator_isDone</a>(ghi); <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2d3ebd2fe8ee454695c6387215e3e88a">BLI_ghashIterator_step</a>(ghi)) {
<a name="l00653"></a>00653             data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++] = *((<a class="code" href="../../d4/d1d/structUvEdge.html">UvEdge</a> *)<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a61c902d18de9cdd3785ef33e598d360f">BLI_ghashIterator_getKey</a>(ghi));
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655         data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">totalUvEdges</a> = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2f636817c33fecf8de5e18f30fba0879">BLI_ghash_size</a>(edgeHash);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657         <span class="comment">/* cleanup temporary stuff */</span>
<a name="l00658"></a>00658         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a3cc839e5e4e00419c6774832687e39c1">BLI_ghashIterator_free</a>(ghi);
<a name="l00659"></a>00659         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(edgeHash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00660"></a>00660         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(edges);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         <span class="comment">/* transfer boundary edge property to uvs */</span>
<a name="l00663"></a>00663         <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#afd8aa6aceb5b943d136b8fe47a987960">uv_sculpt_settings</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a853abe551c55a521793b6df3771a6e18">UV_SCULPT_LOCK_BORDERS</a>) {
<a name="l00664"></a>00664             <span class="keywordflow">for</span> (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab00efe1941958ff3c9e2c7600faaebbc">totalUvEdges</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00665"></a>00665                 <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d4/d1d/structUvEdge.html#a554667b3ffc0461a89194b745f89bb1e">flag</a>) {
<a name="l00666"></a>00666                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d4/d1d/structUvEdge.html#ad1c88c77487dfc8c2649dd1d3f520c69">uv1</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> |= <a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">MARK_BOUNDARY</a>;
<a name="l00667"></a>00667                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ab6235de1b94e8ebda948e10e8671b4c7">uvedges</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d4/d1d/structUvEdge.html#a129c7240f7afcc90902044395efc81b4">uv2</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> |= <a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">MARK_BOUNDARY</a>;
<a name="l00668"></a>00668                 }
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672         <span class="comment">/* Allocate initial selection for grab tool */</span>
<a name="l00673"></a>00673         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#aef85f55dbd2ed5e8f9e334fd211da5f8">tool</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae7f58246c6082772e6d952cdbf994b00">UV_SCULPT_TOOL_GRAB</a>) {
<a name="l00674"></a>00674             <span class="keywordtype">float</span> radius, radius_root;
<a name="l00675"></a>00675             <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *sculptdata = (<a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *)op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00676"></a>00676             <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima;
<a name="l00677"></a>00677             <span class="keywordtype">int</span> width, height;
<a name="l00678"></a>00678             <span class="keywordtype">float</span> aspectRatio;
<a name="l00679"></a>00679             <span class="keywordtype">float</span> alpha, zoomx, zoomy;
<a name="l00680"></a>00680             <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(sculptdata-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a6facadfd5373fdb6f08e4681bc937ad4">uvsculpt</a>);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682             alpha = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a9259092b9744db0b14e8a59954356d20">brush_alpha</a>(scene, brush);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684             radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(scene, brush);
<a name="l00685"></a>00685             sima = <a class="code" href="../../df/d01/BKE__context_8h.html#ae04ae450dc98cc5d253c49530f5a2dd6">CTX_wm_space_image</a>(C);
<a name="l00686"></a>00686             <a class="code" href="../../de/d53/ED__image_8h.html#a72aa9c6d1d329f0fce3b5c65b8698318">ED_space_image_size</a>(sima, &amp;width, &amp;height);
<a name="l00687"></a>00687             <a class="code" href="../../de/d53/ED__image_8h.html#a6902c4f28acdbce0b7080dbbfbcbc4aa">ED_space_image_zoom</a>(sima, ar, &amp;zoomx, &amp;zoomy);
<a name="l00688"></a>00688 
<a name="l00689"></a>00689             aspectRatio = width / (float)height;
<a name="l00690"></a>00690             radius /= (width * zoomx);
<a name="l00691"></a>00691             radius = radius * radius;
<a name="l00692"></a>00692             radius_root = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(radius);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694             <span class="comment">/* Allocate selection stack */</span>
<a name="l00695"></a>00695             data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>), <span class="stringliteral">&quot;uv_sculpt_initial_stroke&quot;</span>);
<a name="l00696"></a>00696             <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>) {
<a name="l00697"></a>00697                 <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00698"></a>00698             }
<a name="l00699"></a>00699             data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>) * data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>, <span class="stringliteral">&quot;uv_sculpt_initial_selection&quot;</span>);
<a name="l00700"></a>00700             <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>) {
<a name="l00701"></a>00701                 <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00702"></a>00702             }
<a name="l00703"></a>00703 
<a name="l00704"></a>00704             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#a38645cf146b483b31dbbdfa0eda83307">init_coord</a>, co);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706             counter = 0;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708             <span class="keywordflow">for</span> (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a4aa54c0e62bd2027291755d308a66f89">totalUniqueUvs</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00709"></a>00709                 <span class="keywordtype">float</span> dist, <a class="code" href="../../d0/dbc/namespaceKDL.html#a0227d72a9cfff5e6065944ebb04f9e77">diff</a>[2];
<a name="l00710"></a>00710                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#a93077920552ee4e669de145526bbf467">flag</a> &amp; <a class="code" href="../../d8/da6/sculpt__uv_8c.html#abe293272b9ff2cafdabc121a731f3e6a">MARK_BOUNDARY</a>) {
<a name="l00711"></a>00711                     <span class="keywordflow">continue</span>;
<a name="l00712"></a>00712                 }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab33aab525bc92b68e86d3fafda240f38">sub_v2_v2v2</a>(diff, data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>, co);
<a name="l00715"></a>00715                 diff[1] /= aspectRatio;
<a name="l00716"></a>00716                 <span class="keywordflow">if</span> ((dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a03e71ae06120f598c068aad6970015c2">dot_v2v2</a>(diff, diff)) &lt;= radius) {
<a name="l00717"></a>00717                     <span class="keywordtype">float</span> strength;
<a name="l00718"></a>00718                     strength = alpha * <a class="code" href="../../da/dc9/BKE__brush_8h.html#afcd6c828e3c28abab8e3aaf5f32b60d9">brush_curve_strength</a>(brush, <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(dist), radius_root);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[counter].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a4b4db7a07e12cc1f6c86f03a2e57c17f">uv</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00721"></a>00721                     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[counter].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a102afd082627483080a96e665db2cfc3">strength</a> = strength;
<a name="l00722"></a>00722                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#acdeffce76ca74015779137919f638547">initialSelection</a>[counter].<a class="code" href="../../d0/d2c/structUVInitialStrokeElement.html#a62d37cf0e5d91286f27e27418c054cbd">initial_uv</a>, data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a98c03c0d3914fdad6789699d2c56dccd">uv</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/db1/structUvAdjacencyElement.html#acc44b357c5fcc074d399693f4c4b28af">uv</a>);
<a name="l00723"></a>00723                     counter++;
<a name="l00724"></a>00724                 }
<a name="l00725"></a>00725             }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727             data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#a57add13476ca9cbd9bbfdb218131e781">initial_stroke</a>-&gt;<a class="code" href="../../dc/d7c/structUVInitialStroke.html#aa6d165c91d97877d30d43aea0e7bddae">totalInitialSelected</a> = counter;
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     <span class="keywordflow">return</span> op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#ae1427f77061899049d21038b52f83279">00734</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ae1427f77061899049d21038b52f83279">uv_sculpt_stroke_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00735"></a>00735 {
<a name="l00736"></a>00736     <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l00737"></a>00737     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <span class="keywordflow">if</span> (!(data = <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a2b477f6da0f7fe6278160b89c4b71f68">uv_sculpt_stroke_init</a>(C, op, event))) {
<a name="l00740"></a>00740         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a3c0acd093dae48780647dc3cf9fbf829">uv_sculpt_stroke_apply</a>(C, op, event, obedit);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">timer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, 0.001f);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">timer</a>) {
<a name="l00748"></a>00748         <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00749"></a>00749         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00750"></a>00750     }
<a name="l00751"></a>00751     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 
<a name="l00757"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad3f1cba027ca602da36fb66133b706eb">00757</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad3f1cba027ca602da36fb66133b706eb">uv_sculpt_stroke_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00758"></a>00758 {
<a name="l00759"></a>00759     <a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d6/d46/structUvSculptData.html">UvSculptData</a> *)op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00760"></a>00760     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l00763"></a>00763         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l00764"></a>00764         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l00765"></a>00765         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l00766"></a>00766             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad05ea6fe91d17952a60439dfc373e095">uv_sculpt_stroke_exit</a>(C, op);
<a name="l00767"></a>00767             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00768"></a>00768 
<a name="l00769"></a>00769         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l00770"></a>00770         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99234bdab7c4336e174cd0db37044412">INBETWEEN_MOUSEMOVE</a>:
<a name="l00771"></a>00771             <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a3c0acd093dae48780647dc3cf9fbf829">uv_sculpt_stroke_apply</a>(C, op, event, obedit);
<a name="l00772"></a>00772             <span class="keywordflow">break</span>;
<a name="l00773"></a>00773         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>:
<a name="l00774"></a>00774             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> == data-&gt;<a class="code" href="../../d6/d46/structUvSculptData.html#ad14b8730d1eecc0d3db138d5c2d8984c">timer</a>)
<a name="l00775"></a>00775                 <a class="code" href="../../d8/da6/sculpt__uv_8c.html#a3c0acd093dae48780647dc3cf9fbf829">uv_sculpt_stroke_apply</a>(C, op, event, obedit);
<a name="l00776"></a>00776             <span class="keywordflow">break</span>;
<a name="l00777"></a>00777         <span class="keywordflow">default</span>:
<a name="l00778"></a>00778             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00779"></a>00779     }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C));
<a name="l00782"></a>00782     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;data);
<a name="l00783"></a>00783     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;data, 0);
<a name="l00784"></a>00784     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00785"></a>00785 }
<a name="l00786"></a>00786 
<a name="l00787"></a><a class="code" href="../../d8/da6/sculpt__uv_8c.html#a5b5c1671677829844c391618bd0d4f77">00787</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d6c/paint__intern_8h.html#a5e3c0e8b800a260dbef4aaacb9f47a17">SCULPT_OT_uv_sculpt_stroke</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00788"></a>00788 {
<a name="l00789"></a>00789     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> stroke_mode_items[] = {
<a name="l00790"></a>00790         {<a class="code" href="../../d3/d6c/paint__intern_8h.html#a5b20103cf8d6df4544d910252d289ebca804d5607d23cafcdca43024e6a01d6b5">BRUSH_STROKE_NORMAL</a>, <span class="stringliteral">&quot;NORMAL&quot;</span>, 0, <span class="stringliteral">&quot;Normal&quot;</span>, <span class="stringliteral">&quot;Apply brush normally&quot;</span>},
<a name="l00791"></a>00791         {<a class="code" href="../../d3/d6c/paint__intern_8h.html#a5b20103cf8d6df4544d910252d289ebca926aec666db20807f318239004b21835">BRUSH_STROKE_INVERT</a>, <span class="stringliteral">&quot;INVERT&quot;</span>, 0, <span class="stringliteral">&quot;Invert&quot;</span>, <span class="stringliteral">&quot;Invert action of brush for duration of stroke&quot;</span>},
<a name="l00792"></a>00792         {<a class="code" href="../../d3/d6c/paint__intern_8h.html#a5b20103cf8d6df4544d910252d289ebca6c33c8ffa0feae581e285a613e7a65fe">BRUSH_STROKE_SMOOTH</a>, <span class="stringliteral">&quot;RELAX&quot;</span>, 0, <span class="stringliteral">&quot;Relax&quot;</span>, <span class="stringliteral">&quot;Switch brush to relax mode for duration of stroke&quot;</span>},
<a name="l00793"></a>00793         {0}
<a name="l00794"></a>00794     };
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     <span class="comment">/* identifiers */</span>
<a name="l00797"></a>00797     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Sculpt UVs&quot;</span>;
<a name="l00798"></a>00798     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Sculpt UVs using a brush&quot;</span>;
<a name="l00799"></a>00799     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SCULPT_OT_uv_sculpt_stroke&quot;</span>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     <span class="comment">/* api callbacks */</span>
<a name="l00802"></a>00802     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ae1427f77061899049d21038b52f83279">uv_sculpt_stroke_invoke</a>;
<a name="l00803"></a>00803     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d8/da6/sculpt__uv_8c.html#ad3f1cba027ca602da36fb66133b706eb">uv_sculpt_stroke_modal</a>;
<a name="l00804"></a>00804     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d60/paint__image_8c.html#a5b1d224c1c1ca030412d0f1a7b09105b">uv_sculpt_poll</a>;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="comment">/* flags */</span>
<a name="l00807"></a>00807     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="comment">/* props */</span>
<a name="l00810"></a>00810     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, stroke_mode_items, <a class="code" href="../../d3/d6c/paint__intern_8h.html#a5b20103cf8d6df4544d910252d289ebca804d5607d23cafcdca43024e6a01d6b5">BRUSH_STROKE_NORMAL</a>, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;Stroke Mode&quot;</span>);
<a name="l00811"></a>00811 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:53 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: btSoftBody.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">btSoftBody.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../de/db6/btSoftBody_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">Bullet Continuous Collision Detection and Physics Library</span>
<a name="l00003"></a>00003 <span class="comment">Copyright (c) 2003-2006 Erwin Coumans  http://continuousphysics.com/Bullet/</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">This software is provided &#39;as-is&#39;, without any express or implied warranty.</span>
<a name="l00006"></a>00006 <span class="comment">In no event will the authors be held liable for any damages arising from the use of this software.</span>
<a name="l00007"></a>00007 <span class="comment">Permission is granted to anyone to use this software for any purpose,</span>
<a name="l00008"></a>00008 <span class="comment">including commercial applications, and to alter it and redistribute it freely,</span>
<a name="l00009"></a>00009 <span class="comment">subject to the following restrictions:</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">1. The origin of this software must not be misrepresented; you must not claim that you wrote the original software. If you use this software in a product, an acknowledgment in the product documentation would be appreciated but is not required.</span>
<a name="l00012"></a>00012 <span class="comment">2. Altered source versions must be plainly marked as such, and must not be misrepresented as being the original software.</span>
<a name="l00013"></a>00013 <span class="comment">3. This notice may not be removed or altered from any source distribution.</span>
<a name="l00014"></a>00014 <span class="comment">*/</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html">btSoftBodyInternals.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d60/btSoftBodySolvers_8h.html">BulletSoftBody/btSoftBodySolvers.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d46/btSoftBodyData_8h.html">btSoftBodyData.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df0/btSerializer_8h.html">LinearMath/btSerializer.h</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">//</span>
<a name="l00023"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a842480e0f75b82a50f0e5e606e2ac40b">00023</a> <a class="code" href="../../da/d60/classbtSoftBody.html#a842480e0f75b82a50f0e5e606e2ac40b" title="btSoftBody implementation by Nathanael Presson">btSoftBody::btSoftBody</a>(<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html">btSoftBodyWorldInfo</a>* worldInfo,<span class="keywordtype">int</span> node_count,  <span class="keyword">const</span> btVector3* x,  <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>* m)
<a name="l00024"></a>00024 :m_worldInfo(worldInfo),m_softBodySolver(0)
<a name="l00025"></a>00025 {   
<a name="l00026"></a>00026     <span class="comment">/* Init     */</span> 
<a name="l00027"></a>00027     <a class="code" href="../../da/d60/classbtSoftBody.html#ae07c09d9c2937897c3690c1a3970bf61">initDefaults</a>();
<a name="l00028"></a>00028 
<a name="l00029"></a>00029     <span class="comment">/* Default material */</span> 
<a name="l00030"></a>00030     <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>*   pm=<a class="code" href="../../da/d60/classbtSoftBody.html#a9f982578b7de055039a75e5904152b6d">appendMaterial</a>();
<a name="l00031"></a>00031     pm-&gt;<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html#adf4cb9a81ab3ce7fdb7297fb482fd9a8">m_kLST</a>  =   1;
<a name="l00032"></a>00032     pm-&gt;<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html#a1875797b002c5248c90f42fbee349a43">m_kAST</a>  =   1;
<a name="l00033"></a>00033     pm-&gt;<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html#ab86b682fc529ec4f315dbea2f87a7b29">m_kVST</a>  =   1;
<a name="l00034"></a>00034     pm-&gt;<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html#a1822a2a9a82241735e84531f59dc118c">m_flags</a> =   <a class="code" href="../../d9/dbe/structbtSoftBody_1_1fMaterial.html#a6cc6df1c89b51761f169222062ec5ca8af84f8e3bf24e47554c5278e654ddc0bb" title="Enable debug draw.">fMaterial::Default</a>;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036     <span class="comment">/* Nodes            */</span> 
<a name="l00037"></a>00037     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      margin=getCollisionShape()-&gt;getMargin();
<a name="l00038"></a>00038     <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(node_count);
<a name="l00039"></a>00039     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=node_count;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00040"></a>00040     {   
<a name="l00041"></a>00041         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00042"></a>00042         <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(n);
<a name="l00043"></a>00043         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>       =   x?*x++:btVector3(0,0,0);
<a name="l00044"></a>00044         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>       =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>;
<a name="l00045"></a>00045         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>      =   m?*m++:1;
<a name="l00046"></a>00046         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>      =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0?1/n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>:0;
<a name="l00047"></a>00047         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#acca6a5b8479e45c00e07b68cdc482f3f">m_leaf</a>    =   <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a0efd4485566228688870dc7340365d03">insert</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a6b9b2b5b6361d2b56285ce18733e2092">btDbvtVolume::FromCR</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,margin),&amp;n);
<a name="l00048"></a>00048         n.<a class="code" href="../../de/d54/structbtSoftBody_1_1Feature.html#ae24af9323abfd07bc80ad26634c1b360">m_material</a>=   pm;
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050     <a class="code" href="../../da/d60/classbtSoftBody.html#aee48603cdeeb5cee57f6a210b135294b">updateBounds</a>(); 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a63dc6650741946528320f46770e20519">00054</a> <a class="code" href="../../da/d60/classbtSoftBody.html#a842480e0f75b82a50f0e5e606e2ac40b" title="btSoftBody implementation by Nathanael Presson">btSoftBody::btSoftBody</a>(<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html">btSoftBodyWorldInfo</a>* worldInfo)
<a name="l00055"></a>00055 :m_worldInfo(worldInfo)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057     <a class="code" href="../../da/d60/classbtSoftBody.html#ae07c09d9c2937897c3690c1a3970bf61">initDefaults</a>();
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ae07c09d9c2937897c3690c1a3970bf61">00061</a> <span class="keywordtype">void</span>    <a class="code" href="../../da/d60/classbtSoftBody.html#ae07c09d9c2937897c3690c1a3970bf61">btSoftBody::initDefaults</a>()
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063     m_internalType      =   CO_SOFT_BODY;
<a name="l00064"></a>00064     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a91b7375ace054ae67744aa417579dfa3">aeromodel</a>     =   <a class="code" href="../../d0/df3/structbtSoftBody_1_1eAeroModel.html#a147f4e50f7cfaa2855b5ea5b4b2986aeadcfaa831ddbd8fd6b2b2320a68561e59">eAeroModel::V_Point</a>;
<a name="l00065"></a>00065     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a18eec41b81c8a86632b2c9b1892ae462">kVCF</a>          =   1;
<a name="l00066"></a>00066     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a00138980dda3355a50e2f5d79107d772">kDG</a>           =   0;
<a name="l00067"></a>00067     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aaf819d51d8c1774bd5629965fbd53be6">kLF</a>           =   0;
<a name="l00068"></a>00068     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a307cb6ef5523b702defdbabe51ec9603">kDP</a>           =   0;
<a name="l00069"></a>00069     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a659a04711566fac7268d50c1c7384035">kPR</a>           =   0;
<a name="l00070"></a>00070     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a6057779d5267a9e600bb4055d1f7f2c2">kVC</a>           =   0;
<a name="l00071"></a>00071     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a313daa4181e892f93d51114493b5f96c">kDF</a>           =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.2;
<a name="l00072"></a>00072     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a8e9d39cceaf15fd8697b2f8831b2fee1">kMT</a>           =   0;
<a name="l00073"></a>00073     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a2d2bb11122dd2d69d03b8c700bbf0209">kCHR</a>          =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)1.0;
<a name="l00074"></a>00074     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a11c864538713216f8d34bb45d580bbbd">kKHR</a>          =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.1;
<a name="l00075"></a>00075     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#acb51a580d7316fda20f3b6dac911bfda">kSHR</a>          =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)1.0;
<a name="l00076"></a>00076     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#af4a43c3b3d4cec8f9bdfb1178d7ae5e1">kAHR</a>          =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.7;
<a name="l00077"></a>00077     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a6e930bc1e762885278b675270aad60dc">kSRHR_CL</a>      =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.1;
<a name="l00078"></a>00078     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a0afa82b3f6f99b24dcbb0b9c98876564">kSKHR_CL</a>      =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)1;
<a name="l00079"></a>00079     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a5b724a41c05818106ac4cc9bb14d29cf">kSSHR_CL</a>      =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.5;
<a name="l00080"></a>00080     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#ab3cbac97cbdf11526621854596809f2f">kSR_SPLT_CL</a>   =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.5;
<a name="l00081"></a>00081     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a76fab5d763ac8b5f7a7a29e05f008af1">kSK_SPLT_CL</a>   =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.5;
<a name="l00082"></a>00082     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a77f98dda946550d73c4eb858ffb82aee">kSS_SPLT_CL</a>   =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.5;
<a name="l00083"></a>00083     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a07d5c0b7c84c8e384eb4039b60496657">maxvolume</a>     =   (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)1;
<a name="l00084"></a>00084     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aca2a21b06d44629ad4d1fc0bb4d8a93d">timescale</a>     =   1;
<a name="l00085"></a>00085     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aba421ab9d7267825bacabf8a0faa7e23">viterations</a>   =   0;
<a name="l00086"></a>00086     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a281a562a273f8d02f9b7354aa1bf1c86">piterations</a>   =   1;  
<a name="l00087"></a>00087     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a2308fe57ad7f38ca9a2f5fe934156f6c">diterations</a>   =   0;
<a name="l00088"></a>00088     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a120909b8c9563169d6457cc9e00a885d">citerations</a>   =   4;
<a name="l00089"></a>00089     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>    =   <a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a1c6fb7a4f36642982c053815889133e5" title="Cluster soft body self collision.">fCollision::Default</a>;
<a name="l00090"></a>00090     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a359673dbb1d50f586ae6e77924e9d8ac">m_bvolume</a>    =   <span class="keyword">false</span>;
<a name="l00091"></a>00091     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#adf09c94d97fb44f3b88c3b1832776766">m_bframe</a>     =   <span class="keyword">false</span>;
<a name="l00092"></a>00092     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a4806127851c12e3df29b1097aa3723c9">m_volume</a>     =   0;
<a name="l00093"></a>00093     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a5083f27c5671f4ff377a6ee4d601ec6e">m_com</a>        =   btVector3(0,0,0);
<a name="l00094"></a>00094     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ac84ae4951c58adeee86b8e6113f2e2d2">m_rot</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a6e15db8fa9ca470e00f3cada4b480fca" title="Set the matrix to the identity.">setIdentity</a>();
<a name="l00095"></a>00095     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a15a4fa7fa548a96678aae8dc8e259d34">m_scl</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a6e15db8fa9ca470e00f3cada4b480fca" title="Set the matrix to the identity.">setIdentity</a>();
<a name="l00096"></a>00096     <a class="code" href="../../da/d60/classbtSoftBody.html#abd99c0f3e6d2a2e227d38421374ce173">m_tag</a>               =   0;
<a name="l00097"></a>00097     <a class="code" href="../../da/d60/classbtSoftBody.html#a3be50e0cde03af244eb7103a45ed52c3">m_timeacc</a>           =   0;
<a name="l00098"></a>00098     <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>      =   <span class="keyword">true</span>;
<a name="l00099"></a>00099     <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[0]         =   btVector3(0,0,0);
<a name="l00100"></a>00100     <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[1]         =   btVector3(0,0,0);
<a name="l00101"></a>00101     m_worldTransform.setIdentity();
<a name="l00102"></a>00102     <a class="code" href="../../da/d60/classbtSoftBody.html#a9da956f8d824e44cae9f8b37eff54c19">setSolver</a>(<a class="code" href="../../d2/de0/structbtSoftBody_1_1eSolverPresets.html#aca9f468831b5ac0c35998d8202caf049af1728cbce35d234df528955500cd9182">eSolverPresets::Positions</a>);
<a name="l00103"></a>00103     
<a name="l00104"></a>00104     <span class="comment">/* Collision shape  */</span> 
<a name="l00106"></a>00106     m_collisionShape = <span class="keyword">new</span> <a class="code" href="../../d1/d5a/classbtSoftBodyCollisionShape.html">btSoftBodyCollisionShape</a>(<span class="keyword">this</span>);
<a name="l00107"></a>00107     m_collisionShape-&gt;setMargin(0.25);
<a name="l00108"></a>00108     
<a name="l00109"></a>00109     <a class="code" href="../../da/d60/classbtSoftBody.html#a62f3be93755bd2e1f30bed79a9f72cac">m_initialWorldTransform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#ac95a4f502585b3c896001eb236293ce5" title="Set this transformation to the identity.">setIdentity</a>();
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <a class="code" href="../../da/d60/classbtSoftBody.html#ad02496af28d6bf408a736ee3e5f05c32">m_windVelocity</a> = btVector3(0,0,0);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">//</span>
<a name="l00116"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad88f317bd0b243a458bb7380f26631c7">00116</a> <a class="code" href="../../da/d60/classbtSoftBody.html#ad88f317bd0b243a458bb7380f26631c7">btSoftBody::~btSoftBody</a>()
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="comment">//for now, delete the internal shape</span>
<a name="l00119"></a>00119     <span class="keyword">delete</span> m_collisionShape;    
<a name="l00120"></a>00120     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <a class="code" href="../../da/d60/classbtSoftBody.html#a9acc6f49f29e890115e42c4deec24f85">releaseClusters</a>();
<a name="l00123"></a>00123     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) 
<a name="l00124"></a>00124         <a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a053f25687d0cd7a29571c8669cf9bcd4">btAlignedFree</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>[i]);
<a name="l00125"></a>00125     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) 
<a name="l00126"></a>00126         <a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a053f25687d0cd7a29571c8669cf9bcd4">btAlignedFree</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[i]);
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">//</span>
<a name="l00130"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a709f4801dc0963cc780d53bb005aba8c">00130</a> <span class="keywordtype">bool</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a709f4801dc0963cc780d53bb005aba8c">btSoftBody::checkLink</a>(<span class="keywordtype">int</span> node0,<span class="keywordtype">int</span> node1)<span class="keyword"> const</span>
<a name="l00131"></a>00131 <span class="keyword"></span>{
<a name="l00132"></a>00132     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a709f4801dc0963cc780d53bb005aba8c">checkLink</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0],&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1]));
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">//</span>
<a name="l00136"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a96d6c58efa61a72ef77b78a6c644a12e">00136</a> <span class="keywordtype">bool</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a709f4801dc0963cc780d53bb005aba8c">btSoftBody::checkLink</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* node0,<span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* node1)<span class="keyword"> const</span>
<a name="l00137"></a>00137 <span class="keyword"></span>{
<a name="l00138"></a>00138     <span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* n[]={node0,node1};
<a name="l00139"></a>00139     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00140"></a>00140     {
<a name="l00141"></a>00141         <span class="keyword">const</span> <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp; l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00142"></a>00142         <span class="keywordflow">if</span>( (l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]==n[0]&amp;&amp;l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]==n[1])||
<a name="l00143"></a>00143             (l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]==n[1]&amp;&amp;l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]==n[0]))
<a name="l00144"></a>00144         {
<a name="l00145"></a>00145             <span class="keywordflow">return</span>(<span class="keyword">true</span>);
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148     <span class="keywordflow">return</span>(<span class="keyword">false</span>);
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment">//</span>
<a name="l00152"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a6802ec1cd5bd9718e09ed9da92537b2d">00152</a> <span class="keywordtype">bool</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a6802ec1cd5bd9718e09ed9da92537b2d">btSoftBody::checkFace</a>(<span class="keywordtype">int</span> node0,<span class="keywordtype">int</span> node1,<span class="keywordtype">int</span> node2)<span class="keyword"> const</span>
<a name="l00153"></a>00153 <span class="keyword"></span>{
<a name="l00154"></a>00154     <span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* n[]={   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0],
<a name="l00155"></a>00155         &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1],
<a name="l00156"></a>00156         &amp;m_nodes[node2]};
<a name="l00157"></a>00157     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00158"></a>00158     {
<a name="l00159"></a>00159         <span class="keyword">const</span> <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp; f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00160"></a>00160         <span class="keywordtype">int</span>         c=0;
<a name="l00161"></a>00161         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j)
<a name="l00162"></a>00162         {
<a name="l00163"></a>00163             <span class="keywordflow">if</span>( (f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j]==n[0])||
<a name="l00164"></a>00164                 (f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j]==n[1])||
<a name="l00165"></a>00165                 (f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j]==n[2])) c|=1&lt;&lt;j; <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l00166"></a>00166         }
<a name="l00167"></a>00167         <span class="keywordflow">if</span>(c==7) <span class="keywordflow">return</span>(<span class="keyword">true</span>);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169     <span class="keywordflow">return</span>(<span class="keyword">false</span>);
<a name="l00170"></a>00170 }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="comment">//</span>
<a name="l00173"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9f982578b7de055039a75e5904152b6d">00173</a> <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">btSoftBody::Material</a>*       <a class="code" href="../../da/d60/classbtSoftBody.html#a9f982578b7de055039a75e5904152b6d">btSoftBody::appendMaterial</a>()
<a name="l00174"></a>00174 {
<a name="l00175"></a>00175     <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>*   pm=<span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>),16)) <a class="code" href="../../de/db2/DNA__material__types_8h.html#a03ae9476d7167e86530070e50b6fad6d">Material</a>();
<a name="l00176"></a>00176     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()&gt;0)
<a name="l00177"></a>00177         *pm=*<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>[0];
<a name="l00178"></a>00178     <span class="keywordflow">else</span>
<a name="l00179"></a>00179         <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(*pm);
<a name="l00180"></a>00180     <a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(pm);
<a name="l00181"></a>00181     <span class="keywordflow">return</span>(pm);
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">//</span>
<a name="l00185"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">00185</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">btSoftBody::appendNote</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* text,
<a name="l00186"></a>00186                                        <span class="keyword">const</span> btVector3&amp; o,
<a name="l00187"></a>00187                                        <span class="keyword">const</span> <a class="code" href="../../d0/d9d/classbtVector4.html">btVector4</a>&amp; c,
<a name="l00188"></a>00188                                        <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* n0,
<a name="l00189"></a>00189                                        <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* n1,
<a name="l00190"></a>00190                                        <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* n2,
<a name="l00191"></a>00191                                        <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* n3)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193     <a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html">Note</a>    n;
<a name="l00194"></a>00194     <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(n);
<a name="l00195"></a>00195     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aa01e3e06ddf3ed1539b501fec0d25332">m_rank</a>        =   0;
<a name="l00196"></a>00196     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#adfb1568162e3a01e73c226e1727c7468">m_text</a>        =   text;
<a name="l00197"></a>00197     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#a8fec523bbe4d172e0e783ed7a9bd3a7e">m_offset</a>      =   o;
<a name="l00198"></a>00198     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#a68226826ba138cc3ecb6968857821726">m_coords</a>[0]   =   c.x();
<a name="l00199"></a>00199     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#a68226826ba138cc3ecb6968857821726">m_coords</a>[1]   =   c.y();
<a name="l00200"></a>00200     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#a68226826ba138cc3ecb6968857821726">m_coords</a>[2]   =   c.z();
<a name="l00201"></a>00201     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#a68226826ba138cc3ecb6968857821726">m_coords</a>[3]   =   c.w();
<a name="l00202"></a>00202     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aca99ac080d4282d94667fd9d527914c2">m_nodes</a>[0]    =   n0;n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aa01e3e06ddf3ed1539b501fec0d25332">m_rank</a>+=n0?1:0;
<a name="l00203"></a>00203     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aca99ac080d4282d94667fd9d527914c2">m_nodes</a>[1]    =   n1;n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aa01e3e06ddf3ed1539b501fec0d25332">m_rank</a>+=n1?1:0;
<a name="l00204"></a>00204     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aca99ac080d4282d94667fd9d527914c2">m_nodes</a>[2]    =   n2;n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aa01e3e06ddf3ed1539b501fec0d25332">m_rank</a>+=n2?1:0;
<a name="l00205"></a>00205     n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aca99ac080d4282d94667fd9d527914c2">m_nodes</a>[3]    =   n3;n.<a class="code" href="../../de/d50/structbtSoftBody_1_1Note.html#aa01e3e06ddf3ed1539b501fec0d25332">m_rank</a>+=n3?1:0;
<a name="l00206"></a>00206     <a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(n);
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="comment">//</span>
<a name="l00210"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a5c4f5428c421191e55babc34b4672924">00210</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">btSoftBody::appendNote</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* text,
<a name="l00211"></a>00211                                        <span class="keyword">const</span> btVector3&amp; o,
<a name="l00212"></a>00212                                        <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* feature)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214     <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">appendNote</a>(text,o,<a class="code" href="../../d0/d9d/classbtVector4.html">btVector4</a>(1,0,0,0),feature);
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="comment">//</span>
<a name="l00218"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aa71ccf539cb5b4e79d6b07a6f503af65">00218</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">btSoftBody::appendNote</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* text,
<a name="l00219"></a>00219                                        <span class="keyword">const</span> btVector3&amp; o,
<a name="l00220"></a>00220                                        <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>* feature)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>   w=1/(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)2;
<a name="l00223"></a>00223     <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">appendNote</a>(text,o,<a class="code" href="../../d0/d9d/classbtVector4.html">btVector4</a>(w,w,0,0),   feature-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0],
<a name="l00224"></a>00224         feature-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="comment">//</span>
<a name="l00228"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a15285f0ac6eb1d24a25b58cd05eefb39">00228</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">btSoftBody::appendNote</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* text,
<a name="l00229"></a>00229                                        <span class="keyword">const</span> btVector3&amp; o,
<a name="l00230"></a>00230                                        <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>* feature)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>   w=1/(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)3;
<a name="l00233"></a>00233     <a class="code" href="../../da/d60/classbtSoftBody.html#aa672f32eb59763f5175c7f823615db98">appendNote</a>(text,o,<a class="code" href="../../d0/d9d/classbtVector4.html">btVector4</a>(w,w,w,0),   feature-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0],
<a name="l00234"></a>00234         feature-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1],
<a name="l00235"></a>00235         feature-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">//</span>
<a name="l00239"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a6259e16009323fc8e936966b1fba1324">00239</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a6259e16009323fc8e936966b1fba1324">btSoftBody::appendNode</a>( <span class="keyword">const</span> btVector3&amp; x,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> m)
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#afcfda91263ff04e1efcbe62bf68e2d1d" title="return the pre-allocated (reserved) elements, this is at least as large as the total number of elemen...">capacity</a>()==<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243         <a class="code" href="../../da/d60/classbtSoftBody.html#ab0c0d590f7b945029af1f5afc26b58ab">pointersToIndices</a>();
<a name="l00244"></a>00244         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a0bcdc850355c6742c66d50b16b102d9d">reserve</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()*2+1);
<a name="l00245"></a>00245         <a class="code" href="../../da/d60/classbtSoftBody.html#ae7d0c0ae69ea5801118a049f590fe703">indicesToPointers</a>();
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  margin=getCollisionShape()-&gt;getMargin();
<a name="l00248"></a>00248     <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../dc/d4c/rayobject__octree_8cpp.html#a0466fc5f1bc9e6de776e48149b19c471">Node</a>());
<a name="l00249"></a>00249     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1];
<a name="l00250"></a>00250     <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(n);
<a name="l00251"></a>00251     n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>           =   x;
<a name="l00252"></a>00252     n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>           =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>;
<a name="l00253"></a>00253     n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>          =   m&gt;0?1/m:0;
<a name="l00254"></a>00254     n.<a class="code" href="../../de/d54/structbtSoftBody_1_1Feature.html#ae24af9323abfd07bc80ad26634c1b360">m_material</a>    =   <a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>[0];
<a name="l00255"></a>00255     n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#acca6a5b8479e45c00e07b68cdc482f3f">m_leaf</a>        =   <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a0efd4485566228688870dc7340365d03">insert</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a6b9b2b5b6361d2b56285ce18733e2092">btDbvtVolume::FromCR</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,margin),&amp;n);
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="comment">//</span>
<a name="l00259"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">00259</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">btSoftBody::appendLink</a>(<span class="keywordtype">int</span> model,<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261     <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>    l;
<a name="l00262"></a>00262     <span class="keywordflow">if</span>(model&gt;=0)
<a name="l00263"></a>00263         l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[model];
<a name="l00264"></a>00264     <span class="keywordflow">else</span>
<a name="l00265"></a>00265     { <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(l);l.<a class="code" href="../../de/d54/structbtSoftBody_1_1Feature.html#ae24af9323abfd07bc80ad26634c1b360">m_material</a>=mat?mat:<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>[0]; }
<a name="l00266"></a>00266     <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(l);
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="comment">//</span>
<a name="l00270"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9af70d96f1962fe82baec96ef236010d">00270</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">btSoftBody::appendLink</a>( <span class="keywordtype">int</span> node0,
<a name="l00271"></a>00271                                        <span class="keywordtype">int</span> node1,
<a name="l00272"></a>00272                                        <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat,
<a name="l00273"></a>00273                                        <span class="keywordtype">bool</span> bcheckexist)
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275     <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0],&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1],mat,bcheckexist);
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">//</span>
<a name="l00279"></a><a class="code" href="../../da/d60/classbtSoftBody.html#acf014be8167a550f227ae1b366ef3337">00279</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">btSoftBody::appendLink</a>( <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* node0,
<a name="l00280"></a>00280                                        <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* node1,
<a name="l00281"></a>00281                                        <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat,
<a name="l00282"></a>00282                                        <span class="keywordtype">bool</span> bcheckexist)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <span class="keywordflow">if</span>((!bcheckexist)||(!<a class="code" href="../../da/d60/classbtSoftBody.html#a709f4801dc0963cc780d53bb005aba8c">checkLink</a>(node0,node1)))
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286         <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(-1,mat);
<a name="l00287"></a>00287         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;   l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1];
<a name="l00288"></a>00288         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]        =   node0;
<a name="l00289"></a>00289         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]        =   node1;
<a name="l00290"></a>00290         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ae817453c9089ab7e0ddfa32b300b0d8a">m_rl</a>          =   (l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>).<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>();
<a name="l00291"></a>00291         <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">true</span>;
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="comment">//</span>
<a name="l00296"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a1a89dadf0b4a8d9553d5e2263c034b07">00296</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a1a89dadf0b4a8d9553d5e2263c034b07">btSoftBody::appendFace</a>(<span class="keywordtype">int</span> model,<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298     <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>    f;
<a name="l00299"></a>00299     <span class="keywordflow">if</span>(model&gt;=0)
<a name="l00300"></a>00300     { f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[model]; }
<a name="l00301"></a>00301     <span class="keywordflow">else</span>
<a name="l00302"></a>00302     { <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(f);f.<a class="code" href="../../de/d54/structbtSoftBody_1_1Feature.html#ae24af9323abfd07bc80ad26634c1b360">m_material</a>=mat?mat:<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>[0]; }
<a name="l00303"></a>00303     <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(f);
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">//</span>
<a name="l00307"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad1fb030a3cce3125ba51533eaf6cb949">00307</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a1a89dadf0b4a8d9553d5e2263c034b07">btSoftBody::appendFace</a>(<span class="keywordtype">int</span> node0,<span class="keywordtype">int</span> node1,<span class="keywordtype">int</span> node2,<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat)
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309     <span class="keywordflow">if</span> (node0==node1)
<a name="l00310"></a>00310         <span class="keywordflow">return</span>;
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (node1==node2)
<a name="l00312"></a>00312         <span class="keywordflow">return</span>;
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (node2==node0)
<a name="l00314"></a>00314         <span class="keywordflow">return</span>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <a class="code" href="../../da/d60/classbtSoftBody.html#a1a89dadf0b4a8d9553d5e2263c034b07">appendFace</a>(-1,mat);
<a name="l00317"></a>00317     <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;   f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1];
<a name="l00318"></a>00318     <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(node0!=node1);
<a name="l00319"></a>00319     <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(node1!=node2);
<a name="l00320"></a>00320     <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(node2!=node0);
<a name="l00321"></a>00321     f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0];
<a name="l00322"></a>00322     f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1];
<a name="l00323"></a>00323     f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node2];
<a name="l00324"></a>00324     f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#a644dbb11481a1f0a54a6b1b47e29cf0a">m_ra</a>      =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a4abf663bbb87e98cbf9a90d299ae248b">AreaOf</a>( f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l00325"></a>00325         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l00326"></a>00326         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>); 
<a name="l00327"></a>00327     <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">true</span>;
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">//</span>
<a name="l00331"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a3d88c896f533e9ea942c746bee29711b">00331</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a3d88c896f533e9ea942c746bee29711b">btSoftBody::appendTetra</a>(<span class="keywordtype">int</span> model,<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat)
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333 <a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html">Tetra</a>   t;
<a name="l00334"></a>00334 <span class="keywordflow">if</span>(model&gt;=0)
<a name="l00335"></a>00335     t=<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>[model];
<a name="l00336"></a>00336     <span class="keywordflow">else</span>
<a name="l00337"></a>00337     { <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a2e796d56624fb0dc9e28ee81995e92ab">ZeroInitialize</a>(t);t.<a class="code" href="../../de/d54/structbtSoftBody_1_1Feature.html#ae24af9323abfd07bc80ad26634c1b360">m_material</a>=mat?mat:<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>[0]; }
<a name="l00338"></a>00338 <a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(t);
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="comment">//</span>
<a name="l00342"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9b56ea716ed865fdfb78aa2b2ec6952a">00342</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a3d88c896f533e9ea942c746bee29711b">btSoftBody::appendTetra</a>(<span class="keywordtype">int</span> node0,
<a name="l00343"></a>00343                                         <span class="keywordtype">int</span> node1,
<a name="l00344"></a>00344                                         <span class="keywordtype">int</span> node2,
<a name="l00345"></a>00345                                         <span class="keywordtype">int</span> node3,
<a name="l00346"></a>00346                                         <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <a class="code" href="../../da/d60/classbtSoftBody.html#a3d88c896f533e9ea942c746bee29711b">appendTetra</a>(-1,mat);
<a name="l00349"></a>00349     <a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html">Tetra</a>&amp;  t=<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1];
<a name="l00350"></a>00350     t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[0]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0];
<a name="l00351"></a>00351     t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[1]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1];
<a name="l00352"></a>00352     t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[2]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node2];
<a name="l00353"></a>00353     t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[3]    =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node3];
<a name="l00354"></a>00354     t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#a5e86059848aa6610b4013ba4b4ab0b0e">m_rv</a>      =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a32bf4ffbc67f1b6528560157ece4bbb8">VolumeOf</a>(t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[3]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>);
<a name="l00355"></a>00355     <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">true</span>;
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">//</span>
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ae402153bffbdb261ac7aee484ae4a519">00360</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ae402153bffbdb261ac7aee484ae4a519">btSoftBody::appendAnchor</a>(<span class="keywordtype">int</span> node,<a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a>* body, <span class="keywordtype">bool</span> disableCollisionBetweenLinkedBodies)
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362     btVector3 local = body-&gt;getWorldTransform().inverse()*<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node].m_x;
<a name="l00363"></a>00363     <a class="code" href="../../da/d60/classbtSoftBody.html#ae402153bffbdb261ac7aee484ae4a519">appendAnchor</a>(node,body,local,disableCollisionBetweenLinkedBodies);
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="comment">//</span>
<a name="l00367"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a1a239f8228f672d5c9cb35d3f6c27107">00367</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ae402153bffbdb261ac7aee484ae4a519">btSoftBody::appendAnchor</a>(<span class="keywordtype">int</span> node,<a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a>* body, <span class="keyword">const</span> btVector3&amp; localPivot,<span class="keywordtype">bool</span> disableCollisionBetweenLinkedBodies)
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369     <span class="keywordflow">if</span> (disableCollisionBetweenLinkedBodies)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         <span class="keywordflow">if</span> (<a class="code" href="../../da/d60/classbtSoftBody.html#a056ef3693699a133cb54e701ec067ab7">m_collisionDisabledObjects</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ae7b14c469b51e0ea010d3b9d701bc1b8">findLinearSearch</a>(body)==<a class="code" href="../../da/d60/classbtSoftBody.html#a056ef3693699a133cb54e701ec067ab7">m_collisionDisabledObjects</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373             <a class="code" href="../../da/d60/classbtSoftBody.html#a056ef3693699a133cb54e701ec067ab7">m_collisionDisabledObjects</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(body);
<a name="l00374"></a>00374         }
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html">Anchor</a>  a;
<a name="l00378"></a>00378     a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#abc1bf9b55ed97026448d561a3fee9d8b">m_node</a>            =   &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node];
<a name="l00379"></a>00379     a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>            =   body;
<a name="l00380"></a>00380     a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a06d5ececcb7018b282039a82f5061e4a">m_local</a>           =   localPivot;
<a name="l00381"></a>00381     a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#abc1bf9b55ed97026448d561a3fee9d8b">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab254674b1b0cf75bba85bb59aa98fb69">m_battach</a> =   1;
<a name="l00382"></a>00382     <a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(a);
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="comment">//</span>
<a name="l00386"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a265bfcce61012a940a03adf1dc412d1f">00386</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a265bfcce61012a940a03adf1dc412d1f">btSoftBody::appendLinearJoint</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d7e/structbtSoftBody_1_1LJoint_1_1Specs.html">LJoint::Specs</a>&amp; specs,<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* body0,<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html">Body</a> body1)
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388     <a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html">LJoint</a>*     pj  =   <span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html">LJoint</a>),16)) <a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html">LJoint</a>();
<a name="l00389"></a>00389     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[0] =   body0;
<a name="l00390"></a>00390     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[1] =   body1;
<a name="l00391"></a>00391     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#abe0ba38a89d753938cbd6d3fece0a29a">m_refs</a>[0]   =   pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[0].<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html#a0bea3d7c3c8e70f0f424565622df3493">xform</a>().<a class="code" href="../../d4/d79/classbtTransform.html#ab8bfe567b46a87ca917b29ad75ac383a" title="Return the inverse of this transform.">inverse</a>()*specs.<a class="code" href="../../d2/d7e/structbtSoftBody_1_1LJoint_1_1Specs.html#abe696eb6c83d211fb066bf42709550a7">position</a>;
<a name="l00392"></a>00392     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#abe0ba38a89d753938cbd6d3fece0a29a">m_refs</a>[1]   =   pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[1].<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html#a0bea3d7c3c8e70f0f424565622df3493">xform</a>().<a class="code" href="../../d4/d79/classbtTransform.html#ab8bfe567b46a87ca917b29ad75ac383a" title="Return the inverse of this transform.">inverse</a>()*specs.<a class="code" href="../../d2/d7e/structbtSoftBody_1_1LJoint_1_1Specs.html#abe696eb6c83d211fb066bf42709550a7">position</a>;
<a name="l00393"></a>00393     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a4edd7242f07b07ee9912284d21b159f1">m_cfm</a>       =   specs.<a class="code" href="../../d8/d9d/structbtSoftBody_1_1Joint_1_1Specs.html#aebc7b3a79c8dfebf22705d65cbfcd179">cfm</a>;
<a name="l00394"></a>00394     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a9c5f5b382fcd0469b7b74bfa8abc9e9a">m_erp</a>       =   specs.<a class="code" href="../../d8/d9d/structbtSoftBody_1_1Joint_1_1Specs.html#a2128d5e934125f18c31e71baf374d812">erp</a>;
<a name="l00395"></a>00395     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a310e024b55848099960bd2c9878f13a7">m_split</a>     =   specs.<a class="code" href="../../d8/d9d/structbtSoftBody_1_1Joint_1_1Specs.html#a360c67be0277f561281a6f2d69eaed23">split</a>;
<a name="l00396"></a>00396     <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(pj);
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="comment">//</span>
<a name="l00400"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a6f60720a468c4734aef16440c794c9cc">00400</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a265bfcce61012a940a03adf1dc412d1f">btSoftBody::appendLinearJoint</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d7e/structbtSoftBody_1_1LJoint_1_1Specs.html">LJoint::Specs</a>&amp; specs,<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html">Body</a> body)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402     <a class="code" href="../../da/d60/classbtSoftBody.html#a265bfcce61012a940a03adf1dc412d1f">appendLinearJoint</a>(specs,<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0],body);
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">//</span>
<a name="l00406"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a573a55a32496e60563cd5d9f6a41edc0">00406</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a265bfcce61012a940a03adf1dc412d1f">btSoftBody::appendLinearJoint</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d7e/structbtSoftBody_1_1LJoint_1_1Specs.html">LJoint::Specs</a>&amp; specs,<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* body)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <a class="code" href="../../da/d60/classbtSoftBody.html#a265bfcce61012a940a03adf1dc412d1f">appendLinearJoint</a>(specs,<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0],body-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0]);
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">//</span>
<a name="l00412"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a76633cd436f4de0204f1d1e483c0a2e3">00412</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a76633cd436f4de0204f1d1e483c0a2e3">btSoftBody::appendAngularJoint</a>(<span class="keyword">const</span> <a class="code" href="../../d0/dec/structbtSoftBody_1_1AJoint_1_1Specs.html">AJoint::Specs</a>&amp; specs,<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* body0,<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html">Body</a> body1)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html">AJoint</a>*     pj  =   <span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html">AJoint</a>),16)) <a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html">AJoint</a>();
<a name="l00415"></a>00415     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[0] =   body0;
<a name="l00416"></a>00416     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[1] =   body1;
<a name="l00417"></a>00417     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#abe0ba38a89d753938cbd6d3fece0a29a">m_refs</a>[0]   =   pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[0].<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html#a0bea3d7c3c8e70f0f424565622df3493">xform</a>().<a class="code" href="../../d4/d79/classbtTransform.html#ab8bfe567b46a87ca917b29ad75ac383a" title="Return the inverse of this transform.">inverse</a>().<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>()*specs.<a class="code" href="../../d0/dec/structbtSoftBody_1_1AJoint_1_1Specs.html#ae043ee7fa63bf1cc3f35e89fa622a0cd">axis</a>;
<a name="l00418"></a>00418     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#abe0ba38a89d753938cbd6d3fece0a29a">m_refs</a>[1]   =   pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a8020996a1e17a05bb1f82b452858fef8">m_bodies</a>[1].<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html#a0bea3d7c3c8e70f0f424565622df3493">xform</a>().<a class="code" href="../../d4/d79/classbtTransform.html#ab8bfe567b46a87ca917b29ad75ac383a" title="Return the inverse of this transform.">inverse</a>().<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>()*specs.<a class="code" href="../../d0/dec/structbtSoftBody_1_1AJoint_1_1Specs.html#ae043ee7fa63bf1cc3f35e89fa622a0cd">axis</a>;
<a name="l00419"></a>00419     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a4edd7242f07b07ee9912284d21b159f1">m_cfm</a>       =   specs.<a class="code" href="../../d8/d9d/structbtSoftBody_1_1Joint_1_1Specs.html#aebc7b3a79c8dfebf22705d65cbfcd179">cfm</a>;
<a name="l00420"></a>00420     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a9c5f5b382fcd0469b7b74bfa8abc9e9a">m_erp</a>       =   specs.<a class="code" href="../../d8/d9d/structbtSoftBody_1_1Joint_1_1Specs.html#a2128d5e934125f18c31e71baf374d812">erp</a>;
<a name="l00421"></a>00421     pj-&gt;<a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#a310e024b55848099960bd2c9878f13a7">m_split</a>     =   specs.<a class="code" href="../../d8/d9d/structbtSoftBody_1_1Joint_1_1Specs.html#a360c67be0277f561281a6f2d69eaed23">split</a>;
<a name="l00422"></a>00422     pj-&gt;<a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#a9caf65d5ea6cfa0a85a31b8f96865526">m_icontrol</a>  =   specs.<a class="code" href="../../d0/dec/structbtSoftBody_1_1AJoint_1_1Specs.html#a1bc2eafb69ff1eb116ebbb0f5ad976e7">icontrol</a>;
<a name="l00423"></a>00423     <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(pj);
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment">//</span>
<a name="l00427"></a><a class="code" href="../../da/d60/classbtSoftBody.html#afbacb266e17f8b785985cb3f85be7f51">00427</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a76633cd436f4de0204f1d1e483c0a2e3">btSoftBody::appendAngularJoint</a>(<span class="keyword">const</span> <a class="code" href="../../d0/dec/structbtSoftBody_1_1AJoint_1_1Specs.html">AJoint::Specs</a>&amp; specs,<a class="code" href="../../dc/da4/structbtSoftBody_1_1Body.html">Body</a> body)
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <a class="code" href="../../da/d60/classbtSoftBody.html#a76633cd436f4de0204f1d1e483c0a2e3">appendAngularJoint</a>(specs,<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0],body);
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">//</span>
<a name="l00433"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ae39c309cd794ce277964808a5d20d1d9">00433</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a76633cd436f4de0204f1d1e483c0a2e3">btSoftBody::appendAngularJoint</a>(<span class="keyword">const</span> <a class="code" href="../../d0/dec/structbtSoftBody_1_1AJoint_1_1Specs.html">AJoint::Specs</a>&amp; specs,<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* body)
<a name="l00434"></a>00434 {
<a name="l00435"></a>00435     <a class="code" href="../../da/d60/classbtSoftBody.html#a76633cd436f4de0204f1d1e483c0a2e3">appendAngularJoint</a>(specs,<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0],body-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0]);
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="comment">//</span>
<a name="l00439"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a4d4cb25a0b61eee260bda46bca373960">00439</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a4d4cb25a0b61eee260bda46bca373960">btSoftBody::addForce</a>(<span class="keyword">const</span> btVector3&amp; force)
<a name="l00440"></a>00440 {
<a name="l00441"></a>00441     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) <a class="code" href="../../da/d60/classbtSoftBody.html#a4d4cb25a0b61eee260bda46bca373960">addForce</a>(force,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">//</span>
<a name="l00445"></a><a class="code" href="../../da/d60/classbtSoftBody.html#afdfb3e29c73cb1a67a0d006eb1e1824d">00445</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a4d4cb25a0b61eee260bda46bca373960">btSoftBody::addForce</a>(<span class="keyword">const</span> btVector3&amp; force,<span class="keywordtype">int</span> node)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node];
<a name="l00448"></a>00448     <span class="keywordflow">if</span>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l00449"></a>00449     {
<a name="l00450"></a>00450         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#aebe1f784e80e576a11338c21a5717069">m_f</a>   +=  force;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">//</span>
<a name="l00455"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a3407addc1014cef6327ed009f4804da7">00455</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a3407addc1014cef6327ed009f4804da7">btSoftBody::addVelocity</a>(<span class="keyword">const</span> btVector3&amp; velocity)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) <a class="code" href="../../da/d60/classbtSoftBody.html#a3407addc1014cef6327ed009f4804da7">addVelocity</a>(velocity,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="comment">/* Set velocity for the entire body                                     */</span> 
<a name="l00461"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a94daa5306dfad2e4c5b29715600aed8e">00461</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#a94daa5306dfad2e4c5b29715600aed8e">btSoftBody::setVelocity</a>(    <span class="keyword">const</span> btVector3&amp; velocity)
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) 
<a name="l00464"></a>00464     {
<a name="l00465"></a>00465         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00466"></a>00466         <span class="keywordflow">if</span>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l00467"></a>00467         {
<a name="l00468"></a>00468             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>   =   velocity;
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="comment">//</span>
<a name="l00475"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a5befe4cdedc0cf4d002471fd25f59416">00475</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a3407addc1014cef6327ed009f4804da7">btSoftBody::addVelocity</a>(<span class="keyword">const</span> btVector3&amp; velocity,<span class="keywordtype">int</span> node)
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node];
<a name="l00478"></a>00478     <span class="keywordflow">if</span>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l00479"></a>00479     {
<a name="l00480"></a>00480         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>   +=  velocity;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="comment">//</span>
<a name="l00485"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a1aa16f724cd3f5e8431f3fec07d75b60">00485</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a1aa16f724cd3f5e8431f3fec07d75b60">btSoftBody::setMass</a>(<span class="keywordtype">int</span> node,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> mass)
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487     <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node].m_im=mass&gt;0?1/mass:0;
<a name="l00488"></a>00488     <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">true</span>;
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">//</span>
<a name="l00492"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a91645388270bc2f8bdf3dbf629f56201">00492</a> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        <a class="code" href="../../da/d60/classbtSoftBody.html#a91645388270bc2f8bdf3dbf629f56201">btSoftBody::getMass</a>(<span class="keywordtype">int</span> node)<span class="keyword"> const</span>
<a name="l00493"></a>00493 <span class="keyword"></span>{
<a name="l00494"></a>00494     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node].m_im&gt;0?1/<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node].m_im:0);
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 <span class="comment">//</span>
<a name="l00498"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad97bdb48f39751adbe2607f2ef3ccc19">00498</a> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        <a class="code" href="../../da/d60/classbtSoftBody.html#ad97bdb48f39751adbe2607f2ef3ccc19">btSoftBody::getTotalMass</a>()<span class="keyword"> const</span>
<a name="l00499"></a>00499 <span class="keyword"></span>{
<a name="l00500"></a>00500     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>    mass=0;
<a name="l00501"></a>00501     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00502"></a>00502     {
<a name="l00503"></a>00503         mass+=<a class="code" href="../../da/d60/classbtSoftBody.html#a91645388270bc2f8bdf3dbf629f56201">getMass</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     <span class="keywordflow">return</span>(mass);
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="comment">//</span>
<a name="l00509"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad7fa51cdee5753af58c3d7cf5c15330f">00509</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ad7fa51cdee5753af58c3d7cf5c15330f">btSoftBody::setTotalMass</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> mass,<span class="keywordtype">bool</span> fromfaces)
<a name="l00510"></a>00510 {
<a name="l00511"></a>00511     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="keywordflow">if</span>(fromfaces)
<a name="l00514"></a>00514     {
<a name="l00515"></a>00515 
<a name="l00516"></a>00516         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00517"></a>00517         {
<a name="l00518"></a>00518             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im=0;
<a name="l00519"></a>00519         }
<a name="l00520"></a>00520         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00521"></a>00521         {
<a name="l00522"></a>00522             <span class="keyword">const</span> <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;     f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00523"></a>00523             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  twicearea=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a4abf663bbb87e98cbf9a90d299ae248b">AreaOf</a>(   f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l00524"></a>00524                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l00525"></a>00525                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>);
<a name="l00526"></a>00526             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j)
<a name="l00527"></a>00527             {
<a name="l00528"></a>00528                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>+=twicearea;
<a name="l00529"></a>00529             }
<a name="l00530"></a>00530         }
<a name="l00531"></a>00531         <span class="keywordflow">for</span>( i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00532"></a>00532         {
<a name="l00533"></a>00533             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im=1/<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im;
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  tm=<a class="code" href="../../da/d60/classbtSoftBody.html#ad97bdb48f39751adbe2607f2ef3ccc19">getTotalMass</a>();
<a name="l00537"></a>00537     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  itm=1/tm;
<a name="l00538"></a>00538     <span class="keywordflow">for</span>( i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00539"></a>00539     {
<a name="l00540"></a>00540         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im/=itm*mass;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542     <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">true</span>;
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 <span class="comment">//</span>
<a name="l00546"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a6018d917b0eee5dc61c4d5cc66a6ceb2">00546</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a6018d917b0eee5dc61c4d5cc66a6ceb2">btSoftBody::setTotalDensity</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> density)
<a name="l00547"></a>00547 {
<a name="l00548"></a>00548     <a class="code" href="../../da/d60/classbtSoftBody.html#ad7fa51cdee5753af58c3d7cf5c15330f">setTotalMass</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#acfa376b0906401dc0f33d6ac9b7e0164">getVolume</a>()*density,<span class="keyword">true</span>);
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <span class="comment">//</span>
<a name="l00552"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a65a3db52b7fe9c869cb85577d292833d">00552</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a65a3db52b7fe9c869cb85577d292833d">btSoftBody::setVolumeMass</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> mass)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554 <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;btScalar&gt;</a>  ranks;
<a name="l00555"></a>00555 ranks.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>(),0);
<a name="l00556"></a>00556 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00559"></a>00559     {
<a name="l00560"></a>00560     <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im=0;
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562 <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00563"></a>00563     {
<a name="l00564"></a>00564     <span class="keyword">const</span> <a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html">Tetra</a>&amp; t=<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00565"></a>00565     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;4;++j)
<a name="l00566"></a>00566         {
<a name="l00567"></a>00567         t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[j]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>+=<a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#a5e86059848aa6610b4013ba4b4ab0b0e">m_rv</a>);
<a name="l00568"></a>00568         ranks[int(t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#aff3ff48a28a068a8dd469a5da4dbf8f8">m_n</a>[j]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0])]+=1;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 <span class="keywordflow">for</span>( i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00572"></a>00572     {
<a name="l00573"></a>00573     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i].m_im&gt;0)
<a name="l00574"></a>00574         {
<a name="l00575"></a>00575         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im=ranks[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]/<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578 <a class="code" href="../../da/d60/classbtSoftBody.html#ad7fa51cdee5753af58c3d7cf5c15330f">setTotalMass</a>(mass,<span class="keyword">false</span>);
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="comment">//</span>
<a name="l00582"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a79bfb08e24aa77bdd08db4ee7853b544">00582</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a79bfb08e24aa77bdd08db4ee7853b544">btSoftBody::setVolumeDensity</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> density)
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584 <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>    volume=0;
<a name="l00585"></a>00585 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00586"></a>00586     {
<a name="l00587"></a>00587     <span class="keyword">const</span> <a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html">Tetra</a>&amp; t=<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00588"></a>00588     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;4;++j)
<a name="l00589"></a>00589         {
<a name="l00590"></a>00590         volume+=<a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(t.<a class="code" href="../../dd/d7d/structbtSoftBody_1_1Tetra.html#a5e86059848aa6610b4013ba4b4ab0b0e">m_rv</a>);
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593 <a class="code" href="../../da/d60/classbtSoftBody.html#a65a3db52b7fe9c869cb85577d292833d">setVolumeMass</a>(volume*density/6);
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="comment">//</span>
<a name="l00597"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a7ab01480d2dcebf21db52e65d0d8b891">00597</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a7ab01480d2dcebf21db52e65d0d8b891">btSoftBody::transform</a>(<span class="keyword">const</span> <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a>&amp; trs)
<a name="l00598"></a>00598 {
<a name="l00599"></a>00599     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  margin=getCollisionShape()-&gt;getMargin();
<a name="l00600"></a>00600     <a class="code" href="../../d0/d6b/btScalar_8h.html#a38c30fdd0ea2558373a1b6e41c77d9d2">ATTRIBUTE_ALIGNED16</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html">btDbvtVolume</a>)   vol;
<a name="l00601"></a>00601     
<a name="l00602"></a>00602     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00603"></a>00603     {
<a name="l00604"></a>00604         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00605"></a>00605         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>=trs*n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>;
<a name="l00606"></a>00606         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>=trs*n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>;
<a name="l00607"></a>00607         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>=trs.<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>()*n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>;
<a name="l00608"></a>00608         vol = <a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a6b9b2b5b6361d2b56285ce18733e2092">btDbvtVolume::FromCR</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,margin);
<a name="l00609"></a>00609         
<a name="l00610"></a>00610         <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a6efe1f6bb9abd80ea76d1bfa97cebd2b">update</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#acca6a5b8479e45c00e07b68cdc482f3f">m_leaf</a>,vol);
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     <a class="code" href="../../da/d60/classbtSoftBody.html#ab362c5aca67e90032065945ce15cff31">updateNormals</a>();
<a name="l00613"></a>00613     <a class="code" href="../../da/d60/classbtSoftBody.html#aee48603cdeeb5cee57f6a210b135294b">updateBounds</a>();
<a name="l00614"></a>00614     <a class="code" href="../../da/d60/classbtSoftBody.html#ad73c943fe892bd5e3242e65de5df3db1">updateConstants</a>();
<a name="l00615"></a>00615     <a class="code" href="../../da/d60/classbtSoftBody.html#a62f3be93755bd2e1f30bed79a9f72cac">m_initialWorldTransform</a> = trs;
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618 <span class="comment">//</span>
<a name="l00619"></a><a class="code" href="../../da/d60/classbtSoftBody.html#af412dc4d210f98a36a14b2d17d80e00e">00619</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#af412dc4d210f98a36a14b2d17d80e00e">btSoftBody::translate</a>(<span class="keyword">const</span> btVector3&amp; trs)
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621     <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a> t;
<a name="l00622"></a>00622     t.<a class="code" href="../../d4/d79/classbtTransform.html#ac95a4f502585b3c896001eb236293ce5" title="Set this transformation to the identity.">setIdentity</a>();
<a name="l00623"></a>00623     t.<a class="code" href="../../d4/d79/classbtTransform.html#a10d173bd239e576c57d0ad5568303c03" title="Set the translational element.">setOrigin</a>(trs);
<a name="l00624"></a>00624     <a class="code" href="../../da/d60/classbtSoftBody.html#a7ab01480d2dcebf21db52e65d0d8b891">transform</a>(t);
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 <span class="comment">//</span>
<a name="l00628"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a45e297c3090eee78c3d539eadfa86a50">00628</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a45e297c3090eee78c3d539eadfa86a50">btSoftBody::rotate</a>( <span class="keyword">const</span> <a class="code" href="../../d2/d33/classbtQuaternion.html" title="The btQuaternion implements quaternion to perform linear algebra rotations in combination with btMatr...">btQuaternion</a>&amp; rot)
<a name="l00629"></a>00629 {
<a name="l00630"></a>00630     <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a> t;
<a name="l00631"></a>00631     t.<a class="code" href="../../d4/d79/classbtTransform.html#ac95a4f502585b3c896001eb236293ce5" title="Set this transformation to the identity.">setIdentity</a>();
<a name="l00632"></a>00632     t.<a class="code" href="../../d4/d79/classbtTransform.html#a5d012bc1b697ba1ff775f0b3b7ab6e3b" title="Set the rotational element by btQuaternion.">setRotation</a>(rot);
<a name="l00633"></a>00633     <a class="code" href="../../da/d60/classbtSoftBody.html#a7ab01480d2dcebf21db52e65d0d8b891">transform</a>(t);
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 <span class="comment">//</span>
<a name="l00637"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a2a6533511a6a6cbede9bacb5c9a5280c">00637</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a2a6533511a6a6cbede9bacb5c9a5280c">btSoftBody::scale</a>(<span class="keyword">const</span> btVector3&amp; scl)
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  margin=getCollisionShape()-&gt;getMargin();
<a name="l00641"></a>00641     <a class="code" href="../../d0/d6b/btScalar_8h.html#a38c30fdd0ea2558373a1b6e41c77d9d2">ATTRIBUTE_ALIGNED16</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html">btDbvtVolume</a>)   vol;
<a name="l00642"></a>00642     
<a name="l00643"></a>00643     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00644"></a>00644     {
<a name="l00645"></a>00645         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00646"></a>00646         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>*=scl;
<a name="l00647"></a>00647         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>*=scl;
<a name="l00648"></a>00648         vol = <a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a6b9b2b5b6361d2b56285ce18733e2092">btDbvtVolume::FromCR</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,margin);
<a name="l00649"></a>00649         <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a6efe1f6bb9abd80ea76d1bfa97cebd2b">update</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#acca6a5b8479e45c00e07b68cdc482f3f">m_leaf</a>,vol);
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     <a class="code" href="../../da/d60/classbtSoftBody.html#ab362c5aca67e90032065945ce15cff31">updateNormals</a>();
<a name="l00652"></a>00652     <a class="code" href="../../da/d60/classbtSoftBody.html#aee48603cdeeb5cee57f6a210b135294b">updateBounds</a>();
<a name="l00653"></a>00653     <a class="code" href="../../da/d60/classbtSoftBody.html#ad73c943fe892bd5e3242e65de5df3db1">updateConstants</a>();
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 <span class="comment">//</span>
<a name="l00657"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a13672a0c23f4b2af774ed83a6457cbef">00657</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a13672a0c23f4b2af774ed83a6457cbef">btSoftBody::setPose</a>(<span class="keywordtype">bool</span> bvolume,<span class="keywordtype">bool</span> bframe)
<a name="l00658"></a>00658 {
<a name="l00659"></a>00659     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a359673dbb1d50f586ae6e77924e9d8ac">m_bvolume</a>    =   bvolume;
<a name="l00660"></a>00660     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#adf09c94d97fb44f3b88c3b1832776766">m_bframe</a>     =   bframe;
<a name="l00661"></a>00661     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="comment">/* Weights      */</span> 
<a name="l00664"></a>00664     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  omass=<a class="code" href="../../da/d60/classbtSoftBody.html#ad97bdb48f39751adbe2607f2ef3ccc19">getTotalMass</a>();
<a name="l00665"></a>00665     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  kmass=omass*<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()*1000;
<a name="l00666"></a>00666     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        tmass=omass;
<a name="l00667"></a>00667     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ad734471e031d5105259ebab2f9de71c9">m_wgh</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l00668"></a>00668     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i].m_im&lt;=0) tmass+=kmass;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     <span class="keywordflow">for</span>( i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00673"></a>00673     {
<a name="l00674"></a>00674         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00675"></a>00675         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ad734471e031d5105259ebab2f9de71c9">m_wgh</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]=    n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0                    ?
<a name="l00676"></a>00676             1/(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im*tmass)   :
<a name="l00677"></a>00677         kmass/tmass;
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679     <span class="comment">/* Pos      */</span> 
<a name="l00680"></a>00680     <span class="keyword">const</span> btVector3 com=<a class="code" href="../../da/d60/classbtSoftBody.html#a3705e365dc96446bc489c392dcf2ac0c">evaluateCom</a>();
<a name="l00681"></a>00681     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aa6cae81e27e3a4c8990423f2fa6bf182">m_pos</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l00682"></a>00682     <span class="keywordflow">for</span>( i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00683"></a>00683     {
<a name="l00684"></a>00684         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aa6cae81e27e3a4c8990423f2fa6bf182">m_pos</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x-com;
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a4806127851c12e3df29b1097aa3723c9">m_volume</a> =   bvolume?<a class="code" href="../../da/d60/classbtSoftBody.html#acfa376b0906401dc0f33d6ac9b7e0164">getVolume</a>():0;
<a name="l00687"></a>00687     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a5083f27c5671f4ff377a6ee4d601ec6e">m_com</a>    =   com;
<a name="l00688"></a>00688     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ac84ae4951c58adeee86b8e6113f2e2d2">m_rot</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a6e15db8fa9ca470e00f3cada4b480fca" title="Set the matrix to the identity.">setIdentity</a>();
<a name="l00689"></a>00689     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a15a4fa7fa548a96678aae8dc8e259d34">m_scl</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a6e15db8fa9ca470e00f3cada4b480fca" title="Set the matrix to the identity.">setIdentity</a>();
<a name="l00690"></a>00690     <span class="comment">/* Aqq      */</span> 
<a name="l00691"></a>00691     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>[0] =
<a name="l00692"></a>00692         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>[1] =
<a name="l00693"></a>00693         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>[2] =   btVector3(0,0,0);
<a name="l00694"></a>00694     <span class="keywordflow">for</span>( i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00695"></a>00695     {
<a name="l00696"></a>00696         <span class="keyword">const</span> btVector3&amp;    q=<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aa6cae81e27e3a4c8990423f2fa6bf182">m_pos</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00697"></a>00697         <span class="keyword">const</span> btVector3     mq=<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ad734471e031d5105259ebab2f9de71c9">m_wgh</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*q;
<a name="l00698"></a>00698         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>[0]+=mq.x()*q;
<a name="l00699"></a>00699         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>[1]+=mq.y()*q;
<a name="l00700"></a>00700         <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>[2]+=mq.z()*q;
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     <a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>=<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a051aba0fed800ed3453f04a5b8e7f465" title="Return the inverse of the matrix.">inverse</a>();
<a name="l00703"></a>00703     <a class="code" href="../../da/d60/classbtSoftBody.html#ad73c943fe892bd5e3242e65de5df3db1">updateConstants</a>();
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 <span class="comment">//</span>
<a name="l00707"></a><a class="code" href="../../da/d60/classbtSoftBody.html#acfa376b0906401dc0f33d6ac9b7e0164">00707</a> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        <a class="code" href="../../da/d60/classbtSoftBody.html#acfa376b0906401dc0f33d6ac9b7e0164">btSoftBody::getVolume</a>()<span class="keyword"> const</span>
<a name="l00708"></a>00708 <span class="keyword"></span>{
<a name="l00709"></a>00709     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>    vol=0;
<a name="l00710"></a>00710     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()&gt;0)
<a name="l00711"></a>00711     {
<a name="l00712"></a>00712         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <span class="keyword">const</span> btVector3 org=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0].m_x;
<a name="l00715"></a>00715         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00716"></a>00716         {
<a name="l00717"></a>00717             <span class="keyword">const</span> <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp; f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00718"></a>00718             vol+=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-org,<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-org,f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-org));
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720         vol/=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)6;
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722     <span class="keywordflow">return</span>(vol);
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="comment">//</span>
<a name="l00726"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a5172e7b77934f37e37cdcb41f37c5a0b">00726</a> <span class="keywordtype">int</span>             <a class="code" href="../../da/d60/classbtSoftBody.html#a5172e7b77934f37e37cdcb41f37c5a0b">btSoftBody::clusterCount</a>()<span class="keyword"> const</span>
<a name="l00727"></a>00727 <span class="keyword"></span>{
<a name="l00728"></a>00728     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">//</span>
<a name="l00732"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a8a4ea1cf74b8b8e08733d3f0fb466ded">00732</a> btVector3       <a class="code" href="../../da/d60/classbtSoftBody.html#a8a4ea1cf74b8b8e08733d3f0fb466ded">btSoftBody::clusterCom</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster)
<a name="l00733"></a>00733 {
<a name="l00734"></a>00734     btVector3       com(0,0,0);
<a name="l00735"></a>00735     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00736"></a>00736     {
<a name="l00737"></a>00737         com+=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_x*cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739     <span class="keywordflow">return</span>(com*cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>);
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="comment">//</span>
<a name="l00743"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9f3cd0e04c9c7eb5692720da29e88a4f">00743</a> btVector3       <a class="code" href="../../da/d60/classbtSoftBody.html#a8a4ea1cf74b8b8e08733d3f0fb466ded">btSoftBody::clusterCom</a>(<span class="keywordtype">int</span> cluster)<span class="keyword"> const</span>
<a name="l00744"></a>00744 <span class="keyword"></span>{
<a name="l00745"></a>00745     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a8a4ea1cf74b8b8e08733d3f0fb466ded">clusterCom</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[cluster]));
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="comment">//</span>
<a name="l00749"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ab6ae110bfb643bda929c67a59cf6b83f">00749</a> btVector3       <a class="code" href="../../da/d60/classbtSoftBody.html#ab6ae110bfb643bda929c67a59cf6b83f">btSoftBody::clusterVelocity</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; rpos)
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751     <span class="keywordflow">return</span>(cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>+<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>,rpos));
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="comment">//</span>
<a name="l00755"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a546e7f4e94c6b75f7e4eecada5b956e7">00755</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a546e7f4e94c6b75f7e4eecada5b956e7">btSoftBody::clusterVImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; rpos,<span class="keyword">const</span> btVector3&amp; impulse)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757     <span class="keyword">const</span> btVector3 li=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>*impulse;
<a name="l00758"></a>00758     <span class="keyword">const</span> btVector3 ai=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>*<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(rpos,impulse);
<a name="l00759"></a>00759     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[0]+=li;cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>+=li;
<a name="l00760"></a>00760     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[1]+=ai;cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>+=ai;
<a name="l00761"></a>00761     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a157244b73178b5b8a725e1e0e0c5bb1b">m_nvimpulses</a>++;
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="comment">//</span>
<a name="l00765"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ab3cfd805f7fddd63db5f966c3d1cbb1b">00765</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ab3cfd805f7fddd63db5f966c3d1cbb1b">btSoftBody::clusterDImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; rpos,<span class="keyword">const</span> btVector3&amp; impulse)
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767     <span class="keyword">const</span> btVector3 li=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>*impulse;
<a name="l00768"></a>00768     <span class="keyword">const</span> btVector3 ai=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>*<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(rpos,impulse);
<a name="l00769"></a>00769     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[0]+=li;
<a name="l00770"></a>00770     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[1]+=ai;
<a name="l00771"></a>00771     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>++;
<a name="l00772"></a>00772 }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 <span class="comment">//</span>
<a name="l00775"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aad6406f1e55d95ba092ed2f51a992b72">00775</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#aad6406f1e55d95ba092ed2f51a992b72">btSoftBody::clusterImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; rpos,<span class="keyword">const</span> <a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html">Impulse</a>&amp; impulse)
<a name="l00776"></a>00776 {
<a name="l00777"></a>00777     <span class="keywordflow">if</span>(impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#ae607701d136e2334189803d44f3a2211">m_asVelocity</a>)    <a class="code" href="../../da/d60/classbtSoftBody.html#a546e7f4e94c6b75f7e4eecada5b956e7">clusterVImpulse</a>(cluster,rpos,impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>);
<a name="l00778"></a>00778     <span class="keywordflow">if</span>(impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a48e0f46f144d9cacca2333788d3df56d">m_asDrift</a>)       <a class="code" href="../../da/d60/classbtSoftBody.html#ab3cfd805f7fddd63db5f966c3d1cbb1b">clusterDImpulse</a>(cluster,rpos,impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a264b6b2fd236213db5e79322cef5f327">m_drift</a>);
<a name="l00779"></a>00779 }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 <span class="comment">//</span>
<a name="l00782"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a7bfd5a6382e9f1d35ff2b6a2e90d2fbc">00782</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a7bfd5a6382e9f1d35ff2b6a2e90d2fbc">btSoftBody::clusterVAImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; impulse)
<a name="l00783"></a>00783 {
<a name="l00784"></a>00784     <span class="keyword">const</span> btVector3 ai=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>*impulse;
<a name="l00785"></a>00785     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[1]+=ai;cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>+=ai;
<a name="l00786"></a>00786     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a157244b73178b5b8a725e1e0e0c5bb1b">m_nvimpulses</a>++;
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="comment">//</span>
<a name="l00790"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a6222d3a234f2776c398084a673f6a35f">00790</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a6222d3a234f2776c398084a673f6a35f">btSoftBody::clusterDAImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; impulse)
<a name="l00791"></a>00791 {
<a name="l00792"></a>00792     <span class="keyword">const</span> btVector3 ai=cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>*impulse;
<a name="l00793"></a>00793     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[1]+=ai;
<a name="l00794"></a>00794     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>++;
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="comment">//</span>
<a name="l00798"></a><a class="code" href="../../da/d60/classbtSoftBody.html#affddc2d7f3b500c44d9e1f703df0cc33">00798</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#affddc2d7f3b500c44d9e1f703df0cc33">btSoftBody::clusterAImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> <a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html">Impulse</a>&amp; impulse)
<a name="l00799"></a>00799 {
<a name="l00800"></a>00800     <span class="keywordflow">if</span>(impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#ae607701d136e2334189803d44f3a2211">m_asVelocity</a>)    <a class="code" href="../../da/d60/classbtSoftBody.html#a7bfd5a6382e9f1d35ff2b6a2e90d2fbc">clusterVAImpulse</a>(cluster,impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>);
<a name="l00801"></a>00801     <span class="keywordflow">if</span>(impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a48e0f46f144d9cacca2333788d3df56d">m_asDrift</a>)       <a class="code" href="../../da/d60/classbtSoftBody.html#a6222d3a234f2776c398084a673f6a35f">clusterDAImpulse</a>(cluster,impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a264b6b2fd236213db5e79322cef5f327">m_drift</a>);
<a name="l00802"></a>00802 }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="comment">//</span>
<a name="l00805"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a7a988e2954fdf0f8f4691599ca645d9b">00805</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a7a988e2954fdf0f8f4691599ca645d9b">btSoftBody::clusterDCImpulse</a>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cluster,<span class="keyword">const</span> btVector3&amp; impulse)
<a name="l00806"></a>00806 {
<a name="l00807"></a>00807     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[0]+=impulse*cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>;
<a name="l00808"></a>00808     cluster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>++;
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00811"></a><a class="code" href="../../df/dc1/structNodeLinks.html">00811</a> <span class="keyword">struct </span><a class="code" href="../../df/dc1/structNodeLinks.html">NodeLinks</a>
<a name="l00812"></a>00812 {
<a name="l00813"></a><a class="code" href="../../df/dc1/structNodeLinks.html#a3e69c1399f17cbe7a61d64cb87e8ae4e">00813</a>     <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a> <a class="code" href="../../df/dc1/structNodeLinks.html#a3e69c1399f17cbe7a61d64cb87e8ae4e">m_links</a>;
<a name="l00814"></a>00814 };
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 <span class="comment">//</span>
<a name="l00819"></a><a class="code" href="../../da/d60/classbtSoftBody.html#af31b03f0ff5eecec1ec9eee5a7582d20">00819</a> <span class="keywordtype">int</span>             <a class="code" href="../../da/d60/classbtSoftBody.html#af31b03f0ff5eecec1ec9eee5a7582d20">btSoftBody::generateBendingConstraints</a>(<span class="keywordtype">int</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>,<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>* mat)
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="keywordflow">if</span>(distance&gt;1)
<a name="l00824"></a>00824     {
<a name="l00825"></a>00825         <span class="comment">/* Build graph  */</span> 
<a name="l00826"></a>00826         <span class="keyword">const</span> <span class="keywordtype">int</span>       n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l00827"></a>00827         <span class="keyword">const</span> <span class="keywordtype">unsigned</span>  inf=(~(unsigned)0)&gt;&gt;1;
<a name="l00828"></a>00828         <span class="keywordtype">unsigned</span>*       adj=<span class="keyword">new</span> <span class="keywordtype">unsigned</span>[n*n];
<a name="l00829"></a>00829         
<a name="l00830"></a>00830 
<a name="l00831"></a>00831 <span class="preprocessor">#define IDX(_x_,_y_)    ((_y_)*n+(_x_))</span>
<a name="l00832"></a>00832 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(j=0;j&lt;n;++j)
<a name="l00833"></a>00833         {
<a name="l00834"></a>00834             <span class="keywordflow">for</span>(i=0;i&lt;n;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00835"></a>00835             {
<a name="l00836"></a>00836                 <span class="keywordflow">if</span>(i!=j)
<a name="l00837"></a>00837                 {
<a name="l00838"></a>00838                     adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]=adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(j,i)]=inf;
<a name="l00839"></a>00839                 }
<a name="l00840"></a>00840                 <span class="keywordflow">else</span>
<a name="l00841"></a>00841                 {
<a name="l00842"></a>00842                     adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]=adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(j,i)]=0;
<a name="l00843"></a>00843                 }
<a name="l00844"></a>00844             }
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846         <span class="keywordflow">for</span>( i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848             <span class="keyword">const</span> <span class="keywordtype">int</span>   ia=(int)(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]);
<a name="l00849"></a>00849             <span class="keyword">const</span> <span class="keywordtype">int</span>   ib=(int)(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]);
<a name="l00850"></a>00850             adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(ia,ib)]=1;
<a name="l00851"></a>00851             adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(ib,ia)]=1;
<a name="l00852"></a>00852         }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         <span class="comment">//special optimized case for distance == 2</span>
<a name="l00856"></a>00856         <span class="keywordflow">if</span> (distance == 2)
<a name="l00857"></a>00857         {
<a name="l00858"></a>00858 
<a name="l00859"></a>00859             <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;NodeLinks&gt;</a> nodeLinks;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 
<a name="l00862"></a>00862             <span class="comment">/* Build node links */</span>
<a name="l00863"></a>00863             nodeLinks.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l00864"></a>00864 
<a name="l00865"></a>00865             <span class="keywordflow">for</span>( i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00866"></a>00866             {
<a name="l00867"></a>00867                 <span class="keyword">const</span> <span class="keywordtype">int</span>   ia=(int)(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]);
<a name="l00868"></a>00868                 <span class="keyword">const</span> <span class="keywordtype">int</span>   ib=(int)(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]);
<a name="l00869"></a>00869                 <span class="keywordflow">if</span> (nodeLinks[ia].<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ae7b14c469b51e0ea010d3b9d701bc1b8">findLinearSearch</a>(ib)==nodeLinks[ia].m_links.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l00870"></a>00870                     nodeLinks[ia].<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(ib);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872                 <span class="keywordflow">if</span> (nodeLinks[ib].<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ae7b14c469b51e0ea010d3b9d701bc1b8">findLinearSearch</a>(ia)==nodeLinks[ib].m_links.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l00873"></a>00873                     nodeLinks[ib].<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(ia);
<a name="l00874"></a>00874             }
<a name="l00875"></a>00875             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nodeLinks.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();ii++)
<a name="l00876"></a>00876             {
<a name="l00877"></a>00877                 <span class="keywordtype">int</span> i=ii;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj=0;jj&lt;nodeLinks[ii].m_links.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();jj++)
<a name="l00880"></a>00880                 {
<a name="l00881"></a>00881                     <span class="keywordtype">int</span> k = nodeLinks[ii].m_links[jj];
<a name="l00882"></a>00882                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> kk=0;kk&lt;nodeLinks[k].m_links.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();kk++)
<a name="l00883"></a>00883                     {
<a name="l00884"></a>00884                         <span class="keywordtype">int</span> j = nodeLinks[k].m_links[kk];
<a name="l00885"></a>00885                         <span class="keywordflow">if</span> (i!=j)
<a name="l00886"></a>00886                         {
<a name="l00887"></a>00887                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span>  <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>=adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,k)]+adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(k,j)];
<a name="l00888"></a>00888                             <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(sum==2);
<a name="l00889"></a>00889                             <span class="keywordflow">if</span>(adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]&gt;sum)
<a name="l00890"></a>00890                             {
<a name="l00891"></a>00891                                 adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]=adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(j,i)]=<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l00892"></a>00892                             }
<a name="l00893"></a>00893                         }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895                     }
<a name="l00896"></a>00896                 }
<a name="l00897"></a>00897             }
<a name="l00898"></a>00898         } <span class="keywordflow">else</span>
<a name="l00899"></a>00899         {
<a name="l00901"></a>00901             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;n;++k)
<a name="l00902"></a>00902             {
<a name="l00903"></a>00903                 <span class="keywordflow">for</span>(j=0;j&lt;n;++j)
<a name="l00904"></a>00904                 {
<a name="l00905"></a>00905                     <span class="keywordflow">for</span>(i=j+1;i&lt;n;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00906"></a>00906                     {
<a name="l00907"></a>00907                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span>  <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>=adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,k)]+adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(k,j)];
<a name="l00908"></a>00908                         <span class="keywordflow">if</span>(adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]&gt;sum)
<a name="l00909"></a>00909                         {
<a name="l00910"></a>00910                             adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]=adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(j,i)]=<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l00911"></a>00911                         }
<a name="l00912"></a>00912                     }
<a name="l00913"></a>00913                 }
<a name="l00914"></a>00914             }
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 
<a name="l00918"></a>00918         <span class="comment">/* Build links  */</span> 
<a name="l00919"></a>00919         <span class="keywordtype">int</span> nlinks=0;
<a name="l00920"></a>00920         <span class="keywordflow">for</span>(j=0;j&lt;n;++j)
<a name="l00921"></a>00921         {
<a name="l00922"></a>00922             <span class="keywordflow">for</span>(i=j+1;i&lt;n;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00923"></a>00923             {
<a name="l00924"></a>00924                 <span class="keywordflow">if</span>(adj[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a7eee887aa26478b2de7daf4c0c2cb61b">IDX</a>(i,j)]==(<span class="keywordtype">unsigned</span>)distance)
<a name="l00925"></a>00925                 {
<a name="l00926"></a>00926                     <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(i,j,mat);
<a name="l00927"></a>00927                     <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1].m_bbending=1;
<a name="l00928"></a>00928                     ++nlinks;
<a name="l00929"></a>00929                 }
<a name="l00930"></a>00930             }
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932         <span class="keyword">delete</span>[] adj;       
<a name="l00933"></a>00933         <span class="keywordflow">return</span>(nlinks);
<a name="l00934"></a>00934     }
<a name="l00935"></a>00935     <span class="keywordflow">return</span>(0);
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">//</span>
<a name="l00939"></a><a class="code" href="../../da/d60/classbtSoftBody.html#acc984ed7b1ae0c8520d474f4ba3e053f">00939</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#acc984ed7b1ae0c8520d474f4ba3e053f">btSoftBody::randomizeConstraints</a>()
<a name="l00940"></a>00940 {
<a name="l00941"></a>00941     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   seed=243703;
<a name="l00942"></a>00942 <span class="preprocessor">#define NEXTRAND (seed=(1664525L*seed+1013904223L)&amp;0xffffffff)</span>
<a name="l00943"></a>00943 <span class="preprocessor"></span>    <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00946"></a>00946     {
<a name="l00947"></a>00947         <a class="code" href="../../d0/d6b/btScalar_8h.html#a2914d44e9957536703eda13dd0a4a2b2">btSwap</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i],<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#aeb6feaf5181be95d4cc84ff22d450a77">NEXTRAND</a>%ni]);
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00950"></a>00950     {
<a name="l00951"></a>00951         <a class="code" href="../../d0/d6b/btScalar_8h.html#a2914d44e9957536703eda13dd0a4a2b2">btSwap</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i],<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../de/db6/btSoftBody_8cpp.html#aeb6feaf5181be95d4cc84ff22d450a77">NEXTRAND</a>%ni]);
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953 <span class="preprocessor">#undef NEXTRAND</span>
<a name="l00954"></a>00954 <span class="preprocessor"></span>}
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="comment">//</span>
<a name="l00957"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a916cd79e87cf151686267100cb83031c">00957</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a916cd79e87cf151686267100cb83031c">btSoftBody::releaseCluster</a>(<span class="keywordtype">int</span> index)
<a name="l00958"></a>00958 {
<a name="l00959"></a>00959     <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>*    c=<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[index];
<a name="l00960"></a>00960     <span class="keywordflow">if</span>(c-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a7f01866a3ee1cd8c68f1ddae5f6d12fb">m_leaf</a>) <a class="code" href="../../da/d60/classbtSoftBody.html#a108b2be76b7647b2138d99e99b3bbdb0">m_cdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ae01b804da6734f4ce250f6fe7ef0b5fb">remove</a>(c-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a7f01866a3ee1cd8c68f1ddae5f6d12fb">m_leaf</a>);
<a name="l00961"></a>00961     c-&gt;~Cluster();
<a name="l00962"></a>00962     <a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a053f25687d0cd7a29571c8669cf9bcd4">btAlignedFree</a>(c);
<a name="l00963"></a>00963     <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6782242f06df5bab0cffbd23195cd9cd">remove</a>(c);
<a name="l00964"></a>00964 }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966 <span class="comment">//</span>
<a name="l00967"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9acc6f49f29e890115e42c4deec24f85">00967</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a9acc6f49f29e890115e42c4deec24f85">btSoftBody::releaseClusters</a>()
<a name="l00968"></a>00968 {
<a name="l00969"></a>00969     <span class="keywordflow">while</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()&gt;0) <a class="code" href="../../da/d60/classbtSoftBody.html#a916cd79e87cf151686267100cb83031c">releaseCluster</a>(0);
<a name="l00970"></a>00970 }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 <span class="comment">//</span>
<a name="l00973"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9915ca0d99dbeb9f39221dab218d5208">00973</a> <span class="keywordtype">int</span>             <a class="code" href="../../da/d60/classbtSoftBody.html#a9915ca0d99dbeb9f39221dab218d5208">btSoftBody::generateClusters</a>(<span class="keywordtype">int</span> k,<span class="keywordtype">int</span> maxiterations)
<a name="l00974"></a>00974 {
<a name="l00975"></a>00975     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00976"></a>00976     <a class="code" href="../../da/d60/classbtSoftBody.html#a9acc6f49f29e890115e42c4deec24f85">releaseClusters</a>();
<a name="l00977"></a>00977     <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d05/btMinMax_8h.html#a083aab7ffec01586f450c9f2696f7fe5">btMin</a>(k,<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()));
<a name="l00978"></a>00978     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00979"></a>00979     {
<a name="l00980"></a>00980         <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]           =   <span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>),16)) <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>();
<a name="l00981"></a>00981         <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_collide=   <span class="keyword">true</span>;
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983     k=<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l00984"></a>00984     <span class="keywordflow">if</span>(k&gt;0)
<a name="l00985"></a>00985     {
<a name="l00986"></a>00986         <span class="comment">/* Initialize       */</span> 
<a name="l00987"></a>00987         <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;btVector3&gt;</a> centers;
<a name="l00988"></a>00988         btVector3                       cog(0,0,0);
<a name="l00989"></a>00989         <span class="keywordtype">int</span>                             <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00990"></a>00990         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l00991"></a>00991         {
<a name="l00992"></a>00992             cog+=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x;
<a name="l00993"></a>00993             <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[(i*29873)%<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i]);
<a name="l00994"></a>00994         }
<a name="l00995"></a>00995         cog/=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l00996"></a>00996         centers.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(k,cog);
<a name="l00997"></a>00997         <span class="comment">/* Iterate          */</span> 
<a name="l00998"></a>00998         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  slope=16;
<a name="l00999"></a>00999         <span class="keywordtype">bool</span>            changed;
<a name="l01000"></a>01000         <span class="keywordtype">int</span>             iterations=0;
<a name="l01001"></a>01001         <span class="keywordflow">do</span>  {
<a name="l01002"></a>01002             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  w=2-btMin&lt;btScalar&gt;(1,iterations/slope);
<a name="l01003"></a>01003             changed=<span class="keyword">false</span>;
<a name="l01004"></a>01004             iterations++;   
<a name="l01005"></a>01005             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007             <span class="keywordflow">for</span>(i=0;i&lt;k;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01008"></a>01008             {
<a name="l01009"></a>01009                 btVector3   c(0,0,0);
<a name="l01010"></a>01010                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++j)
<a name="l01011"></a>01011                 {
<a name="l01012"></a>01012                     c+=<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes[j]-&gt;m_x;
<a name="l01013"></a>01013                 }
<a name="l01014"></a>01014                 <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[i]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l01015"></a>01015                 {
<a name="l01016"></a>01016                     c           /=  (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[i]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l01017"></a>01017                     c           =   centers[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]+(c-centers[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])*w;
<a name="l01018"></a>01018                     changed     |=  ((c-centers[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]).length2()&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>);
<a name="l01019"></a>01019                     centers[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]  =   c;
<a name="l01020"></a>01020                     <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(0);
<a name="l01021"></a>01021                 }           
<a name="l01022"></a>01022             }
<a name="l01023"></a>01023             <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01024"></a>01024             {
<a name="l01025"></a>01025                 <span class="keyword">const</span> btVector3 nx=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x;
<a name="l01026"></a>01026                 <span class="keywordtype">int</span>             kbest=0;
<a name="l01027"></a>01027                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        kdist=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a9ff392c5ebdd0a2c553696b92d7883c4">ClusterMetric</a>(centers[0],nx);
<a name="l01028"></a>01028                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;k;++j)
<a name="l01029"></a>01029                 {
<a name="l01030"></a>01030                     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  d=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a9ff392c5ebdd0a2c553696b92d7883c4">ClusterMetric</a>(centers[j],nx);
<a name="l01031"></a>01031                     <span class="keywordflow">if</span>(d&lt;kdist)
<a name="l01032"></a>01032                     {
<a name="l01033"></a>01033                         kbest=j;
<a name="l01034"></a>01034                         kdist=d;
<a name="l01035"></a>01035                     }
<a name="l01036"></a>01036                 }
<a name="l01037"></a>01037                 <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[kbest]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i]);
<a name="l01038"></a>01038             }       
<a name="l01039"></a>01039         } <span class="keywordflow">while</span>(changed&amp;&amp;(iterations&lt;maxiterations));
<a name="l01040"></a>01040         <span class="comment">/* Merge        */</span> 
<a name="l01041"></a>01041         <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a>   cids;
<a name="l01042"></a>01042         cids.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>(),-1);
<a name="l01043"></a>01043         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01044"></a>01044         {
<a name="l01045"></a>01045             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++j)
<a name="l01046"></a>01046             {
<a name="l01047"></a>01047                 cids[int(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[i]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[j]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0])]=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01048"></a>01048             }
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01051"></a>01051         {
<a name="l01052"></a>01052             <span class="keyword">const</span> <span class="keywordtype">int</span> idx[]={   int(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[0]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]),
<a name="l01053"></a>01053                 int(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[1]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]),
<a name="l01054"></a>01054                 int(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[2]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0])};
<a name="l01055"></a>01055             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j)
<a name="l01056"></a>01056             {
<a name="l01057"></a>01057                 <span class="keyword">const</span> <span class="keywordtype">int</span> cid=cids[idx[j]];
<a name="l01058"></a>01058                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> q=1;q&lt;3;++q)
<a name="l01059"></a>01059                 {
<a name="l01060"></a>01060                     <span class="keyword">const</span> <span class="keywordtype">int</span> kid=idx[(j+q)%3];
<a name="l01061"></a>01061                     <span class="keywordflow">if</span>(cids[kid]!=cid)
<a name="l01062"></a>01062                     {
<a name="l01063"></a>01063                         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[cid]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ae7b14c469b51e0ea010d3b9d701bc1b8">findLinearSearch</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[kid])==<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[cid]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l01064"></a>01064                         {
<a name="l01065"></a>01065                             <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[cid]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[kid]);
<a name="l01066"></a>01066                         }
<a name="l01067"></a>01067                     }
<a name="l01068"></a>01068                 }
<a name="l01069"></a>01069             }
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071         <span class="comment">/* Master       */</span> 
<a name="l01072"></a>01072         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()&gt;1)
<a name="l01073"></a>01073         {
<a name="l01074"></a>01074             <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>*    pmaster=<span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>),16)) <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>();
<a name="l01075"></a>01075             pmaster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ab64d0063b57ece06113a4d96dfcdbd2c">m_collide</a>  =   <span class="keyword">false</span>;
<a name="l01076"></a>01076             pmaster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a0bcdc850355c6742c66d50b16b102d9d">reserve</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l01077"></a>01077             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) pmaster-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i]);
<a name="l01078"></a>01078             <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(pmaster);
<a name="l01079"></a>01079             <a class="code" href="../../d0/d6b/btScalar_8h.html#a2914d44e9957536703eda13dd0a4a2b2">btSwap</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0],<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]);
<a name="l01080"></a>01080         }
<a name="l01081"></a>01081         <span class="comment">/* Terminate    */</span> 
<a name="l01082"></a>01082         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01083"></a>01083         {
<a name="l01084"></a>01084             <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[i]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()==0)
<a name="l01085"></a>01085             {
<a name="l01086"></a>01086                 <a class="code" href="../../da/d60/classbtSoftBody.html#a916cd79e87cf151686267100cb83031c">releaseCluster</a>(i--);
<a name="l01087"></a>01087             }
<a name="l01088"></a>01088         }
<a name="l01089"></a>01089     } <span class="keywordflow">else</span>
<a name="l01090"></a>01090     {
<a name="l01091"></a>01091         <span class="comment">//create a cluster for each tetrahedron (if tetrahedra exist) or each face</span>
<a name="l01092"></a>01092         <span class="keywordflow">if</span> (<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l01093"></a>01093         {
<a name="l01094"></a>01094             <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l01095"></a>01095             <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01096"></a>01096             {
<a name="l01097"></a>01097                 <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]           =   <span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>),16)) <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>();
<a name="l01098"></a>01098                 <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_collide=   <span class="keyword">true</span>;
<a name="l01099"></a>01099             }
<a name="l01100"></a>01100             <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i++)
<a name="l01101"></a>01101             {
<a name="l01102"></a>01102                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;4;j++)
<a name="l01103"></a>01103                 {
<a name="l01104"></a>01104                     <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>[i].m_n[j]);
<a name="l01105"></a>01105                 }
<a name="l01106"></a>01106             }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108         } <span class="keywordflow">else</span>
<a name="l01109"></a>01109         {
<a name="l01110"></a>01110             <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l01111"></a>01111             <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01112"></a>01112             {
<a name="l01113"></a>01113                 <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]           =   <span class="keyword">new</span>(<a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a5798ef3418d84a1761ef917ef6720db7">btAlignedAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>),16)) <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>();
<a name="l01114"></a>01114                 <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_collide=   <span class="keyword">true</span>;
<a name="l01115"></a>01115             }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117             <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01118"></a>01118             {
<a name="l01119"></a>01119                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j)
<a name="l01120"></a>01120                 {
<a name="l01121"></a>01121                     <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[j]);
<a name="l01122"></a>01122                 }
<a name="l01123"></a>01123             }
<a name="l01124"></a>01124         }
<a name="l01125"></a>01125     }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="keywordflow">if</span> (<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l01128"></a>01128     {
<a name="l01129"></a>01129         <a class="code" href="../../da/d60/classbtSoftBody.html#ac6bcd9853756ab196ea18c831a04a8b7">initializeClusters</a>();
<a name="l01130"></a>01130         <a class="code" href="../../da/d60/classbtSoftBody.html#a0fbc8cbbe127ff3d1ed9467e709a8181">updateClusters</a>();
<a name="l01131"></a>01131 
<a name="l01132"></a>01132 
<a name="l01133"></a>01133         <span class="comment">//for self-collision</span>
<a name="l01134"></a>01134         <a class="code" href="../../da/d60/classbtSoftBody.html#a2a7ce6797345d0b068b2d2bab2db0ff3">m_clusterConnectivity</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l01135"></a>01135         {
<a name="l01136"></a>01136             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c0=0;c0&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();c0++)
<a name="l01137"></a>01137             {
<a name="l01138"></a>01138                 <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[c0]-&gt;m_clusterIndex=c0;
<a name="l01139"></a>01139                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c1=0;c1&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();c1++)
<a name="l01140"></a>01140                 {
<a name="l01141"></a>01141                     
<a name="l01142"></a>01142                     <span class="keywordtype">bool</span> connected=<span class="keyword">false</span>;
<a name="l01143"></a>01143                     <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* cla = <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[c0];
<a name="l01144"></a>01144                     <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>* clb = <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[c1];
<a name="l01145"></a>01145                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;!connected&amp;&amp;i&lt;cla-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i++)
<a name="l01146"></a>01146                     {
<a name="l01147"></a>01147                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;clb-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();j++)
<a name="l01148"></a>01148                         {
<a name="l01149"></a>01149                             <span class="keywordflow">if</span> (cla-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[i] == clb-&gt;<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j])
<a name="l01150"></a>01150                             {
<a name="l01151"></a>01151                                 connected=<span class="keyword">true</span>;
<a name="l01152"></a>01152                                 <span class="keywordflow">break</span>;
<a name="l01153"></a>01153                             }
<a name="l01154"></a>01154                         }
<a name="l01155"></a>01155                     }
<a name="l01156"></a>01156                     <a class="code" href="../../da/d60/classbtSoftBody.html#a2a7ce6797345d0b068b2d2bab2db0ff3">m_clusterConnectivity</a>[c0+c1*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()]=connected;
<a name="l01157"></a>01157                 }
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159         }
<a name="l01160"></a>01160     }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l01163"></a>01163 }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165 <span class="comment">//</span>
<a name="l01166"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9d29ac0eb82c40645c17b5082a7325c9">01166</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a9d29ac0eb82c40645c17b5082a7325c9">btSoftBody::refine</a>(<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html">ImplicitFn</a>* ifn,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> accurary,<span class="keywordtype">bool</span> cut)
<a name="l01167"></a>01167 {
<a name="l01168"></a>01168     <span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>*         nbase = &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0];
<a name="l01169"></a>01169     <span class="keywordtype">int</span>                 ncount = <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l01170"></a>01170     <a class="code" href="../../de/dc9/structbtSymMatrix.html" title="btSoftBody implementation by Nathanael Presson">btSymMatrix&lt;int&gt;</a>    edges(ncount,-2);
<a name="l01171"></a>01171     <span class="keywordtype">int</span>                 newnodes=0;
<a name="l01172"></a>01172     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,ni;
<a name="l01173"></a>01173 
<a name="l01174"></a>01174     <span class="comment">/* Filter out       */</span> 
<a name="l01175"></a>01175     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;   l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01178"></a>01178         <span class="keywordflow">if</span>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a17ea04d617ec225f0213b30228ad6cb1">m_bbending</a>)
<a name="l01179"></a>01179         {
<a name="l01180"></a>01180             <span class="keywordflow">if</span>(!<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#afda700987be688b08370ed58636faba8">SameSign</a>(ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>),ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)))
<a name="l01181"></a>01181             {
<a name="l01182"></a>01182                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a2914d44e9957536703eda13dd0a4a2b2">btSwap</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i],<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]);
<a name="l01183"></a>01183                 <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6169be905e03b84ea3bc8d8f7c7fc39d">pop_back</a>();--<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01184"></a>01184             }
<a name="l01185"></a>01185         }   
<a name="l01186"></a>01186     }
<a name="l01187"></a>01187     <span class="comment">/* Fill edges       */</span> 
<a name="l01188"></a>01188     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01189"></a>01189     {
<a name="l01190"></a>01190         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;   l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01191"></a>01191         edges(<span class="keywordtype">int</span>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-nbase),<span class="keywordtype">int</span>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-nbase))=-1;
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01194"></a>01194     {   
<a name="l01195"></a>01195         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;   f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01196"></a>01196         edges(<span class="keywordtype">int</span>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-nbase),<span class="keywordtype">int</span>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-nbase))=-1;
<a name="l01197"></a>01197         edges(<span class="keywordtype">int</span>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-nbase),<span class="keywordtype">int</span>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-nbase))=-1;
<a name="l01198"></a>01198         edges(<span class="keywordtype">int</span>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-nbase),<span class="keywordtype">int</span>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-nbase))=-1;
<a name="l01199"></a>01199     }
<a name="l01200"></a>01200     <span class="comment">/* Intersect        */</span> 
<a name="l01201"></a>01201     <span class="keywordflow">for</span>(i=0;i&lt;ncount;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01202"></a>01202     {
<a name="l01203"></a>01203         <span class="keywordflow">for</span>(j=i+1;j&lt;ncount;++j)
<a name="l01204"></a>01204         {
<a name="l01205"></a>01205             <span class="keywordflow">if</span>(edges(i,j)==-1)
<a name="l01206"></a>01206             {
<a name="l01207"></a>01207                 <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           a=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01208"></a>01208                 <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           b=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[j];
<a name="l01209"></a>01209                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  t=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a1df53f398fc762b8837c82c36ea67d5d">ImplicitSolve</a>(ifn,a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,accurary);
<a name="l01210"></a>01210                 <span class="keywordflow">if</span>(t&gt;0)
<a name="l01211"></a>01211                 {
<a name="l01212"></a>01212                     <span class="keyword">const</span> btVector3 x=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,t);
<a name="l01213"></a>01213                     <span class="keyword">const</span> btVector3 v=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>,b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>,t);
<a name="l01214"></a>01214                     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        m=0;
<a name="l01215"></a>01215                     <span class="keywordflow">if</span>(a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l01216"></a>01216                     {
<a name="l01217"></a>01217                         <span class="keywordflow">if</span>(b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l01218"></a>01218                         {
<a name="l01219"></a>01219                             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  ma=1/a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>;
<a name="l01220"></a>01220                             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  mb=1/b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>;
<a name="l01221"></a>01221                             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  mc=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(ma,mb,t);
<a name="l01222"></a>01222                             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  f=(ma+mb)/(ma+mb+mc);
<a name="l01223"></a>01223                             a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>=1/(ma*f);
<a name="l01224"></a>01224                             b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>=1/(mb*f);
<a name="l01225"></a>01225                             m=mc*f;
<a name="l01226"></a>01226                         }
<a name="l01227"></a>01227                         <span class="keywordflow">else</span>
<a name="l01228"></a>01228                         { a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>/=0.5;m=1/a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>; }
<a name="l01229"></a>01229                     }
<a name="l01230"></a>01230                     <span class="keywordflow">else</span>
<a name="l01231"></a>01231                     {
<a name="l01232"></a>01232                         <span class="keywordflow">if</span>(b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l01233"></a>01233                         { b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>/=0.5;m=1/b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>; }
<a name="l01234"></a>01234                         <span class="keywordflow">else</span>
<a name="l01235"></a>01235                             m=0;
<a name="l01236"></a>01236                     }
<a name="l01237"></a>01237                     <a class="code" href="../../da/d60/classbtSoftBody.html#a6259e16009323fc8e936966b1fba1324">appendNode</a>(x,m);
<a name="l01238"></a>01238                     edges(i,j)=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1;
<a name="l01239"></a>01239                     <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[edges(i,j)].m_v=v;
<a name="l01240"></a>01240                     ++newnodes;
<a name="l01241"></a>01241                 }
<a name="l01242"></a>01242             }
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245     nbase=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0];
<a name="l01246"></a>01246     <span class="comment">/* Refine links     */</span> 
<a name="l01247"></a>01247     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01248"></a>01248     {
<a name="l01249"></a>01249         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;       feat=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01250"></a>01250         <span class="keyword">const</span> <span class="keywordtype">int</span>   idx[]={ int(feat.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-nbase),
<a name="l01251"></a>01251             int(feat.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-nbase)};
<a name="l01252"></a>01252         <span class="keywordflow">if</span>((idx[0]&lt;ncount)&amp;&amp;(idx[1]&lt;ncount))
<a name="l01253"></a>01253         {
<a name="l01254"></a>01254             <span class="keyword">const</span> <span class="keywordtype">int</span> ni=edges(idx[0],idx[1]);
<a name="l01255"></a>01255             <span class="keywordflow">if</span>(ni&gt;0)
<a name="l01256"></a>01256             {
<a name="l01257"></a>01257                 <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(i);
<a name="l01258"></a>01258                 <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>*       pft[]={ &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>],
<a name="l01259"></a>01259                     &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]};            
<a name="l01260"></a>01260                 pft[0]-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[idx[0]];
<a name="l01261"></a>01261                 pft[0]-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[ni];
<a name="l01262"></a>01262                 pft[1]-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[ni];
<a name="l01263"></a>01263                 pft[1]-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[idx[1]];
<a name="l01264"></a>01264             }
<a name="l01265"></a>01265         }
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267     <span class="comment">/* Refine faces     */</span> 
<a name="l01268"></a>01268     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01269"></a>01269     {
<a name="l01270"></a>01270         <span class="keyword">const</span> <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp; feat=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01271"></a>01271         <span class="keyword">const</span> <span class="keywordtype">int</span>   idx[]={ int(feat.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-nbase),
<a name="l01272"></a>01272             int(feat.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-nbase),
<a name="l01273"></a>01273             int(feat.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-nbase)};
<a name="l01274"></a>01274         <span class="keywordflow">for</span>(j=2,k=0;k&lt;3;j=k++)
<a name="l01275"></a>01275         {
<a name="l01276"></a>01276             <span class="keywordflow">if</span>((idx[j]&lt;ncount)&amp;&amp;(idx[k]&lt;ncount))
<a name="l01277"></a>01277             {
<a name="l01278"></a>01278                 <span class="keyword">const</span> <span class="keywordtype">int</span> ni=edges(idx[j],idx[k]);
<a name="l01279"></a>01279                 <span class="keywordflow">if</span>(ni&gt;0)
<a name="l01280"></a>01280                 {
<a name="l01281"></a>01281                     <a class="code" href="../../da/d60/classbtSoftBody.html#a1a89dadf0b4a8d9553d5e2263c034b07">appendFace</a>(i);
<a name="l01282"></a>01282                     <span class="keyword">const</span> <span class="keywordtype">int</span>   l=(k+1)%3;
<a name="l01283"></a>01283                     <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>*       pft[]={ &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>],
<a name="l01284"></a>01284                         &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]};
<a name="l01285"></a>01285                     pft[0]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[idx[l]];
<a name="l01286"></a>01286                     pft[0]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[idx[j]];
<a name="l01287"></a>01287                     pft[0]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[ni];
<a name="l01288"></a>01288                     pft[1]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[ni];
<a name="l01289"></a>01289                     pft[1]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[idx[k]];
<a name="l01290"></a>01290                     pft[1]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[idx[l]];
<a name="l01291"></a>01291                     <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(ni,idx[l],pft[0]-&gt;m_material);
<a name="l01292"></a>01292                     --<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;<span class="keywordflow">break</span>;
<a name="l01293"></a>01293                 }
<a name="l01294"></a>01294             }
<a name="l01295"></a>01295         }
<a name="l01296"></a>01296     }
<a name="l01297"></a>01297     <span class="comment">/* Cut              */</span> 
<a name="l01298"></a>01298     <span class="keywordflow">if</span>(cut)
<a name="l01299"></a>01299     {   
<a name="l01300"></a>01300         <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a>   cnodes;
<a name="l01301"></a>01301         <span class="keyword">const</span> <span class="keywordtype">int</span>                   pcount=ncount;
<a name="l01302"></a>01302         <span class="keywordtype">int</span>                         <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01303"></a>01303         ncount=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l01304"></a>01304         cnodes.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(ncount,0);
<a name="l01305"></a>01305         <span class="comment">/* Nodes        */</span> 
<a name="l01306"></a>01306         <span class="keywordflow">for</span>(i=0;i&lt;ncount;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01307"></a>01307         {
<a name="l01308"></a>01308             <span class="keyword">const</span> btVector3 x=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x;
<a name="l01309"></a>01309             <span class="keywordflow">if</span>((i&gt;=pcount)||(<a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(x))&lt;accurary))
<a name="l01310"></a>01310             {
<a name="l01311"></a>01311                 <span class="keyword">const</span> btVector3 v=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_v;
<a name="l01312"></a>01312                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>        m=<a class="code" href="../../da/d60/classbtSoftBody.html#a91645388270bc2f8bdf3dbf629f56201">getMass</a>(i);
<a name="l01313"></a>01313                 <span class="keywordflow">if</span>(m&gt;0) { m*=0.5;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im/=0.5; }
<a name="l01314"></a>01314                 <a class="code" href="../../da/d60/classbtSoftBody.html#a6259e16009323fc8e936966b1fba1324">appendNode</a>(x,m);
<a name="l01315"></a>01315                 cnodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1;
<a name="l01316"></a>01316                 <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[cnodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]].m_v=v;
<a name="l01317"></a>01317             }
<a name="l01318"></a>01318         }
<a name="l01319"></a>01319         nbase=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0];
<a name="l01320"></a>01320         <span class="comment">/* Links        */</span> 
<a name="l01321"></a>01321         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01322"></a>01322         {
<a name="l01323"></a>01323             <span class="keyword">const</span> <span class="keywordtype">int</span>       <span class="keywordtype">id</span>[]={  int(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0]-nbase),
<a name="l01324"></a>01324                 int(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1]-nbase)};
<a name="l01325"></a>01325             <span class="keywordtype">int</span>             todetach=0;
<a name="l01326"></a>01326             <span class="keywordflow">if</span>(cnodes[<span class="keywordtype">id</span>[0]]&amp;&amp;cnodes[<span class="keywordtype">id</span>[1]])
<a name="l01327"></a>01327             {
<a name="l01328"></a>01328                 <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(i);
<a name="l01329"></a>01329                 todetach=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1;
<a name="l01330"></a>01330             }
<a name="l01331"></a>01331             <span class="keywordflow">else</span>
<a name="l01332"></a>01332             {
<a name="l01333"></a>01333                 <span class="keywordflow">if</span>((    (ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<span class="keywordtype">id</span>[0]].m_x)&lt;accurary)&amp;&amp;
<a name="l01334"></a>01334                     (ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<span class="keywordtype">id</span>[1]].m_x)&lt;accurary)))
<a name="l01335"></a>01335                     todetach=i;
<a name="l01336"></a>01336             }
<a name="l01337"></a>01337             <span class="keywordflow">if</span>(todetach)
<a name="l01338"></a>01338             {
<a name="l01339"></a>01339                 <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;   l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[todetach];
<a name="l01340"></a>01340                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;2;++j)
<a name="l01341"></a>01341                 {
<a name="l01342"></a>01342                     <span class="keywordtype">int</span> cn=cnodes[int(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[j]-nbase)];
<a name="l01343"></a>01343                     <span class="keywordflow">if</span>(cn) l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[j]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[cn];
<a name="l01344"></a>01344                 }           
<a name="l01345"></a>01345             }
<a name="l01346"></a>01346         }
<a name="l01347"></a>01347         <span class="comment">/* Faces        */</span> 
<a name="l01348"></a>01348         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01349"></a>01349         {
<a name="l01350"></a>01350             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>**          n=  <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n;
<a name="l01351"></a>01351             <span class="keywordflow">if</span>( (ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(n[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)&lt;accurary)&amp;&amp;
<a name="l01352"></a>01352                 (ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(n[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)&lt;accurary)&amp;&amp;
<a name="l01353"></a>01353                 (ifn-&gt;<a class="code" href="../../dc/dd7/structbtSoftBody_1_1ImplicitFn.html#a3bbaaae0b8f0c1baf636ebfcfd66b482">Eval</a>(n[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)&lt;accurary))
<a name="l01354"></a>01354             {
<a name="l01355"></a>01355                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j)
<a name="l01356"></a>01356                 {
<a name="l01357"></a>01357                     <span class="keywordtype">int</span> cn=cnodes[int(n[j]-nbase)];
<a name="l01358"></a>01358                     <span class="keywordflow">if</span>(cn) n[j]=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[cn];
<a name="l01359"></a>01359                 }
<a name="l01360"></a>01360             }
<a name="l01361"></a>01361         }
<a name="l01362"></a>01362         <span class="comment">/* Clean orphans    */</span> 
<a name="l01363"></a>01363         <span class="keywordtype">int</span>                         nnodes=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l01364"></a>01364         <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a>   ranks;
<a name="l01365"></a>01365         <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a>   todelete;
<a name="l01366"></a>01366         ranks.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(nnodes,0);
<a name="l01367"></a>01367         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01368"></a>01368         {
<a name="l01369"></a>01369             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;2;++j) ranks[<span class="keywordtype">int</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[j]-nbase)]++;
<a name="l01370"></a>01370         }
<a name="l01371"></a>01371         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01372"></a>01372         {
<a name="l01373"></a>01373             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j) ranks[<span class="keywordtype">int</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[j]-nbase)]++;
<a name="l01374"></a>01374         }
<a name="l01375"></a>01375         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01376"></a>01376         {
<a name="l01377"></a>01377             <span class="keyword">const</span> <span class="keywordtype">int</span>   <span class="keywordtype">id</span>[]={  int(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0]-nbase),
<a name="l01378"></a>01378                 int(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1]-nbase)};
<a name="l01379"></a>01379             <span class="keyword">const</span> <span class="keywordtype">bool</span>  sg[]={  ranks[<span class="keywordtype">id</span>[0]]==1,
<a name="l01380"></a>01380                 ranks[<span class="keywordtype">id</span>[1]]==1};
<a name="l01381"></a>01381             <span class="keywordflow">if</span>(sg[0]||sg[1])
<a name="l01382"></a>01382             {
<a name="l01383"></a>01383                 --ranks[<span class="keywordtype">id</span>[0]];
<a name="l01384"></a>01384                 --ranks[<span class="keywordtype">id</span>[1]];
<a name="l01385"></a>01385                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a2914d44e9957536703eda13dd0a4a2b2">btSwap</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i],<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]);
<a name="l01386"></a>01386                 <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6169be905e03b84ea3bc8d8f7c7fc39d">pop_back</a>();--<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01387"></a>01387             }
<a name="l01388"></a>01388         }
<a name="l01389"></a>01389 <span class="preprocessor">#if 0   </span>
<a name="l01390"></a>01390 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(i=nnodes-1;i&gt;=0;--<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01391"></a>01391         {
<a name="l01392"></a>01392             <span class="keywordflow">if</span>(!ranks[i]) todelete.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(i);
<a name="l01393"></a>01393         }   
<a name="l01394"></a>01394         <span class="keywordflow">if</span>(todelete.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>())
<a name="l01395"></a>01395         {       
<a name="l01396"></a>01396             <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a>&amp;  map=ranks;
<a name="l01397"></a>01397             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;nnodes;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) map[i]=i;
<a name="l01398"></a>01398             PointersToIndices(<span class="keyword">this</span>);
<a name="l01399"></a>01399             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0,ni=todelete.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01400"></a>01400             {
<a name="l01401"></a>01401                 <span class="keywordtype">int</span>     j=todelete[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01402"></a>01402                 <span class="keywordtype">int</span>&amp;    a=map[j];
<a name="l01403"></a>01403                 <span class="keywordtype">int</span>&amp;    b=map[--nnodes];
<a name="l01404"></a>01404                 <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ae01b804da6734f4ce250f6fe7ef0b5fb">remove</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[a].m_leaf);<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[a].m_leaf=0;
<a name="l01405"></a>01405                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a2914d44e9957536703eda13dd0a4a2b2">btSwap</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[a],<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[b]);
<a name="l01406"></a>01406                 j=a;a=b;b=j;            
<a name="l01407"></a>01407             }
<a name="l01408"></a>01408             IndicesToPointers(<span class="keyword">this</span>,&amp;map[0]);
<a name="l01409"></a>01409             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(nnodes);
<a name="l01410"></a>01410         }
<a name="l01411"></a>01411 <span class="preprocessor">#endif</span>
<a name="l01412"></a>01412 <span class="preprocessor"></span>    }
<a name="l01413"></a>01413     <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">true</span>;
<a name="l01414"></a>01414 }
<a name="l01415"></a>01415 
<a name="l01416"></a>01416 <span class="comment">//</span>
<a name="l01417"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a1dd5a0790a03d3680f2dc939ea3a19e5">01417</a> <span class="keywordtype">bool</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a16f221920ddcc0485c13e6fba169c291">btSoftBody::cutLink</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* node0,<span class="keyword">const</span> <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>* node1,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> position)
<a name="l01418"></a>01418 {
<a name="l01419"></a>01419     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a16f221920ddcc0485c13e6fba169c291">cutLink</a>(<span class="keywordtype">int</span>(node0-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]),<span class="keywordtype">int</span>(node1-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]),position));
<a name="l01420"></a>01420 }
<a name="l01421"></a>01421 
<a name="l01422"></a>01422 <span class="comment">//</span>
<a name="l01423"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a16f221920ddcc0485c13e6fba169c291">01423</a> <span class="keywordtype">bool</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a16f221920ddcc0485c13e6fba169c291">btSoftBody::cutLink</a>(<span class="keywordtype">int</span> node0,<span class="keywordtype">int</span> node1,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> position)
<a name="l01424"></a>01424 {
<a name="l01425"></a>01425     <span class="keywordtype">bool</span>            done=<span class="keyword">false</span>;
<a name="l01426"></a>01426     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l01427"></a>01427     <span class="keyword">const</span> btVector3 d=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0].m_x-<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1].m_x;
<a name="l01428"></a>01428     <span class="keyword">const</span> btVector3 x=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0].m_x,<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1].m_x,position);
<a name="l01429"></a>01429     <span class="keyword">const</span> btVector3 v=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0].m_v,<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1].m_v,position);
<a name="l01430"></a>01430     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  m=1;
<a name="l01431"></a>01431     <a class="code" href="../../da/d60/classbtSoftBody.html#a6259e16009323fc8e936966b1fba1324">appendNode</a>(x,m);
<a name="l01432"></a>01432     <a class="code" href="../../da/d60/classbtSoftBody.html#a6259e16009323fc8e936966b1fba1324">appendNode</a>(x,m);
<a name="l01433"></a>01433     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>*           pa=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node0];
<a name="l01434"></a>01434     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>*           pb=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[node1];
<a name="l01435"></a>01435     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>*           pn[2]={ &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-2],
<a name="l01436"></a>01436         &amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]};
<a name="l01437"></a>01437     pn[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>=v;
<a name="l01438"></a>01438     pn[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>=v;
<a name="l01439"></a>01439     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01440"></a>01440     {
<a name="l01441"></a>01441         <span class="keyword">const</span> <span class="keywordtype">int</span> mtch=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a545581808cdae30595d29209317addef">MatchEdge</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0],<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1],pa,pb);
<a name="l01442"></a>01442         <span class="keywordflow">if</span>(mtch!=-1)
<a name="l01443"></a>01443         {
<a name="l01444"></a>01444             <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(i);
<a name="l01445"></a>01445             <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>*   pft[]={&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>],&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]};
<a name="l01446"></a>01446             pft[0]-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]=pn[mtch];
<a name="l01447"></a>01447             pft[1]-&gt;<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]=pn[1-mtch];
<a name="l01448"></a>01448             done=<span class="keyword">true</span>;
<a name="l01449"></a>01449         }
<a name="l01450"></a>01450     }
<a name="l01451"></a>01451     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01452"></a>01452     {
<a name="l01453"></a>01453         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=2,l=0;l&lt;3;k=l++)
<a name="l01454"></a>01454         {
<a name="l01455"></a>01455             <span class="keyword">const</span> <span class="keywordtype">int</span> mtch=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a545581808cdae30595d29209317addef">MatchEdge</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[k],<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[l],pa,pb);
<a name="l01456"></a>01456             <span class="keywordflow">if</span>(mtch!=-1)
<a name="l01457"></a>01457             {
<a name="l01458"></a>01458                 <a class="code" href="../../da/d60/classbtSoftBody.html#a1a89dadf0b4a8d9553d5e2263c034b07">appendFace</a>(i);
<a name="l01459"></a>01459                 <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>*   pft[]={&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>],&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()-1]};
<a name="l01460"></a>01460                 pft[0]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[l]=pn[mtch];
<a name="l01461"></a>01461                 pft[1]-&gt;<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[k]=pn[1-mtch];
<a name="l01462"></a>01462                 <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(pn[0],pft[0]-&gt;m_n[(l+1)%3],pft[0]-&gt;m_material,<span class="keyword">true</span>);
<a name="l01463"></a>01463                 <a class="code" href="../../da/d60/classbtSoftBody.html#ad632d23c33118bc061ac171a0a99ad20">appendLink</a>(pn[1],pft[0]-&gt;m_n[(l+1)%3],pft[0]-&gt;m_material,<span class="keyword">true</span>);
<a name="l01464"></a>01464             }
<a name="l01465"></a>01465         }
<a name="l01466"></a>01466     }
<a name="l01467"></a>01467     <span class="keywordflow">if</span>(!done)
<a name="l01468"></a>01468     {
<a name="l01469"></a>01469         <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ae01b804da6734f4ce250f6fe7ef0b5fb">remove</a>(pn[0]-&gt;m_leaf);
<a name="l01470"></a>01470         <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ae01b804da6734f4ce250f6fe7ef0b5fb">remove</a>(pn[1]-&gt;m_leaf);
<a name="l01471"></a>01471         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6169be905e03b84ea3bc8d8f7c7fc39d">pop_back</a>();
<a name="l01472"></a>01472         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6169be905e03b84ea3bc8d8f7c7fc39d">pop_back</a>();
<a name="l01473"></a>01473     }
<a name="l01474"></a>01474     <span class="keywordflow">return</span>(done);
<a name="l01475"></a>01475 }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477 <span class="comment">//</span>
<a name="l01478"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a3133d790dcff71b8e8a43eb966097485">01478</a> <span class="keywordtype">bool</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a3133d790dcff71b8e8a43eb966097485" title="Ray casting using rayFrom and rayTo in worldspace, (not direction!)">btSoftBody::rayTest</a>(<span class="keyword">const</span> btVector3&amp; rayFrom,
<a name="l01479"></a>01479                                     <span class="keyword">const</span> btVector3&amp; rayTo,
<a name="l01480"></a>01480                                     <a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html">sRayCast</a>&amp; results)
<a name="l01481"></a>01481 {
<a name="l01482"></a>01482     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()&amp;&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a272b9d6210f48dc2bbde5cdf4f98e987">empty</a>()) 
<a name="l01483"></a>01483         <a class="code" href="../../da/d60/classbtSoftBody.html#af92f269650f4235df9d8923e729a515a">initializeFaceTree</a>();
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#ad1c73060c43d6de8b0b31b9cb3c9296a">body</a>    =   <span class="keyword">this</span>;
<a name="l01486"></a>01486     results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#ac447ec3fddb58db8beb79c1d7c3ad92b" title="feature index">fraction</a> = 1.f;
<a name="l01487"></a>01487     results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#a41cf3cf2defa637a584159ceb7b42c0e" title="soft body">feature</a> =   <a class="code" href="../../df/dcf/structbtSoftBody_1_1eFeature.html#a51ea05112f741010b57b8deadf135f7aa0cd1e56a50f1ec8116e7e76275dd72e7">eFeature::None</a>;
<a name="l01488"></a>01488     results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#ad0f0741cdacfb4171e226f19368f1b69" title="feature type">index</a>   =   -1;
<a name="l01489"></a>01489 
<a name="l01490"></a>01490     <span class="keywordflow">return</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a3133d790dcff71b8e8a43eb966097485" title="Ray casting using rayFrom and rayTo in worldspace, (not direction!)">rayTest</a>(rayFrom,rayTo,results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#ac447ec3fddb58db8beb79c1d7c3ad92b" title="feature index">fraction</a>,results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#a41cf3cf2defa637a584159ceb7b42c0e" title="soft body">feature</a>,results.<a class="code" href="../../d0/d06/structbtSoftBody_1_1sRayCast.html#ad0f0741cdacfb4171e226f19368f1b69" title="feature type">index</a>,<span class="keyword">false</span>)!=0);
<a name="l01491"></a>01491 }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493 <span class="comment">//</span>
<a name="l01494"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a9da956f8d824e44cae9f8b37eff54c19">01494</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a9da956f8d824e44cae9f8b37eff54c19">btSoftBody::setSolver</a>(<a class="code" href="../../d2/de0/structbtSoftBody_1_1eSolverPresets.html#aca9f468831b5ac0c35998d8202caf049">eSolverPresets::_</a> preset)
<a name="l01495"></a>01495 {
<a name="l01496"></a>01496     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#ab62d23fc6f0ec2c4f2caea5f7d05c6cf">m_vsequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a12123db01dda7758f0df5e3bba10cc0a" title="clear the array, deallocated memory. Generally it is better to use array.resize(0), to reduce performance overhead of run-time memory (de)allocations.">clear</a>();
<a name="l01497"></a>01497     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a12123db01dda7758f0df5e3bba10cc0a" title="clear the array, deallocated memory. Generally it is better to use array.resize(0), to reduce performance overhead of run-time memory (de)allocations.">clear</a>();
<a name="l01498"></a>01498     <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a631da7f0a187b150e30c8fa76e0bfb94">m_dsequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a12123db01dda7758f0df5e3bba10cc0a" title="clear the array, deallocated memory. Generally it is better to use array.resize(0), to reduce performance overhead of run-time memory (de)allocations.">clear</a>();
<a name="l01499"></a>01499     <span class="keywordflow">switch</span>(preset)
<a name="l01500"></a>01500     {
<a name="l01501"></a>01501     <span class="keywordflow">case</span>    <a class="code" href="../../d2/de0/structbtSoftBody_1_1eSolverPresets.html#aca9f468831b5ac0c35998d8202caf049af1728cbce35d234df528955500cd9182">eSolverPresets::Positions</a>:
<a name="l01502"></a>01502         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86ad1de203597e3f891a95c3aaf4f805e84" title="Linear solver.">ePSolver::Anchors</a>);
<a name="l01503"></a>01503         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a18826149c80118f73e906b4966c69891" title="Anchor solver.">ePSolver::RContacts</a>);
<a name="l01504"></a>01504         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a1ff50fff0983fbc2e4ae19997d7bfb4e" title="Rigid contacts solver.">ePSolver::SContacts</a>);
<a name="l01505"></a>01505         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a6148c3ff201708184174dcc1b9a242a6">ePSolver::Linear</a>);  
<a name="l01506"></a>01506         <span class="keywordflow">break</span>;  
<a name="l01507"></a>01507     <span class="keywordflow">case</span>    <a class="code" href="../../d2/de0/structbtSoftBody_1_1eSolverPresets.html#aca9f468831b5ac0c35998d8202caf049abd5293ae445a251385bd60aef0ec9afd">eSolverPresets::Velocities</a>:
<a name="l01508"></a>01508         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#ab62d23fc6f0ec2c4f2caea5f7d05c6cf">m_vsequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d4/dcc/structbtSoftBody_1_1eVSolver.html#ad6a7083f91529d75cab91506cd63e088a41e9bf3b93c87326bbe46ab455b855aa">eVSolver::Linear</a>);
<a name="l01509"></a>01509 
<a name="l01510"></a>01510         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86ad1de203597e3f891a95c3aaf4f805e84" title="Linear solver.">ePSolver::Anchors</a>);
<a name="l01511"></a>01511         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a18826149c80118f73e906b4966c69891" title="Anchor solver.">ePSolver::RContacts</a>);
<a name="l01512"></a>01512         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a1ff50fff0983fbc2e4ae19997d7bfb4e" title="Rigid contacts solver.">ePSolver::SContacts</a>);
<a name="l01513"></a>01513 
<a name="l01514"></a>01514         <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a631da7f0a187b150e30c8fa76e0bfb94">m_dsequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#ad61e10166e2c00f487095d3482b9edd1">push_back</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a6148c3ff201708184174dcc1b9a242a6">ePSolver::Linear</a>);
<a name="l01515"></a>01515         <span class="keywordflow">break</span>;
<a name="l01516"></a>01516     }
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519 <span class="comment">//</span>
<a name="l01520"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a37b6906ab9c76448b81254ae3748ef66">01520</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a37b6906ab9c76448b81254ae3748ef66">btSoftBody::predictMotion</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt)
<a name="l01521"></a>01521 {
<a name="l01522"></a>01522 
<a name="l01523"></a>01523     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     <span class="comment">/* Update               */</span> 
<a name="l01526"></a>01526     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>)
<a name="l01527"></a>01527     {
<a name="l01528"></a>01528         <a class="code" href="../../da/d60/classbtSoftBody.html#a04af20a0326f6ebe8cf0901beb39c2fa">m_bUpdateRtCst</a>=<span class="keyword">false</span>;
<a name="l01529"></a>01529         <a class="code" href="../../da/d60/classbtSoftBody.html#ad73c943fe892bd5e3242e65de5df3db1">updateConstants</a>();
<a name="l01530"></a>01530         <a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a91d88cec6f5e212809cb9f47a967090c">clear</a>();
<a name="l01531"></a>01531         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>&amp;<a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a1ad696f1fa631c1256c18a3c8eb18ebc" title="Rigid versus soft mask.">fCollision::VF_SS</a>)
<a name="l01532"></a>01532         {
<a name="l01533"></a>01533             <a class="code" href="../../da/d60/classbtSoftBody.html#af92f269650f4235df9d8923e729a515a">initializeFaceTree</a>();           
<a name="l01534"></a>01534         }
<a name="l01535"></a>01535     }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537     <span class="comment">/* Prepare              */</span> 
<a name="l01538"></a>01538     <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>       =   dt*<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aca2a21b06d44629ad4d1fc0bb4d8a93d">timescale</a>;
<a name="l01539"></a>01539     <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a9e8fa89d8f7a168de0dedb36d59945bc">isdt</a>      =   1/<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l01540"></a>01540     <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a1c69b78153f16112307397d1df33d67a">velmrg</a>    =   <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>*3;
<a name="l01541"></a>01541     <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a2cfb8275eeb89b28d79bd63111b3896d">radmrg</a>    =   getCollisionShape()-&gt;getMargin();
<a name="l01542"></a>01542     <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a9c0af9368af8da8dfe7b94bd9d7542f0">updmrg</a>    =   <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a2cfb8275eeb89b28d79bd63111b3896d">radmrg</a>*(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)0.25;
<a name="l01543"></a>01543     <span class="comment">/* Forces               */</span> 
<a name="l01544"></a>01544     <a class="code" href="../../da/d60/classbtSoftBody.html#a3407addc1014cef6327ed009f4804da7">addVelocity</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>-&gt;<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html#ab2c7540c1556ddfb5adb6aeb2fee3392">m_gravity</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>);
<a name="l01545"></a>01545     <a class="code" href="../../da/d60/classbtSoftBody.html#ab60ff6213c14fe1f6c7a354503dadc80">applyForces</a>();
<a name="l01546"></a>01546     <span class="comment">/* Integrate            */</span> 
<a name="l01547"></a>01547     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01548"></a>01548     {
<a name="l01549"></a>01549         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01550"></a>01550         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>   =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>;
<a name="l01551"></a>01551         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>   +=  n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#aebe1f784e80e576a11338c21a5717069">m_f</a>*n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l01552"></a>01552         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>   +=  n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l01553"></a>01553         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#aebe1f784e80e576a11338c21a5717069">m_f</a>   =   btVector3(0,0,0);
<a name="l01554"></a>01554     }
<a name="l01555"></a>01555     <span class="comment">/* Clusters             */</span> 
<a name="l01556"></a>01556     <a class="code" href="../../da/d60/classbtSoftBody.html#a0fbc8cbbe127ff3d1ed9467e709a8181">updateClusters</a>();
<a name="l01557"></a>01557     <span class="comment">/* Bounds               */</span> 
<a name="l01558"></a>01558     <a class="code" href="../../da/d60/classbtSoftBody.html#aee48603cdeeb5cee57f6a210b135294b">updateBounds</a>(); 
<a name="l01559"></a>01559     <span class="comment">/* Nodes                */</span> 
<a name="l01560"></a>01560     <a class="code" href="../../d0/d6b/btScalar_8h.html#a38c30fdd0ea2558373a1b6e41c77d9d2">ATTRIBUTE_ALIGNED16</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html">btDbvtVolume</a>)   vol;
<a name="l01561"></a>01561     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01562"></a>01562     {
<a name="l01563"></a>01563         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01564"></a>01564         vol = <a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a6b9b2b5b6361d2b56285ce18733e2092">btDbvtVolume::FromCR</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a2cfb8275eeb89b28d79bd63111b3896d">radmrg</a>);
<a name="l01565"></a>01565         <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a6efe1f6bb9abd80ea76d1bfa97cebd2b">update</a>( n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#acca6a5b8479e45c00e07b68cdc482f3f">m_leaf</a>,
<a name="l01566"></a>01566             vol,
<a name="l01567"></a>01567             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a1c69b78153f16112307397d1df33d67a">velmrg</a>,
<a name="l01568"></a>01568             <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a9c0af9368af8da8dfe7b94bd9d7542f0">updmrg</a>);
<a name="l01569"></a>01569     }
<a name="l01570"></a>01570     <span class="comment">/* Faces                */</span> 
<a name="l01571"></a>01571     <span class="keywordflow">if</span>(!<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a272b9d6210f48dc2bbde5cdf4f98e987">empty</a>())
<a name="l01572"></a>01572     {
<a name="l01573"></a>01573         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01574"></a>01574         {
<a name="l01575"></a>01575             <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;           f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01576"></a>01576             <span class="keyword">const</span> btVector3 v=( f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>+
<a name="l01577"></a>01577                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>+
<a name="l01578"></a>01578                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>)/3;
<a name="l01579"></a>01579             vol = <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a32bf4ffbc67f1b6528560157ece4bbb8">VolumeOf</a>(f,<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a2cfb8275eeb89b28d79bd63111b3896d">radmrg</a>);
<a name="l01580"></a>01580             <a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a6efe1f6bb9abd80ea76d1bfa97cebd2b">update</a>( f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#ae0dce3a9981dc191dc4b0ff917239621">m_leaf</a>,
<a name="l01581"></a>01581                 vol,
<a name="l01582"></a>01582                 v*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a1c69b78153f16112307397d1df33d67a">velmrg</a>,
<a name="l01583"></a>01583                 <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a9c0af9368af8da8dfe7b94bd9d7542f0">updmrg</a>);
<a name="l01584"></a>01584         }
<a name="l01585"></a>01585     }
<a name="l01586"></a>01586     <span class="comment">/* Pose                 */</span> 
<a name="l01587"></a>01587     <a class="code" href="../../da/d60/classbtSoftBody.html#ac13d11fd5d294ce8924751b99d431c1c">updatePose</a>();
<a name="l01588"></a>01588     <span class="comment">/* Match                */</span> 
<a name="l01589"></a>01589     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#adf09c94d97fb44f3b88c3b1832776766">m_bframe</a>&amp;&amp;(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a8e9d39cceaf15fd8697b2f8831b2fee1">kMT</a>&gt;0))
<a name="l01590"></a>01590     {
<a name="l01591"></a>01591         <span class="keyword">const</span> <a class="code" href="../../d1/d7d/classbtMatrix3x3.html" title="The btMatrix3x3 class implements a 3x3 rotation matrix, to perform linear algebra in combination with...">btMatrix3x3</a>   posetrs=<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ac84ae4951c58adeee86b8e6113f2e2d2">m_rot</a>;
<a name="l01592"></a>01592         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01593"></a>01593         {
<a name="l01594"></a>01594             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01595"></a>01595             <span class="keywordflow">if</span>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l01596"></a>01596             {
<a name="l01597"></a>01597                 <span class="keyword">const</span> btVector3 x=posetrs*<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aa6cae81e27e3a4c8990423f2fa6bf182">m_pos</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]+<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a5083f27c5671f4ff377a6ee4d601ec6e">m_com</a>;
<a name="l01598"></a>01598                 n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,x,<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a8e9d39cceaf15fd8697b2f8831b2fee1">kMT</a>);
<a name="l01599"></a>01599             }
<a name="l01600"></a>01600         }
<a name="l01601"></a>01601     }
<a name="l01602"></a>01602     <span class="comment">/* Clear contacts       */</span> 
<a name="l01603"></a>01603     <a class="code" href="../../da/d60/classbtSoftBody.html#a8a6217d7ddb3dd99447c41a539e0cdc4">m_rcontacts</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(0);
<a name="l01604"></a>01604     <a class="code" href="../../da/d60/classbtSoftBody.html#ab86da8498926f0565f4813b32ffe9f67">m_scontacts</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(0);
<a name="l01605"></a>01605     <span class="comment">/* Optimize dbvt&#39;s      */</span> 
<a name="l01606"></a>01606     <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a198643b190f8cdac7d7d62cef8cf9bb1">optimizeIncremental</a>(1);
<a name="l01607"></a>01607     <a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a198643b190f8cdac7d7d62cef8cf9bb1">optimizeIncremental</a>(1);
<a name="l01608"></a>01608     <a class="code" href="../../da/d60/classbtSoftBody.html#a108b2be76b7647b2138d99e99b3bbdb0">m_cdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a198643b190f8cdac7d7d62cef8cf9bb1">optimizeIncremental</a>(1);
<a name="l01609"></a>01609 }
<a name="l01610"></a>01610 
<a name="l01611"></a>01611 <span class="comment">//</span>
<a name="l01612"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a98390e324d098502e6e9fb1ea2e52ab6">01612</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a98390e324d098502e6e9fb1ea2e52ab6">btSoftBody::solveConstraints</a>()
<a name="l01613"></a>01613 {
<a name="l01614"></a>01614 
<a name="l01615"></a>01615     <span class="comment">/* Apply clusters       */</span> 
<a name="l01616"></a>01616     <a class="code" href="../../da/d60/classbtSoftBody.html#a47c6e2066250a6c2564abadf3fc72029">applyClusters</a>(<span class="keyword">false</span>);
<a name="l01617"></a>01617     <span class="comment">/* Prepare links        */</span> 
<a name="l01618"></a>01618 
<a name="l01619"></a>01619     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01622"></a>01622     {
<a name="l01623"></a>01623         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;   l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01624"></a>01624         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a3d49299cc32dfbe9e864b6bd183e2d7f">m_c3</a>      =   l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>-l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>;
<a name="l01625"></a>01625         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad89b9138b78a7c5ad5f2ed99bedb96c7">m_c2</a>      =   1/(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a3d49299cc32dfbe9e864b6bd183e2d7f">m_c3</a>.length2()*l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a42498700f2ae06261fcf41f5f1733369">m_c0</a>);
<a name="l01626"></a>01626     }
<a name="l01627"></a>01627     <span class="comment">/* Prepare anchors      */</span> 
<a name="l01628"></a>01628     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01629"></a>01629     {
<a name="l01630"></a>01630         <a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html">Anchor</a>&amp;         a=<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01631"></a>01631         <span class="keyword">const</span> btVector3 ra=a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;getWorldTransform().getBasis()*a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a06d5ececcb7018b282039a82f5061e4a">m_local</a>;
<a name="l01632"></a>01632         a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#ad3928469ff917d5c03bbbbb1192026e5">m_c0</a>  =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#ac4c9d178ef110aa87a201b1fa3ea0ed3">ImpulseMatrix</a>(  <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>,
<a name="l01633"></a>01633             a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#abc1bf9b55ed97026448d561a3fee9d8b">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>,
<a name="l01634"></a>01634             a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#aff8193d59d882da6de7236b2410d7e52">getInvMass</a>(),
<a name="l01635"></a>01635             a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#aac3284d52f4dd4628a0e0ffbc6e05908">getInvInertiaTensorWorld</a>(),
<a name="l01636"></a>01636             ra);
<a name="l01637"></a>01637         a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a0570748f1978b7ab7cd6cc30eb5f6715">m_c1</a>  =   ra;
<a name="l01638"></a>01638         a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a4cd6a20a7e31d879e510ffe6ff076537">m_c2</a>  =   <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>*a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#abc1bf9b55ed97026448d561a3fee9d8b">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>;
<a name="l01639"></a>01639         a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;activate();
<a name="l01640"></a>01640     }
<a name="l01641"></a>01641     <span class="comment">/* Solve velocities     */</span> 
<a name="l01642"></a>01642     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aba421ab9d7267825bacabf8a0faa7e23">viterations</a>&gt;0)
<a name="l01643"></a>01643     {
<a name="l01644"></a>01644         <span class="comment">/* Solve            */</span> 
<a name="l01645"></a>01645         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isolve=0;isolve&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aba421ab9d7267825bacabf8a0faa7e23">viterations</a>;++isolve)
<a name="l01646"></a>01646         {
<a name="l01647"></a>01647             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iseq=0;iseq&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#ab62d23fc6f0ec2c4f2caea5f7d05c6cf">m_vsequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++iseq)
<a name="l01648"></a>01648             {
<a name="l01649"></a>01649                 <a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">getSolver</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#ab62d23fc6f0ec2c4f2caea5f7d05c6cf">m_vsequence</a>[iseq])(<span class="keyword">this</span>,1);
<a name="l01650"></a>01650             }
<a name="l01651"></a>01651         }
<a name="l01652"></a>01652         <span class="comment">/* Update           */</span> 
<a name="l01653"></a>01653         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01654"></a>01654         {
<a name="l01655"></a>01655             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01656"></a>01656             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>   =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>+n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l01657"></a>01657         }
<a name="l01658"></a>01658     }
<a name="l01659"></a>01659     <span class="comment">/* Solve positions      */</span> 
<a name="l01660"></a>01660     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a281a562a273f8d02f9b7354aa1bf1c86">piterations</a>&gt;0)
<a name="l01661"></a>01661     {
<a name="l01662"></a>01662         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isolve=0;isolve&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a281a562a273f8d02f9b7354aa1bf1c86">piterations</a>;++isolve)
<a name="l01663"></a>01663         {
<a name="l01664"></a>01664             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> ti=isolve/(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a281a562a273f8d02f9b7354aa1bf1c86">piterations</a>;
<a name="l01665"></a>01665             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iseq=0;iseq&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++iseq)
<a name="l01666"></a>01666             {
<a name="l01667"></a>01667                 <a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">getSolver</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>[iseq])(<span class="keyword">this</span>,1,ti);
<a name="l01668"></a>01668             }
<a name="l01669"></a>01669         }
<a name="l01670"></a>01670         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  vc=<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a9e8fa89d8f7a168de0dedb36d59945bc">isdt</a>*(1-<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a307cb6ef5523b702defdbabe51ec9603">kDP</a>);
<a name="l01671"></a>01671         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01672"></a>01672         {
<a name="l01673"></a>01673             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01674"></a>01674             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>   =   (n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>)*vc;
<a name="l01675"></a>01675             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#aebe1f784e80e576a11338c21a5717069">m_f</a>   =   btVector3(0,0,0);       
<a name="l01676"></a>01676         }
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678     <span class="comment">/* Solve drift          */</span> 
<a name="l01679"></a>01679     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a2308fe57ad7f38ca9a2f5fe934156f6c">diterations</a>&gt;0)
<a name="l01680"></a>01680     {
<a name="l01681"></a>01681         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  vcf=<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a18eec41b81c8a86632b2c9b1892ae462">kVCF</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a9e8fa89d8f7a168de0dedb36d59945bc">isdt</a>;
<a name="l01682"></a>01682         <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01683"></a>01683         {
<a name="l01684"></a>01684             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01685"></a>01685             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>   =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>;
<a name="l01686"></a>01686         }
<a name="l01687"></a>01687         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idrift=0;idrift&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a2308fe57ad7f38ca9a2f5fe934156f6c">diterations</a>;++idrift)
<a name="l01688"></a>01688         {
<a name="l01689"></a>01689             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iseq=0;iseq&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a631da7f0a187b150e30c8fa76e0bfb94">m_dsequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++iseq)
<a name="l01690"></a>01690             {
<a name="l01691"></a>01691                 <a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">getSolver</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a631da7f0a187b150e30c8fa76e0bfb94">m_dsequence</a>[iseq])(<span class="keyword">this</span>,1,0);
<a name="l01692"></a>01692             }
<a name="l01693"></a>01693         }
<a name="l01694"></a>01694         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01695"></a>01695         {
<a name="l01696"></a>01696             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01697"></a>01697             n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>   +=  (n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>)*vcf;
<a name="l01698"></a>01698         }
<a name="l01699"></a>01699     }
<a name="l01700"></a>01700     <span class="comment">/* Apply clusters       */</span> 
<a name="l01701"></a>01701     <a class="code" href="../../da/d60/classbtSoftBody.html#a83d01c7ffe27a02f42bcb9d191c4a327">dampClusters</a>();
<a name="l01702"></a>01702     <a class="code" href="../../da/d60/classbtSoftBody.html#a47c6e2066250a6c2564abadf3fc72029">applyClusters</a>(<span class="keyword">true</span>);
<a name="l01703"></a>01703 }
<a name="l01704"></a>01704 
<a name="l01705"></a>01705 <span class="comment">//</span>
<a name="l01706"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a653fd3d83a1f7a8d0547b20e17af4483">01706</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a653fd3d83a1f7a8d0547b20e17af4483">btSoftBody::staticSolve</a>(<span class="keywordtype">int</span> iterations)
<a name="l01707"></a>01707 {
<a name="l01708"></a>01708     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> isolve=0;isolve&lt;iterations;++isolve)
<a name="l01709"></a>01709     {
<a name="l01710"></a>01710         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iseq=0;iseq&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++iseq)
<a name="l01711"></a>01711         {
<a name="l01712"></a>01712             <a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">getSolver</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a48c3acf5e2f871a71cbc846b2ddc7b9d">m_psequence</a>[iseq])(<span class="keyword">this</span>,1,0);
<a name="l01713"></a>01713         }
<a name="l01714"></a>01714     }
<a name="l01715"></a>01715 }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717 <span class="comment">//</span>
<a name="l01718"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ae8a2fc459b2afc985fbb03c1b0203bec">01718</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#ae8a2fc459b2afc985fbb03c1b0203bec">btSoftBody::solveCommonConstraints</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>** <span class="comment">/*bodies*/</span>,<span class="keywordtype">int</span> <span class="comment">/*count*/</span>,<span class="keywordtype">int</span> <span class="comment">/*iterations*/</span>)
<a name="l01719"></a>01719 {
<a name="l01721"></a>01721 }
<a name="l01722"></a>01722 
<a name="l01723"></a>01723 <span class="comment">//</span>
<a name="l01724"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aa4129fb3eb8bc03f50ce8b25b28b3842">01724</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#aa4129fb3eb8bc03f50ce8b25b28b3842">btSoftBody::solveClusters</a>(<span class="keyword">const</span> <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;btSoftBody*&gt;</a>&amp; bodies)
<a name="l01725"></a>01725 {
<a name="l01726"></a>01726     <span class="keyword">const</span> <span class="keywordtype">int</span>   nb=bodies.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l01727"></a>01727     <span class="keywordtype">int</span>         iterations=0;
<a name="l01728"></a>01728     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01729"></a>01729 
<a name="l01730"></a>01730     <span class="keywordflow">for</span>(i=0;i&lt;nb;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01731"></a>01731     {
<a name="l01732"></a>01732         iterations=<a class="code" href="../../da/d05/btMinMax_8h.html#ac663fae9d94f02fb5a2d45828aa91ba1">btMax</a>(iterations,bodies[i]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a120909b8c9563169d6457cc9e00a885d">citerations</a>);
<a name="l01733"></a>01733     }
<a name="l01734"></a>01734     <span class="keywordflow">for</span>(i=0;i&lt;nb;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01735"></a>01735     {
<a name="l01736"></a>01736         bodies[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;prepareClusters(iterations);
<a name="l01737"></a>01737     }
<a name="l01738"></a>01738     <span class="keywordflow">for</span>(i=0;i&lt;iterations;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01739"></a>01739     {
<a name="l01740"></a>01740         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> sor=1;
<a name="l01741"></a>01741         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;nb;++j)
<a name="l01742"></a>01742         {
<a name="l01743"></a>01743             bodies[j]-&gt;solveClusters(sor);
<a name="l01744"></a>01744         }
<a name="l01745"></a>01745     }
<a name="l01746"></a>01746     <span class="keywordflow">for</span>(i=0;i&lt;nb;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01747"></a>01747     {
<a name="l01748"></a>01748         bodies[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;cleanupClusters();
<a name="l01749"></a>01749     }
<a name="l01750"></a>01750 }
<a name="l01751"></a>01751 
<a name="l01752"></a>01752 <span class="comment">//</span>
<a name="l01753"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a21d3a56dff4c4999a2da272b712e616c">01753</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a21d3a56dff4c4999a2da272b712e616c">btSoftBody::integrateMotion</a>()
<a name="l01754"></a>01754 {
<a name="l01755"></a>01755     <span class="comment">/* Update           */</span> 
<a name="l01756"></a>01756     <a class="code" href="../../da/d60/classbtSoftBody.html#ab362c5aca67e90032065945ce15cff31">updateNormals</a>();
<a name="l01757"></a>01757 }
<a name="l01758"></a>01758 
<a name="l01759"></a>01759 <span class="comment">//</span>
<a name="l01760"></a><a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a24b9d523391dbc0bc3e01b7dba4aaa13">01760</a> <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a24b9d523391dbc0bc3e01b7dba4aaa13">btSoftBody::RayFromToCaster::RayFromToCaster</a>(<span class="keyword">const</span> btVector3&amp; rayFrom,<span class="keyword">const</span> btVector3&amp; rayTo,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> mxt)
<a name="l01761"></a>01761 {
<a name="l01762"></a>01762     <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#ab3ff09a98d5e68aba2263e273f322b54">m_rayFrom</a> = rayFrom;
<a name="l01763"></a>01763     <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#aaeb2327d0033ed8ee400e9fef264417d">m_rayNormalizedDirection</a> = (rayTo-rayFrom);
<a name="l01764"></a>01764     <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a8d6bc6ea5ac0af8f69a2a1fbe5c90330">m_rayTo</a> = rayTo;
<a name="l01765"></a>01765     <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a30f1a9893610c9f60388fea3d115a53e">m_mint</a>  =   mxt;
<a name="l01766"></a>01766     <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a1857b969f47f52d8fb5607bf943836af">m_face</a>  =   0;
<a name="l01767"></a>01767     <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a3363fdfd71f927b7f1af70bf16843194">m_tests</a> =   0;
<a name="l01768"></a>01768 }
<a name="l01769"></a>01769 
<a name="l01770"></a>01770 <span class="comment">//</span>
<a name="l01771"></a><a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a621df5173379b16c357db2bdc0193b5a">01771</a> <span class="keywordtype">void</span>                <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a621df5173379b16c357db2bdc0193b5a">btSoftBody::RayFromToCaster::Process</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d7b/structbtDbvtNode.html">btDbvtNode</a>* leaf)
<a name="l01772"></a>01772 {
<a name="l01773"></a>01773     <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">btSoftBody::Face</a>&amp;   f=*(<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">btSoftBody::Face</a>*)leaf-&gt;<a class="code" href="../../dd/d7b/structbtDbvtNode.html#a58e20816d17e153f2bb5b622ee79e7f7">data</a>;
<a name="l01774"></a>01774     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      t=rayFromToTriangle(    m_rayFrom,m_rayTo,m_rayNormalizedDirection,
<a name="l01775"></a>01775         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l01776"></a>01776         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l01777"></a>01777         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l01778"></a>01778         m_mint);
<a name="l01779"></a>01779     <span class="keywordflow">if</span>((t&gt;0)&amp;&amp;(t&lt;m_mint)) 
<a name="l01780"></a>01780     { 
<a name="l01781"></a>01781         m_mint=t;m_face=&amp;f; 
<a name="l01782"></a>01782     }
<a name="l01783"></a>01783     ++m_tests;
<a name="l01784"></a>01784 }
<a name="l01785"></a>01785 
<a name="l01786"></a>01786 <span class="comment">//</span>
<a name="l01787"></a><a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a65b5c54f01dd39409b9b743982e8ef01">01787</a> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>            <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a65b5c54f01dd39409b9b743982e8ef01">btSoftBody::RayFromToCaster::rayFromToTriangle</a>( <span class="keyword">const</span> btVector3&amp; rayFrom,
<a name="l01788"></a>01788                                                                    <span class="keyword">const</span> btVector3&amp; rayTo,
<a name="l01789"></a>01789                                                                    <span class="keyword">const</span> btVector3&amp; rayNormalizedDirection,
<a name="l01790"></a>01790                                                                    <span class="keyword">const</span> btVector3&amp; a,
<a name="l01791"></a>01791                                                                    <span class="keyword">const</span> btVector3&amp; b,
<a name="l01792"></a>01792                                                                    <span class="keyword">const</span> btVector3&amp; c,
<a name="l01793"></a>01793                                                                    <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> maxt)
<a name="l01794"></a>01794 {
<a name="l01795"></a>01795     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>   ceps=-<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>*10;
<a name="l01796"></a>01796     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>   teps=<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>*10;
<a name="l01797"></a>01797 
<a name="l01798"></a>01798     <span class="keyword">const</span> btVector3         n=<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(b-a,c-a);
<a name="l01799"></a>01799     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>          d=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(a,n);
<a name="l01800"></a>01800     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>          den=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(rayNormalizedDirection,n);
<a name="l01801"></a>01801     <span class="keywordflow">if</span>(!<a class="code" href="../../d0/d6b/btScalar_8h.html#a64883187cf63c81ef5fb15f6f0c7ae05">btFuzzyZero</a>(den))
<a name="l01802"></a>01802     {
<a name="l01803"></a>01803         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      num=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(rayFrom,n)-d;
<a name="l01804"></a>01804         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      t=-num/den;
<a name="l01805"></a>01805         <span class="keywordflow">if</span>((t&gt;teps)&amp;&amp;(t&lt;maxt))
<a name="l01806"></a>01806         {
<a name="l01807"></a>01807             <span class="keyword">const</span> btVector3 hit=rayFrom+rayNormalizedDirection*t;
<a name="l01808"></a>01808             <span class="keywordflow">if</span>( (<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(n,<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(a-hit,b-hit))&gt;ceps)    &amp;&amp;          
<a name="l01809"></a>01809                 (<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(n,<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(b-hit,c-hit))&gt;ceps)    &amp;&amp;
<a name="l01810"></a>01810                 (<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(n,<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(c-hit,a-hit))&gt;ceps))
<a name="l01811"></a>01811             {
<a name="l01812"></a>01812                 <span class="keywordflow">return</span>(t);
<a name="l01813"></a>01813             }
<a name="l01814"></a>01814         }
<a name="l01815"></a>01815     }
<a name="l01816"></a>01816     <span class="keywordflow">return</span>(-1);
<a name="l01817"></a>01817 }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819 <span class="comment">//</span>
<a name="l01820"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ab0c0d590f7b945029af1f5afc26b58ab">01820</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#ab0c0d590f7b945029af1f5afc26b58ab">btSoftBody::pointersToIndices</a>()
<a name="l01821"></a>01821 {
<a name="l01822"></a>01822 <span class="preprocessor">#define PTR2IDX(_p_,_b_)    reinterpret_cast&lt;btSoftBody::Node*&gt;((_p_)-(_b_))</span>
<a name="l01823"></a>01823 <span class="preprocessor"></span>    <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">btSoftBody::Node</a>*   base=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0];
<a name="l01824"></a>01824     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l01825"></a>01825 
<a name="l01826"></a>01826     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01827"></a>01827     {
<a name="l01828"></a>01828         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i].m_leaf)
<a name="l01829"></a>01829         {
<a name="l01830"></a>01830             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_leaf-&gt;data=*(<span class="keywordtype">void</span>**)&amp;i;
<a name="l01831"></a>01831         }
<a name="l01832"></a>01832     }
<a name="l01833"></a>01833     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01834"></a>01834     {
<a name="l01835"></a>01835         <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[0]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0],base);
<a name="l01836"></a>01836         <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[1]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1],base);
<a name="l01837"></a>01837     }
<a name="l01838"></a>01838     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01839"></a>01839     {
<a name="l01840"></a>01840         <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[0]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[0],base);
<a name="l01841"></a>01841         <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[1]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[1],base);
<a name="l01842"></a>01842         <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[2]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[2],base);
<a name="l01843"></a>01843         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_leaf)
<a name="l01844"></a>01844         {
<a name="l01845"></a>01845             <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_leaf-&gt;data=*(<span class="keywordtype">void</span>**)&amp;i;
<a name="l01846"></a>01846         }
<a name="l01847"></a>01847     }
<a name="l01848"></a>01848     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01849"></a>01849     {
<a name="l01850"></a>01850         <a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_node=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[i].m_node,base);
<a name="l01851"></a>01851     }
<a name="l01852"></a>01852     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01853"></a>01853     {
<a name="l01854"></a>01854         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_rank;++j)
<a name="l01855"></a>01855         {
<a name="l01856"></a>01856             <a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_nodes[j]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a85886ebdfa205ca6ab9efd1446fd0255">PTR2IDX</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>[i].<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[j],base);
<a name="l01857"></a>01857         }
<a name="l01858"></a>01858     }
<a name="l01859"></a>01859 <span class="preprocessor">#undef  PTR2IDX</span>
<a name="l01860"></a>01860 <span class="preprocessor"></span>}
<a name="l01861"></a>01861 
<a name="l01862"></a>01862 <span class="comment">//</span>
<a name="l01863"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ae7d0c0ae69ea5801118a049f590fe703">01863</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#ae7d0c0ae69ea5801118a049f590fe703">btSoftBody::indicesToPointers</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>* map)
<a name="l01864"></a>01864 {
<a name="l01865"></a>01865 <span class="preprocessor">#define IDX2PTR(_p_,_b_)    map?(&amp;(_b_)[map[(((char*)_p_)-(char*)0)]]): \</span>
<a name="l01866"></a>01866 <span class="preprocessor">    (&amp;(_b_)[(((char*)_p_)-(char*)0)])</span>
<a name="l01867"></a>01867 <span class="preprocessor"></span>    <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">btSoftBody::Node</a>*   base=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0];
<a name="l01868"></a>01868     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01871"></a>01871     {
<a name="l01872"></a>01872         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[i].m_leaf)
<a name="l01873"></a>01873         {
<a name="l01874"></a>01874             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_leaf-&gt;data=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01875"></a>01875         }
<a name="l01876"></a>01876     }
<a name="l01877"></a>01877     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01878"></a>01878     {
<a name="l01879"></a>01879         <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[0]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[0],base);
<a name="l01880"></a>01880         <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[1]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[i].m_n[1],base);
<a name="l01881"></a>01881     }
<a name="l01882"></a>01882     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01883"></a>01883     {
<a name="l01884"></a>01884         <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[0]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[0],base);
<a name="l01885"></a>01885         <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[1]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[1],base);
<a name="l01886"></a>01886         <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[2]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_n[2],base);
<a name="l01887"></a>01887         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[i].m_leaf)
<a name="l01888"></a>01888         {
<a name="l01889"></a>01889             <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_leaf-&gt;data=&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01890"></a>01890         }
<a name="l01891"></a>01891     }
<a name="l01892"></a>01892     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01893"></a>01893     {
<a name="l01894"></a>01894         <a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_node=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[i].m_node,base);
<a name="l01895"></a>01895     }
<a name="l01896"></a>01896     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01897"></a>01897     {
<a name="l01898"></a>01898         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_rank;++j)
<a name="l01899"></a>01899         {
<a name="l01900"></a>01900             <a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_nodes[j]=<a class="code" href="../../de/db6/btSoftBody_8cpp.html#a827ea74ac9b89929e15b68420bad1c7e">IDX2PTR</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab2d4d22ffbeed6ae64366f94e1e72fa2">m_notes</a>[i].<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[j],base);
<a name="l01901"></a>01901         }
<a name="l01902"></a>01902     }
<a name="l01903"></a>01903 <span class="preprocessor">#undef  IDX2PTR</span>
<a name="l01904"></a>01904 <span class="preprocessor"></span>}
<a name="l01905"></a>01905 
<a name="l01906"></a>01906 <span class="comment">//</span>
<a name="l01907"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a05e57d2031d33fec2557a4e7cf2c9ab3">01907</a> <span class="keywordtype">int</span>                 <a class="code" href="../../da/d60/classbtSoftBody.html#a3133d790dcff71b8e8a43eb966097485" title="Ray casting using rayFrom and rayTo in worldspace, (not direction!)">btSoftBody::rayTest</a>(<span class="keyword">const</span> btVector3&amp; rayFrom,<span class="keyword">const</span> btVector3&amp; rayTo,
<a name="l01908"></a>01908                                         <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>&amp; mint,<a class="code" href="../../df/dcf/structbtSoftBody_1_1eFeature.html#a51ea05112f741010b57b8deadf135f7a">eFeature::_</a>&amp; feature,<span class="keywordtype">int</span>&amp; index,<span class="keywordtype">bool</span> bcountonly)<span class="keyword"> const</span>
<a name="l01909"></a>01909 <span class="keyword"></span>{
<a name="l01910"></a>01910     <span class="keywordtype">int</span> cnt=0;
<a name="l01911"></a>01911     <span class="keywordflow">if</span>(bcountonly||<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a272b9d6210f48dc2bbde5cdf4f98e987">empty</a>())
<a name="l01912"></a>01912     {<span class="comment">/* Full search */</span> 
<a name="l01913"></a>01913         btVector3 dir = rayTo-rayFrom;
<a name="l01914"></a>01914         dir.normalize();
<a name="l01915"></a>01915 
<a name="l01916"></a>01916         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01917"></a>01917         {
<a name="l01918"></a>01918             <span class="keyword">const</span> <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">btSoftBody::Face</a>&amp; f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01919"></a>01919 
<a name="l01920"></a>01920             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>          t=<a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a65b5c54f01dd39409b9b743982e8ef01">RayFromToCaster::rayFromToTriangle</a>(   rayFrom,rayTo,dir,
<a name="l01921"></a>01921                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l01922"></a>01922                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l01923"></a>01923                 f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l01924"></a>01924                 mint);
<a name="l01925"></a>01925             <span class="keywordflow">if</span>(t&gt;0)
<a name="l01926"></a>01926             {
<a name="l01927"></a>01927                 ++cnt;
<a name="l01928"></a>01928                 <span class="keywordflow">if</span>(!bcountonly)
<a name="l01929"></a>01929                 {
<a name="l01930"></a>01930                     feature=<a class="code" href="../../df/dcf/structbtSoftBody_1_1eFeature.html#a51ea05112f741010b57b8deadf135f7aa09455013860a4c26d012da65fc4ae7f2">btSoftBody::eFeature::Face</a>;
<a name="l01931"></a>01931                     index=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01932"></a>01932                     mint=t;
<a name="l01933"></a>01933                 }
<a name="l01934"></a>01934             }
<a name="l01935"></a>01935         }
<a name="l01936"></a>01936     }
<a name="l01937"></a>01937     <span class="keywordflow">else</span>
<a name="l01938"></a>01938     {<span class="comment">/* Use dbvt    */</span> 
<a name="l01939"></a>01939         <a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html" title="RayFromToCaster takes a ray from, ray to (instead of direction!)">RayFromToCaster</a> collider(rayFrom,rayTo,mint);
<a name="l01940"></a>01940 
<a name="l01941"></a>01941         <a class="code" href="../../da/d60/classbtSoftBody.html#a3133d790dcff71b8e8a43eb966097485" title="Ray casting using rayFrom and rayTo in worldspace, (not direction!)">btDbvt::rayTest</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>,rayFrom,rayTo,collider);
<a name="l01942"></a>01942         <span class="keywordflow">if</span>(collider.<a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a1857b969f47f52d8fb5607bf943836af">m_face</a>)
<a name="l01943"></a>01943         {
<a name="l01944"></a>01944             mint=collider.<a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a30f1a9893610c9f60388fea3d115a53e">m_mint</a>;
<a name="l01945"></a>01945             feature=<a class="code" href="../../df/dcf/structbtSoftBody_1_1eFeature.html#a51ea05112f741010b57b8deadf135f7aa09455013860a4c26d012da65fc4ae7f2">btSoftBody::eFeature::Face</a>;
<a name="l01946"></a>01946             index=(int)(collider.<a class="code" href="../../df/dcf/structbtSoftBody_1_1RayFromToCaster.html#a1857b969f47f52d8fb5607bf943836af">m_face</a>-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[0]);
<a name="l01947"></a>01947             cnt=1;
<a name="l01948"></a>01948         }
<a name="l01949"></a>01949     }
<a name="l01950"></a>01950     <span class="keywordflow">return</span>(cnt);
<a name="l01951"></a>01951 }
<a name="l01952"></a>01952 
<a name="l01953"></a>01953 <span class="comment">//</span>
<a name="l01954"></a><a class="code" href="../../da/d60/classbtSoftBody.html#af92f269650f4235df9d8923e729a515a">01954</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#af92f269650f4235df9d8923e729a515a">btSoftBody::initializeFaceTree</a>()
<a name="l01955"></a>01955 {
<a name="l01956"></a>01956     <a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a91d88cec6f5e212809cb9f47a967090c">clear</a>();
<a name="l01957"></a>01957     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01958"></a>01958     {
<a name="l01959"></a>01959         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;   f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01960"></a>01960         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#ae0dce3a9981dc191dc4b0ff917239621">m_leaf</a>=<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a0efd4485566228688870dc7340365d03">insert</a>(<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a32bf4ffbc67f1b6528560157ece4bbb8">VolumeOf</a>(f,0),&amp;f);
<a name="l01961"></a>01961     }
<a name="l01962"></a>01962 }
<a name="l01963"></a>01963 
<a name="l01964"></a>01964 <span class="comment">//</span>
<a name="l01965"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a3705e365dc96446bc489c392dcf2ac0c">01965</a> btVector3       <a class="code" href="../../da/d60/classbtSoftBody.html#a3705e365dc96446bc489c392dcf2ac0c">btSoftBody::evaluateCom</a>()<span class="keyword"> const</span>
<a name="l01966"></a>01966 <span class="keyword"></span>{
<a name="l01967"></a>01967     btVector3   com(0,0,0);
<a name="l01968"></a>01968     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#adf09c94d97fb44f3b88c3b1832776766">m_bframe</a>)
<a name="l01969"></a>01969     {
<a name="l01970"></a>01970         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01971"></a>01971         {
<a name="l01972"></a>01972             com+=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x*<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ad734471e031d5105259ebab2f9de71c9">m_wgh</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01973"></a>01973         }
<a name="l01974"></a>01974     }
<a name="l01975"></a>01975     <span class="keywordflow">return</span>(com);
<a name="l01976"></a>01976 }
<a name="l01977"></a>01977 
<a name="l01978"></a>01978 <span class="comment">//</span>
<a name="l01979"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ab508b3126d26fc1ebadd5688c97ba0a2">01979</a> <span class="keywordtype">bool</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#ab508b3126d26fc1ebadd5688c97ba0a2">btSoftBody::checkContact</a>(   btCollisionObject* colObj,
<a name="l01980"></a>01980                                              <span class="keyword">const</span> btVector3&amp; x,
<a name="l01981"></a>01981                                              <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> margin,
<a name="l01982"></a>01982                                              <a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html">btSoftBody::sCti</a>&amp; cti)<span class="keyword"> const</span>
<a name="l01983"></a>01983 <span class="keyword"></span>{
<a name="l01984"></a>01984     btVector3 nrm;
<a name="l01985"></a>01985     <a class="code" href="../../d7/dd7/classbtCollisionShape.html" title="The btCollisionShape class provides an interface for collision shapes that can be shared among btColl...">btCollisionShape</a> *shp = colObj-&gt;getCollisionShape();
<a name="l01986"></a>01986     <a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a> *tmpRigid = <a class="code" href="../../da/d60/classbtSoftBody.html#ac6209b1843fd2511b477547c648adb67">btRigidBody::upcast</a>(colObj);
<a name="l01987"></a>01987     <span class="keyword">const</span> <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a> &amp;wtr = tmpRigid ? tmpRigid-&gt;getWorldTransform() : colObj-&gt;getWorldTransform();
<a name="l01988"></a>01988     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dst = 
<a name="l01989"></a>01989         <a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>-&gt;<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html#aa8b999bc3c2548d043c07115fd45cceb">m_sparsesdf</a>.<a class="code" href="../../d9/d97/structbtSparseSdf.html#ad0480201affbe9a0a44151163ffb6ca6">Evaluate</a>(  
<a name="l01990"></a>01990             wtr.<a class="code" href="../../d4/d79/classbtTransform.html#ab1d6c326aa76f78dfb5d9585814249f0">invXform</a>(x),
<a name="l01991"></a>01991             shp,
<a name="l01992"></a>01992             nrm,
<a name="l01993"></a>01993             margin);
<a name="l01994"></a>01994     <span class="keywordflow">if</span>(dst&lt;0)
<a name="l01995"></a>01995     {
<a name="l01996"></a>01996         cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#a8882fe7fed81551ea73cda3bc2713982">m_colObj</a> = colObj;
<a name="l01997"></a>01997         cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a> = wtr.<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>()*nrm;
<a name="l01998"></a>01998         cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ac3028faa276435d90944dd2b72b533b8">m_offset</a> = -<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>( cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a>, x - cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a> * dst );
<a name="l01999"></a>01999         <span class="keywordflow">return</span>(<span class="keyword">true</span>);
<a name="l02000"></a>02000     }
<a name="l02001"></a>02001     <span class="keywordflow">return</span>(<span class="keyword">false</span>);
<a name="l02002"></a>02002 }
<a name="l02003"></a>02003 
<a name="l02004"></a>02004 <span class="comment">//</span>
<a name="l02005"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ab362c5aca67e90032065945ce15cff31">02005</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#ab362c5aca67e90032065945ce15cff31">btSoftBody::updateNormals</a>()
<a name="l02006"></a>02006 {
<a name="l02007"></a>02007 
<a name="l02008"></a>02008     <span class="keyword">const</span> btVector3 zv(0,0,0);
<a name="l02009"></a>02009     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l02010"></a>02010 
<a name="l02011"></a>02011     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02012"></a>02012     {
<a name="l02013"></a>02013         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n=zv;
<a name="l02014"></a>02014     }
<a name="l02015"></a>02015     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02016"></a>02016     {
<a name="l02017"></a>02017         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">btSoftBody::Face</a>&amp;   f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02018"></a>02018         <span class="keyword">const</span> btVector3     n=<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l02019"></a>02019             f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>);
<a name="l02020"></a>02020         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#a715422a3e0a99f7dce614aec5c2baa58">m_normal</a>=n.normalized();
<a name="l02021"></a>02021         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>+=n;
<a name="l02022"></a>02022         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>+=n;
<a name="l02023"></a>02023         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>+=n;
<a name="l02024"></a>02024     }
<a name="l02025"></a>02025     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02026"></a>02026     {
<a name="l02027"></a>02027         <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n.length();
<a name="l02028"></a>02028         <span class="keywordflow">if</span> (len&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>)
<a name="l02029"></a>02029             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n /= <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l02030"></a>02030     }
<a name="l02031"></a>02031 }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033 <span class="comment">//</span>
<a name="l02034"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aee48603cdeeb5cee57f6a210b135294b">02034</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#aee48603cdeeb5cee57f6a210b135294b">btSoftBody::updateBounds</a>()
<a name="l02035"></a>02035 {
<a name="l02036"></a>02036     <span class="comment">/*if( m_acceleratedSoftBody )</span>
<a name="l02037"></a>02037 <span class="comment">    {</span>
<a name="l02038"></a>02038 <span class="comment">        // If we have an accelerated softbody we need to obtain the bounds correctly</span>
<a name="l02039"></a>02039 <span class="comment">        // For now (slightly hackily) just have a very large AABB</span>
<a name="l02040"></a>02040 <span class="comment">        // TODO: Write get bounds kernel</span>
<a name="l02041"></a>02041 <span class="comment">        // If that is updating in place, atomic collisions might be low (when the cloth isn&#39;t perfectly aligned to an axis) and we could</span>
<a name="l02042"></a>02042 <span class="comment">        // probably do a test and exchange reasonably efficiently.</span>
<a name="l02043"></a>02043 <span class="comment"></span>
<a name="l02044"></a>02044 <span class="comment">        m_bounds[0] = btVector3(-1000, -1000, -1000);</span>
<a name="l02045"></a>02045 <span class="comment">        m_bounds[1] = btVector3(1000, 1000, 1000);</span>
<a name="l02046"></a>02046 <span class="comment"></span>
<a name="l02047"></a>02047 <span class="comment">    } else {*/</span>
<a name="l02048"></a>02048         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>)
<a name="l02049"></a>02049         {
<a name="l02050"></a>02050             <span class="keyword">const</span> btVector3&amp;    mins=<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>-&gt;<a class="code" href="../../dd/d7b/structbtDbvtNode.html#a62820bd0549bb1bffaf62850b13ace44">volume</a>.<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a38dff65559e91f07ef9d5eb4b329a8f9">Mins</a>();
<a name="l02051"></a>02051             <span class="keyword">const</span> btVector3&amp;    maxs=<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>-&gt;<a class="code" href="../../dd/d7b/structbtDbvtNode.html#a62820bd0549bb1bffaf62850b13ace44">volume</a>.<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a4d15a5323acdaad28afecdf1b6daaa10">Maxs</a>();
<a name="l02052"></a>02052             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      csm=getCollisionShape()-&gt;getMargin();
<a name="l02053"></a>02053             <span class="keyword">const</span> btVector3     mrg=btVector3(  csm,
<a name="l02054"></a>02054                 csm,
<a name="l02055"></a>02055                 csm)*1; <span class="comment">// ??? to investigate...</span>
<a name="l02056"></a>02056             <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[0]=mins-mrg;
<a name="l02057"></a>02057             <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[1]=maxs+mrg;
<a name="l02058"></a>02058             <span class="keywordflow">if</span>(0!=getBroadphaseHandle())
<a name="l02059"></a>02059             {                   
<a name="l02060"></a>02060                 <a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>-&gt;<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html#afd9ac8c00b3df5f3134ea448d237209e">m_broadphase</a>-&gt;<a class="code" href="../../df/dfe/classbtBroadphaseInterface.html#a5dafdb7e104b1634202d1b21668a5aa7">setAabb</a>( getBroadphaseHandle(),
<a name="l02061"></a>02061                     <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[0],
<a name="l02062"></a>02062                     <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[1],
<a name="l02063"></a>02063                     <a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>-&gt;<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html#a4cdb28e69f0f3e14335d8519d7e4be49">m_dispatcher</a>);
<a name="l02064"></a>02064             }
<a name="l02065"></a>02065         }
<a name="l02066"></a>02066         <span class="keywordflow">else</span>
<a name="l02067"></a>02067         {
<a name="l02068"></a>02068             <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[0]=
<a name="l02069"></a>02069                 <a class="code" href="../../da/d60/classbtSoftBody.html#a8e821d5ed921ec7fe4919d39123d1022">m_bounds</a>[1]=btVector3(0,0,0);
<a name="l02070"></a>02070         }       
<a name="l02071"></a>02071     <span class="comment">//}</span>
<a name="l02072"></a>02072 }
<a name="l02073"></a>02073 
<a name="l02074"></a>02074 
<a name="l02075"></a>02075 <span class="comment">//</span>
<a name="l02076"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ac13d11fd5d294ce8924751b99d431c1c">02076</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#ac13d11fd5d294ce8924751b99d431c1c">btSoftBody::updatePose</a>()
<a name="l02077"></a>02077 {
<a name="l02078"></a>02078     <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#adf09c94d97fb44f3b88c3b1832776766">m_bframe</a>)
<a name="l02079"></a>02079     {
<a name="l02080"></a>02080         <a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html">btSoftBody::Pose</a>&amp;   pose=<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>;
<a name="l02081"></a>02081         <span class="keyword">const</span> btVector3     com=<a class="code" href="../../da/d60/classbtSoftBody.html#a3705e365dc96446bc489c392dcf2ac0c">evaluateCom</a>();
<a name="l02082"></a>02082         <span class="comment">/* Com          */</span> 
<a name="l02083"></a>02083         pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a5083f27c5671f4ff377a6ee4d601ec6e">m_com</a>  =   com;
<a name="l02084"></a>02084         <span class="comment">/* Rotation     */</span> 
<a name="l02085"></a>02085         <a class="code" href="../../d1/d7d/classbtMatrix3x3.html" title="The btMatrix3x3 class implements a 3x3 rotation matrix, to perform linear algebra in combination with...">btMatrix3x3</a>     Apq;
<a name="l02086"></a>02086         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  eps=<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>;
<a name="l02087"></a>02087         Apq[0]=Apq[1]=Apq[2]=btVector3(0,0,0);
<a name="l02088"></a>02088         Apq[0].setX(eps);Apq[1].setY(eps*2);Apq[2].setZ(eps*3);
<a name="l02089"></a>02089         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02090"></a>02090         {
<a name="l02091"></a>02091             <span class="keyword">const</span> btVector3     a=pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ad734471e031d5105259ebab2f9de71c9">m_wgh</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x-com);
<a name="l02092"></a>02092             <span class="keyword">const</span> btVector3&amp;    b=pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aa6cae81e27e3a4c8990423f2fa6bf182">m_pos</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02093"></a>02093             Apq[0]+=a.x()*b;
<a name="l02094"></a>02094             Apq[1]+=a.y()*b;
<a name="l02095"></a>02095             Apq[2]+=a.z()*b;
<a name="l02096"></a>02096         }
<a name="l02097"></a>02097         <a class="code" href="../../d1/d7d/classbtMatrix3x3.html" title="The btMatrix3x3 class implements a 3x3 rotation matrix, to perform linear algebra in combination with...">btMatrix3x3</a>     r,s;
<a name="l02098"></a>02098         <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a51fa0565b7b0352f73538e61b2a9d078">PolarDecompose</a>(Apq,r,s);
<a name="l02099"></a>02099         pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#ac84ae4951c58adeee86b8e6113f2e2d2">m_rot</a>=r;
<a name="l02100"></a>02100         pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a15a4fa7fa548a96678aae8dc8e259d34">m_scl</a>=pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#aade9009495e18ebbaebfdf029fc0fca0">m_aqq</a>*r.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#aa7fe855a2910c515482576ee08b2f455" title="Return the transpose of the matrix.">transpose</a>()*Apq;
<a name="l02101"></a>02101         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a07d5c0b7c84c8e384eb4039b60496657">maxvolume</a>&gt;1)
<a name="l02102"></a>02102         {
<a name="l02103"></a>02103             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  idet=Clamp&lt;btScalar&gt;(   1/pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a15a4fa7fa548a96678aae8dc8e259d34">m_scl</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a773ad4a95e390d67b9f35f373c4d1289" title="Return the determinant of the matrix.">determinant</a>(),
<a name="l02104"></a>02104                 1,<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a07d5c0b7c84c8e384eb4039b60496657">maxvolume</a>);
<a name="l02105"></a>02105             pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a15a4fa7fa548a96678aae8dc8e259d34">m_scl</a>=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a1a96d4d368689d4a2e41e7b177167f4b">Mul</a>(pose.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a15a4fa7fa548a96678aae8dc8e259d34">m_scl</a>,idet);
<a name="l02106"></a>02106         }
<a name="l02107"></a>02107 
<a name="l02108"></a>02108     }
<a name="l02109"></a>02109 }
<a name="l02110"></a>02110 
<a name="l02111"></a>02111 <span class="comment">//</span>
<a name="l02112"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad73c943fe892bd5e3242e65de5df3db1">02112</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#ad73c943fe892bd5e3242e65de5df3db1">btSoftBody::updateConstants</a>()
<a name="l02113"></a>02113 {
<a name="l02114"></a>02114     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l02115"></a>02115 
<a name="l02116"></a>02116     <span class="comment">/* Links        */</span> 
<a name="l02117"></a>02117     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02118"></a>02118     {
<a name="l02119"></a>02119         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;       l=<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02120"></a>02120         <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">Material</a>&amp;   m=*l.<a class="code" href="../../de/d54/structbtSoftBody_1_1Feature.html#ae24af9323abfd07bc80ad26634c1b360">m_material</a>;
<a name="l02121"></a>02121         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ae817453c9089ab7e0ddfa32b300b0d8a">m_rl</a>  =   (l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>).<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>();
<a name="l02122"></a>02122         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a42498700f2ae06261fcf41f5f1733369">m_c0</a>  =   (l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>+l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>)/m.<a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html#adf4cb9a81ab3ce7fdb7297fb482fd9a8">m_kLST</a>;
<a name="l02123"></a>02123         l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#abb46e72d3788091ec006b866ee2b4692">m_c1</a>  =   l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ae817453c9089ab7e0ddfa32b300b0d8a">m_rl</a>*l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ae817453c9089ab7e0ddfa32b300b0d8a">m_rl</a>;
<a name="l02124"></a>02124     }
<a name="l02125"></a>02125     <span class="comment">/* Faces        */</span> 
<a name="l02126"></a>02126     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02127"></a>02127     {
<a name="l02128"></a>02128         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;       f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02129"></a>02129         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#a644dbb11481a1f0a54a6b1b47e29cf0a">m_ra</a>  =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a4abf663bbb87e98cbf9a90d299ae248b">AreaOf</a>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>);
<a name="l02130"></a>02130     }
<a name="l02131"></a>02131     <span class="comment">/* Area&#39;s       */</span> 
<a name="l02132"></a>02132     <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;int&gt;</a>   counts;
<a name="l02133"></a>02133     counts.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>(),0);
<a name="l02134"></a>02134     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02135"></a>02135     {
<a name="l02136"></a>02136         <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_area   =   0;
<a name="l02137"></a>02137     }
<a name="l02138"></a>02138     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02139"></a>02139     {
<a name="l02140"></a>02140         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">btSoftBody::Face</a>&amp;   f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02141"></a>02141         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j)
<a name="l02142"></a>02142         {
<a name="l02143"></a>02143             <span class="keyword">const</span> <span class="keywordtype">int</span> index=(int)(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]);
<a name="l02144"></a>02144             counts[index]++;
<a name="l02145"></a>02145             f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a27a52573c1e481488830bcf9f543f16c">m_area</a>+=<a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#a644dbb11481a1f0a54a6b1b47e29cf0a">m_ra</a>);
<a name="l02146"></a>02146         }
<a name="l02147"></a>02147     }
<a name="l02148"></a>02148     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02149"></a>02149     {
<a name="l02150"></a>02150         <span class="keywordflow">if</span>(counts[i]&gt;0)
<a name="l02151"></a>02151             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_area/=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)counts[i];
<a name="l02152"></a>02152         <span class="keywordflow">else</span>
<a name="l02153"></a>02153             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_area=0;
<a name="l02154"></a>02154     }
<a name="l02155"></a>02155 }
<a name="l02156"></a>02156 
<a name="l02157"></a>02157 <span class="comment">//</span>
<a name="l02158"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ac6bcd9853756ab196ea18c831a04a8b7">02158</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#ac6bcd9853756ab196ea18c831a04a8b7">btSoftBody::initializeClusters</a>()
<a name="l02159"></a>02159 {
<a name="l02160"></a>02160     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02161"></a>02161 
<a name="l02162"></a>02162     <span class="keywordflow">for</span>( i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02163"></a>02163     {
<a name="l02164"></a>02164         <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>&amp;    c=*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02165"></a>02165         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>=0;
<a name="l02166"></a>02166         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l02167"></a>02167         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++j)
<a name="l02168"></a>02168         {
<a name="l02169"></a>02169             <span class="keywordflow">if</span> (c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&gt;m_im==0)
<a name="l02170"></a>02170             {
<a name="l02171"></a>02171                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ac40f1e6c289a6c81cfbede28884cd53a">m_containsAnchor</a> = <span class="keyword">true</span>;
<a name="l02172"></a>02172                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[j]   =   <a class="code" href="../../d0/d6b/btScalar_8h.html#a3a24ecdd029d38fef175bee5d965710a">BT_LARGE_FLOAT</a>;
<a name="l02173"></a>02173             } <span class="keywordflow">else</span>
<a name="l02174"></a>02174             {
<a name="l02175"></a>02175                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[j]   =   <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>(1.)/c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&gt;m_im;
<a name="l02176"></a>02176             }
<a name="l02177"></a>02177             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>       +=  c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[j];
<a name="l02178"></a>02178         }
<a name="l02179"></a>02179         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>       =   <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>(1.)/c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>;
<a name="l02180"></a>02180         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>         =   <a class="code" href="../../da/d60/classbtSoftBody.html#a8a4ea1cf74b8b8e08733d3f0fb466ded">btSoftBody::clusterCom</a>(&amp;c);
<a name="l02181"></a>02181         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>          =   btVector3(0,0,0);
<a name="l02182"></a>02182         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>          =   btVector3(0,0,0);
<a name="l02183"></a>02183         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a7f01866a3ee1cd8c68f1ddae5f6d12fb">m_leaf</a>        =   0;
<a name="l02184"></a>02184         <span class="comment">/* Inertia  */</span> 
<a name="l02185"></a>02185         <a class="code" href="../../d1/d7d/classbtMatrix3x3.html" title="The btMatrix3x3 class implements a 3x3 rotation matrix, to perform linear algebra in combination with...">btMatrix3x3</a>&amp;    ii=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d0f7ef744ac87b5e6a9d98b2a583aa4">m_locii</a>;
<a name="l02186"></a>02186         ii[0]=ii[1]=ii[2]=btVector3(0,0,0);
<a name="l02187"></a>02187         {
<a name="l02188"></a>02188             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l02189"></a>02189 
<a name="l02190"></a>02190             <span class="keywordflow">for</span>(i=0,ni=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02191"></a>02191             {
<a name="l02192"></a>02192                 <span class="keyword">const</span> btVector3 k=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_x-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>;
<a name="l02193"></a>02193                 <span class="keyword">const</span> btVector3 q=k*k;
<a name="l02194"></a>02194                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  m=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02195"></a>02195                 ii[0][0]    +=  m*(q[1]+q[2]);
<a name="l02196"></a>02196                 ii[1][1]    +=  m*(q[0]+q[2]);
<a name="l02197"></a>02197                 ii[2][2]    +=  m*(q[0]+q[1]);
<a name="l02198"></a>02198                 ii[0][1]    -=  m*k[0]*k[1];
<a name="l02199"></a>02199                 ii[0][2]    -=  m*k[0]*k[2];
<a name="l02200"></a>02200                 ii[1][2]    -=  m*k[1]*k[2];
<a name="l02201"></a>02201             }
<a name="l02202"></a>02202         }
<a name="l02203"></a>02203         ii[1][0]=ii[0][1];
<a name="l02204"></a>02204         ii[2][0]=ii[0][2];
<a name="l02205"></a>02205         ii[2][1]=ii[1][2];
<a name="l02206"></a>02206         
<a name="l02207"></a>02207         ii = ii.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a051aba0fed800ed3453f04a5b8e7f465" title="Return the inverse of the matrix.">inverse</a>();
<a name="l02208"></a>02208 
<a name="l02209"></a>02209         <span class="comment">/* Frame    */</span> 
<a name="l02210"></a>02210         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#ac95a4f502585b3c896001eb236293ce5" title="Set this transformation to the identity.">setIdentity</a>();
<a name="l02211"></a>02211         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#a10d173bd239e576c57d0ad5568303c03" title="Set the translational element.">setOrigin</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>);
<a name="l02212"></a>02212         c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a3893f7524acfdea8831df7708ad39611">m_framerefs</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>());
<a name="l02213"></a>02213         {
<a name="l02214"></a>02214             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02215"></a>02215             <span class="keywordflow">for</span>(i=0;i&lt;c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a3893f7524acfdea8831df7708ad39611">m_framerefs</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02216"></a>02216             {
<a name="l02217"></a>02217                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a3893f7524acfdea8831df7708ad39611">m_framerefs</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_x-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>;
<a name="l02218"></a>02218             }
<a name="l02219"></a>02219         }
<a name="l02220"></a>02220     }
<a name="l02221"></a>02221 }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223 <span class="comment">//</span>
<a name="l02224"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a0fbc8cbbe127ff3d1ed9467e709a8181">02224</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#a0fbc8cbbe127ff3d1ed9467e709a8181">btSoftBody::updateClusters</a>()
<a name="l02225"></a>02225 {
<a name="l02226"></a>02226     <a class="code" href="../../d3/d0e/btQuickprof_8h.html#a313914a100622c10c4c094bbab420a37">BT_PROFILE</a>(<span class="stringliteral">&quot;UpdateClusters&quot;</span>);
<a name="l02227"></a>02227     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02228"></a>02228 
<a name="l02229"></a>02229     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02230"></a>02230     {
<a name="l02231"></a>02231         <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">btSoftBody::Cluster</a>&amp;    c=*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02232"></a>02232         <span class="keyword">const</span> <span class="keywordtype">int</span>               n=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l02233"></a>02233         <span class="comment">//const btScalar            invn=1/(btScalar)n;</span>
<a name="l02234"></a>02234         <span class="keywordflow">if</span>(n)
<a name="l02235"></a>02235         {
<a name="l02236"></a>02236             <span class="comment">/* Frame                */</span> 
<a name="l02237"></a>02237             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  eps=<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>(0.0001);
<a name="l02238"></a>02238             <a class="code" href="../../d1/d7d/classbtMatrix3x3.html" title="The btMatrix3x3 class implements a 3x3 rotation matrix, to perform linear algebra in combination with...">btMatrix3x3</a>     m,r,s;
<a name="l02239"></a>02239             m[0]=m[1]=m[2]=btVector3(0,0,0);
<a name="l02240"></a>02240             m[0][0]=eps*1;
<a name="l02241"></a>02241             m[1][1]=eps*2;
<a name="l02242"></a>02242             m[2][2]=eps*3;
<a name="l02243"></a>02243             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>=<a class="code" href="../../da/d60/classbtSoftBody.html#a8a4ea1cf74b8b8e08733d3f0fb466ded">clusterCom</a>(&amp;c);
<a name="l02244"></a>02244             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02245"></a>02245             {
<a name="l02246"></a>02246                 <span class="keyword">const</span> btVector3     a=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_x-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>;
<a name="l02247"></a>02247                 <span class="keyword">const</span> btVector3&amp;    b=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a3893f7524acfdea8831df7708ad39611">m_framerefs</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02248"></a>02248                 m[0]+=a[0]*b;m[1]+=a[1]*b;m[2]+=a[2]*b;
<a name="l02249"></a>02249             }
<a name="l02250"></a>02250             <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a51fa0565b7b0352f73538e61b2a9d078">PolarDecompose</a>(m,r,s);
<a name="l02251"></a>02251             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#a10d173bd239e576c57d0ad5568303c03" title="Set the translational element.">setOrigin</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>);
<a name="l02252"></a>02252             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#acf90a00b9996c47cb4b4a74aadb28c09" title="Set the rotational element by btMatrix3x3.">setBasis</a>(r);     
<a name="l02253"></a>02253             <span class="comment">/* Inertia          */</span> 
<a name="l02254"></a>02254 <span class="preprocessor">#if 1</span><span class="comment">/* Constant    */</span> 
<a name="l02255"></a>02255             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>()*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d0f7ef744ac87b5e6a9d98b2a583aa4">m_locii</a>*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>.<a class="code" href="../../d4/d79/classbtTransform.html#a7fc96ecb7fe7794b6bcd56136bc51053" title="Return the basis matrix for the rotation.">getBasis</a>().<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#aa7fe855a2910c515482576ee08b2f455" title="Return the transpose of the matrix.">transpose</a>();
<a name="l02256"></a>02256 <span class="preprocessor">#else</span>
<a name="l02257"></a>02257 <span class="preprocessor"></span><span class="preprocessor">#if 0</span><span class="comment">/* Sphere  */</span> 
<a name="l02258"></a>02258             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  rk=(2*c.m_extents.length2())/(5*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>);
<a name="l02259"></a>02259             <span class="keyword">const</span> btVector3 inertia(rk,rk,rk);
<a name="l02260"></a>02260             <span class="keyword">const</span> btVector3 iin(<a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(inertia[0])&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>?1/inertia[0]:0,
<a name="l02261"></a>02261                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(inertia[1])&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>?1/inertia[1]:0,
<a name="l02262"></a>02262                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(inertia[2])&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>?1/inertia[2]:0);
<a name="l02263"></a>02263 
<a name="l02264"></a>02264             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>=c.m_xform.getBasis().scaled(iin)*c.m_xform.getBasis().transpose();
<a name="l02265"></a>02265 <span class="preprocessor">#else</span><span class="comment">/* Actual  */</span>      
<a name="l02266"></a>02266             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[0]=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[1]=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[2]=btVector3(0,0,0);
<a name="l02267"></a>02267             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;n;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02268"></a>02268             {
<a name="l02269"></a>02269                 <span class="keyword">const</span> btVector3 k=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_x-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>;
<a name="l02270"></a>02270                 <span class="keyword">const</span> btVector3     q=k*k;
<a name="l02271"></a>02271                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      m=1/c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_im;
<a name="l02272"></a>02272                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[0][0] +=  m*(q[1]+q[2]);
<a name="l02273"></a>02273                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[1][1] +=  m*(q[0]+q[2]);
<a name="l02274"></a>02274                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[2][2] +=  m*(q[0]+q[1]);
<a name="l02275"></a>02275                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[0][1] -=  m*k[0]*k[1];
<a name="l02276"></a>02276                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[0][2] -=  m*k[0]*k[2];
<a name="l02277"></a>02277                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[1][2] -=  m*k[1]*k[2];
<a name="l02278"></a>02278             }
<a name="l02279"></a>02279             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[1][0]=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[0][1];
<a name="l02280"></a>02280             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[2][0]=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[0][2];
<a name="l02281"></a>02281             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[2][1]=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>[1][2];
<a name="l02282"></a>02282             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>.<a class="code" href="../../d1/d7d/classbtMatrix3x3.html#a051aba0fed800ed3453f04a5b8e7f465" title="Return the inverse of the matrix.">inverse</a>();
<a name="l02283"></a>02283 <span class="preprocessor">#endif</span>
<a name="l02284"></a>02284 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02285"></a>02285 <span class="preprocessor"></span>            <span class="comment">/* Velocities           */</span> 
<a name="l02286"></a>02286             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>=btVector3(0,0,0);
<a name="l02287"></a>02287             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>=btVector3(0,0,0);
<a name="l02288"></a>02288             {
<a name="l02289"></a>02289                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02290"></a>02290 
<a name="l02291"></a>02291                 <span class="keywordflow">for</span>(i=0;i&lt;n;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02292"></a>02292                 {
<a name="l02293"></a>02293                     <span class="keyword">const</span> btVector3 v=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_v*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02294"></a>02294                     c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>  +=  v;
<a name="l02295"></a>02295                     c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>  +=  <a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[i]-&gt;m_x-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>,v);
<a name="l02296"></a>02296                 }
<a name="l02297"></a>02297             }
<a name="l02298"></a>02298             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#aa6ae5e2414ffb4f3a60e2d9c62990ebe">m_imass</a>*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>*(1-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a496233af537fdcb98c64f853b2d2ca2a">m_ldamping</a>);
<a name="l02299"></a>02299             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a45ebe0fba8ad921de4d3f6bff9e42858">m_invwi</a>*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>*(1-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ac0c0e542d10b631bd457db435d5bb8ba">m_adamping</a>);
<a name="l02300"></a>02300             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[0]    =
<a name="l02301"></a>02301                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[1]    = btVector3(0,0,0);
<a name="l02302"></a>02302             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[0]    =
<a name="l02303"></a>02303                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[1]    = btVector3(0,0,0);
<a name="l02304"></a>02304             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a157244b73178b5b8a725e1e0e0c5bb1b">m_nvimpulses</a>      = 0;
<a name="l02305"></a>02305             c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>      = 0;
<a name="l02306"></a>02306             <span class="comment">/* Matching             */</span> 
<a name="l02307"></a>02307             <span class="keywordflow">if</span>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a660db0fd423e1f3abf72d5074ba23b64">m_matching</a>&gt;0)
<a name="l02308"></a>02308             {
<a name="l02309"></a>02309                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++j)
<a name="l02310"></a>02310                 {
<a name="l02311"></a>02311                     <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           n=*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j];
<a name="l02312"></a>02312                     <span class="keyword">const</span> btVector3 x=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#addf1cd863cb3f8c8df8bf03796dbba61">m_framexform</a>*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a3893f7524acfdea8831df7708ad39611">m_framerefs</a>[j];
<a name="l02313"></a>02313                     n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a04dc38323f564676af8c756fb04b0ba3">Lerp</a>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,x,c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a660db0fd423e1f3abf72d5074ba23b64">m_matching</a>);
<a name="l02314"></a>02314                 }
<a name="l02315"></a>02315             }           
<a name="l02316"></a>02316             <span class="comment">/* Dbvt                 */</span> 
<a name="l02317"></a>02317             <span class="keywordflow">if</span>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ab64d0063b57ece06113a4d96dfcdbd2c">m_collide</a>)
<a name="l02318"></a>02318             {
<a name="l02319"></a>02319                 btVector3   mi=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[0]-&gt;m_x;
<a name="l02320"></a>02320                 btVector3   mx=mi;
<a name="l02321"></a>02321                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;n;++j)
<a name="l02322"></a>02322                 {
<a name="l02323"></a>02323                     mi.setMin(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&gt;m_x);
<a name="l02324"></a>02324                     mx.setMax(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&gt;m_x);
<a name="l02325"></a>02325                 }           
<a name="l02326"></a>02326                 <a class="code" href="../../d0/d6b/btScalar_8h.html#a38c30fdd0ea2558373a1b6e41c77d9d2">ATTRIBUTE_ALIGNED16</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html">btDbvtVolume</a>)   <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>=<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a421d031c65294920c84fbde27ab3ceca">btDbvtVolume::FromMM</a>(mi,mx);
<a name="l02327"></a>02327                 <span class="keywordflow">if</span>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a7f01866a3ee1cd8c68f1ddae5f6d12fb">m_leaf</a>)
<a name="l02328"></a>02328                     <a class="code" href="../../da/d60/classbtSoftBody.html#a108b2be76b7647b2138d99e99b3bbdb0">m_cdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a6efe1f6bb9abd80ea76d1bfa97cebd2b">update</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a7f01866a3ee1cd8c68f1ddae5f6d12fb">m_leaf</a>,<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>,c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>*3,<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#a2cfb8275eeb89b28d79bd63111b3896d">radmrg</a>);
<a name="l02329"></a>02329                 <span class="keywordflow">else</span>
<a name="l02330"></a>02330                     c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a7f01866a3ee1cd8c68f1ddae5f6d12fb">m_leaf</a>=<a class="code" href="../../da/d60/classbtSoftBody.html#a108b2be76b7647b2138d99e99b3bbdb0">m_cdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#a0efd4485566228688870dc7340365d03">insert</a>(<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>,&amp;c);
<a name="l02331"></a>02331             }
<a name="l02332"></a>02332         }
<a name="l02333"></a>02333     }
<a name="l02334"></a>02334 
<a name="l02335"></a>02335 
<a name="l02336"></a>02336 }
<a name="l02337"></a>02337 
<a name="l02338"></a>02338 
<a name="l02339"></a>02339 
<a name="l02340"></a>02340 
<a name="l02341"></a>02341 <span class="comment">//</span>
<a name="l02342"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a6b9b7057950305e0046f173fe27698da">02342</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#a6b9b7057950305e0046f173fe27698da">btSoftBody::cleanupClusters</a>()
<a name="l02343"></a>02343 {
<a name="l02344"></a>02344     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02345"></a>02345     {
<a name="l02346"></a>02346         <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Terminate(<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>);
<a name="l02347"></a>02347         <span class="keywordflow">if</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_delete)
<a name="l02348"></a>02348         {
<a name="l02349"></a>02349             <a class="code" href="../../df/d39/btAlignedAllocator_8h.html#a053f25687d0cd7a29571c8669cf9bcd4">btAlignedFree</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l02350"></a>02350             <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6782242f06df5bab0cffbd23195cd9cd">remove</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[i--]);
<a name="l02351"></a>02351         }   
<a name="l02352"></a>02352     }
<a name="l02353"></a>02353 }
<a name="l02354"></a>02354 
<a name="l02355"></a>02355 <span class="comment">//</span>
<a name="l02356"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a4ee4c96c4821c31be91a3edeab2365fd">02356</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#a4ee4c96c4821c31be91a3edeab2365fd">btSoftBody::prepareClusters</a>(<span class="keywordtype">int</span> iterations)
<a name="l02357"></a>02357 {
<a name="l02358"></a>02358     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02359"></a>02359     {
<a name="l02360"></a>02360         <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Prepare(<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>,iterations);
<a name="l02361"></a>02361     }
<a name="l02362"></a>02362 }
<a name="l02363"></a>02363 
<a name="l02364"></a>02364 
<a name="l02365"></a>02365 <span class="comment">//</span>
<a name="l02366"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aa577be31d76bdc85298424d88790e6d5">02366</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#aa4129fb3eb8bc03f50ce8b25b28b3842">btSoftBody::solveClusters</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> sor)
<a name="l02367"></a>02367 {
<a name="l02368"></a>02368     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02369"></a>02369     {
<a name="l02370"></a>02370         <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Solve(<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>,sor);
<a name="l02371"></a>02371     }
<a name="l02372"></a>02372 }
<a name="l02373"></a>02373 
<a name="l02374"></a>02374 <span class="comment">//</span>
<a name="l02375"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a47c6e2066250a6c2564abadf3fc72029">02375</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#a47c6e2066250a6c2564abadf3fc72029">btSoftBody::applyClusters</a>(<span class="keywordtype">bool</span> drift)
<a name="l02376"></a>02376 {
<a name="l02377"></a>02377     <a class="code" href="../../d3/d0e/btQuickprof_8h.html#a313914a100622c10c4c094bbab420a37">BT_PROFILE</a>(<span class="stringliteral">&quot;ApplyClusters&quot;</span>);
<a name="l02378"></a>02378 <span class="comment">//  const btScalar                  f0=m_sst.sdt;</span>
<a name="l02379"></a>02379     <span class="comment">//const btScalar                    f1=f0/2;</span>
<a name="l02380"></a>02380     <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;btVector3&gt;</a> deltas;
<a name="l02381"></a>02381     <a class="code" href="../../dc/df2/classbtAlignedObjectArray.html">btAlignedObjectArray&lt;btScalar&gt;</a> weights;
<a name="l02382"></a>02382     deltas.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>(),btVector3(0,0,0));
<a name="l02383"></a>02383     weights.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6a48cd9cb91d0cfa50ee1c70ef485190">resize</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>(),0);
<a name="l02384"></a>02384     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02385"></a>02385 
<a name="l02386"></a>02386     <span class="keywordflow">if</span>(drift)
<a name="l02387"></a>02387     {
<a name="l02388"></a>02388         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02389"></a>02389         {
<a name="l02390"></a>02390             <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>&amp;    c=*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02391"></a>02391             <span class="keywordflow">if</span>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>)
<a name="l02392"></a>02392             {
<a name="l02393"></a>02393                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[0]/=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>;
<a name="l02394"></a>02394                 c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[1]/=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>;
<a name="l02395"></a>02395             }
<a name="l02396"></a>02396         }
<a name="l02397"></a>02397     }
<a name="l02398"></a>02398     
<a name="l02399"></a>02399     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02400"></a>02400     {
<a name="l02401"></a>02401         <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>&amp;    c=*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];   
<a name="l02402"></a>02402         <span class="keywordflow">if</span>(0&lt;(drift?c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#acdd246930948f91d4b28fa9ea716e516">m_ndimpulses</a>:c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a157244b73178b5b8a725e1e0e0c5bb1b">m_nvimpulses</a>))
<a name="l02403"></a>02403         {
<a name="l02404"></a>02404             <span class="keyword">const</span> btVector3     v=(drift?c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[0]:c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[0])*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l02405"></a>02405             <span class="keyword">const</span> btVector3     w=(drift?c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a03333f456ba390b56bfe71f93522a072">m_dimpulses</a>[1]:c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a95d2677d3e4e92604826f48cfe3f67b3">m_vimpulses</a>[1])*<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l02406"></a>02406             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++j)
<a name="l02407"></a>02407             {
<a name="l02408"></a>02408                 <span class="keyword">const</span> <span class="keywordtype">int</span>           idx=int(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[0]);
<a name="l02409"></a>02409                 <span class="keyword">const</span> btVector3&amp;    x=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&gt;m_x;
<a name="l02410"></a>02410                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      q=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#ad06448becadded3ea08cab6e75568df8">m_masses</a>[j];
<a name="l02411"></a>02411                 deltas[idx]     +=  (v+<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(w,x-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>))*q;
<a name="l02412"></a>02412                 weights[idx]    +=  q;
<a name="l02413"></a>02413             }
<a name="l02414"></a>02414         }
<a name="l02415"></a>02415     }
<a name="l02416"></a>02416     <span class="keywordflow">for</span>(i=0;i&lt;deltas.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02417"></a>02417     {
<a name="l02418"></a>02418         <span class="keywordflow">if</span>(weights[i]&gt;0) 
<a name="l02419"></a>02419         {
<a name="l02420"></a>02420             <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x+=deltas[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]/weights[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02421"></a>02421         }
<a name="l02422"></a>02422     }
<a name="l02423"></a>02423 }
<a name="l02424"></a>02424 
<a name="l02425"></a>02425 <span class="comment">//</span>
<a name="l02426"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a83d01c7ffe27a02f42bcb9d191c4a327">02426</a> <span class="keywordtype">void</span>                    <a class="code" href="../../da/d60/classbtSoftBody.html#a83d01c7ffe27a02f42bcb9d191c4a327">btSoftBody::dampClusters</a>()
<a name="l02427"></a>02427 {
<a name="l02428"></a>02428     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02429"></a>02429 
<a name="l02430"></a>02430     <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02431"></a>02431     {
<a name="l02432"></a>02432         <a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html">Cluster</a>&amp;    c=*<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];   
<a name="l02433"></a>02433         <span class="keywordflow">if</span>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a6ea4166fcd7e69685daaee90786ba49a">m_ndamping</a>&gt;0)
<a name="l02434"></a>02434         {
<a name="l02435"></a>02435             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();++j)
<a name="l02436"></a>02436             {
<a name="l02437"></a>02437                 <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           n=*c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j];
<a name="l02438"></a>02438                 <span class="keywordflow">if</span>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l02439"></a>02439                 {
<a name="l02440"></a>02440                     <span class="keyword">const</span> btVector3 vx=c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a8dc77d63fab4031d0b75221a77931ce3">m_lv</a>+<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#afc06e6e04e4eb9f28cd70b4012af4641">m_av</a>,c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a5d67503d77a08f0bf7b974f08cd01f01">m_nodes</a>[j]-&gt;m_q-c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a605fbcd7af2056321b5be4a3ac04c3e8">m_com</a>);
<a name="l02441"></a>02441                     <span class="keywordflow">if</span>(vx.length2()&lt;=n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>.length2())
<a name="l02442"></a>02442                         {
<a name="l02443"></a>02443                         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>   +=  c.<a class="code" href="../../d3/d69/structbtSoftBody_1_1Cluster.html#a6ea4166fcd7e69685daaee90786ba49a">m_ndamping</a>*(vx-n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>);
<a name="l02444"></a>02444                         }
<a name="l02445"></a>02445                 }
<a name="l02446"></a>02446             }
<a name="l02447"></a>02447         }
<a name="l02448"></a>02448     }
<a name="l02449"></a>02449 }
<a name="l02450"></a>02450 
<a name="l02451"></a>02451 <span class="comment">//</span>
<a name="l02452"></a><a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#acde4b979f83417395c2b534d450077c5">02452</a> <span class="keywordtype">void</span>                <a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#acde4b979f83417395c2b534d450077c5">btSoftBody::Joint::Prepare</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<span class="keywordtype">int</span>)
<a name="l02453"></a>02453 {
<a name="l02454"></a>02454     m_bodies[0].activate();
<a name="l02455"></a>02455     m_bodies[1].activate();
<a name="l02456"></a>02456 }
<a name="l02457"></a>02457 
<a name="l02458"></a>02458 <span class="comment">//</span>
<a name="l02459"></a><a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html#aafb676d1a943fbce147eb4d8cf4c6a67">02459</a> <span class="keywordtype">void</span>                <a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html#aafb676d1a943fbce147eb4d8cf4c6a67">btSoftBody::LJoint::Prepare</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<span class="keywordtype">int</span> iterations)
<a name="l02460"></a>02460 {
<a name="l02461"></a>02461     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>   maxdrift=4;
<a name="l02462"></a>02462     <a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#acde4b979f83417395c2b534d450077c5">Joint::Prepare</a>(dt,iterations);
<a name="l02463"></a>02463     m_rpos[0]       =   m_bodies[0].xform()*m_refs[0];
<a name="l02464"></a>02464     m_rpos[1]       =   m_bodies[1].xform()*m_refs[1];
<a name="l02465"></a>02465     m_drift         =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#adb0d145d791b9cc1320770a6a0bc7a2d">Clamp</a>(m_rpos[0]-m_rpos[1],maxdrift)*m_erp/dt;
<a name="l02466"></a>02466     m_rpos[0]       -=  m_bodies[0].xform().getOrigin();
<a name="l02467"></a>02467     m_rpos[1]       -=  m_bodies[1].xform().getOrigin();
<a name="l02468"></a>02468     m_massmatrix    =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#ac4c9d178ef110aa87a201b1fa3ea0ed3">ImpulseMatrix</a>(  m_bodies[0].invMass(),m_bodies[0].invWorldInertia(),m_rpos[0],
<a name="l02469"></a>02469         m_bodies[1].invMass(),m_bodies[1].invWorldInertia(),m_rpos[1]);
<a name="l02470"></a>02470     <span class="keywordflow">if</span>(m_split&gt;0)
<a name="l02471"></a>02471     {
<a name="l02472"></a>02472         m_sdrift    =   m_massmatrix*(m_drift*m_split);
<a name="l02473"></a>02473         m_drift     *=  1-m_split;
<a name="l02474"></a>02474     }
<a name="l02475"></a>02475     m_drift /=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)iterations;
<a name="l02476"></a>02476 }
<a name="l02477"></a>02477 
<a name="l02478"></a>02478 <span class="comment">//</span>
<a name="l02479"></a><a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html#a641a7b24103aa03e5e3fb8eac339a592">02479</a> <span class="keywordtype">void</span>                <a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html#a641a7b24103aa03e5e3fb8eac339a592">btSoftBody::LJoint::Solve</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> sor)
<a name="l02480"></a>02480 {
<a name="l02481"></a>02481     <span class="keyword">const</span> btVector3     va=m_bodies[0].velocity(m_rpos[0]);
<a name="l02482"></a>02482     <span class="keyword">const</span> btVector3     vb=m_bodies[1].velocity(m_rpos[1]);
<a name="l02483"></a>02483     <span class="keyword">const</span> btVector3     vr=va-vb;
<a name="l02484"></a>02484     <a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html">btSoftBody::Impulse</a> impulse;
<a name="l02485"></a>02485     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#ae607701d136e2334189803d44f3a2211">m_asVelocity</a>    =   1;
<a name="l02486"></a>02486     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>      =   m_massmatrix*(m_drift+vr*m_cfm)*sor;
<a name="l02487"></a>02487     m_bodies[0].applyImpulse(-impulse,m_rpos[0]);
<a name="l02488"></a>02488     m_bodies[1].applyImpulse( impulse,m_rpos[1]);
<a name="l02489"></a>02489 }
<a name="l02490"></a>02490 
<a name="l02491"></a>02491 <span class="comment">//</span>
<a name="l02492"></a><a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html#adbcf5b43c02ca4455e1731474aa823dc">02492</a> <span class="keywordtype">void</span>                <a class="code" href="../../db/ddd/structbtSoftBody_1_1LJoint.html#adbcf5b43c02ca4455e1731474aa823dc">btSoftBody::LJoint::Terminate</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt)
<a name="l02493"></a>02493 {
<a name="l02494"></a>02494     <span class="keywordflow">if</span>(m_split&gt;0)
<a name="l02495"></a>02495     {
<a name="l02496"></a>02496         m_bodies[0].applyDImpulse(-m_sdrift,m_rpos[0]);
<a name="l02497"></a>02497         m_bodies[1].applyDImpulse( m_sdrift,m_rpos[1]);
<a name="l02498"></a>02498     }
<a name="l02499"></a>02499 }
<a name="l02500"></a>02500 
<a name="l02501"></a>02501 <span class="comment">//</span>
<a name="l02502"></a><a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#a43fe2375c81f89ba8a0090f4561bed43">02502</a> <span class="keywordtype">void</span>                <a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#a43fe2375c81f89ba8a0090f4561bed43">btSoftBody::AJoint::Prepare</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<span class="keywordtype">int</span> iterations)
<a name="l02503"></a>02503 {
<a name="l02504"></a>02504     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>   maxdrift=<a class="code" href="../../d0/d6b/btScalar_8h.html#a1bdff187c878167505bcedbbbabf7b0a">SIMD_PI</a>/16;
<a name="l02505"></a>02505     m_icontrol-&gt;Prepare(<span class="keyword">this</span>);
<a name="l02506"></a>02506     <a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#acde4b979f83417395c2b534d450077c5">Joint::Prepare</a>(dt,iterations);
<a name="l02507"></a>02507     m_axis[0]   =   m_bodies[0].xform().getBasis()*m_refs[0];
<a name="l02508"></a>02508     m_axis[1]   =   m_bodies[1].xform().getBasis()*m_refs[1];
<a name="l02509"></a>02509     m_drift     =   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a4f811fc2716c06dea21884cf17ae131c">NormalizeAny</a>(<a class="code" href="../../d2/dd0/btVector3_8h.html#ad50f4077e814fac34e7d7d5d461278de" title="Return the cross product of two vectors.">btCross</a>(m_axis[1],m_axis[0]));
<a name="l02510"></a>02510     m_drift     *=  <a class="code" href="../../da/d05/btMinMax_8h.html#a083aab7ffec01586f450c9f2696f7fe5">btMin</a>(maxdrift,<a class="code" href="../../d0/d6b/btScalar_8h.html#a004c41de4028b1437d1aafbaa0769cd5">btAcos</a>(Clamp&lt;btScalar&gt;(<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(m_axis[0],m_axis[1]),-1,+1)));
<a name="l02511"></a>02511     m_drift     *=  m_erp/dt;
<a name="l02512"></a>02512     m_massmatrix=   <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a40d7d4645011340331773b501d6c540d">AngularImpulseMatrix</a>(m_bodies[0].invWorldInertia(),m_bodies[1].invWorldInertia());
<a name="l02513"></a>02513     <span class="keywordflow">if</span>(m_split&gt;0)
<a name="l02514"></a>02514     {
<a name="l02515"></a>02515         m_sdrift    =   m_massmatrix*(m_drift*m_split);
<a name="l02516"></a>02516         m_drift     *=  1-m_split;
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518     m_drift /=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)iterations;
<a name="l02519"></a>02519 }
<a name="l02520"></a>02520 
<a name="l02521"></a>02521 <span class="comment">//</span>
<a name="l02522"></a><a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#a9c0981fa66ca3998f6a9ed3c221b496b">02522</a> <span class="keywordtype">void</span>                <a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#a9c0981fa66ca3998f6a9ed3c221b496b">btSoftBody::AJoint::Solve</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> sor)
<a name="l02523"></a>02523 {
<a name="l02524"></a>02524     <span class="keyword">const</span> btVector3     va=m_bodies[0].angularVelocity();
<a name="l02525"></a>02525     <span class="keyword">const</span> btVector3     vb=m_bodies[1].angularVelocity();
<a name="l02526"></a>02526     <span class="keyword">const</span> btVector3     vr=va-vb;
<a name="l02527"></a>02527     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      sp=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(vr,m_axis[0]);
<a name="l02528"></a>02528     <span class="keyword">const</span> btVector3     vc=vr-m_axis[0]*m_icontrol-&gt;Speed(<span class="keyword">this</span>,sp);
<a name="l02529"></a>02529     <a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html">btSoftBody::Impulse</a> impulse;
<a name="l02530"></a>02530     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#ae607701d136e2334189803d44f3a2211">m_asVelocity</a>    =   1;
<a name="l02531"></a>02531     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>      =   m_massmatrix*(m_drift+vc*m_cfm)*sor;
<a name="l02532"></a>02532     m_bodies[0].applyAImpulse(-impulse);
<a name="l02533"></a>02533     m_bodies[1].applyAImpulse( impulse);
<a name="l02534"></a>02534 }
<a name="l02535"></a>02535 
<a name="l02536"></a>02536 <span class="comment">//</span>
<a name="l02537"></a><a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#adc2443dc9477a4c90c1597c3dc86e04a">02537</a> <span class="keywordtype">void</span>                <a class="code" href="../../d7/de4/structbtSoftBody_1_1AJoint.html#adc2443dc9477a4c90c1597c3dc86e04a">btSoftBody::AJoint::Terminate</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt)
<a name="l02538"></a>02538 {
<a name="l02539"></a>02539     <span class="keywordflow">if</span>(m_split&gt;0)
<a name="l02540"></a>02540     {
<a name="l02541"></a>02541         m_bodies[0].applyDAImpulse(-m_sdrift);
<a name="l02542"></a>02542         m_bodies[1].applyDAImpulse( m_sdrift);
<a name="l02543"></a>02543     }
<a name="l02544"></a>02544 }
<a name="l02545"></a>02545 
<a name="l02546"></a>02546 <span class="comment">//</span>
<a name="l02547"></a><a class="code" href="../../d3/d39/structbtSoftBody_1_1CJoint.html#a632281fa2e040825aea5c0f871a89587">02547</a> <span class="keywordtype">void</span>                <a class="code" href="../../d3/d39/structbtSoftBody_1_1CJoint.html#a632281fa2e040825aea5c0f871a89587">btSoftBody::CJoint::Prepare</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<span class="keywordtype">int</span> iterations)
<a name="l02548"></a>02548 {
<a name="l02549"></a>02549     <a class="code" href="../../d4/df6/structbtSoftBody_1_1Joint.html#acde4b979f83417395c2b534d450077c5">Joint::Prepare</a>(dt,iterations);
<a name="l02550"></a>02550     <span class="keyword">const</span> <span class="keywordtype">bool</span>  dodrift=(m_life==0);
<a name="l02551"></a>02551     m_delete=(++m_life)&gt;m_maxlife;
<a name="l02552"></a>02552     <span class="keywordflow">if</span>(dodrift)
<a name="l02553"></a>02553     {
<a name="l02554"></a>02554         m_drift=m_drift*m_erp/dt;
<a name="l02555"></a>02555         <span class="keywordflow">if</span>(m_split&gt;0)
<a name="l02556"></a>02556         {
<a name="l02557"></a>02557             m_sdrift    =   m_massmatrix*(m_drift*m_split);
<a name="l02558"></a>02558             m_drift     *=  1-m_split;
<a name="l02559"></a>02559         }
<a name="l02560"></a>02560         m_drift/=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)iterations;
<a name="l02561"></a>02561     }
<a name="l02562"></a>02562     <span class="keywordflow">else</span>
<a name="l02563"></a>02563     {
<a name="l02564"></a>02564         m_drift=m_sdrift=btVector3(0,0,0);
<a name="l02565"></a>02565     }
<a name="l02566"></a>02566 }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568 <span class="comment">//</span>
<a name="l02569"></a><a class="code" href="../../d3/d39/structbtSoftBody_1_1CJoint.html#aea04c88d0da5c5dbecc545a06af7b97a">02569</a> <span class="keywordtype">void</span>                <a class="code" href="../../d3/d39/structbtSoftBody_1_1CJoint.html#aea04c88d0da5c5dbecc545a06af7b97a">btSoftBody::CJoint::Solve</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> sor)
<a name="l02570"></a>02570 {
<a name="l02571"></a>02571     <span class="keyword">const</span> btVector3     va=m_bodies[0].velocity(m_rpos[0]);
<a name="l02572"></a>02572     <span class="keyword">const</span> btVector3     vb=m_bodies[1].velocity(m_rpos[1]);
<a name="l02573"></a>02573     <span class="keyword">const</span> btVector3     vrel=va-vb;
<a name="l02574"></a>02574     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      rvac=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(vrel,m_normal);
<a name="l02575"></a>02575     <a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html">btSoftBody::Impulse</a> impulse;
<a name="l02576"></a>02576     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#ae607701d136e2334189803d44f3a2211">m_asVelocity</a>    =   1;
<a name="l02577"></a>02577     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>      =   m_drift;
<a name="l02578"></a>02578     <span class="keywordflow">if</span>(rvac&lt;0)
<a name="l02579"></a>02579     {
<a name="l02580"></a>02580         <span class="keyword">const</span> btVector3 iv=m_normal*rvac;
<a name="l02581"></a>02581         <span class="keyword">const</span> btVector3 fv=vrel-iv;
<a name="l02582"></a>02582         impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>  +=  iv+fv*m_friction;
<a name="l02583"></a>02583     }
<a name="l02584"></a>02584     impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>=m_massmatrix*impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>*sor;
<a name="l02585"></a>02585     
<a name="l02586"></a>02586     <span class="keywordflow">if</span> (m_bodies[0].m_soft==m_bodies[1].m_soft)
<a name="l02587"></a>02587     {
<a name="l02588"></a>02588         <span class="keywordflow">if</span> ((impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.getX() ==impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.getX())&amp;&amp;(impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.getY() ==impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.getY())&amp;&amp;
<a name="l02589"></a>02589             (impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.getZ() ==impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.getZ()))
<a name="l02590"></a>02590         {
<a name="l02591"></a>02591             <span class="keywordflow">if</span> (impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#ae607701d136e2334189803d44f3a2211">m_asVelocity</a>)
<a name="l02592"></a>02592             {
<a name="l02593"></a>02593                 <span class="keywordflow">if</span> (impulse.<a class="code" href="../../dc/d99/structbtSoftBody_1_1Impulse.html#a8456d87d37e70f0734f6f374d2793899">m_velocity</a>.length() &lt;m_bodies[0].m_soft-&gt;m_maxSelfCollisionImpulse)
<a name="l02594"></a>02594                 {
<a name="l02595"></a>02595                     
<a name="l02596"></a>02596                 } <span class="keywordflow">else</span>
<a name="l02597"></a>02597                 {
<a name="l02598"></a>02598                     m_bodies[0].applyImpulse(-impulse*m_bodies[0].m_soft-&gt;m_selfCollisionImpulseFactor,m_rpos[0]);
<a name="l02599"></a>02599                     m_bodies[1].applyImpulse( impulse*m_bodies[0].m_soft-&gt;m_selfCollisionImpulseFactor,m_rpos[1]);
<a name="l02600"></a>02600                 }
<a name="l02601"></a>02601             }
<a name="l02602"></a>02602         }
<a name="l02603"></a>02603     } <span class="keywordflow">else</span>
<a name="l02604"></a>02604     {
<a name="l02605"></a>02605         m_bodies[0].applyImpulse(-impulse,m_rpos[0]);
<a name="l02606"></a>02606         m_bodies[1].applyImpulse( impulse,m_rpos[1]);
<a name="l02607"></a>02607     }
<a name="l02608"></a>02608 }
<a name="l02609"></a>02609 
<a name="l02610"></a>02610 <span class="comment">//</span>
<a name="l02611"></a><a class="code" href="../../d3/d39/structbtSoftBody_1_1CJoint.html#a12ae7ef7a49dc7c32c104bcb170d54d5">02611</a> <span class="keywordtype">void</span>                <a class="code" href="../../d3/d39/structbtSoftBody_1_1CJoint.html#a12ae7ef7a49dc7c32c104bcb170d54d5">btSoftBody::CJoint::Terminate</a>(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dt)
<a name="l02612"></a>02612 {
<a name="l02613"></a>02613     <span class="keywordflow">if</span>(m_split&gt;0)
<a name="l02614"></a>02614     {
<a name="l02615"></a>02615         m_bodies[0].applyDImpulse(-m_sdrift,m_rpos[0]);
<a name="l02616"></a>02616         m_bodies[1].applyDImpulse( m_sdrift,m_rpos[1]);
<a name="l02617"></a>02617     }
<a name="l02618"></a>02618 }
<a name="l02619"></a>02619 
<a name="l02620"></a>02620 <span class="comment">//</span>
<a name="l02621"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ab60ff6213c14fe1f6c7a354503dadc80">02621</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#ab60ff6213c14fe1f6c7a354503dadc80">btSoftBody::applyForces</a>()
<a name="l02622"></a>02622 {
<a name="l02623"></a>02623 
<a name="l02624"></a>02624     <a class="code" href="../../d3/d0e/btQuickprof_8h.html#a313914a100622c10c4c094bbab420a37">BT_PROFILE</a>(<span class="stringliteral">&quot;SoftBody applyForces&quot;</span>);
<a name="l02625"></a>02625     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                  dt =            <a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l02626"></a>02626     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                  kLF =           <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aaf819d51d8c1774bd5629965fbd53be6">kLF</a>;
<a name="l02627"></a>02627     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                  kDG =           <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a00138980dda3355a50e2f5d79107d772">kDG</a>;
<a name="l02628"></a>02628     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                  kPR =           <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a659a04711566fac7268d50c1c7384035">kPR</a>;
<a name="l02629"></a>02629     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                  kVC =           <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a6057779d5267a9e600bb4055d1f7f2c2">kVC</a>;
<a name="l02630"></a>02630     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_lift =       kLF&gt;0;
<a name="l02631"></a>02631     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_drag =       kDG&gt;0;
<a name="l02632"></a>02632     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_pressure =   kPR!=0;
<a name="l02633"></a>02633     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_volume =     kVC&gt;0;
<a name="l02634"></a>02634     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_aero =       as_lift ||
<a name="l02635"></a>02635                                                     as_drag     ;
<a name="l02636"></a>02636     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_vaero =      as_aero &amp;&amp;
<a name="l02637"></a>02637                                                     (<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a91b7375ace054ae67744aa417579dfa3">aeromodel</a> &lt; <a class="code" href="../../d0/df3/structbtSoftBody_1_1eAeroModel.html#a147f4e50f7cfaa2855b5ea5b4b2986aeaae33c1f5ebe9b125c044a4198b6ca3b4" title="Vertex normals are taken as it is.">btSoftBody::eAeroModel::F_TwoSided</a>);
<a name="l02638"></a>02638     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      as_faero =      as_aero &amp;&amp;
<a name="l02639"></a>02639                                                     (<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a91b7375ace054ae67744aa417579dfa3">aeromodel</a> &gt;= <a class="code" href="../../d0/df3/structbtSoftBody_1_1eAeroModel.html#a147f4e50f7cfaa2855b5ea5b4b2986aeaae33c1f5ebe9b125c044a4198b6ca3b4" title="Vertex normals are taken as it is.">btSoftBody::eAeroModel::F_TwoSided</a>);
<a name="l02640"></a>02640     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      use_medium =    as_aero;
<a name="l02641"></a>02641     <span class="keyword">const</span> <span class="keywordtype">bool</span>                      use_volume =    as_pressure ||
<a name="l02642"></a>02642         as_volume   ;
<a name="l02643"></a>02643     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                        volume =        0;
<a name="l02644"></a>02644     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                        ivolumetp =     0;
<a name="l02645"></a>02645     <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>                        dvolumetv =     0;
<a name="l02646"></a>02646     <a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html">btSoftBody::sMedium</a> medium;
<a name="l02647"></a>02647     <span class="keywordflow">if</span>(use_volume)
<a name="l02648"></a>02648     {
<a name="l02649"></a>02649         volume      =   <a class="code" href="../../da/d60/classbtSoftBody.html#acfa376b0906401dc0f33d6ac9b7e0164">getVolume</a>();
<a name="l02650"></a>02650         ivolumetp   =   1/<a class="code" href="../../d0/d6b/btScalar_8h.html#a4c4bd8e065ab617f4e37273d76e6d581">btFabs</a>(volume)*kPR;
<a name="l02651"></a>02651         dvolumetv   =   (<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>.<a class="code" href="../../de/d2d/structbtSoftBody_1_1Pose.html#a4806127851c12e3df29b1097aa3723c9">m_volume</a>-volume)*kVC;
<a name="l02652"></a>02652     }
<a name="l02653"></a>02653     <span class="comment">/* Per vertex forces            */</span> 
<a name="l02654"></a>02654     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,ni;
<a name="l02655"></a>02655 
<a name="l02656"></a>02656     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02657"></a>02657     {
<a name="l02658"></a>02658         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">btSoftBody::Node</a>&amp;   n=<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02659"></a>02659         <span class="keywordflow">if</span>(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>&gt;0)
<a name="l02660"></a>02660         {
<a name="l02661"></a>02661             <span class="keywordflow">if</span>(use_medium)
<a name="l02662"></a>02662             {
<a name="l02663"></a>02663                 <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a6b588b82a4b78c6b0e1d81f5325b4349">EvaluateMedium</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>, n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>, medium);
<a name="l02664"></a>02664                 medium.<a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html#affbc228a8ce2083a0737bf638a0532bb">m_velocity</a> = <a class="code" href="../../da/d60/classbtSoftBody.html#ad02496af28d6bf408a736ee3e5f05c32">m_windVelocity</a>;
<a name="l02665"></a>02665                 medium.<a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html#a733bce7e2535dc75c72e31f2ed865647">m_density</a> = <a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>-&gt;<a class="code" href="../../d8/dc6/structbtSoftBodyWorldInfo.html#a2a8dbb3c18aee460ad9651de8fd99954">air_density</a>;
<a name="l02666"></a>02666 
<a name="l02667"></a>02667                 <span class="comment">/* Aerodynamics         */</span> 
<a name="l02668"></a>02668                 <span class="keywordflow">if</span>(as_vaero)
<a name="l02669"></a>02669                 {               
<a name="l02670"></a>02670                     <span class="keyword">const</span> btVector3 rel_v = n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a> - medium.<a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html#affbc228a8ce2083a0737bf638a0532bb">m_velocity</a>;
<a name="l02671"></a>02671                     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  rel_v2 = rel_v.length2();
<a name="l02672"></a>02672                     <span class="keywordflow">if</span>(rel_v2&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>)
<a name="l02673"></a>02673                     {
<a name="l02674"></a>02674                         btVector3   nrm = n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>;
<a name="l02675"></a>02675                         <span class="comment">/* Setup normal     */</span> 
<a name="l02676"></a>02676                         <span class="keywordflow">switch</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a91b7375ace054ae67744aa417579dfa3">aeromodel</a>)
<a name="l02677"></a>02677                         {
<a name="l02678"></a>02678                         <span class="keywordflow">case</span>    <a class="code" href="../../d0/df3/structbtSoftBody_1_1eAeroModel.html#a147f4e50f7cfaa2855b5ea5b4b2986aeadcfaa831ddbd8fd6b2b2320a68561e59">btSoftBody::eAeroModel::V_Point</a>:
<a name="l02679"></a>02679                             nrm = <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a4f811fc2716c06dea21884cf17ae131c">NormalizeAny</a>(rel_v);
<a name="l02680"></a>02680                             <span class="keywordflow">break</span>;
<a name="l02681"></a>02681                         <span class="keywordflow">case</span>    <a class="code" href="../../d0/df3/structbtSoftBody_1_1eAeroModel.html#a147f4e50f7cfaa2855b5ea5b4b2986aea112eb2723581b443eb31003e75769ced" title="Vertex normals are oriented toward velocity.">btSoftBody::eAeroModel::V_TwoSided</a>:
<a name="l02682"></a>02682                             nrm *= (<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)( (<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(nrm,rel_v) &lt; 0) ? -1 : +1);
<a name="l02683"></a>02683                             <span class="keywordflow">break</span>;                          
<a name="l02684"></a>02684                         <span class="keywordflow">default</span>:
<a name="l02685"></a>02685                             {
<a name="l02686"></a>02686                             }
<a name="l02687"></a>02687                         }
<a name="l02688"></a>02688                         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> dvn = <a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(rel_v,nrm);
<a name="l02689"></a>02689                         <span class="comment">/* Compute forces   */</span> 
<a name="l02690"></a>02690                         <span class="keywordflow">if</span>(dvn&gt;0)
<a name="l02691"></a>02691                         {
<a name="l02692"></a>02692                             btVector3       force(0,0,0);
<a name="l02693"></a>02693                             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  c0  =   n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a27a52573c1e481488830bcf9f543f16c">m_area</a> * dvn * rel_v2/2;
<a name="l02694"></a>02694                             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  c1  =   c0 * medium.<a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html#a733bce7e2535dc75c72e31f2ed865647">m_density</a>;
<a name="l02695"></a>02695                             force   +=  nrm*(-c1*kLF);
<a name="l02696"></a>02696                             force   +=  rel_v.normalized() * (-c1 * kDG);
<a name="l02697"></a>02697                             <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#aca86a9163958b61ccc363f0b4ced6f03">ApplyClampedForce</a>(n, force, dt);
<a name="l02698"></a>02698                         }
<a name="l02699"></a>02699                     }
<a name="l02700"></a>02700                 }
<a name="l02701"></a>02701             }
<a name="l02702"></a>02702             <span class="comment">/* Pressure             */</span> 
<a name="l02703"></a>02703             <span class="keywordflow">if</span>(as_pressure)
<a name="l02704"></a>02704             {
<a name="l02705"></a>02705                 n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#aebe1f784e80e576a11338c21a5717069">m_f</a>   +=  n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>*(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a27a52573c1e481488830bcf9f543f16c">m_area</a>*ivolumetp);
<a name="l02706"></a>02706             }
<a name="l02707"></a>02707             <span class="comment">/* Volume               */</span> 
<a name="l02708"></a>02708             <span class="keywordflow">if</span>(as_volume)
<a name="l02709"></a>02709             {
<a name="l02710"></a>02710                 n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#aebe1f784e80e576a11338c21a5717069">m_f</a>   +=  n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#add7c76a258ec17f3856a7b81680b9067">m_n</a>*(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a27a52573c1e481488830bcf9f543f16c">m_area</a>*dvolumetv);
<a name="l02711"></a>02711             }
<a name="l02712"></a>02712         }
<a name="l02713"></a>02713     }
<a name="l02714"></a>02714     <span class="comment">/* Per face forces              */</span> 
<a name="l02715"></a>02715     <span class="keywordflow">for</span>(i=0,ni=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();i&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02716"></a>02716     {
<a name="l02717"></a>02717         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">btSoftBody::Face</a>&amp;   f=<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02718"></a>02718         <span class="keywordflow">if</span>(as_faero)
<a name="l02719"></a>02719         {
<a name="l02720"></a>02720             <span class="keyword">const</span> btVector3 v=(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>+f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>+f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>)/3;
<a name="l02721"></a>02721             <span class="keyword">const</span> btVector3 x=(f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>+f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>+f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)/3;
<a name="l02722"></a>02722             <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a6b588b82a4b78c6b0e1d81f5325b4349">EvaluateMedium</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#a4a2ef515395ec9c49b1c550bb20dc724">m_worldInfo</a>,x,medium);
<a name="l02723"></a>02723             <span class="keyword">const</span> btVector3 rel_v=v-medium.<a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html#affbc228a8ce2083a0737bf638a0532bb">m_velocity</a>;
<a name="l02724"></a>02724             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  rel_v2=rel_v.length2();
<a name="l02725"></a>02725             <span class="keywordflow">if</span>(rel_v2&gt;<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>)
<a name="l02726"></a>02726             {
<a name="l02727"></a>02727                 btVector3   nrm=f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#a715422a3e0a99f7dce614aec5c2baa58">m_normal</a>;
<a name="l02728"></a>02728                 <span class="comment">/* Setup normal     */</span> 
<a name="l02729"></a>02729                 <span class="keywordflow">switch</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a91b7375ace054ae67744aa417579dfa3">aeromodel</a>)
<a name="l02730"></a>02730                 {
<a name="l02731"></a>02731                 <span class="keywordflow">case</span>    <a class="code" href="../../d0/df3/structbtSoftBody_1_1eAeroModel.html#a147f4e50f7cfaa2855b5ea5b4b2986aeaae33c1f5ebe9b125c044a4198b6ca3b4" title="Vertex normals are taken as it is.">btSoftBody::eAeroModel::F_TwoSided</a>:
<a name="l02732"></a>02732                     nrm*=(<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>)(<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(nrm,rel_v)&lt;0?-1:+1);<span class="keywordflow">break</span>;
<a name="l02733"></a>02733                     <span class="keywordflow">default</span>:
<a name="l02734"></a>02734                     {
<a name="l02735"></a>02735                     }
<a name="l02736"></a>02736                 }
<a name="l02737"></a>02737                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  dvn=<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(rel_v,nrm);
<a name="l02738"></a>02738                 <span class="comment">/* Compute forces   */</span> 
<a name="l02739"></a>02739                 <span class="keywordflow">if</span>(dvn&gt;0)
<a name="l02740"></a>02740                 {
<a name="l02741"></a>02741                     btVector3       force(0,0,0);
<a name="l02742"></a>02742                     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  c0  =   f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#a644dbb11481a1f0a54a6b1b47e29cf0a">m_ra</a>*dvn*rel_v2;
<a name="l02743"></a>02743                     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  c1  =   c0*medium.<a class="code" href="../../d8/d11/structbtSoftBody_1_1sMedium.html#a733bce7e2535dc75c72e31f2ed865647">m_density</a>;
<a name="l02744"></a>02744                     force   +=  nrm*(-c1*kLF);
<a name="l02745"></a>02745                     force   +=  rel_v.normalized()*(-c1*kDG);
<a name="l02746"></a>02746                     force   /=  3;
<a name="l02747"></a>02747                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;++j) <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#aca86a9163958b61ccc363f0b4ced6f03">ApplyClampedForce</a>(*f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[j],force,dt);
<a name="l02748"></a>02748                 }
<a name="l02749"></a>02749             }
<a name="l02750"></a>02750         }
<a name="l02751"></a>02751     }
<a name="l02752"></a>02752 }
<a name="l02753"></a>02753 
<a name="l02754"></a>02754 <span class="comment">//</span>
<a name="l02755"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a4958237e624f63ec359a10231a11a19a">02755</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#a4958237e624f63ec359a10231a11a19a">btSoftBody::PSolve_Anchors</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* psb,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> kst,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> ti)
<a name="l02756"></a>02756 {
<a name="l02757"></a>02757     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  kAHR=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#af4a43c3b3d4cec8f9bdfb1178d7ae5e1">kAHR</a>*kst;
<a name="l02758"></a>02758     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  dt=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l02759"></a>02759     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02760"></a>02760     {
<a name="l02761"></a>02761         <span class="keyword">const</span> <a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html">Anchor</a>&amp;       a=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02762"></a>02762         <span class="keyword">const</span> <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a>&amp;  t=a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;getWorldTransform();
<a name="l02763"></a>02763         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;               n=*a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#abc1bf9b55ed97026448d561a3fee9d8b">m_node</a>;
<a name="l02764"></a>02764         <span class="keyword">const</span> btVector3     wa=t*a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a06d5ececcb7018b282039a82f5061e4a">m_local</a>;
<a name="l02765"></a>02765         <span class="keyword">const</span> btVector3     va=a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a78f7293894bf0652a1e740ee63bf1eed">getVelocityInLocalPoint</a>(a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a0570748f1978b7ab7cd6cc30eb5f6715">m_c1</a>)*dt;
<a name="l02766"></a>02766         <span class="keyword">const</span> btVector3     vb=n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>;
<a name="l02767"></a>02767         <span class="keyword">const</span> btVector3     vr=(va-vb)+(wa-n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)*kAHR;
<a name="l02768"></a>02768         <span class="keyword">const</span> btVector3     impulse=a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#ad3928469ff917d5c03bbbbb1192026e5">m_c0</a>*vr;
<a name="l02769"></a>02769         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>+=impulse*a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a4cd6a20a7e31d879e510ffe6ff076537">m_c2</a>;
<a name="l02770"></a>02770         a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a232e889f1d84f32b4f8d54d24baa1b18">m_body</a>-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a8274f89d9e6b8fe945282797bd25f377">applyImpulse</a>(-impulse,a.<a class="code" href="../../d1/de5/structbtSoftBody_1_1Anchor.html#a0570748f1978b7ab7cd6cc30eb5f6715">m_c1</a>);
<a name="l02771"></a>02771     }
<a name="l02772"></a>02772 }
<a name="l02773"></a>02773 
<a name="l02774"></a>02774 <span class="comment">//</span>
<a name="l02775"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aaafba18f5de9bc2d62a41b15fc0421bb">02775</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d60/classbtSoftBody.html#aaafba18f5de9bc2d62a41b15fc0421bb">btSoftBody::PSolve_RContacts</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* psb, <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> kst, <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> ti)
<a name="l02776"></a>02776 {
<a name="l02777"></a>02777     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  dt = psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a329525a55d20b3a388b92b234fd15b5f">m_sst</a>.<a class="code" href="../../d3/d1a/structbtSoftBody_1_1SolverState.html#ad0ea3088c28d3c1ca19022b7208fe1d8">sdt</a>;
<a name="l02778"></a>02778     <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  mrg = psb-&gt;getCollisionShape()-&gt;getMargin();
<a name="l02779"></a>02779     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a8a6217d7ddb3dd99447c41a539e0cdc4">m_rcontacts</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02780"></a>02780     {
<a name="l02781"></a>02781         <span class="keyword">const</span> <a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html">RContact</a>&amp;     c = psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a8a6217d7ddb3dd99447c41a539e0cdc4">m_rcontacts</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02782"></a>02782         <span class="keyword">const</span> <a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html">sCti</a>&amp;         cti = c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a16d3320b0ec49e9bad6b9589c04cfe50">m_cti</a>;  
<a name="l02783"></a>02783 
<a name="l02784"></a>02784         <span class="keywordflow">if</span> (cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#a8882fe7fed81551ea73cda3bc2713982">m_colObj</a>-&gt;hasContactResponse()) {
<a name="l02785"></a>02785             <a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a>* tmpRigid = <a class="code" href="../../da/d60/classbtSoftBody.html#ac6209b1843fd2511b477547c648adb67">btRigidBody::upcast</a>(cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#a8882fe7fed81551ea73cda3bc2713982">m_colObj</a>);
<a name="l02786"></a>02786             <span class="keyword">const</span> btVector3     va = tmpRigid ? tmpRigid-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a78f7293894bf0652a1e740ee63bf1eed">getVelocityInLocalPoint</a>(c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a6eadf65f297f841a8d065d5cc071334b">m_c1</a>)*dt : btVector3(0,0,0);
<a name="l02787"></a>02787             <span class="keyword">const</span> btVector3     vb = c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a91e08172ca7278478dabda95881dffcb">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a91e08172ca7278478dabda95881dffcb">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>;   
<a name="l02788"></a>02788             <span class="keyword">const</span> btVector3     vr = vb-va;
<a name="l02789"></a>02789             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      dn = <a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(vr, cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a>);       
<a name="l02790"></a>02790             <span class="keywordflow">if</span>(dn&lt;=<a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>)
<a name="l02791"></a>02791             {
<a name="l02792"></a>02792                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      dp = <a class="code" href="../../da/d05/btMinMax_8h.html#a083aab7ffec01586f450c9f2696f7fe5">btMin</a>( (<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a91e08172ca7278478dabda95881dffcb">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>, cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a>) + cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ac3028faa276435d90944dd2b72b533b8">m_offset</a>), mrg );
<a name="l02793"></a>02793                 <span class="keyword">const</span> btVector3     fv = vr - (cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a> * dn);
<a name="l02794"></a>02794                 <span class="comment">// c0 is the impulse matrix, c3 is 1 - the friction coefficient or 0, c4 is the contact hardness coefficient</span>
<a name="l02795"></a>02795                 <span class="keyword">const</span> btVector3     impulse = c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a9ac99e80f862a19452fc2b451c979b9d">m_c0</a> * ( (vr - (fv * c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#ab22964c6cd93a7b8cf12f4f5b4d0556e">m_c3</a>) + (cti.<a class="code" href="../../dd/dac/structbtSoftBody_1_1sCti.html#ae668ef16af4314e979f47d1ab28fc5f9">m_normal</a> * (dp * c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a5da2bf761efb065f9951826f9fe796b1">m_c4</a>))) * kst );
<a name="l02796"></a>02796                 c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a91e08172ca7278478dabda95881dffcb">m_node</a>-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a> -= impulse * c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a10f62432bbbb1ed4f2003ced24a3e7a7">m_c2</a>;
<a name="l02797"></a>02797                 <span class="keywordflow">if</span> (tmpRigid)
<a name="l02798"></a>02798                     tmpRigid-&gt;<a class="code" href="../../d9/dea/classbtRigidBody.html#a8274f89d9e6b8fe945282797bd25f377">applyImpulse</a>(impulse,c.<a class="code" href="../../d5/d0c/structbtSoftBody_1_1RContact.html#a6eadf65f297f841a8d065d5cc071334b">m_c1</a>);
<a name="l02799"></a>02799             }
<a name="l02800"></a>02800         }
<a name="l02801"></a>02801     }
<a name="l02802"></a>02802 }
<a name="l02803"></a>02803 
<a name="l02804"></a>02804 <span class="comment">//</span>
<a name="l02805"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a03cec6f0910a538cbc1a54bb4aaeea42">02805</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#a03cec6f0910a538cbc1a54bb4aaeea42">btSoftBody::PSolve_SContacts</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* psb,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> ti)
<a name="l02806"></a>02806 {
<a name="l02807"></a>02807     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab86da8498926f0565f4813b32ffe9f67">m_scontacts</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02808"></a>02808     {
<a name="l02809"></a>02809         <span class="keyword">const</span> <a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html">SContact</a>&amp;     c=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab86da8498926f0565f4813b32ffe9f67">m_scontacts</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02810"></a>02810         <span class="keyword">const</span> btVector3&amp;    nr=c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#a8024b61fae8c8531d7bb083d0e5b23a4">m_normal</a>;
<a name="l02811"></a>02811         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;               n=*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#a969a9b23a1b807135afb300daa9f3901">m_node</a>;
<a name="l02812"></a>02812         <a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html">Face</a>&amp;               f=*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#af232d111cf7074bc17075ea754658c76">m_face</a>;
<a name="l02813"></a>02813         <span class="keyword">const</span> btVector3     <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a200a67bb3eba9b61da1d1f224a25db26">BaryEval</a>( f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l02814"></a>02814             f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l02815"></a>02815             f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>,
<a name="l02816"></a>02816             c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acc26bf2b8d7f3ee7528030336aefa5df">m_weights</a>);
<a name="l02817"></a>02817         <span class="keyword">const</span> btVector3     q=<a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a200a67bb3eba9b61da1d1f224a25db26">BaryEval</a>( f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>,
<a name="l02818"></a>02818             f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>,
<a name="l02819"></a>02819             f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>,
<a name="l02820"></a>02820             c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acc26bf2b8d7f3ee7528030336aefa5df">m_weights</a>);                                           
<a name="l02821"></a>02821         <span class="keyword">const</span> btVector3     vr=(n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab41394c67b5514c0114c6cb0da2d7bb8">m_q</a>)-(p-q);
<a name="l02822"></a>02822         btVector3           corr(0,0,0);
<a name="l02823"></a>02823         <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a> = <a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(vr,nr);
<a name="l02824"></a>02824         <span class="keywordflow">if</span>(dot&lt;0)
<a name="l02825"></a>02825         {
<a name="l02826"></a>02826             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  j=c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#abda6249445903b4e143ecd1d537a4303">m_margin</a>-(<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(nr,n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>)-<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(nr,p));
<a name="l02827"></a>02827             corr+=c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#a8024b61fae8c8531d7bb083d0e5b23a4">m_normal</a>*j;
<a name="l02828"></a>02828         }
<a name="l02829"></a>02829         corr            -=  <a class="code" href="../../df/d59/btSoftBodyInternals_8h.html#a98b34a60b722d96134f6dbb7e6ce6cae">ProjectOnPlane</a>(vr,nr)*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#ad094c94c16a779ee3982392400f7ac47">m_friction</a>;
<a name="l02830"></a>02830         n.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>           +=  corr*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acd2e9e6885709d44581565c49bb0872f">m_cfm</a>[0];
<a name="l02831"></a>02831         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>   -=  corr*(c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acd2e9e6885709d44581565c49bb0872f">m_cfm</a>[1]*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acc26bf2b8d7f3ee7528030336aefa5df">m_weights</a>.x());
<a name="l02832"></a>02832         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>   -=  corr*(c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acd2e9e6885709d44581565c49bb0872f">m_cfm</a>[1]*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acc26bf2b8d7f3ee7528030336aefa5df">m_weights</a>.y());
<a name="l02833"></a>02833         f.<a class="code" href="../../d1/d7b/structbtSoftBody_1_1Face.html#adac49d4261998d2c4c3611c104ae0f8c">m_n</a>[2]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>   -=  corr*(c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acd2e9e6885709d44581565c49bb0872f">m_cfm</a>[1]*c.<a class="code" href="../../df/d62/structbtSoftBody_1_1SContact.html#acc26bf2b8d7f3ee7528030336aefa5df">m_weights</a>.z());
<a name="l02834"></a>02834     }
<a name="l02835"></a>02835 }
<a name="l02836"></a>02836 
<a name="l02837"></a>02837 <span class="comment">//</span>
<a name="l02838"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a0097a8dcdbf3edf51c896348e7f6d075">02838</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#a0097a8dcdbf3edf51c896348e7f6d075">btSoftBody::PSolve_Links</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* psb,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> kst,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> ti)
<a name="l02839"></a>02839 {
<a name="l02840"></a>02840     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02841"></a>02841     {           
<a name="l02842"></a>02842         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;   l=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02843"></a>02843         <span class="keywordflow">if</span>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a42498700f2ae06261fcf41f5f1733369">m_c0</a>&gt;0)
<a name="l02844"></a>02844         {
<a name="l02845"></a>02845             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           a=*l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[0];
<a name="l02846"></a>02846             <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>&amp;           b=*l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>[1];
<a name="l02847"></a>02847             <span class="keyword">const</span> btVector3 del=b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>;
<a name="l02848"></a>02848             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>=del.length2();
<a name="l02849"></a>02849             <span class="keywordflow">if</span> (l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#abb46e72d3788091ec006b866ee2b4692">m_c1</a>+len &gt; <a class="code" href="../../d0/d6b/btScalar_8h.html#ae51eef6845bd59f964c1b2dbfe7054b7">SIMD_EPSILON</a>)
<a name="l02850"></a>02850             {
<a name="l02851"></a>02851                 <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  k=((l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#abb46e72d3788091ec006b866ee2b4692">m_c1</a>-<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>)/(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a42498700f2ae06261fcf41f5f1733369">m_c0</a>*(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#abb46e72d3788091ec006b866ee2b4692">m_c1</a>+len)))*kst;
<a name="l02852"></a>02852                 a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>-=del*(k*a.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>);
<a name="l02853"></a>02853                 b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a302f526590ac3cd265eccfd3f1cfd817">m_x</a>+=del*(k*b.<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>);
<a name="l02854"></a>02854             }
<a name="l02855"></a>02855         }
<a name="l02856"></a>02856     }
<a name="l02857"></a>02857 }
<a name="l02858"></a>02858 
<a name="l02859"></a>02859 <span class="comment">//</span>
<a name="l02860"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a5d1bc8003163e9f8a79e94fc2def5d70">02860</a> <span class="keywordtype">void</span>                <a class="code" href="../../da/d60/classbtSoftBody.html#a5d1bc8003163e9f8a79e94fc2def5d70">btSoftBody::VSolve_Links</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* psb,<a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a> kst)
<a name="l02861"></a>02861 {
<a name="l02862"></a>02862     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0,ni=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ni;++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l02863"></a>02863     {           
<a name="l02864"></a>02864         <a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html">Link</a>&amp;           l=psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02865"></a>02865         <a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html">Node</a>**          n=l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad45191444e0c41525c7be8dc72eb8f7f">m_n</a>;
<a name="l02866"></a>02866         <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>  j=-<a class="code" href="../../d2/dd0/btVector3_8h.html#a550dc4505b1f10c03a685705f41f4011" title="Return the dot product between two vectors.">btDot</a>(l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a3d49299cc32dfbe9e864b6bd183e2d7f">m_c3</a>,n[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>-n[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>)*l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#ad89b9138b78a7c5ad5f2ed99bedb96c7">m_c2</a>*kst;
<a name="l02867"></a>02867         n[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>+= l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a3d49299cc32dfbe9e864b6bd183e2d7f">m_c3</a>*(j*n[0]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>);
<a name="l02868"></a>02868         n[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#ab286626ebbca7d0ab07fb5bf04232540">m_v</a>-= l.<a class="code" href="../../da/d34/structbtSoftBody_1_1Link.html#a3d49299cc32dfbe9e864b6bd183e2d7f">m_c3</a>*(j*n[1]-&gt;<a class="code" href="../../d3/d07/structbtSoftBody_1_1Node.html#a24a6d86c8fb27545c995e3664cf47298">m_im</a>);
<a name="l02869"></a>02869     }
<a name="l02870"></a>02870 }
<a name="l02871"></a>02871 
<a name="l02872"></a>02872 <span class="comment">//</span>
<a name="l02873"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">02873</a> <a class="code" href="../../da/d60/classbtSoftBody.html#a89cc7db3d3f5a7189ad92d63e9b15ede">btSoftBody::psolver_t</a>   <a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">btSoftBody::getSolver</a>(<a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86">ePSolver::_</a> solver)
<a name="l02874"></a>02874 {
<a name="l02875"></a>02875     <span class="keywordflow">switch</span>(solver)
<a name="l02876"></a>02876     {
<a name="l02877"></a>02877     <span class="keywordflow">case</span>    <a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86ad1de203597e3f891a95c3aaf4f805e84" title="Linear solver.">ePSolver::Anchors</a>:      
<a name="l02878"></a>02878         <span class="keywordflow">return</span>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a4958237e624f63ec359a10231a11a19a">btSoftBody::PSolve_Anchors</a>);
<a name="l02879"></a>02879     <span class="keywordflow">case</span>    <a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a6148c3ff201708184174dcc1b9a242a6">ePSolver::Linear</a>:       
<a name="l02880"></a>02880         <span class="keywordflow">return</span>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a0097a8dcdbf3edf51c896348e7f6d075">btSoftBody::PSolve_Links</a>);
<a name="l02881"></a>02881     <span class="keywordflow">case</span>    <a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a18826149c80118f73e906b4966c69891" title="Anchor solver.">ePSolver::RContacts</a>:    
<a name="l02882"></a>02882         <span class="keywordflow">return</span>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#aaafba18f5de9bc2d62a41b15fc0421bb">btSoftBody::PSolve_RContacts</a>);
<a name="l02883"></a>02883     <span class="keywordflow">case</span>    <a class="code" href="../../d7/d65/structbtSoftBody_1_1ePSolver.html#a5d6ab41a09da7333bc2047b4ea14bf86a1ff50fff0983fbc2e4ae19997d7bfb4e" title="Rigid contacts solver.">ePSolver::SContacts</a>:    
<a name="l02884"></a>02884         <span class="keywordflow">return</span>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a03cec6f0910a538cbc1a54bb4aaeea42">btSoftBody::PSolve_SContacts</a>);  
<a name="l02885"></a>02885         <span class="keywordflow">default</span>:
<a name="l02886"></a>02886         {
<a name="l02887"></a>02887         }
<a name="l02888"></a>02888     }
<a name="l02889"></a>02889     <span class="keywordflow">return</span>(0);
<a name="l02890"></a>02890 }
<a name="l02891"></a>02891 
<a name="l02892"></a>02892 <span class="comment">//</span>
<a name="l02893"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ad6063e28f3c00c308baf4f1ea8b161d3">02893</a> <a class="code" href="../../da/d60/classbtSoftBody.html#ac030786831e87b8ecb9364a5e8bc2dc1">btSoftBody::vsolver_t</a>   <a class="code" href="../../da/d60/classbtSoftBody.html#ae2ab143e48d092e818a3b4180016f469">btSoftBody::getSolver</a>(<a class="code" href="../../d4/dcc/structbtSoftBody_1_1eVSolver.html#ad6a7083f91529d75cab91506cd63e088">eVSolver::_</a> solver)
<a name="l02894"></a>02894 {
<a name="l02895"></a>02895     <span class="keywordflow">switch</span>(solver)
<a name="l02896"></a>02896     {
<a name="l02897"></a>02897     <span class="keywordflow">case</span>    <a class="code" href="../../d4/dcc/structbtSoftBody_1_1eVSolver.html#ad6a7083f91529d75cab91506cd63e088a41e9bf3b93c87326bbe46ab455b855aa">eVSolver::Linear</a>:       <span class="keywordflow">return</span>(&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a5d1bc8003163e9f8a79e94fc2def5d70">btSoftBody::VSolve_Links</a>);
<a name="l02898"></a>02898         <span class="keywordflow">default</span>:
<a name="l02899"></a>02899         {
<a name="l02900"></a>02900         }
<a name="l02901"></a>02901     }
<a name="l02902"></a>02902     <span class="keywordflow">return</span>(0);
<a name="l02903"></a>02903 }
<a name="l02904"></a>02904 
<a name="l02905"></a>02905 <span class="comment">//</span>
<a name="l02906"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a5a8e43293bcb295da9ab9fcddb0571e8">02906</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a5a8e43293bcb295da9ab9fcddb0571e8">btSoftBody::defaultCollisionHandler</a>(btCollisionObject* pco)
<a name="l02907"></a>02907 {
<a name="l02908"></a>02908 
<a name="l02909"></a>02909     <span class="keywordflow">switch</span>(<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>&amp;<a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a663e0d74f72de7f2a943ba66852f1dbb">fCollision::RVSmask</a>)
<a name="l02910"></a>02910     {
<a name="l02911"></a>02911     <span class="keywordflow">case</span>    <a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a7c057a9cdfcd280d9ec3bf69e09edc62" title="Rigid versus soft mask.">fCollision::SDF_RS</a>:
<a name="l02912"></a>02912         {
<a name="l02913"></a>02913             <a class="code" href="../../de/db1/structbtSoftColliders_1_1CollideSDF__RS.html">btSoftColliders::CollideSDF_RS</a>  docollide;      
<a name="l02914"></a>02914             <a class="code" href="../../d9/dea/classbtRigidBody.html">btRigidBody</a>*        prb1=<a class="code" href="../../da/d60/classbtSoftBody.html#ac6209b1843fd2511b477547c648adb67">btRigidBody::upcast</a>(pco);
<a name="l02915"></a>02915             <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a> wtr=pco-&gt;getWorldTransform();
<a name="l02916"></a>02916 
<a name="l02917"></a>02917             <span class="keyword">const</span> <a class="code" href="../../d4/d79/classbtTransform.html" title="The btTransform class supports rigid transforms with only translation and rotation and no scaling/she...">btTransform</a>   ctr=pco-&gt;getWorldTransform();
<a name="l02918"></a>02918             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      timemargin=(wtr.<a class="code" href="../../d4/d79/classbtTransform.html#a1fbf71080d75e64ef8cb5130e2bef196" title="Return the origin vector translation.">getOrigin</a>()-ctr.<a class="code" href="../../d4/d79/classbtTransform.html#a1fbf71080d75e64ef8cb5130e2bef196" title="Return the origin vector translation.">getOrigin</a>()).<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>();
<a name="l02919"></a>02919             <span class="keyword">const</span> <a class="code" href="../../d0/d6b/btScalar_8h.html#a1e5824cfc8adbf5a77f2622132d16018" title="The btScalar type abstracts floating point numbers, to easily switch between double and single floati...">btScalar</a>      basemargin=getCollisionShape()-&gt;getMargin();
<a name="l02920"></a>02920             btVector3           mins;
<a name="l02921"></a>02921             btVector3           maxs;
<a name="l02922"></a>02922             <a class="code" href="../../d0/d6b/btScalar_8h.html#a38c30fdd0ea2558373a1b6e41c77d9d2">ATTRIBUTE_ALIGNED16</a>(<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html">btDbvtVolume</a>)       volume;
<a name="l02923"></a>02923             pco-&gt;getCollisionShape()-&gt;getAabb(  pco-&gt;getWorldTransform(),
<a name="l02924"></a>02924                 mins,
<a name="l02925"></a>02925                 maxs);
<a name="l02926"></a>02926             volume=<a class="code" href="../../d6/d66/structbtDbvtAabbMm.html#a421d031c65294920c84fbde27ab3ceca">btDbvtVolume::FromMM</a>(mins,maxs);
<a name="l02927"></a>02927             volume.Expand(btVector3(basemargin,basemargin,basemargin));     
<a name="l02928"></a>02928             docollide.<a class="code" href="../../de/db1/structbtSoftColliders_1_1CollideSDF__RS.html#a5ad3b9d51e7ec617e8dc6bc3c1a7ebf7">psb</a>       =   <span class="keyword">this</span>;
<a name="l02929"></a>02929             docollide.<a class="code" href="../../de/db1/structbtSoftColliders_1_1CollideSDF__RS.html#a74cbb25522a5b49021b501db54775682">m_colObj1</a> = pco;
<a name="l02930"></a>02930             docollide.<a class="code" href="../../de/db1/structbtSoftColliders_1_1CollideSDF__RS.html#a54908dbec17b9ca6830c5069cb01f72d">m_rigidBody</a> = prb1;
<a name="l02931"></a>02931 
<a name="l02932"></a>02932             docollide.<a class="code" href="../../de/db1/structbtSoftColliders_1_1CollideSDF__RS.html#a097b8ab40b3052df3d381a0189d7953d">dynmargin</a> =   basemargin+timemargin;
<a name="l02933"></a>02933             docollide.<a class="code" href="../../de/db1/structbtSoftColliders_1_1CollideSDF__RS.html#a68a8fc30e5cc12c06e6cab04901a013e">stamargin</a> =   basemargin;
<a name="l02934"></a>02934             <a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ae2302166fccb87b30ccbabac90dfcc6d">collideTV</a>(<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>,volume,docollide);
<a name="l02935"></a>02935         }
<a name="l02936"></a>02936         <span class="keywordflow">break</span>;
<a name="l02937"></a>02937     <span class="keywordflow">case</span>    <a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5af9bbf62b0d36af93b1198eb19d800813" title="SDF based rigid vs soft.">fCollision::CL_RS</a>:
<a name="l02938"></a>02938         {
<a name="l02939"></a>02939             <a class="code" href="../../de/de3/structbtSoftColliders_1_1CollideCL__RS.html">btSoftColliders::CollideCL_RS</a>   collider;
<a name="l02940"></a>02940             collider.<a class="code" href="../../de/de3/structbtSoftColliders_1_1CollideCL__RS.html#a020b9712f8e0c9c2dd901c93a1f97120">Process</a>(<span class="keyword">this</span>,pco);
<a name="l02941"></a>02941         }
<a name="l02942"></a>02942         <span class="keywordflow">break</span>;
<a name="l02943"></a>02943     }
<a name="l02944"></a>02944 }
<a name="l02945"></a>02945 
<a name="l02946"></a>02946 <span class="comment">//</span>
<a name="l02947"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a08d6032177bb1e5b8d89bc425c9b1d27">02947</a> <span class="keywordtype">void</span>            <a class="code" href="../../da/d60/classbtSoftBody.html#a5a8e43293bcb295da9ab9fcddb0571e8">btSoftBody::defaultCollisionHandler</a>(<a class="code" href="../../da/d60/classbtSoftBody.html">btSoftBody</a>* psb)
<a name="l02948"></a>02948 {
<a name="l02949"></a>02949     <span class="keyword">const</span> <span class="keywordtype">int</span> cf=<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>&amp;psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>;
<a name="l02950"></a>02950     <span class="keywordflow">switch</span>(cf&amp;<a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a720d2ba3f15fb6ca5c417c5971eb05b6" title="Cluster vs convex rigid vs soft.">fCollision::SVSmask</a>)
<a name="l02951"></a>02951     {
<a name="l02952"></a>02952     <span class="keywordflow">case</span>    <a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a602caf1ca49fea4d9215dbea6ad17f04" title="Vertex vs face soft vs soft handling.">fCollision::CL_SS</a>:
<a name="l02953"></a>02953         {
<a name="l02954"></a>02954             
<a name="l02955"></a>02955             <span class="comment">//support self-collision if CL_SELF flag set</span>
<a name="l02956"></a>02956             <span class="keywordflow">if</span> (<span class="keyword">this</span>!=psb || psb-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>&amp;<a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a71505ee64a4a976707c73ec67cfcd533" title="Cluster vs cluster soft vs soft handling.">fCollision::CL_SELF</a>)
<a name="l02957"></a>02957             {
<a name="l02958"></a>02958                 <a class="code" href="../../d4/db1/structbtSoftColliders_1_1CollideCL__SS.html">btSoftColliders::CollideCL_SS</a>   docollide;
<a name="l02959"></a>02959                 docollide.<a class="code" href="../../d4/db1/structbtSoftColliders_1_1CollideCL__SS.html#a1d8e929afd1afec1b606cce34c4a9a32">Process</a>(<span class="keyword">this</span>,psb);
<a name="l02960"></a>02960             }
<a name="l02961"></a>02961             
<a name="l02962"></a>02962         }
<a name="l02963"></a>02963         <span class="keywordflow">break</span>;
<a name="l02964"></a>02964     <span class="keywordflow">case</span>    <a class="code" href="../../d0/dcf/structbtSoftBody_1_1fCollision.html#afeb40bef0380b8db7e9e5628cc5f08d5a1ad696f1fa631c1256c18a3c8eb18ebc" title="Rigid versus soft mask.">fCollision::VF_SS</a>:
<a name="l02965"></a>02965         {
<a name="l02966"></a>02966             <span class="comment">//only self-collision for Cluster, not Vertex-Face yet</span>
<a name="l02967"></a>02967             <span class="keywordflow">if</span> (<span class="keyword">this</span>!=psb)
<a name="l02968"></a>02968             {
<a name="l02969"></a>02969                 <a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html">btSoftColliders::CollideVF_SS</a>   docollide;
<a name="l02970"></a>02970                 <span class="comment">/* common                   */</span> 
<a name="l02971"></a>02971                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#afddd3ce943cf462b9fa616277d9cea9d">mrg</a>=  getCollisionShape()-&gt;getMargin()+
<a name="l02972"></a>02972                     psb-&gt;getCollisionShape()-&gt;getMargin();
<a name="l02973"></a>02973                 <span class="comment">/* psb0 nodes vs psb1 faces */</span> 
<a name="l02974"></a>02974                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[0]=<span class="keyword">this</span>;
<a name="l02975"></a>02975                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[1]=psb;
<a name="l02976"></a>02976                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[0]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#aeb3be68be0d863b1534996676a2aa416">collideTT</a>(    docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[0]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>,
<a name="l02977"></a>02977                     docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[1]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>,
<a name="l02978"></a>02978                     docollide);
<a name="l02979"></a>02979                 <span class="comment">/* psb1 nodes vs psb0 faces */</span> 
<a name="l02980"></a>02980                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[0]=psb;
<a name="l02981"></a>02981                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[1]=<span class="keyword">this</span>;
<a name="l02982"></a>02982                 docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[0]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#aeb3be68be0d863b1534996676a2aa416">collideTT</a>(    docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[0]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#aff100eec6044f78bbc4f7e5ccf4619d3">m_ndbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>,
<a name="l02983"></a>02983                     docollide.<a class="code" href="../../d5/d63/structbtSoftColliders_1_1CollideVF__SS.html#a98877778cb52b9599e6ea13d1b6cdeb6">psb</a>[1]-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#ab4ca8f3ddef99e2068818d6fabbad321">m_fdbvt</a>.<a class="code" href="../../da/da2/structbtDbvt.html#ac79cacfc8471aa681ee8756ca9d5683a">m_root</a>,
<a name="l02984"></a>02984                     docollide);
<a name="l02985"></a>02985             }
<a name="l02986"></a>02986         }
<a name="l02987"></a>02987         <span class="keywordflow">break</span>;
<a name="l02988"></a>02988     <span class="keywordflow">default</span>:
<a name="l02989"></a>02989         {
<a name="l02990"></a>02990             
<a name="l02991"></a>02991         }
<a name="l02992"></a>02992     }
<a name="l02993"></a>02993 }
<a name="l02994"></a>02994 
<a name="l02995"></a>02995 
<a name="l02996"></a>02996 
<a name="l02997"></a><a class="code" href="../../da/d60/classbtSoftBody.html#aee9ac69662731fa96ae2357522972ef9">02997</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d60/classbtSoftBody.html#aee9ac69662731fa96ae2357522972ef9">btSoftBody::setWindVelocity</a>( <span class="keyword">const</span> btVector3 &amp;velocity )
<a name="l02998"></a>02998 {
<a name="l02999"></a>02999     <a class="code" href="../../da/d60/classbtSoftBody.html#ad02496af28d6bf408a736ee3e5f05c32">m_windVelocity</a> = velocity;
<a name="l03000"></a>03000 }
<a name="l03001"></a>03001 
<a name="l03002"></a>03002 
<a name="l03003"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a71de05c3c56952a4d76e09ca9ca9cce0">03003</a> <span class="keyword">const</span> btVector3&amp; <a class="code" href="../../da/d60/classbtSoftBody.html#a71de05c3c56952a4d76e09ca9ca9cce0">btSoftBody::getWindVelocity</a>()
<a name="l03004"></a>03004 {
<a name="l03005"></a>03005     <span class="keywordflow">return</span> <a class="code" href="../../da/d60/classbtSoftBody.html#ad02496af28d6bf408a736ee3e5f05c32">m_windVelocity</a>;
<a name="l03006"></a>03006 }
<a name="l03007"></a>03007 
<a name="l03008"></a>03008 
<a name="l03009"></a>03009 
<a name="l03010"></a><a class="code" href="../../da/d60/classbtSoftBody.html#a31284537a34144a1e21f8a5d84312eb9">03010</a> <span class="keywordtype">int</span> <a class="code" href="../../da/d60/classbtSoftBody.html#a31284537a34144a1e21f8a5d84312eb9">btSoftBody::calculateSerializeBufferSize</a>()<span class="keyword">  const</span>
<a name="l03011"></a>03011 <span class="keyword"></span>{
<a name="l03012"></a>03012     <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../de/d40/btSoftBody_8h.html#ab19b7d7c85c0dfe847b79e4de4607f1d" title="btSoftBody implementation by Nathanael Presson">btSoftBodyData</a>);
<a name="l03013"></a>03013     <span class="keywordflow">return</span> sz;
<a name="l03014"></a>03014 }
<a name="l03015"></a>03015 
<a name="l03017"></a><a class="code" href="../../da/d60/classbtSoftBody.html#ac24b1fbdcc3ed3d26b3dae6380303c77">03017</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../da/d60/classbtSoftBody.html#ac24b1fbdcc3ed3d26b3dae6380303c77" title="fills the dataBuffer and returns the struct name (and 0 on failure)">btSoftBody::serialize</a>(<span class="keywordtype">void</span>* dataBuffer, <span class="keyword">class</span> <a class="code" href="../../d2/d43/classbtSerializer.html">btSerializer</a>* serializer)<span class="keyword"> const</span>
<a name="l03018"></a>03018 <span class="keyword"></span>{
<a name="l03019"></a>03019     <a class="code" href="../../de/d40/btSoftBody_8h.html#ab19b7d7c85c0dfe847b79e4de4607f1d" title="btSoftBody implementation by Nathanael Presson">btSoftBodyData</a>* sbd = (<a class="code" href="../../de/d40/btSoftBody_8h.html#ab19b7d7c85c0dfe847b79e4de4607f1d" title="btSoftBody implementation by Nathanael Presson">btSoftBodyData</a>*) dataBuffer;
<a name="l03020"></a>03020 
<a name="l03021"></a>03021     <a class="code" href="../../da/d60/classbtSoftBody.html#ac24b1fbdcc3ed3d26b3dae6380303c77" title="fills the dataBuffer and returns the struct name (and 0 on failure)">btCollisionObject::serialize</a>(&amp;sbd-&gt;m_collisionObjectData, serializer);
<a name="l03022"></a>03022 
<a name="l03023"></a>03023     <a class="code" href="../../d2/d38/classbtHashMap.html">btHashMap&lt;btHashPtr,int&gt;</a>    m_nodeIndexMap;
<a name="l03024"></a>03024 
<a name="l03025"></a>03025     sbd-&gt;m_numMaterials = <a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03026"></a>03026     sbd-&gt;m_materials = sbd-&gt;m_numMaterials? (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>**) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a7f5e4eae3387e8169599a04ad8991e92">m_materials</a>): 0;
<a name="l03027"></a>03027 
<a name="l03028"></a>03028     <span class="keywordflow">if</span> (sbd-&gt;m_materials)
<a name="l03029"></a>03029     {
<a name="l03030"></a>03030         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*);
<a name="l03031"></a>03031         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numMaterials;
<a name="l03032"></a>03032         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03033"></a>03033         <span class="comment">//SoftBodyMaterialData** memPtr = chunk-&gt;m_oldPtr;</span>
<a name="l03034"></a>03034         <a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>** memPtr = (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>**)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03035"></a>03035         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03036"></a>03036         {
<a name="l03037"></a>03037             <a class="code" href="../../d2/dea/structbtSoftBody_1_1Material.html">btSoftBody::Material</a>* mat = m_materials[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l03038"></a>03038             *memPtr = mat ? (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)mat) : 0;
<a name="l03039"></a>03039             <span class="keywordflow">if</span> (!serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a6f0e64395af88f0a3f43bf0b4ed90a39">findPointer</a>(mat))
<a name="l03040"></a>03040             {
<a name="l03041"></a>03041                 <span class="comment">//serialize it here</span>
<a name="l03042"></a>03042                 <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>),1);
<a name="l03043"></a>03043                 <a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>* memPtr = (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03044"></a>03044                 memPtr-&gt;<a class="code" href="../../da/db4/structSoftBodyMaterialData.html#a89ac411b007b81cd72bb7fa42176f205">m_flags</a> = mat-&gt;m_flags;
<a name="l03045"></a>03045                 memPtr-&gt;<a class="code" href="../../da/db4/structSoftBodyMaterialData.html#adb5b47c720ed05e42e12c74eedba9d8b">m_angularStiffness</a> = mat-&gt;m_kAST;
<a name="l03046"></a>03046                 memPtr-&gt;<a class="code" href="../../da/db4/structSoftBodyMaterialData.html#a10a3ccf32511c85b9eb62ad97553312d">m_linearStiffness</a> = mat-&gt;m_kLST;
<a name="l03047"></a>03047                 memPtr-&gt;<a class="code" href="../../da/db4/structSoftBodyMaterialData.html#a564fb4279b51e7cf3aa0e7844f55f2c8">m_volumeStiffness</a> = mat-&gt;m_kVST;
<a name="l03048"></a>03048                 serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyMaterialData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#a4727a9ed27c8184394f52e648621e9b0">BT_SBMATERIAL_CODE</a>,mat);
<a name="l03049"></a>03049             }
<a name="l03050"></a>03050         }
<a name="l03051"></a>03051         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyMaterialData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_materials);
<a name="l03052"></a>03052     }
<a name="l03053"></a>03053 
<a name="l03054"></a>03054 
<a name="l03055"></a>03055     
<a name="l03056"></a>03056 
<a name="l03057"></a>03057     sbd-&gt;m_numNodes = <a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03058"></a>03058     sbd-&gt;m_nodes = sbd-&gt;m_numNodes ? (<a class="code" href="../../d9/dba/structSoftBodyNodeData.html">SoftBodyNodeData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ad53c95f39d517c1b72db24f175e92fb5">m_nodes</a>): 0;
<a name="l03059"></a>03059     <span class="keywordflow">if</span> (sbd-&gt;m_nodes)
<a name="l03060"></a>03060     {
<a name="l03061"></a>03061         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d9/dba/structSoftBodyNodeData.html">SoftBodyNodeData</a>);
<a name="l03062"></a>03062         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numNodes;
<a name="l03063"></a>03063         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03064"></a>03064         <a class="code" href="../../d9/dba/structSoftBodyNodeData.html">SoftBodyNodeData</a>* memPtr = (<a class="code" href="../../d9/dba/structSoftBodyNodeData.html">SoftBodyNodeData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03065"></a>03065         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03066"></a>03066         {
<a name="l03067"></a>03067             m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_f.serializeFloat( memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#a02f1a2aabf0390dfc804273ea11b8b5c">m_accumulatedForce</a>);
<a name="l03068"></a>03068             memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#a009ecbfaab4325952b028b88a70c6271">m_area</a> = m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_area;
<a name="l03069"></a>03069             memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#acf4ecf747225f90a77f19a9fbf10693a">m_attach</a> = m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_battach;
<a name="l03070"></a>03070             memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#a4d3926ca40971d11a4cb9f6839622682">m_inverseMass</a> = m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_im;
<a name="l03071"></a>03071             memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#af6baa1513e97f93a451536fdc795a4d9">m_material</a> = m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material? (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*) m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material):0;
<a name="l03072"></a>03072             m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n.serializeFloat(memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#a203d1d911752253ca23603a4b973caab">m_normal</a>);
<a name="l03073"></a>03073             m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_x.serializeFloat(memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#aa0c132cc1752e4b630865aba51df704c">m_position</a>);
<a name="l03074"></a>03074             m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_q.serializeFloat(memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#a4cbf9490d0df4e6d7735dff8728b785b">m_previousPosition</a>);
<a name="l03075"></a>03075             m_nodes[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_v.serializeFloat(memPtr-&gt;<a class="code" href="../../d9/dba/structSoftBodyNodeData.html#a8fb72104d280eaa306813f53df341c72">m_velocity</a>);
<a name="l03076"></a>03076             m_nodeIndexMap.<a class="code" href="../../d2/d38/classbtHashMap.html#a15fc118df433a9b7f4350d42cd33bd13">insert</a>(&amp;m_nodes[i],i);
<a name="l03077"></a>03077         }
<a name="l03078"></a>03078         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyNodeData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ae6d73c524d40f088dcfd6d1e2e31e810">BT_SBNODE_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_nodes);
<a name="l03079"></a>03079     }
<a name="l03080"></a>03080 
<a name="l03081"></a>03081     sbd-&gt;m_numLinks = <a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03082"></a>03082     sbd-&gt;m_links = sbd-&gt;m_numLinks? (<a class="code" href="../../d5/de2/structSoftBodyLinkData.html">SoftBodyLinkData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ab52f85beefd08470be24a0586832ff4e">m_links</a>[0]):0;
<a name="l03083"></a>03083     <span class="keywordflow">if</span> (sbd-&gt;m_links)
<a name="l03084"></a>03084     {
<a name="l03085"></a>03085         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d5/de2/structSoftBodyLinkData.html">SoftBodyLinkData</a>);
<a name="l03086"></a>03086         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numLinks;
<a name="l03087"></a>03087         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03088"></a>03088         <a class="code" href="../../d5/de2/structSoftBodyLinkData.html">SoftBodyLinkData</a>* memPtr = (<a class="code" href="../../d5/de2/structSoftBodyLinkData.html">SoftBodyLinkData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03089"></a>03089         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03090"></a>03090         {
<a name="l03091"></a>03091             memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#a9203bb205397199fa65fd760d178a74d">m_bbending</a> = m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_bbending;
<a name="l03092"></a>03092             memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#a4d930951b51d81f0ecd1c91b69370292">m_material</a> = m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material? (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*) m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material):0;
<a name="l03093"></a>03093             memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#a2d6e0b5cf017da8c450099f775f965a3">m_nodeIndices</a>[0] = m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[0] ? m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[0] - &amp;m_nodes[0]: -1;
<a name="l03094"></a>03094             memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#a2d6e0b5cf017da8c450099f775f965a3">m_nodeIndices</a>[1] = m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[1] ? m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[1] - &amp;m_nodes[0]: -1;
<a name="l03095"></a>03095             <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#a2d6e0b5cf017da8c450099f775f965a3">m_nodeIndices</a>[0]&lt;m_nodes.size());
<a name="l03096"></a>03096             <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#a2d6e0b5cf017da8c450099f775f965a3">m_nodeIndices</a>[1]&lt;m_nodes.size());
<a name="l03097"></a>03097             memPtr-&gt;<a class="code" href="../../d5/de2/structSoftBodyLinkData.html#ae5fb5d5d3cfdf9b427360ad0211344df">m_restLength</a> = m_links[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_rl;
<a name="l03098"></a>03098         }
<a name="l03099"></a>03099         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyLinkData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_links[0]);
<a name="l03100"></a>03100 
<a name="l03101"></a>03101     }
<a name="l03102"></a>03102 
<a name="l03103"></a>03103 
<a name="l03104"></a>03104     sbd-&gt;m_numFaces = <a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03105"></a>03105     sbd-&gt;m_faces = sbd-&gt;m_numFaces? (<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html">SoftBodyFaceData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a76a8ea9e874b87a9dc51846cc24f3a4f">m_faces</a>[0]):0;
<a name="l03106"></a>03106     <span class="keywordflow">if</span> (sbd-&gt;m_faces)
<a name="l03107"></a>03107     {
<a name="l03108"></a>03108         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html">SoftBodyFaceData</a>);
<a name="l03109"></a>03109         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numFaces;
<a name="l03110"></a>03110         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03111"></a>03111         <a class="code" href="../../d6/d0a/structSoftBodyFaceData.html">SoftBodyFaceData</a>* memPtr = (<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html">SoftBodyFaceData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03112"></a>03112         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03113"></a>03113         {
<a name="l03114"></a>03114             memPtr-&gt;<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html#a6e9f3df3ab6ff0e79464b4ac49702db0">m_material</a> = m_faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material ?  (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material): 0;
<a name="l03115"></a>03115             m_faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_normal.serializeFloat( memPtr-&gt;<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html#a0571d9b6ae94d31ed8687c3ba9bb5225">m_normal</a>);
<a name="l03116"></a>03116             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++)
<a name="l03117"></a>03117             {
<a name="l03118"></a>03118                 memPtr-&gt;<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html#aa3c85d456d0ff5ff8184788765c5f937">m_nodeIndices</a>[j] = m_faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[j]? m_faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_n[j] - &amp;m_nodes[0]: -1;
<a name="l03119"></a>03119             }
<a name="l03120"></a>03120             memPtr-&gt;<a class="code" href="../../d6/d0a/structSoftBodyFaceData.html#af1735e28f48b38fe1df6a27b9ac44c90">m_restArea</a> = m_faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_ra;
<a name="l03121"></a>03121         }
<a name="l03122"></a>03122         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyFaceData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_faces[0]);
<a name="l03123"></a>03123     }
<a name="l03124"></a>03124 
<a name="l03125"></a>03125 
<a name="l03126"></a>03126     sbd-&gt;m_numTetrahedra = <a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03127"></a>03127     sbd-&gt;m_tetrahedra = sbd-&gt;m_numTetrahedra ? (<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html">SoftBodyTetraData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a5d67872e5c52a4d6cee4df5f752f9cfb">m_tetras</a>[0]):0;
<a name="l03128"></a>03128     <span class="keywordflow">if</span> (sbd-&gt;m_tetrahedra)
<a name="l03129"></a>03129     {
<a name="l03130"></a>03130         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html">SoftBodyTetraData</a>);
<a name="l03131"></a>03131         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numTetrahedra;
<a name="l03132"></a>03132         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03133"></a>03133         <a class="code" href="../../d4/dd9/structSoftBodyTetraData.html">SoftBodyTetraData</a>* memPtr = (<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html">SoftBodyTetraData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03134"></a>03134         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03135"></a>03135         {
<a name="l03136"></a>03136             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;4;j++)
<a name="l03137"></a>03137             {
<a name="l03138"></a>03138                 m_tetras[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_c0[j].serializeFloat( memPtr-&gt;<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html#a627747b5daf322851f14ad7c79ac6ac2">m_c0</a>[j] );
<a name="l03139"></a>03139                 memPtr-&gt;<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html#a2412381cc83582b0ceaecd1893694ca9">m_nodeIndices</a>[j] = m_tetras[j].m_n[j]? m_tetras[j].m_n[j]-&amp;m_nodes[0] : -1;
<a name="l03140"></a>03140             }
<a name="l03141"></a>03141             memPtr-&gt;<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html#a7dde8f8ceedaff75f33752241875595e">m_c1</a> = m_tetras[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_c1;
<a name="l03142"></a>03142             memPtr-&gt;<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html#ad810c00250737ca383b0dae52523015d">m_c2</a> = m_tetras[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_c2;
<a name="l03143"></a>03143             memPtr-&gt;<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html#a650259aff31d2dc62a4fc860f2b1a5c2">m_material</a> = m_tetras[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material ? (<a class="code" href="../../da/db4/structSoftBodyMaterialData.html">SoftBodyMaterialData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*) m_tetras[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_material): 0;
<a name="l03144"></a>03144             memPtr-&gt;<a class="code" href="../../d4/dd9/structSoftBodyTetraData.html#aabca833d1e9377c1ca76fae6aee7ff39">m_restVolume</a> = m_tetras[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_rv;
<a name="l03145"></a>03145         }
<a name="l03146"></a>03146         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyTetraData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_tetras[0]);
<a name="l03147"></a>03147     }
<a name="l03148"></a>03148 
<a name="l03149"></a>03149     sbd-&gt;m_numAnchors = <a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03150"></a>03150     sbd-&gt;m_anchors = sbd-&gt;m_numAnchors ? (<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html">SoftRigidAnchorData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#ac92bf269338f8e02284edff1cb075f1c">m_anchors</a>[0]):0;
<a name="l03151"></a>03151     <span class="keywordflow">if</span> (sbd-&gt;m_anchors)
<a name="l03152"></a>03152     {
<a name="l03153"></a>03153         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html">SoftRigidAnchorData</a>);
<a name="l03154"></a>03154         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numAnchors;
<a name="l03155"></a>03155         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03156"></a>03156         <a class="code" href="../../db/d8d/structSoftRigidAnchorData.html">SoftRigidAnchorData</a>* memPtr = (<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html">SoftRigidAnchorData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03157"></a>03157         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03158"></a>03158         {
<a name="l03159"></a>03159             m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_c0.serializeFloat(memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#a0a22d1db38d705aeed26b269ea626fd4">m_c0</a>);
<a name="l03160"></a>03160             m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_c1.serializeFloat(memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#a83c966bd2a61bb9b6324bc66ba6425aa">m_c1</a>);
<a name="l03161"></a>03161             memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#ac04b4388734aef9e6aca362fc6a686e2">m_c2</a> = m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_c2;
<a name="l03162"></a>03162             m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_local.serializeFloat(memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#a1c9b5b7de7eae0bcefcc06241ea10b04">m_localFrame</a>);
<a name="l03163"></a>03163             memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#aff037297a50a284782d25b7b9e07128e">m_nodeIndex</a> = m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_node? m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_node-&amp;m_nodes[0]: -1;
<a name="l03164"></a>03164             
<a name="l03165"></a>03165             memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#a893c8e4bd76a06d9312439d615ca9676">m_rigidBody</a> = m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_body? (<a class="code" href="../../dd/d16/btRigidBody_8h.html#ad0501635fe25524bc2c9e32e1445dca8">btRigidBodyData</a>*)  serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_anchors[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].m_body): 0;
<a name="l03166"></a>03166             <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(memPtr-&gt;<a class="code" href="../../db/d8d/structSoftRigidAnchorData.html#aff037297a50a284782d25b7b9e07128e">m_nodeIndex</a> &lt; m_nodes.size());
<a name="l03167"></a>03167         }
<a name="l03168"></a>03168         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftRigidAnchorData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_anchors[0]);
<a name="l03169"></a>03169     }
<a name="l03170"></a>03170     
<a name="l03171"></a>03171 
<a name="l03172"></a>03172     sbd-&gt;m_config.m_dynamicFriction = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a313daa4181e892f93d51114493b5f96c">kDF</a>;
<a name="l03173"></a>03173     sbd-&gt;m_config.m_baumgarte = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a18eec41b81c8a86632b2c9b1892ae462">kVCF</a>;
<a name="l03174"></a>03174     sbd-&gt;m_config.m_pressure = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a659a04711566fac7268d50c1c7384035">kPR</a>;
<a name="l03175"></a>03175     sbd-&gt;m_config.m_aeroModel = this-&gt;<a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a91b7375ace054ae67744aa417579dfa3">aeromodel</a>;
<a name="l03176"></a>03176     sbd-&gt;m_config.m_lift = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aaf819d51d8c1774bd5629965fbd53be6">kLF</a>;
<a name="l03177"></a>03177     sbd-&gt;m_config.m_drag = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a00138980dda3355a50e2f5d79107d772">kDG</a>;
<a name="l03178"></a>03178     sbd-&gt;m_config.m_positionIterations = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a281a562a273f8d02f9b7354aa1bf1c86">piterations</a>;
<a name="l03179"></a>03179     sbd-&gt;m_config.m_driftIterations = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a2308fe57ad7f38ca9a2f5fe934156f6c">diterations</a>;
<a name="l03180"></a>03180     sbd-&gt;m_config.m_clusterIterations = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a120909b8c9563169d6457cc9e00a885d">citerations</a>;
<a name="l03181"></a>03181     sbd-&gt;m_config.m_velocityIterations = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aba421ab9d7267825bacabf8a0faa7e23">viterations</a>;
<a name="l03182"></a>03182     sbd-&gt;m_config.m_maxVolume = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a07d5c0b7c84c8e384eb4039b60496657">maxvolume</a>;
<a name="l03183"></a>03183     sbd-&gt;m_config.m_damping = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a307cb6ef5523b702defdbabe51ec9603">kDP</a>;
<a name="l03184"></a>03184     sbd-&gt;m_config.m_poseMatch = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a8e9d39cceaf15fd8697b2f8831b2fee1">kMT</a>;
<a name="l03185"></a>03185     sbd-&gt;m_config.m_collisionFlags = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a094682081f77f6351dfac8a73f00a046">collisions</a>;
<a name="l03186"></a>03186     sbd-&gt;m_config.m_volume = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a6057779d5267a9e600bb4055d1f7f2c2">kVC</a>;
<a name="l03187"></a>03187     sbd-&gt;m_config.m_rigidContactHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a2d2bb11122dd2d69d03b8c700bbf0209">kCHR</a>;
<a name="l03188"></a>03188     sbd-&gt;m_config.m_kineticContactHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a11c864538713216f8d34bb45d580bbbd">kKHR</a>;
<a name="l03189"></a>03189     sbd-&gt;m_config.m_softContactHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#acb51a580d7316fda20f3b6dac911bfda">kSHR</a>;
<a name="l03190"></a>03190     sbd-&gt;m_config.m_anchorHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#af4a43c3b3d4cec8f9bdfb1178d7ae5e1">kAHR</a>;
<a name="l03191"></a>03191     sbd-&gt;m_config.m_timeScale = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#aca2a21b06d44629ad4d1fc0bb4d8a93d">timescale</a>;
<a name="l03192"></a>03192     sbd-&gt;m_config.m_maxVolume = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a07d5c0b7c84c8e384eb4039b60496657">maxvolume</a>;
<a name="l03193"></a>03193     sbd-&gt;m_config.m_softRigidClusterHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a6e930bc1e762885278b675270aad60dc">kSRHR_CL</a>;
<a name="l03194"></a>03194     sbd-&gt;m_config.m_softKineticClusterHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a0afa82b3f6f99b24dcbb0b9c98876564">kSKHR_CL</a>;
<a name="l03195"></a>03195     sbd-&gt;m_config.m_softSoftClusterHardness = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a5b724a41c05818106ac4cc9bb14d29cf">kSSHR_CL</a>;
<a name="l03196"></a>03196     sbd-&gt;m_config.m_softRigidClusterImpulseSplit = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#ab3cbac97cbdf11526621854596809f2f">kSR_SPLT_CL</a>;
<a name="l03197"></a>03197     sbd-&gt;m_config.m_softKineticClusterImpulseSplit = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a76fab5d763ac8b5f7a7a29e05f008af1">kSK_SPLT_CL</a>;
<a name="l03198"></a>03198     sbd-&gt;m_config.m_softSoftClusterImpulseSplit = <a class="code" href="../../da/d60/classbtSoftBody.html#a6c8ea8006fb5e716361a7d66cf00daab">m_cfg</a>.<a class="code" href="../../d9/d56/structbtSoftBody_1_1Config.html#a77f98dda946550d73c4eb858ffb82aee">kSS_SPLT_CL</a>;
<a name="l03199"></a>03199         
<a name="l03200"></a>03200     <span class="comment">//pose for shape matching</span>
<a name="l03201"></a>03201     {
<a name="l03202"></a>03202         sbd-&gt;m_pose = (<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html">SoftBodyPoseData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a3c1d3c3e9f60e3d97f08245a82fa0ed3">m_pose</a>);
<a name="l03203"></a>03203 
<a name="l03204"></a>03204         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html">SoftBodyPoseData</a>);
<a name="l03205"></a>03205         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,1);
<a name="l03206"></a>03206         <a class="code" href="../../d3/dcf/structSoftBodyPoseData.html">SoftBodyPoseData</a>* memPtr = (<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html">SoftBodyPoseData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03207"></a>03207         
<a name="l03208"></a>03208         m_pose.m_aqq.serializeFloat(memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#add98eba45fb2d041e5de318262cc5826">m_aqq</a>);
<a name="l03209"></a>03209         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#ad8f20e6a915c17541a3584f24ef75e38">m_bframe</a> = m_pose.m_bframe;
<a name="l03210"></a>03210         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#ab9cf31ad71d65de90d826917bd58fab2">m_bvolume</a> = m_pose.m_bvolume;
<a name="l03211"></a>03211         m_pose.m_com.serializeFloat(memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a2357ae1c8175b5816331d2226af67552">m_com</a>);
<a name="l03212"></a>03212         
<a name="l03213"></a>03213         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a562e708b792125bc9f844b363636659e">m_numPositions</a> = m_pose.m_pos.size();
<a name="l03214"></a>03214         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#aae039479a8734b2bef62604e49b1b8da">m_positions</a> = memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a562e708b792125bc9f844b363636659e">m_numPositions</a> ? (<a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;m_pose.m_pos[0]): 0;
<a name="l03215"></a>03215         <span class="keywordflow">if</span> (memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a562e708b792125bc9f844b363636659e">m_numPositions</a>)
<a name="l03216"></a>03216         {
<a name="l03217"></a>03217             <span class="keywordtype">int</span> numElem = memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a562e708b792125bc9f844b363636659e">m_numPositions</a>;
<a name="l03218"></a>03218             <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d2/dd0/btVector3_8h.html#ad116b75e5135551c1335437e47fd8a3f">btVector3Data</a>);
<a name="l03219"></a>03219             <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03220"></a>03220             <a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>* memPtr = (<a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03221"></a>03221             for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03222"></a>03222             {
<a name="l03223"></a>03223                 m_pose.m_pos[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].serializeFloat(*memPtr);
<a name="l03224"></a>03224             }
<a name="l03225"></a>03225             serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;btVector3FloatData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)&amp;m_pose.m_pos[0]);
<a name="l03226"></a>03226         }
<a name="l03227"></a>03227         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#af404e47f7a1beaf49675175b3bc8bdfa">m_restVolume</a> = m_pose.m_volume;
<a name="l03228"></a>03228         m_pose.m_rot.serializeFloat(memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a020a35cfbbe88a92360402e702b7f667">m_rot</a>);
<a name="l03229"></a>03229         m_pose.m_scl.serializeFloat(memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#ae1dbbbb74ed103dbb2008661e3042ea7">m_scale</a>);
<a name="l03230"></a>03230 
<a name="l03231"></a>03231         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a73ac96f9dafa067f9f2d80bb876d77a3">m_numWeigts</a> = m_pose.m_wgh.size();
<a name="l03232"></a>03232         memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#ae2c54cc1a0a8598ac76ca733ed65e72e">m_weights</a> = memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a73ac96f9dafa067f9f2d80bb876d77a3">m_numWeigts</a>? (<span class="keywordtype">float</span>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*) &amp;m_pose.m_wgh[0]) : 0;
<a name="l03233"></a>03233         <span class="keywordflow">if</span> (memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a73ac96f9dafa067f9f2d80bb876d77a3">m_numWeigts</a>)
<a name="l03234"></a>03234         {
<a name="l03235"></a>03235             
<a name="l03236"></a>03236             <span class="keywordtype">int</span> numElem = memPtr-&gt;<a class="code" href="../../d3/dcf/structSoftBodyPoseData.html#a73ac96f9dafa067f9f2d80bb876d77a3">m_numWeigts</a>;
<a name="l03237"></a>03237             <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(float);
<a name="l03238"></a>03238             <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03239"></a>03239             <span class="keywordtype">float</span>* memPtr = (<span class="keywordtype">float</span>*) chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03240"></a>03240             for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03241"></a>03241             {
<a name="l03242"></a>03242                 *memPtr = m_pose.m_wgh[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l03243"></a>03243             }
<a name="l03244"></a>03244             serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;float&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)&amp;m_pose.m_wgh[0]);
<a name="l03245"></a>03245         }
<a name="l03246"></a>03246 
<a name="l03247"></a>03247         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyPoseData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)&amp;m_pose);
<a name="l03248"></a>03248     }
<a name="l03249"></a>03249 
<a name="l03250"></a>03250     <span class="comment">//clusters for convex-cluster collision detection</span>
<a name="l03251"></a>03251 
<a name="l03252"></a>03252     sbd-&gt;m_numClusters = <a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03253"></a>03253     sbd-&gt;m_clusters = sbd-&gt;m_numClusters? (<a class="code" href="../../de/df3/structSoftBodyClusterData.html">SoftBodyClusterData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)<a class="code" href="../../da/d60/classbtSoftBody.html#a9579ec7fb7f43787cf4bc74eed279f48">m_clusters</a>[0]) : 0;
<a name="l03254"></a>03254     <span class="keywordflow">if</span> (sbd-&gt;m_numClusters)
<a name="l03255"></a>03255     {
<a name="l03256"></a>03256         <span class="keywordtype">int</span> numElem = sbd-&gt;m_numClusters;
<a name="l03257"></a>03257         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../de/df3/structSoftBodyClusterData.html">SoftBodyClusterData</a>);
<a name="l03258"></a>03258         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03259"></a>03259         <a class="code" href="../../de/df3/structSoftBodyClusterData.html">SoftBodyClusterData</a>* memPtr = (<a class="code" href="../../de/df3/structSoftBodyClusterData.html">SoftBodyClusterData</a>*) chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03260"></a>03260         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03261"></a>03261         {
<a name="l03262"></a>03262             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#af5bab36c7cb638342a869875ad3b90cd">m_adamping</a>= m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_adamping;
<a name="l03263"></a>03263             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_av.serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a011a00f2cb998dfaca3bdf803572d777">m_av</a>);
<a name="l03264"></a>03264             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#adeec97b03e256449a0e65d6bc1594542">m_clusterIndex</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_clusterIndex;
<a name="l03265"></a>03265             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ab04a8dab21722c60a27ebbe8560e436a">m_collide</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_collide;
<a name="l03266"></a>03266             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_com.serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#af9d1cbefb31e169319f5765620a489f3">m_com</a>);
<a name="l03267"></a>03267             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a69ef62e4117ebf173d836e72841a6275">m_containsAnchor</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_containsAnchor;
<a name="l03268"></a>03268             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_dimpulses[0].serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#aa73da44e7721f19bbf31580903f4a091">m_dimpulses</a>[0]);
<a name="l03269"></a>03269             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_dimpulses[1].serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#aa73da44e7721f19bbf31580903f4a091">m_dimpulses</a>[1]);
<a name="l03270"></a>03270             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_framexform.serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ae102876d093436233f3eb8b785bd53b6">m_framexform</a>);
<a name="l03271"></a>03271             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#af28133c734e5bfe2ea3fc063e0eb13ba">m_idmass</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_idmass;
<a name="l03272"></a>03272             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a3dc996b0396f38b9ba7461a0c6fdf48c">m_imass</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_imass;
<a name="l03273"></a>03273             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_invwi.serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a4794dc1bc3ec675d4cd50b549ca6b763">m_invwi</a>);
<a name="l03274"></a>03274             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#acc7e6fa5e831c3f4dfe9fbc9632429c2">m_ldamping</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_ldamping;
<a name="l03275"></a>03275             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_locii.serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#aa7b4e9ec24613e7a66709fc5a8fde0bc">m_locii</a>);
<a name="l03276"></a>03276             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_lv.serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#acd12e43a3c7646cf594d6af5cee66586">m_lv</a>);
<a name="l03277"></a>03277             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ad750d17ec6489cd3bd5f92ad794a8891">m_matching</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_matching;
<a name="l03278"></a>03278             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#aa90d0d59195e96b3e5addb8b5cebca23">m_maxSelfCollisionImpulse</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_maxSelfCollisionImpulse;
<a name="l03279"></a>03279             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ab44def4e338b7f0882361562bb47f9b5">m_ndamping</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_ndamping;
<a name="l03280"></a>03280             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#acc7e6fa5e831c3f4dfe9fbc9632429c2">m_ldamping</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_ldamping;
<a name="l03281"></a>03281             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#af5bab36c7cb638342a869875ad3b90cd">m_adamping</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_adamping;
<a name="l03282"></a>03282             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#af78309e9c32a1be74f7f7bff245f0d68">m_selfCollisionImpulseFactor</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_selfCollisionImpulseFactor;
<a name="l03283"></a>03283 
<a name="l03284"></a>03284             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a9a79113a408bac08b1e6c60c2e6bc9f4">m_numFrameRefs</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_framerefs.size();
<a name="l03285"></a>03285             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a0d14f22b08c69b61c2451e56cfa161f6">m_numMasses</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_masses.size();
<a name="l03286"></a>03286             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ad0e717ce7b7586b5ae722d5a6a2d6d8f">m_numNodes</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nodes.size();
<a name="l03287"></a>03287 
<a name="l03288"></a>03288             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a8b3984643d5381ec8b3096d67956f273">m_nvimpulses</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_nvimpulses;
<a name="l03289"></a>03289             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_vimpulses[0].serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a6052f3a630dfcb8211198f2556790804">m_vimpulses</a>[0]);
<a name="l03290"></a>03290             m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_vimpulses[1].serializeFloat(memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a6052f3a630dfcb8211198f2556790804">m_vimpulses</a>[1]);
<a name="l03291"></a>03291             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ae219096d87a2b3aded02ae7d6420709b">m_ndimpulses</a> = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_ndimpulses;
<a name="l03292"></a>03292 
<a name="l03293"></a>03293             
<a name="l03294"></a>03294 
<a name="l03295"></a>03295             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a7b0cc1fd9a9b134aa36fc94083de3d4c">m_framerefs</a> = memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a9a79113a408bac08b1e6c60c2e6bc9f4">m_numFrameRefs</a>? (<a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>*)serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_framerefs[0]) : 0;
<a name="l03296"></a>03296             <span class="keywordflow">if</span> (memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a7b0cc1fd9a9b134aa36fc94083de3d4c">m_framerefs</a>)
<a name="l03297"></a>03297             {
<a name="l03298"></a>03298                 <span class="keywordtype">int</span> numElem = memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a9a79113a408bac08b1e6c60c2e6bc9f4">m_numFrameRefs</a>;
<a name="l03299"></a>03299                 <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>);
<a name="l03300"></a>03300                 <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03301"></a>03301                 <a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>* memPtr = (<a class="code" href="../../de/d67/structbtVector3FloatData.html">btVector3FloatData</a>*) chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03302"></a>03302                 for (<span class="keywordtype">int</span> j=0;j&lt;numElem;j++,memPtr++)
<a name="l03303"></a>03303                 {
<a name="l03304"></a>03304                     m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_framerefs[j].serializeFloat(*memPtr);
<a name="l03305"></a>03305                 }
<a name="l03306"></a>03306                 serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;btVector3FloatData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)&amp;m_clusters[i]-&gt;m_framerefs[0]);
<a name="l03307"></a>03307             }
<a name="l03308"></a>03308             
<a name="l03309"></a>03309             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ae51d93f83e5d4c6550b82078dc9eb66a">m_masses</a> = memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a0d14f22b08c69b61c2451e56cfa161f6">m_numMasses</a> ? (<span class="keywordtype">float</span>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;m_clusters[i]-&gt;m_masses[0]): 0;
<a name="l03310"></a>03310             <span class="keywordflow">if</span> (memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ae51d93f83e5d4c6550b82078dc9eb66a">m_masses</a>)
<a name="l03311"></a>03311             {
<a name="l03312"></a>03312                 <span class="keywordtype">int</span> numElem = memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a0d14f22b08c69b61c2451e56cfa161f6">m_numMasses</a>;
<a name="l03313"></a>03313                 <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(float);
<a name="l03314"></a>03314                 <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03315"></a>03315                 <span class="keywordtype">float</span>* memPtr = (<span class="keywordtype">float</span>*) chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03316"></a>03316                 for (<span class="keywordtype">int</span> j=0;j&lt;numElem;j++,memPtr++)
<a name="l03317"></a>03317                 {
<a name="l03318"></a>03318                     *memPtr = m_clusters[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_masses[j];
<a name="l03319"></a>03319                 }
<a name="l03320"></a>03320                 serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;float&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)&amp;m_clusters[i]-&gt;m_masses[0]);
<a name="l03321"></a>03321             }
<a name="l03322"></a>03322 
<a name="l03323"></a>03323             memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#accb5de8e6da8af9521edc9763868ca2e">m_nodeIndices</a>  = memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#ad0e717ce7b7586b5ae722d5a6a2d6d8f">m_numNodes</a> ? (<span class="keywordtype">int</span>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*) &amp;m_clusters[i]-&gt;m_nodes) : 0;
<a name="l03324"></a>03324             <span class="keywordflow">if</span> (memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#accb5de8e6da8af9521edc9763868ca2e">m_nodeIndices</a> )
<a name="l03325"></a>03325             {
<a name="l03326"></a>03326                 <span class="keywordtype">int</span> numElem = memPtr-&gt;<a class="code" href="../../de/df3/structSoftBodyClusterData.html#a0d14f22b08c69b61c2451e56cfa161f6">m_numMasses</a>;
<a name="l03327"></a>03327                 <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(int);
<a name="l03328"></a>03328                 <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03329"></a>03329                 <span class="keywordtype">int</span>* memPtr = (<span class="keywordtype">int</span>*) chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03330"></a>03330                 for (<span class="keywordtype">int</span> j=0;j&lt;numElem;j++,memPtr++)
<a name="l03331"></a>03331                 {
<a name="l03332"></a>03332                     <span class="keywordtype">int</span>* indexPtr = m_nodeIndexMap.<a class="code" href="../../d2/d38/classbtHashMap.html#ab04b49625760144b1e8a66dc8b7bf6b9">find</a>(m_clusters[i]-&gt;m_nodes[j]);
<a name="l03333"></a>03333                     <a class="code" href="../../d0/d6b/btScalar_8h.html#aff3e6078c073f6ba0edb95353f2c2c62">btAssert</a>(indexPtr);
<a name="l03334"></a>03334                     *memPtr = *indexPtr;
<a name="l03335"></a>03335                 }
<a name="l03336"></a>03336                 serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;int&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)&amp;m_clusters[i]-&gt;m_nodes);
<a name="l03337"></a>03337             }
<a name="l03338"></a>03338         }
<a name="l03339"></a>03339         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;SoftBodyClusterData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*)m_clusters[0]);
<a name="l03340"></a>03340 
<a name="l03341"></a>03341     }
<a name="l03342"></a>03342     
<a name="l03343"></a>03343 
<a name="l03344"></a>03344     
<a name="l03345"></a>03345     sbd-&gt;m_numJoints = <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>();
<a name="l03346"></a>03346     sbd-&gt;m_joints = <a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>.<a class="code" href="../../dc/df2/classbtAlignedObjectArray.html#a6bdd14c7599ecb95e8d83dd5a715f9b7" title="return the number of elements in the array">size</a>()? (<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html">btSoftBodyJointData</a>*) serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)&amp;<a class="code" href="../../da/d60/classbtSoftBody.html#a1c4a78e51ce702096f3db221cc2ae8a6">m_joints</a>[0]) : 0;
<a name="l03347"></a>03347 
<a name="l03348"></a>03348     <span class="keywordflow">if</span> (sbd-&gt;m_joints)
<a name="l03349"></a>03349     {
<a name="l03350"></a>03350         <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html">btSoftBodyJointData</a>);
<a name="l03351"></a>03351         <span class="keywordtype">int</span> numElem = m_joints.size();
<a name="l03352"></a>03352         <a class="code" href="../../d9/dfa/classbtChunk.html">btChunk</a>* chunk = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#a0bc96e86971e3410f66bc64bbce8ec81">allocate</a>(sz,numElem);
<a name="l03353"></a>03353         <a class="code" href="../../d4/d52/structbtSoftBodyJointData.html">btSoftBodyJointData</a>* memPtr = (<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html">btSoftBodyJointData</a>*)chunk-&gt;<a class="code" href="../../d9/dfa/classbtChunk.html#aa9c3adc50e121d98bbb7e8c91c472fa5">m_oldPtr</a>;
<a name="l03354"></a>03354 
<a name="l03355"></a>03355         for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numElem;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++,memPtr++)
<a name="l03356"></a>03356         {
<a name="l03357"></a>03357             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#ab0620ed64c79d8abdbcd3ed739e7a0c3">m_jointType</a> = (int)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Type();
<a name="l03358"></a>03358             m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_refs[0].serializeFloat(memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a317d5254a5a5bb919d1780caabad226a">m_refs</a>[0]);
<a name="l03359"></a>03359             m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_refs[1].serializeFloat(memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a317d5254a5a5bb919d1780caabad226a">m_refs</a>[1]);
<a name="l03360"></a>03360             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a277938182c7715a1e9d25a4d5c4a4883">m_cfm</a> = m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_cfm;
<a name="l03361"></a>03361             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a01f10d72c14307a7fbe04cac64457a15">m_erp</a> = m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_erp;
<a name="l03362"></a>03362             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a8eb9aaf8d03ec99c8d36f9a16d62d075">m_split</a> = m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_split;
<a name="l03363"></a>03363             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a38653218fd5c6b336e66564d7e433e52">m_delete</a> = m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_delete;
<a name="l03364"></a>03364             
<a name="l03365"></a>03365             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;4;j++)
<a name="l03366"></a>03366             {
<a name="l03367"></a>03367                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a3253593e164dccf56f61a473ecd24549">m_relPosition</a>[0].<a class="code" href="../../de/d67/structbtVector3FloatData.html#ab246fb8dc0af06cfb3260d836591dc46">m_floats</a>[j] = 0.f;
<a name="l03368"></a>03368                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a3253593e164dccf56f61a473ecd24549">m_relPosition</a>[1].<a class="code" href="../../de/d67/structbtVector3FloatData.html#ab246fb8dc0af06cfb3260d836591dc46">m_floats</a>[j] = 0.f;
<a name="l03369"></a>03369             }
<a name="l03370"></a>03370             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#aa0c5fe576669547704c7e97a11fa1b79">m_bodyA</a> = 0;
<a name="l03371"></a>03371             memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a4db68941d63ea7141412ce8582d1346b">m_bodyB</a> = 0;
<a name="l03372"></a>03372             <span class="keywordflow">if</span> (m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[0].m_soft)
<a name="l03373"></a>03373             {
<a name="l03374"></a>03374                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a496ebce7c9805781d14f941986ac5feb">m_bodyAtype</a> = <a class="code" href="../../dd/d46/btSoftBodyData_8h.html#a10ab4c4a36a382c819cd773a29f6ca6caa0807dce624de5116d3ff2d86a25f25b">BT_JOINT_SOFT_BODY_CLUSTER</a>;
<a name="l03375"></a>03375                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#aa0c5fe576669547704c7e97a11fa1b79">m_bodyA</a> = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[0].m_soft);
<a name="l03376"></a>03376             }
<a name="l03377"></a>03377             <span class="keywordflow">if</span> (m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[0].m_collisionObject)
<a name="l03378"></a>03378             {
<a name="l03379"></a>03379                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a496ebce7c9805781d14f941986ac5feb">m_bodyAtype</a> = <a class="code" href="../../dd/d46/btSoftBodyData_8h.html#a10ab4c4a36a382c819cd773a29f6ca6caeedb9de321287f33ea8cf976f2bef129">BT_JOINT_COLLISION_OBJECT</a>;
<a name="l03380"></a>03380                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#aa0c5fe576669547704c7e97a11fa1b79">m_bodyA</a> = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[0].m_collisionObject);
<a name="l03381"></a>03381             }
<a name="l03382"></a>03382             <span class="keywordflow">if</span> (m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[0].m_rigid)
<a name="l03383"></a>03383             {
<a name="l03384"></a>03384                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a496ebce7c9805781d14f941986ac5feb">m_bodyAtype</a> = <a class="code" href="../../dd/d46/btSoftBodyData_8h.html#a10ab4c4a36a382c819cd773a29f6ca6ca422215b3d66166debea57f2dbbb61b37">BT_JOINT_RIGID_BODY</a>;
<a name="l03385"></a>03385                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#aa0c5fe576669547704c7e97a11fa1b79">m_bodyA</a> = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[0].m_rigid);
<a name="l03386"></a>03386             }
<a name="l03387"></a>03387 
<a name="l03388"></a>03388             <span class="keywordflow">if</span> (m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[1].m_soft)
<a name="l03389"></a>03389             {
<a name="l03390"></a>03390                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a13ea08e1cfa0ebbe7f4e7bb4b3147e69">m_bodyBtype</a> = <a class="code" href="../../dd/d46/btSoftBodyData_8h.html#a10ab4c4a36a382c819cd773a29f6ca6caa0807dce624de5116d3ff2d86a25f25b">BT_JOINT_SOFT_BODY_CLUSTER</a>;
<a name="l03391"></a>03391                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a4db68941d63ea7141412ce8582d1346b">m_bodyB</a> = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[1].m_soft);
<a name="l03392"></a>03392             }
<a name="l03393"></a>03393             <span class="keywordflow">if</span> (m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[1].m_collisionObject)
<a name="l03394"></a>03394             {
<a name="l03395"></a>03395                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a13ea08e1cfa0ebbe7f4e7bb4b3147e69">m_bodyBtype</a> = <a class="code" href="../../dd/d46/btSoftBodyData_8h.html#a10ab4c4a36a382c819cd773a29f6ca6caeedb9de321287f33ea8cf976f2bef129">BT_JOINT_COLLISION_OBJECT</a>;
<a name="l03396"></a>03396                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a4db68941d63ea7141412ce8582d1346b">m_bodyB</a> = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[1].m_collisionObject);
<a name="l03397"></a>03397             }
<a name="l03398"></a>03398             <span class="keywordflow">if</span> (m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[1].m_rigid)
<a name="l03399"></a>03399             {
<a name="l03400"></a>03400                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a13ea08e1cfa0ebbe7f4e7bb4b3147e69">m_bodyBtype</a> = <a class="code" href="../../dd/d46/btSoftBodyData_8h.html#a10ab4c4a36a382c819cd773a29f6ca6ca422215b3d66166debea57f2dbbb61b37">BT_JOINT_RIGID_BODY</a>;
<a name="l03401"></a>03401                 memPtr-&gt;<a class="code" href="../../d4/d52/structbtSoftBodyJointData.html#a4db68941d63ea7141412ce8582d1346b">m_bodyB</a> = serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ab47015de46266c378ebba6329e71a5d6">getUniquePointer</a>((<span class="keywordtype">void</span>*)m_joints[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;m_bodies[1].m_rigid);
<a name="l03402"></a>03402             }
<a name="l03403"></a>03403         }
<a name="l03404"></a>03404         serializer-&gt;<a class="code" href="../../d2/d43/classbtSerializer.html#ac98913802b276eed28d745ef422ac724">finalizeChunk</a>(chunk,<span class="stringliteral">&quot;btSoftBodyJointData&quot;</span>,<a class="code" href="../../de/df0/btSerializer_8h.html#ad9334757d82f4dece09b300be73b6bbf">BT_ARRAY_CODE</a>,(<span class="keywordtype">void</span>*) &amp;m_joints[0]);
<a name="l03405"></a>03405     }
<a name="l03406"></a>03406 
<a name="l03407"></a>03407 
<a name="l03408"></a>03408     <span class="keywordflow">return</span> <a class="code" href="../../de/d40/btSoftBody_8h.html#a8bb15a3630b9b9ed7f9e1d101c4467c5">btSoftBodyDataName</a>;
<a name="l03409"></a>03409 }
<a name="l03410"></a>03410 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:09 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

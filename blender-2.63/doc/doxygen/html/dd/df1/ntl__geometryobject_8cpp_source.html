<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: ntl_geometryobject.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">ntl_geometryobject.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../dd/df1/ntl__geometryobject_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - Free Surface Fluid Simulation with the Lattice Boltzmann Method</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * a geometry object</span>
<a name="l00010"></a>00010 <span class="comment"> * all other geometry objects are derived from this one</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *****************************************************************************/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html">ntl_geometryobject.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d8d/ntl__world_8h.html">ntl_world.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d2c/ntl__matrices_8h.html">ntl_matrices.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">// for FGI</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d00/elbeem_8h.html">elbeem.h</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ad9d5079f80e065340a06997423445f7f">00022</a> <span class="preprocessor">#define TRI_UVOFFSET (1./4.)</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="comment">//#define TRI_UVOFFSET (1./3.)</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">/*****************************************************************************/</span>
<a name="l00027"></a>00027 <span class="comment">/* Default constructor */</span>
<a name="l00028"></a>00028 <span class="comment">/*****************************************************************************/</span>
<a name="l00029"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a6cdc915eb88d595a3d09a032352d7542">00029</a> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a6cdc915eb88d595a3d09a032352d7542" title="Default constructor.">ntlGeometryObject::ntlGeometryObject</a>() :
<a name="l00030"></a>00030     mIsInitialized(false), mpMaterial( <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ),
<a name="l00031"></a>00031     mMaterialName( <span class="stringliteral">&quot;default&quot;</span> ),
<a name="l00032"></a>00032     mCastShadows( 1 ), mReceiveShadows( 1 ),
<a name="l00033"></a>00033     mGeoInitType( 0 ), 
<a name="l00034"></a>00034     mInitialVelocity(0.0), mcInitialVelocity(0.0), mLocalCoordInivel(false),
<a name="l00035"></a>00035     mGeoInitIntersect(false),
<a name="l00036"></a>00036     mGeoPartSlipValue(0.0),
<a name="l00037"></a>00037     mcGeoImpactFactor(1.),
<a name="l00038"></a>00038     mVolumeInit(<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>),
<a name="l00039"></a>00039     mInitialPos(0.),
<a name="l00040"></a>00040     mcTrans(0.), mcRot(0.), mcScale(1.),
<a name="l00041"></a>00041     mIsAnimated(false),
<a name="l00042"></a>00042     mMovPoints(), mMovNormals(),
<a name="l00043"></a>00043     mHaveCachedMov(false),
<a name="l00044"></a>00044     mCachedMovPoints(), mCachedMovNormals(),
<a name="l00045"></a>00045     mTriangleDivs1(), mTriangleDivs2(), mTriangleDivs3(),
<a name="l00046"></a>00046     mMovPntsInited(-100.0), mMaxMovPnt(-1),
<a name="l00047"></a>00047     mcGeoActive(1.),
<a name="l00048"></a>00048     mCpsTimeStart(0.), mCpsTimeEnd(1.0), mCpsQuality(10.),
<a name="l00049"></a>00049     mcAttrFStr(0.),mcAttrFRad(0.), mcVelFStr(0.), mcVelFRad(0.)
<a name="l00050"></a>00050 { 
<a name="l00051"></a>00051 };
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/*****************************************************************************/</span>
<a name="l00055"></a>00055 <span class="comment">/* Default destructor */</span>
<a name="l00056"></a>00056 <span class="comment">/*****************************************************************************/</span>
<a name="l00057"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#ad1965af8f67a1712cb9a752cea77f22f">00057</a> <a class="code" href="../../df/dc9/classntlGeometryObject.html#ad1965af8f67a1712cb9a752cea77f22f" title="Default destructor.">ntlGeometryObject::~ntlGeometryObject</a>() 
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00062"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">00062</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">ntlGeometryObject::getMeshAnimated</a>() {
<a name="l00063"></a>00063     <span class="comment">// off by default, on for e.g. ntlGeometryObjModel</span>
<a name="l00064"></a>00064     <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00068"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a0b927bfc8a888b7e1a87f75c7c793280">00068</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a0b927bfc8a888b7e1a87f75c7c793280">ntlGeometryObject::checkIsAnimated</a>() {
<a name="l00069"></a>00069     <span class="keywordflow">if</span>(    (<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1)  <span class="comment">// VALIDATE</span>
<a name="l00070"></a>00070         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00071"></a>00071         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00072"></a>00072         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00073"></a>00073             <span class="comment">// mcGeoImpactFactor only needed when moving</span>
<a name="l00074"></a>00074         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00075"></a>00075         ) {
<a name="l00076"></a>00076         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a88e7f679c571b9eaf92b132cfb331beb">mIsAnimated</a> = <span class="keyword">true</span>;
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="comment">// fluid objects always have static init!</span>
<a name="l00080"></a>00080     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a>==<a class="code" href="../../d8/d00/elbeem_8h.html#a51b010da5bd6ef1a80ad3b9a7be00e3a">FGI_FLUID</a>) {
<a name="l00081"></a>00081         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a88e7f679c571b9eaf92b132cfb331beb">mIsAnimated</a>=<span class="keyword">false</span>;
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083     <span class="comment">//errMsg(&quot;ntlGeometryObject::checkIsAnimated&quot;,&quot;obj=&quot;&lt;&lt;getName()&lt;&lt;&quot; debug: trans:&quot;&lt;&lt;mcTrans.accessValues().size()&lt;&lt;&quot; rot:&quot;&lt;&lt;mcRot.accessValues().size()&lt;&lt;&quot; scale:&quot;&lt;&lt;mcScale.accessValues().size()&lt;&lt;&quot; active:&quot;&lt;&lt;mcGeoActive.accessValues().size()&lt;&lt;&quot; inivel:&quot;&lt;&lt;mcInitialVelocity.accessValues().size()&lt;&lt;&quot;. isani?&quot;&lt;&lt;mIsAnimated ); // DEBUG</span>
<a name="l00084"></a>00084     <span class="keywordflow">return</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a88e7f679c571b9eaf92b132cfb331beb">mIsAnimated</a>;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/*****************************************************************************/</span>
<a name="l00088"></a>00088 <span class="comment">/* Init attributes etc. of this object */</span>
<a name="l00089"></a>00089 <span class="comment">/*****************************************************************************/</span>
<a name="l00090"></a><a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae5a4cd202693418249883fa9f50eab87">00090</a> <span class="preprocessor">#define GEOINIT_STRINGS  10</span>
<a name="l00091"></a><a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ab1e1f5040fd4fc13db5c2b5795421452">00091</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ab1e1f5040fd4fc13db5c2b5795421452">initStringStrs</a>[<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae5a4cd202693418249883fa9f50eab87">GEOINIT_STRINGS</a>] = {
<a name="l00092"></a>00092     <span class="stringliteral">&quot;fluid&quot;</span>,
<a name="l00093"></a>00093     <span class="stringliteral">&quot;bnd_no&quot;</span>,<span class="stringliteral">&quot;bnd_noslip&quot;</span>,
<a name="l00094"></a>00094     <span class="stringliteral">&quot;bnd_free&quot;</span>,<span class="stringliteral">&quot;bnd_freeslip&quot;</span>,
<a name="l00095"></a>00095     <span class="stringliteral">&quot;bnd_part&quot;</span>,<span class="stringliteral">&quot;bnd_partslip&quot;</span>,
<a name="l00096"></a>00096     <span class="stringliteral">&quot;inflow&quot;</span>, <span class="stringliteral">&quot;outflow&quot;</span>, <span class="stringliteral">&quot;control&quot;</span>,
<a name="l00097"></a>00097 };
<a name="l00098"></a><a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ab6f54e536796f320db0f53a1cd7fe360">00098</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ab6f54e536796f320db0f53a1cd7fe360">initStringTypes</a>[<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae5a4cd202693418249883fa9f50eab87">GEOINIT_STRINGS</a>] = {
<a name="l00099"></a>00099     <a class="code" href="../../d8/d00/elbeem_8h.html#a51b010da5bd6ef1a80ad3b9a7be00e3a">FGI_FLUID</a>,
<a name="l00100"></a>00100     <a class="code" href="../../d8/d00/elbeem_8h.html#ad0e7f1ed7626d8bd0701ec8f2e96aacd">FGI_BNDNO</a>, <a class="code" href="../../d8/d00/elbeem_8h.html#ad0e7f1ed7626d8bd0701ec8f2e96aacd">FGI_BNDNO</a>,
<a name="l00101"></a>00101     <a class="code" href="../../d8/d00/elbeem_8h.html#a26267e2d9b47124e93188bb5e770524b">FGI_BNDFREE</a>, <a class="code" href="../../d8/d00/elbeem_8h.html#a26267e2d9b47124e93188bb5e770524b">FGI_BNDFREE</a>,
<a name="l00102"></a>00102     <a class="code" href="../../d8/d00/elbeem_8h.html#adfd63685e07b3a05e15253ac1dd88c53">FGI_BNDPART</a>, <a class="code" href="../../d8/d00/elbeem_8h.html#adfd63685e07b3a05e15253ac1dd88c53">FGI_BNDPART</a>,
<a name="l00103"></a>00103     <a class="code" href="../../d8/d00/elbeem_8h.html#a981c60c9f2725cfc951630cf070fc646">FGI_MBNDINFLOW</a>, <a class="code" href="../../d8/d00/elbeem_8h.html#ae440d9b224ab18a3429b1fcb1dabccc8">FGI_MBNDOUTFLOW</a>, 
<a name="l00104"></a>00104     <a class="code" href="../../d8/d00/elbeem_8h.html#a521787d995d4318d27481c812333ed1d">FGI_CONTROL</a>
<a name="l00105"></a>00105 };
<a name="l00106"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#af8fab6d439a11e626e6604bce0cd4f51">00106</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#af8fab6d439a11e626e6604bce0cd4f51">ntlGeometryObject::initialize</a>(<a class="code" href="../../d0/d95/classntlRenderGlobals.html" title="Class that handles global rendering parameters.">ntlRenderGlobals</a> *glob) 
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108     <span class="comment">//debugOut(&quot;ntlGeometryObject::initialize: &#39;&quot;&lt;&lt;getName()&lt;&lt;&quot;&#39; &quot;, 10);</span>
<a name="l00109"></a>00109     <span class="comment">// initialize only once...</span>
<a name="l00110"></a>00110     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#abd314f10dc918d84e697c484c34c174a">mIsInitialized</a>) <span class="keywordflow">return</span>;
<a name="l00111"></a>00111     
<a name="l00112"></a>00112     <span class="comment">// init material, always necessary</span>
<a name="l00113"></a>00113     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8f3258e45ebb6663e3bce898a61b75d5">searchMaterial</a>( glob-&gt;<a class="code" href="../../d0/d95/classntlRenderGlobals.html#a84d31b05d957e34c82f47526d3600cf5" title="Returns the property object list.">getMaterials</a>() );
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aba1827bd65bf930e57d1b00d2445e911">mGeoInitId</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;geoinitid&quot;</span>, this-&gt;mGeoInitId,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mGeoInitId&quot;</span>, <span class="keyword">false</span>);
<a name="l00116"></a>00116     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a600bfafe524efcb0780797b24aa39002">mGeoInitIntersect</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;geoinit_intersect&quot;</span>, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a600bfafe524efcb0780797b24aa39002">mGeoInitIntersect</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mGeoInitIntersect&quot;</span>, <span class="keyword">false</span>);
<a name="l00117"></a>00117     <span class="keywordtype">string</span> ginitStr = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;geoinittype&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mGeoInitType&quot;</span>, <span class="keyword">false</span>);
<a name="l00118"></a>00118     <span class="keywordflow">if</span>(this-&gt;mGeoInitId&gt;=0) {
<a name="l00119"></a>00119         <span class="keywordtype">bool</span> gotit = <span class="keyword">false</span>;
<a name="l00120"></a>00120         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae5a4cd202693418249883fa9f50eab87">GEOINIT_STRINGS</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00121"></a>00121             <span class="keywordflow">if</span>(ginitStr== <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ab1e1f5040fd4fc13db5c2b5795421452">initStringStrs</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {
<a name="l00122"></a>00122                 gotit = <span class="keyword">true</span>;
<a name="l00123"></a>00123                 <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a> = <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ab6f54e536796f320db0f53a1cd7fe360">initStringTypes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00124"></a>00124             }
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keywordflow">if</span>(!gotit) {
<a name="l00128"></a>00128             <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;ntlGeometryObject::initialize&quot;</span>,<span class="stringliteral">&quot;Obj &#39;&quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ac9e7557154ccdacd21e86c58c660b866">mName</a>&lt;&lt;<span class="stringliteral">&quot;&#39;, Unkown &#39;geoinittype&#39; value: &#39;&quot;</span>&lt;&lt; ginitStr &lt;&lt;<span class="stringliteral">&quot;&#39; &quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00129"></a>00129             <span class="keywordflow">return</span>;
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="keywordtype">int</span> geoActive = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;geoinitactive&quot;</span>, 1,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;geoActive&quot;</span>, <span class="keyword">false</span>);
<a name="l00134"></a>00134     <span class="keywordflow">if</span>(!geoActive) {
<a name="l00135"></a>00135         <span class="comment">// disable geo init again...</span>
<a name="l00136"></a>00136         this-&gt;mGeoInitId = -1;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     <a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>  = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>( <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9b49e7f48d12234d2ae59e9e430b1861">readVec3d</a>(<span class="stringliteral">&quot;initial_velocity&quot;</span>, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4cf9be02f3d4720947423404f482018f">vec2D</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>),<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mInitialVelocity&quot;</span>, <span class="keyword">false</span>));
<a name="l00139"></a>00139     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ad1ae92dac48e3bb5b9d6076748248267">exists</a>(<span class="stringliteral">&quot;initial_velocity&quot;</span>) || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00140"></a>00140         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a1f38f6f13698586bb512aee119e771bf">readChannelVec3f</a>(<span class="stringliteral">&quot;initial_velocity&quot;</span>);
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142     <span class="comment">// always use channel</span>
<a name="l00143"></a>00143     <span class="keywordflow">if</span>(!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) { <a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;ntlVec3Gfx&gt;</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>); }
<a name="l00144"></a>00144     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a14b418cf288f896992606f23df4bcac0">mLocalCoordInivel</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;geoinit_localinivel&quot;</span>, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a14b418cf288f896992606f23df4bcac0">mLocalCoordInivel</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mLocalCoordInivel&quot;</span>, <span class="keyword">false</span>);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a794728f027a282a491f1419dfa957e9d">mGeoPartSlipValue</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;geoinit_partslip&quot;</span>, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a794728f027a282a491f1419dfa957e9d">mGeoPartSlipValue</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mGeoPartSlipValue&quot;</span>, <span class="keyword">false</span>);
<a name="l00147"></a>00147     <span class="keywordtype">bool</span> mOnlyThinInit = <span class="keyword">false</span>; <span class="comment">// deprecated!</span>
<a name="l00148"></a>00148     mOnlyThinInit     = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;geoinit_onlythin&quot;</span>, mOnlyThinInit,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mOnlyThinInit&quot;</span>, <span class="keyword">false</span>);
<a name="l00149"></a>00149     <span class="keywordflow">if</span>(mOnlyThinInit) <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a> = <a class="code" href="../../de/d07/ntl__geometryobject_8h.html#aadbad63b419747cf5182366ca4a231c0">VOLUMEINIT_SHELL</a>;
<a name="l00150"></a>00150     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a>     = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;geoinit_volumeinit&quot;</span>, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mVolumeInit&quot;</span>, <span class="keyword">false</span>);
<a name="l00151"></a>00151     <span class="keywordflow">if</span>((<a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a>&lt;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>)||(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a>&gt;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a22dea5eede14a7d766084f430bd193a5">VOLUMEINIT_BOTH</a>)) <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a> = <a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">// moving obs correction factor</span>
<a name="l00154"></a>00154     <span class="keywordtype">float</span> impactfactor=1.;
<a name="l00155"></a>00155     impactfactor = (float)<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;impactfactor&quot;</span>, impactfactor,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;impactfactor&quot;</span>, <span class="keyword">false</span>);
<a name="l00156"></a>00156     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;exists(<span class="stringliteral">&quot;impactfactor&quot;</span>) || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a45191eefcbb6d22e58e4a4ea33035406">mcGeoImpactFactor</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00157"></a>00157         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a45191eefcbb6d22e58e4a4ea33035406">mcGeoImpactFactor</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;impactfactor&quot;</span>);
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="comment">// override cfg types</span>
<a name="l00161"></a>00161     <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a6c30d2ffaaec28e75058406720c5f1a7">mVisible</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;visible&quot;</span>, <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a6c30d2ffaaec28e75058406720c5f1a7">mVisible</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mVisible&quot;</span>, <span class="keyword">false</span>);
<a name="l00162"></a>00162     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a5a0465963899fe8594db3baeb589f8ac">mReceiveShadows</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;recv_shad&quot;</span>, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a5a0465963899fe8594db3baeb589f8ac">mReceiveShadows</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mReceiveShadows&quot;</span>, <span class="keyword">false</span>);
<a name="l00163"></a>00163     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a4c4a08c0ae1ace1e1c339f76d660fa2c">mCastShadows</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa8a6db5f0eb383b614783746ccbd7cc2">readBool</a>(<span class="stringliteral">&quot;cast_shad&quot;</span>, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a4c4a08c0ae1ace1e1c339f76d660fa2c">mCastShadows</a>,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;mCastShadows&quot;</span>, <span class="keyword">false</span>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="comment">// read mesh animation channels</span>
<a name="l00166"></a>00166     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3d</a> translation(0.0);
<a name="l00167"></a>00167     translation = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9b49e7f48d12234d2ae59e9e430b1861">readVec3d</a>(<span class="stringliteral">&quot;translation&quot;</span>, translation,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;translation&quot;</span>, <span class="keyword">false</span>);
<a name="l00168"></a>00168     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;exists(<span class="stringliteral">&quot;translation&quot;</span>) || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00169"></a>00169         <a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a1f38f6f13698586bb512aee119e771bf">readChannelVec3f</a>(<span class="stringliteral">&quot;translation&quot;</span>);
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3d</a> rotation(0.0);
<a name="l00172"></a>00172     rotation = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9b49e7f48d12234d2ae59e9e430b1861">readVec3d</a>(<span class="stringliteral">&quot;rotation&quot;</span>, rotation,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;rotation&quot;</span>, <span class="keyword">false</span>);
<a name="l00173"></a>00173     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;exists(<span class="stringliteral">&quot;rotation&quot;</span>) || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00174"></a>00174         <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a1f38f6f13698586bb512aee119e771bf">readChannelVec3f</a>(<span class="stringliteral">&quot;rotation&quot;</span>);
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3d</a> scale(1.0);
<a name="l00177"></a>00177     scale = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9b49e7f48d12234d2ae59e9e430b1861">readVec3d</a>(<span class="stringliteral">&quot;scale&quot;</span>, scale,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;scale&quot;</span>, <span class="keyword">false</span>);
<a name="l00178"></a>00178     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;exists(<span class="stringliteral">&quot;scale&quot;</span>) || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00179"></a>00179         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a1f38f6f13698586bb512aee119e771bf">readChannelVec3f</a>(<span class="stringliteral">&quot;scale&quot;</span>);
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="keywordtype">float</span> geoactive=1.;
<a name="l00183"></a>00183     geoactive = (float)<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;geoactive&quot;</span>, geoactive,<span class="stringliteral">&quot;ntlGeometryObject&quot;</span>, <span class="stringliteral">&quot;geoactive&quot;</span>, <span class="keyword">false</span>);
<a name="l00184"></a>00184     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;exists(<span class="stringliteral">&quot;geoactive&quot;</span>) || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00185"></a>00185         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a> = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;geoactive&quot;</span>);
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     <span class="comment">// always use channel</span>
<a name="l00188"></a>00188     <span class="keywordflow">if</span>(!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) { <a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;float&gt;</a>(geoactive); }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a0b927bfc8a888b7e1a87f75c7c793280">checkIsAnimated</a>();
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <a class="code" href="../../df/dc9/classntlGeometryObject.html#abd314f10dc918d84e697c484c34c174a">mIsInitialized</a> = <span class="keyword">true</span>;
<a name="l00193"></a>00193     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initialize&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;GeoObj &#39;&quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot;&#39;: visible=&quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a6c30d2ffaaec28e75058406720c5f1a7">mVisible</a>&lt;&lt;<span class="stringliteral">&quot; gid=&quot;</span>&lt;&lt;this-&gt;mGeoInitId&lt;&lt;<span class="stringliteral">&quot; gtype=&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a>&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ginitStr&lt;&lt;
<a name="l00194"></a>00194             <span class="stringliteral">&quot; gvel=&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>&lt;&lt;<span class="stringliteral">&quot; gisect=&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a600bfafe524efcb0780797b24aa39002">mGeoInitIntersect</a>, 10); <span class="comment">// debug</span>
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00198"></a>00198 <span class="comment">// default action - do nothing...</span>
<a name="l00199"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#af0e86667d66058fcde1aea0b5d727e4a">00199</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#af0e86667d66058fcde1aea0b5d727e4a">ntlGeometryObject::notifyOfDump</a>(<span class="keywordtype">int</span> dumtp, <span class="keywordtype">int</span> frameNr,<span class="keywordtype">char</span> *frameNrStr,<span class="keywordtype">string</span> outfilename, <span class="keywordtype">double</span> simtime) {
<a name="l00200"></a>00200   <span class="keywordtype">bool</span> <a class="code" href="../../de/df0/utilities_8h.html#a2b390eed962d9bee00ce58c1f6bfd159">debugOut</a>=<span class="keyword">false</span>;
<a name="l00201"></a>00201     <span class="keywordflow">if</span>(debugOut) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::notifyOfDump&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot; dt:&quot;</span>&lt;&lt;dumtp&lt;&lt;<span class="stringliteral">&quot; obj:&quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; frame:&quot;</span>&lt;&lt;frameNrStr&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;frameNr&lt;&lt;<span class="stringliteral">&quot;,t&quot;</span>&lt;&lt;simtime&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;outfilename, 10); <span class="comment">// DEBUG</span>
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="comment">/*****************************************************************************/</span>
<a name="l00205"></a>00205 <span class="comment">/* Search the material for this object from the material list */</span>
<a name="l00206"></a>00206 <span class="comment">/*****************************************************************************/</span>
<a name="l00207"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a8f3258e45ebb6663e3bce898a61b75d5">00207</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8f3258e45ebb6663e3bce898a61b75d5">ntlGeometryObject::searchMaterial</a>(vector&lt;ntlMaterial *&gt; *mat)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <span class="comment">/* search the list... */</span>
<a name="l00210"></a>00210     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;
<a name="l00211"></a>00211     <span class="keywordflow">for</span> (vector&lt;ntlMaterial*&gt;::iterator iter = mat-&gt;begin();
<a name="l00212"></a>00212          iter != mat-&gt;end(); iter++) {
<a name="l00213"></a>00213         <span class="keywordflow">if</span>( <a class="code" href="../../df/dc9/classntlGeometryObject.html#a5589a862007ee27669b826ca3c69f0dc">mMaterialName</a> == (*iter)-&gt;getName() ) {
<a name="l00214"></a>00214             <span class="comment">//warnMsg(&quot;ntlGeometryObject::searchMaterial&quot;,&quot;for obj &#39;&quot;&lt;&lt;getName()&lt;&lt;&quot;&#39; found - &#39;&quot;&lt;&lt;(*iter)-&gt;getName()&lt;&lt;&quot;&#39; &quot;&lt;&lt;i); // DEBUG</span>
<a name="l00215"></a>00215             <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8b0cd5cd6b9e45cb1e5db1dbd32349fb">mpMaterial</a> = (*iter);
<a name="l00216"></a>00216             <span class="keywordflow">return</span>;
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218         i++;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;ntlGeometryObject::searchMaterial&quot;</span>,<span class="stringliteral">&quot;Unknown material &#39;&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a5589a862007ee27669b826ca3c69f0dc">mMaterialName</a>&lt;&lt;<span class="stringliteral">&quot;&#39; ! &quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00221"></a>00221     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8b0cd5cd6b9e45cb1e5db1dbd32349fb">mpMaterial</a> = <span class="keyword">new</span> <a class="code" href="../../d5/d60/classntlMaterial.html" title="Properties of an geo object, describing the reflection properties of the surface.">ntlMaterial</a>();
<a name="l00222"></a>00222     <span class="keywordflow">return</span>;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">/******************************************************************************</span>
<a name="l00226"></a>00226 <span class="comment"> * static add triangle function</span>
<a name="l00227"></a>00227 <span class="comment"> *****************************************************************************/</span>
<a name="l00228"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#acb486ec1413f9b002f625045f1d28065">00228</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#acb486ec1413f9b002f625045f1d28065">ntlGeometryObject::sceneAddTriangle</a>(
<a name="l00229"></a>00229         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>  p1,<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>  p2,<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>  p3,
<a name="l00230"></a>00230         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pn1,<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pn2,<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pn3,
<a name="l00231"></a>00231         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> trin, <span class="keywordtype">bool</span> <a class="code" href="../../d2/df6/sculpt_8c.html#a11919b8f48badb89cbb5b795722c22e3">smooth</a>,
<a name="l00232"></a>00232         vector&lt;ntlTriangle&gt; *triangles,
<a name="l00233"></a>00233         vector&lt;ntlVec3Gfx&gt;  *<a class="code" href="../../d9/d0b/structvertices.html">vertices</a>,
<a name="l00234"></a>00234         vector&lt;ntlVec3Gfx&gt;  *normals) {
<a name="l00235"></a>00235     <a class="code" href="../../d8/da3/classntlTriangle.html">ntlTriangle</a> tri;
<a name="l00236"></a>00236     <span class="keywordtype">int</span> tempVert;
<a name="l00237"></a>00237   
<a name="l00238"></a>00238     <span class="keywordflow">if</span>(normals-&gt;size() != vertices-&gt;size()) {
<a name="l00239"></a>00239         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;ntlGeometryObject::sceneAddTriangle&quot;</span>,<span class="stringliteral">&quot;For &#39;&quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ac9e7557154ccdacd21e86c58c660b866">mName</a>&lt;&lt;<span class="stringliteral">&quot;&#39;: Vertices and normals sizes to not match!!!&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#af2f6eab59be57681799dbee88ff4c4a7">SIMWORLD_GENERICERROR</a>);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     } <span class="keywordflow">else</span> {
<a name="l00242"></a>00242         
<a name="l00243"></a>00243         vertices-&gt;push_back( p1 ); 
<a name="l00244"></a>00244         normals-&gt;push_back( pn1 ); 
<a name="l00245"></a>00245         tempVert = normals-&gt;size()-1;
<a name="l00246"></a>00246         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[0] = tempVert;
<a name="l00247"></a>00247         
<a name="l00248"></a>00248         vertices-&gt;push_back( p2 ); 
<a name="l00249"></a>00249         normals-&gt;push_back( pn2 ); 
<a name="l00250"></a>00250         tempVert = normals-&gt;size()-1;
<a name="l00251"></a>00251         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[1] = tempVert;
<a name="l00252"></a>00252         
<a name="l00253"></a>00253         vertices-&gt;push_back( p3 ); 
<a name="l00254"></a>00254         normals-&gt;push_back( pn3 ); 
<a name="l00255"></a>00255         tempVert = normals-&gt;size()-1;
<a name="l00256"></a>00256         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[2] = tempVert;
<a name="l00257"></a>00257         
<a name="l00258"></a>00258         
<a name="l00259"></a>00259         <span class="comment">/* init flags from ntl_ray.h */</span>
<a name="l00260"></a>00260         <span class="keywordtype">int</span> flag = 0; 
<a name="l00261"></a>00261         <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ad0558ea884fc049a12e55dc8643da897">getVisible</a>()){ flag |= <a class="code" href="../../dc/dbe/ntl__ray_8h.html#ad16aabe4ad275186120f5fc48f7fe7a5">TRI_GEOMETRY</a>; }
<a name="l00262"></a>00262         <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a7f43f465f89561369e1ed4a8459e3a1b">getCastShadows</a>() ) { 
<a name="l00263"></a>00263             flag |= <a class="code" href="../../dc/dbe/ntl__ray_8h.html#a47d545c4e62e276cf957df78efb0b822">TRI_CASTSHADOWS</a>; } 
<a name="l00264"></a>00264         
<a name="l00265"></a>00265         <span class="comment">/* init geo init id */</span>
<a name="l00266"></a>00266         <span class="keywordtype">int</span> geoiId = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a4ce21e1f1ec7dcb750f4bc1dd3e87d55">getGeoInitId</a>(); 
<a name="l00267"></a>00267         <span class="comment">//if((geoiId &gt; 0) &amp;&amp; (mVolumeInit&amp;VOLUMEINIT_VOLUME) &amp;&amp; (!mIsAnimated)) { </span>
<a name="l00268"></a>00268         <span class="keywordflow">if</span>((geoiId &gt; 0) &amp;&amp; (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a>&amp;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>)) { 
<a name="l00269"></a>00269             flag |= (1&lt;&lt; (geoiId+4)); 
<a name="l00270"></a>00270             flag |= <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a>; 
<a name="l00271"></a>00271         } 
<a name="l00272"></a>00272         <span class="comment">/*errMsg(&quot;ntlScene::addTriangle&quot;,&quot;DEBUG flag=&quot;&lt;&lt;convertFlags2String(flag) ); */</span> 
<a name="l00273"></a>00273         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a41f0bc7e01db34a34138a15edbef7bc2">setFlags</a>( flag );
<a name="l00274"></a>00274         
<a name="l00275"></a>00275         <span class="comment">/* triangle normal missing */</span>
<a name="l00276"></a>00276         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a4b55cba00cdf885e77683568a66f3138">setNormal</a>( trin );
<a name="l00277"></a>00277         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#ae4184c63599c43500d7c296c1573d03a">setSmoothNormals</a>( smooth );
<a name="l00278"></a>00278         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#ab463e8c2a589e49ed46a92031652ea9b">setObjectId</a>( this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aee1fd9e7472b16961490c14fc3ee1c11">mObjectId</a> );
<a name="l00279"></a>00279         triangles-&gt;push_back( tri ); 
<a name="l00280"></a>00280     } <span class="comment">/* normals check*/</span> 
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#aa59d7b2cefa21d8d49e35cf3e6c752a7">00283</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#aa59d7b2cefa21d8d49e35cf3e6c752a7">ntlGeometryObject::sceneAddTriangleNoVert</a>(<span class="keywordtype">int</span> *trips,
<a name="l00284"></a>00284         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> trin, <span class="keywordtype">bool</span> <a class="code" href="../../d2/df6/sculpt_8c.html#a11919b8f48badb89cbb5b795722c22e3">smooth</a>,
<a name="l00285"></a>00285         vector&lt;ntlTriangle&gt; *triangles) {
<a name="l00286"></a>00286     <a class="code" href="../../d8/da3/classntlTriangle.html">ntlTriangle</a> tri;
<a name="l00287"></a>00287         
<a name="l00288"></a>00288     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[0] = trips[0];
<a name="l00289"></a>00289     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[1] = trips[1];
<a name="l00290"></a>00290     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[2] = trips[2];
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">// same as normal sceneAddTriangle</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">/* init flags from ntl_ray.h */</span>
<a name="l00295"></a>00295     <span class="keywordtype">int</span> flag = 0; 
<a name="l00296"></a>00296     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ad0558ea884fc049a12e55dc8643da897">getVisible</a>()){ flag |= <a class="code" href="../../dc/dbe/ntl__ray_8h.html#ad16aabe4ad275186120f5fc48f7fe7a5">TRI_GEOMETRY</a>; }
<a name="l00297"></a>00297     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a7f43f465f89561369e1ed4a8459e3a1b">getCastShadows</a>() ) { 
<a name="l00298"></a>00298         flag |= <a class="code" href="../../dc/dbe/ntl__ray_8h.html#a47d545c4e62e276cf957df78efb0b822">TRI_CASTSHADOWS</a>; } 
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">/* init geo init id */</span>
<a name="l00301"></a>00301     <span class="keywordtype">int</span> geoiId = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a4ce21e1f1ec7dcb750f4bc1dd3e87d55">getGeoInitId</a>(); 
<a name="l00302"></a>00302     <span class="keywordflow">if</span>((geoiId &gt; 0) &amp;&amp; (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a8eb595f512f93ca63666f84e185e2e25">mVolumeInit</a>&amp;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>)) { 
<a name="l00303"></a>00303         flag |= (1&lt;&lt; (geoiId+4)); 
<a name="l00304"></a>00304         flag |= <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a>; 
<a name="l00305"></a>00305     } 
<a name="l00306"></a>00306     <span class="comment">/*errMsg(&quot;ntlScene::addTriangle&quot;,&quot;DEBUG flag=&quot;&lt;&lt;convertFlags2String(flag) ); */</span> 
<a name="l00307"></a>00307     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a41f0bc7e01db34a34138a15edbef7bc2">setFlags</a>( flag );
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">/* triangle normal missing */</span>
<a name="l00310"></a>00310     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a4b55cba00cdf885e77683568a66f3138">setNormal</a>( trin );
<a name="l00311"></a>00311     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#ae4184c63599c43500d7c296c1573d03a">setSmoothNormals</a>( smooth );
<a name="l00312"></a>00312     tri.<a class="code" href="../../d8/da3/classntlTriangle.html#ab463e8c2a589e49ed46a92031652ea9b">setObjectId</a>( this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aee1fd9e7472b16961490c14fc3ee1c11">mObjectId</a> );
<a name="l00313"></a>00313     triangles-&gt;push_back( tri ); 
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="comment">/******************************************************************************/</span>
<a name="l00318"></a>00318 <span class="comment">/* Init channels from float arrays (for elbeem API) */</span>
<a name="l00319"></a>00319 <span class="comment">/******************************************************************************/</span>
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#afaf658f798b01c4c4cce407a3a9774bf">00321</a> <span class="preprocessor">#define ADD_CHANNEL_VEC(dst,nvals,val) \</span>
<a name="l00322"></a>00322 <span class="preprocessor">        vals.clear(); time.clear(); elbeemSimplifyChannelVec3(val,&amp;nvals); \</span>
<a name="l00323"></a>00323 <span class="preprocessor">        for(int i=0; i&lt;(nvals); i++) { \</span>
<a name="l00324"></a>00324 <span class="preprocessor">            vals.push_back(ntlVec3Gfx((val)[i*4+0], (val)[i*4+1],(val)[i*4+2] )); \</span>
<a name="l00325"></a>00325 <span class="preprocessor">            time.push_back( (val)[i*4+3] ); \</span>
<a name="l00326"></a>00326 <span class="preprocessor">        } \</span>
<a name="l00327"></a>00327 <span class="preprocessor">        (dst) = AnimChannel&lt; ntlVec3Gfx &gt;(vals,time); </span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>
<a name="l00329"></a><a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae20d1e58cbd3a5fd5d0d42d824ee18b0">00329</a> <span class="preprocessor">#define ADD_CHANNEL_FLOAT(dst,nvals,val) \</span>
<a name="l00330"></a>00330 <span class="preprocessor">        valsfloat.clear(); time.clear(); elbeemSimplifyChannelFloat(val,&amp;nvals); \</span>
<a name="l00331"></a>00331 <span class="preprocessor">        for(int i=0; i&lt;(nvals); i++) { \</span>
<a name="l00332"></a>00332 <span class="preprocessor">            valsfloat.push_back( (val)[i*2+0] ); \</span>
<a name="l00333"></a>00333 <span class="preprocessor">            time.push_back( (val)[i*2+1] ); \</span>
<a name="l00334"></a>00334 <span class="preprocessor">        } \</span>
<a name="l00335"></a>00335 <span class="preprocessor">        (dst) = AnimChannel&lt; float &gt;(valsfloat,time); </span>
<a name="l00336"></a>00336 <span class="preprocessor"></span>
<a name="l00337"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a31afe4ffe0cdfb9196e442ad7f734b11">00337</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a31afe4ffe0cdfb9196e442ad7f734b11">ntlGeometryObject::initChannels</a>(
<a name="l00338"></a>00338         <span class="keywordtype">int</span> nTrans, <span class="keywordtype">float</span> *trans, <span class="keywordtype">int</span> nRot, <span class="keywordtype">float</span> *rot, <span class="keywordtype">int</span> nScale, <span class="keywordtype">float</span> *scale,
<a name="l00339"></a>00339         <span class="keywordtype">int</span> nAct, <span class="keywordtype">float</span> *act, <span class="keywordtype">int</span> nIvel, <span class="keywordtype">float</span> *ivel,
<a name="l00340"></a>00340         <span class="keywordtype">int</span> nAttrFStr, <span class="keywordtype">float</span> *attrFStr,
<a name="l00341"></a>00341         <span class="keywordtype">int</span> nAttrFRad, <span class="keywordtype">float</span> *attrFRad,
<a name="l00342"></a>00342         <span class="keywordtype">int</span> nVelFStr, <span class="keywordtype">float</span> *velFStr,
<a name="l00343"></a>00343         <span class="keywordtype">int</span> nVelFRad, <span class="keywordtype">float</span> *velFRad
<a name="l00344"></a>00344         ) {
<a name="l00345"></a>00345     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugInitc=<span class="keyword">true</span>;
<a name="l00346"></a>00346     <span class="keywordflow">if</span>(debugInitc) { <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initChannels&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;nt:&quot;</span>&lt;&lt;nTrans&lt;&lt;<span class="stringliteral">&quot; nr:&quot;</span>&lt;&lt;nRot&lt;&lt;<span class="stringliteral">&quot; ns:&quot;</span>&lt;&lt;nScale, 10); 
<a name="l00347"></a>00347                      <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initChannels&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;na:&quot;</span>&lt;&lt;nAct&lt;&lt;<span class="stringliteral">&quot; niv:&quot;</span>&lt;&lt;nIvel&lt;&lt;<span class="stringliteral">&quot; &quot;</span>, 10); }
<a name="l00348"></a>00348     vector&lt;ntlVec3Gfx&gt; vals;
<a name="l00349"></a>00349     vector&lt;float&gt;  valsfloat;
<a name="l00350"></a>00350     vector&lt;double&gt; time;
<a name="l00351"></a>00351     <span class="keywordflow">if</span>((trans)&amp;&amp;(nTrans&gt;0)) {  <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#afaf658f798b01c4c4cce407a3a9774bf">ADD_CHANNEL_VEC</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>, nTrans, trans); }
<a name="l00352"></a>00352     <span class="keywordflow">if</span>((rot)&amp;&amp;(nRot&gt;0)) {      <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#afaf658f798b01c4c4cce407a3a9774bf">ADD_CHANNEL_VEC</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>, nRot, rot); }
<a name="l00353"></a>00353     <span class="keywordflow">if</span>((scale)&amp;&amp;(nScale&gt;0)) {  <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#afaf658f798b01c4c4cce407a3a9774bf">ADD_CHANNEL_VEC</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>, nScale, scale); }
<a name="l00354"></a>00354     <span class="keywordflow">if</span>((act)&amp;&amp;(nAct&gt;0)) {      <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae20d1e58cbd3a5fd5d0d42d824ee18b0">ADD_CHANNEL_FLOAT</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>, nAct, act); }
<a name="l00355"></a>00355     <span class="keywordflow">if</span>((ivel)&amp;&amp;(nIvel&gt;0)) {    <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#afaf658f798b01c4c4cce407a3a9774bf">ADD_CHANNEL_VEC</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>, nIvel, ivel); }
<a name="l00356"></a>00356     
<a name="l00357"></a>00357     <span class="comment">/* fluid control channels */</span>
<a name="l00358"></a>00358     <span class="keywordflow">if</span>((attrFStr)&amp;&amp;(nAttrFStr&gt;0)) { <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae20d1e58cbd3a5fd5d0d42d824ee18b0">ADD_CHANNEL_FLOAT</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#aef9df038eebdfb6fd3648de74939dbcc">mcAttrFStr</a>, nAttrFStr, attrFStr); }
<a name="l00359"></a>00359     <span class="keywordflow">if</span>((attrFRad)&amp;&amp;(nAttrFRad&gt;0)) { <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae20d1e58cbd3a5fd5d0d42d824ee18b0">ADD_CHANNEL_FLOAT</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28cba2c36ef472f5212195da19f0c932">mcAttrFRad</a>, nAttrFRad, attrFRad); }
<a name="l00360"></a>00360     <span class="keywordflow">if</span>((velFStr)&amp;&amp;(nVelFStr&gt;0)) {   <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae20d1e58cbd3a5fd5d0d42d824ee18b0">ADD_CHANNEL_FLOAT</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ad8db13fefd1036cadd7d88042d0bb03a">mcVelFStr</a>, nAct, velFStr); }
<a name="l00361"></a>00361     <span class="keywordflow">if</span>((velFRad)&amp;&amp;(nVelFRad&gt;0)) {   <a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ae20d1e58cbd3a5fd5d0d42d824ee18b0">ADD_CHANNEL_FLOAT</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab0463a311ac2c26a1105e41871365808">mcVelFRad</a>, nVelFRad, velFRad); }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a0b927bfc8a888b7e1a87f75c7c793280">checkIsAnimated</a>();
<a name="l00364"></a>00364     
<a name="l00365"></a>00365     <span class="keywordflow">if</span>(debugInitc) { 
<a name="l00366"></a>00366         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initChannels&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;
<a name="l00367"></a>00367                 <span class="stringliteral">&quot; nt:&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&lt;&lt;<span class="stringliteral">&quot; nr:&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&lt;&lt;
<a name="l00368"></a>00368                 <span class="stringliteral">&quot; ns:&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&lt;&lt;<span class="stringliteral">&quot; isAnim:&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a88e7f679c571b9eaf92b132cfb331beb">mIsAnimated</a>, 10); }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="keywordflow">if</span>(debugInitc) {
<a name="l00371"></a>00371         std::ostringstream ostr;
<a name="l00372"></a>00372         ostr &lt;&lt; <span class="stringliteral">&quot;trans: &quot;</span>;
<a name="l00373"></a>00373         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00374"></a>00374             ostr&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot;@&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a3b7559c4efa1db22af2663825933b62e" title="raw access of time vector">accessTimes</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00375"></a>00375         } ostr&lt;&lt;<span class="stringliteral">&quot;;   &quot;</span>;
<a name="l00376"></a>00376         ostr&lt;&lt;<span class="stringliteral">&quot;rot: &quot;</span>;
<a name="l00377"></a>00377         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00378"></a>00378             ostr&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot;@&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a3b7559c4efa1db22af2663825933b62e" title="raw access of time vector">accessTimes</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00379"></a>00379         } ostr&lt;&lt;<span class="stringliteral">&quot;;   &quot;</span>;
<a name="l00380"></a>00380         ostr&lt;&lt;<span class="stringliteral">&quot;scale: &quot;</span>;
<a name="l00381"></a>00381         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00382"></a>00382             ostr&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot;@&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a3b7559c4efa1db22af2663825933b62e" title="raw access of time vector">accessTimes</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00383"></a>00383         } ostr&lt;&lt;<span class="stringliteral">&quot;;   &quot;</span>;
<a name="l00384"></a>00384         ostr&lt;&lt;<span class="stringliteral">&quot;act: &quot;</span>;
<a name="l00385"></a>00385         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00386"></a>00386             ostr&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot;@&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a3b7559c4efa1db22af2663825933b62e" title="raw access of time vector">accessTimes</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00387"></a>00387         } ostr&lt;&lt;<span class="stringliteral">&quot;;   &quot;</span>;
<a name="l00388"></a>00388         ostr&lt;&lt;<span class="stringliteral">&quot;ivel: &quot;</span>;
<a name="l00389"></a>00389         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00390"></a>00390             ostr&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot;@&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a3b7559c4efa1db22af2663825933b62e" title="raw access of time vector">accessTimes</a>()[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>;
<a name="l00391"></a>00391         } ostr&lt;&lt;<span class="stringliteral">&quot;;   &quot;</span>;
<a name="l00392"></a>00392         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initChannels&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Inited &quot;</span>&lt;&lt;ostr.str(),10);
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 <span class="preprocessor">#undef ADD_CHANNEL</span>
<a name="l00396"></a>00396 <span class="preprocessor"></span>
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="comment">/*****************************************************************************/</span>
<a name="l00399"></a>00399 <span class="comment">/* apply object translation at time t*/</span>
<a name="l00400"></a>00400 <span class="comment">/*****************************************************************************/</span>
<a name="l00401"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">00401</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">ntlGeometryObject::applyTransformation</a>(<span class="keywordtype">double</span> t, vector&lt;ntlVec3Gfx&gt; *verts, vector&lt;ntlVec3Gfx&gt; *norms, <span class="keywordtype">int</span> vstart, <span class="keywordtype">int</span> vend, <span class="keywordtype">int</span> forceTrafo) {
<a name="l00402"></a>00402     <span class="keywordflow">if</span>(    (<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1)  <span class="comment">// VALIDATE</span>
<a name="l00403"></a>00403         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00404"></a>00404         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00405"></a>00405         || (forceTrafo)
<a name="l00406"></a>00406         || (!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a5fc7c7bbb9dca55a2aba3a031bda6a7c">mHaveCachedMov</a>)
<a name="l00407"></a>00407         ) {
<a name="l00408"></a>00408         <span class="comment">// transformation is animated, continue</span>
<a name="l00409"></a>00409         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pos = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a02d8e9a80f8d7e324d59b4bd48046778">getTranslation</a>(t); 
<a name="l00410"></a>00410         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> scale = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t);
<a name="l00411"></a>00411         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../df/d5a/svm__noise_8h.html#aae44e21ada356d9d84450d5440fbb0c4">rot</a> = <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t);
<a name="l00412"></a>00412         <a class="code" href="../../d3/d61/classntlMatrix4x4.html">ntlMat4Gfx</a> rotMat;
<a name="l00413"></a>00413         rotMat.<a class="code" href="../../d3/d61/classntlMatrix4x4.html#ade3c1a6b97facdf6ecd22df68cda9b27">initRotationXYZ</a>(rot[0],rot[1],rot[2]);
<a name="l00414"></a>00414         pos += <a class="code" href="../../df/dc9/classntlGeometryObject.html#ac6df42dc9ce34b1d7b178bd4a23f5ae6">mInitialPos</a>;
<a name="l00415"></a>00415         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::applyTransformation&quot;</span>,<span class="stringliteral">&quot;obj=&quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; t&quot;</span>&lt;&lt;pos&lt;&lt;<span class="stringliteral">&quot; r&quot;</span>&lt;&lt;rot&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;scale);
<a name="l00416"></a>00416         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=vstart; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;vend; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00417"></a>00417             (*verts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] *= scale;
<a name="l00418"></a>00418             (*verts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = rotMat * (*verts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00419"></a>00419             (*verts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] += pos;
<a name="l00420"></a>00420             <span class="comment">//if(i&lt;10) errMsg(&quot;ntlGeometryObject::applyTransformation&quot;,&quot; v&quot;&lt;&lt;i&lt;&lt;&quot;/&quot;&lt;&lt;vend&lt;&lt;&quot;=&quot;&lt;&lt;(*verts)[i]);</span>
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422         <span class="keywordflow">if</span>(norms) {
<a name="l00423"></a>00423             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=vstart; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;vend; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00424"></a>00424                 (*norms)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = rotMat * (*norms)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00425"></a>00425             }
<a name="l00426"></a>00426         }
<a name="l00427"></a>00427     } <span class="keywordflow">else</span> {
<a name="l00428"></a>00428         <span class="comment">// not animated, cached points were already returned</span>
<a name="l00429"></a>00429         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a> (<span class="stringliteral">&quot;ntlGeometryObject::applyTransformation&quot;</span>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; used cached points &quot;</span>);
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00434"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a99cee89ef1449fbefdb99d0d98305b8f">00434</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a99cee89ef1449fbefdb99d0d98305b8f">ntlGeometryObject::calcTriangleDivs</a>(vector&lt;ntlVec3Gfx&gt; &amp;verts, vector&lt;ntlTriangle&gt; &amp;tris, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> fsTri) {
<a name="l00435"></a>00435     <a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>.resize( tris.size() );
<a name="l00436"></a>00436     <a class="code" href="../../df/dc9/classntlGeometryObject.html#abebecc8ea1335989ee34eda73c455142">mTriangleDivs2</a>.resize( tris.size() );
<a name="l00437"></a>00437     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a27e52274e896b546fe1018967ce3248b">mTriangleDivs3</a>.resize( tris.size() );
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <span class="comment">//fsTri *= 2.; // DEBUG! , wrong init!</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;tris.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00442"></a>00442         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p0 = verts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[0] ];
<a name="l00443"></a>00443         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p1 = verts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[1] ];
<a name="l00444"></a>00444         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p2 = verts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[2] ];
<a name="l00445"></a>00445         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side1 = p1 - p0;
<a name="l00446"></a>00446         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side2 = p2 - p0;
<a name="l00447"></a>00447         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side3 = p1 - p2;
<a name="l00448"></a>00448         <span class="keywordtype">int</span> divs1=0, divs2=0, divs3=0;
<a name="l00449"></a>00449         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(side1) &gt; fsTri*fsTri) { divs1 = (int)(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(side1)/fsTri); }
<a name="l00450"></a>00450         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(side2) &gt; fsTri*fsTri) { divs2 = (int)(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(side2)/fsTri); }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452         <a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = divs1;
<a name="l00453"></a>00453         <a class="code" href="../../df/dc9/classntlGeometryObject.html#abebecc8ea1335989ee34eda73c455142">mTriangleDivs2</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = divs2;
<a name="l00454"></a>00454         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a27e52274e896b546fe1018967ce3248b">mTriangleDivs3</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = divs3;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00459"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a05010070584e1d1a5c5cebc5791b3c26">00459</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a05010070584e1d1a5c5cebc5791b3c26">ntlGeometryObject::initMovingPoints</a>(<span class="keywordtype">double</span> time, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> featureSize) {
<a name="l00460"></a>00460     <span class="keywordflow">if</span>((<a class="code" href="../../df/dc9/classntlGeometryObject.html#a4408bb1122638fe487f72247fb91804a">mMovPntsInited</a>==featureSize)&amp;&amp;(!<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">getMeshAnimated</a>())) <span class="keywordflow">return</span>;
<a name="l00461"></a>00461     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugMoinit=<span class="keyword">false</span>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     vector&lt;ntlTriangle&gt; triangles; 
<a name="l00464"></a>00464     vector&lt;ntlVec3Gfx&gt; <a class="code" href="../../d9/d0b/structvertices.html">vertices</a>; 
<a name="l00465"></a>00465     vector&lt;ntlVec3Gfx&gt; vnormals; 
<a name="l00466"></a>00466     <span class="keywordtype">int</span> objectId = 1;
<a name="l00467"></a>00467     this-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a44d0c43347720a6bf14bece2f39a4ec3">getTriangles</a>(time, &amp;triangles,&amp;vertices,&amp;vnormals,objectId);
<a name="l00468"></a>00468     
<a name="l00469"></a>00469     <a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>.clear();
<a name="l00470"></a>00470     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a80b6351b32676058dc672eff046657df">mMovNormals</a>.clear();
<a name="l00471"></a>00471     <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPoints&quot;</span>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; has v:&quot;</span>&lt;&lt;vertices.size()&lt;&lt;<span class="stringliteral">&quot; t:&quot;</span>&lt;&lt;triangles.size() );
<a name="l00472"></a>00472     <span class="comment">// no points?</span>
<a name="l00473"></a>00473     <span class="keywordflow">if</span>(vertices.size()&lt;1) {
<a name="l00474"></a>00474         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a6a8b643cb201e977f62627ffc564d8f4">mMaxMovPnt</a>=-1;
<a name="l00475"></a>00475         <span class="keywordflow">return</span>; 
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3f</a> maxscale = <a class="code" href="../../da/d97/attributes_8cpp.html#a74d766d922e27c367c60c2a765b9cd35">channelFindMaxVf</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>);
<a name="l00478"></a>00478     <span class="keywordtype">float</span> maxpart = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[0]);
<a name="l00479"></a>00479     <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[1])&gt;maxpart) maxpart = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[1]);
<a name="l00480"></a>00480     <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[2])&gt;maxpart) maxpart = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[2]);
<a name="l00481"></a>00481     <span class="keywordtype">float</span> scaleFac = 1.0/(maxpart);
<a name="l00482"></a>00482     <span class="comment">// TODO - better reinit from time to time?</span>
<a name="l00483"></a>00483     <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> fsTri = featureSize*0.5 *scaleFac;
<a name="l00484"></a>00484     <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPoints&quot;</span>,<span class="stringliteral">&quot;maxscale:&quot;</span>&lt;&lt;maxpart&lt;&lt;<span class="stringliteral">&quot; featureSize:&quot;</span>&lt;&lt;featureSize&lt;&lt;<span class="stringliteral">&quot; fsTri:&quot;</span>&lt;&lt;fsTri );
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>.size()!=triangles.size()) {
<a name="l00487"></a>00487         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a99cee89ef1449fbefdb99d0d98305b8f">calcTriangleDivs</a>(vertices,triangles,fsTri);
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="comment">// debug: count points to init</span>
<a name="l00491"></a>00491     <span class="comment">/*if(debugMoinit) {</span>
<a name="l00492"></a>00492 <span class="comment">        errMsg(&quot;ntlGeometryObject::initMovingPoints&quot;,&quot;Object &quot;&lt;&lt;getName()&lt;&lt;&quot; estimating...&quot;);</span>
<a name="l00493"></a>00493 <span class="comment">        int countp=vertices.size()*2;</span>
<a name="l00494"></a>00494 <span class="comment">        for(size_t i=0; i&lt;triangles.size(); i++) {</span>
<a name="l00495"></a>00495 <span class="comment">            ntlVec3Gfx p0 = vertices[ triangles[i].getPoints()[0] ];</span>
<a name="l00496"></a>00496 <span class="comment">            ntlVec3Gfx side1 = vertices[ triangles[i].getPoints()[1] ] - p0;</span>
<a name="l00497"></a>00497 <span class="comment">            ntlVec3Gfx side2 = vertices[ triangles[i].getPoints()[2] ] - p0;</span>
<a name="l00498"></a>00498 <span class="comment">            int divs1=0, divs2=0;</span>
<a name="l00499"></a>00499 <span class="comment">            if(normNoSqrt(side1) &gt; fsTri*fsTri) { divs1 = (int)(norm(side1)/fsTri); }</span>
<a name="l00500"></a>00500 <span class="comment">            if(normNoSqrt(side2) &gt; fsTri*fsTri) { divs2 = (int)(norm(side2)/fsTri); }</span>
<a name="l00501"></a>00501 <span class="comment">            errMsg(&quot;ntlGeometryObject::initMovingPoints&quot;,&quot;tri:&quot;&lt;&lt;i&lt;&lt;&quot; p:&quot;&lt;&lt;p0&lt;&lt;&quot; s1:&quot;&lt;&lt;side1&lt;&lt;&quot; s2:&quot;&lt;&lt;side2&lt;&lt;&quot; -&gt; &quot;&lt;&lt;divs1&lt;&lt;&quot;,&quot;&lt;&lt;divs2 );</span>
<a name="l00502"></a>00502 <span class="comment">            if(divs1+divs2 &gt; 0) {</span>
<a name="l00503"></a>00503 <span class="comment">                for(int u=0; u&lt;=divs1; u++) {</span>
<a name="l00504"></a>00504 <span class="comment">                    for(int v=0; v&lt;=divs2; v++) {</span>
<a name="l00505"></a>00505 <span class="comment">                        const gfxReal uf = (gfxReal)(u+TRI_UVOFFSET) / (gfxReal)(divs1+0.0);</span>
<a name="l00506"></a>00506 <span class="comment">                        const gfxReal vf = (gfxReal)(v+TRI_UVOFFSET) / (gfxReal)(divs2+0.0);</span>
<a name="l00507"></a>00507 <span class="comment">                        if(uf+vf&gt;1.0) continue;</span>
<a name="l00508"></a>00508 <span class="comment">                        countp+=2;</span>
<a name="l00509"></a>00509 <span class="comment">                    }</span>
<a name="l00510"></a>00510 <span class="comment">                }</span>
<a name="l00511"></a>00511 <span class="comment">            }</span>
<a name="l00512"></a>00512 <span class="comment">        }</span>
<a name="l00513"></a>00513 <span class="comment">        errMsg(&quot;ntlGeometryObject::initMovingPoints&quot;,&quot;Object &quot;&lt;&lt;getName()&lt;&lt;&quot; requires:&quot;&lt;&lt;countp*2);</span>
<a name="l00514"></a>00514 <span class="comment">    } // */</span>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="keywordtype">bool</span> discardInflowBack = <span class="keyword">false</span>;
<a name="l00517"></a>00517     <span class="keywordflow">if</span>( (<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a>==<a class="code" href="../../d8/d00/elbeem_8h.html#a981c60c9f2725cfc951630cf070fc646">FGI_MBNDINFLOW</a>) &amp;&amp; (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&lt;1) ) discardInflowBack = <span class="keyword">true</span>;
<a name="l00518"></a>00518     discardInflowBack = <span class="keyword">false</span>; <span class="comment">// DEBUG disable for now</span>
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="comment">// init std points</span>
<a name="l00522"></a>00522     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;vertices.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00523"></a>00523         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = vertices[ <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> ];
<a name="l00524"></a>00524         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> n = vnormals[ <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> ];
<a name="l00525"></a>00525         <span class="comment">// discard inflow backsides</span>
<a name="l00526"></a>00526         <span class="comment">//if( (mGeoInitType==FGI_MBNDINFLOW) &amp;&amp; (!mIsAnimated)) {</span>
<a name="l00527"></a>00527         <span class="keywordflow">if</span>(discardInflowBack) { <span class="comment">//if( (mGeoInitType==FGI_MBNDINFLOW) &amp;&amp; (!mIsAnimated)) {</span>
<a name="l00528"></a>00528             <span class="keywordflow">if</span>(<a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>,n)&lt;0.0) <span class="keywordflow">continue</span>;
<a name="l00529"></a>00529         }
<a name="l00530"></a>00530         <a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>.push_back(p);
<a name="l00531"></a>00531         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a80b6351b32676058dc672eff046657df">mMovNormals</a>.push_back(n);
<a name="l00532"></a>00532         <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPoints&quot;</span>,<span class="stringliteral">&quot;std&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; p&quot;</span>&lt;&lt;p&lt;&lt;<span class="stringliteral">&quot; n&quot;</span>&lt;&lt;n&lt;&lt;<span class="stringliteral">&quot; &quot;</span>);
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534     <span class="comment">// init points &amp; refine...</span>
<a name="l00535"></a>00535     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;triangles.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00536"></a>00536         <span class="keywordtype">int</span> *trips = triangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints();
<a name="l00537"></a>00537         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p0 = vertices[ trips[0] ];
<a name="l00538"></a>00538         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side1 = vertices[ trips[1] ] - p0;
<a name="l00539"></a>00539         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side2 = vertices[ trips[2] ] - p0;
<a name="l00540"></a>00540         <span class="keywordtype">int</span> divs1=<a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>], divs2=<a class="code" href="../../df/dc9/classntlGeometryObject.html#abebecc8ea1335989ee34eda73c455142">mTriangleDivs2</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00541"></a>00541         
<a name="l00542"></a>00542         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> trinormOrg = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ac43d14a1c6daaaff84ddd054b5c4db7d">getNormalized</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>(side1,side2));
<a name="l00543"></a>00543         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> trinorm = trinormOrg*0.25*featureSize;
<a name="l00544"></a>00544         <span class="keywordflow">if</span>(discardInflowBack) { 
<a name="l00545"></a>00545             <span class="keywordflow">if</span>(<a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>,trinorm)&lt;0.0) <span class="keywordflow">continue</span>;
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547         <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPoints&quot;</span>,<span class="stringliteral">&quot;Tri1 &quot;</span>&lt;&lt;vertices[trips[0]]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;vertices[trips[1]]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;vertices[trips[2]]&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;divs1&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;divs2 );
<a name="l00548"></a>00548         <span class="keywordflow">if</span>(divs1+divs2 &gt; 0) {
<a name="l00549"></a>00549             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> u=0; u&lt;=divs1; u++) {
<a name="l00550"></a>00550                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0; v&lt;=divs2; v++) {
<a name="l00551"></a>00551                     <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> uf = (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(u+<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ad9d5079f80e065340a06997423445f7f">TRI_UVOFFSET</a>) / (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(divs1+0.0);
<a name="l00552"></a>00552                     <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> vf = (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(v+<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ad9d5079f80e065340a06997423445f7f">TRI_UVOFFSET</a>) / (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(divs2+0.0);
<a name="l00553"></a>00553                     <span class="keywordflow">if</span>(uf+vf&gt;1.0) <span class="keywordflow">continue</span>;
<a name="l00554"></a>00554                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = 
<a name="l00555"></a>00555                         vertices[ trips[0] ] * (1.0-uf-vf)+
<a name="l00556"></a>00556                         vertices[ trips[1] ] * uf +
<a name="l00557"></a>00557                         vertices[ trips[2] ] * vf;
<a name="l00558"></a>00558                     <span class="comment">//ntlVec3Gfx n = vnormals[ </span>
<a name="l00559"></a>00559                         <span class="comment">//trips[0] ] * (1.0-uf-vf)+</span>
<a name="l00560"></a>00560                         <span class="comment">//vnormals[ trips[1] ]*uf +</span>
<a name="l00561"></a>00561                         <span class="comment">//vnormals[ trips[2] ]*vf;</span>
<a name="l00562"></a>00562                     <span class="comment">//normalize(n);</span>
<a name="l00563"></a>00563                     <span class="comment">// discard inflow backsides</span>
<a name="l00564"></a>00564 
<a name="l00565"></a>00565                     <a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>.push_back(p + trinorm); <span class="comment">// NEW!?</span>
<a name="l00566"></a>00566                     <a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>.push_back(p - trinorm);
<a name="l00567"></a>00567                     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a80b6351b32676058dc672eff046657df">mMovNormals</a>.push_back(trinormOrg);
<a name="l00568"></a>00568                     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a80b6351b32676058dc672eff046657df">mMovNormals</a>.push_back(trinormOrg); 
<a name="l00569"></a>00569                     <span class="comment">//errMsg(&quot;TRINORM&quot;,&quot;p&quot;&lt;&lt;p&lt;&lt;&quot; n&quot;&lt;&lt;n&lt;&lt;&quot; trin&quot;&lt;&lt;trinorm);</span>
<a name="l00570"></a>00570                 }
<a name="l00571"></a>00571             }
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <span class="comment">// find max point</span>
<a name="l00576"></a>00576     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a6a8b643cb201e977f62627ffc564d8f4">mMaxMovPnt</a> = 0;
<a name="l00577"></a>00577     <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> dist = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>[0]);
<a name="l00578"></a>00578     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00579"></a>00579         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])&gt;dist) {
<a name="l00580"></a>00580             <a class="code" href="../../df/dc9/classntlGeometryObject.html#a6a8b643cb201e977f62627ffc564d8f4">mMaxMovPnt</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00581"></a>00581             dist = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>[0]);
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordflow">if</span>(    (this-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae5bc326fd5c373ab43982e90b2149718">getMeshAnimated</a>())
<a name="l00586"></a>00586       || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1)  <span class="comment">// VALIDATE</span>
<a name="l00587"></a>00587         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00588"></a>00588         || (<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;1) 
<a name="l00589"></a>00589         ) {
<a name="l00590"></a>00590         <span class="comment">// also do trafo...</span>
<a name="l00591"></a>00591     } <span class="keywordflow">else</span> {
<a name="l00592"></a>00592         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a925dcd247a3d55e43255d3a8545e0af7">mCachedMovPoints</a> = <a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>;
<a name="l00593"></a>00593         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a64b5696926d25fe4953761d28234ba1e">mCachedMovNormals</a> = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a80b6351b32676058dc672eff046657df">mMovNormals</a>;
<a name="l00594"></a>00594         <span class="comment">//applyTransformation(time, &amp;mCachedMovPoints, &amp;mCachedMovNormals, 0, mCachedMovPoints.size(), true);</span>
<a name="l00595"></a>00595         <a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(time, &amp;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a925dcd247a3d55e43255d3a8545e0af7">mCachedMovPoints</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dc9/classntlGeometryObject.html#a925dcd247a3d55e43255d3a8545e0af7">mCachedMovPoints</a>.size(), <span class="keyword">true</span>);
<a name="l00596"></a>00596         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a5fc7c7bbb9dca55a2aba3a031bda6a7c">mHaveCachedMov</a> = <span class="keyword">true</span>;
<a name="l00597"></a>00597         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPoints&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; cached points &quot;</span>, 7);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a4408bb1122638fe487f72247fb91804a">mMovPntsInited</a> = featureSize;
<a name="l00601"></a>00601     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPoints&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; inited v:&quot;</span>&lt;&lt;vertices.size()&lt;&lt;<span class="stringliteral">&quot;-&gt;&quot;</span>&lt;&lt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>.size() , 5);
<a name="l00602"></a>00602 }
<a name="l00606"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a0d4d85f93933c9d954972cd098c3503b">00606</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a0d4d85f93933c9d954972cd098c3503b">ntlGeometryObject::initMovingPointsAnim</a>(
<a name="l00607"></a>00607          <span class="keywordtype">double</span> srctime, vector&lt;ntlVec3Gfx&gt; &amp;srcmovPoints,
<a name="l00608"></a>00608          <span class="keywordtype">double</span> dsttime, vector&lt;ntlVec3Gfx&gt; &amp;dstmovPoints,
<a name="l00609"></a>00609          vector&lt;ntlVec3Gfx&gt; *dstmovNormals,
<a name="l00610"></a>00610          <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> featureSize,
<a name="l00611"></a>00611          <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> geostart, <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> geoend
<a name="l00612"></a>00612          ) {
<a name="l00613"></a>00613     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugMoinit=<span class="keyword">false</span>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     vector&lt;ntlTriangle&gt; srctriangles; 
<a name="l00616"></a>00616     vector&lt;ntlVec3Gfx&gt; srcvertices; 
<a name="l00617"></a>00617     vector&lt;ntlVec3Gfx&gt; unused_normals; 
<a name="l00618"></a>00618     vector&lt;ntlTriangle&gt; dsttriangles; 
<a name="l00619"></a>00619     vector&lt;ntlVec3Gfx&gt; dstvertices; 
<a name="l00620"></a>00620     vector&lt;ntlVec3Gfx&gt; dstnormals; 
<a name="l00621"></a>00621     <span class="keywordtype">int</span> objectId = 1;
<a name="l00622"></a>00622     <span class="comment">// TODO optimize? , get rid of normals?</span>
<a name="l00623"></a>00623     unused_normals.clear();
<a name="l00624"></a>00624     this-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a44d0c43347720a6bf14bece2f39a4ec3">getTriangles</a>(srctime, &amp;srctriangles,&amp;srcvertices,&amp;unused_normals,objectId);
<a name="l00625"></a>00625     unused_normals.clear();
<a name="l00626"></a>00626     this-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a44d0c43347720a6bf14bece2f39a4ec3">getTriangles</a>(dsttime, &amp;dsttriangles,&amp;dstvertices,&amp;dstnormals,objectId);
<a name="l00627"></a>00627     
<a name="l00628"></a>00628     srcmovPoints.clear();
<a name="l00629"></a>00629     dstmovPoints.clear();
<a name="l00630"></a>00630     <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPointsAnim&quot;</span>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; has srcv:&quot;</span>&lt;&lt;srcvertices.size()&lt;&lt;<span class="stringliteral">&quot; srct:&quot;</span>&lt;&lt;srctriangles.size() );
<a name="l00631"></a>00631     <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPointsAnim&quot;</span>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; has dstv:&quot;</span>&lt;&lt;dstvertices.size()&lt;&lt;<span class="stringliteral">&quot; dstt:&quot;</span>&lt;&lt;dsttriangles.size() );
<a name="l00632"></a>00632     <span class="comment">// no points?</span>
<a name="l00633"></a>00633     <span class="keywordflow">if</span>(srcvertices.size()&lt;1) {
<a name="l00634"></a>00634         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a6a8b643cb201e977f62627ffc564d8f4">mMaxMovPnt</a>=-1;
<a name="l00635"></a>00635         <span class="keywordflow">return</span>; 
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637     <span class="keywordflow">if</span>((srctriangles.size() != dsttriangles.size()) ||
<a name="l00638"></a>00638        (srcvertices.size() != dstvertices.size()) ) {
<a name="l00639"></a>00639         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPointsAnim&quot;</span>,<span class="stringliteral">&quot;Invalid triangle numbers! Aborting...&quot;</span>);
<a name="l00640"></a>00640         <span class="keywordflow">return</span>;
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3f</a> maxscale = <a class="code" href="../../da/d97/attributes_8cpp.html#a74d766d922e27c367c60c2a765b9cd35">channelFindMaxVf</a>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a968e606761acf8a2b081c8ba1d673553">mcScale</a>);
<a name="l00643"></a>00643     <span class="keywordtype">float</span> maxpart = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[0]);
<a name="l00644"></a>00644     <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[1])&gt;maxpart) maxpart = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[1]);
<a name="l00645"></a>00645     <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[2])&gt;maxpart) maxpart = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(maxscale[2]);
<a name="l00646"></a>00646     <span class="keywordtype">float</span> scaleFac = 1.0/(maxpart);
<a name="l00647"></a>00647     <span class="comment">// TODO - better reinit from time to time?</span>
<a name="l00648"></a>00648     <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> fsTri = featureSize*0.5 *scaleFac;
<a name="l00649"></a>00649     <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPointsAnim&quot;</span>,<span class="stringliteral">&quot;maxscale:&quot;</span>&lt;&lt;maxpart&lt;&lt;<span class="stringliteral">&quot; featureSize:&quot;</span>&lt;&lt;featureSize&lt;&lt;<span class="stringliteral">&quot; fsTri:&quot;</span>&lt;&lt;fsTri );
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>.size()!=srctriangles.size()) {
<a name="l00652"></a>00652         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a99cee89ef1449fbefdb99d0d98305b8f">calcTriangleDivs</a>(srcvertices,srctriangles,fsTri);
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     <span class="comment">// init std points</span>
<a name="l00657"></a>00657     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;srcvertices.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00658"></a>00658         srcmovPoints.push_back(srcvertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00659"></a>00659         <span class="comment">//srcmovNormals.push_back(srcnormals[i]);</span>
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;dstvertices.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00662"></a>00662         dstmovPoints.push_back(dstvertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00663"></a>00663         <span class="keywordflow">if</span>(dstmovNormals) (*dstmovNormals).push_back(dstnormals[i]);
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665     <span class="keywordflow">if</span>(debugMoinit) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPointsAnim&quot;</span>,<span class="stringliteral">&quot;stats src:&quot;</span>&lt;&lt;srcmovPoints.size()&lt;&lt;<span class="stringliteral">&quot; dst:&quot;</span>&lt;&lt;dstmovPoints.size()&lt;&lt;<span class="stringliteral">&quot; &quot;</span> );
<a name="l00666"></a>00666     <span class="comment">// init points &amp; refine...</span>
<a name="l00667"></a>00667     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;srctriangles.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00668"></a>00668         <span class="keyword">const</span> <span class="keywordtype">int</span> divs1=<a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00669"></a>00669         <span class="keyword">const</span> <span class="keywordtype">int</span>   divs2=<a class="code" href="../../df/dc9/classntlGeometryObject.html#abebecc8ea1335989ee34eda73c455142">mTriangleDivs2</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00670"></a>00670         <span class="keywordflow">if</span>(divs1+divs2 &gt; 0) {
<a name="l00671"></a>00671             <span class="keywordtype">int</span> *srctrips = srctriangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints();
<a name="l00672"></a>00672             <span class="keywordtype">int</span> *dsttrips = dsttriangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints();
<a name="l00673"></a>00673             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> srcp0 =    srcvertices[ srctrips[0] ];
<a name="l00674"></a>00674             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> srcside1 = srcvertices[ srctrips[1] ] - srcp0;
<a name="l00675"></a>00675             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> srcside2 = srcvertices[ srctrips[2] ] - srcp0;
<a name="l00676"></a>00676             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dstp0 =    dstvertices[ dsttrips[0] ];
<a name="l00677"></a>00677             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dstside1 = dstvertices[ dsttrips[1] ] - dstp0;
<a name="l00678"></a>00678             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dstside2 = dstvertices[ dsttrips[2] ] - dstp0;
<a name="l00679"></a>00679             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> src_trinorm    = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ac43d14a1c6daaaff84ddd054b5c4db7d">getNormalized</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>(srcside1,srcside2))*0.25*featureSize;
<a name="l00680"></a>00680             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dst_trinormOrg = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ac43d14a1c6daaaff84ddd054b5c4db7d">getNormalized</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>(dstside1,dstside2));
<a name="l00681"></a>00681             <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dst_trinorm    = dst_trinormOrg                         *0.25*featureSize;
<a name="l00682"></a>00682             <span class="comment">//errMsg(&quot;ntlGeometryObject::initMovingPointsAnim&quot;,&quot;Tri1 &quot;&lt;&lt;srcvertices[srctrips[0]]&lt;&lt;&quot;,&quot;&lt;&lt;srcvertices[srctrips[1]]&lt;&lt;&quot;,&quot;&lt;&lt;srcvertices[srctrips[2]]&lt;&lt;&quot; &quot;&lt;&lt;divs1&lt;&lt;&quot;,&quot;&lt;&lt;divs2 );</span>
<a name="l00683"></a>00683             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> u=0; u&lt;=divs1; u++) {
<a name="l00684"></a>00684                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v=0; v&lt;=divs2; v++) {
<a name="l00685"></a>00685                     <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> uf = (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(u+<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ad9d5079f80e065340a06997423445f7f">TRI_UVOFFSET</a>) / (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(divs1+0.0);
<a name="l00686"></a>00686                     <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> vf = (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(v+<a class="code" href="../../dd/df1/ntl__geometryobject_8cpp.html#ad9d5079f80e065340a06997423445f7f">TRI_UVOFFSET</a>) / (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(divs2+0.0);
<a name="l00687"></a>00687                     <span class="keywordflow">if</span>(uf+vf&gt;1.0) <span class="keywordflow">continue</span>;
<a name="l00688"></a>00688                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> srcp = 
<a name="l00689"></a>00689                         srcvertices[ srctrips[0] ] * (1.0-uf-vf)+
<a name="l00690"></a>00690                         srcvertices[ srctrips[1] ] * uf +
<a name="l00691"></a>00691                         srcvertices[ srctrips[2] ] * vf;
<a name="l00692"></a>00692                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dstp = 
<a name="l00693"></a>00693                         dstvertices[ dsttrips[0] ] * (1.0-uf-vf)+
<a name="l00694"></a>00694                         dstvertices[ dsttrips[1] ] * uf +
<a name="l00695"></a>00695                         dstvertices[ dsttrips[2] ] * vf;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697                     <span class="comment">// cutoffDomain</span>
<a name="l00698"></a>00698                     <span class="keywordflow">if</span>((srcp[0]&lt;geostart[0]) &amp;&amp; (dstp[0]&lt;geostart[0])) <span class="keywordflow">continue</span>;
<a name="l00699"></a>00699                     <span class="keywordflow">if</span>((srcp[1]&lt;geostart[1]) &amp;&amp; (dstp[1]&lt;geostart[1])) <span class="keywordflow">continue</span>;
<a name="l00700"></a>00700                     <span class="keywordflow">if</span>((srcp[2]&lt;geostart[2]) &amp;&amp; (dstp[2]&lt;geostart[2])) <span class="keywordflow">continue</span>;
<a name="l00701"></a>00701                     <span class="keywordflow">if</span>((srcp[0]&gt;geoend[0]  ) &amp;&amp; (dstp[0]&gt;geoend[0]  )) <span class="keywordflow">continue</span>;
<a name="l00702"></a>00702                     <span class="keywordflow">if</span>((srcp[1]&gt;geoend[1]  ) &amp;&amp; (dstp[1]&gt;geoend[1]  )) <span class="keywordflow">continue</span>;
<a name="l00703"></a>00703                     <span class="keywordflow">if</span>((srcp[2]&gt;geoend[2]  ) &amp;&amp; (dstp[2]&gt;geoend[2]  )) <span class="keywordflow">continue</span>;
<a name="l00704"></a>00704                     
<a name="l00705"></a>00705                     srcmovPoints.push_back(srcp+src_trinorm); <span class="comment">// SURFENHTEST</span>
<a name="l00706"></a>00706                     srcmovPoints.push_back(srcp-src_trinorm);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708                     dstmovPoints.push_back(dstp+dst_trinorm); <span class="comment">// SURFENHTEST</span>
<a name="l00709"></a>00709                     dstmovPoints.push_back(dstp-dst_trinorm);
<a name="l00710"></a>00710                     <span class="keywordflow">if</span>(dstmovNormals) {
<a name="l00711"></a>00711                         (*dstmovNormals).push_back(dst_trinormOrg);
<a name="l00712"></a>00712                         (*dstmovNormals).push_back(dst_trinormOrg); }
<a name="l00713"></a>00713                 }
<a name="l00714"></a>00714             }
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="comment">// find max point not necessary</span>
<a name="l00719"></a>00719     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObject::initMovingPointsAnim&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Object &quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; inited v:&quot;</span>&lt;&lt;srcvertices.size()&lt;&lt;<span class="stringliteral">&quot;-&gt;&quot;</span>&lt;&lt;srcmovPoints.size()&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;dstmovPoints.size() , 5);
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00723"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a974c9cb8d51faacb695648c89089bd94">00723</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a974c9cb8d51faacb695648c89089bd94">ntlGeometryObject::getMovingPoints</a>(vector&lt;ntlVec3Gfx&gt; &amp;ret, vector&lt;ntlVec3Gfx&gt; *norms) {
<a name="l00724"></a>00724     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a5fc7c7bbb9dca55a2aba3a031bda6a7c">mHaveCachedMov</a>) {
<a name="l00725"></a>00725         ret = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a925dcd247a3d55e43255d3a8545e0af7">mCachedMovPoints</a>;
<a name="l00726"></a>00726         <span class="keywordflow">if</span>(norms) { 
<a name="l00727"></a>00727             *norms = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a64b5696926d25fe4953761d28234ba1e">mCachedMovNormals</a>; 
<a name="l00728"></a>00728             <span class="comment">//errMsg(&quot;ntlGeometryObject&quot;,&quot;getMovingPoints - Normals currently unused!&quot;);</span>
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730         <span class="comment">//errMsg (&quot;ntlGeometryObject::getMovingPoints&quot;,&quot;Object &quot;&lt;&lt;getName()&lt;&lt;&quot; used cached points &quot;); // DEBUG</span>
<a name="l00731"></a>00731         <span class="keywordflow">return</span>;
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     ret = <a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>;
<a name="l00735"></a>00735     <span class="keywordflow">if</span>(norms) { 
<a name="l00736"></a>00736         <span class="comment">//errMsg(&quot;ntlGeometryObject&quot;,&quot;getMovingPoints - Normals currently unused!&quot;);</span>
<a name="l00737"></a>00737         *norms = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a80b6351b32676058dc672eff046657df">mMovNormals</a>; 
<a name="l00738"></a>00738     }
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 
<a name="l00743"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#ad1f99d809bf8921c2de5e839fcd7270a">00743</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../df/dc9/classntlGeometryObject.html#ad1f99d809bf8921c2de5e839fcd7270a">ntlGeometryObject::calculateMaxVel</a>(<span class="keywordtype">double</span> t1, <span class="keywordtype">double</span> t2) {
<a name="l00744"></a>00744     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> vel(0.);
<a name="l00745"></a>00745     <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a6a8b643cb201e977f62627ffc564d8f4">mMaxMovPnt</a>&lt;0) <span class="keywordflow">return</span> vel;
<a name="l00746"></a>00746         
<a name="l00747"></a>00747     vector&lt;ntlVec3Gfx&gt; verts1,verts2;
<a name="l00748"></a>00748     verts1.push_back(<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab867f6bad2495dd664ba9b56ecf43690">mMovPoints</a>[<a class="code" href="../../df/dc9/classntlGeometryObject.html#a6a8b643cb201e977f62627ffc564d8f4">mMaxMovPnt</a>]);
<a name="l00749"></a>00749     verts2 = verts1;
<a name="l00750"></a>00750     <a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(t1,&amp;verts1,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0,verts1.size(), <span class="keyword">true</span>);
<a name="l00751"></a>00751     <a class="code" href="../../df/dc9/classntlGeometryObject.html#adb88533bcd1b56b14e0ac6d42404ecb7">applyTransformation</a>(t2,&amp;verts2,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0,verts2.size(), <span class="keyword">true</span>);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     vel = (verts2[0]-verts1[0]); <span class="comment">// /(t2-t1);</span>
<a name="l00754"></a>00754     <span class="comment">//errMsg(&quot;ntlGeometryObject::calculateMaxVel&quot;,&quot;t1=&quot;&lt;&lt;t1&lt;&lt;&quot; t2=&quot;&lt;&lt;t2&lt;&lt;&quot; p1=&quot;&lt;&lt;verts1[0]&lt;&lt;&quot; p2=&quot;&lt;&lt;verts2[0]&lt;&lt;&quot; v=&quot;&lt;&lt;vel);</span>
<a name="l00755"></a>00755     <span class="keywordflow">return</span> vel;
<a name="l00756"></a>00756 }
<a name="l00757"></a>00757 
<a name="l00759"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a02d8e9a80f8d7e324d59b4bd48046778">00759</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a02d8e9a80f8d7e324d59b4bd48046778">ntlGeometryObject::getTranslation</a>(<span class="keywordtype">double</span> t) {
<a name="l00760"></a>00760     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pos = <a class="code" href="../../df/dc9/classntlGeometryObject.html#acbd58fed6cf404059d97059fcce4e3a8">mcTrans</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t);
<a name="l00761"></a>00761   <span class="comment">// DEBUG CP_FORCECIRCLEINIT 1</span>
<a name="l00762"></a>00762     <span class="comment">/*if( </span>
<a name="l00763"></a>00763 <span class="comment">            (mName.compare(string(&quot;0__ts1&quot;))==0) ||</span>
<a name="l00764"></a>00764 <span class="comment">            (mName.compare(string(&quot;1__ts1&quot;))==0) ||</span>
<a name="l00765"></a>00765 <span class="comment">            (mName.compare(string(&quot;2__ts1&quot;))==0) ||</span>
<a name="l00766"></a>00766 <span class="comment">            (mName.compare(string(&quot;3__ts1&quot;))==0) ||</span>
<a name="l00767"></a>00767 <span class="comment">            (mName.compare(string(&quot;4__ts1&quot;))==0) ||</span>
<a name="l00768"></a>00768 <span class="comment">            (mName.compare(string(&quot;5__ts1&quot;))==0) ||</span>
<a name="l00769"></a>00769 <span class="comment">            (mName.compare(string(&quot;6__ts1&quot;))==0) ||</span>
<a name="l00770"></a>00770 <span class="comment">            (mName.compare(string(&quot;7__ts1&quot;))==0) ||</span>
<a name="l00771"></a>00771 <span class="comment">            (mName.compare(string(&quot;8__ts1&quot;))==0) ||</span>
<a name="l00772"></a>00772 <span class="comment">            (mName.compare(string(&quot;9__ts1&quot;))==0) </span>
<a name="l00773"></a>00773 <span class="comment">            ) { int j=mName[0]-&#39;0&#39;;</span>
<a name="l00774"></a>00774 <span class="comment">            ntlVec3Gfx ppos(0.); { // DEBUG</span>
<a name="l00775"></a>00775 <span class="comment">            const float tscale=10.;</span>
<a name="l00776"></a>00776 <span class="comment">            const float tprevo = 0.33;</span>
<a name="l00777"></a>00777 <span class="comment">            const ntlVec3Gfx   toff(50,50,0);</span>
<a name="l00778"></a>00778 <span class="comment">            const ntlVec3Gfx oscale(30,30,0);</span>
<a name="l00779"></a>00779 <span class="comment">            ppos[0] =  cos(tscale* t - tprevo*(float)j + M_PI -0.1) * oscale[0] + toff[0];</span>
<a name="l00780"></a>00780 <span class="comment">            ppos[1] = -sin(tscale* t - tprevo*(float)j + M_PI -0.1) * oscale[1] + toff[1];</span>
<a name="l00781"></a>00781 <span class="comment">            ppos[2] =                               toff[2]; } // DEBUG</span>
<a name="l00782"></a>00782 <span class="comment">            pos = ppos;</span>
<a name="l00783"></a>00783 <span class="comment">            pos[2] = 0.15;</span>
<a name="l00784"></a>00784 <span class="comment">    }</span>
<a name="l00785"></a>00785 <span class="comment">  // DEBUG CP_FORCECIRCLEINIT 1 */</span>
<a name="l00786"></a>00786     <span class="keywordflow">return</span> pos;
<a name="l00787"></a>00787 }
<a name="l00789"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a3af1760d6e1672d64113f8eef2496fc6">00789</a> <span class="keywordtype">float</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a3af1760d6e1672d64113f8eef2496fc6">ntlGeometryObject::getGeoActive</a>(<span class="keywordtype">double</span> t) {
<a name="l00790"></a>00790     <span class="keywordtype">float</span> act = <a class="code" href="../../df/dc9/classntlGeometryObject.html#a63eff11de3456e385fe1a0b72a280f67">mcGeoActive</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t); <span class="comment">// if &lt;= 0.0 -&gt; off</span>
<a name="l00791"></a>00791     <span class="keywordflow">return</span> act;
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#aebcec645dfde3d2a9bff1905d490f7e8">00794</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dc9/classntlGeometryObject.html#aebcec645dfde3d2a9bff1905d490f7e8">ntlGeometryObject::setInitialVelocity</a>(<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <span class="keyword">set</span>) { 
<a name="l00795"></a>00795     <a class="code" href="../../df/dc9/classntlGeometryObject.html#aa21d73a85fc52c7fb318c3c6b4b01c34">mInitialVelocity</a>=<span class="keyword">set</span>; 
<a name="l00796"></a>00796     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;ntlVec3Gfx&gt;</a>(<span class="keyword">set</span>); 
<a name="l00797"></a>00797 }
<a name="l00798"></a><a class="code" href="../../df/dc9/classntlGeometryObject.html#a7963fa7338802294bfe1e63440616414">00798</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../df/dc9/classntlGeometryObject.html#a7963fa7338802294bfe1e63440616414">ntlGeometryObject::getInitialVelocity</a>(<span class="keywordtype">double</span> t) { 
<a name="l00799"></a>00799     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> v =  <a class="code" href="../../df/dc9/classntlGeometryObject.html#a30ead09361d05a91fc008662b1393475">mcInitialVelocity</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t); <span class="comment">//return mInitialVelocity; </span>
<a name="l00800"></a>00800     <span class="keywordflow">if</span>(!<a class="code" href="../../df/dc9/classntlGeometryObject.html#a14b418cf288f896992606f23df4bcac0">mLocalCoordInivel</a>) <span class="keywordflow">return</span> v;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../df/d5a/svm__noise_8h.html#aae44e21ada356d9d84450d5440fbb0c4">rot</a> = <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae4b9c28af5ada25026f4a9be9e65f26b">mcRot</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t);
<a name="l00803"></a>00803     <a class="code" href="../../d3/d61/classntlMatrix4x4.html">ntlMat4Gfx</a> rotMat;
<a name="l00804"></a>00804     rotMat.<a class="code" href="../../d3/d61/classntlMatrix4x4.html#ade3c1a6b97facdf6ecd22df68cda9b27">initRotationXYZ</a>(rot[0],rot[1],rot[2]);
<a name="l00805"></a>00805     v = rotMat * v;
<a name="l00806"></a>00806     <span class="keywordflow">return</span> v;
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808     
<a name="l00809"></a>00809 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:36 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

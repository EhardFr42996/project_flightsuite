<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: node.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">node.c</div>  </div>
</div>
<div class="contents">
<a href="../../dd/d2d/node_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2005 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): Bob Holcomb.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#if 0 </span><span class="comment">/* pynodes commented for now */</span>
<a name="l00034"></a>00034 <span class="preprocessor">#  ifdef WITH_PYTHON</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#    include &lt;Python.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#  endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d2a/DNA__action__types_8h.html">DNA_action_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db3/BLI__string_8h.html">BLI_string.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d3e/BLI__listbase_8h.html">BLI_listbase.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dd9/BLI__path__util_8h.html">BLI_path_util.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d61/BLF__translation_8h.html">BLF_translation.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d77/BKE__image_8h.html">BKE_image.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d52/NOD__socket_8h.html">NOD_socket.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d05/NOD__composite_8h.html">NOD_composite.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d3a/NOD__shader_8h.html">NOD_shader.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dfc/NOD__texture_8h.html">NOD_texture.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="../../dd/d2d/node_8c.html#a9d388f47548009c135129d96e030d6ba">00079</a> <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <span class="keyword">static</span> <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a7c818545257582cb367e58b3a75f15a6">types</a>[<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a65928324ac7ecafcf0f822524c203d54">NUM_NTREE_TYPES</a>];
<a name="l00082"></a>00082     <span class="keyword">static</span> <span class="keywordtype">int</span> types_init = 1;
<a name="l00083"></a>00083     <span class="keywordflow">if</span> (types_init) {
<a name="l00084"></a>00084         types[<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>] = &amp;<a class="code" href="../../d8/d3a/NOD__shader_8h.html#aef21619201db6e9d70f526e5d7375873">ntreeType_Shader</a>;
<a name="l00085"></a>00085         types[<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>] = &amp;<a class="code" href="../../d7/d49/node__composite__tree_8c.html#a9ee7bb923a21f5a57c06c04482e3788f">ntreeType_Composite</a>;
<a name="l00086"></a>00086         types[<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>] = &amp;<a class="code" href="../../d4/dfc/NOD__texture_8h.html#a2b1a173ff666fbe56a47cb65a9739e97">ntreeType_Texture</a>;
<a name="l00087"></a>00087         types_init = 0;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (type &gt;= 0 &amp;&amp; type &lt; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a65928324ac7ecafcf0f822524c203d54">NUM_NTREE_TYPES</a>) {
<a name="l00091"></a>00091         <span class="keywordflow">return</span> types[<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>];
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093     <span class="keywordflow">else</span> {
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">00098</a> <span class="keyword">static</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *<a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype = <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>)-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#aa705f91cca0620a6d5ecd112e243ffc5">node_types</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00101"></a>00101     <span class="keywordflow">for</span> (; ntype; ntype= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ab12a766ae8639a9eb22ef59ec025c67c">next</a>)
<a name="l00102"></a>00102         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>==type)
<a name="l00103"></a>00103             <span class="keywordflow">return</span> ntype;
<a name="l00104"></a>00104     
<a name="l00105"></a>00105     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="../../dd/d2d/node_8c.html#ae5bb820547c20f06436fed4ea855894a">00108</a> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a5b6cc9053da8f344660dd228e1485677">ntreeGetNodeType</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <span class="keywordflow">return</span> <a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(ntree, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae174135c0568adeb8a45d7697ae378a9">nodetype</a>);
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="../../dd/d2d/node_8c.html#a50d644c69d64b9b43649bb371dd6ebd3">00113</a> <a class="code" href="../../dd/dfb/structbNodeSocketType.html">bNodeSocketType</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a569537bca3d5248cfc2322a915803d89">ntreeGetSocketType</a>(<span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <span class="keyword">static</span> <a class="code" href="../../dd/dfb/structbNodeSocketType.html">bNodeSocketType</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a7c818545257582cb367e58b3a75f15a6">types</a>[<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae78aff9ecead2a9be8088f7a5fcf9f19">NUM_SOCKET_TYPES</a>]= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00116"></a>00116     <span class="keyword">static</span> <span class="keywordtype">int</span> types_init = 1;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (types_init) {
<a name="l00119"></a>00119         <a class="code" href="../../da/d28/node__socket_8c.html#a3afa72f3fdfd9709cd0cff85336a6919">node_socket_type_init</a>(types);
<a name="l00120"></a>00120         types_init= 0;
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (type &lt; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae78aff9ecead2a9be8088f7a5fcf9f19">NUM_SOCKET_TYPES</a>) {
<a name="l00124"></a>00124         <span class="keywordflow">return</span> types[<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>];
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     <span class="keywordflow">else</span> {
<a name="l00127"></a>00127         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="../../dd/d2d/node_8c.html#a3000e2ba182c5c6d7549118e530167d1">00131</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a9e5866b70fc15f2998753843f0d45cda">ntreeInitTypes</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00134"></a>00134     
<a name="l00135"></a>00135     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= next) {
<a name="l00136"></a>00136         next= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l00137"></a>00137         
<a name="l00138"></a>00138         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>= <a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(ntree, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>);
<a name="l00139"></a>00139         
<a name="l00140"></a>00140         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a2c68ef059534ec7a55087732345e875e">NODE_DYNAMIC</a>) {
<a name="l00141"></a>00141             <span class="comment">/* needed info if the pynode script fails now: */</span>
<a name="l00142"></a>00142             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= ntree;
<a name="l00143"></a>00143             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">/* not an empty script node */</span>
<a name="l00144"></a>00144                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>= 0;
<a name="l00145"></a>00145                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>= <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>,<a class="code" href="../../d4/d91/BKE__node_8h.html#a81d1ddfc376249723db9a64b9ffae1f3">NODE_DYNAMIC_ADDEXIST</a>);
<a name="l00146"></a>00146             }
<a name="l00147"></a>00147 <span class="comment">//          if (node-&gt;typeinfo)</span>
<a name="l00148"></a>00148 <span class="comment">//              node-&gt;typeinfo-&gt;initfunc(node);</span>
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00152"></a>00152             printf(<span class="stringliteral">&quot;Error: Node type %s doesn&#39;t exist anymore, removed\n&quot;</span>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>);
<a name="l00153"></a>00153             <a class="code" href="../../d4/d91/BKE__node_8h.html#a6913c62630bd85b7514bebc6e58c5d51">nodeFreeNode</a>(ntree, node);
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156             
<a name="l00157"></a>00157     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ab59922f6b4bcc1b20e121e0fa6b69a4c">init</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ac3ed4c9daa2428253bb2d505410683a2">NTREE_TYPE_INIT</a>;
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="../../dd/d2d/node_8c.html#a0d419d03a850b3a1a1424042f735399d">00160</a> <span class="keyword">static</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *<a class="code" href="../../dd/d2d/node_8c.html#a0d419d03a850b3a1a1424042f735399d">make_socket</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ntree), <span class="keywordtype">int</span> in_out, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, <span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00163"></a>00163     
<a name="l00164"></a>00164     sock= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>), <span class="stringliteral">&quot;sock&quot;</span>);
<a name="l00165"></a>00165     
<a name="l00166"></a>00166     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, name, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a48944375b7ad88babca505393473f53a">NODE_MAXSTR</a>);
<a name="l00167"></a>00167     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a36deb7fbd6dea184e99685a979750824">limit</a> = (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a> ? 1 : 0xFFF);
<a name="l00168"></a>00168     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>= <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>;
<a name="l00169"></a>00169     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a16dd98d87c594f25bb0676986a13dd9e">storage</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00170"></a>00170     
<a name="l00171"></a>00171     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d28/node__socket_8c.html#a06af3f435abfc0756d1e3f87c90b19dd">node_socket_make_default_value</a>(type);
<a name="l00172"></a>00172     <a class="code" href="../../da/d28/node__socket_8c.html#a079793633b58eb7e052ab081a964a5b4">node_socket_init_default_value</a>(type, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00173"></a>00173     
<a name="l00174"></a>00174     <span class="keywordflow">return</span> sock;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="../../dd/d2d/node_8c.html#a7f9361a609afb9f2a329ce905de0e27c">00177</a> <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#aae580ede2ac6b1b63fd398d9ef54f95f">nodeAddSocket</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> in_out, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, <span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock = <a class="code" href="../../dd/d2d/node_8c.html#a0d419d03a850b3a1a1424042f735399d">make_socket</a>(ntree, in_out, name, type);
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>)
<a name="l00181"></a>00181         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, sock);
<a name="l00182"></a>00182     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>)
<a name="l00183"></a>00183         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, sock);
<a name="l00184"></a>00184     
<a name="l00185"></a>00185     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae67319bd4d588921dc74a7d025065c15">NODE_UPDATE</a>;
<a name="l00186"></a>00186     
<a name="l00187"></a>00187     <span class="keywordflow">return</span> sock;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="../../dd/d2d/node_8c.html#a48c32b02d297eeca116564d0480c1f10">00190</a> <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#ad12a42a8a83032e34b1dc368feca7657">nodeInsertSocket</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> in_out, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *next_sock, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, <span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock = <a class="code" href="../../dd/d2d/node_8c.html#a0d419d03a850b3a1a1424042f735399d">make_socket</a>(ntree, in_out, name, type);
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>)
<a name="l00194"></a>00194         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, next_sock, sock);
<a name="l00195"></a>00195     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>)
<a name="l00196"></a>00196         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, next_sock, sock);
<a name="l00197"></a>00197     
<a name="l00198"></a>00198     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae67319bd4d588921dc74a7d025065c15">NODE_UPDATE</a>;
<a name="l00199"></a>00199     
<a name="l00200"></a>00200     <span class="keywordflow">return</span> sock;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="../../dd/d2d/node_8c.html#aab477d27bfa5d4b00fbbec795f4e0125">00203</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aa4faf2c04a65b1932766577b93c6ed6d">nodeRemoveSocket</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= next) {
<a name="l00208"></a>00208         next= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l00209"></a>00209         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==sock || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==sock) {
<a name="l00210"></a>00210             <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     
<a name="l00214"></a>00214     <span class="comment">/* this is fast, this way we don&#39;t need an in_out argument */</span>
<a name="l00215"></a>00215     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, sock);
<a name="l00216"></a>00216     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, sock);
<a name="l00217"></a>00217     
<a name="l00218"></a>00218     <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00219"></a>00219     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sock);
<a name="l00220"></a>00220     
<a name="l00221"></a>00221     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae67319bd4d588921dc74a7d025065c15">NODE_UPDATE</a>;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="../../dd/d2d/node_8c.html#ad91486e963421b84918055fb7e0ddb5f">00224</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a6539930c8e6f641fe00022c8153b773f">nodeRemoveAllSockets</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00227"></a>00227     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00228"></a>00228     
<a name="l00229"></a>00229     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= next) {
<a name="l00230"></a>00230         next= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>==node || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>==node) {
<a name="l00232"></a>00232             <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     
<a name="l00236"></a>00236     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00237"></a>00237         <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00238"></a>00238     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>);
<a name="l00239"></a>00239     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00240"></a>00240         <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00241"></a>00241     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>);
<a name="l00242"></a>00242     
<a name="l00243"></a>00243     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae67319bd4d588921dc74a7d025065c15">NODE_UPDATE</a>;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">/* finds a node based on its name */</span>
<a name="l00247"></a><a class="code" href="../../dd/d2d/node_8c.html#a754f08c1c5ee009fa7798f8e98497fcb">00247</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a60b36f71b62212bef4196861570e5120">nodeFindNodebyName</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>)
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <span class="keywordflow">return</span> <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a07f40c87b9211c9d5fef01d4a4e9054d">BLI_findstring</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>, name, offsetof(<a class="code" href="../../dc/daa/structbNode.html">bNode</a>, name));
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment">/* finds a node based on given socket */</span>
<a name="l00253"></a><a class="code" href="../../dd/d2d/node_8c.html#acf3d6db023dacb62cd4586515f8a6aca">00253</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a2591e42fb37baab20835698647434f47">nodeFindNode</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> **nodep, <span class="keywordtype">int</span> *sockindex, <span class="keywordtype">int</span> *in_out)
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00256"></a>00256     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *tsock;
<a name="l00257"></a>00257     <span class="keywordtype">int</span> index= 0;
<a name="l00258"></a>00258     
<a name="l00259"></a>00259     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00260"></a>00260         <span class="keywordflow">for</span> (index=0, tsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tsock; tsock= tsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, index++) {
<a name="l00261"></a>00261             <span class="keywordflow">if</span> (tsock==sock) {
<a name="l00262"></a>00262                 <span class="keywordflow">if</span> (in_out) *in_out= <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>;
<a name="l00263"></a>00263                 <span class="keywordflow">break</span>;
<a name="l00264"></a>00264             }
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266         <span class="keywordflow">if</span> (tsock)
<a name="l00267"></a>00267             <span class="keywordflow">break</span>;
<a name="l00268"></a>00268         <span class="keywordflow">for</span> (index=0, tsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tsock; tsock= tsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, index++) {
<a name="l00269"></a>00269             <span class="keywordflow">if</span> (tsock==sock) {
<a name="l00270"></a>00270                 <span class="keywordflow">if</span> (in_out) *in_out= <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>;
<a name="l00271"></a>00271                 <span class="keywordflow">break</span>;
<a name="l00272"></a>00272             }
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         <span class="keywordflow">if</span> (tsock)
<a name="l00275"></a>00275             <span class="keywordflow">break</span>;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="keywordflow">if</span> (node) {
<a name="l00279"></a>00279         *nodep= node;
<a name="l00280"></a>00280         <span class="keywordflow">if</span> (sockindex) *sockindex= index;
<a name="l00281"></a>00281         <span class="keywordflow">return</span> 1;
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     *nodep= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00285"></a>00285     <span class="keywordflow">return</span> 0;
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="comment">/* ************** Add stuff ********** */</span>
<a name="l00289"></a><a class="code" href="../../dd/d2d/node_8c.html#a2093f31a9e06e58556f3ab1ad9330e22">00289</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a2093f31a9e06e58556f3ab1ad9330e22">node_add_sockets_from_type</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291     <a class="code" href="../../d1/da2/structbNodeSocketTemplate.html">bNodeSocketTemplate</a> *sockdef;
<a name="l00292"></a>00292     <span class="comment">/* bNodeSocket *sock; */</span> <span class="comment">/* UNUSED */</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#acca5296bd3e77a5dc7a18b0b5c0f15eb">inputs</a>) {
<a name="l00295"></a>00295         sockdef= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#acca5296bd3e77a5dc7a18b0b5c0f15eb">inputs</a>;
<a name="l00296"></a>00296         <span class="keywordflow">while</span> (sockdef-&gt;<a class="code" href="../../d1/da2/structbNodeSocketTemplate.html#ad30d49a03cc86393ef658c0b84c54eb7">type</a> != -1) {
<a name="l00297"></a>00297             <span class="comment">/* sock = */</span> <a class="code" href="../../da/d28/node__socket_8c.html#a1e086545df64e13ca1142e695afe8374">node_add_input_from_template</a>(ntree, node, sockdef);
<a name="l00298"></a>00298             
<a name="l00299"></a>00299             sockdef++;
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6c0d9e5ca5dcfb5aa866279350ecd736">outputs</a>) {
<a name="l00303"></a>00303         sockdef= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6c0d9e5ca5dcfb5aa866279350ecd736">outputs</a>;
<a name="l00304"></a>00304         <span class="keywordflow">while</span> (sockdef-&gt;<a class="code" href="../../d1/da2/structbNodeSocketTemplate.html#ad30d49a03cc86393ef658c0b84c54eb7">type</a> != -1) {
<a name="l00305"></a>00305             <span class="comment">/* sock = */</span> <a class="code" href="../../da/d28/node__socket_8c.html#a596d300d72d9db1d706c02bde739a50d">node_add_output_from_template</a>(ntree, node, sockdef);
<a name="l00306"></a>00306             
<a name="l00307"></a>00307             sockdef++;
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">/* Find the first available, non-duplicate name for a given node */</span>
<a name="l00313"></a><a class="code" href="../../dd/d2d/node_8c.html#aaef7f36e86460add3ba190855724900e">00313</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a08e88749decf79e52c9536bfc45ea407">nodeUniqueName</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a584e08e337965c8bb232cf7ff28a0e13">BLI_uniquename</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>, node, <span class="stringliteral">&quot;Node&quot;</span>, <span class="charliteral">&#39;.&#39;</span>, offsetof(<a class="code" href="../../dc/daa/structbNode.html">bNode</a>, <a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>), <span class="keyword">sizeof</span>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>));
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="../../dd/d2d/node_8c.html#abbb7ca0d66fede1fcd987cb4173d907d">00318</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> *ntemp)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00321"></a>00321     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype;
<a name="l00322"></a>00322     
<a name="l00323"></a>00323     ntype= <a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(ntree, ntemp-&gt;<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a>);
<a name="l00324"></a>00324     <span class="keywordflow">if</span> (ntype == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00325"></a>00325         printf(<span class="stringliteral">&quot;nodeAddNodeType() error: &#39;%d&#39; type invalid\n&quot;</span>, ntemp-&gt;<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a>);
<a name="l00326"></a>00326         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328     <span class="comment">/* validity check */</span>
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a0b60cc966d0f0ea1e89476305f95c82c">nodeValid</a>(ntree, ntemp))
<a name="l00330"></a>00330         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00331"></a>00331     
<a name="l00332"></a>00332     node= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a>), <span class="stringliteral">&quot;new node&quot;</span>);
<a name="l00333"></a>00333     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>;
<a name="l00334"></a>00334     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>= ntype;
<a name="l00335"></a>00335     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a>= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a>|ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a>;
<a name="l00336"></a>00336     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a18f0501b54ca3cfe9673f015df45043c">width</a>;
<a name="l00337"></a>00337     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a45344c987d49653cfdedebb4c403a3f2">miniwidth</a>= 42.0f;
<a name="l00338"></a>00338     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3892585203606fd3e3b0f448eb93c6a8">height</a>= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#abe77293ac7cba5441a435ff45fdc3578">height</a>;
<a name="l00339"></a>00339     
<a name="l00340"></a>00340     <a class="code" href="../../dd/d2d/node_8c.html#a2093f31a9e06e58556f3ab1ad9330e22">node_add_sockets_from_type</a>(ntree, node, ntype);
<a name="l00341"></a>00341     
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a35bdba7f95b4d599742de716a5451ffe" title="Initialize a new node instance of this type after creation.">initfunc</a>!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00343"></a>00343         ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a35bdba7f95b4d599742de716a5451ffe" title="Initialize a new node instance of this type after creation.">initfunc</a>(ntree, node, ntemp);
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     <span class="comment">/* initialize the node name with the node label */</span>
<a name="l00346"></a>00346     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a310ed873e050bce490fb72ebd79c608a">nodeLabel</a>(node), <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a48944375b7ad88babca505393473f53a">NODE_MAXSTR</a>);
<a name="l00347"></a>00347     <a class="code" href="../../d4/d91/BKE__node_8h.html#a08e88749decf79e52c9536bfc45ea407">nodeUniqueName</a>(ntree, node);
<a name="l00348"></a>00348     
<a name="l00349"></a>00349     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>, node);
<a name="l00350"></a>00350     
<a name="l00351"></a>00351     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bd987034ba27bfa2562c511f38c2d23">NTREE_UPDATE_NODES</a>;
<a name="l00352"></a>00352     
<a name="l00353"></a>00353     <span class="keywordflow">return</span> node;
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="../../dd/d2d/node_8c.html#a1b76ff6e7bfb55ff96b057b1fd77b69c">00356</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a23eddd1cfd011bc268072141e5d1b2b8">nodeMakeDynamicType</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <span class="comment">/* find SH_DYNAMIC_NODE ntype */</span>
<a name="l00359"></a>00359     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>)-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#aa705f91cca0620a6d5ecd112e243ffc5">node_types</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00360"></a>00360     <span class="keywordflow">while</span> (ntype) {
<a name="l00361"></a>00361         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a2c68ef059534ec7a55087732345e875e">NODE_DYNAMIC</a>)
<a name="l00362"></a>00362             <span class="keywordflow">break</span>;
<a name="l00363"></a>00363         ntype= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ab12a766ae8639a9eb22ef59ec025c67c">next</a>;
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="comment">/* make own type struct to fill */</span>
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (ntype) {
<a name="l00368"></a>00368         <span class="comment">/*node-&gt;typeinfo= MEM_dupallocN(ntype);*/</span>
<a name="l00369"></a>00369         <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *newtype= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a>), <span class="stringliteral">&quot;dynamic bNodeType&quot;</span>);
<a name="l00370"></a>00370         *newtype= *ntype;
<a name="l00371"></a>00371         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(newtype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>, ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>, <span class="keyword">sizeof</span>(newtype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>));
<a name="l00372"></a>00372         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>= newtype;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="comment">/* keep socket listorder identical, for copying links */</span>
<a name="l00377"></a>00377 <span class="comment">/* ntree is the target tree */</span>
<a name="l00378"></a><a class="code" href="../../dd/d2d/node_8c.html#a034fd110588b33d604fb62ca708401f4">00378</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#abf956330b2cdbf553a616ec2f866d20d">nodeCopyNode</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *nnode= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a>), <span class="stringliteral">&quot;dupli node&quot;</span>);
<a name="l00381"></a>00381     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, *oldsock;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     *nnode= *node;
<a name="l00384"></a>00384     <a class="code" href="../../d4/d91/BKE__node_8h.html#a08e88749decf79e52c9536bfc45ea407">nodeUniqueName</a>(ntree, nnode);
<a name="l00385"></a>00385     
<a name="l00386"></a>00386     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>, nnode);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;nnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>);
<a name="l00389"></a>00389     oldsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00390"></a>00390     <span class="keywordflow">for</span> (sock= nnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, oldsock= oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00391"></a>00391         oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>= sock;
<a name="l00392"></a>00392         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac708207fa45ef287eda4276ec555aa99">stack_index</a>= 0;
<a name="l00393"></a>00393         
<a name="l00394"></a>00394         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d28/node__socket_8c.html#a06af3f435abfc0756d1e3f87c90b19dd">node_socket_make_default_value</a>(oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00395"></a>00395         <a class="code" href="../../da/d28/node__socket_8c.html#a1fe65fdadd6912d9db74d77e6eb8e3e0">node_socket_copy_default_value</a>(oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>, oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00396"></a>00396         
<a name="l00397"></a>00397         <span class="comment">/* XXX some compositor node (e.g. image, render layers) still store</span>
<a name="l00398"></a>00398 <span class="comment">         * some persistent buffer data here, need to clear this to avoid dangling pointers.</span>
<a name="l00399"></a>00399 <span class="comment">         */</span>
<a name="l00400"></a>00400         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402     
<a name="l00403"></a>00403     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;nnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>);
<a name="l00404"></a>00404     oldsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00405"></a>00405     <span class="keywordflow">for</span> (sock= nnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, oldsock= oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00406"></a>00406         oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>= sock;
<a name="l00407"></a>00407         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac708207fa45ef287eda4276ec555aa99">stack_index</a>= 0;
<a name="l00408"></a>00408         
<a name="l00409"></a>00409         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d28/node__socket_8c.html#a06af3f435abfc0756d1e3f87c90b19dd">node_socket_make_default_value</a>(oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00410"></a>00410         <a class="code" href="../../da/d28/node__socket_8c.html#a1fe65fdadd6912d9db74d77e6eb8e3e0">node_socket_copy_default_value</a>(oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>, oldsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00411"></a>00411         
<a name="l00412"></a>00412         <span class="comment">/* XXX some compositor node (e.g. image, render layers) still store</span>
<a name="l00413"></a>00413 <span class="comment">         * some persistent buffer data here, need to clear this to avoid dangling pointers.</span>
<a name="l00414"></a>00414 <span class="comment">         */</span>
<a name="l00415"></a>00415         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417     
<a name="l00418"></a>00418     <span class="comment">/* don&#39;t increase node-&gt;id users, freenode doesn&#39;t decrement either */</span>
<a name="l00419"></a>00419     
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a235e91d7b013f2b846cf5108ac9e5839" title="Make a copy of the custom storage data.">copystoragefunc</a>)
<a name="l00421"></a>00421         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a235e91d7b013f2b846cf5108ac9e5839" title="Make a copy of the custom storage data.">copystoragefunc</a>(node, nnode);
<a name="l00422"></a>00422     
<a name="l00423"></a>00423     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>= nnode;
<a name="l00424"></a>00424     nnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00425"></a>00425     nnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00426"></a>00426     
<a name="l00427"></a>00427     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bd987034ba27bfa2562c511f38c2d23">NTREE_UPDATE_NODES</a>;
<a name="l00428"></a>00428     
<a name="l00429"></a>00429     <span class="keywordflow">return</span> nnode;
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">/* also used via rna api, so we check for proper input output direction */</span>
<a name="l00433"></a><a class="code" href="../../dd/d2d/node_8c.html#a22ac6521c39806174454e5633752b0cd">00433</a> <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *fromnode, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *fromsock, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tonode, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *tosock)
<a name="l00434"></a>00434 {
<a name="l00435"></a>00435     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00436"></a>00436     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l00437"></a>00437     <span class="keywordtype">int</span> from= 0, to= 0;
<a name="l00438"></a>00438     
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (fromnode) {
<a name="l00440"></a>00440         <span class="comment">/* test valid input */</span>
<a name="l00441"></a>00441         <span class="keywordflow">for</span> (sock= fromnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00442"></a>00442             <span class="keywordflow">if</span> (sock==fromsock)
<a name="l00443"></a>00443                 <span class="keywordflow">break</span>;
<a name="l00444"></a>00444         <span class="keywordflow">if</span> (sock)
<a name="l00445"></a>00445             from= 1; <span class="comment">/* OK */</span>
<a name="l00446"></a>00446         <span class="keywordflow">else</span> {
<a name="l00447"></a>00447             <span class="keywordflow">for</span> (sock= fromnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00448"></a>00448                 <span class="keywordflow">if</span> (sock==fromsock)
<a name="l00449"></a>00449                     <span class="keywordflow">break</span>;
<a name="l00450"></a>00450             <span class="keywordflow">if</span> (sock)
<a name="l00451"></a>00451                 from= -1; <span class="comment">/* OK but flip */</span>
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <span class="keywordflow">else</span> {
<a name="l00455"></a>00455         <span class="comment">/* check tree sockets */</span>
<a name="l00456"></a>00456         <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00457"></a>00457             <span class="keywordflow">if</span> (sock==fromsock)
<a name="l00458"></a>00458                 <span class="keywordflow">break</span>;
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (sock)
<a name="l00460"></a>00460             from= 1; <span class="comment">/* OK */</span>
<a name="l00461"></a>00461         <span class="keywordflow">else</span> {
<a name="l00462"></a>00462             <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00463"></a>00463                 <span class="keywordflow">if</span> (sock==fromsock)
<a name="l00464"></a>00464                     <span class="keywordflow">break</span>;
<a name="l00465"></a>00465             <span class="keywordflow">if</span> (sock)
<a name="l00466"></a>00466                 from= -1; <span class="comment">/* OK but flip */</span>
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469     <span class="keywordflow">if</span> (tonode) {
<a name="l00470"></a>00470         <span class="keywordflow">for</span> (sock= tonode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00471"></a>00471             <span class="keywordflow">if</span> (sock==tosock)
<a name="l00472"></a>00472                 <span class="keywordflow">break</span>;
<a name="l00473"></a>00473         <span class="keywordflow">if</span> (sock)
<a name="l00474"></a>00474             to= 1; <span class="comment">/* OK */</span>
<a name="l00475"></a>00475         <span class="keywordflow">else</span> {
<a name="l00476"></a>00476             <span class="keywordflow">for</span> (sock= tonode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00477"></a>00477                 <span class="keywordflow">if</span> (sock==tosock)
<a name="l00478"></a>00478                     <span class="keywordflow">break</span>;
<a name="l00479"></a>00479             <span class="keywordflow">if</span> (sock)
<a name="l00480"></a>00480                 to= -1; <span class="comment">/* OK but flip */</span>
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     <span class="keywordflow">else</span> {
<a name="l00484"></a>00484         <span class="comment">/* check tree sockets */</span>
<a name="l00485"></a>00485         <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00486"></a>00486             <span class="keywordflow">if</span> (sock==tosock)
<a name="l00487"></a>00487                 <span class="keywordflow">break</span>;
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (sock)
<a name="l00489"></a>00489             to= 1; <span class="comment">/* OK */</span>
<a name="l00490"></a>00490         <span class="keywordflow">else</span> {
<a name="l00491"></a>00491             <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00492"></a>00492                 <span class="keywordflow">if</span> (sock==tosock)
<a name="l00493"></a>00493                     <span class="keywordflow">break</span>;
<a name="l00494"></a>00494             <span class="keywordflow">if</span> (sock)
<a name="l00495"></a>00495                 to= -1; <span class="comment">/* OK but flip */</span>
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498     
<a name="l00499"></a>00499     <span class="keywordflow">if</span> (from &gt;= 0 &amp;&amp; to &gt;= 0) {
<a name="l00500"></a>00500         link= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a>), <span class="stringliteral">&quot;link&quot;</span>);
<a name="l00501"></a>00501         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l00502"></a>00502         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= fromnode;
<a name="l00503"></a>00503         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= fromsock;
<a name="l00504"></a>00504         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= tonode;
<a name="l00505"></a>00505         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= tosock;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (from &lt;= 0 &amp;&amp; to &lt;= 0) {
<a name="l00508"></a>00508         link= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a>), <span class="stringliteral">&quot;link&quot;</span>);
<a name="l00509"></a>00509         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l00510"></a>00510         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= tonode;
<a name="l00511"></a>00511         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= tosock;
<a name="l00512"></a>00512         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= fromnode;
<a name="l00513"></a>00513         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= fromsock;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l00517"></a>00517     
<a name="l00518"></a>00518     <span class="keywordflow">return</span> <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a><a class="code" href="../../dd/d2d/node_8c.html#aa8f8de28f9df044ea39b84bfef9005c6">00521</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>)
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>)
<a name="l00525"></a>00525         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00526"></a>00526     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(link);
<a name="l00527"></a>00527     
<a name="l00528"></a>00528     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="../../dd/d2d/node_8c.html#aac749aa3e5cb67b5d299b2a1f93de871">00531</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a2ea3b16bccdfe374b7c1a19435ef4350">nodeRemSocketLinks</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00534"></a>00534     
<a name="l00535"></a>00535     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= next) {
<a name="l00536"></a>00536         next= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l00537"></a>00537         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==sock || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==sock) {
<a name="l00538"></a>00538             <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00539"></a>00539         }
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541     
<a name="l00542"></a>00542     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 
<a name="l00545"></a><a class="code" href="../../dd/d2d/node_8c.html#a989f81c25d93e68130876104b2bd2c53">00545</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a28c5a2c4425a5a23de80e2715a6bb816">nodeInternalRelink</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *link_next;
<a name="l00548"></a>00548     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> intlinks;
<a name="l00549"></a>00549     
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (!node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a>)
<a name="l00551"></a>00551         <span class="keywordflow">return</span>;
<a name="l00552"></a>00552     
<a name="l00553"></a>00553     intlinks = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a>(ntree, node);
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     <span class="comment">/* store link pointers in output sockets, for efficient lookup */</span>
<a name="l00556"></a>00556     <span class="keywordflow">for</span> (link=intlinks.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l00557"></a>00557         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a> = <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00558"></a>00558     
<a name="l00559"></a>00559     <span class="comment">/* redirect downstream links */</span>
<a name="l00560"></a>00560     <span class="keywordflow">for</span> (link=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link_next) {
<a name="l00561"></a>00561         link_next = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l00562"></a>00562         
<a name="l00563"></a>00563         <span class="comment">/* do we have internal link? */</span>
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>==node) {
<a name="l00565"></a>00565             <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>) {
<a name="l00566"></a>00566                 <span class="comment">/* get the upstream input link */</span>
<a name="l00567"></a>00567                 <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *fromlink = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>;
<a name="l00568"></a>00568                 <span class="comment">/* skip the node */</span>
<a name="l00569"></a>00569                 <span class="keywordflow">if</span> (fromlink) {
<a name="l00570"></a>00570                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> = fromlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>;
<a name="l00571"></a>00571                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a> = fromlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>;
<a name="l00572"></a>00572                     
<a name="l00573"></a>00573                     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l00574"></a>00574                 }
<a name="l00575"></a>00575                 <span class="keywordflow">else</span>
<a name="l00576"></a>00576                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00577"></a>00577             }
<a name="l00578"></a>00578             <span class="keywordflow">else</span>
<a name="l00579"></a>00579                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00580"></a>00580         }
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582     
<a name="l00583"></a>00583     <span class="comment">/* remove remaining upstream links */</span>
<a name="l00584"></a>00584     <span class="keywordflow">for</span> (link=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link_next) {
<a name="l00585"></a>00585         link_next = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l00586"></a>00586         
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>==node)
<a name="l00588"></a>00588             <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590     
<a name="l00591"></a>00591     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;intlinks);
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="comment">/* transforms node location to area coords */</span>
<a name="l00595"></a><a class="code" href="../../dd/d2d/node_8c.html#a9eb359055cb3125cd4b2136ff9a6cab2">00595</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c9277adafb36f9bcca7b8f6e27dcb78">nodeSpaceCoords</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">float</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>, <span class="keywordtype">float</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>)
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>) {
<a name="l00598"></a>00598         <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c9277adafb36f9bcca7b8f6e27dcb78">nodeSpaceCoords</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>, locx, locy);
<a name="l00599"></a>00599         *locx += node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>;
<a name="l00600"></a>00600         *locy += node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>;
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     <span class="keywordflow">else</span> {
<a name="l00603"></a>00603         *locx = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>;
<a name="l00604"></a>00604         *locy = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>;
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a><a class="code" href="../../dd/d2d/node_8c.html#af3d6e829e0f2e7c8dcc3e8f6fa365dfa">00608</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a6045214a4d26524eeeb49eb4c1d0a8f5">nodeAttachNode</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *parent)
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610     <span class="keywordtype">float</span> parentx, parenty;
<a name="l00611"></a>00611     
<a name="l00612"></a>00612     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a> = parent;
<a name="l00613"></a>00613     <span class="comment">/* transform to parent space */</span>
<a name="l00614"></a>00614     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c9277adafb36f9bcca7b8f6e27dcb78">nodeSpaceCoords</a>(parent, &amp;parentx, &amp;parenty);
<a name="l00615"></a>00615     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a> -= parentx;
<a name="l00616"></a>00616     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a> -= parenty;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="../../dd/d2d/node_8c.html#ae533a989f90d55311cafea5673d9adb1">00619</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ae533a989f90d55311cafea5673d9adb1">nodeDetachNode</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621     <span class="keywordtype">float</span> parentx, parenty;
<a name="l00622"></a>00622     
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>) {
<a name="l00624"></a>00624         <span class="comment">/* transform to &quot;global&quot; (area) space */</span>
<a name="l00625"></a>00625         <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c9277adafb36f9bcca7b8f6e27dcb78">nodeSpaceCoords</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>, &amp;parentx, &amp;parenty);
<a name="l00626"></a>00626         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a> += parentx;
<a name="l00627"></a>00627         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a> += parenty;
<a name="l00628"></a>00628         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="../../dd/d2d/node_8c.html#a05c73006f30c6cc0fc61105446e19098">00632</a> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a061b08730b913443f7b577f99ae284c1">ntreeAddTree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, <span class="keywordtype">int</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, <span class="keywordtype">int</span> nodetype)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l00635"></a>00635     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype;
<a name="l00636"></a>00636     
<a name="l00637"></a>00637     <span class="comment">/* trees are created as local trees if they of compositor, material or texture type,</span>
<a name="l00638"></a>00638 <span class="comment">     * node groups and other tree types are created as library data.</span>
<a name="l00639"></a>00639 <span class="comment">     */</span>
<a name="l00640"></a>00640     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(type, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>) &amp;&amp; nodetype==0) {
<a name="l00641"></a>00641         ntree= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>), <span class="stringliteral">&quot;new node tree&quot;</span>);
<a name="l00642"></a>00642         *( (<span class="keywordtype">short</span> *)ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> )= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>; <span class="comment">/* not &quot;type&quot;, as that is ntree-&gt;type */</span>
<a name="l00643"></a>00643         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, name, <span class="keyword">sizeof</span>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>));
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     <span class="keywordflow">else</span>
<a name="l00646"></a>00646         ntree= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;nodetree, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>, name);
<a name="l00647"></a>00647     
<a name="l00648"></a>00648     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>= <a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>;
<a name="l00649"></a>00649     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae174135c0568adeb8a45d7697ae378a9">nodetype</a> = nodetype;
<a name="l00650"></a>00650     
<a name="l00651"></a>00651     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9e5866b70fc15f2998753843f0d45cda">ntreeInitTypes</a>(ntree);
<a name="l00652"></a>00652     
<a name="l00653"></a>00653     ntype = <a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(ntree, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae174135c0568adeb8a45d7697ae378a9">nodetype</a>);
<a name="l00654"></a>00654     <span class="keywordflow">if</span> (ntype &amp;&amp; ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad8c3e38a6810153a46ce2b5723057c1f" title="Initialize a node tree associated to this node type.">inittreefunc</a>)
<a name="l00655"></a>00655         ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad8c3e38a6810153a46ce2b5723057c1f" title="Initialize a node tree associated to this node type.">inittreefunc</a>(ntree);
<a name="l00656"></a>00656     
<a name="l00657"></a>00657     <span class="keywordflow">return</span> ntree;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="comment">/* Warning: this function gets called during some rather unexpected times</span>
<a name="l00661"></a>00661 <span class="comment"> *  - this gets called when executing compositing updates (for threaded previews)</span>
<a name="l00662"></a>00662 <span class="comment"> *  - when the nodetree datablock needs to be copied (i.e. when users get copied)</span>
<a name="l00663"></a>00663 <span class="comment"> *  - for scene duplication use ntreeSwapID() after so we don&#39;t have stale pointers.</span>
<a name="l00664"></a>00664 <span class="comment"> */</span>
<a name="l00665"></a><a class="code" href="../../dd/d2d/node_8c.html#aeb7d17d2df4e670dcd51b27a19ef1eb2">00665</a> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a42a2adacc98ae098c53b06a35258af8e">ntreeCopyTree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *newtree;
<a name="l00668"></a>00668     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node <span class="comment">/*, *nnode */</span> <span class="comment">/* UNUSED */</span>, *last;
<a name="l00669"></a>00669     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00670"></a>00670     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *gsock, *oldgsock;
<a name="l00671"></a>00671     
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00673"></a>00673     
<a name="l00674"></a>00674     <span class="comment">/* is ntree part of library? */</span>
<a name="l00675"></a>00675     <span class="keywordflow">for</span> (newtree=<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;nodetree.first; newtree; newtree= newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l00676"></a>00676         <span class="keywordflow">if</span> (newtree==ntree) <span class="keywordflow">break</span>;
<a name="l00677"></a>00677     <span class="keywordflow">if</span> (newtree) {
<a name="l00678"></a>00678         newtree= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0c0c1987364874c73cda326eace31efd">copy_libblock</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>);
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     <span class="keywordflow">else</span> {
<a name="l00681"></a>00681         newtree= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(ntree);
<a name="l00682"></a>00682         <a class="code" href="../../d8/db1/BKE__library_8h.html#a9f87a052d210246269f5c486356d8988">copy_libblock_data</a>(&amp;newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>); <span class="comment">/* copy animdata and ID props */</span>
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a7ef055ce6415a7293a1bc5fa307dd2b5">gpd</a>);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687     <span class="comment">/* in case a running nodetree is copied */</span>
<a name="l00688"></a>00688     newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00689"></a>00689     
<a name="l00690"></a>00690     newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00691"></a>00691     newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00692"></a>00692     
<a name="l00693"></a>00693     last = ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l00694"></a>00694     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00695"></a>00695         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00696"></a>00696         <span class="comment">/* nnode= */</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#abf956330b2cdbf553a616ec2f866d20d">nodeCopyNode</a>(newtree, node);   <span class="comment">/* sets node-&gt;new */</span>
<a name="l00697"></a>00697         
<a name="l00698"></a>00698         <span class="comment">/* make sure we don&#39;t copy new nodes again! */</span>
<a name="l00699"></a>00699         <span class="keywordflow">if</span> (node==last)
<a name="l00700"></a>00700             <span class="keywordflow">break</span>;
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     
<a name="l00703"></a>00703     <span class="comment">/* socket definition for group usage */</span>
<a name="l00704"></a>00704     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>);
<a name="l00705"></a>00705     <span class="keywordflow">for</span> (gsock= newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, oldgsock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gsock; gsock=gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, oldgsock=oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00706"></a>00706         oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>= gsock;
<a name="l00707"></a>00707         gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae2b132eaf8a8c28488808fbc4387fa02">groupsock</a> = (oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae2b132eaf8a8c28488808fbc4387fa02">groupsock</a> ? oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae2b132eaf8a8c28488808fbc4387fa02">groupsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00708"></a>00708         gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d28/node__socket_8c.html#a06af3f435abfc0756d1e3f87c90b19dd">node_socket_make_default_value</a>(oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00709"></a>00709         <a class="code" href="../../da/d28/node__socket_8c.html#a1fe65fdadd6912d9db74d77e6eb8e3e0">node_socket_copy_default_value</a>(oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>, oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>);
<a name="l00712"></a>00712     <span class="keywordflow">for</span> (gsock= newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, oldgsock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gsock; gsock=gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, oldgsock=oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00713"></a>00713         oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>= gsock;
<a name="l00714"></a>00714         gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae2b132eaf8a8c28488808fbc4387fa02">groupsock</a> = (oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae2b132eaf8a8c28488808fbc4387fa02">groupsock</a> ? oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae2b132eaf8a8c28488808fbc4387fa02">groupsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00715"></a>00715         gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d28/node__socket_8c.html#a06af3f435abfc0756d1e3f87c90b19dd">node_socket_make_default_value</a>(oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00716"></a>00716         <a class="code" href="../../da/d28/node__socket_8c.html#a1fe65fdadd6912d9db74d77e6eb8e3e0">node_socket_copy_default_value</a>(oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, gsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>, oldgsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718     
<a name="l00719"></a>00719     <span class="comment">/* copy links */</span>
<a name="l00720"></a>00720     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>);
<a name="l00721"></a>00721     <span class="keywordflow">for</span> (link= newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l00722"></a>00722         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> = (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> ? link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00723"></a>00723         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a> = (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a> ? link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00724"></a>00724         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> = (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> ? link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00725"></a>00725         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> = (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> ? link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00726"></a>00726         <span class="comment">/* update the link socket&#39;s pointer */</span>
<a name="l00727"></a>00727         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>)
<a name="l00728"></a>00728             link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a> = <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     
<a name="l00731"></a>00731     <span class="comment">/* update node-&gt;parent pointers */</span>
<a name="l00732"></a>00732     <span class="keywordflow">for</span> (node=newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00733"></a>00733         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>)
<a name="l00734"></a>00734             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a> = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>;
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736     
<a name="l00737"></a>00737     <span class="keywordflow">return</span> newtree;
<a name="l00738"></a>00738 }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 <span class="comment">/* use when duplicating scenes */</span>
<a name="l00741"></a><a class="code" href="../../dd/d2d/node_8c.html#ac6e0d944f6ca1eed8b01e1b3a9a4cbbe">00741</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a8c9edc14a2b0f8f88573fe7250d05eb8">ntreeSwitchID</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d8/d7e/structID.html">ID</a> *id_from, <a class="code" href="../../d8/d7e/structID.html">ID</a> *id_to)
<a name="l00742"></a>00742 {
<a name="l00743"></a>00743     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00744"></a>00744     <span class="comment">/* for scene duplication only */</span>
<a name="l00745"></a>00745     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00746"></a>00746         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==id_from) {
<a name="l00747"></a>00747             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= id_to;
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750 }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 <span class="comment">/* *************** preview *********** */</span>
<a name="l00753"></a>00753 <span class="comment">/* if node-&gt;preview, then we assume the rect to exist */</span>
<a name="l00754"></a>00754 
<a name="l00755"></a><a class="code" href="../../dd/d2d/node_8c.html#abbfbe1a42e50ced3afd429588ec0d8cc">00755</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#afaeddf09fd0ee090b3dc02e6ef1d3dba">nodeFreePreview</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>) {
<a name="l00758"></a>00758         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>)
<a name="l00759"></a>00759             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>);
<a name="l00760"></a>00760         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>);
<a name="l00761"></a>00761         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00762"></a>00762     }   
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="../../dd/d2d/node_8c.html#a2e587a71c308139382ccb65aa8c77835">00765</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a2e587a71c308139382ccb65aa8c77835">node_init_preview</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> xsize, <span class="keywordtype">int</span> ysize)
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767     
<a name="l00768"></a>00768     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00769"></a>00769         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/d14/structbNodePreview.html">bNodePreview</a>), <span class="stringliteral">&quot;node preview&quot;</span>);
<a name="l00770"></a>00770         <span class="comment">//      printf(&quot;added preview %s\n&quot;, node-&gt;name);</span>
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772     
<a name="l00773"></a>00773     <span class="comment">/* node previews can get added with variable size this way */</span>
<a name="l00774"></a>00774     <span class="keywordflow">if</span> (xsize==0 || ysize==0)
<a name="l00775"></a>00775         <span class="keywordflow">return</span>;
<a name="l00776"></a>00776     
<a name="l00777"></a>00777     <span class="comment">/* sanity checks &amp; initialize */</span>
<a name="l00778"></a>00778     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>) {
<a name="l00779"></a>00779         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a>!=xsize &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a608ade12fcd89ca6217376f8c65718ba">ysize</a>!=ysize) {
<a name="l00780"></a>00780             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>);
<a name="l00781"></a>00781             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784     
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00786"></a>00786         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(4*xsize + xsize*ysize*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*4, <span class="stringliteral">&quot;node preview rect&quot;</span>);
<a name="l00787"></a>00787         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a>= xsize;
<a name="l00788"></a>00788         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a608ade12fcd89ca6217376f8c65718ba">ysize</a>= ysize;
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790     <span class="comment">/* no clear, makes nicer previews */</span>
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a><a class="code" href="../../dd/d2d/node_8c.html#a1ee1dc3b98dc6ccbb6b8153adc316154">00793</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ad4c3524fcab7c01db938bac27bad9112">ntreeInitPreview</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">int</span> xsize, <span class="keywordtype">int</span> ysize)
<a name="l00794"></a>00794 {
<a name="l00795"></a>00795     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00796"></a>00796     
<a name="l00797"></a>00797     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00798"></a>00798         <span class="keywordflow">return</span>;
<a name="l00799"></a>00799     
<a name="l00800"></a>00800     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00801"></a>00801         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>)    <span class="comment">/* hrms, check for closed nodes? */</span>
<a name="l00802"></a>00802             <a class="code" href="../../dd/d2d/node_8c.html#a2e587a71c308139382ccb65aa8c77835">node_init_preview</a>(node, xsize, ysize);
<a name="l00803"></a>00803         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>))
<a name="l00804"></a>00804             <a class="code" href="../../d4/d91/BKE__node_8h.html#ad4c3524fcab7c01db938bac27bad9112">ntreeInitPreview</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>, xsize, ysize);
<a name="l00805"></a>00805     }       
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00808"></a><a class="code" href="../../dd/d2d/node_8c.html#a5b3ac74554c3702a2e8c2f07f0399919">00808</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a5b3ac74554c3702a2e8c2f07f0399919">nodeClearPreview</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00809"></a>00809 {
<a name="l00810"></a>00810     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>)
<a name="l00811"></a>00811         memset(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>, 0, <a class="code" href="../../da/d2b/mallocn_8c.html#a7d1e6a2f5f9d271452a168d3a637d91f">MEM_allocN_len</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>));
<a name="l00812"></a>00812 }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 <span class="comment">/* use it to enforce clear */</span>
<a name="l00815"></a><a class="code" href="../../dd/d2d/node_8c.html#ab202a9d880c1b7f27805293a6472d77e">00815</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ac65e67cff842c9b2908ccd1b22dcc6fc">ntreeClearPreview</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00818"></a>00818     
<a name="l00819"></a>00819     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00820"></a>00820         <span class="keywordflow">return</span>;
<a name="l00821"></a>00821     
<a name="l00822"></a>00822     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00823"></a>00823         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>)
<a name="l00824"></a>00824             <a class="code" href="../../dd/d2d/node_8c.html#a5b3ac74554c3702a2e8c2f07f0399919">nodeClearPreview</a>(node);
<a name="l00825"></a>00825         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>))
<a name="l00826"></a>00826             <a class="code" href="../../d4/d91/BKE__node_8h.html#ac65e67cff842c9b2908ccd1b22dcc6fc">ntreeClearPreview</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00827"></a>00827     }       
<a name="l00828"></a>00828 }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830 <span class="comment">/* hack warning! this function is only used for shader previews, and </span>
<a name="l00831"></a>00831 <span class="comment"> * since it gets called multiple times per pixel for Ztransp we only</span>
<a name="l00832"></a>00832 <span class="comment"> * add the color once. Preview gets cleared before it starts render though */</span>
<a name="l00833"></a><a class="code" href="../../dd/d2d/node_8c.html#abd3f2e4ec8acc9b2fafcc5b5d545ba30">00833</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a52c85e4fff220c08536914f7c129ee99">nodeAddToPreview</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">float</span> *col, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> do_manage)
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835     <a class="code" href="../../de/d14/structbNodePreview.html">bNodePreview</a> *preview= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>;
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (preview) {
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (x&gt;=0 &amp;&amp; y&gt;=0) {
<a name="l00838"></a>00838             <span class="keywordflow">if</span> (x&lt;preview-&gt;xsize &amp;&amp; y&lt;preview-&gt;ysize) {
<a name="l00839"></a>00839                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tar= preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>+ 4*((preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a>*y) + x);
<a name="l00840"></a>00840                 
<a name="l00841"></a>00841                 <span class="keywordflow">if</span> (do_manage) {
<a name="l00842"></a>00842                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#aa806866375a2664c2ecc72d1d8bcb58b">linearrgb_to_srgb_uchar4</a>(tar, col);
<a name="l00843"></a>00843                 }
<a name="l00844"></a>00844                 <span class="keywordflow">else</span> {
<a name="l00845"></a>00845                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#ae4ca069c8f950fd8499b3aaa9c0a57d6">rgba_float_to_uchar</a>(tar, col);
<a name="l00846"></a>00846                 }
<a name="l00847"></a>00847             }
<a name="l00848"></a>00848             <span class="comment">//else printf(&quot;prv out bound x y %d %d\n&quot;, x, y);</span>
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850         <span class="comment">//else printf(&quot;prv out bound x y %d %d\n&quot;, x, y);</span>
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852 }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 <span class="comment">/* ************** Free stuff ********** */</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856 <span class="comment">/* goes over entire tree */</span>
<a name="l00857"></a><a class="code" href="../../dd/d2d/node_8c.html#ad6d02c73ee50dd6aea427d274caebea9">00857</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aeefad39a6d7f6b7ed79ea95bae4d3766">nodeUnlinkNode</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00860"></a>00860     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00861"></a>00861     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb;
<a name="l00862"></a>00862     
<a name="l00863"></a>00863     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= next) {
<a name="l00864"></a>00864         next= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l00865"></a>00865         
<a name="l00866"></a>00866         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>==node) {
<a name="l00867"></a>00867             lb= &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>;
<a name="l00868"></a>00868             <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>)
<a name="l00869"></a>00869                 link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae67319bd4d588921dc74a7d025065c15">NODE_UPDATE</a>;
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>==node)
<a name="l00872"></a>00872             lb= &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>;
<a name="l00873"></a>00873         <span class="keywordflow">else</span>
<a name="l00874"></a>00874             lb= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876         <span class="keywordflow">if</span> (lb) {
<a name="l00877"></a>00877             <span class="keywordflow">for</span> (sock= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00878"></a>00878                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==sock || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==sock)
<a name="l00879"></a>00879                     <span class="keywordflow">break</span>;
<a name="l00880"></a>00880             }
<a name="l00881"></a>00881             <span class="keywordflow">if</span> (sock) {
<a name="l00882"></a>00882                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l00883"></a>00883             }
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885     }
<a name="l00886"></a>00886 }
<a name="l00887"></a>00887 
<a name="l00888"></a><a class="code" href="../../dd/d2d/node_8c.html#a753d37666319d0381696ede25ee2db0d">00888</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a753d37666319d0381696ede25ee2db0d">node_unlink_attached</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *parent)
<a name="l00889"></a>00889 {
<a name="l00890"></a>00890     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00891"></a>00891     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00892"></a>00892         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a> == parent)
<a name="l00893"></a>00893             <a class="code" href="../../d4/d91/BKE__node_8h.html#ae533a989f90d55311cafea5673d9adb1">nodeDetachNode</a>(node);
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 
<a name="l00897"></a><a class="code" href="../../dd/d2d/node_8c.html#a2e4df35a444c6bd7e2723434eacdeb84">00897</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a6913c62630bd85b7514bebc6e58c5d51">nodeFreeNode</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *treetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l00900"></a>00900     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, *nextsock;
<a name="l00901"></a>00901     
<a name="l00902"></a>00902     <span class="comment">/* remove all references to this node */</span>
<a name="l00903"></a>00903     <a class="code" href="../../d4/d91/BKE__node_8h.html#aeefad39a6d7f6b7ed79ea95bae4d3766">nodeUnlinkNode</a>(ntree, node);
<a name="l00904"></a>00904     <a class="code" href="../../dd/d2d/node_8c.html#a753d37666319d0381696ede25ee2db0d">node_unlink_attached</a>(ntree, node);
<a name="l00905"></a>00905     
<a name="l00906"></a>00906     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>, node);
<a name="l00907"></a>00907     
<a name="l00908"></a>00908     <span class="comment">/* since it is called while free database, node-&gt;id is undefined */</span>
<a name="l00909"></a>00909     
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (treetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#ac3ec2bd1823bde30b46e4898ce82d551">free_node_cache</a>)
<a name="l00911"></a>00911         treetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#ac3ec2bd1823bde30b46e4898ce82d551">free_node_cache</a>(ntree, node);
<a name="l00912"></a>00912     
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a62aaec501f05dc7251595c5eb63d6206" title="Free the custom storage data.">freestoragefunc</a>)
<a name="l00914"></a>00914         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a62aaec501f05dc7251595c5eb63d6206" title="Free the custom storage data.">freestoragefunc</a>(node);
<a name="l00915"></a>00915     
<a name="l00916"></a>00916     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock = nextsock) {
<a name="l00917"></a>00917         nextsock = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>;
<a name="l00918"></a>00918         <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00919"></a>00919         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sock);
<a name="l00920"></a>00920     }
<a name="l00921"></a>00921     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock = nextsock) {
<a name="l00922"></a>00922         nextsock = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>;
<a name="l00923"></a>00923         <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00924"></a>00924         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sock);
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <a class="code" href="../../d4/d91/BKE__node_8h.html#afaeddf09fd0ee090b3dc02e6ef1d3dba">nodeFreePreview</a>(node);
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node);
<a name="l00930"></a>00930     
<a name="l00931"></a>00931     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bd987034ba27bfa2562c511f38c2d23">NTREE_UPDATE_NODES</a>;
<a name="l00932"></a>00932 }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 <span class="comment">/* do not free ntree itself here, free_libblock calls this function too */</span>
<a name="l00935"></a><a class="code" href="../../dd/d2d/node_8c.html#a86536d71b0278caa9de28c57fd1f710d">00935</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a5f6d61a1f4a0daa3dab1624a1335f947">ntreeFreeTree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00936"></a>00936 {
<a name="l00937"></a>00937     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00938"></a>00938     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00939"></a>00939     
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00941"></a>00941     
<a name="l00942"></a>00942     <span class="comment">/* XXX hack! node trees should not store execution graphs at all.</span>
<a name="l00943"></a>00943 <span class="comment">     * This should be removed when old tree types no longer require it.</span>
<a name="l00944"></a>00944 <span class="comment">     * Currently the execution data for texture nodes remains in the tree</span>
<a name="l00945"></a>00945 <span class="comment">     * after execution, until the node tree is updated or freed.</span>
<a name="l00946"></a>00946 <span class="comment">     */</span>
<a name="l00947"></a>00947     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>) {
<a name="l00948"></a>00948         <span class="keywordflow">switch</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>) {
<a name="l00949"></a>00949         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>:
<a name="l00950"></a>00950             <a class="code" href="../../d4/d91/BKE__node_8h.html#af898c8382fa74b9785f6489117c36aa4">ntreeCompositEndExecTree</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>, 1);
<a name="l00951"></a>00951             <span class="keywordflow">break</span>;
<a name="l00952"></a>00952         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>:
<a name="l00953"></a>00953             <a class="code" href="../../d4/d91/BKE__node_8h.html#a9d92bf95395b13310ef34c076176c84c">ntreeShaderEndExecTree</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>, 1);
<a name="l00954"></a>00954             <span class="keywordflow">break</span>;
<a name="l00955"></a>00955         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>:
<a name="l00956"></a>00956             <a class="code" href="../../d4/d91/BKE__node_8h.html#a724a94a118bf6c8c74e2e06464652211">ntreeTexEndExecTree</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>, 1);
<a name="l00957"></a>00957             <span class="keywordflow">break</span>;
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960     
<a name="l00961"></a>00961     <a class="code" href="../../dc/d51/BKE__animsys_8h.html#a186ce67df8bf9873cc945eed480eaa49">BKE_free_animdata</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree);
<a name="l00962"></a>00962     
<a name="l00963"></a>00963     <a class="code" href="../../d8/db1/BKE__library_8h.html#a2caead3c3bda9441d1a4affbbe0d328b">id_us_min</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree-&gt;gpd);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ntree-&gt;links);   <span class="comment">/* do first, then unlink_node goes fast */</span>
<a name="l00966"></a>00966     
<a name="l00967"></a>00967     <span class="keywordflow">for</span> (node= ntree-&gt;nodes.first; node; node= next) {
<a name="l00968"></a>00968         next= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l00969"></a>00969         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6913c62630bd85b7514bebc6e58c5d51">nodeFreeNode</a>(ntree, node);
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971     
<a name="l00972"></a>00972     <span class="keywordflow">for</span> (sock=ntree-&gt;inputs.first; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00973"></a>00973         <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00974"></a>00974     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ntree-&gt;inputs);
<a name="l00975"></a>00975     <span class="keywordflow">for</span> (sock=ntree-&gt;outputs.first; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00976"></a>00976         <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00977"></a>00977     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ntree-&gt;outputs);
<a name="l00978"></a>00978 }
<a name="l00979"></a>00979 
<a name="l00980"></a><a class="code" href="../../dd/d2d/node_8c.html#a5498e5035afcd86bfae26406bd9e085f">00980</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a55320a68c2b2edcd81acf2807434c546">ntreeFreeCache</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00981"></a>00981 {
<a name="l00982"></a>00982     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *treetype;
<a name="l00983"></a>00983     
<a name="l00984"></a>00984     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00985"></a>00985     
<a name="l00986"></a>00986     treetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (treetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a44b696565b93d26c3b0e81e350baff3e">free_cache</a>)
<a name="l00988"></a>00988         treetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a44b696565b93d26c3b0e81e350baff3e">free_cache</a>(ntree);
<a name="l00989"></a>00989 }
<a name="l00990"></a>00990 
<a name="l00991"></a><a class="code" href="../../dd/d2d/node_8c.html#a24375f5affe42513e9fd7b14b07b6c53">00991</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a9bc46b59ae07500da394cfd467c24b10">ntreeSetOutput</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00992"></a>00992 {
<a name="l00993"></a>00993     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="comment">/* find the active outputs, might become tree type dependent handler */</span>
<a name="l00996"></a>00996     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00997"></a>00997         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a0c1dfc239a1caee873fa06628a828b02">NODE_CLASS_OUTPUT</a>) {
<a name="l00998"></a>00998             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tnode;
<a name="l00999"></a>00999             <span class="keywordtype">int</span> output= 0;
<a name="l01000"></a>01000             
<a name="l01001"></a>01001             <span class="comment">/* we need a check for which output node should be tagged like this, below an exception */</span>
<a name="l01002"></a>01002             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a993ae4ed5e6e026e42a3f81b3ef71787">CMP_NODE_OUTPUT_FILE</a>)
<a name="l01003"></a>01003                 <span class="keywordflow">continue</span>;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005             <span class="comment">/* there is more types having output class, each one is checked */</span>
<a name="l01006"></a>01006             <span class="keywordflow">for</span> (tnode= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tnode; tnode= tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01007"></a>01007                 <span class="keywordflow">if</span> (tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a0c1dfc239a1caee873fa06628a828b02">NODE_CLASS_OUTPUT</a>) {
<a name="l01008"></a>01008                     
<a name="l01009"></a>01009                     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l01010"></a>01010                             
<a name="l01011"></a>01011                         <span class="comment">/* same type, exception for viewer */</span>
<a name="l01012"></a>01012                         <span class="keywordflow">if</span> (tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> ||
<a name="l01013"></a>01013                            (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>) &amp;&amp;
<a name="l01014"></a>01014                             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>))) {
<a name="l01015"></a>01015                             <span class="keywordflow">if</span> (tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>) {
<a name="l01016"></a>01016                                 output++;
<a name="l01017"></a>01017                                 <span class="keywordflow">if</span> (output&gt;1)
<a name="l01018"></a>01018                                     tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l01019"></a>01019                             }
<a name="l01020"></a>01020                         }
<a name="l01021"></a>01021                     }
<a name="l01022"></a>01022                     <span class="keywordflow">else</span> {
<a name="l01023"></a>01023                         <span class="comment">/* same type */</span>
<a name="l01024"></a>01024                         <span class="keywordflow">if</span> (tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>) {
<a name="l01025"></a>01025                             <span class="keywordflow">if</span> (tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>) {
<a name="l01026"></a>01026                                 output++;
<a name="l01027"></a>01027                                 <span class="keywordflow">if</span> (output&gt;1)
<a name="l01028"></a>01028                                     tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l01029"></a>01029                             }
<a name="l01030"></a>01030                         }
<a name="l01031"></a>01031                     }
<a name="l01032"></a>01032                 }
<a name="l01033"></a>01033             }
<a name="l01034"></a>01034             <span class="keywordflow">if</span> (output==0)
<a name="l01035"></a>01035                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l01036"></a>01036         }
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038     
<a name="l01039"></a>01039     <span class="comment">/* here we could recursively set which nodes have to be done,</span>
<a name="l01040"></a>01040 <span class="comment">     * might be different for editor or for &quot;real&quot; use... */</span>
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 
<a name="l01043"></a><a class="code" href="../../d4/dc4/structMakeLocalCallData.html">01043</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/dc4/structMakeLocalCallData.html">MakeLocalCallData</a> {
<a name="l01044"></a><a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a96f62a07046d0876733c716b31190d7b">01044</a>     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a96f62a07046d0876733c716b31190d7b">group_id</a>;
<a name="l01045"></a><a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a0b3a4b74736213fac6417b6ebb87fd69">01045</a>     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a0b3a4b74736213fac6417b6ebb87fd69">new_id</a>;
<a name="l01046"></a><a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a78a247ffbb8d1703f7bab1943240f4c3">01046</a>     <span class="keywordtype">int</span> <a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a5f170add80b640d5552d866c19d60fe1">lib</a>, <a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a78a247ffbb8d1703f7bab1943240f4c3">local</a>;
<a name="l01047"></a>01047 } <a class="code" href="../../dd/d2d/node_8c.html#a4edee0f80ff1a2941f8e2117a32e162c">MakeLocalCallData</a>;
<a name="l01048"></a>01048 
<a name="l01049"></a><a class="code" href="../../dd/d2d/node_8c.html#a99cf400cd561c572a50076925b47ed48">01049</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a99cf400cd561c572a50076925b47ed48">ntreeMakeLocal_CheckLocal</a>(<span class="keywordtype">void</span> *calldata, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01050"></a>01050 {
<a name="l01051"></a>01051     <a class="code" href="../../d4/dc4/structMakeLocalCallData.html">MakeLocalCallData</a> *cd= (<a class="code" href="../../d4/dc4/structMakeLocalCallData.html">MakeLocalCallData</a>*)calldata;
<a name="l01052"></a>01052     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01053"></a>01053     
<a name="l01054"></a>01054     <span class="comment">/* find if group is in tree */</span>
<a name="l01055"></a>01055     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01056"></a>01056         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> == cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a96f62a07046d0876733c716b31190d7b">group_id</a>) {
<a name="l01057"></a>01057             <span class="keywordflow">if</span> (owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a5f170add80b640d5552d866c19d60fe1">lib</a>= 1;
<a name="l01058"></a>01058             <span class="keywordflow">else</span> cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a78a247ffbb8d1703f7bab1943240f4c3">local</a>= 1;
<a name="l01059"></a>01059         }
<a name="l01060"></a>01060     }
<a name="l01061"></a>01061 }
<a name="l01062"></a>01062 
<a name="l01063"></a><a class="code" href="../../dd/d2d/node_8c.html#a955929bb46eb907b5f40ea2554b4cdf9">01063</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a955929bb46eb907b5f40ea2554b4cdf9">ntreeMakeLocal_LinkNew</a>(<span class="keywordtype">void</span> *calldata, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01064"></a>01064 {
<a name="l01065"></a>01065     <a class="code" href="../../d4/dc4/structMakeLocalCallData.html">MakeLocalCallData</a> *cd= (<a class="code" href="../../d4/dc4/structMakeLocalCallData.html">MakeLocalCallData</a>*)calldata;
<a name="l01066"></a>01066     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01067"></a>01067     
<a name="l01068"></a>01068     <span class="comment">/* find if group is in tree */</span>
<a name="l01069"></a>01069     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01070"></a>01070         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> == cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a96f62a07046d0876733c716b31190d7b">group_id</a>) {
<a name="l01071"></a>01071             <span class="keywordflow">if</span> (owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01072"></a>01072                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a0b3a4b74736213fac6417b6ebb87fd69">new_id</a>;
<a name="l01073"></a>01073                 cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a0b3a4b74736213fac6417b6ebb87fd69">new_id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l01074"></a>01074                 cd-&gt;<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a96f62a07046d0876733c716b31190d7b">group_id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l01075"></a>01075             }
<a name="l01076"></a>01076         }
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a><a class="code" href="../../dd/d2d/node_8c.html#ab147da13371b74ac4454355efdd8653d">01080</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a9d99c449b4d87a1605cdd2d8c3cf93b4">ntreeMakeLocal</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01081"></a>01081 {
<a name="l01082"></a>01082     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l01083"></a>01083     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *treetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01084"></a>01084     <a class="code" href="../../d4/dc4/structMakeLocalCallData.html">MakeLocalCallData</a> cd;
<a name="l01085"></a>01085     
<a name="l01086"></a>01086     <span class="comment">/* - only lib users: do nothing</span>
<a name="l01087"></a>01087 <span class="comment">     * - only local users: set flag</span>
<a name="l01088"></a>01088 <span class="comment">     * - mixed: make copy</span>
<a name="l01089"></a>01089 <span class="comment">     */</span>
<a name="l01090"></a>01090     
<a name="l01091"></a>01091     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01092"></a>01092     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==1) {
<a name="l01093"></a>01093         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree);
<a name="l01094"></a>01094         <span class="keywordflow">return</span>;
<a name="l01095"></a>01095     }
<a name="l01096"></a>01096     
<a name="l01097"></a>01097     <span class="comment">/* now check users of groups... again typedepending, callback... */</span>
<a name="l01098"></a>01098     cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a96f62a07046d0876733c716b31190d7b">group_id</a> = &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>;
<a name="l01099"></a>01099     cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a0b3a4b74736213fac6417b6ebb87fd69">new_id</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01100"></a>01100     cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a78a247ffbb8d1703f7bab1943240f4c3">local</a> = 0;
<a name="l01101"></a>01101     cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a5f170add80b640d5552d866c19d60fe1">lib</a> = 0;
<a name="l01102"></a>01102     
<a name="l01103"></a>01103     treetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;cd, &amp;<a class="code" href="../../dd/d2d/node_8c.html#a99cf400cd561c572a50076925b47ed48">ntreeMakeLocal_CheckLocal</a>);
<a name="l01104"></a>01104     
<a name="l01105"></a>01105     <span class="comment">/* if all users are local, we simply make tree local */</span>
<a name="l01106"></a>01106     <span class="keywordflow">if</span> (cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a78a247ffbb8d1703f7bab1943240f4c3">local</a> &amp;&amp; cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a5f170add80b640d5552d866c19d60fe1">lib</a>==0) {
<a name="l01107"></a>01107         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree);
<a name="l01108"></a>01108     }
<a name="l01109"></a>01109     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a78a247ffbb8d1703f7bab1943240f4c3">local</a> &amp;&amp; cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a5f170add80b640d5552d866c19d60fe1">lib</a>) {
<a name="l01110"></a>01110         <span class="comment">/* this is the mixed case, we copy the tree and assign it to local users */</span>
<a name="l01111"></a>01111         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *newtree= <a class="code" href="../../d4/d91/BKE__node_8h.html#a42a2adacc98ae098c53b06a35258af8e">ntreeCopyTree</a>(ntree);
<a name="l01112"></a>01112         
<a name="l01113"></a>01113         newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 0;
<a name="l01114"></a>01114         
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         cd.<a class="code" href="../../d4/dc4/structMakeLocalCallData.html#a0b3a4b74736213fac6417b6ebb87fd69">new_id</a> = &amp;newtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>;
<a name="l01117"></a>01117         treetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;cd, &amp;<a class="code" href="../../dd/d2d/node_8c.html#a955929bb46eb907b5f40ea2554b4cdf9">ntreeMakeLocal_LinkNew</a>);
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 }
<a name="l01120"></a>01120 
<a name="l01121"></a><a class="code" href="../../dd/d2d/node_8c.html#adbfa1126872f01a2a74a5128b5e69c05">01121</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#af5de1a5b2cf226ea04c989eb8ae32fc8">ntreeNodeExists</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../dc/d4c/rayobject__octree_8cpp.html#a9229c64cd4d56c700e8a7db2d452477c">testnode</a>)
<a name="l01122"></a>01122 {
<a name="l01123"></a>01123     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01124"></a>01124     <span class="keywordflow">for</span> (; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01125"></a>01125         <span class="keywordflow">if</span> (node==testnode)
<a name="l01126"></a>01126             <span class="keywordflow">return</span> 1;
<a name="l01127"></a>01127     <span class="keywordflow">return</span> 0;
<a name="l01128"></a>01128 }
<a name="l01129"></a>01129 
<a name="l01130"></a><a class="code" href="../../dd/d2d/node_8c.html#abf645956d75da5186a9b13ce481119e7">01130</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a785f7f622dd0398a5e1ca3af3ac2187e">ntreeOutputExists</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *testsock)
<a name="l01131"></a>01131 {
<a name="l01132"></a>01132     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01133"></a>01133     <span class="keywordflow">for</span> (; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01134"></a>01134         <span class="keywordflow">if</span> (sock==testsock)
<a name="l01135"></a>01135             <span class="keywordflow">return</span> 1;
<a name="l01136"></a>01136     <span class="keywordflow">return</span> 0;
<a name="l01137"></a>01137 }
<a name="l01138"></a>01138 
<a name="l01139"></a>01139 <span class="comment">/* returns localized tree for execution in threads */</span>
<a name="l01140"></a><a class="code" href="../../dd/d2d/node_8c.html#a44266f18edf276937157d4a307b023f1">01140</a> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a0c6fac4e1bca3cc6a05968379937ecb7">ntreeLocalize</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01141"></a>01141 {
<a name="l01142"></a>01142     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ltree;
<a name="l01145"></a>01145     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01146"></a>01146     
<a name="l01147"></a>01147     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *action_backup= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *tmpact_backup= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01148"></a>01148     
<a name="l01149"></a>01149     <span class="comment">/* Workaround for copying an action on each render!</span>
<a name="l01150"></a>01150 <span class="comment">     * set action to NULL so animdata actions don&#39;t get copied */</span>
<a name="l01151"></a>01151     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <span class="keywordflow">if</span> (adt) {
<a name="l01154"></a>01154         action_backup= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l01155"></a>01155         tmpact_backup= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157         adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01158"></a>01158         adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <span class="comment">/* node copy func */</span>
<a name="l01162"></a>01162     ltree= <a class="code" href="../../d4/d91/BKE__node_8h.html#a42a2adacc98ae098c53b06a35258af8e">ntreeCopyTree</a>(ntree);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (adt) {
<a name="l01165"></a>01165         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ladt= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;ltree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167         adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>= ladt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>= action_backup;
<a name="l01168"></a>01168         adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>= ladt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>= tmpact_backup;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="keywordflow">if</span> (action_backup) action_backup-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l01171"></a>01171         <span class="keywordflow">if</span> (tmpact_backup) tmpact_backup-&gt;id.us++;
<a name="l01172"></a>01172         
<a name="l01173"></a>01173     }
<a name="l01174"></a>01174     <span class="comment">/* end animdata uglyness */</span>
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     <span class="comment">/* ensures only a single output node is enabled */</span>
<a name="l01177"></a>01177     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9bc46b59ae07500da394cfd467c24b10">ntreeSetOutput</a>(ntree);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01180"></a>01180         <span class="comment">/* store new_node pointer to original */</span>
<a name="l01181"></a>01181         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>= node;
<a name="l01182"></a>01182     }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#ac5bc9ad60138362af34517d83275efd3">localize</a>)
<a name="l01185"></a>01185         ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#ac5bc9ad60138362af34517d83275efd3">localize</a>(ltree, ntree);
<a name="l01186"></a>01186 
<a name="l01187"></a>01187     <span class="keywordflow">return</span> ltree;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 <span class="comment">/* sync local composite with real tree */</span>
<a name="l01191"></a>01191 <span class="comment">/* local tree is supposed to be running, be careful moving previews! */</span>
<a name="l01192"></a>01192 <span class="comment">/* is called by jobs manager, outside threads, so it doesnt happen during draw */</span>
<a name="l01193"></a><a class="code" href="../../dd/d2d/node_8c.html#af4e52890ed0feac41fe66f9550abf6a5">01193</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a3ac7c3fa7bd32bf7910afd02209e31ff">ntreeLocalSync</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *localtree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01194"></a>01194 {
<a name="l01195"></a>01195     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a70f3ab6767fc8c4a972b1f91d8909e05">local_sync</a>)
<a name="l01198"></a>01198         ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a70f3ab6767fc8c4a972b1f91d8909e05">local_sync</a>(localtree, ntree);
<a name="l01199"></a>01199 }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 <span class="comment">/* merge local tree results back, and free local tree */</span>
<a name="l01202"></a>01202 <span class="comment">/* we have to assume the editor already changed completely */</span>
<a name="l01203"></a><a class="code" href="../../dd/d2d/node_8c.html#a6be0c887542d22e0d3ce5273fc247c9c">01203</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a82e3e5d063980554bf0feb1286e087bc">ntreeLocalMerge</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *localtree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01204"></a>01204 {
<a name="l01205"></a>01205     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01206"></a>01206     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *lnode;
<a name="l01207"></a>01207     
<a name="l01208"></a>01208     <span class="comment">/* move over the compbufs and previews */</span>
<a name="l01209"></a>01209     <span class="keywordflow">for</span> (lnode= localtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lnode; lnode= lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01210"></a>01210         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#af5de1a5b2cf226ea04c989eb8ae32fc8">ntreeNodeExists</a>(ntree, lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>)) {
<a name="l01211"></a>01211             <span class="keywordflow">if</span> (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a> &amp;&amp; lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>) {
<a name="l01212"></a>01212                 <a class="code" href="../../d4/d91/BKE__node_8h.html#afaeddf09fd0ee090b3dc02e6ef1d3dba">nodeFreePreview</a>(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>);
<a name="l01213"></a>01213                 lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>;
<a name="l01214"></a>01214                 lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01215"></a>01215             }
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219     <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a5fe4dee332cd452a6b4db3c7aa417d95">local_merge</a>)
<a name="l01220"></a>01220         ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a5fe4dee332cd452a6b4db3c7aa417d95">local_merge</a>(localtree, ntree);
<a name="l01221"></a>01221 
<a name="l01222"></a>01222     <a class="code" href="../../d4/d91/BKE__node_8h.html#a5f6d61a1f4a0daa3dab1624a1335f947">ntreeFreeTree</a>(localtree);
<a name="l01223"></a>01223     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(localtree);
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="comment">/* ************ find stuff *************** */</span>
<a name="l01227"></a>01227 
<a name="l01228"></a><a class="code" href="../../dd/d2d/node_8c.html#a1c45838a96292db0feeb508bac481e72">01228</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#af8797e56955a10c3cdf51aa7aa6233ca">ntreeHasType</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">int</span> type)
<a name="l01229"></a>01229 {
<a name="l01230"></a>01230     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01231"></a>01231     
<a name="l01232"></a>01232     <span class="keywordflow">if</span> (ntree)
<a name="l01233"></a>01233         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01234"></a>01234             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == type)
<a name="l01235"></a>01235                 <span class="keywordflow">return</span> 1;
<a name="l01236"></a>01236     <span class="keywordflow">return</span> 0;
<a name="l01237"></a>01237 }
<a name="l01238"></a>01238 
<a name="l01239"></a><a class="code" href="../../dd/d2d/node_8c.html#a443fa4f27d3388966b44e8c19dd9912b">01239</a> <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a02685bdaa86bfa81440393e18e466ece">nodeFindLink</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *from, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *to)
<a name="l01240"></a>01240 {
<a name="l01241"></a>01241     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01242"></a>01242     
<a name="l01243"></a>01243     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l01244"></a>01244         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==from &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==to)
<a name="l01245"></a>01245             <span class="keywordflow">return</span> <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01246"></a>01246         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==to &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==from)   <span class="comment">/* hrms? */</span>
<a name="l01247"></a>01247             <span class="keywordflow">return</span> <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01248"></a>01248     }
<a name="l01249"></a>01249     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01250"></a>01250 }
<a name="l01251"></a>01251 
<a name="l01252"></a><a class="code" href="../../dd/d2d/node_8c.html#ae7676f55766d3ac1a77bc007b50f8a3b">01252</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l01253"></a>01253 {
<a name="l01254"></a>01254     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01255"></a>01255     <span class="keywordtype">int</span> tot= 0;
<a name="l01256"></a>01256     
<a name="l01257"></a>01257     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l01258"></a>01258         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==sock || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==sock)
<a name="l01259"></a>01259             tot++;
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261     <span class="keywordflow">return</span> tot;
<a name="l01262"></a>01262 }
<a name="l01263"></a>01263 
<a name="l01264"></a><a class="code" href="../../dd/d2d/node_8c.html#a8076c6a462a6bad731addde7c7847ae5">01264</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01265"></a>01265 {
<a name="l01266"></a>01266     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01267"></a>01267     
<a name="l01268"></a>01268     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01269"></a>01269     
<a name="l01270"></a>01270     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01271"></a>01271         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a>)
<a name="l01272"></a>01272             <span class="keywordflow">break</span>;
<a name="l01273"></a>01273     <span class="keywordflow">return</span> node;
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276 <span class="comment">/* two active flags, ID nodes have special flag for buttons display */</span>
<a name="l01277"></a><a class="code" href="../../dd/d2d/node_8c.html#a782d4c0e90f801266828666f9a5f4f07">01277</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#ac139eb516e1a50c64f2cb5268e29eecb">nodeGetActiveID</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">short</span> idtype)
<a name="l01278"></a>01278 {
<a name="l01279"></a>01279     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01280"></a>01280     
<a name="l01281"></a>01281     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01282"></a>01282 
<a name="l01283"></a>01283     <span class="comment">/* check for group edit */</span>
<a name="l01284"></a>01284     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01285"></a>01285         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>)
<a name="l01286"></a>01286             <span class="keywordflow">break</span>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <span class="keywordflow">if</span> (node)
<a name="l01289"></a>01289         ntree= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l01290"></a>01290     
<a name="l01291"></a>01291     <span class="comment">/* now find active node with this id */</span>
<a name="l01292"></a>01292     for (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01293"></a>01293         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==idtype)
<a name="l01294"></a>01294             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab290aa5a3c6dfff37c12fff016d410bc">NODE_ACTIVE_ID</a>)
<a name="l01295"></a>01295                 <span class="keywordflow">break</span>;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297     <span class="keywordflow">return</span> node;
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a><a class="code" href="../../dd/d2d/node_8c.html#a33cf6845eb592f26ef359d88129340b1">01300</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a4d2e84afdd2771df83679fda8be48433">nodeSetActiveID</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">short</span> idtype, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01303"></a>01303     <span class="keywordtype">int</span> ok= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01304"></a>01304 
<a name="l01305"></a>01305     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> ok;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="comment">/* check for group edit */</span>
<a name="l01308"></a>01308     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01309"></a>01309         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>)
<a name="l01310"></a>01310             <span class="keywordflow">break</span>;
<a name="l01311"></a>01311 
<a name="l01312"></a>01312     <span class="keywordflow">if</span> (node)
<a name="l01313"></a>01313         ntree= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315     <span class="comment">/* now find active node with this id */</span>
<a name="l01316"></a>01316     for (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01317"></a>01317         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==idtype) {
<a name="l01318"></a>01318             <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; ok==<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==<span class="keywordtype">id</span>) {
<a name="l01319"></a>01319                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab290aa5a3c6dfff37c12fff016d410bc">NODE_ACTIVE_ID</a>;
<a name="l01320"></a>01320                 ok= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01321"></a>01321             }
<a name="l01322"></a>01322             <span class="keywordflow">else</span> {
<a name="l01323"></a>01323                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab290aa5a3c6dfff37c12fff016d410bc">NODE_ACTIVE_ID</a>;
<a name="l01324"></a>01324             }
<a name="l01325"></a>01325         }
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="keywordflow">return</span> ok;
<a name="l01329"></a>01329 }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 
<a name="l01332"></a>01332 <span class="comment">/* two active flags, ID nodes have special flag for buttons display */</span>
<a name="l01333"></a><a class="code" href="../../dd/d2d/node_8c.html#aa9e6955d8136e319d9caf950c5ae1fb7">01333</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a2272a6c8d8829e022d91891bd07c2a27">nodeClearActiveID</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">short</span> idtype)
<a name="l01334"></a>01334 {
<a name="l01335"></a>01335     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01336"></a>01336     
<a name="l01337"></a>01337     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01338"></a>01338     
<a name="l01339"></a>01339     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01340"></a>01340         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==idtype)
<a name="l01341"></a>01341             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab290aa5a3c6dfff37c12fff016d410bc">NODE_ACTIVE_ID</a>;
<a name="l01342"></a>01342 }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 <span class="comment">/* two active flags, ID nodes have special flag for buttons display */</span>
<a name="l01345"></a><a class="code" href="../../dd/d2d/node_8c.html#a3b8f5a292c594ad35cb59b63693a05d5">01345</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aef5a94d758aa610c384ae08b358b0bbc">nodeSetActive</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01346"></a>01346 {
<a name="l01347"></a>01347     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tnode;
<a name="l01348"></a>01348     
<a name="l01349"></a>01349     <span class="comment">/* make sure only one node is active, and only one per ID type */</span>
<a name="l01350"></a>01350     <span class="keywordflow">for</span> (tnode= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tnode; tnode= tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01351"></a>01351         tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a>;
<a name="l01352"></a>01352         
<a name="l01353"></a>01353         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>) {
<a name="l01354"></a>01354             <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>))
<a name="l01355"></a>01355                 tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab290aa5a3c6dfff37c12fff016d410bc">NODE_ACTIVE_ID</a>;
<a name="l01356"></a>01356         }
<a name="l01357"></a>01357         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ae08783155f76296c2137f55ed691bb69">NODE_CLASS_TEXTURE</a>)
<a name="l01358"></a>01358             tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6bfb8557e92ab04b26c5520fca97d6a9">NODE_ACTIVE_TEXTURE</a>;
<a name="l01359"></a>01359     }
<a name="l01360"></a>01360     
<a name="l01361"></a>01361     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a>;
<a name="l01362"></a>01362     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l01363"></a>01363         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab290aa5a3c6dfff37c12fff016d410bc">NODE_ACTIVE_ID</a>;
<a name="l01364"></a>01364     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ae08783155f76296c2137f55ed691bb69">NODE_CLASS_TEXTURE</a>)
<a name="l01365"></a>01365         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6bfb8557e92ab04b26c5520fca97d6a9">NODE_ACTIVE_TEXTURE</a>;
<a name="l01366"></a>01366 }
<a name="l01367"></a>01367 
<a name="l01368"></a><a class="code" href="../../dd/d2d/node_8c.html#a17d2fc63cedddc359b943927a0d76c23">01368</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l01369"></a>01369 {
<a name="l01370"></a>01370     <span class="keywordflow">return</span> ((sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; (<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a> | <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>)) != 0);
<a name="l01371"></a>01371 }
<a name="l01372"></a>01372 
<a name="l01373"></a><a class="code" href="../../dd/d2d/node_8c.html#a0963a464dbab19efae887921743fcc7c">01373</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aed4dae208600f3c7749616de1293f382">nodeSocketSetType</a>(<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, <span class="keywordtype">int</span> type)
<a name="l01374"></a>01374 {
<a name="l01375"></a>01375     <span class="keywordtype">int</span> old_type = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>;
<a name="l01376"></a>01376     <span class="keywordtype">void</span> *old_default_value = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>;
<a name="l01377"></a>01377     
<a name="l01378"></a>01378     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a> = type;
<a name="l01379"></a>01379     
<a name="l01380"></a>01380     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d28/node__socket_8c.html#a06af3f435abfc0756d1e3f87c90b19dd">node_socket_make_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l01381"></a>01381     <a class="code" href="../../da/d28/node__socket_8c.html#a079793633b58eb7e052ab081a964a5b4">node_socket_init_default_value</a>(type, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l01382"></a>01382     <a class="code" href="../../da/d28/node__socket_8c.html#ad4b2a17c6601ec400a69176233713f3b">node_socket_convert_default_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>, old_type, old_default_value);
<a name="l01383"></a>01383     <a class="code" href="../../da/d28/node__socket_8c.html#a71204cf482e1a1e4c47324d5cd6a3c37">node_socket_free_default_value</a>(old_type, old_default_value);
<a name="l01384"></a>01384 }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386 <span class="comment">/* ************** dependency stuff *********** */</span>
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 <span class="comment">/* node is guaranteed to be not checked before */</span>
<a name="l01389"></a><a class="code" href="../../dd/d2d/node_8c.html#a31c2a9e2b6bdafd098210cc22f5929a5">01389</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d2d/node_8c.html#a31c2a9e2b6bdafd098210cc22f5929a5">node_get_deplist_recurs</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> ***nsort)
<a name="l01390"></a>01390 {
<a name="l01391"></a>01391     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *fromnode;
<a name="l01392"></a>01392     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01393"></a>01393     <span class="keywordtype">int</span> level = 0xFFF;
<a name="l01394"></a>01394     
<a name="l01395"></a>01395     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>= 1;
<a name="l01396"></a>01396     
<a name="l01397"></a>01397     <span class="comment">/* check linked nodes */</span>
<a name="l01398"></a>01398     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01399"></a>01399         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>) {
<a name="l01400"></a>01400             fromnode= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>;
<a name="l01401"></a>01401             <span class="keywordflow">if</span> (fromnode) {
<a name="l01402"></a>01402                 <span class="keywordflow">if</span> (fromnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>==0)
<a name="l01403"></a>01403                     fromnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a>= <a class="code" href="../../dd/d2d/node_8c.html#a31c2a9e2b6bdafd098210cc22f5929a5">node_get_deplist_recurs</a>(fromnode, nsort);
<a name="l01404"></a>01404                 <span class="keywordflow">if</span> (fromnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> &lt;= level)
<a name="l01405"></a>01405                     level = fromnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> - 1;
<a name="l01406"></a>01406             }
<a name="l01407"></a>01407         }
<a name="l01408"></a>01408     }
<a name="l01409"></a>01409     
<a name="l01410"></a>01410     <span class="comment">/* check parent node */</span>
<a name="l01411"></a>01411     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>) {
<a name="l01412"></a>01412         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>==0)
<a name="l01413"></a>01413             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a>= <a class="code" href="../../dd/d2d/node_8c.html#a31c2a9e2b6bdafd098210cc22f5929a5">node_get_deplist_recurs</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>, nsort);
<a name="l01414"></a>01414         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> &lt;= level)
<a name="l01415"></a>01415             level = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> - 1;
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417     
<a name="l01418"></a>01418     <span class="keywordflow">if</span> (nsort) {
<a name="l01419"></a>01419         **nsort= node;
<a name="l01420"></a>01420         (*nsort)++;
<a name="l01421"></a>01421     }
<a name="l01422"></a>01422     
<a name="l01423"></a>01423     <span class="keywordflow">return</span> level;
<a name="l01424"></a>01424 }
<a name="l01425"></a>01425 
<a name="l01426"></a><a class="code" href="../../dd/d2d/node_8c.html#abd4e92e4b7947775c351b2f8e1341c29">01426</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#abd4e92e4b7947775c351b2f8e1341c29">ntreeGetDependencyList</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> ***deplist, <span class="keywordtype">int</span> *totnodes)
<a name="l01427"></a>01427 {
<a name="l01428"></a>01428     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, **nsort;
<a name="l01429"></a>01429     
<a name="l01430"></a>01430     *totnodes=0;
<a name="l01431"></a>01431     
<a name="l01432"></a>01432     <span class="comment">/* first clear data */</span>
<a name="l01433"></a>01433     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01434"></a>01434         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>= 0;
<a name="l01435"></a>01435         (*totnodes)++;
<a name="l01436"></a>01436     }
<a name="l01437"></a>01437     <span class="keywordflow">if</span> (*totnodes==0) {
<a name="l01438"></a>01438         *deplist = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01439"></a>01439         <span class="keywordflow">return</span>;
<a name="l01440"></a>01440     }
<a name="l01441"></a>01441     
<a name="l01442"></a>01442     nsort= *deplist= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((*totnodes)*<span class="keyword">sizeof</span>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a>*), <span class="stringliteral">&quot;sorted node array&quot;</span>);
<a name="l01443"></a>01443     
<a name="l01444"></a>01444     <span class="comment">/* recursive check */</span>
<a name="l01445"></a>01445     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01446"></a>01446         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>==0) {
<a name="l01447"></a>01447             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a>= <a class="code" href="../../dd/d2d/node_8c.html#a31c2a9e2b6bdafd098210cc22f5929a5">node_get_deplist_recurs</a>(node, &amp;nsort);
<a name="l01448"></a>01448         }
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452 <span class="comment">/* only updates node-&gt;level for detecting cycles links */</span>
<a name="l01453"></a><a class="code" href="../../dd/d2d/node_8c.html#ad048f15930b15338c6fa984c7c87851d">01453</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#ad048f15930b15338c6fa984c7c87851d">ntree_update_node_level</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01454"></a>01454 {
<a name="l01455"></a>01455     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01456"></a>01456     
<a name="l01457"></a>01457     <span class="comment">/* first clear tag */</span>
<a name="l01458"></a>01458     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01459"></a>01459         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>= 0;
<a name="l01460"></a>01460     }
<a name="l01461"></a>01461     
<a name="l01462"></a>01462     <span class="comment">/* recursive check */</span>
<a name="l01463"></a>01463     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01464"></a>01464         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a7808b61294b1792ceb5327f663607a10">done</a>==0) {
<a name="l01465"></a>01465             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a>= <a class="code" href="../../dd/d2d/node_8c.html#a31c2a9e2b6bdafd098210cc22f5929a5">node_get_deplist_recurs</a>(node, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01466"></a>01466         }
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468 }
<a name="l01469"></a>01469 
<a name="l01470"></a><a class="code" href="../../dd/d2d/node_8c.html#ad3bceac136e7a4534b9f285af02546c0">01470</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#ad3bceac136e7a4534b9f285af02546c0">ntree_update_link_pointers</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01471"></a>01471 {
<a name="l01472"></a>01472     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01473"></a>01473     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01474"></a>01474     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01475"></a>01475     
<a name="l01476"></a>01476     <span class="comment">/* first clear data */</span>
<a name="l01477"></a>01477     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01478"></a>01478         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01479"></a>01479             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01480"></a>01480             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l01481"></a>01481         }
<a name="l01482"></a>01482         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01483"></a>01483             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l01484"></a>01484         }
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486     <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01487"></a>01487         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l01488"></a>01488     }
<a name="l01489"></a>01489     <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01490"></a>01490         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01491"></a>01491         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l01492"></a>01492     }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l01495"></a>01495         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>= <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01496"></a>01496         
<a name="l01497"></a>01497         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l01498"></a>01498         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l01499"></a>01499     }
<a name="l01500"></a>01500 }
<a name="l01501"></a>01501 
<a name="l01502"></a><a class="code" href="../../dd/d2d/node_8c.html#a52919925ea21893162167a1d36804a7f">01502</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a52919925ea21893162167a1d36804a7f">ntree_validate_links</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01503"></a>01503 {
<a name="l01504"></a>01504     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype = <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01505"></a>01505     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01506"></a>01506     
<a name="l01507"></a>01507     <span class="keywordflow">for</span> (link = ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l01508"></a>01508         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a29a0264c85ac1f8b42bc71d236cd4842">NODE_LINK_VALID</a>;
<a name="l01509"></a>01509         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> &lt;= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a>)
<a name="l01510"></a>01510             link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a29a0264c85ac1f8b42bc71d236cd4842">NODE_LINK_VALID</a>;
<a name="l01511"></a>01511         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a1d59ac979061804bc3fec65fe48709f0">validate_link</a>) {
<a name="l01512"></a>01512             <span class="keywordflow">if</span> (!ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a1d59ac979061804bc3fec65fe48709f0">validate_link</a>(ntree, link))
<a name="l01513"></a>01513                 link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a29a0264c85ac1f8b42bc71d236cd4842">NODE_LINK_VALID</a>;
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516 }
<a name="l01517"></a>01517 
<a name="l01518"></a><a class="code" href="../../dd/d2d/node_8c.html#ad5fce2f853a660c83538301dd424fe51">01518</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#ad5fce2f853a660c83538301dd424fe51">ntree_verify_nodes_cb</a>(<span class="keywordtype">void</span> *calldata, <span class="keyword">struct</span> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(owner_id), <span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01519"></a>01519 {
<a name="l01520"></a>01520     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= (<a class="code" href="../../d8/d7e/structID.html">ID</a>*)calldata;
<a name="l01521"></a>01521     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01522"></a>01522     
<a name="l01523"></a>01523     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01524"></a>01524         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7d8e50e4bea8e707c32cbf69f3fe456f" title="Check and update if internal ID data has changed.">verifyfunc</a>)
<a name="l01525"></a>01525             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7d8e50e4bea8e707c32cbf69f3fe456f" title="Check and update if internal ID data has changed.">verifyfunc</a>(ntree, node, <span class="keywordtype">id</span>);
<a name="l01526"></a>01526 }
<a name="l01527"></a>01527 
<a name="l01528"></a><a class="code" href="../../dd/d2d/node_8c.html#ab5d78a913dc12958e7b6247e903de568">01528</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ab5d78a913dc12958e7b6247e903de568">ntreeVerifyNodes</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype;
<a name="l01531"></a>01531     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l01532"></a>01532     <span class="keywordtype">int</span> n;
<a name="l01533"></a>01533     
<a name="l01534"></a>01534     <span class="keywordflow">for</span> (n=0; n &lt; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a65928324ac7ecafcf0f822524c203d54">NUM_NTREE_TYPES</a>; ++n) {
<a name="l01535"></a>01535         ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(n);
<a name="l01536"></a>01536         <span class="keywordflow">if</span> (ntreetype &amp;&amp; ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>)
<a name="l01537"></a>01537             ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(main, <span class="keywordtype">id</span>, <a class="code" href="../../dd/d2d/node_8c.html#ad5fce2f853a660c83538301dd424fe51">ntree_verify_nodes_cb</a>);
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539     <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01540"></a>01540         <a class="code" href="../../dd/d2d/node_8c.html#ad5fce2f853a660c83538301dd424fe51">ntree_verify_nodes_cb</a>(<span class="keywordtype">id</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ntree);
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a><a class="code" href="../../dd/d2d/node_8c.html#ad74aa9a65c737a31ead9ece92aedc209">01543</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l01544"></a>01544 {
<a name="l01545"></a>01545     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01546"></a>01546     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01547"></a>01547     
<a name="l01548"></a>01548     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> &amp; (<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>|<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bd987034ba27bfa2562c511f38c2d23">NTREE_UPDATE_NODES</a>)) {
<a name="l01549"></a>01549         <span class="comment">/* set the bNodeSocket-&gt;link pointers */</span>
<a name="l01550"></a>01550         <a class="code" href="../../dd/d2d/node_8c.html#ad3bceac136e7a4534b9f285af02546c0">ntree_update_link_pointers</a>(ntree);
<a name="l01551"></a>01551         
<a name="l01552"></a>01552         <span class="comment">/* update the node level from link dependencies */</span>
<a name="l01553"></a>01553         <a class="code" href="../../dd/d2d/node_8c.html#ad048f15930b15338c6fa984c7c87851d">ntree_update_node_level</a>(ntree);
<a name="l01554"></a>01554     }
<a name="l01555"></a>01555     
<a name="l01556"></a>01556     <span class="comment">/* update individual nodes */</span>
<a name="l01557"></a>01557     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01558"></a>01558         <span class="comment">/* node tree update tags override individual node update flags */</span>
<a name="l01559"></a>01559         <span class="keywordflow">if</span> ((node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae67319bd4d588921dc74a7d025065c15">NODE_UPDATE</a>) || (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa9f2cec5015fe968da62576381bf2920">NTREE_UPDATE</a>)) {
<a name="l01560"></a>01560             <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#af438efd446dc834db41b333651eec0d7">update_node</a>)
<a name="l01561"></a>01561                 ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#af438efd446dc834db41b333651eec0d7">update_node</a>(ntree, node);
<a name="l01562"></a>01562             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>)
<a name="l01563"></a>01563                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>(ntree, node);
<a name="l01564"></a>01564         }
<a name="l01565"></a>01565         <span class="comment">/* clear update flag */</span>
<a name="l01566"></a>01566         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> = 0;
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568     
<a name="l01569"></a>01569     <span class="comment">/* check link validity */</span>
<a name="l01570"></a>01570     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> &amp; (<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>|<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bd987034ba27bfa2562c511f38c2d23">NTREE_UPDATE_NODES</a>))
<a name="l01571"></a>01571         <a class="code" href="../../dd/d2d/node_8c.html#a52919925ea21893162167a1d36804a7f">ntree_validate_links</a>(ntree);
<a name="l01572"></a>01572     
<a name="l01573"></a>01573     <span class="comment">/* generic tree update callback */</span>
<a name="l01574"></a>01574     <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a8339542fb9a6f7094878db638a42d214">update</a>)
<a name="l01575"></a>01575         ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a8339542fb9a6f7094878db638a42d214">update</a>(ntree);
<a name="l01576"></a>01576     <span class="keywordflow">else</span> {
<a name="l01577"></a>01577         <span class="comment">/* Trees can be associated with a specific node type (i.e. group nodes),</span>
<a name="l01578"></a>01578 <span class="comment">         * in that case a tree update function may be defined by that node type.</span>
<a name="l01579"></a>01579 <span class="comment">         */</span>
<a name="l01580"></a>01580         <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype= <a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(ntree, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae174135c0568adeb8a45d7697ae378a9">nodetype</a>);
<a name="l01581"></a>01581         <span class="keywordflow">if</span> (ntype &amp;&amp; ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#aa5468fd71245635975cabd6202f4dd03" title="Update a node tree associated to this node type.">updatetreefunc</a>)
<a name="l01582"></a>01582             ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#aa5468fd71245635975cabd6202f4dd03" title="Update a node tree associated to this node type.">updatetreefunc</a>(ntree);
<a name="l01583"></a>01583     }
<a name="l01584"></a>01584     
<a name="l01585"></a>01585     <span class="comment">/* XXX hack, should be done by depsgraph!! */</span>
<a name="l01586"></a>01586     <a class="code" href="../../d4/d91/BKE__node_8h.html#ab5d78a913dc12958e7b6247e903de568">ntreeVerifyNodes</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>);
<a name="l01587"></a>01587     
<a name="l01588"></a>01588     <span class="comment">/* clear the update flag */</span>
<a name="l01589"></a>01589     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> = 0;
<a name="l01590"></a>01590 }
<a name="l01591"></a>01591 
<a name="l01592"></a><a class="code" href="../../dd/d2d/node_8c.html#a20702d62ef86747a4a2975034f58b987">01592</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01593"></a>01593 {
<a name="l01594"></a>01594     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01595"></a>01595     
<a name="l01596"></a>01596     <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#af438efd446dc834db41b333651eec0d7">update_node</a>)
<a name="l01597"></a>01597         ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#af438efd446dc834db41b333651eec0d7">update_node</a>(ntree, node);
<a name="l01598"></a>01598     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>)
<a name="l01599"></a>01599         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>(ntree, node);
<a name="l01600"></a>01600     <span class="comment">/* clear update flag */</span>
<a name="l01601"></a>01601     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> = 0;
<a name="l01602"></a>01602 }
<a name="l01603"></a>01603 
<a name="l01604"></a><a class="code" href="../../dd/d2d/node_8c.html#aefeab4f06150f03c7e1c27c171d97d7a">01604</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a7f3de8e85e038cac2d3843fd77a8f05e">nodeUpdateID</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l01605"></a>01605 {
<a name="l01606"></a>01606     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype;
<a name="l01607"></a>01607     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01608"></a>01608     <span class="keywordtype">int</span> change = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01609"></a>01609     
<a name="l01610"></a>01610     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keywordtype">id</span>, ntree))
<a name="l01611"></a>01611         <span class="keywordflow">return</span> change;
<a name="l01612"></a>01612     
<a name="l01613"></a>01613     ntreetype = <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l01614"></a>01614     
<a name="l01615"></a>01615     <span class="keywordflow">if</span> (ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#af438efd446dc834db41b333651eec0d7">update_node</a>) {
<a name="l01616"></a>01616         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01617"></a>01617             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==<span class="keywordtype">id</span>) {
<a name="l01618"></a>01618                 change = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01619"></a>01619                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a71111ebce99b0fc268089e7ad2278bb4">NODE_UPDATE_ID</a>;
<a name="l01620"></a>01620                 ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#af438efd446dc834db41b333651eec0d7">update_node</a>(ntree, node);
<a name="l01621"></a>01621                 <span class="comment">/* clear update flag */</span>
<a name="l01622"></a>01622                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> = 0;
<a name="l01623"></a>01623             }
<a name="l01624"></a>01624         }
<a name="l01625"></a>01625     }
<a name="l01626"></a>01626     <span class="keywordflow">else</span> {
<a name="l01627"></a>01627         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01628"></a>01628             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==<span class="keywordtype">id</span>) {
<a name="l01629"></a>01629                 change = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01630"></a>01630                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a71111ebce99b0fc268089e7ad2278bb4">NODE_UPDATE_ID</a>;
<a name="l01631"></a>01631                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>)
<a name="l01632"></a>01632                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>(ntree, node);
<a name="l01633"></a>01633                 <span class="comment">/* clear update flag */</span>
<a name="l01634"></a>01634                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1ce23cb88b26b9a00725ea56732061e8">update</a> = 0;
<a name="l01635"></a>01635             }
<a name="l01636"></a>01636         }
<a name="l01637"></a>01637     }
<a name="l01638"></a>01638     
<a name="l01639"></a>01639     <span class="keywordflow">return</span> change;
<a name="l01640"></a>01640 }
<a name="l01641"></a>01641 
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 <span class="comment">/* ************* node type access ********** */</span>
<a name="l01644"></a>01644 
<a name="l01645"></a><a class="code" href="../../dd/d2d/node_8c.html#ad5390bde4910bb9bae4c3a8987f4b401">01645</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a0b60cc966d0f0ea1e89476305f95c82c">nodeValid</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> *ntemp)
<a name="l01646"></a>01646 {
<a name="l01647"></a>01647     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype= <a class="code" href="../../dd/d2d/node_8c.html#ad39d573f4ae82d35d1c9b21d557d148a">node_get_type</a>(ntree, ntemp-&gt;<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a>);
<a name="l01648"></a>01648     <span class="keywordflow">if</span> (ntype) {
<a name="l01649"></a>01649         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a53e74150becab8d123b1b40914dde689">validfunc</a>)
<a name="l01650"></a>01650             <span class="keywordflow">return</span> ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a53e74150becab8d123b1b40914dde689">validfunc</a>(ntree, ntemp);
<a name="l01651"></a>01651         <span class="keywordflow">else</span>
<a name="l01652"></a>01652             <span class="keywordflow">return</span> 1;
<a name="l01653"></a>01653     }
<a name="l01654"></a>01654     <span class="keywordflow">else</span>
<a name="l01655"></a>01655         <span class="keywordflow">return</span> 0;
<a name="l01656"></a>01656 }
<a name="l01657"></a>01657 
<a name="l01658"></a><a class="code" href="../../dd/d2d/node_8c.html#af6e8fcab0b27be26459dea8da9f75fa5">01658</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d4/d91/BKE__node_8h.html#a310ed873e050bce490fb72ebd79c608a">nodeLabel</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01659"></a>01659 {
<a name="l01660"></a>01660     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad4f53ee8d6bfc22403252f8adc3029ef">label</a>[0]!=<span class="charliteral">&#39;\0&#39;</span>)
<a name="l01661"></a>01661         <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad4f53ee8d6bfc22403252f8adc3029ef">label</a>;
<a name="l01662"></a>01662     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a5f455666d65dbb1378028bbe8730789c" title="Optional custom label function for the node header.">labelfunc</a>)
<a name="l01663"></a>01663         <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a5f455666d65dbb1378028bbe8730789c" title="Optional custom label function for the node header.">labelfunc</a>(node);
<a name="l01664"></a>01664     <span class="keywordflow">else</span>
<a name="l01665"></a>01665         <span class="keywordflow">return</span> <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>);
<a name="l01666"></a>01666 }
<a name="l01667"></a>01667 
<a name="l01668"></a><a class="code" href="../../dd/d2d/node_8c.html#a3eb89e599889f39e698a8d06204e19a4">01668</a> <span class="keyword">struct </span><a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a3eb89e599889f39e698a8d06204e19a4">nodeGroupEditGet</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01669"></a>01669 {
<a name="l01670"></a>01670     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad625b0bb00707f390f1379912cf9e84b">group_edit_get</a>)
<a name="l01671"></a>01671         <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad625b0bb00707f390f1379912cf9e84b">group_edit_get</a>(node);
<a name="l01672"></a>01672     <span class="keywordflow">else</span>
<a name="l01673"></a>01673         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01674"></a>01674 }
<a name="l01675"></a>01675 
<a name="l01676"></a><a class="code" href="../../dd/d2d/node_8c.html#a6da6f9e1254e7d6521ead9176e21aca8">01676</a> <span class="keyword">struct </span><a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a6da6f9e1254e7d6521ead9176e21aca8">nodeGroupEditSet</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> edit)
<a name="l01677"></a>01677 {
<a name="l01678"></a>01678     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a0c534e2e335b9a5ed627ae755eddc985">group_edit_set</a>)
<a name="l01679"></a>01679         <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a0c534e2e335b9a5ed627ae755eddc985">group_edit_set</a>(node, edit);
<a name="l01680"></a>01680     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad625b0bb00707f390f1379912cf9e84b">group_edit_get</a>)
<a name="l01681"></a>01681         <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad625b0bb00707f390f1379912cf9e84b">group_edit_get</a>(node);
<a name="l01682"></a>01682     <span class="keywordflow">else</span>
<a name="l01683"></a>01683         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01684"></a>01684 }
<a name="l01685"></a>01685 
<a name="l01686"></a><a class="code" href="../../dd/d2d/node_8c.html#ac4c0ce40fc5796d932b182848b74f0e9">01686</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ac4c0ce40fc5796d932b182848b74f0e9">nodeGroupEditClear</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01687"></a>01687 {
<a name="l01688"></a>01688     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3730d3e526ba83e4c754799d68728d78">group_edit_clear</a>)
<a name="l01689"></a>01689         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3730d3e526ba83e4c754799d68728d78">group_edit_clear</a>(node);
<a name="l01690"></a>01690 }
<a name="l01691"></a>01691 
<a name="l01692"></a><a class="code" href="../../dd/d2d/node_8c.html#a727afc819764f8ee60b923bece23a2f9">01692</a> <span class="keyword">struct </span><a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> <a class="code" href="../../d4/d91/BKE__node_8h.html#a727afc819764f8ee60b923bece23a2f9">nodeMakeTemplate</a>(struct <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01693"></a>01693 {
<a name="l01694"></a>01694     <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> ntemp;
<a name="l01695"></a>01695     <span class="keywordflow">if</span> (node-&gt;typeinfo-&gt;templatefunc)
<a name="l01696"></a>01696         <span class="keywordflow">return</span> node-&gt;typeinfo-&gt;templatefunc(node);
<a name="l01697"></a>01697     <span class="keywordflow">else</span> {
<a name="l01698"></a>01698         ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = node-&gt;type;
<a name="l01699"></a>01699         <span class="keywordflow">return</span> ntemp;
<a name="l01700"></a>01700     }
<a name="l01701"></a>01701 }
<a name="l01702"></a>01702 
<a name="l01703"></a><a class="code" href="../../dd/d2d/node_8c.html#a457c463f7415df849af6d3ec913930bf">01703</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ad72f02bc8d3724fd040a4c7b04c7ae6b">node_type_base</a>(<a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ttype, <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">int</span> <a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">short</span> nclass, <span class="keywordtype">short</span> flag)
<a name="l01704"></a>01704 {
<a name="l01705"></a>01705     memset(ntype, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a>));
<a name="l01706"></a>01706 
<a name="l01707"></a>01707     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a> = <a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a>;
<a name="l01708"></a>01708     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>, name, <span class="keyword">sizeof</span>(ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>));
<a name="l01709"></a>01709     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a> = nclass;
<a name="l01710"></a>01710     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> = flag;
<a name="l01711"></a>01711 
<a name="l01712"></a>01712     <span class="comment">/* Default muting stuff. */</span>
<a name="l01713"></a>01713     <span class="keywordflow">if</span> (ttype)
<a name="l01714"></a>01714         ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a> = ttype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a53267a1a402eb41019deba274dceebe4">internal_connect</a>;
<a name="l01715"></a>01715 
<a name="l01716"></a>01716     <span class="comment">/* default size values */</span>
<a name="l01717"></a>01717     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a18f0501b54ca3cfe9673f015df45043c">width</a> = 140;
<a name="l01718"></a>01718     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a17a19bf64a9af92a9dea9e3c1c49a5bb">minwidth</a> = 100;
<a name="l01719"></a>01719     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3e874db2170ffa85faed857fbd0e9de1">maxwidth</a> = 320;
<a name="l01720"></a>01720     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#abe77293ac7cba5441a435ff45fdc3578">height</a> = 100;
<a name="l01721"></a>01721     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ab64177c02d764173d8947e80ae1a3bd6">minheight</a> = 30;
<a name="l01722"></a>01722     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad65f56a9d654920824ac0535f72cc616">maxheight</a> = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l01723"></a>01723 }
<a name="l01724"></a>01724 
<a name="l01725"></a><a class="code" href="../../dd/d2d/node_8c.html#a28da87d7bde19fc52db8a347dfbcdb33">01725</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a28da87d7bde19fc52db8a347dfbcdb33">node_type_socket_templates</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keyword">struct</span> <a class="code" href="../../d1/da2/structbNodeSocketTemplate.html">bNodeSocketTemplate</a> *<a class="code" href="../../d6/d6f/node__texture__at_8c.html#a70776cb126b4133373e3eec422fb99d3">inputs</a>, <span class="keyword">struct</span> <a class="code" href="../../d1/da2/structbNodeSocketTemplate.html">bNodeSocketTemplate</a> *<a class="code" href="../../d6/d6f/node__texture__at_8c.html#a535b401a0319d29ede7bce36636a0cdf">outputs</a>)
<a name="l01726"></a>01726 {
<a name="l01727"></a>01727     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#acca5296bd3e77a5dc7a18b0b5c0f15eb">inputs</a> = <a class="code" href="../../d6/d6f/node__texture__at_8c.html#a70776cb126b4133373e3eec422fb99d3">inputs</a>;
<a name="l01728"></a>01728     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6c0d9e5ca5dcfb5aa866279350ecd736">outputs</a> = <a class="code" href="../../d6/d6f/node__texture__at_8c.html#a535b401a0319d29ede7bce36636a0cdf">outputs</a>;
<a name="l01729"></a>01729 }
<a name="l01730"></a>01730 
<a name="l01731"></a><a class="code" href="../../dd/d2d/node_8c.html#af530927053fe9c1d51c34c39db8ea8a1">01731</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#af530927053fe9c1d51c34c39db8ea8a1">node_type_init</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">void</span> (*initfunc)(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keyword">struct</span> <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> *ntemp))
<a name="l01732"></a>01732 {
<a name="l01733"></a>01733     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a35bdba7f95b4d599742de716a5451ffe" title="Initialize a new node instance of this type after creation.">initfunc</a> = initfunc;
<a name="l01734"></a>01734 }
<a name="l01735"></a>01735 
<a name="l01736"></a><a class="code" href="../../dd/d2d/node_8c.html#ad157762d43c72163d88d8a092417296b">01736</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ad157762d43c72163d88d8a092417296b">node_type_valid</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">int</span> (*validfunc)(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> *ntemp))
<a name="l01737"></a>01737 {
<a name="l01738"></a>01738     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a53e74150becab8d123b1b40914dde689">validfunc</a> = validfunc;
<a name="l01739"></a>01739 }
<a name="l01740"></a>01740 
<a name="l01741"></a><a class="code" href="../../dd/d2d/node_8c.html#a1e52ce207d6deb6a922816062c31793b">01741</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a1e52ce207d6deb6a922816062c31793b">node_type_size</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> minwidth, <span class="keywordtype">int</span> maxwidth)
<a name="l01742"></a>01742 {
<a name="l01743"></a>01743     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a18f0501b54ca3cfe9673f015df45043c">width</a> = width;
<a name="l01744"></a>01744     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a17a19bf64a9af92a9dea9e3c1c49a5bb">minwidth</a> = minwidth;
<a name="l01745"></a>01745     <span class="keywordflow">if</span> (maxwidth &lt;= minwidth)
<a name="l01746"></a>01746         ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3e874db2170ffa85faed857fbd0e9de1">maxwidth</a> = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l01747"></a>01747     <span class="keywordflow">else</span>
<a name="l01748"></a>01748         ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3e874db2170ffa85faed857fbd0e9de1">maxwidth</a> = maxwidth;
<a name="l01749"></a>01749 }
<a name="l01750"></a>01750 
<a name="l01751"></a><a class="code" href="../../dd/d2d/node_8c.html#a084bebc400beebe47458c569fd9f13c9">01751</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aef8267492dd0b028ecb667853276428a">node_type_storage</a>(<a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keyword">const</span> <span class="keywordtype">char</span> *storagename, <span class="keywordtype">void</span> (*freestoragefunc)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *), <span class="keywordtype">void</span> (*copystoragefunc)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *))
<a name="l01752"></a>01752 {
<a name="l01753"></a>01753     <span class="keywordflow">if</span> (storagename)
<a name="l01754"></a>01754         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad290e73f9d347f1f586d3f7ead86ce49">storagename</a>, storagename, <span class="keyword">sizeof</span>(ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad290e73f9d347f1f586d3f7ead86ce49">storagename</a>));
<a name="l01755"></a>01755     <span class="keywordflow">else</span>
<a name="l01756"></a>01756         ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad290e73f9d347f1f586d3f7ead86ce49">storagename</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01757"></a>01757     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a235e91d7b013f2b846cf5108ac9e5839" title="Make a copy of the custom storage data.">copystoragefunc</a> = copystoragefunc;
<a name="l01758"></a>01758     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a62aaec501f05dc7251595c5eb63d6206" title="Free the custom storage data.">freestoragefunc</a> = freestoragefunc;
<a name="l01759"></a>01759 }
<a name="l01760"></a>01760 
<a name="l01761"></a><a class="code" href="../../dd/d2d/node_8c.html#a699302d949cf724a034fb9204f8597a8">01761</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a699302d949cf724a034fb9204f8597a8">node_type_label</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keyword">const</span> <span class="keywordtype">char</span> *(*labelfunc)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *))
<a name="l01762"></a>01762 {
<a name="l01763"></a>01763     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a5f455666d65dbb1378028bbe8730789c" title="Optional custom label function for the node header.">labelfunc</a> = labelfunc;
<a name="l01764"></a>01764 }
<a name="l01765"></a>01765 
<a name="l01766"></a><a class="code" href="../../dd/d2d/node_8c.html#a73c0fcef0f43badce5f93166bfc46cfa">01766</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a73c0fcef0f43badce5f93166bfc46cfa">node_type_template</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keyword">struct</span> <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> (*templatefunc)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *))
<a name="l01767"></a>01767 {
<a name="l01768"></a>01768     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#aac4198a151b22cdbdbefbc921b2cb49b" title="Create a template from an existing node.">templatefunc</a> = templatefunc;
<a name="l01769"></a>01769 }
<a name="l01770"></a>01770 
<a name="l01771"></a><a class="code" href="../../dd/d2d/node_8c.html#a2818d72fc7a8ea04349e6459fd8e971a">01771</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a2818d72fc7a8ea04349e6459fd8e971a">node_type_update</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype,
<a name="l01772"></a>01772                       <span class="keywordtype">void</span> (*updatefunc)(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node),
<a name="l01773"></a>01773                       <span class="keywordtype">void</span> (*verifyfunc)(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keyword">struct</span> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>))
<a name="l01774"></a>01774 {
<a name="l01775"></a>01775     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a> = updatefunc;
<a name="l01776"></a>01776     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7d8e50e4bea8e707c32cbf69f3fe456f" title="Check and update if internal ID data has changed.">verifyfunc</a> = verifyfunc;
<a name="l01777"></a>01777 }
<a name="l01778"></a>01778 
<a name="l01779"></a><a class="code" href="../../dd/d2d/node_8c.html#af2510e458c0551dca53115665c7f1df4">01779</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#af2510e458c0551dca53115665c7f1df4">node_type_tree</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">void</span> (*inittreefunc)(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *), <span class="keywordtype">void</span> (*updatetreefunc)(<span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *))
<a name="l01780"></a>01780 {
<a name="l01781"></a>01781     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad8c3e38a6810153a46ce2b5723057c1f" title="Initialize a node tree associated to this node type.">inittreefunc</a> = inittreefunc;
<a name="l01782"></a>01782     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#aa5468fd71245635975cabd6202f4dd03" title="Update a node tree associated to this node type.">updatetreefunc</a> = updatetreefunc;
<a name="l01783"></a>01783 }
<a name="l01784"></a>01784 
<a name="l01785"></a><a class="code" href="../../dd/d2d/node_8c.html#aa1875c7a31eed6e66484271c8b759912">01785</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aa1875c7a31eed6e66484271c8b759912">node_type_group_edit</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype,
<a name="l01786"></a>01786                           <span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *(*group_edit_get)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node),
<a name="l01787"></a>01787                           <span class="keyword">struct</span> <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *(*group_edit_set)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> edit),
<a name="l01788"></a>01788                           <span class="keywordtype">void</span> (*group_edit_clear)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node))
<a name="l01789"></a>01789 {
<a name="l01790"></a>01790     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad625b0bb00707f390f1379912cf9e84b">group_edit_get</a> = group_edit_get;
<a name="l01791"></a>01791     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a0c534e2e335b9a5ed627ae755eddc985">group_edit_set</a> = group_edit_set;
<a name="l01792"></a>01792     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3730d3e526ba83e4c754799d68728d78">group_edit_clear</a> = group_edit_clear;
<a name="l01793"></a>01793 }
<a name="l01794"></a>01794 
<a name="l01795"></a><a class="code" href="../../dd/d2d/node_8c.html#a3d52173ccbf8815125bcb79c234503d0">01795</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a3d52173ccbf8815125bcb79c234503d0">node_type_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">void</span> (*execfunc)(<span class="keywordtype">void</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *, <span class="keyword">struct</span> <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> **, <span class="keyword">struct</span> <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> **))
<a name="l01796"></a>01796 {
<a name="l01797"></a>01797     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac2ffa2c3ecc9f4553ba458d7859d5777">execfunc</a> = execfunc;
<a name="l01798"></a>01798 }
<a name="l01799"></a>01799 
<a name="l01800"></a><a class="code" href="../../dd/d2d/node_8c.html#aafd44439a46c1821ae1d71869deab0a2">01800</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aafd44439a46c1821ae1d71869deab0a2">node_type_exec_new</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype,
<a name="l01801"></a>01801                         <span class="keywordtype">void</span> *(*initexecfunc)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node),
<a name="l01802"></a>01802                         <span class="keywordtype">void</span> (*freeexecfunc)(<span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">void</span> *nodedata),
<a name="l01803"></a>01803                         <span class="keywordtype">void</span> (*newexecfunc)(<span class="keywordtype">void</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> <a class="code" href="../../df/d68/classthread.html">thread</a>, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *, <span class="keywordtype">void</span> *nodedata, <span class="keyword">struct</span> <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> **, <span class="keyword">struct</span> <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> **))
<a name="l01804"></a>01804 {
<a name="l01805"></a>01805     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3de5419527bbc722a4d867cc46d97f4b">initexecfunc</a> = initexecfunc;
<a name="l01806"></a>01806     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#aed7d2940029a136d0c5a5be565985403">freeexecfunc</a> = freeexecfunc;
<a name="l01807"></a>01807     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6824f8e31d7923170e49746787393afb">newexecfunc</a> = newexecfunc;
<a name="l01808"></a>01808 }
<a name="l01809"></a>01809 
<a name="l01810"></a><a class="code" href="../../dd/d2d/node_8c.html#afdcf23cdff745ec69f7730e6288643f4">01810</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a591beafc04bd877c435637c26962855b">node_type_internal_connect</a>(<a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> (*internal_connect)(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *))
<a name="l01811"></a>01811 {
<a name="l01812"></a>01812     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a> = internal_connect;
<a name="l01813"></a>01813 }
<a name="l01814"></a>01814 
<a name="l01815"></a><a class="code" href="../../dd/d2d/node_8c.html#ada9816e1db9361e084502f30c515f65c">01815</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ada9816e1db9361e084502f30c515f65c">node_type_gpu</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">int</span> (*gpufunc)(<span class="keyword">struct</span> <a class="code" href="../../de/da3/structGPUMaterial.html">GPUMaterial</a> *mat, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keyword">struct</span> <a class="code" href="../../d7/d83/structGPUNodeStack.html">GPUNodeStack</a> *in, <span class="keyword">struct</span> <a class="code" href="../../d7/d83/structGPUNodeStack.html">GPUNodeStack</a> *out))
<a name="l01816"></a>01816 {
<a name="l01817"></a>01817     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a24c3f35b706a4835753279de6169d18f">gpufunc</a> = gpufunc;
<a name="l01818"></a>01818 }
<a name="l01819"></a>01819 
<a name="l01820"></a><a class="code" href="../../dd/d2d/node_8c.html#a8416201a333bcf4949d4eecdb455b206">01820</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a8416201a333bcf4949d4eecdb455b206">node_type_gpu_ext</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">int</span> (*gpuextfunc)(<span class="keyword">struct</span> <a class="code" href="../../de/da3/structGPUMaterial.html">GPUMaterial</a> *mat, <span class="keyword">struct</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">void</span> *nodedata, <span class="keyword">struct</span> <a class="code" href="../../d7/d83/structGPUNodeStack.html">GPUNodeStack</a> *in, <span class="keyword">struct</span> <a class="code" href="../../d7/d83/structGPUNodeStack.html">GPUNodeStack</a> *out))
<a name="l01821"></a>01821 {
<a name="l01822"></a>01822     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ae0c5ffee4dca86e5fbcee903ed7ae297">gpuextfunc</a> = gpuextfunc;
<a name="l01823"></a>01823 }
<a name="l01824"></a>01824 
<a name="l01825"></a><a class="code" href="../../dd/d2d/node_8c.html#a660f1e005dce20d32366db366ecc11df">01825</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a660f1e005dce20d32366db366ecc11df">node_type_compatibility</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, <span class="keywordtype">short</span> compatibility)
<a name="l01826"></a>01826 {
<a name="l01827"></a>01827     ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a43fbc2ad11a4ae4e961ddca49a93b1bd">compatibility</a> = compatibility;
<a name="l01828"></a>01828 }
<a name="l01829"></a>01829 
<a name="l01830"></a><a class="code" href="../../dd/d2d/node_8c.html#a9721b5b02fa72a229a1507404c4deea3">01830</a> <span class="keyword">static</span> <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *<a class="code" href="../../dd/d2d/node_8c.html#a9721b5b02fa72a229a1507404c4deea3">is_nodetype_registered</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *typelist, <span class="keywordtype">int</span> <a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a>) 
<a name="l01831"></a>01831 {
<a name="l01832"></a>01832     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype= typelist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01833"></a>01833     
<a name="l01834"></a>01834     <span class="keywordflow">for</span> (;ntype; ntype= ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ab12a766ae8639a9eb22ef59ec025c67c">next</a> )
<a name="l01835"></a>01835         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>==type)
<a name="l01836"></a>01836             <span class="keywordflow">return</span> ntype;
<a name="l01837"></a>01837     
<a name="l01838"></a>01838     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01839"></a>01839 }
<a name="l01840"></a>01840 
<a name="l01841"></a><a class="code" href="../../dd/d2d/node_8c.html#ab557731496cc0ae146ccb02813d011b9">01841</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aca0dd5d95b739964ba75c4d656922373">nodeRegisterType</a>(<a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ttype, <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype) 
<a name="l01842"></a>01842 {
<a name="l01843"></a>01843     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *typelist = &amp;(ttype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#aa705f91cca0620a6d5ecd112e243ffc5">node_types</a>);
<a name="l01844"></a>01844     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *found= <a class="code" href="../../dd/d2d/node_8c.html#a9721b5b02fa72a229a1507404c4deea3">is_nodetype_registered</a>(typelist, ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>);
<a name="l01845"></a>01845     
<a name="l01846"></a>01846     <span class="keywordflow">if</span> (found==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01847"></a>01847         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(typelist, ntype);
<a name="l01848"></a>01848 }
<a name="l01849"></a>01849 
<a name="l01850"></a><a class="code" href="../../dd/d2d/node_8c.html#ab510baea37a5411543186e8c62448b41">01850</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#ab510baea37a5411543186e8c62448b41">registerCompositNodes</a>(<a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ttype)
<a name="l01851"></a>01851 {
<a name="l01852"></a>01852     <a class="code" href="../../d4/d91/BKE__node_8h.html#aec99bb1d29f4cbd5ad9328a3e5be7b30">register_node_type_frame</a>(ttype);
<a name="l01853"></a>01853     
<a name="l01854"></a>01854     <a class="code" href="../../df/d53/node__composite__common_8c.html#ae01e39e92278ff250da7d95403c834c1">register_node_type_cmp_group</a>(ttype);
<a name="l01855"></a>01855 <span class="comment">//  register_node_type_cmp_forloop(ttype);</span>
<a name="l01856"></a>01856 <span class="comment">//  register_node_type_cmp_whileloop(ttype);</span>
<a name="l01857"></a>01857     
<a name="l01858"></a>01858     <a class="code" href="../../da/d14/node__composite__image_8c.html#abd601f077bd77c59028ad91dc30f68cd">register_node_type_cmp_rlayers</a>(ttype);
<a name="l01859"></a>01859     <a class="code" href="../../da/d14/node__composite__image_8c.html#a89a8280bfada74f2c670f9b562bcb5d5">register_node_type_cmp_image</a>(ttype);
<a name="l01860"></a>01860     <a class="code" href="../../de/d9d/node__composite__texture_8c.html#ab2cf0052b02741a30369f93387d132fb">register_node_type_cmp_texture</a>(ttype);
<a name="l01861"></a>01861     <a class="code" href="../../d3/dea/node__composite__value_8c.html#a5fef2b71cccc268265e0b1a31560dd79">register_node_type_cmp_value</a>(ttype);
<a name="l01862"></a>01862     <a class="code" href="../../d5/d46/node__composite__rgb_8c.html#a0337b29f95cf2fdf88eb2c7f3c9f7794">register_node_type_cmp_rgb</a>(ttype);
<a name="l01863"></a>01863     <a class="code" href="../../dc/dc9/node__composite__curves_8c.html#a1831f841dc4e60ba6995c869e7363a00">register_node_type_cmp_curve_time</a>(ttype);
<a name="l01864"></a>01864     <a class="code" href="../../dd/db3/node__composite__movieclip_8c.html#afe7f59a250a516e675f79df7fd9d1c70">register_node_type_cmp_movieclip</a>(ttype);
<a name="l01865"></a>01865     
<a name="l01866"></a>01866     <a class="code" href="../../df/dd1/node__composite__composite_8c.html#a3c9f55f4a6b04ee8279356029fcacd35">register_node_type_cmp_composite</a>(ttype);
<a name="l01867"></a>01867     <a class="code" href="../../d0/d6b/node__composite__viewer_8c.html#a8a1efe59fd012ab386b494fa3840137e">register_node_type_cmp_viewer</a>(ttype);
<a name="l01868"></a>01868     <a class="code" href="../../db/dc7/node__composite__splitViewer_8c.html#aee3e20f6620e44f007c0b9ba0e2dbc55">register_node_type_cmp_splitviewer</a>(ttype);
<a name="l01869"></a>01869     <a class="code" href="../../d7/dbf/node__composite__outputFile_8c.html#a8f8c90c6b71656856a7b428ea202c54a">register_node_type_cmp_output_file</a>(ttype);
<a name="l01870"></a>01870     <a class="code" href="../../df/dde/node__composite__levels_8c.html#a8bce1163206aecfe30f5ecd9824639f6">register_node_type_cmp_view_levels</a>(ttype);
<a name="l01871"></a>01871     
<a name="l01872"></a>01872     <a class="code" href="../../dc/dc9/node__composite__curves_8c.html#a608de75ea27458fe41afd8c725584a33">register_node_type_cmp_curve_rgb</a>(ttype);
<a name="l01873"></a>01873     <a class="code" href="../../d5/d3e/node__composite__mixrgb_8c.html#a71627521dc21661ecc312ca417648cce">register_node_type_cmp_mix_rgb</a>(ttype);
<a name="l01874"></a>01874     <a class="code" href="../../d5/daf/node__composite__hueSatVal_8c.html#a275ac141e0621ec53a9842a738da7d76">register_node_type_cmp_hue_sat</a>(ttype);
<a name="l01875"></a>01875     <a class="code" href="../../d8/da5/node__composite__brightness_8c.html#a1120548106cdee2b12748d307cd6a9b0">register_node_type_cmp_brightcontrast</a>(ttype);
<a name="l01876"></a>01876     <a class="code" href="../../dd/d05/node__composite__gamma_8c.html#a4f119dccbd830e4c5e17e121c9567386">register_node_type_cmp_gamma</a>(ttype);
<a name="l01877"></a>01877     <a class="code" href="../../db/d0b/node__composite__invert_8c.html#adabba946e31d399e5739a0449767eb3a">register_node_type_cmp_invert</a>(ttype);
<a name="l01878"></a>01878     <a class="code" href="../../d7/d9d/node__composite__alphaOver_8c.html#a326af90cf9e5ac570a9ad35dfaf9b1b6">register_node_type_cmp_alphaover</a>(ttype);
<a name="l01879"></a>01879     <a class="code" href="../../de/d0c/node__composite__zcombine_8c.html#aa8fe76413ff100d7d2d8ca34085a5396">register_node_type_cmp_zcombine</a>(ttype);
<a name="l01880"></a>01880     <a class="code" href="../../d0/d68/node__composite__colorbalance_8c.html#a056b8d8bad67806e9380735faa9650de">register_node_type_cmp_colorbalance</a>(ttype);
<a name="l01881"></a>01881     <a class="code" href="../../d1/db8/node__composite__huecorrect_8c.html#a49aab5731e6ab76c32c163d46df613f8">register_node_type_cmp_huecorrect</a>(ttype);
<a name="l01882"></a>01882     
<a name="l01883"></a>01883     <a class="code" href="../../d6/dda/node__composite__normal_8c.html#a24a0a5f20414e7235b0ac43703fa5b71">register_node_type_cmp_normal</a>(ttype);
<a name="l01884"></a>01884     <a class="code" href="../../dc/dc9/node__composite__curves_8c.html#a8582ee75a3dd5a1357f8b369d4dc7049">register_node_type_cmp_curve_vec</a>(ttype);
<a name="l01885"></a>01885     <a class="code" href="../../d9/d03/node__composite__mapValue_8c.html#af0781a468a46e2648f3a3073da43f42b">register_node_type_cmp_map_value</a>(ttype);
<a name="l01886"></a>01886     <a class="code" href="../../dd/d8f/node__composite__normalize_8c.html#abf8ab55fdb05fe2ed6a55bcd2487c33c">register_node_type_cmp_normalize</a>(ttype);
<a name="l01887"></a>01887     
<a name="l01888"></a>01888     <a class="code" href="../../d8/db5/node__composite__filter_8c.html#a6aea902638e2f33510f6fdd649705595">register_node_type_cmp_filter</a>(ttype);
<a name="l01889"></a>01889     <a class="code" href="../../d3/d03/node__composite__blur_8c.html#a66de7bd588512db03ca4cc7929081952">register_node_type_cmp_blur</a>(ttype);
<a name="l01890"></a>01890     <a class="code" href="../../dd/dd3/node__composite__directionalblur_8c.html#a5d35fdbc4fd0b15b5b74606c14a179c3">register_node_type_cmp_dblur</a>(ttype);
<a name="l01891"></a>01891     <a class="code" href="../../d9/dbb/node__composite__bilateralblur_8c.html#a06fa74d0b2f55b5fd5e200ef36c1d0c9">register_node_type_cmp_bilateralblur</a>(ttype);
<a name="l01892"></a>01892     <a class="code" href="../../da/dc0/node__composite__vecBlur_8c.html#a01325270d959886e0df5b4ccf37dce46">register_node_type_cmp_vecblur</a>(ttype);
<a name="l01893"></a>01893     <a class="code" href="../../d3/df9/node__composite__dilate_8c.html#a1a4841c73cbb6497c98174f23bf69f3d">register_node_type_cmp_dilateerode</a>(ttype);
<a name="l01894"></a>01894     <a class="code" href="../../d0/daf/node__composite__defocus_8c.html#a443e9bbb30c7362fd5ace6c7613e2b37">register_node_type_cmp_defocus</a>(ttype);
<a name="l01895"></a>01895     
<a name="l01896"></a>01896     <a class="code" href="../../dd/df4/node__composite__valToRgb_8c.html#ac14d44dd04d86831659ff9dcbae196cb">register_node_type_cmp_valtorgb</a>(ttype);
<a name="l01897"></a>01897     <a class="code" href="../../dd/df4/node__composite__valToRgb_8c.html#a83d3464000e0cd1d9256922c7bf40bfc">register_node_type_cmp_rgbtobw</a>(ttype);
<a name="l01898"></a>01898     <a class="code" href="../../d5/d80/node__composite__setalpha_8c.html#a5d4c11001375a00a63a34ab5192204d8">register_node_type_cmp_setalpha</a>(ttype);
<a name="l01899"></a>01899     <a class="code" href="../../d4/ded/node__composite__idMask_8c.html#a5c6bb402e1b98a5246d1ffebed0465ba">register_node_type_cmp_idmask</a>(ttype);
<a name="l01900"></a>01900     <a class="code" href="../../db/d9c/node__composite__math_8c.html#afc6db930848e6cfb34b373172524da67">register_node_type_cmp_math</a>(ttype);
<a name="l01901"></a>01901     <a class="code" href="../../dd/da3/node__composite__sepcombRGBA_8c.html#a1a08c0726f84096c3343eb246253dcd1">register_node_type_cmp_seprgba</a>(ttype);
<a name="l01902"></a>01902     <a class="code" href="../../dd/da3/node__composite__sepcombRGBA_8c.html#aab912e653853617eeca9f9c68c395021">register_node_type_cmp_combrgba</a>(ttype);
<a name="l01903"></a>01903     <a class="code" href="../../d4/d52/node__composite__sepcombHSVA_8c.html#a94c900b384578bddb5ff78f5433c6811">register_node_type_cmp_sephsva</a>(ttype);
<a name="l01904"></a>01904     <a class="code" href="../../d4/d52/node__composite__sepcombHSVA_8c.html#a3ba3b59617fe997970d27523b501714b">register_node_type_cmp_combhsva</a>(ttype);
<a name="l01905"></a>01905     <a class="code" href="../../dc/d03/node__composite__sepcombYUVA_8c.html#a51088c1b09a5d1f1c510a5857709d6dd">register_node_type_cmp_sepyuva</a>(ttype);
<a name="l01906"></a>01906     <a class="code" href="../../dc/d03/node__composite__sepcombYUVA_8c.html#a5ba46f11ebba913bc2254165ad5b5468">register_node_type_cmp_combyuva</a>(ttype);
<a name="l01907"></a>01907     <a class="code" href="../../dc/d39/node__composite__sepcombYCCA_8c.html#aae3e7de0cbd80ff655ba12f1e51c833b">register_node_type_cmp_sepycca</a>(ttype);
<a name="l01908"></a>01908     <a class="code" href="../../dc/d39/node__composite__sepcombYCCA_8c.html#a53aedea3969ecbd9c2b462b828d293f1">register_node_type_cmp_combycca</a>(ttype);
<a name="l01909"></a>01909     <a class="code" href="../../d3/d09/node__composite__premulkey_8c.html#a523c20b17d28ec162f39e5a1f09a37fc">register_node_type_cmp_premulkey</a>(ttype);
<a name="l01910"></a>01910     
<a name="l01911"></a>01911     <a class="code" href="../../da/d4d/node__composite__diffMatte_8c.html#a3da7c274b2f8b6d3e40882343f1e980e">register_node_type_cmp_diff_matte</a>(ttype);
<a name="l01912"></a>01912     <a class="code" href="../../d1/d9b/node__composite__distanceMatte_8c.html#abf0ddf04fad4c1d803d3b9bdc4eb798c">register_node_type_cmp_distance_matte</a>(ttype);
<a name="l01913"></a>01913     <a class="code" href="../../d5/dc2/node__composite__chromaMatte_8c.html#a44ee564420b800e87bb51a158d575b9e">register_node_type_cmp_chroma_matte</a>(ttype);
<a name="l01914"></a>01914     <a class="code" href="../../d5/d08/node__composite__colorMatte_8c.html#a72eb0a25aa4929c73f0dedc80e6f17a0">register_node_type_cmp_color_matte</a>(ttype);
<a name="l01915"></a>01915     <a class="code" href="../../d5/d3a/node__composite__channelMatte_8c.html#ab6c867bc1cce22f3bc8d80ac74aca661">register_node_type_cmp_channel_matte</a>(ttype);
<a name="l01916"></a>01916     <a class="code" href="../../d0/d2a/node__composite__colorSpill_8c.html#acd8fc70515f123c971af51a17881c2b5">register_node_type_cmp_color_spill</a>(ttype);
<a name="l01917"></a>01917     <a class="code" href="../../d3/da7/node__composite__lummaMatte_8c.html#a5c29e7f7c5f7be352aac225f0a7d0614">register_node_type_cmp_luma_matte</a>(ttype);
<a name="l01918"></a>01918     <a class="code" href="../../d1/d2a/node__composite__doubleEdgeMask_8c.html#a4fce2be03627cbe2d7332c121852fe7d">register_node_type_cmp_doubleedgemask</a>(ttype);
<a name="l01919"></a>01919 
<a name="l01920"></a>01920     <a class="code" href="../../df/d70/node__composite__translate_8c.html#a5a85b662e7e8f5ef8fd1bff1094f1b8a">register_node_type_cmp_translate</a>(ttype);
<a name="l01921"></a>01921     <a class="code" href="../../dc/d59/node__composite__rotate_8c.html#a528c641ccd84675917e5ce32c1b94667">register_node_type_cmp_rotate</a>(ttype);
<a name="l01922"></a>01922     <a class="code" href="../../dc/de6/node__composite__scale_8c.html#ae32eb09f475208a53849caa6a115be24">register_node_type_cmp_scale</a>(ttype);
<a name="l01923"></a>01923     <a class="code" href="../../dd/df3/node__composite__flip_8c.html#a436454e266a5131557816cdd35341f85">register_node_type_cmp_flip</a>(ttype);
<a name="l01924"></a>01924     <a class="code" href="../../d8/dcd/node__composite__crop_8c.html#a4df53aca9fdb678699a29c8d1e35ddc6">register_node_type_cmp_crop</a>(ttype);
<a name="l01925"></a>01925     <a class="code" href="../../da/dc0/node__composite__displace_8c.html#a65be2b4a8d851c2d917aa5df6f84e18a">register_node_type_cmp_displace</a>(ttype);
<a name="l01926"></a>01926     <a class="code" href="../../d6/de6/node__composite__mapUV_8c.html#a1199b9a396792419ed0d384dfab1ef77">register_node_type_cmp_mapuv</a>(ttype);
<a name="l01927"></a>01927     <a class="code" href="../../d4/d39/node__composite__glare_8c.html#aaaa074cfbff255cd9bf9ee6fc9fbfaa5">register_node_type_cmp_glare</a>(ttype);
<a name="l01928"></a>01928     <a class="code" href="../../d8/dda/node__composite__tonemap_8c.html#ac9c6c0b49c5b379bf43794e4aaf4cc21">register_node_type_cmp_tonemap</a>(ttype);
<a name="l01929"></a>01929     <a class="code" href="../../d8/d0b/node__composite__lensdist_8c.html#af3ebc48aae495251e26a81da8d41572b">register_node_type_cmp_lensdist</a>(ttype);
<a name="l01930"></a>01930     <a class="code" href="../../dd/d13/node__composite__transform_8c.html#ab9572673f8ce902b8971b1d6d794cb44">register_node_type_cmp_transform</a>(ttype);
<a name="l01931"></a>01931     <a class="code" href="../../da/d5c/node__composite__stabilize2d_8c.html#a7284c9faaa44c8bfbd1c8b763d9b78ac">register_node_type_cmp_stabilize2d</a>(ttype);
<a name="l01932"></a>01932     <a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#a36e92f2ad30c5f39f200d59b0f5db918">register_node_type_cmp_moviedistortion</a>(ttype);
<a name="l01933"></a>01933 }
<a name="l01934"></a>01934 
<a name="l01935"></a><a class="code" href="../../dd/d2d/node_8c.html#a2eac3621ed2054c00658d3157f22f4cc">01935</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a2eac3621ed2054c00658d3157f22f4cc">registerShaderNodes</a>(<a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ttype) 
<a name="l01936"></a>01936 {
<a name="l01937"></a>01937     <a class="code" href="../../d4/d91/BKE__node_8h.html#aec99bb1d29f4cbd5ad9328a3e5be7b30">register_node_type_frame</a>(ttype);
<a name="l01938"></a>01938     
<a name="l01939"></a>01939     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a65411bafe6b5292f6ee0480447663873">register_node_type_sh_group</a>(ttype);
<a name="l01940"></a>01940     <span class="comment">//register_node_type_sh_forloop(ttype);</span>
<a name="l01941"></a>01941     <span class="comment">//register_node_type_sh_whileloop(ttype);</span>
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a560ec05c2f0af1232112c2c69f2076cc">register_node_type_sh_output</a>(ttype);
<a name="l01944"></a>01944     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#acd7a16ec6ae6f95488569e2c9487445a">register_node_type_sh_material</a>(ttype);
<a name="l01945"></a>01945     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a30e6443dc46b4270ff28c2f90d1f370d">register_node_type_sh_camera</a>(ttype);
<a name="l01946"></a>01946     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a57625631b8065a491fd2fb6ae85e88ec">register_node_type_sh_gamma</a>(ttype);
<a name="l01947"></a>01947     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a2245a82588b0211729c4abb34630ec59">register_node_type_sh_brightcontrast</a>(ttype);
<a name="l01948"></a>01948     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a8a07a961d238618c545119ed3b660bdc">register_node_type_sh_value</a>(ttype);
<a name="l01949"></a>01949     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a5eaa4f5c0de83a7b80422685064e15c7">register_node_type_sh_rgb</a>(ttype);
<a name="l01950"></a>01950     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a6997817efd66e77b754b9868fb4fc261">register_node_type_sh_mix_rgb</a>(ttype);
<a name="l01951"></a>01951     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a84acafa4c858047d7c85a8e3fdaacb9f">register_node_type_sh_valtorgb</a>(ttype);
<a name="l01952"></a>01952     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a8669582f93d1f629c6c208df518909f9">register_node_type_sh_rgbtobw</a>(ttype);
<a name="l01953"></a>01953     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#af9d8deaa8e1060f6b4a77e6f3893c48c">register_node_type_sh_texture</a>(ttype);
<a name="l01954"></a>01954     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a58db7ecb196da40b2214e2a5cc56bd33">register_node_type_sh_normal</a>(ttype);
<a name="l01955"></a>01955     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a8d0bc8f0412eb285f466887f639106c8">register_node_type_sh_geom</a>(ttype);
<a name="l01956"></a>01956     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#ac786e52744f3ab9775b3d744d151e6e2">register_node_type_sh_mapping</a>(ttype);
<a name="l01957"></a>01957     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a8760b62a39ba902dfc4aa19fd35684a1">register_node_type_sh_curve_vec</a>(ttype);
<a name="l01958"></a>01958     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#ad5649b08df74aaacb08807479856c110">register_node_type_sh_curve_rgb</a>(ttype);
<a name="l01959"></a>01959     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a1bdf6ad5c52d8fbeea8fc7dc05ecd353">register_node_type_sh_math</a>(ttype);
<a name="l01960"></a>01960     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a09a287e68bca658869a98040a19def1e">register_node_type_sh_vect_math</a>(ttype);
<a name="l01961"></a>01961     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a804e29eee763297789f978acb574a7cf">register_node_type_sh_squeeze</a>(ttype);
<a name="l01962"></a>01962     <span class="comment">//register_node_type_sh_dynamic(ttype);</span>
<a name="l01963"></a>01963     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a840ed90a50ecb0e868f2dd39bc29d68f">register_node_type_sh_material_ext</a>(ttype);
<a name="l01964"></a>01964     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#af365ae503422f41363e96dadd9180a5d">register_node_type_sh_invert</a>(ttype);
<a name="l01965"></a>01965     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#aa9962faedb9b2976e0fc449ed28684b8">register_node_type_sh_seprgb</a>(ttype);
<a name="l01966"></a>01966     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a410780e46454a37323816fe3b3d21d19">register_node_type_sh_combrgb</a>(ttype);
<a name="l01967"></a>01967     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a35acab55bf5b4513b2bcb3670679522d">register_node_type_sh_hue_sat</a>(ttype);
<a name="l01968"></a>01968 
<a name="l01969"></a>01969     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a54ddb39f6bdbf8f656328f849722951e">register_node_type_sh_attribute</a>(ttype);
<a name="l01970"></a>01970     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a4e78aec3fd96a904db52ef0446e0a901">register_node_type_sh_geometry</a>(ttype);
<a name="l01971"></a>01971     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a95f2e4aa4d47e02a9e1e7419b669416f">register_node_type_sh_light_path</a>(ttype);
<a name="l01972"></a>01972     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a65611f39cd86abf37cf44e18cf3da99f">register_node_type_sh_fresnel</a>(ttype);
<a name="l01973"></a>01973     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a332e3b9abe47185def841cd57c51a8c9">register_node_type_sh_layer_weight</a>(ttype);
<a name="l01974"></a>01974     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a9b662f204400e2c5302f941ddf0fdf03">register_node_type_sh_tex_coord</a>(ttype);
<a name="l01975"></a>01975 
<a name="l01976"></a>01976     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a442fec4340eb649163a537022a2e54c7">register_node_type_sh_background</a>(ttype);
<a name="l01977"></a>01977     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a3ab0c1878e8cab57fb8e4b29b4b21130">register_node_type_sh_bsdf_diffuse</a>(ttype);
<a name="l01978"></a>01978     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#aaa343d43dbf79f87192c6d9afc11d559">register_node_type_sh_bsdf_glossy</a>(ttype);
<a name="l01979"></a>01979     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a1d8053aed385da18569819773c2e92e3">register_node_type_sh_bsdf_glass</a>(ttype);
<a name="l01980"></a>01980     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a940686284684492b561d55ffb670fc64">register_node_type_sh_bsdf_translucent</a>(ttype);
<a name="l01981"></a>01981     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a6f89dc500f58d9ee7be7911d3c9223f6">register_node_type_sh_bsdf_transparent</a>(ttype);
<a name="l01982"></a>01982     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#aa2845de463446ef0652dd26bb22277b0">register_node_type_sh_bsdf_velvet</a>(ttype);
<a name="l01983"></a>01983     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a31f2e9b1d92975f06077a24718f6f99b">register_node_type_sh_emission</a>(ttype);
<a name="l01984"></a>01984     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#ae04eb7258ef280c9209b178a88752d60">register_node_type_sh_holdout</a>(ttype);
<a name="l01985"></a>01985     <span class="comment">//register_node_type_sh_volume_transparent(ttype);</span>
<a name="l01986"></a>01986     <span class="comment">//register_node_type_sh_volume_isotropic(ttype);</span>
<a name="l01987"></a>01987     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a90e96e9704c535c0eb705730baa685b9">register_node_type_sh_mix_shader</a>(ttype);
<a name="l01988"></a>01988     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#aaa05f2147883fef0e3f8fa8683dd2d00">register_node_type_sh_add_shader</a>(ttype);
<a name="l01989"></a>01989 
<a name="l01990"></a>01990     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a97f69a10aeb441c32c6a61f6184a1175">register_node_type_sh_output_lamp</a>(ttype);
<a name="l01991"></a>01991     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a7052dcf6a8f0f703a1e8d363638ce3e5">register_node_type_sh_output_material</a>(ttype);
<a name="l01992"></a>01992     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a95a3f9bf0da8a99ea857ca514f8bcd61">register_node_type_sh_output_world</a>(ttype);
<a name="l01993"></a>01993 
<a name="l01994"></a>01994     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a86ef582af729715e2b3f2a6043016a98">register_node_type_sh_tex_image</a>(ttype);
<a name="l01995"></a>01995     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#aaa89072bc0a0cc277e8471f3be93e84c">register_node_type_sh_tex_environment</a>(ttype);
<a name="l01996"></a>01996     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a1d1f9a2ed1bdb9a16e0f0ca39c882080">register_node_type_sh_tex_sky</a>(ttype);
<a name="l01997"></a>01997     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a129fb7150ddbfca68fac7f17d9a59e96">register_node_type_sh_tex_noise</a>(ttype);
<a name="l01998"></a>01998     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a8dd7813797f660b7fb7fb95653e97788">register_node_type_sh_tex_wave</a>(ttype);
<a name="l01999"></a>01999     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a2575a48c2d8160fb045ac0f991b0a03b">register_node_type_sh_tex_voronoi</a>(ttype);
<a name="l02000"></a>02000     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a16b689616e7b05b5eb37c79faa9e4911">register_node_type_sh_tex_musgrave</a>(ttype);
<a name="l02001"></a>02001     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#a4dd5f24926becc01ea79179cf0bc32bd">register_node_type_sh_tex_gradient</a>(ttype);
<a name="l02002"></a>02002     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#aa691b34db4976841fa1558fd5a7144b4">register_node_type_sh_tex_magic</a>(ttype);
<a name="l02003"></a>02003     <a class="code" href="../../d8/d3a/NOD__shader_8h.html#af98f6db9adc78639e0df5786dda6f872">register_node_type_sh_tex_checker</a>(ttype);
<a name="l02004"></a>02004 }
<a name="l02005"></a>02005 
<a name="l02006"></a><a class="code" href="../../dd/d2d/node_8c.html#a447f62162ed54359bcdaca436fdde7e8">02006</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#a447f62162ed54359bcdaca436fdde7e8">registerTextureNodes</a>(<a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ttype)
<a name="l02007"></a>02007 {
<a name="l02008"></a>02008     <a class="code" href="../../d4/d91/BKE__node_8h.html#aec99bb1d29f4cbd5ad9328a3e5be7b30">register_node_type_frame</a>(ttype);
<a name="l02009"></a>02009     
<a name="l02010"></a>02010     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a62612b3a9121a10c0459f2446b559c14">register_node_type_tex_group</a>(ttype);
<a name="l02011"></a>02011 <span class="comment">//  register_node_type_tex_forloop(ttype);</span>
<a name="l02012"></a>02012 <span class="comment">//  register_node_type_tex_whileloop(ttype);</span>
<a name="l02013"></a>02013     
<a name="l02014"></a>02014     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#abb89d8da6172211a8c27ce14aad900ab">register_node_type_tex_math</a>(ttype);
<a name="l02015"></a>02015     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a6b715f6481576c9db6352a365efe2236">register_node_type_tex_mix_rgb</a>(ttype);
<a name="l02016"></a>02016     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#aace1bb59ff70c189f542f100a34a01ca">register_node_type_tex_valtorgb</a>(ttype);
<a name="l02017"></a>02017     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#aab8d9b880024e88ac420c6f51fe7c259">register_node_type_tex_rgbtobw</a>(ttype);
<a name="l02018"></a>02018     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#ae039bc5883235a101fbd3798b56bb2b5">register_node_type_tex_valtonor</a>(ttype);
<a name="l02019"></a>02019     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#add67f0fea176452bcf8c5f346dfbe5cc">register_node_type_tex_curve_rgb</a>(ttype);
<a name="l02020"></a>02020     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a93a758464370d1b5febb46f51aa08c6d">register_node_type_tex_curve_time</a>(ttype);
<a name="l02021"></a>02021     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a8b4afd42517c06590c84b4f49f3a4f6c">register_node_type_tex_invert</a>(ttype);
<a name="l02022"></a>02022     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a4d27476e2d76a9fd909e7806d6a4c31c">register_node_type_tex_hue_sat</a>(ttype);
<a name="l02023"></a>02023     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#aae2d32e95281ba8c0dedfdd3c72355c8">register_node_type_tex_coord</a>(ttype);
<a name="l02024"></a>02024     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a6d9b2e2d49438e03617e71f87533d640">register_node_type_tex_distance</a>(ttype);
<a name="l02025"></a>02025     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#aee5a575ede317227817e9e62e621ea74">register_node_type_tex_compose</a>(ttype);
<a name="l02026"></a>02026     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a42a570aab3991c3380dfd59cf099091f">register_node_type_tex_decompose</a>(ttype);
<a name="l02027"></a>02027     
<a name="l02028"></a>02028     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a761c84062a135963fe9f52f95b4dd281">register_node_type_tex_output</a>(ttype);
<a name="l02029"></a>02029     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a41624c5e68e80c97fa493def51dac531">register_node_type_tex_viewer</a>(ttype);
<a name="l02030"></a>02030     
<a name="l02031"></a>02031     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a14c2306c64483aebe852bf011e47bd7d">register_node_type_tex_checker</a>(ttype);
<a name="l02032"></a>02032     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a0138a47162b3aa96a56b978f25824111">register_node_type_tex_texture</a>(ttype);
<a name="l02033"></a>02033     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a52da76ea93fccee722ab29127c57c0ba">register_node_type_tex_bricks</a>(ttype);
<a name="l02034"></a>02034     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a26d0e44fea9274e6d8e5874db1150e6b">register_node_type_tex_image</a>(ttype);
<a name="l02035"></a>02035     
<a name="l02036"></a>02036     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#aa790ab1f08dbc5542ba898e96e756c93">register_node_type_tex_rotate</a>(ttype);
<a name="l02037"></a>02037     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a430241110906f8373593ad26ff3121d3">register_node_type_tex_translate</a>(ttype);
<a name="l02038"></a>02038     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a0c152709fedaf5a09c7ce6c69d64700a">register_node_type_tex_scale</a>(ttype);
<a name="l02039"></a>02039     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a82e2aec1ed163d58ae79092fd6d67fba">register_node_type_tex_at</a>(ttype);
<a name="l02040"></a>02040     
<a name="l02041"></a>02041     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a7dd14fedfc6ab43624c44d696f6717b6">register_node_type_tex_proc_voronoi</a>(ttype);
<a name="l02042"></a>02042     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a3312656a1d6b03900b59b5cd6dc4d008">register_node_type_tex_proc_blend</a>(ttype);
<a name="l02043"></a>02043     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a493230635e033901f7d048ee1d4abdc0">register_node_type_tex_proc_magic</a>(ttype);
<a name="l02044"></a>02044     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#ab83bdced9c15243ff76761b0a29689f1">register_node_type_tex_proc_marble</a>(ttype);
<a name="l02045"></a>02045     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a88baba1fb9ef428d760dacd6b0492166">register_node_type_tex_proc_clouds</a>(ttype);
<a name="l02046"></a>02046     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a30e4960191f14e83962c24c57a71842e">register_node_type_tex_proc_wood</a>(ttype);
<a name="l02047"></a>02047     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a0c0ffe1a14b29df19a36b336760a9f1a">register_node_type_tex_proc_musgrave</a>(ttype);
<a name="l02048"></a>02048     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#ac9e671d9c5e595f563c0df7d3ce95fd5">register_node_type_tex_proc_noise</a>(ttype);
<a name="l02049"></a>02049     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a608c861374344acbf4c24f8f9e7ce14d">register_node_type_tex_proc_stucci</a>(ttype);
<a name="l02050"></a>02050     <a class="code" href="../../d4/dfc/NOD__texture_8h.html#a4ac759de72b7ab02a4a071cef1383fbc">register_node_type_tex_proc_distnoise</a>(ttype);
<a name="l02051"></a>02051 }
<a name="l02052"></a>02052 
<a name="l02053"></a><a class="code" href="../../dd/d2d/node_8c.html#af4c002d34d1ef730fdffa9a99e8798c8">02053</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#af4c002d34d1ef730fdffa9a99e8798c8">free_dynamic_typeinfo</a>(<a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype)
<a name="l02054"></a>02054 {
<a name="l02055"></a>02055     <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a2c68ef059534ec7a55087732345e875e">NODE_DYNAMIC</a>) {
<a name="l02056"></a>02056         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#acca5296bd3e77a5dc7a18b0b5c0f15eb">inputs</a>) {
<a name="l02057"></a>02057             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#acca5296bd3e77a5dc7a18b0b5c0f15eb">inputs</a>);
<a name="l02058"></a>02058         }
<a name="l02059"></a>02059         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6c0d9e5ca5dcfb5aa866279350ecd736">outputs</a>) {
<a name="l02060"></a>02060             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6c0d9e5ca5dcfb5aa866279350ecd736">outputs</a>);
<a name="l02061"></a>02061         }
<a name="l02062"></a>02062         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>) {
<a name="l02063"></a>02063             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>((<span class="keywordtype">void</span> *)ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a243fb617d7fb3f6cd65f790fb4c842e8">name</a>);
<a name="l02064"></a>02064         }
<a name="l02065"></a>02065     }
<a name="l02066"></a>02066 }
<a name="l02067"></a>02067 
<a name="l02068"></a><a class="code" href="../../dd/d2d/node_8c.html#ae628d7accc301b6922aa6f6b0fee6506">02068</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d2d/node_8c.html#ae628d7accc301b6922aa6f6b0fee6506">free_typeinfos</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l02069"></a>02069 {
<a name="l02070"></a>02070     <a class="code" href="../../dd/d0c/structbNodeType.html">bNodeType</a> *ntype, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02071"></a>02071     <span class="keywordflow">for</span> (ntype=list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntype; ntype=next) {
<a name="l02072"></a>02072         next = ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ab12a766ae8639a9eb22ef59ec025c67c">next</a>;
<a name="l02073"></a>02073         
<a name="l02074"></a>02074         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a66a213878b84a017e1583948363771f2">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a2c68ef059534ec7a55087732345e875e">NODE_DYNAMIC</a>)
<a name="l02075"></a>02075             <a class="code" href="../../dd/d2d/node_8c.html#af4c002d34d1ef730fdffa9a99e8798c8">free_dynamic_typeinfo</a>(ntype);
<a name="l02076"></a>02076         
<a name="l02077"></a>02077         <span class="keywordflow">if</span> (ntype-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6d95ff353a678ebd6376a4ea88bd04cd">needs_free</a>)
<a name="l02078"></a>02078             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ntype);
<a name="l02079"></a>02079     }
<a name="l02080"></a>02080 }
<a name="l02081"></a>02081 
<a name="l02082"></a><a class="code" href="../../dd/d2d/node_8c.html#ab3cc0a5a771338a14e263a1deadff952">02082</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ab3cc0a5a771338a14e263a1deadff952">init_nodesystem</a>(<span class="keywordtype">void</span>) 
<a name="l02083"></a>02083 {
<a name="l02084"></a>02084     <a class="code" href="../../dd/d2d/node_8c.html#ab510baea37a5411543186e8c62448b41">registerCompositNodes</a>(<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>));
<a name="l02085"></a>02085     <a class="code" href="../../dd/d2d/node_8c.html#a2eac3621ed2054c00658d3157f22f4cc">registerShaderNodes</a>(<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>));
<a name="l02086"></a>02086     <a class="code" href="../../dd/d2d/node_8c.html#a447f62162ed54359bcdaca436fdde7e8">registerTextureNodes</a>(<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>));
<a name="l02087"></a>02087 }
<a name="l02088"></a>02088 
<a name="l02089"></a><a class="code" href="../../dd/d2d/node_8c.html#a99f937f95c0ff67816e0accd45931ad3">02089</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a99f937f95c0ff67816e0accd45931ad3">free_nodesystem</a>(<span class="keywordtype">void</span>) 
<a name="l02090"></a>02090 {
<a name="l02091"></a>02091     <a class="code" href="../../dd/d2d/node_8c.html#ae628d7accc301b6922aa6f6b0fee6506">free_typeinfos</a>(&amp;<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>)-&gt;node_types);
<a name="l02092"></a>02092     <a class="code" href="../../dd/d2d/node_8c.html#ae628d7accc301b6922aa6f6b0fee6506">free_typeinfos</a>(&amp;<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>)-&gt;node_types);
<a name="l02093"></a>02093     <a class="code" href="../../dd/d2d/node_8c.html#ae628d7accc301b6922aa6f6b0fee6506">free_typeinfos</a>(&amp;<a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>)-&gt;node_types);
<a name="l02094"></a>02094 }
<a name="l02095"></a>02095 
<a name="l02096"></a>02096 <span class="comment">/* called from unlink_scene, when deleting a scene goes over all scenes</span>
<a name="l02097"></a>02097 <span class="comment"> * other than the input, checks if they have render layer nodes referencing</span>
<a name="l02098"></a>02098 <span class="comment"> * the to-be-deleted scene, and resets them to NULL. */</span>
<a name="l02099"></a>02099 
<a name="l02100"></a>02100 <span class="comment">/* XXX needs to get current scene then! */</span>
<a name="l02101"></a><a class="code" href="../../dd/d2d/node_8c.html#aea395f7d8a39c80e938d141002d950c1">02101</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a259f4d799ba3a86f66b034c9d4693d3c">clear_scene_in_nodes</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l02102"></a>02102 {
<a name="l02103"></a>02103     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce1;
<a name="l02104"></a>02104     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106     <span class="keywordflow">for</span> (sce1= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce1; sce1=sce1-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02107"></a>02107         <span class="keywordflow">if</span> (sce1!=sce) {
<a name="l02108"></a>02108             <span class="keywordflow">if</span> (sce1-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l02109"></a>02109                 <span class="keywordflow">for</span> (node= sce1-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02110"></a>02110                     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>) {
<a name="l02111"></a>02111                         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *nodesce= (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l02112"></a>02112                         
<a name="l02113"></a>02113                         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (nodesce==sce) node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02114"></a>02114                     }
<a name="l02115"></a>02115                 }
<a name="l02116"></a>02116             }
<a name="l02117"></a>02117         }
<a name="l02118"></a>02118     }
<a name="l02119"></a>02119 }
<a name="l02120"></a>02120 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:34 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

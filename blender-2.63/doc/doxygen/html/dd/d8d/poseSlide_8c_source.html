<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: poseSlide.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">poseSlide.c</div>  </div>
</div>
<div class="contents">
<a href="../../dd/d8d/poseSlide_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2009, Blender Foundation, Joshua Leung</span>
<a name="l00019"></a>00019 <span class="comment"> * This is a new part of Blender</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Joshua Leung</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/BLI__dynstr_8h.html" title="A dynamically sized string ADT.">BLI_dynstr.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html">BLI_dlrbTree.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d98/ED__armature_8h.html">ED_armature.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/df9/ED__keyframes__draw_8h.html">ED_keyframes_draw.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d26/armature__intern_8h.html">armature_intern.h</a>&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">/* **************************************************** */</span>
<a name="l00071"></a>00071 <span class="comment">/* == POSE &#39;SLIDING&#39; TOOLS == </span>
<a name="l00072"></a>00072 <span class="comment"> *</span>
<a name="l00073"></a>00073 <span class="comment"> * A) Push &amp; Relax, Breakdowner</span>
<a name="l00074"></a>00074 <span class="comment"> * These tools provide the animator with various capabilities</span>
<a name="l00075"></a>00075 <span class="comment"> * for interactively controlling the spacing of poses, but also</span>
<a name="l00076"></a>00076 <span class="comment"> * for &#39;pushing&#39; and/or &#39;relaxing&#39; extremes as they see fit.</span>
<a name="l00077"></a>00077 <span class="comment"> *</span>
<a name="l00078"></a>00078 <span class="comment"> * B) Propagate</span>
<a name="l00079"></a>00079 <span class="comment"> * This tool copies elements of the selected pose to successive</span>
<a name="l00080"></a>00080 <span class="comment"> * keyframes, allowing the animator to go back and modify the poses</span>
<a name="l00081"></a>00081 <span class="comment"> * for some &quot;static&quot; pose controls, without having to repeatedly</span>
<a name="l00082"></a>00082 <span class="comment"> * doing a &quot;next paste&quot; dance.</span>
<a name="l00083"></a>00083 <span class="comment"> *</span>
<a name="l00084"></a>00084 <span class="comment"> * C) Pose Sculpting</span>
<a name="l00085"></a>00085 <span class="comment"> * This is yet to be implemented, but the idea here is to use</span>
<a name="l00086"></a>00086 <span class="comment"> * sculpting techniques to make it easier to pose rigs by allowing</span>
<a name="l00087"></a>00087 <span class="comment"> * rigs to be manipulated using a familiar paint-based interface. </span>
<a name="l00088"></a>00088 <span class="comment"> */</span>
<a name="l00089"></a>00089 <span class="comment">/* **************************************************** */</span>
<a name="l00090"></a>00090 <span class="comment">/* A) Push &amp; Relax, Breakdowner */</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* Temporary data shared between these operators */</span>
<a name="l00093"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html">00093</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> {
<a name="l00094"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#aea38211ab3a95dd44824fdd094784fe9">00094</a>     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../de/db9/structtPoseSlideOp.html#aea38211ab3a95dd44824fdd094784fe9">scene</a>;       <span class="comment">/* current scene */</span>
<a name="l00095"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a70ab0d25a8110360aae5f4746e4e926c">00095</a>     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../de/db9/structtPoseSlideOp.html#a70ab0d25a8110360aae5f4746e4e926c">sa</a>;        <span class="comment">/* area that we&#39;re operating in (needed for modal()) */</span>
<a name="l00096"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#ad5aa6fe6228e0c877966249b2abb6801">00096</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../de/db9/structtPoseSlideOp.html#ad5aa6fe6228e0c877966249b2abb6801">ar</a>;        <span class="comment">/* region that we&#39;re operating in (needed for modal()) */</span>
<a name="l00097"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">00097</a>     <a class="code" href="../../de/de7/structObject.html">Object</a> *<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>;         <span class="comment">/* active object that Pose Info comes from */</span>
<a name="l00098"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#af82a99cb85c5f6178d75da74f34949e8">00098</a>     <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *<a class="code" href="../../de/db9/structtPoseSlideOp.html#af82a99cb85c5f6178d75da74f34949e8">arm</a>;     <span class="comment">/* armature for pose */</span>
<a name="l00099"></a>00099     
<a name="l00100"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">00100</a>     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>;   <span class="comment">/* links between posechannels and f-curves  */</span>
<a name="l00101"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">00101</a>     <a class="code" href="../../d1/d5d/structDLRBT__Tree.html">DLRBT_Tree</a> <a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>;    <span class="comment">/* binary tree for quicker searching for keyframes (when applicable) */</span>
<a name="l00102"></a>00102     
<a name="l00103"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">00103</a>     <span class="keywordtype">int</span> <a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a>;         <span class="comment">/* current frame number */</span>
<a name="l00104"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">00104</a>     <span class="keywordtype">int</span> <a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>;      <span class="comment">/* frame before current frame (blend-from) */</span>
<a name="l00105"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">00105</a>     <span class="keywordtype">int</span> <a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>;      <span class="comment">/* frame after current frame (blend-to) */</span>
<a name="l00106"></a>00106     
<a name="l00107"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">00107</a>     <span class="keywordtype">int</span> <a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a>;           <span class="comment">/* sliding mode (ePoseSlide_Modes) */</span>
<a name="l00108"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a0d74a9c9f449556a8227b480fc6ca026">00108</a>     <span class="keywordtype">int</span> <a class="code" href="../../de/db9/structtPoseSlideOp.html#a0d74a9c9f449556a8227b480fc6ca026">flag</a>;           <span class="comment">// unused for now, but can later get used for storing runtime settings....</span>
<a name="l00109"></a>00109     
<a name="l00110"></a><a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">00110</a>     <span class="keywordtype">float</span> <a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>;   <span class="comment">/* 0-1 value for determining the influence of whatever is relevant */</span>
<a name="l00111"></a>00111 } <a class="code" href="../../dd/d8d/poseSlide_8c.html#a8c4c43f49ae90e805fb593afd8410f1b">tPoseSlideOp</a>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="comment">/* Pose Sliding Modes */</span>
<a name="l00114"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3">00114</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3">ePoseSlide_Modes</a> {
<a name="l00115"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">00115</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">POSESLIDE_PUSH</a>  = 0,        <span class="comment">/* exaggerate the pose... */</span>
<a name="l00116"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3adc917cf1381c43f7042ddb7d345e05d4">00116</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3adc917cf1381c43f7042ddb7d345e05d4">POSESLIDE_RELAX</a>,            <span class="comment">/* soften the pose... */</span>
<a name="l00117"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">00117</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>,        <span class="comment">/* slide between the endpoint poses, finding a &#39;soft&#39; spot */</span>
<a name="l00118"></a>00118 } <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3">ePoseSlide_Modes</a>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">/* ------------------------------------ */</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">/* operator init */</span>
<a name="l00123"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">00123</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">short</span> mode)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00126"></a>00126     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00127"></a>00127     
<a name="l00128"></a>00128     <span class="comment">/* init slide-op data */</span>
<a name="l00129"></a>00129     pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a>), <span class="stringliteral">&quot;tPoseSlideOp&quot;</span>);
<a name="l00130"></a>00130     
<a name="l00131"></a>00131     <span class="comment">/* get info from context */</span>
<a name="l00132"></a>00132     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#aea38211ab3a95dd44824fdd094784fe9">scene</a>= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00133"></a>00133     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>= <a class="code" href="../../df/dac/BKE__object_8h.html#a7c81fbe77e3bc5283e2746857d88c94c">object_pose_armature_get</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C));
<a name="l00134"></a>00134     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#af82a99cb85c5f6178d75da74f34949e8">arm</a>= (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>)? pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00135"></a>00135     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a70ab0d25a8110360aae5f4746e4e926c">sa</a>= <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C); <span class="comment">/* only really needed when doing modal() */</span>
<a name="l00136"></a>00136     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ad5aa6fe6228e0c877966249b2abb6801">ar</a>= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C); <span class="comment">/* only really needed when doing modal() */</span>
<a name="l00137"></a>00137     
<a name="l00138"></a>00138     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a>= pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#aea38211ab3a95dd44824fdd094784fe9">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l00139"></a>00139     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a>= mode;
<a name="l00140"></a>00140     
<a name="l00141"></a>00141     <span class="comment">/* set range info from property values - these may get overridden for the invoke() */</span>
<a name="l00142"></a>00142     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>= <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;percentage&quot;</span>);
<a name="l00143"></a>00143     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>= <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;prev_frame&quot;</span>);
<a name="l00144"></a>00144     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>= <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;next_frame&quot;</span>);
<a name="l00145"></a>00145     
<a name="l00146"></a>00146     <span class="comment">/* check the settings from the context */</span>
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#af82a99cb85c5f6178d75da74f34949e8">arm</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>))
<a name="l00148"></a>00148         <span class="keywordflow">return</span> 0;
<a name="l00149"></a>00149     <span class="keywordflow">else</span>
<a name="l00150"></a>00150         act= pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l00151"></a>00151     
<a name="l00152"></a>00152     <span class="comment">/* for each Pose-Channel which gets affected, get the F-Curves for that channel </span>
<a name="l00153"></a>00153 <span class="comment">     * and set the relevant transform flags...</span>
<a name="l00154"></a>00154 <span class="comment">     */</span>
<a name="l00155"></a>00155     <a class="code" href="../../dc/d26/armature__intern_8h.html#a1eb817b4568ad188efc563cedfbae55e">poseAnim_mapping_get</a>(C, &amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>, act);
<a name="l00156"></a>00156     
<a name="l00157"></a>00157     <span class="comment">/* set depsgraph flags */</span>
<a name="l00158"></a>00158         <span class="comment">/* make sure the lock is set OK, unlock can be accidentally saved? */</span>
<a name="l00159"></a>00159     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483da1c4860e42b03f3df7793fd48276aba39">POSE_LOCKED</a>;
<a name="l00160"></a>00160     pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> &amp;= ~<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483da20b58cdb8e3733b1459498b01c29234d">POSE_DO_UNLOCK</a>;
<a name="l00161"></a>00161     
<a name="l00162"></a>00162     <span class="comment">/* do basic initialize of RB-BST used for finding keyframes, but leave the filling of it up </span>
<a name="l00163"></a>00163 <span class="comment">     * to the caller of this (usually only invoke() will do it, to make things more efficient).</span>
<a name="l00164"></a>00164 <span class="comment">     */</span>
<a name="l00165"></a>00165     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a252f6abeef3b6e861da84630cbdbb02b">BLI_dlrbTree_init</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>);
<a name="l00166"></a>00166     
<a name="l00167"></a>00167     <span class="comment">/* return status is whether we&#39;ve got all the data we were requested to get */</span>
<a name="l00168"></a>00168     <span class="keywordflow">return</span> 1;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="comment">/* exiting the operator - free data */</span>
<a name="l00172"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">00172</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00175"></a>00175     
<a name="l00176"></a>00176     <span class="comment">/* if data exists, clear its data and exit */</span>
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (pso) {
<a name="l00178"></a>00178         <span class="comment">/* free the temp pchan links and their data */</span>
<a name="l00179"></a>00179         <a class="code" href="../../dc/d26/armature__intern_8h.html#a16e9e9b54a5f7436207884082965be0d">poseAnim_mapping_free</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>);
<a name="l00180"></a>00180         
<a name="l00181"></a>00181         <span class="comment">/* free RB-BST for keyframes (if it contained data) */</span>
<a name="l00182"></a>00182         <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#af6bec977f19ccbbea32e1aec6ed00341">BLI_dlrbTree_free</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>);
<a name="l00183"></a>00183         
<a name="l00184"></a>00184         <span class="comment">/* free data itself */</span>
<a name="l00185"></a>00185         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pso);
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     <span class="comment">/* cleanup */</span>
<a name="l00189"></a>00189     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">/* ------------------------------------ */</span>
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 <span class="comment">/* helper for apply() / reset() - refresh the data */</span>
<a name="l00195"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a816fa62df4b678675ebd207c282e11ab">00195</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a816fa62df4b678675ebd207c282e11ab">pose_slide_refresh</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <span class="comment">/* wrapper around the generic version, allowing us to add some custom stuff later still */</span>
<a name="l00198"></a>00198     <a class="code" href="../../dc/d26/armature__intern_8h.html#adda31c88d8cd6166fce7645f76f331c1">poseAnim_mapping_refresh</a>(C, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#aea38211ab3a95dd44824fdd094784fe9">scene</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>);
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">/* helper for apply() - perform sliding for some value */</span>
<a name="l00202"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a5f7ccbeb429c24a93bead7e4dcdf2b3c">00202</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a5f7ccbeb429c24a93bead7e4dcdf2b3c">pose_slide_apply_val</a> (<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, <span class="keywordtype">float</span> *val)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204     <span class="keywordtype">float</span> cframe = (float)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a>;
<a name="l00205"></a>00205     <span class="keywordtype">float</span> sVal, eVal;
<a name="l00206"></a>00206     <span class="keywordtype">float</span> w1, w2;
<a name="l00207"></a>00207     
<a name="l00208"></a>00208     <span class="comment">/* get keyframe values for endpoint poses to blend with */</span>
<a name="l00209"></a>00209         <span class="comment">/* previous/start */</span>
<a name="l00210"></a>00210     sVal= <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu, (<span class="keywordtype">float</span>)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00211"></a>00211         <span class="comment">/* next/end */</span>
<a name="l00212"></a>00212     eVal= <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu, (<span class="keywordtype">float</span>)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00213"></a>00213     
<a name="l00214"></a>00214     <span class="comment">/* calculate the relative weights of the endpoints */</span>
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a> == <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>) {
<a name="l00216"></a>00216         <span class="comment">/* get weights from the percentage control */</span>
<a name="l00217"></a>00217         w1= pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>;    <span class="comment">/* this must come second */</span>
<a name="l00218"></a>00218         w2= 1.0f - w1;          <span class="comment">/* this must come first */</span>
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     <span class="keywordflow">else</span> {
<a name="l00221"></a>00221         <span class="comment">/*  - these weights are derived from the relative distance of these </span>
<a name="l00222"></a>00222 <span class="comment">         *    poses from the current frame</span>
<a name="l00223"></a>00223 <span class="comment">         *  - they then get normalised so that they only sum up to 1</span>
<a name="l00224"></a>00224 <span class="comment">         */</span>
<a name="l00225"></a>00225         <span class="keywordtype">float</span> wtot; 
<a name="l00226"></a>00226         
<a name="l00227"></a>00227         w1 = cframe - (float)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>;
<a name="l00228"></a>00228         w2 = (<span class="keywordtype">float</span>)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a> - cframe;
<a name="l00229"></a>00229         
<a name="l00230"></a>00230         wtot = w1 + w2;
<a name="l00231"></a>00231         w1 = (w1/wtot);
<a name="l00232"></a>00232         w2 = (w2/wtot);
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234     
<a name="l00235"></a>00235     <span class="comment">/* depending on the mode, calculate the new value</span>
<a name="l00236"></a>00236 <span class="comment">     *  - in all of these, the start+end values are multiplied by w2 and w1 (respectively),</span>
<a name="l00237"></a>00237 <span class="comment">     *    since multiplication in another order would decrease the value the current frame is closer to</span>
<a name="l00238"></a>00238 <span class="comment">     */</span>
<a name="l00239"></a>00239     <span class="keywordflow">switch</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a>) {
<a name="l00240"></a>00240         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">POSESLIDE_PUSH</a>: <span class="comment">/* make the current pose more pronounced */</span>
<a name="l00241"></a>00241         {
<a name="l00242"></a>00242             <span class="comment">/* perform a weighted average here, favoring the middle pose</span>
<a name="l00243"></a>00243 <span class="comment">             *  - numerator should be larger than denominator to &#39;expand&#39; the result</span>
<a name="l00244"></a>00244 <span class="comment">             *  - perform this weighting a number of times given by the percentage...</span>
<a name="l00245"></a>00245 <span class="comment">             */</span>
<a name="l00246"></a>00246             <span class="keywordtype">int</span> iters= (int)ceil(10.0f*pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>); <span class="comment">// TODO: maybe a sensitivity ctrl on top of this is needed</span>
<a name="l00247"></a>00247             
<a name="l00248"></a>00248             <span class="keywordflow">while</span> (iters-- &gt; 0) {
<a name="l00249"></a>00249                 (*val)= ( -((sVal * w2) + (eVal * w1)) + ((*val) * 6.0f) ) / 5.0f; 
<a name="l00250"></a>00250             }
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252             <span class="keywordflow">break</span>;
<a name="l00253"></a>00253             
<a name="l00254"></a>00254         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3adc917cf1381c43f7042ddb7d345e05d4">POSESLIDE_RELAX</a>: <span class="comment">/* make the current pose more like its surrounding ones */</span>
<a name="l00255"></a>00255         {
<a name="l00256"></a>00256             <span class="comment">/* perform a weighted average here, favoring the middle pose</span>
<a name="l00257"></a>00257 <span class="comment">             *  - numerator should be smaller than denominator to &#39;relax&#39; the result</span>
<a name="l00258"></a>00258 <span class="comment">             *  - perform this weighting a number of times given by the percentage...</span>
<a name="l00259"></a>00259 <span class="comment">             */</span>
<a name="l00260"></a>00260             <span class="keywordtype">int</span> iters= (int)ceil(10.0f*pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>); <span class="comment">// TODO: maybe a sensitivity ctrl on top of this is needed</span>
<a name="l00261"></a>00261             
<a name="l00262"></a>00262             <span class="keywordflow">while</span> (iters-- &gt; 0) {
<a name="l00263"></a>00263                 (*val)= ( ((sVal * w2) + (eVal * w1)) + ((*val) * 5.0f) ) / 6.0f;
<a name="l00264"></a>00264             }
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266             <span class="keywordflow">break</span>;
<a name="l00267"></a>00267             
<a name="l00268"></a>00268         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>: <span class="comment">/* make the current pose slide around between the endpoints */</span>
<a name="l00269"></a>00269         {
<a name="l00270"></a>00270             <span class="comment">/* perform simple linear interpolation - coefficient for start must come from pso-&gt;percentage... */</span>
<a name="l00271"></a>00271             <span class="comment">// TODO: make this use some kind of spline interpolation instead?</span>
<a name="l00272"></a>00272             (*val)= ((sVal * w2) + (eVal * w1));
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274             <span class="keywordflow">break</span>;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="comment">/* helper for apply() - perform sliding for some 3-element vector */</span>
<a name="l00279"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ad94ea444d84f8eb72ac4003961342913">00279</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#ad94ea444d84f8eb72ac4003961342913">pose_slide_apply_vec3</a> (<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso, <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl, <span class="keywordtype">float</span> vec[3], <span class="keyword">const</span> <span class="keywordtype">char</span> propName[])
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281     <a class="code" href="../../d0/df2/structLinkData.html">LinkData</a> *ld=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00282"></a>00282     <span class="keywordtype">char</span> *path=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     <span class="comment">/* get the path to use... */</span>
<a name="l00285"></a>00285     path= <a class="code" href="../../d3/db3/BLI__string_8h.html#a17694667060f4df89dab999b472e42c7">BLI_sprintfN</a>(<span class="stringliteral">&quot;%s.%s&quot;</span>, pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a49428c0f63df183d1757daf86e617a91">pchan_path</a>, propName);
<a name="l00286"></a>00286     
<a name="l00287"></a>00287     <span class="comment">/* using this path, find each matching F-Curve for the variables we&#39;re interested in */</span>
<a name="l00288"></a>00288     <span class="keywordflow">while</span> ( (ld= <a class="code" href="../../dc/d26/armature__intern_8h.html#a43f83e40b7d4577b1938717630be1bec">poseAnim_mapping_getNextFCurve</a>(&amp;pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#afc3e004e5b1349a97d9af92564413079">fcurves</a>, ld, path)) ) {
<a name="l00289"></a>00289         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a3591ce65917fa263d5e3c0586e90bf40">data</a>;
<a name="l00290"></a>00290         
<a name="l00291"></a>00291         <span class="comment">/* just work on these channels one by one... there&#39;s no interaction between values */</span>
<a name="l00292"></a>00292         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a5f7ccbeb429c24a93bead7e4dcdf2b3c">pose_slide_apply_val</a>(pso, fcu, &amp;vec[fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a>]);
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294     
<a name="l00295"></a>00295     <span class="comment">/* free the temp path we got */</span>
<a name="l00296"></a>00296     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(path);
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="comment">/* helper for apply() - perform sliding for custom properties */</span>
<a name="l00300"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ae3461ce8397ccde7507cad4b3c67d897">00300</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#ae3461ce8397ccde7507cad4b3c67d897">pose_slide_apply_props</a> (<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso, <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl)
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr = {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00303"></a>00303     <a class="code" href="../../d0/df2/structLinkData.html">LinkData</a> *ld;
<a name="l00304"></a>00304     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a49428c0f63df183d1757daf86e617a91">pchan_path</a>);
<a name="l00305"></a>00305     
<a name="l00306"></a>00306     <span class="comment">/* setup pointer RNA for resolving paths */</span>
<a name="l00307"></a>00307     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#aa57827e223e108b43db078059b848997">RNA_PoseBone</a>, pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a65a32eae0e0f70d38062b7b044f3e145">pchan</a>, &amp;ptr);
<a name="l00308"></a>00308     
<a name="l00309"></a>00309     <span class="comment">/* custom properties are just denoted using [&quot;...&quot;][etc.] after the end of the base path, </span>
<a name="l00310"></a>00310 <span class="comment">     * so just check for opening pair after the end of the path</span>
<a name="l00311"></a>00311 <span class="comment">     */</span>
<a name="l00312"></a>00312     <span class="keywordflow">for</span> (ld = pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#afc3e004e5b1349a97d9af92564413079">fcurves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ld; ld = ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a5e24b2a72895050a8c968e55b8dce1e3">next</a>) {
<a name="l00313"></a>00313         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu = (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a3591ce65917fa263d5e3c0586e90bf40">data</a>;
<a name="l00314"></a>00314         <span class="keywordtype">char</span> *bPtr, *pPtr;
<a name="l00315"></a>00315         
<a name="l00316"></a>00316         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00317"></a>00317             <span class="keywordflow">continue</span>;
<a name="l00318"></a>00318         
<a name="l00319"></a>00319         <span class="comment">/* do we have a match? </span>
<a name="l00320"></a>00320 <span class="comment">         *  - bPtr is the RNA Path with the standard part chopped off</span>
<a name="l00321"></a>00321 <span class="comment">         *  - pPtr is the chunk of the path which is left over</span>
<a name="l00322"></a>00322 <span class="comment">         */</span>
<a name="l00323"></a>00323         bPtr = strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a49428c0f63df183d1757daf86e617a91">pchan_path</a>) + <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00324"></a>00324         pPtr = strstr(bPtr, <span class="stringliteral">&quot;[\&quot;&quot;</span>);   <span class="comment">/* dummy &quot; for texteditor bugs */</span>
<a name="l00325"></a>00325         
<a name="l00326"></a>00326         <span class="keywordflow">if</span> (pPtr) {
<a name="l00327"></a>00327             <span class="comment">/* use RNA to try and get a handle on this property, then, assuming that it is just</span>
<a name="l00328"></a>00328 <span class="comment">             * numerical, try and grab the value as a float for temp editing before setting back</span>
<a name="l00329"></a>00329 <span class="comment">             */</span>
<a name="l00330"></a>00330             <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(&amp;ptr, pPtr);
<a name="l00331"></a>00331             
<a name="l00332"></a>00332             <span class="keywordflow">if</span> (prop) {
<a name="l00333"></a>00333                 <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a51b018d85ee119253ae423b9314eeaef">RNA_property_type</a>(prop)) {
<a name="l00334"></a>00334                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a273da4f3eac15c9bfdf45600a9d3a223">PROP_FLOAT</a>:
<a name="l00335"></a>00335                     {
<a name="l00336"></a>00336                         <span class="keywordtype">float</span> <a class="code" href="../../d3/d31/cloth_8c.html#acf0e59dfbda3fd18370631277d67a66d">tval</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a01215512e696b97758a08e61833fb8bd">RNA_property_float_get</a>(&amp;ptr, prop);
<a name="l00337"></a>00337                         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a5f7ccbeb429c24a93bead7e4dcdf2b3c">pose_slide_apply_val</a>(pso, fcu, &amp;tval);
<a name="l00338"></a>00338                         <a class="code" href="../../d3/d10/rna__access_8c.html#abdb7455ec63efacab0c1d5b9fb25b0b0">RNA_property_float_set</a>(&amp;ptr, prop, tval);
<a name="l00339"></a>00339                     }
<a name="l00340"></a>00340                         <span class="keywordflow">break</span>;
<a name="l00341"></a>00341                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a3f897b521d476ae35d56f769b80b54f4">PROP_BOOLEAN</a>:
<a name="l00342"></a>00342                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a46db685881d563dbd4be267143d05b84">PROP_ENUM</a>:
<a name="l00343"></a>00343                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a620d0acb046e6bc10271434db1960d41">PROP_INT</a>:
<a name="l00344"></a>00344                     {
<a name="l00345"></a>00345                         <span class="keywordtype">float</span> <a class="code" href="../../d3/d31/cloth_8c.html#acf0e59dfbda3fd18370631277d67a66d">tval</a> = (float)<a class="code" href="../../d3/d10/rna__access_8c.html#a7755e74d78f50e508966f2af17f7523e">RNA_property_int_get</a>(&amp;ptr, prop);
<a name="l00346"></a>00346                         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a5f7ccbeb429c24a93bead7e4dcdf2b3c">pose_slide_apply_val</a>(pso, fcu, &amp;tval);
<a name="l00347"></a>00347                         <a class="code" href="../../d3/d10/rna__access_8c.html#a0b521aa0072858134949f9639de7faff">RNA_property_int_set</a>(&amp;ptr, prop, (<span class="keywordtype">int</span>)tval);
<a name="l00348"></a>00348                     }
<a name="l00349"></a>00349                         <span class="keywordflow">break</span>;
<a name="l00350"></a>00350                     <span class="keywordflow">default</span>:
<a name="l00351"></a>00351                         <span class="comment">/* cannot handle */</span>
<a name="l00352"></a>00352                         <span class="comment">//printf(&quot;Cannot Pose Slide non-numerical property\n&quot;);</span>
<a name="l00353"></a>00353                         <span class="keywordflow">break</span>;
<a name="l00354"></a>00354                 }
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="comment">/* helper for apply() - perform sliding for quaternion rotations (using quat blending) */</span>
<a name="l00361"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a8e7409aced5250b7889225830d2c689d">00361</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a8e7409aced5250b7889225830d2c689d">pose_slide_apply_quat</a> (<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso, <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl)
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu_w=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *fcu_x=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *fcu_y=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *fcu_z=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00364"></a>00364     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan= pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a65a32eae0e0f70d38062b7b044f3e145">pchan</a>;
<a name="l00365"></a>00365     <a class="code" href="../../d0/df2/structLinkData.html">LinkData</a> *ld=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00366"></a>00366     <span class="keywordtype">char</span> *path=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00367"></a>00367     <span class="keywordtype">float</span> cframe;
<a name="l00368"></a>00368     
<a name="l00369"></a>00369     <span class="comment">/* get the path to use - this should be quaternion rotations only (needs care) */</span>
<a name="l00370"></a>00370     path= <a class="code" href="../../d3/db3/BLI__string_8h.html#a17694667060f4df89dab999b472e42c7">BLI_sprintfN</a>(<span class="stringliteral">&quot;%s.%s&quot;</span>, pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a49428c0f63df183d1757daf86e617a91">pchan_path</a>, <span class="stringliteral">&quot;rotation_quaternion&quot;</span>);
<a name="l00371"></a>00371     
<a name="l00372"></a>00372     <span class="comment">/* get the current frame number */</span>
<a name="l00373"></a>00373     cframe= (float)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a>;
<a name="l00374"></a>00374     
<a name="l00375"></a>00375     <span class="comment">/* using this path, find each matching F-Curve for the variables we&#39;re interested in */</span>
<a name="l00376"></a>00376     while ( (ld= <a class="code" href="../../dc/d26/armature__intern_8h.html#a43f83e40b7d4577b1938717630be1bec">poseAnim_mapping_getNextFCurve</a>(&amp;pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#afc3e004e5b1349a97d9af92564413079">fcurves</a>, ld, path)) ) {
<a name="l00377"></a>00377         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a3591ce65917fa263d5e3c0586e90bf40">data</a>;
<a name="l00378"></a>00378         
<a name="l00379"></a>00379         <span class="comment">/* assign this F-Curve to one of the relevant pointers... */</span>
<a name="l00380"></a>00380         switch (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a>) {
<a name="l00381"></a>00381             <span class="keywordflow">case</span> 3: <span class="comment">/* z */</span>
<a name="l00382"></a>00382                 fcu_z= fcu;
<a name="l00383"></a>00383                 <span class="keywordflow">break</span>;
<a name="l00384"></a>00384             <span class="keywordflow">case</span> 2: <span class="comment">/* y */</span>
<a name="l00385"></a>00385                 fcu_y= fcu;
<a name="l00386"></a>00386                 <span class="keywordflow">break</span>;
<a name="l00387"></a>00387             <span class="keywordflow">case</span> 1: <span class="comment">/* x */</span>
<a name="l00388"></a>00388                 fcu_x= fcu;
<a name="l00389"></a>00389                 <span class="keywordflow">break</span>;
<a name="l00390"></a>00390             <span class="keywordflow">case</span> 0: <span class="comment">/* w */</span>
<a name="l00391"></a>00391                 fcu_w= fcu;
<a name="l00392"></a>00392                 <span class="keywordflow">break</span>;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395     
<a name="l00396"></a>00396     <span class="comment">/* only if all channels exist, proceed */</span>
<a name="l00397"></a>00397     <span class="keywordflow">if</span> (fcu_w &amp;&amp; fcu_x &amp;&amp; fcu_y &amp;&amp; fcu_z) {
<a name="l00398"></a>00398         <span class="keywordtype">float</span> quat_prev[4], quat_next[4];
<a name="l00399"></a>00399         
<a name="l00400"></a>00400         <span class="comment">/* get 2 quats */</span>
<a name="l00401"></a>00401         quat_prev[0] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_w, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00402"></a>00402         quat_prev[1] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_x, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00403"></a>00403         quat_prev[2] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_y, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00404"></a>00404         quat_prev[3] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_z, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00405"></a>00405         
<a name="l00406"></a>00406         quat_next[0] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_w, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00407"></a>00407         quat_next[1] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_x, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00408"></a>00408         quat_next[2] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_y, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00409"></a>00409         quat_next[3] = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a1ddf79cf14ac3b61c5ea5f3a3af5bd0c">evaluate_fcurve</a>(fcu_z, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00410"></a>00410         
<a name="l00411"></a>00411         <span class="comment">/* perform blending */</span>
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a> == <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>) {
<a name="l00413"></a>00413             <span class="comment">/* just perform the interpol between quat_prev and quat_next using pso-&gt;percentage as a guide */</span>
<a name="l00414"></a>00414             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aabc8b501c8bcfe8a37ecfc39661b07d9">interp_qt_qtqt</a>(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a6788cc31b26081e0abbb5c3534efa0ba">quat</a>, quat_prev, quat_next, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>);
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a> == <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">POSESLIDE_PUSH</a>) {
<a name="l00417"></a>00417             <span class="keywordtype">float</span> quat_diff[4], quat_orig[4];
<a name="l00418"></a>00418             
<a name="l00419"></a>00419             <span class="comment">/* calculate the delta transform from the previous to the current */</span>
<a name="l00420"></a>00420             <span class="comment">// TODO: investigate ways to favour one transform more?</span>
<a name="l00421"></a>00421             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a4f06a32bfff449cff3b1f7bce55d9fdc">sub_qt_qtqt</a>(quat_diff, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a6788cc31b26081e0abbb5c3534efa0ba">quat</a>, quat_prev);
<a name="l00422"></a>00422             
<a name="l00423"></a>00423             <span class="comment">/* make a copy of the original rotation */</span>
<a name="l00424"></a>00424             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(quat_orig, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a6788cc31b26081e0abbb5c3534efa0ba">quat</a>);
<a name="l00425"></a>00425             
<a name="l00426"></a>00426             <span class="comment">/* increase the original by the delta transform, by an amount determined by percentage */</span>
<a name="l00427"></a>00427             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#afe11cd255c876d4209925d95cb4511c3">add_qt_qtqt</a>(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a6788cc31b26081e0abbb5c3534efa0ba">quat</a>, quat_orig, quat_diff, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>);
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         <span class="keywordflow">else</span> {
<a name="l00430"></a>00430             <span class="keywordtype">float</span> quat_interp[4], quat_orig[4];
<a name="l00431"></a>00431             <span class="keywordtype">int</span> iters= (int)ceil(10.0f*pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>); <span class="comment">// TODO: maybe a sensitivity ctrl on top of this is needed</span>
<a name="l00432"></a>00432             
<a name="l00433"></a>00433             <span class="comment">/* perform this blending several times until a satisfactory result is reached */</span>
<a name="l00434"></a>00434             <span class="keywordflow">while</span> (iters-- &gt; 0) {
<a name="l00435"></a>00435                 <span class="comment">/* calculate the interpolation between the endpoints */</span>
<a name="l00436"></a>00436                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aabc8b501c8bcfe8a37ecfc39661b07d9">interp_qt_qtqt</a>(quat_interp, quat_prev, quat_next, (cframe-pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>) / (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>-pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>) );
<a name="l00437"></a>00437                 
<a name="l00438"></a>00438                 <span class="comment">/* make a copy of the original rotation */</span>
<a name="l00439"></a>00439                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(quat_orig, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a6788cc31b26081e0abbb5c3534efa0ba">quat</a>);
<a name="l00440"></a>00440                 
<a name="l00441"></a>00441                 <span class="comment">/* tricky interpolations - blending between original and new */</span>
<a name="l00442"></a>00442                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aabc8b501c8bcfe8a37ecfc39661b07d9">interp_qt_qtqt</a>(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a6788cc31b26081e0abbb5c3534efa0ba">quat</a>, quat_orig, quat_interp, 1.0f/6.0f);
<a name="l00443"></a>00443             }
<a name="l00444"></a>00444         }
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446     
<a name="l00447"></a>00447     <span class="comment">/* free the path now */</span>
<a name="l00448"></a>00448     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(path);
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 <span class="comment">/* apply() - perform the pose sliding based on weighting various poses */</span>
<a name="l00452"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a14574fb17d1a89b51809e2f7a914f4b0">00452</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a14574fb17d1a89b51809e2f7a914f4b0">pose_slide_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl;
<a name="l00455"></a>00455     
<a name="l00456"></a>00456     <span class="comment">/* sanitise the frame ranges */</span>
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a> == pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>) {
<a name="l00458"></a>00458         <span class="comment">/* move out one step either side */</span>
<a name="l00459"></a>00459         pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>--;
<a name="l00460"></a>00460         pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>++;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462     
<a name="l00463"></a>00463     <span class="comment">/* for each link, handle each set of transforms */</span>
<a name="l00464"></a>00464     <span class="keywordflow">for</span> (pfl= pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pfl; pfl= pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#ab78cc60e506b9c0b2a5159966939ba8c">next</a>) {
<a name="l00465"></a>00465         <span class="comment">/* valid transforms for each PoseChannel should have been noted already </span>
<a name="l00466"></a>00466 <span class="comment">         *  - sliding the pose should be a straightforward exercise for location+rotation, </span>
<a name="l00467"></a>00467 <span class="comment">         *    but rotations get more complicated since we may want to use quaternion blending </span>
<a name="l00468"></a>00468 <span class="comment">         *    for quaternions instead...</span>
<a name="l00469"></a>00469 <span class="comment">         */</span>
<a name="l00470"></a>00470         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan= pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a65a32eae0e0f70d38062b7b044f3e145">pchan</a>;
<a name="l00471"></a>00471          
<a name="l00472"></a>00472         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a7d2af4aa1ea500333f5342449c1992ce">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ac0c689f38e4bba7c1c19bcae920efa78a8cff068fd46e07906661ccbc2b22a051">POSE_LOC</a>) {
<a name="l00473"></a>00473             <span class="comment">/* calculate these for the &#39;location&#39; vector, and use location curves */</span>
<a name="l00474"></a>00474             <a class="code" href="../../dd/d8d/poseSlide_8c.html#ad94ea444d84f8eb72ac4003961342913">pose_slide_apply_vec3</a>(pso, pfl, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ac0f475005d700752b614260d043d3100">loc</a>, <span class="stringliteral">&quot;location&quot;</span>);
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476         
<a name="l00477"></a>00477         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a7d2af4aa1ea500333f5342449c1992ce">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ac0c689f38e4bba7c1c19bcae920efa78ad4a9b6cb5d343a285728d3b6a44500f7">POSE_SIZE</a>) {
<a name="l00478"></a>00478             <span class="comment">/* calculate these for the &#39;scale&#39; vector, and use scale curves */</span>
<a name="l00479"></a>00479             <a class="code" href="../../dd/d8d/poseSlide_8c.html#ad94ea444d84f8eb72ac4003961342913">pose_slide_apply_vec3</a>(pso, pfl, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a9da92496b65a5f7ee51a007b7d30a6e9">size</a>, <span class="stringliteral">&quot;scale&quot;</span>);
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481         
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a7d2af4aa1ea500333f5342449c1992ce">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ac0c689f38e4bba7c1c19bcae920efa78a30ecc60a167f3b46f7a8e75181610d3a">POSE_ROT</a>) {
<a name="l00483"></a>00483             <span class="comment">/* everything depends on the rotation mode */</span>
<a name="l00484"></a>00484             <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a06e5397e6647572a9bf92443589285ff">rotmode</a> &gt; 0) {
<a name="l00485"></a>00485                 <span class="comment">/* eulers - so calculate these for the &#39;eul&#39; vector, and use euler_rotation curves */</span>
<a name="l00486"></a>00486                 <a class="code" href="../../dd/d8d/poseSlide_8c.html#ad94ea444d84f8eb72ac4003961342913">pose_slide_apply_vec3</a>(pso, pfl, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a170758ca33f0507932e671c5449bd541">eul</a>, <span class="stringliteral">&quot;rotation_euler&quot;</span>);
<a name="l00487"></a>00487             }
<a name="l00488"></a>00488             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a06e5397e6647572a9bf92443589285ff">rotmode</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca6fd1324ea35af2fbf6879b35d73ea547">ROT_MODE_AXISANGLE</a>) {
<a name="l00489"></a>00489                 <span class="comment">// TODO: need to figure out how to do this!</span>
<a name="l00490"></a>00490             }
<a name="l00491"></a>00491             <span class="keywordflow">else</span> {
<a name="l00492"></a>00492                 <span class="comment">/* quaternions - use quaternion blending */</span>
<a name="l00493"></a>00493                 <a class="code" href="../../dd/d8d/poseSlide_8c.html#a8e7409aced5250b7889225830d2c689d">pose_slide_apply_quat</a>(pso, pfl);
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496         
<a name="l00497"></a>00497         <span class="keywordflow">if</span> (pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#a79a6006cd398ef068bc2770f0b71fd85">oldprops</a>) {
<a name="l00498"></a>00498             <span class="comment">/* not strictly a transform, but contributes to the pose produced in many rigs */</span>
<a name="l00499"></a>00499             <a class="code" href="../../dd/d8d/poseSlide_8c.html#ae3461ce8397ccde7507cad4b3c67d897">pose_slide_apply_props</a>(pso, pfl);
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502     
<a name="l00503"></a>00503     <span class="comment">/* depsgraph updates + redraws */</span>
<a name="l00504"></a>00504     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a816fa62df4b678675ebd207c282e11ab">pose_slide_refresh</a>(C, pso);
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="comment">/* perform autokeyframing after changes were made + confirmed */</span>
<a name="l00508"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#aaa4c54def577deb6b560dccf96330cd3">00508</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#aaa4c54def577deb6b560dccf96330cd3">pose_slide_autoKeyframe</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510     <span class="comment">/* wrapper around the generic call */</span>
<a name="l00511"></a>00511     <a class="code" href="../../dc/d26/armature__intern_8h.html#aa842067a58c8bbe7aab6a4a3c1b07215">poseAnim_mapping_autoKeyframe</a>(C, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#aea38211ab3a95dd44824fdd094784fe9">scene</a>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>, &amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>, (<span class="keywordtype">float</span>)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a>);
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 <span class="comment">/* reset changes made to current pose */</span>
<a name="l00515"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a44ef3a04f4cdbfdd0ec51c74a54c6f6d">00515</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a44ef3a04f4cdbfdd0ec51c74a54c6f6d">pose_slide_reset</a> (<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517     <span class="comment">/* wrapper around the generic call, so that custom stuff can be added later */</span>
<a name="l00518"></a>00518     <a class="code" href="../../dc/d26/armature__intern_8h.html#a35d5fb0b99fecafe9daa6a4c7b608b71">poseAnim_mapping_reset</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>);
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 <span class="comment">/* ------------------------------------ */</span>
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 <span class="comment">/* draw percentage indicator in header */</span>
<a name="l00524"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a7507784e05022cc8b5d1184f0265a66d">00524</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7507784e05022cc8b5d1184f0265a66d">pose_slide_draw_status</a> (<a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00525"></a>00525 {
<a name="l00526"></a>00526     <span class="keywordtype">char</span> status_str[32];
<a name="l00527"></a>00527     <span class="keywordtype">char</span> mode_str[32];
<a name="l00528"></a>00528     
<a name="l00529"></a>00529     <span class="keywordflow">switch</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a38c2ef192029c829c894c55864c5973c">mode</a>) {
<a name="l00530"></a>00530         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">POSESLIDE_PUSH</a>:
<a name="l00531"></a>00531             strcpy(mode_str, <span class="stringliteral">&quot;Push Pose&quot;</span>);
<a name="l00532"></a>00532             <span class="keywordflow">break</span>;
<a name="l00533"></a>00533         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3adc917cf1381c43f7042ddb7d345e05d4">POSESLIDE_RELAX</a>:
<a name="l00534"></a>00534             strcpy(mode_str, <span class="stringliteral">&quot;Relax Pose&quot;</span>);
<a name="l00535"></a>00535             <span class="keywordflow">break</span>;
<a name="l00536"></a>00536         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>:
<a name="l00537"></a>00537             strcpy(mode_str, <span class="stringliteral">&quot;Breakdown&quot;</span>);
<a name="l00538"></a>00538             <span class="keywordflow">break</span>;
<a name="l00539"></a>00539         
<a name="l00540"></a>00540         <span class="keywordflow">default</span>:
<a name="l00541"></a>00541             <span class="comment">// unknown</span>
<a name="l00542"></a>00542             strcpy(mode_str, <span class="stringliteral">&quot;Sliding-Tool&quot;</span>);
<a name="l00543"></a>00543             <span class="keywordflow">break</span>;
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     
<a name="l00546"></a>00546     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(status_str, <span class="keyword">sizeof</span>(status_str), <span class="stringliteral">&quot;%s: %d %%&quot;</span>, mode_str, (<span class="keywordtype">int</span>)(pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>*100.0f));
<a name="l00547"></a>00547     <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a70ab0d25a8110360aae5f4746e4e926c">sa</a>, status_str);
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="comment">/* common code for invoke() methods */</span>
<a name="l00551"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a6b2812d7add20575a7df9c4fdb81ad37">00551</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a6b2812d7add20575a7df9c4fdb81ad37">pose_slide_invoke_common</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553     <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl;
<a name="l00554"></a>00554     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ac7490892e120304f23997521c1f19b74">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>;
<a name="l00555"></a>00555     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00556"></a>00556     
<a name="l00557"></a>00557     <span class="comment">/* for each link, add all its keyframes to the search tree */</span>
<a name="l00558"></a>00558     <span class="keywordflow">for</span> (pfl= pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ae4f8f727378c4bcc9447e77c18788ffb">pfLinks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pfl; pfl= pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#ab78cc60e506b9c0b2a5159966939ba8c">next</a>) {
<a name="l00559"></a>00559         <a class="code" href="../../d0/df2/structLinkData.html">LinkData</a> *ld;
<a name="l00560"></a>00560         
<a name="l00561"></a>00561         <span class="comment">/* do this for each F-Curve */</span>
<a name="l00562"></a>00562         <span class="keywordflow">for</span> (ld= pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#afc3e004e5b1349a97d9af92564413079">fcurves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ld; ld= ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a5e24b2a72895050a8c968e55b8dce1e3">next</a>) {
<a name="l00563"></a>00563             <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a3591ce65917fa263d5e3c0586e90bf40">data</a>;
<a name="l00564"></a>00564             <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a9d18e6fc983df5018e97acd591c7ff33">fcurve_to_keylist</a>(adt, fcu, &amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567     
<a name="l00568"></a>00568     <span class="comment">/* consolidate these keyframes, and figure out the nearest ones */</span>
<a name="l00569"></a>00569     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a90a980516f029c7f9ddb3d854cc37bb7">BLI_dlrbTree_linkedlist_sync</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>);
<a name="l00570"></a>00570     
<a name="l00571"></a>00571         <span class="comment">/* cancel if no keyframes found... */</span>
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>.<a class="code" href="../../d1/d5d/structDLRBT__Tree.html#ac6e167ec21709b3b24aa0d47f74fdf3f">root</a>) {
<a name="l00573"></a>00573         <a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *ak;
<a name="l00574"></a>00574         <span class="keywordtype">float</span> cframe= (float)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a>;
<a name="l00575"></a>00575         
<a name="l00576"></a>00576         <span class="comment">/* firstly, check if the current frame is a keyframe... */</span>
<a name="l00577"></a>00577         ak= (<a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *)<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#ae03440d04a6c42f07849f3a17059ef65">BLI_dlrbTree_search_exact</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a8c8eb077f4beaf1835776f05ca3a307f">compare_ak_cfraPtr</a>, &amp;cframe);
<a name="l00578"></a>00578         
<a name="l00579"></a>00579         <span class="keywordflow">if</span> (ak == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00580"></a>00580             <span class="comment">/* current frame is not a keyframe, so search */</span>
<a name="l00581"></a>00581             <a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *pk= (<a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *)<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#afff10808c3fc68c746cff8553b087f19">BLI_dlrbTree_search_prev</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a8c8eb077f4beaf1835776f05ca3a307f">compare_ak_cfraPtr</a>, &amp;cframe);
<a name="l00582"></a>00582             <a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *nk= (<a class="code" href="../../dc/d1c/structActKeyColumn.html">ActKeyColumn</a> *)<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#af832876ce373e013985f231c264a2437">BLI_dlrbTree_search_next</a>(&amp;pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6dd48586c0a98ed8a0edc747e0d8f4a1">keys</a>, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a8c8eb077f4beaf1835776f05ca3a307f">compare_ak_cfraPtr</a>, &amp;cframe);
<a name="l00583"></a>00583             
<a name="l00584"></a>00584             <span class="comment">/* new set the frames */</span>
<a name="l00585"></a>00585                 <span class="comment">/* prev frame */</span>
<a name="l00586"></a>00586             pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>= (pk)? (pk-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a>) : (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a> - 1);
<a name="l00587"></a>00587             <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;prev_frame&quot;</span>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00588"></a>00588                 <span class="comment">/* next frame */</span>
<a name="l00589"></a>00589             pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>= (nk)? (nk-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a>) : (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a> + 1);
<a name="l00590"></a>00590             <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;next_frame&quot;</span>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592         <span class="keywordflow">else</span> {
<a name="l00593"></a>00593             <span class="comment">/* current frame itself is a keyframe, so just take keyframes on either side */</span>
<a name="l00594"></a>00594                 <span class="comment">/* prev frame */</span>
<a name="l00595"></a>00595             pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>= (ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#af85f543f6ba7710adb88f5e1ac6fff2c">prev</a>)? (ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#af85f543f6ba7710adb88f5e1ac6fff2c">prev</a>-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a>) : (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a> - 1);
<a name="l00596"></a>00596             <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;prev_frame&quot;</span>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a8aa2acdb81c75aa7b6cee1d015a0bb81">prevFrame</a>);
<a name="l00597"></a>00597                 <span class="comment">/* next frame */</span>
<a name="l00598"></a>00598             pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>= (ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#abf93bb2e0a342a169a1dc97b39668bba">next</a>)? (ak-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#abf93bb2e0a342a169a1dc97b39668bba">next</a>-&gt;<a class="code" href="../../dc/d1c/structActKeyColumn.html#a9f7f4be8fe9ff797a55d90d0db3661e0">cfra</a>) : (pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#acfca548c2ef5dbd9ca692ab7ebeaecb7">cframe</a> + 1);
<a name="l00599"></a>00599             <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;next_frame&quot;</span>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a6a4133d2aa5eb6064771f2c01d618336">nextFrame</a>);
<a name="l00600"></a>00600         }
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     <span class="keywordflow">else</span> {
<a name="l00603"></a>00603         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No keyframes to slide between&quot;</span>);
<a name="l00604"></a>00604         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00605"></a>00605         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607     
<a name="l00608"></a>00608     <span class="comment">/* initial apply for operator... */</span>
<a name="l00609"></a>00609     <span class="comment">// TODO: need to calculate percentage for initial round too...</span>
<a name="l00610"></a>00610     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a14574fb17d1a89b51809e2f7a914f4b0">pose_slide_apply</a>(C, pso);
<a name="l00611"></a>00611     
<a name="l00612"></a>00612     <span class="comment">/* depsgraph updates + redraws */</span>
<a name="l00613"></a>00613     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a816fa62df4b678675ebd207c282e11ab">pose_slide_refresh</a>(C, pso);
<a name="l00614"></a>00614     
<a name="l00615"></a>00615     <span class="comment">/* set cursor to indicate modal */</span>
<a name="l00616"></a>00616     <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9ba66cd47f5b5b8c10426fc21db81c197c1">BC_EW_SCROLLCURSOR</a>);
<a name="l00617"></a>00617     
<a name="l00618"></a>00618     <span class="comment">/* header print */</span>
<a name="l00619"></a>00619     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7507784e05022cc8b5d1184f0265a66d">pose_slide_draw_status</a>(pso);
<a name="l00620"></a>00620     
<a name="l00621"></a>00621     <span class="comment">/* add a modal handler for this operator */</span>
<a name="l00622"></a>00622     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l00623"></a>00623     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="comment">/* common code for modal() */</span>
<a name="l00627"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#adda522cd9cea166b08d13d54e75e2aea">00627</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#adda522cd9cea166b08d13d54e75e2aea">pose_slide_modal</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *evt)
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00630"></a>00630     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00631"></a>00631     
<a name="l00632"></a>00632     <span class="keywordflow">switch</span> (evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l00633"></a>00633         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>: <span class="comment">/* confirm */</span>
<a name="l00634"></a>00634         {
<a name="l00635"></a>00635             <span class="comment">/* return to normal cursor and header status */</span>
<a name="l00636"></a>00636             <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a70ab0d25a8110360aae5f4746e4e926c">sa</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00637"></a>00637             <a class="code" href="../../de/d3c/wm__cursors_8c.html#ab8500ccfbffb6b57f4e0645e0f9a4759">WM_cursor_restore</a>(win);
<a name="l00638"></a>00638             
<a name="l00639"></a>00639             <span class="comment">/* insert keyframes as required... */</span>
<a name="l00640"></a>00640             <a class="code" href="../../dd/d8d/poseSlide_8c.html#aaa4c54def577deb6b560dccf96330cd3">pose_slide_autoKeyframe</a>(C, pso);
<a name="l00641"></a>00641             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00642"></a>00642             
<a name="l00643"></a>00643             <span class="comment">/* done! */</span>
<a name="l00644"></a>00644             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646         
<a name="l00647"></a>00647         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>:    <span class="comment">/* cancel */</span>
<a name="l00648"></a>00648         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>: 
<a name="l00649"></a>00649         {
<a name="l00650"></a>00650             <span class="comment">/* return to normal cursor and header status */</span>
<a name="l00651"></a>00651             <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a70ab0d25a8110360aae5f4746e4e926c">sa</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00652"></a>00652             <a class="code" href="../../de/d3c/wm__cursors_8c.html#ab8500ccfbffb6b57f4e0645e0f9a4759">WM_cursor_restore</a>(win);
<a name="l00653"></a>00653             
<a name="l00654"></a>00654             <span class="comment">/* reset transforms back to original state */</span>
<a name="l00655"></a>00655             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a44ef3a04f4cdbfdd0ec51c74a54c6f6d">pose_slide_reset</a>(pso);
<a name="l00656"></a>00656             
<a name="l00657"></a>00657             <span class="comment">/* depsgraph updates + redraws */</span>
<a name="l00658"></a>00658             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a816fa62df4b678675ebd207c282e11ab">pose_slide_refresh</a>(C, pso);
<a name="l00659"></a>00659             
<a name="l00660"></a>00660             <span class="comment">/* clean up temp data */</span>
<a name="l00661"></a>00661             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00662"></a>00662             
<a name="l00663"></a>00663             <span class="comment">/* canceled! */</span>
<a name="l00664"></a>00664             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666             
<a name="l00667"></a>00667         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>: <span class="comment">/* calculate new position */</span>
<a name="l00668"></a>00668         {
<a name="l00669"></a>00669             <span class="comment">/* calculate percentage based on position of mouse (we only use x-axis for now.</span>
<a name="l00670"></a>00670 <span class="comment">             * since this is more convenient for users to do), and store new percentage value</span>
<a name="l00671"></a>00671 <span class="comment">             */</span>
<a name="l00672"></a>00672             pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>= (evt-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> - pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ad5aa6fe6228e0c877966249b2abb6801">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>) / ((<span class="keywordtype">float</span>)pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#ad5aa6fe6228e0c877966249b2abb6801">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>);
<a name="l00673"></a>00673             <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;percentage&quot;</span>, pso-&gt;<a class="code" href="../../de/db9/structtPoseSlideOp.html#a226c198c45e5623c79894f44e15b660b">percentage</a>);
<a name="l00674"></a>00674             
<a name="l00675"></a>00675             <span class="comment">/* update percentage indicator in header */</span>
<a name="l00676"></a>00676             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7507784e05022cc8b5d1184f0265a66d">pose_slide_draw_status</a>(pso);
<a name="l00677"></a>00677             
<a name="l00678"></a>00678             <span class="comment">/* reset transforms (to avoid accumulation errors) */</span>
<a name="l00679"></a>00679             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a44ef3a04f4cdbfdd0ec51c74a54c6f6d">pose_slide_reset</a>(pso);
<a name="l00680"></a>00680             
<a name="l00681"></a>00681             <span class="comment">/* apply... */</span>
<a name="l00682"></a>00682             <a class="code" href="../../dd/d8d/poseSlide_8c.html#a14574fb17d1a89b51809e2f7a914f4b0">pose_slide_apply</a>(C, pso);
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684             <span class="keywordflow">break</span>;
<a name="l00685"></a>00685             
<a name="l00686"></a>00686         <span class="keywordflow">default</span>: <span class="comment">/* unhandled event (maybe it was some view manip? */</span>
<a name="l00687"></a>00687             <span class="comment">/* allow to pass through */</span>
<a name="l00688"></a>00688             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690     
<a name="l00691"></a>00691     <span class="comment">/* still running... */</span>
<a name="l00692"></a>00692     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 <span class="comment">/* common code for cancel() */</span>
<a name="l00696"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a85d5ed60d776b7af703f603c3513514f">00696</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a85d5ed60d776b7af703f603c3513514f">pose_slide_cancel</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698     <span class="comment">/* cleanup and done */</span>
<a name="l00699"></a>00699     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00700"></a>00700     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">/* common code for exec() methods */</span>
<a name="l00704"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a773f01c91d86349fad443abe1ecaffe5">00704</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a773f01c91d86349fad443abe1ecaffe5">pose_slide_exec_common</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706     <span class="comment">/* settings should have been set up ok for applying, so just apply! */</span>
<a name="l00707"></a>00707     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a14574fb17d1a89b51809e2f7a914f4b0">pose_slide_apply</a>(C, pso);
<a name="l00708"></a>00708     
<a name="l00709"></a>00709     <span class="comment">/* insert keyframes if needed */</span>
<a name="l00710"></a>00710     <a class="code" href="../../dd/d8d/poseSlide_8c.html#aaa4c54def577deb6b560dccf96330cd3">pose_slide_autoKeyframe</a>(C, pso);
<a name="l00711"></a>00711     
<a name="l00712"></a>00712     <span class="comment">/* cleanup and done */</span>
<a name="l00713"></a>00713     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00714"></a>00714     
<a name="l00715"></a>00715     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="comment">/* common code for defining RNA properties */</span>
<a name="l00719"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a7f03b65c275eff0a44d9bde64b17c2db">00719</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7f03b65c275eff0a44d9bde64b17c2db">pose_slide_opdef_properties</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00720"></a>00720 {
<a name="l00721"></a>00721     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;prev_frame&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a353e940124984022b2492bf3bcb2957f">MINAFRAME</a>, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#afedd4d2cbfe9c6cdbc7496c9a2a01c9e">MAXFRAME</a>, <span class="stringliteral">&quot;Previous Keyframe&quot;</span>, <span class="stringliteral">&quot;Frame number of keyframe immediately before the current frame&quot;</span>, 0, 50);
<a name="l00722"></a>00722     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;next_frame&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a353e940124984022b2492bf3bcb2957f">MINAFRAME</a>, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#afedd4d2cbfe9c6cdbc7496c9a2a01c9e">MAXFRAME</a>, <span class="stringliteral">&quot;Next Keyframe&quot;</span>, <span class="stringliteral">&quot;Frame number of keyframe immediately after the current frame&quot;</span>, 0, 50);
<a name="l00723"></a>00723     <a class="code" href="../../dc/d7e/rna__define_8c.html#a8e5fcbcf969e10621649d1c563ef0b9e">RNA_def_float_percentage</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;percentage&quot;</span>, 0.5f, 0.0f, 1.0f, <span class="stringliteral">&quot;Percentage&quot;</span>, <span class="stringliteral">&quot;Weighting factor for the sliding operation&quot;</span>, 0.3, 0.7);
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="comment">/* ------------------------------------ */</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728 <span class="comment">/* invoke() - for &#39;push&#39; mode */</span>
<a name="l00729"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#aa231e752aa9c4ca72a818cfd1e7cff7e">00729</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#aa231e752aa9c4ca72a818cfd1e7cff7e">pose_slide_push_invoke</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(evt))
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00732"></a>00732     
<a name="l00733"></a>00733     <span class="comment">/* initialize data  */</span>
<a name="l00734"></a>00734     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a>(C, op, <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">POSESLIDE_PUSH</a>) == 0) {
<a name="l00735"></a>00735         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00736"></a>00736         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738     <span class="keywordflow">else</span>
<a name="l00739"></a>00739         pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00740"></a>00740     
<a name="l00741"></a>00741     <span class="comment">/* do common setup work */</span>
<a name="l00742"></a>00742     <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a6b2812d7add20575a7df9c4fdb81ad37">pose_slide_invoke_common</a>(C, op, pso);
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745 <span class="comment">/* exec() - for push */</span>
<a name="l00746"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ab6579b03242196b011bcf4da40e53453">00746</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#ab6579b03242196b011bcf4da40e53453">pose_slide_push_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00747"></a>00747 {
<a name="l00748"></a>00748     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00749"></a>00749     
<a name="l00750"></a>00750     <span class="comment">/* initialize data (from RNA-props) */</span>
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a>(C, op, <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a6ad5e3ef6355b93bb750924c7adf4f4d">POSESLIDE_PUSH</a>) == 0) {
<a name="l00752"></a>00752         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00753"></a>00753         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     <span class="keywordflow">else</span>
<a name="l00756"></a>00756         pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00757"></a>00757         
<a name="l00758"></a>00758     <span class="comment">/* do common exec work */</span>
<a name="l00759"></a>00759     <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a773f01c91d86349fad443abe1ecaffe5">pose_slide_exec_common</a>(C, op, pso);
<a name="l00760"></a>00760 }
<a name="l00761"></a>00761 
<a name="l00762"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#aea738b4c77f8a4cb57fff574e9faf7b3">00762</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#aac6aaf780c7ebf80986f80c7ea1a7ec4">POSE_OT_push</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00763"></a>00763 {
<a name="l00764"></a>00764     <span class="comment">/* identifiers */</span>
<a name="l00765"></a>00765     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Push Pose&quot;</span>;
<a name="l00766"></a>00766     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_push&quot;</span>;
<a name="l00767"></a>00767     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Exaggerate the current pose&quot;</span>;
<a name="l00768"></a>00768     
<a name="l00769"></a>00769     <span class="comment">/* callbacks */</span>
<a name="l00770"></a>00770     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#ab6579b03242196b011bcf4da40e53453">pose_slide_push_exec</a>;
<a name="l00771"></a>00771     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#aa231e752aa9c4ca72a818cfd1e7cff7e">pose_slide_push_invoke</a>;
<a name="l00772"></a>00772     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#adda522cd9cea166b08d13d54e75e2aea">pose_slide_modal</a>;
<a name="l00773"></a>00773     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#a85d5ed60d776b7af703f603c3513514f">pose_slide_cancel</a>;
<a name="l00774"></a>00774     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l00775"></a>00775     
<a name="l00776"></a>00776     <span class="comment">/* flags */</span>
<a name="l00777"></a>00777     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l00778"></a>00778     
<a name="l00779"></a>00779     <span class="comment">/* Properties */</span>
<a name="l00780"></a>00780     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7f03b65c275eff0a44d9bde64b17c2db">pose_slide_opdef_properties</a>(ot);
<a name="l00781"></a>00781 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="comment">/* ........................ */</span>
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 <span class="comment">/* invoke() - for &#39;relax&#39; mode */</span>
<a name="l00786"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#aeeec512f51769e2f08b467e1680f38d4">00786</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#aeeec512f51769e2f08b467e1680f38d4">pose_slide_relax_invoke</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(evt))
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00789"></a>00789     
<a name="l00790"></a>00790     <span class="comment">/* initialize data  */</span>
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a>(C, op, <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3adc917cf1381c43f7042ddb7d345e05d4">POSESLIDE_RELAX</a>) == 0) {
<a name="l00792"></a>00792         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00793"></a>00793         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795     <span class="keywordflow">else</span>
<a name="l00796"></a>00796         pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00797"></a>00797     
<a name="l00798"></a>00798     <span class="comment">/* do common setup work */</span>
<a name="l00799"></a>00799     <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a6b2812d7add20575a7df9c4fdb81ad37">pose_slide_invoke_common</a>(C, op, pso);
<a name="l00800"></a>00800 }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="comment">/* exec() - for relax */</span>
<a name="l00803"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ae9895eb9d38708d2b55511d507698fa5">00803</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#ae9895eb9d38708d2b55511d507698fa5">pose_slide_relax_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00806"></a>00806     
<a name="l00807"></a>00807     <span class="comment">/* initialize data (from RNA-props) */</span>
<a name="l00808"></a>00808     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a>(C, op, <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3adc917cf1381c43f7042ddb7d345e05d4">POSESLIDE_RELAX</a>) == 0) {
<a name="l00809"></a>00809         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00810"></a>00810         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812     <span class="keywordflow">else</span>
<a name="l00813"></a>00813         pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00814"></a>00814         
<a name="l00815"></a>00815     <span class="comment">/* do common exec work */</span>
<a name="l00816"></a>00816     <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a773f01c91d86349fad443abe1ecaffe5">pose_slide_exec_common</a>(C, op, pso);
<a name="l00817"></a>00817 }
<a name="l00818"></a>00818 
<a name="l00819"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ad57bc01aed70cff43c2217e344dea1b6">00819</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a3d73f798107e34a05d2f9d73a965663c">POSE_OT_relax</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821     <span class="comment">/* identifiers */</span>
<a name="l00822"></a>00822     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Relax Pose&quot;</span>;
<a name="l00823"></a>00823     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_relax&quot;</span>;
<a name="l00824"></a>00824     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Make the current pose more similar to its surrounding ones&quot;</span>;
<a name="l00825"></a>00825     
<a name="l00826"></a>00826     <span class="comment">/* callbacks */</span>
<a name="l00827"></a>00827     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#ae9895eb9d38708d2b55511d507698fa5">pose_slide_relax_exec</a>;
<a name="l00828"></a>00828     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#aeeec512f51769e2f08b467e1680f38d4">pose_slide_relax_invoke</a>;
<a name="l00829"></a>00829     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#adda522cd9cea166b08d13d54e75e2aea">pose_slide_modal</a>;
<a name="l00830"></a>00830     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#a85d5ed60d776b7af703f603c3513514f">pose_slide_cancel</a>;
<a name="l00831"></a>00831     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l00832"></a>00832     
<a name="l00833"></a>00833     <span class="comment">/* flags */</span>
<a name="l00834"></a>00834     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l00835"></a>00835     
<a name="l00836"></a>00836     <span class="comment">/* Properties */</span>
<a name="l00837"></a>00837     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7f03b65c275eff0a44d9bde64b17c2db">pose_slide_opdef_properties</a>(ot);
<a name="l00838"></a>00838 }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 <span class="comment">/* ........................ */</span>
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 <span class="comment">/* invoke() - for &#39;breakdown&#39; mode */</span>
<a name="l00843"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af3c7caf5a297d548afc95b73bf5e1786">00843</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#af3c7caf5a297d548afc95b73bf5e1786">pose_slide_breakdown_invoke</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(evt))
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00846"></a>00846     
<a name="l00847"></a>00847     <span class="comment">/* initialize data  */</span>
<a name="l00848"></a>00848     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a>(C, op, <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>) == 0) {
<a name="l00849"></a>00849         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00850"></a>00850         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852     <span class="keywordflow">else</span>
<a name="l00853"></a>00853         pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00854"></a>00854     
<a name="l00855"></a>00855     <span class="comment">/* do common setup work */</span>
<a name="l00856"></a>00856     <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a6b2812d7add20575a7df9c4fdb81ad37">pose_slide_invoke_common</a>(C, op, pso);
<a name="l00857"></a>00857 }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859 <span class="comment">/* exec() - for breakdown */</span>
<a name="l00860"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ab0fa880e59b3b7478074c669ba9ecd76">00860</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#ab0fa880e59b3b7478074c669ba9ecd76">pose_slide_breakdown_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00861"></a>00861 {
<a name="l00862"></a>00862     <a class="code" href="../../de/db9/structtPoseSlideOp.html">tPoseSlideOp</a> *pso;
<a name="l00863"></a>00863     
<a name="l00864"></a>00864     <span class="comment">/* initialize data (from RNA-props) */</span>
<a name="l00865"></a>00865     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d8d/poseSlide_8c.html#a4e0c51626c7b28bc261354c71aad5b84">pose_slide_init</a>(C, op, <a class="code" href="../../dd/d8d/poseSlide_8c.html#a00c8bd56ea2aabf933e4875d75ef08f3a33eca0af56fc54b866256fc04ce5273b">POSESLIDE_BREAKDOWN</a>) == 0) {
<a name="l00866"></a>00866         <a class="code" href="../../dd/d8d/poseSlide_8c.html#a0d361641a2c487e720264ddd3d0a6c30">pose_slide_exit</a>(op);
<a name="l00867"></a>00867         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869     <span class="keywordflow">else</span>
<a name="l00870"></a>00870         pso= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00871"></a>00871         
<a name="l00872"></a>00872     <span class="comment">/* do common exec work */</span>
<a name="l00873"></a>00873     <span class="keywordflow">return</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a773f01c91d86349fad443abe1ecaffe5">pose_slide_exec_common</a>(C, op, pso);
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a16ebac518f783f8941bad2b9abf09a7f">00876</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#ad3d7343a017fc65d6fe64b2862bb3eb3">POSE_OT_breakdown</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00877"></a>00877 {
<a name="l00878"></a>00878     <span class="comment">/* identifiers */</span>
<a name="l00879"></a>00879     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Pose Breakdowner&quot;</span>;
<a name="l00880"></a>00880     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_breakdown&quot;</span>;
<a name="l00881"></a>00881     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Create a suitable breakdown pose on the current frame&quot;</span>;
<a name="l00882"></a>00882     
<a name="l00883"></a>00883     <span class="comment">/* callbacks */</span>
<a name="l00884"></a>00884     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#ab0fa880e59b3b7478074c669ba9ecd76">pose_slide_breakdown_exec</a>;
<a name="l00885"></a>00885     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#af3c7caf5a297d548afc95b73bf5e1786">pose_slide_breakdown_invoke</a>;
<a name="l00886"></a>00886     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#adda522cd9cea166b08d13d54e75e2aea">pose_slide_modal</a>;
<a name="l00887"></a>00887     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#a85d5ed60d776b7af703f603c3513514f">pose_slide_cancel</a>;
<a name="l00888"></a>00888     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l00889"></a>00889     
<a name="l00890"></a>00890     <span class="comment">/* flags */</span>
<a name="l00891"></a>00891     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l00892"></a>00892     
<a name="l00893"></a>00893     <span class="comment">/* Properties */</span>
<a name="l00894"></a>00894     <a class="code" href="../../dd/d8d/poseSlide_8c.html#a7f03b65c275eff0a44d9bde64b17c2db">pose_slide_opdef_properties</a>(ot);
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 <span class="comment">/* **************************************************** */</span>
<a name="l00898"></a>00898 <span class="comment">/* B) Pose Propagate */</span>
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 <span class="comment">/* &quot;termination conditions&quot; - i.e. when we stop */</span>
<a name="l00901"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9e">00901</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9e">ePosePropagate_Termination</a> {
<a name="l00902"></a>00902         <span class="comment">/* stop after the current hold ends */</span>
<a name="l00903"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eaa7e207e6c0c4e36bca153d19321885c2">00903</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eaa7e207e6c0c4e36bca153d19321885c2">POSE_PROPAGATE_SMART_HOLDS</a> = 0,
<a name="l00904"></a>00904         <span class="comment">/* only do on the last keyframe */</span>
<a name="l00905"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea13a45c1c4e6daebf8aaab3576c6a966d">00905</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea13a45c1c4e6daebf8aaab3576c6a966d">POSE_PROPAGATE_LAST_KEY</a>,
<a name="l00906"></a>00906         <span class="comment">/* stop after the next keyframe */</span>
<a name="l00907"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eadff479c09711830de1cd9bd94c98cb9f">00907</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eadff479c09711830de1cd9bd94c98cb9f">POSE_PROPAGATE_NEXT_KEY</a>,
<a name="l00908"></a>00908         <span class="comment">/* stop after the specified frame */</span>
<a name="l00909"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea2f0ba0c699ef0b34729199f0036a2af4">00909</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea2f0ba0c699ef0b34729199f0036a2af4">POSE_PROPAGATE_BEFORE_FRAME</a>,
<a name="l00910"></a>00910         <span class="comment">/* stop when we run out of keyframes */</span>
<a name="l00911"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea8a3ba8be93d2ec94ee2d0165583bfecb">00911</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea8a3ba8be93d2ec94ee2d0165583bfecb">POSE_PROPAGATE_BEFORE_END</a>,
<a name="l00912"></a>00912     
<a name="l00913"></a>00913         <span class="comment">/* only do on the frames where markers are selected */</span>
<a name="l00914"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea3cef4af10a8eba7f6316a9522f42a46a">00914</a>     <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea3cef4af10a8eba7f6316a9522f42a46a">POSE_PROPAGATE_SELECTED_MARKERS</a>
<a name="l00915"></a>00915 } <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9e">ePosePropagate_Termination</a>;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 <span class="comment">/* termination data needed for some modes - assumes only one of these entries will be needed at a time */</span>
<a name="l00918"></a><a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html">00918</a> <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html">tPosePropagate_ModeData</a> {
<a name="l00919"></a>00919     <span class="comment">/* smart holds + before frame: frame number to stop on */</span>
<a name="l00920"></a><a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#aa9cf90603e423c18c9ca80beb05da073">00920</a>     <span class="keywordtype">float</span> <a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#aa9cf90603e423c18c9ca80beb05da073">end_frame</a>;
<a name="l00921"></a>00921     
<a name="l00922"></a>00922     <span class="comment">/* selected markers: listbase for CfraElem&#39;s marking these frames */</span>
<a name="l00923"></a><a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#a1444e7c2f9466f9d416ce793bc7133b6">00923</a>     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#a1444e7c2f9466f9d416ce793bc7133b6">sel_markers</a>;
<a name="l00924"></a>00924 } <a class="code" href="../../dd/d8d/poseSlide_8c.html#ae117cf8db6893a90048deb92ce445e72">tPosePropagate_ModeData</a>;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 <span class="comment">/* --------------------------------- */</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928 <span class="comment">/* get frame on which the &quot;hold&quot; for the bone ends </span>
<a name="l00929"></a>00929 <span class="comment"> * XXX: this may not really work that well if a bone moves on some channels and not others</span>
<a name="l00930"></a>00930 <span class="comment"> *      if this happens to be a major issue, scrap this, and just make this happen </span>
<a name="l00931"></a>00931 <span class="comment"> *      independently per F-Curve</span>
<a name="l00932"></a>00932 <span class="comment"> */</span>
<a name="l00933"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a90a86db75009e96801822636ccf185a7">00933</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a90a86db75009e96801822636ccf185a7">pose_propagate_get_boneHoldEndFrame</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl, <span class="keywordtype">float</span> startFrame)
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935     <a class="code" href="../../d1/d5d/structDLRBT__Tree.html">DLRBT_Tree</a> keys, blocks;
<a name="l00936"></a>00936     <a class="code" href="../../dd/d60/structActKeyBlock.html">ActKeyBlock</a> *ab;
<a name="l00937"></a>00937     
<a name="l00938"></a>00938     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>;
<a name="l00939"></a>00939     <a class="code" href="../../d0/df2/structLinkData.html">LinkData</a> *ld;
<a name="l00940"></a>00940     <span class="keywordtype">float</span> endFrame = startFrame;
<a name="l00941"></a>00941     
<a name="l00942"></a>00942     <span class="comment">/* set up optimized data-structures for searching for relevant keyframes + holds */</span>
<a name="l00943"></a>00943     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a252f6abeef3b6e861da84630cbdbb02b">BLI_dlrbTree_init</a>(&amp;keys);
<a name="l00944"></a>00944     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a252f6abeef3b6e861da84630cbdbb02b">BLI_dlrbTree_init</a>(&amp;blocks);
<a name="l00945"></a>00945     
<a name="l00946"></a>00946     <span class="keywordflow">for</span> (ld = pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#afc3e004e5b1349a97d9af92564413079">fcurves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ld; ld = ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a5e24b2a72895050a8c968e55b8dce1e3">next</a>) {
<a name="l00947"></a>00947         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu = (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a3591ce65917fa263d5e3c0586e90bf40">data</a>;
<a name="l00948"></a>00948         <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a9d18e6fc983df5018e97acd591c7ff33">fcurve_to_keylist</a>(adt, fcu, &amp;keys, &amp;blocks);
<a name="l00949"></a>00949     }
<a name="l00950"></a>00950     
<a name="l00951"></a>00951     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a90a980516f029c7f9ddb3d854cc37bb7">BLI_dlrbTree_linkedlist_sync</a>(&amp;keys);
<a name="l00952"></a>00952     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#a90a980516f029c7f9ddb3d854cc37bb7">BLI_dlrbTree_linkedlist_sync</a>(&amp;blocks);
<a name="l00953"></a>00953     
<a name="l00954"></a>00954     <span class="comment">/* find the long keyframe (i.e. hold), and hence obtain the endFrame value </span>
<a name="l00955"></a>00955 <span class="comment">     *  - the best case would be one that starts on the frame itself</span>
<a name="l00956"></a>00956 <span class="comment">     */</span>
<a name="l00957"></a>00957     ab = (<a class="code" href="../../dd/d60/structActKeyBlock.html">ActKeyBlock</a> *)<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#ae03440d04a6c42f07849f3a17059ef65">BLI_dlrbTree_search_exact</a>(&amp;blocks, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#aa7e834ffee9a385f522fb3322fbafacb">compare_ab_cfraPtr</a>, &amp;startFrame);
<a name="l00958"></a>00958     
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5f/keyframes__draw_8c.html#ac841bb30199e008827d630982f220ce1">actkeyblock_is_valid</a>(ab, &amp;keys) == 0) {
<a name="l00960"></a>00960         <span class="comment">/* There are only two cases for no-exact match:</span>
<a name="l00961"></a>00961 <span class="comment">         *  1) the current frame is just before another key but not on a key itself</span>
<a name="l00962"></a>00962 <span class="comment">         *  2) the current frame is on a key, but that key doesn&#39;t link to the next</span>
<a name="l00963"></a>00963 <span class="comment">         *</span>
<a name="l00964"></a>00964 <span class="comment">         * If we&#39;ve got the first case, then we can search for another block, </span>
<a name="l00965"></a>00965 <span class="comment">         * otherwise forget it, as we&#39;d be overwriting some valid data.</span>
<a name="l00966"></a>00966 <span class="comment">         */</span>
<a name="l00967"></a>00967         <span class="keywordflow">if</span> (<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#ae03440d04a6c42f07849f3a17059ef65">BLI_dlrbTree_search_exact</a>(&amp;keys, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#a8c8eb077f4beaf1835776f05ca3a307f">compare_ak_cfraPtr</a>, &amp;startFrame) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00968"></a>00968             <span class="comment">/* we&#39;ve got case 1, so try the one after */</span>
<a name="l00969"></a>00969             ab = (<a class="code" href="../../dd/d60/structActKeyBlock.html">ActKeyBlock</a> *)<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#af832876ce373e013985f231c264a2437">BLI_dlrbTree_search_next</a>(&amp;blocks, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#aa7e834ffee9a385f522fb3322fbafacb">compare_ab_cfraPtr</a>, &amp;startFrame);
<a name="l00970"></a>00970             
<a name="l00971"></a>00971             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5f/keyframes__draw_8c.html#ac841bb30199e008827d630982f220ce1">actkeyblock_is_valid</a>(ab, &amp;keys) == 0) {
<a name="l00972"></a>00972                 <span class="comment">/* try the block before this frame then as last resort */</span>
<a name="l00973"></a>00973                 ab = (<a class="code" href="../../dd/d60/structActKeyBlock.html">ActKeyBlock</a> *)<a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#afff10808c3fc68c746cff8553b087f19">BLI_dlrbTree_search_prev</a>(&amp;blocks, <a class="code" href="../../d4/d5f/keyframes__draw_8c.html#aa7e834ffee9a385f522fb3322fbafacb">compare_ab_cfraPtr</a>, &amp;startFrame);
<a name="l00974"></a>00974                 
<a name="l00975"></a>00975                 <span class="comment">/* whatever happens, stop searching now... */</span>
<a name="l00976"></a>00976                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5f/keyframes__draw_8c.html#ac841bb30199e008827d630982f220ce1">actkeyblock_is_valid</a>(ab, &amp;keys) == 0) {
<a name="l00977"></a>00977                     <span class="comment">/* restrict range to just the frame itself </span>
<a name="l00978"></a>00978 <span class="comment">                     * i.e. everything is in motion, so no holds to safely overwrite</span>
<a name="l00979"></a>00979 <span class="comment">                     */</span>
<a name="l00980"></a>00980                     ab = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00981"></a>00981                 }
<a name="l00982"></a>00982             }
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984         <span class="keywordflow">else</span> {
<a name="l00985"></a>00985             <span class="comment">/* we&#39;ve got case 2 - set ab to NULL just in case, since we shouldn&#39;t do anything in this case */</span>
<a name="l00986"></a>00986             ab = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00987"></a>00987         }
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989     
<a name="l00990"></a>00990     <span class="comment">/* check if we can go any further than we&#39;ve already gone */</span>
<a name="l00991"></a>00991     <span class="keywordflow">if</span> (ab) {
<a name="l00992"></a>00992         <span class="comment">/* go to next if it is also valid and meets &quot;extension&quot; criteria */</span>
<a name="l00993"></a>00993         <span class="keywordflow">while</span> (ab-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a6a804c62fa3ab0833c69029b087ca2ec">next</a>) {
<a name="l00994"></a>00994             <a class="code" href="../../dd/d60/structActKeyBlock.html">ActKeyBlock</a> *abn = (<a class="code" href="../../dd/d60/structActKeyBlock.html">ActKeyBlock</a> *)ab-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a6a804c62fa3ab0833c69029b087ca2ec">next</a>;
<a name="l00995"></a>00995             
<a name="l00996"></a>00996             <span class="comment">/* must be valid */</span>
<a name="l00997"></a>00997             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d4/d5f/keyframes__draw_8c.html#ac841bb30199e008827d630982f220ce1">actkeyblock_is_valid</a>(abn, &amp;keys) == 0)
<a name="l00998"></a>00998                 <span class="keywordflow">break</span>;
<a name="l00999"></a>00999             <span class="comment">/* should start on the same frame that the last ended on */</span>
<a name="l01000"></a>01000             <span class="keywordflow">if</span> (ab-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a13a12577d6f6a70b54f8913254204f61">end</a> != abn-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a50d8879575d76939150de2c61258b16e">start</a>)
<a name="l01001"></a>01001                 <span class="keywordflow">break</span>;
<a name="l01002"></a>01002             <span class="comment">/* should have the same number of curves */</span>
<a name="l01003"></a>01003             <span class="keywordflow">if</span> (ab-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a8a9576474b95d4194cc95e3cb505cb47">totcurve</a> != abn-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a8a9576474b95d4194cc95e3cb505cb47">totcurve</a>)
<a name="l01004"></a>01004                 <span class="keywordflow">break</span>;
<a name="l01005"></a>01005             <span class="comment">/* should have the same value </span>
<a name="l01006"></a>01006 <span class="comment">             * XXX: this may be a bit fuzzy on larger data sets, so be careful</span>
<a name="l01007"></a>01007 <span class="comment">             */</span>
<a name="l01008"></a>01008             <span class="keywordflow">if</span> (ab-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a47f9715fbd4519befdc0f9dde729539d">val</a> != abn-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a47f9715fbd4519befdc0f9dde729539d">val</a>)
<a name="l01009"></a>01009                 <span class="keywordflow">break</span>;
<a name="l01010"></a>01010                 
<a name="l01011"></a>01011             <span class="comment">/* we can extend the bounds to the end of this &quot;next&quot; block now */</span>
<a name="l01012"></a>01012             ab = abn;
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014         
<a name="l01015"></a>01015         <span class="comment">/* end frame can now take the value of the end of the block */</span>
<a name="l01016"></a>01016         endFrame = ab-&gt;<a class="code" href="../../dd/d60/structActKeyBlock.html#a13a12577d6f6a70b54f8913254204f61">end</a>;
<a name="l01017"></a>01017     }
<a name="l01018"></a>01018     
<a name="l01019"></a>01019     <span class="comment">/* free temp memory */</span>
<a name="l01020"></a>01020     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#af6bec977f19ccbbea32e1aec6ed00341">BLI_dlrbTree_free</a>(&amp;keys);
<a name="l01021"></a>01021     <a class="code" href="../../de/d11/BLI__dlrbTree_8h.html#af6bec977f19ccbbea32e1aec6ed00341">BLI_dlrbTree_free</a>(&amp;blocks);
<a name="l01022"></a>01022     
<a name="l01023"></a>01023     <span class="comment">/* return the end frame we&#39;ve found */</span>
<a name="l01024"></a>01024     <span class="keywordflow">return</span> endFrame;
<a name="l01025"></a>01025 }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 <span class="comment">/* get reference value from F-Curve using RNA */</span>
<a name="l01028"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a2cf48e135499d13f3a80c91f925129ce">01028</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#a2cf48e135499d13f3a80c91f925129ce">pose_propagate_get_refVal</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, <span class="keywordtype">float</span> *value)
<a name="l01029"></a>01029 {
<a name="l01030"></a>01030     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> id_ptr, ptr;
<a name="l01031"></a>01031     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l01032"></a>01032     <span class="keywordtype">short</span> found= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01033"></a>01033     
<a name="l01034"></a>01034     <span class="comment">/* base pointer is always the object -&gt; id_ptr */</span>
<a name="l01035"></a>01035     <a class="code" href="../../d3/d10/rna__access_8c.html#a2ce5c1d9b520b00730820e0e118dd4e1">RNA_id_pointer_create</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;id_ptr);
<a name="l01036"></a>01036     
<a name="l01037"></a>01037     <span class="comment">/* resolve the property... */</span>
<a name="l01038"></a>01038     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a003cb660a44918af456e10e005495f86">RNA_path_resolve</a>(&amp;id_ptr, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, &amp;ptr, &amp;prop)) {
<a name="l01039"></a>01039         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a2b969ea1007e1516895f65336025e529">RNA_property_array_check</a>(prop)) {
<a name="l01040"></a>01040             <span class="comment">/* array */</span>
<a name="l01041"></a>01041             <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a> &lt; <a class="code" href="../../d3/d10/rna__access_8c.html#aad51db9a31d245dba4ee1f50608f331c">RNA_property_array_length</a>(&amp;ptr, prop)) {
<a name="l01042"></a>01042                 found= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01043"></a>01043                 <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a51b018d85ee119253ae423b9314eeaef">RNA_property_type</a>(prop)) {
<a name="l01044"></a>01044                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a3f897b521d476ae35d56f769b80b54f4">PROP_BOOLEAN</a>:
<a name="l01045"></a>01045                         *value= (float)<a class="code" href="../../d3/d10/rna__access_8c.html#acb4afecfe847861cf6ebf4593d2b42bf">RNA_property_boolean_get_index</a>(&amp;ptr, prop, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a>);
<a name="l01046"></a>01046                         <span class="keywordflow">break</span>;
<a name="l01047"></a>01047                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a620d0acb046e6bc10271434db1960d41">PROP_INT</a>:
<a name="l01048"></a>01048                         *value= (float)<a class="code" href="../../d3/d10/rna__access_8c.html#a30c78968af88b29eca251317dfbbece5">RNA_property_int_get_index</a>(&amp;ptr, prop, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a>);
<a name="l01049"></a>01049                         <span class="keywordflow">break</span>;
<a name="l01050"></a>01050                     <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a273da4f3eac15c9bfdf45600a9d3a223">PROP_FLOAT</a>:
<a name="l01051"></a>01051                         *value= <a class="code" href="../../d3/d10/rna__access_8c.html#a402f3a472211a6817b5c1165566e35da">RNA_property_float_get_index</a>(&amp;ptr, prop, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a>);
<a name="l01052"></a>01052                         <span class="keywordflow">break</span>;
<a name="l01053"></a>01053                     <span class="keywordflow">default</span>:
<a name="l01054"></a>01054                         found= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01055"></a>01055                         <span class="keywordflow">break</span>;
<a name="l01056"></a>01056                 }
<a name="l01057"></a>01057             }
<a name="l01058"></a>01058         }
<a name="l01059"></a>01059         <span class="keywordflow">else</span> {
<a name="l01060"></a>01060             <span class="comment">/* not an array */</span>
<a name="l01061"></a>01061             found= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01062"></a>01062             <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a51b018d85ee119253ae423b9314eeaef">RNA_property_type</a>(prop)) {
<a name="l01063"></a>01063                 <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a3f897b521d476ae35d56f769b80b54f4">PROP_BOOLEAN</a>:
<a name="l01064"></a>01064                     *value= (float)<a class="code" href="../../d3/d10/rna__access_8c.html#a3a4a0d200b12ded21d24676dcff67732">RNA_property_boolean_get</a>(&amp;ptr, prop);
<a name="l01065"></a>01065                     <span class="keywordflow">break</span>;
<a name="l01066"></a>01066                 <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a620d0acb046e6bc10271434db1960d41">PROP_INT</a>:
<a name="l01067"></a>01067                     *value= (float)<a class="code" href="../../d3/d10/rna__access_8c.html#a7755e74d78f50e508966f2af17f7523e">RNA_property_int_get</a>(&amp;ptr, prop);
<a name="l01068"></a>01068                     <span class="keywordflow">break</span>;
<a name="l01069"></a>01069                 <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a46db685881d563dbd4be267143d05b84">PROP_ENUM</a>:
<a name="l01070"></a>01070                     *value= (float)<a class="code" href="../../d3/d10/rna__access_8c.html#abb4862291354aedcb2cc916f1c30642b">RNA_property_enum_get</a>(&amp;ptr, prop);
<a name="l01071"></a>01071                     <span class="keywordflow">break</span>;
<a name="l01072"></a>01072                 <span class="keywordflow">case</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87a273da4f3eac15c9bfdf45600a9d3a223">PROP_FLOAT</a>:
<a name="l01073"></a>01073                     *value= <a class="code" href="../../d3/d10/rna__access_8c.html#a01215512e696b97758a08e61833fb8bd">RNA_property_float_get</a>(&amp;ptr, prop);
<a name="l01074"></a>01074                     <span class="keywordflow">break</span>;
<a name="l01075"></a>01075                 <span class="keywordflow">default</span>:
<a name="l01076"></a>01076                     found= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01077"></a>01077                     <span class="keywordflow">break</span>;
<a name="l01078"></a>01078             }
<a name="l01079"></a>01079         }
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081     
<a name="l01082"></a>01082     <span class="keywordflow">return</span> found;
<a name="l01083"></a>01083 }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 <span class="comment">/* propagate just works along each F-Curve in turn */</span>
<a name="l01086"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#ab8087c00f821ae7c37f337bf24515b69">01086</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#ab8087c00f821ae7c37f337bf24515b69">pose_propagate_fcurve</a> (<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, 
<a name="l01087"></a>01087                 <span class="keywordtype">float</span> startFrame, <a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html">tPosePropagate_ModeData</a> modeData)
<a name="l01088"></a>01088 {
<a name="l01089"></a>01089     <span class="keyword">const</span> <span class="keywordtype">int</span> mode = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l01090"></a>01090     
<a name="l01091"></a>01091     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l01092"></a>01092     <span class="keywordtype">float</span> refVal = 0.0f;
<a name="l01093"></a>01093     <span class="keywordtype">short</span> keyExists;
<a name="l01094"></a>01094     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, match;
<a name="l01095"></a>01095     <span class="keywordtype">short</span> first=1;
<a name="l01096"></a>01096     
<a name="l01097"></a>01097     <span class="comment">/* skip if no keyframes to edit */</span>
<a name="l01098"></a>01098     <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a> &lt; 2))
<a name="l01099"></a>01099         <span class="keywordflow">return</span>;
<a name="l01100"></a>01100         
<a name="l01101"></a>01101     <span class="comment">/* find the reference value from bones directly, which means that the user</span>
<a name="l01102"></a>01102 <span class="comment">     * doesn&#39;t need to firstly keyframe the pose (though this doesn&#39;t mean that </span>
<a name="l01103"></a>01103 <span class="comment">     * they can&#39;t either)</span>
<a name="l01104"></a>01104 <span class="comment">     */</span>
<a name="l01105"></a>01105     <span class="keywordflow">if</span> ( !<a class="code" href="../../dd/d8d/poseSlide_8c.html#a2cf48e135499d13f3a80c91f925129ce">pose_propagate_get_refVal</a>(ob, fcu, &amp;refVal))
<a name="l01106"></a>01106         <span class="keywordflow">return</span>;
<a name="l01107"></a>01107     
<a name="l01108"></a>01108     <span class="comment">/* find the first keyframe to start propagating from </span>
<a name="l01109"></a>01109 <span class="comment">     *  - if there&#39;s a keyframe on the current frame, we probably want to save this value there too</span>
<a name="l01110"></a>01110 <span class="comment">     *    since it may be as of yet unkeyed</span>
<a name="l01111"></a>01111 <span class="comment">     *  - if starting before the starting frame, don&#39;t touch the key, as it may have had some valid </span>
<a name="l01112"></a>01112 <span class="comment">     *    values</span>
<a name="l01113"></a>01113 <span class="comment">     */</span>
<a name="l01114"></a>01114     match = <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a57be9969692b1bd993d12fa9f2c39bf2">binarysearch_bezt_index</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>, startFrame, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>, &amp;keyExists);
<a name="l01115"></a>01115     
<a name="l01116"></a>01116     <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>[match].<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0] &lt; startFrame)
<a name="l01117"></a>01117         i = match + 1;
<a name="l01118"></a>01118     <span class="keywordflow">else</span>
<a name="l01119"></a>01119         i = match;
<a name="l01120"></a>01120     
<a name="l01121"></a>01121     <span class="keywordflow">for</span> (bezt = &amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>[i]; i &lt; fcu-&gt;totvert; i++, bezt++) {
<a name="l01122"></a>01122         <span class="comment">/* additional termination conditions based on the operator &#39;mode&#39; property go here... */</span>
<a name="l01123"></a>01123         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(mode, <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea2f0ba0c699ef0b34729199f0036a2af4">POSE_PROPAGATE_BEFORE_FRAME</a>, <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eaa7e207e6c0c4e36bca153d19321885c2">POSE_PROPAGATE_SMART_HOLDS</a>)) {
<a name="l01124"></a>01124             <span class="comment">/* stop if keyframe is outside the accepted range */</span>
<a name="l01125"></a>01125             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0] &gt; modeData.<a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#aa9cf90603e423c18c9ca80beb05da073">end_frame</a>)
<a name="l01126"></a>01126                 <span class="keywordflow">break</span>; 
<a name="l01127"></a>01127         }
<a name="l01128"></a>01128         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eadff479c09711830de1cd9bd94c98cb9f">POSE_PROPAGATE_NEXT_KEY</a>) {
<a name="l01129"></a>01129             <span class="comment">/* stop after the first keyframe has been processed */</span>
<a name="l01130"></a>01130             <span class="keywordflow">if</span> (first == 0)
<a name="l01131"></a>01131                 <span class="keywordflow">break</span>;
<a name="l01132"></a>01132         }
<a name="l01133"></a>01133         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea13a45c1c4e6daebf8aaab3576c6a966d">POSE_PROPAGATE_LAST_KEY</a>) {
<a name="l01134"></a>01134             <span class="comment">/* only affect this frame if it will be the last one */</span>
<a name="l01135"></a>01135             <span class="keywordflow">if</span> (i != (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>-1))
<a name="l01136"></a>01136                 <span class="keywordflow">continue</span>;
<a name="l01137"></a>01137         }
<a name="l01138"></a>01138         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea3cef4af10a8eba7f6316a9522f42a46a">POSE_PROPAGATE_SELECTED_MARKERS</a>) {
<a name="l01139"></a>01139             <span class="comment">/* only allow if there&#39;s a marker on this frame */</span>
<a name="l01140"></a>01140             <a class="code" href="../../db/d00/structCfraElem.html">CfraElem</a> *ce = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01141"></a>01141             
<a name="l01142"></a>01142             <span class="comment">/* stop on matching marker if there is one */</span>
<a name="l01143"></a>01143             <span class="keywordflow">for</span> (ce = modeData.<a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#a1444e7c2f9466f9d416ce793bc7133b6">sel_markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ce; ce = ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#ab87202e5ec809b32216d4c8f5f2cde42">next</a>) {
<a name="l01144"></a>01144                 <span class="keywordflow">if</span> (ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a> == (<span class="keywordtype">int</span>)(floor(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0] + 0.5f)))
<a name="l01145"></a>01145                     <span class="keywordflow">break</span>;
<a name="l01146"></a>01146             }
<a name="l01147"></a>01147             
<a name="l01148"></a>01148             <span class="comment">/* skip this keyframe if no marker */</span>
<a name="l01149"></a>01149             <span class="keywordflow">if</span> (ce == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01150"></a>01150                 <span class="keywordflow">continue</span>;
<a name="l01151"></a>01151         }
<a name="l01152"></a>01152         
<a name="l01153"></a>01153         <span class="comment">/* just flatten handles, since values will now be the same either side... */</span>
<a name="l01154"></a>01154         <span class="comment">// TODO: perhaps a fade-out modulation of the value is required here (optional once again)?</span>
<a name="l01155"></a>01155         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1] = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1] = refVal;
<a name="l01156"></a>01156         
<a name="l01157"></a>01157         <span class="comment">/* select keyframe to indicate that it&#39;s been changed */</span>
<a name="l01158"></a>01158         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01159"></a>01159         first = 0;
<a name="l01160"></a>01160     }
<a name="l01161"></a>01161 }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 <span class="comment">/* --------------------------------- */</span>
<a name="l01164"></a>01164 
<a name="l01165"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#abe143720d6aec5f45006c63de3cf78a6">01165</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d8d/poseSlide_8c.html#abe143720d6aec5f45006c63de3cf78a6">pose_propagate_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01166"></a>01166 {
<a name="l01167"></a>01167     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01168"></a>01168     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/BKE__object_8h.html#a7c81fbe77e3bc5283e2746857d88c94c">object_pose_armature_get</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C));
<a name="l01169"></a>01169     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act= (ob &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)? ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01170"></a>01170     
<a name="l01171"></a>01171     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> pflinks = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01172"></a>01172     <a class="code" href="../../d0/d5c/structtPChanFCurveLink.html">tPChanFCurveLink</a> *pfl;
<a name="l01173"></a>01173     
<a name="l01174"></a>01174     <a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html">tPosePropagate_ModeData</a> modeData;
<a name="l01175"></a>01175     <span class="keyword">const</span> <span class="keywordtype">int</span> mode = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l01176"></a>01176     
<a name="l01177"></a>01177     <span class="comment">/* sanity checks */</span>
<a name="l01178"></a>01178     <span class="keywordflow">if</span> (ob == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01179"></a>01179         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No object to propagate poses for&quot;</span>);
<a name="l01180"></a>01180         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01181"></a>01181     }
<a name="l01182"></a>01182     <span class="keywordflow">if</span> (act == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01183"></a>01183         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No keyframed poses to propagate to&quot;</span>);
<a name="l01184"></a>01184         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186     
<a name="l01187"></a>01187     <span class="comment">/* isolate F-Curves related to the selected bones */</span>
<a name="l01188"></a>01188     <a class="code" href="../../dc/d26/armature__intern_8h.html#a1eb817b4568ad188efc563cedfbae55e">poseAnim_mapping_get</a>(C, &amp;pflinks, ob, act);
<a name="l01189"></a>01189     
<a name="l01190"></a>01190     <span class="comment">/* mode-specific data preprocessing (requiring no access to curves) */</span>
<a name="l01191"></a>01191     <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea3cef4af10a8eba7f6316a9522f42a46a">POSE_PROPAGATE_SELECTED_MARKERS</a>) {
<a name="l01192"></a>01192         <span class="comment">/* get a list of selected markers */</span>
<a name="l01193"></a>01193         <a class="code" href="../../df/d12/anim__markers_8c.html#a1d5d03257253a65f19e588ffe3b22036">ED_markers_make_cfra_list</a>(&amp;scene-&gt;markers, &amp;modeData.<a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#a1444e7c2f9466f9d416ce793bc7133b6">sel_markers</a>, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l01194"></a>01194     }
<a name="l01195"></a>01195     <span class="keywordflow">else</span> {
<a name="l01196"></a>01196         <span class="comment">/* assume everything else wants endFrame */</span>
<a name="l01197"></a>01197         modeData.<a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#aa9cf90603e423c18c9ca80beb05da073">end_frame</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;end_frame&quot;</span>);
<a name="l01198"></a>01198     }
<a name="l01199"></a>01199     
<a name="l01200"></a>01200     <span class="comment">/* for each bone, perform the copying required */</span>
<a name="l01201"></a>01201     <span class="keywordflow">for</span> (pfl = pflinks.first; pfl; pfl = pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#ab78cc60e506b9c0b2a5159966939ba8c">next</a>) {
<a name="l01202"></a>01202         <a class="code" href="../../d0/df2/structLinkData.html">LinkData</a> *ld;
<a name="l01203"></a>01203         
<a name="l01204"></a>01204         <span class="comment">/* mode-specific data preprocessing (requiring access to all curves) */</span>
<a name="l01205"></a>01205         <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eaa7e207e6c0c4e36bca153d19321885c2">POSE_PROPAGATE_SMART_HOLDS</a>) {
<a name="l01206"></a>01206             <span class="comment">/* we store in endFrame the end frame of the &quot;long keyframe&quot; (i.e. a held value) starting</span>
<a name="l01207"></a>01207 <span class="comment">             * from the keyframe that occurs after the current frame</span>
<a name="l01208"></a>01208 <span class="comment">             */</span>
<a name="l01209"></a>01209             modeData.<a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#aa9cf90603e423c18c9ca80beb05da073">end_frame</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#a90a86db75009e96801822636ccf185a7">pose_propagate_get_boneHoldEndFrame</a>(ob, pfl, (<span class="keywordtype">float</span>)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>);
<a name="l01210"></a>01210         }
<a name="l01211"></a>01211         
<a name="l01212"></a>01212         <span class="comment">/* go through propagating pose to keyframes, curve by curve */</span>
<a name="l01213"></a>01213         <span class="keywordflow">for</span> (ld = pfl-&gt;<a class="code" href="../../d0/d5c/structtPChanFCurveLink.html#afc3e004e5b1349a97d9af92564413079">fcurves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ld; ld= ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a5e24b2a72895050a8c968e55b8dce1e3">next</a>)
<a name="l01214"></a>01214             <a class="code" href="../../dd/d8d/poseSlide_8c.html#ab8087c00f821ae7c37f337bf24515b69">pose_propagate_fcurve</a>(op, ob, (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ld-&gt;<a class="code" href="../../d0/df2/structLinkData.html#a3591ce65917fa263d5e3c0586e90bf40">data</a>, (<span class="keywordtype">float</span>)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>, modeData);
<a name="l01215"></a>01215     }
<a name="l01216"></a>01216     
<a name="l01217"></a>01217     <span class="comment">/* free temp data */</span>
<a name="l01218"></a>01218     <a class="code" href="../../dc/d26/armature__intern_8h.html#a16e9e9b54a5f7436207884082965be0d">poseAnim_mapping_free</a>(&amp;pflinks);
<a name="l01219"></a>01219     
<a name="l01220"></a>01220     <span class="keywordflow">if</span> (mode == <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea3cef4af10a8eba7f6316a9522f42a46a">POSE_PROPAGATE_SELECTED_MARKERS</a>)
<a name="l01221"></a>01221         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;modeData.<a class="code" href="../../d8/dda/uniontPosePropagate__ModeData.html#a1444e7c2f9466f9d416ce793bc7133b6">sel_markers</a>);
<a name="l01222"></a>01222     
<a name="l01223"></a>01223     <span class="comment">/* updates + notifiers */</span>
<a name="l01224"></a>01224     <a class="code" href="../../dc/d26/armature__intern_8h.html#adda31c88d8cd6166fce7645f76f331c1">poseAnim_mapping_refresh</a>(C, scene, ob);
<a name="l01225"></a>01225     
<a name="l01226"></a>01226     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01227"></a>01227 }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="comment">/* --------------------------------- */</span>
<a name="l01230"></a>01230 
<a name="l01231"></a><a class="code" href="../../dd/d8d/poseSlide_8c.html#a9e15337c9b7f909c7010fea2fc473408">01231</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#ab6bf53beb30f115d084a131310ad38bd">POSE_OT_propagate</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01232"></a>01232 {
<a name="l01233"></a>01233     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> terminate_items[]= {
<a name="l01234"></a>01234         {<a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eaa7e207e6c0c4e36bca153d19321885c2">POSE_PROPAGATE_SMART_HOLDS</a>, <span class="stringliteral">&quot;WHILE_HELD&quot;</span>, 0, <span class="stringliteral">&quot;While Held&quot;</span>, <span class="stringliteral">&quot;Propagate pose to all keyframes after current frame that don&#39;t change (Default behavior)&quot;</span>},
<a name="l01235"></a>01235         {<a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eadff479c09711830de1cd9bd94c98cb9f">POSE_PROPAGATE_NEXT_KEY</a>, <span class="stringliteral">&quot;NEXT_KEY&quot;</span>, 0, <span class="stringliteral">&quot;To Next Keyframe&quot;</span>, <span class="stringliteral">&quot;Propagate pose to first keyframe following the current frame only&quot;</span>},
<a name="l01236"></a>01236         {<a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea13a45c1c4e6daebf8aaab3576c6a966d">POSE_PROPAGATE_LAST_KEY</a>, <span class="stringliteral">&quot;LAST_KEY&quot;</span>, 0, <span class="stringliteral">&quot;To Last Keyframe&quot;</span>, <span class="stringliteral">&quot;Propagate pose to the last keyframe only (i.e. making action cyclic)&quot;</span>},
<a name="l01237"></a>01237         {<a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea2f0ba0c699ef0b34729199f0036a2af4">POSE_PROPAGATE_BEFORE_FRAME</a>, <span class="stringliteral">&quot;BEFORE_FRAME&quot;</span>, 0, <span class="stringliteral">&quot;Before Frame&quot;</span>, <span class="stringliteral">&quot;Propagate pose to all keyframes between current frame and &#39;Frame&#39; property&quot;</span>},
<a name="l01238"></a>01238         {<a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea8a3ba8be93d2ec94ee2d0165583bfecb">POSE_PROPAGATE_BEFORE_END</a>, <span class="stringliteral">&quot;BEFORE_END&quot;</span>, 0, <span class="stringliteral">&quot;Before Last Keyframe&quot;</span>, <span class="stringliteral">&quot;Propagate pose to all keyframes from current frame until no more are found&quot;</span>},
<a name="l01239"></a>01239         {<a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9ea3cef4af10a8eba7f6316a9522f42a46a">POSE_PROPAGATE_SELECTED_MARKERS</a>, <span class="stringliteral">&quot;SELECTED_MARKERS&quot;</span>, 0, <span class="stringliteral">&quot;On Selected Markers&quot;</span>, <span class="stringliteral">&quot;Propagate pose to all keyframes occurring on frames with Scene Markers after the current frame&quot;</span>},
<a name="l01240"></a>01240         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l01241"></a>01241         
<a name="l01242"></a>01242     <span class="comment">/* identifiers */</span>
<a name="l01243"></a>01243     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Propagate Pose&quot;</span>;
<a name="l01244"></a>01244     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_propagate&quot;</span>;
<a name="l01245"></a>01245     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Copy selected aspects of the current pose to subsequent poses already keyframed&quot;</span>;
<a name="l01246"></a>01246     
<a name="l01247"></a>01247     <span class="comment">/* callbacks */</span>
<a name="l01248"></a>01248     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dd/d8d/poseSlide_8c.html#abe143720d6aec5f45006c63de3cf78a6">pose_propagate_exec</a>;
<a name="l01249"></a>01249     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>; <span class="comment">// XXX: needs selected bones!</span>
<a name="l01250"></a>01250     
<a name="l01251"></a>01251     <span class="comment">/* flag */</span>
<a name="l01252"></a>01252     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01253"></a>01253     
<a name="l01254"></a>01254     <span class="comment">/* properties */</span>
<a name="l01255"></a>01255     <span class="comment">// TODO: add &quot;fade out&quot; control for tapering off amount of propagation as time goes by?</span>
<a name="l01256"></a>01256     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, terminate_items, <a class="code" href="../../dd/d8d/poseSlide_8c.html#af6064ff0d2774c739e85827074fa1c9eaa7e207e6c0c4e36bca153d19321885c2">POSE_PROPAGATE_SMART_HOLDS</a>, <span class="stringliteral">&quot;Terminate Mode&quot;</span>, <span class="stringliteral">&quot;Method used to determine when to stop propagating pose to keyframes&quot;</span>);
<a name="l01257"></a>01257     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;end_frame&quot;</span>, 250.0, FLT_MIN, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;End Frame&quot;</span>, <span class="stringliteral">&quot;Frame to stop propagating frames to (for &#39;Before Frame&#39; mode)&quot;</span>, 1.0, 250.0);
<a name="l01258"></a>01258 }
<a name="l01259"></a>01259 
<a name="l01260"></a>01260 <span class="comment">/* **************************************************** */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:45 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

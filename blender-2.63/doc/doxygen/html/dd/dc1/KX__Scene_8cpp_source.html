<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: KX_Scene.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">KX_Scene.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../dd/dc1/KX__Scene_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> * Ketsji scene. Holds references to all scene data.</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 
<a name="l00034"></a>00034 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(FREE_WINDOWS)</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#pragma warning (disable : 4786)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#endif //WIN32</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da5/KX__Scene_8h.html">KX_Scene.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de4/KX__PythonInit_8h.html">KX_PythonInit.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d60/MT__assert_8h.html">MT_assert.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html">KX_KetsjiEngine.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d9b/KX__BlenderMaterial_8h.html">KX_BlenderMaterial.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html">RAS_IPolygonMaterial.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/db8/ListValue_8h.html">ListValue.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d03/SCA__LogicManager_8h.html">SCA_LogicManager.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dcc/SCA__TimeEventManager_8h.html">SCA_TimeEventManager.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="comment">//#include &quot;SCA_AlwaysEventManager.h&quot;</span>
<a name="l00048"></a>00048 <span class="comment">//#include &quot;SCA_RandomEventManager.h&quot;</span>
<a name="l00049"></a>00049 <span class="comment">//#include &quot;KX_RayEventManager.h&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d2c/KX__TouchEventManager_8h.html">KX_TouchEventManager.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dca/SCA__KeyboardManager_8h.html" title="Manager for keyboard events.">SCA_KeyboardManager.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d2a/SCA__MouseManager_8h.html" title="Manager for mouse events.">SCA_MouseManager.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="comment">//#include &quot;SCA_PropertyEventManager.h&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/SCA__ActuatorEventManager_8h.html">SCA_ActuatorEventManager.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dca/SCA__BasicEventManager_8h.html">SCA_BasicEventManager.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d17/KX__Camera_8h.html" title="Camera in the gameengine. Cameras are also used for views.">KX_Camera.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dac/SCA__JoystickManager_8h.html">SCA_JoystickManager.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d0f/RAS__IRasterizer_8h.html">RAS_IRasterizer.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dfd/RAS__BucketManager_8h.html">RAS_BucketManager.h</a>&quot;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d8c/FloatValue_8h.html">FloatValue.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d9a/SCA__IController_8h.html" title="Interface for input devices. The defines for keyboard/system/mouse events here are for internal use i...">SCA_IController.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d75/SCA__IActuator_8h.html">SCA_IActuator.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d3b/SG__Node_8h.html">SG_Node.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d4a/BL__System_8h.html">BL_System.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dcb/SG__Controller_8h.html">SG_Controller.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d93/SG__IObject_8h.html">SG_IObject.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d19/SG__Tree_8h.html">SG_Tree.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d75/DNA__group__types_8h.html">DNA_group_types.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dca/KX__SG__NodeRelationships_8h.html">KX_SG_NodeRelationships.h</a>&quot;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d77/KX__NetworkEventManager_8h.html" title="Ketsji Logic Extension: Network Event Manager class.">KX_NetworkEventManager.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3c/NG__NetworkScene_8h.html" title="NetworkSceneManagement generic class.">NG_NetworkScene.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d95/PHY__IPhysicsEnvironment_8h.html">PHY_IPhysicsEnvironment.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/df8/KX__IPhysicsController_8h.html">KX_IPhysicsController.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d88/PHY__IGraphicController_8h.html">PHY_IGraphicController.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc5/KX__BlenderSceneConverter_8h.html">KX_BlenderSceneConverter.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d8c/KX__MotionState_8h.html">KX_MotionState.h</a>&quot;</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d60/BL__ModifierDeformer_8h.html">BL_ModifierDeformer.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../df/de6/BL__ShapeDeformer_8h.html">BL_ShapeDeformer.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/de4/BL__DeformableGameObject_8h.html">BL_DeformableGameObject.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dbc/KX__ObstacleSimulation_8h.html">KX_ObstacleSimulation.h</a>&quot;</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d2/d70/KX__SoftBodyDeformer_8h.html">KX_SoftBodyDeformer.h</a>&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html">KX_ConvertPhysicsObject.h</a>&quot;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d4a/CcdPhysicsEnvironment_8h.html">CcdPhysicsEnvironment.h</a>&quot;</span>
<a name="l00094"></a>00094 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d14/CcdPhysicsController_8h.html">CcdPhysicsController.h</a>&quot;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d58/KX__Light_8h.html">KX_Light.h</a>&quot;</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#abeea8422ff8f8274b560ad6758bae245">00101</a> <span class="keywordtype">void</span>* <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#abeea8422ff8f8274b560ad6758bae245">KX_SceneReplicationFunc</a>(<a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* node,<span class="keywordtype">void</span>* gameobj,<span class="keywordtype">void</span>* scene)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* replica = ((<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*)scene)-&gt;AddNodeReplicaObject(node,(<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)gameobj);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordflow">if</span> (replica)
<a name="l00106"></a>00106         replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)replica;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#ac88701640e82f65d417e526bd831e033">00111</a> <span class="keywordtype">void</span>* <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#ac88701640e82f65d417e526bd831e033">KX_SceneDestructionFunc</a>(<a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* node,<span class="keywordtype">void</span>* gameobj,<span class="keywordtype">void</span>* scene)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113     ((<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*)scene)-&gt;RemoveNodeDestructObject(node,(<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)gameobj);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00116"></a>00116 };
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aef26e3ab36cf9a850f0bed0ae527565a">00118</a> <span class="keywordtype">bool</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aef26e3ab36cf9a850f0bed0ae527565a">KX_Scene::KX_ScenegraphUpdateFunc</a>(<a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* node,<span class="keywordtype">void</span>* gameobj,<span class="keywordtype">void</span>* scene)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <span class="keywordflow">return</span> ((<a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>*)node)-&gt;Schedule(((<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*)scene)-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a77d42e8ca3af4dadbb276c2baeceb42e">m_sghead</a>);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a9c568c2a33dae28e000d6a7ded3b256b">00123</a> <span class="keywordtype">bool</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a9c568c2a33dae28e000d6a7ded3b256b">KX_Scene::KX_ScenegraphRescheduleFunc</a>(<a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* node,<span class="keywordtype">void</span>* gameobj,<span class="keywordtype">void</span>* scene)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keywordflow">return</span> ((<a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>*)node)-&gt;Reschedule(((<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*)scene)-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a77d42e8ca3af4dadbb276c2baeceb42e">m_sghead</a>);
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <a class="code" href="../../dc/d81/structSG__Callbacks.html">SG_Callbacks</a> <a class="code" href="../../d2/da3/classKX__Scene.html#a95b425043c91b7e775df61e5d34a581e">KX_Scene::m_callbacks</a> = <a class="code" href="../../dc/d81/structSG__Callbacks.html">SG_Callbacks</a>(
<a name="l00129"></a>00129     <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#abeea8422ff8f8274b560ad6758bae245">KX_SceneReplicationFunc</a>,
<a name="l00130"></a>00130     <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#ac88701640e82f65d417e526bd831e033">KX_SceneDestructionFunc</a>,
<a name="l00131"></a>00131     <a class="code" href="../../d1/d73/classKX__GameObject.html#a87a54772e4db69c1605def878723b495">KX_GameObject::UpdateTransformFunc</a>,
<a name="l00132"></a>00132     <a class="code" href="../../d2/da3/classKX__Scene.html#aef26e3ab36cf9a850f0bed0ae527565a">KX_Scene::KX_ScenegraphUpdateFunc</a>,
<a name="l00133"></a>00133     <a class="code" href="../../d2/da3/classKX__Scene.html#a9c568c2a33dae28e000d6a7ded3b256b">KX_Scene::KX_ScenegraphRescheduleFunc</a>);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">// temporarily var until there is a button in the userinterface</span>
<a name="l00136"></a>00136 <span class="comment">// (defined in KX_PythonInit.cpp)</span>
<a name="l00137"></a>00137 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="../../dd/de4/KX__PythonInit_8h.html#adc119ee912ea9773cd022f881569d0a4">gUseVisibilityTemp</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a61c2ad8da7ec56ff26130f8734961d30">00139</a> <a class="code" href="../../d2/da3/classKX__Scene.html#a61c2ad8da7ec56ff26130f8734961d30">KX_Scene::KX_Scene</a>(<span class="keyword">class</span> <a class="code" href="../../d9/d20/classSCA__IInputDevice.html">SCA_IInputDevice</a>* keyboarddevice,
<a name="l00140"></a>00140                    <span class="keyword">class</span> <a class="code" href="../../d9/d20/classSCA__IInputDevice.html">SCA_IInputDevice</a>* mousedevice,
<a name="l00141"></a>00141                    <span class="keyword">class</span> <a class="code" href="../../d4/d8b/classNG__NetworkDeviceInterface.html">NG_NetworkDeviceInterface</a> *ndi,
<a name="l00142"></a>00142                    <span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; sceneName,
<a name="l00143"></a>00143                    <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene,
<a name="l00144"></a>00144                    <span class="keyword">class</span> <a class="code" href="../../d5/df6/classRAS__ICanvas.html">RAS_ICanvas</a>* canvas): 
<a name="l00145"></a>00145     <a class="code" href="../../d0/dbc/classPyObjectPlus.html">PyObjectPlus</a>(),
<a name="l00146"></a>00146     m_keyboardmgr(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00147"></a>00147     m_mousemgr(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00148"></a>00148     m_sceneConverter(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00149"></a>00149     m_physicsEnvironment(0),
<a name="l00150"></a>00150     m_sceneName(sceneName),
<a name="l00151"></a>00151     m_networkDeviceInterface(ndi),
<a name="l00152"></a>00152     m_active_camera(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00153"></a>00153     m_ueberExecutionPriority(0),
<a name="l00154"></a>00154     m_blenderScene(scene)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <a class="code" href="../../d2/da3/classKX__Scene.html#a530a20a733e67bb9a04a3c36e52f3092">m_suspendedtime</a> = 0.0;
<a name="l00157"></a>00157     <a class="code" href="../../d2/da3/classKX__Scene.html#a96fe5531316ecdfc58481628d3683e3a">m_suspendeddelta</a> = 0.0;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <a class="code" href="../../d2/da3/classKX__Scene.html#a77ceb7fac5e693c1fd00ea2ae68a21d8">m_dbvt_culling</a> = <span class="keyword">false</span>;
<a name="l00160"></a>00160     <a class="code" href="../../d2/da3/classKX__Scene.html#a90cc06d39b7ef3db3baa4339e1a4d5a2">m_dbvt_occlusion_res</a> = 0;
<a name="l00161"></a>00161     <a class="code" href="../../d2/da3/classKX__Scene.html#ad72caf11978c9d0531601714183195e0">m_activity_culling</a> = <span class="keyword">false</span>;
<a name="l00162"></a>00162     <a class="code" href="../../d2/da3/classKX__Scene.html#a4a54fbd56dd1c3301dd9bb9080c04983">m_suspend</a> = <span class="keyword">false</span>;
<a name="l00163"></a>00163     <a class="code" href="../../d2/da3/classKX__Scene.html#aa82064bbbb7b7329cf48f5eaac6cd559">m_isclearingZbuffer</a> = <span class="keyword">true</span>;
<a name="l00164"></a>00164     <a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a> = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00165"></a>00165     <a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a> = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00166"></a>00166     <a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a> = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00167"></a>00167     <a class="code" href="../../d2/da3/classKX__Scene.html#a9025ca6731839d4e7cd6b069ebf21345">m_lightlist</a>= <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00168"></a>00168     <a class="code" href="../../d2/da3/classKX__Scene.html#a99eaa79b8f26eddd69d2cc1d2334b9ad">m_inactivelist</a> = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00169"></a>00169     <a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a> = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00170"></a>00170     <a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a> = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a> = <span class="keyword">new</span> <a class="code" href="../../db/d0f/classSCA__LogicManager.html">SCA_LogicManager</a>();
<a name="l00173"></a>00173     
<a name="l00174"></a>00174     <a class="code" href="../../d2/da3/classKX__Scene.html#a113450ed42f973641e38f5af82d19e61">m_timemgr</a> = <span class="keyword">new</span> <a class="code" href="../../de/dd3/classSCA__TimeEventManager.html">SCA_TimeEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>);
<a name="l00175"></a>00175     <a class="code" href="../../d2/da3/classKX__Scene.html#a2470d2a03b7b9fad38326306094c6980">m_keyboardmgr</a> = <span class="keyword">new</span> <a class="code" href="../../dd/dff/classSCA__KeyboardManager.html">SCA_KeyboardManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>,keyboarddevice);
<a name="l00176"></a>00176     <a class="code" href="../../d2/da3/classKX__Scene.html#adfe54f38432656a7ae3371014f4308cf">m_mousemgr</a> = <span class="keyword">new</span> <a class="code" href="../../d2/de0/classSCA__MouseManager.html">SCA_MouseManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>,mousedevice, canvas);
<a name="l00177"></a>00177     
<a name="l00178"></a>00178     <span class="comment">//SCA_AlwaysEventManager* alwaysmgr = new SCA_AlwaysEventManager(m_logicmgr);</span>
<a name="l00179"></a>00179     <span class="comment">//SCA_PropertyEventManager* propmgr = new SCA_PropertyEventManager(m_logicmgr);</span>
<a name="l00180"></a>00180     <a class="code" href="../../d5/d0d/classSCA__ActuatorEventManager.html">SCA_ActuatorEventManager</a>* actmgr = <span class="keyword">new</span> <a class="code" href="../../d5/d0d/classSCA__ActuatorEventManager.html">SCA_ActuatorEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>);
<a name="l00181"></a>00181     <span class="comment">//SCA_RandomEventManager* rndmgr = new SCA_RandomEventManager(m_logicmgr);</span>
<a name="l00182"></a>00182     <a class="code" href="../../d4/de0/classSCA__BasicEventManager.html">SCA_BasicEventManager</a>* basicmgr = <span class="keyword">new</span> <a class="code" href="../../d4/de0/classSCA__BasicEventManager.html">SCA_BasicEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>);
<a name="l00183"></a>00183     <span class="comment">//KX_RayEventManager* raymgr = new KX_RayEventManager(m_logicmgr);</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <a class="code" href="../../d7/d86/classKX__NetworkEventManager.html">KX_NetworkEventManager</a>* netmgr = <span class="keyword">new</span> <a class="code" href="../../d7/d86/classKX__NetworkEventManager.html">KX_NetworkEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>, ndi);
<a name="l00186"></a>00186     
<a name="l00187"></a>00187     
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="comment">//m_logicmgr-&gt;RegisterEventManager(alwaysmgr);</span>
<a name="l00190"></a>00190     <span class="comment">//m_logicmgr-&gt;RegisterEventManager(propmgr);</span>
<a name="l00191"></a>00191     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(actmgr);
<a name="l00192"></a>00192     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a2470d2a03b7b9fad38326306094c6980">m_keyboardmgr</a>);
<a name="l00193"></a>00193     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#adfe54f38432656a7ae3371014f4308cf">m_mousemgr</a>);
<a name="l00194"></a>00194     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a113450ed42f973641e38f5af82d19e61">m_timemgr</a>);
<a name="l00195"></a>00195     <span class="comment">//m_logicmgr-&gt;RegisterEventManager(rndmgr);</span>
<a name="l00196"></a>00196     <span class="comment">//m_logicmgr-&gt;RegisterEventManager(raymgr);</span>
<a name="l00197"></a>00197     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(netmgr);
<a name="l00198"></a>00198     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(basicmgr);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <a class="code" href="../../dc/d4a/BL__System_8h.html#a14ad21f63f97245f17d100854950b35d">SYS_SystemHandle</a> hSystem = <a class="code" href="../../d7/d58/BL__System_8cpp.html#a6d6d836bf4ccaeb2ba849cf528ddff32">SYS_GetSystem</a>();
<a name="l00202"></a>00202     <span class="keywordtype">bool</span> nojoystick= <a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(hSystem,<span class="stringliteral">&quot;nojoystick&quot;</span>,0);
<a name="l00203"></a>00203     <span class="keywordflow">if</span> (!nojoystick)
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205         <a class="code" href="../../d9/dd7/classSCA__JoystickManager.html">SCA_JoystickManager</a> *joymgr = <span class="keyword">new</span> <a class="code" href="../../d9/dd7/classSCA__JoystickManager.html">SCA_JoystickManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>);
<a name="l00206"></a>00206         <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(joymgr);
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <a class="code" href="../../dc/d60/MT__assert_8h.html#a9a255d1fa64eae77485b7bc71c1b4c97">MT_assert</a> (<a class="code" href="../../d2/da3/classKX__Scene.html#a22bfd57b3a9350c5e3dbc362211a70b9">m_networkDeviceInterface</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00210"></a>00210     <a class="code" href="../../d2/da3/classKX__Scene.html#add0d70e61b74544c26013ef9106151af">m_networkScene</a> = <span class="keyword">new</span> <a class="code" href="../../d5/d50/classNG__NetworkScene.html">NG_NetworkScene</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a22bfd57b3a9350c5e3dbc362211a70b9">m_networkDeviceInterface</a>);
<a name="l00211"></a>00211     
<a name="l00212"></a>00212     <a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <a class="code" href="../../d2/da3/classKX__Scene.html#acbacf5de2b0aaf01acbfd2b80514285e">m_bucketmanager</a>=<span class="keyword">new</span> <a class="code" href="../../df/d04/classRAS__BucketManager.html">RAS_BucketManager</a>();
<a name="l00215"></a>00215     
<a name="l00216"></a>00216     <span class="keywordtype">bool</span> showObstacleSimulation = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a0f9f3d66dd9dad6e59b94c62a2ff6f11">GAME_SHOW_OBSTACLE_SIMULATION</a>;
<a name="l00217"></a>00217     <span class="keywordflow">switch</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#aaa0893dffa259ea2ee3f9553548ec9b3">obstacleSimulation</a>)
<a name="l00218"></a>00218     {
<a name="l00219"></a>00219     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a873092ff3882140c5109ec4acaae6ed8">OBSTSIMULATION_TOI_rays</a>:
<a name="l00220"></a>00220         <a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a> = <span class="keyword">new</span> <a class="code" href="../../d0/d12/classKX__ObstacleSimulationTOI__rays.html">KX_ObstacleSimulationTOI_rays</a>((<a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a>)scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6615b32747780b4b9df427eb68c19598">levelHeight</a>, showObstacleSimulation);
<a name="l00221"></a>00221         <span class="keywordflow">break</span>;
<a name="l00222"></a>00222     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ab8b3513c54cf643be33005e082355857">OBSTSIMULATION_TOI_cells</a>:
<a name="l00223"></a>00223         <a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a> = <span class="keyword">new</span> <a class="code" href="../../de/d1c/classKX__ObstacleSimulationTOI__cells.html">KX_ObstacleSimulationTOI_cells</a>((<a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a>)scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6615b32747780b4b9df427eb68c19598">levelHeight</a>, showObstacleSimulation);
<a name="l00224"></a>00224         <span class="keywordflow">break</span>;
<a name="l00225"></a>00225     <span class="keywordflow">default</span>:
<a name="l00226"></a>00226         <a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     
<a name="l00229"></a>00229 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>    m_attr_dict = PyDict_New(); <span class="comment">/* new ref */</span>
<a name="l00231"></a>00231     m_draw_call_pre = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00232"></a>00232     m_draw_call_post = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00233"></a>00233 <span class="preprocessor">#endif</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>}
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a4b75b453191c935a936097d1b3b2cb32">00238</a> <a class="code" href="../../d2/da3/classKX__Scene.html#a4b75b453191c935a936097d1b3b2cb32">KX_Scene::~KX_Scene</a>()
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240     <span class="comment">// The release of debug properties used to be in SCA_IScene::~SCA_IScene</span>
<a name="l00241"></a>00241     <span class="comment">// It&#39;s still there but we remove all properties here otherwise some</span>
<a name="l00242"></a>00242     <span class="comment">// reference might be hanging and causing late release of objects</span>
<a name="l00243"></a>00243     <a class="code" href="../../d6/d02/classSCA__IScene.html#ad5ae2df06b284e2e0387b6cb7cdceb54">RemoveAllDebugProperties</a>();
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     <span class="keywordflow">while</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>()-&gt;GetCount() &gt; 0) 
<a name="l00246"></a>00246     {
<a name="l00247"></a>00247         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* parentobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) <a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(0);
<a name="l00248"></a>00248         this-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#af875d0f33688aaa8cea374d9a96dbcbe">RemoveObject</a>(parentobj);
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a>)
<a name="l00252"></a>00252         <span class="keyword">delete</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a>;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>)
<a name="l00255"></a>00255         <a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a>)
<a name="l00258"></a>00258         <a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00259"></a>00259     
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a99eaa79b8f26eddd69d2cc1d2334b9ad">m_inactivelist</a>)
<a name="l00261"></a>00261         <a class="code" href="../../d2/da3/classKX__Scene.html#a99eaa79b8f26eddd69d2cc1d2334b9ad">m_inactivelist</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a9025ca6731839d4e7cd6b069ebf21345">m_lightlist</a>)
<a name="l00264"></a>00264         <a class="code" href="../../d2/da3/classKX__Scene.html#a9025ca6731839d4e7cd6b069ebf21345">m_lightlist</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00265"></a>00265     
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>)
<a name="l00267"></a>00267         <a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>)
<a name="l00270"></a>00270         <a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>)
<a name="l00273"></a>00273         <a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>)
<a name="l00276"></a>00276         <span class="keyword">delete</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a25ffcbe89017ebb6c42eb457fac93583">m_physicsEnvironment</a>)
<a name="l00279"></a>00279         <span class="keyword">delete</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a25ffcbe89017ebb6c42eb457fac93583">m_physicsEnvironment</a>;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#add0d70e61b74544c26013ef9106151af">m_networkScene</a>)
<a name="l00282"></a>00282         <span class="keyword">delete</span> <a class="code" href="../../d2/da3/classKX__Scene.html#add0d70e61b74544c26013ef9106151af">m_networkScene</a>;
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#acbacf5de2b0aaf01acbfd2b80514285e">m_bucketmanager</a>)
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286         <span class="keyword">delete</span> <a class="code" href="../../d2/da3/classKX__Scene.html#acbacf5de2b0aaf01acbfd2b80514285e">m_bucketmanager</a>;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>    PyDict_Clear(m_attr_dict);
<a name="l00291"></a>00291     <span class="comment">/* Py_CLEAR: Py_DECREF&#39;s and NULL&#39;s */</span>
<a name="l00292"></a>00292     Py_CLEAR(m_attr_dict);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">/* these may be NULL but the macro checks */</span>
<a name="l00295"></a>00295     Py_CLEAR(m_draw_call_pre);
<a name="l00296"></a>00296     Py_CLEAR(m_draw_call_post);
<a name="l00297"></a>00297 <span class="preprocessor">#endif</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span>}
<a name="l00299"></a>00299 
<a name="l00300"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a9e031e8bf9bb35c1216efe1048d8102b">00300</a> <a class="code" href="../../df/d04/classRAS__BucketManager.html">RAS_BucketManager</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a9e031e8bf9bb35c1216efe1048d8102b">KX_Scene::GetBucketManager</a>()
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#acbacf5de2b0aaf01acbfd2b80514285e">m_bucketmanager</a>;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a7ab522483b5a299acb5967d3f2318f7d">00306</a> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a7ab522483b5a299acb5967d3f2318f7d">KX_Scene::GetTempObjectList</a>()
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>;
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">00311</a> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">KX_Scene::GetObjectList</a>()
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>;
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">00317</a> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">KX_Scene::GetRootParentList</a>()
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a>;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">00322</a> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">KX_Scene::GetInactiveList</a>()
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a99eaa79b8f26eddd69d2cc1d2334b9ad">m_inactivelist</a>;
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ad0262902bd268122e328de3448809fa6">00329</a> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#ad0262902bd268122e328de3448809fa6">KX_Scene::GetLightList</a>()
<a name="l00330"></a>00330 {
<a name="l00331"></a>00331     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a9025ca6731839d4e7cd6b069ebf21345">m_lightlist</a>;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">00334</a> <a class="code" href="../../db/d0f/classSCA__LogicManager.html">SCA_LogicManager</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">KX_Scene::GetLogicManager</a>()
<a name="l00335"></a>00335 {
<a name="l00336"></a>00336     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a3571af4237b258a335342f6d6ece5bdb">00339</a> <a class="code" href="../../de/dd3/classSCA__TimeEventManager.html">SCA_TimeEventManager</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a3571af4237b258a335342f6d6ece5bdb">KX_Scene::GetTimeEventManager</a>()
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a113450ed42f973641e38f5af82d19e61">m_timemgr</a>;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 
<a name="l00346"></a>00346  
<a name="l00347"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a077f80bc9f4bea049c0e661ed0b8af36">00347</a> list&lt;class KX_Camera*&gt;* <a class="code" href="../../d2/da3/classKX__Scene.html#a077f80bc9f4bea049c0e661ed0b8af36">KX_Scene::GetCameras</a>()
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349     <span class="keywordflow">return</span> &amp;<a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a1006d20bf80e79e137dc8df4632a3b64">00352</a> list&lt;class KX_FontObject*&gt;* <a class="code" href="../../d2/da3/classKX__Scene.html#a1006d20bf80e79e137dc8df4632a3b64">KX_Scene::GetFonts</a>()
<a name="l00353"></a>00353 {
<a name="l00354"></a>00354     <span class="keywordflow">return</span> &amp;<a class="code" href="../../d2/da3/classKX__Scene.html#af2472d5fc466a80650613900067fd99f">m_fonts</a>;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a5810ccd07fbefd1f8ef739fa67002feb">00357</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a5810ccd07fbefd1f8ef739fa67002feb">KX_Scene::SetFramingType</a>(<a class="code" href="../../da/dd4/classRAS__FrameSettings.html">RAS_FrameSettings</a> &amp; frame_settings)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359     <a class="code" href="../../d2/da3/classKX__Scene.html#ab73da3072584760c003193ad3f929698">m_frame_settings</a> = frame_settings;
<a name="l00360"></a>00360 };
<a name="l00361"></a>00361 
<a name="l00368"></a><a class="code" href="../../d2/da3/classKX__Scene.html#afbc5972fd417fa29c0364016178690c5">00368</a> <span class="keyword">const</span> <a class="code" href="../../da/dd4/classRAS__FrameSettings.html">RAS_FrameSettings</a>&amp; <a class="code" href="../../d2/da3/classKX__Scene.html#afbc5972fd417fa29c0364016178690c5">KX_Scene::GetFramingType</a>()<span class="keyword"> const </span>
<a name="l00369"></a>00369 <span class="keyword"></span>{
<a name="l00370"></a>00370     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ab73da3072584760c003193ad3f929698">m_frame_settings</a>;
<a name="l00371"></a>00371 };  
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00379"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a7aad47e03378b86d9efdbf66f929adc2">00379</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a7aad47e03378b86d9efdbf66f929adc2">KX_Scene::SetSceneViewport</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d14/classRAS__Rect.html">RAS_Rect</a> &amp;viewport)
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381     <a class="code" href="../../d2/da3/classKX__Scene.html#a1db068d666de391e5b0d312ab1046a2c">m_viewport</a> = viewport;
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a><a class="code" href="../../d2/da3/classKX__Scene.html#adcd89dcf93dd148543adefa15957130f">00386</a> <span class="keyword">const</span> <a class="code" href="../../d9/d14/classRAS__Rect.html">RAS_Rect</a>&amp; <a class="code" href="../../d2/da3/classKX__Scene.html#adcd89dcf93dd148543adefa15957130f">KX_Scene::GetSceneViewport</a>()<span class="keyword"> const </span>
<a name="l00387"></a>00387 <span class="keyword"></span>{
<a name="l00388"></a>00388     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a1db068d666de391e5b0d312ab1046a2c">m_viewport</a>;
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a9c99b1b626029014f37dc68a92ab7708">00393</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a9c99b1b626029014f37dc68a92ab7708">KX_Scene::SetWorldInfo</a>(<span class="keyword">class</span> <a class="code" href="../../db/d52/classKX__WorldInfo.html">KX_WorldInfo</a>* worldinfo)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395     <a class="code" href="../../d2/da3/classKX__Scene.html#ace1a37cefb9861771f04f422c5db3bbf">m_worldinfo</a> = worldinfo;
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a4831748648dedf769fd668499302da65">00400</a> <span class="keyword">class </span><a class="code" href="../../db/d52/classKX__WorldInfo.html">KX_WorldInfo</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a4831748648dedf769fd668499302da65">KX_Scene::GetWorldInfo</a>()
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ace1a37cefb9861771f04f422c5db3bbf">m_worldinfo</a>;
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 
<a name="l00406"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a65f7457105a314e61316cba509a658a9">00406</a> <span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; <a class="code" href="../../d2/da3/classKX__Scene.html#a65f7457105a314e61316cba509a658a9">KX_Scene::GetName</a>()
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a5d4e49f7d1d251ba206a3fd55f7ff4a5">m_sceneName</a>;
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a5e1a71311b83553c918a4d66e193f15b">00412</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a5e1a71311b83553c918a4d66e193f15b">KX_Scene::Suspend</a>()
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <a class="code" href="../../d2/da3/classKX__Scene.html#a4a54fbd56dd1c3301dd9bb9080c04983">m_suspend</a> = <span class="keyword">true</span>;
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ab2fef8f186d358a9708eddf5bde80b77">00417</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ab2fef8f186d358a9708eddf5bde80b77">KX_Scene::Resume</a>()
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419     <a class="code" href="../../d2/da3/classKX__Scene.html#a4a54fbd56dd1c3301dd9bb9080c04983">m_suspend</a> = <span class="keyword">false</span>;
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="../../d2/da3/classKX__Scene.html#acdf44444b61f12b5d1b3af56b0c25e02">00422</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#acdf44444b61f12b5d1b3af56b0c25e02">KX_Scene::SetActivityCulling</a>(<span class="keywordtype">bool</span> b)
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424     <a class="code" href="../../d2/da3/classKX__Scene.html#ad72caf11978c9d0531601714183195e0">m_activity_culling</a> = b;
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aca343536aec9340fda359272d5254aba">00427</a> <span class="keywordtype">bool</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aca343536aec9340fda359272d5254aba">KX_Scene::IsSuspended</a>()
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a4a54fbd56dd1c3301dd9bb9080c04983">m_suspend</a>;
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a881e1c9c5ab6c1f7e312609a8f53b8f0">00432</a> <span class="keywordtype">bool</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a881e1c9c5ab6c1f7e312609a8f53b8f0">KX_Scene::IsClearingZBuffer</a>()
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aa82064bbbb7b7329cf48f5eaac6cd559">m_isclearingZbuffer</a>;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a8d924ae13cb22d51776f9a04201f35ef">00437</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a8d924ae13cb22d51776f9a04201f35ef">KX_Scene::EnableZBufferClearing</a>(<span class="keywordtype">bool</span> isclearingZbuffer)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439     <a class="code" href="../../d2/da3/classKX__Scene.html#aa82064bbbb7b7329cf48f5eaac6cd559">m_isclearingZbuffer</a> = isclearingZbuffer;
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aa48425068732060289c87f52e9c4cd20">00442</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aa48425068732060289c87f52e9c4cd20">KX_Scene::RemoveNodeDestructObject</a>(<span class="keyword">class</span> <a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* node,<span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* orgobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)gameobj;    
<a name="l00445"></a>00445     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#af606c325634056236f63be551c63c3ea">NewRemoveObject</a>(orgobj) != 0)
<a name="l00446"></a>00446     {
<a name="l00447"></a>00447         <span class="comment">// object is not yet deleted because a reference is hanging somewhere.</span>
<a name="l00448"></a>00448         <span class="comment">// This should not happen anymore since we use proxy object for Python</span>
<a name="l00449"></a>00449         <span class="comment">// confident enough to put an assert?</span>
<a name="l00450"></a>00450         <span class="comment">//assert(false);</span>
<a name="l00451"></a>00451         printf(<span class="stringliteral">&quot;Zombie object! name=%s\n&quot;</span>, orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a268fb3bcc390cd18830e91113693eb40">GetName</a>().<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>());
<a name="l00452"></a>00452         orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a2c6585948b5a4d35e4e7593d46bdb7c0">SetSGNode</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00453"></a>00453         <a class="code" href="../../db/d53/classPHY__IGraphicController.html">PHY_IGraphicController</a>* ctrl = orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8946a2704a4a7400615dab4ed9d0dfe4">GetGraphicController</a>();
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (ctrl)
<a name="l00455"></a>00455         {
<a name="l00456"></a>00456             <span class="comment">// a graphic controller is set, we must delete it as the node will be deleted</span>
<a name="l00457"></a>00457             <span class="keyword">delete</span> ctrl;
<a name="l00458"></a>00458             orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a6f67759c316c4e9c6af844259d722cd1">SetGraphicController</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461     <span class="keywordflow">if</span> (node)
<a name="l00462"></a>00462         <span class="keyword">delete</span> node;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ab0f900fb646af6656672352891531858">00465</a> <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#ab0f900fb646af6656672352891531858">KX_Scene::AddNodeReplicaObject</a>(<span class="keyword">class</span> <a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* node, <span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467     <span class="comment">// for group duplication, limit the duplication of the hierarchy to the</span>
<a name="l00468"></a>00468     <span class="comment">// objects that are part of the group. </span>
<a name="l00469"></a>00469     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/da3/classKX__Scene.html#ace267e1c87b57fcbec772c6c40c0741f">IsObjectInGroup</a>(gameobj))
<a name="l00470"></a>00470         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00471"></a>00471     
<a name="l00472"></a>00472     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* orgobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)gameobj;
<a name="l00473"></a>00473     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* newobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#aeb79cf6bfe56d46df56d7f83c8b5c6f4">GetReplica</a>();
<a name="l00474"></a>00474     <a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>.<a class="code" href="../../d8/d8a/classCTR__Map.html#a79e68315a7733982eea54107231300df">insert</a>(orgobj, newobj);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="comment">// also register &#39;timers&#39; (time properties) of the replica</span>
<a name="l00477"></a>00477     <span class="keywordtype">int</span> numprops = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#af55f9e133711c3efd3f55f0380efb3e9">GetPropertyCount</a>();
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; numprops; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* prop = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<span class="stringliteral">&quot;timer&quot;</span>))
<a name="l00484"></a>00484             this-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a113450ed42f973641e38f5af82d19e61">m_timemgr</a>-&gt;<a class="code" href="../../de/dd3/classSCA__TimeEventManager.html#a8be4dc6aa6fb29527d7ba28d81361c5b">AddTimeProperty</a>(prop);
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (node)
<a name="l00488"></a>00488     {
<a name="l00489"></a>00489         newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a2c6585948b5a4d35e4e7593d46bdb7c0">SetSGNode</a>((<a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>*)node);
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491     <span class="keywordflow">else</span>
<a name="l00492"></a>00492     {
<a name="l00493"></a>00493         <a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a> = <span class="keyword">new</span> <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>(newobj,<span class="keyword">this</span>,KX_Scene::m_callbacks);
<a name="l00494"></a>00494     
<a name="l00495"></a>00495         <span class="comment">// this fixes part of the scaling-added object bug</span>
<a name="l00496"></a>00496         <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* orgnode = orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>();
<a name="l00497"></a>00497         <a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a>-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#ae9c53084a510b513b02dfe6f0448f34a">SetLocalScale</a>(orgnode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#ab2a2369819619117a9ea73555b0e7646">GetLocalScale</a>());
<a name="l00498"></a>00498         <a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a>-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a30d80c0a5ade811c461435a6875aa77f">SetLocalPosition</a>(orgnode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a251ddaf5cd0b1d48662cba5960712b23">GetLocalPosition</a>());
<a name="l00499"></a>00499         <a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a>-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a589c6b5ec03b113430cd912d5bd0fdc1">SetLocalOrientation</a>(orgnode-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a3cd273e73f81331ee753a9611b6377b7">GetLocalOrientation</a>());
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="comment">// define the relationship between this node and it&#39;s parent.</span>
<a name="l00502"></a>00502         <a class="code" href="../../d6/d0a/classKX__NormalParentRelation.html">KX_NormalParentRelation</a> * parent_relation = 
<a name="l00503"></a>00503             <a class="code" href="../../d6/d0a/classKX__NormalParentRelation.html#a6e0ee2e5d68fc3d5a2c1589670793ef4">KX_NormalParentRelation::New</a>();
<a name="l00504"></a>00504         <a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a>-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#afd81adaab4e510163b91952ea4777d8e">SetParentRelation</a>(parent_relation);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a2c6585948b5a4d35e4e7593d46bdb7c0">SetSGNode</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a66152a8975d332d8f9846bb3ef7cb805">m_rootnode</a>);
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508     
<a name="l00509"></a>00509     <a class="code" href="../../da/d03/classSG__IObject.html">SG_IObject</a>* replicanode = newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>();
<a name="l00510"></a>00510 <span class="comment">//  SG_Node* rootnode = (replicanode == m_rootnode ? NULL : m_rootnode);</span>
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     replicanode-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#afd60e11ade3b1302b072eba65fc8a911">SetSGClientObject</a>(newobj);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="comment">// this is the list of object that are send to the graphics pipeline</span>
<a name="l00515"></a>00515     <a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>());
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6093176c1389ff66df406c225ee0bcaf">GetGameObjectType</a>()==<a class="code" href="../../da/d68/classSCA__IObject.html#a1f0f06b1ee29284cbef58072f8f2671ba89f3a9ecc77a937dcd12e72726da5dd9">SCA_IObject::OBJ_LIGHT</a>)
<a name="l00517"></a>00517         <a class="code" href="../../d2/da3/classKX__Scene.html#a9025ca6731839d4e7cd6b069ebf21345">m_lightlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>());
<a name="l00518"></a>00518     newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a1a018532e6f4b42433f05a130d4c2f6a">AddMeshUser</a>();
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">// logic cannot be replicated, until the whole hierarchy is replicated.</span>
<a name="l00521"></a>00521     <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.push_back(newobj);
<a name="l00522"></a>00522     <span class="comment">//replicate controllers of this node</span>
<a name="l00523"></a>00523     <a class="code" href="../../d0/d93/SG__IObject_8h.html#aad4346341d8a820b9434848b5cc4ec64">SGControllerList</a>    scenegraphcontrollers = orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#a65ffd2fdff176c9b9708b7638d35a367" title="Needed for replication.">GetSGControllerList</a>();
<a name="l00524"></a>00524     replicanode-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#ac2e2125659218bf143859ff4330e6aad">RemoveAllControllers</a>();
<a name="l00525"></a>00525     SGControllerList::iterator cit;
<a name="l00526"></a>00526     <span class="comment">//int numcont = scenegraphcontrollers.size();</span>
<a name="l00527"></a>00527     
<a name="l00528"></a>00528     <span class="keywordflow">for</span> (cit = scenegraphcontrollers.begin();!(cit==scenegraphcontrollers.end());++cit)
<a name="l00529"></a>00529     {
<a name="l00530"></a>00530         <span class="comment">// controller replication is quite complicated</span>
<a name="l00531"></a>00531         <span class="comment">// only replicate ipo and physics controller for now</span>
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <a class="code" href="../../d6/d9e/classSG__Controller.html">SG_Controller</a>* replicacontroller = (*cit)-&gt;<a class="code" href="../../d6/d9e/classSG__Controller.html#aa1d57689e292f6a82aae6e9d232d89d1">GetReplica</a>((<a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>*) replicanode);
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (replicacontroller)
<a name="l00535"></a>00535         {
<a name="l00536"></a>00536             replicacontroller-&gt;<a class="code" href="../../d6/d9e/classSG__Controller.html#ad52cb79037f34f2c8e0cac2ebd3a6706">SetObject</a>(replicanode);
<a name="l00537"></a>00537             replicanode-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#ac5ab1fa024907ab0f4857ae4daa029c9">AddSGController</a>(replicacontroller);
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540     <span class="comment">// replicate graphic controller</span>
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8946a2704a4a7400615dab4ed9d0dfe4">GetGraphicController</a>())
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543         <a class="code" href="../../d2/d52/classPHY__IMotionState.html">PHY_IMotionState</a>* motionstate = <span class="keyword">new</span> <a class="code" href="../../da/d5b/classKX__MotionState.html">KX_MotionState</a>(newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>());
<a name="l00544"></a>00544         <a class="code" href="../../db/d53/classPHY__IGraphicController.html">PHY_IGraphicController</a>* newctrl = orgobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8946a2704a4a7400615dab4ed9d0dfe4">GetGraphicController</a>()-&gt;<a class="code" href="../../db/d53/classPHY__IGraphicController.html#adf300810bc0a95e5db88813b3a222856">GetReplica</a>(motionstate);
<a name="l00545"></a>00545         newctrl-&gt;<a class="code" href="../../d5/d92/classPHY__IController.html#abdbbf1e2e4de21e160a874095dfb0972">setNewClientInfo</a>(newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4fb43f2d41de4ddd5130fa0c882dd204">getClientInfo</a>());
<a name="l00546"></a>00546         newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a6f67759c316c4e9c6af844259d722cd1">SetGraphicController</a>(newctrl);
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="keywordflow">return</span> newobj;
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 <span class="comment">// before calling this method KX_Scene::ReplicateLogic(), make sure to</span>
<a name="l00554"></a>00554 <span class="comment">// have called &#39;GameObject::ReParentLogic&#39; for each object this</span>
<a name="l00555"></a>00555 <span class="comment">// hierarchy that&#39;s because first ALL bricks must exist in the new</span>
<a name="l00556"></a>00556 <span class="comment">// replica of the hierarchy in order to make cross-links work properly</span>
<a name="l00557"></a>00557 <span class="comment">// !</span>
<a name="l00558"></a>00558 <span class="comment">// It is VERY important that the order of sensors and actuators in</span>
<a name="l00559"></a>00559 <span class="comment">// the replicated object is preserved: it is used to reconnect the logic.</span>
<a name="l00560"></a>00560 <span class="comment">// This method is more robust then using the bricks name in case of complex </span>
<a name="l00561"></a>00561 <span class="comment">// group replication. The replication of logic bricks is done in </span>
<a name="l00562"></a>00562 <span class="comment">// SCA_IObject::ReParentLogic(), make sure it preserves the order of the bricks.</span>
<a name="l00563"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a7b3b8e3ba119a977e2ffffb4b0fd4e3f">00563</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a7b3b8e3ba119a977e2ffffb4b0fd4e3f">KX_Scene::ReplicateLogic</a>(<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* newobj)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565     <span class="comment">// also relink the controller to sensors/actuators</span>
<a name="l00566"></a>00566     <a class="code" href="../../dc/de6/SCA__IObject_8h.html#afc52d55edd6e89c7b789e32e7971b09f">SCA_ControllerList</a>&amp; controllers = newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a1ddd7f8bdd328a332e4aad7eb523d343">GetControllers</a>();
<a name="l00567"></a>00567     <span class="comment">//SCA_SensorList&amp;     sensors     = newobj-&gt;GetSensors();</span>
<a name="l00568"></a>00568     <span class="comment">//SCA_ActuatorList&amp;   actuators   = newobj-&gt;GetActuators();</span>
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">for</span> (SCA_ControllerList::iterator itc = controllers.begin(); !(itc==controllers.end());itc++)
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572         <a class="code" href="../../d9/d74/classSCA__IController.html">SCA_IController</a>* cont = (*itc);
<a name="l00573"></a>00573         cont-&gt;<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a6b9f4467149ea86bebb1f1ed6ded983f">SetUeberExecutePriority</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#ace3bfb66b4f29f2bf77db9c64b523925">m_ueberExecutionPriority</a>);
<a name="l00574"></a>00574         vector&lt;SCA_ISensor*&gt; linkedsensors = cont-&gt;<a class="code" href="../../d9/d74/classSCA__IController.html#a13c15041990338781524ff9d5b269476">GetLinkedSensors</a>();
<a name="l00575"></a>00575         vector&lt;SCA_IActuator*&gt; linkedactuators = cont-&gt;<a class="code" href="../../d9/d74/classSCA__IController.html#a75556e8984e8f5202f34e595c5e97461">GetLinkedActuators</a>();
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="comment">// disconnect the sensors and actuators</span>
<a name="l00578"></a>00578         <span class="comment">// do it directly on the list at this controller is not connected to anything at this stage</span>
<a name="l00579"></a>00579         cont-&gt;<a class="code" href="../../d9/d74/classSCA__IController.html#a13c15041990338781524ff9d5b269476">GetLinkedSensors</a>().clear();
<a name="l00580"></a>00580         cont-&gt;<a class="code" href="../../d9/d74/classSCA__IController.html#a75556e8984e8f5202f34e595c5e97461">GetLinkedActuators</a>().clear();
<a name="l00581"></a>00581         
<a name="l00582"></a>00582         <span class="comment">// now relink each sensor</span>
<a name="l00583"></a>00583         <span class="keywordflow">for</span> (vector&lt;SCA_ISensor*&gt;::iterator its = linkedsensors.begin();!(its==linkedsensors.end());its++)
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585             <a class="code" href="../../dc/d76/classSCA__ISensor.html">SCA_ISensor</a>* oldsensor = (*its);
<a name="l00586"></a>00586             <a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* oldsensorobj = oldsensor-&gt;<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a95c857650b9b7baa9987a65efecd42c4">GetParent</a>();
<a name="l00587"></a>00587             <a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* newsensorobj = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00588"></a>00588         
<a name="l00589"></a>00589             <span class="comment">// the original owner of the sensor has been replicated?</span>
<a name="l00590"></a>00590             <span class="keywordtype">void</span> **h_obj = <a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>[oldsensorobj];
<a name="l00591"></a>00591             <span class="keywordflow">if</span> (h_obj)
<a name="l00592"></a>00592                 newsensorobj = (<a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>*)(*h_obj);
<a name="l00593"></a>00593             <span class="keywordflow">if</span> (!newsensorobj)
<a name="l00594"></a>00594             {
<a name="l00595"></a>00595                 <span class="comment">// no, then the sensor points outside the hierachy, keep it the same</span>
<a name="l00596"></a>00596                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a42ec90a1f7c5e78b8262b948a1c823d1">SearchValue</a>(oldsensorobj))
<a name="l00597"></a>00597                     <span class="comment">// only replicate links that points to active objects</span>
<a name="l00598"></a>00598                     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a7e92d899b0cbdb64fd41bfe8e48769af">RegisterToSensor</a>(cont,oldsensor);
<a name="l00599"></a>00599             }
<a name="l00600"></a>00600             <span class="keywordflow">else</span>
<a name="l00601"></a>00601             {
<a name="l00602"></a>00602                 <span class="comment">// yes, then the new sensor has the same position</span>
<a name="l00603"></a>00603                 <a class="code" href="../../dc/de6/SCA__IObject_8h.html#a928978f9ec8ed536dd9b74298801e562">SCA_SensorList</a>&amp; sensorlist = oldsensorobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6931c6c819b8de336843073edc93e9c5">GetSensors</a>();
<a name="l00604"></a>00604                 SCA_SensorList::iterator sit;
<a name="l00605"></a>00605                 <a class="code" href="../../dc/d76/classSCA__ISensor.html">SCA_ISensor</a>* newsensor = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00606"></a>00606                 <span class="keywordtype">int</span> sensorpos;
<a name="l00607"></a>00607 
<a name="l00608"></a>00608                 <span class="keywordflow">for</span> (sensorpos=0, sit=sensorlist.begin(); sit!=sensorlist.end(); sit++, sensorpos++)
<a name="l00609"></a>00609                 {
<a name="l00610"></a>00610                     <span class="keywordflow">if</span> ((*sit) == oldsensor) 
<a name="l00611"></a>00611                     {
<a name="l00612"></a>00612                         newsensor = newsensorobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6931c6c819b8de336843073edc93e9c5">GetSensors</a>().at(sensorpos);
<a name="l00613"></a>00613                         <span class="keywordflow">break</span>;
<a name="l00614"></a>00614                     }
<a name="l00615"></a>00615                 }
<a name="l00616"></a>00616                 <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(newsensor != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00617"></a>00617                 <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a7e92d899b0cbdb64fd41bfe8e48769af">RegisterToSensor</a>(cont,newsensor);
<a name="l00618"></a>00618             }
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620         
<a name="l00621"></a>00621         <span class="comment">// now relink each actuator</span>
<a name="l00622"></a>00622         <span class="keywordflow">for</span> (vector&lt;SCA_IActuator*&gt;::iterator ita = linkedactuators.begin();!(ita==linkedactuators.end());ita++)
<a name="l00623"></a>00623         {
<a name="l00624"></a>00624             <a class="code" href="../../d5/d8b/classSCA__IActuator.html">SCA_IActuator</a>* oldactuator = (*ita);
<a name="l00625"></a>00625             <a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* oldactuatorobj = oldactuator-&gt;<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a95c857650b9b7baa9987a65efecd42c4">GetParent</a>();
<a name="l00626"></a>00626             <a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* newactuatorobj = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628             <span class="comment">// the original owner of the sensor has been replicated?</span>
<a name="l00629"></a>00629             <span class="keywordtype">void</span> **h_obj = <a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>[oldactuatorobj];
<a name="l00630"></a>00630             <span class="keywordflow">if</span> (h_obj)
<a name="l00631"></a>00631                 newactuatorobj = (<a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>*)(*h_obj);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633             <span class="keywordflow">if</span> (!newactuatorobj)
<a name="l00634"></a>00634             {
<a name="l00635"></a>00635                 <span class="comment">// no, then the sensor points outside the hierachy, keep it the same</span>
<a name="l00636"></a>00636                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a42ec90a1f7c5e78b8262b948a1c823d1">SearchValue</a>(oldactuatorobj))
<a name="l00637"></a>00637                     <span class="comment">// only replicate links that points to active objects</span>
<a name="l00638"></a>00638                     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a68ce8bd78ff4a5b7185165b741d5f3c0">RegisterToActuator</a>(cont,oldactuator);
<a name="l00639"></a>00639             }
<a name="l00640"></a>00640             <span class="keywordflow">else</span>
<a name="l00641"></a>00641             {
<a name="l00642"></a>00642                 <span class="comment">// yes, then the new sensor has the same position</span>
<a name="l00643"></a>00643                 <a class="code" href="../../dc/de6/SCA__IObject_8h.html#a6d9d58fbf8bcf0bbeecdd3473a21b408">SCA_ActuatorList</a>&amp; actuatorlist = oldactuatorobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>();
<a name="l00644"></a>00644                 SCA_ActuatorList::iterator ait;
<a name="l00645"></a>00645                 <a class="code" href="../../d5/d8b/classSCA__IActuator.html">SCA_IActuator</a>* newactuator = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00646"></a>00646                 <span class="keywordtype">int</span> actuatorpos;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648                 <span class="keywordflow">for</span> (actuatorpos=0, ait=actuatorlist.begin(); ait!=actuatorlist.end(); ait++, actuatorpos++)
<a name="l00649"></a>00649                 {
<a name="l00650"></a>00650                     <span class="keywordflow">if</span> ((*ait) == oldactuator) 
<a name="l00651"></a>00651                     {
<a name="l00652"></a>00652                         newactuator = newactuatorobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>().at(actuatorpos);
<a name="l00653"></a>00653                         <span class="keywordflow">break</span>;
<a name="l00654"></a>00654                     }
<a name="l00655"></a>00655                 }
<a name="l00656"></a>00656                 <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(newactuator != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00657"></a>00657                 <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a68ce8bd78ff4a5b7185165b741d5f3c0">RegisterToActuator</a>(cont,newactuator);
<a name="l00658"></a>00658                 newactuator-&gt;<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a6b9f4467149ea86bebb1f1ed6ded983f">SetUeberExecutePriority</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#ace3bfb66b4f29f2bf77db9c64b523925">m_ueberExecutionPriority</a>);
<a name="l00659"></a>00659             }
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662     <span class="comment">// ready to set initial state</span>
<a name="l00663"></a>00663     newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6ff384be524dde6d026dd7f1059b146a">ResetState</a>();
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aa96b9ae252e6d4b8bc0b22b4e3200199">00666</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aa96b9ae252e6d4b8bc0b22b4e3200199">KX_Scene::DupliGroupRecurse</a>(<a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* obj, <span class="keywordtype">int</span> level)
<a name="l00667"></a>00667 {
<a name="l00668"></a>00668     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* groupobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) obj;
<a name="l00669"></a>00669     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* replica;
<a name="l00670"></a>00670     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj;
<a name="l00671"></a>00671     <a class="code" href="../../de/de7/structObject.html">Object</a>* blgroupobj = groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l00672"></a>00672     <a class="code" href="../../d4/d91/structGroup.html">Group</a>* group;
<a name="l00673"></a>00673     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l00674"></a>00674     vector&lt;KX_GameObject*&gt; duplilist;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (!groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>() ||
<a name="l00677"></a>00677         !groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a264ac7c60a972b2afe766e1e847135f8">IsDupliGroup</a>() ||
<a name="l00678"></a>00678         level&gt;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36a22093e79e04fd2df49aaf650c10ce">MAX_DUPLI_RECUR</a>)
<a name="l00679"></a>00679         <span class="keywordflow">return</span>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="comment">// we will add one group at a time</span>
<a name="l00682"></a>00682     <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.clear();
<a name="l00683"></a>00683     <a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>();
<a name="l00684"></a>00684     <a class="code" href="../../d2/da3/classKX__Scene.html#ace3bfb66b4f29f2bf77db9c64b523925">m_ueberExecutionPriority</a>++;
<a name="l00685"></a>00685     <span class="comment">// for groups will do something special: </span>
<a name="l00686"></a>00686     <span class="comment">// we will force the creation of objects to those in the group only</span>
<a name="l00687"></a>00687     <span class="comment">// Again, this is match what Blender is doing (it doesn&#39;t care of parent relationship)</span>
<a name="l00688"></a>00688     <a class="code" href="../../d2/da3/classKX__Scene.html#afe2642c2496da56a535920434e991fff">m_groupGameObjects</a>.clear();
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     group = blgroupobj-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>;
<a name="l00691"></a>00691     <span class="keywordflow">for</span> (go=(<a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a>*)group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go=(<a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a>*)go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) 
<a name="l00692"></a>00692     {
<a name="l00693"></a>00693         <a class="code" href="../../de/de7/structObject.html">Object</a>* blenderobj = go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>;
<a name="l00694"></a>00694         <span class="keywordflow">if</span> (blgroupobj == blenderobj)
<a name="l00695"></a>00695             <span class="comment">// this check is also in group_duplilist()</span>
<a name="l00696"></a>00696             <span class="keywordflow">continue</span>;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698         gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a6ae6dbc0b64c5d968a0e65b7ab38de10">FindGameObjByBlendObj</a>(blenderobj);
<a name="l00699"></a>00699         <span class="keywordflow">if</span> (gameobj == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l00700"></a>00700         {
<a name="l00701"></a>00701             <span class="comment">// this object has not been converted!!!</span>
<a name="l00702"></a>00702             <span class="comment">// Should not happen as dupli group are created automatically </span>
<a name="l00703"></a>00703             <span class="keywordflow">continue</span>;
<a name="l00704"></a>00704         }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#af6b00ffd083ae6a634a0078bbf9faad6">SetBlenderGroupObject</a>(blgroupobj);
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <span class="keywordflow">if</span> ((blenderobj-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a> &amp; group-&gt;<a class="code" href="../../d4/d91/structGroup.html#aa803ef41a5ebcd860d3345e63c8d242c">layer</a>)==0)
<a name="l00709"></a>00709         {
<a name="l00710"></a>00710             <span class="comment">// object is not visible in the 3D view, will not be instantiated</span>
<a name="l00711"></a>00711             <span class="keywordflow">continue</span>;
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713         <a class="code" href="../../d2/da3/classKX__Scene.html#afe2642c2496da56a535920434e991fff">m_groupGameObjects</a>.insert(gameobj);
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     set&lt;CValue*&gt;::iterator oit;
<a name="l00717"></a>00717     <span class="keywordflow">for</span> (oit=<a class="code" href="../../d2/da3/classKX__Scene.html#afe2642c2496da56a535920434e991fff">m_groupGameObjects</a>.begin(); oit != <a class="code" href="../../d2/da3/classKX__Scene.html#afe2642c2496da56a535920434e991fff">m_groupGameObjects</a>.end(); oit++)
<a name="l00718"></a>00718     {
<a name="l00719"></a>00719         gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)(*oit);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *parent = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4554e5e42a4f3b02e8b56284edfdb611">GetParent</a>();
<a name="l00722"></a>00722         <span class="keywordflow">if</span> (parent != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00723"></a>00723         {
<a name="l00724"></a>00724             parent-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>(); <span class="comment">// GetParent() increased the refcount</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726             <span class="comment">// this object is not a top parent. Either it is the child of another</span>
<a name="l00727"></a>00727             <span class="comment">// object in the group and it will be added automatically when the parent</span>
<a name="l00728"></a>00728             <span class="comment">// is added. Or it is the child of an object outside the group and the group</span>
<a name="l00729"></a>00729             <span class="comment">// is inconsistent, skip it anyway</span>
<a name="l00730"></a>00730             <span class="keywordflow">continue</span>;
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732         replica = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) <a class="code" href="../../d2/da3/classKX__Scene.html#ab0f900fb646af6656672352891531858">AddNodeReplicaObject</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,gameobj);
<a name="l00733"></a>00733         <span class="comment">// add to &#39;rootparent&#39; list (this is the list of top hierarchy objects, updated each frame)</span>
<a name="l00734"></a>00734         <a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>());
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="comment">// recurse replication into children nodes</span>
<a name="l00737"></a>00737         <a class="code" href="../../df/d3b/SG__Node_8h.html#a8ae32373b02caa826276c36fe07ecb76">NodeList</a>&amp; children = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#aa0d15b7e05705e40a1525864cd7499d1">GetSGChildren</a>();
<a name="l00738"></a>00738 
<a name="l00739"></a>00739         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a9b47a0d3afd93c80efa164ae03c22113">ClearSGChildren</a>();
<a name="l00740"></a>00740         <span class="keywordflow">for</span> (NodeList::iterator childit = children.begin();!(childit==children.end());++childit)
<a name="l00741"></a>00741         {
<a name="l00742"></a>00742             <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* orgnode = (*childit);
<a name="l00743"></a>00743             <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* childreplicanode = orgnode-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#acd837cc73022e8d4f107ae93d81e1c77">GetSGReplica</a>();
<a name="l00744"></a>00744             <span class="keywordflow">if</span> (childreplicanode)
<a name="l00745"></a>00745                 replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a2e527abc6716de94e2bc551c69a9ae52">AddChild</a>(childreplicanode);
<a name="l00746"></a>00746         }
<a name="l00747"></a>00747         <span class="comment">// don&#39;t replicate logic now: we assume that the objects in the group can have</span>
<a name="l00748"></a>00748         <span class="comment">// logic relationship, even outside parent relationship</span>
<a name="l00749"></a>00749         <span class="comment">// In order to match 3D view, the position of groupobj is used as a </span>
<a name="l00750"></a>00750         <span class="comment">// transformation matrix instead of the new position. This means that </span>
<a name="l00751"></a>00751         <span class="comment">// the group reference point is 0,0,0</span>
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         <span class="comment">// get the rootnode&#39;s scale</span>
<a name="l00754"></a>00754         <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> newscale = groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a214226e36095439d638bb17d0057f88c">NodeGetWorldScaling</a>();
<a name="l00755"></a>00755         <span class="comment">// set the replica&#39;s relative scale with the rootnode&#39;s scale</span>
<a name="l00756"></a>00756         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a9c0d7951e0c48b05064d04a3c303fe44">NodeSetRelativeScale</a>(newscale);
<a name="l00757"></a>00757 
<a name="l00758"></a>00758         <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> offset(group-&gt;<a class="code" href="../../d4/d91/structGroup.html#aad2a848d575cebb420a380e4496c75c5">dupli_ofs</a>);
<a name="l00759"></a>00759         <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> newpos = groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>() + 
<a name="l00760"></a>00760             newscale*(groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac4c31c796993a704c92cbc2d82927cfe">NodeGetWorldOrientation</a>() * (gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>()-offset));
<a name="l00761"></a>00761         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a22d183aca27dacd2942c7eb428fa0eb7">NodeSetLocalPosition</a>(newpos);
<a name="l00762"></a>00762         <span class="comment">// set the orientation after position for softbody!</span>
<a name="l00763"></a>00763         <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a> newori = groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac4c31c796993a704c92cbc2d82927cfe">NodeGetWorldOrientation</a>() * gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac4c31c796993a704c92cbc2d82927cfe">NodeGetWorldOrientation</a>();
<a name="l00764"></a>00764         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a3832f5baf84b55a2b3d71b98a85ac7b1">NodeSetLocalOrientation</a>(newori);
<a name="l00765"></a>00765         <span class="comment">// update scenegraph for entire tree of children</span>
<a name="l00766"></a>00766         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a791ba43c770c33dc637bb61f93152745">UpdateWorldData</a>(0);
<a name="l00767"></a>00767         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#af7b29844eae45cad5e4aaff53bca0c0d">SetBBox</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a17f93f8a07655d9ec109426327a60ef5">BBox</a>());
<a name="l00768"></a>00768         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a4f5866990ac53d4528b2b52049bc43f4">SetRadius</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a88a6b46222babe1b0738f52f51cc1a9d">Radius</a>());
<a name="l00769"></a>00769         <span class="comment">// we can now add the graphic controller to the physic engine</span>
<a name="l00770"></a>00770         replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#adc5ba175fb7d47e8ece0d54992d41ffb">ActivateGraphicController</a>(<span class="keyword">true</span>);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="comment">// done with replica</span>
<a name="l00773"></a>00773         replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">// the logic must be replicated first because we need</span>
<a name="l00777"></a>00777     <span class="comment">// the new logic bricks before relinking</span>
<a name="l00778"></a>00778     vector&lt;KX_GameObject*&gt;::iterator git;
<a name="l00779"></a>00779     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781         (*git)-&gt;ReParentLogic();
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783     
<a name="l00784"></a>00784     <span class="comment">//  relink any pointers as necessary, sort of a temporary solution</span>
<a name="l00785"></a>00785     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00786"></a>00786     {
<a name="l00787"></a>00787         <span class="comment">// this will also relink the actuator to objects within the hierarchy</span>
<a name="l00788"></a>00788         (*git)-&gt;Relink(&amp;<a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>);
<a name="l00789"></a>00789         <span class="comment">// add the object in the layer of the parent</span>
<a name="l00790"></a>00790         (*git)-&gt;SetLayer(groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>());
<a name="l00791"></a>00791         <span class="comment">// If the object was a light, we need to update it&#39;s RAS_LightObject as well</span>
<a name="l00792"></a>00792         <span class="keywordflow">if</span> ((*git)-&gt;GetGameObjectType()==<a class="code" href="../../da/d68/classSCA__IObject.html#a1f0f06b1ee29284cbef58072f8f2671ba89f3a9ecc77a937dcd12e72726da5dd9">SCA_IObject::OBJ_LIGHT</a>)
<a name="l00793"></a>00793         {
<a name="l00794"></a>00794             <a class="code" href="../../d8/d31/classKX__LightObject.html">KX_LightObject</a>* lightobj = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d8/d31/classKX__LightObject.html">KX_LightObject</a>*<span class="keyword">&gt;</span>(*git);
<a name="l00795"></a>00795             lightobj-&gt;<a class="code" href="../../d8/d31/classKX__LightObject.html#a2f0616e6aa8f3d83249a08ae06395508">GetLightData</a>()-&gt;<a class="code" href="../../de/df8/structRAS__LightObject.html#ae69cf27f948257ffa569b85350238faa">m_layer</a> = groupobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>();
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799     <span class="comment">// replicate crosslinks etc. between logic bricks</span>
<a name="l00800"></a>00800     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00801"></a>00801     {
<a name="l00802"></a>00802         <a class="code" href="../../d2/da3/classKX__Scene.html#a7b3b8e3ba119a977e2ffffb4b0fd4e3f">ReplicateLogic</a>((*git));
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804     
<a name="l00805"></a>00805     <span class="comment">// now look if object in the hierarchy have dupli group and recurse</span>
<a name="l00806"></a>00806     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00807"></a>00807     {
<a name="l00808"></a>00808         <span class="keywordflow">if</span> ((*git) != groupobj &amp;&amp; (*git)-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a264ac7c60a972b2afe766e1e847135f8">IsDupliGroup</a>())
<a name="l00809"></a>00809             <span class="comment">// can&#39;t instantiate group immediately as it destroys m_logicHierarchicalGameObjects</span>
<a name="l00810"></a>00810             duplilist.push_back((*git));
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="keywordflow">for</span> (git = duplilist.begin(); !(git == duplilist.end()); ++git)
<a name="l00814"></a>00814     {
<a name="l00815"></a>00815         <a class="code" href="../../d2/da3/classKX__Scene.html#aa96b9ae252e6d4b8bc0b22b4e3200199">DupliGroupRecurse</a>((*git), level+1);
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817 }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819 
<a name="l00820"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aa5061eaf15eecd535d55c2c52bd11b83">00820</a> <a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#aa5061eaf15eecd535d55c2c52bd11b83">KX_Scene::AddReplicaObject</a>(<span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* originalobject,
<a name="l00821"></a>00821                                         <span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* parentobject,
<a name="l00822"></a>00822                                         <span class="keywordtype">int</span> lifespan)
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.clear();
<a name="l00826"></a>00826     <a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>();
<a name="l00827"></a>00827     <a class="code" href="../../d2/da3/classKX__Scene.html#afe2642c2496da56a535920434e991fff">m_groupGameObjects</a>.clear();
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="comment">// todo: place a timebomb in the object, for temporarily objects :)</span>
<a name="l00830"></a>00830     <span class="comment">// lifespan of zero means &#39;this object lives forever&#39;</span>
<a name="l00831"></a>00831     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* originalobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) originalobject;
<a name="l00832"></a>00832     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* parentobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) parentobject;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834     <a class="code" href="../../d2/da3/classKX__Scene.html#ace3bfb66b4f29f2bf77db9c64b523925">m_ueberExecutionPriority</a>++;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="comment">// lets create a replica</span>
<a name="l00837"></a>00837     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* replica = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) <a class="code" href="../../d2/da3/classKX__Scene.html#ab0f900fb646af6656672352891531858">AddNodeReplicaObject</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,originalobj);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">if</span> (lifespan &gt; 0)
<a name="l00840"></a>00840     {
<a name="l00841"></a>00841         <span class="comment">// add a timebomb to this object</span>
<a name="l00842"></a>00842         <span class="comment">// for now, convert between so called frames and realtime</span>
<a name="l00843"></a>00843         <a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>());
<a name="l00844"></a>00844         <span class="comment">// this convert the life from frames to sort-of seconds, hard coded 0.02 that assumes we have 50 frames per second</span>
<a name="l00845"></a>00845         <span class="comment">// if you change this value, make sure you change it in KX_GameObject::pyattr_get_life property too</span>
<a name="l00846"></a>00846         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a> *fval = <span class="keyword">new</span> <a class="code" href="../../d0/d4c/classCFloatValue.html">CFloatValue</a>(lifespan*0.02);
<a name="l00847"></a>00847         replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a9d5dd30c15b816f60f1fb6b38bae939c" title="Property Management.">SetProperty</a>(<span class="stringliteral">&quot;::timebomb&quot;</span>,fval);
<a name="l00848"></a>00848         fval-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="comment">// add to &#39;rootparent&#39; list (this is the list of top hierarchy objects, updated each frame)</span>
<a name="l00852"></a>00852     <a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>());
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     <span class="comment">// recurse replication into children nodes</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <a class="code" href="../../df/d3b/SG__Node_8h.html#a8ae32373b02caa826276c36fe07ecb76">NodeList</a>&amp; children = originalobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#aa0d15b7e05705e40a1525864cd7499d1">GetSGChildren</a>();
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a9b47a0d3afd93c80efa164ae03c22113">ClearSGChildren</a>();
<a name="l00859"></a>00859     <span class="keywordflow">for</span> (NodeList::iterator childit = children.begin();!(childit==children.end());++childit)
<a name="l00860"></a>00860     {
<a name="l00861"></a>00861         <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* orgnode = (*childit);
<a name="l00862"></a>00862         <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* childreplicanode = orgnode-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#acd837cc73022e8d4f107ae93d81e1c77">GetSGReplica</a>();
<a name="l00863"></a>00863         <span class="keywordflow">if</span> (childreplicanode)
<a name="l00864"></a>00864             replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a2e527abc6716de94e2bc551c69a9ae52">AddChild</a>(childreplicanode);
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="comment">// At this stage all the objects in the hierarchy have been duplicated,</span>
<a name="l00868"></a>00868     <span class="comment">// we can update the scenegraph, we need it for the duplication of logic</span>
<a name="l00869"></a>00869     <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> newpos = ((<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) parentobject)-&gt;NodeGetWorldPosition();
<a name="l00870"></a>00870     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a22d183aca27dacd2942c7eb428fa0eb7">NodeSetLocalPosition</a>(newpos);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a> newori = ((<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) parentobject)-&gt;NodeGetWorldOrientation();
<a name="l00873"></a>00873     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a3832f5baf84b55a2b3d71b98a85ac7b1">NodeSetLocalOrientation</a>(newori);
<a name="l00874"></a>00874     
<a name="l00875"></a>00875     <span class="comment">// get the rootnode&#39;s scale</span>
<a name="l00876"></a>00876     <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> newscale = parentobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a567f2f8e61a1fe15cfee58bb47f18c06">GetRootSGParent</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#ab2a2369819619117a9ea73555b0e7646">GetLocalScale</a>();
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="comment">// set the replica&#39;s relative scale with the rootnode&#39;s scale</span>
<a name="l00879"></a>00879     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a9c0d7951e0c48b05064d04a3c303fe44">NodeSetRelativeScale</a>(newscale);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a791ba43c770c33dc637bb61f93152745">UpdateWorldData</a>(0);
<a name="l00882"></a>00882     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#af7b29844eae45cad5e4aaff53bca0c0d">SetBBox</a>(originalobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a17f93f8a07655d9ec109426327a60ef5">BBox</a>());
<a name="l00883"></a>00883     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a4f5866990ac53d4528b2b52049bc43f4">SetRadius</a>(originalobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a88a6b46222babe1b0738f52f51cc1a9d">Radius</a>());
<a name="l00884"></a>00884     <span class="comment">// the size is correct, we can add the graphic controller to the physic engine</span>
<a name="l00885"></a>00885     replica-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#adc5ba175fb7d47e8ece0d54992d41ffb">ActivateGraphicController</a>(<span class="keyword">true</span>);
<a name="l00886"></a>00886 
<a name="l00887"></a>00887     <span class="comment">// now replicate logic</span>
<a name="l00888"></a>00888     vector&lt;KX_GameObject*&gt;::iterator git;
<a name="l00889"></a>00889     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891         (*git)-&gt;ReParentLogic();
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893     
<a name="l00894"></a>00894     <span class="comment">//  relink any pointers as necessary, sort of a temporary solution</span>
<a name="l00895"></a>00895     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00896"></a>00896     {
<a name="l00897"></a>00897         <span class="comment">// this will also relink the actuators in the hierarchy</span>
<a name="l00898"></a>00898         (*git)-&gt;Relink(&amp;<a class="code" href="../../d2/da3/classKX__Scene.html#ab8386c7f62e5caaf2375b2ff0d2e1649">m_map_gameobject_to_replica</a>);
<a name="l00899"></a>00899         <span class="comment">// add the object in the layer of the parent</span>
<a name="l00900"></a>00900         (*git)-&gt;SetLayer(parentobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>());
<a name="l00901"></a>00901         <span class="comment">// If the object was a light, we need to update it&#39;s RAS_LightObject as well</span>
<a name="l00902"></a>00902         <span class="keywordflow">if</span> ((*git)-&gt;GetGameObjectType()==<a class="code" href="../../da/d68/classSCA__IObject.html#a1f0f06b1ee29284cbef58072f8f2671ba89f3a9ecc77a937dcd12e72726da5dd9">SCA_IObject::OBJ_LIGHT</a>)
<a name="l00903"></a>00903         {
<a name="l00904"></a>00904             <a class="code" href="../../d8/d31/classKX__LightObject.html">KX_LightObject</a>* lightobj = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d8/d31/classKX__LightObject.html">KX_LightObject</a>*<span class="keyword">&gt;</span>(*git);
<a name="l00905"></a>00905             lightobj-&gt;<a class="code" href="../../d8/d31/classKX__LightObject.html#a2f0616e6aa8f3d83249a08ae06395508">GetLightData</a>()-&gt;<a class="code" href="../../de/df8/structRAS__LightObject.html#ae69cf27f948257ffa569b85350238faa">m_layer</a> = parentobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>();
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907     }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     <span class="comment">// replicate crosslinks etc. between logic bricks</span>
<a name="l00910"></a>00910     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00911"></a>00911     {
<a name="l00912"></a>00912         <a class="code" href="../../d2/da3/classKX__Scene.html#a7b3b8e3ba119a977e2ffffb4b0fd4e3f">ReplicateLogic</a>((*git));
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914     
<a name="l00915"></a>00915     <span class="comment">// check if there are objects with dupligroup in the hierarchy</span>
<a name="l00916"></a>00916     vector&lt;KX_GameObject*&gt; duplilist;
<a name="l00917"></a>00917     <span class="keywordflow">for</span> (git = <a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.begin();!(git==<a class="code" href="../../d2/da3/classKX__Scene.html#a649a247dffa35475fa13536543729e9b">m_logicHierarchicalGameObjects</a>.end());++git)
<a name="l00918"></a>00918     {
<a name="l00919"></a>00919         <span class="keywordflow">if</span> ((*git)-&gt;IsDupliGroup())
<a name="l00920"></a>00920         {
<a name="l00921"></a>00921             <span class="comment">// separate list as m_logicHierarchicalGameObjects is also used by DupliGroupRecurse()</span>
<a name="l00922"></a>00922             duplilist.push_back(*git);
<a name="l00923"></a>00923         }
<a name="l00924"></a>00924     }
<a name="l00925"></a>00925     <span class="keywordflow">for</span> (git = duplilist.begin();!(git==duplilist.end());++git)
<a name="l00926"></a>00926     {
<a name="l00927"></a>00927         <a class="code" href="../../d2/da3/classKX__Scene.html#aa96b9ae252e6d4b8bc0b22b4e3200199">DupliGroupRecurse</a>(*git, 0);
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929     <span class="comment">//  don&#39;t release replica here because we are returning it, not done with it...</span>
<a name="l00930"></a>00930     <span class="keywordflow">return</span> replica;
<a name="l00931"></a>00931 }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 
<a name="l00935"></a><a class="code" href="../../d2/da3/classKX__Scene.html#af875d0f33688aaa8cea374d9a96dbcbe">00935</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#af875d0f33688aaa8cea374d9a96dbcbe">KX_Scene::RemoveObject</a>(<span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l00936"></a>00936 {
<a name="l00937"></a>00937     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* newobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) gameobj;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <span class="comment">// disconnect child from parent</span>
<a name="l00940"></a>00940     <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* node = newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>();
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <span class="keywordflow">if</span> (node)
<a name="l00943"></a>00943     {
<a name="l00944"></a>00944         node-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a8090fb062d17a47fa1d4e320332ea2b4">DisconnectFromParent</a>();
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         <span class="comment">// recursively destruct</span>
<a name="l00947"></a>00947         node-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#ac774a8c98d9f29f1b35a2740cc73450f">Destruct</a>();
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     <span class="comment">//no need to do that: the object is destroyed and memory released </span>
<a name="l00950"></a>00950     <span class="comment">//newobj-&gt;SetSGNode(0);</span>
<a name="l00951"></a>00951 }
<a name="l00952"></a>00952 
<a name="l00953"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a5b5f17f9ad24ad20d6770447b8368a3f">00953</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a5b5f17f9ad24ad20d6770447b8368a3f">KX_Scene::DelayedRemoveObject</a>(<span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l00954"></a>00954 {
<a name="l00955"></a>00955     <span class="comment">//KX_GameObject* newobj = (KX_GameObject*) gameobj;</span>
<a name="l00956"></a>00956     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a42ec90a1f7c5e78b8262b948a1c823d1">SearchValue</a>(gameobj))
<a name="l00957"></a>00957     {
<a name="l00958"></a>00958         <a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(gameobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>());
<a name="l00959"></a>00959     } 
<a name="l00960"></a>00960 }
<a name="l00961"></a>00961 
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 
<a name="l00964"></a><a class="code" href="../../d2/da3/classKX__Scene.html#af606c325634056236f63be551c63c3ea">00964</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da3/classKX__Scene.html#af606c325634056236f63be551c63c3ea">KX_Scene::NewRemoveObject</a>(<span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966     <span class="keywordtype">int</span> ret;
<a name="l00967"></a>00967     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* newobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) gameobj;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     <span class="comment">/* Invalidate the python reference, since the object may exist in script lists</span>
<a name="l00970"></a>00970 <span class="comment">     * its possible that it wont be automatically invalidated, so do it manually here,</span>
<a name="l00971"></a>00971 <span class="comment">     * </span>
<a name="l00972"></a>00972 <span class="comment">     * if for some reason the object is added back into the scene python can always get a new Proxy</span>
<a name="l00973"></a>00973 <span class="comment">     */</span>
<a name="l00974"></a>00974     newobj-&gt;<a class="code" href="../../d0/dbc/classPyObjectPlus.html#aefa0215a22de17ec6429ecdd6af2cb0c">InvalidateProxy</a>();
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <span class="comment">// keep the blender-&gt;game object association up to date</span>
<a name="l00977"></a>00977     <span class="comment">// note that all the replicas of an object will have the same</span>
<a name="l00978"></a>00978     <span class="comment">// blender object, that&#39;s why we need to check the game object</span>
<a name="l00979"></a>00979     <span class="comment">// as only the deletion of the original object must be recorded</span>
<a name="l00980"></a>00980     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#aa78e5261da36f5f264ed43bf9d8d2a2f">UnregisterGameObj</a>(newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>(), gameobj);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <span class="comment">//todo: look at this</span>
<a name="l00983"></a>00983     <span class="comment">//GetPhysicsEnvironment()-&gt;RemovePhysicsController(gameobj-&gt;getPhysicsController());</span>
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     <span class="comment">// remove all sensors/controllers/actuators from logicsystem...</span>
<a name="l00986"></a>00986     
<a name="l00987"></a>00987     <a class="code" href="../../dc/de6/SCA__IObject_8h.html#a928978f9ec8ed536dd9b74298801e562">SCA_SensorList</a>&amp; sensors = newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6931c6c819b8de336843073edc93e9c5">GetSensors</a>();
<a name="l00988"></a>00988     <span class="keywordflow">for</span> (SCA_SensorList::iterator its = sensors.begin();
<a name="l00989"></a>00989          !(its==sensors.end());its++)
<a name="l00990"></a>00990     {
<a name="l00991"></a>00991         <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a5914cc5e6db88fe1901a8007b4d16977">RemoveSensor</a>(*its);
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <a class="code" href="../../dc/de6/SCA__IObject_8h.html#afc52d55edd6e89c7b789e32e7971b09f">SCA_ControllerList</a>&amp; controllers = newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a1ddd7f8bdd328a332e4aad7eb523d343">GetControllers</a>();
<a name="l00995"></a>00995     <span class="keywordflow">for</span> (SCA_ControllerList::iterator itc = controllers.begin();
<a name="l00996"></a>00996          !(itc==controllers.end());itc++)
<a name="l00997"></a>00997     {
<a name="l00998"></a>00998         <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a8a6dc5df8dcfe84344045564d7533d8c">RemoveController</a>(*itc);
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <a class="code" href="../../dc/de6/SCA__IObject_8h.html#a6d9d58fbf8bcf0bbeecdd3473a21b408">SCA_ActuatorList</a>&amp; actuators = newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>();
<a name="l01002"></a>01002     <span class="keywordflow">for</span> (SCA_ActuatorList::iterator ita = actuators.begin();
<a name="l01003"></a>01003          !(ita==actuators.end());ita++)
<a name="l01004"></a>01004     {
<a name="l01005"></a>01005         <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a0ee24a86f9e3d33521b337bd8fdfae66">RemoveActuator</a>(*ita);
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007     <span class="comment">// the sensors/controllers/actuators must also be released, this is done in ~SCA_IObject</span>
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <span class="comment">// now remove the timer properties from the time manager</span>
<a name="l01010"></a>01010     <span class="keywordtype">int</span> numprops = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#af55f9e133711c3efd3f55f0380efb3e9">GetPropertyCount</a>();
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; numprops; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01013"></a>01013     {
<a name="l01014"></a>01014         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* propval = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l01015"></a>01015         <span class="keywordflow">if</span> (propval-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<span class="stringliteral">&quot;timer&quot;</span>))
<a name="l01016"></a>01016         {
<a name="l01017"></a>01017             <a class="code" href="../../d2/da3/classKX__Scene.html#a113450ed42f973641e38f5af82d19e61">m_timemgr</a>-&gt;<a class="code" href="../../de/dd3/classSCA__TimeEventManager.html#a874010c3edcc9d1ae4612921130f3be1">RemoveTimeProperty</a>(propval);
<a name="l01018"></a>01018         }
<a name="l01019"></a>01019     }
<a name="l01020"></a>01020     
<a name="l01021"></a>01021     newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#adc5a6f8bb55a78231a8a5c86de7cc10d">RemoveMeshes</a>();
<a name="l01022"></a>01022     ret = 1;
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (newobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6093176c1389ff66df406c225ee0bcaf">GetGameObjectType</a>()==<a class="code" href="../../da/d68/classSCA__IObject.html#a1f0f06b1ee29284cbef58072f8f2671ba89f3a9ecc77a937dcd12e72726da5dd9">SCA_IObject::OBJ_LIGHT</a> &amp;&amp; <a class="code" href="../../d2/da3/classKX__Scene.html#a9025ca6731839d4e7cd6b069ebf21345">m_lightlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01024"></a>01024         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01026"></a>01026         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01027"></a>01027     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01028"></a>01028         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#ad8189fb96b828d3a464bcf6931e618bd">m_parentlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01030"></a>01030         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01031"></a>01031     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a99eaa79b8f26eddd69d2cc1d2334b9ad">m_inactivelist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01032"></a>01032         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01033"></a>01033     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01034"></a>01034         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01035"></a>01035     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(newobj))
<a name="l01036"></a>01036         ret = newobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01037"></a>01037         
<a name="l01038"></a>01038     <span class="keywordflow">if</span> (newobj == <a class="code" href="../../d2/da3/classKX__Scene.html#ada20662a220ce96c5cf62631db89a8b3">m_active_camera</a>)
<a name="l01039"></a>01039     {
<a name="l01040"></a>01040         <span class="comment">//no AddRef done on m_active_camera so no Release</span>
<a name="l01041"></a>01041         <span class="comment">//m_active_camera-&gt;Release();</span>
<a name="l01042"></a>01042         <a class="code" href="../../d2/da3/classKX__Scene.html#ada20662a220ce96c5cf62631db89a8b3">m_active_camera</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     <span class="comment">// in case this is a camera</span>
<a name="l01046"></a>01046     <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.remove((<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>*)newobj);
<a name="l01047"></a>01047 
<a name="l01048"></a>01048     <span class="comment">// in case this is a font</span>
<a name="l01049"></a>01049     <a class="code" href="../../d2/da3/classKX__Scene.html#af2472d5fc466a80650613900067fd99f">m_fonts</a>.remove((<a class="code" href="../../d1/d47/classKX__FontObject.html">KX_FontObject</a>*)newobj);
<a name="l01050"></a>01050 
<a name="l01051"></a>01051     <span class="comment">/* currently does nothing, keep in case we need to Unregister something */</span>
<a name="l01052"></a>01052 <span class="preprocessor">#if 0</span>
<a name="l01053"></a>01053 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a136771ca7c3a57a7f15140ba24e86e12">m_sceneConverter</a>)
<a name="l01054"></a>01054         <a class="code" href="../../d2/da3/classKX__Scene.html#a136771ca7c3a57a7f15140ba24e86e12">m_sceneConverter</a>-&gt;<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a9df0abe9021caa8548159afaebd2e99f">UnregisterGameObject</a>(newobj);
<a name="l01055"></a>01055 <span class="preprocessor">#endif</span>
<a name="l01056"></a>01056 <span class="preprocessor"></span>    
<a name="l01057"></a>01057     <span class="comment">// return value will be 0 if the object is actually deleted (all reference gone)</span>
<a name="l01058"></a>01058     
<a name="l01059"></a>01059     <span class="keywordflow">return</span> ret;
<a name="l01060"></a>01060 }
<a name="l01061"></a>01061 
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 
<a name="l01064"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a8c98cded27cde1ff0bfc3e5a54b9e53d">01064</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a8c98cded27cde1ff0bfc3e5a54b9e53d">KX_Scene::ReplaceMesh</a>(<span class="keyword">class</span> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* obj,<span class="keywordtype">void</span>* meshobj, <span class="keywordtype">bool</span> use_gfx, <span class="keywordtype">bool</span> use_phys)
<a name="l01065"></a>01065 {
<a name="l01066"></a>01066     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*<span class="keyword">&gt;</span>(obj);
<a name="l01067"></a>01067     <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>* mesh = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>*<span class="keyword">&gt;</span>(meshobj);
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     <span class="keywordflow">if</span> (!gameobj) {
<a name="l01070"></a>01070         std::cout &lt;&lt; <span class="stringliteral">&quot;KX_Scene::ReplaceMesh Warning: invalid object, doing nothing&quot;</span> &lt;&lt; std::endl;
<a name="l01071"></a>01071         <span class="keywordflow">return</span>;
<a name="l01072"></a>01072     }
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     <span class="keywordflow">if</span> (use_gfx &amp;&amp; mesh != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01075"></a>01075     {       
<a name="l01076"></a>01076     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#adc5a6f8bb55a78231a8a5c86de7cc10d">RemoveMeshes</a>();
<a name="l01077"></a>01077     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab9aa7b85e7af077ebf3b475b1fdf0b64">AddMesh</a>(mesh);
<a name="l01078"></a>01078     
<a name="l01079"></a>01079     <span class="keywordflow">if</span> (gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a38b418326591ac039868bf0387d221dd">m_isDeformable</a>)
<a name="l01080"></a>01080     {
<a name="l01081"></a>01081         <a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a>* newobj = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a>*<span class="keyword">&gt;</span>( gameobj );
<a name="l01082"></a>01082         
<a name="l01083"></a>01083         <span class="keywordflow">if</span> (newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#abdf9c8fe6e65a0b967e002b42edd6b32">GetDeformer</a>())
<a name="l01084"></a>01084         {
<a name="l01085"></a>01085             <span class="keyword">delete</span> newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#abdf9c8fe6e65a0b967e002b42edd6b32">GetDeformer</a>();
<a name="l01086"></a>01086             newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a984ec33f21d152789887b15e93c752ce">SetDeformer</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01087"></a>01087         }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089         <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3f873a70dc7521e2e67ef719ca3f22dc">GetMesh</a>()) 
<a name="l01090"></a>01090         {
<a name="l01091"></a>01091             <span class="comment">// we must create a new deformer but which one?</span>
<a name="l01092"></a>01092             <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* parentobj = newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a4554e5e42a4f3b02e8b56284edfdb611">GetParent</a>();
<a name="l01093"></a>01093             <span class="comment">// this always return the original game object (also for replicate)</span>
<a name="l01094"></a>01094             <a class="code" href="../../de/de7/structObject.html">Object</a>* blendobj = newobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l01095"></a>01095             <span class="comment">// object that owns the new mesh</span>
<a name="l01096"></a>01096             <a class="code" href="../../de/de7/structObject.html">Object</a>* oldblendobj = <span class="keyword">static_cast&lt;</span>struct <a class="code" href="../../de/de7/structObject.html">Object</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#aab845ccc471c7d75069377fb5fe57946">FindBlendObjByGameMeshName</a>(mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a8e232cc1d6f124cc472f9717f82c2f77">GetName</a>()));
<a name="l01097"></a>01097             <a class="code" href="../../da/d29/structMesh.html">Mesh</a>* blendmesh = mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3f873a70dc7521e2e67ef719ca3f22dc">GetMesh</a>();
<a name="l01098"></a>01098 
<a name="l01099"></a>01099             <span class="keywordtype">bool</span> bHasModifier = <a class="code" href="../../d8/dbf/classBL__ModifierDeformer.html#aa93c52466dcd9da31b79aba8c7368057">BL_ModifierDeformer::HasCompatibleDeformer</a>(blendobj);
<a name="l01100"></a>01100             <span class="keywordtype">bool</span> bHasShapeKey = blendmesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; blendmesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#af4673161e52f45eb6c8efc3ea71939fa">type</a>==<a class="code" href="../../de/d41/DNA__key__types_8h.html#a14061dd054afd472999a4f4f6cdf3923a166121abc12de1fb379b9e6956f45c67">KEY_RELATIVE</a>;
<a name="l01101"></a>01101             <span class="keywordtype">bool</span> bHasDvert = blendmesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01102"></a>01102             <span class="keywordtype">bool</span> bHasArmature = 
<a name="l01103"></a>01103                 <a class="code" href="../../d8/dbf/classBL__ModifierDeformer.html#a4347aece15d3c85492d0a8736386e111">BL_ModifierDeformer::HasArmatureDeformer</a>(blendobj) &amp;&amp;
<a name="l01104"></a>01104                 parentobj &amp;&amp;                                <span class="comment">// current parent is armature</span>
<a name="l01105"></a>01105                 parentobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6093176c1389ff66df406c225ee0bcaf">GetGameObjectType</a>() == <a class="code" href="../../da/d68/classSCA__IObject.html#a1f0f06b1ee29284cbef58072f8f2671ba8477bd4faa124e9f3280aa92537e00ec">SCA_IObject::OBJ_ARMATURE</a> &amp;&amp;
<a name="l01106"></a>01106                 oldblendobj &amp;&amp;                              <span class="comment">// needed for mesh deform</span>
<a name="l01107"></a>01107                 blendobj-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a> &amp;&amp;                         <span class="comment">// original object had armature (not sure this test is needed)</span>
<a name="l01108"></a>01108                 blendobj-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a> &amp;&amp;
<a name="l01109"></a>01109                 blendmesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a>!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;                     <span class="comment">// mesh has vertex group</span>
<a name="l01110"></a>01110 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01111"></a>01111 <span class="preprocessor"></span>            <span class="keywordtype">bool</span> bHasSoftBody = (!parentobj &amp;&amp; (blendobj-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af92fc03b976c0b0b12655c193bd15a44">OB_SOFT_BODY</a>));
<a name="l01112"></a>01112 <span class="preprocessor">#endif</span>
<a name="l01113"></a>01113 <span class="preprocessor"></span>            <span class="keywordtype">bool</span> releaseParent = <span class="keyword">true</span>;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115             
<a name="l01116"></a>01116             <span class="keywordflow">if</span> (oldblendobj==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01117"></a>01117                 <span class="keywordflow">if</span> (bHasModifier || bHasShapeKey || bHasDvert || bHasArmature) {
<a name="l01118"></a>01118                     std::cout &lt;&lt; <span class="stringliteral">&quot;warning: ReplaceMesh() new mesh is not used in an object from the current scene, you will get incorrect behavior&quot;</span> &lt;&lt; std::endl;
<a name="l01119"></a>01119                     bHasShapeKey= bHasDvert= bHasArmature=bHasModifier= <span class="keyword">false</span>;
<a name="l01120"></a>01120                 }
<a name="l01121"></a>01121             }
<a name="l01122"></a>01122             
<a name="l01123"></a>01123             <span class="keywordflow">if</span> (bHasModifier)
<a name="l01124"></a>01124             {
<a name="l01125"></a>01125                 <a class="code" href="../../d8/dbf/classBL__ModifierDeformer.html">BL_ModifierDeformer</a>* modifierDeformer;
<a name="l01126"></a>01126                 <span class="keywordflow">if</span> (bHasShapeKey || bHasArmature)
<a name="l01127"></a>01127                 {
<a name="l01128"></a>01128                     modifierDeformer = <span class="keyword">new</span> <a class="code" href="../../d8/dbf/classBL__ModifierDeformer.html">BL_ModifierDeformer</a>(
<a name="l01129"></a>01129                         newobj,
<a name="l01130"></a>01130                         <a class="code" href="../../d2/da3/classKX__Scene.html#a4f9af3a58953b41cb7ab437052179f50">m_blenderScene</a>,
<a name="l01131"></a>01131                         oldblendobj, blendobj,
<a name="l01132"></a>01132                         mesh,
<a name="l01133"></a>01133                         <span class="keyword">true</span>,
<a name="l01134"></a>01134                         static_cast&lt;BL_ArmatureObject*&gt;( parentobj )
<a name="l01135"></a>01135                     );
<a name="l01136"></a>01136                     releaseParent= <span class="keyword">false</span>;
<a name="l01137"></a>01137                     modifierDeformer-&gt;<a class="code" href="../../d6/d12/classBL__ShapeDeformer.html#a2960be18d159d1bcf7e2324f1b75b64a">LoadShapeDrivers</a>(blendobj-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l01138"></a>01138                 }
<a name="l01139"></a>01139                 <span class="keywordflow">else</span>
<a name="l01140"></a>01140                 {
<a name="l01141"></a>01141                     modifierDeformer = <span class="keyword">new</span> <a class="code" href="../../d8/dbf/classBL__ModifierDeformer.html">BL_ModifierDeformer</a>(
<a name="l01142"></a>01142                         newobj,
<a name="l01143"></a>01143                         <a class="code" href="../../d2/da3/classKX__Scene.html#a4f9af3a58953b41cb7ab437052179f50">m_blenderScene</a>,
<a name="l01144"></a>01144                         oldblendobj, blendobj,
<a name="l01145"></a>01145                         mesh,
<a name="l01146"></a>01146                         <span class="keyword">false</span>,
<a name="l01147"></a>01147                         <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>
<a name="l01148"></a>01148                     );
<a name="l01149"></a>01149                 }
<a name="l01150"></a>01150                 newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a984ec33f21d152789887b15e93c752ce">SetDeformer</a>(modifierDeformer);
<a name="l01151"></a>01151             } 
<a name="l01152"></a>01152             <span class="keywordflow">else</span>    <span class="keywordflow">if</span> (bHasShapeKey)
<a name="l01153"></a>01153             {
<a name="l01154"></a>01154                 <a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a>* shapeDeformer;
<a name="l01155"></a>01155                 <span class="keywordflow">if</span> (bHasArmature) 
<a name="l01156"></a>01156                 {
<a name="l01157"></a>01157                     shapeDeformer = <span class="keyword">new</span> <a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a>(
<a name="l01158"></a>01158                         newobj,
<a name="l01159"></a>01159                         oldblendobj, blendobj,
<a name="l01160"></a>01160                         mesh,
<a name="l01161"></a>01161                         <span class="keyword">true</span>,
<a name="l01162"></a>01162                         <span class="keyword">true</span>,
<a name="l01163"></a>01163                         static_cast&lt;BL_ArmatureObject*&gt;( parentobj )
<a name="l01164"></a>01164                     );
<a name="l01165"></a>01165                     releaseParent= <span class="keyword">false</span>;
<a name="l01166"></a>01166                     shapeDeformer-&gt;<a class="code" href="../../d6/d12/classBL__ShapeDeformer.html#a2960be18d159d1bcf7e2324f1b75b64a">LoadShapeDrivers</a>(blendobj-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l01167"></a>01167                 }
<a name="l01168"></a>01168                 <span class="keywordflow">else</span>
<a name="l01169"></a>01169                 {
<a name="l01170"></a>01170                     shapeDeformer = <span class="keyword">new</span> <a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a>(
<a name="l01171"></a>01171                         newobj,
<a name="l01172"></a>01172                         oldblendobj, blendobj,
<a name="l01173"></a>01173                         mesh,
<a name="l01174"></a>01174                         <span class="keyword">false</span>,
<a name="l01175"></a>01175                         <span class="keyword">true</span>,
<a name="l01176"></a>01176                         <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>
<a name="l01177"></a>01177                     );
<a name="l01178"></a>01178                 }
<a name="l01179"></a>01179                 newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a984ec33f21d152789887b15e93c752ce">SetDeformer</a>( shapeDeformer);
<a name="l01180"></a>01180             }
<a name="l01181"></a>01181             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bHasArmature) 
<a name="l01182"></a>01182             {
<a name="l01183"></a>01183                 <a class="code" href="../../d2/d80/classBL__SkinDeformer.html">BL_SkinDeformer</a>* skinDeformer = <span class="keyword">new</span> <a class="code" href="../../d2/d80/classBL__SkinDeformer.html">BL_SkinDeformer</a>(
<a name="l01184"></a>01184                     newobj,
<a name="l01185"></a>01185                     oldblendobj, blendobj,
<a name="l01186"></a>01186                     mesh,
<a name="l01187"></a>01187                     <span class="keyword">true</span>,
<a name="l01188"></a>01188                     <span class="keyword">true</span>,
<a name="l01189"></a>01189                     static_cast&lt;BL_ArmatureObject*&gt;( parentobj )
<a name="l01190"></a>01190                 );
<a name="l01191"></a>01191                 releaseParent= <span class="keyword">false</span>;
<a name="l01192"></a>01192                 newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a984ec33f21d152789887b15e93c752ce">SetDeformer</a>(skinDeformer);
<a name="l01193"></a>01193             }
<a name="l01194"></a>01194             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bHasDvert)
<a name="l01195"></a>01195             {
<a name="l01196"></a>01196                 <a class="code" href="../../d2/dc5/classBL__MeshDeformer.html">BL_MeshDeformer</a>* meshdeformer = <span class="keyword">new</span> <a class="code" href="../../d2/dc5/classBL__MeshDeformer.html">BL_MeshDeformer</a>(
<a name="l01197"></a>01197                     newobj, oldblendobj, mesh
<a name="l01198"></a>01198                 );
<a name="l01199"></a>01199                 newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a984ec33f21d152789887b15e93c752ce">SetDeformer</a>(meshdeformer);
<a name="l01200"></a>01200             }
<a name="l01201"></a>01201 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01202"></a>01202 <span class="preprocessor"></span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bHasSoftBody)
<a name="l01203"></a>01203             {
<a name="l01204"></a>01204                 <a class="code" href="../../d6/d77/classKX__SoftBodyDeformer.html">KX_SoftBodyDeformer</a> *softdeformer = <span class="keyword">new</span> <a class="code" href="../../d6/d77/classKX__SoftBodyDeformer.html">KX_SoftBodyDeformer</a>(mesh, newobj);
<a name="l01205"></a>01205                 newobj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a984ec33f21d152789887b15e93c752ce">SetDeformer</a>(softdeformer);
<a name="l01206"></a>01206             }
<a name="l01207"></a>01207 <span class="preprocessor">#endif</span>
<a name="l01208"></a>01208 <span class="preprocessor"></span>
<a name="l01209"></a>01209             <span class="comment">// release parent reference if its not being used </span>
<a name="l01210"></a>01210             <span class="keywordflow">if</span> ( releaseParent &amp;&amp; parentobj)
<a name="l01211"></a>01211                 parentobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01212"></a>01212         }
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a1a018532e6f4b42433f05a130d4c2f6a">AddMeshUser</a>();
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01219"></a>01219 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (use_phys) { <span class="comment">/* update the new assigned mesh with the physics mesh */</span>
<a name="l01220"></a>01220         KX_ReInstanceBulletShapeFromMesh(gameobj, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, use_gfx?<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>:mesh);
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222 <span class="preprocessor">#endif</span>
<a name="l01223"></a>01223 <span class="preprocessor"></span>}
<a name="l01224"></a>01224 
<a name="l01225"></a>01225 <span class="comment">/* Font Object routines */</span>
<a name="l01226"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a45cc2dbf396acb1d4149fed45d2d8cbc">01226</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a45cc2dbf396acb1d4149fed45d2d8cbc">KX_Scene::AddFont</a>(<a class="code" href="../../d1/d47/classKX__FontObject.html">KX_FontObject</a>* font)
<a name="l01227"></a>01227 {
<a name="l01228"></a>01228     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/da3/classKX__Scene.html#a34bdfe75be9797f73bd836ea6957a645">FindFont</a>(font))
<a name="l01229"></a>01229         <a class="code" href="../../d2/da3/classKX__Scene.html#af2472d5fc466a80650613900067fd99f">m_fonts</a>.push_back(font);
<a name="l01230"></a>01230 }
<a name="l01231"></a>01231 
<a name="l01232"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a34bdfe75be9797f73bd836ea6957a645">01232</a> <a class="code" href="../../d1/d47/classKX__FontObject.html">KX_FontObject</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a34bdfe75be9797f73bd836ea6957a645">KX_Scene::FindFont</a>(<a class="code" href="../../d1/d47/classKX__FontObject.html">KX_FontObject</a>* font)
<a name="l01233"></a>01233 {
<a name="l01234"></a>01234     list&lt;KX_FontObject*&gt;::iterator it = <a class="code" href="../../d2/da3/classKX__Scene.html#af2472d5fc466a80650613900067fd99f">m_fonts</a>.begin();
<a name="l01235"></a>01235 
<a name="l01236"></a>01236     <span class="keywordflow">while</span> ( (it != <a class="code" href="../../d2/da3/classKX__Scene.html#af2472d5fc466a80650613900067fd99f">m_fonts</a>.end()) 
<a name="l01237"></a>01237             &amp;&amp; ((*it) != font) ) {
<a name="l01238"></a>01238       ++it;
<a name="l01239"></a>01239     }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241     <span class="keywordflow">return</span> ((it == <a class="code" href="../../d2/da3/classKX__Scene.html#af2472d5fc466a80650613900067fd99f">m_fonts</a>.end()) ? <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : (*it));
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 <span class="comment">/* Camera Object routines */</span>
<a name="l01246"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aedab66b0e7dc8c92034493e0161d336e">01246</a> <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#aedab66b0e7dc8c92034493e0161d336e">KX_Scene::FindCamera</a>(<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam)
<a name="l01247"></a>01247 {
<a name="l01248"></a>01248     list&lt;KX_Camera*&gt;::iterator it = <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.begin();
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     <span class="keywordflow">while</span> ( (it != <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.end())
<a name="l01251"></a>01251             &amp;&amp; ((*it) != cam) )
<a name="l01252"></a>01252     {
<a name="l01253"></a>01253         it++;
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256     <span class="keywordflow">return</span> ((it == <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.end()) ? <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : (*it));
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 
<a name="l01260"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a9abcdcdca15bc0b43d1dfa497278858d">01260</a> <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#aedab66b0e7dc8c92034493e0161d336e">KX_Scene::FindCamera</a>(<a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; name)
<a name="l01261"></a>01261 {
<a name="l01262"></a>01262     list&lt;KX_Camera*&gt;::iterator it = <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.begin();
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <span class="keywordflow">while</span> ( (it != <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.end())
<a name="l01265"></a>01265             &amp;&amp; ((*it)-&gt;GetName() != name) )
<a name="l01266"></a>01266     {
<a name="l01267"></a>01267         it++;
<a name="l01268"></a>01268     }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270     <span class="keywordflow">return</span> ((it == <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.end()) ? <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : (*it));
<a name="l01271"></a>01271 }
<a name="l01272"></a>01272 
<a name="l01273"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aaee2b18c7468e717b0536dc6449857d0">01273</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aaee2b18c7468e717b0536dc6449857d0">KX_Scene::AddCamera</a>(<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam)
<a name="l01274"></a>01274 {
<a name="l01275"></a>01275     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/da3/classKX__Scene.html#aedab66b0e7dc8c92034493e0161d336e">FindCamera</a>(cam))
<a name="l01276"></a>01276         <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.push_back(cam);
<a name="l01277"></a>01277 }
<a name="l01278"></a>01278 
<a name="l01279"></a>01279 
<a name="l01280"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a8127f5823a26b8f1c87db68908088826">01280</a> <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a8127f5823a26b8f1c87db68908088826">KX_Scene::GetActiveCamera</a>()
<a name="l01281"></a>01281 {   
<a name="l01282"></a>01282     <span class="comment">// NULL if not defined</span>
<a name="l01283"></a>01283     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ada20662a220ce96c5cf62631db89a8b3">m_active_camera</a>;
<a name="l01284"></a>01284 }
<a name="l01285"></a>01285 
<a name="l01286"></a>01286 
<a name="l01287"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a301c93aa375258c3b8972a5405d2cd9d">01287</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a301c93aa375258c3b8972a5405d2cd9d">KX_Scene::SetActiveCamera</a>(<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam)
<a name="l01288"></a>01288 {
<a name="l01289"></a>01289     <span class="comment">// only set if the cam is in the active list? Or add it otherwise?</span>
<a name="l01290"></a>01290     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/da3/classKX__Scene.html#aedab66b0e7dc8c92034493e0161d336e">FindCamera</a>(cam)) {
<a name="l01291"></a>01291         <a class="code" href="../../d2/da3/classKX__Scene.html#aaee2b18c7468e717b0536dc6449857d0">AddCamera</a>(cam);
<a name="l01292"></a>01292         <span class="keywordflow">if</span> (cam) std::cout &lt;&lt; <span class="stringliteral">&quot;Added cam &quot;</span> &lt;&lt; cam-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a268fb3bcc390cd18830e91113693eb40">GetName</a>() &lt;&lt; std::endl;
<a name="l01293"></a>01293     } 
<a name="l01294"></a>01294 
<a name="l01295"></a>01295     <a class="code" href="../../d2/da3/classKX__Scene.html#ada20662a220ce96c5cf62631db89a8b3">m_active_camera</a> = cam;
<a name="l01296"></a>01296 }
<a name="l01297"></a>01297 
<a name="l01298"></a><a class="code" href="../../d2/da3/classKX__Scene.html#acef8bbdb3fae488d277259651c270c3e">01298</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#acef8bbdb3fae488d277259651c270c3e">KX_Scene::SetCameraOnTop</a>(<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam)
<a name="l01299"></a>01299 {
<a name="l01300"></a>01300     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/da3/classKX__Scene.html#aedab66b0e7dc8c92034493e0161d336e">FindCamera</a>(cam)) {
<a name="l01301"></a>01301         <span class="comment">// adding is always done at the back, so that&#39;s all that needs to be done</span>
<a name="l01302"></a>01302         <a class="code" href="../../d2/da3/classKX__Scene.html#aaee2b18c7468e717b0536dc6449857d0">AddCamera</a>(cam);
<a name="l01303"></a>01303         <span class="keywordflow">if</span> (cam) std::cout &lt;&lt; <span class="stringliteral">&quot;Added cam &quot;</span> &lt;&lt; cam-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a268fb3bcc390cd18830e91113693eb40">GetName</a>() &lt;&lt; std::endl;
<a name="l01304"></a>01304     } <span class="keywordflow">else</span> {
<a name="l01305"></a>01305         <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.remove(cam);
<a name="l01306"></a>01306         <a class="code" href="../../d2/da3/classKX__Scene.html#a9133ef6c8a1f7cd394c335cce6a30a1e">m_cameras</a>.push_back(cam);
<a name="l01307"></a>01307     }
<a name="l01308"></a>01308 }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310 
<a name="l01311"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ab7a3b37660796d392e254f00ad048513">01311</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ab7a3b37660796d392e254f00ad048513">KX_Scene::UpdateMeshTransformations</a>()
<a name="l01312"></a>01312 {
<a name="l01313"></a>01313     <span class="comment">// do this incrementally in the future</span>
<a name="l01314"></a>01314     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01315"></a>01315     {
<a name="l01316"></a>01316         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)<a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l01317"></a>01317         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8557640aa39c9a672ecefe6ea69c0fbb">GetOpenGLMatrix</a>();
<a name="l01318"></a>01318     }
<a name="l01319"></a>01319 }
<a name="l01320"></a>01320 
<a name="l01321"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">01321</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">KX_Scene::MarkVisible</a>(<a class="code" href="../../dd/d23/classSG__Tree.html">SG_Tree</a> *node, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty, <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam, <span class="keywordtype">int</span> layer)
<a name="l01322"></a>01322 {
<a name="l01323"></a>01323     <span class="keywordtype">int</span> <a class="code" href="../../dc/de7/rayobject__vbvh_8cpp.html#ae47a935fc48f1b53ebf1d7bab772119d">intersect</a> = <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da3da8b8b2c821c493417a8a3e26a00a57">KX_Camera::INTERSECT</a>;
<a name="l01324"></a>01324     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *gameobj = node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#ac66a5f9847f92dacc8e737b26ca26f13">Client</a>()?(<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#ac66a5f9847f92dacc8e737b26ca26f13">Client</a>()-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#a5d43f7a1fb6fde5b37fa17b639095af1">GetSGClientObject</a>():<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01325"></a>01325     <span class="keywordtype">bool</span> visible = (gameobj &amp;&amp; gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#aaeabe9e8554e43eb8d62fa25d3808bc3">GetVisible</a>() &amp;&amp; (!layer || (gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>() &amp; layer)));
<a name="l01326"></a>01326     <span class="keywordtype">bool</span> dotest = visible || node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#aa363ef3f8176af3e1805fc1e3bcce584">Left</a>() || node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a902aec6be85c7579e21cc172814e29a2">Right</a>();
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="comment">/* If the camera is inside the box, assume intersect. */</span>
<a name="l01329"></a>01329     <span class="keywordflow">if</span> (dotest &amp;&amp; !node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#ac83d2ec61964d03f52041f1f2bb296dc">inside</a>( cam-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>()))
<a name="l01330"></a>01330     {
<a name="l01331"></a>01331         <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> radius = node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a2b028cd551f8ef0ffec5b9c5bb94339c">Radius</a>();
<a name="l01332"></a>01332         <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> center = node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a9783fd23bbb13b5b9c17ec104efaa007">Center</a>();
<a name="l01333"></a>01333         
<a name="l01334"></a>01334         intersect =  cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a0146a781c151f5d0a93195a0e3bd37e4">SphereInsideFrustum</a>(center, radius); 
<a name="l01335"></a>01335         
<a name="l01336"></a>01336         <span class="keywordflow">if</span> (intersect == <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da3da8b8b2c821c493417a8a3e26a00a57">KX_Camera::INTERSECT</a>)
<a name="l01337"></a>01337         {
<a name="l01338"></a>01338             <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> box[8];
<a name="l01339"></a>01339             node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a46c9ff98a1e8ede49652db13e5cbf630">get</a>(box);
<a name="l01340"></a>01340             intersect = cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#af05f5f156665a980f7ba827569c181b9">BoxInsideFrustum</a>(box);
<a name="l01341"></a>01341         }
<a name="l01342"></a>01342     }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344     <span class="keywordflow">switch</span> (intersect)
<a name="l01345"></a>01345     {
<a name="l01346"></a>01346         <span class="keywordflow">case</span> <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da0b551c2faef81e8e872e72e4a3971bb0">KX_Camera::OUTSIDE</a>:
<a name="l01347"></a>01347             <a class="code" href="../../d2/da3/classKX__Scene.html#a86fa00ff6431cf6a16f97e9e005aafb0">MarkSubTreeVisible</a>(node, rasty, <span class="keyword">false</span>, cam);
<a name="l01348"></a>01348             <span class="keywordflow">break</span>;
<a name="l01349"></a>01349         <span class="keywordflow">case</span> <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da3da8b8b2c821c493417a8a3e26a00a57">KX_Camera::INTERSECT</a>:
<a name="l01350"></a>01350             <span class="keywordflow">if</span> (gameobj)
<a name="l01351"></a>01351                 <a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">MarkVisible</a>(rasty, gameobj, cam, layer);
<a name="l01352"></a>01352             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#aa363ef3f8176af3e1805fc1e3bcce584">Left</a>())
<a name="l01353"></a>01353                 <a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">MarkVisible</a>(node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#aa363ef3f8176af3e1805fc1e3bcce584">Left</a>(), rasty, cam, layer);
<a name="l01354"></a>01354             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a902aec6be85c7579e21cc172814e29a2">Right</a>())
<a name="l01355"></a>01355                 <a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">MarkVisible</a>(node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a902aec6be85c7579e21cc172814e29a2">Right</a>(), rasty, cam, layer);
<a name="l01356"></a>01356             <span class="keywordflow">break</span>;
<a name="l01357"></a>01357         <span class="keywordflow">case</span> <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da813b2d8a38b5b15270ac30367a58328a">KX_Camera::INSIDE</a>:
<a name="l01358"></a>01358             <a class="code" href="../../d2/da3/classKX__Scene.html#a86fa00ff6431cf6a16f97e9e005aafb0">MarkSubTreeVisible</a>(node, rasty, <span class="keyword">true</span>, cam, layer);
<a name="l01359"></a>01359             <span class="keywordflow">break</span>;
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01363"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a86fa00ff6431cf6a16f97e9e005aafb0">01363</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a86fa00ff6431cf6a16f97e9e005aafb0">KX_Scene::MarkSubTreeVisible</a>(<a class="code" href="../../dd/d23/classSG__Tree.html">SG_Tree</a> *node, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty, <span class="keywordtype">bool</span> visible, <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam, <span class="keywordtype">int</span> layer)
<a name="l01364"></a>01364 {
<a name="l01365"></a>01365     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#ac66a5f9847f92dacc8e737b26ca26f13">Client</a>())
<a name="l01366"></a>01366     {
<a name="l01367"></a>01367         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#ac66a5f9847f92dacc8e737b26ca26f13">Client</a>()-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#a5d43f7a1fb6fde5b37fa17b639095af1">GetSGClientObject</a>();
<a name="l01368"></a>01368         <span class="keywordflow">if</span> (gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#aaeabe9e8554e43eb8d62fa25d3808bc3">GetVisible</a>())
<a name="l01369"></a>01369         {
<a name="l01370"></a>01370             <span class="keywordflow">if</span> (visible)
<a name="l01371"></a>01371             {
<a name="l01372"></a>01372                 <span class="keywordtype">int</span> nummeshes = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0380469d233ad08592b6a49819db066d">GetMeshCount</a>();
<a name="l01373"></a>01373                 
<a name="l01374"></a>01374                 <span class="comment">// this adds the vertices to the display list</span>
<a name="l01375"></a>01375                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0;m&lt;nummeshes;m++)
<a name="l01376"></a>01376                     (gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(m))-&gt;SchedulePolygons(rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>());
<a name="l01377"></a>01377             }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379             gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac49bc0c98a38eb380249d8b743efd5d5">SetCulled</a>(!visible);
<a name="l01380"></a>01380             gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a79d8df09113d6a4bf14420b92503f0f3">UpdateBuckets</a>(<span class="keyword">false</span>);
<a name="l01381"></a>01381         }
<a name="l01382"></a>01382     }
<a name="l01383"></a>01383     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#aa363ef3f8176af3e1805fc1e3bcce584">Left</a>())
<a name="l01384"></a>01384         <a class="code" href="../../d2/da3/classKX__Scene.html#a86fa00ff6431cf6a16f97e9e005aafb0">MarkSubTreeVisible</a>(node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#aa363ef3f8176af3e1805fc1e3bcce584">Left</a>(), rasty, visible, cam, layer);
<a name="l01385"></a>01385     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a902aec6be85c7579e21cc172814e29a2">Right</a>())
<a name="l01386"></a>01386         <a class="code" href="../../d2/da3/classKX__Scene.html#a86fa00ff6431cf6a16f97e9e005aafb0">MarkSubTreeVisible</a>(node-&gt;<a class="code" href="../../dd/d23/classSG__Tree.html#a902aec6be85c7579e21cc172814e29a2">Right</a>(), rasty, visible, cam, layer);
<a name="l01387"></a>01387 }
<a name="l01388"></a>01388 
<a name="l01389"></a><a class="code" href="../../d2/da3/classKX__Scene.html#af2e8474658f998ef65c780f49c781921">01389</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">KX_Scene::MarkVisible</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty, <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj,<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>*  cam,<span class="keywordtype">int</span> layer)
<a name="l01390"></a>01390 {
<a name="l01391"></a>01391     <span class="comment">// User (Python/Actuator) has forced object invisible...</span>
<a name="l01392"></a>01392     <span class="keywordflow">if</span> (!gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>() || !gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#aaeabe9e8554e43eb8d62fa25d3808bc3">GetVisible</a>())
<a name="l01393"></a>01393         <span class="keywordflow">return</span>;
<a name="l01394"></a>01394     
<a name="l01395"></a>01395     <span class="comment">// Shadow lamp layers</span>
<a name="l01396"></a>01396     <span class="keywordflow">if</span> (layer &amp;&amp; !(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>() &amp; layer)) {
<a name="l01397"></a>01397         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac49bc0c98a38eb380249d8b743efd5d5">SetCulled</a>(<span class="keyword">true</span>);
<a name="l01398"></a>01398         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a79d8df09113d6a4bf14420b92503f0f3">UpdateBuckets</a>(<span class="keyword">false</span>);
<a name="l01399"></a>01399         <span class="keywordflow">return</span>;
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402     <span class="comment">// If Frustum culling is off, the object is always visible.</span>
<a name="l01403"></a>01403     <span class="keywordtype">bool</span> vis = !cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#aad00f159111f75f29331aac957a6e1f6">GetFrustumCulling</a>();
<a name="l01404"></a>01404     
<a name="l01405"></a>01405     <span class="comment">// If the camera is inside this node, then the object is visible.</span>
<a name="l01406"></a>01406     <span class="keywordflow">if</span> (!vis)
<a name="l01407"></a>01407     {
<a name="l01408"></a>01408         vis = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a18c9d7d808370f7fd090a6ab369a45f8">inside</a>( cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#ac497695377486f951e554fa8c3f0d6cd">GetCameraLocation</a>() );
<a name="l01409"></a>01409     }
<a name="l01410"></a>01410         
<a name="l01411"></a>01411     <span class="comment">// Test the object&#39;s bound sphere against the view frustum.</span>
<a name="l01412"></a>01412     <span class="keywordflow">if</span> (!vis)
<a name="l01413"></a>01413     {
<a name="l01414"></a>01414         <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> scale = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a3078d7872c2ae7a194546c96b09ff301">GetWorldScaling</a>();
<a name="l01415"></a>01415         <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> radius = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(scale[scale.<a class="code" href="../../d6/d9d/classMT__Vector3.html#a1659c39bc81b4db5907f7e3aec302d8b">closestAxis</a>()] * gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a88a6b46222babe1b0738f52f51cc1a9d">Radius</a>());
<a name="l01416"></a>01416         <span class="keywordflow">switch</span> (cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a0146a781c151f5d0a93195a0e3bd37e4">SphereInsideFrustum</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>(), radius))
<a name="l01417"></a>01417         {
<a name="l01418"></a>01418             <span class="keywordflow">case</span> <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da813b2d8a38b5b15270ac30367a58328a">KX_Camera::INSIDE</a>:
<a name="l01419"></a>01419                 vis = <span class="keyword">true</span>;
<a name="l01420"></a>01420                 <span class="keywordflow">break</span>;
<a name="l01421"></a>01421             <span class="keywordflow">case</span> <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da0b551c2faef81e8e872e72e4a3971bb0">KX_Camera::OUTSIDE</a>:
<a name="l01422"></a>01422                 vis = <span class="keyword">false</span>;
<a name="l01423"></a>01423                 <span class="keywordflow">break</span>;
<a name="l01424"></a>01424             <span class="keywordflow">case</span> <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da3da8b8b2c821c493417a8a3e26a00a57">KX_Camera::INTERSECT</a>:
<a name="l01425"></a>01425                 <span class="comment">// Test the object&#39;s bound box against the view frustum.</span>
<a name="l01426"></a>01426                 <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> box[8];
<a name="l01427"></a>01427                 gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a3f66ae9c242c5d11479f00bd1868bc78">getBBox</a>(box); 
<a name="l01428"></a>01428                 vis = cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#af05f5f156665a980f7ba827569c181b9">BoxInsideFrustum</a>(box) != <a class="code" href="../../dc/d6b/classKX__Camera.html#a826239ba2ab8f9d9ab2ca8cad79a047da0b551c2faef81e8e872e72e4a3971bb0">KX_Camera::OUTSIDE</a>;
<a name="l01429"></a>01429                 <span class="keywordflow">break</span>;
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431     }
<a name="l01432"></a>01432     
<a name="l01433"></a>01433     <span class="keywordflow">if</span> (vis)
<a name="l01434"></a>01434     {
<a name="l01435"></a>01435         <span class="keywordtype">int</span> nummeshes = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0380469d233ad08592b6a49819db066d">GetMeshCount</a>();
<a name="l01436"></a>01436         
<a name="l01437"></a>01437         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0;m&lt;nummeshes;m++)
<a name="l01438"></a>01438         {
<a name="l01439"></a>01439             <span class="comment">// this adds the vertices to the display list</span>
<a name="l01440"></a>01440             (gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(m))-&gt;SchedulePolygons(rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>());
<a name="l01441"></a>01441         }
<a name="l01442"></a>01442         <span class="comment">// Visibility/ non-visibility are marked</span>
<a name="l01443"></a>01443         <span class="comment">// elsewhere now.</span>
<a name="l01444"></a>01444         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac49bc0c98a38eb380249d8b743efd5d5">SetCulled</a>(<span class="keyword">false</span>);
<a name="l01445"></a>01445         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a79d8df09113d6a4bf14420b92503f0f3">UpdateBuckets</a>(<span class="keyword">false</span>);
<a name="l01446"></a>01446     } <span class="keywordflow">else</span> {
<a name="l01447"></a>01447         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac49bc0c98a38eb380249d8b743efd5d5">SetCulled</a>(<span class="keyword">true</span>);
<a name="l01448"></a>01448         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a79d8df09113d6a4bf14420b92503f0f3">UpdateBuckets</a>(<span class="keyword">false</span>);
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 }
<a name="l01451"></a>01451 
<a name="l01452"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ad2c78a9e7c317ac8ce8018364cc5c59e">01452</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ad2c78a9e7c317ac8ce8018364cc5c59e">KX_Scene::PhysicsCullingCallback</a>(<a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html">KX_ClientObjectInfo</a>* objectInfo, <span class="keywordtype">void</span>* cullingInfo)
<a name="l01453"></a>01453 {
<a name="l01454"></a>01454     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = objectInfo-&gt;<a class="code" href="../../d3/d67/structKX__ClientObjectInfo.html#a4e09a739c17776b2ae907664321ba114">m_gameobject</a>;
<a name="l01455"></a>01455     <span class="keywordflow">if</span> (!gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#aaeabe9e8554e43eb8d62fa25d3808bc3">GetVisible</a>())
<a name="l01456"></a>01456         <span class="comment">// ideally, invisible objects should be removed from the culling tree temporarily</span>
<a name="l01457"></a>01457         <span class="keywordflow">return</span>;
<a name="l01458"></a>01458     <span class="keywordflow">if</span> (((CullingInfo*)cullingInfo)-&gt;m_layer &amp;&amp; !(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ab7670c9020e12b589c96374262e769eb">GetLayer</a>() &amp; ((CullingInfo*)cullingInfo)-&gt;m_layer))
<a name="l01459"></a>01459         <span class="comment">// used for shadow: object is not in shadow layer</span>
<a name="l01460"></a>01460         <span class="keywordflow">return</span>;
<a name="l01461"></a>01461 
<a name="l01462"></a>01462     <span class="comment">// make object visible</span>
<a name="l01463"></a>01463     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac49bc0c98a38eb380249d8b743efd5d5">SetCulled</a>(<span class="keyword">false</span>);
<a name="l01464"></a>01464     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a79d8df09113d6a4bf14420b92503f0f3">UpdateBuckets</a>(<span class="keyword">false</span>);
<a name="l01465"></a>01465 }
<a name="l01466"></a>01466 
<a name="l01467"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a900a6e3a5557be098988d17da66b0d99">01467</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a900a6e3a5557be098988d17da66b0d99">KX_Scene::CalculateVisibleMeshes</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty,<a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>* cam, <span class="keywordtype">int</span> layer)
<a name="l01468"></a>01468 {
<a name="l01469"></a>01469     <span class="keywordtype">bool</span> dbvt_culling = <span class="keyword">false</span>;
<a name="l01470"></a>01470     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a77ceb7fac5e693c1fd00ea2ae68a21d8">m_dbvt_culling</a>) 
<a name="l01471"></a>01471     {
<a name="l01472"></a>01472         <span class="comment">// test culling through Bullet</span>
<a name="l01473"></a>01473         <a class="code" href="../../d8/d22/structPHY____Vector4.html">PHY__Vector4</a> planes[6];
<a name="l01474"></a>01474         <span class="comment">// get the clip planes</span>
<a name="l01475"></a>01475         <a class="code" href="../../d2/dfc/classMT__Vector4.html">MT_Vector4</a>* cplanes = cam-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a5167c99228d12e5bd7b6bad1e8fe018f">GetNormalizedClipPlanes</a>();
<a name="l01476"></a>01476         <span class="comment">// and convert</span>
<a name="l01477"></a>01477         planes[0].<a class="code" href="../../d8/d22/structPHY____Vector4.html#a2e0d417785968e53da792d51a6287356">setValue</a>(cplanes[4].getValue());  <span class="comment">// near</span>
<a name="l01478"></a>01478         planes[1].<a class="code" href="../../d8/d22/structPHY____Vector4.html#a2e0d417785968e53da792d51a6287356">setValue</a>(cplanes[5].getValue());  <span class="comment">// far</span>
<a name="l01479"></a>01479         planes[2].<a class="code" href="../../d8/d22/structPHY____Vector4.html#a2e0d417785968e53da792d51a6287356">setValue</a>(cplanes[0].getValue());  <span class="comment">// left</span>
<a name="l01480"></a>01480         planes[3].<a class="code" href="../../d8/d22/structPHY____Vector4.html#a2e0d417785968e53da792d51a6287356">setValue</a>(cplanes[1].getValue());  <span class="comment">// right</span>
<a name="l01481"></a>01481         planes[4].<a class="code" href="../../d8/d22/structPHY____Vector4.html#a2e0d417785968e53da792d51a6287356">setValue</a>(cplanes[2].getValue());  <span class="comment">// top</span>
<a name="l01482"></a>01482         planes[5].<a class="code" href="../../d8/d22/structPHY____Vector4.html#a2e0d417785968e53da792d51a6287356">setValue</a>(cplanes[3].getValue());  <span class="comment">// bottom</span>
<a name="l01483"></a>01483         CullingInfo info(layer);
<a name="l01484"></a>01484         dbvt_culling = <a class="code" href="../../d2/da3/classKX__Scene.html#a25ffcbe89017ebb6c42eb457fac93583">m_physicsEnvironment</a>-&gt;<a class="code" href="../../d4/db0/classPHY__IPhysicsEnvironment.html#a740a60dfce43ccbbf53e242855f20d53">cullingTest</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#ad2c78a9e7c317ac8ce8018364cc5c59e">PhysicsCullingCallback</a>,&amp;info,planes,5,<a class="code" href="../../d2/da3/classKX__Scene.html#a90cc06d39b7ef3db3baa4339e1a4d5a2">m_dbvt_occlusion_res</a>);
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486     <span class="keywordflow">if</span> (!dbvt_culling) {
<a name="l01487"></a>01487         <span class="comment">// the physics engine couldn&#39;t help us, do it the hard way</span>
<a name="l01488"></a>01488         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01489"></a>01489         {
<a name="l01490"></a>01490             <a class="code" href="../../d2/da3/classKX__Scene.html#aec749764a29042c80ed50262ed2ddaf9">MarkVisible</a>(rasty, static_cast&lt;KX_GameObject*&gt;(<a class="code" href="../../d2/da3/classKX__Scene.html#a1d41babfc4a8c3a06c137aedbe23dab5">m_objectlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)), cam, layer);
<a name="l01491"></a>01491         }
<a name="l01492"></a>01492     }
<a name="l01493"></a>01493 }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495 <span class="comment">// logic stuff</span>
<a name="l01496"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a3000f2f93875789b02310ca7adfb9859">01496</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a3000f2f93875789b02310ca7adfb9859">KX_Scene::LogicBeginFrame</a>(<span class="keywordtype">double</span> curtime)
<a name="l01497"></a>01497 {
<a name="l01498"></a>01498     <span class="comment">// have a look at temp objects ...</span>
<a name="l01499"></a>01499     <span class="keywordtype">int</span> lastobj = <a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>() - 1;
<a name="l01500"></a>01500     
<a name="l01501"></a>01501     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = lastobj; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--)
<a name="l01502"></a>01502     {
<a name="l01503"></a>01503         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* objval = <a class="code" href="../../d2/da3/classKX__Scene.html#a807f49ef6169408f7d85fd70495a4c94">m_tempObjectList</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l01504"></a>01504         <a class="code" href="../../d0/d4c/classCFloatValue.html">CFloatValue</a>* propval = (<a class="code" href="../../d0/d4c/classCFloatValue.html">CFloatValue</a>*) objval-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<span class="stringliteral">&quot;::timebomb&quot;</span>);
<a name="l01505"></a>01505         
<a name="l01506"></a>01506         <span class="keywordflow">if</span> (propval)
<a name="l01507"></a>01507         {
<a name="l01508"></a>01508             <span class="keywordtype">float</span> timeleft = propval-&gt;<a class="code" href="../../d0/d4c/classCFloatValue.html#afb1a27b6fa2fdc9d0a2def468fdaffe3">GetNumber</a>() - 1.0/<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#aae3401cc9c19fd8183258729a3326979">KX_KetsjiEngine::GetTicRate</a>();
<a name="l01509"></a>01509             
<a name="l01510"></a>01510             <span class="keywordflow">if</span> (timeleft &gt; 0)
<a name="l01511"></a>01511             {
<a name="l01512"></a>01512                 propval-&gt;<a class="code" href="../../d0/d4c/classCFloatValue.html#a94615c8be017aced354f68b983a7b518">SetFloat</a>(timeleft);
<a name="l01513"></a>01513             }
<a name="l01514"></a>01514             <span class="keywordflow">else</span>
<a name="l01515"></a>01515             {
<a name="l01516"></a>01516                 <a class="code" href="../../d2/da3/classKX__Scene.html#a5b5f17f9ad24ad20d6770447b8368a3f">DelayedRemoveObject</a>(objval);
<a name="l01517"></a>01517                 <span class="comment">// remove obj</span>
<a name="l01518"></a>01518             }
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520         <span class="keywordflow">else</span>
<a name="l01521"></a>01521         {
<a name="l01522"></a>01522             <span class="comment">// all object is the tempObjectList should have a clock</span>
<a name="l01523"></a>01523         }
<a name="l01524"></a>01524     }
<a name="l01525"></a>01525     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a628cc2c1413f48a7bb6c8fadf71a6327">BeginFrame</a>(curtime, 1.0/<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#aae3401cc9c19fd8183258729a3326979">KX_KetsjiEngine::GetTicRate</a>());
<a name="l01526"></a>01526 }
<a name="l01527"></a>01527 
<a name="l01528"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a4fceb73cf9935594261572c31357bae3">01528</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a4fceb73cf9935594261572c31357bae3">KX_Scene::AddAnimatedObject</a>(<a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530     gameobj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#afbffee1cbf1ba190723f69445a2471ca">AddRef</a>();
<a name="l01531"></a>01531     <a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>(gameobj);
<a name="l01532"></a>01532 }
<a name="l01533"></a>01533 
<a name="l01534"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a75ae03479beddf0984b1c1047bb0478e">01534</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a75ae03479beddf0984b1c1047bb0478e">KX_Scene::RemoveAnimatedObject</a>(<a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* gameobj)
<a name="l01535"></a>01535 {
<a name="l01536"></a>01536     <a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a18acf9a41b6ed927d931143806bd1852">RemoveValue</a>(gameobj);
<a name="l01537"></a>01537 }
<a name="l01538"></a>01538 
<a name="l01539"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ad5f45210c2f8a349f9c4ab94e5346a6b">01539</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ad5f45210c2f8a349f9c4ab94e5346a6b">KX_Scene::UpdateAnimations</a>(<span class="keywordtype">double</span> curtime)
<a name="l01540"></a>01540 {
<a name="l01541"></a>01541     <span class="comment">// Update any animations</span>
<a name="l01542"></a>01542     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>(); ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01543"></a>01543         ((<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)<a class="code" href="../../d2/da3/classKX__Scene.html#a9298775df6ff46b03e9415bbee2df0ac">m_animatedlist</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>))-&gt;UpdateActionManager(curtime);
<a name="l01544"></a>01544 }
<a name="l01545"></a>01545 
<a name="l01546"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a01d68be4aa9dc043518f69c7970b5eb6">01546</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a01d68be4aa9dc043518f69c7970b5eb6">KX_Scene::LogicUpdateFrame</a>(<span class="keywordtype">double</span> curtime, <span class="keywordtype">bool</span> frame)
<a name="l01547"></a>01547 {
<a name="l01548"></a>01548     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a4223767dfb255ddaa2b3fe254ca3d64d">UpdateFrame</a>(curtime, frame);
<a name="l01549"></a>01549 }
<a name="l01550"></a>01550 
<a name="l01551"></a>01551 
<a name="l01552"></a>01552 
<a name="l01553"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ab8128c362d72e3da38ed751ce0ee569f">01553</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ab8128c362d72e3da38ed751ce0ee569f">KX_Scene::LogicEndFrame</a>()
<a name="l01554"></a>01554 {
<a name="l01555"></a>01555     <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a9572b78bc9a0220166ee4b856ff50fc3">EndFrame</a>();
<a name="l01556"></a>01556     <span class="keywordtype">int</span> numobj;
<a name="l01557"></a>01557 
<a name="l01558"></a>01558     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* obj;
<a name="l01559"></a>01559 
<a name="l01560"></a>01560     <span class="keywordflow">while</span> ((numobj = <a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>()) &gt; 0)
<a name="l01561"></a>01561     {
<a name="l01562"></a>01562         <span class="comment">// remove the object from this list to make sure we will not hit it again</span>
<a name="l01563"></a>01563         obj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)<a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(numobj-1);
<a name="l01564"></a>01564         <a class="code" href="../../d2/da3/classKX__Scene.html#a8bc433b621483ec76e17eedf1e81b69c">m_euthanasyobjects</a>-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a43f761baf3295d8d928315ada9093d88">Remove</a>(numobj-1);
<a name="l01565"></a>01565         obj-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l01566"></a>01566         <a class="code" href="../../d2/da3/classKX__Scene.html#af875d0f33688aaa8cea374d9a96dbcbe">RemoveObject</a>(obj);
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     <span class="comment">//prepare obstacle simulation for new frame</span>
<a name="l01570"></a>01570     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a>)
<a name="l01571"></a>01571         <a class="code" href="../../d2/da3/classKX__Scene.html#a867ac5d20bd2d757daebf824f84f1a25">m_obstacleSimulation</a>-&gt;<a class="code" href="../../d7/d8d/classKX__ObstacleSimulation.html#af36e511a4e04afe7b2919b410c5d8cd5">UpdateObstacles</a>();
<a name="l01572"></a>01572 }
<a name="l01573"></a>01573 
<a name="l01574"></a>01574 
<a name="l01575"></a>01575 
<a name="l01579"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aad1da210d503085e9af7297ecc82ade9">01579</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aad1da210d503085e9af7297ecc82ade9">KX_Scene::UpdateParents</a>(<span class="keywordtype">double</span> curtime)
<a name="l01580"></a>01580 {
<a name="l01581"></a>01581     <span class="comment">// we use the SG dynamic list</span>
<a name="l01582"></a>01582     <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a>* node;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584     <span class="keywordflow">while</span> ((node = <a class="code" href="../../d8/d3b/classSG__Node.html#acc9c9e40c07f1a857b83a6ee5be7191b">SG_Node::GetNextScheduled</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a77d42e8ca3af4dadbb276c2baeceb42e">m_sghead</a>)) != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01585"></a>01585     {
<a name="l01586"></a>01586         node-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a791ba43c770c33dc637bb61f93152745">UpdateWorldData</a>(curtime);
<a name="l01587"></a>01587     }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589     <span class="comment">//for (int i=0; i&lt;GetRootParentList()-&gt;GetCount(); i++)</span>
<a name="l01590"></a>01590     <span class="comment">//{</span>
<a name="l01591"></a>01591     <span class="comment">//  KX_GameObject* parentobj = (KX_GameObject*)GetRootParentList()-&gt;GetValue(i);</span>
<a name="l01592"></a>01592     <span class="comment">//  parentobj-&gt;NodeUpdateGS(curtime);</span>
<a name="l01593"></a>01593     <span class="comment">//}</span>
<a name="l01594"></a>01594 
<a name="l01595"></a>01595     <span class="comment">// the list must be empty here</span>
<a name="l01596"></a>01596     <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a77d42e8ca3af4dadbb276c2baeceb42e">m_sghead</a>.<a class="code" href="../../db/d57/classSG__DList.html#ae79023f982222bb6ea7b5715934deffb">Empty</a>());
<a name="l01597"></a>01597     <span class="comment">// some nodes may be ready for reschedule, move them to schedule list for next time</span>
<a name="l01598"></a>01598     <span class="keywordflow">while</span> ((node = <a class="code" href="../../d8/d3b/classSG__Node.html#a82394499fdfa41c92567caca60aacc5f">SG_Node::GetNextRescheduled</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a77d42e8ca3af4dadbb276c2baeceb42e">m_sghead</a>)) != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01599"></a>01599     {
<a name="l01600"></a>01600         node-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#ac51c125843101d2ecc366efe2ac756c5">Schedule</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a77d42e8ca3af4dadbb276c2baeceb42e">m_sghead</a>);
<a name="l01601"></a>01601     }
<a name="l01602"></a>01602 }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 
<a name="l01605"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a128d13556724e1951eeb3e32a1c5b679">01605</a> <a class="code" href="../../de/dc6/classRAS__MaterialBucket.html">RAS_MaterialBucket</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#a128d13556724e1951eeb3e32a1c5b679">KX_Scene::FindBucket</a>(<span class="keyword">class</span> <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a>* polymat, <span class="keywordtype">bool</span> &amp;bucketCreated)
<a name="l01606"></a>01606 {
<a name="l01607"></a>01607     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#acbacf5de2b0aaf01acbfd2b80514285e">m_bucketmanager</a>-&gt;<a class="code" href="../../df/d04/classRAS__BucketManager.html#a3752fc8e3c029c7593f9b6683c1a65e7">FindBucket</a>(polymat, bucketCreated);
<a name="l01608"></a>01608 }
<a name="l01609"></a>01609 
<a name="l01610"></a>01610 
<a name="l01611"></a>01611 
<a name="l01612"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a443cbcc3cd2fc6c7ac960fbef4bcae85">01612</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a443cbcc3cd2fc6c7ac960fbef4bcae85">KX_Scene::RenderBuckets</a>(<span class="keyword">const</span> <a class="code" href="../../d0/df9/classMT__Transform.html">MT_Transform</a> &amp; cameratransform,
<a name="l01613"></a>01613                              <span class="keyword">class</span> <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty,
<a name="l01614"></a>01614                              <span class="keyword">class</span> <a class="code" href="../../d0/d53/classRAS__IRenderTools.html">RAS_IRenderTools</a>* rendertools)
<a name="l01615"></a>01615 {
<a name="l01616"></a>01616     <a class="code" href="../../d2/da3/classKX__Scene.html#acbacf5de2b0aaf01acbfd2b80514285e">m_bucketmanager</a>-&gt;<a class="code" href="../../df/d04/classRAS__BucketManager.html#a0da5f399706f5a119ca062186c4a0555">Renderbuckets</a>(cameratransform,rasty,rendertools);
<a name="l01617"></a>01617     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#acac68937ea1fdde98a4d98701d03636c">KX_BlenderMaterial::EndFrame</a>();
<a name="l01618"></a>01618 }
<a name="l01619"></a>01619 
<a name="l01620"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a1c281f323667052085e56d3f7aafc6b3">01620</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a1c281f323667052085e56d3f7aafc6b3">KX_Scene::UpdateObjectActivity</a>(<span class="keywordtype">void</span>) 
<a name="l01621"></a>01621 {
<a name="l01622"></a>01622     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#ad72caf11978c9d0531601714183195e0">m_activity_culling</a>) {
<a name="l01623"></a>01623         <span class="comment">/* determine the activity criterium and set objects accordingly */</span>
<a name="l01624"></a>01624         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;
<a name="l01625"></a>01625         
<a name="l01626"></a>01626         <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> camloc = <a class="code" href="../../d2/da3/classKX__Scene.html#a8127f5823a26b8f1c87db68908088826">GetActiveCamera</a>()-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>(); <span class="comment">//GetCameraLocation();</span>
<a name="l01627"></a>01627         
<a name="l01628"></a>01628         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>();i++)
<a name="l01629"></a>01629         {
<a name="l01630"></a>01630             <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* ob = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*) <a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(i);
<a name="l01631"></a>01631             
<a name="l01632"></a>01632             <span class="keywordflow">if</span> (!ob-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8d7167bfea75144435b4e119d3d6eb4f">GetIgnoreActivityCulling</a>()) {
<a name="l01633"></a>01633                 <span class="comment">/* Simple test: more than 10 away from the camera, count</span>
<a name="l01634"></a>01634 <span class="comment">                 * Manhattan distance. */</span>
<a name="l01635"></a>01635                 <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> obpos = ob-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>();
<a name="l01636"></a>01636                 
<a name="l01637"></a>01637                 <span class="keywordflow">if</span> ( (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(camloc[0] - obpos[0]) &gt; <a class="code" href="../../d2/da3/classKX__Scene.html#a08d6f2c33d58667759b9216c108d254f">m_activity_box_radius</a>)
<a name="l01638"></a>01638                      || (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(camloc[1] - obpos[1]) &gt; <a class="code" href="../../d2/da3/classKX__Scene.html#a08d6f2c33d58667759b9216c108d254f">m_activity_box_radius</a>)
<a name="l01639"></a>01639                      || (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(camloc[2] - obpos[2]) &gt; <a class="code" href="../../d2/da3/classKX__Scene.html#a08d6f2c33d58667759b9216c108d254f">m_activity_box_radius</a>) )
<a name="l01640"></a>01640                 {           
<a name="l01641"></a>01641                     ob-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a2df7beba5df062f732b24d6b69a010b8">Suspend</a>();
<a name="l01642"></a>01642                 } <span class="keywordflow">else</span> {
<a name="l01643"></a>01643                     ob-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ae9254128296ba80bf66711883f96dba6">Resume</a>();
<a name="l01644"></a>01644                 }
<a name="l01645"></a>01645             }
<a name="l01646"></a>01646         }       
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648 }
<a name="l01649"></a>01649 
<a name="l01650"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a51d7618248cce477183bb6c5217e81bd">01650</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a51d7618248cce477183bb6c5217e81bd">KX_Scene::SetActivityCullingRadius</a>(<span class="keywordtype">float</span> f)
<a name="l01651"></a>01651 {
<a name="l01652"></a>01652     <span class="keywordflow">if</span> (f &lt; 0.5)
<a name="l01653"></a>01653         f = 0.5;
<a name="l01654"></a>01654     <a class="code" href="../../d2/da3/classKX__Scene.html#a08d6f2c33d58667759b9216c108d254f">m_activity_box_radius</a> = f;
<a name="l01655"></a>01655 }
<a name="l01656"></a>01656     
<a name="l01657"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ace954172aef17148001ee5af998d1346">01657</a> <a class="code" href="../../d4/d8b/classNG__NetworkDeviceInterface.html">NG_NetworkDeviceInterface</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#ace954172aef17148001ee5af998d1346">KX_Scene::GetNetworkDeviceInterface</a>()
<a name="l01658"></a>01658 {
<a name="l01659"></a>01659     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a22bfd57b3a9350c5e3dbc362211a70b9">m_networkDeviceInterface</a>;
<a name="l01660"></a>01660 }
<a name="l01661"></a>01661 
<a name="l01662"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ae847a7ae6d0f06cec6ce97abce89ac45">01662</a> <a class="code" href="../../d5/d50/classNG__NetworkScene.html">NG_NetworkScene</a>* <a class="code" href="../../d2/da3/classKX__Scene.html#ae847a7ae6d0f06cec6ce97abce89ac45">KX_Scene::GetNetworkScene</a>()
<a name="l01663"></a>01663 {
<a name="l01664"></a>01664     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#add0d70e61b74544c26013ef9106151af">m_networkScene</a>;
<a name="l01665"></a>01665 }
<a name="l01666"></a>01666 
<a name="l01667"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a19ff750cba3f3a7c98946826bc458951">01667</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a19ff750cba3f3a7c98946826bc458951">KX_Scene::SetNetworkDeviceInterface</a>(<a class="code" href="../../d4/d8b/classNG__NetworkDeviceInterface.html">NG_NetworkDeviceInterface</a>* newInterface)
<a name="l01668"></a>01668 {
<a name="l01669"></a>01669     <a class="code" href="../../d2/da3/classKX__Scene.html#a22bfd57b3a9350c5e3dbc362211a70b9">m_networkDeviceInterface</a> = newInterface;
<a name="l01670"></a>01670 }
<a name="l01671"></a>01671 
<a name="l01672"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aa90301ca8cab05f3b02a4540cc3875c8">01672</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aa90301ca8cab05f3b02a4540cc3875c8">KX_Scene::SetNetworkScene</a>(<a class="code" href="../../d5/d50/classNG__NetworkScene.html">NG_NetworkScene</a> *newScene)
<a name="l01673"></a>01673 {
<a name="l01674"></a>01674     <a class="code" href="../../d2/da3/classKX__Scene.html#add0d70e61b74544c26013ef9106151af">m_networkScene</a> = newScene;
<a name="l01675"></a>01675 }
<a name="l01676"></a>01676 
<a name="l01677"></a>01677 
<a name="l01678"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a7eb6f85118ceb26e60b23f77919c2e71">01678</a> <span class="keywordtype">void</span>    <a class="code" href="../../d2/da3/classKX__Scene.html#a7eb6f85118ceb26e60b23f77919c2e71">KX_Scene::SetGravity</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a>&amp; gravity)
<a name="l01679"></a>01679 {
<a name="l01680"></a>01680     <a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>()-&gt;<a class="code" href="../../d4/db0/classPHY__IPhysicsEnvironment.html#ad6d8f77ea39ac3e6b224797bc9e9683f">setGravity</a>(gravity[0],gravity[1],gravity[2]);
<a name="l01681"></a>01681 }
<a name="l01682"></a>01682 
<a name="l01683"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a60ed258cc80ecf20e3dae6a7f3cde078">01683</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a60ed258cc80ecf20e3dae6a7f3cde078">KX_Scene::SetSceneConverter</a>(<span class="keyword">class</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html">KX_BlenderSceneConverter</a>* sceneConverter)
<a name="l01684"></a>01684 {
<a name="l01685"></a>01685     <a class="code" href="../../d2/da3/classKX__Scene.html#a136771ca7c3a57a7f15140ba24e86e12">m_sceneConverter</a> = sceneConverter;
<a name="l01686"></a>01686 }
<a name="l01687"></a>01687 
<a name="l01688"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ac6eb1fbbe7dc93e98d1ca2b14ad5561e">01688</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ac6eb1fbbe7dc93e98d1ca2b14ad5561e">KX_Scene::SetPhysicsEnvironment</a>(<span class="keyword">class</span> <a class="code" href="../../d4/db0/classPHY__IPhysicsEnvironment.html">PHY_IPhysicsEnvironment</a>* physEnv)
<a name="l01689"></a>01689 {
<a name="l01690"></a>01690     <a class="code" href="../../d2/da3/classKX__Scene.html#a25ffcbe89017ebb6c42eb457fac93583">m_physicsEnvironment</a> = physEnv;
<a name="l01691"></a>01691     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#a25ffcbe89017ebb6c42eb457fac93583">m_physicsEnvironment</a>) {
<a name="l01692"></a>01692         <a class="code" href="../../d1/d3e/classKX__TouchEventManager.html">KX_TouchEventManager</a>* touchmgr = <span class="keyword">new</span> <a class="code" href="../../d1/d3e/classKX__TouchEventManager.html">KX_TouchEventManager</a>(<a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>, physEnv);
<a name="l01693"></a>01693         <a class="code" href="../../d2/da3/classKX__Scene.html#a489b5b41bc4a126ff84200d6dbd19c0a">m_logicmgr</a>-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a61e9b57ca8e80c1439a5d636cdd6faa6">RegisterEventManager</a>(touchmgr);
<a name="l01694"></a>01694     }
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696  
<a name="l01697"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a1b32395afd9493b625c6a546a8111aab">01697</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a1b32395afd9493b625c6a546a8111aab">KX_Scene::setSuspendedTime</a>(<span class="keywordtype">double</span> suspendedtime)
<a name="l01698"></a>01698 {
<a name="l01699"></a>01699     <a class="code" href="../../d2/da3/classKX__Scene.html#a530a20a733e67bb9a04a3c36e52f3092">m_suspendedtime</a> = suspendedtime;
<a name="l01700"></a>01700 }
<a name="l01701"></a><a class="code" href="../../d2/da3/classKX__Scene.html#acf10d677c55ca923265e403611d00a54">01701</a> <span class="keywordtype">double</span> <a class="code" href="../../d2/da3/classKX__Scene.html#acf10d677c55ca923265e403611d00a54">KX_Scene::getSuspendedTime</a>()
<a name="l01702"></a>01702 {
<a name="l01703"></a>01703     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a530a20a733e67bb9a04a3c36e52f3092">m_suspendedtime</a>;
<a name="l01704"></a>01704 }
<a name="l01705"></a><a class="code" href="../../d2/da3/classKX__Scene.html#ac38dc6c43b5f22c7f44714e1a5664cd1">01705</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#ac38dc6c43b5f22c7f44714e1a5664cd1">KX_Scene::setSuspendedDelta</a>(<span class="keywordtype">double</span> suspendeddelta)
<a name="l01706"></a>01706 {
<a name="l01707"></a>01707     <a class="code" href="../../d2/da3/classKX__Scene.html#a96fe5531316ecdfc58481628d3683e3a">m_suspendeddelta</a> = suspendeddelta;
<a name="l01708"></a>01708 }
<a name="l01709"></a><a class="code" href="../../d2/da3/classKX__Scene.html#abdd51d27d00a89c52141a4ceaf4f3926">01709</a> <span class="keywordtype">double</span> <a class="code" href="../../d2/da3/classKX__Scene.html#abdd51d27d00a89c52141a4ceaf4f3926">KX_Scene::getSuspendedDelta</a>()
<a name="l01710"></a>01710 {
<a name="l01711"></a>01711     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a96fe5531316ecdfc58481628d3683e3a">m_suspendeddelta</a>;
<a name="l01712"></a>01712 }
<a name="l01713"></a>01713 
<a name="l01714"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a35b8cb4fc82ef83e14e8f4e54330e876">01714</a> <span class="keywordtype">short</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a35b8cb4fc82ef83e14e8f4e54330e876">KX_Scene::GetAnimationFPS</a>()
<a name="l01715"></a>01715 {
<a name="l01716"></a>01716     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a4f9af3a58953b41cb7ab437052179f50">m_blenderScene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a071df993e13c05fc37e6f9a82c0679f5">frs_sec</a>;
<a name="l01717"></a>01717 }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01720"></a>01720 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/db9/KX__BulletPhysicsController_8h.html">KX_BulletPhysicsController.h</a>&quot;</span>
<a name="l01721"></a>01721 <span class="preprocessor">#endif</span>
<a name="l01722"></a>01722 <span class="preprocessor"></span>
<a name="l01723"></a><a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">01723</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">MergeScene_LogicBrick</a>(<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html">SCA_ILogicBrick</a>* brick, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *to)
<a name="l01724"></a>01724 {
<a name="l01725"></a>01725     <a class="code" href="../../db/d0f/classSCA__LogicManager.html">SCA_LogicManager</a> *logicmgr= to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>();
<a name="l01726"></a>01726 
<a name="l01727"></a>01727     brick-&gt;<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#ad05f36375dbf59284813335f5e25ac38">Replace_IScene</a>(to);
<a name="l01728"></a>01728     brick-&gt;<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a8e42db2bacd30ee0677318976d09a05f">Replace_NetworkScene</a>(to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ae847a7ae6d0f06cec6ce97abce89ac45">GetNetworkScene</a>());
<a name="l01729"></a>01729 
<a name="l01730"></a>01730     <a class="code" href="../../dc/d76/classSCA__ISensor.html">SCA_ISensor</a> *sensor=  <span class="keyword">dynamic_cast&lt;</span>class <a class="code" href="../../dc/d76/classSCA__ISensor.html">SCA_ISensor</a> *<span class="keyword">&gt;</span>(brick);
<a name="l01731"></a>01731     <span class="keywordflow">if</span> (sensor) {
<a name="l01732"></a>01732         sensor-&gt;<a class="code" href="../../dc/d76/classSCA__ISensor.html#a977a18b22bc474394788623352bf83ef">Replace_EventManager</a>(logicmgr);
<a name="l01733"></a>01733     }
<a name="l01734"></a>01734 
<a name="l01735"></a>01735     <span class="comment">/* near sensors have physics controllers */</span>
<a name="l01736"></a>01736 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01737"></a>01737 <span class="preprocessor"></span>    <a class="code" href="../../d2/d9e/classKX__TouchSensor.html">KX_TouchSensor</a> *touch_sensor = <span class="keyword">dynamic_cast&lt;</span>class <a class="code" href="../../d2/d9e/classKX__TouchSensor.html">KX_TouchSensor</a> *<span class="keyword">&gt;</span>(brick);
<a name="l01738"></a>01738     <span class="keywordflow">if</span> (touch_sensor) {
<a name="l01739"></a>01739         touch_sensor-&gt;<a class="code" href="../../d2/d9e/classKX__TouchSensor.html#ac2cbe8fe721c87c382acb0fc0738fe8c">GetPhysicsController</a>()-&gt;<a class="code" href="../../d5/d92/classPHY__IController.html#a6fcf2c7eeb11c8930f4277a3c6f5efa6">SetPhysicsEnvironment</a>(to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>());
<a name="l01740"></a>01740     }
<a name="l01741"></a>01741 <span class="preprocessor">#endif</span>
<a name="l01742"></a>01742 <span class="preprocessor"></span>}
<a name="l01743"></a>01743 
<a name="l01744"></a>01744 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01745"></a>01745 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/de0/CcdGraphicController_8h.html">CcdGraphicController.h</a>&quot;</span> <span class="comment">// XXX  ctrl-&gt;SetPhysicsEnvironment(to-&gt;GetPhysicsEnvironment());</span>
<a name="l01746"></a>01746 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d4a/CcdPhysicsEnvironment_8h.html">CcdPhysicsEnvironment.h</a>&quot;</span> <span class="comment">// XXX  ctrl-&gt;SetPhysicsEnvironment(to-&gt;GetPhysicsEnvironment());</span>
<a name="l01747"></a>01747 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db9/KX__BulletPhysicsController_8h.html">KX_BulletPhysicsController.h</a>&quot;</span>
<a name="l01748"></a>01748 <span class="preprocessor">#endif</span>
<a name="l01749"></a>01749 <span class="preprocessor"></span>
<a name="l01750"></a><a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a5c9b8bb7ecf29dbee524392ed32ded59">01750</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a5c9b8bb7ecf29dbee524392ed32ded59">MergeScene_GameObject</a>(<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *to, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *from)
<a name="l01751"></a>01751 {
<a name="l01752"></a>01752     {
<a name="l01753"></a>01753         <a class="code" href="../../dc/de6/SCA__IObject_8h.html#a6d9d58fbf8bcf0bbeecdd3473a21b408">SCA_ActuatorList</a>&amp; actuators= gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>();
<a name="l01754"></a>01754         SCA_ActuatorList::iterator ita;
<a name="l01755"></a>01755 
<a name="l01756"></a>01756         <span class="keywordflow">for</span> (ita = actuators.begin(); !(ita==actuators.end()); ++ita)
<a name="l01757"></a>01757         {
<a name="l01758"></a>01758             <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">MergeScene_LogicBrick</a>(*ita, to);
<a name="l01759"></a>01759         }
<a name="l01760"></a>01760     }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762 
<a name="l01763"></a>01763     {
<a name="l01764"></a>01764         <a class="code" href="../../dc/de6/SCA__IObject_8h.html#a928978f9ec8ed536dd9b74298801e562">SCA_SensorList</a>&amp; sensors= gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6931c6c819b8de336843073edc93e9c5">GetSensors</a>();
<a name="l01765"></a>01765         SCA_SensorList::iterator its;
<a name="l01766"></a>01766 
<a name="l01767"></a>01767         <span class="keywordflow">for</span> (its = sensors.begin(); !(its==sensors.end()); ++its)
<a name="l01768"></a>01768         {
<a name="l01769"></a>01769             <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">MergeScene_LogicBrick</a>(*its, to);
<a name="l01770"></a>01770         }
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772 
<a name="l01773"></a>01773     {
<a name="l01774"></a>01774         <a class="code" href="../../dc/de6/SCA__IObject_8h.html#afc52d55edd6e89c7b789e32e7971b09f">SCA_ControllerList</a>&amp; controllers= gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a1ddd7f8bdd328a332e4aad7eb523d343">GetControllers</a>();
<a name="l01775"></a>01775         SCA_ControllerList::iterator itc;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777         <span class="keywordflow">for</span> (itc = controllers.begin(); !(itc==controllers.end()); ++itc)
<a name="l01778"></a>01778         {
<a name="l01779"></a>01779             <a class="code" href="../../d9/d74/classSCA__IController.html">SCA_IController</a> *cont= *itc;
<a name="l01780"></a>01780             <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">MergeScene_LogicBrick</a>(cont, to);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782             vector&lt;SCA_ISensor*&gt; linkedsensors = cont-&gt;<a class="code" href="../../d9/d74/classSCA__IController.html#a13c15041990338781524ff9d5b269476">GetLinkedSensors</a>();
<a name="l01783"></a>01783             vector&lt;SCA_IActuator*&gt; linkedactuators = cont-&gt;<a class="code" href="../../d9/d74/classSCA__IController.html#a75556e8984e8f5202f34e595c5e97461">GetLinkedActuators</a>();
<a name="l01784"></a>01784 
<a name="l01785"></a>01785             <span class="keywordflow">for</span> (vector&lt;SCA_IActuator*&gt;::iterator ita = linkedactuators.begin();!(ita==linkedactuators.end());++ita) {
<a name="l01786"></a>01786                 <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">MergeScene_LogicBrick</a>(*ita, to);
<a name="l01787"></a>01787             }
<a name="l01788"></a>01788 
<a name="l01789"></a>01789             <span class="keywordflow">for</span> (vector&lt;SCA_ISensor*&gt;::iterator its = linkedsensors.begin();!(its==linkedsensors.end());++its) {
<a name="l01790"></a>01790                 <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a6e42b7ccc7e6cd22451669b8a16dd1ff">MergeScene_LogicBrick</a>(*its, to);
<a name="l01791"></a>01791             }
<a name="l01792"></a>01792         }
<a name="l01793"></a>01793     }
<a name="l01794"></a>01794 
<a name="l01795"></a>01795     <span class="comment">/* graphics controller */</span>
<a name="l01796"></a>01796     <a class="code" href="../../db/d53/classPHY__IGraphicController.html">PHY_IGraphicController</a> *ctrl = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a8946a2704a4a7400615dab4ed9d0dfe4">GetGraphicController</a>();
<a name="l01797"></a>01797     <span class="keywordflow">if</span> (ctrl) {
<a name="l01798"></a>01798         <span class="comment">/* SHOULD update the m_cullingTree */</span>
<a name="l01799"></a>01799         ctrl-&gt;<a class="code" href="../../d5/d92/classPHY__IController.html#a6fcf2c7eeb11c8930f4277a3c6f5efa6">SetPhysicsEnvironment</a>(to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>());
<a name="l01800"></a>01800     }
<a name="l01801"></a>01801 
<a name="l01802"></a>01802     <span class="comment">/* SG_Node can hold a scene reference */</span>
<a name="l01803"></a>01803     <a class="code" href="../../d8/d3b/classSG__Node.html">SG_Node</a> *sg= gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>();
<a name="l01804"></a>01804     <span class="keywordflow">if</span> (sg) {
<a name="l01805"></a>01805         <span class="keywordflow">if</span> (sg-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#af4a8dccd2d38019437082f42e7bd7950">GetSGClientInfo</a>() == from) {
<a name="l01806"></a>01806             sg-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#ae3b4452f68c4fc26601fc2c4b7a33753">SetSGClientInfo</a>(to);
<a name="l01807"></a>01807 
<a name="l01808"></a>01808             <span class="comment">/* Make sure to grab the children too since they might not be tied to a game object */</span>
<a name="l01809"></a>01809             <a class="code" href="../../df/d3b/SG__Node_8h.html#a8ae32373b02caa826276c36fe07ecb76">NodeList</a> children = sg-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#aa0d15b7e05705e40a1525864cd7499d1">GetSGChildren</a>();
<a name="l01810"></a>01810             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;children.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01811"></a>01811                     children[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;SetSGClientInfo(to);
<a name="l01812"></a>01812         }
<a name="l01813"></a>01813 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01814"></a>01814 <span class="preprocessor"></span>        SGControllerList::iterator contit;
<a name="l01815"></a>01815         <a class="code" href="../../d0/d93/SG__IObject_8h.html#aad4346341d8a820b9434848b5cc4ec64">SGControllerList</a>&amp; controllers = sg-&gt;<a class="code" href="../../da/d03/classSG__IObject.html#a65ffd2fdff176c9b9708b7638d35a367" title="Needed for replication.">GetSGControllerList</a>();
<a name="l01816"></a>01816         <span class="keywordflow">for</span> (contit = controllers.begin();contit!=controllers.end();++contit)
<a name="l01817"></a>01817         {
<a name="l01818"></a>01818             <a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a> *phys_ctrl= <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d0/d48/classKX__BulletPhysicsController.html">KX_BulletPhysicsController</a> *<span class="keyword">&gt;</span>(*contit);
<a name="l01819"></a>01819             <span class="keywordflow">if</span> (phys_ctrl)
<a name="l01820"></a>01820                 phys_ctrl-&gt;<a class="code" href="../../d2/d9d/classCcdPhysicsController.html#aa819a5064e87c9b50282f8ddba469c2d">SetPhysicsEnvironment</a>(to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>());
<a name="l01821"></a>01821         }
<a name="l01822"></a>01822 <span class="preprocessor">#endif // USE_BULLET</span>
<a name="l01823"></a>01823 <span class="preprocessor"></span>    }
<a name="l01824"></a>01824     <span class="comment">/* If the object is a light, update it&#39;s scene */</span>
<a name="l01825"></a>01825     <span class="keywordflow">if</span> (gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a6093176c1389ff66df406c225ee0bcaf">GetGameObjectType</a>() == <a class="code" href="../../da/d68/classSCA__IObject.html#a1f0f06b1ee29284cbef58072f8f2671ba89f3a9ecc77a937dcd12e72726da5dd9">SCA_IObject::OBJ_LIGHT</a>)
<a name="l01826"></a>01826         ((<a class="code" href="../../d8/d31/classKX__LightObject.html">KX_LightObject</a>*)gameobj)-&gt;UpdateScene(to);
<a name="l01827"></a>01827 
<a name="l01828"></a>01828     <span class="comment">/* Add the object to the scene&#39;s logic manager */</span>
<a name="l01829"></a>01829     to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a72ab91832183e3172df57e31c452c7f7">RegisterGameObjectName</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a268fb3bcc390cd18830e91113693eb40">GetName</a>(), gameobj);
<a name="l01830"></a>01830     to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a44a09bdf1102c62280858578b8a6cd35">RegisterGameObj</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>(), gameobj);
<a name="l01831"></a>01831 
<a name="l01832"></a>01832     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0380469d233ad08592b6a49819db066d">GetMeshCount</a>(); ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01833"></a>01833         to-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#ad4817a28b514a6c3d43e68cf9cedc236">RegisterGameMeshName</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a8e232cc1d6f124cc472f9717f82c2f77">GetName</a>(), gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>());
<a name="l01834"></a>01834 }
<a name="l01835"></a>01835 
<a name="l01836"></a><a class="code" href="../../d2/da3/classKX__Scene.html#aaf62549b29afc4d00216c108dd0bd8d9">01836</a> <span class="keywordtype">bool</span> <a class="code" href="../../d2/da3/classKX__Scene.html#aaf62549b29afc4d00216c108dd0bd8d9">KX_Scene::MergeScene</a>(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *other)
<a name="l01837"></a>01837 {
<a name="l01838"></a>01838 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01839"></a>01839 <span class="preprocessor"></span>    <a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a> *env=         <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a> *<span class="keyword">&gt;</span>(this-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>());
<a name="l01840"></a>01840     <a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a> *env_other=   <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a> *<span class="keyword">&gt;</span>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a29c3e8d43a5878f1725c03ce37bb5a30">GetPhysicsEnvironment</a>());
<a name="l01841"></a>01841 
<a name="l01842"></a>01842     <span class="keywordflow">if</span> ((env==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) != (env_other==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) <span class="comment">/* TODO - even when both scenes have NONE physics, the other is loaded with bullet enabled, ??? */</span>
<a name="l01843"></a>01843     {
<a name="l01844"></a>01844         printf(<span class="stringliteral">&quot;KX_Scene::MergeScene: physics scenes type differ, aborting\n&quot;</span>);
<a name="l01845"></a>01845         printf(<span class="stringliteral">&quot;\tsource %d, terget %d\n&quot;</span>, (<span class="keywordtype">int</span>)(env!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), (<span class="keywordtype">int</span>)(env_other!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01846"></a>01846         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01847"></a>01847     }
<a name="l01848"></a>01848 <span class="preprocessor">#endif // USE_BULLET</span>
<a name="l01849"></a>01849 <span class="preprocessor"></span>
<a name="l01850"></a>01850     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/classKX__Scene.html#aa868200102a0b60274ed39d3313207d2">GetSceneConverter</a>() != other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#aa868200102a0b60274ed39d3313207d2">GetSceneConverter</a>()) {
<a name="l01851"></a>01851         printf(<span class="stringliteral">&quot;KX_Scene::MergeScene: converters differ, aborting\n&quot;</span>);
<a name="l01852"></a>01852         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01853"></a>01853     }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 
<a name="l01856"></a>01856     <a class="code" href="../../d2/da3/classKX__Scene.html#a9e031e8bf9bb35c1216efe1048d8102b">GetBucketManager</a>()-&gt;<a class="code" href="../../df/d04/classRAS__BucketManager.html#a41fe37bfd80965abb9c6346d55fb4e24">MergeBucketManager</a>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a9e031e8bf9bb35c1216efe1048d8102b">GetBucketManager</a>(), <span class="keyword">this</span>);
<a name="l01857"></a>01857 
<a name="l01858"></a>01858     <span class="comment">/* move materials across, assume they both use the same scene-converters */</span>
<a name="l01859"></a>01859     <a class="code" href="../../d2/da3/classKX__Scene.html#aa868200102a0b60274ed39d3313207d2">GetSceneConverter</a>()-&gt;<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aa453b081fe69b500cc27ecfe7cd1a494">MergeScene</a>(<span class="keyword">this</span>, other);
<a name="l01860"></a>01860 
<a name="l01861"></a>01861     <span class="comment">/* active + inactive == all ??? - lets hope so */</span>
<a name="l01862"></a>01862     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01863"></a>01863     {
<a name="l01864"></a>01864         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l01865"></a>01865         <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a5c9b8bb7ecf29dbee524392ed32ded59">MergeScene_GameObject</a>(gameobj, <span class="keyword">this</span>, other);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867         gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a79d8df09113d6a4bf14420b92503f0f3">UpdateBuckets</a>(<span class="keyword">false</span>); <span class="comment">/* only for active objects */</span>
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01871"></a>01871     {
<a name="l01872"></a>01872         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l01873"></a>01873         <a class="code" href="../../dd/dc1/KX__Scene_8cpp.html#a5c9b8bb7ecf29dbee524392ed32ded59">MergeScene_GameObject</a>(gameobj, <span class="keyword">this</span>, other);
<a name="l01874"></a>01874     }
<a name="l01875"></a>01875 
<a name="l01876"></a>01876     <a class="code" href="../../d2/da3/classKX__Scene.html#a7ab522483b5a299acb5967d3f2318f7d">GetTempObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a1d8a0f67df037cfcc86c067d89be10b2">MergeList</a>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a7ab522483b5a299acb5967d3f2318f7d">GetTempObjectList</a>());
<a name="l01877"></a>01877     other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a7ab522483b5a299acb5967d3f2318f7d">GetTempObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#af15dd2d30e3da5ce713b6d7341d2ca88">ReleaseAndRemoveAll</a>();
<a name="l01878"></a>01878 
<a name="l01879"></a>01879     <a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a1d8a0f67df037cfcc86c067d89be10b2">MergeList</a>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>());
<a name="l01880"></a>01880     other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#af15dd2d30e3da5ce713b6d7341d2ca88">ReleaseAndRemoveAll</a>();
<a name="l01881"></a>01881 
<a name="l01882"></a>01882     <a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a1d8a0f67df037cfcc86c067d89be10b2">MergeList</a>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>());
<a name="l01883"></a>01883     other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#af15dd2d30e3da5ce713b6d7341d2ca88">ReleaseAndRemoveAll</a>();
<a name="l01884"></a>01884 
<a name="l01885"></a>01885     <a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a1d8a0f67df037cfcc86c067d89be10b2">MergeList</a>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>());
<a name="l01886"></a>01886     other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#af15dd2d30e3da5ce713b6d7341d2ca88">ReleaseAndRemoveAll</a>();
<a name="l01887"></a>01887 
<a name="l01888"></a>01888     <a class="code" href="../../d2/da3/classKX__Scene.html#ad0262902bd268122e328de3448809fa6">GetLightList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#a1d8a0f67df037cfcc86c067d89be10b2">MergeList</a>(other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad0262902bd268122e328de3448809fa6">GetLightList</a>());
<a name="l01889"></a>01889     other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad0262902bd268122e328de3448809fa6">GetLightList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#af15dd2d30e3da5ce713b6d7341d2ca88">ReleaseAndRemoveAll</a>();
<a name="l01890"></a>01890 
<a name="l01891"></a>01891 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l01892"></a>01892 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (env) <span class="comment">/* bullet scene? - dummy scenes don&#39;t need touching */</span>
<a name="l01893"></a>01893         env-&gt;<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html#ac506970bad8974a9e57cf0019ad80ab8">MergeEnvironment</a>(env_other);
<a name="l01894"></a>01894 <span class="preprocessor">#endif</span>
<a name="l01895"></a>01895 <span class="preprocessor"></span>    
<a name="l01896"></a>01896     <span class="comment">/* merge logic */</span>
<a name="l01897"></a>01897     {
<a name="l01898"></a>01898         <a class="code" href="../../db/d0f/classSCA__LogicManager.html">SCA_LogicManager</a> *logicmgr=         <a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>();
<a name="l01899"></a>01899         <a class="code" href="../../db/d0f/classSCA__LogicManager.html">SCA_LogicManager</a> *logicmgr_other=   other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>();
<a name="l01900"></a>01900 
<a name="l01901"></a>01901         vector&lt;class SCA_EventManager*&gt;evtmgrs= logicmgr-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a0d3b9f23fa2fd43b9be40af3f32c1cea">GetEventManagers</a>();
<a name="l01902"></a>01902         <span class="comment">//vector&lt;class SCA_EventManager*&gt;evtmgrs_others= logicmgr_other-&gt;GetEventManagers();</span>
<a name="l01903"></a>01903 
<a name="l01904"></a>01904         <span class="comment">//SCA_EventManager *evtmgr;</span>
<a name="l01905"></a>01905         <a class="code" href="../../db/d2d/classSCA__EventManager.html">SCA_EventManager</a> *evtmgr_other;
<a name="l01906"></a>01906 
<a name="l01907"></a>01907         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; evtmgrs.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01908"></a>01908             evtmgr_other= logicmgr_other-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#ad28df62ed8d230e1a521e91bc921f41d">FindEventManager</a>(evtmgrs[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;GetType());
<a name="l01909"></a>01909 
<a name="l01910"></a>01910             <span class="keywordflow">if</span> (evtmgr_other) <span class="comment">/* unlikely but possible one scene has a joystick and not the other */</span>
<a name="l01911"></a>01911                 evtmgr_other-&gt;<a class="code" href="../../db/d2d/classSCA__EventManager.html#a05a1627bf8a1ac41a0a69d0956ca18ad">Replace_LogicManager</a>(logicmgr);
<a name="l01912"></a>01912 
<a name="l01913"></a>01913             <span class="comment">/* when merging objects sensors are moved across into the new manager, don&#39;t need to do this here */</span>
<a name="l01914"></a>01914         }
<a name="l01915"></a>01915 
<a name="l01916"></a>01916         <span class="comment">/* grab any timer properties from the other scene */</span>
<a name="l01917"></a>01917         <a class="code" href="../../de/dd3/classSCA__TimeEventManager.html">SCA_TimeEventManager</a> *timemgr=      <a class="code" href="../../d2/da3/classKX__Scene.html#a3571af4237b258a335342f6d6ece5bdb">GetTimeEventManager</a>();
<a name="l01918"></a>01918         <a class="code" href="../../de/dd3/classSCA__TimeEventManager.html">SCA_TimeEventManager</a> *timemgr_other=    other-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a3571af4237b258a335342f6d6ece5bdb">GetTimeEventManager</a>();
<a name="l01919"></a>01919         vector&lt;CValue*&gt; times = timemgr_other-&gt;<a class="code" href="../../de/dd3/classSCA__TimeEventManager.html#a53bb5cbf0241d492fa69cc5b176c663b">GetTimeValues</a>();
<a name="l01920"></a>01920 
<a name="l01921"></a>01921         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; times.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01922"></a>01922             timemgr-&gt;<a class="code" href="../../de/dd3/classSCA__TimeEventManager.html#a8be4dc6aa6fb29527d7ba28d81361c5b">AddTimeProperty</a>(times[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l01923"></a>01923         }
<a name="l01924"></a>01924         
<a name="l01925"></a>01925     }
<a name="l01926"></a>01926     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01927"></a>01927 }
<a name="l01928"></a>01928 
<a name="l01929"></a><a class="code" href="../../d2/da3/classKX__Scene.html#a7e80d5e65839a8808ed8a74e2d6c0e60">01929</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#a7e80d5e65839a8808ed8a74e2d6c0e60">KX_Scene::Update2DFilter</a>(vector&lt;STR_String&gt;&amp; propNames, <span class="keywordtype">void</span>* gameObj, <a class="code" href="../../d3/d62/classRAS__2DFilterManager.html#af28a1d8de1d56c6c0303381ecf8ed03f">RAS_2DFilterManager::RAS_2DFILTER_MODE</a> filtermode, <span class="keywordtype">int</span> pass, <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; text)
<a name="l01930"></a>01930 {
<a name="l01931"></a>01931     <a class="code" href="../../d2/da3/classKX__Scene.html#a3a1ef090da44e063eca5fd6b28342dc6">m_filtermanager</a>.<a class="code" href="../../d3/d62/classRAS__2DFilterManager.html#a8d9ed2aad32811df537087e97393fd44">EnableFilter</a>(propNames, gameObj, filtermode, pass, text);
<a name="l01932"></a>01932 }
<a name="l01933"></a>01933 
<a name="l01934"></a><a class="code" href="../../d2/da3/classKX__Scene.html#af112fcfbb48a812ae3c9d1d2e72a89a2">01934</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da3/classKX__Scene.html#af112fcfbb48a812ae3c9d1d2e72a89a2">KX_Scene::Render2DFilters</a>(<a class="code" href="../../d5/df6/classRAS__ICanvas.html">RAS_ICanvas</a>* canvas)
<a name="l01935"></a>01935 {
<a name="l01936"></a>01936     <a class="code" href="../../d2/da3/classKX__Scene.html#a3a1ef090da44e063eca5fd6b28342dc6">m_filtermanager</a>.<a class="code" href="../../d3/d62/classRAS__2DFilterManager.html#a7fcde52481869876be232b516401f12c">RenderFilters</a>(canvas);
<a name="l01937"></a>01937 }
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l01940"></a>01940 <span class="preprocessor"></span>
<a name="l01941"></a>01941 <span class="keywordtype">void</span> KX_Scene::RunDrawingCallbacks(PyObject* cb_list)
<a name="l01942"></a>01942 {
<a name="l01943"></a>01943     Py_ssize_t <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <span class="keywordflow">if</span> (cb_list &amp;&amp; (len=PyList_GET_SIZE(cb_list)))
<a name="l01946"></a>01946     {
<a name="l01947"></a>01947         PyObject* args= PyTuple_New(0); <span class="comment">// save python creating each call</span>
<a name="l01948"></a>01948         PyObject* func;
<a name="l01949"></a>01949         PyObject* ret;
<a name="l01950"></a>01950 
<a name="l01951"></a>01951         <span class="comment">// Iterate the list and run the callbacks</span>
<a name="l01952"></a>01952         <span class="keywordflow">for</span> (Py_ssize_t pos=0; pos &lt; <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>; pos++)
<a name="l01953"></a>01953         {
<a name="l01954"></a>01954             func= PyList_GET_ITEM(cb_list, pos);
<a name="l01955"></a>01955             ret= PyObject_Call(func, args, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01956"></a>01956             <span class="keywordflow">if</span> (ret==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01957"></a>01957                 PyErr_Print();
<a name="l01958"></a>01958                 PyErr_Clear();
<a name="l01959"></a>01959             }
<a name="l01960"></a>01960             <span class="keywordflow">else</span> {
<a name="l01961"></a>01961                 Py_DECREF(ret);
<a name="l01962"></a>01962             }
<a name="l01963"></a>01963         }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965         Py_DECREF(args);
<a name="l01966"></a>01966     }
<a name="l01967"></a>01967 }
<a name="l01968"></a>01968 
<a name="l01969"></a>01969 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l01970"></a>01970 <span class="comment">//Python</span>
<a name="l01971"></a>01971 
<a name="l01972"></a>01972 PyTypeObject KX_Scene::Type = {
<a name="l01973"></a>01973     PyVarObject_HEAD_INIT(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)
<a name="l01974"></a>01974     <span class="stringliteral">&quot;KX_Scene&quot;</span>,
<a name="l01975"></a>01975     <span class="keyword">sizeof</span>(PyObjectPlus_Proxy),
<a name="l01976"></a>01976     0,
<a name="l01977"></a>01977     py_base_dealloc,
<a name="l01978"></a>01978     0,
<a name="l01979"></a>01979     0,
<a name="l01980"></a>01980     0,
<a name="l01981"></a>01981     0,
<a name="l01982"></a>01982     py_base_repr,
<a name="l01983"></a>01983     0,
<a name="l01984"></a>01984     &amp;<a class="code" href="../../dd/d1a/structSequence.html">Sequence</a>,
<a name="l01985"></a>01985     &amp;Mapping,
<a name="l01986"></a>01986     0,0,0,0,0,0,
<a name="l01987"></a>01987     Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE,
<a name="l01988"></a>01988     0,0,0,0,0,0,0,
<a name="l01989"></a>01989     Methods,
<a name="l01990"></a>01990     0,
<a name="l01991"></a>01991     0,
<a name="l01992"></a>01992     &amp;CValue::Type,
<a name="l01993"></a>01993     0,0,0,0,0,0,
<a name="l01994"></a>01994     py_base_new
<a name="l01995"></a>01995 };
<a name="l01996"></a>01996 
<a name="l01997"></a>01997 PyMethodDef KX_Scene::Methods[] = {
<a name="l01998"></a>01998     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, addObject),
<a name="l01999"></a>01999     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, end),
<a name="l02000"></a>02000     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, restart),
<a name="l02001"></a>02001     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, replace),
<a name="l02002"></a>02002     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, suspend),
<a name="l02003"></a>02003     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, resume),
<a name="l02004"></a>02004     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, drawObstacleSimulation),
<a name="l02005"></a>02005 
<a name="l02006"></a>02006     
<a name="l02007"></a>02007     <span class="comment">/* dict style access */</span>
<a name="l02008"></a>02008     KX_PYMETHODTABLE(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, <span class="keyword">get</span>),
<a name="l02009"></a>02009     
<a name="l02010"></a>02010     {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>} <span class="comment">//Sentinel</span>
<a name="l02011"></a>02011 };
<a name="l02012"></a>02012 <span class="keyword">static</span> PyObject *Map_GetItem(PyObject *self_v, PyObject *item)
<a name="l02013"></a>02013 {
<a name="l02014"></a>02014     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(self_v);
<a name="l02015"></a>02015     <span class="keyword">const</span> <span class="keywordtype">char</span> *attr_str= _PyUnicode_AsString(item);
<a name="l02016"></a>02016     PyObject* pyconvert;
<a name="l02017"></a>02017     
<a name="l02018"></a>02018     <span class="keywordflow">if</span> (<span class="keyword">self</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02019"></a>02019         PyErr_SetString(PyExc_SystemError, <span class="stringliteral">&quot;val = scene[key]: KX_Scene, &quot;</span>BGE_PROXY_ERROR_MSG);
<a name="l02020"></a>02020         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02021"></a>02021     }
<a name="l02022"></a>02022     
<a name="l02023"></a>02023     <span class="keywordflow">if</span> (self-&gt;m_attr_dict &amp;&amp; (pyconvert=PyDict_GetItem(self-&gt;m_attr_dict, item))) {
<a name="l02024"></a>02024         
<a name="l02025"></a>02025         <span class="keywordflow">if</span> (attr_str)
<a name="l02026"></a>02026             PyErr_Clear();
<a name="l02027"></a>02027         Py_INCREF(pyconvert);
<a name="l02028"></a>02028         <span class="keywordflow">return</span> pyconvert;
<a name="l02029"></a>02029     }
<a name="l02030"></a>02030     <span class="keywordflow">else</span> {
<a name="l02031"></a>02031         <span class="keywordflow">if</span> (attr_str)   PyErr_Format(PyExc_KeyError, <span class="stringliteral">&quot;value = scene[key]: KX_Scene, key \&quot;%s\&quot; does not exist&quot;</span>, attr_str);
<a name="l02032"></a>02032         <span class="keywordflow">else</span>            PyErr_SetString(PyExc_KeyError, <span class="stringliteral">&quot;value = scene[key]: KX_Scene, key does not exist&quot;</span>);
<a name="l02033"></a>02033         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02034"></a>02034     }
<a name="l02035"></a>02035         
<a name="l02036"></a>02036 }
<a name="l02037"></a>02037 
<a name="l02038"></a>02038 <span class="keyword">static</span> <span class="keywordtype">int</span> Map_SetItem(PyObject *self_v, PyObject *key, PyObject *val)
<a name="l02039"></a>02039 {
<a name="l02040"></a>02040     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(self_v);
<a name="l02041"></a>02041     <span class="keyword">const</span> <span class="keywordtype">char</span> *attr_str= _PyUnicode_AsString(key);
<a name="l02042"></a>02042     <span class="keywordflow">if</span> (attr_str==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02043"></a>02043         PyErr_Clear();
<a name="l02044"></a>02044     
<a name="l02045"></a>02045     <span class="keywordflow">if</span> (<span class="keyword">self</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02046"></a>02046         PyErr_SetString(PyExc_SystemError, <span class="stringliteral">&quot;scene[key] = value: KX_Scene, &quot;</span>BGE_PROXY_ERROR_MSG);
<a name="l02047"></a>02047         <span class="keywordflow">return</span> -1;
<a name="l02048"></a>02048     }
<a name="l02049"></a>02049     
<a name="l02050"></a>02050     <span class="keywordflow">if</span> (val==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">/* del ob[&quot;key&quot;] */</span>
<a name="l02051"></a>02051         <span class="keywordtype">int</span> del= 0;
<a name="l02052"></a>02052         
<a name="l02053"></a>02053         <span class="keywordflow">if</span> (self-&gt;m_attr_dict)
<a name="l02054"></a>02054             del |= (PyDict_DelItem(self-&gt;m_attr_dict, key)==0) ? 1:0;
<a name="l02055"></a>02055         
<a name="l02056"></a>02056         <span class="keywordflow">if</span> (del==0) {
<a name="l02057"></a>02057             <span class="keywordflow">if</span> (attr_str)   PyErr_Format(PyExc_KeyError, <span class="stringliteral">&quot;scene[key] = value: KX_Scene, key \&quot;%s\&quot; could not be set&quot;</span>, attr_str);
<a name="l02058"></a>02058             <span class="keywordflow">else</span>            PyErr_SetString(PyExc_KeyError, <span class="stringliteral">&quot;del scene[key]: KX_Scene, key could not be deleted&quot;</span>);
<a name="l02059"></a>02059             <span class="keywordflow">return</span> -1;
<a name="l02060"></a>02060         }
<a name="l02061"></a>02061         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (self-&gt;m_attr_dict) {
<a name="l02062"></a>02062             PyErr_Clear(); <span class="comment">/* PyDict_DelItem sets an error when it fails */</span>
<a name="l02063"></a>02063         }
<a name="l02064"></a>02064     }
<a name="l02065"></a>02065     <span class="keywordflow">else</span> { <span class="comment">/* ob[&quot;key&quot;] = value */</span>
<a name="l02066"></a>02066         <span class="keywordtype">int</span> <span class="keyword">set</span> = 0;
<a name="l02067"></a>02067 
<a name="l02068"></a>02068         <span class="keywordflow">if</span> (self-&gt;m_attr_dict==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="comment">/* lazy init */</span>
<a name="l02069"></a>02069             <span class="keyword">self</span>-&gt;m_attr_dict= PyDict_New();
<a name="l02070"></a>02070         
<a name="l02071"></a>02071         
<a name="l02072"></a>02072         <span class="keywordflow">if</span> (PyDict_SetItem(self-&gt;m_attr_dict, key, val)==0)
<a name="l02073"></a>02073             <span class="keyword">set</span>= 1;
<a name="l02074"></a>02074         <span class="keywordflow">else</span>
<a name="l02075"></a>02075             PyErr_SetString(PyExc_KeyError, <span class="stringliteral">&quot;scene[key] = value: KX_Scene, key not be added to internal dictionary&quot;</span>);
<a name="l02076"></a>02076     
<a name="l02077"></a>02077         <span class="keywordflow">if</span> (<span class="keyword">set</span>==0)
<a name="l02078"></a>02078             <span class="keywordflow">return</span> -1; <span class="comment">/* pythons error value */</span>
<a name="l02079"></a>02079         
<a name="l02080"></a>02080     }
<a name="l02081"></a>02081     
<a name="l02082"></a>02082     <span class="keywordflow">return</span> 0; <span class="comment">/* success */</span>
<a name="l02083"></a>02083 }
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 <span class="keyword">static</span> <span class="keywordtype">int</span> Seq_Contains(PyObject *self_v, PyObject *value)
<a name="l02086"></a>02086 {
<a name="l02087"></a>02087     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(self_v);
<a name="l02088"></a>02088     
<a name="l02089"></a>02089     <span class="keywordflow">if</span> (<span class="keyword">self</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02090"></a>02090         PyErr_SetString(PyExc_SystemError, <span class="stringliteral">&quot;val in scene: KX_Scene, &quot;</span>BGE_PROXY_ERROR_MSG);
<a name="l02091"></a>02091         <span class="keywordflow">return</span> -1;
<a name="l02092"></a>02092     }
<a name="l02093"></a>02093     
<a name="l02094"></a>02094     <span class="keywordflow">if</span> (self-&gt;m_attr_dict &amp;&amp; PyDict_GetItem(self-&gt;m_attr_dict, value))
<a name="l02095"></a>02095         <span class="keywordflow">return</span> 1;
<a name="l02096"></a>02096     
<a name="l02097"></a>02097     <span class="keywordflow">return</span> 0;
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 
<a name="l02100"></a>02100 PyMappingMethods KX_Scene::Mapping = {
<a name="l02101"></a>02101     (lenfunc)<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>                   ,           <span class="comment">/*inquiry mp_length */</span>
<a name="l02102"></a>02102     (binaryfunc)Map_GetItem,        <span class="comment">/*binaryfunc mp_subscript */</span>
<a name="l02103"></a>02103     (objobjargproc)Map_SetItem, <span class="comment">/*objobjargproc mp_ass_subscript */</span>
<a name="l02104"></a>02104 };
<a name="l02105"></a>02105 
<a name="l02106"></a>02106 PySequenceMethods <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#ae911188ac1b461f468687bd5a1e70307">KX_Scene::Sequence</a> = {
<a name="l02107"></a>02107     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* Cant set the len otherwise it can evaluate as false */</span>
<a name="l02108"></a>02108     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* sq_concat */</span>
<a name="l02109"></a>02109     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* sq_repeat */</span>
<a name="l02110"></a>02110     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* sq_item */</span>
<a name="l02111"></a>02111     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* sq_slice */</span>
<a name="l02112"></a>02112     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* sq_ass_item */</span>
<a name="l02113"></a>02113     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,       <span class="comment">/* sq_ass_slice */</span>
<a name="l02114"></a>02114     (objobjproc)Seq_Contains,   <span class="comment">/* sq_contains */</span>
<a name="l02115"></a>02115     (binaryfunc) <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="comment">/* sq_inplace_concat */</span>
<a name="l02116"></a>02116     (ssizeargfunc) NULL, <span class="comment">/* sq_inplace_repeat */</span>
<a name="l02117"></a>02117 };
<a name="l02118"></a>02118 
<a name="l02119"></a>02119 PyObject* KX_Scene::pyattr_get_name(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02120"></a>02120 {
<a name="l02121"></a>02121     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02122"></a>02122     <span class="keywordflow">return</span> PyUnicode_From_STR_String(self-&gt;GetName());
<a name="l02123"></a>02123 }
<a name="l02124"></a>02124 
<a name="l02125"></a>02125 PyObject* KX_Scene::pyattr_get_objects(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02126"></a>02126 {
<a name="l02127"></a>02127     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02128"></a>02128     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;GetProxy();
<a name="l02129"></a>02129 }
<a name="l02130"></a>02130 
<a name="l02131"></a>02131 PyObject* KX_Scene::pyattr_get_objects_inactive(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02132"></a>02132 {
<a name="l02133"></a>02133     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02134"></a>02134     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>()-&gt;GetProxy();
<a name="l02135"></a>02135 }
<a name="l02136"></a>02136 
<a name="l02137"></a>02137 PyObject* KX_Scene::pyattr_get_lights(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02138"></a>02138 {
<a name="l02139"></a>02139     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02140"></a>02140     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad0262902bd268122e328de3448809fa6">GetLightList</a>()-&gt;GetProxy();
<a name="l02141"></a>02141 }
<a name="l02142"></a>02142 
<a name="l02143"></a>02143 PyObject* KX_Scene::pyattr_get_cameras(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02144"></a>02144 {
<a name="l02145"></a>02145     <span class="comment">/* With refcounts in this case...</span>
<a name="l02146"></a>02146 <span class="comment">     * the new CListValue is owned by python, so its possible python holds onto it longer then the BGE</span>
<a name="l02147"></a>02147 <span class="comment">     * however this is the same with &quot;scene.objects + []&quot;, when you make a copy by adding lists.</span>
<a name="l02148"></a>02148 <span class="comment">     */</span>
<a name="l02149"></a>02149     
<a name="l02150"></a>02150     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02151"></a>02151     <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* clist = <span class="keyword">new</span> <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>();
<a name="l02152"></a>02152     
<a name="l02153"></a>02153     <span class="comment">/* return self-&gt;GetCameras()-&gt;GetProxy(); */</span>
<a name="l02154"></a>02154     
<a name="l02155"></a>02155     list&lt;KX_Camera*&gt;::iterator it = <span class="keyword">self</span>-&gt;GetCameras()-&gt;begin();
<a name="l02156"></a>02156     <span class="keywordflow">while</span> (it != self-&gt;GetCameras()-&gt;end()) {
<a name="l02157"></a>02157         clist-&gt;<a class="code" href="../../d6/de7/classCListValue.html#ab20ce4d43a9f9aec11731aa4abddb059">Add</a>((*it)-&gt;AddRef());
<a name="l02158"></a>02158         it++;
<a name="l02159"></a>02159     }
<a name="l02160"></a>02160     
<a name="l02161"></a>02161     <span class="keywordflow">return</span> clist-&gt;NewProxy(<span class="keyword">true</span>);
<a name="l02162"></a>02162 }
<a name="l02163"></a>02163 
<a name="l02164"></a>02164 PyObject* KX_Scene::pyattr_get_active_camera(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02165"></a>02165 {
<a name="l02166"></a>02166     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02167"></a>02167     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a8127f5823a26b8f1c87db68908088826">GetActiveCamera</a>()-&gt;GetProxy();
<a name="l02168"></a>02168 }
<a name="l02169"></a>02169 
<a name="l02170"></a>02170 
<a name="l02171"></a>02171 <span class="keywordtype">int</span> KX_Scene::pyattr_set_active_camera(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef, PyObject *value)
<a name="l02172"></a>02172 {
<a name="l02173"></a>02173     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02174"></a>02174     <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a> *camOb;
<a name="l02175"></a>02175     
<a name="l02176"></a>02176     <span class="keywordflow">if</span> (!ConvertPythonToCamera(value, &amp;camOb, <span class="keyword">false</span>, <span class="stringliteral">&quot;scene.active_camera = value: KX_Scene&quot;</span>))
<a name="l02177"></a>02177         <span class="keywordflow">return</span> PY_SET_ATTR_FAIL;
<a name="l02178"></a>02178     
<a name="l02179"></a>02179     <span class="keyword">self</span>-&gt;SetActiveCamera(camOb);
<a name="l02180"></a>02180     <span class="keywordflow">return</span> PY_SET_ATTR_SUCCESS;
<a name="l02181"></a>02181 }
<a name="l02182"></a>02182 
<a name="l02183"></a>02183 PyObject* KX_Scene::pyattr_get_drawing_callback_pre(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02184"></a>02184 {
<a name="l02185"></a>02185     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02186"></a>02186 
<a name="l02187"></a>02187     <span class="keywordflow">if</span> (self-&gt;m_draw_call_pre==NULL)
<a name="l02188"></a>02188         <span class="keyword">self</span>-&gt;m_draw_call_pre= PyList_New(0);
<a name="l02189"></a>02189     Py_INCREF(self-&gt;m_draw_call_pre);
<a name="l02190"></a>02190     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;m_draw_call_pre;
<a name="l02191"></a>02191 }
<a name="l02192"></a>02192 
<a name="l02193"></a>02193 PyObject* KX_Scene::pyattr_get_drawing_callback_post(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l02194"></a>02194 {
<a name="l02195"></a>02195     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="keywordflow">if</span> (self-&gt;m_draw_call_post==NULL)
<a name="l02198"></a>02198         <span class="keyword">self</span>-&gt;m_draw_call_post= PyList_New(0);
<a name="l02199"></a>02199     Py_INCREF(self-&gt;m_draw_call_post);
<a name="l02200"></a>02200     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;m_draw_call_post;
<a name="l02201"></a>02201 }
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 <span class="keywordtype">int</span> KX_Scene::pyattr_set_drawing_callback_pre(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef, PyObject *value)
<a name="l02204"></a>02204 {
<a name="l02205"></a>02205     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02206"></a>02206 
<a name="l02207"></a>02207     <span class="keywordflow">if</span> (!PyList_CheckExact(value))
<a name="l02208"></a>02208     {
<a name="l02209"></a>02209         PyErr_SetString(PyExc_ValueError, <span class="stringliteral">&quot;Expected a list&quot;</span>);
<a name="l02210"></a>02210         <span class="keywordflow">return</span> PY_SET_ATTR_FAIL;
<a name="l02211"></a>02211     }
<a name="l02212"></a>02212     Py_XDECREF(self-&gt;m_draw_call_pre);
<a name="l02213"></a>02213 
<a name="l02214"></a>02214     Py_INCREF(value);
<a name="l02215"></a>02215     <span class="keyword">self</span>-&gt;m_draw_call_pre = value;
<a name="l02216"></a>02216 
<a name="l02217"></a>02217     <span class="keywordflow">return</span> PY_SET_ATTR_SUCCESS;
<a name="l02218"></a>02218 }
<a name="l02219"></a>02219 
<a name="l02220"></a>02220 <span class="keywordtype">int</span> KX_Scene::pyattr_set_drawing_callback_post(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef, PyObject *value)
<a name="l02221"></a>02221 {
<a name="l02222"></a>02222     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* <span class="keyword">self</span> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l02223"></a>02223 
<a name="l02224"></a>02224     <span class="keywordflow">if</span> (!PyList_CheckExact(value))
<a name="l02225"></a>02225     {
<a name="l02226"></a>02226         PyErr_SetString(PyExc_ValueError, <span class="stringliteral">&quot;Expected a list&quot;</span>);
<a name="l02227"></a>02227         <span class="keywordflow">return</span> PY_SET_ATTR_FAIL;
<a name="l02228"></a>02228     }
<a name="l02229"></a>02229     Py_XDECREF(self-&gt;m_draw_call_post);
<a name="l02230"></a>02230 
<a name="l02231"></a>02231     Py_INCREF(value);
<a name="l02232"></a>02232     <span class="keyword">self</span>-&gt;m_draw_call_post = value;
<a name="l02233"></a>02233 
<a name="l02234"></a>02234     <span class="keywordflow">return</span> PY_SET_ATTR_SUCCESS;
<a name="l02235"></a>02235 }
<a name="l02236"></a>02236 
<a name="l02237"></a>02237 PyAttributeDef KX_Scene::Attributes[] = {
<a name="l02238"></a>02238     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;name&quot;</span>,              <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_name),
<a name="l02239"></a>02239     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;objects&quot;</span>,           <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_objects),
<a name="l02240"></a>02240     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;objectsInactive&quot;</span>,   <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_objects_inactive),
<a name="l02241"></a>02241     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;lights&quot;</span>,            <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_lights),
<a name="l02242"></a>02242     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;cameras&quot;</span>,           <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_cameras),
<a name="l02243"></a>02243     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;lights&quot;</span>,            <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_lights),
<a name="l02244"></a>02244     KX_PYATTRIBUTE_RW_FUNCTION(<span class="stringliteral">&quot;active_camera&quot;</span>,     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_active_camera, pyattr_set_active_camera),
<a name="l02245"></a>02245     KX_PYATTRIBUTE_RW_FUNCTION(<span class="stringliteral">&quot;pre_draw&quot;</span>,          <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_drawing_callback_pre, pyattr_set_drawing_callback_pre),
<a name="l02246"></a>02246     KX_PYATTRIBUTE_RW_FUNCTION(<span class="stringliteral">&quot;post_draw&quot;</span>,         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, pyattr_get_drawing_callback_post, pyattr_set_drawing_callback_post),
<a name="l02247"></a>02247     KX_PYATTRIBUTE_BOOL_RO(<span class="stringliteral">&quot;suspended&quot;</span>,             <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, m_suspend),
<a name="l02248"></a>02248     KX_PYATTRIBUTE_BOOL_RO(<span class="stringliteral">&quot;activity_culling&quot;</span>,      <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, m_activity_culling),
<a name="l02249"></a>02249     KX_PYATTRIBUTE_FLOAT_RW(<span class="stringliteral">&quot;activity_culling_radius&quot;</span>, 0.5f, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, m_activity_box_radius),
<a name="l02250"></a>02250     KX_PYATTRIBUTE_BOOL_RO(<span class="stringliteral">&quot;dbvt_culling&quot;</span>,          <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, m_dbvt_culling),
<a name="l02251"></a>02251     { NULL }    <span class="comment">//Sentinel</span>
<a name="l02252"></a>02252 };
<a name="l02253"></a>02253 
<a name="l02254"></a>02254 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, addObject,
<a name="l02255"></a>02255 <span class="stringliteral">&quot;addObject(object, other, time=0)\n&quot;</span>
<a name="l02256"></a>02256 <span class="stringliteral">&quot;Returns the added object.\n&quot;</span>)
<a name="l02257"></a>02257 {
<a name="l02258"></a>02258     PyObject *pyob, *pyother;
<a name="l02259"></a>02259     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *ob, *other;
<a name="l02260"></a>02260 
<a name="l02261"></a>02261     <span class="keywordtype">int</span> time = 0;
<a name="l02262"></a>02262 
<a name="l02263"></a>02263     <span class="keywordflow">if</span> (!PyArg_ParseTuple(args, <span class="stringliteral">&quot;OO|i:addObject&quot;</span>, &amp;pyob, &amp;pyother, &amp;time))
<a name="l02264"></a>02264         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02265"></a>02265 
<a name="l02266"></a>02266     <span class="keywordflow">if</span> (    !ConvertPythonToGameObject(pyob, &amp;ob, <span class="keyword">false</span>, <span class="stringliteral">&quot;scene.addObject(object, other, time): KX_Scene (first argument)&quot;</span>) ||
<a name="l02267"></a>02267             !ConvertPythonToGameObject(pyother, &amp;other, <span class="keyword">false</span>, <span class="stringliteral">&quot;scene.addObject(object, other, time): KX_Scene (second argument)&quot;</span>) )
<a name="l02268"></a>02268         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02269"></a>02269 
<a name="l02270"></a>02270 
<a name="l02271"></a>02271     <a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* replica = AddReplicaObject((<a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>*)ob, other, time);
<a name="l02272"></a>02272     
<a name="l02273"></a>02273     <span class="comment">// release here because AddReplicaObject AddRef&#39;s</span>
<a name="l02274"></a>02274     <span class="comment">// the object is added to the scene so we don&#39;t want python to own a reference</span>
<a name="l02275"></a>02275     replica-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l02276"></a>02276     <span class="keywordflow">return</span> replica-&gt;GetProxy();
<a name="l02277"></a>02277 }
<a name="l02278"></a>02278 
<a name="l02279"></a>02279 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, end,
<a name="l02280"></a>02280 <span class="stringliteral">&quot;end()\n&quot;</span>
<a name="l02281"></a>02281 <span class="stringliteral">&quot;Removes this scene from the game.\n&quot;</span>)
<a name="l02282"></a>02282 {
<a name="l02283"></a>02283     
<a name="l02284"></a>02284     <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a73270876d4beab375ee4cbc78e597251">KX_GetActiveEngine</a>()-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a7b948cca010297cbe938411bdfb2008b">RemoveScene</a>(m_sceneName);
<a name="l02285"></a>02285     
<a name="l02286"></a>02286     Py_RETURN_NONE;
<a name="l02287"></a>02287 }
<a name="l02288"></a>02288 
<a name="l02289"></a>02289 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, restart,
<a name="l02290"></a>02290                    <span class="stringliteral">&quot;restart()\n&quot;</span>
<a name="l02291"></a>02291                    <span class="stringliteral">&quot;Restarts this scene.\n&quot;</span>)
<a name="l02292"></a>02292 {
<a name="l02293"></a>02293     <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a73270876d4beab375ee4cbc78e597251">KX_GetActiveEngine</a>()-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ac1f3a55b60a01e89ea78c30476eb2b2f">ReplaceScene</a>(m_sceneName, m_sceneName);
<a name="l02294"></a>02294     
<a name="l02295"></a>02295     Py_RETURN_NONE;
<a name="l02296"></a>02296 }
<a name="l02297"></a>02297 
<a name="l02298"></a>02298 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, replace,
<a name="l02299"></a>02299                    <span class="stringliteral">&quot;replace(newScene)\n&quot;</span>
<a name="l02300"></a>02300                    <span class="stringliteral">&quot;Replaces this scene with another one.\n&quot;</span>)
<a name="l02301"></a>02301 {
<a name="l02302"></a>02302     <span class="keywordtype">char</span>* name;
<a name="l02303"></a>02303     
<a name="l02304"></a>02304     <span class="keywordflow">if</span> (!PyArg_ParseTuple(args, <span class="stringliteral">&quot;s:replace&quot;</span>, &amp;name))
<a name="l02305"></a>02305         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02306"></a>02306     
<a name="l02307"></a>02307     <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a73270876d4beab375ee4cbc78e597251">KX_GetActiveEngine</a>()-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ac1f3a55b60a01e89ea78c30476eb2b2f">ReplaceScene</a>(m_sceneName, name);
<a name="l02308"></a>02308     
<a name="l02309"></a>02309     Py_RETURN_NONE;
<a name="l02310"></a>02310 }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, suspend,
<a name="l02313"></a>02313                     <span class="stringliteral">&quot;suspend()\n&quot;</span>
<a name="l02314"></a>02314                     <span class="stringliteral">&quot;Suspends this scene.\n&quot;</span>)
<a name="l02315"></a>02315 {
<a name="l02316"></a>02316     Suspend();
<a name="l02317"></a>02317     
<a name="l02318"></a>02318     Py_RETURN_NONE;
<a name="l02319"></a>02319 }
<a name="l02320"></a>02320 
<a name="l02321"></a>02321 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, resume,
<a name="l02322"></a>02322                     <span class="stringliteral">&quot;resume()\n&quot;</span>
<a name="l02323"></a>02323                     <span class="stringliteral">&quot;Resumes this scene.\n&quot;</span>)
<a name="l02324"></a>02324 {
<a name="l02325"></a>02325     Resume();
<a name="l02326"></a>02326     
<a name="l02327"></a>02327     Py_RETURN_NONE;
<a name="l02328"></a>02328 }
<a name="l02329"></a>02329 
<a name="l02330"></a>02330 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, drawObstacleSimulation,
<a name="l02331"></a>02331                    <span class="stringliteral">&quot;drawObstacleSimulation()\n&quot;</span>
<a name="l02332"></a>02332                    <span class="stringliteral">&quot;Draw debug visualization of obstacle simulation.\n&quot;</span>)
<a name="l02333"></a>02333 {
<a name="l02334"></a>02334     <span class="keywordflow">if</span> (GetObstacleSimulation())
<a name="l02335"></a>02335         GetObstacleSimulation()-&gt;DrawObstacles();
<a name="l02336"></a>02336 
<a name="l02337"></a>02337     Py_RETURN_NONE;
<a name="l02338"></a>02338 }
<a name="l02339"></a>02339 
<a name="l02340"></a>02340 <span class="comment">/* Matches python dict.get(key, [default]) */</span>
<a name="l02341"></a>02341 KX_PYMETHODDEF_DOC(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>, <span class="keyword">get</span>, <span class="stringliteral">&quot;&quot;</span>)
<a name="l02342"></a>02342 {
<a name="l02343"></a>02343     PyObject *key;
<a name="l02344"></a>02344     PyObject* def = Py_None;
<a name="l02345"></a>02345     PyObject* ret;
<a name="l02346"></a>02346 
<a name="l02347"></a>02347     <span class="keywordflow">if</span> (!PyArg_ParseTuple(args, <span class="stringliteral">&quot;O|O:get&quot;</span>, &amp;key, &amp;def))
<a name="l02348"></a>02348         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02349"></a>02349     
<a name="l02350"></a>02350     <span class="keywordflow">if</span> (m_attr_dict &amp;&amp; (ret=PyDict_GetItem(m_attr_dict, key))) {
<a name="l02351"></a>02351         Py_INCREF(ret);
<a name="l02352"></a>02352         <span class="keywordflow">return</span> ret;
<a name="l02353"></a>02353     }
<a name="l02354"></a>02354     
<a name="l02355"></a>02355     Py_INCREF(def);
<a name="l02356"></a>02356     <span class="keywordflow">return</span> def;
<a name="l02357"></a>02357 }
<a name="l02358"></a>02358 
<a name="l02359"></a>02359 <span class="preprocessor">#endif // WITH_PYTHON</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:29 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

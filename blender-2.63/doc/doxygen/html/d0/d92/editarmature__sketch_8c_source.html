<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: editarmature_sketch.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">editarmature_sketch.c</div>  </div>
</div>
<div class="contents">
<a href="../../d0/d92/editarmature__sketch_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd0/BLI__graph_8h.html">BLI_graph.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d6a/BKE__sketch_8h.html">BKE_sketch.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="comment">//#include &quot;BIF_screen.h&quot;</span>
<a name="l00053"></a>00053 <span class="comment">//#include &quot;BIF_space.h&quot;</span>
<a name="l00054"></a>00054 <span class="comment">//#include &quot;BIF_mywindow.h&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d98/ED__armature_8h.html">ED_armature.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d26/armature__intern_8h.html">armature_intern.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="comment">//#include &quot;BIF_sketch.h&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d15/BIF__retarget_8h.html">BIF_retarget.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dad/BIF__generate_8h.html">BIF_generate.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="comment">//#include &quot;BIF_interface.h&quot;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df2/ED__transform_8h.html">ED_transform.h</a>&quot;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">//#include &quot;blendef.h&quot;</span>
<a name="l00068"></a>00068 <span class="comment">//#include &quot;mydevice.h&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d76/reeb_8h.html">reeb.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a254844a99a397e6b90a9101f86afe58d">00073</a> <span class="keyword">typedef</span> int  (*<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a254844a99a397e6b90a9101f86afe58d">GestureDetectFct</a>)(<a class="code" href="../../d5/df1/structbContext.html">bContext</a>*, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a>*, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *);
<a name="l00074"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a82c80fe73764ea590288bb4fe883e882">00074</a> <span class="keyword">typedef</span> void (*<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a82c80fe73764ea590288bb4fe883e882">GestureApplyFct</a>)(<a class="code" href="../../d5/df1/structbContext.html">bContext</a>*, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a>*, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *);
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="../../d9/d18/structSK__GestureAction.html">00076</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d18/structSK__GestureAction.html">SK_GestureAction</a> {
<a name="l00077"></a><a class="code" href="../../d9/d18/structSK__GestureAction.html#ac84b2adb5fc573ed75c31300c0413784">00077</a>     <span class="keywordtype">char</span> <a class="code" href="../../d9/d18/structSK__GestureAction.html#ac84b2adb5fc573ed75c31300c0413784">name</a>[64];
<a name="l00078"></a><a class="code" href="../../d9/d18/structSK__GestureAction.html#aeaa36c79582fd1d186ee577b34bc8b84">00078</a>     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a254844a99a397e6b90a9101f86afe58d">GestureDetectFct</a>    <a class="code" href="../../d9/d18/structSK__GestureAction.html#aeaa36c79582fd1d186ee577b34bc8b84">detect</a>;
<a name="l00079"></a><a class="code" href="../../d9/d18/structSK__GestureAction.html#abb50a876bca21114bcecb52b32c0eb19">00079</a>     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a82c80fe73764ea590288bb4fe883e882">GestureApplyFct</a>     <a class="code" href="../../d9/d18/structSK__GestureAction.html#abb50a876bca21114bcecb52b32c0eb19">apply</a>;
<a name="l00080"></a>00080 } <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aae5ab3e1a15adf6d539dd882f702c822">SK_GestureAction</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="preprocessor">#if 0 </span><span class="comment">/* UNUSED 2.5 */</span>
<a name="l00083"></a>00083 <span class="keyword">static</span> <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> boneSnap;
<a name="l00084"></a>00084 <span class="preprocessor">#endif</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab84899a8a580131b3d9a5bd84f1c2eb7">00086</a> <span class="keyword">static</span> <span class="keywordtype">int</span>    <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab84899a8a580131b3d9a5bd84f1c2eb7">LAST_SNAP_POINT_VALID</a> = 0;
<a name="l00087"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6e5e0ad3e287aa921f6a8044d3159e3">00087</a> <span class="keyword">static</span> <span class="keywordtype">float</span>  <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6e5e0ad3e287aa921f6a8044d3159e3">LAST_SNAP_POINT</a>[3];
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html">00090</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> {
<a name="l00091"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2b7aca3bd60742cc4e55a4bfd71d0cf7">00091</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#a065a69cf25d1066d67773d0db6c90d14">HeadFct</a>     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2b7aca3bd60742cc4e55a4bfd71d0cf7">head</a>;
<a name="l00092"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5acf1e1570345ac0fd05e4f494cc2984">00092</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#ab5bf3ca60b2d0770a27bf539d58f38c9">TailFct</a>     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5acf1e1570345ac0fd05e4f494cc2984">tail</a>;
<a name="l00093"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5eb9adade8b1ff7ab738846ea2d37e8f">00093</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#a6c0684e7f3d3e6a4b440fb668006cbd7">PeekFct</a>     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5eb9adade8b1ff7ab738846ea2d37e8f">peek</a>;
<a name="l00094"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a57e645673904073d8385afcc1b200a7a">00094</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#a18761ae06cedf73ea0e7d79dc1420795">NextFct</a>     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a57e645673904073d8385afcc1b200a7a">next</a>;
<a name="l00095"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5e72105df5126fa99c81416d95f7a95c">00095</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#a0059b50cd598b1e4eaa2786d2964ff77">NextNFct</a>    <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5e72105df5126fa99c81416d95f7a95c">nextN</a>;
<a name="l00096"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a230a054bca570bd9b4860b6eb41e9bf2">00096</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#a2a1236d48e003b873054f671c4253e62">PreviousFct</a> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a230a054bca570bd9b4860b6eb41e9bf2">previous</a>;
<a name="l00097"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#ae1afa46301b731122933cddfbb2f5baa">00097</a>     <a class="code" href="../../d3/dd0/BLI__graph_8h.html#a488a4d2e71dc7a57fcded19857012cd0">StoppedFct</a>  <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#ae1afa46301b731122933cddfbb2f5baa">stopped</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a403bb8445721c83d27d3a412c7f04550">00099</a>     <span class="keywordtype">float</span> *<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a403bb8445721c83d27d3a412c7f04550">p</a>, *<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a1c76a30cd0702ee8e4c667cea0775842">no</a>;
<a name="l00100"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a7f3412262250d3728a4de161cf489d53">00100</a>     <span class="keywordtype">float</span> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a7f3412262250d3728a4de161cf489d53">size</a>;
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#aa5d00eb3dc617bf885107e37fd9ed3aa">00102</a>     <span class="keywordtype">int</span> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#aa5d00eb3dc617bf885107e37fd9ed3aa">length</a>;
<a name="l00103"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">00103</a>     <span class="keywordtype">int</span> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a>;
<a name="l00104"></a>00104     <span class="comment">/*********************************/</span>
<a name="l00105"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a467c5770fa18e663a8dbde88a405a1d5">00105</a>     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a467c5770fa18e663a8dbde88a405a1d5">stroke</a>;
<a name="l00106"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">00106</a>     <span class="keywordtype">int</span> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">start</a>;
<a name="l00107"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a319e0f6bc6ba3f7b2ffcfff60210e8b2">00107</a>     <span class="keywordtype">int</span> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a319e0f6bc6ba3f7b2ffcfff60210e8b2">end</a>;
<a name="l00108"></a><a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">00108</a>     <span class="keywordtype">int</span> <a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a>;
<a name="l00109"></a>00109 } <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af59be563f1c34bf1984276399d217762">SK_StrokeIterator</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">/******************** PROTOTYPES ******************************/</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee297b0a6157a5c37a1cdaff384d958d">initStrokeIterator</a>(<a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a> *iter, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a888d8739df031ff9f4fcd2fea4743128">sk_detectCutGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00116"></a>00116 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae0ea75d8bf13477b9506235442541c56">sk_applyCutGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00117"></a>00117 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a265cccf66af1c0b33ba824ae4483ab7c">sk_detectTrimGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00118"></a>00118 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a243c73a78af71ae43eb3efdcb0c1c9df">sk_applyTrimGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00119"></a>00119 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae58896306f50928aabe60e5397e855e4">sk_detectCommandGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00120"></a>00120 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3c086399e333a83c64d40d5464325dfd">sk_applyCommandGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00121"></a>00121 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afd4ce8801ac1338d31f605722e69874a">sk_detectDeleteGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00122"></a>00122 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a63c64b5ea14834d44ec00e9fed95a345">sk_applyDeleteGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00123"></a>00123 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae731451a9db73a60bd00e89903f18262">sk_detectMergeGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00124"></a>00124 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa5bd5d3f99a94efc669cfb8213d11f89">sk_applyMergeGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00125"></a>00125 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5b5b05615e1ababadcb6097676a44cb7">sk_detectReverseGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00126"></a>00126 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aaa121be88395b20bc437b90c3759fd37">sk_applyReverseGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00127"></a>00127 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a380c3ff51afa1846a6994ec63bd5ca24">sk_detectConvertGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00128"></a>00128 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a73aabf16980a3753034e85ddd1cb91be">sk_applyConvertGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *c, <span class="keywordtype">int</span> create);
<a name="l00131"></a>00131 <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5f01d6375a9f8da8de54c65b689e6406">viewcontextSketch</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc, <span class="keywordtype">int</span> create);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0c809e3b8c545e87fc828886f06506e6">sk_resetOverdraw</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch);
<a name="l00134"></a>00134 <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1afb0a0fb276119809a18d8585da89cc">sk_hasOverdraw</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">/******************** GESTURE ACTIONS ******************************/</span>
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a84c1e7f8cbfd927c2cc3849d7693db55">00138</a> <span class="keyword">static</span> <a class="code" href="../../d9/d18/structSK__GestureAction.html">SK_GestureAction</a> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a84c1e7f8cbfd927c2cc3849d7693db55">GESTURE_ACTIONS</a>[] =
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         {<span class="stringliteral">&quot;Cut&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a888d8739df031ff9f4fcd2fea4743128">sk_detectCutGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae0ea75d8bf13477b9506235442541c56">sk_applyCutGesture</a>},
<a name="l00141"></a>00141         {<span class="stringliteral">&quot;Trim&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a265cccf66af1c0b33ba824ae4483ab7c">sk_detectTrimGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a243c73a78af71ae43eb3efdcb0c1c9df">sk_applyTrimGesture</a>},
<a name="l00142"></a>00142         {<span class="stringliteral">&quot;Command&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae58896306f50928aabe60e5397e855e4">sk_detectCommandGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3c086399e333a83c64d40d5464325dfd">sk_applyCommandGesture</a>},
<a name="l00143"></a>00143         {<span class="stringliteral">&quot;Delete&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afd4ce8801ac1338d31f605722e69874a">sk_detectDeleteGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a63c64b5ea14834d44ec00e9fed95a345">sk_applyDeleteGesture</a>},
<a name="l00144"></a>00144         {<span class="stringliteral">&quot;Merge&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae731451a9db73a60bd00e89903f18262">sk_detectMergeGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa5bd5d3f99a94efc669cfb8213d11f89">sk_applyMergeGesture</a>},
<a name="l00145"></a>00145         {<span class="stringliteral">&quot;Reverse&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5b5b05615e1ababadcb6097676a44cb7">sk_detectReverseGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aaa121be88395b20bc437b90c3759fd37">sk_applyReverseGesture</a>},
<a name="l00146"></a>00146         {<span class="stringliteral">&quot;Convert&quot;</span>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a380c3ff51afa1846a6994ec63bd5ca24">sk_detectConvertGesture</a>, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a73aabf16980a3753034e85ddd1cb91be">sk_applyConvertGesture</a>},
<a name="l00147"></a>00147         {<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}
<a name="l00148"></a>00148     };
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="comment">/******************** TEMPLATES UTILS *************************/</span>
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">00152</a> <span class="keyword">static</span> <span class="keywordtype">char</span>  *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00153"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">00153</a> <span class="keyword">static</span> <span class="keywordtype">int</span>    <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">TEMPLATES_CURRENT</a> = 0;
<a name="l00154"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af29e6d49f9e12e4d13633399c4d21e5f">00154</a> <span class="keyword">static</span> <a class="code" href="../../df/da0/structGHash.html">GHash</a> *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af29e6d49f9e12e4d13633399c4d21e5f">TEMPLATES_HASH</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00155"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7515b222a41d9f31bc3e57a192972a5f">00155</a> <span class="keyword">static</span> <a class="code" href="../../db/de6/structRigGraph.html">RigGraph</a> *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7515b222a41d9f31bc3e57a192972a5f">TEMPLATE_RIGG</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af984e13df8b9e62f892de984e669a138">00157</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af984e13df8b9e62f892de984e669a138">BIF_makeListTemplates</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00160"></a>00160     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00161"></a>00161     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00162"></a>00162     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l00163"></a>00163     <span class="keywordtype">int</span> index = 0;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (TEMPLATES_HASH != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(TEMPLATES_HASH, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     TEMPLATES_HASH = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a740dc6d654384d5ad7097ffb19d3427c">BLI_ghashutil_inthash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#aafcc0f47fca1c35fee3ec515dfa43f15">BLI_ghashutil_intcmp</a>, <span class="stringliteral">&quot;makeListTemplates gh&quot;</span>);
<a name="l00171"></a>00171     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">TEMPLATES_CURRENT</a> = 0;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="keywordflow">for</span> ( base = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8e4d7097454ad5b3dfde455bf35b6450">FIRSTBASE</a>; base; base = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a> )
<a name="l00174"></a>00174     {
<a name="l00175"></a>00175         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="keywordflow">if</span> (ob != obedit &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>)
<a name="l00178"></a>00178         {
<a name="l00179"></a>00179             index++;
<a name="l00180"></a>00180             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(TEMPLATES_HASH, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa6f58f8bcd4649b89458079eae9b1a1f">SET_INT_IN_POINTER</a>(index), ob);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182             <span class="keywordflow">if</span> (ob == ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a>)
<a name="l00183"></a>00183             {
<a name="l00184"></a>00184                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">TEMPLATES_CURRENT</a> = index;
<a name="l00185"></a>00185             }
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6c08ef548d619e5a5d40ff2afc1134d4">00190</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6c08ef548d619e5a5d40ff2afc1134d4">BIF_listTemplates</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>))
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192     <a class="code" href="../../d2/d31/structGHashIterator.html">GHashIterator</a> ghi;
<a name="l00193"></a>00193     <span class="keywordtype">char</span> menu_header[] = <span class="stringliteral">&quot;Template%t|None%x0|&quot;</span>;
<a name="l00194"></a>00194     <span class="keywordtype">char</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a>);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2f636817c33fecf8de5e18f30fba0879">BLI_ghash_size</a>(TEMPLATES_HASH) * 32 + 30), <span class="stringliteral">&quot;skeleton template menu&quot;</span>);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     p = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     p += sprintf(<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a>, <span class="stringliteral">&quot;%s&quot;</span>, menu_header);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ae5c7898e6699144374188f0e06ac5d9e">BLI_ghashIterator_init</a>(&amp;ghi, TEMPLATES_HASH);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="keywordflow">while</span> (!<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a0eff6b7b74d72e06f7c125da5a46a5f1">BLI_ghashIterator_isDone</a>(&amp;ghi))
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a65c048ac3140f6c2598d94e4276a41f3">BLI_ghashIterator_getValue</a>(&amp;ghi);
<a name="l00212"></a>00212         <span class="keywordtype">int</span> key = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#afe52e69b7f74d4e0319b467db917c08c">GET_INT_FROM_POINTER</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a61c902d18de9cdd3785ef33e598d360f">BLI_ghashIterator_getKey</a>(&amp;ghi));
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         p += sprintf(p, <span class="stringliteral">&quot;|%s%%x%i&quot;</span>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, key);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2d3ebd2fe8ee454695c6387215e3e88a">BLI_ghashIterator_step</a>(&amp;ghi);
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="keywordflow">return</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a>;
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af34d4ee31ce92c3b7d32221a08d1857b">00222</a> <span class="keywordtype">int</span>   <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af34d4ee31ce92c3b7d32221a08d1857b">BIF_currentTemplate</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">TEMPLATES_CURRENT</a> == 0 &amp;&amp; ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00227"></a>00227     {
<a name="l00228"></a>00228         <a class="code" href="../../d2/d31/structGHashIterator.html">GHashIterator</a> ghi;
<a name="l00229"></a>00229         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ae5c7898e6699144374188f0e06ac5d9e">BLI_ghashIterator_init</a>(&amp;ghi, TEMPLATES_HASH);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="keywordflow">while</span> (!<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a0eff6b7b74d72e06f7c125da5a46a5f1">BLI_ghashIterator_isDone</a>(&amp;ghi))
<a name="l00232"></a>00232         {
<a name="l00233"></a>00233             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a65c048ac3140f6c2598d94e4276a41f3">BLI_ghashIterator_getValue</a>(&amp;ghi);
<a name="l00234"></a>00234             <span class="keywordtype">int</span> key = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#afe52e69b7f74d4e0319b467db917c08c">GET_INT_FROM_POINTER</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a61c902d18de9cdd3785ef33e598d360f">BLI_ghashIterator_getKey</a>(&amp;ghi));
<a name="l00235"></a>00235 
<a name="l00236"></a>00236             <span class="keywordflow">if</span> (ob == ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a>)
<a name="l00237"></a>00237             {
<a name="l00238"></a>00238                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">TEMPLATES_CURRENT</a> = key;
<a name="l00239"></a>00239                 <span class="keywordflow">break</span>;
<a name="l00240"></a>00240             }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2d3ebd2fe8ee454695c6387215e3e88a">BLI_ghashIterator_step</a>(&amp;ghi);
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordflow">return</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab334e92aab10453bb0b7a8cc8dddff5e">TEMPLATES_CURRENT</a>;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afc7d608275be2c994663af6b98924866">00249</a> <span class="keyword">static</span> <a class="code" href="../../db/de6/structRigGraph.html">RigGraph</a>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afc7d608275be2c994663af6b98924866">sk_makeTemplateGraph</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00252"></a>00252     <span class="keywordflow">if</span> (ob == obedit)
<a name="l00253"></a>00253     {
<a name="l00254"></a>00254         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (ob != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00258"></a>00258     {
<a name="l00259"></a>00259         <span class="keywordflow">if</span> (TEMPLATE_RIGG &amp;&amp; TEMPLATE_RIGG-&gt;<a class="code" href="../../db/de6/structRigGraph.html#a6a51b3181c53352614417637cdd37f7d">ob</a> != ob)
<a name="l00260"></a>00260         {
<a name="l00261"></a>00261             <a class="code" href="../../dc/d15/BIF__retarget_8h.html#a4ada5eda1baaddc3c10197e2b0bec7d8">RIG_freeRigGraph</a>((<a class="code" href="../../d0/d31/structBGraph.html">BGraph</a>*)TEMPLATE_RIGG);
<a name="l00262"></a>00262             TEMPLATE_RIGG = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (TEMPLATE_RIGG == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00266"></a>00266         {
<a name="l00267"></a>00267             <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269             arm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271             TEMPLATE_RIGG = <a class="code" href="../../dc/d15/BIF__retarget_8h.html#a378f80405c937eac03da2be7b12a46e1">RIG_graphFromArmature</a>(C, ob, arm);
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">return</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7515b222a41d9f31bc3e57a192972a5f">TEMPLATE_RIGG</a>;
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0cf551c75096f787fd89c149afdfa4ff">00278</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0cf551c75096f787fd89c149afdfa4ff">BIF_nbJointsTemplate</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00281"></a>00281     <a class="code" href="../../db/de6/structRigGraph.html">RigGraph</a> *rg = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afc7d608275be2c994663af6b98924866">sk_makeTemplateGraph</a>(C, ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a>);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (rg)
<a name="l00284"></a>00284     {
<a name="l00285"></a>00285         <span class="keywordflow">return</span> <a class="code" href="../../dc/d15/BIF__retarget_8h.html#abd52b663e368b528abc713e0f302cbf4">RIG_nbJoints</a>(rg);
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     <span class="keywordflow">else</span>
<a name="l00288"></a>00288     {
<a name="l00289"></a>00289         <span class="keywordflow">return</span> -1;
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace858b29979149c891e02db922d3c352">00293</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace858b29979149c891e02db922d3c352">BIF_nameBoneTemplate</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00296"></a>00296     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *stk = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1);
<a name="l00297"></a>00297     <a class="code" href="../../db/de6/structRigGraph.html">RigGraph</a> *rg;
<a name="l00298"></a>00298     <span class="keywordtype">int</span> index = 0;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (stk &amp;&amp; stk-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         index = stk-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>;
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     rg = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afc7d608275be2c994663af6b98924866">sk_makeTemplateGraph</a>(C, ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a>);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (rg == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00308"></a>00308     {
<a name="l00309"></a>00309         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="keywordflow">return</span> <a class="code" href="../../dc/d15/BIF__retarget_8h.html#a72738b9f64deac78701626ce7152d166">RIG_nameBone</a>(rg, 0, index);
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ad7295b1964bb6e46653a4e2791ef56cc">00315</a> <span class="keywordtype">void</span>  <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ad7295b1964bb6e46653a4e2791ef56cc">BIF_freeTemplates</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>))
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00318"></a>00318     {
<a name="l00319"></a>00319         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a>);
<a name="l00320"></a>00320         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8657bf126d18ebce9536628c0900ef68">TEMPLATES_MENU</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (TEMPLATES_HASH != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(TEMPLATES_HASH, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00326"></a>00326         TEMPLATES_HASH = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (TEMPLATE_RIGG != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331         <a class="code" href="../../dc/d15/BIF__retarget_8h.html#a4ada5eda1baaddc3c10197e2b0bec7d8">RIG_freeRigGraph</a>((<a class="code" href="../../d0/d31/structBGraph.html">BGraph</a>*)TEMPLATE_RIGG);
<a name="l00332"></a>00332         TEMPLATE_RIGG = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="../../d1/d98/ED__armature_8h.html#ac9ab66ad57d4166d838d5e2b90cbf029">00336</a> <span class="keywordtype">void</span>  <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea56580eaabddc9329772a968098374a">BIF_setTemplate</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">int</span> index)
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00339"></a>00339     <span class="keywordflow">if</span> (index &gt; 0)
<a name="l00340"></a>00340     {
<a name="l00341"></a>00341         ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a> = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(TEMPLATES_HASH, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa6f58f8bcd4649b89458079eae9b1a1f">SET_INT_IN_POINTER</a>(index));
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343     <span class="keywordflow">else</span>
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345         ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         <span class="keywordflow">if</span> (TEMPLATE_RIGG != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00348"></a>00348         {
<a name="l00349"></a>00349             <a class="code" href="../../dc/d15/BIF__retarget_8h.html#a4ada5eda1baaddc3c10197e2b0bec7d8">RIG_freeRigGraph</a>((<a class="code" href="../../d0/d31/structBGraph.html">BGraph</a>*)TEMPLATE_RIGG);
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351         TEMPLATE_RIGG = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="comment">/*********************** CONVERSION ***************************/</span>
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0096ac0a78929746e31af7dee96ac6b8">00357</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0096ac0a78929746e31af7dee96ac6b8">sk_autoname</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d0/dc1/structReebArc.html">ReebArc</a> *arc)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a1db1018b3469815b20f26b4da45107fa">skgen_retarget_options</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a784b176b7c325d978eae3d361350ff84">SK_RETARGET_AUTONAME</a>)
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362         <span class="keywordflow">if</span> (arc == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00363"></a>00363         {
<a name="l00364"></a>00364             <span class="keywordtype">char</span> *num = ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#acb65e306b6b2040af986df1f639e2ba3">skgen_num_string</a>;
<a name="l00365"></a>00365             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = atoi(num);
<a name="l00366"></a>00366             i++;
<a name="l00367"></a>00367             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(num, 8, <span class="stringliteral">&quot;%i&quot;</span>, i);
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369         <span class="keywordflow">else</span>
<a name="l00370"></a>00370         {
<a name="l00371"></a>00371             <span class="keywordtype">char</span> *side = ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a82e1b8d343b4ab1a3a1b3a74d5ccf826">skgen_side_string</a>;
<a name="l00372"></a>00372             <span class="keywordtype">int</span> valid = 0;
<a name="l00373"></a>00373             <span class="keywordtype">int</span> caps = 0;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375             <span class="keywordflow">if</span> (side[0] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00376"></a>00376             {
<a name="l00377"></a>00377                 valid = 1;
<a name="l00378"></a>00378             }
<a name="l00379"></a>00379             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(side, <span class="stringliteral">&quot;R&quot;</span>)==0 || strcmp(side, <span class="stringliteral">&quot;L&quot;</span>)==0)
<a name="l00380"></a>00380             {
<a name="l00381"></a>00381                 valid = 1;
<a name="l00382"></a>00382                 caps = 1;
<a name="l00383"></a>00383             }
<a name="l00384"></a>00384             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(side, <span class="stringliteral">&quot;r&quot;</span>)==0 || strcmp(side, <span class="stringliteral">&quot;l&quot;</span>)==0)
<a name="l00385"></a>00385             {
<a name="l00386"></a>00386                 valid = 1;
<a name="l00387"></a>00387                 caps = 0;
<a name="l00388"></a>00388             }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390             <span class="keywordflow">if</span> (valid)
<a name="l00391"></a>00391             {
<a name="l00392"></a>00392                 <span class="keywordflow">if</span> (arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a9da6e154a0e84c6185d2abf18261f6b3">head</a>-&gt;<a class="code" href="../../da/d14/structReebNode.html#a531e3c11f126ba6705d037004711f171">p</a>[0] &lt; 0)
<a name="l00393"></a>00393                 {
<a name="l00394"></a>00394                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(side, 8, caps?<span class="stringliteral">&quot;R&quot;</span>:<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00395"></a>00395                 }
<a name="l00396"></a>00396                 <span class="keywordflow">else</span>
<a name="l00397"></a>00397                 {
<a name="l00398"></a>00398                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(side, 8, caps?<span class="stringliteral">&quot;L&quot;</span>:<span class="stringliteral">&quot;l&quot;</span>);
<a name="l00399"></a>00399                 }
<a name="l00400"></a>00400             }
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1fd763ad9b581ef7157554dbd425eb2c">00405</a> <span class="keyword">static</span> <a class="code" href="../../da/d14/structReebNode.html">ReebNode</a> *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1fd763ad9b581ef7157554dbd425eb2c">sk_pointToNode</a>(<a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <span class="keywordtype">float</span> imat[][4], <span class="keywordtype">float</span> tmat[][3])
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407     <a class="code" href="../../da/d14/structReebNode.html">ReebNode</a> *node;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     node = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d14/structReebNode.html">ReebNode</a>), <span class="stringliteral">&quot;reeb node&quot;</span>);
<a name="l00410"></a>00410     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(node-&gt;<a class="code" href="../../da/d14/structReebNode.html#a531e3c11f126ba6705d037004711f171">p</a>, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l00411"></a>00411     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(imat, node-&gt;<a class="code" href="../../da/d14/structReebNode.html#a531e3c11f126ba6705d037004711f171">p</a>);
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(node-&gt;<a class="code" href="../../da/d14/structReebNode.html#a887ee9180490992b46104d7836435936">no</a>, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>);
<a name="l00414"></a>00414     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tmat, node-&gt;<a class="code" href="../../da/d14/structReebNode.html#a887ee9180490992b46104d7836435936">no</a>);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">return</span> node;
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acc756c559392229727704022eb6b26cb">00419</a> <span class="keyword">static</span> <a class="code" href="../../d0/dc1/structReebArc.html">ReebArc</a> *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acc756c559392229727704022eb6b26cb">sk_strokeToArc</a>(<a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <span class="keywordtype">float</span> imat[][4], <span class="keywordtype">float</span> tmat[][3])
<a name="l00420"></a>00420 {
<a name="l00421"></a>00421     <a class="code" href="../../d0/dc1/structReebArc.html">ReebArc</a> *arc;
<a name="l00422"></a>00422     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     arc = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc1/structReebArc.html">ReebArc</a>), <span class="stringliteral">&quot;reeb arc&quot;</span>);
<a name="l00425"></a>00425     arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a9da6e154a0e84c6185d2abf18261f6b3">head</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1fd763ad9b581ef7157554dbd425eb2c">sk_pointToNode</a>(stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>, imat, tmat);
<a name="l00426"></a>00426     arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a8efc890a6ba67bd2a0ef6dc7b9692e29">tail</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1fd763ad9b581ef7157554dbd425eb2c">sk_pointToNode</a>(<a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(stk), imat, tmat);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a0fa5154a652d5a6850f1fb3ad23e91b8">bcount</a> = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 2; <span class="comment">/* first and last are nodes, don&#39;t count */</span>
<a name="l00429"></a>00429     arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a23f7b86e6f92fc941384cbadef4f875c">buckets</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/dd8/structEmbedBucket.html">EmbedBucket</a>) * arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a0fa5154a652d5a6850f1fb3ad23e91b8">bcount</a>, <span class="stringliteral">&quot;Buckets&quot;</span>);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="keywordflow">for</span> (i = 0; i &lt; arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a0fa5154a652d5a6850f1fb3ad23e91b8">bcount</a>; i++)
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a23f7b86e6f92fc941384cbadef4f875c">buckets</a>[i].<a class="code" href="../../d1/dd8/structEmbedBucket.html#a909132d17a0ff9dc6a7a5a2ee81ac60e">p</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l00434"></a>00434         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(imat, arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a23f7b86e6f92fc941384cbadef4f875c">buckets</a>[i].<a class="code" href="../../d1/dd8/structEmbedBucket.html#a909132d17a0ff9dc6a7a5a2ee81ac60e">p</a>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a23f7b86e6f92fc941384cbadef4f875c">buckets</a>[i].<a class="code" href="../../d1/dd8/structEmbedBucket.html#a0df892751d169daa144b2ead686c9d29">no</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>);
<a name="l00437"></a>00437         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tmat, arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a23f7b86e6f92fc941384cbadef4f875c">buckets</a>[i].<a class="code" href="../../d1/dd8/structEmbedBucket.html#a0df892751d169daa144b2ead686c9d29">no</a>);
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="keywordflow">return</span> arc;
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abcfddc2b9b8f68fa515413b30af17b3a">00443</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abcfddc2b9b8f68fa515413b30af17b3a">sk_retargetStroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00446"></a>00446     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00447"></a>00447     <span class="keywordtype">float</span> imat[4][4];
<a name="l00448"></a>00448     <span class="keywordtype">float</span> tmat[3][3];
<a name="l00449"></a>00449     <a class="code" href="../../d0/dc1/structReebArc.html">ReebArc</a> *arc;
<a name="l00450"></a>00450     <a class="code" href="../../db/de6/structRigGraph.html">RigGraph</a> *rg;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(tmat, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00455"></a>00455     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad34fc69317ce2354d58d80147b753408">transpose_m3</a>(tmat);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     arc = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acc756c559392229727704022eb6b26cb">sk_strokeToArc</a>(stk, imat, tmat);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0096ac0a78929746e31af7dee96ac6b8">sk_autoname</a>(C, arc);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     rg = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afc7d608275be2c994663af6b98924866">sk_makeTemplateGraph</a>(C, ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a>);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <a class="code" href="../../dc/d15/BIF__retarget_8h.html#ad2851496c90c421b573f44388474d03b">BIF_retargetArc</a>(C, arc, rg);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0096ac0a78929746e31af7dee96ac6b8">sk_autoname</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a9da6e154a0e84c6185d2abf18261f6b3">head</a>);
<a name="l00468"></a>00468     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(arc-&gt;<a class="code" href="../../d0/dc1/structReebArc.html#a8efc890a6ba67bd2a0ef6dc7b9692e29">tail</a>);
<a name="l00469"></a>00469     <a class="code" href="../../d2/dd8/reeb_8c.html#a7b06a4c8dd8fa1f1a5a6355ba250ade3">REEB_freeArc</a>((<a class="code" href="../../d9/d4f/structBArc.html">BArc</a>*)arc);
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 <span class="comment">/**************************************************************/</span>
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee378f7c6191662f7e64c4a6cdb4f4ba">00474</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee378f7c6191662f7e64c4a6cdb4f4ba">sk_cancelStroke</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476     <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00477"></a>00477     {
<a name="l00478"></a>00478         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0c809e3b8c545e87fc828886f06506e6">sk_resetOverdraw</a>(sketch);
<a name="l00479"></a>00479         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a0dc330dc52840b50934a2ca5f3f90802">sk_removeStroke</a>(sketch, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>);
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">00484</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">sk_clampPointSize</a>(<a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486     <span class="keywordflow">return</span> <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(size * pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#ac298259f58c30fdfb2a274ed3ed4c885">size</a>, size / 2);
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">00489</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">sk_drawPoint</a>(GLUquadric *quad, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00490"></a>00490 {
<a name="l00491"></a>00491     glTranslatef(pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>[0], pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>[1], pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>[2]);
<a name="l00492"></a>00492     gluSphere(quad, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">sk_clampPointSize</a>(pt, size), 8, 8);
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a61c333fbb86e22ca70f94a988c64e4ea">00495</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a61c333fbb86e22ca70f94a988c64e4ea">sk_drawEdge</a>(GLUquadric *quad, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt0, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt1, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <span class="keywordtype">float</span> vec1[3], vec2[3] = {0, 0, 1}, axis[3];
<a name="l00498"></a>00498     <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec1, pt1-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, pt0-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l00501"></a>00501     length = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec1);
<a name="l00502"></a>00502     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(axis, vec2, vec1);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a212d65c08323cdf9e10d72e1775e94c2">is_zero_v3</a>(axis))
<a name="l00505"></a>00505     {
<a name="l00506"></a>00506         axis[1] = 1;
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     angle = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(vec2, vec1);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     glRotatef(angle * (<span class="keywordtype">float</span>)(180.0/<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>) + 180.0f, axis[0], axis[1], axis[2]);
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     gluCylinder(quad, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">sk_clampPointSize</a>(pt1, size), <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">sk_clampPointSize</a>(pt0, size), length, 8, 8);
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a21ff9b58056a52dc900ed9e71a3d1988">00516</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a21ff9b58056a52dc900ed9e71a3d1988">sk_drawNormal</a>(GLUquadric *quad, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>, <span class="keywordtype">float</span> height)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518     <span class="keywordtype">float</span> vec2[3] = {0, 0, 1}, axis[3];
<a name="l00519"></a>00519     <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l00520"></a>00520     
<a name="l00521"></a>00521     glPushMatrix();
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(axis, vec2, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a212d65c08323cdf9e10d72e1775e94c2">is_zero_v3</a>(axis))
<a name="l00526"></a>00526     {
<a name="l00527"></a>00527         axis[1] = 1;
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     angle = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(vec2, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     glRotatef(angle * (<span class="keywordtype">float</span>)(180.0/<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>), axis[0], axis[1], axis[2]);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     glColor3f(0, 1, 1);
<a name="l00535"></a>00535     gluCylinder(quad, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">sk_clampPointSize</a>(pt, size), 0, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab3c6d57d65c29034ef01604c048b1fd6">sk_clampPointSize</a>(pt, height), 10, 2);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     glPopMatrix();
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a26e673c5e9c11330722fd6ede7255925">00540</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a26e673c5e9c11330722fd6ede7255925">sk_drawStroke</a>(<a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">float</span> color[3], <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542     <span class="keywordtype">float</span> rgb[3];
<a name="l00543"></a>00543     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00544"></a>00544     GLUquadric *quad = gluNewQuadric();
<a name="l00545"></a>00545     gluQuadricNormals(quad, GLU_SMOOTH);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != -1)
<a name="l00548"></a>00548     {
<a name="l00549"></a>00549         glLoadName(<span class="keywordtype">id</span>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551         <span class="keywordflow">for</span> (i = 0; i &lt; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>; i++)
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553             glPushMatrix();
<a name="l00554"></a>00554 
<a name="l00555"></a>00555             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">sk_drawPoint</a>(quad, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + i, 0.1);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557             <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00558"></a>00558             {
<a name="l00559"></a>00559                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a61c333fbb86e22ca70f94a988c64e4ea">sk_drawEdge</a>(quad, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + i - 1, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + i, 0.1);
<a name="l00560"></a>00560             }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562             glPopMatrix();
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566     <span class="keywordflow">else</span>
<a name="l00567"></a>00567     {
<a name="l00568"></a>00568         <span class="keywordtype">float</span> d_rgb[3] = {1, 1, 1};
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(rgb, color);
<a name="l00571"></a>00571         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(d_rgb, rgb);
<a name="l00572"></a>00572         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(d_rgb, 1.0f / (<span class="keywordtype">float</span>)stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574         <span class="keywordflow">for</span> (i = 0; i &lt; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>; i++)
<a name="l00575"></a>00575         {
<a name="l00576"></a>00576             <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578             glPushMatrix();
<a name="l00579"></a>00579 
<a name="l00580"></a>00580             <span class="keywordflow">if</span> (pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l00581"></a>00581             {
<a name="l00582"></a>00582                 glColor3f(0, 0, 0);
<a name="l00583"></a>00583                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">sk_drawPoint</a>(quad, pt, 0.15);
<a name="l00584"></a>00584                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a21ff9b58056a52dc900ed9e71a3d1988">sk_drawNormal</a>(quad, pt, 0.05, 0.9);
<a name="l00585"></a>00585             }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587             <span class="keywordflow">if</span> (i &gt;= start &amp;&amp; i &lt;= end)
<a name="l00588"></a>00588             {
<a name="l00589"></a>00589                 glColor3f(0.3, 0.3, 0.3);
<a name="l00590"></a>00590             }
<a name="l00591"></a>00591             <span class="keywordflow">else</span>
<a name="l00592"></a>00592             {
<a name="l00593"></a>00593                 glColor3fv(rgb);
<a name="l00594"></a>00594             }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596             <span class="keywordflow">if</span> (pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> != <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l00597"></a>00597             {
<a name="l00598"></a>00598 
<a name="l00599"></a>00599                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">sk_drawPoint</a>(quad, pt, 0.1);
<a name="l00600"></a>00600             }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602             <span class="keywordflow">if</span> (i &gt; 0)
<a name="l00603"></a>00603             {
<a name="l00604"></a>00604                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a61c333fbb86e22ca70f94a988c64e4ea">sk_drawEdge</a>(quad, pt - 1, pt, 0.1);
<a name="l00605"></a>00605             }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607             glPopMatrix();
<a name="l00608"></a>00608 
<a name="l00609"></a>00609             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(rgb, d_rgb);
<a name="l00610"></a>00610         }
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     gluDeleteQuadric(quad);
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#adba332e37d52e253ca08b614cf323a56">00616</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#adba332e37d52e253ca08b614cf323a56">drawSubdividedStrokeBy</a>(<a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *toolsettings, <a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a> *iter, <a class="code" href="../../de/dad/BIF__generate_8h.html#a34105052f5e0ddf917afd3bd18bcc99b">NextSubdivisionFunc</a> next_subdividion)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk = ((<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)iter)-&gt;stroke;
<a name="l00619"></a>00619     <span class="keywordtype">float</span> head[3], tail[3];
<a name="l00620"></a>00620     <span class="keywordtype">int</span> bone_start = 0;
<a name="l00621"></a>00621     <span class="keywordtype">int</span> end = iter-&gt;<a class="code" href="../../d7/da3/structBArcIterator.html#af1d988a0974dc382c5cf91f7406e559f">length</a>;
<a name="l00622"></a>00622     <span class="keywordtype">int</span> index;
<a name="l00623"></a>00623     GLUquadric *quad = gluNewQuadric();
<a name="l00624"></a>00624     gluQuadricNormals(quad, GLU_SMOOTH);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     iter-&gt;<a class="code" href="../../d7/da3/structBArcIterator.html#ab84bf6d5a8fd8abed504030ed9b7e762">head</a>(iter);
<a name="l00627"></a>00627     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(head, iter-&gt;<a class="code" href="../../d7/da3/structBArcIterator.html#ab2ad35768c2da6593547c79bbffaa355">p</a>);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     index = next_subdividion(toolsettings, iter, bone_start, end, head, tail);
<a name="l00630"></a>00630     <span class="keywordflow">while</span> (index != -1)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + index;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         glPushMatrix();
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         glColor3f(0, 1, 0);
<a name="l00637"></a>00637         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">sk_drawPoint</a>(quad, pt, 0.15);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a21ff9b58056a52dc900ed9e71a3d1988">sk_drawNormal</a>(quad, pt, 0.05, 0.9);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641         glPopMatrix();
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(head, tail);
<a name="l00644"></a>00644         bone_start = index; <span class="comment">// start next bone from current index</span>
<a name="l00645"></a>00645 
<a name="l00646"></a>00646         index = next_subdividion(toolsettings, iter, bone_start, end, head, tail);
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     gluDeleteQuadric(quad);
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a80222a30c7f6021db776da5336ff8d3d">00652</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a80222a30c7f6021db776da5336ff8d3d">sk_drawStrokeSubdivision</a>(<a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *toolsettings, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk)
<a name="l00653"></a>00653 {
<a name="l00654"></a>00654     <span class="keywordtype">int</span> head_index = -1;
<a name="l00655"></a>00655     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">if</span> (toolsettings-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af3ea9eb5921c019deb65c7a4bc50f358">SK_CONVERT_RETARGET</a>)
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659         <span class="keywordflow">return</span>;
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="keywordflow">for</span> (i = 0; i &lt; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>; i++)
<a name="l00664"></a>00664     {
<a name="l00665"></a>00665         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667         <span class="keywordflow">if</span> (pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a> || i == stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1) <span class="comment">/* stop on exact or on last point */</span>
<a name="l00668"></a>00668         {
<a name="l00669"></a>00669             <span class="keywordflow">if</span> (head_index == -1)
<a name="l00670"></a>00670             {
<a name="l00671"></a>00671                 head_index = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00672"></a>00672             }
<a name="l00673"></a>00673             <span class="keywordflow">else</span>
<a name="l00674"></a>00674             {
<a name="l00675"></a>00675                 <span class="keywordflow">if</span> (i - head_index &gt; 1)
<a name="l00676"></a>00676                 {
<a name="l00677"></a>00677                     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> sk_iter;
<a name="l00678"></a>00678                     <a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a> *iter = (<a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a>*)&amp;sk_iter;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680                     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee297b0a6157a5c37a1cdaff384d958d">initStrokeIterator</a>(iter, stk, head_index, i);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682                     <span class="keywordflow">if</span> (toolsettings-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af6be1db48175aa40a8bce299a323b7fc">SK_CONVERT_CUT_ADAPTATIVE</a>)
<a name="l00683"></a>00683                     {
<a name="l00684"></a>00684                         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#adba332e37d52e253ca08b614cf323a56">drawSubdividedStrokeBy</a>(toolsettings, iter, <a class="code" href="../../de/dad/BIF__generate_8h.html#a0f6c6eb4f7eb04911abe87781d5e6cc5">nextAdaptativeSubdivision</a>);
<a name="l00685"></a>00685                     }
<a name="l00686"></a>00686                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (toolsettings-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a578fcd270ce326acf57b4559a1fbec75">SK_CONVERT_CUT_LENGTH</a>)
<a name="l00687"></a>00687                     {
<a name="l00688"></a>00688                         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#adba332e37d52e253ca08b614cf323a56">drawSubdividedStrokeBy</a>(toolsettings, iter, <a class="code" href="../../de/dad/BIF__generate_8h.html#a5a2568c2178400c3cae8701cef1b699c">nextLengthSubdivision</a>);
<a name="l00689"></a>00689                     }
<a name="l00690"></a>00690                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (toolsettings-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa66ae9067bc9dae8762c5bc88290c957">SK_CONVERT_CUT_FIXED</a>)
<a name="l00691"></a>00691                     {
<a name="l00692"></a>00692                         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#adba332e37d52e253ca08b614cf323a56">drawSubdividedStrokeBy</a>(toolsettings, iter, <a class="code" href="../../de/dad/BIF__generate_8h.html#a50e96e983870dde98f12d4590367d3d2">nextFixedSubdivision</a>);
<a name="l00693"></a>00693                     }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695                 }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697                 head_index = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00698"></a>00698             }
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bc140d404fc23f144bfe39105f54b18">00703</a> <span class="keyword">static</span> <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bc140d404fc23f144bfe39105f54b18">sk_snapPointStroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <span class="keywordtype">int</span> mval[2], <span class="keywordtype">int</span> *dist, <span class="keywordtype">int</span> *index, <span class="keywordtype">int</span> all_pts)
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00706"></a>00706     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00707"></a>00707     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     <span class="keywordflow">for</span> (i = 0; i &lt; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>; i++)
<a name="l00710"></a>00710     {
<a name="l00711"></a>00711         <span class="keywordflow">if</span> (all_pts || stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l00712"></a>00712         {
<a name="l00713"></a>00713             <span class="keywordtype">short</span> pval[2];
<a name="l00714"></a>00714             <span class="keywordtype">int</span> pdist;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(ar, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, pval);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718             pdist = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(pval[0] - mval[0]) + <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(pval[1] - mval[1]);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720             <span class="keywordflow">if</span> (pdist &lt; *dist)
<a name="l00721"></a>00721             {
<a name="l00722"></a>00722                 *dist = pdist;
<a name="l00723"></a>00723                 pt = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725                 <span class="keywordflow">if</span> (index != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00726"></a>00726                 {
<a name="l00727"></a>00727                     *index = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00728"></a>00728                 }
<a name="l00729"></a>00729             }
<a name="l00730"></a>00730         }
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     <span class="keywordflow">return</span> pt;
<a name="l00734"></a>00734 }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 <span class="preprocessor">#if 0 </span><span class="comment">/* UNUSED 2.5 */</span>
<a name="l00737"></a>00737 <span class="keyword">static</span> <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *sk_snapPointArmature(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *ebones, <span class="keywordtype">int</span> mval[2], <span class="keywordtype">int</span> *dist)
<a name="l00738"></a>00738 {
<a name="l00739"></a>00739     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00740"></a>00740     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00741"></a>00741     <a class="code" href="../../da/d29/structEditBone.html">EditBone</a> *bone;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="keywordflow">for</span> (bone = ebones-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bone; bone = bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a3625b4b7daa42dbfde160d0d8129e57b">next</a>)
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745         <span class="keywordtype">float</span> vec[3];
<a name="l00746"></a>00746         <span class="keywordtype">short</span> pval[2];
<a name="l00747"></a>00747         <span class="keywordtype">int</span> pdist;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">if</span> ((bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a6c7db9597e20d97ea4ae61eaacdc41fe">flag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50ad1063cb445c506fbb2eacef9f453a36e">BONE_CONNECTED</a>) == 0)
<a name="l00750"></a>00750         {
<a name="l00751"></a>00751             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#afb155f521bdb5d856ec84d95cd430861">head</a>);
<a name="l00752"></a>00752             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, vec);
<a name="l00753"></a>00753             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(ar, vec, pval);
<a name="l00754"></a>00754 
<a name="l00755"></a>00755             pdist = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(pval[0] - mval[0]) + <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(pval[1] - mval[1]);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757             <span class="keywordflow">if</span> (pdist &lt; *dist)
<a name="l00758"></a>00758             {
<a name="l00759"></a>00759                 *dist = pdist;
<a name="l00760"></a>00760                 pt = &amp;boneSnap;
<a name="l00761"></a>00761                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, vec);
<a name="l00762"></a>00762                 pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>;
<a name="l00763"></a>00763             }
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 
<a name="l00767"></a>00767         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a390914096213eba14510d2043f85a27f">tail</a>);
<a name="l00768"></a>00768         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, vec);
<a name="l00769"></a>00769         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(ar, vec, pval);
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         pdist = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(pval[0] - mval[0]) + <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(pval[1] - mval[1]);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773         <span class="keywordflow">if</span> (pdist &lt; *dist)
<a name="l00774"></a>00774         {
<a name="l00775"></a>00775             *dist = pdist;
<a name="l00776"></a>00776             pt = &amp;boneSnap;
<a name="l00777"></a>00777             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, vec);
<a name="l00778"></a>00778             pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>;
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782     <span class="keywordflow">return</span> pt;
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 <span class="preprocessor">#endif</span>
<a name="l00785"></a>00785 <span class="preprocessor"></span>
<a name="l00786"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0c809e3b8c545e87fc828886f06506e6">00786</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0c809e3b8c545e87fc828886f06506e6">sk_resetOverdraw</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00789"></a>00789     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#ac4bb9c919522e9bccc34e13503347933">start</a> = -1;
<a name="l00790"></a>00790     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a0d659422193665f7a42119b2923350a6">end</a> = -1;
<a name="l00791"></a>00791     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a4fbc236ce95049736495ff71443260e2">count</a> = 0;
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1afb0a0fb276119809a18d8585da89cc">00794</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1afb0a0fb276119809a18d8585da89cc">sk_hasOverdraw</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk)
<a name="l00795"></a>00795 {
<a name="l00796"></a>00796     <span class="keywordflow">return</span>  sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> &amp;&amp;
<a name="l00797"></a>00797             sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a4fbc236ce95049736495ff71443260e2">count</a> &gt;= <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4718bca8ff279f4c63aeaef495de98f8">SK_OVERDRAW_LIMIT</a> &amp;&amp;
<a name="l00798"></a>00798             (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> == stk || stk == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;
<a name="l00799"></a>00799             (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#ac4bb9c919522e9bccc34e13503347933">start</a> != -1 || sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a0d659422193665f7a42119b2923350a6">end</a> != -1);
<a name="l00800"></a>00800 }
<a name="l00801"></a>00801 
<a name="l00802"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a588fe0daade57603a14a6a82e495673f">00802</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a588fe0daade57603a14a6a82e495673f">sk_updateOverdraw</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l00803"></a>00803 {
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00805"></a>00805     {
<a name="l00806"></a>00806         <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *target;
<a name="l00807"></a>00807         <span class="keywordtype">int</span> closest_index = -1;
<a name="l00808"></a>00808         <span class="keywordtype">int</span> dist = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa979e15e313e62cff0fae8bcb909a0e5">SNAP_MIN_DISTANCE</a> * 2;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810         <span class="keywordflow">for</span> (target = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; target; target = target-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#ad8662a79b275692dfc889101fa38b6c6">next</a>)
<a name="l00811"></a>00811         {
<a name="l00812"></a>00812             <span class="keywordflow">if</span> (target != stk)
<a name="l00813"></a>00813             {
<a name="l00814"></a>00814                 <span class="keywordtype">int</span> index;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816                 <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *spt = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bc140d404fc23f144bfe39105f54b18">sk_snapPointStroke</a>(C, target, dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>, &amp;dist, &amp;index, 1);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818                 <span class="keywordflow">if</span> (spt != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00819"></a>00819                 {
<a name="l00820"></a>00820                     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> = target;
<a name="l00821"></a>00821                     closest_index = index;
<a name="l00822"></a>00822                 }
<a name="l00823"></a>00823             }
<a name="l00824"></a>00824         }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00827"></a>00827         {
<a name="l00828"></a>00828             <span class="keywordflow">if</span> (closest_index &gt; -1)
<a name="l00829"></a>00829             {
<a name="l00830"></a>00830                 <span class="keywordflow">if</span> (<a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(stk)-&gt;type == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l00831"></a>00831                 {
<a name="l00832"></a>00832                     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a4fbc236ce95049736495ff71443260e2">count</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4718bca8ff279f4c63aeaef495de98f8">SK_OVERDRAW_LIMIT</a>;
<a name="l00833"></a>00833                 }
<a name="l00834"></a>00834                 <span class="keywordflow">else</span>
<a name="l00835"></a>00835                 {
<a name="l00836"></a>00836                     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a4fbc236ce95049736495ff71443260e2">count</a>++;
<a name="l00837"></a>00837                 }
<a name="l00838"></a>00838             }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840             <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> == 1)
<a name="l00841"></a>00841             {
<a name="l00842"></a>00842                 sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#ac4bb9c919522e9bccc34e13503347933">start</a> = closest_index;
<a name="l00843"></a>00843             }
<a name="l00844"></a>00844             <span class="keywordflow">else</span>
<a name="l00845"></a>00845             {
<a name="l00846"></a>00846                 sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a0d659422193665f7a42119b2923350a6">end</a> = closest_index;
<a name="l00847"></a>00847             }
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00851"></a>00851     {
<a name="l00852"></a>00852         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *closest_pt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00853"></a>00853         <span class="keywordtype">int</span> dist = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa979e15e313e62cff0fae8bcb909a0e5">SNAP_MIN_DISTANCE</a> * 2;
<a name="l00854"></a>00854         <span class="keywordtype">int</span> index;
<a name="l00855"></a>00855 
<a name="l00856"></a>00856         closest_pt = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bc140d404fc23f144bfe39105f54b18">sk_snapPointStroke</a>(C, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a>, dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>, &amp;dist, &amp;index, 1);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         <span class="keywordflow">if</span> (closest_pt != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00859"></a>00859         {
<a name="l00860"></a>00860             <span class="keywordflow">if</span> (<a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(stk)-&gt;type == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l00861"></a>00861             {
<a name="l00862"></a>00862                 sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a4fbc236ce95049736495ff71443260e2">count</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4718bca8ff279f4c63aeaef495de98f8">SK_OVERDRAW_LIMIT</a>;
<a name="l00863"></a>00863             }
<a name="l00864"></a>00864             <span class="keywordflow">else</span>
<a name="l00865"></a>00865             {
<a name="l00866"></a>00866                 sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a4fbc236ce95049736495ff71443260e2">count</a>++;
<a name="l00867"></a>00867             }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869             sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a0d659422193665f7a42119b2923350a6">end</a> = index;
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871         <span class="keywordflow">else</span>
<a name="l00872"></a>00872         {
<a name="l00873"></a>00873             sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a0d659422193665f7a42119b2923350a6">end</a> = -1;
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876 }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878 <span class="comment">/* return 1 on reverse needed */</span>
<a name="l00879"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e3730bae7edc57d5e29b237ba05340c">00879</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e3730bae7edc57d5e29b237ba05340c">sk_adjustIndexes</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <span class="keywordtype">int</span> *start, <span class="keywordtype">int</span> *end)
<a name="l00880"></a>00880 {
<a name="l00881"></a>00881     <span class="keywordtype">int</span> retval = 0;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     *start = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#ac4bb9c919522e9bccc34e13503347933">start</a>;
<a name="l00884"></a>00884     *end = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a0d659422193665f7a42119b2923350a6">end</a>;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     <span class="keywordflow">if</span> (*start == -1)
<a name="l00887"></a>00887     {
<a name="l00888"></a>00888         *start = 0;
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     <span class="keywordflow">if</span> (*end == -1)
<a name="l00892"></a>00892     {
<a name="l00893"></a>00893         *end = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1;
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="keywordflow">if</span> (*end &lt; *start)
<a name="l00897"></a>00897     {
<a name="l00898"></a>00898         <span class="keywordtype">int</span> tmp = *start;
<a name="l00899"></a>00899         *start = *end;
<a name="l00900"></a>00900         *end = tmp;
<a name="l00901"></a>00901         retval = 1;
<a name="l00902"></a>00902     }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     <span class="keywordflow">return</span> retval;
<a name="l00905"></a>00905 }
<a name="l00906"></a>00906 
<a name="l00907"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4f18589c47c98f2bed6ab2974b19dce7">00907</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4f18589c47c98f2bed6ab2974b19dce7">sk_endOverdraw</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1afb0a0fb276119809a18d8585da89cc">sk_hasOverdraw</a>(sketch, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l00912"></a>00912     {
<a name="l00913"></a>00913         <span class="keywordtype">int</span> start;
<a name="l00914"></a>00914         <span class="keywordtype">int</span> end;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e3730bae7edc57d5e29b237ba05340c">sk_adjustIndexes</a>(sketch, &amp;start, &amp;end))
<a name="l00917"></a>00917         {
<a name="l00918"></a>00918             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ad5a60c8c01485f6a4c6421c6ecaf9d12">sk_reverseStroke</a>(stk);
<a name="l00919"></a>00919         }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> &gt; 1)
<a name="l00922"></a>00922         {
<a name="l00923"></a>00923             stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[start].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a>;
<a name="l00924"></a>00924             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(stk)-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[end].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a>;
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#aebf5f3663d42f4b37b49bc1cd3bc45cb">sk_insertStrokePoints</a>(sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab0aff5b8f18d1337fcb5d1f7101e5bfd">over</a>.<a class="code" href="../../df/da3/structSK__Overdraw.html#a75508c9fce2b2f017f8255f8defd8dfe">target</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>, start, end);
<a name="l00928"></a>00928 
<a name="l00929"></a>00929         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a0dc330dc52840b50934a2ca5f3f90802">sk_removeStroke</a>(sketch, stk);
<a name="l00930"></a>00930 
<a name="l00931"></a>00931         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0c809e3b8c545e87fc828886f06506e6">sk_resetOverdraw</a>(sketch);
<a name="l00932"></a>00932     }
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 
<a name="l00936"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a57f91045185f7eaaa3bc637aeb778340">00936</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a57f91045185f7eaaa3bc637aeb778340">sk_startStroke</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l00937"></a>00937 {
<a name="l00938"></a>00938     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a8d1b4bf8adee1d9e728df802dccdeba4">sk_createStroke</a>();
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>, stk);
<a name="l00941"></a>00941     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> = stk;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0c809e3b8c545e87fc828886f06506e6">sk_resetOverdraw</a>(sketch);
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a82aa5064520378ecafe4a7475f1ce645">00946</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a82aa5064520378ecafe4a7475f1ce645">sk_endStroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l00947"></a>00947 {
<a name="l00948"></a>00948     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l00949"></a>00949     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4b90bf2bb68fd2074618a1e3f39f6b3d">sk_shrinkStrokeBuffer</a>(sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>);
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad0aed04419d4238fc9e0c5e5fe9d0652">BONE_SKETCHING_ADJUST</a>)
<a name="l00952"></a>00952     {
<a name="l00953"></a>00953         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4f18589c47c98f2bed6ab2974b19dce7">sk_endOverdraw</a>(sketch);
<a name="l00954"></a>00954     }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00957"></a>00957 }
<a name="l00958"></a>00958 
<a name="l00959"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae0ed39b831dc150766b00cac6072df03">00959</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae0ed39b831dc150766b00cac6072df03">sk_updateDrawData</a>(<a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l00960"></a>00960 {
<a name="l00961"></a>00961     dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#ad813fa94d7b78f09460b08ef6d55421f">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a968c66960fce7cea1e8bebe1f0059c8f">PT_CONTINUOUS</a>;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a103d14e6feb2b5fd3a9c025de4ae7020">previous_mval</a>[0] = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[0];
<a name="l00964"></a>00964     dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a103d14e6feb2b5fd3a9c025de4ae7020">previous_mval</a>[1] = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[1];
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 
<a name="l00967"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aeb3e724082c1839e02226febbdb2dd3f">00967</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aeb3e724082c1839e02226febbdb2dd3f">sk_distanceDepth</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">float</span> p1[3], <span class="keywordtype">float</span> p2[3])
<a name="l00968"></a>00968 {
<a name="l00969"></a>00969     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00970"></a>00970     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l00971"></a>00971     <span class="keywordtype">float</span> vec[3];
<a name="l00972"></a>00972     <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, p1, p2);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a0a8ff93b28d3d1f8e81650662fbb496d">project_v3_v3v3</a>(vec, vec, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>[2]);
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     distance = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(vec);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>[2], vec) &gt; 0)
<a name="l00981"></a>00981     {
<a name="l00982"></a>00982         distance *= -1;
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     <span class="keywordflow">return</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l00988"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2704ca97b3cece8cb95436c22497b6a3">00988</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2704ca97b3cece8cb95436c22497b6a3">sk_interpolateDepth</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end, <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>, <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>)
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00991"></a>00991     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00992"></a>00992     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="keywordtype">float</span> progress = 0;
<a name="l00995"></a>00995     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     progress = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[start].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[start - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999     <span class="keywordflow">for</span> (i = start; i &lt;= end; i++)
<a name="l01000"></a>01000     {
<a name="l01001"></a>01001         <span class="keywordtype">float</span> ray_start[3], ray_normal[3];
<a name="l01002"></a>01002         <span class="keywordtype">float</span> delta = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01003"></a>01003         <span class="keywordtype">float</span> pval[2];
<a name="l01004"></a>01004 
<a name="l01005"></a>01005         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, pval);
<a name="l01006"></a>01006         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a5b0879983400f47e848161769a969367">ED_view3d_win_to_ray</a>(ar, v3d, pval, ray_start, ray_normal);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(ray_normal, distance * progress / length);
<a name="l01009"></a>01009         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, ray_normal);
<a name="l01010"></a>01010 
<a name="l01011"></a>01011         progress += delta;
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01015"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afb77add0f40b6d9ab916e2fbbbb709c5">01015</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afb77add0f40b6d9ab916e2fbbbb709c5">sk_projectDrawPoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">float</span> vec[3], <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l01016"></a>01016 {
<a name="l01017"></a>01017     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01018"></a>01018     <span class="comment">/* copied from grease pencil, need fixing */</span>
<a name="l01019"></a>01019     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *last = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(stk);
<a name="l01020"></a>01020     <span class="keywordtype">short</span> cval[2];
<a name="l01021"></a>01021     <span class="keywordtype">float</span> fp[3] = {0, 0, 0};
<a name="l01022"></a>01022     <span class="keywordtype">float</span> dvec[3];
<a name="l01023"></a>01023     <span class="keywordtype">float</span> mval_f[2];
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (last != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01026"></a>01026     {
<a name="l01027"></a>01027         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, last-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01028"></a>01028     }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a06acdefee150e80f06f802aeba637f6e">initgrabz</a>(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>, fp[0], fp[1], fp[2]);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <span class="comment">/* method taken from editview.c - mouse_cursor() */</span>
<a name="l01033"></a>01033     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(ar, fp, cval);
<a name="l01034"></a>01034     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a377b8132a50113311bd5d7d76aa30700">VECSUB2D</a>(mval_f, cval, dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>);
<a name="l01035"></a>01035     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ae4c98073cdfe1ff7ff50c08cb53b4228">ED_view3d_win_to_delta</a>(ar, mval_f, dvec);
<a name="l01036"></a>01036     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec, fp, dvec);
<a name="l01037"></a>01037 }
<a name="l01038"></a>01038 
<a name="l01039"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65809e4bad57a1c588340d63ac96cb7e">01039</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65809e4bad57a1c588340d63ac96cb7e">sk_getStrokeDrawPoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch), <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l01040"></a>01040 {
<a name="l01041"></a>01041     pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#ad813fa94d7b78f09460b08ef6d55421f">type</a>;
<a name="l01042"></a>01042     pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a9e274f782cbc3c8fc67eb5336bbaed45">PT_PROJECT</a>;
<a name="l01043"></a>01043     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afb77add0f40b6d9ab916e2fbbbb709c5">sk_projectDrawPoint</a>(C, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, stk, dd);
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     <span class="keywordflow">return</span> 1;
<a name="l01046"></a>01046 }
<a name="l01047"></a>01047 
<a name="l01048"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea82b7b5bbe44935668b80dc110d793c">01048</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea82b7b5bbe44935668b80dc110d793c">sk_addStrokeDrawPoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l01049"></a>01049 {
<a name="l01050"></a>01050     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01051"></a>01051     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l01052"></a>01052     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> pt;
<a name="l01053"></a>01053 
<a name="l01054"></a>01054     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ab4be6ebdd1ddcce7ccd5853b79b81a2f">sk_initPoint</a>(&amp;pt, dd, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>[2]);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65809e4bad57a1c588340d63ac96cb7e">sk_getStrokeDrawPoint</a>(C, &amp;pt, sketch, stk, dd);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1050aff57e9824aa59ad47f55e6c97d2">sk_appendStrokePoint</a>(stk, &amp;pt);
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="keywordflow">return</span> 1;
<a name="l01061"></a>01061 }
<a name="l01062"></a>01062 
<a name="l01063"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0f9b50c786e5a383ec2401778add2b1c">01063</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0f9b50c786e5a383ec2401778add2b1c">sk_getStrokeSnapPoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l01064"></a>01064 {
<a name="l01065"></a>01065     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l01066"></a>01066     <span class="keywordtype">int</span> point_added = 0;
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a949506996d3839db0ad369c30374fa6a">snap_mode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a89ff43c63602329141d5bd8d276c28f1">SCE_SNAP_MODE_VOLUME</a>)
<a name="l01069"></a>01069     {
<a name="l01070"></a>01070         <a class="code" href="../../dd/d2e/structDepthPeel.html">DepthPeel</a> *p1, *p2;
<a name="l01071"></a>01071         <span class="keywordtype">float</span> *last_p = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01072"></a>01072         <span class="keywordtype">float</span> dist = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l01073"></a>01073         <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>[3] = {0};
<a name="l01074"></a>01074         <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = 0;
<a name="l01075"></a>01075         <span class="keywordtype">float</span> mvalf[2];
<a name="l01076"></a>01076 
<a name="l01077"></a>01077         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>);
<a name="l01078"></a>01078         sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080         mvalf[0]= dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[0];
<a name="l01081"></a>01081         mvalf[1]= dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[1];
<a name="l01082"></a>01082         <a class="code" href="../../d8/df2/ED__transform_8h.html#a5e191e2e04336664acce7a6692b4056f">peelObjectsContext</a>(C, &amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>, mvalf, <a class="code" href="../../d8/df2/ED__transform_8h.html#ad6af205d4643f7a9ff2ed777d3b858f6ac561f86496b884c472e17aed3938496a">SNAP_ALL</a>);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084         <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> &gt; 0 &amp;&amp; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a968c66960fce7cea1e8bebe1f0059c8f">PT_CONTINUOUS</a>)
<a name="l01085"></a>01085         {
<a name="l01086"></a>01086             last_p = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>;
<a name="l01087"></a>01087         }
<a name="l01088"></a>01088         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab84899a8a580131b3d9a5bd84f1c2eb7">LAST_SNAP_POINT_VALID</a>)
<a name="l01089"></a>01089         {
<a name="l01090"></a>01090             last_p = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6e5e0ad3e287aa921f6a8044d3159e3">LAST_SNAP_POINT</a>;
<a name="l01091"></a>01091         }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093 
<a name="l01094"></a>01094         <span class="keywordflow">for</span> (p1 = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; p1; p1 = p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3e68f22298301121d828809e34130627">next</a>)
<a name="l01095"></a>01095         {
<a name="l01096"></a>01096             <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a10d3b8cfc94a991db14d0b08fb11170c">flag</a> == 0)
<a name="l01097"></a>01097             {
<a name="l01098"></a>01098                 <span class="keywordtype">float</span> vec[3];
<a name="l01099"></a>01099                 <span class="keywordtype">float</span> new_dist;
<a name="l01100"></a>01100                 <span class="keywordtype">float</span> new_size = 0;
<a name="l01101"></a>01101 
<a name="l01102"></a>01102                 p2 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01103"></a>01103                 p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a10d3b8cfc94a991db14d0b08fb11170c">flag</a> = 1;
<a name="l01104"></a>01104 
<a name="l01105"></a>01105                 <span class="comment">/* if peeling objects, take the first and last from each object */</span>
<a name="l01106"></a>01106                 <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a753542d0c510180f622f335a359c9b43">snap_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3209cdecda291bffd6dda5813ec001aa">SCE_SNAP_PEEL_OBJECT</a>)
<a name="l01107"></a>01107                 {
<a name="l01108"></a>01108                     <a class="code" href="../../dd/d2e/structDepthPeel.html">DepthPeel</a> *peel;
<a name="l01109"></a>01109                     <span class="keywordflow">for</span> (peel = p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3e68f22298301121d828809e34130627">next</a>; peel; peel = peel-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3e68f22298301121d828809e34130627">next</a>)
<a name="l01110"></a>01110                     {
<a name="l01111"></a>01111                         <span class="keywordflow">if</span> (peel-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#ab27fa26b1db7ae44426808550703698e">ob</a> == p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#ab27fa26b1db7ae44426808550703698e">ob</a>)
<a name="l01112"></a>01112                         {
<a name="l01113"></a>01113                             peel-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a10d3b8cfc94a991db14d0b08fb11170c">flag</a> = 1;
<a name="l01114"></a>01114                             p2 = peel;
<a name="l01115"></a>01115                         }
<a name="l01116"></a>01116                     }
<a name="l01117"></a>01117                 }
<a name="l01118"></a>01118                 <span class="comment">/* otherwise, pair first with second and so on */</span>
<a name="l01119"></a>01119                 <span class="keywordflow">else</span>
<a name="l01120"></a>01120                 {
<a name="l01121"></a>01121                     <span class="keywordflow">for</span> (p2 = p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3e68f22298301121d828809e34130627">next</a>; p2 &amp;&amp; p2-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#ab27fa26b1db7ae44426808550703698e">ob</a> != p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#ab27fa26b1db7ae44426808550703698e">ob</a>; p2 = p2-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3e68f22298301121d828809e34130627">next</a>)
<a name="l01122"></a>01122                     {
<a name="l01123"></a>01123                         <span class="comment">/* nothing to do here */</span>
<a name="l01124"></a>01124                     }
<a name="l01125"></a>01125                 }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127                 <span class="keywordflow">if</span> (p2)
<a name="l01128"></a>01128                 {
<a name="l01129"></a>01129                     p2-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a10d3b8cfc94a991db14d0b08fb11170c">flag</a> = 1;
<a name="l01130"></a>01130 
<a name="l01131"></a>01131                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(vec, p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>, p2-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>);
<a name="l01132"></a>01132                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, 0.5f);
<a name="l01133"></a>01133                     new_size = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>, p2-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>);
<a name="l01134"></a>01134                 }
<a name="l01135"></a>01135                 <span class="keywordflow">else</span>
<a name="l01136"></a>01136                 {
<a name="l01137"></a>01137                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, p1-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>);
<a name="l01138"></a>01138                 }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140                 <span class="keywordflow">if</span> (last_p == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01141"></a>01141                 {
<a name="l01142"></a>01142                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(p, vec);
<a name="l01143"></a>01143                     size = new_size;
<a name="l01144"></a>01144                     dist = 0;
<a name="l01145"></a>01145                     <span class="keywordflow">break</span>;
<a name="l01146"></a>01146                 }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148                 new_dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(last_p, vec);
<a name="l01149"></a>01149 
<a name="l01150"></a>01150                 <span class="keywordflow">if</span> (new_dist &lt; dist)
<a name="l01151"></a>01151                 {
<a name="l01152"></a>01152                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(p, vec);
<a name="l01153"></a>01153                     dist = new_dist;
<a name="l01154"></a>01154                     size = new_size;
<a name="l01155"></a>01155                 }
<a name="l01156"></a>01156             }
<a name="l01157"></a>01157         }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159         <span class="keywordflow">if</span> (dist != <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>)
<a name="l01160"></a>01160         {
<a name="l01161"></a>01161             pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#ad813fa94d7b78f09460b08ef6d55421f">type</a>;
<a name="l01162"></a>01162             pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a3cc7a1d1fb8a174d025dd8aa9ecd3e12">PT_SNAP</a>;
<a name="l01163"></a>01163             pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#ac298259f58c30fdfb2a274ed3ed4c885">size</a> = size / 2;
<a name="l01164"></a>01164             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, p);
<a name="l01165"></a>01165 
<a name="l01166"></a>01166             point_added = 1;
<a name="l01167"></a>01167         }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169         <span class="comment">//BLI_freelistN(&amp;depth_peels);</span>
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171     <span class="keywordflow">else</span>
<a name="l01172"></a>01172     {
<a name="l01173"></a>01173         <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *snap_stk;
<a name="l01174"></a>01174         <span class="keywordtype">float</span> vec[3];
<a name="l01175"></a>01175         <span class="keywordtype">float</span> no[3];
<a name="l01176"></a>01176         <span class="keywordtype">float</span> mval[2];
<a name="l01177"></a>01177         <span class="keywordtype">int</span> found = 0;
<a name="l01178"></a>01178         <span class="keywordtype">int</span> dist = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa979e15e313e62cff0fae8bcb909a0e5">SNAP_MIN_DISTANCE</a>; <span class="comment">// Use a user defined value here</span>
<a name="l01179"></a>01179 
<a name="l01180"></a>01180         <span class="comment">/* snap to strokes */</span>
<a name="l01181"></a>01181         <span class="comment">// if (ts-&gt;snap_mode == SCE_SNAP_MODE_VERTEX) /* snap all the time to strokes */</span>
<a name="l01182"></a>01182         <span class="keywordflow">for</span> (snap_stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; snap_stk; snap_stk = snap_stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#ad8662a79b275692dfc889101fa38b6c6">next</a>)
<a name="l01183"></a>01183         {
<a name="l01184"></a>01184             <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *spt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01185"></a>01185             <span class="keywordflow">if</span> (snap_stk == stk)
<a name="l01186"></a>01186             {
<a name="l01187"></a>01187                 spt = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bc140d404fc23f144bfe39105f54b18">sk_snapPointStroke</a>(C, snap_stk, dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>, &amp;dist, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l01188"></a>01188             }
<a name="l01189"></a>01189             <span class="keywordflow">else</span>
<a name="l01190"></a>01190             {
<a name="l01191"></a>01191                 spt = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bc140d404fc23f144bfe39105f54b18">sk_snapPointStroke</a>(C, snap_stk, dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>, &amp;dist, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1);
<a name="l01192"></a>01192             }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194             <span class="keywordflow">if</span> (spt != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01195"></a>01195             {
<a name="l01196"></a>01196                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, spt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01197"></a>01197                 point_added = 1;
<a name="l01198"></a>01198             }
<a name="l01199"></a>01199         }
<a name="l01200"></a>01200         
<a name="l01201"></a>01201         mval[0] = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[0];
<a name="l01202"></a>01202         mval[1] = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[1];
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <span class="comment">/* try to snap to closer object */</span>
<a name="l01205"></a>01205         found = <a class="code" href="../../d8/df2/ED__transform_8h.html#aa21730b18d1d1c696f950521e9138511">snapObjectsContext</a>(C, mval, &amp;dist, vec, no, <a class="code" href="../../d8/df2/ED__transform_8h.html#ad6af205d4643f7a9ff2ed777d3b858f6a176ad989ffd3255e4b46fc34d7d81de3">SNAP_NOT_SELECTED</a>);
<a name="l01206"></a>01206         <span class="keywordflow">if</span> (found == 1)
<a name="l01207"></a>01207         {
<a name="l01208"></a>01208             pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#ad813fa94d7b78f09460b08ef6d55421f">type</a>;
<a name="l01209"></a>01209             pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a3cc7a1d1fb8a174d025dd8aa9ecd3e12">PT_SNAP</a>;
<a name="l01210"></a>01210             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, vec);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212             point_added = 1;
<a name="l01213"></a>01213         }
<a name="l01214"></a>01214     }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216     <span class="keywordflow">return</span> point_added;
<a name="l01217"></a>01217 }
<a name="l01218"></a>01218 
<a name="l01219"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acdec1c8be0e7ec4893612449bdd47ff0">01219</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acdec1c8be0e7ec4893612449bdd47ff0">sk_addStrokeSnapPoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd)
<a name="l01220"></a>01220 {
<a name="l01221"></a>01221     <span class="keywordtype">int</span> point_added;
<a name="l01222"></a>01222     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01223"></a>01223     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l01224"></a>01224     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> pt;
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ab4be6ebdd1ddcce7ccd5853b79b81a2f">sk_initPoint</a>(&amp;pt, dd, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>[2]);
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     point_added = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0f9b50c786e5a383ec2401778add2b1c">sk_getStrokeSnapPoint</a>(C, &amp;pt, sketch, stk, dd);
<a name="l01229"></a>01229 
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (point_added)
<a name="l01231"></a>01231     {
<a name="l01232"></a>01232         <span class="keywordtype">float</span> final_p[3];
<a name="l01233"></a>01233         <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l01234"></a>01234         <span class="keywordtype">int</span> total;
<a name="l01235"></a>01235         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(final_p, pt.<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afb77add0f40b6d9ab916e2fbbbb709c5">sk_projectDrawPoint</a>(C, pt.<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, stk, dd);
<a name="l01240"></a>01240         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1050aff57e9824aa59ad47f55e6c97d2">sk_appendStrokePoint</a>(stk, &amp;pt);
<a name="l01241"></a>01241 
<a name="l01242"></a>01242         <span class="comment">/* update all previous point to give smooth Z progresion */</span>
<a name="l01243"></a>01243         total = 0;
<a name="l01244"></a>01244         length = 0;
<a name="l01245"></a>01245         <span class="keywordflow">for</span> (i = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 2; i &gt; 0; i--)
<a name="l01246"></a>01246         {
<a name="l01247"></a>01247             length += <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01248"></a>01248             total++;
<a name="l01249"></a>01249             <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a3cc7a1d1fb8a174d025dd8aa9ecd3e12">PT_SNAP</a> || stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l01250"></a>01250             {
<a name="l01251"></a>01251                 <span class="keywordflow">break</span>;
<a name="l01252"></a>01252             }
<a name="l01253"></a>01253         }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255         <span class="keywordflow">if</span> (total &gt; 1)
<a name="l01256"></a>01256         {
<a name="l01257"></a>01257             distance = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aeb3e724082c1839e02226febbdb2dd3f">sk_distanceDepth</a>(C, final_p, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01258"></a>01258 
<a name="l01259"></a>01259             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2704ca97b3cece8cb95436c22497b6a3">sk_interpolateDepth</a>(C, stk, i + 1, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 2, length, distance);
<a name="l01260"></a>01260         }
<a name="l01261"></a>01261 
<a name="l01262"></a>01262         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, final_p);
<a name="l01263"></a>01263 
<a name="l01264"></a>01264         point_added = 1;
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267     <span class="keywordflow">return</span> point_added;
<a name="l01268"></a>01268 }
<a name="l01269"></a>01269 
<a name="l01270"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75e2906341d2ed7aa488d14df8b681b4">01270</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75e2906341d2ed7aa488d14df8b681b4">sk_addStrokePoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd, <span class="keywordtype">short</span> snap)
<a name="l01271"></a>01271 {
<a name="l01272"></a>01272     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l01273"></a>01273     <span class="keywordtype">int</span> point_added = 0;
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     <span class="keywordflow">if</span> (snap)
<a name="l01276"></a>01276     {
<a name="l01277"></a>01277         point_added = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acdec1c8be0e7ec4893612449bdd47ff0">sk_addStrokeSnapPoint</a>(C, sketch, stk, dd);
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280     <span class="keywordflow">if</span> (point_added == 0)
<a name="l01281"></a>01281     {
<a name="l01282"></a>01282         point_added = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea82b7b5bbe44935668b80dc110d793c">sk_addStrokeDrawPoint</a>(C, sketch, stk, dd);
<a name="l01283"></a>01283     }
<a name="l01284"></a>01284 
<a name="l01285"></a>01285     <span class="keywordflow">if</span> (stk == sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> &amp;&amp; ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad0aed04419d4238fc9e0c5e5fe9d0652">BONE_SKETCHING_ADJUST</a>)
<a name="l01286"></a>01286     {
<a name="l01287"></a>01287         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a588fe0daade57603a14a6a82e495673f">sk_updateOverdraw</a>(C, sketch, stk, dd);
<a name="l01288"></a>01288     }
<a name="l01289"></a>01289 }
<a name="l01290"></a>01290 
<a name="l01291"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a05b9c834753a5c328a6a0814fd24fed8">01291</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a05b9c834753a5c328a6a0814fd24fed8">sk_getStrokePoint</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd, <span class="keywordtype">short</span> snap)
<a name="l01292"></a>01292 {
<a name="l01293"></a>01293     <span class="keywordtype">int</span> point_added = 0;
<a name="l01294"></a>01294 
<a name="l01295"></a>01295     <span class="keywordflow">if</span> (snap)
<a name="l01296"></a>01296     {
<a name="l01297"></a>01297         point_added = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0f9b50c786e5a383ec2401778add2b1c">sk_getStrokeSnapPoint</a>(C, pt, sketch, stk, dd);
<a name="l01298"></a>01298         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab84899a8a580131b3d9a5bd84f1c2eb7">LAST_SNAP_POINT_VALID</a> = 1;
<a name="l01299"></a>01299         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6e5e0ad3e287aa921f6a8044d3159e3">LAST_SNAP_POINT</a>, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01300"></a>01300     }
<a name="l01301"></a>01301     <span class="keywordflow">else</span>
<a name="l01302"></a>01302     {
<a name="l01303"></a>01303         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab84899a8a580131b3d9a5bd84f1c2eb7">LAST_SNAP_POINT_VALID</a> = 0;
<a name="l01304"></a>01304     }
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     <span class="keywordflow">if</span> (point_added == 0)
<a name="l01307"></a>01307     {
<a name="l01308"></a>01308         point_added = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65809e4bad57a1c588340d63ac96cb7e">sk_getStrokeDrawPoint</a>(C, pt, sketch, stk, dd);
<a name="l01309"></a>01309     }
<a name="l01310"></a>01310 }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 <span class="comment">/********************************************/</span>
<a name="l01313"></a>01313 
<a name="l01314"></a>01314 <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab12150b4c3b852de6e9c0a9a30164820">headPoint</a>(<span class="keywordtype">void</span> *arg);
<a name="l01315"></a>01315 <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8e22379b88010a848d367ed8d205fea1">tailPoint</a>(<span class="keywordtype">void</span> *arg);
<a name="l01316"></a>01316 <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af441debc1ca6536a490ab40cb3f8b0b0">nextPoint</a>(<span class="keywordtype">void</span> *arg);
<a name="l01317"></a>01317 <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7517fd0d41ec9e47ce32771bfc0963f6">nextNPoint</a>(<span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> n);
<a name="l01318"></a>01318 <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acba0e22a120f1f3cc8a5e497bb8cfa63">peekPoint</a>(<span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> n);
<a name="l01319"></a>01319 <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa996caac8407fc038fdecc3827d80d49">previousPoint</a>(<span class="keywordtype">void</span> *arg);
<a name="l01320"></a>01320 <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7c53d880d34818029beb95f3d9b8d551">iteratorStopped</a>(<span class="keywordtype">void</span> *arg);
<a name="l01321"></a>01321 
<a name="l01322"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a53b519a12ff5d18f210b70df1eb85a5f">01322</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a53b519a12ff5d18f210b70df1eb85a5f">initIteratorFct</a>(<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter)
<a name="l01323"></a>01323 {
<a name="l01324"></a>01324     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2b7aca3bd60742cc4e55a4bfd71d0cf7">head</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab12150b4c3b852de6e9c0a9a30164820">headPoint</a>;
<a name="l01325"></a>01325     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5acf1e1570345ac0fd05e4f494cc2984">tail</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8e22379b88010a848d367ed8d205fea1">tailPoint</a>;
<a name="l01326"></a>01326     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5eb9adade8b1ff7ab738846ea2d37e8f">peek</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acba0e22a120f1f3cc8a5e497bb8cfa63">peekPoint</a>;
<a name="l01327"></a>01327     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a57e645673904073d8385afcc1b200a7a">next</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af441debc1ca6536a490ab40cb3f8b0b0">nextPoint</a>;
<a name="l01328"></a>01328     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a5e72105df5126fa99c81416d95f7a95c">nextN</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7517fd0d41ec9e47ce32771bfc0963f6">nextNPoint</a>;
<a name="l01329"></a>01329     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a230a054bca570bd9b4860b6eb41e9bf2">previous</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa996caac8407fc038fdecc3827d80d49">previousPoint</a>;
<a name="l01330"></a>01330     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#ae1afa46301b731122933cddfbb2f5baa">stopped</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7c53d880d34818029beb95f3d9b8d551">iteratorStopped</a>;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace17fedc8ff604722aa1a5a67171d477">01333</a> <span class="keyword">static</span> <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace17fedc8ff604722aa1a5a67171d477">setIteratorValues</a>(<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter, <span class="keywordtype">int</span> index)
<a name="l01334"></a>01334 {
<a name="l01335"></a>01335     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337     <span class="keywordflow">if</span> (index &gt;= 0 &amp;&amp; index &lt; iter-&gt;<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>)
<a name="l01338"></a>01338     {
<a name="l01339"></a>01339         pt = &amp;(iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a467c5770fa18e663a8dbde88a405a1d5">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">start</a> + (iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a> * index)]);
<a name="l01340"></a>01340         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a403bb8445721c83d27d3a412c7f04550">p</a> = pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>;
<a name="l01341"></a>01341         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a1c76a30cd0702ee8e4c667cea0775842">no</a> = pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>;
<a name="l01342"></a>01342         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a7f3412262250d3728a4de161cf489d53">size</a> = pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#ac298259f58c30fdfb2a274ed3ed4c885">size</a>;
<a name="l01343"></a>01343     }
<a name="l01344"></a>01344     <span class="keywordflow">else</span>
<a name="l01345"></a>01345     {
<a name="l01346"></a>01346         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a403bb8445721c83d27d3a412c7f04550">p</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01347"></a>01347         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a1c76a30cd0702ee8e4c667cea0775842">no</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01348"></a>01348         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a7f3412262250d3728a4de161cf489d53">size</a> = 0;
<a name="l01349"></a>01349     }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351     <span class="keywordflow">return</span> pt;
<a name="l01352"></a>01352 }
<a name="l01353"></a>01353 
<a name="l01354"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee297b0a6157a5c37a1cdaff384d958d">01354</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee297b0a6157a5c37a1cdaff384d958d">initStrokeIterator</a>(<a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a> *arg, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end)
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a53b519a12ff5d18f210b70df1eb85a5f">initIteratorFct</a>(iter);
<a name="l01359"></a>01359     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a467c5770fa18e663a8dbde88a405a1d5">stroke</a> = stk;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     <span class="keywordflow">if</span> (start &lt; end)
<a name="l01362"></a>01362     {
<a name="l01363"></a>01363         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">start</a> = start + 1;
<a name="l01364"></a>01364         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a319e0f6bc6ba3f7b2ffcfff60210e8b2">end</a> = end - 1;
<a name="l01365"></a>01365         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a> = 1;
<a name="l01366"></a>01366     }
<a name="l01367"></a>01367     <span class="keywordflow">else</span>
<a name="l01368"></a>01368     {
<a name="l01369"></a>01369         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">start</a> = start - 1;
<a name="l01370"></a>01370         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a319e0f6bc6ba3f7b2ffcfff60210e8b2">end</a> = end + 1;
<a name="l01371"></a>01371         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a> = -1;
<a name="l01372"></a>01372     }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#aa5d00eb3dc617bf885107e37fd9ed3aa">length</a> = iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a> * (iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a319e0f6bc6ba3f7b2ffcfff60210e8b2">end</a> - iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">start</a> + 1);
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> = -1;
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379 
<a name="l01380"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab12150b4c3b852de6e9c0a9a30164820">01380</a> <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab12150b4c3b852de6e9c0a9a30164820">headPoint</a>(<span class="keywordtype">void</span> *arg)
<a name="l01381"></a>01381 {
<a name="l01382"></a>01382     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01383"></a>01383     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *result = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01384"></a>01384 
<a name="l01385"></a>01385     result = &amp;(iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a467c5770fa18e663a8dbde88a405a1d5">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a2e61421eba26d509a40da730d0c0731a">start</a> - iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a>]);
<a name="l01386"></a>01386     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a403bb8445721c83d27d3a412c7f04550">p</a> = result-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>;
<a name="l01387"></a>01387     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a1c76a30cd0702ee8e4c667cea0775842">no</a> = result-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>;
<a name="l01388"></a>01388     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a7f3412262250d3728a4de161cf489d53">size</a> = result-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#ac298259f58c30fdfb2a274ed3ed4c885">size</a>;
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     <span class="keywordflow">return</span> result;
<a name="l01391"></a>01391 }
<a name="l01392"></a>01392 
<a name="l01393"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8e22379b88010a848d367ed8d205fea1">01393</a> <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a8e22379b88010a848d367ed8d205fea1">tailPoint</a>(<span class="keywordtype">void</span> *arg)
<a name="l01394"></a>01394 {
<a name="l01395"></a>01395     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01396"></a>01396     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *result = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     result = &amp;(iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a467c5770fa18e663a8dbde88a405a1d5">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a319e0f6bc6ba3f7b2ffcfff60210e8b2">end</a> + iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a0450389a437ea82807a98bbc7fd16767">stride</a>]);
<a name="l01399"></a>01399     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a403bb8445721c83d27d3a412c7f04550">p</a> = result-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>;
<a name="l01400"></a>01400     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a1c76a30cd0702ee8e4c667cea0775842">no</a> = result-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>;
<a name="l01401"></a>01401     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#a7f3412262250d3728a4de161cf489d53">size</a> = result-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#ac298259f58c30fdfb2a274ed3ed4c885">size</a>;
<a name="l01402"></a>01402 
<a name="l01403"></a>01403     <span class="keywordflow">return</span> result;
<a name="l01404"></a>01404 }
<a name="l01405"></a>01405 
<a name="l01406"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af441debc1ca6536a490ab40cb3f8b0b0">01406</a> <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af441debc1ca6536a490ab40cb3f8b0b0">nextPoint</a>(<span class="keywordtype">void</span> *arg)
<a name="l01407"></a>01407 {
<a name="l01408"></a>01408     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01409"></a>01409     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *result = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01410"></a>01410 
<a name="l01411"></a>01411     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a>++;
<a name="l01412"></a>01412     <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> &lt; iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#aa5d00eb3dc617bf885107e37fd9ed3aa">length</a>)
<a name="l01413"></a>01413     {
<a name="l01414"></a>01414         result = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace17fedc8ff604722aa1a5a67171d477">setIteratorValues</a>(iter, iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a>);
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416 
<a name="l01417"></a>01417     <span class="keywordflow">return</span> result;
<a name="l01418"></a>01418 }
<a name="l01419"></a>01419 
<a name="l01420"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7517fd0d41ec9e47ce32771bfc0963f6">01420</a> <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7517fd0d41ec9e47ce32771bfc0963f6">nextNPoint</a>(<span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> n)
<a name="l01421"></a>01421 {
<a name="l01422"></a>01422     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01423"></a>01423     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *result = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01424"></a>01424 
<a name="l01425"></a>01425     iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> += n;
<a name="l01426"></a>01426 
<a name="l01427"></a>01427     <span class="comment">/* check if passed end */</span>
<a name="l01428"></a>01428     <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> &lt; iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#aa5d00eb3dc617bf885107e37fd9ed3aa">length</a>)
<a name="l01429"></a>01429     {
<a name="l01430"></a>01430         result = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace17fedc8ff604722aa1a5a67171d477">setIteratorValues</a>(iter, iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a>);
<a name="l01431"></a>01431     }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     <span class="keywordflow">return</span> result;
<a name="l01434"></a>01434 }
<a name="l01435"></a>01435 
<a name="l01436"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acba0e22a120f1f3cc8a5e497bb8cfa63">01436</a> <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acba0e22a120f1f3cc8a5e497bb8cfa63">peekPoint</a>(<span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> n)
<a name="l01437"></a>01437 {
<a name="l01438"></a>01438     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01439"></a>01439     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *result = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01440"></a>01440     <span class="keywordtype">int</span> index = iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> + n;
<a name="l01441"></a>01441 
<a name="l01442"></a>01442     <span class="comment">/* check if passed end */</span>
<a name="l01443"></a>01443     <span class="keywordflow">if</span> (index &lt; iter-&gt;<a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>)
<a name="l01444"></a>01444     {
<a name="l01445"></a>01445         result = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace17fedc8ff604722aa1a5a67171d477">setIteratorValues</a>(iter, index);
<a name="l01446"></a>01446     }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     <span class="keywordflow">return</span> result;
<a name="l01449"></a>01449 }
<a name="l01450"></a>01450 
<a name="l01451"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa996caac8407fc038fdecc3827d80d49">01451</a> <span class="keyword">static</span> <span class="keywordtype">void</span>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa996caac8407fc038fdecc3827d80d49">previousPoint</a>(<span class="keywordtype">void</span> *arg)
<a name="l01452"></a>01452 {
<a name="l01453"></a>01453     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01454"></a>01454     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *result = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01455"></a>01455 
<a name="l01456"></a>01456     <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> &gt; 0)
<a name="l01457"></a>01457     {
<a name="l01458"></a>01458         iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a>--;
<a name="l01459"></a>01459         result = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ace17fedc8ff604722aa1a5a67171d477">setIteratorValues</a>(iter, iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a>);
<a name="l01460"></a>01460     }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462     <span class="keywordflow">return</span> result;
<a name="l01463"></a>01463 }
<a name="l01464"></a>01464 
<a name="l01465"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7c53d880d34818029beb95f3d9b8d551">01465</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7c53d880d34818029beb95f3d9b8d551">iteratorStopped</a>(<span class="keywordtype">void</span> *arg)
<a name="l01466"></a>01466 {
<a name="l01467"></a>01467     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> *iter = (<a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a>*)arg;
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#accc3c5a06abfe9f37ba1941c81d9365d">index</a> &gt;= iter-&gt;<a class="code" href="../../d3/d81/structSK__StrokeIterator.html#aa5d00eb3dc617bf885107e37fd9ed3aa">length</a>)
<a name="l01470"></a>01470     {
<a name="l01471"></a>01471         <span class="keywordflow">return</span> 1;
<a name="l01472"></a>01472     }
<a name="l01473"></a>01473     <span class="keywordflow">else</span>
<a name="l01474"></a>01474     {
<a name="l01475"></a>01475         <span class="keywordflow">return</span> 0;
<a name="l01476"></a>01476     }
<a name="l01477"></a>01477 }
<a name="l01478"></a>01478 
<a name="l01479"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa790b39718e9c08af1d4085707c76867">01479</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa790b39718e9c08af1d4085707c76867">sk_convertStroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk)
<a name="l01480"></a>01480 {
<a name="l01481"></a>01481     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01482"></a>01482     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l01483"></a>01483     <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm = obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01484"></a>01484     <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *head;
<a name="l01485"></a>01485     <a class="code" href="../../da/d29/structEditBone.html">EditBone</a> *parent = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01486"></a>01486     <span class="keywordtype">float</span> invmat[4][4]; <span class="comment">/* move in caller function */</span>
<a name="l01487"></a>01487     <span class="keywordtype">float</span> tmat[3][3];
<a name="l01488"></a>01488     <span class="keywordtype">int</span> head_index = 0;
<a name="l01489"></a>01489     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     head = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01492"></a>01492 
<a name="l01493"></a>01493     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(invmat, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(tmat, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01496"></a>01496     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad34fc69317ce2354d58d80147b753408">transpose_m3</a>(tmat);
<a name="l01497"></a>01497 
<a name="l01498"></a>01498     <span class="keywordflow">for</span> (i = 0; i &lt; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>; i++)
<a name="l01499"></a>01499     {
<a name="l01500"></a>01500         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *pt = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01501"></a>01501 
<a name="l01502"></a>01502         <span class="keywordflow">if</span> (pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l01503"></a>01503         {
<a name="l01504"></a>01504             <span class="keywordflow">if</span> (head == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01505"></a>01505             {
<a name="l01506"></a>01506                 head_index = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01507"></a>01507                 head = pt;
<a name="l01508"></a>01508             }
<a name="l01509"></a>01509             <span class="keywordflow">else</span>
<a name="l01510"></a>01510             {
<a name="l01511"></a>01511                 <a class="code" href="../../da/d29/structEditBone.html">EditBone</a> *bone = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01512"></a>01512                 <a class="code" href="../../da/d29/structEditBone.html">EditBone</a> *new_parent;
<a name="l01513"></a>01513 
<a name="l01514"></a>01514                 <span class="keywordflow">if</span> (i - head_index &gt; 1)
<a name="l01515"></a>01515                 {
<a name="l01516"></a>01516                     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> sk_iter;
<a name="l01517"></a>01517                     <a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a> *iter = (<a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a>*)&amp;sk_iter;
<a name="l01518"></a>01518 
<a name="l01519"></a>01519                     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee297b0a6157a5c37a1cdaff384d958d">initStrokeIterator</a>(iter, stk, head_index, i);
<a name="l01520"></a>01520 
<a name="l01521"></a>01521                     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af6be1db48175aa40a8bce299a323b7fc">SK_CONVERT_CUT_ADAPTATIVE</a>)
<a name="l01522"></a>01522                     {
<a name="l01523"></a>01523                         bone = <a class="code" href="../../de/dad/BIF__generate_8h.html#affa9d2694503d93977208a63079042f4">subdivideArcBy</a>(ts, arm, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#adb3f7d11765ffd0276f5a68739e69d65">edbo</a>, iter, invmat, tmat, <a class="code" href="../../de/dad/BIF__generate_8h.html#a0f6c6eb4f7eb04911abe87781d5e6cc5">nextAdaptativeSubdivision</a>);
<a name="l01524"></a>01524                     }
<a name="l01525"></a>01525                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a578fcd270ce326acf57b4559a1fbec75">SK_CONVERT_CUT_LENGTH</a>)
<a name="l01526"></a>01526                     {
<a name="l01527"></a>01527                         bone = <a class="code" href="../../de/dad/BIF__generate_8h.html#affa9d2694503d93977208a63079042f4">subdivideArcBy</a>(ts, arm, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#adb3f7d11765ffd0276f5a68739e69d65">edbo</a>, iter, invmat, tmat, <a class="code" href="../../de/dad/BIF__generate_8h.html#a5a2568c2178400c3cae8701cef1b699c">nextLengthSubdivision</a>);
<a name="l01528"></a>01528                     }
<a name="l01529"></a>01529                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa66ae9067bc9dae8762c5bc88290c957">SK_CONVERT_CUT_FIXED</a>)
<a name="l01530"></a>01530                     {
<a name="l01531"></a>01531                         bone = <a class="code" href="../../de/dad/BIF__generate_8h.html#affa9d2694503d93977208a63079042f4">subdivideArcBy</a>(ts, arm, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#adb3f7d11765ffd0276f5a68739e69d65">edbo</a>, iter, invmat, tmat, <a class="code" href="../../de/dad/BIF__generate_8h.html#a50e96e983870dde98f12d4590367d3d2">nextFixedSubdivision</a>);
<a name="l01532"></a>01532                     }
<a name="l01533"></a>01533                 }
<a name="l01534"></a>01534 
<a name="l01535"></a>01535                 <span class="keywordflow">if</span> (bone == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01536"></a>01536                 {
<a name="l01537"></a>01537                     bone = <a class="code" href="../../de/dbc/editarmature_8c.html#a17d573c0ef449519690d0786f8cacb90">ED_armature_edit_bone_add</a>(arm, <span class="stringliteral">&quot;Bone&quot;</span>);
<a name="l01538"></a>01538 
<a name="l01539"></a>01539                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#afb155f521bdb5d856ec84d95cd430861">head</a>, head-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01540"></a>01540                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a390914096213eba14510d2043f85a27f">tail</a>, pt-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01541"></a>01541 
<a name="l01542"></a>01542                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(invmat, bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#afb155f521bdb5d856ec84d95cd430861">head</a>);
<a name="l01543"></a>01543                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(invmat, bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a390914096213eba14510d2043f85a27f">tail</a>);
<a name="l01544"></a>01544                     <a class="code" href="../../de/dad/BIF__generate_8h.html#a7659f9854df6ee278f38a31ffbc08055">setBoneRollFromNormal</a>(bone, head-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>, invmat, tmat);
<a name="l01545"></a>01545                 }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547                 new_parent = bone;
<a name="l01548"></a>01548                 bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a6c7db9597e20d97ea4ae61eaacdc41fe">flag</a> |= <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a176833e258350f5e845cfb780a4c280c">BONE_SELECTED</a>|<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50abd540848fbcdcaf33141f6ce27766114">BONE_TIPSEL</a>|<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a0349b6b0b0156b6fb460e29f870bb443">BONE_ROOTSEL</a>;
<a name="l01549"></a>01549 
<a name="l01550"></a>01550                 <span class="comment">/* move to end of chain */</span>
<a name="l01551"></a>01551                 <span class="keywordflow">while</span> (bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#abbbb707335156f8caef65a275c51cd96">parent</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01552"></a>01552                 {
<a name="l01553"></a>01553                     bone = bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#abbbb707335156f8caef65a275c51cd96">parent</a>;
<a name="l01554"></a>01554                     bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a6c7db9597e20d97ea4ae61eaacdc41fe">flag</a> |= <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a176833e258350f5e845cfb780a4c280c">BONE_SELECTED</a>|<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50abd540848fbcdcaf33141f6ce27766114">BONE_TIPSEL</a>|<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a0349b6b0b0156b6fb460e29f870bb443">BONE_ROOTSEL</a>;
<a name="l01555"></a>01555                 }
<a name="l01556"></a>01556 
<a name="l01557"></a>01557                 <span class="keywordflow">if</span> (parent != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01558"></a>01558                 {
<a name="l01559"></a>01559                     bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#abbbb707335156f8caef65a275c51cd96">parent</a> = parent;
<a name="l01560"></a>01560                     bone-&gt;<a class="code" href="../../da/d29/structEditBone.html#a6c7db9597e20d97ea4ae61eaacdc41fe">flag</a> |= <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50ad1063cb445c506fbb2eacef9f453a36e">BONE_CONNECTED</a>;
<a name="l01561"></a>01561                 }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563                 parent = new_parent;
<a name="l01564"></a>01564                 head_index = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01565"></a>01565                 head = pt;
<a name="l01566"></a>01566             }
<a name="l01567"></a>01567         }
<a name="l01568"></a>01568     }
<a name="l01569"></a>01569 }
<a name="l01570"></a>01570 
<a name="l01571"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa46a408784b9444d0bddeb52888da8d6">01571</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa46a408784b9444d0bddeb52888da8d6">sk_convert</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l01572"></a>01572 {
<a name="l01573"></a>01573     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l01574"></a>01574     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk;
<a name="l01575"></a>01575 
<a name="l01576"></a>01576     <span class="keywordflow">for</span> (stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; stk; stk = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#ad8662a79b275692dfc889101fa38b6c6">next</a>)
<a name="l01577"></a>01577     {
<a name="l01578"></a>01578         <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a10ef00285f34d710337b71e9b979dc98">selected</a> == 1)
<a name="l01579"></a>01579         {
<a name="l01580"></a>01580             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af3ea9eb5921c019deb65c7a4bc50f358">SK_CONVERT_RETARGET</a>)
<a name="l01581"></a>01581             {
<a name="l01582"></a>01582                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abcfddc2b9b8f68fa515413b30af17b3a">sk_retargetStroke</a>(C, stk);
<a name="l01583"></a>01583             }
<a name="l01584"></a>01584             <span class="keywordflow">else</span>
<a name="l01585"></a>01585             {
<a name="l01586"></a>01586                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa790b39718e9c08af1d4085707c76867">sk_convertStroke</a>(C, stk);
<a name="l01587"></a>01587             }
<a name="l01588"></a>01588 <span class="comment">//          XXX</span>
<a name="l01589"></a>01589 <span class="comment">//          allqueue(REDRAWBUTSEDIT, 0);</span>
<a name="l01590"></a>01590         }
<a name="l01591"></a>01591     }
<a name="l01592"></a>01592 }
<a name="l01593"></a>01593 <span class="comment">/******************* GESTURE *************************/</span>
<a name="l01594"></a>01594 
<a name="l01595"></a>01595 
<a name="l01596"></a>01596 <span class="comment">/* returns the number of self intersections */</span>
<a name="l01597"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65ffa49ce5755a20a3cb03aded45b127">01597</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65ffa49ce5755a20a3cb03aded45b127">sk_getSelfIntersections</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *gesture)
<a name="l01598"></a>01598 {
<a name="l01599"></a>01599     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01600"></a>01600     <span class="keywordtype">int</span> added = 0;
<a name="l01601"></a>01601     <span class="keywordtype">int</span> s_i;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603     <span class="keywordflow">for</span> (s_i = 0; s_i &lt; gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1; s_i++)
<a name="l01604"></a>01604     {
<a name="l01605"></a>01605         <span class="keywordtype">float</span> s_p1[3] = {0, 0, 0};
<a name="l01606"></a>01606         <span class="keywordtype">float</span> s_p2[3] = {0, 0, 0};
<a name="l01607"></a>01607         <span class="keywordtype">int</span> g_i;
<a name="l01608"></a>01608 
<a name="l01609"></a>01609         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, s_p1);
<a name="l01610"></a>01610         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, s_p2);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612         <span class="comment">/* start checking from second next, because two consecutive cannot intersect */</span>
<a name="l01613"></a>01613         <span class="keywordflow">for</span> (g_i = s_i + 2; g_i &lt; gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1; g_i++)
<a name="l01614"></a>01614         {
<a name="l01615"></a>01615             <span class="keywordtype">float</span> g_p1[3] = {0, 0, 0};
<a name="l01616"></a>01616             <span class="keywordtype">float</span> g_p2[3] = {0, 0, 0};
<a name="l01617"></a>01617             <span class="keywordtype">float</span> vi[3];
<a name="l01618"></a>01618             <span class="keywordtype">float</span> lambda;
<a name="l01619"></a>01619 
<a name="l01620"></a>01620             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[g_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, g_p1);
<a name="l01621"></a>01621             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[g_i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, g_p2);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623             <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#af76f0adb324c0b296b6e1ad5f69e5b73">isect_line_line_strict_v3</a>(s_p1, s_p2, g_p1, g_p2, vi, &amp;lambda))
<a name="l01624"></a>01624             {
<a name="l01625"></a>01625                 <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a>), <span class="stringliteral">&quot;Intersection&quot;</span>);
<a name="l01626"></a>01626 
<a name="l01627"></a>01627                 isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#adc72efe05964a11963c3d3eb13297e27">gesture_index</a> = g_i;
<a name="l01628"></a>01628                 isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a> = s_i;
<a name="l01629"></a>01629                 isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a> = s_i + 1;
<a name="l01630"></a>01630                 isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> = gesture;
<a name="l01631"></a>01631 
<a name="l01632"></a>01632                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01633"></a>01633                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>, lambda);
<a name="l01634"></a>01634                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01635"></a>01635 
<a name="l01636"></a>01636                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(list, isect);
<a name="l01637"></a>01637 
<a name="l01638"></a>01638                 added++;
<a name="l01639"></a>01639             }
<a name="l01640"></a>01640         }
<a name="l01641"></a>01641     }
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     <span class="keywordflow">return</span> added;
<a name="l01644"></a>01644 }
<a name="l01645"></a>01645 
<a name="l01646"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a10a056c4be78d7eb61c65ae498fd6fb1">01646</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a10a056c4be78d7eb61c65ae498fd6fb1">cmpIntersections</a>(<span class="keywordtype">void</span> *i1, <span class="keywordtype">void</span> *i2)
<a name="l01647"></a>01647 {
<a name="l01648"></a>01648     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect1 = i1, *isect2 = i2;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650     <span class="keywordflow">if</span> (isect1-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect2-&gt;stroke)
<a name="l01651"></a>01651     {
<a name="l01652"></a>01652         <span class="keywordflow">if</span> (isect1-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a> &lt; isect2-&gt;before)
<a name="l01653"></a>01653         {
<a name="l01654"></a>01654             <span class="keywordflow">return</span> -1;
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isect1-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a> &gt; isect2-&gt;before)
<a name="l01657"></a>01657         {
<a name="l01658"></a>01658             <span class="keywordflow">return</span> 1;
<a name="l01659"></a>01659         }
<a name="l01660"></a>01660         <span class="keywordflow">else</span>
<a name="l01661"></a>01661         {
<a name="l01662"></a>01662             <span class="keywordflow">if</span> (isect1-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a445f49961798ae3ddf30eefd89040a29">lambda</a> &lt; isect2-&gt;lambda)
<a name="l01663"></a>01663             {
<a name="l01664"></a>01664                 <span class="keywordflow">return</span> -1;
<a name="l01665"></a>01665             }
<a name="l01666"></a>01666             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isect1-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a445f49961798ae3ddf30eefd89040a29">lambda</a> &gt; isect2-&gt;lambda)
<a name="l01667"></a>01667             {
<a name="l01668"></a>01668                 <span class="keywordflow">return</span> 1;
<a name="l01669"></a>01669             }
<a name="l01670"></a>01670         }
<a name="l01671"></a>01671     }
<a name="l01672"></a>01672 
<a name="l01673"></a>01673     <span class="keywordflow">return</span> 0;
<a name="l01674"></a>01674 }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676 
<a name="l01677"></a>01677 <span class="comment">/* returns the maximum number of intersections per stroke */</span>
<a name="l01678"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a84dbc227032ac91e98a8545ee16c29dd">01678</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a84dbc227032ac91e98a8545ee16c29dd">sk_getIntersections</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *gesture)
<a name="l01679"></a>01679 {
<a name="l01680"></a>01680     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01681"></a>01681     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01682"></a>01682     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01683"></a>01683     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk;
<a name="l01684"></a>01684     <span class="keywordtype">int</span> added = 0;
<a name="l01685"></a>01685 
<a name="l01686"></a>01686     <span class="keywordflow">for</span> (stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; stk; stk = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#ad8662a79b275692dfc889101fa38b6c6">next</a>)
<a name="l01687"></a>01687     {
<a name="l01688"></a>01688         <span class="keywordtype">int</span> s_added = 0;
<a name="l01689"></a>01689         <span class="keywordtype">int</span> s_i;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691         <span class="keywordflow">for</span> (s_i = 0; s_i &lt; stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1; s_i++)
<a name="l01692"></a>01692         {
<a name="l01693"></a>01693             <span class="keywordtype">float</span> s_p1[3] = {0, 0, 0};
<a name="l01694"></a>01694             <span class="keywordtype">float</span> s_p2[3] = {0, 0, 0};
<a name="l01695"></a>01695             <span class="keywordtype">int</span> g_i;
<a name="l01696"></a>01696 
<a name="l01697"></a>01697             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, s_p1);
<a name="l01698"></a>01698             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, s_p2);
<a name="l01699"></a>01699 
<a name="l01700"></a>01700             <span class="keywordflow">for</span> (g_i = 0; g_i &lt; gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1; g_i++)
<a name="l01701"></a>01701             {
<a name="l01702"></a>01702                 <span class="keywordtype">float</span> g_p1[3] = {0, 0, 0};
<a name="l01703"></a>01703                 <span class="keywordtype">float</span> g_p2[3] = {0, 0, 0};
<a name="l01704"></a>01704                 <span class="keywordtype">float</span> vi[3];
<a name="l01705"></a>01705                 <span class="keywordtype">float</span> lambda;
<a name="l01706"></a>01706 
<a name="l01707"></a>01707                 <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[g_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, g_p1);
<a name="l01708"></a>01708                 <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(ar, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[g_i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, g_p2);
<a name="l01709"></a>01709 
<a name="l01710"></a>01710                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#af76f0adb324c0b296b6e1ad5f69e5b73">isect_line_line_strict_v3</a>(s_p1, s_p2, g_p1, g_p2, vi, &amp;lambda))
<a name="l01711"></a>01711                 {
<a name="l01712"></a>01712                     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a>), <span class="stringliteral">&quot;Intersection&quot;</span>);
<a name="l01713"></a>01713                     <span class="keywordtype">float</span> ray_start[3], ray_end[3];
<a name="l01714"></a>01714                     <span class="keywordtype">float</span> mval[2];
<a name="l01715"></a>01715 
<a name="l01716"></a>01716                     isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#adc72efe05964a11963c3d3eb13297e27">gesture_index</a> = g_i;
<a name="l01717"></a>01717                     isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a> = s_i;
<a name="l01718"></a>01718                     isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a> = s_i + 1;
<a name="l01719"></a>01719                     isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> = stk;
<a name="l01720"></a>01720                     isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a445f49961798ae3ddf30eefd89040a29">lambda</a> = lambda;
<a name="l01721"></a>01721 
<a name="l01722"></a>01722                     mval[0] = vi[0];
<a name="l01723"></a>01723                     mval[1] = vi[1];
<a name="l01724"></a>01724                     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af9aebaced5bcc3391caf7d62b0b6d4b3">ED_view3d_win_to_segment_clip</a>(ar, v3d, mval, ray_start, ray_end);
<a name="l01725"></a>01725 
<a name="l01726"></a>01726                     <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a60ead4f3b5813794f90d67f9d2ee1bfa">isect_line_line_v3</a>( stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>,
<a name="l01727"></a>01727                                         stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[s_i + 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>,
<a name="l01728"></a>01728                                         ray_start,
<a name="l01729"></a>01729                                         ray_end,
<a name="l01730"></a>01730                                         isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>,
<a name="l01731"></a>01731                                         vi);
<a name="l01732"></a>01732 
<a name="l01733"></a>01733                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(list, isect);
<a name="l01734"></a>01734 
<a name="l01735"></a>01735                     s_added++;
<a name="l01736"></a>01736                 }
<a name="l01737"></a>01737             }
<a name="l01738"></a>01738         }
<a name="l01739"></a>01739 
<a name="l01740"></a>01740         added = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(s_added, added);
<a name="l01741"></a>01741     }
<a name="l01742"></a>01742 
<a name="l01743"></a>01743     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa842d1a72dc3dc49faa64be1b066797a">BLI_sortlist</a>(list, <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a10a056c4be78d7eb61c65ae498fd6fb1">cmpIntersections</a>);
<a name="l01744"></a>01744 
<a name="l01745"></a>01745     <span class="keywordflow">return</span> added;
<a name="l01746"></a>01746 }
<a name="l01747"></a>01747 
<a name="l01748"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e54304ca3a3c20f821b1d1ee0a69778">01748</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e54304ca3a3c20f821b1d1ee0a69778">sk_getSegments</a>(<a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *segments, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *gesture)
<a name="l01749"></a>01749 {
<a name="l01750"></a>01750     <a class="code" href="../../d3/d81/structSK__StrokeIterator.html">SK_StrokeIterator</a> sk_iter;
<a name="l01751"></a>01751     <a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a> *iter = (<a class="code" href="../../d7/da3/structBArcIterator.html">BArcIterator</a>*)&amp;sk_iter;
<a name="l01752"></a>01752 
<a name="l01753"></a>01753     <span class="keywordtype">float</span> CORRELATION_THRESHOLD = 0.99f;
<a name="l01754"></a>01754     <span class="keywordtype">float</span> *vec;
<a name="l01755"></a>01755     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1050aff57e9824aa59ad47f55e6c97d2">sk_appendStrokePoint</a>(segments, &amp;gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[0]);
<a name="l01758"></a>01758     vec = segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>;
<a name="l01759"></a>01759 
<a name="l01760"></a>01760     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee297b0a6157a5c37a1cdaff384d958d">initStrokeIterator</a>(iter, gesture, 0, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1);
<a name="l01761"></a>01761 
<a name="l01762"></a>01762     <span class="keywordflow">for</span> (i = 1, j = 0; i &lt; gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a>; i++)
<a name="l01763"></a>01763     {
<a name="l01764"></a>01764         <span class="keywordtype">float</span> n[3];
<a name="l01765"></a>01765 
<a name="l01766"></a>01766         <span class="comment">/* Calculate normal */</span>
<a name="l01767"></a>01767         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(n, gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, vec);
<a name="l01768"></a>01768 
<a name="l01769"></a>01769         <span class="keywordflow">if</span> (<a class="code" href="../../de/dad/BIF__generate_8h.html#af1295d3b4097bb0ce67f2e2cb48c0969">calcArcCorrelation</a>(iter, j, i, vec, n) &lt; CORRELATION_THRESHOLD)
<a name="l01770"></a>01770         {
<a name="l01771"></a>01771             j = i - 1;
<a name="l01772"></a>01772             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1050aff57e9824aa59ad47f55e6c97d2">sk_appendStrokePoint</a>(segments, &amp;gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[j]);
<a name="l01773"></a>01773             vec = segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>;
<a name="l01774"></a>01774             segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>;
<a name="l01775"></a>01775         }
<a name="l01776"></a>01776     }
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1050aff57e9824aa59ad47f55e6c97d2">sk_appendStrokePoint</a>(segments, &amp;gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[gesture-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1]);
<a name="l01779"></a>01779 
<a name="l01780"></a>01780     <span class="keywordflow">return</span> segments-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1;
<a name="l01781"></a>01781 }
<a name="l01782"></a>01782 
<a name="l01783"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5a8fd905477da1d6c0bf225feaad65ff">01783</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a888d8739df031ff9f4fcd2fea4743128">sk_detectCutGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01784"></a>01784 {
<a name="l01785"></a>01785     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> == 1 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> == 1)
<a name="l01786"></a>01786     {
<a name="l01787"></a>01787         <span class="keywordflow">return</span> 1;
<a name="l01788"></a>01788     }
<a name="l01789"></a>01789 
<a name="l01790"></a>01790     <span class="keywordflow">return</span> 0;
<a name="l01791"></a>01791 }
<a name="l01792"></a>01792 
<a name="l01793"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6225a1fc7423ed4487d29cd75dc10fdb">01793</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae0ea75d8bf13477b9506235442541c56">sk_applyCutGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01794"></a>01794 {
<a name="l01795"></a>01795     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l01798"></a>01798     {
<a name="l01799"></a>01799         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> pt;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801         pt.<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>;
<a name="l01802"></a>01802         pt.<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a9e274f782cbc3c8fc67eb5336bbaed45">PT_PROJECT</a>; <span class="comment">/* take mode from neighboring points */</span>
<a name="l01803"></a>01803         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt.<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>);
<a name="l01804"></a>01804         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt.<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>].<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>);
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a94defcdf4d1d2b3c0318444421d9b666">sk_insertStrokePoint</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, &amp;pt, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l01807"></a>01807     }
<a name="l01808"></a>01808 }
<a name="l01809"></a>01809 
<a name="l01810"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6bccfda43be181cef0d774dcdde431fc">01810</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a265cccf66af1c0b33ba824ae4483ab7c">sk_detectTrimGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01811"></a>01811 {
<a name="l01812"></a>01812     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> == 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> == 1 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a23e486db396d49c4c6b8fd2b80a3b2f2">nb_self_intersections</a> == 0)
<a name="l01813"></a>01813     {
<a name="l01814"></a>01814         <span class="keywordtype">float</span> s1[3], s2[3];
<a name="l01815"></a>01815         <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l01816"></a>01816 
<a name="l01817"></a>01817         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(s1, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[0].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01818"></a>01818         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(s2, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[2].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01819"></a>01819 
<a name="l01820"></a>01820         angle = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a927d5473f59c68eed4145d5488288273">angle_v2v2</a>(s1, s2));
<a name="l01821"></a>01821 
<a name="l01822"></a>01822         <span class="keywordflow">if</span> (angle &gt; 60 &amp;&amp; angle &lt; 120)
<a name="l01823"></a>01823         {
<a name="l01824"></a>01824             <span class="keywordflow">return</span> 1;
<a name="l01825"></a>01825         }
<a name="l01826"></a>01826     }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828     <span class="keywordflow">return</span> 0;
<a name="l01829"></a>01829 }
<a name="l01830"></a>01830 
<a name="l01831"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5374fded759a08bec970c6d9e439fd41">01831</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a243c73a78af71ae43eb3efdcb0c1c9df">sk_applyTrimGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01832"></a>01832 {
<a name="l01833"></a>01833     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l01834"></a>01834     <span class="keywordtype">float</span> trim_dir[3];
<a name="l01835"></a>01835 
<a name="l01836"></a>01836     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(trim_dir, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[2].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01837"></a>01837 
<a name="l01838"></a>01838     <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l01839"></a>01839     {
<a name="l01840"></a>01840         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> pt;
<a name="l01841"></a>01841         <span class="keywordtype">float</span> stroke_dir[3];
<a name="l01842"></a>01842 
<a name="l01843"></a>01843         pt.<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>;
<a name="l01844"></a>01844         pt.<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a9e274f782cbc3c8fc67eb5336bbaed45">PT_PROJECT</a>; <span class="comment">/* take mode from neighboring points */</span>
<a name="l01845"></a>01845         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt.<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>);
<a name="l01846"></a>01846         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pt.<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>].<a class="code" href="../../da/d5c/structSK__Point.html#a9490752004dd7e8d353fb8513c0bd4c7">no</a>);
<a name="l01847"></a>01847 
<a name="l01848"></a>01848         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(stroke_dir, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01849"></a>01849 
<a name="l01850"></a>01850         <span class="comment">/* same direction, trim end */</span>
<a name="l01851"></a>01851         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(stroke_dir, trim_dir) &gt; 0)
<a name="l01852"></a>01852         {
<a name="l01853"></a>01853             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a85f46a972f8d9d3b862f454e355b3557">sk_replaceStrokePoint</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, &amp;pt, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l01854"></a>01854             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a01ce936d6725f0489a7cffc49a486b82">sk_trimStroke</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, 0, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l01855"></a>01855         }
<a name="l01856"></a>01856         <span class="comment">/* else, trim start */</span>
<a name="l01857"></a>01857         <span class="keywordflow">else</span>
<a name="l01858"></a>01858         {
<a name="l01859"></a>01859             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a85f46a972f8d9d3b862f454e355b3557">sk_replaceStrokePoint</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, &amp;pt, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>);
<a name="l01860"></a>01860             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a01ce936d6725f0489a7cffc49a486b82">sk_trimStroke</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> - 1);
<a name="l01861"></a>01861         }
<a name="l01862"></a>01862 
<a name="l01863"></a>01863     }
<a name="l01864"></a>01864 }
<a name="l01865"></a>01865 
<a name="l01866"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab5aabe081266c9fb5cff46ba25bdf45d">01866</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae58896306f50928aabe60e5397e855e4">sk_detectCommandGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01867"></a>01867 {
<a name="l01868"></a>01868     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> &gt; 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> == 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a23e486db396d49c4c6b8fd2b80a3b2f2">nb_self_intersections</a> == 1)
<a name="l01869"></a>01869     {
<a name="l01870"></a>01870         <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect, *self_isect;
<a name="l01871"></a>01871 
<a name="l01872"></a>01872         <span class="comment">/* get the the last intersection of the first pair */</span>
<a name="l01873"></a>01873         <span class="keywordflow">for</span> ( isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a> )
<a name="l01874"></a>01874         {
<a name="l01875"></a>01875             <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l01876"></a>01876             {
<a name="l01877"></a>01877                 isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l01878"></a>01878                 <span class="keywordflow">break</span>;
<a name="l01879"></a>01879             }
<a name="l01880"></a>01880         }
<a name="l01881"></a>01881 
<a name="l01882"></a>01882         self_isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a846ca7d56134724acab5c01416586ffe">self_intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01883"></a>01883 
<a name="l01884"></a>01884         <span class="keywordflow">if</span> (isect &amp;&amp; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#adc72efe05964a11963c3d3eb13297e27">gesture_index</a> &lt; self_isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#adc72efe05964a11963c3d3eb13297e27">gesture_index</a>)
<a name="l01885"></a>01885         {
<a name="l01886"></a>01886             <span class="keywordflow">return</span> 1;
<a name="l01887"></a>01887         }
<a name="l01888"></a>01888     }
<a name="l01889"></a>01889 
<a name="l01890"></a>01890     <span class="keywordflow">return</span> 0;
<a name="l01891"></a>01891 }
<a name="l01892"></a>01892 
<a name="l01893"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afa5f012c15f617d76d5104779f1c909c">01893</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3c086399e333a83c64d40d5464325dfd">sk_applyCommandGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01894"></a>01894 {
<a name="l01895"></a>01895     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l01896"></a>01896     <span class="keywordtype">int</span> command = 1;
<a name="l01897"></a>01897 
<a name="l01898"></a>01898 <span class="comment">//  XXX</span>
<a name="l01899"></a>01899 <span class="comment">//  command = pupmenu(&quot;Action %t|Flatten %x1|Straighten %x2|Polygonize %x3&quot;);</span>
<a name="l01900"></a>01900     <span class="keywordflow">if</span> (command &lt; 1) <span class="keywordflow">return</span>;
<a name="l01901"></a>01901 
<a name="l01902"></a>01902     <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l01903"></a>01903     {
<a name="l01904"></a>01904         <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *i2;
<a name="l01905"></a>01905 
<a name="l01906"></a>01906         i2 = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l01907"></a>01907 
<a name="l01908"></a>01908         <span class="keywordflow">if</span> (i2 &amp;&amp; i2-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l01909"></a>01909         {
<a name="l01910"></a>01910             <span class="keywordflow">switch</span> (command)
<a name="l01911"></a>01911             {
<a name="l01912"></a>01912                 <span class="keywordflow">case</span> 1:
<a name="l01913"></a>01913                     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ab3de3ad601da35ae270ce7cf99c8a75f">sk_flattenStroke</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>, i2-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l01914"></a>01914                     <span class="keywordflow">break</span>;
<a name="l01915"></a>01915                 <span class="keywordflow">case</span> 2:
<a name="l01916"></a>01916                     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a6cb9eba69815753dd0bb0e89ea8347f4">sk_straightenStroke</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>, i2-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>, i2-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>);
<a name="l01917"></a>01917                     <span class="keywordflow">break</span>;
<a name="l01918"></a>01918                 <span class="keywordflow">case</span> 3:
<a name="l01919"></a>01919                     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a97fde9836db8cd49116caf9c53951a1e">sk_polygonizeStroke</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>, i2-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l01920"></a>01920                     <span class="keywordflow">break</span>;
<a name="l01921"></a>01921             }
<a name="l01922"></a>01922 
<a name="l01923"></a>01923             isect = i2;
<a name="l01924"></a>01924         }
<a name="l01925"></a>01925     }
<a name="l01926"></a>01926 }
<a name="l01927"></a>01927 
<a name="l01928"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1afde9591b031eca33f0c1e19d8f1582">01928</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#afd4ce8801ac1338d31f605722e69874a">sk_detectDeleteGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01929"></a>01929 {
<a name="l01930"></a>01930     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> == 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> == 2)
<a name="l01931"></a>01931     {
<a name="l01932"></a>01932         <span class="keywordtype">float</span> s1[3], s2[3];
<a name="l01933"></a>01933         <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l01934"></a>01934 
<a name="l01935"></a>01935         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(s1, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[0].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01936"></a>01936         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(s2, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[2].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[1].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l01937"></a>01937 
<a name="l01938"></a>01938         angle = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a927d5473f59c68eed4145d5488288273">angle_v2v2</a>(s1, s2));
<a name="l01939"></a>01939 
<a name="l01940"></a>01940         <span class="keywordflow">if</span> (angle &gt; 120)
<a name="l01941"></a>01941         {
<a name="l01942"></a>01942             <span class="keywordflow">return</span> 1;
<a name="l01943"></a>01943         }
<a name="l01944"></a>01944     }
<a name="l01945"></a>01945 
<a name="l01946"></a>01946     <span class="keywordflow">return</span> 0;
<a name="l01947"></a>01947 }
<a name="l01948"></a>01948 
<a name="l01949"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af2546aba3fd5f282d745179098a92f07">01949</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a63c64b5ea14834d44ec00e9fed95a345">sk_applyDeleteGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l01950"></a>01950 {
<a name="l01951"></a>01951     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l01954"></a>01954     {
<a name="l01955"></a>01955         <span class="comment">/* only delete strokes that are crossed twice */</span>
<a name="l01956"></a>01956         <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a> &amp;&amp; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l01957"></a>01957         {
<a name="l01958"></a>01958             isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l01959"></a>01959 
<a name="l01960"></a>01960             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a0dc330dc52840b50934a2ca5f3f90802">sk_removeStroke</a>(sketch, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>);
<a name="l01961"></a>01961         }
<a name="l01962"></a>01962     }
<a name="l01963"></a>01963 }
<a name="l01964"></a>01964 
<a name="l01965"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab0a6b3adbe34228011e944b5d6b0b96f">01965</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae731451a9db73a60bd00e89903f18262">sk_detectMergeGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l01966"></a>01966 {
<a name="l01967"></a>01967     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01968"></a>01968     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> &gt; 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> == 2)
<a name="l01969"></a>01969     {
<a name="l01970"></a>01970         <span class="keywordtype">short</span> start_val[2], end_val[2];
<a name="l01971"></a>01971         <span class="keywordtype">short</span> dist;
<a name="l01972"></a>01972 
<a name="l01973"></a>01973         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(ar, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[0].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, start_val);
<a name="l01974"></a>01974         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(ar, <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>)-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, end_val);
<a name="l01975"></a>01975 
<a name="l01976"></a>01976         dist = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(start_val[0] - end_val[0]), <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(start_val[1] - end_val[1]));
<a name="l01977"></a>01977 
<a name="l01978"></a>01978         <span class="comment">/* if gesture is a circle */</span>
<a name="l01979"></a>01979         <span class="keywordflow">if</span> ( dist &lt;= 20 )
<a name="l01980"></a>01980         {
<a name="l01981"></a>01981             <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l01982"></a>01982 
<a name="l01983"></a>01983             <span class="comment">/* check if it circled around an exact point */</span>
<a name="l01984"></a>01984             <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l01985"></a>01985             {
<a name="l01986"></a>01986                 <span class="comment">/* only delete strokes that are crossed twice */</span>
<a name="l01987"></a>01987                 <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a> &amp;&amp; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l01988"></a>01988                 {
<a name="l01989"></a>01989                     <span class="keywordtype">int</span> start_index, end_index;
<a name="l01990"></a>01990                     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01991"></a>01991 
<a name="l01992"></a>01992                     start_index = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l01993"></a>01993                     end_index = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>);
<a name="l01994"></a>01994 
<a name="l01995"></a>01995                     <span class="keywordflow">for</span> (i = start_index; i &lt;= end_index; i++)
<a name="l01996"></a>01996                     {
<a name="l01997"></a>01997                         <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l01998"></a>01998                         {
<a name="l01999"></a>01999                             <span class="keywordflow">return</span> 1; <span class="comment">/* at least one exact point found, stop detect here */</span>
<a name="l02000"></a>02000                         }
<a name="l02001"></a>02001                     }
<a name="l02002"></a>02002 
<a name="l02003"></a>02003                     <span class="comment">/* skip next */</span>
<a name="l02004"></a>02004                     isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l02005"></a>02005                 }
<a name="l02006"></a>02006             }
<a name="l02007"></a>02007         }
<a name="l02008"></a>02008     }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010     <span class="keywordflow">return</span> 0;
<a name="l02011"></a>02011 }
<a name="l02012"></a>02012 
<a name="l02013"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae871fd591cfc92814cafdde4b547ffa6">02013</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa5bd5d3f99a94efc669cfb8213d11f89">sk_applyMergeGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l02014"></a>02014 {
<a name="l02015"></a>02015     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l02016"></a>02016 
<a name="l02017"></a>02017     <span class="comment">/* check if it circled around an exact point */</span>
<a name="l02018"></a>02018     <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l02019"></a>02019     {
<a name="l02020"></a>02020         <span class="comment">/* only merge strokes that are crossed twice */</span>
<a name="l02021"></a>02021         <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a> &amp;&amp; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l02022"></a>02022         {
<a name="l02023"></a>02023             <span class="keywordtype">int</span> start_index, end_index;
<a name="l02024"></a>02024             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02025"></a>02025 
<a name="l02026"></a>02026             start_index = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac667dad0cc2bce64a8dba24f42dbb84b">after</a>);
<a name="l02027"></a>02027             end_index = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#ac1e4142fd3ff2f60d1c8694a796cca2d">before</a>);
<a name="l02028"></a>02028 
<a name="l02029"></a>02029             <span class="keywordflow">for</span> (i = start_index; i &lt;= end_index; i++)
<a name="l02030"></a>02030             {
<a name="l02031"></a>02031                 <span class="comment">/* if exact, switch to continuous */</span>
<a name="l02032"></a>02032                 <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[i].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> == <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a7df97fa804cc886630c96325c4e428c4">PT_EXACT</a>)
<a name="l02033"></a>02033                 {
<a name="l02034"></a>02034                     isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d5c/structSK__Point.html#a69018927b7778773a1c5b96d25ebba82">type</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a313386a750306636d12776133bca9659a968c66960fce7cea1e8bebe1f0059c8f">PT_CONTINUOUS</a>;
<a name="l02035"></a>02035                 }
<a name="l02036"></a>02036             }
<a name="l02037"></a>02037 
<a name="l02038"></a>02038             <span class="comment">/* skip next */</span>
<a name="l02039"></a>02039             isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l02040"></a>02040         }
<a name="l02041"></a>02041     }
<a name="l02042"></a>02042 }
<a name="l02043"></a>02043 
<a name="l02044"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4f22d55c1fa74ebbb8db6ecb90e3bd8e">02044</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5b5b05615e1ababadcb6097676a44cb7">sk_detectReverseGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l02045"></a>02045 {
<a name="l02046"></a>02046     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> &gt; 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> == 2 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a23e486db396d49c4c6b8fd2b80a3b2f2">nb_self_intersections</a> == 0)
<a name="l02047"></a>02047     {
<a name="l02048"></a>02048         <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l02049"></a>02049 
<a name="l02050"></a>02050         <span class="comment">/* check if it circled around an exact point */</span>
<a name="l02051"></a>02051         <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l02052"></a>02052         {
<a name="l02053"></a>02053             <span class="comment">/* only delete strokes that are crossed twice */</span>
<a name="l02054"></a>02054             <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a> &amp;&amp; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l02055"></a>02055             {
<a name="l02056"></a>02056                 <span class="keywordtype">float</span> start_v[3], end_v[3];
<a name="l02057"></a>02057                 <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059                 <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#adc72efe05964a11963c3d3eb13297e27">gesture_index</a> &lt; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#adc72efe05964a11963c3d3eb13297e27">gesture_index</a>)
<a name="l02060"></a>02060                 {
<a name="l02061"></a>02061                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(start_v, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[0].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l02062"></a>02062                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(end_v, <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>)-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>);
<a name="l02063"></a>02063                 }
<a name="l02064"></a>02064                 <span class="keywordflow">else</span>
<a name="l02065"></a>02065                 {
<a name="l02066"></a>02066                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(start_v, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a7b1365e992223b9a619eac7ade3a60dc">points</a>[0].<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>);
<a name="l02067"></a>02067                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(end_v, <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>)-&gt;<a class="code" href="../../da/d5c/structSK__Point.html#a9d5a1b2a1d42398bbbfac4650f114b13">p</a>, isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a8ebb6841a3e0674a766252274f93ce63">p</a>);
<a name="l02068"></a>02068                 }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070                 angle = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a927d5473f59c68eed4145d5488288273">angle_v2v2</a>(start_v, end_v));
<a name="l02071"></a>02071 
<a name="l02072"></a>02072                 <span class="keywordflow">if</span> (angle &gt; 120)
<a name="l02073"></a>02073                 {
<a name="l02074"></a>02074                     <span class="keywordflow">return</span> 1;
<a name="l02075"></a>02075                 }
<a name="l02076"></a>02076 
<a name="l02077"></a>02077                 <span class="comment">/* skip next */</span>
<a name="l02078"></a>02078                 isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l02079"></a>02079             }
<a name="l02080"></a>02080         }
<a name="l02081"></a>02081     }
<a name="l02082"></a>02082 
<a name="l02083"></a>02083     <span class="keywordflow">return</span> 0;
<a name="l02084"></a>02084 }
<a name="l02085"></a>02085 
<a name="l02086"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3142585e2a04849d5932e211584f1449">02086</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aaa121be88395b20bc437b90c3759fd37">sk_applyReverseGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l02087"></a>02087 {
<a name="l02088"></a>02088     <a class="code" href="../../d8/dbf/structSK__Intersection.html">SK_Intersection</a> *isect;
<a name="l02089"></a>02089 
<a name="l02090"></a>02090     <span class="keywordflow">for</span> (isect = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; isect; isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>)
<a name="l02091"></a>02091     {
<a name="l02092"></a>02092         <span class="comment">/* only reverse strokes that are crossed twice */</span>
<a name="l02093"></a>02093         <span class="keywordflow">if</span> (isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a> &amp;&amp; isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a> == isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>)
<a name="l02094"></a>02094         {
<a name="l02095"></a>02095             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ad5a60c8c01485f6a4c6421c6ecaf9d12">sk_reverseStroke</a>(isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a3bd2d47f760fcb9f1ef108f2b2ee4398">stroke</a>);
<a name="l02096"></a>02096 
<a name="l02097"></a>02097             <span class="comment">/* skip next */</span>
<a name="l02098"></a>02098             isect = isect-&gt;<a class="code" href="../../d8/dbf/structSK__Intersection.html#a51484bd71136420973dab04f7202f122">next</a>;
<a name="l02099"></a>02099         }
<a name="l02100"></a>02100     }
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab4e65f595e3765f7191c6907f3163aa1">02103</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a380c3ff51afa1846a6994ec63bd5ca24">sk_detectConvertGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(sketch))
<a name="l02104"></a>02104 {
<a name="l02105"></a>02105     <span class="keywordflow">if</span> (gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> == 3 &amp;&amp; gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a23e486db396d49c4c6b8fd2b80a3b2f2">nb_self_intersections</a> == 1)
<a name="l02106"></a>02106     {
<a name="l02107"></a>02107         <span class="keywordflow">return</span> 1;
<a name="l02108"></a>02108     }
<a name="l02109"></a>02109     <span class="keywordflow">return</span> 0;
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 
<a name="l02112"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aab301704637492f33dcddd07f377e51a">02112</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a73aabf16980a3753034e85ddd1cb91be">sk_applyConvertGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(gest), <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02113"></a>02113 {
<a name="l02114"></a>02114     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa46a408784b9444d0bddeb52888da8d6">sk_convert</a>(C, sketch);
<a name="l02115"></a>02115 }
<a name="l02116"></a>02116 
<a name="l02117"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abd698265215086b259e2b787c4b0a0f6">02117</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abd698265215086b259e2b787c4b0a0f6">sk_initGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02118"></a>02118 {
<a name="l02119"></a>02119     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02120"></a>02120     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a846ca7d56134724acab5c01416586ffe">self_intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a846ca7d56134724acab5c01416586ffe">self_intersections</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02121"></a>02121 
<a name="l02122"></a>02122     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a8d1b4bf8adee1d9e728df802dccdeba4">sk_createStroke</a>();
<a name="l02123"></a>02123     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a> = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a>;
<a name="l02124"></a>02124 
<a name="l02125"></a>02125     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a23e486db396d49c4c6b8fd2b80a3b2f2">nb_self_intersections</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a65ffa49ce5755a20a3cb03aded45b127">sk_getSelfIntersections</a>(C, &amp;gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a846ca7d56134724acab5c01416586ffe">self_intersections</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>);
<a name="l02126"></a>02126     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a8909d80b298e043cfbf32ca51e780870">nb_intersections</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a84dbc227032ac91e98a8545ee16c29dd">sk_getIntersections</a>(C, &amp;gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>, sketch, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>);
<a name="l02127"></a>02127     gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a332b2af166eb905e01ed3209079e612c">nb_segments</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e54304ca3a3c20f821b1d1ee0a69778">sk_getSegments</a>(gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>, gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a27c0fe88966d271cde40dd2e0bee51c8">stk</a>);
<a name="l02128"></a>02128 }
<a name="l02129"></a>02129 
<a name="l02130"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ad1853482e86d313fc2cc257f5ed9e02c">02130</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ad1853482e86d313fc2cc257f5ed9e02c">sk_freeGesture</a>(<a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> *gest)
<a name="l02131"></a>02131 {
<a name="l02132"></a>02132     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1b3126e21fbbc3d64c3e25d5eb62fe2f">sk_freeStroke</a>(gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a26818a10cf25f37d76c7f8986890e568">segments</a>);
<a name="l02133"></a>02133     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a9ba1b965cc1b97fdbf9a3fa6c5a15042">intersections</a>);
<a name="l02134"></a>02134     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;gest-&gt;<a class="code" href="../../d3/dec/structSK__Gesture.html#a846ca7d56134724acab5c01416586ffe">self_intersections</a>);
<a name="l02135"></a>02135 }
<a name="l02136"></a>02136 
<a name="l02137"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3cd11bc357adc4e8ce11c7632b73d75b">02137</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3cd11bc357adc4e8ce11c7632b73d75b">sk_applyGesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02138"></a>02138 {
<a name="l02139"></a>02139     <a class="code" href="../../d3/dec/structSK__Gesture.html">SK_Gesture</a> gest;
<a name="l02140"></a>02140     <a class="code" href="../../d9/d18/structSK__GestureAction.html">SK_GestureAction</a> *act;
<a name="l02141"></a>02141 
<a name="l02142"></a>02142     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abd698265215086b259e2b787c4b0a0f6">sk_initGesture</a>(C, &amp;gest, sketch);
<a name="l02143"></a>02143 
<a name="l02144"></a>02144     <span class="comment">/* detect and apply */</span>
<a name="l02145"></a>02145     <span class="keywordflow">for</span> (act = GESTURE_ACTIONS; act-&gt;<a class="code" href="../../d9/d18/structSK__GestureAction.html#abb50a876bca21114bcecb52b32c0eb19">apply</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; act++)
<a name="l02146"></a>02146     {
<a name="l02147"></a>02147         <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d9/d18/structSK__GestureAction.html#aeaa36c79582fd1d186ee577b34bc8b84">detect</a>(C, &amp;gest, sketch))
<a name="l02148"></a>02148         {
<a name="l02149"></a>02149             act-&gt;<a class="code" href="../../d9/d18/structSK__GestureAction.html#abb50a876bca21114bcecb52b32c0eb19">apply</a>(C, &amp;gest, sketch);
<a name="l02150"></a>02150             <span class="keywordflow">break</span>;
<a name="l02151"></a>02151         }
<a name="l02152"></a>02152     }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ad1853482e86d313fc2cc257f5ed9e02c">sk_freeGesture</a>(&amp;gest);
<a name="l02155"></a>02155 }
<a name="l02156"></a>02156 
<a name="l02157"></a>02157 <span class="comment">/********************************************/</span>
<a name="l02158"></a>02158 
<a name="l02159"></a>02159 
<a name="l02160"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af3dcb881281293403ea3136dee7b0da8">02160</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af3dcb881281293403ea3136dee7b0da8">sk_selectStroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">int</span> extend)
<a name="l02161"></a>02161 {
<a name="l02162"></a>02162     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> vc;
<a name="l02163"></a>02163     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect;
<a name="l02164"></a>02164     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buffer[<a class="code" href="../../d8/d6a/ED__view3d_8h.html#a6bf150a3c83492b0adab9ea7068a3f86">MAXPICKBUF</a>];
<a name="l02165"></a>02165     <span class="keywordtype">short</span> hits;
<a name="l02166"></a>02166 
<a name="l02167"></a>02167     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa18efc327ab12e74064a2c1129237431">view3d_set_viewcontext</a>(C, &amp;vc);
<a name="l02168"></a>02168 
<a name="l02169"></a>02169     rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = mval[0]-5;
<a name="l02170"></a>02170     rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = mval[0]+5;
<a name="l02171"></a>02171     rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = mval[1]-5;
<a name="l02172"></a>02172     rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = mval[1]+5;
<a name="l02173"></a>02173 
<a name="l02174"></a>02174     hits = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a0f44a733a5f482f839faaafa07e4f3da">view3d_opengl_select</a>(&amp;vc, buffer, <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a6bf150a3c83492b0adab9ea7068a3f86">MAXPICKBUF</a>, &amp;rect);
<a name="l02175"></a>02175 
<a name="l02176"></a>02176     <span class="keywordflow">if</span> (hits&gt;0)
<a name="l02177"></a>02177     {
<a name="l02178"></a>02178         <span class="keywordtype">int</span> besthitresult = -1;
<a name="l02179"></a>02179 
<a name="l02180"></a>02180         <span class="keywordflow">if</span> (hits == 1) {
<a name="l02181"></a>02181             besthitresult = buffer[3];
<a name="l02182"></a>02182         }
<a name="l02183"></a>02183         <span class="keywordflow">else</span> {
<a name="l02184"></a>02184             besthitresult = buffer[3];
<a name="l02185"></a>02185             <span class="comment">/* loop and get best hit */</span>
<a name="l02186"></a>02186         }
<a name="l02187"></a>02187 
<a name="l02188"></a>02188         <span class="keywordflow">if</span> (besthitresult &gt; 0)
<a name="l02189"></a>02189         {
<a name="l02190"></a>02190             <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *selected_stk = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>, besthitresult - 1);
<a name="l02191"></a>02191 
<a name="l02192"></a>02192             <span class="keywordflow">if</span> (extend == 0)
<a name="l02193"></a>02193             {
<a name="l02194"></a>02194                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a256d2bc29ca62f365278c1247cf5c65b">sk_selectAllSketch</a>(sketch, -1);
<a name="l02195"></a>02195 
<a name="l02196"></a>02196                 selected_stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a10ef00285f34d710337b71e9b979dc98">selected</a> = 1;
<a name="l02197"></a>02197             }
<a name="l02198"></a>02198             <span class="keywordflow">else</span>
<a name="l02199"></a>02199             {
<a name="l02200"></a>02200                 selected_stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a10ef00285f34d710337b71e9b979dc98">selected</a> ^= 1;
<a name="l02201"></a>02201             }
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 
<a name="l02204"></a>02204         }
<a name="l02205"></a>02205         <span class="keywordflow">return</span> 1;
<a name="l02206"></a>02206     }
<a name="l02207"></a>02207 
<a name="l02208"></a>02208     <span class="keywordflow">return</span> 0;
<a name="l02209"></a>02209 }
<a name="l02210"></a>02210 
<a name="l02211"></a>02211 <span class="preprocessor">#if 0 </span><span class="comment">/* UNUSED 2.5 */</span>
<a name="l02212"></a>02212 <span class="keyword">static</span> <span class="keywordtype">void</span> sk_queueRedrawSketch(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02213"></a>02213 {
<a name="l02214"></a>02214     <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02215"></a>02215     {
<a name="l02216"></a>02216         <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *last = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>);
<a name="l02217"></a>02217 
<a name="l02218"></a>02218         <span class="keywordflow">if</span> (last != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02219"></a>02219         {
<a name="l02220"></a>02220 <span class="comment">//          XXX</span>
<a name="l02221"></a>02221 <span class="comment">//          allqueue(REDRAWVIEW3D, 0);</span>
<a name="l02222"></a>02222         }
<a name="l02223"></a>02223     }
<a name="l02224"></a>02224 }
<a name="l02225"></a>02225 <span class="preprocessor">#endif</span>
<a name="l02226"></a>02226 <span class="preprocessor"></span>
<a name="l02227"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0d731a74af8f5ddd59410c4cab88a187">02227</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0d731a74af8f5ddd59410c4cab88a187">sk_drawSketch</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(v3d), <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <span class="keywordtype">int</span> with_names)
<a name="l02228"></a>02228 {
<a name="l02229"></a>02229     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l02230"></a>02230     <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk;
<a name="l02231"></a>02231 
<a name="l02232"></a>02232     glClear(GL_DEPTH_BUFFER_BIT);
<a name="l02233"></a>02233     glEnable(GL_DEPTH_TEST);
<a name="l02234"></a>02234 
<a name="l02235"></a>02235     <span class="keywordflow">if</span> (with_names)
<a name="l02236"></a>02236     {
<a name="l02237"></a>02237         <span class="keywordtype">int</span> id;
<a name="l02238"></a>02238         <span class="keywordflow">for</span> (<span class="keywordtype">id</span> = 1, stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; stk; <span class="keywordtype">id</span>++, stk = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#ad8662a79b275692dfc889101fa38b6c6">next</a>)
<a name="l02239"></a>02239         {
<a name="l02240"></a>02240             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a26e673c5e9c11330722fd6ede7255925">sk_drawStroke</a>(stk, <span class="keywordtype">id</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, -1);
<a name="l02241"></a>02241         }
<a name="l02242"></a>02242 
<a name="l02243"></a>02243         glLoadName(-1);
<a name="l02244"></a>02244     }
<a name="l02245"></a>02245     <span class="keywordflow">else</span>
<a name="l02246"></a>02246     {
<a name="l02247"></a>02247         <span class="keywordtype">float</span> selected_rgb[3] = {1, 0, 0};
<a name="l02248"></a>02248         <span class="keywordtype">float</span> unselected_rgb[3] = {1, 0.5, 0};
<a name="l02249"></a>02249 
<a name="l02250"></a>02250         <span class="keywordflow">for</span> (stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a3b36bbcaed2005b02fe5337c88fef333">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; stk; stk = stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#ad8662a79b275692dfc889101fa38b6c6">next</a>)
<a name="l02251"></a>02251         {
<a name="l02252"></a>02252             <span class="keywordtype">int</span> start = -1;
<a name="l02253"></a>02253             <span class="keywordtype">int</span> end = -1;
<a name="l02254"></a>02254 
<a name="l02255"></a>02255             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1afb0a0fb276119809a18d8585da89cc">sk_hasOverdraw</a>(sketch, stk))
<a name="l02256"></a>02256             {
<a name="l02257"></a>02257                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2e3730bae7edc57d5e29b237ba05340c">sk_adjustIndexes</a>(sketch, &amp;start, &amp;end);
<a name="l02258"></a>02258             }
<a name="l02259"></a>02259 
<a name="l02260"></a>02260             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a26e673c5e9c11330722fd6ede7255925">sk_drawStroke</a>(stk, -1, (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a10ef00285f34d710337b71e9b979dc98">selected</a>==1?selected_rgb:unselected_rgb), start, end);
<a name="l02261"></a>02261 
<a name="l02262"></a>02262             <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a10ef00285f34d710337b71e9b979dc98">selected</a> == 1)
<a name="l02263"></a>02263             {
<a name="l02264"></a>02264                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a80222a30c7f6021db776da5336ff8d3d">sk_drawStrokeSubdivision</a>(ts, stk);
<a name="l02265"></a>02265             }
<a name="l02266"></a>02266         }
<a name="l02267"></a>02267 
<a name="l02268"></a>02268         <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02269"></a>02269         {
<a name="l02270"></a>02270             <a class="code" href="../../da/d5c/structSK__Point.html">SK_Point</a> *last = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a4858c4dcd8893f6a4f267dcb2a93b6b5">sk_lastStrokePoint</a>(sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>);
<a name="l02271"></a>02271 
<a name="l02272"></a>02272             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7fb4a9d1cf55c98515ffe2a47f4c8121">BONE_SKETCHING_QUICK</a>)
<a name="l02273"></a>02273             {
<a name="l02274"></a>02274                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a80222a30c7f6021db776da5336ff8d3d">sk_drawStrokeSubdivision</a>(ts, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>);
<a name="l02275"></a>02275             }
<a name="l02276"></a>02276 
<a name="l02277"></a>02277             <span class="keywordflow">if</span> (last != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02278"></a>02278             {
<a name="l02279"></a>02279                 GLUquadric *quad = gluNewQuadric();
<a name="l02280"></a>02280                 gluQuadricNormals(quad, GLU_SMOOTH);
<a name="l02281"></a>02281 
<a name="l02282"></a>02282                 glPushMatrix();
<a name="l02283"></a>02283 
<a name="l02284"></a>02284                 glEnable(GL_BLEND);
<a name="l02285"></a>02285                 glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l02286"></a>02286 
<a name="l02287"></a>02287                 <span class="keywordflow">switch</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab7526d7f570928e67ca9bfa4cae48371">next_point</a>.<a class="code" href="../../da/d5c/structSK__Point.html#a47377df17f62751d3e4ed9d7adf7e42b">mode</a>)
<a name="l02288"></a>02288                 {
<a name="l02289"></a>02289                     <span class="keywordflow">case</span> <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a3cc7a1d1fb8a174d025dd8aa9ecd3e12">PT_SNAP</a>:
<a name="l02290"></a>02290                         glColor3f(0, 1, 0);
<a name="l02291"></a>02291                         <span class="keywordflow">break</span>;
<a name="l02292"></a>02292                     <span class="keywordflow">case</span> <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a478151cee2c8d9716c34b0a0d69bd3f6a9e274f782cbc3c8fc67eb5336bbaed45">PT_PROJECT</a>:
<a name="l02293"></a>02293                         glColor3f(0, 0, 0);
<a name="l02294"></a>02294                         <span class="keywordflow">break</span>;
<a name="l02295"></a>02295                 }
<a name="l02296"></a>02296 
<a name="l02297"></a>02297                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a23c10effb46309d2a55791c0ebefd16e">sk_drawPoint</a>(quad, &amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab7526d7f570928e67ca9bfa4cae48371">next_point</a>, 0.1);
<a name="l02298"></a>02298 
<a name="l02299"></a>02299                 glColor4f(selected_rgb[0], selected_rgb[1], selected_rgb[2], 0.3);
<a name="l02300"></a>02300 
<a name="l02301"></a>02301                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a61c333fbb86e22ca70f94a988c64e4ea">sk_drawEdge</a>(quad, last, &amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab7526d7f570928e67ca9bfa4cae48371">next_point</a>, 0.1);
<a name="l02302"></a>02302 
<a name="l02303"></a>02303                 glDisable(GL_BLEND);
<a name="l02304"></a>02304 
<a name="l02305"></a>02305                 glPopMatrix();
<a name="l02306"></a>02306 
<a name="l02307"></a>02307                 gluDeleteQuadric(quad);
<a name="l02308"></a>02308             }
<a name="l02309"></a>02309         }
<a name="l02310"></a>02310     }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312 <span class="preprocessor">#if 0</span>
<a name="l02313"></a>02313 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02314"></a>02314     {
<a name="l02315"></a>02315         <span class="keywordtype">float</span> colors[8][3] = {
<a name="l02316"></a>02316                                 {1, 0, 0},
<a name="l02317"></a>02317                                 {0, 1, 0},
<a name="l02318"></a>02318                                 {0, 0, 1},
<a name="l02319"></a>02319                                 {1, 1, 0},
<a name="l02320"></a>02320                                 {1, 0, 1},
<a name="l02321"></a>02321                                 {0, 1, 1},
<a name="l02322"></a>02322                                 {1, 1, 1},
<a name="l02323"></a>02323                                 {0, 0, 0}
<a name="l02324"></a>02324                             };
<a name="l02325"></a>02325         <a class="code" href="../../dd/d2e/structDepthPeel.html">DepthPeel</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l02326"></a>02326         GLUquadric *quad = gluNewQuadric();
<a name="l02327"></a>02327         gluQuadricNormals(quad, GLU_SMOOTH);
<a name="l02328"></a>02328 
<a name="l02329"></a>02329         <span class="keywordflow">for</span> (p = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a8692c4de8ca9765499fe8215ebdb46d8">depth_peels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; p; p = p-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3e68f22298301121d828809e34130627">next</a>)
<a name="l02330"></a>02330         {
<a name="l02331"></a>02331             <span class="keywordtype">int</span> index = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#afe52e69b7f74d4e0319b467db917c08c">GET_INT_FROM_POINTER</a>(p-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#ab27fa26b1db7ae44426808550703698e">ob</a>);
<a name="l02332"></a>02332             index = (index &gt;&gt; 5) &amp; 7;
<a name="l02333"></a>02333 
<a name="l02334"></a>02334             glColor3fv(colors[index]);
<a name="l02335"></a>02335             glPushMatrix();
<a name="l02336"></a>02336             glTranslatef(p-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>[0], p-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>[1], p-&gt;<a class="code" href="../../dd/d2e/structDepthPeel.html#a3565c05ede5e16e29fea08032e7d3d33">p</a>[2]);
<a name="l02337"></a>02337             gluSphere(quad, 0.02, 8, 8);
<a name="l02338"></a>02338             glPopMatrix();
<a name="l02339"></a>02339         }
<a name="l02340"></a>02340 
<a name="l02341"></a>02341         gluDeleteQuadric(quad);
<a name="l02342"></a>02342     }
<a name="l02343"></a>02343 <span class="preprocessor">#endif</span>
<a name="l02344"></a>02344 <span class="preprocessor"></span>
<a name="l02345"></a>02345     glDisable(GL_DEPTH_TEST);
<a name="l02346"></a>02346 
<a name="l02347"></a>02347     <span class="comment">/* only draw gesture in active area */</span>
<a name="l02348"></a>02348     <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> <span class="comment">/*&amp;&amp; area_is_active_area(G.vd-&gt;area)*/</span>)
<a name="l02349"></a>02349     {
<a name="l02350"></a>02350         <span class="keywordtype">float</span> gesture_rgb[3] = {0, 0.5, 1};
<a name="l02351"></a>02351         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a26e673c5e9c11330722fd6ede7255925">sk_drawStroke</a>(sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a>, -1, gesture_rgb, -1, -1);
<a name="l02352"></a>02352     }
<a name="l02353"></a>02353 }
<a name="l02354"></a>02354 
<a name="l02355"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab561b5f77f22d1914c3342bc09fc2840">02355</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab561b5f77f22d1914c3342bc09fc2840">sk_finish_stroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02356"></a>02356 {
<a name="l02357"></a>02357     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l02358"></a>02358 
<a name="l02359"></a>02359     <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02360"></a>02360     {
<a name="l02361"></a>02361         <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk = sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>;
<a name="l02362"></a>02362 
<a name="l02363"></a>02363         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a82aa5064520378ecafe4a7475f1ce645">sk_endStroke</a>(C, sketch);
<a name="l02364"></a>02364 
<a name="l02365"></a>02365         <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7fb4a9d1cf55c98515ffe2a47f4c8121">BONE_SKETCHING_QUICK</a>)
<a name="l02366"></a>02366         {
<a name="l02367"></a>02367             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a022671d573de2d7d1162038e41de9de7">bone_sketching_convert</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af3ea9eb5921c019deb65c7a4bc50f358">SK_CONVERT_RETARGET</a>)
<a name="l02368"></a>02368             {
<a name="l02369"></a>02369                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abcfddc2b9b8f68fa515413b30af17b3a">sk_retargetStroke</a>(C, stk);
<a name="l02370"></a>02370             }
<a name="l02371"></a>02371             <span class="keywordflow">else</span>
<a name="l02372"></a>02372             {
<a name="l02373"></a>02373                 <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa790b39718e9c08af1d4085707c76867">sk_convertStroke</a>(C, stk);
<a name="l02374"></a>02374             }
<a name="l02375"></a>02375 <span class="comment">//          XXX</span>
<a name="l02376"></a>02376 <span class="comment">//          BIF_undo_push(&quot;Convert Sketch&quot;);</span>
<a name="l02377"></a>02377             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a0dc330dc52840b50934a2ca5f3f90802">sk_removeStroke</a>(sketch, stk);
<a name="l02378"></a>02378 <span class="comment">//          XXX</span>
<a name="l02379"></a>02379 <span class="comment">//          allqueue(REDRAWBUTSEDIT, 0);</span>
<a name="l02380"></a>02380         }
<a name="l02381"></a>02381 
<a name="l02382"></a>02382 <span class="comment">//      XXX</span>
<a name="l02383"></a>02383 <span class="comment">//      allqueue(REDRAWVIEW3D, 0);</span>
<a name="l02384"></a>02384         <span class="keywordflow">return</span> 1;
<a name="l02385"></a>02385     }
<a name="l02386"></a>02386 
<a name="l02387"></a>02387     <span class="keywordflow">return</span> 0;
<a name="l02388"></a>02388 }
<a name="l02389"></a>02389 
<a name="l02390"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6ebd6136773e70a9fd3c51b3158d82a">02390</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6ebd6136773e70a9fd3c51b3158d82a">sk_start_draw_stroke</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02391"></a>02391 {
<a name="l02392"></a>02392     <span class="keywordflow">if</span> (sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02393"></a>02393     {
<a name="l02394"></a>02394         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a57f91045185f7eaaa3bc637aeb778340">sk_startStroke</a>(sketch);
<a name="l02395"></a>02395         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a256d2bc29ca62f365278c1247cf5c65b">sk_selectAllSketch</a>(sketch, -1);
<a name="l02396"></a>02396 
<a name="l02397"></a>02397         sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#a10ef00285f34d710337b71e9b979dc98">selected</a> = 1;
<a name="l02398"></a>02398     }
<a name="l02399"></a>02399 }
<a name="l02400"></a>02400 
<a name="l02401"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea866a013c7deeac32aa63dce8fe6fa2">02401</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea866a013c7deeac32aa63dce8fe6fa2">sk_start_draw_gesture</a>(<a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch)
<a name="l02402"></a>02402 {
<a name="l02403"></a>02403     sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a8d1b4bf8adee1d9e728df802dccdeba4">sk_createStroke</a>();
<a name="l02404"></a>02404 }
<a name="l02405"></a>02405 
<a name="l02406"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#affa786aa459cb420492ec49ff2145ac5">02406</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#affa786aa459cb420492ec49ff2145ac5">sk_draw_stroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk, <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd, <span class="keywordtype">short</span> snap)
<a name="l02407"></a>02407 {
<a name="l02408"></a>02408     <span class="keywordflow">if</span> (<a class="code" href="../../de/d6a/BKE__sketch_8h.html#a600070559c23a22647f19062157af353">sk_stroke_filtermval</a>(dd))
<a name="l02409"></a>02409     {
<a name="l02410"></a>02410         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75e2906341d2ed7aa488d14df8b681b4">sk_addStrokePoint</a>(C, sketch, stk, dd, snap);
<a name="l02411"></a>02411         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae0ed39b831dc150766b00cac6072df03">sk_updateDrawData</a>(dd);
<a name="l02412"></a>02412         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a221b77711abb1313d96aec706dfcefca">sk_updateNextPoint</a>(sketch, stk);
<a name="l02413"></a>02413         
<a name="l02414"></a>02414         <span class="keywordflow">return</span> 1;
<a name="l02415"></a>02415     }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <span class="keywordflow">return</span> 0;
<a name="l02418"></a>02418 }
<a name="l02419"></a>02419 
<a name="l02420"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ac28847fdac9669b5cbfc8a4ac58cdf96">02420</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ac28847fdac9669b5cbfc8a4ac58cdf96">ValidSketchViewContext</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc)
<a name="l02421"></a>02421 {
<a name="l02422"></a>02422     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>;
<a name="l02423"></a>02423     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>;
<a name="l02424"></a>02424 
<a name="l02425"></a>02425     <span class="keywordflow">if</span> (obedit &amp;&amp;
<a name="l02426"></a>02426         obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a> &amp;&amp;
<a name="l02427"></a>02427         scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a6d61f52d69389fc572c7035a68dcb0">BONE_SKETCHING</a>)
<a name="l02428"></a>02428     {
<a name="l02429"></a>02429         <span class="keywordflow">return</span> 1;
<a name="l02430"></a>02430     }
<a name="l02431"></a>02431     <span class="keywordflow">else</span>
<a name="l02432"></a>02432     {
<a name="l02433"></a>02433         <span class="keywordflow">return</span> 0;
<a name="l02434"></a>02434     }
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02437"></a><a class="code" href="../../d1/d98/ED__armature_8h.html#aac8575192a6c154269b1d2c1e32a9d07">02437</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7ecbc728322b65ccde7c6e5daa655fc5">BDR_drawSketchNames</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc)
<a name="l02438"></a>02438 {
<a name="l02439"></a>02439     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ac28847fdac9669b5cbfc8a4ac58cdf96">ValidSketchViewContext</a>(vc))
<a name="l02440"></a>02440     {
<a name="l02441"></a>02441         <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5f01d6375a9f8da8de54c65b689e6406">viewcontextSketch</a>(vc, 0);
<a name="l02442"></a>02442         <span class="keywordflow">if</span> (sketch)
<a name="l02443"></a>02443         {
<a name="l02444"></a>02444             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0d731a74af8f5ddd59410c4cab88a187">sk_drawSketch</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ac33fdbda0e0b759a8f12a889216d6945">v3d</a>, sketch, 1);
<a name="l02445"></a>02445             <span class="keywordflow">return</span> 1;
<a name="l02446"></a>02446         }
<a name="l02447"></a>02447     }
<a name="l02448"></a>02448 
<a name="l02449"></a>02449     <span class="keywordflow">return</span> 0;
<a name="l02450"></a>02450 }
<a name="l02451"></a>02451 
<a name="l02452"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6ecff5cf00ce242f6dc1f18d10ae061b">02452</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a6ecff5cf00ce242f6dc1f18d10ae061b">BDR_drawSketch</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02453"></a>02453 {
<a name="l02454"></a>02454     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4c87ba5595aed8469aea5df1607be628">ED_operator_sketch_mode</a>(C))
<a name="l02455"></a>02455     {
<a name="l02456"></a>02456         <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02457"></a>02457         <span class="keywordflow">if</span> (sketch)
<a name="l02458"></a>02458         {
<a name="l02459"></a>02459             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0d731a74af8f5ddd59410c4cab88a187">sk_drawSketch</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C), sketch, 0);
<a name="l02460"></a>02460         }
<a name="l02461"></a>02461     }
<a name="l02462"></a>02462 }
<a name="l02463"></a>02463 
<a name="l02464"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abfcec93df3ea091a891caf8453724a79">02464</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abfcec93df3ea091a891caf8453724a79">sketch_delete</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l02465"></a>02465 {
<a name="l02466"></a>02466     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02467"></a>02467     <span class="keywordflow">if</span> (sketch)
<a name="l02468"></a>02468     {
<a name="l02469"></a>02469         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1984fa6add04fb1f885c3d7af13315dc">sk_deleteSelectedStrokes</a>(sketch);
<a name="l02470"></a>02470 <span class="comment">//          allqueue(REDRAWVIEW3D, 0);</span>
<a name="l02471"></a>02471     }
<a name="l02472"></a>02472     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a530e6e29314e897aa83f4584260af530">ND_SKETCH</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a9e971b3c86d560d28a06ea074e04fa84">NA_REMOVED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02473"></a>02473     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02474"></a>02474 }
<a name="l02475"></a>02475 
<a name="l02476"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a86b59256b5bcd7f885eefb17cf324040">02476</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a2c18e6e03183fdcec9562e025dae13a4">BIF_sk_selectStroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">short</span> extend)
<a name="l02477"></a>02477 {
<a name="l02478"></a>02478     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l02479"></a>02479     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02480"></a>02480 
<a name="l02481"></a>02481     <span class="keywordflow">if</span> (sketch != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a6d61f52d69389fc572c7035a68dcb0">BONE_SKETCHING</a>)
<a name="l02482"></a>02482     {
<a name="l02483"></a>02483         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af3dcb881281293403ea3136dee7b0da8">sk_selectStroke</a>(C, sketch, mval, extend))
<a name="l02484"></a>02484             <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02485"></a>02485     }
<a name="l02486"></a>02486 }
<a name="l02487"></a>02487 
<a name="l02488"></a><a class="code" href="../../d1/d98/ED__armature_8h.html#a1ff3a6498a00c5b0a93474eecacbea05">02488</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aac9a107623f66bf5ed9c6ab06c104a37">BIF_convertSketch</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02489"></a>02489 {
<a name="l02490"></a>02490     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa4807f521d85acba8afda182dd54abf3">ED_operator_sketch_full_mode</a>(C))
<a name="l02491"></a>02491     {
<a name="l02492"></a>02492         <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02493"></a>02493         <span class="keywordflow">if</span> (sketch)
<a name="l02494"></a>02494         {
<a name="l02495"></a>02495             <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa46a408784b9444d0bddeb52888da8d6">sk_convert</a>(C, sketch);
<a name="l02496"></a>02496 <span class="comment">//          BIF_undo_push(&quot;Convert Sketch&quot;);</span>
<a name="l02497"></a>02497 <span class="comment">//          allqueue(REDRAWVIEW3D, 0);</span>
<a name="l02498"></a>02498 <span class="comment">//          allqueue(REDRAWBUTSEDIT, 0);</span>
<a name="l02499"></a>02499         }
<a name="l02500"></a>02500     }
<a name="l02501"></a>02501 }
<a name="l02502"></a>02502 
<a name="l02503"></a><a class="code" href="../../d1/d98/ED__armature_8h.html#a63dd5916b2e380b341a004dc212a1c14">02503</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1c203735d8b947e7970158cc7eadf95d">BIF_deleteSketch</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02504"></a>02504 {
<a name="l02505"></a>02505     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa4807f521d85acba8afda182dd54abf3">ED_operator_sketch_full_mode</a>(C))
<a name="l02506"></a>02506     {
<a name="l02507"></a>02507         <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02508"></a>02508         <span class="keywordflow">if</span> (sketch)
<a name="l02509"></a>02509         {
<a name="l02510"></a>02510             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1984fa6add04fb1f885c3d7af13315dc">sk_deleteSelectedStrokes</a>(sketch);
<a name="l02511"></a>02511 <span class="comment">//          BIF_undo_push(&quot;Convert Sketch&quot;);</span>
<a name="l02512"></a>02512 <span class="comment">//          allqueue(REDRAWVIEW3D, 0);</span>
<a name="l02513"></a>02513         }
<a name="l02514"></a>02514     }
<a name="l02515"></a>02515 }
<a name="l02516"></a>02516 
<a name="l02517"></a>02517 <span class="preprocessor">#if 0</span>
<a name="l02518"></a>02518 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d1/d98/ED__armature_8h.html#a3b566a38938d3e70e4a40aafe82adf4d">BIF_selectAllSketch</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">int</span> mode)
<a name="l02519"></a>02519 {
<a name="l02520"></a>02520     <span class="keywordflow">if</span> (BIF_validSketchMode(C))
<a name="l02521"></a>02521     {
<a name="l02522"></a>02522         <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02523"></a>02523         <span class="keywordflow">if</span> (sketch)
<a name="l02524"></a>02524         {
<a name="l02525"></a>02525             <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a256d2bc29ca62f365278c1247cf5c65b">sk_selectAllSketch</a>(sketch, mode);
<a name="l02526"></a>02526 <span class="comment">//          XXX</span>
<a name="l02527"></a>02527 <span class="comment">//          allqueue(REDRAWVIEW3D, 0);</span>
<a name="l02528"></a>02528         }
<a name="l02529"></a>02529     }
<a name="l02530"></a>02530 }
<a name="l02531"></a>02531 <span class="preprocessor">#endif</span>
<a name="l02532"></a>02532 <span class="preprocessor"></span>
<a name="l02533"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">02533</a> <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">int</span> create)
<a name="l02534"></a>02534 {
<a name="l02535"></a>02535     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02536"></a>02536     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02537"></a>02537 
<a name="l02538"></a>02538     <span class="keywordflow">if</span> (obedit &amp;&amp; obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>)
<a name="l02539"></a>02539     {
<a name="l02540"></a>02540         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm = obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02541"></a>02541     
<a name="l02542"></a>02542         <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; create)
<a name="l02543"></a>02543         {
<a name="l02544"></a>02544             arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ad722e21474a525ada6667835a35e6744">createSketch</a>();
<a name="l02545"></a>02545         }
<a name="l02546"></a>02546         sketch = arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a>;
<a name="l02547"></a>02547     }
<a name="l02548"></a>02548 
<a name="l02549"></a>02549     <span class="keywordflow">return</span> sketch;
<a name="l02550"></a>02550 }
<a name="l02551"></a>02551 
<a name="l02552"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5f01d6375a9f8da8de54c65b689e6406">02552</a> <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a>* <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5f01d6375a9f8da8de54c65b689e6406">viewcontextSketch</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc, <span class="keywordtype">int</span> create)
<a name="l02553"></a>02553 {
<a name="l02554"></a>02554     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>;
<a name="l02555"></a>02555     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02556"></a>02556 
<a name="l02557"></a>02557     <span class="keywordflow">if</span> (obedit &amp;&amp; obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>)
<a name="l02558"></a>02558     {
<a name="l02559"></a>02559         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm = obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02560"></a>02560     
<a name="l02561"></a>02561         <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; create)
<a name="l02562"></a>02562         {
<a name="l02563"></a>02563             arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a> = <a class="code" href="../../de/d6a/BKE__sketch_8h.html#ad722e21474a525ada6667835a35e6744">createSketch</a>();
<a name="l02564"></a>02564         }
<a name="l02565"></a>02565         sketch = arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a>;
<a name="l02566"></a>02566     }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568     <span class="keywordflow">return</span> sketch;
<a name="l02569"></a>02569 }
<a name="l02570"></a>02570 
<a name="l02571"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acef514fbc1c7666a0bf6d28ec670053c">02571</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acef514fbc1c7666a0bf6d28ec670053c">sketch_convert</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l02572"></a>02572 {
<a name="l02573"></a>02573     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02574"></a>02574     <span class="keywordflow">if</span> (sketch != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02575"></a>02575     {
<a name="l02576"></a>02576         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa46a408784b9444d0bddeb52888da8d6">sk_convert</a>(C, sketch);
<a name="l02577"></a>02577         <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02578"></a>02578     }
<a name="l02579"></a>02579     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02580"></a>02580 }
<a name="l02581"></a>02581 
<a name="l02582"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0ab6dd97523cc186c85aee2ab5c7a25b">02582</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0ab6dd97523cc186c85aee2ab5c7a25b">sketch_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l02583"></a>02583 {
<a name="l02584"></a>02584     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02585"></a>02585     <span class="keywordflow">if</span> (sketch != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02586"></a>02586     {
<a name="l02587"></a>02587         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee378f7c6191662f7e64c4a6cdb4f4ba">sk_cancelStroke</a>(sketch);
<a name="l02588"></a>02588         <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02589"></a>02589         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02590"></a>02590     }
<a name="l02591"></a>02591     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l02592"></a>02592 }
<a name="l02593"></a>02593 
<a name="l02594"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a94f65cf423117fcf26125144a313a1ce">02594</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a94f65cf423117fcf26125144a313a1ce">sketch_finish</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l02595"></a>02595 {
<a name="l02596"></a>02596     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02597"></a>02597     <span class="keywordflow">if</span> (sketch != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02598"></a>02598     {
<a name="l02599"></a>02599         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab561b5f77f22d1914c3342bc09fc2840">sk_finish_stroke</a>(C, sketch))
<a name="l02600"></a>02600         {
<a name="l02601"></a>02601             <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02602"></a>02602             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02603"></a>02603         }
<a name="l02604"></a>02604     }
<a name="l02605"></a>02605     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l02606"></a>02606 }
<a name="l02607"></a>02607 
<a name="l02608"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a136ffaa85d1549bb4e340b58335ca16d">02608</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a136ffaa85d1549bb4e340b58335ca16d">sketch_select</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02609"></a>02609 {
<a name="l02610"></a>02610     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02611"></a>02611     <span class="keywordflow">if</span> (sketch)
<a name="l02612"></a>02612     {
<a name="l02613"></a>02613         <span class="keywordtype">short</span> extend = 0;
<a name="l02614"></a>02614         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#af3dcb881281293403ea3136dee7b0da8">sk_selectStroke</a>(C, sketch, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, extend))
<a name="l02615"></a>02615             <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02616"></a>02616     }
<a name="l02617"></a>02617 
<a name="l02618"></a>02618     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02619"></a>02619 }
<a name="l02620"></a>02620 
<a name="l02621"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7d55f3cef7d14c7eae5d549387233514">02621</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7d55f3cef7d14c7eae5d549387233514">sketch_draw_stroke_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02622"></a>02622 {
<a name="l02623"></a>02623     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1); <span class="comment">/* create just to be sure */</span>
<a name="l02624"></a>02624     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee378f7c6191662f7e64c4a6cdb4f4ba">sk_cancelStroke</a>(sketch);
<a name="l02625"></a>02625     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l02626"></a>02626     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02627"></a>02627 }
<a name="l02628"></a>02628 
<a name="l02629"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae3bd3092e015afcdb32ab3086350e9be">02629</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae3bd3092e015afcdb32ab3086350e9be">sketch_draw_stroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02630"></a>02630 {
<a name="l02631"></a>02631     <span class="keywordtype">short</span> snap = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;snap&quot;</span>);
<a name="l02632"></a>02632     <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd;
<a name="l02633"></a>02633     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1);
<a name="l02634"></a>02634 
<a name="l02635"></a>02635     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = dd = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="stringliteral">&quot;SK_DrawData&quot;</span>), <span class="stringliteral">&quot;SketchDrawData&quot;</span>);
<a name="l02636"></a>02636     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a9819c4c56cde6623b33c66fc11fb4f5a">sk_initDrawData</a>(dd, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>);
<a name="l02637"></a>02637 
<a name="l02638"></a>02638     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ab6ebd6136773e70a9fd3c51b3158d82a">sk_start_draw_stroke</a>(sketch);
<a name="l02639"></a>02639 
<a name="l02640"></a>02640     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#affa786aa459cb420492ec49ff2145ac5">sk_draw_stroke</a>(C, sketch, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>, dd, snap);
<a name="l02641"></a>02641 
<a name="l02642"></a>02642     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l02643"></a>02643 
<a name="l02644"></a>02644     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l02645"></a>02645 }
<a name="l02646"></a>02646 
<a name="l02647"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a423d83cc171ebaec11d6b77439afb52f">02647</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a423d83cc171ebaec11d6b77439afb52f">sketch_draw_gesture_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02648"></a>02648 {
<a name="l02649"></a>02649     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1); <span class="comment">/* create just to be sure */</span>
<a name="l02650"></a>02650     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee378f7c6191662f7e64c4a6cdb4f4ba">sk_cancelStroke</a>(sketch);
<a name="l02651"></a>02651     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l02652"></a>02652     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02653"></a>02653 }
<a name="l02654"></a>02654 
<a name="l02655"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a29f91101003ace17477ee3d23865657a">02655</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a29f91101003ace17477ee3d23865657a">sketch_draw_gesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02656"></a>02656 {
<a name="l02657"></a>02657     <span class="keywordtype">short</span> snap = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;snap&quot;</span>);
<a name="l02658"></a>02658     <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd;
<a name="l02659"></a>02659     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1); <span class="comment">/* create just to be sure */</span>
<a name="l02660"></a>02660     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aee378f7c6191662f7e64c4a6cdb4f4ba">sk_cancelStroke</a>(sketch);
<a name="l02661"></a>02661 
<a name="l02662"></a>02662     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = dd = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="stringliteral">&quot;SK_DrawData&quot;</span>), <span class="stringliteral">&quot;SketchDrawData&quot;</span>);
<a name="l02663"></a>02663     <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a9819c4c56cde6623b33c66fc11fb4f5a">sk_initDrawData</a>(dd, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>);
<a name="l02664"></a>02664 
<a name="l02665"></a>02665     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea866a013c7deeac32aa63dce8fe6fa2">sk_start_draw_gesture</a>(sketch);
<a name="l02666"></a>02666     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#affa786aa459cb420492ec49ff2145ac5">sk_draw_stroke</a>(C, sketch, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a>, dd, snap);
<a name="l02667"></a>02667 
<a name="l02668"></a>02668     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l02669"></a>02669 
<a name="l02670"></a>02670     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l02671"></a>02671 }
<a name="l02672"></a>02672 
<a name="l02673"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a541ba382bf6f33a1cd4760b78f09a186">02673</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a541ba382bf6f33a1cd4760b78f09a186">sketch_draw_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">short</span> gesture, <a class="code" href="../../d2/d94/structSK__Stroke.html">SK_Stroke</a> *stk)
<a name="l02674"></a>02674 {
<a name="l02675"></a>02675     <span class="keywordtype">short</span> snap = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;snap&quot;</span>);
<a name="l02676"></a>02676     <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> *dd = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l02677"></a>02677     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1); <span class="comment">/* create just to be sure */</span>
<a name="l02678"></a>02678     <span class="keywordtype">int</span> retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l02679"></a>02679 
<a name="l02680"></a>02680     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)
<a name="l02681"></a>02681     {
<a name="l02682"></a>02682     <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad025960542c5698bad7efc649c641897">LEFTCTRLKEY</a>:
<a name="l02683"></a>02683     <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aacc3c8c5f05ebb7eeca8e4da6dc9c969">RIGHTCTRLKEY</a>:
<a name="l02684"></a>02684         snap = <span class="keyword">event</span>-&gt;ctrl;
<a name="l02685"></a>02685         <a class="code" href="../../d3/d10/rna__access_8c.html#a1741c6fd78b5d828bb7b83517e2766db">RNA_boolean_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;snap&quot;</span>, snap);
<a name="l02686"></a>02686         <span class="keywordflow">break</span>;
<a name="l02687"></a>02687     <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l02688"></a>02688     <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99234bdab7c4336e174cd0db37044412">INBETWEEN_MOUSEMOVE</a>:
<a name="l02689"></a>02689         dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[0] = <span class="keyword">event</span>-&gt;mval[0];
<a name="l02690"></a>02690         dd-&gt;<a class="code" href="../../dd/df2/structSK__DrawData.html#a31650553b5c5b7c925083ccad02aac7f">mval</a>[1] = <span class="keyword">event</span>-&gt;mval[1];
<a name="l02691"></a>02691         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#affa786aa459cb420492ec49ff2145ac5">sk_draw_stroke</a>(C, sketch, stk, dd, snap);
<a name="l02692"></a>02692         <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02693"></a>02693         <span class="keywordflow">break</span>;
<a name="l02694"></a>02694     <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>:
<a name="l02695"></a>02695         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a>(C, op);
<a name="l02696"></a>02696         <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02697"></a>02697         retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02698"></a>02698         <span class="keywordflow">break</span>;
<a name="l02699"></a>02699     <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l02700"></a>02700         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>)
<a name="l02701"></a>02701         {
<a name="l02702"></a>02702             <span class="keywordflow">if</span> (gesture == 0)
<a name="l02703"></a>02703             {
<a name="l02704"></a>02704                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a5279074ff8c648cadba36c35a847b963">sk_endContinuousStroke</a>(stk);
<a name="l02705"></a>02705                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a42b9f7c928f8bd9c3a361acd865be1b4">sk_filterLastContinuousStroke</a>(stk);
<a name="l02706"></a>02706                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a221b77711abb1313d96aec706dfcefca">sk_updateNextPoint</a>(sketch, stk);
<a name="l02707"></a>02707                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02708"></a>02708                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l02709"></a>02709                 retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02710"></a>02710             }
<a name="l02711"></a>02711             <span class="keywordflow">else</span>
<a name="l02712"></a>02712             {
<a name="l02713"></a>02713                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a5279074ff8c648cadba36c35a847b963">sk_endContinuousStroke</a>(stk);
<a name="l02714"></a>02714                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a42b9f7c928f8bd9c3a361acd865be1b4">sk_filterLastContinuousStroke</a>(stk);
<a name="l02715"></a>02715 
<a name="l02716"></a>02716                 <span class="keywordflow">if</span> (stk-&gt;<a class="code" href="../../d2/d94/structSK__Stroke.html#afd9be3882dde861948dc2207f7334563">nb_points</a> &gt; 1)
<a name="l02717"></a>02717                 {
<a name="l02718"></a>02718                     <span class="comment">/* apply gesture here */</span>
<a name="l02719"></a>02719                     <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a3cd11bc357adc4e8ce11c7632b73d75b">sk_applyGesture</a>(C, sketch);
<a name="l02720"></a>02720                 }
<a name="l02721"></a>02721 
<a name="l02722"></a>02722                 <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a1b3126e21fbbc3d64c3e25d5eb62fe2f">sk_freeStroke</a>(stk);
<a name="l02723"></a>02723                 sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02724"></a>02724 
<a name="l02725"></a>02725                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02726"></a>02726                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l02727"></a>02727                 retval = <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02728"></a>02728             }
<a name="l02729"></a>02729         }
<a name="l02730"></a>02730         <span class="keywordflow">break</span>;
<a name="l02731"></a>02731     }
<a name="l02732"></a>02732 
<a name="l02733"></a>02733     <span class="keywordflow">return</span> retval;
<a name="l02734"></a>02734 }
<a name="l02735"></a>02735 
<a name="l02736"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aaba4d1ac272c23bf7f18f160dbc734c7">02736</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aaba4d1ac272c23bf7f18f160dbc734c7">sketch_draw_stroke_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02737"></a>02737 {
<a name="l02738"></a>02738     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1); <span class="comment">/* create just to be sure */</span>
<a name="l02739"></a>02739     <span class="keywordflow">return</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a541ba382bf6f33a1cd4760b78f09a186">sketch_draw_modal</a>(C, op, event, 0, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>);
<a name="l02740"></a>02740 }
<a name="l02741"></a>02741 
<a name="l02742"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a762c52725de75fbb04a567a971e416a2">02742</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a762c52725de75fbb04a567a971e416a2">sketch_draw_gesture_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02743"></a>02743 {
<a name="l02744"></a>02744     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 1); <span class="comment">/* create just to be sure */</span>
<a name="l02745"></a>02745     <span class="keywordflow">return</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a541ba382bf6f33a1cd4760b78f09a186">sketch_draw_modal</a>(C, op, event, 1, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#abea7e0a85c45d1d8faf3cc451af7c935">gesture</a>);
<a name="l02746"></a>02746 }
<a name="l02747"></a>02747 
<a name="l02748"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5d1f0eb3aa7e9d05771af30ebb9f629c">02748</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5d1f0eb3aa7e9d05771af30ebb9f629c">sketch_draw_preview</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02749"></a>02749 {
<a name="l02750"></a>02750     <span class="keywordtype">short</span> snap = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;snap&quot;</span>);
<a name="l02751"></a>02751     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02752"></a>02752 
<a name="l02753"></a>02753     <span class="keywordflow">if</span> (sketch)
<a name="l02754"></a>02754     {
<a name="l02755"></a>02755         <a class="code" href="../../dd/df2/structSK__DrawData.html">SK_DrawData</a> dd;
<a name="l02756"></a>02756 
<a name="l02757"></a>02757         <a class="code" href="../../de/d6a/BKE__sketch_8h.html#a9819c4c56cde6623b33c66fc11fb4f5a">sk_initDrawData</a>(&amp;dd, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>);
<a name="l02758"></a>02758         <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a05b9c834753a5c328a6a0814fd24fed8">sk_getStrokePoint</a>(C, &amp;sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#ab7526d7f570928e67ca9bfa4cae48371">next_point</a>, sketch, sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a>, &amp;dd, snap);
<a name="l02759"></a>02759         <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l02760"></a>02760     }
<a name="l02761"></a>02761 
<a name="l02762"></a>02762     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l02763"></a>02763 }
<a name="l02764"></a>02764 
<a name="l02765"></a>02765 <span class="comment">/* ============================================== Poll Functions ============================================= */</span>
<a name="l02766"></a>02766 
<a name="l02767"></a><a class="code" href="../../d1/d98/ED__armature_8h.html#a8db5570da0d49187155eb901be4c982b">02767</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75bb8082e837256c7ad6c28381e4d9a2">ED_operator_sketch_mode_active_stroke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02768"></a>02768 {
<a name="l02769"></a>02769     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l02770"></a>02770     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02771"></a>02771 
<a name="l02772"></a>02772     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a6d61f52d69389fc572c7035a68dcb0">BONE_SKETCHING</a> &amp;&amp;
<a name="l02773"></a>02773         sketch != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l02774"></a>02774         sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02775"></a>02775     {
<a name="l02776"></a>02776         <span class="keywordflow">return</span> 1;
<a name="l02777"></a>02777     }
<a name="l02778"></a>02778     <span class="keywordflow">else</span>
<a name="l02779"></a>02779     {
<a name="l02780"></a>02780         <span class="keywordflow">return</span> 0;
<a name="l02781"></a>02781     }
<a name="l02782"></a>02782 }
<a name="l02783"></a>02783 
<a name="l02784"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aeecbc314e9a838fa54cf7297491d74c5">02784</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aeecbc314e9a838fa54cf7297491d74c5">ED_operator_sketch_mode_gesture</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02785"></a>02785 {
<a name="l02786"></a>02786     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l02787"></a>02787     <a class="code" href="../../d3/d66/structSK__Sketch.html">SK_Sketch</a> *sketch = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a1cd899372fef1d8807e037a4d0218a04">contextSketch</a>(C, 0);
<a name="l02788"></a>02788 
<a name="l02789"></a>02789     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a6d61f52d69389fc572c7035a68dcb0">BONE_SKETCHING</a> &amp;&amp;
<a name="l02790"></a>02790         (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7fb4a9d1cf55c98515ffe2a47f4c8121">BONE_SKETCHING_QUICK</a>) == 0 &amp;&amp;
<a name="l02791"></a>02791         sketch != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l02792"></a>02792         sketch-&gt;<a class="code" href="../../d3/d66/structSK__Sketch.html#a39712ae18bee79ec46c83dc2da80ba43">active_stroke</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02793"></a>02793     {
<a name="l02794"></a>02794         <span class="keywordflow">return</span> 1;
<a name="l02795"></a>02795     }
<a name="l02796"></a>02796     <span class="keywordflow">else</span>
<a name="l02797"></a>02797     {
<a name="l02798"></a>02798         <span class="keywordflow">return</span> 0;
<a name="l02799"></a>02799     }
<a name="l02800"></a>02800 }
<a name="l02801"></a>02801 
<a name="l02802"></a><a class="code" href="../../d1/d98/ED__armature_8h.html#aaea449db61e9da2ee170fc1eae435ff9">02802</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa4807f521d85acba8afda182dd54abf3">ED_operator_sketch_full_mode</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02803"></a>02803 {
<a name="l02804"></a>02804     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02805"></a>02805     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l02806"></a>02806 
<a name="l02807"></a>02807     <span class="keywordflow">if</span> (obedit &amp;&amp;
<a name="l02808"></a>02808         obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a> &amp;&amp;
<a name="l02809"></a>02809         ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a6d61f52d69389fc572c7035a68dcb0">BONE_SKETCHING</a> &amp;&amp;
<a name="l02810"></a>02810         (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7fb4a9d1cf55c98515ffe2a47f4c8121">BONE_SKETCHING_QUICK</a>) == 0)
<a name="l02811"></a>02811     {
<a name="l02812"></a>02812         <span class="keywordflow">return</span> 1;
<a name="l02813"></a>02813     }
<a name="l02814"></a>02814     <span class="keywordflow">else</span>
<a name="l02815"></a>02815     {
<a name="l02816"></a>02816         <span class="keywordflow">return</span> 0;
<a name="l02817"></a>02817     }
<a name="l02818"></a>02818 }
<a name="l02819"></a>02819 
<a name="l02820"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4c87ba5595aed8469aea5df1607be628">02820</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4c87ba5595aed8469aea5df1607be628">ED_operator_sketch_mode</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l02821"></a>02821 {
<a name="l02822"></a>02822     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02823"></a>02823     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C);
<a name="l02824"></a>02824 
<a name="l02825"></a>02825     <span class="keywordflow">if</span> (obedit &amp;&amp;
<a name="l02826"></a>02826         obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a> &amp;&amp;
<a name="l02827"></a>02827         ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a6d61f52d69389fc572c7035a68dcb0">BONE_SKETCHING</a>)
<a name="l02828"></a>02828     {
<a name="l02829"></a>02829         <span class="keywordflow">return</span> 1;
<a name="l02830"></a>02830     }
<a name="l02831"></a>02831     <span class="keywordflow">else</span>
<a name="l02832"></a>02832     {
<a name="l02833"></a>02833         <span class="keywordflow">return</span> 0;
<a name="l02834"></a>02834     }
<a name="l02835"></a>02835 }
<a name="l02836"></a>02836 
<a name="l02837"></a>02837 <span class="comment">/* ================================================ Operators ================================================ */</span>
<a name="l02838"></a>02838 
<a name="l02839"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ad4ade6f0282545a8058bded1933f068e">02839</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#aa691d46097e9fb496e6f235337ab8208">SKETCH_OT_delete</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02840"></a>02840 {
<a name="l02841"></a>02841     <span class="comment">/* identifiers */</span>
<a name="l02842"></a>02842     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete&quot;</span>;
<a name="l02843"></a>02843     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_delete&quot;</span>;
<a name="l02844"></a>02844 
<a name="l02845"></a>02845     <span class="comment">/* api callbacks */</span>
<a name="l02846"></a>02846     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#abfcec93df3ea091a891caf8453724a79">sketch_delete</a>;
<a name="l02847"></a>02847 
<a name="l02848"></a>02848     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa4807f521d85acba8afda182dd54abf3">ED_operator_sketch_full_mode</a>;
<a name="l02849"></a>02849 
<a name="l02850"></a>02850     <span class="comment">/* flags */</span>
<a name="l02851"></a>02851 <span class="comment">//  ot-&gt;flag = OPTYPE_UNDO;</span>
<a name="l02852"></a>02852 }
<a name="l02853"></a>02853 
<a name="l02854"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aea45b24500d362a56a73ac0c9b31f6a0">02854</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a20c29356aa2e02243974829428669a11">SKETCH_OT_select</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02855"></a>02855 {
<a name="l02856"></a>02856     <span class="comment">/* identifiers */</span>
<a name="l02857"></a>02857     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select&quot;</span>;
<a name="l02858"></a>02858     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_select&quot;</span>;
<a name="l02859"></a>02859 
<a name="l02860"></a>02860     <span class="comment">/* api callbacks */</span>
<a name="l02861"></a>02861     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a136ffaa85d1549bb4e340b58335ca16d">sketch_select</a>;
<a name="l02862"></a>02862 
<a name="l02863"></a>02863     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa4807f521d85acba8afda182dd54abf3">ED_operator_sketch_full_mode</a>;
<a name="l02864"></a>02864 
<a name="l02865"></a>02865     <span class="comment">/* flags */</span>
<a name="l02866"></a>02866 <span class="comment">//  ot-&gt;flag = OPTYPE_UNDO;</span>
<a name="l02867"></a>02867 }
<a name="l02868"></a>02868 
<a name="l02869"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a2c621ab5d05f7f24a21b28c834b3d643">02869</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a1c308d0babe22c258540210194bd670e">SKETCH_OT_cancel_stroke</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02870"></a>02870 {
<a name="l02871"></a>02871     <span class="comment">/* identifiers */</span>
<a name="l02872"></a>02872     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Cancel Stroke&quot;</span>;
<a name="l02873"></a>02873     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_cancel_stroke&quot;</span>;
<a name="l02874"></a>02874 
<a name="l02875"></a>02875     <span class="comment">/* api callbacks */</span>
<a name="l02876"></a>02876     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a0ab6dd97523cc186c85aee2ab5c7a25b">sketch_cancel</a>;
<a name="l02877"></a>02877 
<a name="l02878"></a>02878     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75bb8082e837256c7ad6c28381e4d9a2">ED_operator_sketch_mode_active_stroke</a>;
<a name="l02879"></a>02879 
<a name="l02880"></a>02880     <span class="comment">/* flags */</span>
<a name="l02881"></a>02881 <span class="comment">//  ot-&gt;flag = OPTYPE_UNDO;</span>
<a name="l02882"></a>02882 }
<a name="l02883"></a>02883 
<a name="l02884"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a63fee64a4e8dc64ff4d1fd49a8b2bd04">02884</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a22169a90eedcee2203e1d3e807973d76">SKETCH_OT_convert</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02885"></a>02885 {
<a name="l02886"></a>02886     <span class="comment">/* identifiers */</span>
<a name="l02887"></a>02887     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Convert&quot;</span>;
<a name="l02888"></a>02888     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_convert&quot;</span>;
<a name="l02889"></a>02889 
<a name="l02890"></a>02890     <span class="comment">/* api callbacks */</span>
<a name="l02891"></a>02891     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#acef514fbc1c7666a0bf6d28ec670053c">sketch_convert</a>;
<a name="l02892"></a>02892 
<a name="l02893"></a>02893     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aa4807f521d85acba8afda182dd54abf3">ED_operator_sketch_full_mode</a>;
<a name="l02894"></a>02894 
<a name="l02895"></a>02895     <span class="comment">/* flags */</span>
<a name="l02896"></a>02896     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02897"></a>02897 }
<a name="l02898"></a>02898 
<a name="l02899"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aac7fca6cdb116ea68aa570fd453c6432">02899</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a7f9dcf3d6daaa95c68501ec579bc5eef">SKETCH_OT_finish_stroke</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02900"></a>02900 {
<a name="l02901"></a>02901     <span class="comment">/* identifiers */</span>
<a name="l02902"></a>02902     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;End Stroke&quot;</span>;
<a name="l02903"></a>02903     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_finish_stroke&quot;</span>;
<a name="l02904"></a>02904 
<a name="l02905"></a>02905     <span class="comment">/* api callbacks */</span>
<a name="l02906"></a>02906     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a94f65cf423117fcf26125144a313a1ce">sketch_finish</a>;
<a name="l02907"></a>02907 
<a name="l02908"></a>02908     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75bb8082e837256c7ad6c28381e4d9a2">ED_operator_sketch_mode_active_stroke</a>;
<a name="l02909"></a>02909 
<a name="l02910"></a>02910     <span class="comment">/* flags */</span>
<a name="l02911"></a>02911 <span class="comment">//  ot-&gt;flag = OPTYPE_UNDO;</span>
<a name="l02912"></a>02912 }
<a name="l02913"></a>02913 
<a name="l02914"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ac7398a472bc811117f80520775612acc">02914</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#adf6768e9df0e89255a17998f3c15be7b">SKETCH_OT_draw_preview</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02915"></a>02915 {
<a name="l02916"></a>02916     <span class="comment">/* identifiers */</span>
<a name="l02917"></a>02917     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Draw Preview&quot;</span>;
<a name="l02918"></a>02918     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_draw_preview&quot;</span>;
<a name="l02919"></a>02919 
<a name="l02920"></a>02920     <span class="comment">/* api callbacks */</span>
<a name="l02921"></a>02921     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a5d1f0eb3aa7e9d05771af30ebb9f629c">sketch_draw_preview</a>;
<a name="l02922"></a>02922 
<a name="l02923"></a>02923     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a75bb8082e837256c7ad6c28381e4d9a2">ED_operator_sketch_mode_active_stroke</a>;
<a name="l02924"></a>02924 
<a name="l02925"></a>02925     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;snap&quot;</span>, 0, <span class="stringliteral">&quot;Snap&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02926"></a>02926 
<a name="l02927"></a>02927     <span class="comment">/* flags */</span>
<a name="l02928"></a>02928 <span class="comment">//  ot-&gt;flag = OPTYPE_REGISTER|OPTYPE_UNDO;</span>
<a name="l02929"></a>02929 }
<a name="l02930"></a>02930 
<a name="l02931"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a041383b3d36547ea966ab832cb884b30">02931</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a93125a1e775623e464919b4eb585082b">SKETCH_OT_draw_stroke</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02932"></a>02932 {
<a name="l02933"></a>02933     <span class="comment">/* identifiers */</span>
<a name="l02934"></a>02934     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Draw Stroke&quot;</span>;
<a name="l02935"></a>02935     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_draw_stroke&quot;</span>;
<a name="l02936"></a>02936 
<a name="l02937"></a>02937     <span class="comment">/* api callbacks */</span>
<a name="l02938"></a>02938     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#ae3bd3092e015afcdb32ab3086350e9be">sketch_draw_stroke</a>;
<a name="l02939"></a>02939     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a>  = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aaba4d1ac272c23bf7f18f160dbc734c7">sketch_draw_stroke_modal</a>;
<a name="l02940"></a>02940     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a7d55f3cef7d14c7eae5d549387233514">sketch_draw_stroke_cancel</a>;
<a name="l02941"></a>02941 
<a name="l02942"></a>02942     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = (int (*)(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *))<a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a4c87ba5595aed8469aea5df1607be628">ED_operator_sketch_mode</a>;
<a name="l02943"></a>02943 
<a name="l02944"></a>02944     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;snap&quot;</span>, 0, <span class="stringliteral">&quot;Snap&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02945"></a>02945 
<a name="l02946"></a>02946     <span class="comment">/* flags */</span>
<a name="l02947"></a>02947     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>; <span class="comment">// OPTYPE_REGISTER|OPTYPE_UNDO</span>
<a name="l02948"></a>02948 }
<a name="l02949"></a>02949 
<a name="l02950"></a><a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a943bb10867521e414b087ec933d87cba">02950</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d26/armature__intern_8h.html#a42c0ad582e886e006ab3955f5547fffb">SKETCH_OT_gesture</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02951"></a>02951 {
<a name="l02952"></a>02952     <span class="comment">/* identifiers */</span>
<a name="l02953"></a>02953     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Gesture&quot;</span>;
<a name="l02954"></a>02954     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SKETCH_OT_gesture&quot;</span>;
<a name="l02955"></a>02955 
<a name="l02956"></a>02956     <span class="comment">/* api callbacks */</span>
<a name="l02957"></a>02957     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a29f91101003ace17477ee3d23865657a">sketch_draw_gesture</a>;
<a name="l02958"></a>02958     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a>  = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a762c52725de75fbb04a567a971e416a2">sketch_draw_gesture_modal</a>;
<a name="l02959"></a>02959     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#a423d83cc171ebaec11d6b77439afb52f">sketch_draw_gesture_cancel</a>;
<a name="l02960"></a>02960 
<a name="l02961"></a>02961     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d0/d92/editarmature__sketch_8c.html#aeecbc314e9a838fa54cf7297491d74c5">ED_operator_sketch_mode_gesture</a>;
<a name="l02962"></a>02962 
<a name="l02963"></a>02963     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;snap&quot;</span>, 0, <span class="stringliteral">&quot;Snap&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02964"></a>02964 
<a name="l02965"></a>02965     <span class="comment">/* flags */</span>
<a name="l02966"></a>02966     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>; <span class="comment">// OPTYPE_UNDO</span>
<a name="l02967"></a>02967 }
<a name="l02968"></a>02968 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:16 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

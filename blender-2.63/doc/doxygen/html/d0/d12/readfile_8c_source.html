<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: readfile.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">readfile.c</div>  </div>
</div>
<div class="contents">
<a href="../../d0/d12/readfile_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Blender Foundation</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;zlib.h&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span> <span class="comment">// for printf fopen fwrite fclose sprintf FILE</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;stdlib.h&gt;</span> <span class="comment">// for getenv atoi</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;stddef.h&gt;</span> <span class="comment">// for offsetof</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;fcntl.h&gt;</span> <span class="comment">// for open</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;string.h&gt;</span> <span class="comment">// for strrchr strncmp strstr</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;math.h&gt;</span> <span class="comment">// for fabs</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;stdarg.h&gt;</span> <span class="comment">/* for va_start/end */</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;unistd.h&gt;</span> <span class="comment">// for read close</span>
<a name="l00046"></a>00046 <span class="preprocessor">#else</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;io.h&gt;</span> <span class="comment">// for open close read</span>
<a name="l00048"></a>00048 <span class="preprocessor">#  include &quot;winsock2.h&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#  include &quot;<a class="code" href="../../d9/ded/BLI__winstuff_8h.html" title="Compatibility-like things for windows.">BLI_winstuff.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#endif</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 <span class="comment">/* allow readfile to use deprecated functionality */</span>
<a name="l00053"></a><a class="code" href="../../d0/d12/readfile_8c.html#aab0b0efbdfa37ee26c8805af7d2e8c9c">00053</a> <span class="preprocessor">#define DNA_DEPRECATED_ALLOW</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html">DNA_actuator_types.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d37/DNA__brush__types_8h.html">DNA_brush_types.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d70/DNA__cloth__types_8h.html">DNA_cloth_types.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d3e/DNA__controller__types_8h.html">DNA_controller_types.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html">DNA_constraint_types.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/daf/DNA__dynamicpaint__types_8h.html">DNA_dynamicpaint_types.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html">DNA_effect_types.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d61/DNA__fileglobal__types_8h.html">DNA_fileglobal_types.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dcc/DNA__genfile_8h.html" title="blenloader genfile private function prototypes">DNA_genfile.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d75/DNA__group__types_8h.html">DNA_group_types.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html">DNA_gpencil_types.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html">DNA_ipo_types.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html">DNA_lattice_types.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d40/DNA__meta__types_8h.html">DNA_meta_types.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../db/db5/DNA__nla__types_8h.html">DNA_nla_types.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html">DNA_object_fluidsim.h</a>&quot;</span> <span class="comment">// NT</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d4d/DNA__packedFile__types_8h.html">DNA_packedFile_types.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d5a/DNA__particle__types_8h.html">DNA_particle_types.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d2b/DNA__property__types_8h.html">DNA_property_types.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d71/DNA__text__types_8h.html">DNA_text_types.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html">DNA_view3d_types.h</a>&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html">DNA_sensor_types.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d4e/DNA__sdna__types_8h.html">DNA_sdna_types.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html">DNA_sequence_types.h</a>&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html">DNA_smoke_types.h</a>&quot;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &quot;<a class="code" href="../../da/de4/DNA__speaker__types_8h.html">DNA_speaker_types.h</a>&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d66/DNA__sound__types_8h.html">DNA_sound_types.h</a>&quot;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00094"></a>00094 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dcc/DNA__vfont__types_8h.html">DNA_vfont_types.h</a>&quot;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html">DNA_movieclip_types.h</a>&quot;</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00101"></a>00101 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00102"></a>00102 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00103"></a>00103 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html" title="A general unordered 2-int pair hash table ADT.">BLI_edgehash.h</a>&quot;</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd0/BKE__anim_8h.html">BKE_anim.h</a>&quot;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d17/BKE__armature_8h.html">BKE_armature.h</a>&quot;</span>
<a name="l00108"></a>00108 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dc9/BKE__brush_8h.html">BKE_brush.h</a>&quot;</span>
<a name="l00109"></a>00109 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dca/BKE__colortools_8h.html">BKE_colortools.h</a>&quot;</span>
<a name="l00110"></a>00110 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span>
<a name="l00111"></a>00111 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00112"></a>00112 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dfc/BKE__curve_8h.html">BKE_curve.h</a>&quot;</span>
<a name="l00113"></a>00113 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dbd/BKE__deform_8h.html" title="support for deformation groups and hooks.">BKE_deform.h</a>&quot;</span>
<a name="l00114"></a>00114 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d65/BKE__effect_8h.html">BKE_effect.h</a>&quot;</span>
<a name="l00115"></a>00115 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00116"></a>00116 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span> <span class="comment">// for G</span>
<a name="l00117"></a>00117 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/df5/BKE__group_8h.html">BKE_group.h</a>&quot;</span>
<a name="l00118"></a>00118 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d77/BKE__image_8h.html">BKE_image.h</a>&quot;</span>
<a name="l00119"></a>00119 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8f/BKE__lattice_8h.html">BKE_lattice.h</a>&quot;</span>
<a name="l00120"></a>00120 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span> <span class="comment">// for which_libbase</span>
<a name="l00121"></a>00121 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/de8/BKE__idcode_8h.html">BKE_idcode.h</a>&quot;</span>
<a name="l00122"></a>00122 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00123"></a>00123 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span> <span class="comment">// for Main</span>
<a name="l00124"></a>00124 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span> <span class="comment">// for ME_ defines (patching)</span>
<a name="l00125"></a>00125 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00126"></a>00126 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d37/BKE__multires_8h.html">BKE_multires.h</a>&quot;</span>
<a name="l00127"></a>00127 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span> <span class="comment">// for tree type defines</span>
<a name="l00128"></a>00128 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d53/BKE__ocean_8h.html">BKE_ocean.h</a>&quot;</span>
<a name="l00129"></a>00129 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00130"></a>00130 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d86/BKE__paint_8h.html">BKE_paint.h</a>&quot;</span>
<a name="l00131"></a>00131 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dca/BKE__particle_8h.html">BKE_particle.h</a>&quot;</span>
<a name="l00132"></a>00132 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/BKE__pointcache_8h.html">BKE_pointcache.h</a>&quot;</span>
<a name="l00133"></a>00133 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/db8/BKE__property_8h.html">BKE_property.h</a>&quot;</span> <span class="comment">// for get_ob_property</span>
<a name="l00134"></a>00134 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00135"></a>00135 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de8/BKE__sca_8h.html">BKE_sca.h</a>&quot;</span> <span class="comment">// for init_actuator</span>
<a name="l00136"></a>00136 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00137"></a>00137 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5f/BKE__sequencer_8h.html">BKE_sequencer.h</a>&quot;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d6d/BKE__text_8h.html">BKE_text.h</a>&quot;</span> <span class="comment">// for txt_extended_ascii_as_utf8</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d66/BKE__texture_8h.html">BKE_texture.h</a>&quot;</span> <span class="comment">// for open_plugin_tex</span>
<a name="l00141"></a>00141 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d72/BKE__tracking_8h.html">BKE_tracking.h</a>&quot;</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span> <span class="comment">// SWITCH_INT DATA ENDB DNA1 O_BINARY GLOB USER TEST REND</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/db1/BKE__sound_8h.html">BKE_sound.h</a>&quot;</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>  <span class="comment">// for proxy / timecode versioning stuff</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d52/NOD__socket_8h.html">NOD_socket.h</a>&quot;</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">//XXX #include &quot;BIF_butspace.h&quot; // badlevel, for do_versions, patching event codes</span>
<a name="l00150"></a>00150 <span class="comment">//XXX #include &quot;BIF_filelist.h&quot; // badlevel too, where to move this? - elubie</span>
<a name="l00151"></a>00151 <span class="comment">//XXX #include &quot;BIF_previewrender.h&quot; // bedlelvel, for struct RenderInfo</span>
<a name="l00152"></a>00152 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d01/BLO__readfile_8h.html" title="external readfile function prototypes.">BLO_readfile.h</a>&quot;</span>
<a name="l00153"></a>00153 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d5f/BLO__undofile_8h.html">BLO_undofile.h</a>&quot;</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="preprocessor">#include &quot;<a class="code" href="../../db/da9/RE__engine_8h.html">RE_engine.h</a>&quot;</span>
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d65/readfile_8h.html">readfile.h</a>&quot;</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">/*</span>
<a name="l00164"></a>00164 <span class="comment"> Remark: still a weak point is the newaddress() function, that doesnt solve reading from</span>
<a name="l00165"></a>00165 <span class="comment"> multiple files at the same time</span>
<a name="l00166"></a>00166 <span class="comment"></span>
<a name="l00167"></a>00167 <span class="comment"> (added remark: oh, i thought that was solved? will look at that... (ton)</span>
<a name="l00168"></a>00168 <span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment">READ</span>
<a name="l00170"></a>00170 <span class="comment">- Existing Library (Main) push or free</span>
<a name="l00171"></a>00171 <span class="comment">- allocate new Main</span>
<a name="l00172"></a>00172 <span class="comment">- load file</span>
<a name="l00173"></a>00173 <span class="comment">- read SDNA</span>
<a name="l00174"></a>00174 <span class="comment">- for each LibBlock</span>
<a name="l00175"></a>00175 <span class="comment">    - read LibBlock</span>
<a name="l00176"></a>00176 <span class="comment">    - if a Library</span>
<a name="l00177"></a>00177 <span class="comment">        - make a new Main</span>
<a name="l00178"></a>00178 <span class="comment">        - attach ID&#39;s to it</span>
<a name="l00179"></a>00179 <span class="comment">    - else</span>
<a name="l00180"></a>00180 <span class="comment">        - read associated &#39;direct data&#39;</span>
<a name="l00181"></a>00181 <span class="comment">        - link direct data (internal and to LibBlock)</span>
<a name="l00182"></a>00182 <span class="comment">- read FileGlobal</span>
<a name="l00183"></a>00183 <span class="comment">- read USER data, only when indicated (file is ~/X.XX/startup.blend)</span>
<a name="l00184"></a>00184 <span class="comment">- free file</span>
<a name="l00185"></a>00185 <span class="comment">- per Library (per Main)</span>
<a name="l00186"></a>00186 <span class="comment">    - read file</span>
<a name="l00187"></a>00187 <span class="comment">    - read SDNA</span>
<a name="l00188"></a>00188 <span class="comment">    - find LibBlocks and attach IDs to Main</span>
<a name="l00189"></a>00189 <span class="comment">        - if external LibBlock</span>
<a name="l00190"></a>00190 <span class="comment">            - search all Main&#39;s</span>
<a name="l00191"></a>00191 <span class="comment">                - or it&#39;s already read,</span>
<a name="l00192"></a>00192 <span class="comment">                - or not read yet</span>
<a name="l00193"></a>00193 <span class="comment">                - or make new Main</span>
<a name="l00194"></a>00194 <span class="comment">    - per LibBlock</span>
<a name="l00195"></a>00195 <span class="comment">        - read recursive</span>
<a name="l00196"></a>00196 <span class="comment">        - read associated direct data</span>
<a name="l00197"></a>00197 <span class="comment">        - link direct data (internal and to LibBlock)</span>
<a name="l00198"></a>00198 <span class="comment">    - free file</span>
<a name="l00199"></a>00199 <span class="comment">- per Library with unread LibBlocks</span>
<a name="l00200"></a>00200 <span class="comment">    - read file</span>
<a name="l00201"></a>00201 <span class="comment">    - read SDNA</span>
<a name="l00202"></a>00202 <span class="comment">    - per LibBlock</span>
<a name="l00203"></a>00203 <span class="comment">               - read recursive</span>
<a name="l00204"></a>00204 <span class="comment">               - read associated direct data</span>
<a name="l00205"></a>00205 <span class="comment">               - link direct data (internal and to LibBlock)</span>
<a name="l00206"></a>00206 <span class="comment">        - free file</span>
<a name="l00207"></a>00207 <span class="comment">- join all Mains</span>
<a name="l00208"></a>00208 <span class="comment">- link all LibBlocks and indirect pointers to libblocks</span>
<a name="l00209"></a>00209 <span class="comment">- initialize FileGlobal and copy pointers to Global</span>
<a name="l00210"></a>00210 <span class="comment">*/</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">/* also occurs in library.c */</span>
<a name="l00213"></a>00213 <span class="comment">/* GS reads the memory pointed at in a specific ordering. There are,</span>
<a name="l00214"></a>00214 <span class="comment"> * however two definitions for it. I have jotted them down here, both,</span>
<a name="l00215"></a>00215 <span class="comment"> * but I think the first one is actually used. The thing is that</span>
<a name="l00216"></a>00216 <span class="comment"> * big-endian systems might read this the wrong way round. OTOH, we</span>
<a name="l00217"></a>00217 <span class="comment"> * constructed the IDs that are read out with this macro explicitly as</span>
<a name="l00218"></a>00218 <span class="comment"> * well. I expect we&#39;ll sort it out soon... */</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">/* from blendef: */</span>
<a name="l00221"></a><a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">00221</a> <span class="preprocessor">#define GS(a)   (*((short *)(a)))</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>
<a name="l00223"></a>00223 <span class="comment">/* from misc_util: flip the bytes from x  */</span>
<a name="l00224"></a>00224 <span class="comment">/*  #define GS(x) (((unsigned char *)(x))[0] &lt;&lt; 8 | ((unsigned char *)(x))[1]) */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">// only used here in readfile.c</span>
<a name="l00227"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac47a883c6487cffa79ae446ae1990895">00227</a> <span class="preprocessor">#define SWITCH_LONGINT(a) { \</span>
<a name="l00228"></a>00228 <span class="preprocessor">    char s_i, *p_i; \</span>
<a name="l00229"></a>00229 <span class="preprocessor">    p_i= (char *)&amp;(a);  \</span>
<a name="l00230"></a>00230 <span class="preprocessor">    s_i=p_i[0]; p_i[0]=p_i[7]; p_i[7]=s_i; \</span>
<a name="l00231"></a>00231 <span class="preprocessor">    s_i=p_i[1]; p_i[1]=p_i[6]; p_i[6]=s_i; \</span>
<a name="l00232"></a>00232 <span class="preprocessor">    s_i=p_i[2]; p_i[2]=p_i[5]; p_i[5]=s_i; \</span>
<a name="l00233"></a>00233 <span class="preprocessor">    s_i=p_i[3]; p_i[3]=p_i[4]; p_i[4]=s_i; }</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>
<a name="l00235"></a>00235 <span class="comment">/***/</span>
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="../../d7/d6a/structOldNew.html">00237</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> {
<a name="l00238"></a><a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">00238</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>, *<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00239"></a><a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">00239</a>     <span class="keywordtype">int</span> <a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>;
<a name="l00240"></a>00240 } <a class="code" href="../../d0/d12/readfile_8c.html#a009318bcb460f32aabb2b21abc73e5f2">OldNew</a>;
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="../../d1/dac/structOldNewMap.html">00242</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> {
<a name="l00243"></a><a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">00243</a>     <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>;
<a name="l00244"></a><a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">00244</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>, <a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>;
<a name="l00245"></a><a class="code" href="../../d1/dac/structOldNewMap.html#aec8a11944965eaba6aed57b980c61900">00245</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/dac/structOldNewMap.html#aec8a11944965eaba6aed57b980c61900">sorted</a>;
<a name="l00246"></a><a class="code" href="../../d1/dac/structOldNewMap.html#a1c3a2bb4d8d895db3e8307a75dc71872">00246</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/dac/structOldNewMap.html#a1c3a2bb4d8d895db3e8307a75dc71872">lasthit</a>;
<a name="l00247"></a>00247 } <a class="code" href="../../d0/d12/readfile_8c.html#a95677d5ef5da31163a812f6250f490ec">OldNewMap</a>;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="comment">/* local prototypes */</span>
<a name="l00251"></a>00251 <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bh, <span class="keyword">const</span> <span class="keywordtype">char</span> *blockname);
<a name="l00252"></a>00252 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac8116e0739106ff44bb1e64be869285c">direct_link_modifiers</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb);
<a name="l00253"></a>00253 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1b009f10b5ef8343572988700dca90b3">convert_tface_mt</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">/* this function ensures that reports are printed,</span>
<a name="l00256"></a>00256 <span class="comment"> * in the case of libraray linking errors this is important!</span>
<a name="l00257"></a>00257 <span class="comment"> *</span>
<a name="l00258"></a>00258 <span class="comment"> * bit kludge but better then doubling up on prints,</span>
<a name="l00259"></a>00259 <span class="comment"> * we could alternatively have a versions of a report function which foces printing - campbell</span>
<a name="l00260"></a>00260 <span class="comment"> */</span>
<a name="l00261"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">00261</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(<a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68">ReportType</a> type, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263     <span class="keywordtype">char</span> fixed_buf[1024]; <span class="comment">/* should be long enough */</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     va_list args;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     va_start(args, format);
<a name="l00268"></a>00268     vsnprintf(fixed_buf, <span class="keyword">sizeof</span>(fixed_buf), format, args);
<a name="l00269"></a>00269     va_end(args);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     fixed_buf[<span class="keyword">sizeof</span>(fixed_buf) - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, type, fixed_buf);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background==0) {
<a name="l00276"></a>00276         printf(<span class="stringliteral">&quot;%s\n&quot;</span>, fixed_buf);
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">00280</a> <span class="keyword">static</span> <a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>(<span class="keywordtype">void</span>) 
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282     <a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*onm), <span class="stringliteral">&quot;OldNewMap&quot;</span>);
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>= 1024;
<a name="l00285"></a>00285     onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>)*onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>, <span class="stringliteral">&quot;OldNewMap.entries&quot;</span>);
<a name="l00286"></a>00286     
<a name="l00287"></a>00287     <span class="keywordflow">return</span> onm;
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="../../d0/d12/readfile_8c.html#adcedb16ea2a385f41864b887379c0ce1">00290</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#adcedb16ea2a385f41864b887379c0ce1">verg_oldnewmap</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *v1, <span class="keyword">const</span> <span class="keywordtype">void</span> *v2)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *x1=v1, *x2=v2;
<a name="l00293"></a>00293     
<a name="l00294"></a>00294     <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a> &gt; x2-&gt;old) <span class="keywordflow">return</span> 1;
<a name="l00295"></a>00295     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a> &lt; x2-&gt;old) <span class="keywordflow">return</span> -1;
<a name="l00296"></a>00296     <span class="keywordflow">return</span> 0;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 
<a name="l00300"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa8853f362ec1d38f52d4df67413d3d15">00300</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa8853f362ec1d38f52d4df67413d3d15">oldnewmap_sort</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd) 
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302     qsort(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a>), <a class="code" href="../../d0/d12/readfile_8c.html#adcedb16ea2a385f41864b887379c0ce1">verg_oldnewmap</a>);
<a name="l00303"></a>00303     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aec8a11944965eaba6aed57b980c61900">sorted</a>= 1;
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/* nr is zero for data, and ID code for libdata */</span>
<a name="l00307"></a><a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">00307</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(<a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm, <span class="keywordtype">void</span> *oldaddr, <span class="keywordtype">void</span> *newaddr, <span class="keywordtype">int</span> <a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>) 
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309     <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (oldaddr==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || newaddr==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00312"></a>00312     
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>==onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>) {
<a name="l00314"></a>00314         <span class="keywordtype">int</span> osize= onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>;
<a name="l00315"></a>00315         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *oentries= onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>*= 2;
<a name="l00318"></a>00318         onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>)*onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a8994c8b288352c86009e268bc59fbf9b">entriessize</a>, <span class="stringliteral">&quot;OldNewMap.entries&quot;</span>);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         memcpy(onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>, oentries, <span class="keyword">sizeof</span>(*oentries)*osize);
<a name="l00321"></a>00321         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(oentries);
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     entry= &amp;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>[onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>++];
<a name="l00325"></a>00325     entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>= oldaddr;
<a name="l00326"></a>00326     entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>= newaddr;
<a name="l00327"></a>00327     entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>= <a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>;
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa3d9232651df818b271b70f8c603f766">00330</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#aa3d9232651df818b271b70f8c603f766">oldnewmap_lookup_and_inc</a>(<a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm, <span class="keywordtype">void</span> *addr) 
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="keywordflow">if</span> (addr==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordflow">if</span> (onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a1c3a2bb4d8d895db3e8307a75dc71872">lasthit</a>&lt;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>-1) {
<a name="l00337"></a>00337         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= &amp;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>[++onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a1c3a2bb4d8d895db3e8307a75dc71872">lasthit</a>];
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>==addr) {
<a name="l00340"></a>00340             entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>++;
<a name="l00341"></a>00341             <span class="keywordflow">return</span> entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00342"></a>00342         }
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordflow">for</span> (i=0; i&lt;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>; i++) {
<a name="l00346"></a>00346         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= &amp;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>==addr) {
<a name="l00349"></a>00349             onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a1c3a2bb4d8d895db3e8307a75dc71872">lasthit</a>= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351             entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>++;
<a name="l00352"></a>00352             <span class="keywordflow">return</span> entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00353"></a>00353         }
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00357"></a>00357 }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 <span class="comment">/* for libdata, nr has ID code, no increment */</span>
<a name="l00360"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa2c6d48e113fa2f08cc50ca7bd2a960c">00360</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#aa2c6d48e113fa2f08cc50ca7bd2a960c">oldnewmap_liblookup</a>(<a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm, <span class="keywordtype">void</span> *addr, <span class="keywordtype">void</span> *lib) 
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00363"></a>00363     
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (addr==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00365"></a>00365     
<a name="l00366"></a>00366     <span class="comment">/* lasthit works fine for non-libdata, linking there is done in same sequence as writing */</span>
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aec8a11944965eaba6aed57b980c61900">sorted</a>) {
<a name="l00368"></a>00368         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> entry_s, *entry;
<a name="l00369"></a>00369         
<a name="l00370"></a>00370         entry_s.<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>= addr;
<a name="l00371"></a>00371         
<a name="l00372"></a>00372         entry= bsearch(&amp;entry_s, onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>, onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a>), <a class="code" href="../../d0/d12/readfile_8c.html#adcedb16ea2a385f41864b887379c0ce1">verg_oldnewmap</a>);
<a name="l00373"></a>00373         <span class="keywordflow">if</span> (entry) {
<a name="l00374"></a>00374             <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00375"></a>00375             
<a name="l00376"></a>00376             <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; (!lib || id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>)) {
<a name="l00377"></a>00377                 <span class="keywordflow">return</span> entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00378"></a>00378             }
<a name="l00379"></a>00379         }
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381     
<a name="l00382"></a>00382     <span class="keywordflow">for</span> (i=0; i&lt;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>; i++) {
<a name="l00383"></a>00383         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= &amp;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>==addr) {
<a name="l00386"></a>00386             <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388             <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; (!lib || id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>)) {
<a name="l00389"></a>00389                 <span class="keywordflow">return</span> entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>;
<a name="l00390"></a>00390             }
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6c9bdd398865fbc03c3e15c9a27ae6fe">00397</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a6c9bdd398865fbc03c3e15c9a27ae6fe">oldnewmap_free_unused</a>(<a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm) 
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="keywordflow">for</span> (i=0; i&lt;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>; i++) {
<a name="l00402"></a>00402         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= &amp;onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>==0) {
<a name="l00404"></a>00404             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>);
<a name="l00405"></a>00405             entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="../../d0/d12/readfile_8c.html#aba079f09686eff5205d81438bc402689">00410</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aba079f09686eff5205d81438bc402689">oldnewmap_clear</a>(<a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm) 
<a name="l00411"></a>00411 {
<a name="l00412"></a>00412     onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>= 0;
<a name="l00413"></a>00413     onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a1c3a2bb4d8d895db3e8307a75dc71872">lasthit</a>= 0;
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00416"></a><a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">00416</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(<a class="code" href="../../d1/dac/structOldNewMap.html">OldNewMap</a> *onm) 
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(onm-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>);
<a name="l00419"></a>00419     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(onm);
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="comment">/***/</span>
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a04b6bacd8b4fd46514604fa8c3e427dc">read_libraries</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *basefd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment">/* ************ help functions ***************** */</span>
<a name="l00427"></a>00427 
<a name="l00428"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4981d87f5043c189d707163a26238b4b">00428</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4981d87f5043c189d707163a26238b4b">add_main_to_main</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *from)
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>], *fromarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l00431"></a>00431     <span class="keywordtype">int</span> a;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(mainvar, lbarray);
<a name="l00434"></a>00434     a= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(from, fromarray);
<a name="l00435"></a>00435     <span class="keywordflow">while</span> (a--) {
<a name="l00436"></a>00436         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(lbarray[a], fromarray[a]);
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="../../de/d65/readfile_8h.html#af48dcb9e6b4ce80b32f0bd8ac0f6b7a6">00440</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af48dcb9e6b4ce80b32f0bd8ac0f6b7a6">blo_join_main</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist)
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *tojoin, *mainl;
<a name="l00443"></a>00443     
<a name="l00444"></a>00444     
<a name="l00445"></a>00445     mainl= mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00446"></a>00446     <span class="keywordflow">while</span> ((tojoin= mainl-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>)) {
<a name="l00447"></a>00447         <a class="code" href="../../d0/d12/readfile_8c.html#a4981d87f5043c189d707163a26238b4b">add_main_to_main</a>(mainl, tojoin);
<a name="l00448"></a>00448         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(mainlist, tojoin);
<a name="l00449"></a>00449         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tojoin);
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a><a class="code" href="../../d0/d12/readfile_8c.html#a0a442012fb7092eeedbf92fd27b2ac9d">00453</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a0a442012fb7092eeedbf92fd27b2ac9d">split_libdata</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *first)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbn;
<a name="l00456"></a>00456     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id, *idnext;
<a name="l00457"></a>00457     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keywordtype">id</span>= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00460"></a>00460     <span class="keywordflow">while</span> (<span class="keywordtype">id</span>) {
<a name="l00461"></a>00461         idnext= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l00463"></a>00463             mainvar= first;
<a name="l00464"></a>00464             <span class="keywordflow">while</span> (mainvar) {
<a name="l00465"></a>00465                 <span class="keywordflow">if</span> (mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>==id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l00466"></a>00466                     lbn= <a class="code" href="../../d8/db1/BKE__library_8h.html#a2dc345b18171d710d51f14d814121381">which_libbase</a>(mainvar, <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>));
<a name="l00467"></a>00467                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(lb, <span class="keywordtype">id</span>);
<a name="l00468"></a>00468                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lbn, <span class="keywordtype">id</span>);
<a name="l00469"></a>00469                     <span class="keywordflow">break</span>;
<a name="l00470"></a>00470                 }
<a name="l00471"></a>00471                 mainvar= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>;
<a name="l00472"></a>00472             }
<a name="l00473"></a>00473             <span class="keywordflow">if</span> (mainvar==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) printf(<span class="stringliteral">&quot;error split_libdata\n&quot;</span>);
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475         <span class="keywordtype">id</span>= idnext;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00479"></a><a class="code" href="../../de/d65/readfile_8h.html#a6293b46fa75041bb96fa6e6e513baeb4">00479</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aaf5f25a816c0bd974a821b502bcb6129">blo_split_main</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l00480"></a>00480 {
<a name="l00481"></a>00481     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l00482"></a>00482     <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib;
<a name="l00483"></a>00483     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>;
<a name="l00486"></a>00486     main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00489"></a>00489         <span class="keywordflow">return</span>;
<a name="l00490"></a>00490     
<a name="l00491"></a>00491     <span class="keywordflow">for</span> (lib= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lib; lib= lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a26257357bfced5837d7507da22f18c5a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00492"></a>00492         <a class="code" href="../../d0/dc0/structMain.html">Main</a> *libmain= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc0/structMain.html">Main</a>), <span class="stringliteral">&quot;libmain&quot;</span>);
<a name="l00493"></a>00493         libmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>= lib;
<a name="l00494"></a>00494         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(mainlist, libmain);
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     i= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(main, lbarray);
<a name="l00498"></a>00498     <span class="keywordflow">while</span> (i--)
<a name="l00499"></a>00499         <a class="code" href="../../d0/d12/readfile_8c.html#a0a442012fb7092eeedbf92fd27b2ac9d">split_libdata</a>(lbarray[i], main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>);
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">/* removes things like /blah/blah/../../blah/ etc, then writes in *name the full path */</span>
<a name="l00503"></a><a class="code" href="../../d0/d12/readfile_8c.html#a83b06e589c8a2efbff0e61f0d79d3087">00503</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a83b06e589c8a2efbff0e61f0d79d3087">cleanup_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *relabase, <span class="keywordtype">char</span> *name)
<a name="l00504"></a>00504 {
<a name="l00505"></a>00505     <span class="keywordtype">char</span> filename[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a40b3bb1f7d7c8c9bbf4e0ed92564e73e">FILE_MAXFILE</a>];
<a name="l00506"></a>00506     
<a name="l00507"></a>00507     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9587680f8895016dd21016fcecb476b0">BLI_splitdirstring</a>(name, filename);
<a name="l00508"></a>00508     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a7fcb2651a621a0b5e761fbe2a6add270">BLI_cleanup_dir</a>(relabase, name);
<a name="l00509"></a>00509     strcat(name, filename);
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="../../d0/d12/readfile_8c.html#aec40e10a1816657984efe58afbe3617a">00512</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aec40e10a1816657984efe58afbe3617a">read_file_version</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead;
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); bhead; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead)) {
<a name="l00517"></a>00517         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2a900ad5a15c2c67fb345854b3d2ad09">GLOB</a>) {
<a name="l00518"></a>00518             <a class="code" href="../../db/d9a/structFileGlobal.html">FileGlobal</a> *fg= <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bhead, <span class="stringliteral">&quot;Global&quot;</span>);
<a name="l00519"></a>00519             <span class="keywordflow">if</span> (fg) {
<a name="l00520"></a>00520                 main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a415a742799c367639e33080e74fb4449">subversion</a>;
<a name="l00521"></a>00521                 main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a78def530ab43c43630d2d468e083cb83">minversionfile</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a9ab560aa2e6abea29fdf9bf8562c4cd5">minversion</a>;
<a name="l00522"></a>00522                 main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ab56fa441a433f58e9b0541d8f4f5c210">minsubversionfile</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a75fdb1f77be02db33fa3af5da5ba0b14">minsubversion</a>;
<a name="l00523"></a>00523                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fg);
<a name="l00524"></a>00524             }
<a name="l00525"></a>00525             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>)
<a name="l00526"></a>00526                 <span class="keywordflow">break</span>;
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 
<a name="l00532"></a><a class="code" href="../../d0/d12/readfile_8c.html#a24a5d36cb3cf8466e0e301f6b453b437">00532</a> <span class="keyword">static</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a24a5d36cb3cf8466e0e301f6b453b437">blo_find_main</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist, <span class="keyword">const</span> <span class="keywordtype">char</span> *filepath, <span class="keyword">const</span> <span class="keywordtype">char</span> *relabase)
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *m;
<a name="l00535"></a>00535     <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib;
<a name="l00536"></a>00536     <span class="keywordtype">char</span> name1[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00537"></a>00537     
<a name="l00538"></a>00538     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(name1, filepath, <span class="keyword">sizeof</span>(name1));
<a name="l00539"></a>00539     <a class="code" href="../../d0/d12/readfile_8c.html#a83b06e589c8a2efbff0e61f0d79d3087">cleanup_path</a>(relabase, name1);
<a name="l00540"></a>00540 <span class="comment">//  printf(&quot;blo_find_main: original in  %s\n&quot;, name);</span>
<a name="l00541"></a>00541 <span class="comment">//  printf(&quot;blo_find_main: converted to %s\n&quot;, name1);</span>
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <span class="keywordflow">for</span> (m= mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; m; m= m-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l00544"></a>00544         <span class="keywordtype">char</span> *libname= (m-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>)?m-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>:m-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>;
<a name="l00545"></a>00545         
<a name="l00546"></a>00546         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>(name1, libname) == 0) {
<a name="l00547"></a>00547             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>) printf(<span class="stringliteral">&quot;blo_find_main: found library %s\n&quot;</span>, libname);
<a name="l00548"></a>00548             <span class="keywordflow">return</span> m;
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     m= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc0/structMain.html">Main</a>), <span class="stringliteral">&quot;find_main&quot;</span>);
<a name="l00553"></a>00553     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(mainlist, m);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     lib= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;m-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abaf1999f335a0db6ef4f452fae0fbd06">ID_LI</a>, <span class="stringliteral">&quot;lib&quot;</span>);
<a name="l00556"></a>00556     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, filepath, <span class="keyword">sizeof</span>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>));
<a name="l00557"></a>00557     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, name1, <span class="keyword">sizeof</span>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>));
<a name="l00558"></a>00558     
<a name="l00559"></a>00559     m-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>= lib;
<a name="l00560"></a>00560     
<a name="l00561"></a>00561     <a class="code" href="../../d0/d12/readfile_8c.html#aec40e10a1816657984efe58afbe3617a">read_file_version</a>(fd, m);
<a name="l00562"></a>00562     
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>) printf(<span class="stringliteral">&quot;blo_find_main: added new lib %s\n&quot;</span>, filepath);
<a name="l00564"></a>00564     <span class="keywordflow">return</span> m;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">/* ************ FILE PARSING ****************** */</span>
<a name="l00569"></a>00569 
<a name="l00570"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad28153824503843204e3dcbf06a02f95">00570</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad28153824503843204e3dcbf06a02f95">switch_endian_bh4</a>(<a class="code" href="../../d5/dfb/structBHead4.html">BHead4</a> *bhead)
<a name="l00571"></a>00571 {
<a name="l00572"></a>00572     <span class="comment">/* the ID_.. codes */</span>
<a name="l00573"></a>00573     <span class="keywordflow">if</span> ((bhead-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a> &amp; 0xFFFF)==0) bhead-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a> &gt;&gt;=16;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a> != <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l00576"></a>00576         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(bhead-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a28ef9af8a0d6245d012975228a79a723">len</a>);
<a name="l00577"></a>00577         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(bhead-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a0533ed8e9fed8413efd607c16d350be7">SDNAnr</a>);
<a name="l00578"></a>00578         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(bhead-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a43e35eb83b1383841ca78ae609faa42e">nr</a>);
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00582"></a><a class="code" href="../../d0/d12/readfile_8c.html#add790f2bdcde99713746147bec6ad465">00582</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#add790f2bdcde99713746147bec6ad465">switch_endian_bh8</a>(<a class="code" href="../../d1/d97/structBHead8.html">BHead8</a> *bhead)
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584     <span class="comment">/* the ID_.. codes */</span>
<a name="l00585"></a>00585     <span class="keywordflow">if</span> ((bhead-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a> &amp; 0xFFFF)==0) bhead-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a> &gt;&gt;=16;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a> != <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l00588"></a>00588         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(bhead-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a492b6b8aa12499e7ad33eed0410ed2e5">len</a>);
<a name="l00589"></a>00589         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(bhead-&gt;<a class="code" href="../../d1/d97/structBHead8.html#adaaf5e01b436f464983e7ed24249e670">SDNAnr</a>);
<a name="l00590"></a>00590         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(bhead-&gt;<a class="code" href="../../d1/d97/structBHead8.html#ad9a86cbddec6d7aefb12837ea3298da2">nr</a>);
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a><a class="code" href="../../d0/d12/readfile_8c.html#a3dae139276f539f96b26eec44a5511f1">00594</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3dae139276f539f96b26eec44a5511f1">bh4_from_bh8</a>(<a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead, <a class="code" href="../../d1/d97/structBHead8.html">BHead8</a> *bhead8, <span class="keywordtype">int</span> do_endian_swap)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596     <a class="code" href="../../d5/dfb/structBHead4.html">BHead4</a> *bhead4 = (<a class="code" href="../../d5/dfb/structBHead4.html">BHead4</a> *) bhead;
<a name="l00597"></a>00597 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(FREE_WINDOWS)</span>
<a name="l00598"></a>00598 <span class="preprocessor"></span>    __int64 <a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>;
<a name="l00599"></a>00599 <span class="preprocessor">#else</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span>    <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>;
<a name="l00601"></a>00601 <span class="preprocessor">#endif</span>
<a name="l00602"></a>00602 <span class="preprocessor"></span>
<a name="l00603"></a>00603     bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a>= bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a>;
<a name="l00604"></a>00604     bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a28ef9af8a0d6245d012975228a79a723">len</a>= bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a492b6b8aa12499e7ad33eed0410ed2e5">len</a>;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a> != <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l00607"></a>00607 
<a name="l00608"></a>00608         <span class="comment">//perform a endian swap on 64bit pointers, otherwise the pointer might map to zero</span>
<a name="l00609"></a>00609         <span class="comment">//0x0000000000000000000012345678 would become 0x12345678000000000000000000000000</span>
<a name="l00610"></a>00610         <span class="keywordflow">if</span> (do_endian_swap) {
<a name="l00611"></a>00611             <a class="code" href="../../d0/d12/readfile_8c.html#ac47a883c6487cffa79ae446ae1990895">SWITCH_LONGINT</a>(bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a10faabbbf38c15a904f9c51e7edf3259">old</a>);
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614         <span class="comment">/* this patch is to avoid a long long being read from not-eight aligned positions</span>
<a name="l00615"></a>00615 <span class="comment">         * is necessary on any modern 64bit architecture) */</span>
<a name="l00616"></a>00616         memcpy(&amp;old, &amp;bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a10faabbbf38c15a904f9c51e7edf3259">old</a>, 8);
<a name="l00617"></a>00617         bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a7b98bdbb7bb7f403933a3f0f4c0f028e">old</a> = (int) (old &gt;&gt; 3);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a0533ed8e9fed8413efd607c16d350be7">SDNAnr</a>= bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#adaaf5e01b436f464983e7ed24249e670">SDNAnr</a>;
<a name="l00620"></a>00620         bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a43e35eb83b1383841ca78ae609faa42e">nr</a>= bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#ad9a86cbddec6d7aefb12837ea3298da2">nr</a>;
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622 }
<a name="l00623"></a>00623 
<a name="l00624"></a><a class="code" href="../../d0/d12/readfile_8c.html#a0eabbebebf3ddbec0a66ea0226ebfdf6">00624</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a0eabbebebf3ddbec0a66ea0226ebfdf6">bh8_from_bh4</a>(<a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead, <a class="code" href="../../d5/dfb/structBHead4.html">BHead4</a> *bhead4)
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626     <a class="code" href="../../d1/d97/structBHead8.html">BHead8</a> *bhead8 = (<a class="code" href="../../d1/d97/structBHead8.html">BHead8</a> *) bhead;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a>= bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a>;
<a name="l00629"></a>00629     bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a492b6b8aa12499e7ad33eed0410ed2e5">len</a>= bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a28ef9af8a0d6245d012975228a79a723">len</a>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a> != <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l00632"></a>00632         bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#a10faabbbf38c15a904f9c51e7edf3259">old</a>= bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a7b98bdbb7bb7f403933a3f0f4c0f028e">old</a>;
<a name="l00633"></a>00633         bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#adaaf5e01b436f464983e7ed24249e670">SDNAnr</a>= bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a0533ed8e9fed8413efd607c16d350be7">SDNAnr</a>;
<a name="l00634"></a>00634         bhead8-&gt;<a class="code" href="../../d1/d97/structBHead8.html#ad9a86cbddec6d7aefb12837ea3298da2">nr</a>= bhead4-&gt;<a class="code" href="../../d5/dfb/structBHead4.html#a43e35eb83b1383841ca78ae609faa42e">nr</a>;
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab782b37b3bb5e8035373cbb13f238d91">00638</a> <span class="keyword">static</span> <a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *<a class="code" href="../../d0/d12/readfile_8c.html#ab782b37b3bb5e8035373cbb13f238d91">get_bhead</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l00639"></a>00639 {
<a name="l00640"></a>00640     <a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *new_bhead = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00641"></a>00641     <span class="keywordtype">int</span> readsize;
<a name="l00642"></a>00642     
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (fd) {
<a name="l00644"></a>00644         <span class="keywordflow">if</span> ( ! fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a>) {
<a name="l00645"></a>00645             <span class="comment">/* initializing to zero isn&#39;t strictly needed but shuts valgrind up</span>
<a name="l00646"></a>00646 <span class="comment">             * since uninitialized memory gets compared */</span>
<a name="l00647"></a>00647             <a class="code" href="../../d1/d97/structBHead8.html">BHead8</a> bhead8= {0};
<a name="l00648"></a>00648             <a class="code" href="../../d5/dfb/structBHead4.html">BHead4</a> bhead4= {0};
<a name="l00649"></a>00649             <a class="code" href="../../d4/d6e/structBHead.html">BHead</a>  bhead= {0};
<a name="l00650"></a>00650             
<a name="l00651"></a>00651             <span class="comment">// First read the bhead structure.</span>
<a name="l00652"></a>00652             <span class="comment">// Depending on the platform the file was written on this can</span>
<a name="l00653"></a>00653             <span class="comment">// be a big or little endian BHead4 or BHead8 structure.</span>
<a name="l00654"></a>00654 
<a name="l00655"></a>00655             <span class="comment">// As usual &#39;ENDB&#39; (the last *partial* bhead of the file)</span>
<a name="l00656"></a>00656             <span class="comment">// needs some special handling. We don&#39;t want to EOF just yet.</span>
<a name="l00657"></a>00657 
<a name="l00658"></a>00658             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ae59b18ff8b34afb7b1a2f441d1b719d9">FD_FLAGS_FILE_POINTSIZE_IS_4</a>) {
<a name="l00659"></a>00659                 bhead4.<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a> = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>;
<a name="l00660"></a>00660                 readsize = fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a>(fd, &amp;bhead4, <span class="keyword">sizeof</span>(bhead4));
<a name="l00661"></a>00661 
<a name="l00662"></a>00662                 <span class="keywordflow">if</span> (readsize == <span class="keyword">sizeof</span>(bhead4) || bhead4.<a class="code" href="../../d5/dfb/structBHead4.html#a9ee8486101ad15cf9f3b12acec366832">code</a> == <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l00663"></a>00663                     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l00664"></a>00664                         <a class="code" href="../../d0/d12/readfile_8c.html#ad28153824503843204e3dcbf06a02f95">switch_endian_bh4</a>(&amp;bhead4);
<a name="l00665"></a>00665                     }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667                     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#afeafba3909af7f67692ac0920bf555bd">FD_FLAGS_POINTSIZE_DIFFERS</a>) {
<a name="l00668"></a>00668                         <a class="code" href="../../d0/d12/readfile_8c.html#a0eabbebebf3ddbec0a66ea0226ebfdf6">bh8_from_bh4</a>(&amp;bhead, &amp;bhead4);
<a name="l00669"></a>00669                     }
<a name="l00670"></a>00670                     <span class="keywordflow">else</span> {
<a name="l00671"></a>00671                         memcpy(&amp;bhead, &amp;bhead4, <span class="keyword">sizeof</span>(bhead));
<a name="l00672"></a>00672                     }
<a name="l00673"></a>00673                 }
<a name="l00674"></a>00674                 <span class="keywordflow">else</span> {
<a name="l00675"></a>00675                     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a> = 1;
<a name="l00676"></a>00676                     bhead.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>= 0;
<a name="l00677"></a>00677                 }
<a name="l00678"></a>00678             }
<a name="l00679"></a>00679             <span class="keywordflow">else</span> {
<a name="l00680"></a>00680                 bhead8.<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a> = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>;
<a name="l00681"></a>00681                 readsize = fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a>(fd, &amp;bhead8, <span class="keyword">sizeof</span>(bhead8));
<a name="l00682"></a>00682 
<a name="l00683"></a>00683                 <span class="keywordflow">if</span> (readsize == <span class="keyword">sizeof</span>(bhead8) || bhead8.<a class="code" href="../../d1/d97/structBHead8.html#a249eee2bbdd7b04c0b4b95b945f49017">code</a> == <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l00684"></a>00684                     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l00685"></a>00685                         <a class="code" href="../../d0/d12/readfile_8c.html#add790f2bdcde99713746147bec6ad465">switch_endian_bh8</a>(&amp;bhead8);
<a name="l00686"></a>00686                     }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688                     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#afeafba3909af7f67692ac0920bf555bd">FD_FLAGS_POINTSIZE_DIFFERS</a>) {
<a name="l00689"></a>00689                         <a class="code" href="../../d0/d12/readfile_8c.html#a3dae139276f539f96b26eec44a5511f1">bh4_from_bh8</a>(&amp;bhead, &amp;bhead8, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>));
<a name="l00690"></a>00690                     }
<a name="l00691"></a>00691                     <span class="keywordflow">else</span> {
<a name="l00692"></a>00692                         memcpy(&amp;bhead, &amp;bhead8, <span class="keyword">sizeof</span>(bhead));
<a name="l00693"></a>00693                     }
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695                 <span class="keywordflow">else</span> {
<a name="l00696"></a>00696                     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a> = 1;
<a name="l00697"></a>00697                     bhead.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>= 0;
<a name="l00698"></a>00698                 }
<a name="l00699"></a>00699             }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701             <span class="comment">/* make sure people are not trying to pass bad blend files */</span>
<a name="l00702"></a>00702             <span class="keywordflow">if</span> (bhead.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a> &lt; 0) fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a> = 1;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704             <span class="comment">// bhead now contains the (converted) bhead structure. Now read</span>
<a name="l00705"></a>00705             <span class="comment">// the associated data and put everything in a BHeadN (creative naming !)</span>
<a name="l00706"></a>00706 
<a name="l00707"></a>00707             <span class="keywordflow">if</span> ( ! fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a>) {
<a name="l00708"></a>00708                 new_bhead = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a>) + bhead.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>, <span class="stringliteral">&quot;new_bhead&quot;</span>);
<a name="l00709"></a>00709                 <span class="keywordflow">if</span> (new_bhead) {
<a name="l00710"></a>00710                     new_bhead-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a2dde5ca99e158ac753b94ede6d343407">next</a> = new_bhead-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a0d41cc1620e0410f6587b69e5de7f9f4">prev</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00711"></a>00711                     new_bhead-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a97ad7ccb30834200c8b81bf899d167e0">bhead</a> = bhead;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713                     readsize = fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a>(fd, new_bhead + 1, bhead.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715                     <span class="keywordflow">if</span> (readsize != bhead.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>) {
<a name="l00716"></a>00716                         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a> = 1;
<a name="l00717"></a>00717                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(new_bhead);
<a name="l00718"></a>00718                         new_bhead = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00719"></a>00719                     }
<a name="l00720"></a>00720                 }
<a name="l00721"></a>00721                 <span class="keywordflow">else</span> {
<a name="l00722"></a>00722                     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af0430dd6cdaf6d646449c1acce966819">eof</a> = 1;
<a name="l00723"></a>00723                 }
<a name="l00724"></a>00724             }
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="comment">// We&#39;ve read a new block. Now add it to the list</span>
<a name="l00729"></a>00729     <span class="comment">// of blocks.</span>
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     <span class="keywordflow">if</span> (new_bhead) {
<a name="l00732"></a>00732         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aac634608f49f837e5399237a7272d9a1">listbase</a>, new_bhead);
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="keywordflow">return</span>(new_bhead);
<a name="l00736"></a>00736 }
<a name="l00737"></a>00737 
<a name="l00738"></a><a class="code" href="../../de/d65/readfile_8h.html#a58434e1620b03636466b700fafed81d2">00738</a> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l00739"></a>00739 {
<a name="l00740"></a>00740     <a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *new_bhead;
<a name="l00741"></a>00741     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="comment">// Rewind the file</span>
<a name="l00744"></a>00744     <span class="comment">// Read in a new block if necessary</span>
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     new_bhead = fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aac634608f49f837e5399237a7272d9a1">listbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (new_bhead == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00748"></a>00748         new_bhead = <a class="code" href="../../d0/d12/readfile_8c.html#ab782b37b3bb5e8035373cbb13f238d91">get_bhead</a>(fd);
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (new_bhead) {
<a name="l00752"></a>00752         bhead = &amp;new_bhead-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a97ad7ccb30834200c8b81bf899d167e0">bhead</a>;
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="keywordflow">return</span>(bhead);
<a name="l00756"></a>00756 }
<a name="l00757"></a>00757 
<a name="l00758"></a><a class="code" href="../../d0/d12/readfile_8c.html#a11bcec81656d8d2e65040eedb638fdaa">00758</a> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a11bcec81656d8d2e65040eedb638fdaa">blo_prevbhead</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(fd), <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *thisblock)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760     <a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *bheadn= (<a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *) (((<span class="keywordtype">char</span> *) thisblock) - <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#afe52e69b7f74d4e0319b467db917c08c">GET_INT_FROM_POINTER</a>( &amp;((<a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a>*)0)-&gt;bhead) );
<a name="l00761"></a>00761     <a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *prev= bheadn-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a0d41cc1620e0410f6587b69e5de7f9f4">prev</a>;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <span class="keywordflow">return</span> prev?&amp;prev-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a97ad7ccb30834200c8b81bf899d167e0">bhead</a>:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="../../de/d65/readfile_8h.html#aada07f0ace2d061bd20f694dd04f5991">00766</a> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *thisblock)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *new_bhead = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00769"></a>00769     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (thisblock) {
<a name="l00772"></a>00772         <span class="comment">// bhead is actually a sub part of BHeadN</span>
<a name="l00773"></a>00773         <span class="comment">// We calculate the BHeadN pointer from the BHead pointer below</span>
<a name="l00774"></a>00774         new_bhead = (<a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a> *) (((<span class="keywordtype">char</span> *) thisblock) - <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#afe52e69b7f74d4e0319b467db917c08c">GET_INT_FROM_POINTER</a>( &amp;((<a class="code" href="../../d4/d06/structBHeadN.html">BHeadN</a>*)0)-&gt;bhead) );
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="comment">// get the next BHeadN. If it doesn&#39;t exist we read in the next one</span>
<a name="l00777"></a>00777         new_bhead = new_bhead-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a2dde5ca99e158ac753b94ede6d343407">next</a>;
<a name="l00778"></a>00778         <span class="keywordflow">if</span> (new_bhead == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00779"></a>00779             new_bhead = <a class="code" href="../../d0/d12/readfile_8c.html#ab782b37b3bb5e8035373cbb13f238d91">get_bhead</a>(fd);
<a name="l00780"></a>00780         }
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="keywordflow">if</span> (new_bhead) {
<a name="l00784"></a>00784         <span class="comment">// here we do the reverse:</span>
<a name="l00785"></a>00785         <span class="comment">// go from the BHeadN pointer to the BHead pointer</span>
<a name="l00786"></a>00786         bhead = &amp;new_bhead-&gt;<a class="code" href="../../d4/d06/structBHeadN.html#a97ad7ccb30834200c8b81bf899d167e0">bhead</a>;
<a name="l00787"></a>00787     }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     <span class="keywordflow">return</span>(bhead);
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac01f40254e50238b3660e43bd197b342">00792</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac01f40254e50238b3660e43bd197b342">decode_blender_header</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794     <span class="keywordtype">char</span> header[<a class="code" href="../../de/d65/readfile_8h.html#ae39e03f24605f24fca29957966052d47">SIZEOFBLENDERHEADER</a>], num[4];
<a name="l00795"></a>00795     <span class="keywordtype">int</span> readsize;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="comment">// read in the header data</span>
<a name="l00798"></a>00798     readsize = fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a>(fd, header, <span class="keyword">sizeof</span>(header));
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="keywordflow">if</span> (readsize == <span class="keyword">sizeof</span>(header)) {
<a name="l00801"></a>00801         <span class="keywordflow">if</span> (strncmp(header, <span class="stringliteral">&quot;BLENDER&quot;</span>, 7) == 0) {
<a name="l00802"></a>00802             <span class="keywordtype">int</span> remove_this_endian_test= 1;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804             fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> |= <a class="code" href="../../de/d65/readfile_8h.html#a4acb70c5cfc49e1d8eee0741361a3bd4">FD_FLAGS_FILE_OK</a>;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806             <span class="comment">// what size are pointers in the file ?</span>
<a name="l00807"></a>00807             <span class="keywordflow">if</span> (header[7]==<span class="charliteral">&#39;_&#39;</span>) {
<a name="l00808"></a>00808                 fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> |= <a class="code" href="../../de/d65/readfile_8h.html#ae59b18ff8b34afb7b1a2f441d1b719d9">FD_FLAGS_FILE_POINTSIZE_IS_4</a>;
<a name="l00809"></a>00809                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *) != 4) {
<a name="l00810"></a>00810                     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> |= <a class="code" href="../../de/d65/readfile_8h.html#afeafba3909af7f67692ac0920bf555bd">FD_FLAGS_POINTSIZE_DIFFERS</a>;
<a name="l00811"></a>00811                 }
<a name="l00812"></a>00812             }
<a name="l00813"></a>00813             <span class="keywordflow">else</span> {
<a name="l00814"></a>00814                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *) != 8) {
<a name="l00815"></a>00815                     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> |= <a class="code" href="../../de/d65/readfile_8h.html#afeafba3909af7f67692ac0920bf555bd">FD_FLAGS_POINTSIZE_DIFFERS</a>;
<a name="l00816"></a>00816                 }
<a name="l00817"></a>00817             }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819             <span class="comment">// is the file saved in a different endian</span>
<a name="l00820"></a>00820             <span class="comment">// than we need ?</span>
<a name="l00821"></a>00821             <span class="keywordflow">if</span> (((((<span class="keywordtype">char</span>*)&amp;remove_this_endian_test)[0]==1)?<a class="code" href="../../d1/d8c/BKE__global_8h.html#a9469f350a500755bf54aa4c1a2d2388a">L_ENDIAN</a>:<a class="code" href="../../d1/d8c/BKE__global_8h.html#a497f70c46327d9156e6cf4d2d77a4500">B_ENDIAN</a>) != ((header[8]==<span class="charliteral">&#39;v&#39;</span>)?<a class="code" href="../../d1/d8c/BKE__global_8h.html#a9469f350a500755bf54aa4c1a2d2388a">L_ENDIAN</a>:B_ENDIAN)) {
<a name="l00822"></a>00822                 fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> |= <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>;
<a name="l00823"></a>00823             }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825             <span class="comment">// get the version number</span>
<a name="l00826"></a>00826 
<a name="l00827"></a>00827             memcpy(num, header+9, 3);
<a name="l00828"></a>00828             num[3] = 0;
<a name="l00829"></a>00829             fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a2b42cde3bebb0b947a06543767f620d5">fileversion</a> = atoi(num);
<a name="l00830"></a>00830         }
<a name="l00831"></a>00831     }
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00834"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac6a52196e2230c413710acd7556214c0">00834</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac6a52196e2230c413710acd7556214c0">read_file_dna</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l00835"></a>00835 {
<a name="l00836"></a>00836     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead;
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); bhead; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead)) {
<a name="l00839"></a>00839         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#af0b81c59b7165b704a231edc708875a5">DNA1</a>) {
<a name="l00840"></a>00840             <span class="keywordtype">int</span> do_endian_swap= (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a>&amp;<a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>)?1:0;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842             fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>= <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#ad2a0c183344bbd0082d10d8f7739f754">DNA_sdna_from_data</a>(&amp;bhead[1], bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>, do_endian_swap);
<a name="l00843"></a>00843             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>) {
<a name="l00844"></a>00844                 
<a name="l00845"></a>00845                 fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aef65fc3db8ea5e725f1933c9976522a9">compflags</a>= <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a15901d31265d54e81e52cb1f86fd401e">DNA_struct_get_compareflags</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a>);
<a name="l00846"></a>00846                 <span class="comment">/* used to retrieve ID names from (bhead+1) */</span>
<a name="l00847"></a>00847                 fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a40fda8eb3f6af23fc4b8fff55fcd7cec">id_name_offs</a>= <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#adefc5175e3d3a9e052574be02d5fd10d">DNA_elem_offset</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>, <span class="stringliteral">&quot;ID&quot;</span>, <span class="stringliteral">&quot;char&quot;</span>, <span class="stringliteral">&quot;name[]&quot;</span>);
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850             <span class="keywordflow">return</span> 1;
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>)
<a name="l00853"></a>00853             <span class="keywordflow">break</span>;
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="keywordflow">return</span> 0;
<a name="l00857"></a>00857 }
<a name="l00858"></a>00858 
<a name="l00859"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab61ad9663e97db266f8b9d5e6fa49996">00859</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab61ad9663e97db266f8b9d5e6fa49996">fd_read_from_file</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *filedata, <span class="keywordtype">void</span> *buffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00860"></a>00860 {
<a name="l00861"></a>00861     <span class="keywordtype">int</span> readsize = read(filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#ad5ba9af5f3d5d8f72996d36a816b9372">filedes</a>, buffer, size);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (readsize &lt; 0) {
<a name="l00864"></a>00864         readsize = EOF;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866     <span class="keywordflow">else</span> {
<a name="l00867"></a>00867         filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a> += readsize;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     <span class="keywordflow">return</span> (readsize);
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00873"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac13f162c8ef26aef5da5ac95a0c0dd49">00873</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac13f162c8ef26aef5da5ac95a0c0dd49">fd_read_gzip_from_file</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *filedata, <span class="keywordtype">void</span> *buffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00874"></a>00874 {
<a name="l00875"></a>00875     <span class="keywordtype">int</span> readsize = gzread(filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#abad0c350e8d86579fbe31e6155173de6">gzfiledes</a>, buffer, size);
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (readsize &lt; 0) {
<a name="l00878"></a>00878         readsize = EOF;
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880     <span class="keywordflow">else</span> {
<a name="l00881"></a>00881         filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a> += readsize;
<a name="l00882"></a>00882     }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     <span class="keywordflow">return</span> (readsize);
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a><a class="code" href="../../d0/d12/readfile_8c.html#aff5b8e403100fd3251280c05dc412a28">00887</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#aff5b8e403100fd3251280c05dc412a28">fd_read_from_memory</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *filedata, <span class="keywordtype">void</span> *buffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889     <span class="comment">// don&#39;t read more bytes then there are available in the buffer</span>
<a name="l00890"></a>00890     <span class="keywordtype">int</span> readsize = (int)<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(size, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#adf5d23e39de34d2cdd622409e3c312eb">buffersize</a> - filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a>));
<a name="l00891"></a>00891 
<a name="l00892"></a>00892     memcpy(buffer, filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7605e4580e682d1caee916e90765d0bb">buffer</a> + filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a>, readsize);
<a name="l00893"></a>00893     filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a> += readsize;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     <span class="keywordflow">return</span> (readsize);
<a name="l00896"></a>00896 }
<a name="l00897"></a>00897 
<a name="l00898"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab8439d398df5f4289ae2c6d5158d5083">00898</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab8439d398df5f4289ae2c6d5158d5083">fd_read_from_memfile</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *filedata, <span class="keywordtype">void</span> *buffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900     <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seek= 1&lt;&lt;30;    <span class="comment">/* the current position */</span>
<a name="l00901"></a>00901     <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset= 0;      <span class="comment">/* size of previous chunks */</span>
<a name="l00902"></a>00902     <span class="keyword">static</span> <a class="code" href="../../de/dcc/structMemFileChunk.html">MemFileChunk</a> *chunk=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00903"></a>00903     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chunkoffset, readsize, totread;
<a name="l00904"></a>00904     
<a name="l00905"></a>00905     <span class="keywordflow">if</span> (size==0) <span class="keywordflow">return</span> 0;
<a name="l00906"></a>00906     
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (seek != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a>) {
<a name="l00908"></a>00908         chunk= filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a6467e0cc2b7091ece80c86fdfba85b75">memfile</a>-&gt;<a class="code" href="../../d7/d4d/structMemFile.html#a4bb9689bf50409e227f1895ee436f590">chunks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00909"></a>00909         seek= 0;
<a name="l00910"></a>00910         
<a name="l00911"></a>00911         <span class="keywordflow">while</span> (chunk) {
<a name="l00912"></a>00912             <span class="keywordflow">if</span> (seek + chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#aac0c6f97d1907349d29ec2b9ff5668d7">size</a> &gt; (<span class="keywordtype">unsigned</span>) filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a>) <span class="keywordflow">break</span>;
<a name="l00913"></a>00913             seek+= chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#aac0c6f97d1907349d29ec2b9ff5668d7">size</a>;
<a name="l00914"></a>00914             chunk= chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#acfbcadd26265f9b24a576784d3edb6f5">next</a>;
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916         offset= seek;
<a name="l00917"></a>00917         seek= filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a>;
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919     
<a name="l00920"></a>00920     <span class="keywordflow">if</span> (chunk) {
<a name="l00921"></a>00921         totread= 0;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923         <span class="keywordflow">do</span> {
<a name="l00924"></a>00924             <span class="comment">/* first check if it&#39;s on the end if current chunk */</span>
<a name="l00925"></a>00925             <span class="keywordflow">if</span> (seek-offset == chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#aac0c6f97d1907349d29ec2b9ff5668d7">size</a>) {
<a name="l00926"></a>00926                 offset+= chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#aac0c6f97d1907349d29ec2b9ff5668d7">size</a>;
<a name="l00927"></a>00927                 chunk= chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#acfbcadd26265f9b24a576784d3edb6f5">next</a>;
<a name="l00928"></a>00928             }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930             <span class="comment">/* debug, should never happen */</span>
<a name="l00931"></a>00931             <span class="keywordflow">if</span> (chunk==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00932"></a>00932                 printf(<span class="stringliteral">&quot;illegal read, chunk zero\n&quot;</span>);
<a name="l00933"></a>00933                 <span class="keywordflow">return</span> 0;
<a name="l00934"></a>00934             }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936             chunkoffset= seek-offset;
<a name="l00937"></a>00937             readsize= size-totread;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939             <span class="comment">/* data can be spread over multiple chunks, so clamp size</span>
<a name="l00940"></a>00940 <span class="comment">             * to within this chunk, and then it will read further in</span>
<a name="l00941"></a>00941 <span class="comment">             * the next chunk */</span>
<a name="l00942"></a>00942             <span class="keywordflow">if</span> (chunkoffset+readsize &gt; chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#aac0c6f97d1907349d29ec2b9ff5668d7">size</a>)
<a name="l00943"></a>00943                 readsize= chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#aac0c6f97d1907349d29ec2b9ff5668d7">size</a>-chunkoffset;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945             memcpy((<span class="keywordtype">char</span>*)buffer+totread, chunk-&gt;<a class="code" href="../../de/dcc/structMemFileChunk.html#accd9d2b757da5926b21d9b674fc9fe91">buf</a>+chunkoffset, readsize);
<a name="l00946"></a>00946             totread += readsize;
<a name="l00947"></a>00947             filedata-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0b31525dbce07aa83fb41dd2171209d2">seek</a> += readsize;
<a name="l00948"></a>00948             seek += readsize;
<a name="l00949"></a>00949         } <span class="keywordflow">while</span> (totread &lt; size);
<a name="l00950"></a>00950         
<a name="l00951"></a>00951         <span class="keywordflow">return</span> totread;
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordflow">return</span> 0;
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a><a class="code" href="../../d0/d12/readfile_8c.html#a970260bd2fde4783885be4305f2aa0a0">00957</a> <span class="keyword">static</span> <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a970260bd2fde4783885be4305f2aa0a0">filedata_new</a>(<span class="keywordtype">void</span>)
<a name="l00958"></a>00958 {
<a name="l00959"></a>00959     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a>), <span class="stringliteral">&quot;FileData&quot;</span>);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#ad5ba9af5f3d5d8f72996d36a816b9372">filedes</a> = -1;
<a name="l00962"></a>00962     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#abad0c350e8d86579fbe31e6155173de6">gzfiledes</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         <span class="comment">/* XXX, this doesn&#39;t need to be done all the time,</span>
<a name="l00965"></a>00965 <span class="comment">         * but it keeps us re-entrant,  remove once we have</span>
<a name="l00966"></a>00966 <span class="comment">         * a lib that provides a nice lock. - zr</span>
<a name="l00967"></a>00967 <span class="comment">         */</span>
<a name="l00968"></a>00968     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a> = <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#ad2a0c183344bbd0082d10d8f7739f754">DNA_sdna_from_data</a>(<a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a062991a4dc43ce3e8c304d8dc48e315c">DNAstr</a>,  <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#aed1375e383789bb3d022e86c59958f3b">DNAlen</a>,  0);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>();
<a name="l00971"></a>00971     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a3b0e24ae0fafbe11bbf640c5e46d345c">globmap</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>();
<a name="l00972"></a>00972     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>();
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <span class="keywordflow">return</span> fd;
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a><a class="code" href="../../d0/d12/readfile_8c.html#a3f8caf22340df25ac88e92ac4d212308">00977</a> <span class="keyword">static</span> <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a3f8caf22340df25ac88e92ac4d212308">blo_decode_and_check</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979     <a class="code" href="../../d0/d12/readfile_8c.html#ac01f40254e50238b3660e43bd197b342">decode_blender_header</a>(fd);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#a4acb70c5cfc49e1d8eee0741361a3bd4">FD_FLAGS_FILE_OK</a>) {
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d12/readfile_8c.html#ac6a52196e2230c413710acd7556214c0">read_file_dna</a>(fd)) {
<a name="l00983"></a>00983             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Failed to read blend file: \&quot;%s\&quot;, incomplete&quot;</span>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>);
<a name="l00984"></a>00984             <a class="code" href="../../d0/d12/readfile_8c.html#a3ff9403e8be81e455506f3910dcf24c5">blo_freefiledata</a>(fd);
<a name="l00985"></a>00985             fd= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00986"></a>00986         }
<a name="l00987"></a>00987     } 
<a name="l00988"></a>00988     <span class="keywordflow">else</span> {
<a name="l00989"></a>00989         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Failed to read blend file: \&quot;%s\&quot;, not a blend file&quot;</span>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>);
<a name="l00990"></a>00990         <a class="code" href="../../d0/d12/readfile_8c.html#a3ff9403e8be81e455506f3910dcf24c5">blo_freefiledata</a>(fd);
<a name="l00991"></a>00991         fd= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="keywordflow">return</span> fd;
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 <span class="comment">/* cannot be called with relative paths anymore! */</span>
<a name="l00998"></a>00998 <span class="comment">/* on each new library added, it now checks for the current FileData and expands relativeness */</span>
<a name="l00999"></a><a class="code" href="../../de/d65/readfile_8h.html#a8a21fa58093e6e8e2ceff3348d5a67db">00999</a> <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a8233a740bb1c85530ee2324bb626906f">blo_openblenderfile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filepath, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l01000"></a>01000 {
<a name="l01001"></a>01001     gzFile gzfile;
<a name="l01002"></a>01002     errno= 0;
<a name="l01003"></a>01003     gzfile= <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a4fbe331d32207c2937389e1d330bd7ff">BLI_gzopen</a>(filepath, <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <span class="keywordflow">if</span> (gzfile == (gzFile)Z_NULL) {
<a name="l01006"></a>01006         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Unable to open \&quot;%s\&quot;: %s.&quot;</span>, filepath, errno ? strerror(errno) : <span class="stringliteral">&quot;Unknown error reading file&quot;</span>);
<a name="l01007"></a>01007         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01008"></a>01008     }
<a name="l01009"></a>01009     <span class="keywordflow">else</span> {
<a name="l01010"></a>01010         <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd = <a class="code" href="../../d0/d12/readfile_8c.html#a970260bd2fde4783885be4305f2aa0a0">filedata_new</a>();
<a name="l01011"></a>01011         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#abad0c350e8d86579fbe31e6155173de6">gzfiledes</a> = gzfile;
<a name="l01012"></a>01012         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a> = <a class="code" href="../../d0/d12/readfile_8c.html#ac13f162c8ef26aef5da5ac95a0c0dd49">fd_read_gzip_from_file</a>;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014         <span class="comment">/* needed for library_append and read_libraries */</span>
<a name="l01015"></a>01015         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>, filepath, <span class="keyword">sizeof</span>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>));
<a name="l01016"></a>01016 
<a name="l01017"></a>01017         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3f8caf22340df25ac88e92ac4d212308">blo_decode_and_check</a>(fd, reports);
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019 }
<a name="l01020"></a>01020 
<a name="l01021"></a><a class="code" href="../../de/d65/readfile_8h.html#a34ad3697c4a0e812df588dc4668707b8">01021</a> <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d0/d12/readfile_8c.html#aeb15404968c1035be138cc43122fd18a">blo_openblendermemory</a>(<span class="keywordtype">void</span> *mem, <span class="keywordtype">int</span> memsize, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l01022"></a>01022 {
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (!mem || memsize&lt;<a class="code" href="../../de/d65/readfile_8h.html#ae39e03f24605f24fca29957966052d47">SIZEOFBLENDERHEADER</a>) {
<a name="l01024"></a>01024         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, (mem)? <span class="stringliteral">&quot;Unable to read&quot;</span>: <span class="stringliteral">&quot;Unable to open&quot;</span>);
<a name="l01025"></a>01025         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01026"></a>01026     }
<a name="l01027"></a>01027     <span class="keywordflow">else</span> {
<a name="l01028"></a>01028         <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= <a class="code" href="../../d0/d12/readfile_8c.html#a970260bd2fde4783885be4305f2aa0a0">filedata_new</a>();
<a name="l01029"></a>01029         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7605e4580e682d1caee916e90765d0bb">buffer</a>= mem;
<a name="l01030"></a>01030         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#adf5d23e39de34d2cdd622409e3c312eb">buffersize</a>= memsize;
<a name="l01031"></a>01031         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aff5b8e403100fd3251280c05dc412a28">fd_read_from_memory</a>;
<a name="l01032"></a>01032         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a>|= <a class="code" href="../../de/d65/readfile_8h.html#a35b90a1d151ff429856989fc976fdcf5">FD_FLAGS_NOT_MY_BUFFER</a>;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3f8caf22340df25ac88e92ac4d212308">blo_decode_and_check</a>(fd, reports);
<a name="l01035"></a>01035     }
<a name="l01036"></a>01036 }
<a name="l01037"></a>01037 
<a name="l01038"></a><a class="code" href="../../de/d65/readfile_8h.html#a92a09bcf3053e23ed14f4277e322ffda">01038</a> <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a11e7895a57d01fce54292b36f9bc459b">blo_openblendermemfile</a>(<a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *memfile, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l01039"></a>01039 {
<a name="l01040"></a>01040     <span class="keywordflow">if</span> (!memfile) {
<a name="l01041"></a>01041         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Unable to open blend &lt;memory&gt;&quot;</span>);
<a name="l01042"></a>01042         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044     <span class="keywordflow">else</span> {
<a name="l01045"></a>01045         <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= <a class="code" href="../../d0/d12/readfile_8c.html#a970260bd2fde4783885be4305f2aa0a0">filedata_new</a>();
<a name="l01046"></a>01046         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a6467e0cc2b7091ece80c86fdfba85b75">memfile</a>= memfile;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a>= <a class="code" href="../../d0/d12/readfile_8c.html#ab8439d398df5f4289ae2c6d5158d5083">fd_read_from_memfile</a>;
<a name="l01049"></a>01049         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a>|= <a class="code" href="../../de/d65/readfile_8h.html#a35b90a1d151ff429856989fc976fdcf5">FD_FLAGS_NOT_MY_BUFFER</a>;
<a name="l01050"></a>01050 
<a name="l01051"></a>01051         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3f8caf22340df25ac88e92ac4d212308">blo_decode_and_check</a>(fd, reports);
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053 }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055 
<a name="l01056"></a><a class="code" href="../../de/d65/readfile_8h.html#a3ff9403e8be81e455506f3910dcf24c5">01056</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3ff9403e8be81e455506f3910dcf24c5">blo_freefiledata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01057"></a>01057 {
<a name="l01058"></a>01058     <span class="keywordflow">if</span> (fd) {
<a name="l01059"></a>01059         
<a name="l01060"></a>01060         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#ad5ba9af5f3d5d8f72996d36a816b9372">filedes</a> != -1) {
<a name="l01061"></a>01061             close(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#ad5ba9af5f3d5d8f72996d36a816b9372">filedes</a>);
<a name="l01062"></a>01062         }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#abad0c350e8d86579fbe31e6155173de6">gzfiledes</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01065"></a>01065         {
<a name="l01066"></a>01066             gzclose(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#abad0c350e8d86579fbe31e6155173de6">gzfiledes</a>);
<a name="l01067"></a>01067         }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7605e4580e682d1caee916e90765d0bb">buffer</a> &amp;&amp; !(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#a35b90a1d151ff429856989fc976fdcf5">FD_FLAGS_NOT_MY_BUFFER</a>)) {
<a name="l01070"></a>01070             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7605e4580e682d1caee916e90765d0bb">buffer</a>);
<a name="l01071"></a>01071             fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7605e4580e682d1caee916e90765d0bb">buffer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01072"></a>01072         }
<a name="l01073"></a>01073 
<a name="l01074"></a>01074         <span class="comment">// Free all BHeadN data blocks</span>
<a name="l01075"></a>01075         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aac634608f49f837e5399237a7272d9a1">listbase</a>);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a>)
<a name="l01078"></a>01078             <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a13458cebc31058b42a4f5da0b6f36831">DNA_sdna_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a>);
<a name="l01079"></a>01079         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>)
<a name="l01080"></a>01080             <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a13458cebc31058b42a4f5da0b6f36831">DNA_sdna_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>);
<a name="l01081"></a>01081         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aef65fc3db8ea5e725f1933c9976522a9">compflags</a>)
<a name="l01082"></a>01082             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aef65fc3db8ea5e725f1933c9976522a9">compflags</a>);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>)
<a name="l01085"></a>01085             <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>);
<a name="l01086"></a>01086         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a3b0e24ae0fafbe11bbf640c5e46d345c">globmap</a>)
<a name="l01087"></a>01087             <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a3b0e24ae0fafbe11bbf640c5e46d345c">globmap</a>);
<a name="l01088"></a>01088         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>)
<a name="l01089"></a>01089             <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>);
<a name="l01090"></a>01090         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>)
<a name="l01091"></a>01091             <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>);
<a name="l01092"></a>01092         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a> &amp;&amp; !(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#acea5f9ce38a912ab20e6cfedb1c51ffa">FD_FLAGS_NOT_MY_LIBMAP</a>))
<a name="l01093"></a>01093             <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>);
<a name="l01094"></a>01094         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aae8938088bb13332fa3c4a952364fb09">bheadmap</a>)
<a name="l01095"></a>01095             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aae8938088bb13332fa3c4a952364fb09">bheadmap</a>);
<a name="l01096"></a>01096         
<a name="l01097"></a>01097         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fd);
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="comment">/* ************ DIV ****************** */</span>
<a name="l01102"></a>01102 
<a name="l01103"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac4a49937696133c86c4d975109090079">01103</a> <span class="keywordtype">int</span> <a class="code" href="../../da/d01/BLO__readfile_8h.html#ac4a49937696133c86c4d975109090079">BLO_has_bfile_extension</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l01104"></a>01104 {
<a name="l01105"></a>01105     <span class="keywordflow">return</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a91f9e9d5868a3b3e5756809d6cae1a75">BLI_testextensie</a>(str, <span class="stringliteral">&quot;.ble&quot;</span>) || <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a91f9e9d5868a3b3e5756809d6cae1a75">BLI_testextensie</a>(str, <span class="stringliteral">&quot;.blend&quot;</span>) || <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a91f9e9d5868a3b3e5756809d6cae1a75">BLI_testextensie</a>(str, <span class="stringliteral">&quot;.blend.gz&quot;</span>));
<a name="l01106"></a>01106 }
<a name="l01107"></a>01107 
<a name="l01108"></a><a class="code" href="../../d0/d12/readfile_8c.html#a734b75f66a3c4492626c600820987401">01108</a> <span class="keywordtype">int</span> <a class="code" href="../../da/d01/BLO__readfile_8h.html#a734b75f66a3c4492626c600820987401">BLO_is_a_library</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">char</span> *dir, <span class="keywordtype">char</span> *group)
<a name="l01109"></a>01109 {
<a name="l01110"></a>01110     <span class="comment">/* return ok when a blenderfile, in dir is the filename,</span>
<a name="l01111"></a>01111 <span class="comment">     * in group the type of libdata</span>
<a name="l01112"></a>01112 <span class="comment">     */</span>
<a name="l01113"></a>01113     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01114"></a>01114     <span class="keywordtype">char</span> *fd;
<a name="l01115"></a>01115     
<a name="l01116"></a>01116     strcpy(dir, path);
<a name="l01117"></a>01117     len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(dir);
<a name="l01118"></a>01118     <span class="keywordflow">if</span> (len&lt;7) <span class="keywordflow">return</span> 0;
<a name="l01119"></a>01119     <span class="keywordflow">if</span> ( dir[len-1] != <span class="charliteral">&#39;/&#39;</span> &amp;&amp; dir[len-1] != <span class="charliteral">&#39;\\&#39;</span>) <span class="keywordflow">return</span> 0;
<a name="l01120"></a>01120     
<a name="l01121"></a>01121     group[0]= 0;
<a name="l01122"></a>01122     dir[len-1]= 0;
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     <span class="comment">/* Find the last slash */</span>
<a name="l01125"></a>01125     fd= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(dir);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="keywordflow">if</span> (fd==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 0;
<a name="l01128"></a>01128     *fd= 0;
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (<a class="code" href="../../da/d01/BLO__readfile_8h.html#ac4a49937696133c86c4d975109090079">BLO_has_bfile_extension</a>(fd+1)) {
<a name="l01130"></a>01130         <span class="comment">/* the last part of the dir is a .blend file, no group follows */</span>
<a name="l01131"></a>01131         *fd= <span class="charliteral">&#39;/&#39;</span>; <span class="comment">/* put back the removed slash separating the dir and the .blend file name */</span>
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133     <span class="keywordflow">else</span> {      
<a name="l01134"></a>01134         <span class="keywordtype">char</span> *gp = fd+1; <span class="comment">// in case we have a .blend file, gp points to the group</span>
<a name="l01135"></a>01135 
<a name="l01136"></a>01136         <span class="comment">/* Find the last slash */</span>
<a name="l01137"></a>01137         fd= <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a007cee68196100b8d0d2afbbfc59df23">BLI_last_slash</a>(dir);
<a name="l01138"></a>01138         <span class="keywordflow">if</span> (!fd || !<a class="code" href="../../da/d01/BLO__readfile_8h.html#ac4a49937696133c86c4d975109090079">BLO_has_bfile_extension</a>(fd+1)) <span class="keywordflow">return</span> 0;
<a name="l01139"></a>01139 
<a name="l01140"></a>01140         <span class="comment">/* now we know that we are in a blend file and it is safe to </span>
<a name="l01141"></a>01141 <span class="comment">         * assume that gp actually points to a group */</span>
<a name="l01142"></a>01142         <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;Screen&quot;</span>, gp)!=0)
<a name="l01143"></a>01143             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(group, gp, <a class="code" href="../../da/d01/BLO__readfile_8h.html#a95989cc5ea4f85340eff2b6526d0fa8c">GROUP_MAX</a>);
<a name="l01144"></a>01144     }
<a name="l01145"></a>01145     <span class="keywordflow">return</span> 1;
<a name="l01146"></a>01146 }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148 <span class="comment">/* ************** OLD POINTERS ******************* */</span>
<a name="l01149"></a>01149 
<a name="l01150"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">01150</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *adr)        <span class="comment">/* only direct databocks */</span>
<a name="l01151"></a>01151 {
<a name="l01152"></a>01152     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa3d9232651df818b271b70f8c603f766">oldnewmap_lookup_and_inc</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>, adr);
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa7ac7cf5997f2a9d284919f933a0d356">01155</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#aa7ac7cf5997f2a9d284919f933a0d356">newglobadr</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *adr)        <span class="comment">/* direct datablocks with global linking */</span>
<a name="l01156"></a>01156 {
<a name="l01157"></a>01157     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa3d9232651df818b271b70f8c603f766">oldnewmap_lookup_and_inc</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a3b0e24ae0fafbe11bbf640c5e46d345c">globmap</a>, adr);
<a name="l01158"></a>01158 }
<a name="l01159"></a>01159 
<a name="l01160"></a><a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">01160</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *adr)     <span class="comment">/* used to restore image data after undo */</span>
<a name="l01161"></a>01161 {
<a name="l01162"></a>01162     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a> &amp;&amp; adr)
<a name="l01163"></a>01163         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa3d9232651df818b271b70f8c603f766">oldnewmap_lookup_and_inc</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>, adr);
<a name="l01164"></a>01164     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01165"></a>01165 }
<a name="l01166"></a>01166 
<a name="l01167"></a><a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">01167</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *adr)              <span class="comment">/* used to restore movie clip data after undo */</span>
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a> &amp;&amp; adr)
<a name="l01170"></a>01170         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa3d9232651df818b271b70f8c603f766">oldnewmap_lookup_and_inc</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>, adr);
<a name="l01171"></a>01171     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01172"></a>01172 }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174 
<a name="l01175"></a><a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">01175</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *lib, <span class="keywordtype">void</span> *adr)      <span class="comment">/* only lib data */</span>
<a name="l01176"></a>01176 {
<a name="l01177"></a>01177     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa2c6d48e113fa2f08cc50ca7bd2a960c">oldnewmap_liblookup</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, adr, lib);
<a name="l01178"></a>01178 }
<a name="l01179"></a>01179 
<a name="l01180"></a><a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">01180</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *lib, <span class="keywordtype">void</span> *adr)   <span class="comment">/* increases user number */</span>
<a name="l01181"></a>01181 {
<a name="l01182"></a>01182     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, adr);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>)
<a name="l01185"></a>01185         <span class="keywordtype">id</span>-&gt;us++;
<a name="l01186"></a>01186 
<a name="l01187"></a>01187     <span class="keywordflow">return</span> id;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 
<a name="l01190"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9c77eadd91c9abd3ddcf046fc86f5f7e">01190</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a9c77eadd91c9abd3ddcf046fc86f5f7e">change_idid_adr_fd</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>, <span class="keywordtype">void</span> *<span class="keyword">new</span>)
<a name="l01191"></a>01191 {
<a name="l01192"></a>01192     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01193"></a>01193     
<a name="l01194"></a>01194     <span class="keywordflow">for</span> (i=0; i&lt;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>; i++) {
<a name="l01195"></a>01195         <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= &amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01196"></a>01196         
<a name="l01197"></a>01197         <span class="keywordflow">if</span> (old==entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a> &amp;&amp; entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae719dff14cceff0aafe109635eac72ea">ID_ID</a>) {
<a name="l01198"></a>01198             entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>= <span class="keyword">new</span>;
<a name="l01199"></a>01199             <span class="keywordflow">if</span> (<span class="keyword">new</span>) entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>= <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>( ((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)<span class="keyword">new</span>)-&gt;name );
<a name="l01200"></a>01200             <span class="keywordflow">break</span>;
<a name="l01201"></a>01201         }
<a name="l01202"></a>01202     }
<a name="l01203"></a>01203 }
<a name="l01204"></a>01204 
<a name="l01205"></a><a class="code" href="../../d0/d12/readfile_8c.html#a616ca91ef10e9653cca0974b62762b31">01205</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a616ca91ef10e9653cca0974b62762b31">change_idid_adr</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *basefd, <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6a/structOldNew.html#a2d8c134ad2253aaa95c769248a64125d">old</a>, <span class="keywordtype">void</span> *<span class="keyword">new</span>)
<a name="l01206"></a>01206 {
<a name="l01207"></a>01207     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainptr;
<a name="l01208"></a>01208     
<a name="l01209"></a>01209     <span class="keywordflow">for</span> (mainptr= mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; mainptr; mainptr= mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l01210"></a>01210         <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd;
<a name="l01211"></a>01211         
<a name="l01212"></a>01212         <span class="keywordflow">if</span> (mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>) fd= mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>;
<a name="l01213"></a>01213         <span class="keywordflow">else</span> fd= basefd;
<a name="l01214"></a>01214         
<a name="l01215"></a>01215         <span class="keywordflow">if</span> (fd) {
<a name="l01216"></a>01216             <a class="code" href="../../d0/d12/readfile_8c.html#a9c77eadd91c9abd3ddcf046fc86f5f7e">change_idid_adr_fd</a>(fd, old, <span class="keyword">new</span>);
<a name="l01217"></a>01217         }
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 <span class="comment">/* lib linked proxy objects point to our local data, we need</span>
<a name="l01222"></a>01222 <span class="comment"> * to clear that pointer before reading the undo memfile since</span>
<a name="l01223"></a>01223 <span class="comment"> * the object might be removed, it is set again in reading</span>
<a name="l01224"></a>01224 <span class="comment"> * if the local object still exists */</span>
<a name="l01225"></a><a class="code" href="../../de/d65/readfile_8h.html#a8b2bd59572c8c440f166a9f22a4f794e">01225</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8b2bd59572c8c440f166a9f22a4f794e">blo_clear_proxy_pointers_from_lib</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *oldmain)
<a name="l01226"></a>01226 {
<a name="l01227"></a>01227     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01228"></a>01228     
<a name="l01229"></a>01229     <span class="keywordflow">for</span> (;ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01230"></a>01230         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>)
<a name="l01231"></a>01231             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3d2c2164b03db46f65597e44ac6f9a06">proxy_from</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01232"></a>01232 }
<a name="l01233"></a>01233 
<a name="l01234"></a><a class="code" href="../../de/d65/readfile_8h.html#a864c777ced37d54256b1852472a3383e">01234</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a864c777ced37d54256b1852472a3383e">blo_make_image_pointer_map</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *oldmain)
<a name="l01235"></a>01235 {
<a name="l01236"></a>01236     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01237"></a>01237     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01238"></a>01238     <span class="keywordtype">int</span> a;
<a name="l01239"></a>01239     
<a name="l01240"></a>01240     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>();
<a name="l01241"></a>01241     
<a name="l01242"></a>01242     <span class="keywordflow">for</span> (;ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01243"></a>01243         <a class="code" href="../../df/d0c/structLink.html">Link</a> *ibuf= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01244"></a>01244         <span class="keywordflow">for</span> (; ibuf; ibuf= ibuf-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>)
<a name="l01245"></a>01245             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>, ibuf, ibuf, 0);
<a name="l01246"></a>01246         <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>)
<a name="l01247"></a>01247             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>, 0);
<a name="l01248"></a>01248         <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d2/d94/DNA__image__types_8h.html#ad925558a1ce78f2ac54939303d72f771">IMA_MAX_RENDER_SLOT</a>; a++)
<a name="l01249"></a>01249             <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[a])
<a name="l01250"></a>01250                 <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[a], ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[a], 0);
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252     <span class="keywordflow">for</span> (; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01253"></a>01253         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l01254"></a>01254             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01255"></a>01255             <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01256"></a>01256                 <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>, 0);
<a name="l01257"></a>01257         }
<a name="l01258"></a>01258     }
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 <span class="comment">/* set old main image ibufs to zero if it has been restored */</span>
<a name="l01262"></a>01262 <span class="comment">/* this works because freeing old main only happens after this call */</span>
<a name="l01263"></a><a class="code" href="../../de/d65/readfile_8h.html#abe01624fd355a9f7d18c264203609519">01263</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#abe01624fd355a9f7d18c264203609519">blo_end_image_pointer_map</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *oldmain)
<a name="l01264"></a>01264 {
<a name="l01265"></a>01265     <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>;
<a name="l01266"></a>01266     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01267"></a>01267     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01268"></a>01268     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01269"></a>01269     
<a name="l01270"></a>01270     <span class="comment">/* used entries were restored, so we put them to zero */</span>
<a name="l01271"></a>01271     <span class="keywordflow">for</span> (i=0; i&lt;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>; i++, entry++) {
<a name="l01272"></a>01272         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>&gt;0)
<a name="l01273"></a>01273             entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01274"></a>01274     }
<a name="l01275"></a>01275     
<a name="l01276"></a>01276     <span class="keywordflow">for</span> (;ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01277"></a>01277         <a class="code" href="../../df/d0c/structLink.html">Link</a> *ibuf, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01278"></a>01278         
<a name="l01279"></a>01279         <span class="comment">/* this mirrors direct_link_image */</span>
<a name="l01280"></a>01280         <span class="keywordflow">for</span> (ibuf= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ibuf; ibuf= next) {
<a name="l01281"></a>01281             next= ibuf-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>;
<a name="l01282"></a>01282             <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>==<a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, ibuf)) {    <span class="comment">/* so was restored */</span>
<a name="l01283"></a>01283                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>, ibuf);
<a name="l01284"></a>01284                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a6191ed717ab5202957a8845a97fd6e39">bindcode</a>= 0;
<a name="l01285"></a>01285                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01286"></a>01286             }
<a name="l01287"></a>01287         }
<a name="l01288"></a>01288         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d2/d94/DNA__image__types_8h.html#ad925558a1ce78f2ac54939303d72f771">IMA_MAX_RENDER_SLOT</a>; i++)
<a name="l01289"></a>01289             ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[i]= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[i]);
<a name="l01290"></a>01290 
<a name="l01291"></a>01291         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>);
<a name="l01292"></a>01292     }
<a name="l01293"></a>01293     <span class="keywordflow">for</span> (; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01294"></a>01294         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l01295"></a>01295             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01296"></a>01296             <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01297"></a>01297                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>);
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299     }
<a name="l01300"></a>01300 }
<a name="l01301"></a>01301 
<a name="l01302"></a><a class="code" href="../../de/d65/readfile_8h.html#a37c159011066050085fdfa2a47a98ee1">01302</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a37c159011066050085fdfa2a47a98ee1">blo_make_movieclip_pointer_map</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *oldmain)
<a name="l01303"></a>01303 {
<a name="l01304"></a>01304     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01305"></a>01305     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>();
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="keywordflow">for</span> (;clip; clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01310"></a>01310         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>)
<a name="l01311"></a>01311             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>, 0);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>)
<a name="l01314"></a>01314             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>, 0);
<a name="l01315"></a>01315     }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     <span class="keywordflow">for</span> (; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01318"></a>01318         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l01319"></a>01319             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01320"></a>01320             <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01321"></a>01321                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a7a7174378c79e98cd046514c9565a7b2">CMP_NODE_MOVIEDISTORTION</a>)
<a name="l01322"></a>01322                     <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>, 0);
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325 }
<a name="l01326"></a>01326 
<a name="l01327"></a>01327 <span class="comment">/* set old main movie clips caches to zero if it has been restored */</span>
<a name="l01328"></a>01328 <span class="comment">/* this works because freeing old main only happens after this call */</span>
<a name="l01329"></a><a class="code" href="../../de/d65/readfile_8h.html#abeede1294c04cae5d0d4c9e38a60192c">01329</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#abeede1294c04cae5d0d4c9e38a60192c">blo_end_movieclip_pointer_map</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *oldmain)
<a name="l01330"></a>01330 {
<a name="l01331"></a>01331     <a class="code" href="../../d7/d6a/structOldNew.html">OldNew</a> *entry= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#a994ce67cf40766a3bb70773e32bd4c00">entries</a>;
<a name="l01332"></a>01332     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01333"></a>01333     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= oldmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01334"></a>01334     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01335"></a>01335 
<a name="l01336"></a>01336     <span class="comment">/* used entries were restored, so we put them to zero */</span>
<a name="l01337"></a>01337     <span class="keywordflow">for</span> (i=0; i&lt;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>-&gt;<a class="code" href="../../d1/dac/structOldNewMap.html#aca219e44c333dff67145cb2364c45839">nentries</a>; i++, entry++) {
<a name="l01338"></a>01338         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#a556cf9683c8b6f3aa50c47df07ad6c4d">nr</a>&gt;0)
<a name="l01339"></a>01339                 entry-&gt;<a class="code" href="../../d7/d6a/structOldNew.html#aa8c5ecdb64a7d91b10bc25837294002b">newp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01340"></a>01340     }
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     <span class="keywordflow">for</span> (;clip; clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01343"></a>01343         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>);
<a name="l01344"></a>01344         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>);
<a name="l01345"></a>01345     }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347     <span class="keywordflow">for</span> (; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01348"></a>01348         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l01349"></a>01349             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01350"></a>01350             <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01351"></a>01351                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a7a7174378c79e98cd046514c9565a7b2">CMP_NODE_MOVIEDISTORTION</a>)
<a name="l01352"></a>01352                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l01353"></a>01353         }
<a name="l01354"></a>01354     }
<a name="l01355"></a>01355 }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357 
<a name="l01358"></a>01358 <span class="comment">/* undo file support: add all library pointers in lookup */</span>
<a name="l01359"></a><a class="code" href="../../de/d65/readfile_8h.html#a85783603429d9f676b58ab98b55ca46d">01359</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a85783603429d9f676b58ab98b55ca46d">blo_add_library_pointer_map</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01360"></a>01360 {
<a name="l01361"></a>01361     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *ptr= mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01362"></a>01362     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l01363"></a>01363     
<a name="l01364"></a>01364     <span class="keywordflow">for</span> (ptr= ptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>; ptr; ptr= ptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l01365"></a>01365         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(ptr, lbarray);
<a name="l01366"></a>01366         <span class="keywordflow">while</span> (i--) {
<a name="l01367"></a>01367             <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l01368"></a>01368             <span class="keywordflow">for</span> (<span class="keywordtype">id</span>= lbarray[i]-&gt;first; id; <span class="keywordtype">id</span>= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01369"></a>01369                 <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, <span class="keywordtype">id</span>, <span class="keywordtype">id</span>, <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>));
<a name="l01370"></a>01370         }
<a name="l01371"></a>01371     }
<a name="l01372"></a>01372 }
<a name="l01373"></a>01373         
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 <span class="comment">/* ********** END OLD POINTERS ****************** */</span>
<a name="l01376"></a>01376 <span class="comment">/* ********** READ FILE ****************** */</span>
<a name="l01377"></a>01377 
<a name="l01378"></a><a class="code" href="../../d0/d12/readfile_8c.html#aac6e5534119d3d40a48ae7302e0c9219">01378</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aac6e5534119d3d40a48ae7302e0c9219">switch_endian_structs</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d21/structSDNA.html">SDNA</a> *filesdna, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead)
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380     <span class="keywordtype">int</span> blocksize, nblocks;
<a name="l01381"></a>01381     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     data= (<span class="keywordtype">char</span> *)(bhead+1);
<a name="l01384"></a>01384     blocksize= filesdna-&gt;<a class="code" href="../../de/d21/structSDNA.html#a2c18fb54b5b3cb8d3e6e2c924760c12a">typelens</a>[ filesdna-&gt;<a class="code" href="../../de/d21/structSDNA.html#a7a8754dea529ccbcd709128e5d78e262">structs</a>[bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>][0] ];
<a name="l01385"></a>01385 
<a name="l01386"></a>01386     nblocks= bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a39ba4fd645b8a64764fb33e4dc504f9f">nr</a>;
<a name="l01387"></a>01387     <span class="keywordflow">while</span> (nblocks--) {
<a name="l01388"></a>01388         <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#aea1ef918f46b614bf21ca1ba6acc1214">DNA_struct_switch_endian</a>(filesdna, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>, data);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390         data+= blocksize;
<a name="l01391"></a>01391     }
<a name="l01392"></a>01392 }
<a name="l01393"></a>01393 
<a name="l01394"></a><a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">01394</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bh, <span class="keyword">const</span> <span class="keywordtype">char</span> *blockname)
<a name="l01395"></a>01395 {
<a name="l01396"></a>01396     <span class="keywordtype">void</span> *temp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     <span class="keywordflow">if</span> (bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>) {
<a name="l01399"></a>01399         <span class="comment">/* switch is based on file dna */</span>
<a name="l01400"></a>01400         <span class="keywordflow">if</span> (bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a> &amp;&amp; (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>))
<a name="l01401"></a>01401             <a class="code" href="../../d0/d12/readfile_8c.html#aac6e5534119d3d40a48ae7302e0c9219">switch_endian_structs</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>, bh);
<a name="l01402"></a>01402 
<a name="l01403"></a>01403         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aef65fc3db8ea5e725f1933c9976522a9">compflags</a>[bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>]) {    <span class="comment">/* flag==0: doesn&#39;t exist anymore */</span>
<a name="l01404"></a>01404             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aef65fc3db8ea5e725f1933c9976522a9">compflags</a>[bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>]==2) {
<a name="l01405"></a>01405                 temp= <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a75175cb5ccf0ef662c8712342ca40db1">DNA_struct_reconstruct</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aef65fc3db8ea5e725f1933c9976522a9">compflags</a>, bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>, bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a39ba4fd645b8a64764fb33e4dc504f9f">nr</a>, (bh+1));
<a name="l01406"></a>01406             }
<a name="l01407"></a>01407             <span class="keywordflow">else</span> {
<a name="l01408"></a>01408                 temp= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>, blockname);
<a name="l01409"></a>01409                 memcpy(temp, (bh+1), bh-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>);
<a name="l01410"></a>01410             }
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412     }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414     <span class="keywordflow">return</span> temp;
<a name="l01415"></a>01415 }
<a name="l01416"></a>01416 
<a name="l01417"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">01417</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)       <span class="comment">/* only direct data */</span>
<a name="l01418"></a>01418 {
<a name="l01419"></a>01419     <a class="code" href="../../df/d0c/structLink.html">Link</a> *ln, *prev;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421     <span class="keywordflow">if</span> (lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01424"></a>01424     ln= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01425"></a>01425     prev= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01426"></a>01426     <span class="keywordflow">while</span> (ln) {
<a name="l01427"></a>01427         ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>);
<a name="l01428"></a>01428         ln-&gt;<a class="code" href="../../df/d0c/structLink.html#af8440b49c460fe675ae63fed67b0a725">prev</a>= prev;
<a name="l01429"></a>01429         prev= ln;
<a name="l01430"></a>01430         ln= ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>;
<a name="l01431"></a>01431     }
<a name="l01432"></a>01432     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= prev;
<a name="l01433"></a>01433 }
<a name="l01434"></a>01434 
<a name="l01435"></a><a class="code" href="../../d0/d12/readfile_8c.html#a0dfb60f03d09ef7d48c5c1bed59aef2b">01435</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a0dfb60f03d09ef7d48c5c1bed59aef2b">link_glob_list</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)      <span class="comment">/* for glob data */</span>
<a name="l01436"></a>01436 {
<a name="l01437"></a>01437     <a class="code" href="../../df/d0c/structLink.html">Link</a> *ln, *prev;
<a name="l01438"></a>01438     <span class="keywordtype">void</span> *poin;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440     <span class="keywordflow">if</span> (lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01441"></a>01441     poin= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01442"></a>01442     <span class="keywordflow">if</span> (lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l01443"></a>01443         <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a3b0e24ae0fafbe11bbf640c5e46d345c">globmap</a>, lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, poin, 0);
<a name="l01444"></a>01444     }
<a name="l01445"></a>01445     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= poin;
<a name="l01446"></a>01446 
<a name="l01447"></a>01447     ln= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01448"></a>01448     prev= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01449"></a>01449     <span class="keywordflow">while</span> (ln) {
<a name="l01450"></a>01450         poin= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>);
<a name="l01451"></a>01451         <span class="keywordflow">if</span> (ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>) {
<a name="l01452"></a>01452             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a3b0e24ae0fafbe11bbf640c5e46d345c">globmap</a>, ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>, poin, 0);
<a name="l01453"></a>01453         }
<a name="l01454"></a>01454         ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>= poin;
<a name="l01455"></a>01455         ln-&gt;<a class="code" href="../../df/d0c/structLink.html#af8440b49c460fe675ae63fed67b0a725">prev</a>= prev;
<a name="l01456"></a>01456         prev= ln;
<a name="l01457"></a>01457         ln= ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>;
<a name="l01458"></a>01458     }
<a name="l01459"></a>01459     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= prev;
<a name="l01460"></a>01460 }
<a name="l01461"></a>01461 
<a name="l01462"></a><a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">01462</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> **mat)
<a name="l01463"></a>01463 {
<a name="l01464"></a>01464 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(FREE_WINDOWS)</span>
<a name="l01465"></a>01465 <span class="preprocessor"></span>    __int64 *lpoin, *lmat;
<a name="l01466"></a>01466 <span class="preprocessor">#else</span>
<a name="l01467"></a>01467 <span class="preprocessor"></span>    <span class="keywordtype">long</span> <span class="keywordtype">long</span> *lpoin, *lmat;
<a name="l01468"></a>01468 <span class="preprocessor">#endif</span>
<a name="l01469"></a>01469 <span class="preprocessor"></span>    <span class="keywordtype">int</span> *ipoin, *imat;
<a name="l01470"></a>01470     <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01471"></a>01471 
<a name="l01472"></a>01472         <span class="comment">/* manually convert the pointer array in</span>
<a name="l01473"></a>01473 <span class="comment">         * the old dna format to a pointer array in</span>
<a name="l01474"></a>01474 <span class="comment">         * the new dna format.</span>
<a name="l01475"></a>01475 <span class="comment">         */</span>
<a name="l01476"></a>01476     <span class="keywordflow">if</span> (*mat) {
<a name="l01477"></a>01477         len= <a class="code" href="../../da/d2b/mallocn_8c.html#a7d1e6a2f5f9d271452a168d3a637d91f">MEM_allocN_len</a>(*mat)/fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a86db45961c9edb7d99ca06e67d71c15e">pointerlen</a>;
<a name="l01478"></a>01478 
<a name="l01479"></a>01479         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a86db45961c9edb7d99ca06e67d71c15e">pointerlen</a>==8 &amp;&amp; fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a86db45961c9edb7d99ca06e67d71c15e">pointerlen</a>==4) {
<a name="l01480"></a>01480             ipoin=imat= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>( len*4, <span class="stringliteral">&quot;newmatar&quot;</span>);
<a name="l01481"></a>01481             lpoin= *mat;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483             <span class="keywordflow">while</span> (len-- &gt; 0) {
<a name="l01484"></a>01484                 <span class="keywordflow">if</span> ((fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>))
<a name="l01485"></a>01485                     <a class="code" href="../../d0/d12/readfile_8c.html#ac47a883c6487cffa79ae446ae1990895">SWITCH_LONGINT</a>(*lpoin);
<a name="l01486"></a>01486                 *ipoin= (int) ((*lpoin) &gt;&gt; 3);
<a name="l01487"></a>01487                 ipoin++;
<a name="l01488"></a>01488                 lpoin++;
<a name="l01489"></a>01489             }
<a name="l01490"></a>01490             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(*mat);
<a name="l01491"></a>01491             *mat= imat;
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a86db45961c9edb7d99ca06e67d71c15e">pointerlen</a>==4 &amp;&amp; fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aeb9212836691aae0f2d2adfc6a2ed828">memsdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a86db45961c9edb7d99ca06e67d71c15e">pointerlen</a>==8) {
<a name="l01495"></a>01495             lpoin=lmat= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>( len*8, <span class="stringliteral">&quot;newmatar&quot;</span>);
<a name="l01496"></a>01496             ipoin= *mat;
<a name="l01497"></a>01497 
<a name="l01498"></a>01498             <span class="keywordflow">while</span> (len-- &gt; 0) {
<a name="l01499"></a>01499                 *lpoin= *ipoin;
<a name="l01500"></a>01500                 ipoin++;
<a name="l01501"></a>01501                 lpoin++;
<a name="l01502"></a>01502             }
<a name="l01503"></a>01503             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(*mat);
<a name="l01504"></a>01504             *mat= lmat;
<a name="l01505"></a>01505         }
<a name="l01506"></a>01506     }
<a name="l01507"></a>01507 }
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 <span class="comment">/* ************ READ ID Properties *************** */</span>
<a name="l01510"></a>01510 
<a name="l01511"></a>01511 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">int</span> switch_endian, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd);
<a name="l01512"></a>01512 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">int</span> switch_endian, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd);
<a name="l01513"></a>01513 
<a name="l01514"></a><a class="code" href="../../d0/d12/readfile_8c.html#a275e92a0af46f21d065a8c21cac2ac67">01514</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a275e92a0af46f21d065a8c21cac2ac67">IDP_DirectLinkIDPArray</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">int</span> switch_endian, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01515"></a>01515 {
<a name="l01516"></a>01516     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *<a class="code" href="../../d2/d41/classarray.html">array</a>;
<a name="l01517"></a>01517     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     <span class="comment">/*since we didn&#39;t save the extra buffer, set totallen to len.*/</span>
<a name="l01520"></a>01520     prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#af4b217f40c89a78fcf94efdaa28df28b">totallen</a> = prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>;
<a name="l01521"></a>01521     prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523     array= (<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a>*) prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>;
<a name="l01524"></a>01524     
<a name="l01525"></a>01525     <span class="comment">/* note!, idp-arrays didn&#39;t exist in 2.4x, so the pointer will be cleared</span>
<a name="l01526"></a>01526 <span class="comment">     * theres not really anything we can do to correct this, at least don&#39;t crash */</span>
<a name="l01527"></a>01527     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (array==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01528"></a>01528         prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>= 0;
<a name="l01529"></a>01529         prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#af4b217f40c89a78fcf94efdaa28df28b">totallen</a>= 0;
<a name="l01530"></a>01530     }
<a name="l01531"></a>01531     
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     <span class="keywordflow">for</span> (i=0; i&lt;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>; i++)
<a name="l01534"></a>01534         <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(&amp;array[i], switch_endian, fd);
<a name="l01535"></a>01535 }
<a name="l01536"></a>01536 
<a name="l01537"></a><a class="code" href="../../d0/d12/readfile_8c.html#a25c7f5ebbca30814cd8e8200b34a40c5">01537</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a25c7f5ebbca30814cd8e8200b34a40c5">IDP_DirectLinkArray</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">int</span> switch_endian, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01538"></a>01538 {
<a name="l01539"></a>01539     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> **<a class="code" href="../../d2/d41/classarray.html">array</a>;
<a name="l01540"></a>01540     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542     <span class="comment">/*since we didn&#39;t save the extra buffer, set totallen to len.*/</span>
<a name="l01543"></a>01543     prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#af4b217f40c89a78fcf94efdaa28df28b">totallen</a> = prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>;
<a name="l01544"></a>01544     prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>);
<a name="l01545"></a>01545 
<a name="l01546"></a>01546     <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#aec2d0f53108c1e8d492de12472c884f9">subtype</a> == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abf4b8c1027c684282b432b3c8033a2de">IDP_GROUP</a>) {
<a name="l01547"></a>01547         <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>);
<a name="l01548"></a>01548         array= prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>;
<a name="l01549"></a>01549 
<a name="l01550"></a>01550         <span class="keywordflow">for</span> (i=0; i&lt;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>; i++)
<a name="l01551"></a>01551             <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(array[i], switch_endian, fd);
<a name="l01552"></a>01552     }
<a name="l01553"></a>01553     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#aec2d0f53108c1e8d492de12472c884f9">subtype</a> == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a40d265efbf86b4b076491f723136d25b">IDP_DOUBLE</a>) {
<a name="l01554"></a>01554         <span class="keywordflow">if</span> (switch_endian) {
<a name="l01555"></a>01555             <span class="keywordflow">for</span> (i=0; i&lt;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>; i++) {
<a name="l01556"></a>01556                 <a class="code" href="../../d0/d12/readfile_8c.html#ac47a883c6487cffa79ae446ae1990895">SWITCH_LONGINT</a>(((<span class="keywordtype">double</span>*)prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>)[i]);
<a name="l01557"></a>01557             }
<a name="l01558"></a>01558         }
<a name="l01559"></a>01559     }
<a name="l01560"></a>01560     <span class="keywordflow">else</span> {
<a name="l01561"></a>01561         <span class="keywordflow">if</span> (switch_endian) {
<a name="l01562"></a>01562             <span class="keywordflow">for</span> (i=0; i&lt;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>; i++) {
<a name="l01563"></a>01563                 <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(((<span class="keywordtype">int</span>*)prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>)[i]);
<a name="l01564"></a>01564             }
<a name="l01565"></a>01565         }
<a name="l01566"></a>01566     }
<a name="l01567"></a>01567 }
<a name="l01568"></a>01568 
<a name="l01569"></a><a class="code" href="../../d0/d12/readfile_8c.html#a7ea19aefc1ab77f40002c70afb7d9f0b">01569</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a7ea19aefc1ab77f40002c70afb7d9f0b">IDP_DirectLinkString</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01570"></a>01570 {
<a name="l01571"></a>01571     <span class="comment">/*since we didn&#39;t save the extra string buffer, set totallen to len.*/</span>
<a name="l01572"></a>01572     prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#af4b217f40c89a78fcf94efdaa28df28b">totallen</a> = prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>;
<a name="l01573"></a>01573     prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>);
<a name="l01574"></a>01574 }
<a name="l01575"></a>01575 
<a name="l01576"></a><a class="code" href="../../d0/d12/readfile_8c.html#a266f80854988534492906ca3694843ee">01576</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a266f80854988534492906ca3694843ee">IDP_DirectLinkGroup</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">int</span> switch_endian, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01577"></a>01577 {
<a name="l01578"></a>01578     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = &amp;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a656cd00581ccba5491691f77e1b5e6da">group</a>;
<a name="l01579"></a>01579     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *loop;
<a name="l01580"></a>01580 
<a name="l01581"></a>01581     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, lb);
<a name="l01582"></a>01582 
<a name="l01583"></a>01583     <span class="comment">/*Link child id properties now*/</span>
<a name="l01584"></a>01584     <span class="keywordflow">for</span> (loop=prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a656cd00581ccba5491691f77e1b5e6da">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; loop; loop=loop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a6a1233a8db3fd1ee1b07db13323b65cf">next</a>) {
<a name="l01585"></a>01585         <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(loop, switch_endian, fd);
<a name="l01586"></a>01586     }
<a name="l01587"></a>01587 }
<a name="l01588"></a>01588 
<a name="l01589"></a><a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">01589</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">int</span> switch_endian, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l01590"></a>01590 {
<a name="l01591"></a>01591     <span class="keywordflow">switch</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#afc4e09dbab4908446252e5fcb1b3c5ae">type</a>) {
<a name="l01592"></a>01592         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abf4b8c1027c684282b432b3c8033a2de">IDP_GROUP</a>:
<a name="l01593"></a>01593             <a class="code" href="../../d0/d12/readfile_8c.html#a266f80854988534492906ca3694843ee">IDP_DirectLinkGroup</a>(prop, switch_endian, fd);
<a name="l01594"></a>01594             <span class="keywordflow">break</span>;
<a name="l01595"></a>01595         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad02ddcb1c7a01492cc16b20fc6868eb6">IDP_STRING</a>:
<a name="l01596"></a>01596             <a class="code" href="../../d0/d12/readfile_8c.html#a7ea19aefc1ab77f40002c70afb7d9f0b">IDP_DirectLinkString</a>(prop, fd);
<a name="l01597"></a>01597             <span class="keywordflow">break</span>;
<a name="l01598"></a>01598         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a271555be6be919d1b73afc38fae790bb">IDP_ARRAY</a>:
<a name="l01599"></a>01599             <a class="code" href="../../d0/d12/readfile_8c.html#a25c7f5ebbca30814cd8e8200b34a40c5">IDP_DirectLinkArray</a>(prop, switch_endian, fd);
<a name="l01600"></a>01600             <span class="keywordflow">break</span>;
<a name="l01601"></a>01601         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a22b5486a9e963a270e0e59526cbba3d8">IDP_IDPARRAY</a>:
<a name="l01602"></a>01602             <a class="code" href="../../d0/d12/readfile_8c.html#a275e92a0af46f21d065a8c21cac2ac67">IDP_DirectLinkIDPArray</a>(prop, switch_endian, fd);
<a name="l01603"></a>01603             <span class="keywordflow">break</span>;
<a name="l01604"></a>01604         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a40d265efbf86b4b076491f723136d25b">IDP_DOUBLE</a>:
<a name="l01605"></a>01605             <span class="comment">/* erg, stupid doubles.  since I&#39;m storing them</span>
<a name="l01606"></a>01606 <span class="comment">             * in the same field as int val; val2 in the</span>
<a name="l01607"></a>01607 <span class="comment">             * IDPropertyData struct, they have to deal with</span>
<a name="l01608"></a>01608 <span class="comment">             * endianness specifically</span>
<a name="l01609"></a>01609 <span class="comment">             *</span>
<a name="l01610"></a>01610 <span class="comment">             * in theory, val and val2 would&#39;ve already been swapped</span>
<a name="l01611"></a>01611 <span class="comment">             * if switch_endian is true, so we have to first unswap</span>
<a name="l01612"></a>01612 <span class="comment">             * them then reswap them as a single 64-bit entity.</span>
<a name="l01613"></a>01613 <span class="comment">             */</span>
<a name="l01614"></a>01614             
<a name="l01615"></a>01615             <span class="keywordflow">if</span> (switch_endian) {
<a name="l01616"></a>01616                 <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a658749b6aeffe0cd3cd7233b9970d7d6">val</a>);
<a name="l01617"></a>01617                 <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#ab2e1977b75a63b6e208061e665e878d7">val2</a>);
<a name="l01618"></a>01618                 <a class="code" href="../../d0/d12/readfile_8c.html#ac47a883c6487cffa79ae446ae1990895">SWITCH_LONGINT</a>(prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a658749b6aeffe0cd3cd7233b9970d7d6">val</a>);
<a name="l01619"></a>01619             }
<a name="l01620"></a>01620             
<a name="l01621"></a>01621             <span class="keywordflow">break</span>;
<a name="l01622"></a>01622     }
<a name="l01623"></a>01623 }
<a name="l01624"></a>01624 
<a name="l01625"></a>01625 <span class="comment">/*stub function*/</span>
<a name="l01626"></a><a class="code" href="../../d0/d12/readfile_8c.html#acea9628e73e0dc7e782cbc594506809a">01626</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(prop), <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(switch_endian), <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(fd))
<a name="l01627"></a>01627 {
<a name="l01628"></a>01628 }
<a name="l01629"></a>01629 
<a name="l01630"></a>01630 <span class="comment">/* ************ READ CurveMapping *************** */</span>
<a name="l01631"></a>01631 
<a name="l01632"></a>01632 <span class="comment">/* cuma itself has been read! */</span>
<a name="l01633"></a><a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">01633</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap)
<a name="l01634"></a>01634 {
<a name="l01635"></a>01635     <span class="keywordtype">int</span> a;
<a name="l01636"></a>01636     
<a name="l01637"></a>01637     <span class="comment">/* flag seems to be able to hang? Maybe old files... not bad to clear anyway */</span>
<a name="l01638"></a>01638     cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> &amp;= ~<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a7cb97e9000a38ccb80a39c8cf7816466">CUMA_PREMULLED</a>;
<a name="l01639"></a>01639     
<a name="l01640"></a>01640     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a03be79f4468bc6e046fbc08cb1f3f98c">CM_TOT</a>; a++) {
<a name="l01641"></a>01641         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l01642"></a>01642         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a0223edf9524f4d5558d5e5311b25f953">table</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01643"></a>01643         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a6a3df7291fc771644d786b2b4a2294bc">premultable</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01644"></a>01644     }
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647 <span class="comment">/* ************ READ Brush *************** */</span>
<a name="l01648"></a>01648 <span class="comment">/* library brush linking after fileread */</span>
<a name="l01649"></a><a class="code" href="../../d0/d12/readfile_8c.html#aae06afcd14ed542020cffe2816ac132a">01649</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aae06afcd14ed542020cffe2816ac132a">lib_link_brush</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l01650"></a>01650 {
<a name="l01651"></a>01651     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l01652"></a>01652     
<a name="l01653"></a>01653     <span class="comment">/* only link ID pointers */</span>
<a name="l01654"></a>01654     <span class="keywordflow">for</span> (brush= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01655"></a>01655         <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l01656"></a>01656             brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l01657"></a>01657 
<a name="l01658"></a>01658             brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l01659"></a>01659             brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a15f49f4f869d830a7790726017395b31">clone</a>.<a class="code" href="../../db/d3d/structBrushClone.html#a5786aeede42c79da77f44c8a7ed27650">image</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a15f49f4f869d830a7790726017395b31">clone</a>.<a class="code" href="../../db/d3d/structBrushClone.html#a5786aeede42c79da77f44c8a7ed27650">image</a>);
<a name="l01660"></a>01660         }
<a name="l01661"></a>01661     }
<a name="l01662"></a>01662 }
<a name="l01663"></a>01663 
<a name="l01664"></a><a class="code" href="../../d0/d12/readfile_8c.html#af10943511a67b2e18b2d2546d7bea48d">01664</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af10943511a67b2e18b2d2546d7bea48d">direct_link_brush</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush)
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666     <span class="comment">/* brush itself has been read */</span>
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     <span class="comment">/* fallof curve */</span>
<a name="l01669"></a>01669     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>);
<a name="l01670"></a>01670     <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>)
<a name="l01671"></a>01671         <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>);
<a name="l01672"></a>01672     <span class="keywordflow">else</span>
<a name="l01673"></a>01673         <a class="code" href="../../da/dc9/BKE__brush_8h.html#ae1aaf97753692d574d8f1a4de609cfe6">brush_curve_preset</a>(brush, <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceac45c6b5cfc04c4b021c95fa17347f561">CURVE_PRESET_SHARP</a>);
<a name="l01674"></a>01674 
<a name="l01675"></a>01675     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aa56832257ac5b4738eb4f25ff30acf96">preview</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01676"></a>01676     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a110f0f4309616d63024d59203d4d6dc1">icon_imbuf</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01677"></a>01677 }
<a name="l01678"></a>01678 
<a name="l01679"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad22bed95cbc5ad8fd1589edf6d7e8aa0">01679</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad22bed95cbc5ad8fd1589edf6d7e8aa0">direct_link_script</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(fd), <a class="code" href="../../d7/d04/structScript.html">Script</a> *script)
<a name="l01680"></a>01680 {
<a name="l01681"></a>01681     script-&gt;<a class="code" href="../../d7/d04/structScript.html#a6df9e8aa5bb7c2f06937070e74d82666">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> = 1;
<a name="l01682"></a>01682     <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a3199962819bafde5f1e710ed447c691d">SCRIPT_SET_NULL</a>(script);
<a name="l01683"></a>01683 }
<a name="l01684"></a>01684 
<a name="l01685"></a>01685 
<a name="l01686"></a>01686 <span class="comment">/* ************ READ PACKEDFILE *************** */</span>
<a name="l01687"></a>01687 
<a name="l01688"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab47d4467d81b33a32bc7d3fe6f0244f6">01688</a> <span class="keyword">static</span> <a class="code" href="../../dd/d77/structPackedFile.html">PackedFile</a> *<a class="code" href="../../d0/d12/readfile_8c.html#ab47d4467d81b33a32bc7d3fe6f0244f6">direct_link_packedfile</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dd/d77/structPackedFile.html">PackedFile</a> *oldpf)
<a name="l01689"></a>01689 {
<a name="l01690"></a>01690     <a class="code" href="../../dd/d77/structPackedFile.html">PackedFile</a> *<a class="code" href="../../d8/d9d/gim__memory_8h.html#aa7421a08567e946189db67fbebfb88e0" title="Prefetch 64.">pf</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, oldpf);
<a name="l01691"></a>01691 
<a name="l01692"></a>01692     <span class="keywordflow">if</span> (pf) {
<a name="l01693"></a>01693         pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab26282078abf88909ab32213a4290f8e">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab26282078abf88909ab32213a4290f8e">data</a>);
<a name="l01694"></a>01694     }
<a name="l01695"></a>01695 
<a name="l01696"></a>01696     <span class="keywordflow">return</span> <a class="code" href="../../d8/d9d/gim__memory_8h.html#aa7421a08567e946189db67fbebfb88e0" title="Prefetch 64.">pf</a>;
<a name="l01697"></a>01697 }
<a name="l01698"></a>01698 
<a name="l01699"></a>01699 <span class="comment">/* ************ READ IMAGE PREVIEW *************** */</span>
<a name="l01700"></a>01700 
<a name="l01701"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">01701</a> <span class="keyword">static</span> <a class="code" href="../../df/dbe/structPreviewImage.html">PreviewImage</a> *<a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">direct_link_preview_image</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../df/dbe/structPreviewImage.html">PreviewImage</a> *old_prv)
<a name="l01702"></a>01702 {
<a name="l01703"></a>01703     <a class="code" href="../../df/dbe/structPreviewImage.html">PreviewImage</a> *prv= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, old_prv);
<a name="l01704"></a>01704 
<a name="l01705"></a>01705     <span class="keywordflow">if</span> (prv) {
<a name="l01706"></a>01706         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01707"></a>01707         <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a39ebcd2cbb072fa6eb503b8c96bebb91">NUM_ICON_SIZES</a>; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l01708"></a>01708             <span class="keywordflow">if</span> (prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[i]) {
<a name="l01709"></a>01709                 prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[i]);
<a name="l01710"></a>01710             }
<a name="l01711"></a>01711         }
<a name="l01712"></a>01712     }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714     <span class="keywordflow">return</span> prv;
<a name="l01715"></a>01715 }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717 <span class="comment">/* ************ READ ANIMATION STUFF ***************** */</span>
<a name="l01718"></a>01718 
<a name="l01719"></a>01719 <span class="comment">/* Legacy Data Support (for Version Patching) ----------------------------- */</span>
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01722"></a><a class="code" href="../../d0/d12/readfile_8c.html#afeb2fd709c0c237dbd4eb70e6636c178">01722</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#afeb2fd709c0c237dbd4eb70e6636c178">lib_link_ipo</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l01723"></a>01723 {
<a name="l01724"></a>01724     <a class="code" href="../../d2/dc5/structIpo.html">Ipo</a> *ipo;
<a name="l01725"></a>01725 
<a name="l01726"></a>01726     ipo= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a506519dfdc231b82be806d4b53a09a4c">ipo</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01727"></a>01727     <span class="keywordflow">while</span> (ipo) {
<a name="l01728"></a>01728         <span class="keywordflow">if</span> (ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a63e8c79420e9fc86a87d0bb7d1bd553c">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l01729"></a>01729             <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu;
<a name="l01730"></a>01730             <span class="keywordflow">for</span> (icu= ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; icu; icu= icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#afe828a2dd44460b47a95430528ec274d">next</a>) {
<a name="l01731"></a>01731                 <span class="keywordflow">if</span> (icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>)
<a name="l01732"></a>01732                     icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>-&gt;<a class="code" href="../../d0/d89/structIpoDriver.html#a9650006b4c72ef892c17e815f3a6c3dd">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a63e8c79420e9fc86a87d0bb7d1bd553c">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>-&gt;<a class="code" href="../../d0/d89/structIpoDriver.html#a9650006b4c72ef892c17e815f3a6c3dd">ob</a>);
<a name="l01733"></a>01733             }
<a name="l01734"></a>01734             ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a63e8c79420e9fc86a87d0bb7d1bd553c">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l01735"></a>01735         }
<a name="l01736"></a>01736         ipo= ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a63e8c79420e9fc86a87d0bb7d1bd553c">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01737"></a>01737     }
<a name="l01738"></a>01738 }
<a name="l01739"></a>01739 
<a name="l01740"></a>01740 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01741"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9c31376e4af5bb194e6639d5691f1c3f">01741</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a9c31376e4af5bb194e6639d5691f1c3f">direct_link_ipo</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d2/dc5/structIpo.html">Ipo</a> *ipo)
<a name="l01742"></a>01742 {
<a name="l01743"></a>01743     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu;
<a name="l01744"></a>01744 
<a name="l01745"></a>01745     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>));
<a name="l01746"></a>01746     icu= ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01747"></a>01747     <span class="keywordflow">while</span> (icu) {
<a name="l01748"></a>01748         icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a2c2ff134af40961c76a8f410200a77d9">bezt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a2c2ff134af40961c76a8f410200a77d9">bezt</a>);
<a name="l01749"></a>01749         icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#aa81cacaf8ab46e219b0e65eec0416a93">bp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#aa81cacaf8ab46e219b0e65eec0416a93">bp</a>);
<a name="l01750"></a>01750         icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>);
<a name="l01751"></a>01751         icu= icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#afe828a2dd44460b47a95430528ec274d">next</a>;
<a name="l01752"></a>01752     }
<a name="l01753"></a>01753 }
<a name="l01754"></a>01754 
<a name="l01755"></a>01755 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01756"></a><a class="code" href="../../d0/d12/readfile_8c.html#a50a3aa154e49a65a3d7370ff8a9b5cf7">01756</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a50a3aa154e49a65a3d7370ff8a9b5cf7">lib_link_nlastrips</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *striplist)
<a name="l01757"></a>01757 {
<a name="l01758"></a>01758     <a class="code" href="../../d5/d84/structbActionStrip.html">bActionStrip</a> *strip;
<a name="l01759"></a>01759     <a class="code" href="../../d6/d55/structbActionModifier.html">bActionModifier</a> *amod;
<a name="l01760"></a>01760     
<a name="l01761"></a>01761     <span class="keywordflow">for</span> (strip=striplist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip=strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4db006cf84d35eed981ef557bdd9f126">next</a>) {
<a name="l01762"></a>01762         strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a1c637ba51a26e1cfe1f946a75043d95e">object</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a1c637ba51a26e1cfe1f946a75043d95e">object</a>);
<a name="l01763"></a>01763         strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a357e6e808ddbfc7e09a1b9ff256c2275">act</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a357e6e808ddbfc7e09a1b9ff256c2275">act</a>);
<a name="l01764"></a>01764         strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a2f286a16ff57b174b84b4e4ab262d9f8">ipo</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a2f286a16ff57b174b84b4e4ab262d9f8">ipo</a>);
<a name="l01765"></a>01765         <span class="keywordflow">for</span> (amod= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#aa16f01023db7f917b8a9178ee7cf0268">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; amod; amod= amod-&gt;<a class="code" href="../../d6/d55/structbActionModifier.html#aa0e3dcac1921d79fe6c3512b9cc9a762">next</a>)
<a name="l01766"></a>01766             amod-&gt;<a class="code" href="../../d6/d55/structbActionModifier.html#a56596d41dbe4b9ba69a7aabd9fcbca31">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, amod-&gt;<a class="code" href="../../d6/d55/structbActionModifier.html#a56596d41dbe4b9ba69a7aabd9fcbca31">ob</a>);
<a name="l01767"></a>01767     }
<a name="l01768"></a>01768 }
<a name="l01769"></a>01769 
<a name="l01770"></a>01770 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01771"></a><a class="code" href="../../d0/d12/readfile_8c.html#a77aefc8e1a925743654726dbfd0177d8">01771</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a77aefc8e1a925743654726dbfd0177d8">direct_link_nlastrips</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *strips)
<a name="l01772"></a>01772 {
<a name="l01773"></a>01773     <a class="code" href="../../d5/d84/structbActionStrip.html">bActionStrip</a> *strip;
<a name="l01774"></a>01774     
<a name="l01775"></a>01775     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, strips);
<a name="l01776"></a>01776     
<a name="l01777"></a>01777     <span class="keywordflow">for</span> (strip= strips-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4db006cf84d35eed981ef557bdd9f126">next</a>)
<a name="l01778"></a>01778         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#aa16f01023db7f917b8a9178ee7cf0268">modifiers</a>);
<a name="l01779"></a>01779 }
<a name="l01780"></a>01780 
<a name="l01781"></a>01781 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01782"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5a4f689a7c0e9b331119e72512aecf51">01782</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5a4f689a7c0e9b331119e72512aecf51">lib_link_constraint_channels</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *chanbase)
<a name="l01783"></a>01783 {
<a name="l01784"></a>01784     <a class="code" href="../../d7/dbe/structbConstraintChannel.html">bConstraintChannel</a> *chan;
<a name="l01785"></a>01785 
<a name="l01786"></a>01786     <span class="keywordflow">for</span> (chan=chanbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; chan; chan=chan-&gt;<a class="code" href="../../d7/dbe/structbConstraintChannel.html#acac0a238b06eef93fe5ae0a1051a510b">next</a>) {
<a name="l01787"></a>01787         chan-&gt;<a class="code" href="../../d7/dbe/structbConstraintChannel.html#a45e2b4eb3c4093b7f136b0c2e7a360eb">ipo</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, chan-&gt;<a class="code" href="../../d7/dbe/structbConstraintChannel.html#a45e2b4eb3c4093b7f136b0c2e7a360eb">ipo</a>);
<a name="l01788"></a>01788     }
<a name="l01789"></a>01789 }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791 <span class="comment">/* Data Linking ----------------------------- */</span>
<a name="l01792"></a>01792 
<a name="l01793"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8bc19fb4dc498ba566e43303f372a273">01793</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8bc19fb4dc498ba566e43303f372a273">lib_link_fmodifiers</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l01794"></a>01794 {
<a name="l01795"></a>01795     <a class="code" href="../../dc/d68/structFModifier.html">FModifier</a> *fcm;
<a name="l01796"></a>01796     
<a name="l01797"></a>01797     <span class="keywordflow">for</span> (fcm= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcm; fcm= fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2b03be89329aab5401fcd674e0f2d9ca">next</a>) {
<a name="l01798"></a>01798         <span class="comment">/* data for specific modifiers */</span>
<a name="l01799"></a>01799         <span class="keywordflow">switch</span> (fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2618b2144f7498de1afe54faa6692344">type</a>) {
<a name="l01800"></a>01800             <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97baa6f502fa0bc4eaa22eea8ee09ab8df62">FMODIFIER_TYPE_PYTHON</a>:
<a name="l01801"></a>01801             {
<a name="l01802"></a>01802                 <a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l01803"></a>01803                 data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a95410af8c712f9ab5118aa9463dfebee">script</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a95410af8c712f9ab5118aa9463dfebee">script</a>);
<a name="l01804"></a>01804             }
<a name="l01805"></a>01805                 <span class="keywordflow">break</span>;
<a name="l01806"></a>01806         }
<a name="l01807"></a>01807     }
<a name="l01808"></a>01808 }
<a name="l01809"></a>01809 
<a name="l01810"></a><a class="code" href="../../d0/d12/readfile_8c.html#a540c71f477967dff209e289ffb9e9396">01810</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a540c71f477967dff209e289ffb9e9396">lib_link_fcurves</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list) 
<a name="l01811"></a>01811 {
<a name="l01812"></a>01812     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l01813"></a>01813     
<a name="l01814"></a>01814     <span class="keywordflow">if</span> (list == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01815"></a>01815         <span class="keywordflow">return</span>;
<a name="l01816"></a>01816     
<a name="l01817"></a>01817     <span class="comment">/* relink ID-block references... */</span>
<a name="l01818"></a>01818     <span class="keywordflow">for</span> (fcu= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l01819"></a>01819         <span class="comment">/* driver data */</span>
<a name="l01820"></a>01820         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>) {
<a name="l01821"></a>01821             <a class="code" href="../../d3/d1e/structChannelDriver.html">ChannelDriver</a> *driver= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>;
<a name="l01822"></a>01822             <a class="code" href="../../d1/d24/structDriverVar.html">DriverVar</a> *dvar;
<a name="l01823"></a>01823             
<a name="l01824"></a>01824             <span class="keywordflow">for</span> (dvar= driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a14d54c061db1124addaba9a6a80cce1e">variables</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dvar; dvar= dvar-&gt;<a class="code" href="../../d1/d24/structDriverVar.html#a6cbe874a49fab44dd2e2ec49b5a35da1">next</a>) {
<a name="l01825"></a>01825                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a94a8b2b8c805858b0e72e8652b5d79b6">DRIVER_TARGETS_LOOPER</a>(dvar)
<a name="l01826"></a>01826                 {   
<a name="l01827"></a>01827                     <span class="comment">/* only relink if still used */</span>
<a name="l01828"></a>01828                     <span class="keywordflow">if</span> (tarIndex &lt; dvar-&gt;num_targets)
<a name="l01829"></a>01829                         dtar-&gt;id= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, dtar-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a26257357bfced5837d7507da22f18c5a">id</a>); 
<a name="l01830"></a>01830                     <span class="keywordflow">else</span>
<a name="l01831"></a>01831                         dtar-&gt;id= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01832"></a>01832                 }
<a name="l01833"></a>01833                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ae6f978c887bc26c0da1235ccef77444b">DRIVER_TARGETS_LOOPER_END</a>
<a name="l01834"></a>01834             }
<a name="l01835"></a>01835         }
<a name="l01836"></a>01836         
<a name="l01837"></a>01837         <span class="comment">/* modifiers */</span>
<a name="l01838"></a>01838         <a class="code" href="../../d0/d12/readfile_8c.html#a8bc19fb4dc498ba566e43303f372a273">lib_link_fmodifiers</a>(fd, <span class="keywordtype">id</span>, &amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>);
<a name="l01839"></a>01839     }
<a name="l01840"></a>01840 }
<a name="l01841"></a>01841 
<a name="l01842"></a>01842 
<a name="l01843"></a>01843 <span class="comment">/* NOTE: this assumes that link_list has already been called on the list */</span>
<a name="l01844"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa74b1accde7e4be2b4848223ecb44839">01844</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa74b1accde7e4be2b4848223ecb44839">direct_link_fmodifiers</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l01845"></a>01845 {
<a name="l01846"></a>01846     <a class="code" href="../../dc/d68/structFModifier.html">FModifier</a> *fcm;
<a name="l01847"></a>01847     
<a name="l01848"></a>01848     <span class="keywordflow">for</span> (fcm= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcm; fcm= fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2b03be89329aab5401fcd674e0f2d9ca">next</a>) {
<a name="l01849"></a>01849         <span class="comment">/* relink general data */</span>
<a name="l01850"></a>01850         fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>);
<a name="l01851"></a>01851         fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a9a878718dc71ea858cc6c5c2417a2883">edata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01852"></a>01852         
<a name="l01853"></a>01853         <span class="comment">/* do relinking of data for specific types */</span>
<a name="l01854"></a>01854         <span class="keywordflow">switch</span> (fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2618b2144f7498de1afe54faa6692344">type</a>) {
<a name="l01855"></a>01855             <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba57fb312e27b01da48bd9a5eabb7bd506">FMODIFIER_TYPE_GENERATOR</a>:
<a name="l01856"></a>01856             {
<a name="l01857"></a>01857                 <a class="code" href="../../d6/d18/structFMod__Generator.html">FMod_Generator</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d6/d18/structFMod__Generator.html">FMod_Generator</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l01858"></a>01858                 
<a name="l01859"></a>01859                 data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aee6e820aad268412ab96a6f94e7bedf2">coefficients</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aee6e820aad268412ab96a6f94e7bedf2">coefficients</a>);
<a name="l01860"></a>01860 
<a name="l01861"></a>01861                 <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l01862"></a>01862                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a;
<a name="l01863"></a>01863                     <span class="keywordflow">for</span> (a = 0; a &lt; data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aa2d2e069e48310cf427bb61540504e96">arraysize</a>; a++)
<a name="l01864"></a>01864                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aee6e820aad268412ab96a6f94e7bedf2">coefficients</a>[a]);
<a name="l01865"></a>01865                 }
<a name="l01866"></a>01866             }
<a name="l01867"></a>01867                 <span class="keywordflow">break</span>;
<a name="l01868"></a>01868             <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba8375444b37911c90b1255246a0d274af">FMODIFIER_TYPE_ENVELOPE</a>:
<a name="l01869"></a>01869             {
<a name="l01870"></a>01870                 <a class="code" href="../../d4/dac/structFMod__Envelope.html">FMod_Envelope</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d4/dac/structFMod__Envelope.html">FMod_Envelope</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l01871"></a>01871                 
<a name="l01872"></a>01872                 data-&gt;<a class="code" href="../../d4/dac/structFMod__Envelope.html#a434be05786035884f0f7f78f80812e4e">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../d4/dac/structFMod__Envelope.html#a434be05786035884f0f7f78f80812e4e">data</a>);
<a name="l01873"></a>01873             }
<a name="l01874"></a>01874                 <span class="keywordflow">break</span>;
<a name="l01875"></a>01875             <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97baa6f502fa0bc4eaa22eea8ee09ab8df62">FMODIFIER_TYPE_PYTHON</a>:
<a name="l01876"></a>01876             {
<a name="l01877"></a>01877                 <a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l01878"></a>01878                 
<a name="l01879"></a>01879                 data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a740f4de69d5331dc614700920af3f767">prop</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a740f4de69d5331dc614700920af3f767">prop</a>);
<a name="l01880"></a>01880                 <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a740f4de69d5331dc614700920af3f767">prop</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l01881"></a>01881             }
<a name="l01882"></a>01882                 <span class="keywordflow">break</span>;
<a name="l01883"></a>01883         }
<a name="l01884"></a>01884     }
<a name="l01885"></a>01885 }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887 <span class="comment">/* NOTE: this assumes that link_list has already been called on the list */</span>
<a name="l01888"></a><a class="code" href="../../d0/d12/readfile_8c.html#a793fc86aac57bacf4a63a4a8419e7708">01888</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a793fc86aac57bacf4a63a4a8419e7708">direct_link_fcurves</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l01889"></a>01889 {
<a name="l01890"></a>01890     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l01891"></a>01891     
<a name="l01892"></a>01892     <span class="comment">/* link F-Curve data to F-Curve again (non ID-libs) */</span>
<a name="l01893"></a>01893     <span class="keywordflow">for</span> (fcu= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l01894"></a>01894         <span class="comment">/* curve data */</span>
<a name="l01895"></a>01895         fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>);
<a name="l01896"></a>01896         fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a568e66419fe835c1baaabb739b305e0a">fpt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a568e66419fe835c1baaabb739b305e0a">fpt</a>);
<a name="l01897"></a>01897         
<a name="l01898"></a>01898         <span class="comment">/* rna path */</span>
<a name="l01899"></a>01899         fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>);
<a name="l01900"></a>01900         
<a name="l01901"></a>01901         <span class="comment">/* group */</span>
<a name="l01902"></a>01902         fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>);
<a name="l01903"></a>01903         
<a name="l01904"></a>01904         <span class="comment">/* driver */</span>
<a name="l01905"></a>01905         fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>);
<a name="l01906"></a>01906         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>) {
<a name="l01907"></a>01907             <a class="code" href="../../d3/d1e/structChannelDriver.html">ChannelDriver</a> *driver= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>;
<a name="l01908"></a>01908             <a class="code" href="../../d1/d24/structDriverVar.html">DriverVar</a> *dvar;
<a name="l01909"></a>01909 
<a name="l01910"></a>01910             driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a72ccfa81424a06dd3f40e7b83a2ca1d8">expr_comp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01911"></a>01911             
<a name="l01912"></a>01912             <span class="comment">/* relink variables, targets and their paths */</span>
<a name="l01913"></a>01913             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a14d54c061db1124addaba9a6a80cce1e">variables</a>);
<a name="l01914"></a>01914             <span class="keywordflow">for</span> (dvar= driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a14d54c061db1124addaba9a6a80cce1e">variables</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dvar; dvar= dvar-&gt;<a class="code" href="../../d1/d24/structDriverVar.html#a6cbe874a49fab44dd2e2ec49b5a35da1">next</a>) {
<a name="l01915"></a>01915                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a94a8b2b8c805858b0e72e8652b5d79b6">DRIVER_TARGETS_LOOPER</a>(dvar)
<a name="l01916"></a>01916                 {
<a name="l01917"></a>01917                     <span class="comment">/* only relink the targets being used */</span>
<a name="l01918"></a>01918                     <span class="keywordflow">if</span> (tarIndex &lt; dvar-&gt;num_targets)
<a name="l01919"></a>01919                         dtar-&gt;rna_path= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, dtar-&gt;rna_path);
<a name="l01920"></a>01920                     <span class="keywordflow">else</span>
<a name="l01921"></a>01921                         dtar-&gt;rna_path= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01922"></a>01922                 }
<a name="l01923"></a>01923                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ae6f978c887bc26c0da1235ccef77444b">DRIVER_TARGETS_LOOPER_END</a>
<a name="l01924"></a>01924             }
<a name="l01925"></a>01925         }
<a name="l01926"></a>01926         
<a name="l01927"></a>01927         <span class="comment">/* modifiers */</span>
<a name="l01928"></a>01928         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>);
<a name="l01929"></a>01929         <a class="code" href="../../d0/d12/readfile_8c.html#aa74b1accde7e4be2b4848223ecb44839">direct_link_fmodifiers</a>(fd, &amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>);
<a name="l01930"></a>01930     }
<a name="l01931"></a>01931 }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933 
<a name="l01934"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8b8daffc2cd002c721a0c166aed44709">01934</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8b8daffc2cd002c721a0c166aed44709">lib_link_action</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l01935"></a>01935 {
<a name="l01936"></a>01936     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act;
<a name="l01937"></a>01937     <a class="code" href="../../da/d47/structbActionChannel.html">bActionChannel</a> *chan;
<a name="l01938"></a>01938 
<a name="l01939"></a>01939     <span class="keywordflow">for</span> (act= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a672d2abaa0d861f3a2d938549cbe212b">action</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01940"></a>01940         <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l01941"></a>01941             act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l01942"></a>01942             
<a name="l01943"></a>01943 <span class="comment">// XXX depreceated - old animation system &lt;&lt;&lt;</span>
<a name="l01944"></a>01944             <span class="keywordflow">for</span> (chan=act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a3d353dd48d5478f1a943612bf1ac2388">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; chan; chan=chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#a5bffc2b5bcea64ed3cfefa67496d1e4b">next</a>) {
<a name="l01945"></a>01945                 chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#abfaa53320e65308e3da97133a46bd95d">ipo</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#abfaa53320e65308e3da97133a46bd95d">ipo</a>);
<a name="l01946"></a>01946                 <a class="code" href="../../d0/d12/readfile_8c.html#a5a4f689a7c0e9b331119e72512aecf51">lib_link_constraint_channels</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>, &amp;chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#ac7fb7ef70989a9a2ee883109d9b098a3">constraintChannels</a>);
<a name="l01947"></a>01947             }
<a name="l01948"></a>01948 <span class="comment">// &gt;&gt;&gt; XXX depreceated - old animation system</span>
<a name="l01949"></a>01949             
<a name="l01950"></a>01950             <a class="code" href="../../d0/d12/readfile_8c.html#a540c71f477967dff209e289ffb9e9396">lib_link_fcurves</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l01951"></a>01951         }
<a name="l01952"></a>01952     }
<a name="l01953"></a>01953 }
<a name="l01954"></a>01954 
<a name="l01955"></a><a class="code" href="../../d0/d12/readfile_8c.html#a0eb8acb4f2e1d138367e42fa8e330490">01955</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a0eb8acb4f2e1d138367e42fa8e330490">direct_link_action</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act)
<a name="l01956"></a>01956 {
<a name="l01957"></a>01957     <a class="code" href="../../da/d47/structbActionChannel.html">bActionChannel</a> *achan; <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01958"></a>01958     <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *agrp;
<a name="l01959"></a>01959 
<a name="l01960"></a>01960     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l01961"></a>01961     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a3d353dd48d5478f1a943612bf1ac2388">chanbase</a>); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l01962"></a>01962     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a6d7358fa79f9d0feec006dd2d71c9cd4">groups</a>);
<a name="l01963"></a>01963     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae841959f9a22c79888ab355d652146ca">markers</a>);
<a name="l01964"></a>01964 
<a name="l01965"></a>01965 <span class="comment">// XXX depreceated - old animation system &lt;&lt;&lt;</span>
<a name="l01966"></a>01966     <span class="keywordflow">for</span> (achan = act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a3d353dd48d5478f1a943612bf1ac2388">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; achan; achan=achan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#a5bffc2b5bcea64ed3cfefa67496d1e4b">next</a>) {
<a name="l01967"></a>01967         achan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#a89fa1e6ccdb4e1f9fdfc75a31b37013e">grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, achan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#a89fa1e6ccdb4e1f9fdfc75a31b37013e">grp</a>);
<a name="l01968"></a>01968         
<a name="l01969"></a>01969         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;achan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#ac7fb7ef70989a9a2ee883109d9b098a3">constraintChannels</a>);
<a name="l01970"></a>01970     }
<a name="l01971"></a>01971 <span class="comment">// &gt;&gt;&gt; XXX depreceated - old animation system</span>
<a name="l01972"></a>01972 
<a name="l01973"></a>01973     <a class="code" href="../../d0/d12/readfile_8c.html#a793fc86aac57bacf4a63a4a8419e7708">direct_link_fcurves</a>(fd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l01974"></a>01974     
<a name="l01975"></a>01975     <span class="keywordflow">for</span> (agrp = act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a6d7358fa79f9d0feec006dd2d71c9cd4">groups</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; agrp; agrp= agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a572a3c6b116924498cc9d6a41c93479f">next</a>) {
<a name="l01976"></a>01976         agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01977"></a>01977         agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>);
<a name="l01978"></a>01978     }
<a name="l01979"></a>01979 }
<a name="l01980"></a>01980 
<a name="l01981"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab17fe41f26592b8ef19bd30d9e0bc97a">01981</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab17fe41f26592b8ef19bd30d9e0bc97a">lib_link_nladata_strips</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l01982"></a>01982 {
<a name="l01983"></a>01983     <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l01984"></a>01984     
<a name="l01985"></a>01985     <span class="keywordflow">for</span> (strip= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>) {
<a name="l01986"></a>01986         <span class="comment">/* check strip&#39;s children */</span>
<a name="l01987"></a>01987         <a class="code" href="../../d0/d12/readfile_8c.html#ab17fe41f26592b8ef19bd30d9e0bc97a">lib_link_nladata_strips</a>(fd, <span class="keywordtype">id</span>, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a9cc3337843773f5b953893c79784044d">strips</a>);
<a name="l01988"></a>01988         
<a name="l01989"></a>01989         <span class="comment">/* check strip&#39;s F-Curves */</span>
<a name="l01990"></a>01990         <a class="code" href="../../d0/d12/readfile_8c.html#a540c71f477967dff209e289ffb9e9396">lib_link_fcurves</a>(fd, <span class="keywordtype">id</span>, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a58b04df157b3c8b38a99ef2ac6ba7948">fcurves</a>);
<a name="l01991"></a>01991         
<a name="l01992"></a>01992         <span class="comment">/* reassign the counted-reference to action */</span>
<a name="l01993"></a>01993         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#af4a3969b3858c5536d1842f7a55f11ac">act</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#af4a3969b3858c5536d1842f7a55f11ac">act</a>);
<a name="l01994"></a>01994         
<a name="l01995"></a>01995         <span class="comment">/* fix action id-root (i.e. if it comes from a pre 2.57 .blend file) */</span>
<a name="l01996"></a>01996         <span class="keywordflow">if</span> ((strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#af4a3969b3858c5536d1842f7a55f11ac">act</a>) &amp;&amp; (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#af4a3969b3858c5536d1842f7a55f11ac">act</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> == 0))
<a name="l01997"></a>01997             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#af4a3969b3858c5536d1842f7a55f11ac">act</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> = <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l01998"></a>01998     }
<a name="l01999"></a>01999 }
<a name="l02000"></a>02000 
<a name="l02001"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad54464de7a88674342d25d66521763f3">02001</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad54464de7a88674342d25d66521763f3">lib_link_nladata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l02002"></a>02002 {
<a name="l02003"></a>02003     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt;
<a name="l02004"></a>02004     
<a name="l02005"></a>02005     <span class="comment">/* we only care about the NLA strips inside the tracks */</span>
<a name="l02006"></a>02006     <span class="keywordflow">for</span> (nlt= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nlt; nlt= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>) {
<a name="l02007"></a>02007         <a class="code" href="../../d0/d12/readfile_8c.html#ab17fe41f26592b8ef19bd30d9e0bc97a">lib_link_nladata_strips</a>(fd, <span class="keywordtype">id</span>, &amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>);
<a name="l02008"></a>02008     }
<a name="l02009"></a>02009 }
<a name="l02010"></a>02010 
<a name="l02011"></a>02011 <span class="comment">/* This handles Animato NLA-Strips linking </span>
<a name="l02012"></a>02012 <span class="comment"> * NOTE: this assumes that link_list has already been called on the list </span>
<a name="l02013"></a>02013 <span class="comment"> */</span>
<a name="l02014"></a><a class="code" href="../../d0/d12/readfile_8c.html#a37699f10dba158b672721a0f2b8ceed6">02014</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a37699f10dba158b672721a0f2b8ceed6">direct_link_nladata_strips</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l02015"></a>02015 {
<a name="l02016"></a>02016     <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l02017"></a>02017     
<a name="l02018"></a>02018     <span class="keywordflow">for</span> (strip= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>) {
<a name="l02019"></a>02019         <span class="comment">/* strip&#39;s child strips */</span>
<a name="l02020"></a>02020         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a9cc3337843773f5b953893c79784044d">strips</a>);
<a name="l02021"></a>02021         <a class="code" href="../../d0/d12/readfile_8c.html#a37699f10dba158b672721a0f2b8ceed6">direct_link_nladata_strips</a>(fd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a9cc3337843773f5b953893c79784044d">strips</a>);
<a name="l02022"></a>02022         
<a name="l02023"></a>02023         <span class="comment">/* strip&#39;s F-Curves */</span>
<a name="l02024"></a>02024         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a58b04df157b3c8b38a99ef2ac6ba7948">fcurves</a>);
<a name="l02025"></a>02025         <a class="code" href="../../d0/d12/readfile_8c.html#a793fc86aac57bacf4a63a4a8419e7708">direct_link_fcurves</a>(fd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a58b04df157b3c8b38a99ef2ac6ba7948">fcurves</a>);
<a name="l02026"></a>02026         
<a name="l02027"></a>02027         <span class="comment">/* strip&#39;s F-Modifiers */</span>
<a name="l02028"></a>02028         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ac5ddce08df422b81dfa7a65674b5b296">modifiers</a>);
<a name="l02029"></a>02029         <a class="code" href="../../d0/d12/readfile_8c.html#aa74b1accde7e4be2b4848223ecb44839">direct_link_fmodifiers</a>(fd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ac5ddce08df422b81dfa7a65674b5b296">modifiers</a>);
<a name="l02030"></a>02030     }
<a name="l02031"></a>02031 }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033 <span class="comment">/* NOTE: this assumes that link_list has already been called on the list */</span>
<a name="l02034"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5f65a822d0ef4963474a128d20ff1f38">02034</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5f65a822d0ef4963474a128d20ff1f38">direct_link_nladata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l02035"></a>02035 {
<a name="l02036"></a>02036     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt;
<a name="l02037"></a>02037     
<a name="l02038"></a>02038     <span class="keywordflow">for</span> (nlt= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nlt; nlt= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>) {
<a name="l02039"></a>02039         <span class="comment">/* relink list of strips */</span>
<a name="l02040"></a>02040         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>);
<a name="l02041"></a>02041         
<a name="l02042"></a>02042         <span class="comment">/* relink strip data */</span>
<a name="l02043"></a>02043         <a class="code" href="../../d0/d12/readfile_8c.html#a37699f10dba158b672721a0f2b8ceed6">direct_link_nladata_strips</a>(fd, &amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>);
<a name="l02044"></a>02044     }
<a name="l02045"></a>02045 }
<a name="l02046"></a>02046 
<a name="l02047"></a>02047 <span class="comment">/* ------- */</span>
<a name="l02048"></a>02048 
<a name="l02049"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6447acffc2858d1c4be0519036e1d9b8">02049</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a6447acffc2858d1c4be0519036e1d9b8">lib_link_keyingsets</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l02050"></a>02050 {
<a name="l02051"></a>02051     <a class="code" href="../../d4/d2c/structKeyingSet.html">KeyingSet</a> *ks;
<a name="l02052"></a>02052     <a class="code" href="../../dc/d37/structKS__Path.html">KS_Path</a> *ksp;
<a name="l02053"></a>02053     
<a name="l02054"></a>02054     <span class="comment">/* here, we&#39;re only interested in the ID pointer stored in some of the paths */</span>
<a name="l02055"></a>02055     <span class="keywordflow">for</span> (ks= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ks; ks= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a7ebf1a5f7b5ec817bf053a9ace717a07">next</a>) {
<a name="l02056"></a>02056         <span class="keywordflow">for</span> (ksp= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a886536223416f3dbc721fe77a43a350b">paths</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ksp; ksp= ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a1a4c3bf627d5885bdaf1cd80f27d3811">next</a>) {
<a name="l02057"></a>02057             ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a5aeacd5ecdb1482cc651db9ba8f6ebd8">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a5aeacd5ecdb1482cc651db9ba8f6ebd8">id</a>); 
<a name="l02058"></a>02058         }
<a name="l02059"></a>02059     }
<a name="l02060"></a>02060 }
<a name="l02061"></a>02061 
<a name="l02062"></a>02062 <span class="comment">/* NOTE: this assumes that link_list has already been called on the list */</span>
<a name="l02063"></a><a class="code" href="../../d0/d12/readfile_8c.html#aea0b18ce81da9358ef816b4617119e2e">02063</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aea0b18ce81da9358ef816b4617119e2e">direct_link_keyingsets</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l02064"></a>02064 {
<a name="l02065"></a>02065     <a class="code" href="../../d4/d2c/structKeyingSet.html">KeyingSet</a> *ks;
<a name="l02066"></a>02066     <a class="code" href="../../dc/d37/structKS__Path.html">KS_Path</a> *ksp;
<a name="l02067"></a>02067     
<a name="l02068"></a>02068     <span class="comment">/* link KeyingSet data to KeyingSet again (non ID-libs) */</span>
<a name="l02069"></a>02069     <span class="keywordflow">for</span> (ks= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ks; ks= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a7ebf1a5f7b5ec817bf053a9ace717a07">next</a>) {
<a name="l02070"></a>02070         <span class="comment">/* paths */</span>
<a name="l02071"></a>02071         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a886536223416f3dbc721fe77a43a350b">paths</a>);
<a name="l02072"></a>02072         
<a name="l02073"></a>02073         <span class="keywordflow">for</span> (ksp= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a886536223416f3dbc721fe77a43a350b">paths</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ksp; ksp= ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a1a4c3bf627d5885bdaf1cd80f27d3811">next</a>) {
<a name="l02074"></a>02074             <span class="comment">/* rna path */</span>
<a name="l02075"></a>02075             ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#acfb7309062d511b1d49218a26cb4c85a">rna_path</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#acfb7309062d511b1d49218a26cb4c85a">rna_path</a>);
<a name="l02076"></a>02076         }
<a name="l02077"></a>02077     }
<a name="l02078"></a>02078 }
<a name="l02079"></a>02079 
<a name="l02080"></a>02080 <span class="comment">/* ------- */</span>
<a name="l02081"></a>02081 
<a name="l02082"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">02082</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt)
<a name="l02083"></a>02083 {
<a name="l02084"></a>02084     <span class="keywordflow">if</span> (adt == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02085"></a>02085         <span class="keywordflow">return</span>;
<a name="l02086"></a>02086     
<a name="l02087"></a>02087     <span class="comment">/* link action data */</span>
<a name="l02088"></a>02088     adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>);
<a name="l02089"></a>02089     adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>);
<a name="l02090"></a>02090     
<a name="l02091"></a>02091     <span class="comment">/* fix action id-roots (i.e. if they come from a pre 2.57 .blend file) */</span>
<a name="l02092"></a>02092     <span class="keywordflow">if</span> ((adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>) &amp;&amp; (adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> == 0))
<a name="l02093"></a>02093         adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> = <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l02094"></a>02094     <span class="keywordflow">if</span> ((adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>) &amp;&amp; (adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> == 0))
<a name="l02095"></a>02095         adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> = <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l02096"></a>02096     
<a name="l02097"></a>02097     <span class="comment">/* link drivers */</span>
<a name="l02098"></a>02098     <a class="code" href="../../d0/d12/readfile_8c.html#a540c71f477967dff209e289ffb9e9396">lib_link_fcurves</a>(fd, <span class="keywordtype">id</span>, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l02099"></a>02099     
<a name="l02100"></a>02100     <span class="comment">/* overrides don&#39;t have lib-link for now, so no need to do anything */</span>
<a name="l02101"></a>02101     
<a name="l02102"></a>02102     <span class="comment">/* link NLA-data */</span>
<a name="l02103"></a>02103     <a class="code" href="../../d0/d12/readfile_8c.html#ad54464de7a88674342d25d66521763f3">lib_link_nladata</a>(fd, <span class="keywordtype">id</span>, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>);
<a name="l02104"></a>02104 }
<a name="l02105"></a>02105 
<a name="l02106"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">02106</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt)
<a name="l02107"></a>02107 {
<a name="l02108"></a>02108     <span class="comment">/* NOTE: must have called newdataadr already before doing this... */</span>
<a name="l02109"></a>02109     <span class="keywordflow">if</span> (adt == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02110"></a>02110         <span class="keywordflow">return</span>;
<a name="l02111"></a>02111     
<a name="l02112"></a>02112     <span class="comment">/* link drivers */</span>
<a name="l02113"></a>02113     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l02114"></a>02114     <a class="code" href="../../d0/d12/readfile_8c.html#a793fc86aac57bacf4a63a4a8419e7708">direct_link_fcurves</a>(fd, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l02115"></a>02115     
<a name="l02116"></a>02116     <span class="comment">/* link overrides */</span>
<a name="l02117"></a>02117     <span class="comment">// TODO...</span>
<a name="l02118"></a>02118     
<a name="l02119"></a>02119     <span class="comment">/* link NLA-data */</span>
<a name="l02120"></a>02120     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>);
<a name="l02121"></a>02121     <a class="code" href="../../d0/d12/readfile_8c.html#a5f65a822d0ef4963474a128d20ff1f38">direct_link_nladata</a>(fd, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>);
<a name="l02122"></a>02122     
<a name="l02123"></a>02123     <span class="comment">/* relink active strip - even though strictly speaking this should only be used</span>
<a name="l02124"></a>02124 <span class="comment">     * if we&#39;re in &#39;tweaking mode&#39;, we need to be able to have this loaded back for</span>
<a name="l02125"></a>02125 <span class="comment">     * undo, but also since users may not exit tweakmode before saving (#24535)</span>
<a name="l02126"></a>02126 <span class="comment">     */</span>
<a name="l02127"></a>02127     <span class="comment">// TODO: it&#39;s not really nice that anyone should be able to save the file in this</span>
<a name="l02128"></a>02128     <span class="comment">//      state, but it&#39;s going to be too hard to enforce this single case...</span>
<a name="l02129"></a>02129     adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a1b15d57a11f3d46b6c1a92d879c5a44b">actstrip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a1b15d57a11f3d46b6c1a92d879c5a44b">actstrip</a>);
<a name="l02130"></a>02130 }   
<a name="l02131"></a>02131 
<a name="l02132"></a>02132 <span class="comment">/* ************ READ MOTION PATHS *************** */</span>
<a name="l02133"></a>02133 
<a name="l02134"></a>02134 <span class="comment">/* direct data for cache */</span>
<a name="l02135"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5eed9839e354374ce7b2f9d1181297a4">02135</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5eed9839e354374ce7b2f9d1181297a4">direct_link_motionpath</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dc/d9d/structbMotionPath.html">bMotionPath</a> *mpath)
<a name="l02136"></a>02136 {
<a name="l02137"></a>02137     <span class="comment">/* sanity check */</span>
<a name="l02138"></a>02138     <span class="keywordflow">if</span> (mpath == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02139"></a>02139         <span class="keywordflow">return</span>;
<a name="l02140"></a>02140     
<a name="l02141"></a>02141     <span class="comment">/* relink points cache */</span>
<a name="l02142"></a>02142     mpath-&gt;<a class="code" href="../../dc/d9d/structbMotionPath.html#a8f9a28f56851a4cbe94dc1b75b870833">points</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mpath-&gt;<a class="code" href="../../dc/d9d/structbMotionPath.html#a8f9a28f56851a4cbe94dc1b75b870833">points</a>);
<a name="l02143"></a>02143 }
<a name="l02144"></a>02144 
<a name="l02145"></a>02145 <span class="comment">/* ************ READ NODE TREE *************** */</span>
<a name="l02146"></a>02146 
<a name="l02147"></a>02147 <span class="comment">/* singe node tree (also used for material/scene trees), ntree is not NULL */</span>
<a name="l02148"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">02148</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l02149"></a>02149 {
<a name="l02150"></a>02150     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02151"></a>02151     
<a name="l02152"></a>02152     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>);
<a name="l02153"></a>02153     
<a name="l02154"></a>02154     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a7ef055ce6415a7293a1bc5fa307dd2b5">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a7ef055ce6415a7293a1bc5fa307dd2b5">gpd</a>);
<a name="l02155"></a>02155     
<a name="l02156"></a>02156     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l02157"></a>02157         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l02158"></a>02158 }
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 <span class="comment">/* library ntree linking after fileread */</span>
<a name="l02161"></a><a class="code" href="../../d0/d12/readfile_8c.html#a83289a8bf399e4c755f5cd5589096d6d">02161</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a83289a8bf399e4c755f5cd5589096d6d">lib_link_nodetree</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l02162"></a>02162 {
<a name="l02163"></a>02163     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l02164"></a>02164     
<a name="l02165"></a>02165     <span class="comment">/* only link ID pointers */</span>
<a name="l02166"></a>02166     <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02167"></a>02167         <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02168"></a>02168             ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02169"></a>02169             <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(fd, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, ntree);
<a name="l02170"></a>02170         }
<a name="l02171"></a>02171     }
<a name="l02172"></a>02172 }
<a name="l02173"></a>02173 
<a name="l02174"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab360ec580c6b24c59389aaa3bc51f1ce">02174</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab360ec580c6b24c59389aaa3bc51f1ce">do_versions_socket_default_value</a>(<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l02175"></a>02175 {
<a name="l02176"></a>02176     <a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html">bNodeSocketValueFloat</a> *valfloat;
<a name="l02177"></a>02177     <a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html">bNodeSocketValueVector</a> *valvector;
<a name="l02178"></a>02178     <a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html">bNodeSocketValueRGBA</a> *valrgba;
<a name="l02179"></a>02179     
<a name="l02180"></a>02180     <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)
<a name="l02181"></a>02181         <span class="keywordflow">return</span>;
<a name="l02182"></a>02182     
<a name="l02183"></a>02183     <span class="keywordflow">switch</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>) {
<a name="l02184"></a>02184     <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8e6e748887f7b8c2fa267b03e905d417">SOCK_FLOAT</a>:
<a name="l02185"></a>02185         valfloat = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html">bNodeSocketValueFloat</a>), <span class="stringliteral">&quot;default socket value&quot;</span>);
<a name="l02186"></a>02186         valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#a0723d7da186a1221d1529c8e0dcfabc3">value</a> = sock-&gt;ns.vec[0];
<a name="l02187"></a>02187         valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#ae221429c176b74440bf90260651ecb65">min</a> = sock-&gt;ns.min;
<a name="l02188"></a>02188         valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#adf686cc74a4e5b2a80710b26b0a03826">max</a> = sock-&gt;ns.max;
<a name="l02189"></a>02189         valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#a4fa1ab75eb381063ba94e2145eaca5df">subtype</a> = <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca8134bae8bb64b7bab4a27a4b504f8081">PROP_NONE</a>;
<a name="l02190"></a>02190         <span class="keywordflow">break</span>;
<a name="l02191"></a>02191     <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aeeee9e5d8c1d14907a357b9fdf3ebbd6">SOCK_VECTOR</a>:
<a name="l02192"></a>02192         valvector = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html">bNodeSocketValueVector</a>), <span class="stringliteral">&quot;default socket value&quot;</span>);
<a name="l02193"></a>02193         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#a6063a02dc6fda631ffc366a4beb3eea6">value</a>, sock-&gt;ns.vec);
<a name="l02194"></a>02194         valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#a0eff35590a531b8f8863a9cb472a9013">min</a> = sock-&gt;ns.min;
<a name="l02195"></a>02195         valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#ae3721a62b3093ea625c0b46c6a370abc">max</a> = sock-&gt;ns.max;
<a name="l02196"></a>02196         valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#a1dd317692aa9d37d4d9a11a077e915e1">subtype</a> = <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca8134bae8bb64b7bab4a27a4b504f8081">PROP_NONE</a>;
<a name="l02197"></a>02197         <span class="keywordflow">break</span>;
<a name="l02198"></a>02198     <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab154e8443a228bbc7869bde335815870">SOCK_RGBA</a>:
<a name="l02199"></a>02199         valrgba = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html">bNodeSocketValueRGBA</a>), <span class="stringliteral">&quot;default socket value&quot;</span>);
<a name="l02200"></a>02200         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a097c602b13da72154b19976046f63ef3">copy_v4_v4</a>(valrgba-&gt;<a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html#aa786ca78ea273e1d4604dae181d71ab3">value</a>, sock-&gt;ns.vec);
<a name="l02201"></a>02201         <span class="keywordflow">break</span>;
<a name="l02202"></a>02202     }
<a name="l02203"></a>02203 }
<a name="l02204"></a>02204 
<a name="l02205"></a><a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">02205</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">do_versions_nodetree_default_value</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l02206"></a>02206 {
<a name="l02207"></a>02207     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02208"></a>02208     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l02209"></a>02209     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02210"></a>02210         <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02211"></a>02211             <a class="code" href="../../d0/d12/readfile_8c.html#ab360ec580c6b24c59389aaa3bc51f1ce">do_versions_socket_default_value</a>(sock);
<a name="l02212"></a>02212         <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02213"></a>02213             <a class="code" href="../../d0/d12/readfile_8c.html#ab360ec580c6b24c59389aaa3bc51f1ce">do_versions_socket_default_value</a>(sock);
<a name="l02214"></a>02214     }
<a name="l02215"></a>02215     <span class="keywordflow">for</span> (sock=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02216"></a>02216         <a class="code" href="../../d0/d12/readfile_8c.html#ab360ec580c6b24c59389aaa3bc51f1ce">do_versions_socket_default_value</a>(sock);
<a name="l02217"></a>02217     <span class="keywordflow">for</span> (sock=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02218"></a>02218         <a class="code" href="../../d0/d12/readfile_8c.html#ab360ec580c6b24c59389aaa3bc51f1ce">do_versions_socket_default_value</a>(sock);
<a name="l02219"></a>02219 }
<a name="l02220"></a>02220 
<a name="l02221"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8630b6898db079a6735330710ccb36df">02221</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8630b6898db079a6735330710ccb36df">lib_nodetree_init_types_cb</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>), <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<span class="keywordtype">id</span>), <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l02222"></a>02222 {
<a name="l02223"></a>02223     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02224"></a>02224     
<a name="l02225"></a>02225     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9e5866b70fc15f2998753843f0d45cda">ntreeInitTypes</a>(ntree);
<a name="l02226"></a>02226 
<a name="l02227"></a>02227     <span class="comment">/* need to do this here instead of in do_versions, otherwise next function can crash */</span>
<a name="l02228"></a>02228     <a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">do_versions_nodetree_default_value</a>(ntree);
<a name="l02229"></a>02229     
<a name="l02230"></a>02230     <span class="comment">/* XXX could be replaced by do_versions for new nodes */</span>
<a name="l02231"></a>02231     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l02232"></a>02232         <a class="code" href="../../da/d28/node__socket_8c.html#a1874709890dfa19474e56b48958eb68d">node_verify_socket_templates</a>(ntree, node);
<a name="l02233"></a>02233 }
<a name="l02234"></a>02234 
<a name="l02235"></a>02235 <span class="comment">/* updates group node socket own_index so that</span>
<a name="l02236"></a>02236 <span class="comment"> * external links to/from the group node are preserved.</span>
<a name="l02237"></a>02237 <span class="comment"> */</span>
<a name="l02238"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5bfb6fd88c30e30e25408c4e882e3298">02238</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5bfb6fd88c30e30e25408c4e882e3298">lib_node_do_versions_group_indices</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode)
<a name="l02239"></a>02239 {
<a name="l02240"></a>02240     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ngroup= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l02241"></a>02241     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *intnode;
<a name="l02242"></a>02242     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, *gsock, *intsock;
<a name="l02243"></a>02243     <span class="keywordtype">int</span> found;
<a name="l02244"></a>02244     
<a name="l02245"></a>02245     for (sock=gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;next) {
<a name="l02246"></a>02246         <span class="keywordtype">int</span> old_index = sock-&gt;to_index;
<a name="l02247"></a>02247         <span class="keywordflow">for</span> (gsock=ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gsock; gsock=gsock-&gt;next) {
<a name="l02248"></a>02248             <span class="keywordflow">if</span> (gsock-&gt;link &amp;&amp; gsock-&gt;link-&gt;fromsock-&gt;own_index == old_index) {
<a name="l02249"></a>02249                 sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a180004710b5b9dffd6c4e65a10a64067">own_index</a> = gsock-&gt;own_index;
<a name="l02250"></a>02250                 <span class="keywordflow">break</span>;
<a name="l02251"></a>02251             }
<a name="l02252"></a>02252         }
<a name="l02253"></a>02253     }
<a name="l02254"></a>02254     <span class="keywordflow">for</span> (sock=gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;next) {
<a name="l02255"></a>02255         <span class="keywordtype">int</span> old_index = sock-&gt;to_index;
<a name="l02256"></a>02256         <span class="comment">/* can&#39;t use break in double loop */</span>
<a name="l02257"></a>02257         found = 0;
<a name="l02258"></a>02258         <span class="keywordflow">for</span> (intnode=ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; intnode &amp;&amp; !found; intnode=intnode-&gt;next) {
<a name="l02259"></a>02259             <span class="keywordflow">for</span> (intsock=intnode-&gt;inputs.first; intsock; intsock=intsock-&gt;next) {
<a name="l02260"></a>02260                 <span class="keywordflow">if</span> (intsock-&gt;own_index == old_index &amp;&amp; intsock-&gt;link) {
<a name="l02261"></a>02261                     sock-&gt;own_index = intsock-&gt;link-&gt;fromsock-&gt;own_index;
<a name="l02262"></a>02262                     found = 1;
<a name="l02263"></a>02263                     <span class="keywordflow">break</span>;
<a name="l02264"></a>02264                 }
<a name="l02265"></a>02265             }
<a name="l02266"></a>02266         }
<a name="l02267"></a>02267     }
<a name="l02268"></a>02268 }
<a name="l02269"></a>02269 
<a name="l02270"></a>02270 <span class="comment">/* updates external links for all group nodes in a tree */</span>
<a name="l02271"></a><a class="code" href="../../d0/d12/readfile_8c.html#af7f83f628f7937077cd3527d77b7dfee">02271</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af7f83f628f7937077cd3527d77b7dfee">lib_nodetree_do_versions_group_indices_cb</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>), <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<span class="keywordtype">id</span>), <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l02272"></a>02272 {
<a name="l02273"></a>02273     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02274"></a>02274     
<a name="l02275"></a>02275     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02276"></a>02276         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>) {
<a name="l02277"></a>02277             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ngroup= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l02278"></a>02278             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ngroup &amp;&amp; (ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af587a15172ef19a8790c18899a56e66d">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a14f17fb913f9c6a7ec0a9d481524650d">NTREE_DO_VERSIONS_GROUP_EXPOSE</a>))
<a name="l02279"></a>02279                 <a class="code" href="../../d0/d12/readfile_8c.html#a5bfb6fd88c30e30e25408c4e882e3298">lib_node_do_versions_group_indices</a>(node);
<a name="l02280"></a>02280         }
<a name="l02281"></a>02281     }
<a name="l02282"></a>02282 }
<a name="l02283"></a>02283 
<a name="l02284"></a>02284 <span class="comment">/* make an update call for the tree */</span>
<a name="l02285"></a><a class="code" href="../../d0/d12/readfile_8c.html#a0238abbdbab3fa0b859e6bf96cde0287">02285</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a0238abbdbab3fa0b859e6bf96cde0287">lib_nodetree_do_versions_update_cb</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>), <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<span class="keywordtype">id</span>), <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l02286"></a>02286 {
<a name="l02287"></a>02287     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a>)
<a name="l02288"></a>02288         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ntree);
<a name="l02289"></a>02289 }
<a name="l02290"></a>02290 
<a name="l02291"></a>02291 <span class="comment">/* verify types for nodes and groups, all data has to be read */</span>
<a name="l02292"></a>02292 <span class="comment">/* open = 0: appending/linking, open = 1: open new file (need to clean out dynamic</span>
<a name="l02293"></a>02293 <span class="comment"> * typedefs */</span>
<a name="l02294"></a><a class="code" href="../../d0/d12/readfile_8c.html#af534cada95dabc774631c0383f5e92d9">02294</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af534cada95dabc774631c0383f5e92d9">lib_verify_nodetree</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(open))
<a name="l02295"></a>02295 {
<a name="l02296"></a>02296     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l02297"></a>02297     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02298"></a>02298     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype;
<a name="l02299"></a>02299 
<a name="l02300"></a>02300     <span class="comment">/* this crashes blender on undo/redo */</span>
<a name="l02301"></a>02301 <span class="preprocessor">#if 0</span>
<a name="l02302"></a>02302 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (open==1) {
<a name="l02303"></a>02303             reinit_nodesystem();
<a name="l02304"></a>02304         }
<a name="l02305"></a>02305 <span class="preprocessor">#endif</span>
<a name="l02306"></a>02306 <span class="preprocessor"></span>    
<a name="l02307"></a>02307     <span class="comment">/* set node-&gt;typeinfo pointers */</span>
<a name="l02308"></a>02308     <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a65928324ac7ecafcf0f822524c203d54">NUM_NTREE_TYPES</a>; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l02309"></a>02309         ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(i);
<a name="l02310"></a>02310         <span class="keywordflow">if</span> (ntreetype &amp;&amp; ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>)
<a name="l02311"></a>02311             ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(main, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d0/d12/readfile_8c.html#a8630b6898db079a6735330710ccb36df">lib_nodetree_init_types_cb</a>);
<a name="l02312"></a>02312     }
<a name="l02313"></a>02313     <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l02314"></a>02314         <a class="code" href="../../d0/d12/readfile_8c.html#a8630b6898db079a6735330710ccb36df">lib_nodetree_init_types_cb</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ntree);
<a name="l02315"></a>02315     
<a name="l02316"></a>02316     {
<a name="l02317"></a>02317         <span class="keywordtype">int</span> has_old_groups=0;
<a name="l02318"></a>02318         <span class="comment">/* XXX this should actually be part of do_versions, but since we need</span>
<a name="l02319"></a>02319 <span class="comment">         * finished library linking, it is not possible there. Instead in do_versions</span>
<a name="l02320"></a>02320 <span class="comment">         * we have set the NTREE_DO_VERSIONS flag, so at this point we can do the</span>
<a name="l02321"></a>02321 <span class="comment">         * actual group node updates.</span>
<a name="l02322"></a>02322 <span class="comment">         */</span>
<a name="l02323"></a>02323         <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02324"></a>02324             <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af587a15172ef19a8790c18899a56e66d">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a14f17fb913f9c6a7ec0a9d481524650d">NTREE_DO_VERSIONS_GROUP_EXPOSE</a>) {
<a name="l02325"></a>02325                 <span class="comment">/* this adds copies and links from all unlinked internal sockets to group inputs/outputs. */</span>
<a name="l02326"></a>02326                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a0c74d257a96ea12a81a89f3159ea1f1f">node_group_expose_all_sockets</a>(ntree);
<a name="l02327"></a>02327                 has_old_groups = 1;
<a name="l02328"></a>02328             }
<a name="l02329"></a>02329         }
<a name="l02330"></a>02330         
<a name="l02331"></a>02331         <span class="keywordflow">if</span> (has_old_groups) {
<a name="l02332"></a>02332             <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a65928324ac7ecafcf0f822524c203d54">NUM_NTREE_TYPES</a>; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l02333"></a>02333                 ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(i);
<a name="l02334"></a>02334                 <span class="keywordflow">if</span> (ntreetype &amp;&amp; ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>)
<a name="l02335"></a>02335                     ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(main, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d0/d12/readfile_8c.html#af7f83f628f7937077cd3527d77b7dfee">lib_nodetree_do_versions_group_indices_cb</a>);
<a name="l02336"></a>02336             }
<a name="l02337"></a>02337         }
<a name="l02338"></a>02338         
<a name="l02339"></a>02339         <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l02340"></a>02340             ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af587a15172ef19a8790c18899a56e66d">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a14f17fb913f9c6a7ec0a9d481524650d">NTREE_DO_VERSIONS_GROUP_EXPOSE</a>;
<a name="l02341"></a>02341     }
<a name="l02342"></a>02342     
<a name="l02343"></a>02343     <span class="comment">/* verify all group user nodes */</span>
<a name="l02344"></a>02344     <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02345"></a>02345         <a class="code" href="../../d4/d91/BKE__node_8h.html#ab5d78a913dc12958e7b6247e903de568">ntreeVerifyNodes</a>(main, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>);
<a name="l02346"></a>02346     }
<a name="l02347"></a>02347     
<a name="l02348"></a>02348     <span class="comment">/* make update calls where necessary */</span>
<a name="l02349"></a>02349     {
<a name="l02350"></a>02350         <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l02351"></a>02351             <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a>)
<a name="l02352"></a>02352                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ntree);
<a name="l02353"></a>02353 
<a name="l02354"></a>02354         <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a65928324ac7ecafcf0f822524c203d54">NUM_NTREE_TYPES</a>; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l02355"></a>02355             ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(i);
<a name="l02356"></a>02356             <span class="keywordflow">if</span> (ntreetype &amp;&amp; ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>)
<a name="l02357"></a>02357                 ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(main, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d0/d12/readfile_8c.html#a0238abbdbab3fa0b859e6bf96cde0287">lib_nodetree_do_versions_update_cb</a>);
<a name="l02358"></a>02358         }
<a name="l02359"></a>02359     }
<a name="l02360"></a>02360 }
<a name="l02361"></a>02361 
<a name="l02362"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad71475fd292c97f1d79c7b56e8263690">02362</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad71475fd292c97f1d79c7b56e8263690">direct_link_node_socket</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l02363"></a>02363 {
<a name="l02364"></a>02364     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>);
<a name="l02365"></a>02365     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a16dd98d87c594f25bb0676986a13dd9e">storage</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a16dd98d87c594f25bb0676986a13dd9e">storage</a>);
<a name="l02366"></a>02366     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l02367"></a>02367     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02368"></a>02368 }
<a name="l02369"></a>02369 
<a name="l02370"></a>02370 <span class="comment">/* ntree itself has been read! */</span>
<a name="l02371"></a><a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">02371</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l02372"></a>02372 {
<a name="l02373"></a>02373     <span class="comment">/* note: writing and reading goes in sync, for speed */</span>
<a name="l02374"></a>02374     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02375"></a>02375     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l02376"></a>02376     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02377"></a>02377     
<a name="l02378"></a>02378     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ab59922f6b4bcc1b20e121e0fa6b69a4c">init</a>= 0;     <span class="comment">/* to set callbacks and force setting types */</span>
<a name="l02379"></a>02379     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac9e0ac3502eccbd86f1b149c9a7669ea">progress</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02380"></a>02380     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02381"></a>02381     
<a name="l02382"></a>02382     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>);
<a name="l02383"></a>02383     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>);
<a name="l02384"></a>02384     
<a name="l02385"></a>02385     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>);
<a name="l02386"></a>02386     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02387"></a>02387         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#a2c68ef059534ec7a55087732345e875e">NODE_DYNAMIC</a>) {
<a name="l02388"></a>02388             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>= 0;
<a name="l02389"></a>02389             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>= <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aa780ffba96f87df4c8ab81c6de690594">NODE_DYNAMIC_LOADED</a>);
<a name="l02390"></a>02390         }
<a name="l02391"></a>02391 
<a name="l02392"></a>02392         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02393"></a>02393         
<a name="l02394"></a>02394         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>);
<a name="l02395"></a>02395         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>);
<a name="l02396"></a>02396         
<a name="l02397"></a>02397         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a7a7174378c79e98cd046514c9565a7b2">CMP_NODE_MOVIEDISTORTION</a>) {
<a name="l02398"></a>02398             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l02399"></a>02399         }
<a name="l02400"></a>02400         <span class="keywordflow">else</span>
<a name="l02401"></a>02401             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l02402"></a>02402 
<a name="l02403"></a>02403         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>) {
<a name="l02404"></a>02404             <span class="comment">/* could be handlerized at some point */</span>
<a name="l02405"></a>02405             <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a685d54959d3865af92b2902f073a38a5">SH_NODE_CURVE_VEC</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab4d352843431523db9be44e241247029">SH_NODE_CURVE_RGB</a>))
<a name="l02406"></a>02406                 <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l02407"></a>02407             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l02408"></a>02408                 <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a938bbac603bea1f1790cfe6ec45ce121">CMP_NODE_TIME</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a837e7c0b2a241e438be5cbd6dc0d16d0">CMP_NODE_CURVE_VEC</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aa32ec823eb8b629ad8adcd886553bf49">CMP_NODE_CURVE_RGB</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a6f5bd8f57b461853c73f9c740e254de0">CMP_NODE_HUECORRECT</a>))
<a name="l02409"></a>02409                     <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l02410"></a>02410                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>))
<a name="l02411"></a>02411                     ((<a class="code" href="../../de/d31/structImageUser.html">ImageUser</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>)-&gt;ok= 1;
<a name="l02412"></a>02412             }
<a name="l02413"></a>02413             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>) {
<a name="l02414"></a>02414                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a09e4e447d3a445a4256fee63e6e58047">TEX_NODE_CURVE_RGB</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ac5181d9fdffdb83ef75531cc878b0722">TEX_NODE_CURVE_TIME</a>)
<a name="l02415"></a>02415                     <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l02416"></a>02416                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a93c4ae48bb8d648610cfe6eb0f00e38c">TEX_NODE_IMAGE</a>)
<a name="l02417"></a>02417                     ((<a class="code" href="../../de/d31/structImageUser.html">ImageUser</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>)-&gt;ok= 1;
<a name="l02418"></a>02418             }
<a name="l02419"></a>02419         }
<a name="l02420"></a>02420     }
<a name="l02421"></a>02421     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>);
<a name="l02422"></a>02422     
<a name="l02423"></a>02423     <span class="comment">/* external sockets */</span>
<a name="l02424"></a>02424     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>);
<a name="l02425"></a>02425     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>);
<a name="l02426"></a>02426     
<a name="l02427"></a>02427     <span class="comment">/* and we connect the rest */</span>
<a name="l02428"></a>02428     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02429"></a>02429         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>);
<a name="l02430"></a>02430         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>);
<a name="l02431"></a>02431         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4a3a2a511730b64f4dbf8a3246cffd70">lasty</a>= 0;
<a name="l02432"></a>02432         
<a name="l02433"></a>02433         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02434"></a>02434             <a class="code" href="../../d0/d12/readfile_8c.html#ad71475fd292c97f1d79c7b56e8263690">direct_link_node_socket</a>(fd, sock);
<a name="l02435"></a>02435         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02436"></a>02436             <a class="code" href="../../d0/d12/readfile_8c.html#ad71475fd292c97f1d79c7b56e8263690">direct_link_node_socket</a>(fd, sock);
<a name="l02437"></a>02437     }
<a name="l02438"></a>02438     <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02439"></a>02439         <a class="code" href="../../d0/d12/readfile_8c.html#ad71475fd292c97f1d79c7b56e8263690">direct_link_node_socket</a>(fd, sock);
<a name="l02440"></a>02440     <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02441"></a>02441         <a class="code" href="../../d0/d12/readfile_8c.html#ad71475fd292c97f1d79c7b56e8263690">direct_link_node_socket</a>(fd, sock);
<a name="l02442"></a>02442     
<a name="l02443"></a>02443     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02444"></a>02444         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>);
<a name="l02445"></a>02445         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>);
<a name="l02446"></a>02446         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>);
<a name="l02447"></a>02447         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>);
<a name="l02448"></a>02448     }
<a name="l02449"></a>02449     
<a name="l02450"></a>02450     <span class="comment">/* type verification is in lib-link */</span>
<a name="l02451"></a>02451 }
<a name="l02452"></a>02452 
<a name="l02453"></a>02453 <span class="comment">/* ************ READ ARMATURE ***************** */</span>
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 <span class="comment">/* temp struct used to transport needed info to lib_link_constraint_cb() */</span>
<a name="l02456"></a><a class="code" href="../../d1/dfe/structtConstraintLinkData.html">02456</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/dfe/structtConstraintLinkData.html">tConstraintLinkData</a> {
<a name="l02457"></a><a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a505e20dcb14f74c6dc61379b3501da4a">02457</a>     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a505e20dcb14f74c6dc61379b3501da4a">fd</a>;
<a name="l02458"></a><a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a979f99d2f196b1de182282f2c9206595">02458</a>     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a979f99d2f196b1de182282f2c9206595">id</a>;
<a name="l02459"></a>02459 } <a class="code" href="../../d0/d12/readfile_8c.html#a75c0a22db280d5a266862221f37796e3">tConstraintLinkData</a>;
<a name="l02460"></a>02460 <span class="comment">/* callback function used to relink constraint ID-links */</span>
<a name="l02461"></a><a class="code" href="../../d0/d12/readfile_8c.html#a05d4e5d44e7d9aa0ee64e736cae45007">02461</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a05d4e5d44e7d9aa0ee64e736cae45007">lib_link_constraint_cb</a>(<a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(con), <a class="code" href="../../d8/d7e/structID.html">ID</a> **idpoin, <span class="keywordtype">void</span> *userdata)
<a name="l02462"></a>02462 {
<a name="l02463"></a>02463     <a class="code" href="../../d1/dfe/structtConstraintLinkData.html">tConstraintLinkData</a> *cld= (<a class="code" href="../../d1/dfe/structtConstraintLinkData.html">tConstraintLinkData</a> *)userdata;
<a name="l02464"></a>02464     *idpoin = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(cld-&gt;<a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a505e20dcb14f74c6dc61379b3501da4a">fd</a>, cld-&gt;<a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a979f99d2f196b1de182282f2c9206595">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, *idpoin);
<a name="l02465"></a>02465 }
<a name="l02466"></a>02466 
<a name="l02467"></a><a class="code" href="../../d0/d12/readfile_8c.html#a54f8b6ce2718370b5baea1ec9400d5d4">02467</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a54f8b6ce2718370b5baea1ec9400d5d4">lib_link_constraints</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *conlist)
<a name="l02468"></a>02468 {
<a name="l02469"></a>02469     <a class="code" href="../../d1/dfe/structtConstraintLinkData.html">tConstraintLinkData</a> cld;
<a name="l02470"></a>02470     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02471"></a>02471     
<a name="l02472"></a>02472     <span class="comment">/* legacy fixes */</span>
<a name="l02473"></a>02473     <span class="keywordflow">for</span> (con = conlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02474"></a>02474         <span class="comment">/* patch for error introduced by changing constraints (dunno how) */</span>
<a name="l02475"></a>02475         <span class="comment">/* if con-&gt;data type changes, dna cannot resolve the pointer! (ton) */</span>
<a name="l02476"></a>02476         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02477"></a>02477             con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a82cd381e2c3f10ae3f420bd2b20e1806">CONSTRAINT_TYPE_NULL</a>;
<a name="l02478"></a>02478         }
<a name="l02479"></a>02479         <span class="comment">/* own ipo, all constraints have it */</span>
<a name="l02480"></a>02480         con-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, con-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l02481"></a>02481     }
<a name="l02482"></a>02482     
<a name="l02483"></a>02483     <span class="comment">/* relink all ID-blocks used by the constraints */</span>
<a name="l02484"></a>02484     cld.<a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a505e20dcb14f74c6dc61379b3501da4a">fd</a>= fd;
<a name="l02485"></a>02485     cld.<a class="code" href="../../d1/dfe/structtConstraintLinkData.html#a979f99d2f196b1de182282f2c9206595">id</a>= id;
<a name="l02486"></a>02486     
<a name="l02487"></a>02487     <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#ab7afb39afe46395f0492eb0a57394d59">id_loop_constraints</a>(conlist, <a class="code" href="../../d0/d12/readfile_8c.html#a05d4e5d44e7d9aa0ee64e736cae45007">lib_link_constraint_cb</a>, &amp;cld);
<a name="l02488"></a>02488 }
<a name="l02489"></a>02489 
<a name="l02490"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab5d64cf8cddd50141495646c6bbd63d0">02490</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab5d64cf8cddd50141495646c6bbd63d0">direct_link_constraints</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l02491"></a>02491 {
<a name="l02492"></a>02492     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02493"></a>02493 
<a name="l02494"></a>02494     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, lb);
<a name="l02495"></a>02495     <span class="keywordflow">for</span> (con=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02496"></a>02496         con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>);
<a name="l02497"></a>02497         
<a name="l02498"></a>02498         <span class="keywordflow">switch</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>) {
<a name="l02499"></a>02499             <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a7e2841c90e49a4d5c28931df5f82bf32">CONSTRAINT_TYPE_PYTHON</a>:
<a name="l02500"></a>02500             {
<a name="l02501"></a>02501                 <a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02502"></a>02502                 
<a name="l02503"></a>02503                 <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#ad08ba0f7208324f62cfe83a3e1aa1405">targets</a>);
<a name="l02504"></a>02504                 
<a name="l02505"></a>02505                 data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a22715d94c0730e17caa007d76fafcc67">prop</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a22715d94c0730e17caa007d76fafcc67">prop</a>);
<a name="l02506"></a>02506                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a22715d94c0730e17caa007d76fafcc67">prop</a>)
<a name="l02507"></a>02507                     <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a22715d94c0730e17caa007d76fafcc67">prop</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l02508"></a>02508             }
<a name="l02509"></a>02509                 <span class="keywordflow">break</span>;
<a name="l02510"></a>02510             <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>:
<a name="l02511"></a>02511             {
<a name="l02512"></a>02512                 <a class="code" href="../../d5/d7b/structbSplineIKConstraint.html">bSplineIKConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02513"></a>02513                 
<a name="l02514"></a>02514                 data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a>);
<a name="l02515"></a>02515             }
<a name="l02516"></a>02516                 <span class="keywordflow">break</span>;
<a name="l02517"></a>02517             <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>:
<a name="l02518"></a>02518             {
<a name="l02519"></a>02519                 con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a7b37e24e24b1a5e39e3a32e971025b53">lin_error</a> = 0.f;
<a name="l02520"></a>02520                 con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a75fe4e289223c54264cb38a546adcaea">rot_error</a> = 0.f;
<a name="l02521"></a>02521             }
<a name="l02522"></a>02522             <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a23ff53dbd5e0a68bbd1656c899089630">CONSTRAINT_TYPE_CHILDOF</a>:
<a name="l02523"></a>02523             {
<a name="l02524"></a>02524                 <span class="comment">/* XXX version patch, in older code this flag wasn&#39;t always set, and is inherent to type */</span>
<a name="l02525"></a>02525                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303a611a7ece07a5656a655d1f21db1b49a2">CONSTRAINT_SPACE_POSE</a>)
<a name="l02526"></a>02526                     con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdaa54a56be13da3e0fcae8512d8a553946">CONSTRAINT_SPACEONCE</a>;
<a name="l02527"></a>02527             }
<a name="l02528"></a>02528                 <span class="keywordflow">break</span>;
<a name="l02529"></a>02529         }
<a name="l02530"></a>02530     }
<a name="l02531"></a>02531 }
<a name="l02532"></a>02532 
<a name="l02533"></a><a class="code" href="../../d0/d12/readfile_8c.html#a01d6828c2e0c1971854b3c21bf7e3ff3">02533</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a01d6828c2e0c1971854b3c21bf7e3ff3">lib_link_pose</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d3/de4/structbPose.html">bPose</a> *pose)
<a name="l02534"></a>02534 {
<a name="l02535"></a>02535     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l02536"></a>02536     <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02537"></a>02537     <span class="keywordtype">int</span> rebuild;
<a name="l02538"></a>02538     
<a name="l02539"></a>02539     <span class="keywordflow">if</span> (!pose || !arm)
<a name="l02540"></a>02540         <span class="keywordflow">return</span>;
<a name="l02541"></a>02541     
<a name="l02542"></a>02542 
<a name="l02543"></a>02543     <span class="comment">/* always rebuild to match proxy or lib changes */</span>
<a name="l02544"></a>02544     rebuild= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a> || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>);
<a name="l02545"></a>02545 
<a name="l02546"></a>02546     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>) {
<a name="l02547"></a>02547         <span class="comment">/* sync proxy layer */</span>
<a name="l02548"></a>02548         <span class="keywordflow">if</span> (pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a46505d643d568934e7b52ebd9176cdfc">proxy_layer</a>)
<a name="l02549"></a>02549             arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac14cfbfc02b044a0a9b933dcbe002780">layer</a> = pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a46505d643d568934e7b52ebd9176cdfc">proxy_layer</a>;
<a name="l02550"></a>02550         
<a name="l02551"></a>02551         <span class="comment">/* sync proxy active bone */</span>
<a name="l02552"></a>02552         <span class="keywordflow">if</span> (pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#ab1412ec1f7e512c78c5f9823d68b03cd">proxy_act_bone</a>[0]) {
<a name="l02553"></a>02553             <a class="code" href="../../de/de0/structBone.html">Bone</a> *bone = <a class="code" href="../../da/d17/BKE__armature_8h.html#aa555e0c2fb76b7edbcbd5fc8344b993a">get_named_bone</a>(arm, pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#ab1412ec1f7e512c78c5f9823d68b03cd">proxy_act_bone</a>);
<a name="l02554"></a>02554             <span class="keywordflow">if</span> (bone)
<a name="l02555"></a>02555                 arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7d1c3812f46a8787c49bc84c68c1e118">act_bone</a> = bone;
<a name="l02556"></a>02556         }
<a name="l02557"></a>02557     }
<a name="l02558"></a>02558 
<a name="l02559"></a>02559     <span class="keywordflow">for</span> (pchan = pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l02560"></a>02560         <a class="code" href="../../d0/d12/readfile_8c.html#a54f8b6ce2718370b5baea1ec9400d5d4">lib_link_constraints</a>(fd, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ob, &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>);
<a name="l02561"></a>02561         
<a name="l02562"></a>02562         <span class="comment">/* hurms... loop in a loop, but yah... later... (ton) */</span>
<a name="l02563"></a>02563         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>= <a class="code" href="../../da/d17/BKE__armature_8h.html#aa555e0c2fb76b7edbcbd5fc8344b993a">get_named_bone</a>(arm, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a8e947cbe29071a1c347abe644fe9c0c1">name</a>);
<a name="l02564"></a>02564         
<a name="l02565"></a>02565         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a5142a64bf664411e5f73166f8305b6c0">custom</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a5142a64bf664411e5f73166f8305b6c0">custom</a>);
<a name="l02566"></a>02566         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02567"></a>02567             rebuild= 1;
<a name="l02568"></a>02568         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;id.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l02569"></a>02569             <span class="comment">/* local pose selection copied to armature, bit hackish */</span>
<a name="l02570"></a>02570             pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>-&gt;<a class="code" href="../../de/de0/structBone.html#a5b5e463a4ba414686cfe2954ada482fb">flag</a> &amp;= ~<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a176833e258350f5e845cfb780a4c280c">BONE_SELECTED</a>;
<a name="l02571"></a>02571             pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>-&gt;<a class="code" href="../../de/de0/structBone.html#a5b5e463a4ba414686cfe2954ada482fb">flag</a> |= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ab8002f1264e76592d3768b09dda30f56">selectflag</a>;
<a name="l02572"></a>02572         }
<a name="l02573"></a>02573     }
<a name="l02574"></a>02574     
<a name="l02575"></a>02575     <span class="keywordflow">if</span> (rebuild) {
<a name="l02576"></a>02576         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#acd3a68b1b095992c7f50c74a480549bd">OB_RECALC_TIME</a>;
<a name="l02577"></a>02577         pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483daa8b3bbff9fe194cbe52e3aad051a19a6">POSE_RECALC</a>;
<a name="l02578"></a>02578     }
<a name="l02579"></a>02579 }
<a name="l02580"></a>02580 
<a name="l02581"></a><a class="code" href="../../d0/d12/readfile_8c.html#a94512ed8ad2b1cf7332aa8163b3f3e13">02581</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a94512ed8ad2b1cf7332aa8163b3f3e13">lib_link_armature</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02582"></a>02582 {
<a name="l02583"></a>02583     <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l02584"></a>02584 
<a name="l02585"></a>02585     arm= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02586"></a>02586 
<a name="l02587"></a>02587     <span class="keywordflow">while</span> (arm) {
<a name="l02588"></a>02588         <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02589"></a>02589             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>);
<a name="l02590"></a>02590             arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02591"></a>02591         }
<a name="l02592"></a>02592         arm= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02593"></a>02593     }
<a name="l02594"></a>02594 }
<a name="l02595"></a>02595 
<a name="l02596"></a><a class="code" href="../../d0/d12/readfile_8c.html#a24862e0c39aaccb6639aa7fa1b452bab">02596</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a24862e0c39aaccb6639aa7fa1b452bab">direct_link_bones</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../de/de0/structBone.html">Bone</a>* bone)
<a name="l02597"></a>02597 {
<a name="l02598"></a>02598     <a class="code" href="../../de/de0/structBone.html">Bone</a>    *child;
<a name="l02599"></a>02599 
<a name="l02600"></a>02600     bone-&gt;<a class="code" href="../../de/de0/structBone.html#a58c27a1e1006b66e5912c2803271cf5c">parent</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, bone-&gt;<a class="code" href="../../de/de0/structBone.html#a58c27a1e1006b66e5912c2803271cf5c">parent</a>);
<a name="l02601"></a>02601     bone-&gt;<a class="code" href="../../de/de0/structBone.html#aaba2ee560b6e3d1a41516ed6bff79fab">prop</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, bone-&gt;<a class="code" href="../../de/de0/structBone.html#aaba2ee560b6e3d1a41516ed6bff79fab">prop</a>);
<a name="l02602"></a>02602     <span class="keywordflow">if</span> (bone-&gt;<a class="code" href="../../de/de0/structBone.html#aaba2ee560b6e3d1a41516ed6bff79fab">prop</a>)
<a name="l02603"></a>02603         <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(bone-&gt;<a class="code" href="../../de/de0/structBone.html#aaba2ee560b6e3d1a41516ed6bff79fab">prop</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l02604"></a>02604         
<a name="l02605"></a>02605     bone-&gt;<a class="code" href="../../de/de0/structBone.html#a5b5e463a4ba414686cfe2954ada482fb">flag</a> &amp;= ~<a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50abb70b7be4f95219a3b03881fbc4a58a5">BONE_DRAW_ACTIVE</a>;
<a name="l02606"></a>02606 
<a name="l02607"></a>02607     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>);
<a name="l02608"></a>02608 
<a name="l02609"></a>02609     <span class="keywordflow">for</span> (child=bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; child; child=child-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>)
<a name="l02610"></a>02610         <a class="code" href="../../d0/d12/readfile_8c.html#a24862e0c39aaccb6639aa7fa1b452bab">direct_link_bones</a>(fd, child);
<a name="l02611"></a>02611 }
<a name="l02612"></a>02612 
<a name="l02613"></a><a class="code" href="../../d0/d12/readfile_8c.html#a91c1647530e43997b7144e10ac7eb7f4">02613</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a91c1647530e43997b7144e10ac7eb7f4">direct_link_armature</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm)
<a name="l02614"></a>02614 {
<a name="l02615"></a>02615     <a class="code" href="../../de/de0/structBone.html">Bone</a>    *bone;
<a name="l02616"></a>02616 
<a name="l02617"></a>02617     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>);
<a name="l02618"></a>02618     arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#adb3f7d11765ffd0276f5a68739e69d65">edbo</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02619"></a>02619     arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a18e4e3bd147d59ebca30148176784b86">sketch</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02620"></a>02620     
<a name="l02621"></a>02621     arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>);
<a name="l02622"></a>02622     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>);
<a name="l02623"></a>02623     
<a name="l02624"></a>02624     bone=arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02625"></a>02625     <span class="keywordflow">while</span> (bone) {
<a name="l02626"></a>02626         <a class="code" href="../../d0/d12/readfile_8c.html#a24862e0c39aaccb6639aa7fa1b452bab">direct_link_bones</a>(fd, bone);
<a name="l02627"></a>02627         bone=bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>;
<a name="l02628"></a>02628     }
<a name="l02629"></a>02629 
<a name="l02630"></a>02630     arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7d1c3812f46a8787c49bc84c68c1e118">act_bone</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7d1c3812f46a8787c49bc84c68c1e118">act_bone</a>);
<a name="l02631"></a>02631     arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac80d7a4b51181d91973980e19375019a">act_edbone</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02632"></a>02632 }
<a name="l02633"></a>02633 
<a name="l02634"></a>02634 <span class="comment">/* ************ READ CAMERA ***************** */</span>
<a name="l02635"></a>02635 
<a name="l02636"></a><a class="code" href="../../d0/d12/readfile_8c.html#a99268eaac27603263d41a59dd1a09465">02636</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a99268eaac27603263d41a59dd1a09465">lib_link_camera</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02637"></a>02637 {
<a name="l02638"></a>02638     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *ca;
<a name="l02639"></a>02639 
<a name="l02640"></a>02640     ca= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a331d71d4f599b49bb6b38e48b7cfc7bf">camera</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02641"></a>02641     <span class="keywordflow">while</span> (ca) {
<a name="l02642"></a>02642         <span class="keywordflow">if</span> (ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02643"></a>02643             <span class="keywordflow">if</span> (ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>);
<a name="l02644"></a>02644             
<a name="l02645"></a>02645             ca-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ca-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l02646"></a>02646             
<a name="l02647"></a>02647             ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>);
<a name="l02648"></a>02648             
<a name="l02649"></a>02649             ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02650"></a>02650         }
<a name="l02651"></a>02651         ca= ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02652"></a>02652     }
<a name="l02653"></a>02653 }
<a name="l02654"></a>02654 
<a name="l02655"></a><a class="code" href="../../d0/d12/readfile_8c.html#add89a838fed275afa47f5ab049ceedb5">02655</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#add89a838fed275afa47f5ab049ceedb5">direct_link_camera</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *ca)
<a name="l02656"></a>02656 {
<a name="l02657"></a>02657     ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>);
<a name="l02658"></a>02658     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>);
<a name="l02659"></a>02659 }
<a name="l02660"></a>02660 
<a name="l02661"></a>02661 
<a name="l02662"></a>02662 <span class="comment">/* ************ READ LAMP ***************** */</span>
<a name="l02663"></a>02663 
<a name="l02664"></a><a class="code" href="../../d0/d12/readfile_8c.html#a3e0d9e002217c51047510a4f64f514fa">02664</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3e0d9e002217c51047510a4f64f514fa">lib_link_lamp</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02665"></a>02665 {
<a name="l02666"></a>02666     <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l02667"></a>02667     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex;
<a name="l02668"></a>02668     <span class="keywordtype">int</span> a;
<a name="l02669"></a>02669 
<a name="l02670"></a>02670     la= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02671"></a>02671     <span class="keywordflow">while</span> (la) {
<a name="l02672"></a>02672         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02673"></a>02673             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>);
<a name="l02674"></a>02674             
<a name="l02675"></a>02675             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l02676"></a>02676                 mtex= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a];
<a name="l02677"></a>02677                 <span class="keywordflow">if</span> (mtex) {
<a name="l02678"></a>02678                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l02679"></a>02679                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l02680"></a>02680                 }
<a name="l02681"></a>02681             }
<a name="l02682"></a>02682             
<a name="l02683"></a>02683             la-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, la-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l02684"></a>02684 
<a name="l02685"></a>02685             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>)
<a name="l02686"></a>02686                 <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(fd, &amp;la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l02687"></a>02687             
<a name="l02688"></a>02688             la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02689"></a>02689         }
<a name="l02690"></a>02690         la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02691"></a>02691     }
<a name="l02692"></a>02692 }
<a name="l02693"></a>02693 
<a name="l02694"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2938a1efa1b5d95a2a6766bcbe1617cc">02694</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2938a1efa1b5d95a2a6766bcbe1617cc">direct_link_lamp</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la)
<a name="l02695"></a>02695 {
<a name="l02696"></a>02696     <span class="keywordtype">int</span> a;
<a name="l02697"></a>02697     
<a name="l02698"></a>02698     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>);
<a name="l02699"></a>02699     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>);
<a name="l02700"></a>02700 
<a name="l02701"></a>02701     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l02702"></a>02702         la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]);
<a name="l02703"></a>02703     }
<a name="l02704"></a>02704     
<a name="l02705"></a>02705     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>);
<a name="l02706"></a>02706     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>)
<a name="l02707"></a>02707         <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>);
<a name="l02708"></a>02708 
<a name="l02709"></a>02709     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l02710"></a>02710     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>)
<a name="l02711"></a>02711         <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l02712"></a>02712     
<a name="l02713"></a>02713     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a08a7713434a8ef3d9649eb73953c37cb">preview</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">direct_link_preview_image</a>(fd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a08a7713434a8ef3d9649eb73953c37cb">preview</a>);
<a name="l02714"></a>02714 }
<a name="l02715"></a>02715 
<a name="l02716"></a>02716 <span class="comment">/* ************ READ keys ***************** */</span>
<a name="l02717"></a>02717 
<a name="l02718"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6b7664f42de447cb99205e6f5db680eb">02718</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a6b7664f42de447cb99205e6f5db680eb">lib_link_key</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02719"></a>02719 {
<a name="l02720"></a>02720     <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l02721"></a>02721 
<a name="l02722"></a>02722     key= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1194bb31422b5ad4cd169ea17a08c0a6">key</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02723"></a>02723     <span class="keywordflow">while</span> (key) {
<a name="l02724"></a>02724         <span class="comment">/*check if we need to generate unique ids for the shapekeys*/</span>
<a name="l02725"></a>02725         <span class="keywordflow">if</span> (!key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a56223c7671e8b6a1be37882e473de9c2">uidgen</a>) {
<a name="l02726"></a>02726             <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *block;
<a name="l02727"></a>02727 
<a name="l02728"></a>02728             key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a56223c7671e8b6a1be37882e473de9c2">uidgen</a> = 1;
<a name="l02729"></a>02729             <span class="keywordflow">for</span> (block=key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block=block-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>) {
<a name="l02730"></a>02730                 block-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a19133403f4209f5165ef7d874cce987c">uid</a> = key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a56223c7671e8b6a1be37882e473de9c2">uidgen</a>++;
<a name="l02731"></a>02731             }
<a name="l02732"></a>02732         }
<a name="l02733"></a>02733 
<a name="l02734"></a>02734         <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02735"></a>02735             <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>);
<a name="l02736"></a>02736             
<a name="l02737"></a>02737             key-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, key-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l02738"></a>02738             key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a10821be2b17cc3b647d74f40c307e75f">from</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a10821be2b17cc3b647d74f40c307e75f">from</a>);
<a name="l02739"></a>02739 
<a name="l02740"></a>02740             key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02741"></a>02741         }
<a name="l02742"></a>02742         key= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02743"></a>02743     }
<a name="l02744"></a>02744 }
<a name="l02745"></a>02745 
<a name="l02746"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9849d9276ba50d6814de6dbecbd44983">02746</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a9849d9276ba50d6814de6dbecbd44983">switch_endian_keyblock</a>(<a class="code" href="../../d1/d9e/structKey.html">Key</a> *key, <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb)
<a name="l02747"></a>02747 {
<a name="l02748"></a>02748     <span class="keywordtype">int</span> elemsize, a, b;
<a name="l02749"></a>02749     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, *poin, *cp;
<a name="l02750"></a>02750 
<a name="l02751"></a>02751     elemsize= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a61e6991b6b6a75a8c65470f3b240c193">elemsize</a>;
<a name="l02752"></a>02752     data= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l02753"></a>02753 
<a name="l02754"></a>02754     <span class="keywordflow">for</span> (a=0; a&lt;kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a48866fbfcc064f4777e2d2841ce42fe4">totelem</a>; a++) {
<a name="l02755"></a>02755 
<a name="l02756"></a>02756         cp= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a3fb147668e7b13100f57d4e548eaf5e6">elemstr</a>;
<a name="l02757"></a>02757         poin= <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02758"></a>02758 
<a name="l02759"></a>02759         <span class="keywordflow">while</span> ( cp[0] ) {   <span class="comment">/* cp[0]==amount */</span>
<a name="l02760"></a>02760 
<a name="l02761"></a>02761             <span class="keywordflow">switch</span>(cp[1]) {     <span class="comment">/* cp[1]= type */</span>
<a name="l02762"></a>02762             <span class="keywordflow">case</span> <a class="code" href="../../db/dfd/key_8c.html#a0b1707e97ce1a784fceb99ec5b5c5799">IPO_FLOAT</a>:
<a name="l02763"></a>02763             <span class="keywordflow">case</span> <a class="code" href="../../db/dfd/key_8c.html#aff7a69eecef466496dacdc7a8b656799">IPO_BPOINT</a>:
<a name="l02764"></a>02764             <span class="keywordflow">case</span> <a class="code" href="../../db/dfd/key_8c.html#a46843e0a422a245d3fa7404f5f990b53">IPO_BEZTRIPLE</a>:
<a name="l02765"></a>02765                 b= cp[0];
<a name="l02766"></a>02766                 <span class="keywordflow">while</span> (b--) {
<a name="l02767"></a>02767                     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>((*poin));
<a name="l02768"></a>02768                     poin+= 4;
<a name="l02769"></a>02769                 }
<a name="l02770"></a>02770                 <span class="keywordflow">break</span>;
<a name="l02771"></a>02771             }
<a name="l02772"></a>02772 
<a name="l02773"></a>02773             cp+= 2;
<a name="l02774"></a>02774 
<a name="l02775"></a>02775         }
<a name="l02776"></a>02776         data+= elemsize;
<a name="l02777"></a>02777     }
<a name="l02778"></a>02778 }
<a name="l02779"></a>02779 
<a name="l02780"></a><a class="code" href="../../d0/d12/readfile_8c.html#a82f4a32146d0cf70d646f6c41b675f3b">02780</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a82f4a32146d0cf70d646f6c41b675f3b">direct_link_key</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key)
<a name="l02781"></a>02781 {
<a name="l02782"></a>02782     <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l02783"></a>02783 
<a name="l02784"></a>02784     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>));
<a name="l02785"></a>02785 
<a name="l02786"></a>02786     key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>);
<a name="l02787"></a>02787     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>);
<a name="l02788"></a>02788     
<a name="l02789"></a>02789     key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>);
<a name="l02790"></a>02790 
<a name="l02791"></a>02791     kb= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02792"></a>02792     <span class="keywordflow">while</span> (kb) {
<a name="l02793"></a>02793 
<a name="l02794"></a>02794         kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>);
<a name="l02795"></a>02795         
<a name="l02796"></a>02796         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>)
<a name="l02797"></a>02797             <a class="code" href="../../d0/d12/readfile_8c.html#a9849d9276ba50d6814de6dbecbd44983">switch_endian_keyblock</a>(key, kb);
<a name="l02798"></a>02798 
<a name="l02799"></a>02799         kb= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>;
<a name="l02800"></a>02800     }
<a name="l02801"></a>02801 }
<a name="l02802"></a>02802 
<a name="l02803"></a>02803 <span class="comment">/* ************ READ mball ***************** */</span>
<a name="l02804"></a>02804 
<a name="l02805"></a><a class="code" href="../../d0/d12/readfile_8c.html#a3285f0fb40a62ead7a89a8013dbe21b2">02805</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3285f0fb40a62ead7a89a8013dbe21b2">lib_link_mball</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02806"></a>02806 {
<a name="l02807"></a>02807     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb;
<a name="l02808"></a>02808     <span class="keywordtype">int</span> a;
<a name="l02809"></a>02809 
<a name="l02810"></a>02810     mb= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac1605716bd05f0456c07263500010810">mball</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02811"></a>02811     <span class="keywordflow">while</span> (mb) {
<a name="l02812"></a>02812         <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02813"></a>02813             <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>);
<a name="l02814"></a>02814             
<a name="l02815"></a>02815             <span class="keywordflow">for</span> (a=0; a&lt;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab8971ac14c6143431474bce14b1ea887">totcol</a>; a++) mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]);
<a name="l02816"></a>02816 
<a name="l02817"></a>02817             mb-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mb-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l02818"></a>02818 
<a name="l02819"></a>02819             mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02820"></a>02820         }
<a name="l02821"></a>02821         mb= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02822"></a>02822     }
<a name="l02823"></a>02823 }
<a name="l02824"></a>02824 
<a name="l02825"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4d7d6ebffc9359965e1ccd2371a44646">02825</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4d7d6ebffc9359965e1ccd2371a44646">direct_link_mball</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l02826"></a>02826 {
<a name="l02827"></a>02827     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>);
<a name="l02828"></a>02828     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>);
<a name="l02829"></a>02829     
<a name="l02830"></a>02830     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>);
<a name="l02831"></a>02831     <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>);
<a name="l02832"></a>02832 
<a name="l02833"></a>02833     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>));
<a name="l02834"></a>02834 
<a name="l02835"></a>02835     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aa6032a298ffca43c17d63ff15e200241">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aa6032a298ffca43c17d63ff15e200241">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02836"></a>02836     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02837"></a>02837     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac0ae3b2056b55f10f2bed774c5c30e7e">bb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02838"></a>02838 <span class="comment">/*  mb-&gt;edit_elems.first= mb-&gt;edit_elems.last= NULL;*/</span>
<a name="l02839"></a>02839     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a0bc8bbba74fae4b63a7c91bdf6c63337">lastelem</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02840"></a>02840 }
<a name="l02841"></a>02841 
<a name="l02842"></a>02842 <span class="comment">/* ************ READ WORLD ***************** */</span>
<a name="l02843"></a>02843 
<a name="l02844"></a><a class="code" href="../../d0/d12/readfile_8c.html#a775f6f10ac449ef09f14ad6fb91f4b67">02844</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a775f6f10ac449ef09f14ad6fb91f4b67">lib_link_world</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02845"></a>02845 {
<a name="l02846"></a>02846     <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l02847"></a>02847     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex;
<a name="l02848"></a>02848     <span class="keywordtype">int</span> a;
<a name="l02849"></a>02849 
<a name="l02850"></a>02850     wrld= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02851"></a>02851     <span class="keywordflow">while</span> (wrld) {
<a name="l02852"></a>02852         <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02853"></a>02853             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>);
<a name="l02854"></a>02854             
<a name="l02855"></a>02855             wrld-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, wrld-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l02856"></a>02856             
<a name="l02857"></a>02857             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l02858"></a>02858                 mtex= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a];
<a name="l02859"></a>02859                 <span class="keywordflow">if</span> (mtex) {
<a name="l02860"></a>02860                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l02861"></a>02861                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l02862"></a>02862                 }
<a name="l02863"></a>02863             }
<a name="l02864"></a>02864 
<a name="l02865"></a>02865             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>)
<a name="l02866"></a>02866                 <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(fd, &amp;wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l02867"></a>02867             
<a name="l02868"></a>02868             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02869"></a>02869         }
<a name="l02870"></a>02870         wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02871"></a>02871     }
<a name="l02872"></a>02872 }
<a name="l02873"></a>02873 
<a name="l02874"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4626f74b95336375c371fce830b88c15">02874</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4626f74b95336375c371fce830b88c15">direct_link_world</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld)
<a name="l02875"></a>02875 {
<a name="l02876"></a>02876     <span class="keywordtype">int</span> a;
<a name="l02877"></a>02877 
<a name="l02878"></a>02878     wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>);
<a name="l02879"></a>02879     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>);
<a name="l02880"></a>02880 
<a name="l02881"></a>02881     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l02882"></a>02882         wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]);
<a name="l02883"></a>02883     }
<a name="l02884"></a>02884 
<a name="l02885"></a>02885     wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l02886"></a>02886     <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>)
<a name="l02887"></a>02887         <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l02888"></a>02888 
<a name="l02889"></a>02889     wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a156e067e36c386be1f2a889528109195">preview</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">direct_link_preview_image</a>(fd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a156e067e36c386be1f2a889528109195">preview</a>);
<a name="l02890"></a>02890 }
<a name="l02891"></a>02891 
<a name="l02892"></a>02892 
<a name="l02893"></a>02893 <span class="comment">/* ************ READ VFONT ***************** */</span>
<a name="l02894"></a>02894 
<a name="l02895"></a><a class="code" href="../../d0/d12/readfile_8c.html#a28c32f87e5765b01dc0d2daaf75935ea">02895</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a28c32f87e5765b01dc0d2daaf75935ea">lib_link_vfont</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(fd), <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02896"></a>02896 {
<a name="l02897"></a>02897     <a class="code" href="../../dc/dbe/structVFont.html">VFont</a> *vf;
<a name="l02898"></a>02898 
<a name="l02899"></a>02899     vf= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abef2da7d5c3a1975eb74128e4d70c682">vfont</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02900"></a>02900     <span class="keywordflow">while</span> (vf) {
<a name="l02901"></a>02901         <span class="keywordflow">if</span> (vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02902"></a>02902             vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02903"></a>02903         }
<a name="l02904"></a>02904         vf= vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02905"></a>02905     }
<a name="l02906"></a>02906 }
<a name="l02907"></a>02907 
<a name="l02908"></a><a class="code" href="../../d0/d12/readfile_8c.html#aae703b4108d3110ceaddacacc7ac9ac2">02908</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aae703b4108d3110ceaddacacc7ac9ac2">direct_link_vfont</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dc/dbe/structVFont.html">VFont</a> *vf)
<a name="l02909"></a>02909 {
<a name="l02910"></a>02910     vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#a0dc791926203e1e24184a4a13ac35857">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02911"></a>02911     vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#afed9353561fc055c04cd4dda674c4aa5">packedfile</a>= <a class="code" href="../../d0/d12/readfile_8c.html#ab47d4467d81b33a32bc7d3fe6f0244f6">direct_link_packedfile</a>(fd, vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#afed9353561fc055c04cd4dda674c4aa5">packedfile</a>);
<a name="l02912"></a>02912 }
<a name="l02913"></a>02913 
<a name="l02914"></a>02914 <span class="comment">/* ************ READ TEXT ****************** */</span>
<a name="l02915"></a>02915 
<a name="l02916"></a><a class="code" href="../../d0/d12/readfile_8c.html#aefb920d224a5fdb12266a73dcb154e43">02916</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aefb920d224a5fdb12266a73dcb154e43">lib_link_text</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(fd), <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02917"></a>02917 {
<a name="l02918"></a>02918     <a class="code" href="../../d2/dda/structText.html">Text</a> *text;
<a name="l02919"></a>02919 
<a name="l02920"></a>02920     text= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#aba48dab3abbe5521b8493006361d2d51">text</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02921"></a>02921     <span class="keywordflow">while</span> (text) {
<a name="l02922"></a>02922         <span class="keywordflow">if</span> (text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02923"></a>02923             text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02924"></a>02924         }
<a name="l02925"></a>02925         text= text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02926"></a>02926     }
<a name="l02927"></a>02927 }
<a name="l02928"></a>02928 
<a name="l02929"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab5650b7c5fd2d28347d2a1a90acb6edd">02929</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab5650b7c5fd2d28347d2a1a90acb6edd">direct_link_text</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d2/dda/structText.html">Text</a> *text)
<a name="l02930"></a>02930 {
<a name="l02931"></a>02931     <a class="code" href="../../d8/de6/structTextLine.html">TextLine</a> *ln;
<a name="l02932"></a>02932 
<a name="l02933"></a>02933     text-&gt;<a class="code" href="../../d2/dda/structText.html#a69aa123f472ed716685c2af565d8a9b9">name</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, text-&gt;<a class="code" href="../../d2/dda/structText.html#a69aa123f472ed716685c2af565d8a9b9">name</a>);
<a name="l02934"></a>02934 
<a name="l02935"></a>02935     text-&gt;<a class="code" href="../../d2/dda/structText.html#ae49316aa456fa51a6a9219317999bb3e">undo_pos</a>= -1;
<a name="l02936"></a>02936     text-&gt;<a class="code" href="../../d2/dda/structText.html#ad1c1f7a16cf19b665623bd2c3a9a8f45">undo_len</a>= <a class="code" href="../../d7/d71/DNA__text__types_8h.html#aec16dcd4831010453486def454a4f415">TXT_INIT_UNDO</a>;
<a name="l02937"></a>02937     text-&gt;<a class="code" href="../../d2/dda/structText.html#a59b32c282a7e5b5af9d594983c0814e6">undo_buf</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(text-&gt;<a class="code" href="../../d2/dda/structText.html#ad1c1f7a16cf19b665623bd2c3a9a8f45">undo_len</a>, <span class="stringliteral">&quot;undo buf&quot;</span>);
<a name="l02938"></a>02938 
<a name="l02939"></a>02939     text-&gt;<a class="code" href="../../d2/dda/structText.html#acb96b7187bf8db8a505e82c8aa55964e">compiled</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02940"></a>02940 
<a name="l02941"></a>02941 <span class="preprocessor">#if 0</span>
<a name="l02942"></a>02942 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> &amp; <a class="code" href="../../d7/d71/DNA__text__types_8h.html#a1cab0fb665bac909f466de9fc056da9b">TXT_ISEXT</a>) {
<a name="l02943"></a>02943         <a class="code" href="../../d9/d6d/BKE__text_8h.html#a42f5a6b07656f63624a3b8b806dc8bfb">reopen_text</a>(text);
<a name="l02944"></a>02944         }
<a name="l02945"></a>02945         <span class="keywordflow">else</span> {
<a name="l02946"></a>02946 <span class="preprocessor">#endif</span>
<a name="l02947"></a>02947 <span class="preprocessor"></span>
<a name="l02948"></a>02948     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;text-&gt;<a class="code" href="../../d2/dda/structText.html#a04317b744e009e393be9cbee3fe41998">lines</a>);
<a name="l02949"></a>02949     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;text-&gt;<a class="code" href="../../d2/dda/structText.html#a4da28989c8e2320e9dd4f8966a488785">markers</a>);
<a name="l02950"></a>02950 
<a name="l02951"></a>02951     text-&gt;<a class="code" href="../../d2/dda/structText.html#a3d8d1ee6b07201677b308934c3a35cec">curl</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, text-&gt;<a class="code" href="../../d2/dda/structText.html#a3d8d1ee6b07201677b308934c3a35cec">curl</a>);
<a name="l02952"></a>02952     text-&gt;<a class="code" href="../../d2/dda/structText.html#a8c7aabea9c1c5aa73280d74e64e8fc35">sell</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, text-&gt;<a class="code" href="../../d2/dda/structText.html#a8c7aabea9c1c5aa73280d74e64e8fc35">sell</a>);
<a name="l02953"></a>02953 
<a name="l02954"></a>02954     ln= text-&gt;<a class="code" href="../../d2/dda/structText.html#a04317b744e009e393be9cbee3fe41998">lines</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02955"></a>02955     <span class="keywordflow">while</span> (ln) {
<a name="l02956"></a>02956         ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a2287a51f99b6d16c3f2086d8554dc800">line</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a2287a51f99b6d16c3f2086d8554dc800">line</a>);
<a name="l02957"></a>02957         ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a21689c833c7742c731cdcbdf11799048">format</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02958"></a>02958         
<a name="l02959"></a>02959         <span class="keywordflow">if</span> (ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a5b616daa2580786a91db9f7329c91197">len</a> != (<span class="keywordtype">int</span>) <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a2287a51f99b6d16c3f2086d8554dc800">line</a>)) {
<a name="l02960"></a>02960             printf(<span class="stringliteral">&quot;Error loading text, line lengths differ\n&quot;</span>);
<a name="l02961"></a>02961             ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a5b616daa2580786a91db9f7329c91197">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a2287a51f99b6d16c3f2086d8554dc800">line</a>);
<a name="l02962"></a>02962         }
<a name="l02963"></a>02963 
<a name="l02964"></a>02964         ln= ln-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a9af045586797cc431ac66acd0c59fa76">next</a>;
<a name="l02965"></a>02965     }
<a name="l02966"></a>02966 
<a name="l02967"></a>02967     text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> = (text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a>) &amp; ~<a class="code" href="../../d7/d71/DNA__text__types_8h.html#a1cab0fb665bac909f466de9fc056da9b">TXT_ISEXT</a>;
<a name="l02968"></a>02968 
<a name="l02969"></a>02969     text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l02970"></a>02970 }
<a name="l02971"></a>02971 
<a name="l02972"></a>02972 <span class="comment">/* ************ READ IMAGE ***************** */</span>
<a name="l02973"></a>02973 
<a name="l02974"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac087f1895730eed1a25afda39cdf4835">02974</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac087f1895730eed1a25afda39cdf4835">lib_link_image</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l02975"></a>02975 {
<a name="l02976"></a>02976     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l02977"></a>02977 
<a name="l02978"></a>02978     ima= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02979"></a>02979     <span class="keywordflow">while</span> (ima) {
<a name="l02980"></a>02980         <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l02981"></a>02981             <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l02982"></a>02982 
<a name="l02983"></a>02983             ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l02984"></a>02984         }
<a name="l02985"></a>02985         ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02986"></a>02986     }
<a name="l02987"></a>02987 }
<a name="l02988"></a>02988 
<a name="l02989"></a><a class="code" href="../../d0/d12/readfile_8c.html#a299658226c43204e7afa30caff91959f">02989</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a299658226c43204e7afa30caff91959f">link_ibuf_list</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l02990"></a>02990 {
<a name="l02991"></a>02991     <a class="code" href="../../df/d0c/structLink.html">Link</a> *ln, *prev;
<a name="l02992"></a>02992     
<a name="l02993"></a>02993     <span class="keywordflow">if</span> (lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l02994"></a>02994     
<a name="l02995"></a>02995     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l02996"></a>02996     ln= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02997"></a>02997     prev= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02998"></a>02998     <span class="keywordflow">while</span> (ln) {
<a name="l02999"></a>02999         ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>);
<a name="l03000"></a>03000         ln-&gt;<a class="code" href="../../df/d0c/structLink.html#af8440b49c460fe675ae63fed67b0a725">prev</a>= prev;
<a name="l03001"></a>03001         prev= ln;
<a name="l03002"></a>03002         ln= ln-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>;
<a name="l03003"></a>03003     }
<a name="l03004"></a>03004     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= prev;
<a name="l03005"></a>03005 }
<a name="l03006"></a>03006 
<a name="l03007"></a><a class="code" href="../../d0/d12/readfile_8c.html#a00c3c0b7b91fea008f45562cec48744f">03007</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a00c3c0b7b91fea008f45562cec48744f">direct_link_image</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima)
<a name="l03008"></a>03008 {
<a name="l03009"></a>03009     <span class="comment">/* for undo system, pointers could be restored */</span>
<a name="l03010"></a>03010     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>)
<a name="l03011"></a>03011         <a class="code" href="../../d0/d12/readfile_8c.html#a299658226c43204e7afa30caff91959f">link_ibuf_list</a>(fd, &amp;ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>);
<a name="l03012"></a>03012     <span class="keywordflow">else</span>
<a name="l03013"></a>03013         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03014"></a>03014     
<a name="l03015"></a>03015     <span class="comment">/* if not restored, we keep the binded opengl index */</span>
<a name="l03016"></a>03016     <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a73febaffccd786657631095065b9e25b">ibufs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l03017"></a>03017         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a6191ed717ab5202957a8845a97fd6e39">bindcode</a>= 0;
<a name="l03018"></a>03018         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a493a6b9235c1a39a29429149085f1efb">gputexture</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03019"></a>03019     }
<a name="l03020"></a>03020     
<a name="l03021"></a>03021     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a8871757578c9905c12a57b17ebafc35a">anim</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03022"></a>03022     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab4eb9e80e14920245c69cb9604a28c3a">rr</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03023"></a>03023     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#af60081c0bf52834e01991bb87b123fa5">repbind</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03024"></a>03024     
<a name="l03025"></a>03025     <span class="comment">/* undo system, try to restore render buffers */</span>
<a name="l03026"></a>03026     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#af01f240fa1cb910ffb871c51f4009083">imamap</a>) {
<a name="l03027"></a>03027         <span class="keywordtype">int</span> a;
<a name="l03028"></a>03028         
<a name="l03029"></a>03029         <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d2/d94/DNA__image__types_8h.html#ad925558a1ce78f2ac54939303d72f771">IMA_MAX_RENDER_SLOT</a>; a++)
<a name="l03030"></a>03030             ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a91941c3be2ab13011345237920e4e7ad">newimaadr</a>(fd, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>[a]);
<a name="l03031"></a>03031     }
<a name="l03032"></a>03032     <span class="keywordflow">else</span> {
<a name="l03033"></a>03033         memset(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>, 0, <span class="keyword">sizeof</span>(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a600f01d198f4a37cac944c87e0552d36">renders</a>));
<a name="l03034"></a>03034         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a2a87093a1b926cfb183d0611b22f3f3f">last_render_slot</a>= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a9e7bbcc90a4784deaffcbd550bc509bc">render_slot</a>;
<a name="l03035"></a>03035     }
<a name="l03036"></a>03036     
<a name="l03037"></a>03037     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a0e0851c62c73413ddefacfa48e199c8e">packedfile</a> = <a class="code" href="../../d0/d12/readfile_8c.html#ab47d4467d81b33a32bc7d3fe6f0244f6">direct_link_packedfile</a>(fd, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a0e0851c62c73413ddefacfa48e199c8e">packedfile</a>);
<a name="l03038"></a>03038     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a1c97663701a45c784752d88b3e9b1749">preview</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">direct_link_preview_image</a>(fd, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a1c97663701a45c784752d88b3e9b1749">preview</a>);
<a name="l03039"></a>03039     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#af6746e8e3008f22431dae19d0c2fb914">ok</a>= 1;
<a name="l03040"></a>03040 }
<a name="l03041"></a>03041 
<a name="l03042"></a>03042 
<a name="l03043"></a>03043 <span class="comment">/* ************ READ CURVE ***************** */</span>
<a name="l03044"></a>03044 
<a name="l03045"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4770c8b602a3d1c639876c6f5716c221">03045</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4770c8b602a3d1c639876c6f5716c221">lib_link_curve</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l03046"></a>03046 {
<a name="l03047"></a>03047     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l03048"></a>03048     <span class="keywordtype">int</span> a;
<a name="l03049"></a>03049 
<a name="l03050"></a>03050     cu= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03051"></a>03051     <span class="keywordflow">while</span> (cu) {
<a name="l03052"></a>03052         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l03053"></a>03053             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>);
<a name="l03054"></a>03054 
<a name="l03055"></a>03055             <span class="keywordflow">for</span> (a=0; a&lt;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a178aa2fd33adfb5df2b311a7d398ac36">totcol</a>; a++) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]);
<a name="l03056"></a>03056 
<a name="l03057"></a>03057             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>);
<a name="l03058"></a>03058             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aee5423fad7444492028435713c64be0f">taperobj</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aee5423fad7444492028435713c64be0f">taperobj</a>);
<a name="l03059"></a>03059             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aab9f61871625a95c78c288429b4b6d74">textoncurve</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aab9f61871625a95c78c288429b4b6d74">textoncurve</a>);
<a name="l03060"></a>03060             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>);
<a name="l03061"></a>03061             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>);           
<a name="l03062"></a>03062             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>);
<a name="l03063"></a>03063             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>);
<a name="l03064"></a>03064 
<a name="l03065"></a>03065             cu-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l03066"></a>03066             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>);
<a name="l03067"></a>03067 
<a name="l03068"></a>03068             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l03069"></a>03069         }
<a name="l03070"></a>03070         cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l03071"></a>03071     }
<a name="l03072"></a>03072 }
<a name="l03073"></a>03073 
<a name="l03074"></a>03074 
<a name="l03075"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae2635ef340dae2ee8716d75ccea042ac">03075</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ae2635ef340dae2ee8716d75ccea042ac">switch_endian_knots</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l03076"></a>03076 {
<a name="l03077"></a>03077     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l03078"></a>03078 
<a name="l03079"></a>03079     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) {
<a name="l03080"></a>03080         len= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu);
<a name="l03081"></a>03081         <span class="keywordflow">while</span> (len--) {
<a name="l03082"></a>03082             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>[len]);
<a name="l03083"></a>03083         }
<a name="l03084"></a>03084     }
<a name="l03085"></a>03085     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) {
<a name="l03086"></a>03086         len= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu);
<a name="l03087"></a>03087         <span class="keywordflow">while</span> (len--) {
<a name="l03088"></a>03088             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>[len]);
<a name="l03089"></a>03089         }
<a name="l03090"></a>03090     }
<a name="l03091"></a>03091 }
<a name="l03092"></a>03092 
<a name="l03093"></a><a class="code" href="../../d0/d12/readfile_8c.html#a90fd573b2be2b44cc32aa9ad57fed93a">03093</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a90fd573b2be2b44cc32aa9ad57fed93a">direct_link_curve</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l03094"></a>03094 {
<a name="l03095"></a>03095     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03096"></a>03096     <a class="code" href="../../de/d25/structTextBox.html">TextBox</a> *tb;
<a name="l03097"></a>03097     
<a name="l03098"></a>03098     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>);
<a name="l03099"></a>03099     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>);
<a name="l03100"></a>03100     
<a name="l03101"></a>03101     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>);
<a name="l03102"></a>03102     <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>);
<a name="l03103"></a>03103     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>);
<a name="l03104"></a>03104     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>);   
<a name="l03105"></a>03105     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>);
<a name="l03106"></a>03106 
<a name="l03107"></a>03107     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>));
<a name="l03108"></a>03108     <span class="keywordflow">else</span> {
<a name="l03109"></a>03109         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>=cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03110"></a>03110 
<a name="l03111"></a>03111         tb= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a2781f12837323bb5b150f82d0f0ff70e">MAXTEXTBOX</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../de/d25/structTextBox.html">TextBox</a>), <span class="stringliteral">&quot;TextBoxread&quot;</span>);
<a name="l03112"></a>03112         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>) {
<a name="l03113"></a>03113             memcpy(tb, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a653d6829b5c84d43744c7939f32b0c3b">totbox</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../de/d25/structTextBox.html">TextBox</a>));
<a name="l03114"></a>03114             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>);
<a name="l03115"></a>03115             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>= tb;         
<a name="l03116"></a>03116         }
<a name="l03117"></a>03117         <span class="keywordflow">else</span> {
<a name="l03118"></a>03118             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a653d6829b5c84d43744c7939f32b0c3b">totbox</a> = 1;
<a name="l03119"></a>03119             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a59951ed35caba6bc89103679b3a1c7b8">actbox</a> = 1;
<a name="l03120"></a>03120             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a> = tb;
<a name="l03121"></a>03121             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[0].<a class="code" href="../../de/d25/structTextBox.html#a3cc521cc3bd6b4ba5592e898e0eaa863">w</a> = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aa0c45dd94520ace52b5175df8b6b9dab">linewidth</a>;
<a name="l03122"></a>03122         }       
<a name="l03123"></a>03123         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7aaf33141afe2cd8eb03e34256fd09db">wordspace</a> == 0.0f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7aaf33141afe2cd8eb03e34256fd09db">wordspace</a> = 1.0f;
<a name="l03124"></a>03124     }
<a name="l03125"></a>03125 
<a name="l03126"></a>03126     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>=cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03127"></a>03127     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a98794ad486b99d01cc752f9f94e856e5">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>=cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a98794ad486b99d01cc752f9f94e856e5">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03128"></a>03128     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03129"></a>03129     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03130"></a>03130     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03131"></a>03131     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03132"></a>03132     
<a name="l03133"></a>03133     nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03134"></a>03134     <span class="keywordflow">while</span> (nu) {
<a name="l03135"></a>03135         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l03136"></a>03136         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03137"></a>03137         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>);
<a name="l03138"></a>03138         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l03139"></a>03139         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3c5ced990e505c6408917ae50489759f">charidx</a>= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aec3c171f54634d9a772bbf8000bc2bb6">mat_nr</a>;
<a name="l03140"></a>03140 
<a name="l03141"></a>03141         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l03142"></a>03142             <a class="code" href="../../d0/d12/readfile_8c.html#ae2635ef340dae2ee8716d75ccea042ac">switch_endian_knots</a>(nu);
<a name="l03143"></a>03143         }
<a name="l03144"></a>03144 
<a name="l03145"></a>03145         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l03146"></a>03146     }
<a name="l03147"></a>03147     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03148"></a>03148 }
<a name="l03149"></a>03149 
<a name="l03150"></a>03150 <span class="comment">/* ************ READ TEX ***************** */</span>
<a name="l03151"></a>03151 
<a name="l03152"></a><a class="code" href="../../d0/d12/readfile_8c.html#acd28cac2a368c21e0c20d4de77f593c6">03152</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#acd28cac2a368c21e0c20d4de77f593c6">lib_link_texture</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l03153"></a>03153 {
<a name="l03154"></a>03154     <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l03155"></a>03155 
<a name="l03156"></a>03156     tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03157"></a>03157     <span class="keywordflow">while</span> (tex) {
<a name="l03158"></a>03158         <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l03159"></a>03159             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>);
<a name="l03160"></a>03160 
<a name="l03161"></a>03161             tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2c2c4a8437672ea77fc9cfded61ffaf">ima</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2c2c4a8437672ea77fc9cfded61ffaf">ima</a>);
<a name="l03162"></a>03162             tex-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex-&gt;ipo);
<a name="l03163"></a>03163             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>) tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#a8c98836b697fec0fbaddfd2fc4e0fd09">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#a8c98836b697fec0fbaddfd2fc4e0fd09">object</a>);
<a name="l03164"></a>03164             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>)
<a name="l03165"></a>03165                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a9bf644fb07d4603c6a3feace94442db6">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a9bf644fb07d4603c6a3feace94442db6">object</a>);
<a name="l03166"></a>03166             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>) tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>-&gt;<a class="code" href="../../d8/d04/structVoxelData.html#a68fc319b28309125bff96c2934821978">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>-&gt;<a class="code" href="../../d8/d04/structVoxelData.html#a68fc319b28309125bff96c2934821978">object</a>);
<a name="l03167"></a>03167             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>) tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>-&gt;<a class="code" href="../../df/d03/structOceanTex.html#a332680dcbe04a8ae4be2cb08d78e6548">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>-&gt;<a class="code" href="../../df/d03/structOceanTex.html#a332680dcbe04a8ae4be2cb08d78e6548">object</a>);
<a name="l03168"></a>03168                 
<a name="l03169"></a>03169 
<a name="l03170"></a>03170             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>)
<a name="l03171"></a>03171                 <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(fd, &amp;tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l03172"></a>03172             
<a name="l03173"></a>03173             tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l03174"></a>03174         }
<a name="l03175"></a>03175         tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l03176"></a>03176     }
<a name="l03177"></a>03177 }
<a name="l03178"></a>03178 
<a name="l03179"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad097d43097a93be1c7d96f6ac038b229">03179</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad097d43097a93be1c7d96f6ac038b229">direct_link_texture</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex)
<a name="l03180"></a>03180 {
<a name="l03181"></a>03181     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>);
<a name="l03182"></a>03182     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>);
<a name="l03183"></a>03183     
<a name="l03184"></a>03184     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>);
<a name="l03185"></a>03185     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>) {
<a name="l03186"></a>03186         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>-&gt;<a class="code" href="../../db/dc9/structPluginTex.html#a9118c39a24bc38cd4335bc66718721f1">handle</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03187"></a>03187         <a class="code" href="../../d2/d66/BKE__texture_8h.html#a03eb0c53917a292d8002ae90f80182cb">open_plugin_tex</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>);
<a name="l03188"></a>03188         <span class="comment">/* initialize data for this instance, if an initialization</span>
<a name="l03189"></a>03189 <span class="comment">         * function exists.</span>
<a name="l03190"></a>03190 <span class="comment">         */</span>
<a name="l03191"></a>03191         <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>-&gt;<a class="code" href="../../db/dc9/structPluginTex.html#ae38e6ef603989098b65b48a33347d4a7">instance_init</a>)
<a name="l03192"></a>03192             tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>-&gt;<a class="code" href="../../db/dc9/structPluginTex.html#ae38e6ef603989098b65b48a33347d4a7">instance_init</a>((<span class="keywordtype">void</span> *) tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>-&gt;<a class="code" href="../../db/dc9/structPluginTex.html#a986ab30af83133513d7333e837714f9b">data</a>);
<a name="l03193"></a>03193     }
<a name="l03194"></a>03194     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8a9db83c0f33abeb5ff2bf434abeac9e">coba</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8a9db83c0f33abeb5ff2bf434abeac9e">coba</a>);
<a name="l03195"></a>03195     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>);
<a name="l03196"></a>03196     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>) {
<a name="l03197"></a>03197         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#a8aa958f7d9894d2941bf32c82625a50a">ima</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03198"></a>03198         memset(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#ac7f5cdc3723c068a8fc59ec0cf59e346">cube</a>, 0, 6*<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
<a name="l03199"></a>03199         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#ae6e40ac1dab8eb5009658f68148d1e30">ok</a>= 0;
<a name="l03200"></a>03200     }
<a name="l03201"></a>03201     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>);
<a name="l03202"></a>03202     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>) {
<a name="l03203"></a>03203         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a79956798286f1bbc8a870a805a300c8a">point_tree</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03204"></a>03204         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#ac8b36aceadb3bd386d25c530b184abeb">coba</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#ac8b36aceadb3bd386d25c530b184abeb">coba</a>);
<a name="l03205"></a>03205         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>);
<a name="l03206"></a>03206         <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>) {
<a name="l03207"></a>03207             <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>);
<a name="l03208"></a>03208         }
<a name="l03209"></a>03209     }
<a name="l03210"></a>03210     
<a name="l03211"></a>03211     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>);
<a name="l03212"></a>03212     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>) {
<a name="l03213"></a>03213         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>-&gt;<a class="code" href="../../d8/d04/structVoxelData.html#a7c2385c302a60f3575b55c3fdd236512">dataset</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03214"></a>03214         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>-&gt;<a class="code" href="../../d8/d04/structVoxelData.html#a7920df0a00e824f2a3a53c8d870d13df">ok</a> = 0;
<a name="l03215"></a>03215     }
<a name="l03216"></a>03216     <span class="keywordflow">else</span> {
<a name="l03217"></a>03217         <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a7fd8163d72590628d35ab2695e48424a">TEX_VOXELDATA</a>)
<a name="l03218"></a>03218             tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d04/structVoxelData.html">VoxelData</a>), <span class="stringliteral">&quot;direct_link_texture VoxelData&quot;</span>);
<a name="l03219"></a>03219     }
<a name="l03220"></a>03220     
<a name="l03221"></a>03221     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>);
<a name="l03222"></a>03222     
<a name="l03223"></a>03223     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l03224"></a>03224     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>)
<a name="l03225"></a>03225         <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l03226"></a>03226     
<a name="l03227"></a>03227     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">direct_link_preview_image</a>(fd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a>);
<a name="l03228"></a>03228 
<a name="l03229"></a>03229     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a4c3780a98eb40a0465264303f197ecab">ok</a>= 1;
<a name="l03230"></a>03230 }
<a name="l03231"></a>03231 
<a name="l03232"></a>03232 
<a name="l03233"></a>03233 
<a name="l03234"></a>03234 <span class="comment">/* ************ READ MATERIAL ***************** */</span>
<a name="l03235"></a>03235 
<a name="l03236"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1ba67347b63c98e093680ff46e132cd4">03236</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1ba67347b63c98e093680ff46e132cd4">lib_link_material</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l03237"></a>03237 {
<a name="l03238"></a>03238     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l03239"></a>03239     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex;
<a name="l03240"></a>03240     <span class="keywordtype">int</span> a;
<a name="l03241"></a>03241 
<a name="l03242"></a>03242     ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03243"></a>03243     <span class="keywordflow">while</span> (ma) {
<a name="l03244"></a>03244         <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l03245"></a>03245             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>);
<a name="l03246"></a>03246 
<a name="l03247"></a>03247             <span class="comment">/* Link ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l03248"></a>03248 <span class="comment">             * of library blocks that implement this.*/</span>
<a name="l03249"></a>03249             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l03250"></a>03250 
<a name="l03251"></a>03251             ma-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ma-&gt;ipo);
<a name="l03252"></a>03252             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a67df82e791d0a7e8d62425b4d2cbc364">group</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a67df82e791d0a7e8d62425b4d2cbc364">group</a>);
<a name="l03253"></a>03253             
<a name="l03254"></a>03254             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l03255"></a>03255                 mtex= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a];
<a name="l03256"></a>03256                 <span class="keywordflow">if</span> (mtex) {
<a name="l03257"></a>03257                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l03258"></a>03258                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l03259"></a>03259                 }
<a name="l03260"></a>03260             }
<a name="l03261"></a>03261             
<a name="l03262"></a>03262             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l03263"></a>03263                 <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(fd, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l03264"></a>03264             
<a name="l03265"></a>03265             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l03266"></a>03266         }
<a name="l03267"></a>03267         ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l03268"></a>03268     }
<a name="l03269"></a>03269 }
<a name="l03270"></a>03270 
<a name="l03271"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae712d05f2bc5d9b93d092f2566bd41b0">03271</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ae712d05f2bc5d9b93d092f2566bd41b0">direct_link_material</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma)
<a name="l03272"></a>03272 {
<a name="l03273"></a>03273     <span class="keywordtype">int</span> a;
<a name="l03274"></a>03274 
<a name="l03275"></a>03275     ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>);
<a name="l03276"></a>03276     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>);
<a name="l03277"></a>03277     
<a name="l03278"></a>03278     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l03279"></a>03279         ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]);
<a name="l03280"></a>03280     }
<a name="l03281"></a>03281 
<a name="l03282"></a>03282     ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a64069c881aa121bf9faa495da7768b5f">ramp_col</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a64069c881aa121bf9faa495da7768b5f">ramp_col</a>);
<a name="l03283"></a>03283     ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a60395437e9ccda837921ab3bfa8e009c">ramp_spec</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a60395437e9ccda837921ab3bfa8e009c">ramp_spec</a>);
<a name="l03284"></a>03284     
<a name="l03285"></a>03285     ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l03286"></a>03286     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l03287"></a>03287         <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l03288"></a>03288 
<a name="l03289"></a>03289     ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a59344162eb206d2d639fc13df892c153">preview</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aa15084429fd84d67347973729170c871">direct_link_preview_image</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a59344162eb206d2d639fc13df892c153">preview</a>);
<a name="l03290"></a>03290     ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa520df46803a0ee7d873664f2f1b74d0">gpumaterial</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa520df46803a0ee7d873664f2f1b74d0">gpumaterial</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03291"></a>03291 }
<a name="l03292"></a>03292 
<a name="l03293"></a>03293 <span class="comment">/* ************ READ PARTICLE SETTINGS ***************** */</span>
<a name="l03294"></a>03294 <span class="comment">/* update this also to writefile.c */</span>
<a name="l03295"></a><a class="code" href="../../d0/d12/readfile_8c.html#abe729f5b3b9c12c02a97324c0b937553">03295</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d12/readfile_8c.html#abe729f5b3b9c12c02a97324c0b937553">ptcache_data_struct</a>[] = {
<a name="l03296"></a>03296     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_INDEX</span>
<a name="l03297"></a>03297     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_LOCATION</span>
<a name="l03298"></a>03298     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_VELOCITY</span>
<a name="l03299"></a>03299     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_ROTATION</span>
<a name="l03300"></a>03300     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_AVELOCITY / BPHYS_DATA_XCONST */</span>
<a name="l03301"></a>03301     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_SIZE:</span>
<a name="l03302"></a>03302     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_TIMES:    </span>
<a name="l03303"></a>03303     <span class="stringliteral">&quot;BoidData&quot;</span> <span class="comment">// case BPHYS_DATA_BOIDS:</span>
<a name="l03304"></a>03304 };
<a name="l03305"></a><a class="code" href="../../d0/d12/readfile_8c.html#a16692dbddc2355b370fc4a9777ee3028">03305</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a16692dbddc2355b370fc4a9777ee3028">direct_link_pointcache</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d83/structPointCache.html">PointCache</a> *cache)
<a name="l03306"></a>03306 {
<a name="l03307"></a>03307     <span class="keywordflow">if</span> ((cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4dfd845afe48aca448b8bbcef971cc5d">PTCACHE_DISK_CACHE</a>)==0) {
<a name="l03308"></a>03308         <a class="code" href="../../d0/d5b/structPTCacheMem.html">PTCacheMem</a> *pm;
<a name="l03309"></a>03309         <a class="code" href="../../d2/d97/structPTCacheExtra.html">PTCacheExtra</a> *extra;
<a name="l03310"></a>03310         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03311"></a>03311 
<a name="l03312"></a>03312         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a52981831e4870022ca700f626e4aae02">mem_cache</a>);
<a name="l03313"></a>03313 
<a name="l03314"></a>03314         pm = cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a52981831e4870022ca700f626e4aae02">mem_cache</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03315"></a>03315 
<a name="l03316"></a>03316         <span class="keywordflow">for</span> (; pm; pm=pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#aae9b8467a9815e66d4568c26d7569196">next</a>) {
<a name="l03317"></a>03317             <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#ad17b7c27ab6c314200ba5b6fe5d59e41">BPHYS_TOT_DATA</a>; i++) {
<a name="l03318"></a>03318                 pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[i]);
<a name="l03319"></a>03319                 
<a name="l03320"></a>03320                 <span class="comment">/* the cache saves non-struct data without DNA */</span>
<a name="l03321"></a>03321                 <span class="keywordflow">if</span> (pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[i] &amp;&amp; ptcache_data_struct[i][0]==<span class="charliteral">&#39;\0&#39;</span> &amp;&amp; (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>)) {
<a name="l03322"></a>03322                     <span class="keywordtype">int</span> j, tot= (<a class="code" href="../../db/d45/BKE__pointcache_8h.html#a03341cb500421a27b0452309677c0610">BKE_ptcache_data_size</a> (i) * pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#aeddf4801bb286f61979cfc4a757a42fc">totpoint</a>)/4; <span class="comment">/* data_size returns bytes */</span>
<a name="l03323"></a>03323                     <span class="keywordtype">int</span> *poin= pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l03324"></a>03324                     
<a name="l03325"></a>03325                     <span class="keywordflow">for</span> (j= 0; j&lt;tot; j++)
<a name="l03326"></a>03326                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(poin[j]);
<a name="l03327"></a>03327                 }
<a name="l03328"></a>03328             }
<a name="l03329"></a>03329             
<a name="l03330"></a>03330             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a85b85c1fd14f7a8d9c467857ae274907">extradata</a>);
<a name="l03331"></a>03331 
<a name="l03332"></a>03332             <span class="keywordflow">for</span> (extra=pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a85b85c1fd14f7a8d9c467857ae274907">extradata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; extra; extra=extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a652f1bab30cf02b3519b372fc168c5bf">next</a>)
<a name="l03333"></a>03333                 extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a1cd2313d6b40822712c6d68e0ca2161e">data</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a1cd2313d6b40822712c6d68e0ca2161e">data</a>);
<a name="l03334"></a>03334         }
<a name="l03335"></a>03335     }
<a name="l03336"></a>03336     <span class="keywordflow">else</span>
<a name="l03337"></a>03337         cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a52981831e4870022ca700f626e4aae02">mem_cache</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a52981831e4870022ca700f626e4aae02">mem_cache</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03338"></a>03338 
<a name="l03339"></a>03339     cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp;= ~<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a45a84cafc6ce610ca944f1883fe2453a">PTCACHE_SIMULATION_VALID</a>;
<a name="l03340"></a>03340     cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#abdbf5f6b87b7cecaa23a0dce74c7ba8e">simframe</a>= 0;
<a name="l03341"></a>03341     cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ad08fe08bc70d9877272ff6cdd8437e32">edit</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03342"></a>03342     cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a44149b9445cd4008c57a7573c852b24b">free_edit</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03343"></a>03343     cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#af0a0e4f7958b9ea1e67ef79b65b0df51">cached_frames</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03344"></a>03344 }
<a name="l03345"></a>03345 
<a name="l03346"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">03346</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">direct_link_pointcache_list</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *ptcaches, <a class="code" href="../../d6/d83/structPointCache.html">PointCache</a> **ocache, <span class="keywordtype">int</span> force_disk)
<a name="l03347"></a>03347 {
<a name="l03348"></a>03348     <span class="keywordflow">if</span> (ptcaches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l03349"></a>03349         <a class="code" href="../../d6/d83/structPointCache.html">PointCache</a> *cache= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03350"></a>03350         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, ptcaches);
<a name="l03351"></a>03351         <span class="keywordflow">for</span> (cache=ptcaches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cache; cache=cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a3689f725d54309e1b00a3b06ac0561a5">next</a>) {
<a name="l03352"></a>03352             <a class="code" href="../../d0/d12/readfile_8c.html#a16692dbddc2355b370fc4a9777ee3028">direct_link_pointcache</a>(fd, cache);
<a name="l03353"></a>03353             <span class="keywordflow">if</span> (force_disk) {
<a name="l03354"></a>03354                 cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> |= <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4dfd845afe48aca448b8bbcef971cc5d">PTCACHE_DISK_CACHE</a>;
<a name="l03355"></a>03355                 cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a45c02298ee93df755a2f14ce5c8e5173">step</a> = 1;
<a name="l03356"></a>03356             }
<a name="l03357"></a>03357         }
<a name="l03358"></a>03358 
<a name="l03359"></a>03359         *ocache = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, *ocache);
<a name="l03360"></a>03360     }
<a name="l03361"></a>03361     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*ocache) {
<a name="l03362"></a>03362         <span class="comment">/* old &quot;single&quot; caches need to be linked too */</span>
<a name="l03363"></a>03363         *ocache = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, *ocache);
<a name="l03364"></a>03364         <a class="code" href="../../d0/d12/readfile_8c.html#a16692dbddc2355b370fc4a9777ee3028">direct_link_pointcache</a>(fd, *ocache);
<a name="l03365"></a>03365         <span class="keywordflow">if</span> (force_disk) {
<a name="l03366"></a>03366             (*ocache)-&gt;flag |= <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4dfd845afe48aca448b8bbcef971cc5d">PTCACHE_DISK_CACHE</a>;
<a name="l03367"></a>03367             (*ocache)-&gt;step = 1;
<a name="l03368"></a>03368         }
<a name="l03369"></a>03369 
<a name="l03370"></a>03370         ptcaches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = ptcaches-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = *ocache;
<a name="l03371"></a>03371     }
<a name="l03372"></a>03372 }
<a name="l03373"></a>03373 
<a name="l03374"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9a082255e121031be5668498ec4b9f57">03374</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a9a082255e121031be5668498ec4b9f57">lib_link_partdeflect</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd)
<a name="l03375"></a>03375 {
<a name="l03376"></a>03376     <span class="keywordflow">if</span> (pd &amp;&amp; pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>)
<a name="l03377"></a>03377         pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>=<a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>);
<a name="l03378"></a>03378 }
<a name="l03379"></a>03379 
<a name="l03380"></a><a class="code" href="../../d0/d12/readfile_8c.html#aac02b96a9129ff4a3588edfc0c2e552d">03380</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aac02b96a9129ff4a3588edfc0c2e552d">lib_link_particlesettings</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l03381"></a>03381 {
<a name="l03382"></a>03382     <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l03383"></a>03383     <a class="code" href="../../d3/dcf/structParticleDupliWeight.html">ParticleDupliWeight</a> *dw;
<a name="l03384"></a>03384     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex;
<a name="l03385"></a>03385     <span class="keywordtype">int</span> a;
<a name="l03386"></a>03386 
<a name="l03387"></a>03387     part= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03388"></a>03388     <span class="keywordflow">while</span> (part) {
<a name="l03389"></a>03389         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l03390"></a>03390             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>);
<a name="l03391"></a>03391             part-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, part-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l03392"></a>03392             
<a name="l03393"></a>03393             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a>);
<a name="l03394"></a>03394             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>);
<a name="l03395"></a>03395             part-&gt;eff_group = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, part-&gt;eff_group);
<a name="l03396"></a>03396             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4558fec04ca4894122276ad8980afc57">bb_ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4558fec04ca4894122276ad8980afc57">bb_ob</a>);
<a name="l03397"></a>03397 
<a name="l03398"></a>03398             <a class="code" href="../../d0/d12/readfile_8c.html#a9a082255e121031be5668498ec4b9f57">lib_link_partdeflect</a>(fd, &amp;part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>);
<a name="l03399"></a>03399             <a class="code" href="../../d0/d12/readfile_8c.html#a9a082255e121031be5668498ec4b9f57">lib_link_partdeflect</a>(fd, &amp;part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>);
<a name="l03400"></a>03400 
<a name="l03401"></a>03401             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>)
<a name="l03402"></a>03402                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a>);
<a name="l03403"></a>03403 
<a name="l03404"></a>03404             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>) {
<a name="l03405"></a>03405                 <span class="keywordtype">int</span> index_ok = 0;
<a name="l03406"></a>03406                 <span class="comment">/* check for old files without indices (all indexes 0) */</span>
<a name="l03407"></a>03407                 dw = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03408"></a>03408                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) {
<a name="l03409"></a>03409                     <span class="comment">/* special case for only one object in the group */</span>
<a name="l03410"></a>03410                     index_ok = 1;
<a name="l03411"></a>03411                 }
<a name="l03412"></a>03412                 <span class="keywordflow">else</span> { 
<a name="l03413"></a>03413                     <span class="keywordflow">for</span> (; dw; dw=dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#affc8c044db3cd1c708731828c8e9743d">next</a>) {
<a name="l03414"></a>03414                         <span class="keywordflow">if</span> (dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#aa373b027f15ca7bb69ea3392fbfaad47">index</a> &gt; 0) {
<a name="l03415"></a>03415                             index_ok = 1;
<a name="l03416"></a>03416                             <span class="keywordflow">break</span>;
<a name="l03417"></a>03417                         }
<a name="l03418"></a>03418                     }
<a name="l03419"></a>03419                 }
<a name="l03420"></a>03420 
<a name="l03421"></a>03421                 <span class="keywordflow">if</span> (index_ok) {
<a name="l03422"></a>03422                     <span class="comment">/* if we have indexes, let&#39;s use them */</span>
<a name="l03423"></a>03423                     dw = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03424"></a>03424                     <span class="keywordflow">for</span> (; dw; dw=dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#affc8c044db3cd1c708731828c8e9743d">next</a>) {
<a name="l03425"></a>03425                         <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go = (<a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>, dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#aa373b027f15ca7bb69ea3392fbfaad47">index</a>);
<a name="l03426"></a>03426                         dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#ad432ad4d7384e0040c2c03ea43bbeb07">ob</a> = go ? go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03427"></a>03427                     }
<a name="l03428"></a>03428                 }
<a name="l03429"></a>03429                 <span class="keywordflow">else</span> {
<a name="l03430"></a>03430                     <span class="comment">/* otherwise try to get objects from own library (won&#39;t work on library linked groups) */</span>
<a name="l03431"></a>03431                     <span class="keywordflow">for</span> (; dw; dw=dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#affc8c044db3cd1c708731828c8e9743d">next</a>)
<a name="l03432"></a>03432                         dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#ad432ad4d7384e0040c2c03ea43bbeb07">ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#ad432ad4d7384e0040c2c03ea43bbeb07">ob</a>);
<a name="l03433"></a>03433                 }
<a name="l03434"></a>03434             }
<a name="l03435"></a>03435             <span class="keywordflow">else</span> {
<a name="l03436"></a>03436                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03437"></a>03437             }
<a name="l03438"></a>03438 
<a name="l03439"></a>03439             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>) {
<a name="l03440"></a>03440                 <a class="code" href="../../db/dfa/structBoidState.html">BoidState</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>-&gt;<a class="code" href="../../dd/d94/structBoidSettings.html#a632b0e4786d070f07183c7659cac4444">states</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03441"></a>03441                 <a class="code" href="../../d5/d08/structBoidRule.html">BoidRule</a> *rule;
<a name="l03442"></a>03442                 <span class="keywordflow">for</span> (; <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>; state=state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ae6d686752198cc7b700f9304cd6d3235">next</a>) {
<a name="l03443"></a>03443                     rule = state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ad8d710f50d63b84e59b358315bc9fa92">rules</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03444"></a>03444                 <span class="keywordflow">for</span> (; rule; rule=rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a707cfdd3651380709dfae04c2b06e76d">next</a>)
<a name="l03445"></a>03445                     <span class="keywordflow">switch</span>(rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a6859c7ccbdf3d1f77e1542a4afa2e1fa">type</a>) {
<a name="l03446"></a>03446                         <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9a567af3edd59fbaac9798e90869c20dad">eBoidRuleType_Goal</a>:
<a name="l03447"></a>03447                         <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ab006cc1f787b3169a73527d00fd64d9d">eBoidRuleType_Avoid</a>:
<a name="l03448"></a>03448                         {
<a name="l03449"></a>03449                             <a class="code" href="../../d7/dec/structBoidRuleGoalAvoid.html">BoidRuleGoalAvoid</a> *brga = (<a class="code" href="../../d7/dec/structBoidRuleGoalAvoid.html">BoidRuleGoalAvoid</a>*)rule;
<a name="l03450"></a>03450                             brga-&gt;<a class="code" href="../../d7/dec/structBoidRuleGoalAvoid.html#ae4a52f34c959038feb72e3faa9d04af1">ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, brga-&gt;<a class="code" href="../../d7/dec/structBoidRuleGoalAvoid.html#ae4a52f34c959038feb72e3faa9d04af1">ob</a>);
<a name="l03451"></a>03451                             <span class="keywordflow">break</span>;
<a name="l03452"></a>03452                         }
<a name="l03453"></a>03453                         <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ad43d583c8f8b59c3bfbed5abcb766d53">eBoidRuleType_FollowLeader</a>:
<a name="l03454"></a>03454                         {
<a name="l03455"></a>03455                             <a class="code" href="../../da/d86/structBoidRuleFollowLeader.html">BoidRuleFollowLeader</a> *brfl = (<a class="code" href="../../da/d86/structBoidRuleFollowLeader.html">BoidRuleFollowLeader</a>*)rule;
<a name="l03456"></a>03456                             brfl-&gt;<a class="code" href="../../da/d86/structBoidRuleFollowLeader.html#a3e778a2af456837abc286f711d83b027">ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, brfl-&gt;<a class="code" href="../../da/d86/structBoidRuleFollowLeader.html#a3e778a2af456837abc286f711d83b027">ob</a>);
<a name="l03457"></a>03457                             <span class="keywordflow">break</span>;
<a name="l03458"></a>03458                         }
<a name="l03459"></a>03459                     }
<a name="l03460"></a>03460                 }
<a name="l03461"></a>03461             }
<a name="l03462"></a>03462             
<a name="l03463"></a>03463             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l03464"></a>03464                 mtex= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a];
<a name="l03465"></a>03465                 <span class="keywordflow">if</span> (mtex) {
<a name="l03466"></a>03466                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l03467"></a>03467                     mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l03468"></a>03468                 }
<a name="l03469"></a>03469             }
<a name="l03470"></a>03470 
<a name="l03471"></a>03471             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l03472"></a>03472         }
<a name="l03473"></a>03473         part= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l03474"></a>03474     }
<a name="l03475"></a>03475 }
<a name="l03476"></a>03476 
<a name="l03477"></a><a class="code" href="../../d0/d12/readfile_8c.html#a12d9991858a1c844ae142e70b6e57704">03477</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a12d9991858a1c844ae142e70b6e57704">direct_link_partdeflect</a>(<a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd)
<a name="l03478"></a>03478 {
<a name="l03479"></a>03479     <span class="keywordflow">if</span> (pd) pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a>=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03480"></a>03480 }
<a name="l03481"></a>03481 
<a name="l03482"></a><a class="code" href="../../d0/d12/readfile_8c.html#a028adce39042967163037ebdd4369b5a">03482</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a028adce39042967163037ebdd4369b5a">direct_link_particlesettings</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part)
<a name="l03483"></a>03483 {
<a name="l03484"></a>03484     <span class="keywordtype">int</span> a;
<a name="l03485"></a>03485     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>);
<a name="l03486"></a>03486     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>);
<a name="l03487"></a>03487     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>);
<a name="l03488"></a>03488 
<a name="l03489"></a>03489     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>);
<a name="l03490"></a>03490     <a class="code" href="../../d0/d12/readfile_8c.html#a12d9991858a1c844ae142e70b6e57704">direct_link_partdeflect</a>(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>);
<a name="l03491"></a>03491     <a class="code" href="../../d0/d12/readfile_8c.html#a12d9991858a1c844ae142e70b6e57704">direct_link_partdeflect</a>(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>);
<a name="l03492"></a>03492 
<a name="l03493"></a>03493     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>);
<a name="l03494"></a>03494     <span class="keywordflow">if</span> (!part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>)
<a name="l03495"></a>03495         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a> = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ad0116e11e09f0615cc817f48a9557e85">BKE_add_effector_weights</a>(part-&gt;eff_group);
<a name="l03496"></a>03496 
<a name="l03497"></a>03497     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>);
<a name="l03498"></a>03498 
<a name="l03499"></a>03499     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>);
<a name="l03500"></a>03500     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ada8ff094092deeef0d812a97ab310a08">fluid</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ada8ff094092deeef0d812a97ab310a08">fluid</a>);
<a name="l03501"></a>03501 
<a name="l03502"></a>03502     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>) {
<a name="l03503"></a>03503         <a class="code" href="../../db/dfa/structBoidState.html">BoidState</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l03504"></a>03504         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>-&gt;<a class="code" href="../../dd/d94/structBoidSettings.html#a632b0e4786d070f07183c7659cac4444">states</a>);
<a name="l03505"></a>03505         
<a name="l03506"></a>03506         <span class="keywordflow">for</span> (state=part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>-&gt;<a class="code" href="../../dd/d94/structBoidSettings.html#a632b0e4786d070f07183c7659cac4444">states</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; state; state=state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ae6d686752198cc7b700f9304cd6d3235">next</a>) {
<a name="l03507"></a>03507             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ad8d710f50d63b84e59b358315bc9fa92">rules</a>);
<a name="l03508"></a>03508             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#a0d639fd9f3715ef5263248d2256f52d9">conditions</a>);
<a name="l03509"></a>03509             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ab91a4674f05b56ad12c98ce738ca8dc6">actions</a>);
<a name="l03510"></a>03510         }
<a name="l03511"></a>03511     }
<a name="l03512"></a>03512     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l03513"></a>03513         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]);
<a name="l03514"></a>03514     }
<a name="l03515"></a>03515 }
<a name="l03516"></a>03516 
<a name="l03517"></a><a class="code" href="../../d0/d12/readfile_8c.html#a02accca21ab1b5950aa0950369815dae">03517</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a02accca21ab1b5950aa0950369815dae">lib_link_particlesystems</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *particles)
<a name="l03518"></a>03518 {
<a name="l03519"></a>03519     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys, *psysnext;
<a name="l03520"></a>03520 
<a name="l03521"></a>03521     <span class="keywordflow">for</span> (psys=particles-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psysnext) {
<a name="l03522"></a>03522         psysnext= psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>;
<a name="l03523"></a>03523         
<a name="l03524"></a>03524         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>);
<a name="l03525"></a>03525         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>) {
<a name="l03526"></a>03526             <a class="code" href="../../df/db9/structParticleTarget.html">ParticleTarget</a> *pt = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a37c37da2c9bb6301d50a6133d00b6b75">targets</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03527"></a>03527 
<a name="l03528"></a>03528             <span class="keywordflow">for</span> (; pt; pt=pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a6643a6f60f33e21a80a82e6140ddcbcc">next</a>)
<a name="l03529"></a>03529                 pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a0b60fbd359436e5c221a0f4a719defd4">ob</a>=<a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a0b60fbd359436e5c221a0f4a719defd4">ob</a>);
<a name="l03530"></a>03530 
<a name="l03531"></a>03531             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ac31ded3785aa33d38c83e1dc93156fea">parent</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ac31ded3785aa33d38c83e1dc93156fea">parent</a>);
<a name="l03532"></a>03532             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a93d4eeedae12a40267d140e93d0182e1">target_ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a93d4eeedae12a40267d140e93d0182e1">target_ob</a>);
<a name="l03533"></a>03533 
<a name="l03534"></a>03534             <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>) {
<a name="l03535"></a>03535                 <span class="comment">/* XXX - from reading existing code this seems correct but intended usage of</span>
<a name="l03536"></a>03536 <span class="comment">                 * pointcache should /w cloth should be added in &#39;ParticleSystem&#39; - campbell */</span>
<a name="l03537"></a>03537                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a77605f4a26c5077252abce50377e3de9">point_cache</a>= psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>;
<a name="l03538"></a>03538                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a2bfdb45d82b0577deb1cdd5f879e931c">ptcaches</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a2bfdb45d82b0577deb1cdd5f879e931c">ptcaches</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03539"></a>03539                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>-&gt;<a class="code" href="../../dc/db4/structClothCollSettings.html#ab2dcf5e2ae1cb2d78c62db328c7e8b7d">group</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>-&gt;<a class="code" href="../../dc/db4/structClothCollSettings.html#ab2dcf5e2ae1cb2d78c62db328c7e8b7d">group</a>);
<a name="l03540"></a>03540             }
<a name="l03541"></a>03541         }
<a name="l03542"></a>03542         <span class="keywordflow">else</span> {
<a name="l03543"></a>03543             <span class="comment">/* particle modifier must be removed before particle system */</span>
<a name="l03544"></a>03544             <a class="code" href="../../d7/da3/structParticleSystemModifierData.html">ParticleSystemModifierData</a> *psmd= <a class="code" href="../../db/dca/BKE__particle_8h.html#abb46b353cec8d54be258c683d352fc1d">psys_get_modifier</a>(ob,psys);
<a name="l03545"></a>03545             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, psmd);
<a name="l03546"></a>03546             <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#af99045dd8ec74c199d93a9090781b078">modifier_free</a>((<a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *)psmd);
<a name="l03547"></a>03547 
<a name="l03548"></a>03548             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(particles, psys);
<a name="l03549"></a>03549             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(psys);
<a name="l03550"></a>03550         }
<a name="l03551"></a>03551     }
<a name="l03552"></a>03552 }
<a name="l03553"></a><a class="code" href="../../d0/d12/readfile_8c.html#af4c21de878c55bdf8e024a6d3ca94eb0">03553</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af4c21de878c55bdf8e024a6d3ca94eb0">direct_link_particlesystems</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *particles)
<a name="l03554"></a>03554 {
<a name="l03555"></a>03555     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l03556"></a>03556     <a class="code" href="../../dc/d76/structParticleData.html">ParticleData</a> *pa;
<a name="l03557"></a>03557     <span class="keywordtype">int</span> a;
<a name="l03558"></a>03558 
<a name="l03559"></a>03559     <span class="keywordflow">for</span> (psys=particles-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l03560"></a>03560         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>=<a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd,psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>);
<a name="l03561"></a>03561         
<a name="l03562"></a>03562         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a6d1bcac455641baf1d02cede42894902">hair</a>) {
<a name="l03563"></a>03563             <span class="keywordflow">for</span> (a=0,pa=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>; a&lt;psys-&gt;totpart; a++, pa++)
<a name="l03564"></a>03564                 pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a6d1bcac455641baf1d02cede42894902">hair</a>=<a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd,pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a6d1bcac455641baf1d02cede42894902">hair</a>);
<a name="l03565"></a>03565         }
<a name="l03566"></a>03566         
<a name="l03567"></a>03567         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>-&gt;<a class="code" href="../../dc/d76/structParticleData.html#aa3c5aa86180461633245493c22458c92">keys</a>) {
<a name="l03568"></a>03568             <span class="keywordflow">for</span> (a=0,pa=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>; a&lt;psys-&gt;totpart; a++, pa++) {
<a name="l03569"></a>03569                 pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#aa3c5aa86180461633245493c22458c92">keys</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03570"></a>03570                 pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a8ca52533a1433a54399e1d9edbad7d85">totkey</a>= 0;
<a name="l03571"></a>03571             }
<a name="l03572"></a>03572 
<a name="l03573"></a>03573             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a947c785248ab9746099a34c8bc093e8f">flag</a> &amp;= ~<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a789523a2c52fbcea1f0dd066be9895d2">PSYS_KEYED</a>;
<a name="l03574"></a>03574         }
<a name="l03575"></a>03575 
<a name="l03576"></a>03576         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a>) {
<a name="l03577"></a>03577             pa = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>;
<a name="l03578"></a>03578             pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a>);
<a name="l03579"></a>03579             <span class="keywordflow">for</span> (a=1,pa++; a&lt;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>; a++, pa++)
<a name="l03580"></a>03580                 pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a> = (pa-1)-&gt;boid + 1;
<a name="l03581"></a>03581         }
<a name="l03582"></a>03582         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>) {
<a name="l03583"></a>03583             <span class="keywordflow">for</span> (a=0,pa=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>; a&lt;psys-&gt;totpart; a++, pa++)
<a name="l03584"></a>03584                 pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03585"></a>03585         }
<a name="l03586"></a>03586 
<a name="l03587"></a>03587         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0809cf17c48f503b178fbf788c0f0235">fluid_springs</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0809cf17c48f503b178fbf788c0f0235">fluid_springs</a>);
<a name="l03588"></a>03588 
<a name="l03589"></a>03589         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0b2c69153aaaa2095eef823b6f030713">child</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd,psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0b2c69153aaaa2095eef823b6f030713">child</a>);
<a name="l03590"></a>03590         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a530bbae7c2226da0cdfc6c52878cf547">effectors</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03591"></a>03591 
<a name="l03592"></a>03592         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a37c37da2c9bb6301d50a6133d00b6b75">targets</a>);
<a name="l03593"></a>03593 
<a name="l03594"></a>03594         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a102cd0af2e10a5d6f931a4a80555ed8d">edit</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03595"></a>03595         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a7ea15da16f08ff149ba679d663cf0276">free_edit</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03596"></a>03596         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ae097f6afc34289ef7ef3a6d6741070ad">pathcache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03597"></a>03597         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aa4bf1fe43162b6ea089fdd908773ec94">childcache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03598"></a>03598         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab871b59965ff62d64418ff2e3cdfe835">pathcachebufs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab871b59965ff62d64418ff2e3cdfe835">pathcachebufs</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03599"></a>03599         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#acd0932308f149bc2b212ceeb51b16c9a">childcachebufs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#acd0932308f149bc2b212ceeb51b16c9a">childcachebufs</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03600"></a>03600         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a9e871fb24c237a07bca3960686921a4a">frand</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03601"></a>03601         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03602"></a>03602         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a86a9ed5baa3079474b611e98979c0928">renderdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03603"></a>03603         
<a name="l03604"></a>03604         <a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">direct_link_pointcache_list</a>(fd, &amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a18021dc0203ac6bfb44d306d7a008989">ptcaches</a>, &amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>, 0);
<a name="l03605"></a>03605 
<a name="l03606"></a>03606         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>) {
<a name="l03607"></a>03607             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>);
<a name="l03608"></a>03608             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a73cb41a7ce0ccf4ee8d5c6597307702e">clothObject</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03609"></a>03609             
<a name="l03610"></a>03610             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>);
<a name="l03611"></a>03611             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03612"></a>03612             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>);
<a name="l03613"></a>03613             
<a name="l03614"></a>03614             <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>) {
<a name="l03615"></a>03615                 <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a21b41493ef8aa28318d73bb13b6fe0bb">presets</a> &gt; 10)
<a name="l03616"></a>03616                     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a21b41493ef8aa28318d73bb13b6fe0bb">presets</a> = 0;
<a name="l03617"></a>03617             }
<a name="l03618"></a>03618 
<a name="l03619"></a>03619             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aa30d2b6e32316a34c46f4a66719b733f">hair_in_dm</a> = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#acbfc4717258b006bccf5053182147e56">hair_out_dm</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03620"></a>03620 
<a name="l03621"></a>03621             psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a77605f4a26c5077252abce50377e3de9">point_cache</a> = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>;
<a name="l03622"></a>03622         }
<a name="l03623"></a>03623 
<a name="l03624"></a>03624         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#abdfe77a522a61ab1e124508fa0956d6e">tree</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03625"></a>03625         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a8002f8acdbcdb23dfc28598368a1292f">bvhtree</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03626"></a>03626     }
<a name="l03627"></a>03627     <span class="keywordflow">return</span>;
<a name="l03628"></a>03628 }
<a name="l03629"></a>03629 
<a name="l03630"></a>03630 <span class="comment">/* ************ READ MESH ***************** */</span>
<a name="l03631"></a>03631 
<a name="l03632"></a><a class="code" href="../../d0/d12/readfile_8c.html#a065fce7e3ba99f06dec53d58bc675bb0">03632</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a065fce7e3ba99f06dec53d58bc675bb0">lib_link_mtface</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a> *mtface, <span class="keywordtype">int</span> totface)
<a name="l03633"></a>03633 {
<a name="l03634"></a>03634     <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a> *tf= mtface;
<a name="l03635"></a>03635     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03636"></a>03636 
<a name="l03637"></a>03637     <span class="comment">/* Add pseudo-references (not fake users!) to images used by texface. A</span>
<a name="l03638"></a>03638 <span class="comment">     * little bogus; it would be better if each mesh consistently added one ref</span>
<a name="l03639"></a>03639 <span class="comment">     * to each image it used. - z0r */</span>
<a name="l03640"></a>03640     <span class="keywordflow">for</span> (i=0; i&lt;totface; i++, tf++) {
<a name="l03641"></a>03641         tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>);
<a name="l03642"></a>03642         <span class="keywordflow">if</span> (tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a> &amp;&amp; tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==0)
<a name="l03643"></a>03643             tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l03644"></a>03644     }
<a name="l03645"></a>03645 }
<a name="l03646"></a>03646 
<a name="l03647"></a><a class="code" href="../../d0/d12/readfile_8c.html#a7f5624828349d53cee904531fdc67783">03647</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a7f5624828349d53cee904531fdc67783">lib_link_customdata_mtface</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <a class="code" href="../../df/d04/structCustomData.html">CustomData</a> *fdata, <span class="keywordtype">int</span> totface)
<a name="l03648"></a>03648 {
<a name="l03649"></a>03649     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;  
<a name="l03650"></a>03650     <span class="keywordflow">for</span> (i=0; i&lt;fdata-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; i++) {
<a name="l03651"></a>03651         <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer = &amp;fdata-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l03652"></a>03652         
<a name="l03653"></a>03653         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#af23f4c9ba200ae24e0a1ac80464e7b21">CD_MTFACE</a>)
<a name="l03654"></a>03654             <a class="code" href="../../d0/d12/readfile_8c.html#a065fce7e3ba99f06dec53d58bc675bb0">lib_link_mtface</a>(fd, me, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>, totface);
<a name="l03655"></a>03655     }
<a name="l03656"></a>03656 
<a name="l03657"></a>03657 }
<a name="l03658"></a>03658 
<a name="l03659"></a><a class="code" href="../../d0/d12/readfile_8c.html#aef35832f22245c40002d372617fadbb6">03659</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aef35832f22245c40002d372617fadbb6">lib_link_customdata_mtpoly</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <a class="code" href="../../df/d04/structCustomData.html">CustomData</a> *pdata, <span class="keywordtype">int</span> totface)
<a name="l03660"></a>03660 {
<a name="l03661"></a>03661     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03662"></a>03662 
<a name="l03663"></a>03663     <span class="keywordflow">for</span> (i=0; i&lt;pdata-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; i++) {
<a name="l03664"></a>03664         <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer = &amp;pdata-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l03665"></a>03665         
<a name="l03666"></a>03666         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>) {
<a name="l03667"></a>03667             <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf= layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>;
<a name="l03668"></a>03668             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03669"></a>03669 
<a name="l03670"></a>03670             <span class="keywordflow">for</span> (i=0; i&lt;totface; i++, tf++) {
<a name="l03671"></a>03671                 tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>);
<a name="l03672"></a>03672                 <span class="keywordflow">if</span> (tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a> &amp;&amp; tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==0)
<a name="l03673"></a>03673                     tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l03674"></a>03674             }
<a name="l03675"></a>03675         }
<a name="l03676"></a>03676     }
<a name="l03677"></a>03677 }
<a name="l03678"></a>03678 
<a name="l03679"></a><a class="code" href="../../d0/d12/readfile_8c.html#a45a57114eca6884bd4e9b14943496391">03679</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a45a57114eca6884bd4e9b14943496391">lib_link_mesh</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l03680"></a>03680 {
<a name="l03681"></a>03681     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l03682"></a>03682 
<a name="l03683"></a>03683     me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03684"></a>03684     <span class="keywordflow">while</span> (me) {
<a name="l03685"></a>03685         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l03686"></a>03686             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03687"></a>03687 
<a name="l03688"></a>03688             <span class="comment">/* Link ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l03689"></a>03689 <span class="comment">             * of library blocks that implement this.*/</span>
<a name="l03690"></a>03690             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l03691"></a>03691             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>);
<a name="l03692"></a>03692 
<a name="l03693"></a>03693             <span class="comment">/* this check added for python created meshes */</span>
<a name="l03694"></a>03694             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>) {
<a name="l03695"></a>03695                 <span class="keywordflow">for</span> (i=0; i&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>; i++) {
<a name="l03696"></a>03696                     me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[i]);
<a name="l03697"></a>03697                 }
<a name="l03698"></a>03698             }
<a name="l03699"></a>03699             <span class="keywordflow">else</span> me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>= 0;
<a name="l03700"></a>03700 
<a name="l03701"></a>03701             me-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, me-&gt;ipo);
<a name="l03702"></a>03702             me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>);
<a name="l03703"></a>03703             me-&gt;<a class="code" href="../../da/d29/structMesh.html#a129e37fe8312d017a74c44f1b508e1d4">texcomesh</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a129e37fe8312d017a74c44f1b508e1d4">texcomesh</a>);
<a name="l03704"></a>03704 
<a name="l03705"></a>03705             <a class="code" href="../../d0/d12/readfile_8c.html#a7f5624828349d53cee904531fdc67783">lib_link_customdata_mtface</a>(fd, me, &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l03706"></a>03706             <a class="code" href="../../d0/d12/readfile_8c.html#aef35832f22245c40002d372617fadbb6">lib_link_customdata_mtpoly</a>(fd, me, &amp;me-&gt;pdata, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>);
<a name="l03707"></a>03707             <span class="keywordflow">if</span> (me-&gt;mr &amp;&amp; me-&gt;mr-&gt;levels.first)
<a name="l03708"></a>03708                 <a class="code" href="../../d0/d12/readfile_8c.html#a7f5624828349d53cee904531fdc67783">lib_link_customdata_mtface</a>(fd, me, &amp;me-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>,
<a name="l03709"></a>03709                                ((<a class="code" href="../../db/d78/structMultiresLevel.html">MultiresLevel</a>*)me-&gt;mr-&gt;levels.first)-&gt;totface);
<a name="l03710"></a>03710 
<a name="l03711"></a>03711             <span class="comment">/*check if we need to convert mfaces to mpolys*/</span>
<a name="l03712"></a>03712             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> &amp;&amp; !me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>) {
<a name="l03713"></a>03713                 <span class="comment">/* temporarily switch main so that reading from</span>
<a name="l03714"></a>03714 <span class="comment">                 * external CustomData works */</span>
<a name="l03715"></a>03715                 <a class="code" href="../../d0/dc0/structMain.html">Main</a> *gmain = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l03716"></a>03716                 <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main = <a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>;
<a name="l03717"></a>03717                 
<a name="l03718"></a>03718                 <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a645f16d2719f8c139e5b37feb5329f4e">BKE_mesh_convert_mfaces_to_mpolys</a>(me);
<a name="l03719"></a>03719 
<a name="l03720"></a>03720                 <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main = gmain;
<a name="l03721"></a>03721             }
<a name="l03722"></a>03722             
<a name="l03723"></a>03723             <span class="comment">/*</span>
<a name="l03724"></a>03724 <span class="comment">             * Re-tessellate, even if the polys were just created from tessfaces, this</span>
<a name="l03725"></a>03725 <span class="comment">             * is important because it:</span>
<a name="l03726"></a>03726 <span class="comment">             *  - fill the CD_POLYINDEX layer</span>
<a name="l03727"></a>03727 <span class="comment">             *  - gives consistency of tessface between loading from a file and</span>
<a name="l03728"></a>03728 <span class="comment">             *    converting an edited BMesh back into a mesh (i.e. it replaces</span>
<a name="l03729"></a>03729 <span class="comment">             *    quad tessfaces in a loaded mesh immediately, instead of lazily</span>
<a name="l03730"></a>03730 <span class="comment">             *    waiting until edit mode has been entered/exited, making it easier</span>
<a name="l03731"></a>03731 <span class="comment">             *    to recognize problems that would otherwise only show up after edits).</span>
<a name="l03732"></a>03732 <span class="comment">             */</span>
<a name="l03733"></a>03733 <span class="preprocessor">#ifdef USE_TESSFACE_DEFAULT</span>
<a name="l03734"></a>03734 <span class="preprocessor"></span>            <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a935b5b7d16979aed31099dc7024bdbab">BKE_mesh_tessface_calc</a>(me);
<a name="l03735"></a>03735 <span class="preprocessor">#else</span>
<a name="l03736"></a>03736 <span class="preprocessor"></span>            <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a1973aa37f3dab5010ed30dfc70a0d9dc">BKE_mesh_tessface_clear</a>(me);
<a name="l03737"></a>03737 <span class="preprocessor">#endif</span>
<a name="l03738"></a>03738 <span class="preprocessor"></span>
<a name="l03739"></a>03739             me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l03740"></a>03740         }
<a name="l03741"></a>03741         me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l03742"></a>03742     }
<a name="l03743"></a>03743 
<a name="l03744"></a>03744     <span class="comment">/* convert texface options to material */</span>
<a name="l03745"></a>03745     <a class="code" href="../../d0/d12/readfile_8c.html#a1b009f10b5ef8343572988700dca90b3">convert_tface_mt</a>(fd, main);
<a name="l03746"></a>03746 }
<a name="l03747"></a>03747 
<a name="l03748"></a><a class="code" href="../../d0/d12/readfile_8c.html#a65f81267d6ae42fa5b920788439a565a">03748</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a65f81267d6ae42fa5b920788439a565a">direct_link_dverts</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">int</span> count, <a class="code" href="../../dc/d0d/structMDeformVert.html">MDeformVert</a> *mdverts)
<a name="l03749"></a>03749 {
<a name="l03750"></a>03750     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03751"></a>03751 
<a name="l03752"></a>03752     <span class="keywordflow">if</span> (mdverts == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l03753"></a>03753         <span class="keywordflow">return</span>;
<a name="l03754"></a>03754     }
<a name="l03755"></a>03755 
<a name="l03756"></a>03756     <span class="keywordflow">for</span> (i= count; i &gt; 0; i--, mdverts++) {
<a name="l03757"></a>03757         <span class="comment">/*convert to vgroup allocation system*/</span>
<a name="l03758"></a>03758         <a class="code" href="../../da/d40/structMDeformWeight.html">MDeformWeight</a> *dw;
<a name="l03759"></a>03759         <span class="keywordflow">if</span> (mdverts-&gt;<a class="code" href="../../dc/d0d/structMDeformVert.html#ab98ee24da5fda5ac02eb30e5d1c928ed">dw</a> &amp;&amp; (dw= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mdverts-&gt;<a class="code" href="../../dc/d0d/structMDeformVert.html#ab98ee24da5fda5ac02eb30e5d1c928ed">dw</a>))) {
<a name="l03760"></a>03760             <span class="keyword">const</span> <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#a831c6b6852c6d34448e30a88c34539fd">ssize_t</a> dw_len= mdverts-&gt;<a class="code" href="../../dc/d0d/structMDeformVert.html#ae476e4275af2828e273dad024e40a4c3">totweight</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac652b0016072116c7a12579f5c23c645">MDeformWeight</a>);
<a name="l03761"></a>03761             <span class="keywordtype">void</span> *dw_tmp= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(dw_len, <span class="stringliteral">&quot;direct_link_dverts&quot;</span>);
<a name="l03762"></a>03762             memcpy(dw_tmp, dw, dw_len);
<a name="l03763"></a>03763             mdverts-&gt;<a class="code" href="../../dc/d0d/structMDeformVert.html#ab98ee24da5fda5ac02eb30e5d1c928ed">dw</a>= dw_tmp;
<a name="l03764"></a>03764             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(dw);
<a name="l03765"></a>03765         }
<a name="l03766"></a>03766         <span class="keywordflow">else</span> {
<a name="l03767"></a>03767             mdverts-&gt;<a class="code" href="../../dc/d0d/structMDeformVert.html#ab98ee24da5fda5ac02eb30e5d1c928ed">dw</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03768"></a>03768             mdverts-&gt;<a class="code" href="../../dc/d0d/structMDeformVert.html#ae476e4275af2828e273dad024e40a4c3">totweight</a>= 0;
<a name="l03769"></a>03769         }
<a name="l03770"></a>03770     }
<a name="l03771"></a>03771 }
<a name="l03772"></a>03772 
<a name="l03773"></a><a class="code" href="../../d0/d12/readfile_8c.html#aabd150d01474ca9a850c47ccaf6e9199">03773</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aabd150d01474ca9a850c47ccaf6e9199">direct_link_mdisps</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">int</span> count, <a class="code" href="../../da/d81/structMDisps.html">MDisps</a> *mdisps, <span class="keywordtype">int</span> external)
<a name="l03774"></a>03774 {
<a name="l03775"></a>03775     <span class="keywordflow">if</span> (mdisps) {
<a name="l03776"></a>03776         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03777"></a>03777 
<a name="l03778"></a>03778         <span class="keywordflow">for</span> (i = 0; i &lt; count; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l03779"></a>03779             mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#a074f759a552afe40fba57e3069249e27">disps</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mdisps[i].disps);
<a name="l03780"></a>03780             mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#a2f831907f51e69b0b0a3efe4a8f1776a">hidden</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mdisps[i].hidden);
<a name="l03781"></a>03781 
<a name="l03782"></a>03782             <span class="keywordflow">if</span> (mdisps[i].totdisp &amp;&amp; !mdisps[i].level) {
<a name="l03783"></a>03783                 <span class="comment">/* this calculation is only correct for loop mdisps;</span>
<a name="l03784"></a>03784 <span class="comment">                 * if loading pre-BMesh face mdisps this will be</span>
<a name="l03785"></a>03785 <span class="comment">                 * overwritten with the correct value in</span>
<a name="l03786"></a>03786 <span class="comment">                 * bm_corners_to_loops() */</span>
<a name="l03787"></a>03787                 <span class="keywordtype">float</span> gridsize = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(mdisps[i].totdisp);
<a name="l03788"></a>03788                 mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#a95e9bed7045e91c5519f32008f7aafbf">level</a> = (int)(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a85962e624e1b5fdeacb6d0cb257ae715">logf</a>(gridsize - 1.0f) / <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a92428112a5d24721208748774a4f23e6">M_LN2</a>) + 1;
<a name="l03789"></a>03789             }
<a name="l03790"></a>03790 
<a name="l03791"></a>03791             <span class="keywordflow">if</span> ( (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) &amp;&amp; (mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#a074f759a552afe40fba57e3069249e27">disps</a>) ) {
<a name="l03792"></a>03792                 <span class="comment">/* DNA_struct_switch_endian doesn&#39;t do endian swap for (*disps)[] */</span>
<a name="l03793"></a>03793                 <span class="comment">/* this does swap for data written at write_mdisps() - readfile.c */</span>
<a name="l03794"></a>03794                 <span class="keywordtype">int</span> x;
<a name="l03795"></a>03795                 <span class="keywordtype">float</span> *tmpdisps= *mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#a074f759a552afe40fba57e3069249e27">disps</a>;
<a name="l03796"></a>03796                 <span class="keywordflow">for</span> (x=0;x&lt;mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#aa761cd4860d10148af662dffee5e0ce5">totdisp</a>*3;x++) {
<a name="l03797"></a>03797                     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(*tmpdisps);
<a name="l03798"></a>03798                     tmpdisps++;
<a name="l03799"></a>03799                 }
<a name="l03800"></a>03800             }
<a name="l03801"></a>03801             <span class="keywordflow">if</span> (!external &amp;&amp; !mdisps[i].disps)
<a name="l03802"></a>03802                 mdisps[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../da/d81/structMDisps.html#aa761cd4860d10148af662dffee5e0ce5">totdisp</a> = 0;
<a name="l03803"></a>03803         }
<a name="l03804"></a>03804     }
<a name="l03805"></a>03805 }
<a name="l03806"></a>03806 
<a name="l03807"></a>03807 <span class="comment">/*this isn&#39;t really a public api function, so prototyped here*/</span>
<a name="l03808"></a><a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">03808</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../df/d04/structCustomData.html">CustomData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> count)
<a name="l03809"></a>03809 {
<a name="l03810"></a>03810     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l03811"></a>03811 
<a name="l03812"></a>03812     data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>);
<a name="l03813"></a>03813 
<a name="l03814"></a>03814     <span class="comment">/* annoying workaround for bug [#31079] loading legacy files with</span>
<a name="l03815"></a>03815 <span class="comment">     * no polygons _but_ have stale customdata */</span>
<a name="l03816"></a>03816     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a>(count == 0 &amp;&amp; data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a> != 0)) {
<a name="l03817"></a>03817         memset(data, 0, <span class="keyword">sizeof</span>(*data));
<a name="l03818"></a>03818         <span class="keywordflow">return</span>;
<a name="l03819"></a>03819     }
<a name="l03820"></a>03820 
<a name="l03821"></a>03821     data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae34ce54cf42df29842f387e8a27d34c4">external</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae34ce54cf42df29842f387e8a27d34c4">external</a>);
<a name="l03822"></a>03822 
<a name="l03823"></a>03823     <span class="keywordflow">while</span> (i &lt; data-&gt;totlayer) {
<a name="l03824"></a>03824         <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer = &amp;data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l03825"></a>03825 
<a name="l03826"></a>03826         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a8838b5a61a319759037c096d6b8d9887">flag</a> &amp; <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#ad4dfcdb69890db690267ef52a39245f6">CD_FLAG_EXTERNAL</a>)
<a name="l03827"></a>03827             layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a8838b5a61a319759037c096d6b8d9887">flag</a> &amp;= ~<a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a2ed4917b8758ce7b4f955adf1b5c7a94">CD_FLAG_IN_MEMORY</a>;
<a name="l03828"></a>03828 
<a name="l03829"></a>03829         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a30b99c5789a563eae12e1c7ace447877">CustomData_verify_versions</a>(data, i)) {
<a name="l03830"></a>03830             layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>);
<a name="l03831"></a>03831             <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a85dd305a310931c933a9d0a3fa0a69a4">CD_MDISPS</a>)
<a name="l03832"></a>03832                 <a class="code" href="../../d0/d12/readfile_8c.html#aabd150d01474ca9a850c47ccaf6e9199">direct_link_mdisps</a>(fd, count, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a8838b5a61a319759037c096d6b8d9887">flag</a> &amp; <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#ad4dfcdb69890db690267ef52a39245f6">CD_FLAG_EXTERNAL</a>);
<a name="l03833"></a>03833             i++;
<a name="l03834"></a>03834         }
<a name="l03835"></a>03835     }
<a name="l03836"></a>03836 
<a name="l03837"></a>03837     <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#afdfc40646cb319b9cd07f4281300f5a6">CustomData_update_typemap</a>(data);
<a name="l03838"></a>03838 }
<a name="l03839"></a>03839 
<a name="l03840"></a><a class="code" href="../../d0/d12/readfile_8c.html#adaa08865dc3a94cfafce3d683dd4c55d">03840</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#adaa08865dc3a94cfafce3d683dd4c55d">direct_link_mesh</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *mesh)
<a name="l03841"></a>03841 {
<a name="l03842"></a>03842     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>);
<a name="l03843"></a>03843     <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>);
<a name="l03844"></a>03844 
<a name="l03845"></a>03845     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>);
<a name="l03846"></a>03846     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>);
<a name="l03847"></a>03847     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>);
<a name="l03848"></a>03848     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a>);
<a name="l03849"></a>03849     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>);
<a name="l03850"></a>03850     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>);
<a name="l03851"></a>03851     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a24605886e11f077cf98ad713b1387483">mtface</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a24605886e11f077cf98ad713b1387483">mtface</a>);
<a name="l03852"></a>03852     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>);
<a name="l03853"></a>03853     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a79dc3a13e37ce76df15ae04453a1f58d">msticky</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a79dc3a13e37ce76df15ae04453a1f58d">msticky</a>);
<a name="l03854"></a>03854     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a>);
<a name="l03855"></a>03855     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a42f7770f13a2a1ff5042036eed27edef">mloopcol</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a42f7770f13a2a1ff5042036eed27edef">mloopcol</a>);
<a name="l03856"></a>03856     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a781a2c7601f8f7a00e4ef8f0a904f2e5">mloopuv</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a781a2c7601f8f7a00e4ef8f0a904f2e5">mloopuv</a>);
<a name="l03857"></a>03857     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a33e1a6e421ec6271ac147aea17092ec1">mtpoly</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a33e1a6e421ec6271ac147aea17092ec1">mtpoly</a>);
<a name="l03858"></a>03858     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#af8063586234e2a7297ab9fc730e37e78">mselect</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#af8063586234e2a7297ab9fc730e37e78">mselect</a>);
<a name="l03859"></a>03859 
<a name="l03860"></a>03860     <span class="comment">/* animdata */</span>
<a name="l03861"></a>03861     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>);
<a name="l03862"></a>03862     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>);
<a name="l03863"></a>03863 
<a name="l03864"></a>03864     <span class="comment">/* normally direct_link_dverts should be called in direct_link_customdata,</span>
<a name="l03865"></a>03865 <span class="comment">     * but for backwards compat in do_versions to work we do it here */</span>
<a name="l03866"></a>03866     <a class="code" href="../../d0/d12/readfile_8c.html#a65f81267d6ae42fa5b920788439a565a">direct_link_dverts</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a>);
<a name="l03867"></a>03867 
<a name="l03868"></a>03868     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;vdata, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>);
<a name="l03869"></a>03869     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;edata, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a686df37ba278d2bdc080e4d5a0f70dd5">totedge</a>);
<a name="l03870"></a>03870     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l03871"></a>03871     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>);
<a name="l03872"></a>03872     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;pdata, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>);
<a name="l03873"></a>03873     
<a name="l03874"></a>03874 
<a name="l03875"></a>03875 <span class="preprocessor">#ifdef USE_BMESH_FORWARD_COMPAT</span>
<a name="l03876"></a>03876 <span class="preprocessor"></span>    <span class="comment">/* NEVER ENABLE THIS CODE INTO BMESH!</span>
<a name="l03877"></a>03877 <span class="comment">     * THIS IS FOR LOADING BMESH INTO OLDER FILES ONLY */</span>
<a name="l03878"></a>03878     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>);
<a name="l03879"></a>03879     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a>);
<a name="l03880"></a>03880 
<a name="l03881"></a>03881     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;pdata, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>);
<a name="l03882"></a>03882     <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>);
<a name="l03883"></a>03883 
<a name="l03884"></a>03884     <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>) {
<a name="l03885"></a>03885         <span class="comment">/* be clever and load polygons as mfaces */</span>
<a name="l03886"></a>03886 
<a name="l03887"></a>03887         mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>= <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a3bb3e2b42caff90df9fd28e95cec8867">mesh_mpoly_to_mface</a>(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, &amp;mesh-&gt;pdata,
<a name="l03888"></a>03888                                            mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>);
<a name="l03889"></a>03889 
<a name="l03890"></a>03890         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a0ccefe4320d605b7cb632fa86bbb0ef1">CustomData_free</a>(&amp;mesh-&gt;pdata, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>);
<a name="l03891"></a>03891         memset(&amp;mesh-&gt;pdata, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d04/structCustomData.html">CustomData</a>));
<a name="l03892"></a>03892         mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> = 0;
<a name="l03893"></a>03893 
<a name="l03894"></a>03894         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a0ccefe4320d605b7cb632fa86bbb0ef1">CustomData_free</a>(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>);
<a name="l03895"></a>03895         memset(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d04/structCustomData.html">CustomData</a>));
<a name="l03896"></a>03896         mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a> = 0;
<a name="l03897"></a>03897 
<a name="l03898"></a>03898         <a class="code" href="../../df/d7f/BKE__mesh_8h.html#adc8217e8a6385eec61318e5f7489b462">mesh_update_customdata_pointers</a>(mesh);
<a name="l03899"></a>03899     }
<a name="l03900"></a>03900 
<a name="l03901"></a>03901 <span class="preprocessor">#endif</span>
<a name="l03902"></a>03902 <span class="preprocessor"></span>
<a name="l03903"></a>03903 
<a name="l03904"></a>03904     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a71b32c841e28c59ad02129f2a0e72648">bb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03905"></a>03905     mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03906"></a>03906     
<a name="l03907"></a>03907     <span class="comment">/* Multires data */</span>
<a name="l03908"></a>03908     mesh-&gt;mr= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;mr);
<a name="l03909"></a>03909     <span class="keywordflow">if</span> (mesh-&gt;mr) {
<a name="l03910"></a>03910         <a class="code" href="../../db/d78/structMultiresLevel.html">MultiresLevel</a> *lvl;
<a name="l03911"></a>03911         
<a name="l03912"></a>03912         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;mesh-&gt;mr-&gt;levels);
<a name="l03913"></a>03913         lvl= mesh-&gt;mr-&gt;levels.first;
<a name="l03914"></a>03914         
<a name="l03915"></a>03915         <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;mr-&gt;vdata, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a3bca18308d09f1fb7b145486520fca4e">totvert</a>);
<a name="l03916"></a>03916         <a class="code" href="../../d0/d12/readfile_8c.html#a65f81267d6ae42fa5b920788439a565a">direct_link_dverts</a>(fd, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a3bca18308d09f1fb7b145486520fca4e">totvert</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ad7c68e821437b13392ebdd3f7a41faf0">CustomData_get</a>(&amp;mesh-&gt;mr-&gt;vdata, 0, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a46e655a33ee15daada322dea203b832a">CD_MDEFORMVERT</a>));
<a name="l03917"></a>03917         <a class="code" href="../../d0/d12/readfile_8c.html#af3840ff62269c986dc2a91c7806f6cf9">direct_link_customdata</a>(fd, &amp;mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a5728f1d1a4bc284aa4e20bb6a6a8ca94">totface</a>);
<a name="l03918"></a>03918         
<a name="l03919"></a>03919         mesh-&gt;mr-&gt;edge_flags= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;mr-&gt;edge_flags);
<a name="l03920"></a>03920         mesh-&gt;mr-&gt;edge_creases= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;mr-&gt;edge_creases);
<a name="l03921"></a>03921 
<a name="l03922"></a>03922         mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a>);
<a name="l03923"></a>03923         
<a name="l03924"></a>03924         <span class="comment">/* If mesh has the same number of vertices as the</span>
<a name="l03925"></a>03925 <span class="comment">         * highest multires level, load the current mesh verts</span>
<a name="l03926"></a>03926 <span class="comment">         * into multires and discard the old data. Needed</span>
<a name="l03927"></a>03927 <span class="comment">         * because some saved files either do not have a verts</span>
<a name="l03928"></a>03928 <span class="comment">         * array, or the verts array contains out-of-date</span>
<a name="l03929"></a>03929 <span class="comment">         * data. */</span>
<a name="l03930"></a>03930         <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a> == ((<a class="code" href="../../db/d78/structMultiresLevel.html">MultiresLevel</a>*)mesh-&gt;mr-&gt;levels.last)-&gt;totvert) {
<a name="l03931"></a>03931             <span class="keywordflow">if</span> (mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a>)
<a name="l03932"></a>03932                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a>);
<a name="l03933"></a>03933             mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>);
<a name="l03934"></a>03934         }
<a name="l03935"></a>03935             
<a name="l03936"></a>03936         <span class="keywordflow">for</span> (; lvl; lvl= lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a60870f4f7d8dce17d4154b4bf90c8053">next</a>) {
<a name="l03937"></a>03937             lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#acb8687824eb876f24e436ae6864785f2">verts</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#acb8687824eb876f24e436ae6864785f2">verts</a>);
<a name="l03938"></a>03938             lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a076ed725b0a7040c84220194dfbdccb0">faces</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a076ed725b0a7040c84220194dfbdccb0">faces</a>);
<a name="l03939"></a>03939             lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a4729500c54a43b85c0576ad628e1a691">edges</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#a4729500c54a43b85c0576ad628e1a691">edges</a>);
<a name="l03940"></a>03940             lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#ab7d7cc509af818af3a4d4dcdc4f99e24">colfaces</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#ab7d7cc509af818af3a4d4dcdc4f99e24">colfaces</a>);
<a name="l03941"></a>03941         }
<a name="l03942"></a>03942     }
<a name="l03943"></a>03943 
<a name="l03944"></a>03944     <span class="comment">/* if multires is present but has no valid vertex data,</span>
<a name="l03945"></a>03945 <span class="comment">     * there&#39;s no way to recover it; silently remove multires */</span>
<a name="l03946"></a>03946     <span class="keywordflow">if</span> (mesh-&gt;mr &amp;&amp; !mesh-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a>) {
<a name="l03947"></a>03947         <a class="code" href="../../d1/d37/BKE__multires_8h.html#a21c4cb14ddd151c4242efa17a79ff035">multires_free</a>(mesh-&gt;mr);
<a name="l03948"></a>03948         mesh-&gt;mr = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03949"></a>03949     }
<a name="l03950"></a>03950     
<a name="l03951"></a>03951     <span class="keywordflow">if</span> ((fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) &amp;&amp; mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l03952"></a>03952         <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tf= mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>;
<a name="l03953"></a>03953         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03954"></a>03954 
<a name="l03955"></a>03955         <span class="keywordflow">for</span> (i=0; i&lt; (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>); i++, tf++) {
<a name="l03956"></a>03956             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(tf-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[0]);
<a name="l03957"></a>03957             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(tf-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[1]);
<a name="l03958"></a>03958             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(tf-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[2]);
<a name="l03959"></a>03959             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(tf-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[3]);
<a name="l03960"></a>03960         }
<a name="l03961"></a>03961     }
<a name="l03962"></a>03962 }
<a name="l03963"></a>03963 
<a name="l03964"></a>03964 <span class="comment">/* ************ READ LATTICE ***************** */</span>
<a name="l03965"></a>03965 
<a name="l03966"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad250698250be5256a2ee9077822159db">03966</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad250698250be5256a2ee9077822159db">lib_link_latt</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l03967"></a>03967 {
<a name="l03968"></a>03968     <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt;
<a name="l03969"></a>03969     
<a name="l03970"></a>03970     lt= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acc71d9ddb63ba1e24a044109bb6bab45">latt</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03971"></a>03971     <span class="keywordflow">while</span> (lt) {
<a name="l03972"></a>03972         <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l03973"></a>03973             <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>);
<a name="l03974"></a>03974             
<a name="l03975"></a>03975             lt-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, lt-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l03976"></a>03976             lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a17c6975adcc7144ed734252d6038b7d5">key</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a17c6975adcc7144ed734252d6038b7d5">key</a>);
<a name="l03977"></a>03977             
<a name="l03978"></a>03978             lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l03979"></a>03979         }
<a name="l03980"></a>03980         lt= lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l03981"></a>03981     }
<a name="l03982"></a>03982 }
<a name="l03983"></a>03983 
<a name="l03984"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5ed178467f2244f706d1d31d36b044df">03984</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5ed178467f2244f706d1d31d36b044df">direct_link_latt</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt)
<a name="l03985"></a>03985 {
<a name="l03986"></a>03986     lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>);
<a name="l03987"></a>03987     
<a name="l03988"></a>03988     lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a4a2b2d1f76c8199226ae49ca62403fea">dvert</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a4a2b2d1f76c8199226ae49ca62403fea">dvert</a>);
<a name="l03989"></a>03989     <a class="code" href="../../d0/d12/readfile_8c.html#a65f81267d6ae42fa5b920788439a565a">direct_link_dverts</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a4a2b2d1f76c8199226ae49ca62403fea">dvert</a>);
<a name="l03990"></a>03990     
<a name="l03991"></a>03991     lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03992"></a>03992     
<a name="l03993"></a>03993     lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>);
<a name="l03994"></a>03994     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>);
<a name="l03995"></a>03995 }
<a name="l03996"></a>03996 
<a name="l03997"></a>03997 
<a name="l03998"></a>03998 <span class="comment">/* ************ READ OBJECT ***************** */</span>
<a name="l03999"></a>03999 
<a name="l04000"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae6467c054de0258156062a7ca5f57b25">04000</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ae6467c054de0258156062a7ca5f57b25">lib_link_modifiers__linkModifiers</a>(<span class="keywordtype">void</span> *userData, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob,
<a name="l04001"></a>04001                                               <a class="code" href="../../d8/d7e/structID.html">ID</a> **idpoin)
<a name="l04002"></a>04002 {
<a name="l04003"></a>04003     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd = userData;
<a name="l04004"></a>04004 
<a name="l04005"></a>04005     *idpoin = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, *idpoin);
<a name="l04006"></a>04006     <span class="comment">/* hardcoded bad exception; non-object modifier data gets user count (texture, displace) */</span>
<a name="l04007"></a>04007     <span class="keywordflow">if</span> (*idpoin &amp;&amp; <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>((*idpoin)-&gt;name)!=<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>)
<a name="l04008"></a>04008         (*idpoin)-&gt;us++;
<a name="l04009"></a>04009 }
<a name="l04010"></a><a class="code" href="../../d0/d12/readfile_8c.html#a347e5a28a81625ce8ad9a1427d1917be">04010</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a347e5a28a81625ce8ad9a1427d1917be">lib_link_modifiers</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l04011"></a>04011 {
<a name="l04012"></a>04012     <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#af58b09917325823d100856df77548492">modifiers_foreachIDLink</a>(ob, <a class="code" href="../../d0/d12/readfile_8c.html#ae6467c054de0258156062a7ca5f57b25">lib_link_modifiers__linkModifiers</a>, fd);
<a name="l04013"></a>04013 }
<a name="l04014"></a>04014 
<a name="l04015"></a><a class="code" href="../../d0/d12/readfile_8c.html#a788fda9781017574efb10ba664298f04">04015</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a788fda9781017574efb10ba664298f04">lib_link_object</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l04016"></a>04016 {
<a name="l04017"></a>04017     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l04018"></a>04018     <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l04019"></a>04019     <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens;
<a name="l04020"></a>04020     <a class="code" href="../../dd/d82/structbController.html">bController</a> *cont;
<a name="l04021"></a>04021     <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l04022"></a>04022     <span class="keywordtype">void</span> *poin;
<a name="l04023"></a>04023     <span class="keywordtype">int</span> warn=0, a;
<a name="l04024"></a>04024 
<a name="l04025"></a>04025     ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04026"></a>04026     <span class="keywordflow">while</span> (ob) {
<a name="l04027"></a>04027         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l04028"></a>04028             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l04029"></a>04029             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>);
<a name="l04030"></a>04030             
<a name="l04031"></a>04031 <span class="comment">// XXX depreceated - old animation system &lt;&lt;&lt;           </span>
<a name="l04032"></a>04032             ob-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;ipo);
<a name="l04033"></a>04033             ob-&gt;action = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;action);
<a name="l04034"></a>04034 <span class="comment">// &gt;&gt;&gt; XXX depreceated - old animation system</span>
<a name="l04035"></a>04035 
<a name="l04036"></a>04036             ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l04037"></a>04037             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a10589da689f1a9c4dfb74b11bc24f069">track</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a10589da689f1a9c4dfb74b11bc24f069">track</a>);
<a name="l04038"></a>04038             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0cd974818f733c70574e65b0d0a6045b">poselib</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0cd974818f733c70574e65b0d0a6045b">poselib</a>);
<a name="l04039"></a>04039             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>);
<a name="l04040"></a>04040             
<a name="l04041"></a>04041             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>);
<a name="l04042"></a>04042             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>) {
<a name="l04043"></a>04043                 <span class="comment">/* paranoia check, actually a proxy_from pointer should never be written... */</span>
<a name="l04044"></a>04044                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04045"></a>04045                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a3d2c2164b03db46f65597e44ac6f9a06">proxy_from</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04046"></a>04046                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04047"></a>04047                     
<a name="l04048"></a>04048                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>)
<a name="l04049"></a>04049                         printf(<span class="stringliteral">&quot;Proxy lost from  object %s lib %s\n&quot;</span>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>);
<a name="l04050"></a>04050                     <span class="keywordflow">else</span>
<a name="l04051"></a>04051                         printf(<span class="stringliteral">&quot;Proxy lost from  object %s lib &lt;NONE&gt;\n&quot;</span>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l04052"></a>04052                 }
<a name="l04053"></a>04053                 <span class="keywordflow">else</span> {
<a name="l04054"></a>04054                     <span class="comment">/* this triggers object_update to always use a copy */</span>
<a name="l04055"></a>04055                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a3d2c2164b03db46f65597e44ac6f9a06">proxy_from</a>= ob;
<a name="l04056"></a>04056                     <span class="comment">/* force proxy updates after load/undo, a bit weak */</span>
<a name="l04057"></a>04057                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#acd3a68b1b095992c7f50c74a480549bd">OB_RECALC_TIME</a>;
<a name="l04058"></a>04058                 }
<a name="l04059"></a>04059             }
<a name="l04060"></a>04060             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a090fbae25210a2cf69181f143c683f19">proxy_group</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a090fbae25210a2cf69181f143c683f19">proxy_group</a>);
<a name="l04061"></a>04061             
<a name="l04062"></a>04062             poin= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04063"></a>04063             ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04064"></a>04064 
<a name="l04065"></a>04065             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; poin!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04066"></a>04066                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>)
<a name="l04067"></a>04067                     printf(<span class="stringliteral">&quot;Can&#39;t find obdata of %s lib %s\n&quot;</span>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>);
<a name="l04068"></a>04068                 <span class="keywordflow">else</span>
<a name="l04069"></a>04069                     printf(<span class="stringliteral">&quot;Object %s lost data.\n&quot;</span>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l04070"></a>04070 
<a name="l04071"></a>04071                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>;
<a name="l04072"></a>04072                 warn= 1;
<a name="l04073"></a>04073 
<a name="l04074"></a>04074                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l04075"></a>04075                     <a class="code" href="../../d8/df5/BKE__action_8h.html#a12d7b04abaecb952e016e8512662bc19">free_pose</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l04076"></a>04076                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04077"></a>04077                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp;= ~<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550acfed9b4bf4a7e2d3c5ae0b3571e38950">OB_MODE_POSE</a>;
<a name="l04078"></a>04078                 }
<a name="l04079"></a>04079             }
<a name="l04080"></a>04080             <span class="keywordflow">for</span> (a=0; a&lt;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>; a++) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>[a]);
<a name="l04081"></a>04081             
<a name="l04082"></a>04082             <span class="comment">/* When the object is local and the data is library its possible</span>
<a name="l04083"></a>04083 <span class="comment">             * the material list size gets out of sync. [#22663] */</span>
<a name="l04084"></a>04084             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a> != ((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>)-&gt;lib) {
<a name="l04085"></a>04085                 <span class="keywordtype">short</span> *totcol_data= <a class="code" href="../../d4/d0f/BKE__material_8h.html#a11593c21969f7c374bb82b5aa75630b3">give_totcolp</a>(ob);
<a name="l04086"></a>04086                 <span class="comment">/* Only expand so as not to loose any object materials that might be set. */</span>
<a name="l04087"></a>04087                 <span class="keywordflow">if</span> (totcol_data &amp;&amp; *totcol_data &gt; ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>) {
<a name="l04088"></a>04088                     <span class="comment">/* printf(&quot;&#39;%s&#39; %d -&gt; %d\n&quot;, ob-&gt;id.name, ob-&gt;totcol, *totcol_data); */</span>
<a name="l04089"></a>04089                     <a class="code" href="../../d4/d0f/BKE__material_8h.html#a9db36a699b8ee66091a9bd09186c956f">resize_object_material</a>(ob, *totcol_data);
<a name="l04090"></a>04090                 }
<a name="l04091"></a>04091             }
<a name="l04092"></a>04092 
<a name="l04093"></a>04093             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8c7e94f85e702b071092fbe917f0b707">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8c7e94f85e702b071092fbe917f0b707">gpd</a>);
<a name="l04094"></a>04094             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a94fedb802ee9557bf5cebfa6b3624b16">duplilist</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04095"></a>04095 
<a name="l04096"></a>04096             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l04097"></a>04097             <span class="comment">/* if id.us==0 a new base will be created later on */</span>
<a name="l04098"></a>04098             
<a name="l04099"></a>04099             <span class="comment">/* WARNING! Also check expand_object(), should reflect the stuff below. */</span>
<a name="l04100"></a>04100             <a class="code" href="../../d0/d12/readfile_8c.html#a01d6828c2e0c1971854b3c21bf7e3ff3">lib_link_pose</a>(fd, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l04101"></a>04101             <a class="code" href="../../d0/d12/readfile_8c.html#a54f8b6ce2718370b5baea1ec9400d5d4">lib_link_constraints</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>);
<a name="l04102"></a>04102             
<a name="l04103"></a>04103 <span class="comment">// XXX depreceated - old animation system &lt;&lt;&lt;   </span>
<a name="l04104"></a>04104             <a class="code" href="../../d0/d12/readfile_8c.html#a5a4f689a7c0e9b331119e72512aecf51">lib_link_constraint_channels</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;ob-&gt;constraintChannels);
<a name="l04105"></a>04105             <a class="code" href="../../d0/d12/readfile_8c.html#a50a3aa154e49a65a3d7370ff8a9b5cf7">lib_link_nlastrips</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;ob-&gt;nlastrips);
<a name="l04106"></a>04106 <span class="comment">// &gt;&gt;&gt; XXX depreceated - old animation system</span>
<a name="l04107"></a>04107 
<a name="l04108"></a>04108             <span class="keywordflow">for</span> (paf= ob-&gt;effect.first; paf; paf= paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a4da6369abd847703c33e21d4b26f2fec">next</a>) {
<a name="l04109"></a>04109                 <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a058f8cfb3c8a781264b431c40e4dbaaa">type</a>==<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a712e7ef632d364ac7226cbc7a74b20df">EFF_PARTICLE</a>) {
<a name="l04110"></a>04110                     paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a5db52fef13164131ddbbcd82b8824496">group</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a5db52fef13164131ddbbcd82b8824496">group</a>);
<a name="l04111"></a>04111                 }
<a name="l04112"></a>04112             }               
<a name="l04113"></a>04113 
<a name="l04114"></a>04114             sens= ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04115"></a>04115             <span class="keywordflow">while</span> (sens) {
<a name="l04116"></a>04116                 <span class="keywordflow">for</span> (a=0; a&lt;sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#afa554e662911829345d321e1719bcaeb">totlinks</a>; a++)
<a name="l04117"></a>04117                     sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#aa7ac7cf5997f2a9d284919f933a0d356">newglobadr</a>(fd, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>[a]);
<a name="l04118"></a>04118 
<a name="l04119"></a>04119                 <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a>==<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a7c4f8e3b1bd33b18ebc913c6663a088a">SENS_TOUCH</a>) {
<a name="l04120"></a>04120                     <a class="code" href="../../dd/d04/structbTouchSensor.html">bTouchSensor</a> *ts= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l04121"></a>04121                     ts-&gt;<a class="code" href="../../dd/d04/structbTouchSensor.html#a5301c555a7f87b899535305d7b27f579">ma</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ts-&gt;<a class="code" href="../../dd/d04/structbTouchSensor.html#a5301c555a7f87b899535305d7b27f579">ma</a>);
<a name="l04122"></a>04122                 }
<a name="l04123"></a>04123                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a>==<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#aedf7477b9ae594464a6164c3b18fb4d6">SENS_MESSAGE</a>) {
<a name="l04124"></a>04124                     <a class="code" href="../../dc/d60/structbMessageSensor.html">bMessageSensor</a> *ms= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l04125"></a>04125                     ms-&gt;<a class="code" href="../../dc/d60/structbMessageSensor.html#af836ea3b8de2f362e40258b7dbbffc15">fromObject</a>=
<a name="l04126"></a>04126                         <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ms-&gt;<a class="code" href="../../dc/d60/structbMessageSensor.html#af836ea3b8de2f362e40258b7dbbffc15">fromObject</a>);
<a name="l04127"></a>04127                 }
<a name="l04128"></a>04128                 sens= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>;
<a name="l04129"></a>04129             }
<a name="l04130"></a>04130 
<a name="l04131"></a>04131             cont= ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae2499a91d26d9dc8829a0505f6008066">controllers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04132"></a>04132             <span class="keywordflow">while</span> (cont) {
<a name="l04133"></a>04133                 <span class="keywordflow">for</span> (a=0; a&lt;cont-&gt;<a class="code" href="../../dd/d82/structbController.html#ac94b351dbb56572b804b3abf08d568f1">totlinks</a>; a++)
<a name="l04134"></a>04134                     cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8547b3b1dc994585185196bdaaf063b7">links</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#aa7ac7cf5997f2a9d284919f933a0d356">newglobadr</a>(fd, cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8547b3b1dc994585185196bdaaf063b7">links</a>[a]);
<a name="l04135"></a>04135 
<a name="l04136"></a>04136                 <span class="keywordflow">if</span> (cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a48474985990dd426df0fa0816b06d3b2">type</a>==<a class="code" href="../../d0/d3e/DNA__controller__types_8h.html#addf43c3897e74c7dc474df500fb02898">CONT_PYTHON</a>) {
<a name="l04137"></a>04137                     <a class="code" href="../../d8/d6d/structbPythonCont.html">bPythonCont</a> *pc= cont-&gt;<a class="code" href="../../dd/d82/structbController.html#af6c30d2aedadc64bc687eb503a44b800">data</a>;
<a name="l04138"></a>04138                     pc-&gt;<a class="code" href="../../d8/d6d/structbPythonCont.html#abb7f168a9357050153e5386f9b4f3bfc">text</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, pc-&gt;<a class="code" href="../../d8/d6d/structbPythonCont.html#abb7f168a9357050153e5386f9b4f3bfc">text</a>);
<a name="l04139"></a>04139                 }
<a name="l04140"></a>04140                 cont-&gt;<a class="code" href="../../dd/d82/structbController.html#ade0458a32c1ed86d466773921d47effd">slinks</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04141"></a>04141                 cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8ff4d03794fff7a2b4541b52161c89e1">totslinks</a>= 0;
<a name="l04142"></a>04142 
<a name="l04143"></a>04143                 cont= cont-&gt;<a class="code" href="../../dd/d82/structbController.html#abd185fdf6022047bfd51966024e3820b">next</a>;
<a name="l04144"></a>04144             }
<a name="l04145"></a>04145 
<a name="l04146"></a>04146             act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04147"></a>04147             <span class="keywordflow">while</span> (act) {
<a name="l04148"></a>04148                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a8886ccc844380010702d2a9cbb991ee3">ACT_SOUND</a>) {
<a name="l04149"></a>04149                     <a class="code" href="../../d1/da3/structbSoundActuator.html">bSoundActuator</a> *sa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04150"></a>04150                     sa-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#a4d73983f46d44a780d3a82a310c327ca">sound</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sa-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#a4d73983f46d44a780d3a82a310c327ca">sound</a>);
<a name="l04151"></a>04151                 }
<a name="l04152"></a>04152                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#adb174945b18d2f92217fcec653650608">ACT_GAME</a>) {
<a name="l04153"></a>04153                     <span class="comment">/* bGameActuator *ga= act-&gt;data; */</span>
<a name="l04154"></a>04154                 }
<a name="l04155"></a>04155                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ad0a80e945d2f9f52b83f903c6f0a8bcd">ACT_CAMERA</a>) {
<a name="l04156"></a>04156                     <a class="code" href="../../d3/d76/structbCameraActuator.html">bCameraActuator</a> *ca= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04157"></a>04157                     ca-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a24ae0fc57a2890a5d6c062bb9c038fbd">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ca-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a24ae0fc57a2890a5d6c062bb9c038fbd">ob</a>);
<a name="l04158"></a>04158                 }
<a name="l04159"></a>04159                     <span class="comment">/* leave this one, it&#39;s obsolete but necessary to read for conversion */</span>
<a name="l04160"></a>04160                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6550919fb970694bc25d165dd88d4309">ACT_ADD_OBJECT</a>) {
<a name="l04161"></a>04161                     <a class="code" href="../../dd/dbe/structbAddObjectActuator.html">bAddObjectActuator</a> *eoa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04162"></a>04162                     <span class="keywordflow">if</span> (eoa) eoa-&gt;<a class="code" href="../../dd/dbe/structbAddObjectActuator.html#a851f2a3455b87598a7ff8032c3e93f39">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, eoa-&gt;<a class="code" href="../../dd/dbe/structbAddObjectActuator.html#a851f2a3455b87598a7ff8032c3e93f39">ob</a>);
<a name="l04163"></a>04163                 }
<a name="l04164"></a>04164                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l04165"></a>04165                     <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04166"></a>04166                     <span class="keywordflow">if</span> (oa==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04167"></a>04167                         <a class="code" href="../../dd/de8/BKE__sca_8h.html#ac597de50da403f2cc1d568d35a3b9abb">init_actuator</a>(act);
<a name="l04168"></a>04168                     }
<a name="l04169"></a>04169                     <span class="keywordflow">else</span> {
<a name="l04170"></a>04170                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a9cda7111b23b488749f0c8fa2933446e">reference</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a9cda7111b23b488749f0c8fa2933446e">reference</a>);
<a name="l04171"></a>04171                     }
<a name="l04172"></a>04172                 }
<a name="l04173"></a>04173                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0fc0c7354c3624cb0a4b65934480a969">ACT_EDIT_OBJECT</a>) {
<a name="l04174"></a>04174                     <a class="code" href="../../d4/d5c/structbEditObjectActuator.html">bEditObjectActuator</a> *eoa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04175"></a>04175                     <span class="keywordflow">if</span> (eoa==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04176"></a>04176                         <a class="code" href="../../dd/de8/BKE__sca_8h.html#ac597de50da403f2cc1d568d35a3b9abb">init_actuator</a>(act);
<a name="l04177"></a>04177                     }
<a name="l04178"></a>04178                     <span class="keywordflow">else</span> {
<a name="l04179"></a>04179                         eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a92767cd10e4f3f3564b295d418714088">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a92767cd10e4f3f3564b295d418714088">ob</a>);
<a name="l04180"></a>04180                         eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a49dc73b1e734e62fc62dd00431076f84">me</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a49dc73b1e734e62fc62dd00431076f84">me</a>);
<a name="l04181"></a>04181                     }
<a name="l04182"></a>04182                 }
<a name="l04183"></a>04183                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af24723332b675766ad1d11f031ac6cd4">ACT_SCENE</a>) {
<a name="l04184"></a>04184                     <a class="code" href="../../d8/d6b/structbSceneActuator.html">bSceneActuator</a> *sa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04185"></a>04185                     sa-&gt;<a class="code" href="../../d8/d6b/structbSceneActuator.html#af681370aee48700269f4b544b4d23484">camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sa-&gt;<a class="code" href="../../d8/d6b/structbSceneActuator.html#af681370aee48700269f4b544b4d23484">camera</a>);
<a name="l04186"></a>04186                     sa-&gt;<a class="code" href="../../d8/d6b/structbSceneActuator.html#a314795e300bcb88b199365bc3f248364">scene</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sa-&gt;<a class="code" href="../../d8/d6b/structbSceneActuator.html#a314795e300bcb88b199365bc3f248364">scene</a>);
<a name="l04187"></a>04187                 }
<a name="l04188"></a>04188                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a64df7df8bf7e040450f186a4ac9c3753">ACT_ACTION</a>) {
<a name="l04189"></a>04189                     <a class="code" href="../../d6/d15/structbActionActuator.html">bActionActuator</a> *aa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04190"></a>04190                     aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a>);
<a name="l04191"></a>04191                 }
<a name="l04192"></a>04192                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af3367e7ebe5e98e65421b9a957c6ccb8">ACT_SHAPEACTION</a>) {
<a name="l04193"></a>04193                     <a class="code" href="../../d6/d15/structbActionActuator.html">bActionActuator</a> *aa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04194"></a>04194                     aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a>);
<a name="l04195"></a>04195                 }
<a name="l04196"></a>04196                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a3adf808ddc137a603bc4d0d92b31882a">ACT_PROPERTY</a>) {
<a name="l04197"></a>04197                     <a class="code" href="../../dc/d13/structbPropertyActuator.html">bPropertyActuator</a> *pa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04198"></a>04198                     pa-&gt;<a class="code" href="../../dc/d13/structbPropertyActuator.html#aeee0b9339f26d6bfcd93549cd6cac816">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, pa-&gt;<a class="code" href="../../dc/d13/structbPropertyActuator.html#aeee0b9339f26d6bfcd93549cd6cac816">ob</a>);
<a name="l04199"></a>04199                 }
<a name="l04200"></a>04200                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae4015d5dd2b07f1caedc5039e7dd3753">ACT_MESSAGE</a>) {
<a name="l04201"></a>04201                     <a class="code" href="../../df/d12/structbMessageActuator.html">bMessageActuator</a> *ma= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04202"></a>04202                     ma-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a132d37e6ba7d93be7eb4d5816a04ee41">toObject</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ma-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a132d37e6ba7d93be7eb4d5816a04ee41">toObject</a>);
<a name="l04203"></a>04203                 }
<a name="l04204"></a>04204                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6b9525822dbf86e1fbd601a18a27dcfb">ACT_2DFILTER</a>) {
<a name="l04205"></a>04205                     <a class="code" href="../../d1/dd9/structbTwoDFilterActuator.html">bTwoDFilterActuator</a> *_2dfa = act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>; 
<a name="l04206"></a>04206                     _2dfa-&gt;<a class="code" href="../../d1/dd9/structbTwoDFilterActuator.html#a3190cfa555924909cae3720da5417afc">text</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, _2dfa-&gt;<a class="code" href="../../d1/dd9/structbTwoDFilterActuator.html#a3190cfa555924909cae3720da5417afc">text</a>);
<a name="l04207"></a>04207                 }
<a name="l04208"></a>04208                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#aff16c55b5a12651b7c6902a240530c24">ACT_PARENT</a>) {
<a name="l04209"></a>04209                     <a class="code" href="../../de/d83/structbParentActuator.html">bParentActuator</a> *parenta = act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>; 
<a name="l04210"></a>04210                     parenta-&gt;<a class="code" href="../../de/d83/structbParentActuator.html#a3aca4b9991a861728d6a1cac3ef6ccea">ob</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, parenta-&gt;<a class="code" href="../../de/d83/structbParentActuator.html#a3aca4b9991a861728d6a1cac3ef6ccea">ob</a>);
<a name="l04211"></a>04211                 }
<a name="l04212"></a>04212                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0dc1d9f49f038a2f6dade9ba8a8e34ba">ACT_STATE</a>) {
<a name="l04213"></a>04213                     <span class="comment">/* bStateActuator *statea = act-&gt;data; */</span>
<a name="l04214"></a>04214                 }
<a name="l04215"></a>04215                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#aee9a04f8f07032f50c4743a6499405e7">ACT_ARMATURE</a>) {
<a name="l04216"></a>04216                     <a class="code" href="../../db/d53/structbArmatureActuator.html">bArmatureActuator</a> *arma= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l04217"></a>04217                     arma-&gt;<a class="code" href="../../db/d53/structbArmatureActuator.html#af047ecce453fd3fbef5b0b512539af34">target</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, arma-&gt;<a class="code" href="../../db/d53/structbArmatureActuator.html#af047ecce453fd3fbef5b0b512539af34">target</a>);
<a name="l04218"></a>04218                     arma-&gt;<a class="code" href="../../db/d53/structbArmatureActuator.html#a888253390affbd36ba9574c2be7ace25">subtarget</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, arma-&gt;<a class="code" href="../../db/d53/structbArmatureActuator.html#a888253390affbd36ba9574c2be7ace25">subtarget</a>);
<a name="l04219"></a>04219                 }
<a name="l04220"></a>04220                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a68b54400142bd60b87940076e4d92471">ACT_STEERING</a>) {
<a name="l04221"></a>04221                     <a class="code" href="../../dc/dbe/structbSteeringActuator.html">bSteeringActuator</a> *steeringa = act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>; 
<a name="l04222"></a>04222                     steeringa-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#ab3d481511001e61afb4eda90ce4edb49">target</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, steeringa-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#ab3d481511001e61afb4eda90ce4edb49">target</a>);
<a name="l04223"></a>04223                     steeringa-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#aa72e26ca2f5e0aa5806c211e5d15ea35">navmesh</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, steeringa-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#aa72e26ca2f5e0aa5806c211e5d15ea35">navmesh</a>);
<a name="l04224"></a>04224                 }
<a name="l04225"></a>04225                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l04226"></a>04226             }
<a name="l04227"></a>04227             
<a name="l04228"></a>04228             {
<a name="l04229"></a>04229                 <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fluidmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>);
<a name="l04230"></a>04230                 
<a name="l04231"></a>04231                 <span class="keywordflow">if</span> (fluidmd &amp;&amp; fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>)
<a name="l04232"></a>04232                     fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#ada29cb3e71d30a409e4e895817f637b9">ipo</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#ada29cb3e71d30a409e4e895817f637b9">ipo</a>);
<a name="l04233"></a>04233             }
<a name="l04234"></a>04234 
<a name="l04235"></a>04235             {
<a name="l04236"></a>04236                 <a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *smd = (<a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a7a78843e9dd6590fafc9b7682e691ac5">eModifierType_Smoke</a>);
<a name="l04237"></a>04237                 
<a name="l04238"></a>04238                 <span class="keywordflow">if</span> (smd &amp;&amp; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a88bed02ad1eb599ef628931fc9ab7973">MOD_SMOKE_TYPE_DOMAIN</a> &amp;&amp; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>)
<a name="l04239"></a>04239                 {
<a name="l04240"></a>04240                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#ad6dc6d0356b72929c29a660e36911940">flags</a> |= <a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html#ad58bc0851dda4f8efe9bbaff2001cbfb">MOD_SMOKE_FILE_LOAD</a>; <span class="comment">/* flag for refreshing the simulation after loading */</span>
<a name="l04241"></a>04241                 }
<a name="l04242"></a>04242             }
<a name="l04243"></a>04243 
<a name="l04244"></a>04244             <span class="comment">/* texture field */</span>
<a name="l04245"></a>04245             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>)
<a name="l04246"></a>04246                 <a class="code" href="../../d0/d12/readfile_8c.html#a9a082255e121031be5668498ec4b9f57">lib_link_partdeflect</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>);
<a name="l04247"></a>04247 
<a name="l04248"></a>04248             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>)
<a name="l04249"></a>04249                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a>);
<a name="l04250"></a>04250 
<a name="l04251"></a>04251             <a class="code" href="../../d0/d12/readfile_8c.html#a02accca21ab1b5950aa0950369815dae">lib_link_particlesystems</a>(fd, ob, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>);
<a name="l04252"></a>04252             <a class="code" href="../../d0/d12/readfile_8c.html#a347e5a28a81625ce8ad9a1427d1917be">lib_link_modifiers</a>(fd, ob);
<a name="l04253"></a>04253         }
<a name="l04254"></a>04254         ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l04255"></a>04255     }
<a name="l04256"></a>04256 
<a name="l04257"></a>04257     <span class="keywordflow">if</span> (warn) {
<a name="l04258"></a>04258         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Warning in console&quot;</span>);
<a name="l04259"></a>04259     }
<a name="l04260"></a>04260 }
<a name="l04261"></a>04261 
<a name="l04262"></a>04262 
<a name="l04263"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1d882644a1752229d69214dbafbed302">04263</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1d882644a1752229d69214dbafbed302">direct_link_pose</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d3/de4/structbPose.html">bPose</a> *pose)
<a name="l04264"></a>04264 {
<a name="l04265"></a>04265     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l04266"></a>04266 
<a name="l04267"></a>04267     <span class="keywordflow">if</span> (!pose)
<a name="l04268"></a>04268         <span class="keywordflow">return</span>;
<a name="l04269"></a>04269 
<a name="l04270"></a>04270     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>);
<a name="l04271"></a>04271     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a60a155dd4019f3ee9a94c624589701ce">agroups</a>);
<a name="l04272"></a>04272 
<a name="l04273"></a>04273     pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a53448bd807d93c5d257db12993430ef8">chanhash</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04274"></a>04274 
<a name="l04275"></a>04275     <span class="keywordflow">for</span> (pchan = pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l04276"></a>04276         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04277"></a>04277         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a331eee45a012f6f42d5a52acbf484547">parent</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a331eee45a012f6f42d5a52acbf484547">parent</a>);
<a name="l04278"></a>04278         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ad63dea990fc5ac499625f4d9ef570de9">child</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ad63dea990fc5ac499625f4d9ef570de9">child</a>);
<a name="l04279"></a>04279         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3d057088dabc61fbc5131cb0c4ca158f">custom_tx</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3d057088dabc61fbc5131cb0c4ca158f">custom_tx</a>);
<a name="l04280"></a>04280         
<a name="l04281"></a>04281         <a class="code" href="../../d0/d12/readfile_8c.html#ab5d64cf8cddd50141495646c6bbd63d0">direct_link_constraints</a>(fd, &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>);
<a name="l04282"></a>04282         
<a name="l04283"></a>04283         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a053b8b403c11109dcb74d5a31e5b80fc">prop</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a053b8b403c11109dcb74d5a31e5b80fc">prop</a>);
<a name="l04284"></a>04284         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a053b8b403c11109dcb74d5a31e5b80fc">prop</a>)
<a name="l04285"></a>04285             <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a053b8b403c11109dcb74d5a31e5b80fc">prop</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l04286"></a>04286         
<a name="l04287"></a>04287         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3dbec1e9fa7c6231f0328a74249f0c91">mpath</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3dbec1e9fa7c6231f0328a74249f0c91">mpath</a>);
<a name="l04288"></a>04288         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3dbec1e9fa7c6231f0328a74249f0c91">mpath</a>)
<a name="l04289"></a>04289             <a class="code" href="../../d0/d12/readfile_8c.html#a5eed9839e354374ce7b2f9d1181297a4">direct_link_motionpath</a>(fd, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3dbec1e9fa7c6231f0328a74249f0c91">mpath</a>);
<a name="l04290"></a>04290         
<a name="l04291"></a>04291         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a416338ec6145ec77f78c2eb60f3415d3">iktree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a416338ec6145ec77f78c2eb60f3415d3">iktree</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04292"></a>04292         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#afbc80aa935e8bd461de32493694a7bff">siktree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#afbc80aa935e8bd461de32493694a7bff">siktree</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04293"></a>04293         
<a name="l04294"></a>04294         <span class="comment">/* in case this value changes in future, clamp else we get undefined behavior */</span>
<a name="l04295"></a>04295         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a06e5397e6647572a9bf92443589285ff">rotmode</a>, <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca99392170dcd8a630c175795587ff4a25">ROT_MODE_MIN</a>, <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca4f1266fc5880b47c67868fe915d6945d">ROT_MODE_MAX</a>);
<a name="l04296"></a>04296     }
<a name="l04297"></a>04297     pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a127dfa027eebf5284fa8635babc4606e">ikdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04298"></a>04298     <span class="keywordflow">if</span> (pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a2c700562036f72cc3bfa089c1dbef380">ikparam</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04299"></a>04299         pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a2c700562036f72cc3bfa089c1dbef380">ikparam</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a2c700562036f72cc3bfa089c1dbef380">ikparam</a>);
<a name="l04300"></a>04300     }
<a name="l04301"></a>04301 }
<a name="l04302"></a>04302 
<a name="l04303"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac8116e0739106ff44bb1e64be869285c">04303</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac8116e0739106ff44bb1e64be869285c">direct_link_modifiers</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l04304"></a>04304 {
<a name="l04305"></a>04305     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l04306"></a>04306 
<a name="l04307"></a>04307     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, lb);
<a name="l04308"></a>04308 
<a name="l04309"></a>04309     <span class="keywordflow">for</span> (md=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l04310"></a>04310         md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#addfd2697b56281492c6b4223cdfde7a5">error</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04311"></a>04311         md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a753914a1c3656e4c937e3c3975fec77e">scene</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04312"></a>04312         
<a name="l04313"></a>04313         <span class="comment">/* if modifiers disappear, or for upward compatibility */</span>
<a name="l04314"></a>04314         <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>==<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a837a63cd144446bec663f3a02e0ad397">modifierType_getInfo</a>(md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>))
<a name="l04315"></a>04315             md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>= <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ad8005efaaeddc4b7e0f94e85a40fda2e">eModifierType_None</a>;
<a name="l04316"></a>04316             
<a name="l04317"></a>04317         <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1eb467ffa009a46723f1bf21be5fd730">eModifierType_Subsurf</a>) {
<a name="l04318"></a>04318             <a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a> *smd = (<a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a>*) md;
<a name="l04319"></a>04319 
<a name="l04320"></a>04320             smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a66db3077314e8b611fd214da026f2d13">emCache</a> = smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#acc685d9bb2d4cc119e5ee9eced88c76e">mCache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04321"></a>04321         }
<a name="l04322"></a>04322         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435aa45deecb66e254a60207702a40efa416">eModifierType_Armature</a>) {
<a name="l04323"></a>04323             <a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a> *amd = (<a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a>*) md;
<a name="l04324"></a>04324             
<a name="l04325"></a>04325             amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#ae1bd82cc744c588a1505612cf83acb78">prevCos</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04326"></a>04326         }
<a name="l04327"></a>04327         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5fc484f055c7aba4c89beda85b5ba321">eModifierType_Cloth</a>) {
<a name="l04328"></a>04328             <a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *clmd = (<a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a>*) md;
<a name="l04329"></a>04329             
<a name="l04330"></a>04330             clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a73cb41a7ce0ccf4ee8d5c6597307702e">clothObject</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04331"></a>04331             
<a name="l04332"></a>04332             clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>);
<a name="l04333"></a>04333             clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>);
<a name="l04334"></a>04334 
<a name="l04335"></a>04335             <a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">direct_link_pointcache_list</a>(fd, &amp;clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a2bfdb45d82b0577deb1cdd5f879e931c">ptcaches</a>, &amp;clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a77605f4a26c5077252abce50377e3de9">point_cache</a>, 0);
<a name="l04336"></a>04336             
<a name="l04337"></a>04337             <span class="keywordflow">if</span> (clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>) {
<a name="l04338"></a>04338                 <span class="keywordflow">if</span> (clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a21b41493ef8aa28318d73bb13b6fe0bb">presets</a> &gt; 10)
<a name="l04339"></a>04339                     clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a21b41493ef8aa28318d73bb13b6fe0bb">presets</a> = 0;
<a name="l04340"></a>04340 
<a name="l04341"></a>04341                 clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#ac0796aea9bba67c4a88a62a0754b4feb">reset</a> = 0;
<a name="l04342"></a>04342 
<a name="l04343"></a>04343                 clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a>);
<a name="l04344"></a>04344 
<a name="l04345"></a>04345                 <span class="keywordflow">if</span> (!clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a>) {
<a name="l04346"></a>04346                     clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a> = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ad0116e11e09f0615cc817f48a9557e85">BKE_add_effector_weights</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04347"></a>04347                 }
<a name="l04348"></a>04348             }
<a name="l04349"></a>04349         }
<a name="l04350"></a>04350         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>) {
<a name="l04351"></a>04351             <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fluidmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a>*) md;
<a name="l04352"></a>04352             
<a name="l04353"></a>04353             fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>);
<a name="l04354"></a>04354             <span class="keywordflow">if</span> (fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>) {
<a name="l04355"></a>04355                 fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#aa0899b45f7749666148b215e0b6123d1">fmd</a>= fluidmd;
<a name="l04356"></a>04356                 fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#acae2c1beeddc6e5cf1f0627016d5e526">meshVelocities</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04357"></a>04357             }
<a name="l04358"></a>04358         }
<a name="l04359"></a>04359         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a7a78843e9dd6590fafc9b7682e691ac5">eModifierType_Smoke</a>) {
<a name="l04360"></a>04360             <a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *smd = (<a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a>*) md;
<a name="l04361"></a>04361 
<a name="l04362"></a>04362             <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a88bed02ad1eb599ef628931fc9ab7973">MOD_SMOKE_TYPE_DOMAIN</a>)
<a name="l04363"></a>04363             {
<a name="l04364"></a>04364                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04365"></a>04365                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04366"></a>04366                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>);
<a name="l04367"></a>04367                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a2c65cb551c640ca21bac6ef5ec942c80">smd</a> = smd;
<a name="l04368"></a>04368 
<a name="l04369"></a>04369                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a2243482d9f65b8cb4f1018f8092a73b2">fluid</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04370"></a>04370                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a6b4254083936838e368963db2bd1c41d">wt</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04371"></a>04371                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#aac9e66a5f2eacde79c5c8ac3419c1836">shadow</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04372"></a>04372                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a3005abce710fed5dc020c86e94f0a4da">tex</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04373"></a>04373                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a4b6918c3240e92a1c7cc25fd044e4f36">tex_shadow</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04374"></a>04374                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#ad159c6c6e7b11332c9062c0c42ec4a67">tex_wt</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04375"></a>04375 
<a name="l04376"></a>04376                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a9d82dc71cf74a60bf31ba934137d1078">effector_weights</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a9d82dc71cf74a60bf31ba934137d1078">effector_weights</a>);
<a name="l04377"></a>04377                 <span class="keywordflow">if</span> (!smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a9d82dc71cf74a60bf31ba934137d1078">effector_weights</a>)
<a name="l04378"></a>04378                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a9d82dc71cf74a60bf31ba934137d1078">effector_weights</a> = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ad0116e11e09f0615cc817f48a9557e85">BKE_add_effector_weights</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04379"></a>04379 
<a name="l04380"></a>04380                 <a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">direct_link_pointcache_list</a>(fd, &amp;(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[0]), &amp;(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[0]), 1);
<a name="l04381"></a>04381 
<a name="l04382"></a>04382                 <span class="comment">/* Smoke uses only one cache from now on, so store pointer convert */</span>
<a name="l04383"></a>04383                 <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[1].<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> || smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1]) {
<a name="l04384"></a>04384                     <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1]) {
<a name="l04385"></a>04385                         <a class="code" href="../../d6/d83/structPointCache.html">PointCache</a> *cache = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1]);
<a name="l04386"></a>04386                         <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a2b88c16b99a82dd327dfc9033085b982">PTCACHE_FAKE_SMOKE</a>)
<a name="l04387"></a>04387                             ; <span class="comment">/* Smoke was already saved in &quot;new format&quot; and this cache is a fake one. */</span>
<a name="l04388"></a>04388                         <span class="keywordflow">else</span>
<a name="l04389"></a>04389                             printf(<span class="stringliteral">&quot;High resolution smoke cache not available due to pointcache update. Please reset the simulation.\n&quot;</span>);
<a name="l04390"></a>04390                         <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ae3d00074bc7b55061792e424ef6240fe">BKE_ptcache_free</a>(cache);
<a name="l04391"></a>04391                     }
<a name="l04392"></a>04392                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[1].<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04393"></a>04393                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[1].<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04394"></a>04394                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04395"></a>04395                 }
<a name="l04396"></a>04396             }
<a name="l04397"></a>04397             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a36fe9119d95e89e9f77fcca43030c798">MOD_SMOKE_TYPE_FLOW</a>) {
<a name="l04398"></a>04398                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04399"></a>04399                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04400"></a>04400                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>);
<a name="l04401"></a>04401                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>-&gt;<a class="code" href="../../db/dbe/structSmokeFlowSettings.html#a58a660d9aff19d64891380ec2710a37f">smd</a> = smd;
<a name="l04402"></a>04402                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>-&gt;<a class="code" href="../../db/dbe/structSmokeFlowSettings.html#ae24932b053220085f1418bb55fdfb850">psys</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>-&gt;<a class="code" href="../../db/dbe/structSmokeFlowSettings.html#ae24932b053220085f1418bb55fdfb850">psys</a>);
<a name="l04403"></a>04403             }
<a name="l04404"></a>04404             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a38072e25640d74866f67201327dd38c3">MOD_SMOKE_TYPE_COLL</a>) {
<a name="l04405"></a>04405                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04406"></a>04406                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04407"></a>04407                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>);
<a name="l04408"></a>04408                 <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>)
<a name="l04409"></a>04409                 {
<a name="l04410"></a>04410                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>-&gt;<a class="code" href="../../d7/d78/structSmokeCollSettings.html#ac7b03c1af6e045f213d0cd405b1b5c0a">points</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04411"></a>04411                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>-&gt;<a class="code" href="../../d7/d78/structSmokeCollSettings.html#a5a08ff21c50a3af92d73a83b46aaa59e">numpoints</a> = 0;
<a name="l04412"></a>04412                 }
<a name="l04413"></a>04413                 <span class="keywordflow">else</span>
<a name="l04414"></a>04414                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> = 0;
<a name="l04415"></a>04415 
<a name="l04416"></a>04416             }
<a name="l04417"></a>04417         }
<a name="l04418"></a>04418         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435abf6c2369ea1f5b0cab992eb27906823c">eModifierType_DynamicPaint</a>) {
<a name="l04419"></a>04419             <a class="code" href="../../de/d70/structDynamicPaintModifierData.html">DynamicPaintModifierData</a> *pmd = (<a class="code" href="../../de/d70/structDynamicPaintModifierData.html">DynamicPaintModifierData</a>*) md;
<a name="l04420"></a>04420 
<a name="l04421"></a>04421             <span class="keywordflow">if</span> (pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>)
<a name="l04422"></a>04422             {
<a name="l04423"></a>04423                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>);
<a name="l04424"></a>04424                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#a365ffbb45feb8c1b36198a065ebe2c93">pmd</a> = pmd;
<a name="l04425"></a>04425                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#a91d02c00e230d48b8e86b36145aac45e">dm</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04426"></a>04426                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#a23b381c1fb2c2923ed413d12938fcb9b">flags</a> &amp;= ~<a class="code" href="../../dd/daf/DNA__dynamicpaint__types_8h.html#ab26ce13d2d07b56ec9c856c972275c5c">MOD_DPAINT_BAKING</a>; <span class="comment">/* just in case */</span>
<a name="l04427"></a>04427 
<a name="l04428"></a>04428                 <span class="keywordflow">if</span> (pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#ad228b42281d1a30b3a1471918032d6a5">surfaces</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l04429"></a>04429                     <a class="code" href="../../dc/d46/structDynamicPaintSurface.html">DynamicPaintSurface</a> *surface;
<a name="l04430"></a>04430                     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#ad228b42281d1a30b3a1471918032d6a5">surfaces</a>);
<a name="l04431"></a>04431 
<a name="l04432"></a>04432                     <span class="keywordflow">for</span> (surface=pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#ad228b42281d1a30b3a1471918032d6a5">surfaces</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; surface; surface=surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a844dd16f25eea3afb63262bf54937b05">next</a>) {
<a name="l04433"></a>04433                         surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a25276321bc038bfc06830edaa5113698">canvas</a> = pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>;
<a name="l04434"></a>04434                         surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a5a0a35c043234290d9bd8d5a88840670">data</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04435"></a>04435                         <a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">direct_link_pointcache_list</a>(fd, &amp;(surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ad5a5d56f2355389075826d9c3c69fd93">ptcaches</a>), &amp;(surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ae56d6bbed91169958270d8fb85cf1b15">pointcache</a>), 1);
<a name="l04436"></a>04436 
<a name="l04437"></a>04437                         <span class="keywordflow">if</span> (!(surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ab4e992f41674ea30309db68c8e3a05b6">effector_weights</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ab4e992f41674ea30309db68c8e3a05b6">effector_weights</a>)))
<a name="l04438"></a>04438                             surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ab4e992f41674ea30309db68c8e3a05b6">effector_weights</a> = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ad0116e11e09f0615cc817f48a9557e85">BKE_add_effector_weights</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04439"></a>04439                     }
<a name="l04440"></a>04440                 }
<a name="l04441"></a>04441             }
<a name="l04442"></a>04442             <span class="keywordflow">if</span> (pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>)
<a name="l04443"></a>04443             {
<a name="l04444"></a>04444                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>);
<a name="l04445"></a>04445                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a19964f5eebc9cc3b94c8961cf3712b62">pmd</a> = pmd;
<a name="l04446"></a>04446                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a3bbdd56fe36172a72fee7da1de581194">psys</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a3bbdd56fe36172a72fee7da1de581194">psys</a>);
<a name="l04447"></a>04447                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a770c7441fb2444e1d820fd6e20fc6a6a">paint_ramp</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a770c7441fb2444e1d820fd6e20fc6a6a">paint_ramp</a>);
<a name="l04448"></a>04448                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a0d98857f862c3a96b6462ccc8619616f">vel_ramp</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a0d98857f862c3a96b6462ccc8619616f">vel_ramp</a>);
<a name="l04449"></a>04449                 pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a08828989cea19bc4b26e7981f2d29305">dm</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04450"></a>04450             }
<a name="l04451"></a>04451         }
<a name="l04452"></a>04452         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435abc95e623f4353951954effc91fe021e2">eModifierType_Collision</a>) {
<a name="l04453"></a>04453             
<a name="l04454"></a>04454             <a class="code" href="../../d7/d2f/structCollisionModifierData.html">CollisionModifierData</a> *collmd = (<a class="code" href="../../d7/d2f/structCollisionModifierData.html">CollisionModifierData</a>*) md;
<a name="l04455"></a>04455             <span class="comment">/*</span>
<a name="l04456"></a>04456 <span class="comment">            // TODO: CollisionModifier should use pointcache </span>
<a name="l04457"></a>04457 <span class="comment">            // + have proper reset events before enabling this</span>
<a name="l04458"></a>04458 <span class="comment">            collmd-&gt;x = newdataadr(fd, collmd-&gt;x);</span>
<a name="l04459"></a>04459 <span class="comment">            collmd-&gt;xnew = newdataadr(fd, collmd-&gt;xnew);</span>
<a name="l04460"></a>04460 <span class="comment">            collmd-&gt;mfaces = newdataadr(fd, collmd-&gt;mfaces);</span>
<a name="l04461"></a>04461 <span class="comment">            </span>
<a name="l04462"></a>04462 <span class="comment">            collmd-&gt;current_x = MEM_callocN(sizeof(MVert)*collmd-&gt;numverts,&quot;current_x&quot;);</span>
<a name="l04463"></a>04463 <span class="comment">            collmd-&gt;current_xnew = MEM_callocN(sizeof(MVert)*collmd-&gt;numverts,&quot;current_xnew&quot;);</span>
<a name="l04464"></a>04464 <span class="comment">            collmd-&gt;current_v = MEM_callocN(sizeof(MVert)*collmd-&gt;numverts,&quot;current_v&quot;);</span>
<a name="l04465"></a>04465 <span class="comment">            */</span>
<a name="l04466"></a>04466             
<a name="l04467"></a>04467             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a38b250a905edd916a73390802ba4f68f">x</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04468"></a>04468             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#aadacf061d6f364d64f7546a7aaf1bba6">xnew</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04469"></a>04469             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a983aff4f3af4f2e177ce25812fd5208e">current_x</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04470"></a>04470             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a3214cd56dc53d10793c4cb1538612464">current_xnew</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04471"></a>04471             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a4c18ca9f89cedb3253e359b0608e9dc1">current_v</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04472"></a>04472             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a0be4c6b05aef14ea7dc015b1741be347">time_x</a> = collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a782c22f53bbf2eb474353f8e4b8736af">time_xnew</a> = -1000;
<a name="l04473"></a>04473             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#ac817a899607599b212178bcd8beeaa5e">numverts</a> = 0;
<a name="l04474"></a>04474             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a239507a70644d0438b50d1969f744aac">bvhtree</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04475"></a>04475             collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#aa4d0e546bf8ad244b27c5336856a12fa">mfaces</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04476"></a>04476             
<a name="l04477"></a>04477         }
<a name="l04478"></a>04478         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5163fb176684a2ff2f47657ac51ab973">eModifierType_Surface</a>) {
<a name="l04479"></a>04479             <a class="code" href="../../df/d40/structSurfaceModifierData.html">SurfaceModifierData</a> *surmd = (<a class="code" href="../../df/d40/structSurfaceModifierData.html">SurfaceModifierData</a>*) md;
<a name="l04480"></a>04480 
<a name="l04481"></a>04481             surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ad1afefb644fb13273366566a1d3a5a80">dm</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04482"></a>04482             surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#a1251b2026266851805ac1267d1a7b4cf">bvhtree</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04483"></a>04483             surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#a6c14657418e02d06eafe698b5db88a21">x</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04484"></a>04484             surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ae9775c51ba39878e23684a54c35e9d4a">v</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04485"></a>04485             surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#a85ce19d62bfa5b0bf7f89b53c2bf3199">numverts</a> = 0;
<a name="l04486"></a>04486         }
<a name="l04487"></a>04487         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a82ec76427c7cc0b352e6aadb2e3d0b89">eModifierType_Hook</a>) {
<a name="l04488"></a>04488             <a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a> *hmd = (<a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a>*) md;
<a name="l04489"></a>04489 
<a name="l04490"></a>04490             hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a93fbc2b0ce30ff63bf0f7e02eb0fa827">indexar</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a93fbc2b0ce30ff63bf0f7e02eb0fa827">indexar</a>);
<a name="l04491"></a>04491             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l04492"></a>04492                 <span class="keywordtype">int</span> a;
<a name="l04493"></a>04493                 <span class="keywordflow">for</span> (a=0; a&lt;hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a0633d7b312679ba4e6df987268024e73">totindex</a>; a++) {
<a name="l04494"></a>04494                     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a93fbc2b0ce30ff63bf0f7e02eb0fa827">indexar</a>[a]);
<a name="l04495"></a>04495                 }
<a name="l04496"></a>04496             }
<a name="l04497"></a>04497         }
<a name="l04498"></a>04498         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a08b7b619df960c74b7097e769c4967a4">eModifierType_ParticleSystem</a>) {
<a name="l04499"></a>04499             <a class="code" href="../../d7/da3/structParticleSystemModifierData.html">ParticleSystemModifierData</a> *psmd = (<a class="code" href="../../d7/da3/structParticleSystemModifierData.html">ParticleSystemModifierData</a>*) md;
<a name="l04500"></a>04500 
<a name="l04501"></a>04501             psmd-&gt;<a class="code" href="../../d7/da3/structParticleSystemModifierData.html#a60596392ae65e3953f6adbc107498bf5">dm</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04502"></a>04502             psmd-&gt;<a class="code" href="../../d7/da3/structParticleSystemModifierData.html#aa9bcfe8519ee16580387345028687078">psys</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, psmd-&gt;<a class="code" href="../../d7/da3/structParticleSystemModifierData.html#aa9bcfe8519ee16580387345028687078">psys</a>);
<a name="l04503"></a>04503             psmd-&gt;<a class="code" href="../../d7/da3/structParticleSystemModifierData.html#abc843013a6e93e2d94b3f45ac8fed2c9">flag</a> &amp;= ~<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a4f03f9ddb8ddeabea182daaa994650afaabaaf7f2d3b45ec49fb96b09b99615a3">eParticleSystemFlag_psys_updated</a>;
<a name="l04504"></a>04504             psmd-&gt;<a class="code" href="../../d7/da3/structParticleSystemModifierData.html#abc843013a6e93e2d94b3f45ac8fed2c9">flag</a> |= <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a4f03f9ddb8ddeabea182daaa994650afacf1f7c8df7f053bf63fde5556122f5ac">eParticleSystemFlag_file_loaded</a>;
<a name="l04505"></a>04505         }
<a name="l04506"></a>04506         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b46d87199ff48ab84d740e3481ab54f">eModifierType_Explode</a>) {
<a name="l04507"></a>04507             <a class="code" href="../../de/dfb/structExplodeModifierData.html">ExplodeModifierData</a> *psmd = (<a class="code" href="../../de/dfb/structExplodeModifierData.html">ExplodeModifierData</a>*) md;
<a name="l04508"></a>04508 
<a name="l04509"></a>04509             psmd-&gt;<a class="code" href="../../de/dfb/structExplodeModifierData.html#a2ae2c9bc31ae0c668f387c76bdc074bb">facepa</a>=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04510"></a>04510         }
<a name="l04511"></a>04511         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a177f813942f48c8705d42b9820e02a80">eModifierType_MeshDeform</a>) {
<a name="l04512"></a>04512             <a class="code" href="../../de/df2/structMeshDeformModifierData.html">MeshDeformModifierData</a> *mmd = (<a class="code" href="../../de/df2/structMeshDeformModifierData.html">MeshDeformModifierData</a>*) md;
<a name="l04513"></a>04513 
<a name="l04514"></a>04514             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a47eaa48153ba2e270f52211a56670b71">bindinfluences</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a47eaa48153ba2e270f52211a56670b71">bindinfluences</a>);
<a name="l04515"></a>04515             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad5bcb347ba1b08b5fa809477ce46bc76">bindoffsets</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad5bcb347ba1b08b5fa809477ce46bc76">bindoffsets</a>);
<a name="l04516"></a>04516             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#af2857fb00435f5809c4ab37c1e3a7281">bindcagecos</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#af2857fb00435f5809c4ab37c1e3a7281">bindcagecos</a>);
<a name="l04517"></a>04517             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8525ae4d16c10f3f37a3bc1a5f46fa36">dyngrid</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8525ae4d16c10f3f37a3bc1a5f46fa36">dyngrid</a>);
<a name="l04518"></a>04518             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a89f5f33ad3c86ea029ddec13a578b11c">dyninfluences</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a89f5f33ad3c86ea029ddec13a578b11c">dyninfluences</a>);
<a name="l04519"></a>04519             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad133406450f26edd932ce27d482c246f">dynverts</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad133406450f26edd932ce27d482c246f">dynverts</a>);
<a name="l04520"></a>04520 
<a name="l04521"></a>04521             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a210a992ff7e6b09d721b7998fd929b81">bindweights</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a210a992ff7e6b09d721b7998fd929b81">bindweights</a>);
<a name="l04522"></a>04522             mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>);
<a name="l04523"></a>04523 
<a name="l04524"></a>04524             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l04525"></a>04525                 <span class="keywordtype">int</span> a;
<a name="l04526"></a>04526 
<a name="l04527"></a>04527                 <span class="keywordflow">if</span> (mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad5bcb347ba1b08b5fa809477ce46bc76">bindoffsets</a>)
<a name="l04528"></a>04528                     <span class="keywordflow">for</span> (a=0; a&lt;mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a51bc7f19643fa62c74841cdcc5a2ea2c">totvert</a>+1; a++)
<a name="l04529"></a>04529                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad5bcb347ba1b08b5fa809477ce46bc76">bindoffsets</a>[a]);
<a name="l04530"></a>04530                 <span class="keywordflow">if</span> (mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#af2857fb00435f5809c4ab37c1e3a7281">bindcagecos</a>)
<a name="l04531"></a>04531                     <span class="keywordflow">for</span> (a=0; a&lt;mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8d21a0e3e8f264d0a9bbf406a134a46d">totcagevert</a>*3; a++)
<a name="l04532"></a>04532                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#af2857fb00435f5809c4ab37c1e3a7281">bindcagecos</a>[a]);
<a name="l04533"></a>04533                 <span class="keywordflow">if</span> (mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad133406450f26edd932ce27d482c246f">dynverts</a>)
<a name="l04534"></a>04534                     <span class="keywordflow">for</span> (a=0; a&lt;mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a51bc7f19643fa62c74841cdcc5a2ea2c">totvert</a>; a++)
<a name="l04535"></a>04535                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad133406450f26edd932ce27d482c246f">dynverts</a>[a]);
<a name="l04536"></a>04536 
<a name="l04537"></a>04537                 <span class="keywordflow">if</span> (mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a210a992ff7e6b09d721b7998fd929b81">bindweights</a>)
<a name="l04538"></a>04538                     <span class="keywordflow">for</span> (a=0; a&lt;mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8d21a0e3e8f264d0a9bbf406a134a46d">totcagevert</a>*mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a51bc7f19643fa62c74841cdcc5a2ea2c">totvert</a>; a++)
<a name="l04539"></a>04539                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a210a992ff7e6b09d721b7998fd929b81">bindweights</a>[a]);
<a name="l04540"></a>04540                 <span class="keywordflow">if</span> (mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>)
<a name="l04541"></a>04541                     <span class="keywordflow">for</span> (a=0; a&lt;mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8d21a0e3e8f264d0a9bbf406a134a46d">totcagevert</a>*3; a++)
<a name="l04542"></a>04542                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>[a]);
<a name="l04543"></a>04543             }
<a name="l04544"></a>04544         }
<a name="l04545"></a>04545         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a996bb95cdb69b90cf0b467d26acda2cf">eModifierType_Ocean</a>) {
<a name="l04546"></a>04546             <a class="code" href="../../dd/da2/structOceanModifierData.html">OceanModifierData</a> *omd = (<a class="code" href="../../dd/da2/structOceanModifierData.html">OceanModifierData</a>*) md;
<a name="l04547"></a>04547             omd-&gt;<a class="code" href="../../dd/da2/structOceanModifierData.html#a78587d758f8b21d9fdc1921152f2bb23">oceancache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04548"></a>04548             omd-&gt;<a class="code" href="../../dd/da2/structOceanModifierData.html#a6110a9d1a5cc07374fc7391563a21fea">ocean</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04549"></a>04549             omd-&gt;<a class="code" href="../../dd/da2/structOceanModifierData.html#a4fe0e1946f6efb86b772ce0f15585ba2">refresh</a> = (<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#ad01b0781949d1f14eb39362eb4cf15ae">MOD_OCEAN_REFRESH_ADD</a>|<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a5cb36818f41a5ce593efab6f213d4a1a">MOD_OCEAN_REFRESH_RESET</a>|<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a25c755b38fb66541d879851929d92c0c">MOD_OCEAN_REFRESH_SIM</a>);
<a name="l04550"></a>04550         }
<a name="l04551"></a>04551         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435aac667e2c4a4fa4c4287ddb0d7d58f37a">eModifierType_Warp</a>) {
<a name="l04552"></a>04552             <a class="code" href="../../d6/d24/structWarpModifierData.html">WarpModifierData</a> *tmd = (<a class="code" href="../../d6/d24/structWarpModifierData.html">WarpModifierData</a> *) md;
<a name="l04553"></a>04553 
<a name="l04554"></a>04554             tmd-&gt;<a class="code" href="../../d6/d24/structWarpModifierData.html#a3c6ed272756ae21aaf4f882e9b42eb28">curfalloff</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, tmd-&gt;<a class="code" href="../../d6/d24/structWarpModifierData.html#a3c6ed272756ae21aaf4f882e9b42eb28">curfalloff</a>);
<a name="l04555"></a>04555             <span class="keywordflow">if</span> (tmd-&gt;<a class="code" href="../../d6/d24/structWarpModifierData.html#a3c6ed272756ae21aaf4f882e9b42eb28">curfalloff</a>)
<a name="l04556"></a>04556                 <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, tmd-&gt;<a class="code" href="../../d6/d24/structWarpModifierData.html#a3c6ed272756ae21aaf4f882e9b42eb28">curfalloff</a>);
<a name="l04557"></a>04557         }
<a name="l04558"></a>04558         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ac782f9207083f596c4d2fa983cc2875d">eModifierType_WeightVGEdit</a>) {
<a name="l04559"></a>04559             <a class="code" href="../../da/d90/structWeightVGEditModifierData.html">WeightVGEditModifierData</a> *wmd = (<a class="code" href="../../da/d90/structWeightVGEditModifierData.html">WeightVGEditModifierData</a>*) md;
<a name="l04560"></a>04560 
<a name="l04561"></a>04561             wmd-&gt;<a class="code" href="../../da/d90/structWeightVGEditModifierData.html#a7fbfe9f2cb0314c61607d921be376945">cmap_curve</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, wmd-&gt;<a class="code" href="../../da/d90/structWeightVGEditModifierData.html#a7fbfe9f2cb0314c61607d921be376945">cmap_curve</a>);
<a name="l04562"></a>04562             <span class="keywordflow">if</span> (wmd-&gt;<a class="code" href="../../da/d90/structWeightVGEditModifierData.html#a7fbfe9f2cb0314c61607d921be376945">cmap_curve</a>)
<a name="l04563"></a>04563                 <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, wmd-&gt;<a class="code" href="../../da/d90/structWeightVGEditModifierData.html#a7fbfe9f2cb0314c61607d921be376945">cmap_curve</a>);
<a name="l04564"></a>04564         }
<a name="l04565"></a>04565     }
<a name="l04566"></a>04566 }
<a name="l04567"></a>04567 
<a name="l04568"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad786ae45ae21936d196d6491052eb74d">04568</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad786ae45ae21936d196d6491052eb74d">direct_link_object</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l04569"></a>04569 {
<a name="l04570"></a>04570     <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l04571"></a>04571     <a class="code" href="../../d8/d4a/structbProperty.html">bProperty</a> *prop;
<a name="l04572"></a>04572     <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens;
<a name="l04573"></a>04573     <a class="code" href="../../dd/d82/structbController.html">bController</a> *cont;
<a name="l04574"></a>04574     <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l04575"></a>04575     
<a name="l04576"></a>04576     <span class="comment">/* weak weak... this was only meant as draw flag, now is used in give_base_to_objects too */</span>
<a name="l04577"></a>04577     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp;= ~<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>;
<a name="l04578"></a>04578 
<a name="l04579"></a>04579     <span class="comment">/* loading saved files with editmode enabled works, but for undo we like</span>
<a name="l04580"></a>04580 <span class="comment">     * to stay in object mode during undo presses so keep editmode disabled */</span>
<a name="l04581"></a>04581     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a6467e0cc2b7091ece80c86fdfba85b75">memfile</a>)
<a name="l04582"></a>04582         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp;= ~(<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a20027b5f4381f062402af134bcefe889">OB_MODE_PARTICLE_EDIT</a>);
<a name="l04583"></a>04583     
<a name="l04584"></a>04584     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04585"></a>04585     
<a name="l04586"></a>04586     ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>);
<a name="l04587"></a>04587     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>);
<a name="l04588"></a>04588     
<a name="l04589"></a>04589     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l04590"></a>04590     <a class="code" href="../../d0/d12/readfile_8c.html#a1d882644a1752229d69214dbafbed302">direct_link_pose</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l04591"></a>04591     
<a name="l04592"></a>04592     ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a>);
<a name="l04593"></a>04593     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a>)
<a name="l04594"></a>04594         <a class="code" href="../../d0/d12/readfile_8c.html#a5eed9839e354374ce7b2f9d1181297a4">direct_link_motionpath</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a>);
<a name="l04595"></a>04595 
<a name="l04596"></a>04596     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a11c2e3299c854eb361471ea041397cb7">defbase</a>);
<a name="l04597"></a>04597 <span class="comment">// XXX depreceated - old animation system &lt;&lt;&lt;</span>
<a name="l04598"></a>04598     <a class="code" href="../../d0/d12/readfile_8c.html#a77aefc8e1a925743654726dbfd0177d8">direct_link_nlastrips</a>(fd, &amp;ob-&gt;nlastrips);
<a name="l04599"></a>04599     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;constraintChannels);
<a name="l04600"></a>04600 <span class="comment">// &gt;&gt;&gt; XXX depreceated - old animation system </span>
<a name="l04601"></a>04601 
<a name="l04602"></a>04602     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l04603"></a>04603     <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l04604"></a>04604     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a58e55b421436f3c376299a2179619150">matbits</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a58e55b421436f3c376299a2179619150">matbits</a>);
<a name="l04605"></a>04605     
<a name="l04606"></a>04606     <span class="comment">/* do it here, below old data gets converted */</span>
<a name="l04607"></a>04607     <a class="code" href="../../d0/d12/readfile_8c.html#ac8116e0739106ff44bb1e64be869285c">direct_link_modifiers</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>);
<a name="l04608"></a>04608     
<a name="l04609"></a>04609     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;effect);
<a name="l04610"></a>04610     paf= ob-&gt;effect.first;
<a name="l04611"></a>04611     <span class="keywordflow">while</span> (paf) {
<a name="l04612"></a>04612         <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a058f8cfb3c8a781264b431c40e4dbaaa">type</a>==<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a712e7ef632d364ac7226cbc7a74b20df">EFF_PARTICLE</a>) {
<a name="l04613"></a>04613             paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a155a6aeff365ebf059327e16dfee1993">keys</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04614"></a>04614         }
<a name="l04615"></a>04615         <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a058f8cfb3c8a781264b431c40e4dbaaa">type</a>==<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#abf528a201aaa6b184f74da22b92caac7">EFF_WAVE</a>) {
<a name="l04616"></a>04616             <a class="code" href="../../d9/df9/structWaveEff.html">WaveEff</a> *wav = (<a class="code" href="../../d9/df9/structWaveEff.html">WaveEff</a>*) paf;
<a name="l04617"></a>04617             <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a4da6369abd847703c33e21d4b26f2fec">next</a>;
<a name="l04618"></a>04618             <a class="code" href="../../df/de2/structWaveModifierData.html">WaveModifierData</a> *wmd = (<a class="code" href="../../df/de2/structWaveModifierData.html">WaveModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a581e87bb4d754fc6e9b4b9884507cbfc">eModifierType_Wave</a>);
<a name="l04619"></a>04619 
<a name="l04620"></a>04620             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#ae0f0a6bcde880f83139f8b966ed0e704">damp</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a3e74a51835e841641ceda6d5c72a40aa">damp</a>;
<a name="l04621"></a>04621             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#a616bb1beba7ec5e15ee18e61a6a00245">flag</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#ad3f6a3a93665601963e9197a047cf69c">flag</a>;
<a name="l04622"></a>04622             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#a819803cb03e4e6cd8d97bb8b90b87627">height</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a191666251eda2ab6182d1971e5190fdb">height</a>;
<a name="l04623"></a>04623             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#aa9af91d9dac89efa0dbc530563202e03">lifetime</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a84862137e48ec198559951cc7c23639f">lifetime</a>;
<a name="l04624"></a>04624             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#aec1fcd09abbc5bbc198b235d7f047d6e">narrow</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#ae4f5cc0a798ec834913819572852c62b">narrow</a>;
<a name="l04625"></a>04625             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#a6450e885cc7520131ca9ba3c572db044">speed</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#aec045fae904e105bda5c3f821ac1d0fb">speed</a>;
<a name="l04626"></a>04626             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#a807d227cfaa32187b83aeb4c3fcdae18">startx</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a7763fe72ae33aa6a0a7541e83c82de2f">startx</a>;
<a name="l04627"></a>04627             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#ad0fb7a9d67f4e076b0fc937ae9de1591">starty</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a7763fe72ae33aa6a0a7541e83c82de2f">startx</a>;
<a name="l04628"></a>04628             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#a5e1f86ee51a321c1855d41b01e5aaf35">timeoffs</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a2256e044081236db5e3dcf65a4601328">timeoffs</a>;
<a name="l04629"></a>04629             wmd-&gt;<a class="code" href="../../df/de2/structWaveModifierData.html#a146668deaad577c7faeec45caccdb398">width</a> = wav-&gt;<a class="code" href="../../d9/df9/structWaveEff.html#a17f45bc234ddc64a283fb5ba84e00622">width</a>;
<a name="l04630"></a>04630 
<a name="l04631"></a>04631             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, wmd);
<a name="l04632"></a>04632 
<a name="l04633"></a>04633             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ob-&gt;effect, paf);
<a name="l04634"></a>04634             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(paf);
<a name="l04635"></a>04635 
<a name="l04636"></a>04636             paf = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l04637"></a>04637             <span class="keywordflow">continue</span>;
<a name="l04638"></a>04638         }
<a name="l04639"></a>04639         <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a058f8cfb3c8a781264b431c40e4dbaaa">type</a>==<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#af3cf03327ae31f586423c0426e12fa4a">EFF_BUILD</a>) {
<a name="l04640"></a>04640             <a class="code" href="../../db/d6a/structBuildEff.html">BuildEff</a> *baf = (<a class="code" href="../../db/d6a/structBuildEff.html">BuildEff</a>*) paf;
<a name="l04641"></a>04641             <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a4da6369abd847703c33e21d4b26f2fec">next</a>;
<a name="l04642"></a>04642             <a class="code" href="../../dd/d95/structBuildModifierData.html">BuildModifierData</a> *bmd = (<a class="code" href="../../dd/d95/structBuildModifierData.html">BuildModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435afb47ce2683f2f42c166989cab7d36b20">eModifierType_Build</a>);
<a name="l04643"></a>04643 
<a name="l04644"></a>04644             bmd-&gt;<a class="code" href="../../dd/d95/structBuildModifierData.html#a02da05ee659ed80684fc24477128a40c">start</a> = baf-&gt;<a class="code" href="../../db/d6a/structBuildEff.html#a1fcf4dbfc911d15b2faf7d853402d4ad">sfra</a>;
<a name="l04645"></a>04645             bmd-&gt;<a class="code" href="../../dd/d95/structBuildModifierData.html#ad7783c6753f34bfd11dd92fdc8faf6e5">length</a> = baf-&gt;<a class="code" href="../../db/d6a/structBuildEff.html#afd4d5c4d05ad3fb04ad8d6b81e6642ae">len</a>;
<a name="l04646"></a>04646             bmd-&gt;<a class="code" href="../../dd/d95/structBuildModifierData.html#a9b0f4b85ce084af02fc297da2869cb25">randomize</a> = 0;
<a name="l04647"></a>04647             bmd-&gt;<a class="code" href="../../dd/d95/structBuildModifierData.html#af8d4ac6c8657d64c21be286c9b8ddda1">seed</a> = 1;
<a name="l04648"></a>04648 
<a name="l04649"></a>04649             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, bmd);
<a name="l04650"></a>04650 
<a name="l04651"></a>04651             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ob-&gt;effect, paf);
<a name="l04652"></a>04652             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(paf);
<a name="l04653"></a>04653 
<a name="l04654"></a>04654             paf = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l04655"></a>04655             <span class="keywordflow">continue</span>;
<a name="l04656"></a>04656         }
<a name="l04657"></a>04657         paf= paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a4da6369abd847703c33e21d4b26f2fec">next</a>;
<a name="l04658"></a>04658     }
<a name="l04659"></a>04659 
<a name="l04660"></a>04660     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>);
<a name="l04661"></a>04661     <a class="code" href="../../d0/d12/readfile_8c.html#a12d9991858a1c844ae142e70b6e57704">direct_link_partdeflect</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>);
<a name="l04662"></a>04662     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>);
<a name="l04663"></a>04663     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>) {
<a name="l04664"></a>04664         <a class="code" href="../../df/d9a/structSoftBody.html">SoftBody</a> *sb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>;     
<a name="l04665"></a>04665         
<a name="l04666"></a>04666         sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#afb9eac0e2c3fe1db404aebfcc65bc81d">bpoint</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">// init pointers so it gets rebuilt nicely</span>
<a name="l04667"></a>04667         sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a99bff20b16a6db04352ecaa5bc07ee34">bspring</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04668"></a>04668         sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#abdd51735258f1805c3ccd91ccee22429">scratch</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04669"></a>04669         <span class="comment">/* although not used anymore */</span>
<a name="l04670"></a>04670         <span class="comment">/* still have to be loaded to be compatible with old files */</span>
<a name="l04671"></a>04671         sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>);
<a name="l04672"></a>04672         <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>);
<a name="l04673"></a>04673         <span class="keywordflow">if</span> (sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>) {
<a name="l04674"></a>04674             <span class="keywordtype">int</span> a;
<a name="l04675"></a>04675             <span class="keywordflow">for</span> (a=0; a&lt;sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a185adbc18adce47a43552cb4e25f4e11">totkey</a>; a++) {
<a name="l04676"></a>04676                 sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>[a]= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>[a]);
<a name="l04677"></a>04677             }
<a name="l04678"></a>04678         }
<a name="l04679"></a>04679 
<a name="l04680"></a>04680         sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a>);
<a name="l04681"></a>04681         <span class="keywordflow">if</span> (!sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a>)
<a name="l04682"></a>04682             sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a> = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ad0116e11e09f0615cc817f48a9557e85">BKE_add_effector_weights</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04683"></a>04683 
<a name="l04684"></a>04684         <a class="code" href="../../d0/d12/readfile_8c.html#ad354138f4061febfeef019bdb5c4141d">direct_link_pointcache_list</a>(fd, &amp;sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a2b4fe2801e797119094ffa33d7a92d59">ptcaches</a>, &amp;sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3cbaa712cbb0289db746f8dbfb34f1bb">pointcache</a>, 0);
<a name="l04685"></a>04685     }
<a name="l04686"></a>04686     ob-&gt;<a class="code" href="../../de/de7/structObject.html#acaa3b12bf1664333e0bb2a4327faaef6">bsoft</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#acaa3b12bf1664333e0bb2a4327faaef6">bsoft</a>);
<a name="l04687"></a>04687     ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac9ec82c5bdfa258cad2205e7e6dc73bd">fluidsimSettings</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac9ec82c5bdfa258cad2205e7e6dc73bd">fluidsimSettings</a>); <span class="comment">/* NT */</span>
<a name="l04688"></a>04688 
<a name="l04689"></a>04689     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>);
<a name="l04690"></a>04690     <a class="code" href="../../d0/d12/readfile_8c.html#af4c21de878c55bdf8e024a6d3ca94eb0">direct_link_particlesystems</a>(fd,&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>);
<a name="l04691"></a>04691     
<a name="l04692"></a>04692     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a08b5ac6620501dec9b98cb9f8c9a1fa3">prop</a>);
<a name="l04693"></a>04693     prop= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a08b5ac6620501dec9b98cb9f8c9a1fa3">prop</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04694"></a>04694     <span class="keywordflow">while</span> (prop) {
<a name="l04695"></a>04695         prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a>);
<a name="l04696"></a>04696         <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a>= &amp;prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#ae2e33a29623167cbed18f813196181f2">data</a>;
<a name="l04697"></a>04697         prop= prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a00f412f0af27917829febb5132a160d9">next</a>;
<a name="l04698"></a>04698     }
<a name="l04699"></a>04699 
<a name="l04700"></a>04700     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>);
<a name="l04701"></a>04701     sens= ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04702"></a>04702     <span class="keywordflow">while</span> (sens) {
<a name="l04703"></a>04703         sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l04704"></a>04704         sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>);
<a name="l04705"></a>04705         <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>);
<a name="l04706"></a>04706         sens= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>;
<a name="l04707"></a>04707     }
<a name="l04708"></a>04708 
<a name="l04709"></a>04709     <a class="code" href="../../d0/d12/readfile_8c.html#ab5d64cf8cddd50141495646c6bbd63d0">direct_link_constraints</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>);
<a name="l04710"></a>04710 
<a name="l04711"></a>04711     <a class="code" href="../../d0/d12/readfile_8c.html#a0dfb60f03d09ef7d48c5c1bed59aef2b">link_glob_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae2499a91d26d9dc8829a0505f6008066">controllers</a>);
<a name="l04712"></a>04712     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5a3666f4a715fa60324a0efec6d722ab">init_state</a>) {
<a name="l04713"></a>04713         <span class="comment">/* if a known first state is specified, set it so that the game will start ok */</span>
<a name="l04714"></a>04714         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0db8d849f3d902f13e2f102848182758">state</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5a3666f4a715fa60324a0efec6d722ab">init_state</a>;
<a name="l04715"></a>04715     }
<a name="l04716"></a>04716     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0db8d849f3d902f13e2f102848182758">state</a>) {
<a name="l04717"></a>04717         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0db8d849f3d902f13e2f102848182758">state</a> = 1;
<a name="l04718"></a>04718     }
<a name="l04719"></a>04719     cont= ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae2499a91d26d9dc8829a0505f6008066">controllers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04720"></a>04720     <span class="keywordflow">while</span> (cont) {
<a name="l04721"></a>04721         cont-&gt;<a class="code" href="../../dd/d82/structbController.html#af6c30d2aedadc64bc687eb503a44b800">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cont-&gt;<a class="code" href="../../dd/d82/structbController.html#af6c30d2aedadc64bc687eb503a44b800">data</a>);
<a name="l04722"></a>04722         cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8547b3b1dc994585185196bdaaf063b7">links</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8547b3b1dc994585185196bdaaf063b7">links</a>);
<a name="l04723"></a>04723         <a class="code" href="../../d0/d12/readfile_8c.html#aacac1f8dc83840181f33a2c99d333e52">test_pointer_array</a>(fd, (<span class="keywordtype">void</span> **)&amp;cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8547b3b1dc994585185196bdaaf063b7">links</a>);
<a name="l04724"></a>04724         <span class="keywordflow">if</span> (cont-&gt;<a class="code" href="../../dd/d82/structbController.html#ad6f52ffd576755d8622aa22ee126551e">state_mask</a> == 0)
<a name="l04725"></a>04725             cont-&gt;<a class="code" href="../../dd/d82/structbController.html#ad6f52ffd576755d8622aa22ee126551e">state_mask</a> = 1;
<a name="l04726"></a>04726         cont= cont-&gt;<a class="code" href="../../dd/d82/structbController.html#abd185fdf6022047bfd51966024e3820b">next</a>;
<a name="l04727"></a>04727     }
<a name="l04728"></a>04728 
<a name="l04729"></a>04729     <a class="code" href="../../d0/d12/readfile_8c.html#a0dfb60f03d09ef7d48c5c1bed59aef2b">link_glob_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>);
<a name="l04730"></a>04730     act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04731"></a>04731     <span class="keywordflow">while</span> (act) {
<a name="l04732"></a>04732         act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l04733"></a>04733         act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l04734"></a>04734     }
<a name="l04735"></a>04735 
<a name="l04736"></a>04736     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;hooks);
<a name="l04737"></a>04737     <span class="keywordflow">while</span> (ob-&gt;hooks.first) {
<a name="l04738"></a>04738         <a class="code" href="../../d3/df1/structObHook.html">ObHook</a> *hook = ob-&gt;hooks.first;
<a name="l04739"></a>04739         <a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a> *hmd = (<a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a82ec76427c7cc0b352e6aadb2e3d0b89">eModifierType_Hook</a>);
<a name="l04740"></a>04740 
<a name="l04741"></a>04741         hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#abf4fe97c6ff5945937fa6b6efe2046cc">indexar</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#abf4fe97c6ff5945937fa6b6efe2046cc">indexar</a>);
<a name="l04742"></a>04742         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l04743"></a>04743             <span class="keywordtype">int</span> a;
<a name="l04744"></a>04744             <span class="keywordflow">for</span> (a=0; a&lt;hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#a710e23419512710a56ef2ff97acc5a21">totindex</a>; a++) {
<a name="l04745"></a>04745                 <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae65963c3712c0a69691ab4e1e2dd32ed">SWITCH_INT</a>(hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#abf4fe97c6ff5945937fa6b6efe2046cc">indexar</a>[a]);
<a name="l04746"></a>04746             }
<a name="l04747"></a>04747         }
<a name="l04748"></a>04748 
<a name="l04749"></a>04749             <span class="comment">/* Do conversion here because if we have loaded</span>
<a name="l04750"></a>04750 <span class="comment">             * a hook we need to make sure it gets converted</span>
<a name="l04751"></a>04751 <span class="comment">             * and freed, regardless of version.</span>
<a name="l04752"></a>04752 <span class="comment">             */</span>
<a name="l04753"></a>04753         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#af21fa566f20408a653399940303a8dd9">cent</a>, hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#a663e4dd23d90e6f7b1c9bbfda643e5a7">cent</a>);
<a name="l04754"></a>04754         hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#ae83aec578242a2bf4fa0c6bb05143fa5">falloff</a> = hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#af6e6ee22d7e9f8272af857ed33955bc9">falloff</a>;
<a name="l04755"></a>04755         hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a471685e3580678d645ae9d284b7af04c">force</a> = hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#a13bf4c3ba6342d688faaedcf67bed142">force</a>;
<a name="l04756"></a>04756         hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a93fbc2b0ce30ff63bf0f7e02eb0fa827">indexar</a> = hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#abf4fe97c6ff5945937fa6b6efe2046cc">indexar</a>;
<a name="l04757"></a>04757         hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#ae539a97632b216b678294b1c1fa80a88">object</a> = hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#a29b8c86b4bea412bb7c3f05d38678c52">parent</a>;
<a name="l04758"></a>04758         memcpy(hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a8d4cb6d040d73d8fd4d3e9b8e10c0318">parentinv</a>, hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#afa1599329e75a2e3e63ac3f4d15a8cef">parentinv</a>, <span class="keyword">sizeof</span>(hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a8d4cb6d040d73d8fd4d3e9b8e10c0318">parentinv</a>));
<a name="l04759"></a>04759         hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a0633d7b312679ba4e6df987268024e73">totindex</a> = hook-&gt;<a class="code" href="../../d3/df1/structObHook.html#a710e23419512710a56ef2ff97acc5a21">totindex</a>;
<a name="l04760"></a>04760 
<a name="l04761"></a>04761         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, hmd);
<a name="l04762"></a>04762         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ob-&gt;hooks, hook);
<a name="l04763"></a>04763         
<a name="l04764"></a>04764         <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a3a5b9d70c91ea8daeaf40173bad993e0">modifier_unique_name</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, (<a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a>*)hmd);
<a name="l04765"></a>04765 
<a name="l04766"></a>04766         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(hook);
<a name="l04767"></a>04767     }
<a name="l04768"></a>04768     
<a name="l04769"></a>04769     ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad6f3be8d4a9745faa3b8145ab3a09b33">customdata_mask</a>= 0;
<a name="l04770"></a>04770     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04771"></a>04771     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a75bea6e258885840c46b755cec75f7d0">derivedDeform</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04772"></a>04772     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04773"></a>04773     ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa48036a92e658b42f6e0a3f8a73e8789">gpulamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa48036a92e658b42f6e0a3f8a73e8789">gpulamp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04774"></a>04774     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ab34748e2eb95f79650ab64dcec24d84a">pc_ids</a>);
<a name="l04775"></a>04775 
<a name="l04776"></a>04776     <span class="comment">/* in case this value changes in future, clamp else we get undefined behavior */</span>
<a name="l04777"></a>04777     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aacca751408fdb1bc64d18670bcc4d73e">rotmode</a>, <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca99392170dcd8a630c175795587ff4a25">ROT_MODE_MIN</a>, <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddaca4f1266fc5880b47c67868fe915d6945d">ROT_MODE_MAX</a>);
<a name="l04778"></a>04778 
<a name="l04779"></a>04779     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a>) {
<a name="l04780"></a>04780         ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/de3/structSculptSession.html">SculptSession</a>), <span class="stringliteral">&quot;reload sculpt session&quot;</span>);
<a name="l04781"></a>04781     }
<a name="l04782"></a>04782 }
<a name="l04783"></a>04783 
<a name="l04784"></a>04784 <span class="comment">/* ************ READ SCENE ***************** */</span>
<a name="l04785"></a>04785 
<a name="l04786"></a>04786 <span class="comment">/* patch for missing scene IDs, can&#39;t be in do-versions */</span>
<a name="l04787"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5a73b236e267718efcac3b8b8b1396c5">04787</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5a73b236e267718efcac3b8b8b1396c5">composite_patch</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene)
<a name="l04788"></a>04788 {
<a name="l04789"></a>04789     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l04790"></a>04790     
<a name="l04791"></a>04791     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l04792"></a>04792         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#afebb3fe5e904f63ef36f0dce271da9ed">CMP_NODE_COMPOSITE</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a2086c1d38c6ebfa4ff268bf267b7920a">CMP_NODE_DEFOCUS</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a993ae4ed5e6e026e42a3f81b3ef71787">CMP_NODE_OUTPUT_FILE</a>))
<a name="l04793"></a>04793             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>;
<a name="l04794"></a>04794 }
<a name="l04795"></a>04795 
<a name="l04796"></a><a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">04796</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">link_paint</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>)
<a name="l04797"></a>04797 {
<a name="l04798"></a>04798     <span class="keywordflow">if</span> (p) {
<a name="l04799"></a>04799         p-&gt;<a class="code" href="../../d0/d6c/structPaint.html#ac834513369efaacc14168587aa759f12">brush</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, p-&gt;<a class="code" href="../../d0/d6c/structPaint.html#ac834513369efaacc14168587aa759f12">brush</a>);
<a name="l04800"></a>04800         p-&gt;<a class="code" href="../../d0/d6c/structPaint.html#a7dc6da5441cf836834a5844fedfa9601">paint_cursor</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04801"></a>04801     }
<a name="l04802"></a>04802 }
<a name="l04803"></a>04803 
<a name="l04804"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa12d0dda3a7a01dffa62536294ba1f47">04804</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa12d0dda3a7a01dffa62536294ba1f47">lib_link_scene</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l04805"></a>04805 {
<a name="l04806"></a>04806     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l04807"></a>04807     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l04808"></a>04808     <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l04809"></a>04809     <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl;
<a name="l04810"></a>04810     <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker;
<a name="l04811"></a>04811     
<a name="l04812"></a>04812     sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04813"></a>04813     <span class="keywordflow">while</span> (sce) {
<a name="l04814"></a>04814         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l04815"></a>04815             <span class="comment">/* Link ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l04816"></a>04816 <span class="comment">             * of library blocks that implement this.*/</span>
<a name="l04817"></a>04817             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a255483f7cd05cd78c4d2a9f6a0cd1417">IDP_LibLinkProperty</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l04818"></a>04818             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>);
<a name="l04819"></a>04819             
<a name="l04820"></a>04820             <a class="code" href="../../d0/d12/readfile_8c.html#a6447acffc2858d1c4be0519036e1d9b8">lib_link_keyingsets</a>(fd, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a61668a1aa7d493a6c770b8cd7a9c9e4e">keyingsets</a>);
<a name="l04821"></a>04821             
<a name="l04822"></a>04822             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>);
<a name="l04823"></a>04823             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>);
<a name="l04824"></a>04824             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af89a023123108ed72002144681d7621b">set</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af89a023123108ed72002144681d7621b">set</a>);
<a name="l04825"></a>04825             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa06b54d17dc1e7798392886eb3b0923a">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa06b54d17dc1e7798392886eb3b0923a">gpd</a>);
<a name="l04826"></a>04826             
<a name="l04827"></a>04827             <a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">link_paint</a>(fd, sce, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a266f9f0d61a292f88102781150d7acc5">paint</a>);
<a name="l04828"></a>04828             <a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">link_paint</a>(fd, sce, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a71507c50ae356599dfb4bafef460474c">vpaint</a>-&gt;<a class="code" href="../../de/d1e/structVPaint.html#a91639c084be23729115954704b03c518">paint</a>);
<a name="l04829"></a>04829             <a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">link_paint</a>(fd, sce, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#affa3e524b9068ff98a5f00bb56d8b4e2">wpaint</a>-&gt;<a class="code" href="../../de/d1e/structVPaint.html#a91639c084be23729115954704b03c518">paint</a>);
<a name="l04830"></a>04830             <a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">link_paint</a>(fd, sce, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a1a36b13607238910a064c1b9b61430e5">imapaint</a>.<a class="code" href="../../d1/d54/structImagePaintSettings.html#a2ef68c48836293b4bdbddd0dcedf958b">paint</a>);
<a name="l04831"></a>04831             <a class="code" href="../../d0/d12/readfile_8c.html#a39b0b4fe93c5e26cc029103d75588677">link_paint</a>(fd, sce, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ae213655363e0b6c06991bc62b04c346c">uvsculpt</a>-&gt;<a class="code" href="../../d6/dcf/structUvSculpt.html#acc76f2f5b6ea63dc6951b306d23e7426">paint</a>);
<a name="l04832"></a>04832             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a0b3e6934d24cf388fee2771f07ae3ca9">skgen_template</a>);
<a name="l04833"></a>04833 
<a name="l04834"></a>04834             <span class="keywordflow">for</span> (base= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= next) {
<a name="l04835"></a>04835                 next= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>;
<a name="l04836"></a>04836 
<a name="l04837"></a>04837                 <span class="comment">/* base-&gt;object= newlibadr_us(fd, sce-&gt;id.lib, base-&gt;object); */</span>
<a name="l04838"></a>04838                 base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>);
<a name="l04839"></a>04839                 
<a name="l04840"></a>04840                 <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04841"></a>04841                     <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>,
<a name="l04842"></a>04842                                      <span class="stringliteral">&quot;LIB ERROR: Object lost from scene:&#39;%s\&#39;\n&quot;</span>,
<a name="l04843"></a>04843                                      sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l04844"></a>04844                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>, base);
<a name="l04845"></a>04845                     <span class="keywordflow">if</span> (base==sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04846"></a>04846                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(base);
<a name="l04847"></a>04847                 }
<a name="l04848"></a>04848             }
<a name="l04849"></a>04849 
<a name="l04850"></a>04850             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l04851"></a>04851                 <span class="keywordflow">if</span> (seq-&gt;ipo) seq-&gt;ipo= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, seq-&gt;ipo);
<a name="l04852"></a>04852                 seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a424b12e52a2943c13a922b52de6e0845">scene_sound</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04853"></a>04853                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>) {
<a name="l04854"></a>04854                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>);
<a name="l04855"></a>04855                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>) {
<a name="l04856"></a>04856                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a424b12e52a2943c13a922b52de6e0845">scene_sound</a> = <a class="code" href="../../d2/db1/BKE__sound_8h.html#a94cd9e35c183183be94644c479e0d6e3">sound_scene_add_scene_sound_defaults</a>(sce, seq);
<a name="l04857"></a>04857                     }
<a name="l04858"></a>04858                 }
<a name="l04859"></a>04859                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a05a69413de632e815ce54732152a7b39">clip</a>) {
<a name="l04860"></a>04860                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a05a69413de632e815ce54732152a7b39">clip</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a05a69413de632e815ce54732152a7b39">clip</a>);
<a name="l04861"></a>04861                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a05a69413de632e815ce54732152a7b39">clip</a>-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l04862"></a>04862                 }
<a name="l04863"></a>04863                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>) seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>);
<a name="l04864"></a>04864                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>) {
<a name="l04865"></a>04865                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a424b12e52a2943c13a922b52de6e0845">scene_sound</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04866"></a>04866                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af135daf13efd69a8d844dc7d9058cdc1">SEQ_HD_SOUND</a>)
<a name="l04867"></a>04867                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> = <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a3667844452f6c2f4b40e851fb3cf5132">SEQ_SOUND</a>;
<a name="l04868"></a>04868                     <span class="keywordflow">else</span>
<a name="l04869"></a>04869                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>);
<a name="l04870"></a>04870                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>) {
<a name="l04871"></a>04871                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l04872"></a>04872                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a424b12e52a2943c13a922b52de6e0845">scene_sound</a> = <a class="code" href="../../d2/db1/BKE__sound_8h.html#a08efb69894c1b50d50c5473839f28b94">sound_add_scene_sound_defaults</a>(sce, seq);
<a name="l04873"></a>04873                     }
<a name="l04874"></a>04874                 }
<a name="l04875"></a>04875                 seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#abd6a16e3e4b0c9f400b9e1d3bcfecea9">anim</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04876"></a>04876             }
<a name="l04877"></a>04877             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l04878"></a>04878 
<a name="l04879"></a>04879 <span class="preprocessor">#ifdef DURIAN_CAMERA_SWITCH</span>
<a name="l04880"></a>04880 <span class="preprocessor"></span>            <span class="keywordflow">for</span> (marker= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad75df026c409d765b297e18f988b9d93">markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; marker; marker= marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#ae24b020d13fed8c505c8c6405e31d6a6">next</a>) {
<a name="l04881"></a>04881                 <span class="keywordflow">if</span> (marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>) {
<a name="l04882"></a>04882                     marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>);
<a name="l04883"></a>04883                 }
<a name="l04884"></a>04884             }
<a name="l04885"></a>04885 <span class="preprocessor">#else</span>
<a name="l04886"></a>04886 <span class="preprocessor"></span>            (void)marker;
<a name="l04887"></a>04887 <span class="preprocessor">#endif</span>
<a name="l04888"></a>04888 <span class="preprocessor"></span>
<a name="l04889"></a>04889             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#acf8f5ba64230d559c282e40ba7070a02">seq_update_muting</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>);
<a name="l04890"></a>04890             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a010877e84f5abee618f18f04ccb09b97">seq_update_sound_bounds_all</a>(sce);
<a name="l04891"></a>04891             
<a name="l04892"></a>04892             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l04893"></a>04893                 <a class="code" href="../../d0/d12/readfile_8c.html#a2e07c659657101d23a45e17c94457d1d">lib_link_ntree</a>(fd, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l04894"></a>04894                 <a class="code" href="../../d0/d12/readfile_8c.html#a5a73b236e267718efcac3b8b8b1396c5">composite_patch</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, sce);
<a name="l04895"></a>04895             }
<a name="l04896"></a>04896             
<a name="l04897"></a>04897             <span class="keywordflow">for</span> (srl= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; srl; srl= srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a9363918698634136fa21bafcabd79d27">next</a>) {
<a name="l04898"></a>04898                 srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#af2bc33ebc78690c013b75f8cd6003f87">mat_override</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#af2bc33ebc78690c013b75f8cd6003f87">mat_override</a>);
<a name="l04899"></a>04899                 srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a94cbd24a166c1c093fccd583e08cd3ae">light_override</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a94cbd24a166c1c093fccd583e08cd3ae">light_override</a>);
<a name="l04900"></a>04900             }
<a name="l04901"></a>04901             <span class="comment">/*Game Settings: Dome Warp Text*/</span>
<a name="l04902"></a>04902             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a66ee375e57bb5216b7317965976aaadf">warptext</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a66ee375e57bb5216b7317965976aaadf">warptext</a>);
<a name="l04903"></a>04903 
<a name="l04904"></a>04904             <span class="comment">/* Motion Tracking */</span>
<a name="l04905"></a>04905             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a5ff6096f2dbaa433889794ded2733521">clip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a5ff6096f2dbaa433889794ded2733521">clip</a>);
<a name="l04906"></a>04906 
<a name="l04907"></a>04907             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l04908"></a>04908         }
<a name="l04909"></a>04909 
<a name="l04910"></a>04910         sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l04911"></a>04911     }
<a name="l04912"></a>04912 }
<a name="l04913"></a>04913 
<a name="l04914"></a><a class="code" href="../../d0/d12/readfile_8c.html#acaf0e63123a78225f244ec3af61e1b1b">04914</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#acaf0e63123a78225f244ec3af61e1b1b">link_recurs_seq</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l04915"></a>04915 {
<a name="l04916"></a>04916     <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l04917"></a>04917 
<a name="l04918"></a>04918     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, lb);
<a name="l04919"></a>04919 
<a name="l04920"></a>04920     <span class="keywordflow">for</span> (seq=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; seq; seq=seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#ad4de4f8111ab2794d21cfbd6a2fc1810">next</a>)
<a name="l04921"></a>04921         <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa36ece483e44a2f715bc29b396284bc0">seqbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l04922"></a>04922             <a class="code" href="../../d0/d12/readfile_8c.html#acaf0e63123a78225f244ec3af61e1b1b">link_recurs_seq</a>(fd, &amp;seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa36ece483e44a2f715bc29b396284bc0">seqbase</a>);
<a name="l04923"></a>04923 }
<a name="l04924"></a>04924 
<a name="l04925"></a><a class="code" href="../../d0/d12/readfile_8c.html#a63038a4aba055a9b7ced7e841102ab88">04925</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a63038a4aba055a9b7ced7e841102ab88">direct_link_paint</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> **paint)
<a name="l04926"></a>04926 {
<a name="l04927"></a>04927 <span class="comment">/* TODO. is this needed */</span>
<a name="l04928"></a>04928     (*paint)= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, (*paint));
<a name="l04929"></a>04929 }
<a name="l04930"></a>04930 
<a name="l04931"></a><a class="code" href="../../d0/d12/readfile_8c.html#add50553ce5281b5b24b94aa13ad31656">04931</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#add50553ce5281b5b24b94aa13ad31656">direct_link_scene</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l04932"></a>04932 {
<a name="l04933"></a>04933     <a class="code" href="../../d5/de9/structEditing.html">Editing</a> *ed;
<a name="l04934"></a>04934     <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l04935"></a>04935     <a class="code" href="../../de/d91/structMetaStack.html">MetaStack</a> *ms;
<a name="l04936"></a>04936 
<a name="l04937"></a>04937     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04938"></a>04938     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a60df6215bf46c09e3f85c984731a7669">dagisvalid</a> = 0;
<a name="l04939"></a>04939     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04940"></a>04940     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ab88f4efbfce140ab3cefe9eb89476282">stats</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04941"></a>04941     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a63fc7eaaf0da3042f687458e69d45de1">fps_info</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04942"></a>04942     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a174dd84bce4450b19e545a4e625920e4">customdata_mask_modal</a>= 0;
<a name="l04943"></a>04943     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a65b906a7684131113d6b138e3cd57d3e">lay_updated</a> = 0;
<a name="l04944"></a>04944 
<a name="l04945"></a>04945     <a class="code" href="../../d2/db1/BKE__sound_8h.html#a49eebb03fe163031f8f117ef1cdec992">sound_create_scene</a>(sce);
<a name="l04946"></a>04946 
<a name="l04947"></a>04947     <span class="comment">/* set users to one by default, not in lib-link, this will increase it for compo nodes */</span>
<a name="l04948"></a>04948     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l04949"></a>04949 
<a name="l04950"></a>04950     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>));
<a name="l04951"></a>04951     
<a name="l04952"></a>04952     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>);
<a name="l04953"></a>04953     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>);
<a name="l04954"></a>04954     
<a name="l04955"></a>04955     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a61668a1aa7d493a6c770b8cd7a9c9e4e">keyingsets</a>);
<a name="l04956"></a>04956     <a class="code" href="../../d0/d12/readfile_8c.html#aea0b18ce81da9358ef816b4617119e2e">direct_link_keyingsets</a>(fd, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a61668a1aa7d493a6c770b8cd7a9c9e4e">keyingsets</a>);
<a name="l04957"></a>04957     
<a name="l04958"></a>04958     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>);
<a name="l04959"></a>04959     
<a name="l04960"></a>04960     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>);
<a name="l04961"></a>04961     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>) {
<a name="l04962"></a>04962         <a class="code" href="../../d0/d12/readfile_8c.html#a63038a4aba055a9b7ced7e841102ab88">direct_link_paint</a>(fd, (<a class="code" href="../../d0/d6c/structPaint.html">Paint</a>**)&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>);
<a name="l04963"></a>04963         <a class="code" href="../../d0/d12/readfile_8c.html#a63038a4aba055a9b7ced7e841102ab88">direct_link_paint</a>(fd, (<a class="code" href="../../d0/d6c/structPaint.html">Paint</a>**)&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a71507c50ae356599dfb4bafef460474c">vpaint</a>);
<a name="l04964"></a>04964         <a class="code" href="../../d0/d12/readfile_8c.html#a63038a4aba055a9b7ced7e841102ab88">direct_link_paint</a>(fd, (<a class="code" href="../../d0/d6c/structPaint.html">Paint</a>**)&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#affa3e524b9068ff98a5f00bb56d8b4e2">wpaint</a>);
<a name="l04965"></a>04965         <a class="code" href="../../d0/d12/readfile_8c.html#a63038a4aba055a9b7ced7e841102ab88">direct_link_paint</a>(fd, (<a class="code" href="../../d0/d6c/structPaint.html">Paint</a>**)&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ae213655363e0b6c06991bc62b04c346c">uvsculpt</a>);
<a name="l04966"></a>04966 
<a name="l04967"></a>04967         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a1a36b13607238910a064c1b9b61430e5">imapaint</a>.<a class="code" href="../../d1/d54/structImagePaintSettings.html#a0f84f3e7f50bd1a30c7cf36e52e3817a">paintcursor</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04968"></a>04968         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a931875e2d55fef9de65c777431a94f31">particle</a>.<a class="code" href="../../df/db7/structParticleEditSettings.html#af0b040219b3bb5229e1f730011030fd9">paintcursor</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04969"></a>04969     }
<a name="l04970"></a>04970 
<a name="l04971"></a>04971     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>) {
<a name="l04972"></a>04972         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *old_seqbasep= &amp;((<a class="code" href="../../d5/de9/structEditing.html">Editing</a> *)sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>)-&gt;seqbase;
<a name="l04973"></a>04973         
<a name="l04974"></a>04974         ed= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>);
<a name="l04975"></a>04975 
<a name="l04976"></a>04976         ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a3557a6d5b10e3903ce4300e3dea13c36">act_seq</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a3557a6d5b10e3903ce4300e3dea13c36">act_seq</a>);
<a name="l04977"></a>04977 
<a name="l04978"></a>04978         <span class="comment">/* recursive link sequences, lb will be correctly initialized */</span>
<a name="l04979"></a>04979         <a class="code" href="../../d0/d12/readfile_8c.html#acaf0e63123a78225f244ec3af61e1b1b">link_recurs_seq</a>(fd, &amp;ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>);
<a name="l04980"></a>04980 
<a name="l04981"></a>04981         <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(ed, seq) {
<a name="l04982"></a>04982             seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#ab7595a789e425d70fba09325dc85404d">seq1</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#ab7595a789e425d70fba09325dc85404d">seq1</a>);
<a name="l04983"></a>04983             seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#acf49b2f41e3b26a1eaaafcdeb075e41d">seq2</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#acf49b2f41e3b26a1eaaafcdeb075e41d">seq2</a>);
<a name="l04984"></a>04984             seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a3bddc2c587641a96b5f753443ccd97f3">seq3</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a3bddc2c587641a96b5f753443ccd97f3">seq3</a>);
<a name="l04985"></a>04985             <span class="comment">/* a patch: after introduction of effects with 3 input strips */</span>
<a name="l04986"></a>04986             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a3bddc2c587641a96b5f753443ccd97f3">seq3</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a3bddc2c587641a96b5f753443ccd97f3">seq3</a>= seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#acf49b2f41e3b26a1eaaafcdeb075e41d">seq2</a>;
<a name="l04987"></a>04987 
<a name="l04988"></a>04988             seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a2ce155f30310ee1bf2aca9459e0e1780">plugin</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a2ce155f30310ee1bf2aca9459e0e1780">plugin</a>);
<a name="l04989"></a>04989             seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>);
<a name="l04990"></a>04990             
<a name="l04991"></a>04991             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a4af5720a811adce10514f7495b880734">SEQ_EFFECT</a>)
<a name="l04992"></a>04992                 seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> |= <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a74f24bc783f6f429ad2509f9cf6bde25">SEQ_EFFECT_NOT_LOADED</a>;
<a name="l04993"></a>04993 
<a name="l04994"></a>04994             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a83413469cce986fba23ad6412baa63c6">SEQ_SPEED</a>) {
<a name="l04995"></a>04995                 <a class="code" href="../../d7/d01/structSpeedControlVars.html">SpeedControlVars</a> *s= seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>;
<a name="l04996"></a>04996                 s-&gt;<a class="code" href="../../d7/d01/structSpeedControlVars.html#aa726e88aad79fcaa0ea1bc9ec2d97448">frameMap</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04997"></a>04997             }
<a name="l04998"></a>04998 
<a name="l04999"></a>04999             seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>);
<a name="l05000"></a>05000             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a> &amp;&amp; seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a9bb3647b2bfc887c64bfe537f90ece9a">done</a>==0) {
<a name="l05001"></a>05001                 seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a9bb3647b2bfc887c64bfe537f90ece9a">done</a>= 1;
<a name="l05002"></a>05002 
<a name="l05003"></a>05003                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#ac06b183625bca249c8c0d1168f907aeb">SEQ_IMAGE</a> ||
<a name="l05004"></a>05004                    seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af37f12bdb831d524294dcd62ff0a8805">SEQ_MOVIE</a> ||
<a name="l05005"></a>05005                    seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a8b0dfdfbb5067b1fe563ac12b3df6c69">SEQ_RAM_SOUND</a> ||
<a name="l05006"></a>05006                    seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af135daf13efd69a8d844dc7d9058cdc1">SEQ_HD_SOUND</a>) {
<a name="l05007"></a>05007                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(
<a name="l05008"></a>05008                         fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a>);
<a name="l05009"></a>05009                 }
<a name="l05010"></a>05010                 <span class="keywordflow">else</span> {
<a name="l05011"></a>05011                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05012"></a>05012                 }
<a name="l05013"></a>05013                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#aae93fd5ad47e10cad18a068f1bbd87e1">SEQ_USE_CROP</a>) {
<a name="l05014"></a>05014                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a8fc7c9bf25fc3ea39df3d610dccd8c98">crop</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(
<a name="l05015"></a>05015                         fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a8fc7c9bf25fc3ea39df3d610dccd8c98">crop</a>);
<a name="l05016"></a>05016                 }
<a name="l05017"></a>05017                 <span class="keywordflow">else</span> {
<a name="l05018"></a>05018                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a8fc7c9bf25fc3ea39df3d610dccd8c98">crop</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05019"></a>05019                 }
<a name="l05020"></a>05020                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a2204e50084fbbed919186dc2dad36f14">SEQ_USE_TRANSFORM</a>) {
<a name="l05021"></a>05021                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5af17c211cfb7bcbce74cccb65dce646">transform</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(
<a name="l05022"></a>05022                         fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5af17c211cfb7bcbce74cccb65dce646">transform</a>);
<a name="l05023"></a>05023                 }
<a name="l05024"></a>05024                 <span class="keywordflow">else</span> {
<a name="l05025"></a>05025                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5af17c211cfb7bcbce74cccb65dce646">transform</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05026"></a>05026                 }
<a name="l05027"></a>05027                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a4d0c26e4068782fec7aa66f28f085d77">SEQ_USE_PROXY</a>) {
<a name="l05028"></a>05028                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(
<a name="l05029"></a>05029                         fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>);
<a name="l05030"></a>05030                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>-&gt;<a class="code" href="../../da/d3b/structStripProxy.html#a3aeb3562a48dc034aa13202710d76445">anim</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05031"></a>05031                 }
<a name="l05032"></a>05032                 <span class="keywordflow">else</span> {
<a name="l05033"></a>05033                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05034"></a>05034                 }
<a name="l05035"></a>05035                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a305a49ff2589843313114656f4048c47">SEQ_USE_COLOR_BALANCE</a>) {
<a name="l05036"></a>05036                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a233ff06d80b67b79240b38c5b6146165">color_balance</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(
<a name="l05037"></a>05037                         fd, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a233ff06d80b67b79240b38c5b6146165">color_balance</a>);
<a name="l05038"></a>05038                 }
<a name="l05039"></a>05039                 <span class="keywordflow">else</span> {
<a name="l05040"></a>05040                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a233ff06d80b67b79240b38c5b6146165">color_balance</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05041"></a>05041                 }
<a name="l05042"></a>05042                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a233ff06d80b67b79240b38c5b6146165">color_balance</a>) {
<a name="l05043"></a>05043                     <span class="comment">// seq-&gt;strip-&gt;color_balance-&gt;gui = 0; // XXX - peter, is this relevant in 2.5?</span>
<a name="l05044"></a>05044                 }
<a name="l05045"></a>05045             }
<a name="l05046"></a>05046         }
<a name="l05047"></a>05047         <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l05048"></a>05048         
<a name="l05049"></a>05049         <span class="comment">/* link metastack, slight abuse of structs here, have to restore pointer to internal part in struct */</span>
<a name="l05050"></a>05050         {
<a name="l05051"></a>05051             <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> temp;
<a name="l05052"></a>05052             <span class="keywordtype">char</span> *poin;
<a name="l05053"></a>05053             intptr_t offset;
<a name="l05054"></a>05054             
<a name="l05055"></a>05055             offset= ((intptr_t)&amp;(temp.<a class="code" href="../../dd/d1a/structSequence.html#aa36ece483e44a2f715bc29b396284bc0">seqbase</a>)) - ((intptr_t)&amp;temp);
<a name="l05056"></a>05056             
<a name="l05057"></a>05057             <span class="comment">/* root pointer */</span>
<a name="l05058"></a>05058             <span class="keywordflow">if</span> (ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a> == old_seqbasep) {
<a name="l05059"></a>05059                 ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a>= &amp;ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>;
<a name="l05060"></a>05060             }
<a name="l05061"></a>05061             <span class="keywordflow">else</span> {
<a name="l05062"></a>05062                 
<a name="l05063"></a>05063                 poin= (<span class="keywordtype">char</span> *)ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a>;
<a name="l05064"></a>05064                 poin -= offset;
<a name="l05065"></a>05065                 
<a name="l05066"></a>05066                 poin= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, poin);
<a name="l05067"></a>05067                 <span class="keywordflow">if</span> (poin) ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a>= (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *)(poin+offset);
<a name="l05068"></a>05068                 <span class="keywordflow">else</span> ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a>= &amp;ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>;
<a name="l05069"></a>05069             }           
<a name="l05070"></a>05070             <span class="comment">/* stack */</span>
<a name="l05071"></a>05071             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a71fc675641a789cae753a4480aea15cf">metastack</a>));
<a name="l05072"></a>05072             
<a name="l05073"></a>05073             <span class="keywordflow">for</span> (ms= ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a71fc675641a789cae753a4480aea15cf">metastack</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ms; ms= ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#ab702b65bad4cbd16dd0b32887fb5da32">next</a>) {
<a name="l05074"></a>05074                 ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#a01b324eb36108cb5bb748377f4195718">parseq</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#a01b324eb36108cb5bb748377f4195718">parseq</a>);
<a name="l05075"></a>05075                 
<a name="l05076"></a>05076                 <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#aaf2dee834693f5843c5a2e533de2bbba">oldbasep</a> == old_seqbasep)
<a name="l05077"></a>05077                     ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#aaf2dee834693f5843c5a2e533de2bbba">oldbasep</a>= &amp;ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>;
<a name="l05078"></a>05078                 <span class="keywordflow">else</span> {
<a name="l05079"></a>05079                     poin= (<span class="keywordtype">char</span> *)ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#aaf2dee834693f5843c5a2e533de2bbba">oldbasep</a>;
<a name="l05080"></a>05080                     poin -= offset;
<a name="l05081"></a>05081                     poin= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, poin);
<a name="l05082"></a>05082                     <span class="keywordflow">if</span> (poin) ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#aaf2dee834693f5843c5a2e533de2bbba">oldbasep</a>= (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *)(poin+offset);
<a name="l05083"></a>05083                     <span class="keywordflow">else</span> ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#aaf2dee834693f5843c5a2e533de2bbba">oldbasep</a>= &amp;ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>;
<a name="l05084"></a>05084                 }
<a name="l05085"></a>05085             }
<a name="l05086"></a>05086         }
<a name="l05087"></a>05087     }
<a name="l05088"></a>05088     
<a name="l05089"></a>05089     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>);
<a name="l05090"></a>05090     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>) {
<a name="l05091"></a>05091         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a3fc87d8115240de7e27cd05d1bb1ed8b">lpFormat</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a3fc87d8115240de7e27cd05d1bb1ed8b">lpFormat</a>);
<a name="l05092"></a>05092         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a426beb8964b8a27a366c28cc56588b71">lpParms</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a426beb8964b8a27a366c28cc56588b71">lpParms</a>);
<a name="l05093"></a>05093     }
<a name="l05094"></a>05094     
<a name="l05095"></a>05095     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>);
<a name="l05096"></a>05096     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>) {
<a name="l05097"></a>05097         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>-&gt;<a class="code" href="../../d2/d03/structQuicktimeCodecData.html#aba683799ebc5231dd3da28d70a5db6e9">cdParms</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>-&gt;<a class="code" href="../../d2/d03/structQuicktimeCodecData.html#aba683799ebc5231dd3da28d70a5db6e9">cdParms</a>);
<a name="l05098"></a>05098     }
<a name="l05099"></a>05099     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a>) {
<a name="l05100"></a>05100         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(
<a name="l05101"></a>05101             fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a>);
<a name="l05102"></a>05102         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a>) { 
<a name="l05103"></a>05103             <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(
<a name="l05104"></a>05104                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a>, 
<a name="l05105"></a>05105                 (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l05106"></a>05106         }
<a name="l05107"></a>05107     }
<a name="l05108"></a>05108 
<a name="l05109"></a>05109     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad75df026c409d765b297e18f988b9d93">markers</a>));
<a name="l05110"></a>05110     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aea22a1b7c82a34733d85376ea882893d">transform_spaces</a>));
<a name="l05111"></a>05111     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>));
<a name="l05112"></a>05112 
<a name="l05113"></a>05113     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l05114"></a>05114     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l05115"></a>05115         <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(fd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l05116"></a>05116 }
<a name="l05117"></a>05117 
<a name="l05118"></a>05118 <span class="comment">/* ************ READ WM ***************** */</span>
<a name="l05119"></a>05119 
<a name="l05120"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1c099439e22c8b72cd8ecf39f35498b1">05120</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1c099439e22c8b72cd8ecf39f35498b1">direct_link_windowmanager</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm)
<a name="l05121"></a>05121 {
<a name="l05122"></a>05122     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l05123"></a>05123     
<a name="l05124"></a>05124     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l05125"></a>05125     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>));
<a name="l05126"></a>05126     
<a name="l05127"></a>05127     <span class="keywordflow">for</span> (win= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l05128"></a>05128         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05129"></a>05129         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05130"></a>05130         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a80600ee36f30d18dc8fe28d927462a8d">curswin</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05131"></a>05131         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae9559968ebb34a7dca463a17cdbc90c0">tweak</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05132"></a>05132 
<a name="l05133"></a>05133         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae54e2856a5ae5078fd265e709663cc98">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05134"></a>05134         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05135"></a>05135         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05136"></a>05136         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a4ceaf7b2bc854ba63c27139f9b180a95">subwindows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a4ceaf7b2bc854ba63c27139f9b180a95">subwindows</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05137"></a>05137         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a969ed8f1b8d6494f68339eed3141ba44">gesture</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a969ed8f1b8d6494f68339eed3141ba44">gesture</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05138"></a>05138 
<a name="l05139"></a>05139         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#aa43cc5770f7a2cd2e9e480f6f812fe71">drawdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05140"></a>05140         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a6b5dd98c6208a6594d8183e4dc0f06dd">drawmethod</a>= -1;
<a name="l05141"></a>05141         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a64bc43ec17d4394edc73dd1e4583cde4">drawfail</a>= 0;
<a name="l05142"></a>05142     }
<a name="l05143"></a>05143     
<a name="l05144"></a>05144     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05145"></a>05145     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a290c1fd1d01aa2a23c949397af70c4ac">operators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a290c1fd1d01aa2a23c949397af70c4ac">operators</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05146"></a>05146     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#ab21769011ad4bce8e9b56e4c2b637d54">paintcursors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#ab21769011ad4bce8e9b56e4c2b637d54">paintcursors</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05147"></a>05147     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a81dc723dcdf405fa1b063cc9a17f4fba">queue</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05148"></a>05148     <a class="code" href="../../d2/d40/BKE__report_8h.html#af5b01bb6a9ddfb55fadc44aee9a0d5a5">BKE_reports_init</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a4721c4ea8fa38a2c2f4ed3b569a4966b">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861aca8f7314453dc576fbdca03031b66430">RPT_STORE</a>);
<a name="l05149"></a>05149 
<a name="l05150"></a>05150     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a23d6f666a2d03feb6b25cd52e489adec">keyconfigs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a23d6f666a2d03feb6b25cd52e489adec">keyconfigs</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05151"></a>05151     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a17c7e8a6747f168e3b9266314ba2534e">defaultconf</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05152"></a>05152     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#ac57b8f95e268bbdc4cf846d44901283e">addonconf</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05153"></a>05153     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a6ef2ca350165ac4dfd8e21de4faa4f35">userconf</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05154"></a>05154 
<a name="l05155"></a>05155     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a8ff4e6a89d99dced44a6c83d2f03079a">jobs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a8ff4e6a89d99dced44a6c83d2f03079a">jobs</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05156"></a>05156     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05157"></a>05157     
<a name="l05158"></a>05158     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a977740478a98e70e33e1053cdd16dcb4">windrawable</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05159"></a>05159     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#af6c533cdbd4dc456794e6a89d0f1fe71">winactive</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05160"></a>05160     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a1e38f1b5659680baa3fcf9e39e173358">initialized</a>= 0;
<a name="l05161"></a>05161     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a133dd752e84b68b3d7b2a531e26a3098">op_undo_depth</a>= 0;
<a name="l05162"></a>05162 }
<a name="l05163"></a>05163 
<a name="l05164"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2090ebe3c7b507c749c64c1057899e9a">05164</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2090ebe3c7b507c749c64c1057899e9a">lib_link_windowmanager</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l05165"></a>05165 {
<a name="l05166"></a>05166     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm;
<a name="l05167"></a>05167     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l05168"></a>05168     
<a name="l05169"></a>05169     <span class="keywordflow">for</span> (wm= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1c415972a9fb2c7ce05e14d83affa0d8">wm</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wm; wm= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l05170"></a>05170         <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l05171"></a>05171             <span class="keywordflow">for</span> (win= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>)
<a name="l05172"></a>05172                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>);
<a name="l05173"></a>05173 
<a name="l05174"></a>05174             wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l05175"></a>05175         }
<a name="l05176"></a>05176     }
<a name="l05177"></a>05177 }
<a name="l05178"></a>05178 
<a name="l05179"></a>05179 <span class="comment">/* ****************** READ GREASE PENCIL ***************** */</span>
<a name="l05180"></a>05180 
<a name="l05181"></a>05181 <span class="comment">/* relinks grease-pencil data - used for direct_link and old file linkage */</span>
<a name="l05182"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">05182</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dd/d52/structbGPdata.html">bGPdata</a> *gpd)
<a name="l05183"></a>05183 {
<a name="l05184"></a>05184     <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl;
<a name="l05185"></a>05185     <a class="code" href="../../d7/dcf/structbGPDframe.html">bGPDframe</a> *gpf;
<a name="l05186"></a>05186     <a class="code" href="../../d8/d2d/structbGPDstroke.html">bGPDstroke</a> *gps;
<a name="l05187"></a>05187     
<a name="l05188"></a>05188     <span class="comment">/* we must firstly have some grease-pencil data to link! */</span>
<a name="l05189"></a>05189     <span class="keywordflow">if</span> (gpd == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05190"></a>05190         <span class="keywordflow">return</span>;
<a name="l05191"></a>05191     
<a name="l05192"></a>05192     <span class="comment">/* relink layers */</span>
<a name="l05193"></a>05193     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#a758b708bf82bb5351255c6c1f974a0cc">layers</a>);
<a name="l05194"></a>05194     
<a name="l05195"></a>05195     <span class="keywordflow">for</span> (gpl= gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#a758b708bf82bb5351255c6c1f974a0cc">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpl; gpl= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#a428b812104383d1b973f98c4dde29ac9">next</a>) {
<a name="l05196"></a>05196         <span class="comment">/* relink frames */</span>
<a name="l05197"></a>05197         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#ab6b8d0f88de061c89b2e6c982cf315d8">frames</a>);
<a name="l05198"></a>05198         gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#a4cf01a77eb3d76384bd1908416df37de">actframe</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#a4cf01a77eb3d76384bd1908416df37de">actframe</a>);
<a name="l05199"></a>05199         
<a name="l05200"></a>05200         <span class="keywordflow">for</span> (gpf= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#ab6b8d0f88de061c89b2e6c982cf315d8">frames</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpf; gpf= gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#a4d6f43b91302df84606cc035b683243c">next</a>) {
<a name="l05201"></a>05201             <span class="comment">/* relink strokes (and their points) */</span>
<a name="l05202"></a>05202             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#abfcf891752f8fbe98056b519135c52a2">strokes</a>);
<a name="l05203"></a>05203             
<a name="l05204"></a>05204             <span class="keywordflow">for</span> (gps= gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#abfcf891752f8fbe98056b519135c52a2">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gps; gps= gps-&gt;<a class="code" href="../../d8/d2d/structbGPDstroke.html#aeec4e6a65ac743fd5a2a3ede11f2f85e">next</a>) {
<a name="l05205"></a>05205                 gps-&gt;<a class="code" href="../../d8/d2d/structbGPDstroke.html#a3891196ee51074815ea4e3a4bed391d4">points</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, gps-&gt;<a class="code" href="../../d8/d2d/structbGPDstroke.html#a3891196ee51074815ea4e3a4bed391d4">points</a>);
<a name="l05206"></a>05206             }
<a name="l05207"></a>05207         }
<a name="l05208"></a>05208     }
<a name="l05209"></a>05209 }
<a name="l05210"></a>05210 
<a name="l05211"></a>05211 <span class="comment">/* ****************** READ SCREEN ***************** */</span>
<a name="l05212"></a>05212 
<a name="l05213"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4352e677076f45cddac7500bbcb6f0ef">05213</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4352e677076f45cddac7500bbcb6f0ef">butspace_version_132</a>(<a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *buts)
<a name="l05214"></a>05214 {
<a name="l05215"></a>05215     buts-&gt;v2d.tot.xmin = 0.0f;
<a name="l05216"></a>05216     buts-&gt;v2d.tot.ymin = 0.0f;
<a name="l05217"></a>05217     buts-&gt;v2d.tot.xmax = 1279.0f;
<a name="l05218"></a>05218     buts-&gt;v2d.tot.ymax = 228.0f;
<a name="l05219"></a>05219 
<a name="l05220"></a>05220     buts-&gt;v2d.min[0]= 256.0f;
<a name="l05221"></a>05221     buts-&gt;v2d.min[1]= 42.0f;
<a name="l05222"></a>05222 
<a name="l05223"></a>05223     buts-&gt;v2d.max[0]= 2048.0f;
<a name="l05224"></a>05224     buts-&gt;v2d.max[1]= 450.0f;
<a name="l05225"></a>05225 
<a name="l05226"></a>05226     buts-&gt;v2d.minzoom= 0.5f;
<a name="l05227"></a>05227     buts-&gt;v2d.maxzoom= 1.21f;
<a name="l05228"></a>05228 
<a name="l05229"></a>05229     buts-&gt;v2d.scroll= 0;
<a name="l05230"></a>05230     buts-&gt;v2d.keepzoom= 1;
<a name="l05231"></a>05231     buts-&gt;v2d.keeptot= 1;
<a name="l05232"></a>05232 }
<a name="l05233"></a>05233 
<a name="l05234"></a>05234 <span class="comment">/* note: file read without screens option G_FILE_NO_UI; </span>
<a name="l05235"></a>05235 <span class="comment"> * check lib pointers in call below */</span>
<a name="l05236"></a><a class="code" href="../../d0/d12/readfile_8c.html#a178776c5865f482c80c503bfa2e4973f">05236</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a178776c5865f482c80c503bfa2e4973f">lib_link_screen</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l05237"></a>05237 {
<a name="l05238"></a>05238     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l05239"></a>05239     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l05240"></a>05240 
<a name="l05241"></a>05241     <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l05242"></a>05242         <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l05243"></a>05243             sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l05244"></a>05244             sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>);
<a name="l05245"></a>05245             sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* saved in rare cases */</span>
<a name="l05246"></a>05246             
<a name="l05247"></a>05247             sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05248"></a>05248             <span class="keywordflow">while</span> (sa) {
<a name="l05249"></a>05249                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l05250"></a>05250                 
<a name="l05251"></a>05251                 sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>);
<a name="l05252"></a>05252                 
<a name="l05253"></a>05253                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l05254"></a>05254                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l05255"></a>05255                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l05256"></a>05256                         <a class="code" href="../../df/da6/structBGpic.html">BGpic</a> *bgpic = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05257"></a>05257                         
<a name="l05258"></a>05258                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>);
<a name="l05259"></a>05259                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4f6d087894f000468b148ca934b3ec3a">ob_centre</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4f6d087894f000468b148ca934b3ec3a">ob_centre</a>);
<a name="l05260"></a>05260                         
<a name="l05261"></a>05261                         <span class="comment">/* should be do_versions but not easy adding into the listbase */</span>
<a name="l05262"></a>05262                         <span class="keywordflow">if</span> (v3d-&gt;bgpic) {
<a name="l05263"></a>05263                             v3d-&gt;bgpic= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, v3d-&gt;bgpic);
<a name="l05264"></a>05264                             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>, bgpic);
<a name="l05265"></a>05265                             v3d-&gt;bgpic= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05266"></a>05266                         }
<a name="l05267"></a>05267 
<a name="l05268"></a>05268                         <span class="keywordflow">for</span> (bgpic= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bgpic; bgpic= bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a81c485660f1feac2cfa5c5813153c2f0">next</a>) {
<a name="l05269"></a>05269                             bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a826bef753b14debc45e2cacc6dc3c6f2">ima</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a826bef753b14debc45e2cacc6dc3c6f2">ima</a>);
<a name="l05270"></a>05270                             bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a91d17a6f72f3226ca9f26dab51697941">clip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a91d17a6f72f3226ca9f26dab51697941">clip</a>);
<a name="l05271"></a>05271                         }
<a name="l05272"></a>05272                         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>) {
<a name="l05273"></a>05273                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>);
<a name="l05274"></a>05274                         }
<a name="l05275"></a>05275                     }
<a name="l05276"></a>05276                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l05277"></a>05277                         <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)sl;
<a name="l05278"></a>05278                         <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>;
<a name="l05279"></a>05279                         
<a name="l05280"></a>05280                         <span class="keywordflow">if</span> (ads) {
<a name="l05281"></a>05281                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>);
<a name="l05282"></a>05282                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>);
<a name="l05283"></a>05283                         }
<a name="l05284"></a>05284                     }
<a name="l05285"></a>05285                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>) {
<a name="l05286"></a>05286                         <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts= (<a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *)sl;
<a name="l05287"></a>05287                         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a48c2cdcf5973a7b6f96c5109eca34b25">pinid</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a48c2cdcf5973a7b6f96c5109eca34b25">pinid</a>);
<a name="l05288"></a>05288                         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a0ba04fccc216c1d8a47019caead5abac">mainbo</a>= sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>;
<a name="l05289"></a>05289                         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a3bad9320a18de672b22effaf986d76a3">mainbuser</a>= sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>;
<a name="l05290"></a>05290                         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>&lt;132)
<a name="l05291"></a>05291                             <a class="code" href="../../d0/d12/readfile_8c.html#a4352e677076f45cddac7500bbcb6f0ef">butspace_version_132</a>(sbuts);
<a name="l05292"></a>05292                     }
<a name="l05293"></a>05293                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l05294"></a>05294                         <a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *sfile= (<a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *)sl;
<a name="l05295"></a>05295                         sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a7da25f9907e5e3fae86c36ab182e3fec">files</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05296"></a>05296                         sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a5ef6059fa41acf4330598c19a62918ff">op</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05297"></a>05297                         sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a352bfdf5731e7c1b16bb2303a6341eb7">layout</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05298"></a>05298                         sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a65746145559024992c7406612cef9b6f">folders_prev</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05299"></a>05299                         sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#ab587cdc4261210c9aeeaed40711de0ca">folders_next</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05300"></a>05300                     }
<a name="l05301"></a>05301                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l05302"></a>05302                         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)sl;
<a name="l05303"></a>05303                         <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads= &amp;saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>;
<a name="l05304"></a>05304                         
<a name="l05305"></a>05305                         <span class="keywordflow">if</span> (ads) {
<a name="l05306"></a>05306                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>);
<a name="l05307"></a>05307                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>);
<a name="l05308"></a>05308                         }
<a name="l05309"></a>05309                         
<a name="l05310"></a>05310                         saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a> = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a>);
<a name="l05311"></a>05311                     }
<a name="l05312"></a>05312                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l05313"></a>05313                         <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l05314"></a>05314 
<a name="l05315"></a>05315                         sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abcf13b6f77c9da7cf19c58a26c9a6006">image</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abcf13b6f77c9da7cf19c58a26c9a6006">image</a>);
<a name="l05316"></a>05316                         
<a name="l05317"></a>05317                         <span class="comment">/* NOTE: pre-2.5, this was local data not lib data, but now we need this as lib data</span>
<a name="l05318"></a>05318 <span class="comment">                         * so fingers crossed this works fine!</span>
<a name="l05319"></a>05319 <span class="comment">                         */</span>
<a name="l05320"></a>05320                         sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>);
<a name="l05321"></a>05321                     }
<a name="l05322"></a>05322                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l05323"></a>05323                         <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l05324"></a>05324                         <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads= snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>;
<a name="l05325"></a>05325                         
<a name="l05326"></a>05326                         <span class="keywordflow">if</span> (ads) {
<a name="l05327"></a>05327                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>);
<a name="l05328"></a>05328                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>);
<a name="l05329"></a>05329                         }
<a name="l05330"></a>05330                     }
<a name="l05331"></a>05331                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02011ff3a4d991adb9b4c9360dd8b1c3">SPACE_TEXT</a>) {
<a name="l05332"></a>05332                         <a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *st= (<a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *)sl;
<a name="l05333"></a>05333 
<a name="l05334"></a>05334                         st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa53b685703bcf48892bc3425992d2738">text</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa53b685703bcf48892bc3425992d2738">text</a>);
<a name="l05335"></a>05335                         st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa37ea3bd7a4dcafaaad3a614666dea69">drawcache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05336"></a>05336 
<a name="l05337"></a>05337                     }
<a name="l05338"></a>05338                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caac0ae90ad942da39f8e687b73c11e927">SPACE_SCRIPT</a>) {
<a name="l05339"></a>05339 
<a name="l05340"></a>05340                         <a class="code" href="../../d3/d07/structSpaceScript.html">SpaceScript</a> *scpt= (<a class="code" href="../../d3/d07/structSpaceScript.html">SpaceScript</a> *)sl;
<a name="l05341"></a>05341                         <span class="comment">/*scpt-&gt;script = NULL; - 2.45 set to null, better re-run the script */</span>
<a name="l05342"></a>05342                         <span class="keywordflow">if</span> (scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>) {
<a name="l05343"></a>05343                             scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>);
<a name="l05344"></a>05344                             <span class="keywordflow">if</span> (scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>) {
<a name="l05345"></a>05345                                 <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a3199962819bafde5f1e710ed447c691d">SCRIPT_SET_NULL</a>(scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>);
<a name="l05346"></a>05346                             }
<a name="l05347"></a>05347                         }
<a name="l05348"></a>05348                     }
<a name="l05349"></a>05349                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>) {
<a name="l05350"></a>05350                         <a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *so= (<a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *)sl;
<a name="l05351"></a>05351                         <a class="code" href="../../da/d20/structTreeStoreElem.html">TreeStoreElem</a> *tselem;
<a name="l05352"></a>05352                         <span class="keywordtype">int</span> a;
<a name="l05353"></a>05353 
<a name="l05354"></a>05354                         so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#adccabcddd402b182d47fa100c645fc16">tree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#adccabcddd402b182d47fa100c645fc16">tree</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05355"></a>05355                         so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a3c599ddcbf4ec9160ace136c956f3657">search_tse</a>.<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a3c599ddcbf4ec9160ace136c956f3657">search_tse</a>.<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>);
<a name="l05356"></a>05356                         
<a name="l05357"></a>05357                         <span class="keywordflow">if</span> (so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>) {
<a name="l05358"></a>05358                             tselem= so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a6a0409bdfd0120c3acda35c6cd8ebd3f">data</a>;
<a name="l05359"></a>05359                             <span class="keywordflow">for</span> (a=0; a&lt;so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#adac2878f40e7dc9a6a8881f0b421d299">usedelem</a>; a++, tselem++) {
<a name="l05360"></a>05360                                 tselem-&gt;<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, tselem-&gt;<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>);
<a name="l05361"></a>05361                             }
<a name="l05362"></a>05362                         }
<a name="l05363"></a>05363                     }
<a name="l05364"></a>05364                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l05365"></a>05365                         <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= (<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *)sl;
<a name="l05366"></a>05366                         
<a name="l05367"></a>05367                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>);
<a name="l05368"></a>05368                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05369"></a>05369                         
<a name="l05370"></a>05370                         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>)) {
<a name="l05371"></a>05371                             <span class="comment">/* internal data, a bit patchy */</span>
<a name="l05372"></a>05372                             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05373"></a>05373                             <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>) {
<a name="l05374"></a>05374                                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>)
<a name="l05375"></a>05375                                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../d2/d10/structMaterial.html">Material</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05376"></a>05376                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>)
<a name="l05377"></a>05377                                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../d7/d3f/structWorld.html">World</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05378"></a>05378                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>)
<a name="l05379"></a>05379                                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05380"></a>05380                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>)
<a name="l05381"></a>05381                                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05382"></a>05382                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>)
<a name="l05383"></a>05383                                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../df/d2d/structTex.html">Tex</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05384"></a>05384                             }
<a name="l05385"></a>05385                         }
<a name="l05386"></a>05386                         <span class="keywordflow">else</span> {
<a name="l05387"></a>05387                             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l05388"></a>05388                         }
<a name="l05389"></a>05389                         
<a name="l05390"></a>05390                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1e16ca4023bb5f8981c0c8c79cd7cdc8">linkdrag</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1e16ca4023bb5f8981c0c8c79cd7cdc8">linkdrag</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05391"></a>05391                     }
<a name="l05392"></a>05392                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l05393"></a>05393                         <a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *sclip= (<a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *)sl;
<a name="l05394"></a>05394 
<a name="l05395"></a>05395                         sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#ab38103375a048c37f80d4621df8186c8">clip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#ab38103375a048c37f80d4621df8186c8">clip</a>);
<a name="l05396"></a>05396 
<a name="l05397"></a>05397                         sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#a4f73cdebcf5d0c311f989ce286b78431">scopes</a>.<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a3b99ae69511066325d03727aa3423c01">track_preview</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05398"></a>05398                         sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#a4f73cdebcf5d0c311f989ce286b78431">scopes</a>.<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af834ede6aa0952be7e023c2a36cf8b0d">ok</a> = 0;
<a name="l05399"></a>05399                     }
<a name="l05400"></a>05400                 }
<a name="l05401"></a>05401                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l05402"></a>05402             }
<a name="l05403"></a>05403             sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l05404"></a>05404         }
<a name="l05405"></a>05405     }
<a name="l05406"></a>05406 }
<a name="l05407"></a>05407 
<a name="l05408"></a>05408 <span class="comment">/* Only for undo files, or to restore a screen after reading without UI... */</span>
<a name="l05409"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">05409</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainp, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> user)
<a name="l05410"></a>05410 {
<a name="l05411"></a>05411         
<a name="l05412"></a>05412     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>) {
<a name="l05413"></a>05413         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb= <a class="code" href="../../d8/db1/BKE__library_8h.html#a2dc345b18171d710d51f14d814121381">which_libbase</a>(mainp, <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>));
<a name="l05414"></a>05414         
<a name="l05415"></a>05415         <span class="keywordflow">if</span> (lb) {   <span class="comment">// there&#39;s still risk of checking corrupt mem (freed Ids in oops)</span>
<a name="l05416"></a>05416             <a class="code" href="../../d8/d7e/structID.html">ID</a> *idn= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05417"></a>05417             <span class="keywordtype">char</span> *name= <span class="keywordtype">id</span>-&gt;name+2;
<a name="l05418"></a>05418             
<a name="l05419"></a>05419             <span class="keywordflow">while</span> (idn) {
<a name="l05420"></a>05420                 <span class="keywordflow">if</span> (idn-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[2]==name[0] &amp;&amp; strcmp(idn-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, name)==0) {
<a name="l05421"></a>05421                     <span class="keywordflow">if</span> (idn-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==id-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l05422"></a>05422                         <span class="keywordflow">if</span> (user &amp;&amp; idn-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==0) idn-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l05423"></a>05423                         <span class="keywordflow">break</span>;
<a name="l05424"></a>05424                     }
<a name="l05425"></a>05425                 }
<a name="l05426"></a>05426                 idn= idn-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l05427"></a>05427             }
<a name="l05428"></a>05428             <span class="keywordflow">return</span> idn;
<a name="l05429"></a>05429         }
<a name="l05430"></a>05430     }
<a name="l05431"></a>05431     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05432"></a>05432 }
<a name="l05433"></a>05433 
<a name="l05434"></a><a class="code" href="../../d0/d12/readfile_8c.html#a45c9a586c8b16f1c66ea721ad1db6630">05434</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#a45c9a586c8b16f1c66ea721ad1db6630">lib_link_seq_clipboard_cb</a>(<a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq, <span class="keywordtype">void</span> *arg_pt)
<a name="l05435"></a>05435 {
<a name="l05436"></a>05436     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *newmain = (<a class="code" href="../../d0/dc0/structMain.html">Main</a> *)arg_pt;
<a name="l05437"></a>05437 
<a name="l05438"></a>05438     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>) {
<a name="l05439"></a>05439         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>, 0);
<a name="l05440"></a>05440         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l05441"></a>05441     }
<a name="l05442"></a>05442 
<a name="l05443"></a>05443     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>)
<a name="l05444"></a>05444         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>, 1);
<a name="l05445"></a>05445 
<a name="l05446"></a>05446     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>)
<a name="l05447"></a>05447         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>, 1);
<a name="l05448"></a>05448 
<a name="l05449"></a>05449     <span class="keywordflow">return</span> 1;
<a name="l05450"></a>05450 }
<a name="l05451"></a>05451 
<a name="l05452"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8b6a744b9d4c772f54728e948e2df58c">05452</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8b6a744b9d4c772f54728e948e2df58c">lib_link_clipboard_restore</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *newmain)
<a name="l05453"></a>05453 {
<a name="l05454"></a>05454     <span class="comment">/* update IDs stored in sequencer clipboard */</span>
<a name="l05455"></a>05455     <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a48183fc275a4bd096f6a7dce13f345ae">seqbase_recursive_apply</a>(&amp;<a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a2e5b41c74a0c237fed067a16ebe2438e">seqbase_clipboard</a>, <a class="code" href="../../d0/d12/readfile_8c.html#a45c9a586c8b16f1c66ea721ad1db6630">lib_link_seq_clipboard_cb</a>, newmain);
<a name="l05456"></a>05456 }
<a name="l05457"></a>05457 
<a name="l05458"></a>05458 <span class="comment">/* called from kernel/blender.c */</span>
<a name="l05459"></a>05459 <span class="comment">/* used to link a file (without UI) to the current UI */</span>
<a name="l05460"></a>05460 <span class="comment">/* note that it assumes the old pointers in UI are still valid, so old Main is not freed */</span>
<a name="l05461"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab98d83b845f48c9394d3c2598dc7b83d">05461</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab98d83b845f48c9394d3c2598dc7b83d">lib_link_screen_restore</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *newmain, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *curscreen, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *curscene)
<a name="l05462"></a>05462 {
<a name="l05463"></a>05463     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l05464"></a>05464     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm;
<a name="l05465"></a>05465     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l05466"></a>05466     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l05467"></a>05467 
<a name="l05468"></a>05468     <span class="comment">/* first windowmanager */</span>
<a name="l05469"></a>05469     <span class="keywordflow">for</span> (wm= newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1c415972a9fb2c7ce05e14d83affa0d8">wm</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wm; wm= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l05470"></a>05470         <span class="keywordflow">for</span> (win= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l05471"></a>05471             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>, 1);
<a name="l05472"></a>05472             
<a name="l05473"></a>05473             <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05474"></a>05474                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>= curscreen;
<a name="l05475"></a>05475 
<a name="l05476"></a>05476             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>;
<a name="l05477"></a>05477         }
<a name="l05478"></a>05478     }
<a name="l05479"></a>05479     
<a name="l05480"></a>05480     
<a name="l05481"></a>05481     <span class="keywordflow">for</span> (sc= newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l05482"></a>05482         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *oldscene= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>;
<a name="l05483"></a>05483 
<a name="l05484"></a>05484         sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>, 1);
<a name="l05485"></a>05485         <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05486"></a>05486             sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>= curscene;
<a name="l05487"></a>05487 
<a name="l05488"></a>05488         <span class="comment">/* keep cursor location through undo */</span>
<a name="l05489"></a>05489         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a237f7209bae91bebb60015a0fb2001fe">cursor</a>, oldscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a237f7209bae91bebb60015a0fb2001fe">cursor</a>);
<a name="l05490"></a>05490 
<a name="l05491"></a>05491         sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05492"></a>05492         <span class="keywordflow">while</span> (sa) {
<a name="l05493"></a>05493             <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l05494"></a>05494 
<a name="l05495"></a>05495             <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l05496"></a>05496                 <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l05497"></a>05497                     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l05498"></a>05498                     <a class="code" href="../../df/da6/structBGpic.html">BGpic</a> *bgpic;
<a name="l05499"></a>05499                     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l05500"></a>05500                     
<a name="l05501"></a>05501                     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a9b985c482e62755068cdd28ed0d50e50">scenelock</a>)
<a name="l05502"></a>05502                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* always get from scene */</span>
<a name="l05503"></a>05503                     <span class="keywordflow">else</span>
<a name="l05504"></a>05504                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>, 1);
<a name="l05505"></a>05505                     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05506"></a>05506                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>;
<a name="l05507"></a>05507                     v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4f6d087894f000468b148ca934b3ec3a">ob_centre</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4f6d087894f000468b148ca934b3ec3a">ob_centre</a>, 1);
<a name="l05508"></a>05508                     
<a name="l05509"></a>05509                     <span class="keywordflow">for</span> (bgpic= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bgpic; bgpic= bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a81c485660f1feac2cfa5c5813153c2f0">next</a>) {
<a name="l05510"></a>05510                         bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a826bef753b14debc45e2cacc6dc3c6f2">ima</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a826bef753b14debc45e2cacc6dc3c6f2">ima</a>, 1);
<a name="l05511"></a>05511                         bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a91d17a6f72f3226ca9f26dab51697941">clip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a91d17a6f72f3226ca9f26dab51697941">clip</a>, 1);
<a name="l05512"></a>05512                     }
<a name="l05513"></a>05513                     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>) {
<a name="l05514"></a>05514                         <span class="comment">/*Base *base;*/</span>
<a name="l05515"></a>05515 
<a name="l05516"></a>05516                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>;
<a name="l05517"></a>05517                         
<a name="l05518"></a>05518                         <span class="comment">/* localview can become invalid during undo/redo steps, so we exit it when no could be found */</span>
<a name="l05519"></a>05519                         <span class="comment">/* XXX  regionlocalview ?</span>
<a name="l05520"></a>05520 <span class="comment">                        for (base= sc-&gt;scene-&gt;base.first; base; base= base-&gt;next) {</span>
<a name="l05521"></a>05521 <span class="comment">                            if (base-&gt;lay &amp; v3d-&gt;lay) break;</span>
<a name="l05522"></a>05522 <span class="comment">                        }</span>
<a name="l05523"></a>05523 <span class="comment">                        if (base==NULL) {</span>
<a name="l05524"></a>05524 <span class="comment">                            v3d-&gt;lay= v3d-&gt;localvd-&gt;lay;</span>
<a name="l05525"></a>05525 <span class="comment">                            v3d-&gt;layact= v3d-&gt;localvd-&gt;layact;</span>
<a name="l05526"></a>05526 <span class="comment">                            MEM_freeN(v3d-&gt;localvd); </span>
<a name="l05527"></a>05527 <span class="comment">                            v3d-&gt;localvd= NULL;</span>
<a name="l05528"></a>05528 <span class="comment">                        }</span>
<a name="l05529"></a>05529 <span class="comment">                        */</span>
<a name="l05530"></a>05530                     }
<a name="l05531"></a>05531                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a9b985c482e62755068cdd28ed0d50e50">scenelock</a>) v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a45ac0a23240ec719b0952d62190e9130">lay</a>= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a>;
<a name="l05532"></a>05532 
<a name="l05533"></a>05533                     <span class="comment">/* not very nice, but could help */</span>
<a name="l05534"></a>05534                     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a20eb2672523f97b49bc5fce33828021a">layact</a> &amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a45ac0a23240ec719b0952d62190e9130">lay</a>)==0) v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a20eb2672523f97b49bc5fce33828021a">layact</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a45ac0a23240ec719b0952d62190e9130">lay</a>;
<a name="l05535"></a>05535                     
<a name="l05536"></a>05536                     <span class="comment">/* free render engines for now */</span>
<a name="l05537"></a>05537                     <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l05538"></a>05538                         <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l05539"></a>05539 
<a name="l05540"></a>05540                         <span class="keywordflow">if</span> (rv3d &amp;&amp; rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a2edbfa90c097636953f1a14fb0b12115">render_engine</a>) {
<a name="l05541"></a>05541                             <a class="code" href="../../db/da9/RE__engine_8h.html#a8a292a5ca4bc5bb69055a1fe27b70d62">RE_engine_free</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a2edbfa90c097636953f1a14fb0b12115">render_engine</a>);
<a name="l05542"></a>05542                             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a2edbfa90c097636953f1a14fb0b12115">render_engine</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05543"></a>05543                         }
<a name="l05544"></a>05544                     }
<a name="l05545"></a>05545                 }
<a name="l05546"></a>05546                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l05547"></a>05547                     <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)sl;
<a name="l05548"></a>05548                     <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>;
<a name="l05549"></a>05549                     
<a name="l05550"></a>05550                     <span class="keywordflow">if</span> (ads) {
<a name="l05551"></a>05551                         ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>, 1);
<a name="l05552"></a>05552                         
<a name="l05553"></a>05553                         <span class="keywordflow">if</span> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>)
<a name="l05554"></a>05554                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>, 0);
<a name="l05555"></a>05555                     }
<a name="l05556"></a>05556                 }
<a name="l05557"></a>05557                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>) {
<a name="l05558"></a>05558                     <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts= (<a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *)sl;
<a name="l05559"></a>05559                     sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a48c2cdcf5973a7b6f96c5109eca34b25">pinid</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a48c2cdcf5973a7b6f96c5109eca34b25">pinid</a>, 0);
<a name="l05560"></a>05560                     <span class="comment">//XXX if (sbuts-&gt;ri) sbuts-&gt;ri-&gt;curtile = 0;</span>
<a name="l05561"></a>05561                 }
<a name="l05562"></a>05562                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l05563"></a>05563                     
<a name="l05564"></a>05564                     <a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *sfile= (<a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *)sl;
<a name="l05565"></a>05565                     sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a5ef6059fa41acf4330598c19a62918ff">op</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05566"></a>05566                 }
<a name="l05567"></a>05567                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l05568"></a>05568                     <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)sl;
<a name="l05569"></a>05569                     
<a name="l05570"></a>05570                     saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a>, 1);
<a name="l05571"></a>05571                     saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>, 1);
<a name="l05572"></a>05572 
<a name="l05573"></a>05573                     <span class="keywordflow">if</span> (saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>)
<a name="l05574"></a>05574                         saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>, 0);
<a name="l05575"></a>05575                 }
<a name="l05576"></a>05576                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l05577"></a>05577                     <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l05578"></a>05578 
<a name="l05579"></a>05579                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abcf13b6f77c9da7cf19c58a26c9a6006">image</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abcf13b6f77c9da7cf19c58a26c9a6006">image</a>, 1);
<a name="l05580"></a>05580 
<a name="l05581"></a>05581                     <span class="comment">/* this will be freed, not worth attempting to find same scene,</span>
<a name="l05582"></a>05582 <span class="comment">                     * since it gets initialized later */</span>
<a name="l05583"></a>05583                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#aab747e6c4e4e22d6d238bf13929cc775">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#aee6884f3d5d6dc026064a0ae7831c349">scene</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05584"></a>05584 
<a name="l05585"></a>05585                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05586"></a>05586                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05587"></a>05587                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05588"></a>05588                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05589"></a>05589                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#a46e0b437a82b65c4a1834daf9bc692a4">ok</a> = 0;
<a name="l05590"></a>05590                     
<a name="l05591"></a>05591                     <span class="comment">/* NOTE: pre-2.5, this was local data not lib data, but now we need this as lib data</span>
<a name="l05592"></a>05592 <span class="comment">                     * so assume that here we&#39;re doing for undo only...</span>
<a name="l05593"></a>05593 <span class="comment">                     */</span>
<a name="l05594"></a>05594                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>, 1);
<a name="l05595"></a>05595                 }
<a name="l05596"></a>05596                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l05597"></a>05597                     <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l05598"></a>05598                     <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads= snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>;
<a name="l05599"></a>05599                     
<a name="l05600"></a>05600                     <span class="keywordflow">if</span> (ads) {
<a name="l05601"></a>05601                         ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>, 1);
<a name="l05602"></a>05602                         
<a name="l05603"></a>05603                         <span class="keywordflow">if</span> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>)
<a name="l05604"></a>05604                             ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>, 0);
<a name="l05605"></a>05605                     }
<a name="l05606"></a>05606                 }
<a name="l05607"></a>05607                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02011ff3a4d991adb9b4c9360dd8b1c3">SPACE_TEXT</a>) {
<a name="l05608"></a>05608                     <a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *st= (<a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *)sl;
<a name="l05609"></a>05609 
<a name="l05610"></a>05610                     st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa53b685703bcf48892bc3425992d2738">text</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa53b685703bcf48892bc3425992d2738">text</a>, 1);
<a name="l05611"></a>05611                     <span class="keywordflow">if</span> (st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa53b685703bcf48892bc3425992d2738">text</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#aa53b685703bcf48892bc3425992d2738">text</a>= newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#aba48dab3abbe5521b8493006361d2d51">text</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05612"></a>05612                 }
<a name="l05613"></a>05613                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caac0ae90ad942da39f8e687b73c11e927">SPACE_SCRIPT</a>) {
<a name="l05614"></a>05614                     <a class="code" href="../../d3/d07/structSpaceScript.html">SpaceScript</a> *scpt= (<a class="code" href="../../d3/d07/structSpaceScript.html">SpaceScript</a> *)sl;
<a name="l05615"></a>05615                     
<a name="l05616"></a>05616                     scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>, 1);
<a name="l05617"></a>05617                     
<a name="l05618"></a>05618                     <span class="comment">/*sc-&gt;script = NULL; - 2.45 set to null, better re-run the script */</span>
<a name="l05619"></a>05619                     <span class="keywordflow">if</span> (scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>) {
<a name="l05620"></a>05620                         <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a3199962819bafde5f1e710ed447c691d">SCRIPT_SET_NULL</a>(scpt-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a23bd8246ff7b7f260164422ee42659af">script</a>);
<a name="l05621"></a>05621                     }
<a name="l05622"></a>05622                 }
<a name="l05623"></a>05623                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>) {
<a name="l05624"></a>05624                     <a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *so= (<a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *)sl;
<a name="l05625"></a>05625                     <span class="keywordtype">int</span> a;
<a name="l05626"></a>05626                     
<a name="l05627"></a>05627                     so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a3c599ddcbf4ec9160ace136c956f3657">search_tse</a>.<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a3c599ddcbf4ec9160ace136c956f3657">search_tse</a>.<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>, 0);
<a name="l05628"></a>05628                     
<a name="l05629"></a>05629                     <span class="keywordflow">if</span> (so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>) {
<a name="l05630"></a>05630                         <a class="code" href="../../d5/d0e/structTreeStore.html">TreeStore</a> *ts= so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>;
<a name="l05631"></a>05631                         <a class="code" href="../../da/d20/structTreeStoreElem.html">TreeStoreElem</a> *tselem=ts-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a6a0409bdfd0120c3acda35c6cd8ebd3f">data</a>;
<a name="l05632"></a>05632                         <span class="keywordflow">for</span> (a=0; a&lt;ts-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#adac2878f40e7dc9a6a8881f0b421d299">usedelem</a>; a++, tselem++) {
<a name="l05633"></a>05633                             tselem-&gt;<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, tselem-&gt;<a class="code" href="../../da/d20/structTreeStoreElem.html#a2c7bc60159a1dc474327527b72e50483">id</a>, 0);
<a name="l05634"></a>05634                         }
<a name="l05635"></a>05635                     }
<a name="l05636"></a>05636                 }
<a name="l05637"></a>05637                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l05638"></a>05638                     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= (<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *)sl;
<a name="l05639"></a>05639                     
<a name="l05640"></a>05640                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>, 1);
<a name="l05641"></a>05641                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05642"></a>05642                     
<a name="l05643"></a>05643                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>)) {
<a name="l05644"></a>05644                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05645"></a>05645                         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>) {
<a name="l05646"></a>05646                             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>)
<a name="l05647"></a>05647                                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../d2/d10/structMaterial.html">Material</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05648"></a>05648                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>)
<a name="l05649"></a>05649                                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05650"></a>05650                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>)
<a name="l05651"></a>05651                                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= ((<a class="code" href="../../df/d2d/structTex.html">Tex</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)-&gt;nodetree;
<a name="l05652"></a>05652                         }
<a name="l05653"></a>05653                     }
<a name="l05654"></a>05654                     <span class="keywordflow">else</span> {
<a name="l05655"></a>05655                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, 1);
<a name="l05656"></a>05656                     }
<a name="l05657"></a>05657                 }
<a name="l05658"></a>05658                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l05659"></a>05659                     <a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *sclip= (<a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *)sl;
<a name="l05660"></a>05660 
<a name="l05661"></a>05661                     sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#ab38103375a048c37f80d4621df8186c8">clip</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a6c3fcb2041c1497ef50ca3489ec99158">restore_pointer_by_name</a>(newmain, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#ab38103375a048c37f80d4621df8186c8">clip</a>, 1);
<a name="l05662"></a>05662 
<a name="l05663"></a>05663                     sclip-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#a4f73cdebcf5d0c311f989ce286b78431">scopes</a>.<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af834ede6aa0952be7e023c2a36cf8b0d">ok</a> = 0;
<a name="l05664"></a>05664                 }
<a name="l05665"></a>05665             }
<a name="l05666"></a>05666             sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l05667"></a>05667         }
<a name="l05668"></a>05668     }
<a name="l05669"></a>05669 
<a name="l05670"></a>05670     <span class="comment">/* update IDs stored in all possible clipboards */</span>
<a name="l05671"></a>05671     <a class="code" href="../../d0/d12/readfile_8c.html#a8b6a744b9d4c772f54728e948e2df58c">lib_link_clipboard_restore</a>(newmain);
<a name="l05672"></a>05672 }
<a name="l05673"></a>05673 
<a name="l05674"></a><a class="code" href="../../d0/d12/readfile_8c.html#a310e9afd3dd4a260450ed7a6f7c11dd1">05674</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a310e9afd3dd4a260450ed7a6f7c11dd1">direct_link_region</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> spacetype)
<a name="l05675"></a>05675 {
<a name="l05676"></a>05676     <a class="code" href="../../d7/d84/structPanel.html">Panel</a> *pa;
<a name="l05677"></a>05677 
<a name="l05678"></a>05678     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a72e17f8a4110e1f9d78ff8fb657bf90f">panels</a>));
<a name="l05679"></a>05679 
<a name="l05680"></a>05680     <span class="keywordflow">for</span> (pa= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a72e17f8a4110e1f9d78ff8fb657bf90f">panels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pa; pa=pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#afa1196642c467e11f77b3fc0c5eea955">next</a>) {
<a name="l05681"></a>05681         pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a7d88601ceb67102e8f30bc632de5c09f">paneltab</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a7d88601ceb67102e8f30bc632de5c09f">paneltab</a>);
<a name="l05682"></a>05682         pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a8ca2fefe753dc9eae4399dd49df1daa8">runtime_flag</a>= 0;
<a name="l05683"></a>05683         pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6c2829658c6366c60a73a06d5bb5f468">activedata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05684"></a>05684         pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a1fb9f385176af107045b0df6760e1217">type</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05685"></a>05685     }
<a name="l05686"></a>05686     
<a name="l05687"></a>05687     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>);
<a name="l05688"></a>05688     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>) {
<a name="l05689"></a>05689         <span class="keywordflow">if</span> (spacetype==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l05690"></a>05690             <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l05691"></a>05691             
<a name="l05692"></a>05692             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aa55a6df5b8a0501c16cfdbcc794d627d">localvd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aa55a6df5b8a0501c16cfdbcc794d627d">localvd</a>);
<a name="l05693"></a>05693             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#af03bef54d5f4dbf31d2f73a8d0c83d0a">clipbb</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#af03bef54d5f4dbf31d2f73a8d0c83d0a">clipbb</a>);
<a name="l05694"></a>05694             
<a name="l05695"></a>05695             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad42475ca8dcac3b4e0560c71f462f39c">depths</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05696"></a>05696             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a9f780c24dcd7c2d37dd53a3d5a315deb">ri</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05697"></a>05697             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a2edbfa90c097636953f1a14fb0b12115">render_engine</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05698"></a>05698             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a29ba869ec5eea32c0a98d6b798735636">sms</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05699"></a>05699             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aea7380d3128fc84e4fc69cc963e4215b">smooth_timer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05700"></a>05700         }
<a name="l05701"></a>05701     }
<a name="l05702"></a>05702     
<a name="l05703"></a>05703     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a25594ed094a24063398d806a340ba07d">tab_offset</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05704"></a>05704     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a8ea6bf829b969894b3c52bc87f1c6253">tab_num</a>= 0;
<a name="l05705"></a>05705     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a69d4f32f4bb9bfb2de18a4290a6acc0f">tab_cur</a>= 0;
<a name="l05706"></a>05706     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05707"></a>05707     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05708"></a>05708     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f69b2410135b3a2ad6badb912132ce2">headerstr</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05709"></a>05709     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>= 0;
<a name="l05710"></a>05710     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05711"></a>05711     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#aa9ecd99451bb9e0b9c7d54100a2ec6bc">swap</a>= 0;
<a name="l05712"></a>05712     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a4c516955ae19ced48acf70245d6269a8">do_draw</a>= 0;
<a name="l05713"></a>05713     memset(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6b1b9df40c2ced94c635a1cbfe92fcd4">drawrct</a>, 0, <span class="keyword">sizeof</span>(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6b1b9df40c2ced94c635a1cbfe92fcd4">drawrct</a>));
<a name="l05714"></a>05714 }
<a name="l05715"></a>05715 
<a name="l05716"></a>05716 <span class="comment">/* for the saved 2.50 files without regiondata */</span>
<a name="l05717"></a>05717 <span class="comment">/* and as patch for 2.48 and older */</span>
<a name="l05718"></a><a class="code" href="../../d0/d12/readfile_8c.html#a90c2c40f6a0578002f57f0b6b426f0b9">05718</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a90c2c40f6a0578002f57f0b6b426f0b9">view3d_split_250</a>(<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *regions)
<a name="l05719"></a>05719 {
<a name="l05720"></a>05720     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l05721"></a>05721     
<a name="l05722"></a>05722     <span class="keywordflow">for</span> (ar= regions-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l05723"></a>05723         <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a> &amp;&amp; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l05724"></a>05724             <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d;
<a name="l05725"></a>05725             
<a name="l05726"></a>05726             rv3d= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a>), <span class="stringliteral">&quot;region v3d patch&quot;</span>);
<a name="l05727"></a>05727             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>= (char)v3d-&gt;persp;
<a name="l05728"></a>05728             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ae1cde58bc1011bac27095a74be8a32a9">view</a>= (<span class="keywordtype">char</span>)v3d-&gt;view;
<a name="l05729"></a>05729             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>= v3d-&gt;dist;
<a name="l05730"></a>05730             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a6ce0a5c0ad773034009ed39f47a26061">ofs</a>, v3d-&gt;ofs);
<a name="l05731"></a>05731             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5b66d29020ddf25dfef66674677e84ff">viewquat</a>, v3d-&gt;viewquat);
<a name="l05732"></a>05732         }
<a name="l05733"></a>05733     }
<a name="l05734"></a>05734 
<a name="l05735"></a>05735     <span class="comment">/* this was not initialized correct always */</span>
<a name="l05736"></a>05736     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4fe725baacd2dde9697fdc67f7449e8b">twtype</a> == 0)
<a name="l05737"></a>05737         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4fe725baacd2dde9697fdc67f7449e8b">twtype</a>= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a1a81a4a704345e89a1e585acdcfba158">V3D_MANIP_TRANSLATE</a>;
<a name="l05738"></a>05738 }
<a name="l05739"></a>05739 
<a name="l05740"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae4d8907e36f5fa2b052fb0cdcef07734">05740</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ae4d8907e36f5fa2b052fb0cdcef07734">direct_link_screen</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l05741"></a>05741 {
<a name="l05742"></a>05742     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l05743"></a>05743     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv;
<a name="l05744"></a>05744     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l05745"></a>05745     <span class="keywordtype">int</span> a;
<a name="l05746"></a>05746     
<a name="l05747"></a>05747     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>));
<a name="l05748"></a>05748     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>));
<a name="l05749"></a>05749     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>));
<a name="l05750"></a>05750     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05751"></a>05751     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a484770c9d14f5f3ca1e8eb7573686043">context</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05752"></a>05752 
<a name="l05753"></a>05753     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>= 0;   <span class="comment">/* indices */</span>
<a name="l05754"></a>05754     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a0dd52ca24e613fbec5fc247a4a0bb2bc">swap</a>= 0;
<a name="l05755"></a>05755     
<a name="l05756"></a>05756     <span class="comment">/* hacky patch... but people have been saving files with the verse-blender,</span>
<a name="l05757"></a>05757 <span class="comment">     * causing the handler to keep running for ever, with no means to disable it */</span>
<a name="l05758"></a>05758     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a2dc03b4baadb25c946d3993c97a9d46f">SCREEN_MAXHANDLER</a>; a+=2) {
<a name="l05759"></a>05759         <span class="keywordflow">if</span> ( sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a0f0e3895e4dd2036d5e692b005c22c33">handler</a>[a]==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ae3f2768e1331a4615bcd5e4c27550152">SCREEN_HANDLER_VERSE</a>) {
<a name="l05760"></a>05760             sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a0f0e3895e4dd2036d5e692b005c22c33">handler</a>[a]= 0;
<a name="l05761"></a>05761             <span class="keywordflow">break</span>;
<a name="l05762"></a>05762         }
<a name="l05763"></a>05763     }
<a name="l05764"></a>05764     
<a name="l05765"></a>05765     <span class="comment">/* edges */</span>
<a name="l05766"></a>05766     <span class="keywordflow">for</span> (se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; se; se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>) {
<a name="l05767"></a>05767         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>);
<a name="l05768"></a>05768         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>);
<a name="l05769"></a>05769         <span class="keywordflow">if</span> ( (intptr_t)se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a> &gt; (intptr_t)se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>) {
<a name="l05770"></a>05770             sv= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>;
<a name="l05771"></a>05771             se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>;
<a name="l05772"></a>05772             se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>= sv;
<a name="l05773"></a>05773         }
<a name="l05774"></a>05774 
<a name="l05775"></a>05775         <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l05776"></a>05776             printf(<span class="stringliteral">&quot;error reading screen... file corrupt\n&quot;</span>);
<a name="l05777"></a>05777             se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>;
<a name="l05778"></a>05778         }
<a name="l05779"></a>05779     }
<a name="l05780"></a>05780 
<a name="l05781"></a>05781     <span class="comment">/* areas */</span>
<a name="l05782"></a>05782     <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l05783"></a>05783         <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l05784"></a>05784         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l05785"></a>05785 
<a name="l05786"></a>05786         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>));
<a name="l05787"></a>05787         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>));
<a name="l05788"></a>05788 
<a name="l05789"></a>05789         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a01c01609c538278ac956593f749365e3">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a01c01609c538278ac956593f749365e3">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05790"></a>05790         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a41fdde87680287b354eca377ae99ed1e">type</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* spacetype callbacks */</span>
<a name="l05791"></a>05791         
<a name="l05792"></a>05792         <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l05793"></a>05793             <a class="code" href="../../d0/d12/readfile_8c.html#a310e9afd3dd4a260450ed7a6f7c11dd1">direct_link_region</a>(fd, ar, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>);
<a name="l05794"></a>05794         
<a name="l05795"></a>05795         <span class="comment">/* accident can happen when read/save new file with older version */</span>
<a name="l05796"></a>05796         <span class="comment">/* 2.50: we now always add spacedata for info */</span>
<a name="l05797"></a>05797         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l05798"></a>05798             <a class="code" href="../../db/dbd/structSpaceInfo.html">SpaceInfo</a> *sinfo= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/dbd/structSpaceInfo.html">SpaceInfo</a>), <span class="stringliteral">&quot;spaceinfo&quot;</span>);
<a name="l05799"></a>05799             sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>= sinfo-&gt;<a class="code" href="../../db/dbd/structSpaceInfo.html#a299f9716a54b0fd8af8e513a0dce4b22">spacetype</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cafbebfeeb0fd0f7c61564dec31fe64450">SPACE_INFO</a>;
<a name="l05800"></a>05800             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>, sinfo);
<a name="l05801"></a>05801         }
<a name="l05802"></a>05802         <span class="comment">/* add local view3d too */</span>
<a name="l05803"></a>05803         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>)
<a name="l05804"></a>05804             <a class="code" href="../../d0/d12/readfile_8c.html#a90c2c40f6a0578002f57f0b6b426f0b9">view3d_split_250</a>(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>);
<a name="l05805"></a>05805         
<a name="l05806"></a>05806         <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l05807"></a>05807             <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>));
<a name="l05808"></a>05808 
<a name="l05809"></a>05809             <span class="keywordflow">for</span> (ar= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l05810"></a>05810                 <a class="code" href="../../d0/d12/readfile_8c.html#a310e9afd3dd4a260450ed7a6f7c11dd1">direct_link_region</a>(fd, ar, sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>);
<a name="l05811"></a>05811 
<a name="l05812"></a>05812             <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l05813"></a>05813                 <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l05814"></a>05814                 <a class="code" href="../../df/da6/structBGpic.html">BGpic</a> *bgpic;
<a name="l05815"></a>05815 
<a name="l05816"></a>05816                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a89e41f856a5c6e5a3018c00b04a7cfbc">V3D_INVALID_BACKBUF</a>;
<a name="l05817"></a>05817 
<a name="l05818"></a>05818                 <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>));
<a name="l05819"></a>05819 
<a name="l05820"></a>05820                 <span class="comment">/* should be do_versions except this doesnt fit well there */</span>
<a name="l05821"></a>05821                 <span class="keywordflow">if</span> (v3d-&gt;bgpic) {
<a name="l05822"></a>05822                     bgpic= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, v3d-&gt;bgpic);
<a name="l05823"></a>05823                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>, bgpic);
<a name="l05824"></a>05824                     v3d-&gt;bgpic= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05825"></a>05825                 }
<a name="l05826"></a>05826 
<a name="l05827"></a>05827                 <span class="keywordflow">for</span> (bgpic= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bgpic; bgpic= bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a81c485660f1feac2cfa5c5813153c2f0">next</a>)
<a name="l05828"></a>05828                     bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a16f3925559495b9236d5e8160bc8f842">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a4c3780a98eb40a0465264303f197ecab">ok</a>= 1;
<a name="l05829"></a>05829 
<a name="l05830"></a>05830                 <span class="keywordflow">if</span> (v3d-&gt;gpd) {
<a name="l05831"></a>05831                     v3d-&gt;gpd= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, v3d-&gt;gpd);
<a name="l05832"></a>05832                     <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(fd, v3d-&gt;gpd);
<a name="l05833"></a>05833                 }
<a name="l05834"></a>05834                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>);
<a name="l05835"></a>05835                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aa50bdf2e33288df03e6ee33f75806c4f">afterdraw_transp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aa50bdf2e33288df03e6ee33f75806c4f">afterdraw_transp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05836"></a>05836                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a5ebc452868e0552460b5e249d101d464">afterdraw_xray</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a5ebc452868e0552460b5e249d101d464">afterdraw_xray</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05837"></a>05837                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aff04d5222f4500dd8529d2cd590ec582">afterdraw_xraytransp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aff04d5222f4500dd8529d2cd590ec582">afterdraw_xraytransp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05838"></a>05838                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a1218103b2d22b4f78191fe145c07f4d2">properties_storage</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05839"></a>05839 
<a name="l05840"></a>05840                 <span class="comment">/* render can be quite heavy, set to wire on load */</span>
<a name="l05841"></a>05841                 <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ffb4ceb8fefd165399fc583a8f9d893">OB_RENDER</a>)
<a name="l05842"></a>05842                     v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>;
<a name="l05843"></a>05843                 
<a name="l05844"></a>05844                 <a class="code" href="../../d0/d12/readfile_8c.html#a90c2c40f6a0578002f57f0b6b426f0b9">view3d_split_250</a>(v3d, &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>);
<a name="l05845"></a>05845             }
<a name="l05846"></a>05846             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l05847"></a>05847                 <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a>*)sl;
<a name="l05848"></a>05848                 
<a name="l05849"></a>05849                 sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>);
<a name="l05850"></a>05850                 sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a59cfc5b0b12e4f30083e376887e6a71a">ghostCurves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a59cfc5b0b12e4f30083e376887e6a71a">ghostCurves</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05851"></a>05851             }
<a name="l05852"></a>05852             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l05853"></a>05853                 <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a>*)sl;
<a name="l05854"></a>05854                 
<a name="l05855"></a>05855                 snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>);
<a name="l05856"></a>05856             }
<a name="l05857"></a>05857             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>) {
<a name="l05858"></a>05858                 <a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *soops= (<a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a>*) sl;
<a name="l05859"></a>05859                 
<a name="l05860"></a>05860                 soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>);
<a name="l05861"></a>05861                 <span class="keywordflow">if</span> (soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>) {
<a name="l05862"></a>05862                     soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a6a0409bdfd0120c3acda35c6cd8ebd3f">data</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a6a0409bdfd0120c3acda35c6cd8ebd3f">data</a>);
<a name="l05863"></a>05863                     <span class="comment">/* we only saved what was used */</span>
<a name="l05864"></a>05864                     soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a56ae2ce9ba36f4a001002527723dd7d3">totelem</a>= soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#adac2878f40e7dc9a6a8881f0b421d299">usedelem</a>;
<a name="l05865"></a>05865                     soops-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#afa5f6723bdfa80b2c1b91dcd74942d21">storeflag</a> |= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#af2bce3c8ce5e34957e510d1f801506b9">SO_TREESTORE_CLEANUP</a>;   <span class="comment">// at first draw</span>
<a name="l05866"></a>05866                 }
<a name="l05867"></a>05867             }
<a name="l05868"></a>05868             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l05869"></a>05869                 <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l05870"></a>05870                 
<a name="l05871"></a>05871                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#ac77779485c1d025f8eabb5686d58ac5a">cumap</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#ac77779485c1d025f8eabb5686d58ac5a">cumap</a>);
<a name="l05872"></a>05872                 <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#ac77779485c1d025f8eabb5686d58ac5a">cumap</a>)
<a name="l05873"></a>05873                     <a class="code" href="../../d0/d12/readfile_8c.html#a674562152ba971df46582924b84dc44d">direct_link_curvemapping</a>(fd, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#ac77779485c1d025f8eabb5686d58ac5a">cumap</a>);
<a name="l05874"></a>05874                 
<a name="l05875"></a>05875                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#aab747e6c4e4e22d6d238bf13929cc775">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#aee6884f3d5d6dc026064a0ae7831c349">scene</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05876"></a>05876                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#aab747e6c4e4e22d6d238bf13929cc775">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a4c3780a98eb40a0465264303f197ecab">ok</a>= 1;
<a name="l05877"></a>05877                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#ab7422cc069b12339a27f527b36fa8439">waveform_1</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05878"></a>05878                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#a31a6a8f3f1224c62d0727ca84bb2dad9">waveform_2</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05879"></a>05879                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#a2de861dd0464b9f7b1b30ace0e487265">waveform_3</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05880"></a>05880                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#ac829844907805bba4a15fc315e55dc21">vecscope</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05881"></a>05881                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>.<a class="code" href="../../dc/db8/structScopes.html#a46e0b437a82b65c4a1834daf9bc692a4">ok</a> = 0;
<a name="l05882"></a>05882                 
<a name="l05883"></a>05883                 <span class="comment">/* WARNING: gpencil data is no longer stored directly in sima after 2.5 </span>
<a name="l05884"></a>05884 <span class="comment">                 * so sacrifice a few old files for now to avoid crashes with new files!</span>
<a name="l05885"></a>05885 <span class="comment">                 * committed: r28002 */</span>
<a name="l05886"></a>05886 <span class="preprocessor">#if 0</span>
<a name="l05887"></a>05887 <span class="preprocessor"></span>                sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>);
<a name="l05888"></a>05888                 <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>)
<a name="l05889"></a>05889                     <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(fd, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>);
<a name="l05890"></a>05890 <span class="preprocessor">#endif</span>
<a name="l05891"></a>05891 <span class="preprocessor"></span>            }
<a name="l05892"></a>05892             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l05893"></a>05893                 <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= (<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *)sl;
<a name="l05894"></a>05894                 
<a name="l05895"></a>05895                 <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>) {
<a name="l05896"></a>05896                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>);
<a name="l05897"></a>05897                     <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(fd, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>);
<a name="l05898"></a>05898                 }
<a name="l05899"></a>05899             }
<a name="l05900"></a>05900             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca51011faadfd7d38d3d7a810c600e9458">SPACE_TIME</a>) {
<a name="l05901"></a>05901                 <a class="code" href="../../d5/d0c/structSpaceTime.html">SpaceTime</a> *stime= (<a class="code" href="../../d5/d0c/structSpaceTime.html">SpaceTime</a> *)sl;
<a name="l05902"></a>05902                 stime-&gt;<a class="code" href="../../d5/d0c/structSpaceTime.html#a9988be7d111bb80bfeadcac617b17f5c">caches</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= stime-&gt;<a class="code" href="../../d5/d0c/structSpaceTime.html#a9988be7d111bb80bfeadcac617b17f5c">caches</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05903"></a>05903             }
<a name="l05904"></a>05904             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca09ebd82af4cc18122664889b59473cad">SPACE_LOGIC</a>) {
<a name="l05905"></a>05905                 <a class="code" href="../../de/d63/structSpaceLogic.html">SpaceLogic</a> *slogic= (<a class="code" href="../../de/d63/structSpaceLogic.html">SpaceLogic</a> *)sl;
<a name="l05906"></a>05906                     
<a name="l05907"></a>05907                 <span class="keywordflow">if</span> (slogic-&gt;<a class="code" href="../../de/d63/structSpaceLogic.html#a13760f7ee59537dcc0deaa28364cc170">gpd</a>) {
<a name="l05908"></a>05908                     slogic-&gt;<a class="code" href="../../de/d63/structSpaceLogic.html#a13760f7ee59537dcc0deaa28364cc170">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, slogic-&gt;<a class="code" href="../../de/d63/structSpaceLogic.html#a13760f7ee59537dcc0deaa28364cc170">gpd</a>);
<a name="l05909"></a>05909                     <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(fd, slogic-&gt;<a class="code" href="../../de/d63/structSpaceLogic.html#a13760f7ee59537dcc0deaa28364cc170">gpd</a>);
<a name="l05910"></a>05910                 }
<a name="l05911"></a>05911             }
<a name="l05912"></a>05912             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l05913"></a>05913                 <a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *sseq= (<a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *)sl;
<a name="l05914"></a>05914                 <span class="keywordflow">if</span> (sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>) {
<a name="l05915"></a>05915                     sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>);
<a name="l05916"></a>05916                     <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(fd, sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>);
<a name="l05917"></a>05917                 }
<a name="l05918"></a>05918             }
<a name="l05919"></a>05919             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>) {
<a name="l05920"></a>05920                 <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts= (<a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *)sl;
<a name="l05921"></a>05921                 sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#aba8580ea888a52accc8c5d8d3991e2e4">path</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05922"></a>05922                 sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05923"></a>05923             }
<a name="l05924"></a>05924             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1618fa49f6b8e3582db7b40d4e520817">SPACE_CONSOLE</a>) {
<a name="l05925"></a>05925                 <a class="code" href="../../da/d68/structSpaceConsole.html">SpaceConsole</a> *sconsole= (<a class="code" href="../../da/d68/structSpaceConsole.html">SpaceConsole</a> *)sl;
<a name="l05926"></a>05926                 <a class="code" href="../../dd/df4/structConsoleLine.html">ConsoleLine</a> *cl, *cl_next;
<a name="l05927"></a>05927                 
<a name="l05928"></a>05928                 <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;sconsole-&gt;<a class="code" href="../../da/d68/structSpaceConsole.html#a99d771daee6902839c7fa113960e23b2">scrollback</a>);
<a name="l05929"></a>05929                 <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;sconsole-&gt;<a class="code" href="../../da/d68/structSpaceConsole.html#a37b9aaee0bbd0009dd229c4e6c9cb3fe">history</a>);
<a name="l05930"></a>05930                 
<a name="l05931"></a>05931                 <span class="comment">//for (cl= sconsole-&gt;scrollback.first; cl; cl= cl-&gt;next)</span>
<a name="l05932"></a>05932                 <span class="comment">//  cl-&gt;line= newdataadr(fd, cl-&gt;line);</span>
<a name="l05933"></a>05933                 
<a name="l05934"></a>05934                 <span class="comment">/* comma expressions, (e.g. expr1, expr2, expr3) evalutate each expression,</span>
<a name="l05935"></a>05935 <span class="comment">                 * from left to right.  the right-most expression sets the result of the comma</span>
<a name="l05936"></a>05936 <span class="comment">                 * expression as a whole*/</span>
<a name="l05937"></a>05937                 <span class="keywordflow">for</span> (cl= sconsole-&gt;<a class="code" href="../../da/d68/structSpaceConsole.html#a37b9aaee0bbd0009dd229c4e6c9cb3fe">history</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cl; cl= cl_next) {
<a name="l05938"></a>05938                     cl_next= cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#abf7833ee4b5b1cd336f71a4b77614412">next</a>;
<a name="l05939"></a>05939                     cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#a819831055f8adc1da76506b135ded576">line</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#a819831055f8adc1da76506b135ded576">line</a>);
<a name="l05940"></a>05940                     <span class="keywordflow">if</span> (cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#a819831055f8adc1da76506b135ded576">line</a>) {
<a name="l05941"></a>05941                         <span class="comment">/* the allocted length is not written, so reset here */</span>
<a name="l05942"></a>05942                         cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#aa27ee5c21618ca2b07129fcd0ead8747">len_alloc</a>= cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#af752db442dc19c02cdae4b85da53d09a">len</a> + 1;
<a name="l05943"></a>05943                     }
<a name="l05944"></a>05944                     <span class="keywordflow">else</span> {
<a name="l05945"></a>05945                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sconsole-&gt;<a class="code" href="../../da/d68/structSpaceConsole.html#a37b9aaee0bbd0009dd229c4e6c9cb3fe">history</a>, cl);
<a name="l05946"></a>05946                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cl);
<a name="l05947"></a>05947                     }
<a name="l05948"></a>05948                 }
<a name="l05949"></a>05949             }
<a name="l05950"></a>05950             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l05951"></a>05951                 <a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *sfile= (<a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *)sl;
<a name="l05952"></a>05952                 
<a name="l05953"></a>05953                 <span class="comment">/* this sort of info is probably irrelevant for reloading...</span>
<a name="l05954"></a>05954 <span class="comment">                 * plus, it isn&#39;t saved to files yet!</span>
<a name="l05955"></a>05955 <span class="comment">                 */</span>
<a name="l05956"></a>05956                 sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a65746145559024992c7406612cef9b6f">folders_prev</a>= sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#ab587cdc4261210c9aeeaed40711de0ca">folders_next</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05957"></a>05957                 sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a7da25f9907e5e3fae86c36ab182e3fec">files</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05958"></a>05958                 sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a352bfdf5731e7c1b16bb2303a6341eb7">layout</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05959"></a>05959                 sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a5ef6059fa41acf4330598c19a62918ff">op</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05960"></a>05960                 sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a734998e9f91fa15ae0beb9f723a41d09">params</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a734998e9f91fa15ae0beb9f723a41d09">params</a>);
<a name="l05961"></a>05961             }
<a name="l05962"></a>05962         }
<a name="l05963"></a>05963         
<a name="l05964"></a>05964         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a2abe64269b37637b8c7e75ac81ba9e4e">actionzones</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a2abe64269b37637b8c7e75ac81ba9e4e">actionzones</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05965"></a>05965 
<a name="l05966"></a>05966         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>);
<a name="l05967"></a>05967         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>);
<a name="l05968"></a>05968         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>);
<a name="l05969"></a>05969         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l05970"></a>05970     }
<a name="l05971"></a>05971 }
<a name="l05972"></a>05972 
<a name="l05973"></a>05973 <span class="comment">/* ********** READ LIBRARY *************** */</span>
<a name="l05974"></a>05974 
<a name="l05975"></a>05975 
<a name="l05976"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1a35b0c839005ea19e004c6b86962a42">05976</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1a35b0c839005ea19e004c6b86962a42">direct_link_library</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l05977"></a>05977 {
<a name="l05978"></a>05978     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *newmain;
<a name="l05979"></a>05979     
<a name="l05980"></a>05980     <span class="keywordflow">for</span> (newmain= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; newmain; newmain= newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l05981"></a>05981         <span class="keywordflow">if</span> (newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>) {
<a name="l05982"></a>05982             <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>(newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>) == 0) {
<a name="l05983"></a>05983                 <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>,
<a name="l05984"></a>05984                                  <span class="stringliteral">&quot;Library &#39;%s&#39;, &#39;%s&#39; had multiple instances, save and reload!&quot;</span>,
<a name="l05985"></a>05985                                  lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l05986"></a>05986 
<a name="l05987"></a>05987                 <a class="code" href="../../d0/d12/readfile_8c.html#a616ca91ef10e9653cca0974b62762b31">change_idid_adr</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, fd, lib, newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>);
<a name="l05988"></a>05988 <span class="comment">//              change_idid_adr_fd(fd, lib, newmain-&gt;curlib);</span>
<a name="l05989"></a>05989                 
<a name="l05990"></a>05990                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>, lib);
<a name="l05991"></a>05991                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(lib);
<a name="l05992"></a>05992 
<a name="l05993"></a>05993 
<a name="l05994"></a>05994                 <span class="keywordflow">return</span>;
<a name="l05995"></a>05995             }
<a name="l05996"></a>05996         }
<a name="l05997"></a>05997     }
<a name="l05998"></a>05998     <span class="comment">/* make sure we have full path in lib-&gt;filename */</span>
<a name="l05999"></a>05999     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, <span class="keyword">sizeof</span>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>));
<a name="l06000"></a>06000     <a class="code" href="../../d0/d12/readfile_8c.html#a83b06e589c8a2efbff0e61f0d79d3087">cleanup_path</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l06001"></a>06001     
<a name="l06002"></a>06002 <span class="comment">//  printf(&quot;direct_link_library: name %s\n&quot;, lib-&gt;name);</span>
<a name="l06003"></a>06003 <span class="comment">//  printf(&quot;direct_link_library: filename %s\n&quot;, lib-&gt;filename);</span>
<a name="l06004"></a>06004     
<a name="l06005"></a>06005     <span class="comment">/* new main */</span>
<a name="l06006"></a>06006     newmain= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc0/structMain.html">Main</a>), <span class="stringliteral">&quot;directlink&quot;</span>);
<a name="l06007"></a>06007     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, newmain);
<a name="l06008"></a>06008     newmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>= lib;
<a name="l06009"></a>06009 
<a name="l06010"></a>06010     lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#aa62a40a009720ec1a80ec1f050c3e13c">parent</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06011"></a>06011 }
<a name="l06012"></a>06012 
<a name="l06013"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa09d77a512e9ac511f256537a34764c7">06013</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa09d77a512e9ac511f256537a34764c7">lib_link_library</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(fd), <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l06014"></a>06014 {
<a name="l06015"></a>06015     <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib;
<a name="l06016"></a>06016     <span class="keywordflow">for</span> (lib= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lib; lib= lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a26257357bfced5837d7507da22f18c5a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l06017"></a>06017         lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a26257357bfced5837d7507da22f18c5a">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l06018"></a>06018     }
<a name="l06019"></a>06019 }
<a name="l06020"></a>06020 
<a name="l06021"></a>06021 <span class="comment">/* Always call this once you have loaded new library data to set the relative paths correctly in relation to the blend file */</span>
<a name="l06022"></a><a class="code" href="../../d0/d12/readfile_8c.html#a728bf2d00e314cdf430b210dc5a858db">06022</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a728bf2d00e314cdf430b210dc5a858db">fix_relpaths_library</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *basepath, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l06023"></a>06023 {
<a name="l06024"></a>06024     <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib;
<a name="l06025"></a>06025     <span class="comment">/* BLO_read_from_memory uses a blank filename */</span>
<a name="l06026"></a>06026     <span class="keywordflow">if</span> (basepath==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || basepath[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l06027"></a>06027         <span class="keywordflow">for</span> (lib= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lib; lib= lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a26257357bfced5837d7507da22f18c5a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l06028"></a>06028             <span class="comment">/* when loading a linked lib into a file which has not been saved,</span>
<a name="l06029"></a>06029 <span class="comment">             * there is nothing we can be relative to, so instead we need to make</span>
<a name="l06030"></a>06030 <span class="comment">             * it absolute. This can happen when appending an object with a relative</span>
<a name="l06031"></a>06031 <span class="comment">             * link into an unsaved blend file. See [#27405].</span>
<a name="l06032"></a>06032 <span class="comment">             * The remap relative option will make it relative again on save - campbell */</span>
<a name="l06033"></a>06033             <span class="keywordflow">if</span> (strncmp(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, <span class="stringliteral">&quot;//&quot;</span>, 2)==0) {
<a name="l06034"></a>06034                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, <span class="keyword">sizeof</span>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>));
<a name="l06035"></a>06035             }
<a name="l06036"></a>06036         }
<a name="l06037"></a>06037     }
<a name="l06038"></a>06038     <span class="keywordflow">else</span> {
<a name="l06039"></a>06039         <span class="keywordflow">for</span> (lib= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lib; lib= lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a26257357bfced5837d7507da22f18c5a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l06040"></a>06040             <span class="comment">/* Libraries store both relative and abs paths, recreate relative paths,</span>
<a name="l06041"></a>06041 <span class="comment">             * relative to the blend file since indirectly linked libs will be relative to their direct linked library */</span>
<a name="l06042"></a>06042             <span class="keywordflow">if</span> (strncmp(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, <span class="stringliteral">&quot;//&quot;</span>, 2)==0) { <span class="comment">/* if this is relative to begin with? */</span>
<a name="l06043"></a>06043                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, <span class="keyword">sizeof</span>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>));
<a name="l06044"></a>06044                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a885e6044163b103a6c8e811d17286bb6">BLI_path_rel</a>(lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, basepath);
<a name="l06045"></a>06045             }
<a name="l06046"></a>06046         }
<a name="l06047"></a>06047     }
<a name="l06048"></a>06048 }
<a name="l06049"></a>06049 
<a name="l06050"></a>06050 <span class="comment">/* ************ READ SPEAKER ***************** */</span>
<a name="l06051"></a>06051 
<a name="l06052"></a><a class="code" href="../../d0/d12/readfile_8c.html#a59a2d536382b8c7c988486796b3326d1">06052</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a59a2d536382b8c7c988486796b3326d1">lib_link_speaker</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l06053"></a>06053 {
<a name="l06054"></a>06054     <a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *spk;
<a name="l06055"></a>06055 
<a name="l06056"></a>06056     spk= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#af9e10672ecb71ccca79b79ec38514b1e">speaker</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06057"></a>06057     <span class="keywordflow">while</span> (spk) {
<a name="l06058"></a>06058         <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l06059"></a>06059             <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>) <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>);
<a name="l06060"></a>06060 
<a name="l06061"></a>06061             spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>);
<a name="l06062"></a>06062             <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>) {
<a name="l06063"></a>06063                 spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l06064"></a>06064             }
<a name="l06065"></a>06065 
<a name="l06066"></a>06066             spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l06067"></a>06067         }
<a name="l06068"></a>06068         spk= spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l06069"></a>06069     }
<a name="l06070"></a>06070 }
<a name="l06071"></a>06071 
<a name="l06072"></a><a class="code" href="../../d0/d12/readfile_8c.html#a870712e354266b6e0f29a7c16b079c58">06072</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a870712e354266b6e0f29a7c16b079c58">direct_link_speaker</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *spk)
<a name="l06073"></a>06073 {
<a name="l06074"></a>06074     spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>);
<a name="l06075"></a>06075     <a class="code" href="../../d0/d12/readfile_8c.html#ac20cf24350fc4ffb7a2560553b9bdc95">direct_link_animdata</a>(fd, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>);
<a name="l06076"></a>06076 
<a name="l06077"></a>06077 <span class="preprocessor">#if 0</span>
<a name="l06078"></a>06078 <span class="preprocessor"></span>    spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>);
<a name="l06079"></a>06079     <a class="code" href="../../d0/d12/readfile_8c.html#a452f5750878929dc0e719b9c9381701a">direct_link_sound</a>(fd, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>);
<a name="l06080"></a>06080 <span class="preprocessor">#endif</span>
<a name="l06081"></a>06081 <span class="preprocessor"></span>}
<a name="l06082"></a>06082 
<a name="l06083"></a>06083 <span class="comment">/* ************** READ SOUND ******************* */</span>
<a name="l06084"></a>06084 
<a name="l06085"></a><a class="code" href="../../d0/d12/readfile_8c.html#a452f5750878929dc0e719b9c9381701a">06085</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a452f5750878929dc0e719b9c9381701a">direct_link_sound</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *sound)
<a name="l06086"></a>06086 {
<a name="l06087"></a>06087     sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a5d0a67cae0463d23f97454f8579783a6">handle</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06088"></a>06088     sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a2ea38d5cfc68f03d0688cf03efc5300f">playback_handle</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06089"></a>06089     sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#aae5a99a8d317bdb758031444938e058c">waveform</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06090"></a>06090 
<a name="l06091"></a>06091     <span class="comment">// versioning stuff, if there was a cache, then we enable caching:</span>
<a name="l06092"></a>06092     <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a61334833202ab84512101b04b9552776">cache</a>)
<a name="l06093"></a>06093     {
<a name="l06094"></a>06094         sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a3359f77bc2f3c090848eee0746d7ae9e">flags</a> |= <a class="code" href="../../d1/d66/DNA__sound__types_8h.html#a5e66fb1cb9d9029042b47581b8f28ce3">SOUND_FLAGS_CACHING</a>;
<a name="l06095"></a>06095         sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a61334833202ab84512101b04b9552776">cache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06096"></a>06096     }
<a name="l06097"></a>06097 
<a name="l06098"></a>06098     sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a> = <a class="code" href="../../d0/d12/readfile_8c.html#ab47d4467d81b33a32bc7d3fe6f0244f6">direct_link_packedfile</a>(fd, sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a>);
<a name="l06099"></a>06099     sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a> = <a class="code" href="../../d0/d12/readfile_8c.html#ab47d4467d81b33a32bc7d3fe6f0244f6">direct_link_packedfile</a>(fd, sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a>);
<a name="l06100"></a>06100 }
<a name="l06101"></a>06101 
<a name="l06102"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad2857ea584f3cca15be3a8983646f1b0">06102</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad2857ea584f3cca15be3a8983646f1b0">lib_link_sound</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l06103"></a>06103 {
<a name="l06104"></a>06104     <a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *sound;
<a name="l06105"></a>06105 
<a name="l06106"></a>06106     sound= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06107"></a>06107     <span class="keywordflow">while</span> (sound) {
<a name="l06108"></a>06108         <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l06109"></a>06109             sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l06110"></a>06110             sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a60f9608a681f9f2baff429a75ec5d757">ipo</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a60f9608a681f9f2baff429a75ec5d757">ipo</a>); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l06111"></a>06111             
<a name="l06112"></a>06112             <a class="code" href="../../d2/db1/BKE__sound_8h.html#a85ca26441a1ce74f38471059a7447c5d">sound_load</a>(main, sound);
<a name="l06113"></a>06113         }
<a name="l06114"></a>06114         sound= sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l06115"></a>06115     }
<a name="l06116"></a>06116 }
<a name="l06117"></a>06117 <span class="comment">/* ***************** READ GROUP *************** */</span>
<a name="l06118"></a>06118 
<a name="l06119"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae40b11175fb7a37d6e40b81b3eba5c0d">06119</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ae40b11175fb7a37d6e40b81b3eba5c0d">direct_link_group</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group)
<a name="l06120"></a>06120 {
<a name="l06121"></a>06121     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>);
<a name="l06122"></a>06122 }
<a name="l06123"></a>06123 
<a name="l06124"></a><a class="code" href="../../d0/d12/readfile_8c.html#a27e8ccc208b85b6149be8c6fa995d310">06124</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a27e8ccc208b85b6149be8c6fa995d310">lib_link_group</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l06125"></a>06125 {
<a name="l06126"></a>06126     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06127"></a>06127     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l06128"></a>06128     <span class="keywordtype">int</span> add_us;
<a name="l06129"></a>06129     
<a name="l06130"></a>06130     <span class="keywordflow">while</span> (group) {
<a name="l06131"></a>06131         <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l06132"></a>06132             group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l06133"></a>06133             
<a name="l06134"></a>06134             add_us= 0;
<a name="l06135"></a>06135             
<a name="l06136"></a>06136             go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06137"></a>06137             <span class="keywordflow">while</span> (go) {
<a name="l06138"></a>06138                 go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>);
<a name="l06139"></a>06139                 <span class="keywordflow">if</span> (go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>) {
<a name="l06140"></a>06140                     go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>;
<a name="l06141"></a>06141                     <span class="comment">/* if group has an object, it increments user... */</span>
<a name="l06142"></a>06142                     add_us= 1;
<a name="l06143"></a>06143                     <span class="keywordflow">if</span> (go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==0)
<a name="l06144"></a>06144                         go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l06145"></a>06145                 }
<a name="l06146"></a>06146                 go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>;
<a name="l06147"></a>06147             }
<a name="l06148"></a>06148             <span class="keywordflow">if</span> (add_us) group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l06149"></a>06149             <a class="code" href="../../d2/df5/BKE__group_8h.html#aab6586d417ef750053456ac7c4ca8807">rem_from_group</a>(group, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);    <span class="comment">/* removes NULL entries */</span>
<a name="l06150"></a>06150         }
<a name="l06151"></a>06151         group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l06152"></a>06152     }
<a name="l06153"></a>06153 }
<a name="l06154"></a>06154 
<a name="l06155"></a>06155 <span class="comment">/* ***************** READ MOVIECLIP *************** */</span>
<a name="l06156"></a>06156 
<a name="l06157"></a><a class="code" href="../../d0/d12/readfile_8c.html#af8020e89b9c7e713c5500959e8b6b93c">06157</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af8020e89b9c7e713c5500959e8b6b93c">direct_link_movieReconstruction</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html">MovieTrackingReconstruction</a> *reconstruction)
<a name="l06158"></a>06158 {
<a name="l06159"></a>06159     reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#ac680e228e4654f3375f1458195da30e1">cameras</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#ac680e228e4654f3375f1458195da30e1">cameras</a>);
<a name="l06160"></a>06160 }
<a name="l06161"></a>06161 
<a name="l06162"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab23eb173fd6b73b5daa940bbc71c69fd">06162</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab23eb173fd6b73b5daa940bbc71c69fd">direct_link_movieTracks</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *tracksbase)
<a name="l06163"></a>06163 {
<a name="l06164"></a>06164     <a class="code" href="../../da/d5f/structMovieTrackingTrack.html">MovieTrackingTrack</a> *track;
<a name="l06165"></a>06165 
<a name="l06166"></a>06166     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, tracksbase);
<a name="l06167"></a>06167 
<a name="l06168"></a>06168     track= tracksbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06169"></a>06169     <span class="keywordflow">while</span> (track) {
<a name="l06170"></a>06170         track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a9b873f8e5dc871f03a5ea0a42095927e">markers</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a9b873f8e5dc871f03a5ea0a42095927e">markers</a>);
<a name="l06171"></a>06171 
<a name="l06172"></a>06172         track= track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#aec565ab687123b2707c7be0182b24ea6">next</a>;
<a name="l06173"></a>06173     }
<a name="l06174"></a>06174 }
<a name="l06175"></a>06175 
<a name="l06176"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab4499b150cc6cad9756d2b5060b42dcb">06176</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab4499b150cc6cad9756d2b5060b42dcb">direct_link_movieclip</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l06177"></a>06177 {
<a name="l06178"></a>06178     <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking= &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l06179"></a>06179     <a class="code" href="../../d2/de6/structMovieTrackingObject.html">MovieTrackingObject</a> *object;
<a name="l06180"></a>06180 
<a name="l06181"></a>06181     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>);
<a name="l06182"></a>06182 
<a name="l06183"></a>06183     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>) clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>);
<a name="l06184"></a>06184     <span class="keywordflow">else</span> clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06185"></a>06185 
<a name="l06186"></a>06186     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aa925bd5b5698256dd100a608a5f11cca">movieclipmap</a>) clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a7df4bfc1c51ce71d9a614c010056aa0d">newmclipadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>);
<a name="l06187"></a>06187     <span class="keywordflow">else</span> clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aa298f48dc58796d47294d1def37e1571">intrinsics</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06188"></a>06188 
<a name="l06189"></a>06189     <a class="code" href="../../d0/d12/readfile_8c.html#ab23eb173fd6b73b5daa940bbc71c69fd">direct_link_movieTracks</a>(fd, &amp;tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a74fe531242e070b2108266db9046bf8f">tracks</a>);
<a name="l06190"></a>06190     <a class="code" href="../../d0/d12/readfile_8c.html#af8020e89b9c7e713c5500959e8b6b93c">direct_link_movieReconstruction</a>(fd, &amp;tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a08fa44e235d5e8555098950eca818076">reconstruction</a>);
<a name="l06191"></a>06191 
<a name="l06192"></a>06192     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#a8589447927c2d2ed3f7fa8b23434046f">act_track</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#a8589447927c2d2ed3f7fa8b23434046f">act_track</a>);
<a name="l06193"></a>06193 
<a name="l06194"></a>06194     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06195"></a>06195     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a70b380f3e5eb84c8d5f23dbb41be115b">tracking_context</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06196"></a>06196     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#a3f358c5f17db519129b32708b0f02af2">stats</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06197"></a>06197 
<a name="l06198"></a>06198     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#af45dd7955027c6f892e7f1ad15ffdc9a">ok</a>= 0;
<a name="l06199"></a>06199     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#aa31124cc2c83761d5a93ac50679ae9f3">scaleibuf</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06200"></a>06200     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#ae9b55bdb3802264af7f2c14ab8056df2">rot_track</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#ae9b55bdb3802264af7f2c14ab8056df2">rot_track</a>);
<a name="l06201"></a>06201 
<a name="l06202"></a>06202     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a8b83f22c1c9fa84904d2a6689973b789">objects</a>);
<a name="l06203"></a>06203 
<a name="l06204"></a>06204     <span class="keywordtype">object</span>= tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a8b83f22c1c9fa84904d2a6689973b789">objects</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06205"></a>06205     <span class="keywordflow">while</span> (<span class="keywordtype">object</span>) {
<a name="l06206"></a>06206         <a class="code" href="../../d0/d12/readfile_8c.html#ab23eb173fd6b73b5daa940bbc71c69fd">direct_link_movieTracks</a>(fd, &amp;object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#a6b02c7f7e4eb6807acefb344d36fc07c">tracks</a>);
<a name="l06207"></a>06207         <a class="code" href="../../d0/d12/readfile_8c.html#af8020e89b9c7e713c5500959e8b6b93c">direct_link_movieReconstruction</a>(fd, &amp;object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#a94d8bb0ba214e1dfd431530a6fb17af3">reconstruction</a>);
<a name="l06208"></a>06208 
<a name="l06209"></a>06209         <span class="keywordtype">object</span>= <span class="keywordtype">object</span>-&gt;next;
<a name="l06210"></a>06210     }
<a name="l06211"></a>06211 }
<a name="l06212"></a>06212 
<a name="l06213"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2f13b06d9affcef04703f64794e79f09">06213</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2f13b06d9affcef04703f64794e79f09">lib_link_movieclip</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l06214"></a>06214 {
<a name="l06215"></a>06215     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l06216"></a>06216 
<a name="l06217"></a>06217     clip= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06218"></a>06218     <span class="keywordflow">while</span> (clip) {
<a name="l06219"></a>06219         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l06220"></a>06220             <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>)
<a name="l06221"></a>06221                 <a class="code" href="../../d0/d12/readfile_8c.html#ac1b09790dfa7ed928e21e657ce8391c6">lib_link_animdata</a>(fd, &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>);
<a name="l06222"></a>06222 
<a name="l06223"></a>06223             clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#add2ae3647cc0fc51e5b2254cbbb152b7">gpd</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#add2ae3647cc0fc51e5b2254cbbb152b7">gpd</a>);
<a name="l06224"></a>06224 
<a name="l06225"></a>06225             clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l06226"></a>06226         }
<a name="l06227"></a>06227         clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l06228"></a>06228     }
<a name="l06229"></a>06229 }
<a name="l06230"></a>06230 
<a name="l06231"></a>06231 <span class="comment">/* ************** GENERAL &amp; MAIN ******************** */</span>
<a name="l06232"></a>06232 
<a name="l06233"></a>06233 
<a name="l06234"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5b4f86c0913e040faf846cc757887a98">06234</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a5b4f86c0913e040faf846cc757887a98">dataname</a>(<span class="keywordtype">short</span> id_code)
<a name="l06235"></a>06235 {
<a name="l06236"></a>06236     
<a name="l06237"></a>06237     <span class="keywordflow">switch</span>( id_code ) {
<a name="l06238"></a>06238         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from OB&quot;</span>;
<a name="l06239"></a>06239         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from ME&quot;</span>;
<a name="l06240"></a>06240         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a5856d1dba712ee1a816c279762743c1b">ID_IP</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from IP&quot;</span>;
<a name="l06241"></a>06241         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from SCE&quot;</span>;
<a name="l06242"></a>06242         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from MA&quot;</span>;
<a name="l06243"></a>06243         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from TE&quot;</span>;
<a name="l06244"></a>06244         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ace150506eaf644d92a5110cf45978379">ID_CU</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from CU&quot;</span>;
<a name="l06245"></a>06245         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afc8c3d5178b4130eee3e7542ef0dcae7">ID_GR</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from GR&quot;</span>;
<a name="l06246"></a>06246         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae4ba19f70b08895557ef00b489e7d255">ID_AR</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from AR&quot;</span>;
<a name="l06247"></a>06247         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from AC&quot;</span>;
<a name="l06248"></a>06248         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abaf1999f335a0db6ef4f452fae0fbd06">ID_LI</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from LI&quot;</span>;
<a name="l06249"></a>06249         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3e4005eef9876a2cb9d799bdb2a43998">ID_MB</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from MB&quot;</span>;
<a name="l06250"></a>06250         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a564eac75543b047cf8b2b759818529c3">ID_IM</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from IM&quot;</span>;
<a name="l06251"></a>06251         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad058b07954b2795eadc855a7a354578b">ID_LT</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from LT&quot;</span>;
<a name="l06252"></a>06252         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from LA&quot;</span>;
<a name="l06253"></a>06253         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82bdb2fdea7abee55d993c0210101273">ID_CA</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from CA&quot;</span>;
<a name="l06254"></a>06254         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a46c0b029a6e8fc3d7ebb18311b83397d">ID_KE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from KE&quot;</span>;
<a name="l06255"></a>06255         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from WO&quot;</span>;
<a name="l06256"></a>06256         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad177ecff9697780942b6ff5576c153e9">ID_SCR</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from SCR&quot;</span>;
<a name="l06257"></a>06257         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a00dc71b465cb83f24230f213cb0d79c1">ID_VF</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from VF&quot;</span>;
<a name="l06258"></a>06258         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aedc19b629c5c0b30dd7697cd4ac4dc20">ID_TXT</a> : <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from TXT&quot;</span>;
<a name="l06259"></a>06259         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0cd81e8a0b1724426ed2d1e36218cdf6">ID_SPK</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from SPK&quot;</span>;
<a name="l06260"></a>06260         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3bae74282a62fb44842ff3767a86ec70">ID_SO</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from SO&quot;</span>;
<a name="l06261"></a>06261         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from NT&quot;</span>;
<a name="l06262"></a>06262         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7f2ccbf688d8c6763420cb2fe028e5a">ID_BR</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from BR&quot;</span>;
<a name="l06263"></a>06263         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa64d54c8b860f4a2c7cabc743f60512e">ID_PA</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from PA&quot;</span>;
<a name="l06264"></a>06264         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2df65579fd9eb1398862a7e915de5dc2">ID_GD</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from GD&quot;</span>;
<a name="l06265"></a>06265         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a7f8c4173f43796897d92d5c2ac8ec697">ID_MC</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from MC&quot;</span>;
<a name="l06266"></a>06266     }
<a name="l06267"></a>06267     <span class="keywordflow">return</span> <span class="stringliteral">&quot;Data from Lib Block&quot;</span>;
<a name="l06268"></a>06268     
<a name="l06269"></a>06269 }
<a name="l06270"></a>06270 
<a name="l06271"></a><a class="code" href="../../d0/d12/readfile_8c.html#aabc4bcc829936539892ac7a711c9ad27">06271</a> <span class="keyword">static</span> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#aabc4bcc829936539892ac7a711c9ad27">read_data_into_oldnewmap</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead, <span class="keyword">const</span> <span class="keywordtype">char</span> *allocname)
<a name="l06272"></a>06272 {
<a name="l06273"></a>06273     bhead = <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l06274"></a>06274 
<a name="l06275"></a>06275     <span class="keywordflow">while</span> (bhead &amp;&amp; bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>) {
<a name="l06276"></a>06276         <span class="keywordtype">void</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l06277"></a>06277 <span class="preprocessor">#if 0</span>
<a name="l06278"></a>06278 <span class="preprocessor"></span>        <span class="comment">/* XXX DUMB DEBUGGING OPTION TO GIVE NAMES for guarded malloc errors */</span>
<a name="l06279"></a>06279         <span class="keywordtype">short</span> *sp= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a7a8754dea529ccbcd709128e5d78e262">structs</a>[bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>];
<a name="l06280"></a>06280         <span class="keywordtype">char</span> *tmp= malloc(100);
<a name="l06281"></a>06281         allocname = fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7c9199b878e877e4c1b2960f95681c02">filesdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a0d5e0524e4c0c40fd9fa549d80ea04c8">types</a>[ sp[0] ];
<a name="l06282"></a>06282         strcpy(tmp, allocname);
<a name="l06283"></a>06283         data= <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bhead, tmp);
<a name="l06284"></a>06284 <span class="preprocessor">#else</span>
<a name="l06285"></a>06285 <span class="preprocessor"></span>        data= <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bhead, allocname);
<a name="l06286"></a>06286 <span class="preprocessor">#endif</span>
<a name="l06287"></a>06287 <span class="preprocessor"></span>        
<a name="l06288"></a>06288         <span class="keywordflow">if</span> (data) {
<a name="l06289"></a>06289             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>, data, 0);
<a name="l06290"></a>06290         }
<a name="l06291"></a>06291 
<a name="l06292"></a>06292         bhead = <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l06293"></a>06293     }
<a name="l06294"></a>06294 
<a name="l06295"></a>06295     <span class="keywordflow">return</span> bhead;
<a name="l06296"></a>06296 }
<a name="l06297"></a>06297 
<a name="l06298"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">06298</a> <span class="keyword">static</span> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead, <span class="keywordtype">int</span> flag, <a class="code" href="../../d8/d7e/structID.html">ID</a> **id_r)
<a name="l06299"></a>06299 {
<a name="l06300"></a>06300     <span class="comment">/* this routine reads a libblock and its direct data. Use link functions</span>
<a name="l06301"></a>06301 <span class="comment">     * to connect it all</span>
<a name="l06302"></a>06302 <span class="comment">     */</span>
<a name="l06303"></a>06303 
<a name="l06304"></a>06304     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l06305"></a>06305     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb;
<a name="l06306"></a>06306     <span class="keyword">const</span> <span class="keywordtype">char</span> *allocname;
<a name="l06307"></a>06307     
<a name="l06308"></a>06308     <span class="comment">/* read libblock */</span>
<a name="l06309"></a>06309     <span class="keywordtype">id</span> = <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bhead, <span class="stringliteral">&quot;lib block&quot;</span>);
<a name="l06310"></a>06310     <span class="keywordflow">if</span> (id_r)
<a name="l06311"></a>06311         *id_r= id;
<a name="l06312"></a>06312     <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>)
<a name="l06313"></a>06313         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l06314"></a>06314     
<a name="l06315"></a>06315     <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>, <span class="keywordtype">id</span>, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>);  <span class="comment">/* for ID_ID check */</span>
<a name="l06316"></a>06316     
<a name="l06317"></a>06317     <span class="comment">/* do after read_struct, for dna reconstruct */</span>
<a name="l06318"></a>06318     <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae719dff14cceff0aafe109635eac72ea">ID_ID</a>) {
<a name="l06319"></a>06319         lb= <a class="code" href="../../d8/db1/BKE__library_8h.html#a2dc345b18171d710d51f14d814121381">which_libbase</a>(main, <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>));
<a name="l06320"></a>06320     }
<a name="l06321"></a>06321     <span class="keywordflow">else</span> {
<a name="l06322"></a>06322         lb= <a class="code" href="../../d8/db1/BKE__library_8h.html#a2dc345b18171d710d51f14d814121381">which_libbase</a>(main, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>);
<a name="l06323"></a>06323     }
<a name="l06324"></a>06324     
<a name="l06325"></a>06325     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, <span class="keywordtype">id</span>);
<a name="l06326"></a>06326 
<a name="l06327"></a>06327     <span class="comment">/* clear first 8 bits */</span>
<a name="l06328"></a>06328     <span class="keywordtype">id</span>-&gt;flag= (<span class="keywordtype">id</span>-&gt;flag &amp; 0xFF00) | flag | <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>;
<a name="l06329"></a>06329     <span class="keywordtype">id</span>-&gt;lib= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>;
<a name="l06330"></a>06330     <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7a490f7c486f67fa46961f920fc8e26">LIB_FAKEUSER</a>) <span class="keywordtype">id</span>-&gt;us= 1;
<a name="l06331"></a>06331     <span class="keywordflow">else</span> <span class="keywordtype">id</span>-&gt;us= 0;
<a name="l06332"></a>06332     <span class="keywordtype">id</span>-&gt;icon_id = 0;
<a name="l06333"></a>06333     <span class="keywordtype">id</span>-&gt;flag &amp;= ~(<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6495dd702ce79062ae906f5c158d0680">LIB_ID_RECALC</a>|<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab8237ab3584d272d3ae2d70c4ee2b040">LIB_ID_RECALC_DATA</a>);
<a name="l06334"></a>06334 
<a name="l06335"></a>06335     <span class="comment">/* this case cannot be direct_linked: it&#39;s just the ID part */</span>
<a name="l06336"></a>06336     <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae719dff14cceff0aafe109635eac72ea">ID_ID</a>) {
<a name="l06337"></a>06337         <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l06338"></a>06338     }
<a name="l06339"></a>06339 
<a name="l06340"></a>06340     <span class="comment">/* need a name for the mallocN, just for debugging and sane prints on leaks */</span>
<a name="l06341"></a>06341     allocname= <a class="code" href="../../d0/d12/readfile_8c.html#a5b4f86c0913e040faf846cc757887a98">dataname</a>(<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>));
<a name="l06342"></a>06342     
<a name="l06343"></a>06343     <span class="comment">/* read all data into fd-&gt;datamap */</span>
<a name="l06344"></a>06344     bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aabc4bcc829936539892ac7a711c9ad27">read_data_into_oldnewmap</a>(fd, bhead, allocname);
<a name="l06345"></a>06345 
<a name="l06346"></a>06346     <span class="comment">/* init pointers direct data */</span>
<a name="l06347"></a>06347     <span class="keywordflow">switch</span>( <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) ) {
<a name="l06348"></a>06348         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a31e01e435bf4f33398bb3504bc6ce2cb">ID_WM</a>:
<a name="l06349"></a>06349             <a class="code" href="../../d0/d12/readfile_8c.html#a1c099439e22c8b72cd8ecf39f35498b1">direct_link_windowmanager</a>(fd, (<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *)<span class="keywordtype">id</span>);
<a name="l06350"></a>06350             <span class="keywordflow">break</span>;
<a name="l06351"></a>06351         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad177ecff9697780942b6ff5576c153e9">ID_SCR</a>:
<a name="l06352"></a>06352             <a class="code" href="../../d0/d12/readfile_8c.html#ae4d8907e36f5fa2b052fb0cdcef07734">direct_link_screen</a>(fd, (<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *)<span class="keywordtype">id</span>);
<a name="l06353"></a>06353             <span class="keywordflow">break</span>;
<a name="l06354"></a>06354         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>:
<a name="l06355"></a>06355             <a class="code" href="../../d0/d12/readfile_8c.html#add50553ce5281b5b24b94aa13ad31656">direct_link_scene</a>(fd, (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<span class="keywordtype">id</span>);
<a name="l06356"></a>06356             <span class="keywordflow">break</span>;
<a name="l06357"></a>06357         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>:
<a name="l06358"></a>06358             <a class="code" href="../../d0/d12/readfile_8c.html#ad786ae45ae21936d196d6491052eb74d">direct_link_object</a>(fd, (<a class="code" href="../../de/de7/structObject.html">Object</a> *)<span class="keywordtype">id</span>);
<a name="l06359"></a>06359             <span class="keywordflow">break</span>;
<a name="l06360"></a>06360         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>:
<a name="l06361"></a>06361             <a class="code" href="../../d0/d12/readfile_8c.html#adaa08865dc3a94cfafce3d683dd4c55d">direct_link_mesh</a>(fd, (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)<span class="keywordtype">id</span>);
<a name="l06362"></a>06362             <span class="keywordflow">break</span>;
<a name="l06363"></a>06363         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ace150506eaf644d92a5110cf45978379">ID_CU</a>:
<a name="l06364"></a>06364             <a class="code" href="../../d0/d12/readfile_8c.html#a90fd573b2be2b44cc32aa9ad57fed93a">direct_link_curve</a>(fd, (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)<span class="keywordtype">id</span>);
<a name="l06365"></a>06365             <span class="keywordflow">break</span>;
<a name="l06366"></a>06366         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3e4005eef9876a2cb9d799bdb2a43998">ID_MB</a>:
<a name="l06367"></a>06367             <a class="code" href="../../d0/d12/readfile_8c.html#a4d7d6ebffc9359965e1ccd2371a44646">direct_link_mball</a>(fd, (<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *)<span class="keywordtype">id</span>);
<a name="l06368"></a>06368             <span class="keywordflow">break</span>;
<a name="l06369"></a>06369         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>:
<a name="l06370"></a>06370             <a class="code" href="../../d0/d12/readfile_8c.html#ae712d05f2bc5d9b93d092f2566bd41b0">direct_link_material</a>(fd, (<a class="code" href="../../d2/d10/structMaterial.html">Material</a> *)<span class="keywordtype">id</span>);
<a name="l06371"></a>06371             <span class="keywordflow">break</span>;
<a name="l06372"></a>06372         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>:
<a name="l06373"></a>06373             <a class="code" href="../../d0/d12/readfile_8c.html#ad097d43097a93be1c7d96f6ac038b229">direct_link_texture</a>(fd, (<a class="code" href="../../df/d2d/structTex.html">Tex</a> *)<span class="keywordtype">id</span>);
<a name="l06374"></a>06374             <span class="keywordflow">break</span>;
<a name="l06375"></a>06375         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a564eac75543b047cf8b2b759818529c3">ID_IM</a>:
<a name="l06376"></a>06376             <a class="code" href="../../d0/d12/readfile_8c.html#a00c3c0b7b91fea008f45562cec48744f">direct_link_image</a>(fd, (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)<span class="keywordtype">id</span>);
<a name="l06377"></a>06377             <span class="keywordflow">break</span>;
<a name="l06378"></a>06378         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>:
<a name="l06379"></a>06379             <a class="code" href="../../d0/d12/readfile_8c.html#a2938a1efa1b5d95a2a6766bcbe1617cc">direct_link_lamp</a>(fd, (<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *)<span class="keywordtype">id</span>);
<a name="l06380"></a>06380             <span class="keywordflow">break</span>;
<a name="l06381"></a>06381         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a00dc71b465cb83f24230f213cb0d79c1">ID_VF</a>:
<a name="l06382"></a>06382             <a class="code" href="../../d0/d12/readfile_8c.html#aae703b4108d3110ceaddacacc7ac9ac2">direct_link_vfont</a>(fd, (<a class="code" href="../../dc/dbe/structVFont.html">VFont</a> *)<span class="keywordtype">id</span>);
<a name="l06383"></a>06383             <span class="keywordflow">break</span>;
<a name="l06384"></a>06384         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aedc19b629c5c0b30dd7697cd4ac4dc20">ID_TXT</a>:
<a name="l06385"></a>06385             <a class="code" href="../../d0/d12/readfile_8c.html#ab5650b7c5fd2d28347d2a1a90acb6edd">direct_link_text</a>(fd, (<a class="code" href="../../d2/dda/structText.html">Text</a> *)<span class="keywordtype">id</span>);
<a name="l06386"></a>06386             <span class="keywordflow">break</span>;
<a name="l06387"></a>06387         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a5856d1dba712ee1a816c279762743c1b">ID_IP</a>:
<a name="l06388"></a>06388             <a class="code" href="../../d0/d12/readfile_8c.html#a9c31376e4af5bb194e6639d5691f1c3f">direct_link_ipo</a>(fd, (<a class="code" href="../../d2/dc5/structIpo.html">Ipo</a> *)<span class="keywordtype">id</span>);
<a name="l06389"></a>06389             <span class="keywordflow">break</span>;
<a name="l06390"></a>06390         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a46c0b029a6e8fc3d7ebb18311b83397d">ID_KE</a>:
<a name="l06391"></a>06391             <a class="code" href="../../d0/d12/readfile_8c.html#a82f4a32146d0cf70d646f6c41b675f3b">direct_link_key</a>(fd, (<a class="code" href="../../d1/d9e/structKey.html">Key</a> *)<span class="keywordtype">id</span>);
<a name="l06392"></a>06392             <span class="keywordflow">break</span>;
<a name="l06393"></a>06393         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad058b07954b2795eadc855a7a354578b">ID_LT</a>:
<a name="l06394"></a>06394             <a class="code" href="../../d0/d12/readfile_8c.html#a5ed178467f2244f706d1d31d36b044df">direct_link_latt</a>(fd, (<a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *)<span class="keywordtype">id</span>);
<a name="l06395"></a>06395             <span class="keywordflow">break</span>;
<a name="l06396"></a>06396         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>:
<a name="l06397"></a>06397             <a class="code" href="../../d0/d12/readfile_8c.html#a4626f74b95336375c371fce830b88c15">direct_link_world</a>(fd, (<a class="code" href="../../d7/d3f/structWorld.html">World</a> *)<span class="keywordtype">id</span>);
<a name="l06398"></a>06398             <span class="keywordflow">break</span>;
<a name="l06399"></a>06399         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abaf1999f335a0db6ef4f452fae0fbd06">ID_LI</a>:
<a name="l06400"></a>06400             <a class="code" href="../../d0/d12/readfile_8c.html#a1a35b0c839005ea19e004c6b86962a42">direct_link_library</a>(fd, (<a class="code" href="../../da/d4d/structLibrary.html">Library</a> *)<span class="keywordtype">id</span>, main);
<a name="l06401"></a>06401             <span class="keywordflow">break</span>;
<a name="l06402"></a>06402         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82bdb2fdea7abee55d993c0210101273">ID_CA</a>:
<a name="l06403"></a>06403             <a class="code" href="../../d0/d12/readfile_8c.html#add89a838fed275afa47f5ab049ceedb5">direct_link_camera</a>(fd, (<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *)<span class="keywordtype">id</span>);
<a name="l06404"></a>06404             <span class="keywordflow">break</span>;
<a name="l06405"></a>06405         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0cd81e8a0b1724426ed2d1e36218cdf6">ID_SPK</a>:
<a name="l06406"></a>06406             <a class="code" href="../../d0/d12/readfile_8c.html#a870712e354266b6e0f29a7c16b079c58">direct_link_speaker</a>(fd, (<a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *)<span class="keywordtype">id</span>);
<a name="l06407"></a>06407             <span class="keywordflow">break</span>;
<a name="l06408"></a>06408         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3bae74282a62fb44842ff3767a86ec70">ID_SO</a>:
<a name="l06409"></a>06409             <a class="code" href="../../d0/d12/readfile_8c.html#a452f5750878929dc0e719b9c9381701a">direct_link_sound</a>(fd, (<a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *)<span class="keywordtype">id</span>);
<a name="l06410"></a>06410             <span class="keywordflow">break</span>;
<a name="l06411"></a>06411         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afc8c3d5178b4130eee3e7542ef0dcae7">ID_GR</a>:
<a name="l06412"></a>06412             <a class="code" href="../../d0/d12/readfile_8c.html#ae40b11175fb7a37d6e40b81b3eba5c0d">direct_link_group</a>(fd, (<a class="code" href="../../d4/d91/structGroup.html">Group</a> *)<span class="keywordtype">id</span>);
<a name="l06413"></a>06413             <span class="keywordflow">break</span>;
<a name="l06414"></a>06414         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae4ba19f70b08895557ef00b489e7d255">ID_AR</a>:
<a name="l06415"></a>06415             <a class="code" href="../../d0/d12/readfile_8c.html#a91c1647530e43997b7144e10ac7eb7f4">direct_link_armature</a>(fd, (<a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a>*)<span class="keywordtype">id</span>);
<a name="l06416"></a>06416             <span class="keywordflow">break</span>;
<a name="l06417"></a>06417         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>:
<a name="l06418"></a>06418             <a class="code" href="../../d0/d12/readfile_8c.html#a0eb8acb4f2e1d138367e42fa8e330490">direct_link_action</a>(fd, (<a class="code" href="../../d1/d48/structbAction.html">bAction</a>*)<span class="keywordtype">id</span>);
<a name="l06419"></a>06419             <span class="keywordflow">break</span>;
<a name="l06420"></a>06420         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>:
<a name="l06421"></a>06421             <a class="code" href="../../d0/d12/readfile_8c.html#a46d0239dd55a53c999f8e037fa4c77f6">direct_link_nodetree</a>(fd, (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)<span class="keywordtype">id</span>);
<a name="l06422"></a>06422             <span class="keywordflow">break</span>;
<a name="l06423"></a>06423         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7f2ccbf688d8c6763420cb2fe028e5a">ID_BR</a>:
<a name="l06424"></a>06424             <a class="code" href="../../d0/d12/readfile_8c.html#af10943511a67b2e18b2d2546d7bea48d">direct_link_brush</a>(fd, (<a class="code" href="../../d1/d9f/structBrush.html">Brush</a>*)<span class="keywordtype">id</span>);
<a name="l06425"></a>06425             <span class="keywordflow">break</span>;
<a name="l06426"></a>06426         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa64d54c8b860f4a2c7cabc743f60512e">ID_PA</a>:
<a name="l06427"></a>06427             <a class="code" href="../../d0/d12/readfile_8c.html#a028adce39042967163037ebdd4369b5a">direct_link_particlesettings</a>(fd, (<a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a>*)<span class="keywordtype">id</span>);
<a name="l06428"></a>06428             <span class="keywordflow">break</span>;
<a name="l06429"></a>06429         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a9677f9d5fdee0a3ab214151155cef964">ID_SCRIPT</a>:
<a name="l06430"></a>06430             <a class="code" href="../../d0/d12/readfile_8c.html#ad22bed95cbc5ad8fd1589edf6d7e8aa0">direct_link_script</a>(fd, (<a class="code" href="../../d7/d04/structScript.html">Script</a>*)<span class="keywordtype">id</span>);
<a name="l06431"></a>06431             <span class="keywordflow">break</span>;
<a name="l06432"></a>06432         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2df65579fd9eb1398862a7e915de5dc2">ID_GD</a>:
<a name="l06433"></a>06433             <a class="code" href="../../d0/d12/readfile_8c.html#a6bd2786d3e6f4078340ce682b13b7cb2">direct_link_gpencil</a>(fd, (<a class="code" href="../../dd/d52/structbGPdata.html">bGPdata</a> *)<span class="keywordtype">id</span>);
<a name="l06434"></a>06434             <span class="keywordflow">break</span>;
<a name="l06435"></a>06435         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a7f8c4173f43796897d92d5c2ac8ec697">ID_MC</a>:
<a name="l06436"></a>06436             <a class="code" href="../../d0/d12/readfile_8c.html#ab4499b150cc6cad9756d2b5060b42dcb">direct_link_movieclip</a>(fd, (<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *)<span class="keywordtype">id</span>);
<a name="l06437"></a>06437             <span class="keywordflow">break</span>;
<a name="l06438"></a>06438     }
<a name="l06439"></a>06439     
<a name="l06440"></a>06440     <span class="comment">/*link direct data of ID properties*/</span>
<a name="l06441"></a>06441     <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) {
<a name="l06442"></a>06442         <span class="keywordtype">id</span>-&gt;properties = <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, id-&gt;<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>);
<a name="l06443"></a>06443         <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) { <span class="comment">/* this case means the data was written incorrectly, it should not happen */</span>
<a name="l06444"></a>06444             <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l06445"></a>06445         }
<a name="l06446"></a>06446     }
<a name="l06447"></a>06447 
<a name="l06448"></a>06448     <a class="code" href="../../d0/d12/readfile_8c.html#a6c9bdd398865fbc03c3e15c9a27ae6fe">oldnewmap_free_unused</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>);
<a name="l06449"></a>06449     <a class="code" href="../../d0/d12/readfile_8c.html#aba079f09686eff5205d81438bc402689">oldnewmap_clear</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>);
<a name="l06450"></a>06450 
<a name="l06451"></a>06451     <span class="keywordflow">return</span> (bhead);
<a name="l06452"></a>06452 }
<a name="l06453"></a>06453 
<a name="l06454"></a>06454 <span class="comment">/* note, this has to be kept for reading older files... */</span>
<a name="l06455"></a>06455 <span class="comment">/* also version info is written here */</span>
<a name="l06456"></a><a class="code" href="../../d0/d12/readfile_8c.html#adc7ea50765ff1877a81e7c98ec047cfb">06456</a> <span class="keyword">static</span> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#adc7ea50765ff1877a81e7c98ec047cfb">read_global</a>(<a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead)
<a name="l06457"></a>06457 {
<a name="l06458"></a>06458     <a class="code" href="../../db/d9a/structFileGlobal.html">FileGlobal</a> *fg= <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bhead, <span class="stringliteral">&quot;Global&quot;</span>);
<a name="l06459"></a>06459     
<a name="l06460"></a>06460     <span class="comment">/* copy to bfd handle */</span>
<a name="l06461"></a>06461     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a415a742799c367639e33080e74fb4449">subversion</a>;
<a name="l06462"></a>06462     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#a78def530ab43c43630d2d468e083cb83">minversionfile</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a9ab560aa2e6abea29fdf9bf8562c4cd5">minversion</a>;
<a name="l06463"></a>06463     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#ab56fa441a433f58e9b0541d8f4f5c210">minsubversionfile</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a75fdb1f77be02db33fa3af5da5ba0b14">minsubversion</a>;
<a name="l06464"></a>06464     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#ab5cfd3be11c657c3eb66ff6ee3b4dcf8">revision</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a20f32c691c6f173a63bb0333d2127a53">revision</a>;
<a name="l06465"></a>06465     
<a name="l06466"></a>06466     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a22f82a21a5ea33b23956a688e9ed5595">winpos</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a6ba4e3ecd5302c24079f3a83e4bbfdf3">winpos</a>;
<a name="l06467"></a>06467     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a18858ade465176be45afbe2a4f50563b">fileflags</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a7f8eadc30a8b154168b4852f8793063f">fileflags</a>;
<a name="l06468"></a>06468     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ac6f05d28dd3dc3a4869fc4d16c0adcd8">displaymode</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a6a95b3dccada4af0741cacdb5e348312">displaymode</a>;
<a name="l06469"></a>06469     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#af96ecf74af63b83903105e4ffc837fe2">globalf</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a28df6e05561b90006153f3a925653378">globalf</a>;
<a name="l06470"></a>06470     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#aff5b3d60cfdb6c24dfdb18159928d857">filename</a>, fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#affe6d9c896ff71a3e861e51fac141680">filename</a>, <span class="keyword">sizeof</span>(bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#aff5b3d60cfdb6c24dfdb18159928d857">filename</a>));
<a name="l06471"></a>06471     
<a name="l06472"></a>06472     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.fileflags &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a28c521d55001f8082934eab889676e76">G_FILE_RECOVER</a>)
<a name="l06473"></a>06473         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>, fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#affe6d9c896ff71a3e861e51fac141680">filename</a>, <span class="keyword">sizeof</span>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>));
<a name="l06474"></a>06474     
<a name="l06475"></a>06475     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a878e239a8517075578f047442d1aa3d1">curscreen</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#ac07df6dac9cdf380c1162a39275deee2">curscreen</a>;
<a name="l06476"></a>06476     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a>= fg-&gt;<a class="code" href="../../db/d9a/structFileGlobal.html#a466ad2e08958277fb6e2aee7af5dd0e2">curscene</a>;
<a name="l06477"></a>06477     
<a name="l06478"></a>06478     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fg);
<a name="l06479"></a>06479 
<a name="l06480"></a>06480     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a94adc0c6309c7d1034724c76d83a9f37">globalf</a>= bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#af96ecf74af63b83903105e4ffc837fe2">globalf</a>;
<a name="l06481"></a>06481     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a>= bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a18858ade465176be45afbe2a4f50563b">fileflags</a>;
<a name="l06482"></a>06482     
<a name="l06483"></a>06483     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l06484"></a>06484 }
<a name="l06485"></a>06485 
<a name="l06486"></a>06486 <span class="comment">/* note, this has to be kept for reading older files... */</span>
<a name="l06487"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2d766246a05e4ed199fec8899591a544">06487</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2d766246a05e4ed199fec8899591a544">link_global</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd)
<a name="l06488"></a>06488 {
<a name="l06489"></a>06489     
<a name="l06490"></a>06490     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a878e239a8517075578f047442d1aa3d1">curscreen</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a878e239a8517075578f047442d1aa3d1">curscreen</a>);
<a name="l06491"></a>06491     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a>= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a>);
<a name="l06492"></a>06492     <span class="comment">// this happens in files older than 2.35</span>
<a name="l06493"></a>06493     <span class="keywordflow">if</span> (bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06494"></a>06494         <span class="keywordflow">if</span> (bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a878e239a8517075578f047442d1aa3d1">curscreen</a>) bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ab73859890567227939cc23bafc1431a2">curscene</a>= bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a878e239a8517075578f047442d1aa3d1">curscreen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>;
<a name="l06495"></a>06495     }
<a name="l06496"></a>06496 }
<a name="l06497"></a>06497 
<a name="l06498"></a><a class="code" href="../../d0/d12/readfile_8c.html#abc488726672b983d9963cf4a76478d79">06498</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#abc488726672b983d9963cf4a76478d79">vcol_to_fcol</a>(<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l06499"></a>06499 {
<a name="l06500"></a>06500     <a class="code" href="../../d6/da0/structMFace.html">MFace</a> *mface;
<a name="l06501"></a>06501     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *mcol, *mcoln, *mcolmain;
<a name="l06502"></a>06502     <span class="keywordtype">int</span> a;
<a name="l06503"></a>06503 
<a name="l06504"></a>06504     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>==0 || me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l06505"></a>06505 
<a name="l06506"></a>06506     mcoln= mcolmain= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(4*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>, <span class="stringliteral">&quot;mcoln&quot;</span>);
<a name="l06507"></a>06507     mcol = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>;
<a name="l06508"></a>06508     mface= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>;
<a name="l06509"></a>06509     for (a=me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; a&gt;0; a--, mface++) {
<a name="l06510"></a>06510         mcoln[0]= mcol[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#a7bbd2d1ca59c1ed8edd859c0a869081d">v1</a>];
<a name="l06511"></a>06511         mcoln[1]= mcol[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#a3e56f10b57b97167b3db97024920f693">v2</a>];
<a name="l06512"></a>06512         mcoln[2]= mcol[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#ac3bd1c8c8cb82e73685b9bfead2b30da">v3</a>];
<a name="l06513"></a>06513         mcoln[3]= mcol[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a>];
<a name="l06514"></a>06514         mcoln+= 4;
<a name="l06515"></a>06515     }
<a name="l06516"></a>06516 
<a name="l06517"></a>06517     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>);
<a name="l06518"></a>06518     me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>= (<a class="code" href="../../db/d33/structMCol.html">MCol</a> *)mcolmain;
<a name="l06519"></a>06519 }
<a name="l06520"></a>06520 
<a name="l06521"></a><a class="code" href="../../d0/d12/readfile_8c.html#a686dfdd6f292c778af89391076cf0b83">06521</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#a686dfdd6f292c778af89391076cf0b83">map_223_keybd_code_to_224_keybd_code</a>(<span class="keywordtype">int</span> code)
<a name="l06522"></a>06522 {
<a name="l06523"></a>06523     <span class="keywordflow">switch</span> (code) {
<a name="l06524"></a>06524         <span class="keywordflow">case</span> 312:   <span class="keywordflow">return</span> 311; <span class="comment">/* F12KEY */</span>
<a name="l06525"></a>06525         <span class="keywordflow">case</span> 159:   <span class="keywordflow">return</span> 161; <span class="comment">/* PADSLASHKEY */</span>
<a name="l06526"></a>06526         <span class="keywordflow">case</span> 161:   <span class="keywordflow">return</span> 150; <span class="comment">/* PAD0 */</span>
<a name="l06527"></a>06527         <span class="keywordflow">case</span> 154:   <span class="keywordflow">return</span> 151; <span class="comment">/* PAD1 */</span>
<a name="l06528"></a>06528         <span class="keywordflow">case</span> 150:   <span class="keywordflow">return</span> 152; <span class="comment">/* PAD2 */</span>
<a name="l06529"></a>06529         <span class="keywordflow">case</span> 155:   <span class="keywordflow">return</span> 153; <span class="comment">/* PAD3 */</span>
<a name="l06530"></a>06530         <span class="keywordflow">case</span> 151:   <span class="keywordflow">return</span> 154; <span class="comment">/* PAD4 */</span>
<a name="l06531"></a>06531         <span class="keywordflow">case</span> 156:   <span class="keywordflow">return</span> 155; <span class="comment">/* PAD5 */</span>
<a name="l06532"></a>06532         <span class="keywordflow">case</span> 152:   <span class="keywordflow">return</span> 156; <span class="comment">/* PAD6 */</span>
<a name="l06533"></a>06533         <span class="keywordflow">case</span> 157:   <span class="keywordflow">return</span> 157; <span class="comment">/* PAD7 */</span>
<a name="l06534"></a>06534         <span class="keywordflow">case</span> 153:   <span class="keywordflow">return</span> 158; <span class="comment">/* PAD8 */</span>
<a name="l06535"></a>06535         <span class="keywordflow">case</span> 158:   <span class="keywordflow">return</span> 159; <span class="comment">/* PAD9 */</span>
<a name="l06536"></a>06536         <span class="keywordflow">default</span>: <span class="keywordflow">return</span> code;
<a name="l06537"></a>06537     }
<a name="l06538"></a>06538 }
<a name="l06539"></a>06539 
<a name="l06540"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4247b66e4158b2e4d1aaff23f8d93f6c">06540</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4247b66e4158b2e4d1aaff23f8d93f6c">do_version_bone_head_tail_237</a>(<a class="code" href="../../de/de0/structBone.html">Bone</a> *bone)
<a name="l06541"></a>06541 {
<a name="l06542"></a>06542     <a class="code" href="../../de/de0/structBone.html">Bone</a> *child;
<a name="l06543"></a>06543     <span class="keywordtype">float</span> vec[3];
<a name="l06544"></a>06544 
<a name="l06545"></a>06545     <span class="comment">/* head */</span>
<a name="l06546"></a>06546     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bone-&gt;<a class="code" href="../../de/de0/structBone.html#a61421ab678dab0140c6d8022b5166ae8">arm_head</a>, bone-&gt;<a class="code" href="../../de/de0/structBone.html#ac5365d4b57959d83787fe04d546beb1b">arm_mat</a>[3]);
<a name="l06547"></a>06547 
<a name="l06548"></a>06548     <span class="comment">/* tail is in current local coord system */</span>
<a name="l06549"></a>06549     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, bone-&gt;<a class="code" href="../../de/de0/structBone.html#ac5365d4b57959d83787fe04d546beb1b">arm_mat</a>[1]);
<a name="l06550"></a>06550     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, bone-&gt;<a class="code" href="../../de/de0/structBone.html#ab7128f767dae0e0af9129bbdc7f26278">length</a>);
<a name="l06551"></a>06551     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(bone-&gt;<a class="code" href="../../de/de0/structBone.html#a6d1bafbd60d8b4a424cecc108259c781">arm_tail</a>, bone-&gt;<a class="code" href="../../de/de0/structBone.html#a61421ab678dab0140c6d8022b5166ae8">arm_head</a>, vec);
<a name="l06552"></a>06552 
<a name="l06553"></a>06553     <span class="keywordflow">for</span> (child= bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; child; child= child-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>)
<a name="l06554"></a>06554         <a class="code" href="../../d0/d12/readfile_8c.html#a4247b66e4158b2e4d1aaff23f8d93f6c">do_version_bone_head_tail_237</a>(child);
<a name="l06555"></a>06555 }
<a name="l06556"></a>06556 
<a name="l06557"></a><a class="code" href="../../d0/d12/readfile_8c.html#a71aef27d3a39bc5d6f7b7ca74edfc2ca">06557</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a71aef27d3a39bc5d6f7b7ca74edfc2ca">bone_version_238</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l06558"></a>06558 {
<a name="l06559"></a>06559     <a class="code" href="../../de/de0/structBone.html">Bone</a> *bone;
<a name="l06560"></a>06560     
<a name="l06561"></a>06561     <span class="keywordflow">for</span> (bone= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bone; bone= bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>) {
<a name="l06562"></a>06562         <span class="keywordflow">if</span> (bone-&gt;<a class="code" href="../../de/de0/structBone.html#ac603bd97e3cb0f73ec55cc73ee8ac1d0">rad_tail</a>==0.0f &amp;&amp; bone-&gt;<a class="code" href="../../de/de0/structBone.html#aa3a081bf3e8f40876c53868e52174190">rad_head</a>==0.0f) {
<a name="l06563"></a>06563             bone-&gt;<a class="code" href="../../de/de0/structBone.html#aa3a081bf3e8f40876c53868e52174190">rad_head</a>= 0.25f*bone-&gt;<a class="code" href="../../de/de0/structBone.html#ab7128f767dae0e0af9129bbdc7f26278">length</a>;
<a name="l06564"></a>06564             bone-&gt;<a class="code" href="../../de/de0/structBone.html#ac603bd97e3cb0f73ec55cc73ee8ac1d0">rad_tail</a>= 0.1f*bone-&gt;<a class="code" href="../../de/de0/structBone.html#ab7128f767dae0e0af9129bbdc7f26278">length</a>;
<a name="l06565"></a>06565             
<a name="l06566"></a>06566             bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae41dbb73ded85fe0699b8c7283998ea9">dist</a>-= bone-&gt;<a class="code" href="../../de/de0/structBone.html#aa3a081bf3e8f40876c53868e52174190">rad_head</a>;
<a name="l06567"></a>06567             <span class="keywordflow">if</span> (bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae41dbb73ded85fe0699b8c7283998ea9">dist</a>&lt;=0.0f) bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae41dbb73ded85fe0699b8c7283998ea9">dist</a>= 0.0f;
<a name="l06568"></a>06568         }
<a name="l06569"></a>06569         <a class="code" href="../../d0/d12/readfile_8c.html#a71aef27d3a39bc5d6f7b7ca74edfc2ca">bone_version_238</a>(&amp;bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>);
<a name="l06570"></a>06570     }
<a name="l06571"></a>06571 }
<a name="l06572"></a>06572 
<a name="l06573"></a><a class="code" href="../../d0/d12/readfile_8c.html#a01288dafacf4be92ea56be483dcbe874">06573</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a01288dafacf4be92ea56be483dcbe874">bone_version_239</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l06574"></a>06574 {
<a name="l06575"></a>06575     <a class="code" href="../../de/de0/structBone.html">Bone</a> *bone;
<a name="l06576"></a>06576     
<a name="l06577"></a>06577     <span class="keywordflow">for</span> (bone= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bone; bone= bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>) {
<a name="l06578"></a>06578         <span class="keywordflow">if</span> (bone-&gt;<a class="code" href="../../de/de0/structBone.html#a7050e920284a4c3c13fab5c79c141a48">layer</a>==0)
<a name="l06579"></a>06579             bone-&gt;<a class="code" href="../../de/de0/structBone.html#a7050e920284a4c3c13fab5c79c141a48">layer</a>= 1;
<a name="l06580"></a>06580         <a class="code" href="../../d0/d12/readfile_8c.html#a01288dafacf4be92ea56be483dcbe874">bone_version_239</a>(&amp;bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>);
<a name="l06581"></a>06581     }
<a name="l06582"></a>06582 }
<a name="l06583"></a>06583 
<a name="l06584"></a><a class="code" href="../../d0/d12/readfile_8c.html#a334601bb9dce50a8cb5eec3fd53be2f4">06584</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a334601bb9dce50a8cb5eec3fd53be2f4">ntree_version_241</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l06585"></a>06585 {
<a name="l06586"></a>06586     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l06587"></a>06587     
<a name="l06588"></a>06588     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l06589"></a>06589         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l06590"></a>06590             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ae837dcd1a79a0a74c588e72a263f8171">CMP_NODE_BLUR</a>) {
<a name="l06591"></a>06591                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06592"></a>06592                     <a class="code" href="../../d4/d1a/structNodeBlurData.html">NodeBlurData</a> *nbd= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d1a/structNodeBlurData.html">NodeBlurData</a>), <span class="stringliteral">&quot;node blur patch&quot;</span>);
<a name="l06593"></a>06593                     nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#aab6fc9fecf9f22308a14977c0e88a8d7">sizex</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>;
<a name="l06594"></a>06594                     nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#a0dd302ab411a7b3ad4c3f50524ced439">sizey</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad7336ae6ca33289c27905c9516b084e6">custom2</a>;
<a name="l06595"></a>06595                     nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#af6a91e349fb44ac4797a600cf6884c82">filtertype</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a35bd7a756aaee204dea48e5bec554be6">R_FILTER_QUAD</a>;
<a name="l06596"></a>06596                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= nbd;
<a name="l06597"></a>06597                 }
<a name="l06598"></a>06598             }
<a name="l06599"></a>06599             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a136c82d2b597ce06fbf76d303f190ea8">CMP_NODE_VECBLUR</a>) {
<a name="l06600"></a>06600                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06601"></a>06601                     <a class="code" href="../../d4/d1a/structNodeBlurData.html">NodeBlurData</a> *nbd= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d1a/structNodeBlurData.html">NodeBlurData</a>), <span class="stringliteral">&quot;node blur patch&quot;</span>);
<a name="l06602"></a>06602                     nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#a2de30f4e2a2b59f85787cc06cf4d295c">samples</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>;
<a name="l06603"></a>06603                     nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#aa15acc2abd000b54c533318f0569503b">maxspeed</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad7336ae6ca33289c27905c9516b084e6">custom2</a>;
<a name="l06604"></a>06604                     nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#a3cb9ee967ae140c3b86da1f043532c15">fac</a>= 1.0f;
<a name="l06605"></a>06605                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= nbd;
<a name="l06606"></a>06606                 }
<a name="l06607"></a>06607             }
<a name="l06608"></a>06608         }
<a name="l06609"></a>06609     }
<a name="l06610"></a>06610 }
<a name="l06611"></a>06611 
<a name="l06612"></a><a class="code" href="../../d0/d12/readfile_8c.html#a27023e78f913967ce6b61181e41f0d3a">06612</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a27023e78f913967ce6b61181e41f0d3a">ntree_version_242</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l06613"></a>06613 {
<a name="l06614"></a>06614     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l06615"></a>06615     
<a name="l06616"></a>06616     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l06617"></a>06617         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l06618"></a>06618             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a476f11efdda1985393442a971078e187">CMP_NODE_HUE_SAT</a>) {
<a name="l06619"></a>06619                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>) {
<a name="l06620"></a>06620                     <a class="code" href="../../d7/d4c/structNodeHueSat.html">NodeHueSat</a> *nhs= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l06621"></a>06621                     <span class="keywordflow">if</span> (nhs-&gt;<a class="code" href="../../d7/d4c/structNodeHueSat.html#a4b4c7049ed167df60d91e82097a4b9eb">val</a>==0.0f) nhs-&gt;<a class="code" href="../../d7/d4c/structNodeHueSat.html#a4b4c7049ed167df60d91e82097a4b9eb">val</a>= 1.0f;
<a name="l06622"></a>06622                 }
<a name="l06623"></a>06623             }
<a name="l06624"></a>06624         }
<a name="l06625"></a>06625     }
<a name="l06626"></a>06626     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>) {
<a name="l06627"></a>06627         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l06628"></a>06628             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#ae9e5782a089a26df08498b1dab27c65e">SH_NODE_GEOMETRY</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06629"></a>06629                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d83/structNodeGeometry.html">NodeGeometry</a>), <span class="stringliteral">&quot;NodeGeometry&quot;</span>);
<a name="l06630"></a>06630     }
<a name="l06631"></a>06631     
<a name="l06632"></a>06632 }
<a name="l06633"></a>06633 
<a name="l06634"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5e18fb337bdbe887db5233d4f3f08862">06634</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5e18fb337bdbe887db5233d4f3f08862">customdata_version_242</a>(<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l06635"></a>06635 {
<a name="l06636"></a>06636     <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer;
<a name="l06637"></a>06637     <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a> *mtf;
<a name="l06638"></a>06638     <a class="code" href="../../db/d33/structMCol.html">MCol</a> *mcol;
<a name="l06639"></a>06639     <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tf;
<a name="l06640"></a>06640     <span class="keywordtype">int</span> a, mtfacen, mcoln;
<a name="l06641"></a>06641 
<a name="l06642"></a>06642     <span class="keywordflow">if</span> (!me-&gt;vdata.totlayer) {
<a name="l06643"></a>06643         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;vdata, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#aeaf3e06503363d78080a7e479645964d">CD_MVERT</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a2322540667163be1f19150b2ec590291">CD_ASSIGN</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>);
<a name="l06644"></a>06644 
<a name="l06645"></a>06645         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a79dc3a13e37ce76df15ae04453a1f58d">msticky</a>)
<a name="l06646"></a>06646             <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;vdata, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a1f53e1636e6961e60b631943d55cedb5">CD_MSTICKY</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a2322540667163be1f19150b2ec590291">CD_ASSIGN</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a79dc3a13e37ce76df15ae04453a1f58d">msticky</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>);
<a name="l06647"></a>06647         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a>)
<a name="l06648"></a>06648             <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;vdata, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a46e655a33ee15daada322dea203b832a">CD_MDEFORMVERT</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a2322540667163be1f19150b2ec590291">CD_ASSIGN</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a5d3c41c9b430b3ed6e0454a85fea68de">dvert</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>);
<a name="l06649"></a>06649     }
<a name="l06650"></a>06650 
<a name="l06651"></a>06651     <span class="keywordflow">if</span> (!me-&gt;edata.totlayer)
<a name="l06652"></a>06652         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;edata, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a656806a32e0c556097f3fd15e872aa19">CD_MEDGE</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a2322540667163be1f19150b2ec590291">CD_ASSIGN</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a686df37ba278d2bdc080e4d5a0f70dd5">totedge</a>);
<a name="l06653"></a>06653     
<a name="l06654"></a>06654     <span class="keywordflow">if</span> (!me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>) {
<a name="l06655"></a>06655         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#ab3e1f19d7cc2b320286784997edc1519">CD_MFACE</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a2322540667163be1f19150b2ec590291">CD_ASSIGN</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l06656"></a>06656 
<a name="l06657"></a>06657         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l06658"></a>06658             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>)
<a name="l06659"></a>06659                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>);
<a name="l06660"></a>06660 
<a name="l06661"></a>06661             me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>= <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a24cf4db4f470b454282bf931f4aa58ac">CD_MCOL</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a05108c9597b8051246fc8fbc09caa56d">CD_CALLOC</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l06662"></a>06662             me-&gt;<a class="code" href="../../da/d29/structMesh.html#a24605886e11f077cf98ad713b1387483">mtface</a>= <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#af23f4c9ba200ae24e0a1ac80464e7b21">CD_MTFACE</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a05108c9597b8051246fc8fbc09caa56d">CD_CALLOC</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l06663"></a>06663 
<a name="l06664"></a>06664             mtf= me-&gt;<a class="code" href="../../da/d29/structMesh.html#a24605886e11f077cf98ad713b1387483">mtface</a>;
<a name="l06665"></a>06665             mcol= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>;
<a name="l06666"></a>06666             tf= me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>;
<a name="l06667"></a>06667 
<a name="l06668"></a>06668             <span class="keywordflow">for</span> (a=0; a &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; a++, mtf++, tf++, mcol+=4) {
<a name="l06669"></a>06669                 memcpy(mcol, tf-&gt;col, <span class="keyword">sizeof</span>(tf-&gt;col));
<a name="l06670"></a>06670                 memcpy(mtf-&gt;uv, tf-&gt;uv, <span class="keyword">sizeof</span>(tf-&gt;uv));
<a name="l06671"></a>06671 
<a name="l06672"></a>06672                 mtf-&gt;flag= tf-&gt;flag;
<a name="l06673"></a>06673                 mtf-&gt;unwrap= tf-&gt;unwrap;
<a name="l06674"></a>06674                 mtf-&gt;mode= tf-&gt;mode;
<a name="l06675"></a>06675                 mtf-&gt;tile= tf-&gt;tile;
<a name="l06676"></a>06676                 mtf-&gt;tpage= tf-&gt;tpage;
<a name="l06677"></a>06677                 mtf-&gt;transp= tf-&gt;transp;
<a name="l06678"></a>06678             }
<a name="l06679"></a>06679 
<a name="l06680"></a>06680             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>);
<a name="l06681"></a>06681             me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06682"></a>06682         }
<a name="l06683"></a>06683         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>) {
<a name="l06684"></a>06684             me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>= <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a14573f9bdcf9448020a73d96d6e7a51e">CustomData_add_layer</a>(&amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a24cf4db4f470b454282bf931f4aa58ac">CD_MCOL</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a2322540667163be1f19150b2ec590291">CD_ASSIGN</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l06685"></a>06685         }
<a name="l06686"></a>06686     }
<a name="l06687"></a>06687 
<a name="l06688"></a>06688     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l06689"></a>06689         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>);
<a name="l06690"></a>06690         me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06691"></a>06691     }
<a name="l06692"></a>06692 
<a name="l06693"></a>06693     <span class="keywordflow">for</span> (a=0, mtfacen=0, mcoln=0; a &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; a++) {
<a name="l06694"></a>06694         layer= &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[a];
<a name="l06695"></a>06695 
<a name="l06696"></a>06696         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#af23f4c9ba200ae24e0a1ac80464e7b21">CD_MTFACE</a>) {
<a name="l06697"></a>06697             <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>[0] == 0) {
<a name="l06698"></a>06698                 <span class="keywordflow">if</span> (mtfacen == 0) strcpy(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>, <span class="stringliteral">&quot;UVMap&quot;</span>);
<a name="l06699"></a>06699                 <span class="keywordflow">else</span> <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>, <span class="keyword">sizeof</span>(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>), <span class="stringliteral">&quot;UVMap.%.3d&quot;</span>, mtfacen);
<a name="l06700"></a>06700             }
<a name="l06701"></a>06701             mtfacen++;
<a name="l06702"></a>06702         }
<a name="l06703"></a>06703         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a24cf4db4f470b454282bf931f4aa58ac">CD_MCOL</a>) {
<a name="l06704"></a>06704             <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>[0] == 0) {
<a name="l06705"></a>06705                 <span class="keywordflow">if</span> (mcoln == 0) strcpy(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>, <span class="stringliteral">&quot;Col&quot;</span>);
<a name="l06706"></a>06706                 <span class="keywordflow">else</span> <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>, <span class="keyword">sizeof</span>(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#aa8ef26f614b5037233d4ba102e3286d8">name</a>), <span class="stringliteral">&quot;Col.%.3d&quot;</span>, mcoln);
<a name="l06707"></a>06707             }
<a name="l06708"></a>06708             mcoln++;
<a name="l06709"></a>06709         }
<a name="l06710"></a>06710     }
<a name="l06711"></a>06711 
<a name="l06712"></a>06712     <a class="code" href="../../df/d7f/BKE__mesh_8h.html#adc8217e8a6385eec61318e5f7489b462">mesh_update_customdata_pointers</a>(me, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06713"></a>06713 }
<a name="l06714"></a>06714 
<a name="l06715"></a>06715 <span class="comment">/*only copy render texface layer from active*/</span>
<a name="l06716"></a><a class="code" href="../../d0/d12/readfile_8c.html#a47b23c2aa31ffe804ec6bdb76f3379ee">06716</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a47b23c2aa31ffe804ec6bdb76f3379ee">customdata_version_243</a>(<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l06717"></a>06717 {
<a name="l06718"></a>06718     <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer;
<a name="l06719"></a>06719     <span class="keywordtype">int</span> a;
<a name="l06720"></a>06720 
<a name="l06721"></a>06721     <span class="keywordflow">for</span> (a=0; a &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; a++) {
<a name="l06722"></a>06722         layer= &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[a];
<a name="l06723"></a>06723         layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a3dfb0ec9996a27680e060effecd83c6d">active_rnd</a> = layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a7b07435821ccbd6a9a69dd9ae93178f0">active</a>;
<a name="l06724"></a>06724     }
<a name="l06725"></a>06725 }
<a name="l06726"></a>06726 
<a name="l06727"></a>06727 <span class="comment">/* struct NodeImageAnim moved to ImageUser, and we make it default available */</span>
<a name="l06728"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9326461e0726ca7b4e22d7679d6fb4f0">06728</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a9326461e0726ca7b4e22d7679d6fb4f0">do_version_ntree_242_2</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l06729"></a>06729 {
<a name="l06730"></a>06730     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l06731"></a>06731     
<a name="l06732"></a>06732     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l06733"></a>06733         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l06734"></a>06734             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>)) {
<a name="l06735"></a>06735                 <span class="comment">/* only image had storage */</span>
<a name="l06736"></a>06736                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>) {
<a name="l06737"></a>06737                     <a class="code" href="../../d8/d43/structNodeImageAnim.html">NodeImageAnim</a> *nia= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l06738"></a>06738                     <a class="code" href="../../de/d31/structImageUser.html">ImageUser</a> *iuser= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/d31/structImageUser.html">ImageUser</a>), <span class="stringliteral">&quot;ima user node&quot;</span>);
<a name="l06739"></a>06739 
<a name="l06740"></a>06740                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a86cb3e5ecb23a95da68893e43af1c52d">frames</a>= nia-&gt;<a class="code" href="../../d8/d43/structNodeImageAnim.html#afc05ad2c41b1a1b111091fc0a031647f">frames</a>;
<a name="l06741"></a>06741                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a69e7d2b76006d695daeaae9832df2c83">sfra</a>= nia-&gt;<a class="code" href="../../d8/d43/structNodeImageAnim.html#a35721277450fb7f573b85c26a03a5084">sfra</a>;
<a name="l06742"></a>06742                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a576cb0077af7401c73e8634dee46a7f6">offset</a>= nia-&gt;<a class="code" href="../../d8/d43/structNodeImageAnim.html#a3d2f543d34d3c8f5b09bf1bbb4488a64">nr</a>-1;
<a name="l06743"></a>06743                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a22a1db60afef9af31dae54165dce922e">cycl</a>= nia-&gt;<a class="code" href="../../d8/d43/structNodeImageAnim.html#a6173e87eba9087a04c9ca3f5225bf823">cyclic</a>;
<a name="l06744"></a>06744                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#ac4e828b08400ad8bc231081b1ba7969e">fie_ima</a>= 2;
<a name="l06745"></a>06745                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a4c3780a98eb40a0465264303f197ecab">ok</a>= 1;
<a name="l06746"></a>06746                     
<a name="l06747"></a>06747                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= iuser;
<a name="l06748"></a>06748                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nia);
<a name="l06749"></a>06749                 }
<a name="l06750"></a>06750                 <span class="keywordflow">else</span> {
<a name="l06751"></a>06751                     <a class="code" href="../../de/d31/structImageUser.html">ImageUser</a> *iuser= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/d31/structImageUser.html">ImageUser</a>), <span class="stringliteral">&quot;node image user&quot;</span>);
<a name="l06752"></a>06752                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a69e7d2b76006d695daeaae9832df2c83">sfra</a>= 1;
<a name="l06753"></a>06753                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#ac4e828b08400ad8bc231081b1ba7969e">fie_ima</a>= 2;
<a name="l06754"></a>06754                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#a4c3780a98eb40a0465264303f197ecab">ok</a>= 1;
<a name="l06755"></a>06755                 }
<a name="l06756"></a>06756             }
<a name="l06757"></a>06757         }
<a name="l06758"></a>06758     }
<a name="l06759"></a>06759 }
<a name="l06760"></a>06760 
<a name="l06761"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4086085aaff87acde51bbbd8bcd8ec81">06761</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4086085aaff87acde51bbbd8bcd8ec81">ntree_version_245</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l06762"></a>06762 {
<a name="l06763"></a>06763     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l06764"></a>06764     <a class="code" href="../../d2/d59/structNodeTwoFloats.html">NodeTwoFloats</a> *ntf;
<a name="l06765"></a>06765     <a class="code" href="../../d8/d7e/structID.html">ID</a> *nodeid;
<a name="l06766"></a>06766     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *image;
<a name="l06767"></a>06767     <a class="code" href="../../de/d31/structImageUser.html">ImageUser</a> *iuser;
<a name="l06768"></a>06768 
<a name="l06769"></a>06769     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l06770"></a>06770         <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l06771"></a>06771             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a923f1ffc1cd5bad323669f90f22d3a21">CMP_NODE_ALPHAOVER</a>) {
<a name="l06772"></a>06772                 <span class="keywordflow">if</span> (!node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>) {
<a name="l06773"></a>06773                     ntf= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d59/structNodeTwoFloats.html">NodeTwoFloats</a>), <span class="stringliteral">&quot;NodeTwoFloats&quot;</span>);
<a name="l06774"></a>06774                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= ntf;
<a name="l06775"></a>06775                     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>)
<a name="l06776"></a>06776                         ntf-&gt;<a class="code" href="../../d2/d59/structNodeTwoFloats.html#a1798f4dc83c25c1a9ff9514d873aa650">x</a>= 1.0f;
<a name="l06777"></a>06777                 }
<a name="l06778"></a>06778             }
<a name="l06779"></a>06779             
<a name="l06780"></a>06780             <span class="comment">/* fix for temporary flag changes during 245 cycle */</span>
<a name="l06781"></a>06781             nodeid= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l06782"></a>06782             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a> &amp;&amp; nodeid &amp;&amp; <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(nodeid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a564eac75543b047cf8b2b759818529c3">ID_IM</a>) {
<a name="l06783"></a>06783                 image= (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a>*)nodeid;
<a name="l06784"></a>06784                 iuser= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l06785"></a>06785                 <span class="keywordflow">if</span> (iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> &amp; <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>) {
<a name="l06786"></a>06786                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> &amp;= ~<a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>;
<a name="l06787"></a>06787                     iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>;
<a name="l06788"></a>06788                 }
<a name="l06789"></a>06789                 <span class="keywordflow">if</span> (iuser-&gt;<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> &amp; <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>) {
<a name="l06790"></a>06790                     image-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> &amp;= ~<a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>;
<a name="l06791"></a>06791                     image-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>;
<a name="l06792"></a>06792                 }
<a name="l06793"></a>06793             }
<a name="l06794"></a>06794         }
<a name="l06795"></a>06795     }
<a name="l06796"></a>06796 }
<a name="l06797"></a>06797 
<a name="l06798"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1f55543594cf20d9096bb326570ea582">06798</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1f55543594cf20d9096bb326570ea582">idproperties_fix_groups_lengths_recurse</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop)
<a name="l06799"></a>06799 {
<a name="l06800"></a>06800     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *loop;
<a name="l06801"></a>06801     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l06802"></a>06802     
<a name="l06803"></a>06803     <span class="keywordflow">for</span> (loop=prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a656cd00581ccba5491691f77e1b5e6da">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, i=0; loop; loop=loop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a6a1233a8db3fd1ee1b07db13323b65cf">next</a>, i++) {
<a name="l06804"></a>06804         <span class="keywordflow">if</span> (loop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#afc4e09dbab4908446252e5fcb1b3c5ae">type</a> == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abf4b8c1027c684282b432b3c8033a2de">IDP_GROUP</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a1f55543594cf20d9096bb326570ea582">idproperties_fix_groups_lengths_recurse</a>(loop);
<a name="l06805"></a>06805     }
<a name="l06806"></a>06806     
<a name="l06807"></a>06807     <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a> != i) {
<a name="l06808"></a>06808         printf(<span class="stringliteral">&quot;Found and fixed bad id property group length.\n&quot;</span>);
<a name="l06809"></a>06809         prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l06810"></a>06810     }
<a name="l06811"></a>06811 }
<a name="l06812"></a>06812 
<a name="l06813"></a><a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">06813</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> idlist)
<a name="l06814"></a>06814 {
<a name="l06815"></a>06815     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l06816"></a>06816     
<a name="l06817"></a>06817     <span class="keywordflow">for</span> (<span class="keywordtype">id</span>=idlist.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; <span class="keywordtype">id</span>; <span class="keywordtype">id</span>=id-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l06818"></a>06818         <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) {
<a name="l06819"></a>06819             <a class="code" href="../../d0/d12/readfile_8c.html#a1f55543594cf20d9096bb326570ea582">idproperties_fix_groups_lengths_recurse</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>);
<a name="l06820"></a>06820         }
<a name="l06821"></a>06821     }
<a name="l06822"></a>06822 }
<a name="l06823"></a>06823 
<a name="l06824"></a><a class="code" href="../../d0/d12/readfile_8c.html#a73a7c50f17735f433d4f847146842abd">06824</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a73a7c50f17735f433d4f847146842abd">alphasort_version_246</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l06825"></a>06825 {
<a name="l06826"></a>06826     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l06827"></a>06827     <a class="code" href="../../d6/da0/structMFace.html">MFace</a> *mf;
<a name="l06828"></a>06828     <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a> *tf;
<a name="l06829"></a>06829     <span class="keywordtype">int</span> a, b, texalpha;
<a name="l06830"></a>06830 
<a name="l06831"></a>06831     <span class="comment">/* verify we have a tface layer */</span>
<a name="l06832"></a>06832     <span class="keywordflow">for</span> (b=0; b&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; b++)
<a name="l06833"></a>06833         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[b].<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#af23f4c9ba200ae24e0a1ac80464e7b21">CD_MTFACE</a>)
<a name="l06834"></a>06834             <span class="keywordflow">break</span>;
<a name="l06835"></a>06835     
<a name="l06836"></a>06836     <span class="keywordflow">if</span> (b == me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>)
<a name="l06837"></a>06837         <span class="keywordflow">return</span>;
<a name="l06838"></a>06838 
<a name="l06839"></a>06839     <span class="comment">/* if we do, set alpha sort if the game engine did it before */</span>
<a name="l06840"></a>06840     <span class="keywordflow">for</span> (a=0, mf=me-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>; a&lt;me-&gt;totface; a++, mf++) {
<a name="l06841"></a>06841         <span class="keywordflow">if</span> (mf-&gt;<a class="code" href="../../d6/da0/structMFace.html#a9263f86fc8c22b7f355bcade20574047">mat_nr</a> &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>) {
<a name="l06842"></a>06842             ma= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[mf-&gt;<a class="code" href="../../d6/da0/structMFace.html#a9263f86fc8c22b7f355bcade20574047">mat_nr</a>]);
<a name="l06843"></a>06843             texalpha = 0;
<a name="l06844"></a>06844 
<a name="l06845"></a>06845             <span class="comment">/* we can&#39;t read from this if it comes from a library,</span>
<a name="l06846"></a>06846 <span class="comment">             * because direct_link might not have happened on it,</span>
<a name="l06847"></a>06847 <span class="comment">             * so ma-&gt;mtex is not pointing to valid memory yet */</span>
<a name="l06848"></a>06848             <span class="keywordflow">if</span> (ma &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>)
<a name="l06849"></a>06849                 ma= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06850"></a>06850 
<a name="l06851"></a>06851             <span class="keywordflow">for</span> (b=0; ma &amp;&amp; b&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; b++)
<a name="l06852"></a>06852                 <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a> &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[b] &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[b]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa28e86f4cbc4330e5e8518b11dcfbc61">mapto</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a4d4d91166a52a89f90553ad91d3efd06">MAP_ALPHA</a>)
<a name="l06853"></a>06853                     texalpha = 1;
<a name="l06854"></a>06854         }
<a name="l06855"></a>06855         <span class="keywordflow">else</span> {
<a name="l06856"></a>06856             ma= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06857"></a>06857             texalpha = 0;
<a name="l06858"></a>06858         }
<a name="l06859"></a>06859 
<a name="l06860"></a>06860         <span class="keywordflow">for</span> (b=0; b&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; b++) {
<a name="l06861"></a>06861             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[b].<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#af23f4c9ba200ae24e0a1ac80464e7b21">CD_MTFACE</a>) {
<a name="l06862"></a>06862                 tf = ((<a class="code" href="../../da/d7f/structMTFace.html">MTFace</a>*)me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[b].<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>) + a;
<a name="l06863"></a>06863 
<a name="l06864"></a>06864                 tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a11d7f70a4874a3d2ff3a8a2bb3a8cd38">mode</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#afd7c183da145fc4d95b9e1d4861a4b9e">TF_ALPHASORT</a>;
<a name="l06865"></a>06865                 <span class="keywordflow">if</span> (ma &amp;&amp; (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a582c0fe9d451f1c0ede8929648f9dd52">MA_ZTRANSP</a>))
<a name="l06866"></a>06866                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#ae5d76f757d75c711baf7f637cc6c9157">transp</a>, <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9a3562b701a306f562a2831e606203f5">TF_ALPHA</a>, <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ae466a9c8c2f3490a474787d9fa5f26a0">TF_ADD</a>) || (texalpha &amp;&amp; (tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#ae5d76f757d75c711baf7f637cc6c9157">transp</a> != <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ab862979ac94b6922b1c017e355ac1cec">TF_CLIP</a>)))
<a name="l06867"></a>06867                         tf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a11d7f70a4874a3d2ff3a8a2bb3a8cd38">mode</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#afd7c183da145fc4d95b9e1d4861a4b9e">TF_ALPHASORT</a>;
<a name="l06868"></a>06868             }
<a name="l06869"></a>06869         }
<a name="l06870"></a>06870     }
<a name="l06871"></a>06871 }
<a name="l06872"></a>06872 
<a name="l06873"></a>06873 <span class="comment">/* 2.50 patch */</span>
<a name="l06874"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5c5c4c0440afe5d78fe26bbd89450cbc">06874</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5c5c4c0440afe5d78fe26bbd89450cbc">area_add_header_region</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l06875"></a>06875 {
<a name="l06876"></a>06876     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l06877"></a>06877     
<a name="l06878"></a>06878     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06879"></a>06879     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2ab7e0b51ce129a8b256dc705a06c4c4e8">RGN_TYPE_HEADER</a>;
<a name="l06880"></a>06880     <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a229820c70c6ac394347de2e96109f194">HEADERDOWN</a>)
<a name="l06881"></a>06881         ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a898395503574ba73c18b3dbbd96fd107">RGN_ALIGN_BOTTOM</a>;
<a name="l06882"></a>06882     <span class="keywordflow">else</span>
<a name="l06883"></a>06883         ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a96755a55dd96367084937e6448c578c9">RGN_ALIGN_TOP</a>;
<a name="l06884"></a>06884     
<a name="l06885"></a>06885     <span class="comment">/* initialize view2d data for header region, to allow panning */</span>
<a name="l06886"></a>06886     <span class="comment">/* is copy from ui_view2d.c */</span>
<a name="l06887"></a>06887     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a3344658e1cbe75ca187be39f1b34bb75">V2D_LIMITZOOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa366789f03a66ff87dadb3edec360b4b">V2D_KEEPASPECT</a>);
<a name="l06888"></a>06888     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>;
<a name="l06889"></a>06889     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50dda81163a7de1fba335adcbe0c8995">keeptot</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aaec334af82dbd82afbdb5ff95da5219e">V2D_KEEPTOT_STRICT</a>; 
<a name="l06890"></a>06890     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a9e75d9c4cc082bfcdca415b211bdae88">V2D_ALIGN_NO_NEG_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#adef4c229c91733757ad48327e398f168">V2D_ALIGN_NO_NEG_Y</a>;
<a name="l06891"></a>06891     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa75dca45404bbc0929370ff2eb226acf">V2D_PIXELOFS_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a6748d8818e7a0e9d1c4b00f6c246667c">V2D_PIXELOFS_Y</a>);
<a name="l06892"></a>06892 }
<a name="l06893"></a>06893 
<a name="l06894"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2181aed3654255aec35f9ceb3d8f80ee">06894</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2181aed3654255aec35f9ceb3d8f80ee">sequencer_init_preview_region</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>* ar)
<a name="l06895"></a>06895 {
<a name="l06896"></a>06896     <span class="comment">// XXX a bit ugly still, copied from space_sequencer</span>
<a name="l06897"></a>06897     <span class="comment">/* NOTE: if you change values here, also change them in space_sequencer.c, sequencer_new */</span>
<a name="l06898"></a>06898     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a9c229d954ba6692b9ea76f4a444a6ad5">RGN_TYPE_PREVIEW</a>;
<a name="l06899"></a>06899     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a96755a55dd96367084937e6448c578c9">RGN_ALIGN_TOP</a>;
<a name="l06900"></a>06900     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a> |= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l06901"></a>06901     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa366789f03a66ff87dadb3edec360b4b">V2D_KEEPASPECT</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a12307a21b2037e2c990c4076cfcde78b">V2D_KEEPZOOM</a>;
<a name="l06902"></a>06902     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= 0.00001f;
<a name="l06903"></a>06903     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= 100000.0f;
<a name="l06904"></a>06904     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = -960.0f; <span class="comment">/* 1920 width centered */</span>
<a name="l06905"></a>06905     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = -540.0f; <span class="comment">/* 1080 height centered */</span>
<a name="l06906"></a>06906     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = 960.0f;
<a name="l06907"></a>06907     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 540.0f;
<a name="l06908"></a>06908     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[0]= 0.0f;
<a name="l06909"></a>06909     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1]= 0.0f;
<a name="l06910"></a>06910     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[0]= 12000.0f;
<a name="l06911"></a>06911     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[1]= 12000.0f;
<a name="l06912"></a>06912     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>;
<a name="l06913"></a>06913     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a872efafdd8879adecd9cbcd47f0e76ed">V2D_ALIGN_FREE</a>; <span class="comment">// (V2D_ALIGN_NO_NEG_X|V2D_ALIGN_NO_NEG_Y);</span>
<a name="l06914"></a>06914     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50dda81163a7de1fba335adcbe0c8995">keeptot</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a94e15ed9a178191749fbd17513b0d463">V2D_KEEPTOT_FREE</a>;
<a name="l06915"></a>06915 }
<a name="l06916"></a>06916 
<a name="l06917"></a>06917 <span class="comment">/* 2.50 patch */</span>
<a name="l06918"></a><a class="code" href="../../d0/d12/readfile_8c.html#a66b47e5461e0fee70dcdc96d2368cf7e">06918</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a66b47e5461e0fee70dcdc96d2368cf7e">area_add_window_regions</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l06919"></a>06919 {
<a name="l06920"></a>06920     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l06921"></a>06921     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar_main;
<a name="l06922"></a>06922 
<a name="l06923"></a>06923     <span class="keywordflow">if</span> (sl) {
<a name="l06924"></a>06924         <span class="comment">/* first channels for ipo action nla... */</span>
<a name="l06925"></a>06925         <span class="keywordflow">switch</span>(sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>) {
<a name="l06926"></a>06926             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>:
<a name="l06927"></a>06927                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l06928"></a>06928                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06929"></a>06929                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a065baa7d4590b7259b08da664c894389">RGN_TYPE_CHANNELS</a>;
<a name="l06930"></a>06930                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af406a205a9600f7ffa7e100511c9643a">RGN_ALIGN_LEFT</a>; 
<a name="l06931"></a>06931                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>);
<a name="l06932"></a>06932                 
<a name="l06933"></a>06933                     <span class="comment">// for some reason, this doesn&#39;t seem to go auto like for NLA...</span>
<a name="l06934"></a>06934                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l06935"></a>06935                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06936"></a>06936                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a1324ee7084207af80aad66c626841e8c">RGN_TYPE_UI</a>;
<a name="l06937"></a>06937                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a26c26121325540375f6fb076bee0fb59">RGN_ALIGN_RIGHT</a>;
<a name="l06938"></a>06938                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>;
<a name="l06939"></a>06939                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l06940"></a>06940                 <span class="keywordflow">break</span>;
<a name="l06941"></a>06941                 
<a name="l06942"></a>06942             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>:
<a name="l06943"></a>06943                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l06944"></a>06944                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06945"></a>06945                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a065baa7d4590b7259b08da664c894389">RGN_TYPE_CHANNELS</a>;
<a name="l06946"></a>06946                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af406a205a9600f7ffa7e100511c9643a">RGN_ALIGN_LEFT</a>;
<a name="l06947"></a>06947                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>;
<a name="l06948"></a>06948                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a2147102666411f36071112bdd9410ee3">V2D_VIEWSYNC_AREA_VERTICAL</a>;
<a name="l06949"></a>06949                 <span class="keywordflow">break</span>;
<a name="l06950"></a>06950                 
<a name="l06951"></a>06951             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>:
<a name="l06952"></a>06952                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l06953"></a>06953                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06954"></a>06954                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a065baa7d4590b7259b08da664c894389">RGN_TYPE_CHANNELS</a>;
<a name="l06955"></a>06955                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af406a205a9600f7ffa7e100511c9643a">RGN_ALIGN_LEFT</a>;
<a name="l06956"></a>06956                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>;
<a name="l06957"></a>06957                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a2147102666411f36071112bdd9410ee3">V2D_VIEWSYNC_AREA_VERTICAL</a>;
<a name="l06958"></a>06958                 
<a name="l06959"></a>06959                     <span class="comment">// for some reason, some files still don&#39;t get this auto</span>
<a name="l06960"></a>06960                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l06961"></a>06961                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06962"></a>06962                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a1324ee7084207af80aad66c626841e8c">RGN_TYPE_UI</a>;
<a name="l06963"></a>06963                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a26c26121325540375f6fb076bee0fb59">RGN_ALIGN_RIGHT</a>;
<a name="l06964"></a>06964                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>;
<a name="l06965"></a>06965                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l06966"></a>06966                 <span class="keywordflow">break</span>;
<a name="l06967"></a>06967                 
<a name="l06968"></a>06968             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>:
<a name="l06969"></a>06969                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;nodetree area for node&quot;</span>);
<a name="l06970"></a>06970                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06971"></a>06971                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a1324ee7084207af80aad66c626841e8c">RGN_TYPE_UI</a>;
<a name="l06972"></a>06972                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af406a205a9600f7ffa7e100511c9643a">RGN_ALIGN_LEFT</a>;
<a name="l06973"></a>06973                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>);
<a name="l06974"></a>06974                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a2147102666411f36071112bdd9410ee3">V2D_VIEWSYNC_AREA_VERTICAL</a>;
<a name="l06975"></a>06975                 <span class="comment">/* temporarily hide it */</span>
<a name="l06976"></a>06976                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l06977"></a>06977                 <span class="keywordflow">break</span>;
<a name="l06978"></a>06978             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>:
<a name="l06979"></a>06979                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;nodetree area for node&quot;</span>);
<a name="l06980"></a>06980                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06981"></a>06981                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a065baa7d4590b7259b08da664c894389">RGN_TYPE_CHANNELS</a>;
<a name="l06982"></a>06982                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af406a205a9600f7ffa7e100511c9643a">RGN_ALIGN_LEFT</a>;
<a name="l06983"></a>06983 
<a name="l06984"></a>06984                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;ui area for file&quot;</span>);
<a name="l06985"></a>06985                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l06986"></a>06986                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a1324ee7084207af80aad66c626841e8c">RGN_TYPE_UI</a>;
<a name="l06987"></a>06987                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a96755a55dd96367084937e6448c578c9">RGN_ALIGN_TOP</a>;
<a name="l06988"></a>06988                 <span class="keywordflow">break</span>;
<a name="l06989"></a>06989             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>:
<a name="l06990"></a>06990                 ar_main = (<a class="code" href="../../da/d23/structARegion.html">ARegion</a>*)lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06991"></a>06991                 for (; ar_main; ar_main = ar_main-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l06992"></a>06992                     <span class="keywordflow">if</span> (ar_main-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>)
<a name="l06993"></a>06993                         <span class="keywordflow">break</span>;
<a name="l06994"></a>06994                 }
<a name="l06995"></a>06995                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;preview area for sequencer&quot;</span>);
<a name="l06996"></a>06996                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(lb, ar_main, ar);
<a name="l06997"></a>06997                 <a class="code" href="../../d0/d12/readfile_8c.html#a2181aed3654255aec35f9ceb3d8f80ee">sequencer_init_preview_region</a>(ar);
<a name="l06998"></a>06998                 <span class="keywordflow">break</span>;
<a name="l06999"></a>06999             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>:
<a name="l07000"></a>07000                 <span class="comment">/* toolbar */</span>
<a name="l07001"></a>07001                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;toolbar for view3d&quot;</span>);
<a name="l07002"></a>07002                 
<a name="l07003"></a>07003                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l07004"></a>07004                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2ad274603e567ada5179c2a7a3d5fb99f4">RGN_TYPE_TOOLS</a>;
<a name="l07005"></a>07005                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af406a205a9600f7ffa7e100511c9643a">RGN_ALIGN_LEFT</a>;
<a name="l07006"></a>07006                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l07007"></a>07007                 
<a name="l07008"></a>07008                 <span class="comment">/* tool properties */</span>
<a name="l07009"></a>07009                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;tool properties for view3d&quot;</span>);
<a name="l07010"></a>07010                 
<a name="l07011"></a>07011                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l07012"></a>07012                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2aef41b39373a2eb1b6497f25ce95c05e3">RGN_TYPE_TOOL_PROPS</a>;
<a name="l07013"></a>07013                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a898395503574ba73c18b3dbbd96fd107">RGN_ALIGN_BOTTOM</a>|<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a8a5e3e090a3f96966048a2082a3ad8bb">RGN_SPLIT_PREV</a>;
<a name="l07014"></a>07014                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l07015"></a>07015                 
<a name="l07016"></a>07016                 <span class="comment">/* buttons/list view */</span>
<a name="l07017"></a>07017                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;buttons for view3d&quot;</span>);
<a name="l07018"></a>07018                 
<a name="l07019"></a>07019                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l07020"></a>07020                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a1324ee7084207af80aad66c626841e8c">RGN_TYPE_UI</a>;
<a name="l07021"></a>07021                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a26c26121325540375f6fb076bee0fb59">RGN_ALIGN_RIGHT</a>;
<a name="l07022"></a>07022                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f2584ecbfa3cdef91e6e2f740975ceb">flag</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a45948a913af510c6e98f8d448ac360eb">RGN_FLAG_HIDDEN</a>;
<a name="l07023"></a>07023 <span class="preprocessor">#if 0</span>
<a name="l07024"></a>07024 <span class="preprocessor"></span>            <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>:
<a name="l07025"></a>07025                 <span class="comment">/* context UI region */</span>
<a name="l07026"></a>07026                 ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l07027"></a>07027                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l07028"></a>07028                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a1324ee7084207af80aad66c626841e8c">RGN_TYPE_UI</a>;
<a name="l07029"></a>07029                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a8c70a85ae4e6eee036ee6f58f246876d">alignment</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a26c26121325540375f6fb076bee0fb59">RGN_ALIGN_RIGHT</a>;
<a name="l07030"></a>07030                 
<a name="l07031"></a>07031                 <span class="keywordflow">break</span>;
<a name="l07032"></a>07032 <span class="preprocessor">#endif</span>
<a name="l07033"></a>07033 <span class="preprocessor"></span>        }
<a name="l07034"></a>07034     }
<a name="l07035"></a>07035 
<a name="l07036"></a>07036     <span class="comment">/* main region */</span>
<a name="l07037"></a>07037     ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;area region from do_versions&quot;</span>);
<a name="l07038"></a>07038     
<a name="l07039"></a>07039     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, ar);
<a name="l07040"></a>07040     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>;
<a name="l07041"></a>07041     
<a name="l07042"></a>07042     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>;
<a name="l07043"></a>07043     
<a name="l07044"></a>07044     <span class="keywordflow">if</span> (sl) {
<a name="l07045"></a>07045         <span class="comment">/* if active spacetype has view2d data, copy that over to main region */</span>
<a name="l07046"></a>07046         <span class="comment">/* and we split view3d */</span>
<a name="l07047"></a>07047         <span class="keywordflow">switch</span>(sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>) {
<a name="l07048"></a>07048             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>:
<a name="l07049"></a>07049                 <a class="code" href="../../d0/d12/readfile_8c.html#a90c2c40f6a0578002f57f0b6b426f0b9">view3d_split_250</a>((<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl, lb);
<a name="l07050"></a>07050                 <span class="keywordflow">break</span>;      
<a name="l07051"></a>07051                         
<a name="l07052"></a>07052             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>:
<a name="l07053"></a>07053             {
<a name="l07054"></a>07054                 <a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *soops= (<a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *)sl;
<a name="l07055"></a>07055                 
<a name="l07056"></a>07056                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;soops-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07057"></a>07057                 
<a name="l07058"></a>07058                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp;= ~<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad1bc8ccf189da1c9de7471ee64102862">V2D_SCROLL_LEFT</a>;
<a name="l07059"></a>07059                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a28c89a58660b4bd5a5b78223315fd6d6">V2D_SCROLL_BOTTOM_O</a>);
<a name="l07060"></a>07060                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a9e75d9c4cc082bfcdca415b211bdae88">V2D_ALIGN_NO_NEG_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>);
<a name="l07061"></a>07061                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa366789f03a66ff87dadb3edec360b4b">V2D_KEEPASPECT</a>);
<a name="l07062"></a>07062                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50dda81163a7de1fba335adcbe0c8995">keeptot</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aaec334af82dbd82afbdb5ff95da5219e">V2D_KEEPTOT_STRICT</a>;
<a name="l07063"></a>07063                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= 1.0f;
<a name="l07064"></a>07064                 <span class="comment">//ar-&gt;v2d.flag |= V2D_IS_INITIALISED;</span>
<a name="l07065"></a>07065             }
<a name="l07066"></a>07066                 <span class="keywordflow">break</span>;
<a name="l07067"></a>07067             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca51011faadfd7d38d3d7a810c600e9458">SPACE_TIME</a>:
<a name="l07068"></a>07068             {
<a name="l07069"></a>07069                 <a class="code" href="../../d5/d0c/structSpaceTime.html">SpaceTime</a> *stime= (<a class="code" href="../../d5/d0c/structSpaceTime.html">SpaceTime</a> *)sl;
<a name="l07070"></a>07070                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;stime-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07071"></a>07071                 
<a name="l07072"></a>07072                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aea84ae057740160cfff79dc8997dc47b">V2D_SCROLL_SCALE_HORIZONTAL</a>);
<a name="l07073"></a>07073                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#adef4c229c91733757ad48327e398f168">V2D_ALIGN_NO_NEG_Y</a>;
<a name="l07074"></a>07074                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a7908acd6aefdcbd62fb675c848be69bd">V2D_LOCKOFS_Y</a>;
<a name="l07075"></a>07075                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>;
<a name="l07076"></a>07076                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = -10.0;
<a name="l07077"></a>07077                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1]= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[1]= 20.0;
<a name="l07078"></a>07078             }
<a name="l07079"></a>07079                 <span class="keywordflow">break</span>;
<a name="l07080"></a>07080             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>:
<a name="l07081"></a>07081             {
<a name="l07082"></a>07082                 <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)sl;
<a name="l07083"></a>07083                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;sipo-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07084"></a>07084                 
<a name="l07085"></a>07085                 <span class="comment">/* init mainarea view2d */</span>
<a name="l07086"></a>07086                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aea84ae057740160cfff79dc8997dc47b">V2D_SCROLL_SCALE_HORIZONTAL</a>);
<a name="l07087"></a>07087                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad1bc8ccf189da1c9de7471ee64102862">V2D_SCROLL_LEFT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a232ca231c26fa4332850f8268cbd0e0d">V2D_SCROLL_SCALE_VERTICAL</a>);
<a name="l07088"></a>07088                 
<a name="l07089"></a>07089                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[0]= FLT_MIN;
<a name="l07090"></a>07090                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1]= FLT_MIN;
<a name="l07091"></a>07091                 
<a name="l07092"></a>07092                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[0]= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>;
<a name="l07093"></a>07093                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[1]= <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l07094"></a>07094                 
<a name="l07095"></a>07095                 <span class="comment">//ar-&gt;v2d.flag |= V2D_IS_INITIALISED;</span>
<a name="l07096"></a>07096                 <span class="keywordflow">break</span>;
<a name="l07097"></a>07097             }
<a name="l07098"></a>07098             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>:
<a name="l07099"></a>07099             {
<a name="l07100"></a>07100                 <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l07101"></a>07101                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;snla-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07102"></a>07102                 
<a name="l07103"></a>07103                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = (float)(-sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9bf030bfae8e6e6ff63acd63f0d499df">winy</a>)/3.0f;
<a name="l07104"></a>07104                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0.0f;
<a name="l07105"></a>07105                 
<a name="l07106"></a>07106                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aea84ae057740160cfff79dc8997dc47b">V2D_SCROLL_SCALE_HORIZONTAL</a>);
<a name="l07107"></a>07107                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>);
<a name="l07108"></a>07108                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>;
<a name="l07109"></a>07109                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a2147102666411f36071112bdd9410ee3">V2D_VIEWSYNC_AREA_VERTICAL</a>;
<a name="l07110"></a>07110                 <span class="keywordflow">break</span>;
<a name="l07111"></a>07111             }
<a name="l07112"></a>07112             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>:
<a name="l07113"></a>07113             {
<a name="l07114"></a>07114                 <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)sl;
<a name="l07115"></a>07115                 
<a name="l07116"></a>07116                 <span class="comment">/* we totally reinit the view for the Action Editor, as some old instances had some weird cruft set */</span>
<a name="l07117"></a>07117                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = -20.0f;
<a name="l07118"></a>07118                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = (float)(-sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9bf030bfae8e6e6ff63acd63f0d499df">winy</a>)/3.0f;
<a name="l07119"></a>07119                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = (float)((sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a8875e00cdc1e130b8267c63b9cc0558e">winx</a> &gt; 120)? (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a8875e00cdc1e130b8267c63b9cc0558e">winx</a>) : 120);
<a name="l07120"></a>07120                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0.0f;
<a name="l07121"></a>07121                 
<a name="l07122"></a>07122                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>;
<a name="l07123"></a>07123                 
<a name="l07124"></a>07124                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[0]= 0.0f;
<a name="l07125"></a>07125                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1]= 0.0f;
<a name="l07126"></a>07126                 
<a name="l07127"></a>07127                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[0]= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>;
<a name="l07128"></a>07128                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a682fdbe0e2e02fc781631725ca7eb6cf">max</a>[1]= <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l07129"></a>07129 
<a name="l07130"></a>07130                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= 0.01f;
<a name="l07131"></a>07131                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= 50;
<a name="l07132"></a>07132                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aea84ae057740160cfff79dc8997dc47b">V2D_SCROLL_SCALE_HORIZONTAL</a>);
<a name="l07133"></a>07133                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>);
<a name="l07134"></a>07134                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>;
<a name="l07135"></a>07135                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>;
<a name="l07136"></a>07136                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a2147102666411f36071112bdd9410ee3">V2D_VIEWSYNC_AREA_VERTICAL</a>;
<a name="l07137"></a>07137                 
<a name="l07138"></a>07138                 <span class="comment">/* for old files with ShapeKey editors open + an action set, clear the action as </span>
<a name="l07139"></a>07139 <span class="comment">                 * it doesn&#39;t make sense in the new system (i.e. violates concept that ShapeKey edit</span>
<a name="l07140"></a>07140 <span class="comment">                 * only shows ShapeKey-rooted actions only)</span>
<a name="l07141"></a>07141 <span class="comment">                 */</span>
<a name="l07142"></a>07142                 <span class="keywordflow">if</span> (saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a> == <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a595af644741730a924d0d4d124eea926">SACTCONT_SHAPEKEY</a>)
<a name="l07143"></a>07143                     saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07144"></a>07144                 <span class="keywordflow">break</span>;
<a name="l07145"></a>07145             }
<a name="l07146"></a>07146             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>:
<a name="l07147"></a>07147             {
<a name="l07148"></a>07148                 <a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *sseq= (<a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *)sl;
<a name="l07149"></a>07149                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;sseq-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07150"></a>07150                 
<a name="l07151"></a>07151                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aea84ae057740160cfff79dc8997dc47b">V2D_SCROLL_SCALE_HORIZONTAL</a>);
<a name="l07152"></a>07152                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad1bc8ccf189da1c9de7471ee64102862">V2D_SCROLL_LEFT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a232ca231c26fa4332850f8268cbd0e0d">V2D_SCROLL_SCALE_VERTICAL</a>);
<a name="l07153"></a>07153                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#adef4c229c91733757ad48327e398f168">V2D_ALIGN_NO_NEG_Y</a>;
<a name="l07154"></a>07154                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a0c6ad4ab28f9e6cc5b9fd9e3aafafbac">flag</a> |= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a39f3bc5c996c526f80c092ba7628b129">V2D_IS_INITIALISED</a>;
<a name="l07155"></a>07155                 <span class="keywordflow">break</span>;
<a name="l07156"></a>07156             }
<a name="l07157"></a>07157             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>:
<a name="l07158"></a>07158             {
<a name="l07159"></a>07159                 <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= (<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *)sl;
<a name="l07160"></a>07160                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;snode-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07161"></a>07161                 
<a name="l07162"></a>07162                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>);
<a name="l07163"></a>07163                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a3344658e1cbe75ca187be39f1b34bb75">V2D_LIMITZOOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa366789f03a66ff87dadb3edec360b4b">V2D_KEEPASPECT</a>;
<a name="l07164"></a>07164                 <span class="keywordflow">break</span>;
<a name="l07165"></a>07165             }
<a name="l07166"></a>07166             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>:
<a name="l07167"></a>07167             {
<a name="l07168"></a>07168                 <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts= (<a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *)sl;
<a name="l07169"></a>07169                 memcpy(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, &amp;sbuts-&gt;v2d, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a>));
<a name="l07170"></a>07170                 
<a name="l07171"></a>07171                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> |= (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a>); 
<a name="l07172"></a>07172                 <span class="keywordflow">break</span>;
<a name="l07173"></a>07173             }
<a name="l07174"></a>07174             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>:
<a name="l07175"></a>07175              {
<a name="l07176"></a>07176                 <span class="comment">// SpaceFile *sfile= (SpaceFile *)sl;</span>
<a name="l07177"></a>07177                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = 0;
<a name="l07178"></a>07178                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>;
<a name="l07179"></a>07179                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>;
<a name="l07180"></a>07180                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>;
<a name="l07181"></a>07181                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>;
<a name="l07182"></a>07182                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a28c89a58660b4bd5a5b78223315fd6d6">V2D_SCROLL_BOTTOM_O</a>);
<a name="l07183"></a>07183                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a9e75d9c4cc082bfcdca415b211bdae88">V2D_ALIGN_NO_NEG_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad925b1ac58342a23b616de1720e59d64">V2D_ALIGN_NO_POS_Y</a>);
<a name="l07184"></a>07184                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a3344658e1cbe75ca187be39f1b34bb75">V2D_LIMITZOOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa366789f03a66ff87dadb3edec360b4b">V2D_KEEPASPECT</a>);
<a name="l07185"></a>07185                 <span class="keywordflow">break</span>;
<a name="l07186"></a>07186             }
<a name="l07187"></a>07187             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02011ff3a4d991adb9b4c9360dd8b1c3">SPACE_TEXT</a>:
<a name="l07188"></a>07188             {
<a name="l07189"></a>07189                 <a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *st= (<a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *)sl;
<a name="l07190"></a>07190                 st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#a4594c81bc6838d5ed6505f59a835398b">flags</a> |= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a6e46c9d090ee4f2aafcecda7b9597122">ST_FIND_WRAP</a>;
<a name="l07191"></a>07191             }
<a name="l07192"></a>07192                 <span class="comment">//case SPACE_XXX: // FIXME... add other ones</span>
<a name="l07193"></a>07193                 <span class="comment">//  memcpy(&amp;ar-&gt;v2d, &amp;((SpaceXxx *)sl)-&gt;v2d, sizeof(View2D));</span>
<a name="l07194"></a>07194                 <span class="comment">//  break;</span>
<a name="l07195"></a>07195         }
<a name="l07196"></a>07196     }
<a name="l07197"></a>07197 }
<a name="l07198"></a>07198 
<a name="l07199"></a><a class="code" href="../../d0/d12/readfile_8c.html#a34234d79051c3c1e0b29e0baeb5ed024">07199</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a34234d79051c3c1e0b29e0baeb5ed024">do_versions_windowmanager_2_50</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen)
<a name="l07200"></a>07200 {
<a name="l07201"></a>07201     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l07202"></a>07202     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l07203"></a>07203     
<a name="l07204"></a>07204     <span class="comment">/* add regions */</span>
<a name="l07205"></a>07205     <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l07206"></a>07206         
<a name="l07207"></a>07207         <span class="comment">/* we keep headertype variable to convert old files only */</span>
<a name="l07208"></a>07208         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>)
<a name="l07209"></a>07209             <a class="code" href="../../d0/d12/readfile_8c.html#a5c5c4c0440afe5d78fe26bbd89450cbc">area_add_header_region</a>(sa, &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>);
<a name="l07210"></a>07210         
<a name="l07211"></a>07211         <a class="code" href="../../d0/d12/readfile_8c.html#a66b47e5461e0fee70dcdc96d2368cf7e">area_add_window_regions</a>(sa, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>);
<a name="l07212"></a>07212         
<a name="l07213"></a>07213         <span class="comment">/* space imageselect is deprecated */</span>
<a name="l07214"></a>07214         <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l07215"></a>07215             <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca315d469d135c2a224be48f56bbe8c9d9">SPACE_IMASEL</a>)
<a name="l07216"></a>07216                 sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa8e058bca40351efac8630cc6277e870">SPACE_EMPTY</a>; <span class="comment">/* spacedata then matches */</span>
<a name="l07217"></a>07217         }
<a name="l07218"></a>07218         
<a name="l07219"></a>07219         <span class="comment">/* space sound is deprecated */</span>
<a name="l07220"></a>07220         <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l07221"></a>07221             <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca694150f5de7c1f6eeadb6083f4b7af39">SPACE_SOUND</a>)
<a name="l07222"></a>07222                 sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa8e058bca40351efac8630cc6277e870">SPACE_EMPTY</a>; <span class="comment">/* spacedata then matches */</span>
<a name="l07223"></a>07223         }
<a name="l07224"></a>07224         
<a name="l07225"></a>07225         <span class="comment">/* it seems to be possible in 2.5 to have this saved, filewindow probably */</span>
<a name="l07226"></a>07226         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#adb10112c8e3abb732123a775ebbf7b93">butspacetype</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>;
<a name="l07227"></a>07227         
<a name="l07228"></a>07228         <span class="comment">/* pushed back spaces also need regions! */</span>
<a name="l07229"></a>07229         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l07230"></a>07230             sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07231"></a>07231             <span class="keywordflow">for</span> (sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l07232"></a>07232                 <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>)
<a name="l07233"></a>07233                     <a class="code" href="../../d0/d12/readfile_8c.html#a5c5c4c0440afe5d78fe26bbd89450cbc">area_add_header_region</a>(sa, &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>);
<a name="l07234"></a>07234                 <a class="code" href="../../d0/d12/readfile_8c.html#a66b47e5461e0fee70dcdc96d2368cf7e">area_add_window_regions</a>(sa, sl, &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>);
<a name="l07235"></a>07235             }
<a name="l07236"></a>07236         }
<a name="l07237"></a>07237     }
<a name="l07238"></a>07238 }
<a name="l07239"></a>07239 
<a name="l07240"></a><a class="code" href="../../d0/d12/readfile_8c.html#a66d6ea3bc95509364970a96998109c25">07240</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a66d6ea3bc95509364970a96998109c25">versions_gpencil_add_main</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l07241"></a>07241 {
<a name="l07242"></a>07242     
<a name="l07243"></a>07243     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb, <span class="keywordtype">id</span>);
<a name="l07244"></a>07244     <span class="keywordtype">id</span>-&gt;us= 1;
<a name="l07245"></a>07245     <span class="keywordtype">id</span>-&gt;flag= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7a490f7c486f67fa46961f920fc8e26">LIB_FAKEUSER</a>;
<a name="l07246"></a>07246     *( (<span class="keywordtype">short</span> *)id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> )= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2df65579fd9eb1398862a7e915de5dc2">ID_GD</a>;
<a name="l07247"></a>07247     
<a name="l07248"></a>07248     <a class="code" href="../../d8/db1/BKE__library_8h.html#a03950f3c19795a949723a1069015d10d">new_id</a>(lb, <span class="keywordtype">id</span>, name);
<a name="l07249"></a>07249     <span class="comment">/* alphabetic insterion: is in new_id */</span>
<a name="l07250"></a>07250     
<a name="l07251"></a>07251     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l07252"></a>07252         printf(<span class="stringliteral">&quot;Converted GPencil to ID: %s\n&quot;</span>, id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l07253"></a>07253 }
<a name="l07254"></a>07254 
<a name="l07255"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa42b2524cbe854c45510e8e0e9b1b9e6">07255</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa42b2524cbe854c45510e8e0e9b1b9e6">do_versions_gpencil_2_50</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *main, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen)
<a name="l07256"></a>07256 {
<a name="l07257"></a>07257     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l07258"></a>07258     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l07259"></a>07259     
<a name="l07260"></a>07260     <span class="comment">/* add regions */</span>
<a name="l07261"></a>07261     <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l07262"></a>07262         <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l07263"></a>07263             <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l07264"></a>07264                 <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l07265"></a>07265                 <span class="keywordflow">if</span> (v3d-&gt;gpd) {
<a name="l07266"></a>07266                     <a class="code" href="../../d0/d12/readfile_8c.html#a66d6ea3bc95509364970a96998109c25">versions_gpencil_add_main</a>(&amp;main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4a86abfca9ece5bbb40d490b426da469">gpencil</a>, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)v3d-&gt;gpd, <span class="stringliteral">&quot;GPencil View3D&quot;</span>);
<a name="l07267"></a>07267                     v3d-&gt;gpd= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07268"></a>07268                 }
<a name="l07269"></a>07269             }
<a name="l07270"></a>07270             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l07271"></a>07271                 <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= (<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *)sl;
<a name="l07272"></a>07272                 <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>) {
<a name="l07273"></a>07273                     <a class="code" href="../../d0/d12/readfile_8c.html#a66d6ea3bc95509364970a96998109c25">versions_gpencil_add_main</a>(&amp;main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4a86abfca9ece5bbb40d490b426da469">gpencil</a>, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>, <span class="stringliteral">&quot;GPencil Node&quot;</span>);
<a name="l07274"></a>07274                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a432693e1d0bf5dd3a5c4e1c5523b9680">gpd</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07275"></a>07275                 }
<a name="l07276"></a>07276             }
<a name="l07277"></a>07277             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l07278"></a>07278                 <a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *sseq= (<a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *)sl;
<a name="l07279"></a>07279                 <span class="keywordflow">if</span> (sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>) {
<a name="l07280"></a>07280                     <a class="code" href="../../d0/d12/readfile_8c.html#a66d6ea3bc95509364970a96998109c25">versions_gpencil_add_main</a>(&amp;main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4a86abfca9ece5bbb40d490b426da469">gpencil</a>, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>, <span class="stringliteral">&quot;GPencil Node&quot;</span>);
<a name="l07281"></a>07281                     sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a8a96fdceb21976c2842a48db16cd7d26">gpd</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07282"></a>07282                 }
<a name="l07283"></a>07283             }
<a name="l07284"></a>07284             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l07285"></a>07285                 <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l07286"></a>07286 <span class="preprocessor">#if 0           </span><span class="comment">/* see comment on r28002 */</span>
<a name="l07287"></a>07287                 <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>) {
<a name="l07288"></a>07288                     <a class="code" href="../../d0/d12/readfile_8c.html#a66d6ea3bc95509364970a96998109c25">versions_gpencil_add_main</a>(&amp;main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4a86abfca9ece5bbb40d490b426da469">gpencil</a>, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>, <span class="stringliteral">&quot;GPencil Image&quot;</span>);
<a name="l07289"></a>07289                     sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07290"></a>07290                 }
<a name="l07291"></a>07291 <span class="preprocessor">#else</span>
<a name="l07292"></a>07292 <span class="preprocessor"></span>                sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abb678aff58f44c6ea4058a1e2201daf9">gpd</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07293"></a>07293 <span class="preprocessor">#endif</span>
<a name="l07294"></a>07294 <span class="preprocessor"></span>            }
<a name="l07295"></a>07295         }
<a name="l07296"></a>07296     }       
<a name="l07297"></a>07297 }
<a name="l07298"></a>07298 
<a name="l07299"></a>07299 <span class="comment">/* deprecated, only keep this for readfile.c */</span>
<a name="l07300"></a><a class="code" href="../../d0/d12/readfile_8c.html#a821f02c4c74428a5a16f6574a9de1f25">07300</a> <span class="keyword">static</span> <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a821f02c4c74428a5a16f6574a9de1f25">do_version_give_parteff_245</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l07301"></a>07301 {
<a name="l07302"></a>07302     <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l07303"></a>07303 
<a name="l07304"></a>07304     paf= ob-&gt;effect.first;
<a name="l07305"></a>07305     <span class="keywordflow">while</span> (paf) {
<a name="l07306"></a>07306         <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a058f8cfb3c8a781264b431c40e4dbaaa">type</a>==<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a712e7ef632d364ac7226cbc7a74b20df">EFF_PARTICLE</a>) <span class="keywordflow">return</span> paf;
<a name="l07307"></a>07307         paf= paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a4da6369abd847703c33e21d4b26f2fec">next</a>;
<a name="l07308"></a>07308     }
<a name="l07309"></a>07309     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07310"></a>07310 }
<a name="l07311"></a><a class="code" href="../../d0/d12/readfile_8c.html#a724c27e6983a5e8fc72392da8047f45a">07311</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a724c27e6983a5e8fc72392da8047f45a">do_version_free_effect_245</a>(<a class="code" href="../../de/dd9/structEffect.html">Effect</a> *eff)
<a name="l07312"></a>07312 {
<a name="l07313"></a>07313     <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l07314"></a>07314 
<a name="l07315"></a>07315     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../de/dd9/structEffect.html#a12d3303c74fc39666f803d908d61c966">type</a>==<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a712e7ef632d364ac7226cbc7a74b20df">EFF_PARTICLE</a>) {
<a name="l07316"></a>07316         paf= (<a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *)eff;
<a name="l07317"></a>07317         <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a155a6aeff365ebf059327e16dfee1993">keys</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a155a6aeff365ebf059327e16dfee1993">keys</a>);
<a name="l07318"></a>07318     }
<a name="l07319"></a>07319     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(eff);
<a name="l07320"></a>07320 }
<a name="l07321"></a><a class="code" href="../../d0/d12/readfile_8c.html#a04a08be8c4070f90a1bbd0f2034dce3f">07321</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a04a08be8c4070f90a1bbd0f2034dce3f">do_version_free_effects_245</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l07322"></a>07322 {
<a name="l07323"></a>07323     <a class="code" href="../../de/dd9/structEffect.html">Effect</a> *eff;
<a name="l07324"></a>07324 
<a name="l07325"></a>07325     eff= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07326"></a>07326     <span class="keywordflow">while</span> (eff) {
<a name="l07327"></a>07327         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(lb, eff);
<a name="l07328"></a>07328         <a class="code" href="../../d0/d12/readfile_8c.html#a724c27e6983a5e8fc72392da8047f45a">do_version_free_effect_245</a>(eff);
<a name="l07329"></a>07329         eff= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07330"></a>07330     }
<a name="l07331"></a>07331 }
<a name="l07332"></a>07332 
<a name="l07333"></a><a class="code" href="../../d0/d12/readfile_8c.html#afb691777f5db3b1cd49fe058e11d6573">07333</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#afb691777f5db3b1cd49fe058e11d6573">do_version_mtex_factor_2_50</a>(<a class="code" href="../../dc/ddd/structMTex.html">MTex</a> **mtex_array, <span class="keywordtype">short</span> idtype)
<a name="l07334"></a>07334 {
<a name="l07335"></a>07335     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex;
<a name="l07336"></a>07336     <span class="keywordtype">float</span> varfac, colfac;
<a name="l07337"></a>07337     <span class="keywordtype">int</span> a, neg;
<a name="l07338"></a>07338 
<a name="l07339"></a>07339     <span class="keywordflow">if</span> (!mtex_array)
<a name="l07340"></a>07340         <span class="keywordflow">return</span>;
<a name="l07341"></a>07341 
<a name="l07342"></a>07342     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l07343"></a>07343         <span class="keywordflow">if</span> (mtex_array[a]) {
<a name="l07344"></a>07344             mtex= mtex_array[a];
<a name="l07345"></a>07345 
<a name="l07346"></a>07346             neg= mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aadd93074627cf45cb5c1f20aaf391261">maptoneg</a>;
<a name="l07347"></a>07347             varfac= mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa041f68d1485875801acb76d5d167607">varfac</a>;
<a name="l07348"></a>07348             colfac= mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a50c3aa992ec063f2e025bda4932d9671">colfac</a>;
<a name="l07349"></a>07349 
<a name="l07350"></a>07350             <span class="keywordflow">if</span> (neg &amp; <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a90516c518f4f0451b6e33e733a8c0a3c">MAP_DISP</a>) mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab8859964ddff8c7ca6b22aff96e80b72">dispfac</a>= -mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab8859964ddff8c7ca6b22aff96e80b72">dispfac</a>;
<a name="l07351"></a>07351             <span class="keywordflow">if</span> (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a98aa925aecdf5a9af3e1bb8968b4f2df">MAP_NORM</a>) mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a0eec064756d3176e805049adb245cf29">norfac</a>= -mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a0eec064756d3176e805049adb245cf29">norfac</a>;
<a name="l07352"></a>07352             <span class="keywordflow">if</span> (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a54f3d3d4d03b347951224821aa887f36">MAP_WARP</a>) mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a4e1b6ca70088db7dd9d8e73e343e10ea">warpfac</a>= -mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a4e1b6ca70088db7dd9d8e73e343e10ea">warpfac</a>;
<a name="l07353"></a>07353 
<a name="l07354"></a>07354             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#af06ed960fc34d478679a6847ae196bc1">colspecfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a14f4ce1c3bd682fda8faf3e93243682b">MAP_COLSPEC</a>)? -colfac: colfac;
<a name="l07355"></a>07355             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa7f47775a883545533b1b0a01e00684e">mirrfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a9e22389d5148446e93c44bf98a79fb81">MAP_COLMIR</a>)? -colfac: colfac;
<a name="l07356"></a>07356             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab1c4b184dbdff11ca36fc0c838d2a444">alphafac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a4d4d91166a52a89f90553ad91d3efd06">MAP_ALPHA</a>)? -varfac: varfac;
<a name="l07357"></a>07357             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a771d4de799fe2dfa9ebfe33709a2c9fe">difffac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#afc80d6a261c2aad5ae750e1d5c163cce">MAP_REF</a>)? -varfac: varfac;
<a name="l07358"></a>07358             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a7141aa945409f526feb906f752cdee1b">specfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ae611f4560e7b7acb33d645c437407cd4">MAP_SPEC</a>)? -varfac: varfac;
<a name="l07359"></a>07359             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ae142f5ebd7ec3303b40b2802a0bafed8">emitfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#aadd527fd8bea6a7385879d0c9dbf9114">MAP_EMIT</a>)? -varfac: varfac;
<a name="l07360"></a>07360             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#adcc6e046c588ca0ed1e9726ceb957b56">hardfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#acf19bfa4c7b6b00b31c619fab6930f8f">MAP_HAR</a>)? -varfac: varfac;
<a name="l07361"></a>07361             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#afdd1053d04ec8a354b4c5f28e6edcb40">raymirrfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#afef53ea8bfe8d51fd945f8f780837a15">MAP_RAYMIRR</a>)? -varfac: varfac;
<a name="l07362"></a>07362             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a6905f98e365919a8894bd19cbadd3069">translfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ac864f8cbe64fe2a610d02b7542ae95f6">MAP_TRANSLU</a>)? -varfac: varfac;
<a name="l07363"></a>07363             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ad3fdcaa4886bf2d4ad0e3312be7f34a7">ambfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ae3bc8c879e5c1123eb7464f6c33f8e1d">MAP_AMB</a>)? -varfac: varfac;
<a name="l07364"></a>07364             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ac49df23d0bd8a7f21184f8488a08645a">colemitfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ad8f2c2b60c1a96aef92b3394bc612f95">MAP_EMISSION_COL</a>)? -colfac: colfac;
<a name="l07365"></a>07365             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a7db98161b61601800c194852a5464d79">colreflfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a9ce59cf530f1929de5d9dc171bb35b7d">MAP_REFLECTION_COL</a>)? -colfac: colfac;
<a name="l07366"></a>07366             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab6268d7bd2724c2b812e5f01a2f7c3e0">coltransfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a77d05d29cffe87b4f964827b2d58bc37">MAP_TRANSMISSION_COL</a>)? -colfac: colfac;
<a name="l07367"></a>07367             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#acc827ff5217dfddf5991ec5971fac248">densfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#addeb88fa5c86525e00917eb2009b5440">MAP_DENSITY</a>)? -varfac: varfac;
<a name="l07368"></a>07368             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa28ceaf93956c35c0e2780dd8e65ff2b">scatterfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a0e244d20118aa3de08ad4f074c33b8f8">MAP_SCATTERING</a>)? -varfac: varfac;
<a name="l07369"></a>07369             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aff784f611f628613560f8a828691500f">reflfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a30f1fd2b082cfd91b07340e3afbee2d7">MAP_REFLECTION</a>)? -varfac: varfac;
<a name="l07370"></a>07370 
<a name="l07371"></a>07371             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab040919c1e47566a7f82cc86e678fd5a">timefac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a7e91bb2bd8632dc2f811a20896591183">MAP_PA_TIME</a>)? -varfac: varfac;
<a name="l07372"></a>07372             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ac29e062cfc85b07747b4e29078e5bd94">lengthfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a2bd3f4e5e8586f1bb104cdfdd64f9528">MAP_PA_LENGTH</a>)? -varfac: varfac;
<a name="l07373"></a>07373             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a9895554619c5b92d23e92bb0c9a6d4a4">clumpfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#aade53dca999ae0c79c18a59a9a1d1c6a">MAP_PA_CLUMP</a>)? -varfac: varfac;
<a name="l07374"></a>07374             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a70b05f607adbc72d22e59da9c14ca6fa">kinkfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a6e2eec9e989e2155b8a35079e5408a14">MAP_PA_KINK</a>)? -varfac: varfac;
<a name="l07375"></a>07375             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a23a61ffcf51f6b9299f4820bee7c7357">roughfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ae01936d2ecbbf0385a9446f0a1f40cdb">MAP_PA_ROUGH</a>)? -varfac: varfac;
<a name="l07376"></a>07376             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a5cce8ea7cc1d886c448b4502c267978d">padensfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a235572b9b82ab0d3405b3846aab1b695">MAP_PA_DENS</a>)? -varfac: varfac;
<a name="l07377"></a>07377             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a52a83a38ebd475e5f75628be27bd7799">lifefac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ae84c3a13f924808aa5ec0f1f55a8df28">MAP_PA_LIFE</a>)? -varfac: varfac;
<a name="l07378"></a>07378             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aed4e92f819997ed090789154c9c2ec4d">sizefac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a549b9de4f04188cc860badffedd5ba74">MAP_PA_SIZE</a>)? -varfac: varfac;
<a name="l07379"></a>07379             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a996eb0b386be7689d4a01bacfad04619">ivelfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#adf012ec25bf70c3b73194c8fbc9481ab">MAP_PA_IVEL</a>)? -varfac: varfac;
<a name="l07380"></a>07380 
<a name="l07381"></a>07381             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ae570daf61418e424a52e33b0f32e9e84">shadowfac</a>= (neg &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#aad74125b6ea0c029453815dbc7171a88">LAMAP_SHAD</a>)? -colfac: colfac;
<a name="l07382"></a>07382 
<a name="l07383"></a>07383             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a2f101ce15edc008532e5c1c18584b3ba">zenupfac</a>= (neg &amp; <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a272018a370e2af8a600161966cdf042b">WOMAP_ZENUP</a>)? -colfac: colfac;
<a name="l07384"></a>07384             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#abd81c48187542f62c07d4ac23e464f5e">zendownfac</a>= (neg &amp; <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#aed935881cd37d675bab153443dbc30a3">WOMAP_ZENDOWN</a>)? -colfac: colfac;
<a name="l07385"></a>07385             mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab3dc6c4ec20ced6ef8cd9a3f14e4025d">blendfac</a>= (neg &amp; <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a821137c3873605e55431e07f745931ac">WOMAP_BLEND</a>)? -varfac: varfac;
<a name="l07386"></a>07386 
<a name="l07387"></a>07387             <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>)
<a name="l07388"></a>07388                 mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a50c3aa992ec063f2e025bda4932d9671">colfac</a>= (neg &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#af205394e8cf1225dd1746ef3fe0c08cb">MAP_COL</a>)? -colfac: colfac;
<a name="l07389"></a>07389             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>)
<a name="l07390"></a>07390                 mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a50c3aa992ec063f2e025bda4932d9671">colfac</a>= (neg &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#aae63e37d7dddc407c68288610486ffd6">LAMAP_COL</a>)? -colfac: colfac;
<a name="l07391"></a>07391             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>)
<a name="l07392"></a>07392                 mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a50c3aa992ec063f2e025bda4932d9671">colfac</a>= (neg &amp; <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#aa88b2e408d24959cdfc3cea43542c9b7">WOMAP_HORIZ</a>)? -colfac: colfac;
<a name="l07393"></a>07393         }
<a name="l07394"></a>07394     }
<a name="l07395"></a>07395 }
<a name="l07396"></a>07396 
<a name="l07397"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac1d1392aa792d706bcb963bac44eb9e3">07397</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac1d1392aa792d706bcb963bac44eb9e3">do_version_mdef_250</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l07398"></a>07398 {
<a name="l07399"></a>07399     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l07400"></a>07400     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l07401"></a>07401     <a class="code" href="../../de/df2/structMeshDeformModifierData.html">MeshDeformModifierData</a> *mmd;
<a name="l07402"></a>07402 
<a name="l07403"></a>07403     <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l07404"></a>07404         <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l07405"></a>07405             <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a177f813942f48c8705d42b9820e02a80">eModifierType_MeshDeform</a>) {
<a name="l07406"></a>07406                 mmd= (<a class="code" href="../../de/df2/structMeshDeformModifierData.html">MeshDeformModifierData</a>*)md;
<a name="l07407"></a>07407 
<a name="l07408"></a>07408                 <span class="keywordflow">if</span> (mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>) {
<a name="l07409"></a>07409                     <span class="comment">/* make bindcos NULL in order to trick older versions</span>
<a name="l07410"></a>07410 <span class="comment">                     * into thinking that the mesh was not bound yet */</span>
<a name="l07411"></a>07411                     mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#af2857fb00435f5809c4ab37c1e3a7281">bindcagecos</a>= mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>;
<a name="l07412"></a>07412                     mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a1eb2a0e49659bb761d8fa9b3c4468920">bindcos</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07413"></a>07413 
<a name="l07414"></a>07414                     <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#add0fe1275f3dc882cc09a8ab3fc31b49">modifier_mdef_compact_influences</a>(md);
<a name="l07415"></a>07415                 }
<a name="l07416"></a>07416             }
<a name="l07417"></a>07417         }
<a name="l07418"></a>07418     }
<a name="l07419"></a>07419 }
<a name="l07420"></a>07420 
<a name="l07421"></a><a class="code" href="../../d0/d12/readfile_8c.html#aab2c29513b121716e8ed992816e03102">07421</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aab2c29513b121716e8ed992816e03102">do_version_constraints_radians_degrees_250</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l07422"></a>07422 {
<a name="l07423"></a>07423     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l07424"></a>07424 
<a name="l07425"></a>07425     <span class="keywordflow">for</span> (con=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l07426"></a>07426         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a44c442a006038ebc212011d1c158646f">CONSTRAINT_TYPE_RIGIDBODYJOINT</a>) {
<a name="l07427"></a>07427             <a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html">bRigidBodyJointConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l07428"></a>07428             data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#aaf68f1bac8f98640c374183e5179b24a">axX</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07429"></a>07429             data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#afc39bb91adbb4c12841a8957020377de">axY</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07430"></a>07430             data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#ac4a5c0b431b4ae719ef7bc30651b94b5">axZ</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07431"></a>07431         }
<a name="l07432"></a>07432         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) {
<a name="l07433"></a>07433             <a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l07434"></a>07434             data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ab6b072b23e2bc6baf1be71d99ace2a3d">poleangle</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07435"></a>07435         }
<a name="l07436"></a>07436         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a5dbe292ea3b5603f1d949964a243ba81">CONSTRAINT_TYPE_ROTLIMIT</a>) {
<a name="l07437"></a>07437             <a class="code" href="../../db/d16/structbRotLimitConstraint.html">bRotLimitConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l07438"></a>07438 
<a name="l07439"></a>07439             data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#a9b93b2aa7ccf96e05e41f2e7c64e3df6">xmin</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07440"></a>07440             data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#aa5a0c4380b879d6b467b1efd295569a1">xmax</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07441"></a>07441             data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#a5a73a710f452b7e06651d4f5e76c7a65">ymin</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07442"></a>07442             data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#a5112e6d26a616ce41476afd4633fcd3e">ymax</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07443"></a>07443             data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#a0ba6006fbe4b38ce2f48d1c0d859b9c1">zmin</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07444"></a>07444             data-&gt;<a class="code" href="../../db/d16/structbRotLimitConstraint.html#aa40e680ad5a3d125a73e820cf1b85dc7">zmax</a> *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l07445"></a>07445         }
<a name="l07446"></a>07446     }
<a name="l07447"></a>07447 }
<a name="l07448"></a>07448 
<a name="l07449"></a>07449 <span class="comment">/* NOTE: this version patch is intended for versions &lt; 2.52.2, but was initially introduced in 2.27 already */</span>
<a name="l07450"></a><a class="code" href="../../d0/d12/readfile_8c.html#af30ff8b22789c2549e3c3c0931701a1b">07450</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af30ff8b22789c2549e3c3c0931701a1b">do_version_old_trackto_to_constraints</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l07451"></a>07451 {
<a name="l07452"></a>07452     <span class="comment">/* create new trackto constraint from the relationship */</span>
<a name="l07453"></a>07453     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a10589da689f1a9c4dfb74b11bc24f069">track</a>)
<a name="l07454"></a>07454     {
<a name="l07455"></a>07455         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#ae97b0ba60cdc11d7d8b2d44ed0369892">add_ob_constraint</a>(ob, <span class="stringliteral">&quot;AutoTrack&quot;</span>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a0a299f49fea25012a0b3cf4fab903ad7">CONSTRAINT_TYPE_TRACKTO</a>);
<a name="l07456"></a>07456         <a class="code" href="../../dd/d05/structbTrackToConstraint.html">bTrackToConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l07457"></a>07457         
<a name="l07458"></a>07458         <span class="comment">/* copy tracking settings from the object */</span>
<a name="l07459"></a>07459         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a48d437d6dcd5094b381dc98a5e00ea30">tar</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a10589da689f1a9c4dfb74b11bc24f069">track</a>;
<a name="l07460"></a>07460         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad114fce525aa2f570e9b84abdd4076c2">trackflag</a>;
<a name="l07461"></a>07461         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae7c8e191b4cc5210a05f7f1ac8fe0ef0">upflag</a>;
<a name="l07462"></a>07462     }
<a name="l07463"></a>07463     
<a name="l07464"></a>07464     <span class="comment">/* clear old track setting */</span>
<a name="l07465"></a>07465     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a10589da689f1a9c4dfb74b11bc24f069">track</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07466"></a>07466 }
<a name="l07467"></a>07467 
<a name="l07468"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad02511ad9f2b1e83294f53838f8ed664">07468</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad02511ad9f2b1e83294f53838f8ed664">do_versions_seq_unique_name_all_strips</a>(
<a name="l07469"></a>07469     <a class="code" href="../../d9/d27/structScene.html">Scene</a> * sce, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *seqbasep)
<a name="l07470"></a>07470 {
<a name="l07471"></a>07471     <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> * seq = seqbasep-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07472"></a>07472 
<a name="l07473"></a>07473     <span class="keywordflow">while</span> (seq) {
<a name="l07474"></a>07474         <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#ac8a5c77b4ca3351b21f74890f845c681">seqbase_unique_name_recursive</a>(&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>, seq);
<a name="l07475"></a>07475         <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa36ece483e44a2f715bc29b396284bc0">seqbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l07476"></a>07476             <a class="code" href="../../d0/d12/readfile_8c.html#ad02511ad9f2b1e83294f53838f8ed664">do_versions_seq_unique_name_all_strips</a>(
<a name="l07477"></a>07477                 sce, &amp;seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa36ece483e44a2f715bc29b396284bc0">seqbase</a>);
<a name="l07478"></a>07478         }
<a name="l07479"></a>07479         seq=seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#ad4de4f8111ab2794d21cfbd6a2fc1810">next</a>;
<a name="l07480"></a>07480     }
<a name="l07481"></a>07481 }
<a name="l07482"></a>07482 
<a name="l07483"></a>07483 
<a name="l07484"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac19d6baee72c183890b4d330242a011d">07484</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac19d6baee72c183890b4d330242a011d">do_version_bone_roll_256</a>(<a class="code" href="../../de/de0/structBone.html">Bone</a> *bone)
<a name="l07485"></a>07485 {
<a name="l07486"></a>07486     <a class="code" href="../../de/de0/structBone.html">Bone</a> *child;
<a name="l07487"></a>07487     <span class="keywordtype">float</span> submat[3][3];
<a name="l07488"></a>07488     
<a name="l07489"></a>07489     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(submat, bone-&gt;<a class="code" href="../../de/de0/structBone.html#ac5365d4b57959d83787fe04d546beb1b">arm_mat</a>);
<a name="l07490"></a>07490     <a class="code" href="../../da/d17/BKE__armature_8h.html#a2b53ce3fca660bd148f0e11b7d9692fd">mat3_to_vec_roll</a>(submat, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;bone-&gt;<a class="code" href="../../de/de0/structBone.html#afd67e451c3b933289c0fc88a515ef6a6">arm_roll</a>);
<a name="l07491"></a>07491     
<a name="l07492"></a>07492     <span class="keywordflow">for</span> (child = bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; child; child = child-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>)
<a name="l07493"></a>07493         <a class="code" href="../../d0/d12/readfile_8c.html#ac19d6baee72c183890b4d330242a011d">do_version_bone_roll_256</a>(child);
<a name="l07494"></a>07494 }
<a name="l07495"></a>07495 
<a name="l07496"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab0ed6adc3cd60d5603ff3282d2b525ae">07496</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab0ed6adc3cd60d5603ff3282d2b525ae">do_versions_nodetree_dynamic_sockets</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l07497"></a>07497 {
<a name="l07498"></a>07498     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l07499"></a>07499     <span class="keywordflow">for</span> (sock=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l07500"></a>07500         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a70ce0ddc15282df3859f4cea6610616d">SOCK_DYNAMIC</a>;
<a name="l07501"></a>07501     <span class="keywordflow">for</span> (sock=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l07502"></a>07502         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a70ce0ddc15282df3859f4cea6610616d">SOCK_DYNAMIC</a>;
<a name="l07503"></a>07503 }
<a name="l07504"></a>07504 
<a name="l07505"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1b009f10b5ef8343572988700dca90b3">07505</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1b009f10b5ef8343572988700dca90b3">convert_tface_mt</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l07506"></a>07506 {
<a name="l07507"></a>07507     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *gmain;
<a name="l07508"></a>07508 
<a name="l07509"></a>07509     <span class="comment">/* this is a delayed do_version (so it can create new materials) */</span>
<a name="l07510"></a>07510     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 259 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 259 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3)) {
<a name="l07511"></a>07511 
<a name="l07512"></a>07512         <span class="comment">//XXX hack, material.c uses G.main all over the place, instead of main</span>
<a name="l07513"></a>07513         <span class="comment">// temporarily set G.main to the current main</span>
<a name="l07514"></a>07514         gmain = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l07515"></a>07515         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main = <a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>;
<a name="l07516"></a>07516 
<a name="l07517"></a>07517         <span class="keywordflow">if</span> (!(<a class="code" href="../../d4/d0f/BKE__material_8h.html#a98b353c3673a2ddd19e41c885df77728">do_version_tface</a>(main, 1))) {
<a name="l07518"></a>07518             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Texface conversion problem. Error in console&quot;</span>);
<a name="l07519"></a>07519         }
<a name="l07520"></a>07520 
<a name="l07521"></a>07521         <span class="comment">//XXX hack, material.c uses G.main allover the place, instead of main</span>
<a name="l07522"></a>07522         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main = gmain;
<a name="l07523"></a>07523     }
<a name="l07524"></a>07524 }
<a name="l07525"></a>07525 
<a name="l07526"></a><a class="code" href="../../d0/d12/readfile_8c.html#abda6d5229171184c482c266991b5b2c0">07526</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#abda6d5229171184c482c266991b5b2c0">do_versions_nodetree_image_default_alpha_output</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l07527"></a>07527 {
<a name="l07528"></a>07528     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l07529"></a>07529     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l07530"></a>07530     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l07531"></a>07531         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>)) {
<a name="l07532"></a>07532             <span class="comment">/* default Image output value should have 0 alpha */</span>
<a name="l07533"></a>07533             sock = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07534"></a>07534             ((<a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html">bNodeSocketValueRGBA</a>*)sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)-&gt;value[3] = 0.0f;
<a name="l07535"></a>07535         }
<a name="l07536"></a>07536     }
<a name="l07537"></a>07537 }
<a name="l07538"></a>07538 
<a name="l07539"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa095408a76ff6e72c3ada1e414c11986">07539</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa095408a76ff6e72c3ada1e414c11986">do_version_ntree_tex_mapping_260</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>), <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<span class="keywordtype">id</span>), <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l07540"></a>07540 {
<a name="l07541"></a>07541     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l07542"></a>07542 
<a name="l07543"></a>07543     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l07544"></a>07544         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ab063622824056a904406c1b8a832320e">SH_NODE_MAPPING</a>) {
<a name="l07545"></a>07545             <a class="code" href="../../d8/df6/structTexMapping.html">TexMapping</a> *tex_mapping;
<a name="l07546"></a>07546 
<a name="l07547"></a>07547             tex_mapping= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07548"></a>07548             tex_mapping-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a71055bd10043fae62a7e4e9bee717374">projx</a>= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a5f5715c2d8cddd12258c1bdc8664381c">PROJ_X</a>;
<a name="l07549"></a>07549             tex_mapping-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a9a7f231bffa63ca577dd936ee9b4ef22">projy</a>= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#af600166ec173acd4812aa8fbfdb8bf76">PROJ_Y</a>;
<a name="l07550"></a>07550             tex_mapping-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#aa223e227a28435881bc4f6ceb7db6c5b">projz</a>= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a1607fc9734a0bacceddea4c5206fe10c">PROJ_Z</a>;
<a name="l07551"></a>07551         }
<a name="l07552"></a>07552     }
<a name="l07553"></a>07553 }
<a name="l07554"></a>07554 
<a name="l07555"></a><a class="code" href="../../d0/d12/readfile_8c.html#a3852583c1310fc61c08b71294ed760f4">07555</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3852583c1310fc61c08b71294ed760f4">do_versions_nodetree_convert_angle</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l07556"></a>07556 {
<a name="l07557"></a>07557     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l07558"></a>07558     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l07559"></a>07559         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#a5203e755c045b99720eba75a39b056a2">CMP_NODE_ROTATE</a>) {
<a name="l07560"></a>07560             <span class="comment">/* Convert degrees to radians. */</span>
<a name="l07561"></a>07561             <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock = ((<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>;
<a name="l07562"></a>07562             ((<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html">bNodeSocketValueFloat</a>*)sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)-&gt;value = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(((<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html">bNodeSocketValueFloat</a>*)sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)-&gt;value);
<a name="l07563"></a>07563         }
<a name="l07564"></a>07564         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a8896a791a44debfdcbc8c157fb718321">CMP_NODE_DBLUR</a>) {
<a name="l07565"></a>07565             <span class="comment">/* Convert degrees to radians. */</span>
<a name="l07566"></a>07566             <a class="code" href="../../d1/d03/structNodeDBlurData.html">NodeDBlurData</a> *ndbd= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07567"></a>07567             ndbd-&gt;<a class="code" href="../../d1/d03/structNodeDBlurData.html#ada784443be3f708afabdc472ef128efe">angle</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(ndbd-&gt;<a class="code" href="../../d1/d03/structNodeDBlurData.html#ada784443be3f708afabdc472ef128efe">angle</a>);
<a name="l07568"></a>07568             ndbd-&gt;<a class="code" href="../../d1/d03/structNodeDBlurData.html#aae4a3b3d9798f2b3e5f6efedfb8c8f20">spin</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(ndbd-&gt;<a class="code" href="../../d1/d03/structNodeDBlurData.html#aae4a3b3d9798f2b3e5f6efedfb8c8f20">spin</a>);
<a name="l07569"></a>07569         }
<a name="l07570"></a>07570         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a2086c1d38c6ebfa4ff268bf267b7920a">CMP_NODE_DEFOCUS</a>) {
<a name="l07571"></a>07571             <span class="comment">/* Convert degrees to radians. */</span>
<a name="l07572"></a>07572             <a class="code" href="../../d4/d94/structNodeDefocus.html">NodeDefocus</a> *nqd = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07573"></a>07573             <span class="comment">/* XXX DNA char to float conversion seems to map the char value into the [0.0f, 1.0f] range... */</span>
<a name="l07574"></a>07574             nqd-&gt;<a class="code" href="../../d4/d94/structNodeDefocus.html#af600ecc90204f54b70262013d7d16d82">rotation</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(nqd-&gt;<a class="code" href="../../d4/d94/structNodeDefocus.html#af600ecc90204f54b70262013d7d16d82">rotation</a>*255.0f);
<a name="l07575"></a>07575         }
<a name="l07576"></a>07576         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#a756440e114ac2396e402d1fcc236117d">CMP_NODE_CHROMA_MATTE</a>) {
<a name="l07577"></a>07577             <span class="comment">/* Convert degrees to radians. */</span>
<a name="l07578"></a>07578             <a class="code" href="../../d9/d21/structNodeChroma.html">NodeChroma</a> *ndc = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07579"></a>07579             ndc-&gt;<a class="code" href="../../d9/d21/structNodeChroma.html#a30341ea0b911ff353c3306b746e1160c">t1</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(ndc-&gt;<a class="code" href="../../d9/d21/structNodeChroma.html#a30341ea0b911ff353c3306b746e1160c">t1</a>);
<a name="l07580"></a>07580             ndc-&gt;<a class="code" href="../../d9/d21/structNodeChroma.html#ae46edad205d832dbabbdd92148089b60">t2</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(ndc-&gt;<a class="code" href="../../d9/d21/structNodeChroma.html#ae46edad205d832dbabbdd92148089b60">t2</a>);
<a name="l07581"></a>07581         }
<a name="l07582"></a>07582         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#a75dbf6e35338bdfe919ab5d023bb8dc3">CMP_NODE_GLARE</a>) {
<a name="l07583"></a>07583             <span class="comment">/* Convert degrees to radians. */</span>
<a name="l07584"></a>07584             <a class="code" href="../../d6/d4f/structNodeGlare.html">NodeGlare</a>* ndg = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07585"></a>07585             <span class="comment">/* XXX DNA char to float conversion seems to map the char value into the [0.0f, 1.0f] range... */</span>
<a name="l07586"></a>07586             ndg-&gt;<a class="code" href="../../d6/d4f/structNodeGlare.html#a42be1d848e2b41f68dfbe7e4d62c4e45">angle_ofs</a> = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(ndg-&gt;<a class="code" href="../../d6/d4f/structNodeGlare.html#a42be1d848e2b41f68dfbe7e4d62c4e45">angle_ofs</a>*255.0f);
<a name="l07587"></a>07587         }
<a name="l07588"></a>07588         <span class="comment">/* XXX TexMapping struct is used by other nodes too (at least node_composite_mapValue),</span>
<a name="l07589"></a>07589 <span class="comment">         *     but not the rot part...</span>
<a name="l07590"></a>07590 <span class="comment">         */</span>
<a name="l07591"></a>07591         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ab063622824056a904406c1b8a832320e">SH_NODE_MAPPING</a>) {
<a name="l07592"></a>07592             <span class="comment">/* Convert degrees to radians. */</span>
<a name="l07593"></a>07593             <a class="code" href="../../d8/df6/structTexMapping.html">TexMapping</a>* tmap = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07594"></a>07594             tmap-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a8203f9e856ad257cc97a633e7ca51df7">rot</a>[0] = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(tmap-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a8203f9e856ad257cc97a633e7ca51df7">rot</a>[0]);
<a name="l07595"></a>07595             tmap-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a8203f9e856ad257cc97a633e7ca51df7">rot</a>[1] = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(tmap-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a8203f9e856ad257cc97a633e7ca51df7">rot</a>[1]);
<a name="l07596"></a>07596             tmap-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a8203f9e856ad257cc97a633e7ca51df7">rot</a>[2] = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(tmap-&gt;<a class="code" href="../../d8/df6/structTexMapping.html#a8203f9e856ad257cc97a633e7ca51df7">rot</a>[2]);
<a name="l07597"></a>07597         }
<a name="l07598"></a>07598     }
<a name="l07599"></a>07599 }
<a name="l07600"></a>07600 
<a name="l07601"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4dfd0402183ebf4cc246c063db292100">07601</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4dfd0402183ebf4cc246c063db292100">do_versions_image_settings_2_60</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l07602"></a>07602 {
<a name="l07603"></a>07603     <span class="comment">/* note: rd-&gt;subimtype is moved into individual settings now and no longer</span>
<a name="l07604"></a>07604 <span class="comment">     * exists */</span>
<a name="l07605"></a>07605     <a class="code" href="../../d3/d27/structRenderData.html">RenderData</a> *rd= &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>;
<a name="l07606"></a>07606     <a class="code" href="../../da/d23/structImageFormatData.html">ImageFormatData</a> *imf= &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a53cdd260f397aa4d2bead55f90780180">im_format</a>;
<a name="l07607"></a>07607 
<a name="l07608"></a>07608     <span class="comment">/* we know no data loss happens here, the old values were in char range */</span>
<a name="l07609"></a>07609     imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a30929385debbd1ff586c9f9936895198">imtype</a>=   (char)rd-&gt;imtype;
<a name="l07610"></a>07610     imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#aedc2ed8969621f3903a6fee8eeb098c9">planes</a>=   (<span class="keywordtype">char</span>)rd-&gt;planes;
<a name="l07611"></a>07611     imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a23f6a76d7819cb51371e9959e7ac995a">compress</a>= (char)rd-&gt;quality;
<a name="l07612"></a>07612     imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a74d5dd69af52338475a267ab8493b2f7">quality</a>=  (<span class="keywordtype">char</span>)rd-&gt;quality;
<a name="l07613"></a>07613 
<a name="l07614"></a>07614     <span class="comment">/* default, was stored in multiple places, may override later */</span>
<a name="l07615"></a>07615     imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#ada08bec60e3ea645cefb195d125e978b">depth</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af02e6e0fb1e7bcfc7a2995dee0e7afc2">R_IMF_CHAN_DEPTH_8</a>;
<a name="l07616"></a>07616 
<a name="l07617"></a>07617     <span class="comment">/* openexr */</span>
<a name="l07618"></a>07618     imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#ad5f4a2d09c8c7b6f0cd5072daba6f186">exr_codec</a> = rd-&gt;quality &amp; 7; <span class="comment">/* strange but true! 0-4 are valid values, OPENEXR_COMPRESS */</span>
<a name="l07619"></a>07619 
<a name="l07620"></a>07620     <span class="keywordflow">switch</span> (imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a30929385debbd1ff586c9f9936895198">imtype</a>) {
<a name="l07621"></a>07621     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae55ca7dec6a00559503bd82951e35b72">R_IMF_IMTYPE_OPENEXR</a>:
<a name="l07622"></a>07622         imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#ada08bec60e3ea645cefb195d125e978b">depth</a>=  (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a2ad2260d35d5d7bd722eaf0b8a1b1db6">R_OPENEXR_HALF</a>) ? <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7a5fd1dc06392cd33f368a397b2010f1">R_IMF_CHAN_DEPTH_16</a> : <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a204d434d0d919428f638818080df09c8">R_IMF_CHAN_DEPTH_32</a>;
<a name="l07623"></a>07623         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7509f698142449f9d41f0c27b9365067">R_PREVIEW_JPG</a>) {
<a name="l07624"></a>07624             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#adb094a1f090338e9eb9fa3b341373577">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#abb287f7d5980c374e679e1ec2f04f42a">R_IMF_FLAG_PREVIEW_JPG</a>;
<a name="l07625"></a>07625         }
<a name="l07626"></a>07626         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7bc77c988790d604f5a4df58241d72f5">R_OPENEXR_ZBUF</a>) {
<a name="l07627"></a>07627             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#adb094a1f090338e9eb9fa3b341373577">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae32b2586b603ebd4cd8c6ce5b4844f9b">R_IMF_FLAG_ZBUF</a>;
<a name="l07628"></a>07628         }
<a name="l07629"></a>07629         <span class="keywordflow">break</span>;
<a name="l07630"></a>07630     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4ae0c9079524f481d318b397fd060bb5">R_IMF_IMTYPE_TIFF</a>:
<a name="l07631"></a>07631         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a9a20a15a0d47fc932c5faef2400b1368">R_TIFF_16BIT</a>) {
<a name="l07632"></a>07632             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#ada08bec60e3ea645cefb195d125e978b">depth</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7a5fd1dc06392cd33f368a397b2010f1">R_IMF_CHAN_DEPTH_16</a>;
<a name="l07633"></a>07633         }
<a name="l07634"></a>07634         <span class="keywordflow">break</span>;
<a name="l07635"></a>07635     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4fa48469f45908f0a89d41bcf4a4f486">R_IMF_IMTYPE_JP2</a>:
<a name="l07636"></a>07636         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5a5915f39292d74dacbe85ca85802fa6">R_JPEG2K_16BIT</a>) {
<a name="l07637"></a>07637             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#ada08bec60e3ea645cefb195d125e978b">depth</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7a5fd1dc06392cd33f368a397b2010f1">R_IMF_CHAN_DEPTH_16</a>;
<a name="l07638"></a>07638         }
<a name="l07639"></a>07639         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#acd5ab617f7371566705ae20a0253a908">R_JPEG2K_12BIT</a>) {
<a name="l07640"></a>07640             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#ada08bec60e3ea645cefb195d125e978b">depth</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#abe26906dae13c2271cd16a71a2d7db85">R_IMF_CHAN_DEPTH_12</a>;
<a name="l07641"></a>07641         }
<a name="l07642"></a>07642 
<a name="l07643"></a>07643         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b8b66d49ce79a5990635832f4cdda62">R_JPEG2K_YCC</a>) {
<a name="l07644"></a>07644             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a62c33bb8399f0d009ccbfe9762b19bf6">jp2_flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#accb21ff83c17732b11a9737ad154a1a7">R_IMF_JP2_FLAG_YCC</a>;
<a name="l07645"></a>07645         }
<a name="l07646"></a>07646         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae755c2599ae451387befe9c72664f5eb">R_JPEG2K_CINE_PRESET</a>) {
<a name="l07647"></a>07647             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a62c33bb8399f0d009ccbfe9762b19bf6">jp2_flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7fabf0b33c9bd083d7791072f7ff2b3c">R_IMF_JP2_FLAG_CINE_PRESET</a>;
<a name="l07648"></a>07648         }
<a name="l07649"></a>07649         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a93b99bae501f23dd230fe926545186c4">R_JPEG2K_CINE_48FPS</a>) {
<a name="l07650"></a>07650             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a62c33bb8399f0d009ccbfe9762b19bf6">jp2_flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aceb66a8f728aa53097b1564a12d2c146">R_IMF_JP2_FLAG_CINE_48</a>;
<a name="l07651"></a>07651         }
<a name="l07652"></a>07652         <span class="keywordflow">break</span>;
<a name="l07653"></a>07653     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a2e6d0c304976306261c3fb5874faacc0">R_IMF_IMTYPE_CINEON</a>:
<a name="l07654"></a>07654     <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ab1dfd1d830353da25a5be41ba7d89d24">R_IMF_IMTYPE_DPX</a>:
<a name="l07655"></a>07655         <span class="keywordflow">if</span> (rd-&gt;subimtype &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa91bfbc1990066a3ca78087bc152107d">R_CINEON_LOG</a>) {
<a name="l07656"></a>07656             imf-&gt;<a class="code" href="../../da/d23/structImageFormatData.html#a449a2107cd11697b9eb40118473558ae">cineon_flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a9e008acee9d77b993fb4e571d35322a0">R_IMF_CINEON_FLAG_LOG</a>;
<a name="l07657"></a>07657         }
<a name="l07658"></a>07658         <span class="keywordflow">break</span>;
<a name="l07659"></a>07659     }
<a name="l07660"></a>07660 
<a name="l07661"></a>07661 }
<a name="l07662"></a>07662 
<a name="l07663"></a>07663 <span class="comment">/* socket use flags were only temporary before */</span>
<a name="l07664"></a><a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">07664</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l07665"></a>07665 {
<a name="l07666"></a>07666     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l07667"></a>07667     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l07668"></a>07668     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l07669"></a>07669     
<a name="l07670"></a>07670     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l07671"></a>07671         <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l07672"></a>07672             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l07673"></a>07673         <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l07674"></a>07674             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l07675"></a>07675     }
<a name="l07676"></a>07676     <span class="keywordflow">for</span> (sock=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l07677"></a>07677         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l07678"></a>07678     <span class="keywordflow">for</span> (sock=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l07679"></a>07679         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l07680"></a>07680     
<a name="l07681"></a>07681     <span class="keywordflow">for</span> (link=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l07682"></a>07682         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l07683"></a>07683         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>;
<a name="l07684"></a>07684     }
<a name="l07685"></a>07685 }
<a name="l07686"></a>07686 
<a name="l07687"></a><a class="code" href="../../d0/d12/readfile_8c.html#af35850180edf167baf82af3fd5ca852e">07687</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#af35850180edf167baf82af3fd5ca852e">do_versions_nodetree_multi_file_output_format_2_62_1</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l07688"></a>07688 {
<a name="l07689"></a>07689     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l07690"></a>07690     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l07691"></a>07691     
<a name="l07692"></a>07692     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l07693"></a>07693         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a993ae4ed5e6e026e42a3f81b3ef71787">CMP_NODE_OUTPUT_FILE</a>) {
<a name="l07694"></a>07694             <span class="comment">/* previous CMP_NODE_OUTPUT_FILE nodes get converted to multi-file outputs */</span>
<a name="l07695"></a>07695             <a class="code" href="../../d9/da3/structNodeImageFile.html">NodeImageFile</a> *old_data = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07696"></a>07696             <a class="code" href="../../d9/df1/structNodeImageMultiFile.html">NodeImageMultiFile</a> *nimf= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/df1/structNodeImageMultiFile.html">NodeImageMultiFile</a>), <span class="stringliteral">&quot;node image multi file&quot;</span>);
<a name="l07697"></a>07697             <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *old_image = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, 0);
<a name="l07698"></a>07698             <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *old_z = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, 1);
<a name="l07699"></a>07699             <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l07700"></a>07700             
<a name="l07701"></a>07701             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= nimf;
<a name="l07702"></a>07702             
<a name="l07703"></a>07703             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a81532adedc5406e16391c70d4ca8135a">base_path</a>, old_data-&gt;<a class="code" href="../../d9/da3/structNodeImageFile.html#a321ec27fa2fbd88e2abcf82b8d5a09b3">name</a>, <span class="keyword">sizeof</span>(nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a81532adedc5406e16391c70d4ca8135a">base_path</a>));
<a name="l07704"></a>07704             nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a233b5dd501e075a4873a7bbdd612cab1">format</a> = old_data-&gt;<a class="code" href="../../d9/da3/structNodeImageFile.html#a8b3f99aab574476bae61a414ebf88dbb">im_format</a>;
<a name="l07705"></a>07705             
<a name="l07706"></a>07706             <span class="comment">/* if z buffer is saved, change the image type to multilayer exr.</span>
<a name="l07707"></a>07707 <span class="comment">             * XXX this is slightly messy, Z buffer was ignored before for anything but EXR and IRIS ...</span>
<a name="l07708"></a>07708 <span class="comment">             * i&#39;m just assuming here that IRIZ means IRIS with z buffer ...</span>
<a name="l07709"></a>07709 <span class="comment">             */</span>
<a name="l07710"></a>07710             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(old_data-&gt;<a class="code" href="../../d9/da3/structNodeImageFile.html#a8b3f99aab574476bae61a414ebf88dbb">im_format</a>.<a class="code" href="../../da/d23/structImageFormatData.html#a30929385debbd1ff586c9f9936895198">imtype</a>, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a785413379bb7c00888ccdc4610e7ef08">R_IMF_IMTYPE_IRIZ</a>, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae55ca7dec6a00559503bd82951e35b72">R_IMF_IMTYPE_OPENEXR</a>)) {
<a name="l07711"></a>07711                 nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a233b5dd501e075a4873a7bbdd612cab1">format</a>.<a class="code" href="../../da/d23/structImageFormatData.html#a30929385debbd1ff586c9f9936895198">imtype</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7afb95d1e6ad462626ad5d21190ba54e">R_IMF_IMTYPE_MULTILAYER</a>;
<a name="l07712"></a>07712                 sock = <a class="code" href="../../d4/d91/BKE__node_8h.html#a75e76ad21aa89db3cfd5a9025265e029">ntreeCompositOutputFileAddSocket</a>(ntree, node, old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, &amp;nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a233b5dd501e075a4873a7bbdd612cab1">format</a>);
<a name="l07713"></a>07713                 <span class="keywordflow">if</span> (old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>) {
<a name="l07714"></a>07714                     old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> = sock;
<a name="l07715"></a>07715                     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a> = old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>;
<a name="l07716"></a>07716                 }
<a name="l07717"></a>07717                 sock = <a class="code" href="../../d4/d91/BKE__node_8h.html#a75e76ad21aa89db3cfd5a9025265e029">ntreeCompositOutputFileAddSocket</a>(ntree, node, old_z-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, &amp;nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a233b5dd501e075a4873a7bbdd612cab1">format</a>);
<a name="l07718"></a>07718                 <span class="keywordflow">if</span> (old_z-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>) {
<a name="l07719"></a>07719                     old_z-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> = sock;
<a name="l07720"></a>07720                     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a> = old_z-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>;
<a name="l07721"></a>07721                 }
<a name="l07722"></a>07722             }
<a name="l07723"></a>07723             <span class="keywordflow">else</span> {
<a name="l07724"></a>07724                 <span class="comment">/* saves directly to base path, which is the old image output path */</span>
<a name="l07725"></a>07725                 sock = <a class="code" href="../../d4/d91/BKE__node_8h.html#a75e76ad21aa89db3cfd5a9025265e029">ntreeCompositOutputFileAddSocket</a>(ntree, node, <span class="stringliteral">&quot;&quot;</span>, &amp;nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a233b5dd501e075a4873a7bbdd612cab1">format</a>);
<a name="l07726"></a>07726                 <span class="keywordflow">if</span> (old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>) {
<a name="l07727"></a>07727                     old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> = sock;
<a name="l07728"></a>07728                     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a> = old_image-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>;
<a name="l07729"></a>07729                 }
<a name="l07730"></a>07730             }
<a name="l07731"></a>07731             
<a name="l07732"></a>07732             <a class="code" href="../../d4/d91/BKE__node_8h.html#aa4faf2c04a65b1932766577b93c6ed6d">nodeRemoveSocket</a>(ntree, node, old_image);
<a name="l07733"></a>07733             <a class="code" href="../../d4/d91/BKE__node_8h.html#aa4faf2c04a65b1932766577b93c6ed6d">nodeRemoveSocket</a>(ntree, node, old_z);
<a name="l07734"></a>07734             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(old_data);
<a name="l07735"></a>07735         }
<a name="l07736"></a>07736         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#adf9a8a0567983527f8e6cbecb6a1ab11">CMP_NODE_OUTPUT_MULTI_FILE__DEPRECATED</a>) {
<a name="l07737"></a>07737             <a class="code" href="../../d9/df1/structNodeImageMultiFile.html">NodeImageMultiFile</a> *nimf = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l07738"></a>07738             
<a name="l07739"></a>07739             <span class="comment">/* CMP_NODE_OUTPUT_MULTI_FILE has been redeclared as CMP_NODE_OUTPUT_FILE */</span>
<a name="l07740"></a>07740             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a993ae4ed5e6e026e42a3f81b3ef71787">CMP_NODE_OUTPUT_FILE</a>;
<a name="l07741"></a>07741             
<a name="l07742"></a>07742             <span class="comment">/* initialize the node-wide image format from render data, if available */</span>
<a name="l07743"></a>07743             <span class="keywordflow">if</span> (sce)
<a name="l07744"></a>07744                 nimf-&gt;<a class="code" href="../../d9/df1/structNodeImageMultiFile.html#a233b5dd501e075a4873a7bbdd612cab1">format</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a53cdd260f397aa4d2bead55f90780180">im_format</a>;
<a name="l07745"></a>07745             
<a name="l07746"></a>07746             <span class="comment">/* transfer render format toggle to node format toggle */</span>
<a name="l07747"></a>07747             <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l07748"></a>07748                 <a class="code" href="../../de/df3/structNodeImageMultiFileSocket.html">NodeImageMultiFileSocket</a> *simf = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a16dd98d87c594f25bb0676986a13dd9e">storage</a>;
<a name="l07749"></a>07749                 simf-&gt;<a class="code" href="../../de/df3/structNodeImageMultiFileSocket.html#aad1224be3c8a8ea2e328cf277308a126">use_node_format</a> = simf-&gt;use_render_format;
<a name="l07750"></a>07750             }
<a name="l07751"></a>07751             
<a name="l07752"></a>07752             <span class="comment">/* we do have preview now */</span>
<a name="l07753"></a>07753             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>;
<a name="l07754"></a>07754         }
<a name="l07755"></a>07755     }
<a name="l07756"></a>07756 }
<a name="l07757"></a>07757 
<a name="l07758"></a>07758 <span class="comment">/* blue and red are swapped pre 2.62.1, be sane (red == red) now! */</span>
<a name="l07759"></a><a class="code" href="../../d0/d12/readfile_8c.html#abf9024295b339538aabb0048f2fe4da1">07759</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#abf9024295b339538aabb0048f2fe4da1">do_versions_mesh_mloopcol_swap_2_62_1</a>(<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l07760"></a>07760 {
<a name="l07761"></a>07761     <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer;
<a name="l07762"></a>07762     <a class="code" href="../../d5/df4/structMLoopCol.html">MLoopCol</a> *mloopcol;
<a name="l07763"></a>07763     <span class="keywordtype">int</span> a;
<a name="l07764"></a>07764     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l07765"></a>07765 
<a name="l07766"></a>07766     <span class="keywordflow">for</span> (a = 0; a &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; a++) {
<a name="l07767"></a>07767         layer = &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[a];
<a name="l07768"></a>07768 
<a name="l07769"></a>07769         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#adfdc3d9683ce132f088e8fee80fe6f71">CD_MLOOPCOL</a>) {
<a name="l07770"></a>07770             mloopcol = (<a class="code" href="../../d5/df4/structMLoopCol.html">MLoopCol</a> *)layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>;
<a name="l07771"></a>07771             for (i = 0; i &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>; i++, mloopcol++) {
<a name="l07772"></a>07772                 <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">char</span>, mloopcol-&gt;<a class="code" href="../../d5/df4/structMLoopCol.html#a761df0c1a71a5aafd7e5c6183732e182">r</a>, mloopcol-&gt;<a class="code" href="../../d5/df4/structMLoopCol.html#a313b1b64bedbf4b1d3426940076567c8">b</a>);
<a name="l07773"></a>07773             }
<a name="l07774"></a>07774         }
<a name="l07775"></a>07775     }
<a name="l07776"></a>07776 }
<a name="l07777"></a>07777 
<a name="l07778"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9c6d7f2a5e3846ef77dc9b04e8884e42">07778</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a9c6d7f2a5e3846ef77dc9b04e8884e42">do_versions</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l07779"></a>07779 {
<a name="l07780"></a>07780     <span class="comment">/* WATCH IT!!!: pointers from libdata have not been converted */</span>
<a name="l07781"></a>07781 
<a name="l07782"></a>07782     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l07783"></a>07783         printf(<span class="stringliteral">&quot;read file %s\n  Version %d sub %d svn r%d\n&quot;</span>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>, main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>, main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a>, main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ab5cfd3be11c657c3eb66ff6ee3b4dcf8">revision</a>);
<a name="l07784"></a>07784     
<a name="l07785"></a>07785     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 100) {
<a name="l07786"></a>07786         <span class="comment">/* tex-&gt;extend and tex-&gt;imageflag have changed: */</span>
<a name="l07787"></a>07787         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07788"></a>07788         <span class="keywordflow">while</span> (tex) {
<a name="l07789"></a>07789             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>) {
<a name="l07790"></a>07790 
<a name="l07791"></a>07791                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad82e336d2f6265f9b521d16e7e105568">extend</a>==0) {
<a name="l07792"></a>07792                     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a10e273a1c0a0f25423b2eaa3ce468bc2">xrepeat</a> || tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad852759f1de379ee0800966663d31129">yrepeat</a>) tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad82e336d2f6265f9b521d16e7e105568">extend</a>= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a62cd592404cc5c5ce712a415db44ec61">TEX_REPEAT</a>;
<a name="l07793"></a>07793                     <span class="keywordflow">else</span> {
<a name="l07794"></a>07794                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad82e336d2f6265f9b521d16e7e105568">extend</a>= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a22aa960392e66d15c9c07a14af8e06cd">TEX_EXTEND</a>;
<a name="l07795"></a>07795                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a10e273a1c0a0f25423b2eaa3ce468bc2">xrepeat</a>= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad852759f1de379ee0800966663d31129">yrepeat</a>= 1;
<a name="l07796"></a>07796                     }
<a name="l07797"></a>07797                 }
<a name="l07798"></a>07798 
<a name="l07799"></a>07799             }
<a name="l07800"></a>07800             tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07801"></a>07801         }
<a name="l07802"></a>07802     }
<a name="l07803"></a>07803     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 101) {
<a name="l07804"></a>07804         <span class="comment">/* frame mapping */</span>
<a name="l07805"></a>07805         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07806"></a>07806         <span class="keywordflow">while</span> (sce) {
<a name="l07807"></a>07807             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a42fb1804b4e07360eb563dc0e5b17190">framapto</a>= 100;
<a name="l07808"></a>07808             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a3848b3ecab0408664df0e60bd8ae5d57">images</a>= 100;
<a name="l07809"></a>07809             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4399e01a91c6ca3e1259887c82ea0972">framelen</a>= 1.0;
<a name="l07810"></a>07810             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07811"></a>07811         }
<a name="l07812"></a>07812     }
<a name="l07813"></a>07813     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 102) {
<a name="l07814"></a>07814         <span class="comment">/* init halo&#39;s at 1.0 */</span>
<a name="l07815"></a>07815         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07816"></a>07816         <span class="keywordflow">while</span> (ma) {
<a name="l07817"></a>07817             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ae20db5cd76c043eb6e0f7c5b0200a485">add</a>= 1.0;
<a name="l07818"></a>07818             ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07819"></a>07819         }
<a name="l07820"></a>07820     }
<a name="l07821"></a>07821     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 103) {
<a name="l07822"></a>07822         <span class="comment">/* new variable in object: colbits */</span>
<a name="l07823"></a>07823         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07824"></a>07824         <span class="keywordtype">int</span> a;
<a name="l07825"></a>07825         <span class="keywordflow">while</span> (ob) {
<a name="l07826"></a>07826             ob-&gt;colbits= 0;
<a name="l07827"></a>07827             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>) {
<a name="l07828"></a>07828                 <span class="keywordflow">for</span> (a=0; a&lt;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>; a++) {
<a name="l07829"></a>07829                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>[a]) ob-&gt;colbits |= (1&lt;&lt;a);
<a name="l07830"></a>07830                 }
<a name="l07831"></a>07831             }
<a name="l07832"></a>07832             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07833"></a>07833         }
<a name="l07834"></a>07834     }
<a name="l07835"></a>07835     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 104) {
<a name="l07836"></a>07836         <span class="comment">/* timeoffs moved */</span>
<a name="l07837"></a>07837         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07838"></a>07838         <span class="keywordflow">while</span> (ob) {
<a name="l07839"></a>07839             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; 1) {
<a name="l07840"></a>07840                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> -= 1;
<a name="l07841"></a>07841                 <span class="comment">//ob-&gt;ipoflag |= OB_OFFS_OB;</span>
<a name="l07842"></a>07842             }
<a name="l07843"></a>07843             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07844"></a>07844         }
<a name="l07845"></a>07845     }
<a name="l07846"></a>07846     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 105) {
<a name="l07847"></a>07847         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07848"></a>07848         <span class="keywordflow">while</span> (ob) {
<a name="l07849"></a>07849             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a974897704b58c363ca02c573ac053e9e">dupon</a>= 1; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1c84fe38b7a976ba4df35b694cb36b47">dupoff</a>= 0;
<a name="l07850"></a>07850             ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe4c622f6da34dd68e712ba4ad78030a">dupsta</a>= 1; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a43317cb22427c977a3a4275612fbe9f0">dupend</a>= 100;
<a name="l07851"></a>07851             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07852"></a>07852         }
<a name="l07853"></a>07853     }
<a name="l07854"></a>07854     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 106) {
<a name="l07855"></a>07855         <span class="comment">/* mcol changed */</span>
<a name="l07856"></a>07856         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07857"></a>07857         <span class="keywordflow">while</span> (me) {
<a name="l07858"></a>07858             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>) <a class="code" href="../../d0/d12/readfile_8c.html#abc488726672b983d9963cf4a76478d79">vcol_to_fcol</a>(me);
<a name="l07859"></a>07859             me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07860"></a>07860         }
<a name="l07861"></a>07861 
<a name="l07862"></a>07862     }
<a name="l07863"></a>07863     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 107) {
<a name="l07864"></a>07864         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l07865"></a>07865         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07866"></a>07866         <span class="keywordflow">while</span> (sce) {
<a name="l07867"></a>07867             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#afdc2aa064250a4babf6e2d85ed68996e">R_GAMMA</a>;
<a name="l07868"></a>07868             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07869"></a>07869         }
<a name="l07870"></a>07870         ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07871"></a>07871         <span class="keywordflow">while</span> (ob) {
<a name="l07872"></a>07872             <span class="comment">//ob-&gt;ipoflag |= OB_OFFS_PARENT;</span>
<a name="l07873"></a>07873             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a>==0) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>;
<a name="l07874"></a>07874             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07875"></a>07875         }
<a name="l07876"></a>07876 
<a name="l07877"></a>07877     }
<a name="l07878"></a>07878     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 109) {
<a name="l07879"></a>07879         <span class="comment">/* new variable: gridlines */</span>
<a name="l07880"></a>07880         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07881"></a>07881         <span class="keywordflow">while</span> (sc) {
<a name="l07882"></a>07882             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07883"></a>07883             <span class="keywordflow">while</span> (sa) {
<a name="l07884"></a>07884                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07885"></a>07885                 <span class="keywordflow">while</span> (sl) {
<a name="l07886"></a>07886                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l07887"></a>07887                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l07888"></a>07888 
<a name="l07889"></a>07889                         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aadccf98762844bc1640c456817d65ae0">gridlines</a>==0) v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aadccf98762844bc1640c456817d65ae0">gridlines</a>= 20;
<a name="l07890"></a>07890                     }
<a name="l07891"></a>07891                     sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l07892"></a>07892                 }
<a name="l07893"></a>07893                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l07894"></a>07894             }
<a name="l07895"></a>07895             sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07896"></a>07896         }
<a name="l07897"></a>07897     }
<a name="l07898"></a>07898     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 113) {
<a name="l07899"></a>07899         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07900"></a>07900         <span class="keywordflow">while</span> (ma) {
<a name="l07901"></a>07901             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a5a107ffd20397491091f070d69614473">flaresize</a>==0.0f) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a5a107ffd20397491091f070d69614473">flaresize</a>= 1.0f;
<a name="l07902"></a>07902             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a788bcb90c43ad6367ca0882bc55df41b">subsize</a>= 1.0f;
<a name="l07903"></a>07903             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aea823bcf9064fd6c252eedf7b59e9b5e">flareboost</a>= 1.0f;
<a name="l07904"></a>07904             ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07905"></a>07905         }
<a name="l07906"></a>07906     }
<a name="l07907"></a>07907 
<a name="l07908"></a>07908     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 134) {
<a name="l07909"></a>07909         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07910"></a>07910         <span class="keywordflow">while</span> (tex) {
<a name="l07911"></a>07911             <span class="keywordflow">if</span> ((tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad627393d932868eea287edd7d76d7aba">rfac</a> == 0.0f) &amp;&amp;
<a name="l07912"></a>07912                 (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a74f05d2b0ff6e97bab4424c08412a1d9">gfac</a> == 0.0f) &amp;&amp;
<a name="l07913"></a>07913                 (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2406fedd0a48f45676edded341f48f1">bfac</a> == 0.0f)) {
<a name="l07914"></a>07914                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad627393d932868eea287edd7d76d7aba">rfac</a> = 1.0f;
<a name="l07915"></a>07915                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a74f05d2b0ff6e97bab4424c08412a1d9">gfac</a> = 1.0f;
<a name="l07916"></a>07916                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2406fedd0a48f45676edded341f48f1">bfac</a> = 1.0f;
<a name="l07917"></a>07917                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af4bade26865aad8551d7f436cf0f6555">filtersize</a> = 1.0f;
<a name="l07918"></a>07918             }
<a name="l07919"></a>07919             tex = tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07920"></a>07920         }
<a name="l07921"></a>07921     }
<a name="l07922"></a>07922     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 140) {
<a name="l07923"></a>07923         <span class="comment">/* r-g-b-fac in texture */</span>
<a name="l07924"></a>07924         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07925"></a>07925         <span class="keywordflow">while</span> (tex) {
<a name="l07926"></a>07926             <span class="keywordflow">if</span> ((tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad627393d932868eea287edd7d76d7aba">rfac</a> == 0.0f) &amp;&amp;
<a name="l07927"></a>07927                 (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a74f05d2b0ff6e97bab4424c08412a1d9">gfac</a> == 0.0f) &amp;&amp;
<a name="l07928"></a>07928                 (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2406fedd0a48f45676edded341f48f1">bfac</a> == 0.0f)) {
<a name="l07929"></a>07929                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad627393d932868eea287edd7d76d7aba">rfac</a> = 1.0f;
<a name="l07930"></a>07930                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a74f05d2b0ff6e97bab4424c08412a1d9">gfac</a> = 1.0f;
<a name="l07931"></a>07931                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2406fedd0a48f45676edded341f48f1">bfac</a> = 1.0f;
<a name="l07932"></a>07932                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af4bade26865aad8551d7f436cf0f6555">filtersize</a> = 1.0f;
<a name="l07933"></a>07933             }
<a name="l07934"></a>07934             tex = tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07935"></a>07935         }
<a name="l07936"></a>07936     }
<a name="l07937"></a>07937     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 153) {
<a name="l07938"></a>07938         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07939"></a>07939         <span class="keywordflow">while</span> (sce) {
<a name="l07940"></a>07940             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ab59dde67953fa33c205edf7c75041092">blurfac</a>==0.0f) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ab59dde67953fa33c205edf7c75041092">blurfac</a>= 1.0f;
<a name="l07941"></a>07941             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07942"></a>07942         }
<a name="l07943"></a>07943     }
<a name="l07944"></a>07944     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 163) {
<a name="l07945"></a>07945         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07946"></a>07946         <span class="keywordflow">while</span> (sce) {
<a name="l07947"></a>07947             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a071df993e13c05fc37e6f9a82c0679f5">frs_sec</a>==0) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a071df993e13c05fc37e6f9a82c0679f5">frs_sec</a>= 25;
<a name="l07948"></a>07948             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07949"></a>07949         }
<a name="l07950"></a>07950     }
<a name="l07951"></a>07951     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 164) {
<a name="l07952"></a>07952         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07953"></a>07953         <span class="keywordflow">while</span> (me) {
<a name="l07954"></a>07954             me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad97b68a3564c0ae6104727c0e854e7da">smoothresh</a>= 30;
<a name="l07955"></a>07955             me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07956"></a>07956         }
<a name="l07957"></a>07957     }
<a name="l07958"></a>07958     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 165) {
<a name="l07959"></a>07959         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07960"></a>07960         <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tface;
<a name="l07961"></a>07961         <span class="keywordtype">int</span> nr;
<a name="l07962"></a>07962         <span class="keywordtype">char</span> *cp;
<a name="l07963"></a>07963 
<a name="l07964"></a>07964         <span class="keywordflow">while</span> (me) {
<a name="l07965"></a>07965             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l07966"></a>07966                 nr= me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>;
<a name="l07967"></a>07967                 tface= me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>;
<a name="l07968"></a>07968                 <span class="keywordflow">while</span> (nr--) {
<a name="l07969"></a>07969                     cp= (<span class="keywordtype">char</span> *)&amp;tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[0];
<a name="l07970"></a>07970                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (cp[1]&gt;126) cp[1]= 255; <span class="keywordflow">else</span> cp[1]*=2;
<a name="l07971"></a>07971                     <span class="keywordflow">if</span> (cp[2]&gt;126) cp[2]= 255; <span class="keywordflow">else</span> cp[2]*=2;
<a name="l07972"></a>07972                     <span class="keywordflow">if</span> (cp[3]&gt;126) cp[3]= 255; <span class="keywordflow">else</span> cp[3]*=2;
<a name="l07973"></a>07973                     cp= (<span class="keywordtype">char</span> *)&amp;tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[1];
<a name="l07974"></a>07974                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (cp[1]&gt;126) cp[1]= 255; <span class="keywordflow">else</span> cp[1]*=2;
<a name="l07975"></a>07975                     <span class="keywordflow">if</span> (cp[2]&gt;126) cp[2]= 255; <span class="keywordflow">else</span> cp[2]*=2;
<a name="l07976"></a>07976                     <span class="keywordflow">if</span> (cp[3]&gt;126) cp[3]= 255; <span class="keywordflow">else</span> cp[3]*=2;
<a name="l07977"></a>07977                     cp= (<span class="keywordtype">char</span> *)&amp;tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[2];
<a name="l07978"></a>07978                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (cp[1]&gt;126) cp[1]= 255; <span class="keywordflow">else</span> cp[1]*=2;
<a name="l07979"></a>07979                     <span class="keywordflow">if</span> (cp[2]&gt;126) cp[2]= 255; <span class="keywordflow">else</span> cp[2]*=2;
<a name="l07980"></a>07980                     <span class="keywordflow">if</span> (cp[3]&gt;126) cp[3]= 255; <span class="keywordflow">else</span> cp[3]*=2;
<a name="l07981"></a>07981                     cp= (<span class="keywordtype">char</span> *)&amp;tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[3];
<a name="l07982"></a>07982                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (cp[1]&gt;126) cp[1]= 255; <span class="keywordflow">else</span> cp[1]*=2;
<a name="l07983"></a>07983                     <span class="keywordflow">if</span> (cp[2]&gt;126) cp[2]= 255; <span class="keywordflow">else</span> cp[2]*=2;
<a name="l07984"></a>07984                     <span class="keywordflow">if</span> (cp[3]&gt;126) cp[3]= 255; <span class="keywordflow">else</span> cp[3]*=2;
<a name="l07985"></a>07985 
<a name="l07986"></a>07986                     tface++;
<a name="l07987"></a>07987                 }
<a name="l07988"></a>07988             }
<a name="l07989"></a>07989             me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07990"></a>07990         }
<a name="l07991"></a>07991     }
<a name="l07992"></a>07992 
<a name="l07993"></a>07993     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 169) {
<a name="l07994"></a>07994         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l07995"></a>07995         <span class="keywordflow">while</span> (me) {
<a name="l07996"></a>07996             <span class="keywordflow">if</span> (me-&gt;subdiv==0) me-&gt;subdiv= 1;
<a name="l07997"></a>07997             me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l07998"></a>07998         }
<a name="l07999"></a>07999     }
<a name="l08000"></a>08000 
<a name="l08001"></a>08001     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 169) {
<a name="l08002"></a>08002         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08003"></a>08003         <span class="keywordflow">while</span> (sc) {
<a name="l08004"></a>08004             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08005"></a>08005             <span class="keywordflow">while</span> (sa) {
<a name="l08006"></a>08006                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08007"></a>08007                 <span class="keywordflow">while</span> (sl) {
<a name="l08008"></a>08008                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l08009"></a>08009                         <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a>*) sl;
<a name="l08010"></a>08010                         sipo-&gt;v2d.max[0]= 15000.0;
<a name="l08011"></a>08011                     }
<a name="l08012"></a>08012                     sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l08013"></a>08013                 }
<a name="l08014"></a>08014                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l08015"></a>08015             }
<a name="l08016"></a>08016             sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08017"></a>08017         }
<a name="l08018"></a>08018     }
<a name="l08019"></a>08019 
<a name="l08020"></a>08020     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 170) {
<a name="l08021"></a>08021         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08022"></a>08022         <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l08023"></a>08023         <span class="keywordflow">while</span> (ob) {
<a name="l08024"></a>08024             paf = <a class="code" href="../../d0/d12/readfile_8c.html#a821f02c4c74428a5a16f6574a9de1f25">do_version_give_parteff_245</a>(ob);
<a name="l08025"></a>08025             <span class="keywordflow">if</span> (paf) {
<a name="l08026"></a>08026                 <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a35916f19ad84ce6570174e9578b75616">staticstep</a> == 0) {
<a name="l08027"></a>08027                     paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a35916f19ad84ce6570174e9578b75616">staticstep</a>= 5;
<a name="l08028"></a>08028                 }
<a name="l08029"></a>08029             }
<a name="l08030"></a>08030             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08031"></a>08031         }
<a name="l08032"></a>08032     }
<a name="l08033"></a>08033 
<a name="l08034"></a>08034     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 171) {
<a name="l08035"></a>08035         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08036"></a>08036         <span class="keywordflow">while</span> (sc) {
<a name="l08037"></a>08037             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08038"></a>08038             <span class="keywordflow">while</span> (sa) {
<a name="l08039"></a>08039                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08040"></a>08040                 <span class="keywordflow">while</span> (sl) {
<a name="l08041"></a>08041                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02011ff3a4d991adb9b4c9360dd8b1c3">SPACE_TEXT</a>) {
<a name="l08042"></a>08042                         <a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *st= (<a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a>*) sl;
<a name="l08043"></a>08043                         st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#a92272c945c2d6e4673388f0a3a607a9c">lheight</a>= 12;
<a name="l08044"></a>08044                     }
<a name="l08045"></a>08045                     sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l08046"></a>08046                 }
<a name="l08047"></a>08047                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l08048"></a>08048             }
<a name="l08049"></a>08049             sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08050"></a>08050         }
<a name="l08051"></a>08051     }
<a name="l08052"></a>08052 
<a name="l08053"></a>08053     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 173) {
<a name="l08054"></a>08054         <span class="keywordtype">int</span> a, b;
<a name="l08055"></a>08055         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08056"></a>08056         <span class="keywordflow">while</span> (me) {
<a name="l08057"></a>08057             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l08058"></a>08058                 <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tface= me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>;
<a name="l08059"></a>08059                 <span class="keywordflow">for</span> (a=0; a&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; a++, tface++) {
<a name="l08060"></a>08060                     <span class="keywordflow">for</span> (b=0; b&lt;4; b++) {
<a name="l08061"></a>08061                         tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a36f22a7e271a19e77c16c5614e855e93">uv</a>[b][0]/= 32767.0f;
<a name="l08062"></a>08062                         tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a36f22a7e271a19e77c16c5614e855e93">uv</a>[b][1]/= 32767.0f;
<a name="l08063"></a>08063                     }
<a name="l08064"></a>08064                 }
<a name="l08065"></a>08065             }
<a name="l08066"></a>08066             me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08067"></a>08067         }
<a name="l08068"></a>08068     }
<a name="l08069"></a>08069 
<a name="l08070"></a>08070     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 191) {
<a name="l08071"></a>08071         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08072"></a>08072         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08073"></a>08073 
<a name="l08074"></a>08074         <span class="comment">/* let faces have default add factor of 0.0 */</span>
<a name="l08075"></a>08075         <span class="keywordflow">while</span> (ma) {
<a name="l08076"></a>08076           <span class="keywordflow">if</span> (!(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a0dcc062bc07ac15e934eccc6745eacbb">MA_HALO</a>)) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ae20db5cd76c043eb6e0f7c5b0200a485">add</a> = 0.0;
<a name="l08077"></a>08077           ma = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08078"></a>08078         }
<a name="l08079"></a>08079 
<a name="l08080"></a>08080         <span class="keywordflow">while</span> (ob) {
<a name="l08081"></a>08081             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a60866179af7cb2aad410ea01de546e4e">mass</a>= 1.0f;
<a name="l08082"></a>08082             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0f7412e63750dbfc2e4bd485ff7a9920">damping</a>= 0.1f;
<a name="l08083"></a>08083             <span class="comment">/*ob-&gt;quat[1]= 1.0f;*/</span> <span class="comment">/* quats arnt used yet */</span>
<a name="l08084"></a>08084             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08085"></a>08085         }
<a name="l08086"></a>08086     }
<a name="l08087"></a>08087 
<a name="l08088"></a>08088     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 193) {
<a name="l08089"></a>08089         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08090"></a>08090         <span class="keywordflow">while</span> (ob) {
<a name="l08091"></a>08091             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a068e01267176aa1f09b6651fc61ff6f7">inertia</a>= 1.0f;
<a name="l08092"></a>08092             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0216bf8bf0f5207ab1ff917f30305d79">rdamping</a>= 0.1f;
<a name="l08093"></a>08093             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08094"></a>08094         }
<a name="l08095"></a>08095     }
<a name="l08096"></a>08096 
<a name="l08097"></a>08097     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 196) {
<a name="l08098"></a>08098         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08099"></a>08099         <span class="keywordtype">int</span> a, b;
<a name="l08100"></a>08100         <span class="keywordflow">while</span> (me) {
<a name="l08101"></a>08101             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l08102"></a>08102                 <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tface= me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>;
<a name="l08103"></a>08103                 <span class="keywordflow">for</span> (a=0; a&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; a++, tface++) {
<a name="l08104"></a>08104                     <span class="keywordflow">for</span> (b=0; b&lt;4; b++) {
<a name="l08105"></a>08105                         tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a900724ac6d88d74e97229c8d7f0cf637">mode</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a6cfc000f74b41bf1072b95775a44c172">TF_DYNAMIC</a>;
<a name="l08106"></a>08106                         tface-&gt;<a class="code" href="../../df/de0/structTFace.html#a900724ac6d88d74e97229c8d7f0cf637">mode</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a84d8b9fb10efa0164911c832fc28739d">TF_INVISIBLE</a>;
<a name="l08107"></a>08107                     }
<a name="l08108"></a>08108                 }
<a name="l08109"></a>08109             }
<a name="l08110"></a>08110             me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08111"></a>08111         }
<a name="l08112"></a>08112     }
<a name="l08113"></a>08113 
<a name="l08114"></a>08114     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 200) {
<a name="l08115"></a>08115         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08116"></a>08116         <span class="keywordflow">while</span> (ob) {
<a name="l08117"></a>08117             ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae212b6fefec621cfbbff2c7250fc4a3c">scaflag</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa7e7ef49482d61ce8eae03477e35eb21">OB_DO_FH</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a257e9d5c2c0a383b74bb44ed50efcd81">OB_ROT_FH</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a750ae9f2372bacd245ffd29a89f983d2">OB_ANISOTROPIC_FRICTION</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af296003e3a9b1b16427b1cc72c2509d2">OB_GHOST</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a134c3f4cef16db08d3532d04adefa6fa">OB_RIGID_BODY</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a53ba2501623bb81463914897c276c1d3">OB_BOUNDS</a>);
<a name="l08118"></a>08118                 <span class="comment">/* 64 is do_fh */</span>
<a name="l08119"></a>08119             ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp;= ~(<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a257e9d5c2c0a383b74bb44ed50efcd81">OB_ROT_FH</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a750ae9f2372bacd245ffd29a89f983d2">OB_ANISOTROPIC_FRICTION</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af296003e3a9b1b16427b1cc72c2509d2">OB_GHOST</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a134c3f4cef16db08d3532d04adefa6fa">OB_RIGID_BODY</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a53ba2501623bb81463914897c276c1d3">OB_BOUNDS</a>);
<a name="l08120"></a>08120             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08121"></a>08121         }
<a name="l08122"></a>08122     }
<a name="l08123"></a>08123 
<a name="l08124"></a>08124     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 201) {
<a name="l08125"></a>08125         <span class="comment">/* add-object + end-object are joined to edit-object actuator */</span>
<a name="l08126"></a>08126         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08127"></a>08127         <a class="code" href="../../d8/d4a/structbProperty.html">bProperty</a> *prop;
<a name="l08128"></a>08128         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l08129"></a>08129         <a class="code" href="../../d1/d86/structbIpoActuator.html">bIpoActuator</a> *ia;
<a name="l08130"></a>08130         <a class="code" href="../../d4/d5c/structbEditObjectActuator.html">bEditObjectActuator</a> *eoa;
<a name="l08131"></a>08131         <a class="code" href="../../dd/dbe/structbAddObjectActuator.html">bAddObjectActuator</a> *aoa;
<a name="l08132"></a>08132         <span class="keywordflow">while</span> (ob) {
<a name="l08133"></a>08133             act = ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08134"></a>08134             <span class="keywordflow">while</span> (act) {
<a name="l08135"></a>08135                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a548a3bb674b346430996bd2431126833">ACT_IPO</a>) {
<a name="l08136"></a>08136                     ia= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l08137"></a>08137                     prop= <a class="code" href="../../d1/db8/BKE__property_8h.html#a5eb6a05f373ac49c852787f0f0603327">get_ob_property</a>(ob, ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#a71979f0c1b6fb85f2874411a13c267a7">name</a>);
<a name="l08138"></a>08138                     <span class="keywordflow">if</span> (prop) {
<a name="l08139"></a>08139                         ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#ab87205c10a80d10af8b8ff59feecdc0c">type</a>= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ac0708a5f5c1527673d5cc5d385ebfd02">ACT_IPO_FROM_PROP</a>;
<a name="l08140"></a>08140                     }
<a name="l08141"></a>08141                 }
<a name="l08142"></a>08142                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6550919fb970694bc25d165dd88d4309">ACT_ADD_OBJECT</a>) {
<a name="l08143"></a>08143                     aoa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l08144"></a>08144                     eoa= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5c/structbEditObjectActuator.html">bEditObjectActuator</a>), <span class="stringliteral">&quot;edit ob act&quot;</span>);
<a name="l08145"></a>08145                     eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a1027aca262f21abec88a12b8f871041b">type</a>= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a30e5ad3674fde2726f6e126c2660d860">ACT_EDOB_ADD_OBJECT</a>;
<a name="l08146"></a>08146                     eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a92767cd10e4f3f3564b295d418714088">ob</a>= aoa-&gt;<a class="code" href="../../dd/dbe/structbAddObjectActuator.html#a851f2a3455b87598a7ff8032c3e93f39">ob</a>;
<a name="l08147"></a>08147                     eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#aa116e73492ee11dc95844d66b586ac00">time</a>= aoa-&gt;<a class="code" href="../../dd/dbe/structbAddObjectActuator.html#ab6e096661bd939fc406d7515bf24c390">time</a>;
<a name="l08148"></a>08148                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(aoa);
<a name="l08149"></a>08149                     act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>= eoa;
<a name="l08150"></a>08150                     act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a3110f376c5613124c3ae2fba8e48bf54">otype</a>= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0fc0c7354c3624cb0a4b65934480a969">ACT_EDIT_OBJECT</a>;
<a name="l08151"></a>08151                 }
<a name="l08152"></a>08152                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a2001c1808b11da6d31d8d65a38a57016">ACT_END_OBJECT</a>) {
<a name="l08153"></a>08153                     eoa= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5c/structbEditObjectActuator.html">bEditObjectActuator</a>), <span class="stringliteral">&quot;edit ob act&quot;</span>);
<a name="l08154"></a>08154                     eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a1027aca262f21abec88a12b8f871041b">type</a>= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6d93c65c3d4194160bdacf27a26fe352">ACT_EDOB_END_OBJECT</a>;
<a name="l08155"></a>08155                     act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>= eoa;
<a name="l08156"></a>08156                     act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a3110f376c5613124c3ae2fba8e48bf54">otype</a>= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0fc0c7354c3624cb0a4b65934480a969">ACT_EDIT_OBJECT</a>;
<a name="l08157"></a>08157                 }
<a name="l08158"></a>08158                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l08159"></a>08159             }
<a name="l08160"></a>08160             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08161"></a>08161         }
<a name="l08162"></a>08162     }
<a name="l08163"></a>08163 
<a name="l08164"></a>08164     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 202) {
<a name="l08165"></a>08165         <span class="comment">/* add-object and end-object are joined to edit-object</span>
<a name="l08166"></a>08166 <span class="comment">         * actuator */</span>
<a name="l08167"></a>08167         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08168"></a>08168         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l08169"></a>08169         <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *oa;
<a name="l08170"></a>08170         <span class="keywordflow">while</span> (ob) {
<a name="l08171"></a>08171             act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08172"></a>08172             <span class="keywordflow">while</span> (act) {
<a name="l08173"></a>08173                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l08174"></a>08174                     oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l08175"></a>08175                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a9fb09fe389a9461bb9aef79a8850da06">flag</a> &amp;= ~(<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6d1f84c3220fad240056cb7d18be9aa8">ACT_TORQUE_LOCAL</a>|<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ad0dceff4b72f2c3e82521a6db3815c42">ACT_DROT_LOCAL</a>);     <span class="comment">/* this actuator didn&#39;t do local/glob rot before */</span>
<a name="l08176"></a>08176                 }
<a name="l08177"></a>08177                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l08178"></a>08178             }
<a name="l08179"></a>08179             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08180"></a>08180         }
<a name="l08181"></a>08181     }
<a name="l08182"></a>08182 
<a name="l08183"></a>08183     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 204) {
<a name="l08184"></a>08184         <span class="comment">/* patches for new physics */</span>
<a name="l08185"></a>08185         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08186"></a>08186         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l08187"></a>08187         <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *oa;
<a name="l08188"></a>08188         <a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *sound;
<a name="l08189"></a>08189         <span class="keywordflow">while</span> (ob) {
<a name="l08190"></a>08190 
<a name="l08191"></a>08191             <span class="comment">/* please check this for demo20 files like</span>
<a name="l08192"></a>08192 <span class="comment">             * original Egypt levels etc.  converted</span>
<a name="l08193"></a>08193 <span class="comment">             * rotation factor of 50 is not workable */</span>
<a name="l08194"></a>08194             act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08195"></a>08195             <span class="keywordflow">while</span> (act) {
<a name="l08196"></a>08196                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l08197"></a>08197                     oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l08198"></a>08198 
<a name="l08199"></a>08199                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a8ae949fd3065c97275e20df388fd85dd">forceloc</a>[0]*= 25.0f;
<a name="l08200"></a>08200                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a8ae949fd3065c97275e20df388fd85dd">forceloc</a>[1]*= 25.0f;
<a name="l08201"></a>08201                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a8ae949fd3065c97275e20df388fd85dd">forceloc</a>[2]*= 25.0f;
<a name="l08202"></a>08202 
<a name="l08203"></a>08203                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#ac73562d11da9ddd65f2e634e0bd58535">forcerot</a>[0]*= 10.0f;
<a name="l08204"></a>08204                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#ac73562d11da9ddd65f2e634e0bd58535">forcerot</a>[1]*= 10.0f;
<a name="l08205"></a>08205                     oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#ac73562d11da9ddd65f2e634e0bd58535">forcerot</a>[2]*= 10.0f;
<a name="l08206"></a>08206                 }
<a name="l08207"></a>08207                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l08208"></a>08208             }
<a name="l08209"></a>08209             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08210"></a>08210         }
<a name="l08211"></a>08211 
<a name="l08212"></a>08212         sound = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08213"></a>08213         <span class="keywordflow">while</span> (sound) {
<a name="l08214"></a>08214             <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#af9dd369d781b776bba60c5d09942bdc3">volume</a> &lt; 0.01f) {
<a name="l08215"></a>08215                 sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#af9dd369d781b776bba60c5d09942bdc3">volume</a> = 1.0f;
<a name="l08216"></a>08216             }
<a name="l08217"></a>08217             sound = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08218"></a>08218         }
<a name="l08219"></a>08219     }
<a name="l08220"></a>08220 
<a name="l08221"></a>08221     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 205) {
<a name="l08222"></a>08222         <span class="comment">/* patches for new physics */</span>
<a name="l08223"></a>08223         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08224"></a>08224         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l08225"></a>08225         <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens;
<a name="l08226"></a>08226         <a class="code" href="../../d4/d5c/structbEditObjectActuator.html">bEditObjectActuator</a> *oa;
<a name="l08227"></a>08227         <a class="code" href="../../d5/dc2/structbRaySensor.html">bRaySensor</a> *rs;
<a name="l08228"></a>08228         <a class="code" href="../../d6/dc1/structbCollisionSensor.html">bCollisionSensor</a> *cs;
<a name="l08229"></a>08229         <span class="keywordflow">while</span> (ob) {
<a name="l08230"></a>08230             <span class="comment">/* Set anisotropic friction off for old objects,</span>
<a name="l08231"></a>08231 <span class="comment">             * values to 1.0.  */</span>
<a name="l08232"></a>08232             ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp;= ~<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a750ae9f2372bacd245ffd29a89f983d2">OB_ANISOTROPIC_FRICTION</a>;
<a name="l08233"></a>08233             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9aa1212ef790ff952c162f4a08eea073">anisotropicFriction</a>[0] = 1.0;
<a name="l08234"></a>08234             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9aa1212ef790ff952c162f4a08eea073">anisotropicFriction</a>[1] = 1.0;
<a name="l08235"></a>08235             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9aa1212ef790ff952c162f4a08eea073">anisotropicFriction</a>[2] = 1.0;
<a name="l08236"></a>08236 
<a name="l08237"></a>08237             act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08238"></a>08238             <span class="keywordflow">while</span> (act) {
<a name="l08239"></a>08239                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0fc0c7354c3624cb0a4b65934480a969">ACT_EDIT_OBJECT</a>) {
<a name="l08240"></a>08240                     <span class="comment">/* Zero initial velocity for newly</span>
<a name="l08241"></a>08241 <span class="comment">                     * added objects */</span>
<a name="l08242"></a>08242                     oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l08243"></a>08243                     oa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a72403d146ba11a85c3caa99cb9c7bb07">linVelocity</a>[0] = 0.0;
<a name="l08244"></a>08244                     oa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a72403d146ba11a85c3caa99cb9c7bb07">linVelocity</a>[1] = 0.0;
<a name="l08245"></a>08245                     oa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a72403d146ba11a85c3caa99cb9c7bb07">linVelocity</a>[2] = 0.0;
<a name="l08246"></a>08246                     oa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a0d1ab3e2f3a2e939e302e905b24c9d57">localflag</a> = 0;
<a name="l08247"></a>08247                 }
<a name="l08248"></a>08248                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l08249"></a>08249             }
<a name="l08250"></a>08250 
<a name="l08251"></a>08251             sens= ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08252"></a>08252             <span class="keywordflow">while</span> (sens) {
<a name="l08253"></a>08253                 <span class="comment">/* Extra fields for radar sensors. */</span>
<a name="l08254"></a>08254                 <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a> == <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a4666337cbfd0e85ec0b32f3e43a671aa">SENS_RADAR</a>) {
<a name="l08255"></a>08255                     <a class="code" href="../../dd/d9b/structbRadarSensor.html">bRadarSensor</a> *s = sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l08256"></a>08256                     s-&gt;<a class="code" href="../../dd/d9b/structbRadarSensor.html#ac722b226cf805cb895ee350dafb30f23">range</a> = 10000.0;
<a name="l08257"></a>08257                 }
<a name="l08258"></a>08258 
<a name="l08259"></a>08259                 <span class="comment">/* Pulsing: defaults for new sensors. */</span>
<a name="l08260"></a>08260                 <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a> != <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a77b83bb50a4e8694b2e0cc9a099eedff">SENS_ALWAYS</a>) {
<a name="l08261"></a>08261                     sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a3bdbc1cab6699b85590130a9a157d9f0">pulse</a> = 0;
<a name="l08262"></a>08262                     sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#aa6136be787e64ae4d83dd58267057d82">freq</a> = 0;
<a name="l08263"></a>08263                 }
<a name="l08264"></a>08264                 <span class="keywordflow">else</span> {
<a name="l08265"></a>08265                     sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a3bdbc1cab6699b85590130a9a157d9f0">pulse</a> = 1;
<a name="l08266"></a>08266                 }
<a name="l08267"></a>08267 
<a name="l08268"></a>08268                 <span class="comment">/* Invert: off. */</span>
<a name="l08269"></a>08269                 sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a812d681813ffbce7cf823cd693e3ed0e">invert</a> = 0;
<a name="l08270"></a>08270 
<a name="l08271"></a>08271                 <span class="comment">/* Collision and ray: default = trigger</span>
<a name="l08272"></a>08272 <span class="comment">                 * on property. The material field can</span>
<a name="l08273"></a>08273 <span class="comment">                 * remain empty. */</span>
<a name="l08274"></a>08274                 <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a> == <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a00aa646b78d2304aca726b78bd2d1aa4">SENS_COLLISION</a>) {
<a name="l08275"></a>08275                     cs = (<a class="code" href="../../d6/dc1/structbCollisionSensor.html">bCollisionSensor</a>*) sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l08276"></a>08276                     cs-&gt;<a class="code" href="../../d6/dc1/structbCollisionSensor.html#aa89af0fafccbd97c452b38cb6235f341">mode</a> = 0;
<a name="l08277"></a>08277                 }
<a name="l08278"></a>08278                 <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a> == <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a5ed95c49510097f187cd28aeeddd1491">SENS_RAY</a>) {
<a name="l08279"></a>08279                     rs = (<a class="code" href="../../d5/dc2/structbRaySensor.html">bRaySensor</a>*) sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l08280"></a>08280                     rs-&gt;<a class="code" href="../../d5/dc2/structbRaySensor.html#aad4fc1cf828cc7372c107ed47270e114">mode</a> = 0;
<a name="l08281"></a>08281                 }
<a name="l08282"></a>08282                 sens = sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>;
<a name="l08283"></a>08283             }
<a name="l08284"></a>08284             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08285"></a>08285         }
<a name="l08286"></a>08286         <span class="comment">/* have to check the exact multiplier */</span>
<a name="l08287"></a>08287     }
<a name="l08288"></a>08288 
<a name="l08289"></a>08289     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 211) {
<a name="l08290"></a>08290         <span class="comment">/* Render setting: per scene, the applicable gamma value</span>
<a name="l08291"></a>08291 <span class="comment">         * can be set. Default is 1.0, which means no</span>
<a name="l08292"></a>08292 <span class="comment">         * correction.  */</span>
<a name="l08293"></a>08293         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l08294"></a>08294         <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *oa;
<a name="l08295"></a>08295         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l08296"></a>08296 
<a name="l08297"></a>08297         <span class="comment">/* added alpha in obcolor */</span>
<a name="l08298"></a>08298         ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08299"></a>08299         <span class="keywordflow">while</span> (ob) {
<a name="l08300"></a>08300             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4c1b357960580f8c11b177ccf9ceccb8">col</a>[3]= 1.0;
<a name="l08301"></a>08301             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08302"></a>08302         }
<a name="l08303"></a>08303 
<a name="l08304"></a>08304         <span class="comment">/* added alpha in obcolor */</span>
<a name="l08305"></a>08305         ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08306"></a>08306         <span class="keywordflow">while</span> (ob) {
<a name="l08307"></a>08307             act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08308"></a>08308             <span class="keywordflow">while</span> (act) {
<a name="l08309"></a>08309                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l08310"></a>08310                     <span class="comment">/* multiply velocity with 50 in old files */</span>
<a name="l08311"></a>08311                     oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l08312"></a>08312                     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#adcd60099b2a8cf981bd7364d22575c9c">linearvelocity</a>[0]) &gt;= 0.01f)
<a name="l08313"></a>08313                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#adcd60099b2a8cf981bd7364d22575c9c">linearvelocity</a>[0] *= 50.0f;
<a name="l08314"></a>08314                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#adcd60099b2a8cf981bd7364d22575c9c">linearvelocity</a>[1]) &gt;= 0.01f)
<a name="l08315"></a>08315                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#adcd60099b2a8cf981bd7364d22575c9c">linearvelocity</a>[1] *= 50.0f;
<a name="l08316"></a>08316                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#adcd60099b2a8cf981bd7364d22575c9c">linearvelocity</a>[2]) &gt;= 0.01f)
<a name="l08317"></a>08317                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#adcd60099b2a8cf981bd7364d22575c9c">linearvelocity</a>[2] *= 50.0f;
<a name="l08318"></a>08318                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a3f97c13d7bd60ce6663a180db1c4b09d">angularvelocity</a>[0])&gt;=0.01f)
<a name="l08319"></a>08319                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a3f97c13d7bd60ce6663a180db1c4b09d">angularvelocity</a>[0] *= 50.0f;
<a name="l08320"></a>08320                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a3f97c13d7bd60ce6663a180db1c4b09d">angularvelocity</a>[1])&gt;=0.01f)
<a name="l08321"></a>08321                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a3f97c13d7bd60ce6663a180db1c4b09d">angularvelocity</a>[1] *= 50.0f;
<a name="l08322"></a>08322                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a3f97c13d7bd60ce6663a180db1c4b09d">angularvelocity</a>[2])&gt;=0.01f)
<a name="l08323"></a>08323                         oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a3f97c13d7bd60ce6663a180db1c4b09d">angularvelocity</a>[2] *= 50.0f;
<a name="l08324"></a>08324                 }
<a name="l08325"></a>08325                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l08326"></a>08326             }
<a name="l08327"></a>08327             ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08328"></a>08328         }
<a name="l08329"></a>08329     }
<a name="l08330"></a>08330 
<a name="l08331"></a>08331     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 212) {
<a name="l08332"></a>08332 
<a name="l08333"></a>08333         <a class="code" href="../../d9/dc6/structbSound.html">bSound</a>* sound;
<a name="l08334"></a>08334         <a class="code" href="../../d8/d4a/structbProperty.html">bProperty</a> *prop;
<a name="l08335"></a>08335         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l08336"></a>08336         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l08337"></a>08337 
<a name="l08338"></a>08338         sound = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08339"></a>08339         <span class="keywordflow">while</span> (sound)
<a name="l08340"></a>08340         {
<a name="l08341"></a>08341             sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#acafbe293846803a34a5b8e7916ed0bd4">max_gain</a> = 1.0;
<a name="l08342"></a>08342             sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a6d4a1c6677a81f0b6560b407c4dc6176">min_gain</a> = 0.0;
<a name="l08343"></a>08343             sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#adb5034a33a7b60d01d5cb4cb32ee1a0a">distance</a> = 1.0;
<a name="l08344"></a>08344 
<a name="l08345"></a>08345             <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#ae3a69a9ea18ff22bc066cd25ad3660e7">attenuation</a> &gt; 0.0f)
<a name="l08346"></a>08346                 sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a3359f77bc2f3c090848eee0746d7ae9e">flags</a> |= <a class="code" href="../../d1/d66/DNA__sound__types_8h.html#ac432068439ce729c93c9d632bd430c1a">SOUND_FLAGS_3D</a>;
<a name="l08347"></a>08347             <span class="keywordflow">else</span>
<a name="l08348"></a>08348                 sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a3359f77bc2f3c090848eee0746d7ae9e">flags</a> &amp;= ~<a class="code" href="../../d1/d66/DNA__sound__types_8h.html#ac432068439ce729c93c9d632bd430c1a">SOUND_FLAGS_3D</a>;
<a name="l08349"></a>08349 
<a name="l08350"></a>08350             sound = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08351"></a>08351         }
<a name="l08352"></a>08352 
<a name="l08353"></a>08353         ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08354"></a>08354 
<a name="l08355"></a>08355         <span class="keywordflow">while</span> (ob) {
<a name="l08356"></a>08356             prop= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a08b5ac6620501dec9b98cb9f8c9a1fa3">prop</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08357"></a>08357             <span class="keywordflow">while</span> (prop) {
<a name="l08358"></a>08358                 <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#aedc1fbeab4766cc2a0c5c54ced9e3d54">type</a> == <a class="code" href="../../de/d2b/DNA__property__types_8h.html#abb6ccd1d066f846f00d24ba95890807a">GPROP_TIME</a>) {
<a name="l08359"></a>08359                     <span class="comment">// convert old GPROP_TIME values from int to float</span>
<a name="l08360"></a>08360                     *((<span class="keywordtype">float</span> *)&amp;prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#ae2e33a29623167cbed18f813196181f2">data</a>) = (float) prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#ae2e33a29623167cbed18f813196181f2">data</a>;
<a name="l08361"></a>08361                 }
<a name="l08362"></a>08362 
<a name="l08363"></a>08363                 prop= prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a00f412f0af27917829febb5132a160d9">next</a>;
<a name="l08364"></a>08364             }
<a name="l08365"></a>08365             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08366"></a>08366         }
<a name="l08367"></a>08367 
<a name="l08368"></a>08368             <span class="comment">/* me-&gt;subdiv changed to reflect the actual reparametization</span>
<a name="l08369"></a>08369 <span class="comment">             * better, and smeshes were removed - if it was a smesh make</span>
<a name="l08370"></a>08370 <span class="comment">             * it a subsurf, and reset the subdiv level because subsurf</span>
<a name="l08371"></a>08371 <span class="comment">             * takes a lot more work to calculate.</span>
<a name="l08372"></a>08372 <span class="comment">             */</span>
<a name="l08373"></a>08373         <span class="keywordflow">for</span> (me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08374"></a>08374             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a>&amp;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#aa59c76e9709633faaa4a04ebd5224694">ME_SMESH</a>) {
<a name="l08375"></a>08375                 me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a>&amp;= ~<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#aa59c76e9709633faaa4a04ebd5224694">ME_SMESH</a>;
<a name="l08376"></a>08376                 me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a>|= <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a1e663aa11236b444df46dc98b8c26207">ME_SUBSURF</a>;
<a name="l08377"></a>08377 
<a name="l08378"></a>08378                 me-&gt;subdiv= 1;
<a name="l08379"></a>08379             }
<a name="l08380"></a>08380             <span class="keywordflow">else</span> {
<a name="l08381"></a>08381                 <span class="keywordflow">if</span> (me-&gt;subdiv&lt;2)
<a name="l08382"></a>08382                     me-&gt;subdiv= 1;
<a name="l08383"></a>08383                 <span class="keywordflow">else</span>
<a name="l08384"></a>08384                     me-&gt;subdiv--;
<a name="l08385"></a>08385             }
<a name="l08386"></a>08386         }
<a name="l08387"></a>08387     }
<a name="l08388"></a>08388 
<a name="l08389"></a>08389     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 220) {
<a name="l08390"></a>08390         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l08391"></a>08391         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l08392"></a>08392 
<a name="l08393"></a>08393         ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08394"></a>08394 
<a name="l08395"></a>08395         <span class="comment">/* adapt form factor in order to get the &#39;old&#39; physics</span>
<a name="l08396"></a>08396 <span class="comment">         * behavior back...*/</span>
<a name="l08397"></a>08397 
<a name="l08398"></a>08398         <span class="keywordflow">while</span> (ob) {
<a name="l08399"></a>08399             <span class="comment">/* in future, distinguish between different</span>
<a name="l08400"></a>08400 <span class="comment">             * object bounding shapes */</span>
<a name="l08401"></a>08401             ob-&gt;<a class="code" href="../../de/de7/structObject.html#af2829a0f4febb82506e7f5d2a99f8a3c">formfactor</a> = 0.4f;
<a name="l08402"></a>08402             <span class="comment">/* patch form factor , note that inertia equiv radius</span>
<a name="l08403"></a>08403 <span class="comment">             * of a rotation symmetrical obj */</span>
<a name="l08404"></a>08404             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a068e01267176aa1f09b6651fc61ff6f7">inertia</a> != 1.0f) {
<a name="l08405"></a>08405                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#af2829a0f4febb82506e7f5d2a99f8a3c">formfactor</a> /= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a068e01267176aa1f09b6651fc61ff6f7">inertia</a> * ob-&gt;<a class="code" href="../../de/de7/structObject.html#a068e01267176aa1f09b6651fc61ff6f7">inertia</a>;
<a name="l08406"></a>08406             }
<a name="l08407"></a>08407             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08408"></a>08408         }
<a name="l08409"></a>08409 
<a name="l08410"></a>08410             <span class="comment">/* Began using alpha component of vertex colors, but</span>
<a name="l08411"></a>08411 <span class="comment">             * old file vertex colors are undefined, reset them</span>
<a name="l08412"></a>08412 <span class="comment">             * to be fully opaque. -zr</span>
<a name="l08413"></a>08413 <span class="comment">             */</span>
<a name="l08414"></a>08414         <span class="keywordflow">for</span> (me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08415"></a>08415             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>) {
<a name="l08416"></a>08416                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l08417"></a>08417 
<a name="l08418"></a>08418                 <span class="keywordflow">for</span> (i=0; i&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>*4; i++) {
<a name="l08419"></a>08419                     <a class="code" href="../../db/d33/structMCol.html">MCol</a> *mcol= &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac9ed0f3506c7eeffb9d7aad8d6c254a7">mcol</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l08420"></a>08420                     mcol-&gt;<a class="code" href="../../db/d33/structMCol.html#ae1f8644ca2b94cebaac551081fcc20e1">a</a>= 255;
<a name="l08421"></a>08421                 }
<a name="l08422"></a>08422             }
<a name="l08423"></a>08423             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l08424"></a>08424                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j;
<a name="l08425"></a>08425 
<a name="l08426"></a>08426                 <span class="keywordflow">for</span> (i=0; i&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; i++) {
<a name="l08427"></a>08427                     <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tf= &amp;((<a class="code" href="../../df/de0/structTFace.html">TFace</a>*) me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l08428"></a>08428 
<a name="l08429"></a>08429                     <span class="keywordflow">for</span> (j=0; j&lt;4; j++) {
<a name="l08430"></a>08430                         <span class="keywordtype">char</span> *col= (<span class="keywordtype">char</span>*) &amp;tf-&gt;<a class="code" href="../../df/de0/structTFace.html#a29c2311303890e20e6e44c23a945bb20">col</a>[j];
<a name="l08431"></a>08431 
<a name="l08432"></a>08432                         col[0]= 255;
<a name="l08433"></a>08433                     }
<a name="l08434"></a>08434                 }
<a name="l08435"></a>08435             }
<a name="l08436"></a>08436         }
<a name="l08437"></a>08437     }
<a name="l08438"></a>08438     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 221) {
<a name="l08439"></a>08439         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08440"></a>08440 
<a name="l08441"></a>08441         <span class="comment">// new variables for std-alone player and runtime</span>
<a name="l08442"></a>08442         <span class="keywordflow">while</span> (sce) {
<a name="l08443"></a>08443 
<a name="l08444"></a>08444             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.xplay= 640;
<a name="l08445"></a>08445             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.yplay= 480;
<a name="l08446"></a>08446             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.freqplay= 60;
<a name="l08447"></a>08447 
<a name="l08448"></a>08448             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08449"></a>08449         }
<a name="l08450"></a>08450 
<a name="l08451"></a>08451     }
<a name="l08452"></a>08452     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 222) {
<a name="l08453"></a>08453         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08454"></a>08454 
<a name="l08455"></a>08455         <span class="comment">// new variables for std-alone player and runtime</span>
<a name="l08456"></a>08456         <span class="keywordflow">while</span> (sce) {
<a name="l08457"></a>08457 
<a name="l08458"></a>08458             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.depth= 32;
<a name="l08459"></a>08459 
<a name="l08460"></a>08460             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08461"></a>08461         }
<a name="l08462"></a>08462     }
<a name="l08463"></a>08463 
<a name="l08464"></a>08464 
<a name="l08465"></a>08465     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 223) {
<a name="l08466"></a>08466         <a class="code" href="../../dc/dbe/structVFont.html">VFont</a> *vf;
<a name="l08467"></a>08467         <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l08468"></a>08468         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l08469"></a>08469 
<a name="l08470"></a>08470         <span class="keywordflow">for</span> (vf= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abef2da7d5c3a1975eb74128e4d70c682">vfont</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; vf; vf= vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08471"></a>08471             <span class="keywordflow">if</span> (strcmp(vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#abd754d2a8b6a2241d7b7464d0a98d339">name</a>+<a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#abd754d2a8b6a2241d7b7464d0a98d339">name</a>)-6, <span class="stringliteral">&quot;.Bfont&quot;</span>)==0) {
<a name="l08472"></a>08472                 strcpy(vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#abd754d2a8b6a2241d7b7464d0a98d339">name</a>, <a class="code" href="../../de/dcc/DNA__vfont__types_8h.html#a6c156185941e8d7776c0536b0f392201">FO_BUILTIN_NAME</a>);
<a name="l08473"></a>08473             }
<a name="l08474"></a>08474         }
<a name="l08475"></a>08475 
<a name="l08476"></a>08476         <span class="comment">/* Old textures animate at 25 FPS */</span>
<a name="l08477"></a>08477         <span class="keywordflow">for</span> (ima = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ima; ima=ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08478"></a>08478             ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a4d2f39810177923c60e6e96ef06924f7">animspeed</a> = 25;
<a name="l08479"></a>08479         }
<a name="l08480"></a>08480 
<a name="l08481"></a>08481             <span class="comment">/* Zr remapped some keyboard codes to be linear (stupid zr) */</span>
<a name="l08482"></a>08482         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08483"></a>08483             <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens;
<a name="l08484"></a>08484 
<a name="l08485"></a>08485             <span class="keywordflow">for</span> (sens= ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sens; sens= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>) {
<a name="l08486"></a>08486                 <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a>==<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#ae40bccbe24a73af641991ecb2b04a76d">SENS_KEYBOARD</a>) {
<a name="l08487"></a>08487                     <a class="code" href="../../d1/d26/structbKeyboardSensor.html">bKeyboardSensor</a> *ks= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l08488"></a>08488 
<a name="l08489"></a>08489                     ks-&gt;<a class="code" href="../../d1/d26/structbKeyboardSensor.html#ae1f7d42087a841171d45598ef0840f0b">key</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a686dfdd6f292c778af89391076cf0b83">map_223_keybd_code_to_224_keybd_code</a>(ks-&gt;<a class="code" href="../../d1/d26/structbKeyboardSensor.html#ae1f7d42087a841171d45598ef0840f0b">key</a>);
<a name="l08490"></a>08490                     ks-&gt;<a class="code" href="../../d1/d26/structbKeyboardSensor.html#af50c979daaa462fcceadff07264e12a7">qual</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a686dfdd6f292c778af89391076cf0b83">map_223_keybd_code_to_224_keybd_code</a>(ks-&gt;<a class="code" href="../../d1/d26/structbKeyboardSensor.html#af50c979daaa462fcceadff07264e12a7">qual</a>);
<a name="l08491"></a>08491                     ks-&gt;<a class="code" href="../../d1/d26/structbKeyboardSensor.html#a71410ab8c5a47fea075885b385d6c8a5">qual2</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a686dfdd6f292c778af89391076cf0b83">map_223_keybd_code_to_224_keybd_code</a>(ks-&gt;<a class="code" href="../../d1/d26/structbKeyboardSensor.html#a71410ab8c5a47fea075885b385d6c8a5">qual2</a>);
<a name="l08492"></a>08492                 }
<a name="l08493"></a>08493             }
<a name="l08494"></a>08494         }
<a name="l08495"></a>08495     }
<a name="l08496"></a>08496     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 224) {
<a name="l08497"></a>08497         <a class="code" href="../../d9/dc6/structbSound.html">bSound</a>* sound;
<a name="l08498"></a>08498         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l08499"></a>08499         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l08500"></a>08500         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08501"></a>08501 
<a name="l08502"></a>08502         <span class="keywordflow">for</span> (sound=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sound; sound=sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08503"></a>08503             <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a>) {
<a name="l08504"></a>08504                 <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l08505"></a>08505                     sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a>;
<a name="l08506"></a>08506                 }
<a name="l08507"></a>08507                 sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l08508"></a>08508             }
<a name="l08509"></a>08509         }
<a name="l08510"></a>08510         <span class="comment">/* Make sure that old subsurf meshes don&#39;t have zero subdivision level for rendering */</span>
<a name="l08511"></a>08511         <span class="keywordflow">for</span> (me=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me=me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08512"></a>08512             <span class="keywordflow">if</span> ((me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a1e663aa11236b444df46dc98b8c26207">ME_SUBSURF</a>) &amp;&amp; (me-&gt;subdivr==0))
<a name="l08513"></a>08513                 me-&gt;subdivr=me-&gt;subdiv;
<a name="l08514"></a>08514         }
<a name="l08515"></a>08515 
<a name="l08516"></a>08516         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08517"></a>08517             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.stereomode = 1;  <span class="comment">// no stereo</span>
<a name="l08518"></a>08518         }
<a name="l08519"></a>08519 
<a name="l08520"></a>08520             <span class="comment">/* some oldfile patch, moved from set_func_space */</span>
<a name="l08521"></a>08521         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08522"></a>08522             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08523"></a>08523 
<a name="l08524"></a>08524             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08525"></a>08525                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08526"></a>08526 
<a name="l08527"></a>08527                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08528"></a>08528                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l08529"></a>08529                         <a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *sseq= (<a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a>*) sl;
<a name="l08530"></a>08530                         sseq-&gt;v2d.keeptot= 0;
<a name="l08531"></a>08531                     }
<a name="l08532"></a>08532                 }
<a name="l08533"></a>08533             }
<a name="l08534"></a>08534         }
<a name="l08535"></a>08535 
<a name="l08536"></a>08536     }
<a name="l08537"></a>08537 
<a name="l08538"></a>08538 
<a name="l08539"></a>08539     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 225) {
<a name="l08540"></a>08540         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo;
<a name="l08541"></a>08541         <span class="comment">/* Use Sumo for old games */</span>
<a name="l08542"></a>08542         <span class="keywordflow">for</span> (wo = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wo; wo= wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08543"></a>08543             wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad5c9ecc034252c4f223eaca72be39289">physicsEngine</a> = 2;
<a name="l08544"></a>08544         }
<a name="l08545"></a>08545     }
<a name="l08546"></a>08546 
<a name="l08547"></a>08547     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 227) {
<a name="l08548"></a>08548         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l08549"></a>08549         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l08550"></a>08550         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08551"></a>08551         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l08552"></a>08552 
<a name="l08553"></a>08553         <span class="comment">/* As of now, this insures that the transition from the old Track system</span>
<a name="l08554"></a>08554 <span class="comment">         * to the new full constraint Track is painless for everyone. - theeth</span>
<a name="l08555"></a>08555 <span class="comment">         */</span>
<a name="l08556"></a>08556         ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08557"></a>08557 
<a name="l08558"></a>08558         <span class="keywordflow">while</span> (ob) {
<a name="l08559"></a>08559             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list;
<a name="l08560"></a>08560             list = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l08561"></a>08561 
<a name="l08562"></a>08562             <span class="comment">/* check for already existing TrackTo constraint</span>
<a name="l08563"></a>08563 <span class="comment">             * set their track and up flag correctly */</span>
<a name="l08564"></a>08564 
<a name="l08565"></a>08565             <span class="keywordflow">if</span> (list) {
<a name="l08566"></a>08566                 <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l08567"></a>08567                 <span class="keywordflow">for</span> (curcon = list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l08568"></a>08568                     <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a0a299f49fea25012a0b3cf4fab903ad7">CONSTRAINT_TYPE_TRACKTO</a>) {
<a name="l08569"></a>08569                         <a class="code" href="../../dd/d05/structbTrackToConstraint.html">bTrackToConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l08570"></a>08570                         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad114fce525aa2f570e9b84abdd4076c2">trackflag</a>;
<a name="l08571"></a>08571                         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae7c8e191b4cc5210a05f7f1ac8fe0ef0">upflag</a>;
<a name="l08572"></a>08572                     }
<a name="l08573"></a>08573                 }
<a name="l08574"></a>08574             }
<a name="l08575"></a>08575 
<a name="l08576"></a>08576             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l08577"></a>08577                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l08578"></a>08578                     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l08579"></a>08579                     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l08580"></a>08580                     <span class="keywordflow">for</span> (pchan = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08581"></a>08581                          pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l08582"></a>08582                         <span class="keywordflow">for</span> (curcon = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08583"></a>08583                              curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l08584"></a>08584                             <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a0a299f49fea25012a0b3cf4fab903ad7">CONSTRAINT_TYPE_TRACKTO</a>) {
<a name="l08585"></a>08585                                 <a class="code" href="../../dd/d05/structbTrackToConstraint.html">bTrackToConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l08586"></a>08586                                 data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad114fce525aa2f570e9b84abdd4076c2">trackflag</a>;
<a name="l08587"></a>08587                                 data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae7c8e191b4cc5210a05f7f1ac8fe0ef0">upflag</a>;
<a name="l08588"></a>08588                             }
<a name="l08589"></a>08589                         }
<a name="l08590"></a>08590                     }
<a name="l08591"></a>08591                 }
<a name="l08592"></a>08592             }
<a name="l08593"></a>08593 
<a name="l08594"></a>08594             <span class="comment">/* Change Ob-&gt;Track in real TrackTo constraint */</span>
<a name="l08595"></a>08595             <a class="code" href="../../d0/d12/readfile_8c.html#af30ff8b22789c2549e3c3c0931701a1b">do_version_old_trackto_to_constraints</a>(ob);
<a name="l08596"></a>08596             
<a name="l08597"></a>08597             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08598"></a>08598         }
<a name="l08599"></a>08599 
<a name="l08600"></a>08600 
<a name="l08601"></a>08601         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08602"></a>08602             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a5721059082fb428686ccc3cd9ceaf2e1">mixrate</a> = 44100;
<a name="l08603"></a>08603             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#ae05139635d439bbf654f7f8be40a9eb1">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a2fe3c89fd26653e1280b9083a7ea445d">AUDIO_SCRUB</a>;
<a name="l08604"></a>08604             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af38446c2dfb68ef620bd015cd68aebd2">R_ENVMAP</a>;
<a name="l08605"></a>08605         }
<a name="l08606"></a>08606         <span class="comment">// init new shader vars</span>
<a name="l08607"></a>08607         <span class="keywordflow">for</span> (ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08608"></a>08608             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#afeb21165f67d74e9f7e790339ca84474">refrac</a>= 4.0f;
<a name="l08609"></a>08609             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abbaeac8374986ca82670ff0d7749c566">roughness</a>= 0.5f;
<a name="l08610"></a>08610             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aeef81449c94bb93de33d3fc0be563b9d">param</a>[0]= 0.5f;
<a name="l08611"></a>08611             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aeef81449c94bb93de33d3fc0be563b9d">param</a>[1]= 0.1f;
<a name="l08612"></a>08612             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aeef81449c94bb93de33d3fc0be563b9d">param</a>[2]= 0.1f;
<a name="l08613"></a>08613             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aeef81449c94bb93de33d3fc0be563b9d">param</a>[3]= 0.05f;
<a name="l08614"></a>08614         }
<a name="l08615"></a>08615         <span class="comment">// patch for old wrong max view2d settings, allows zooming out more</span>
<a name="l08616"></a>08616         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08617"></a>08617             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08618"></a>08618 
<a name="l08619"></a>08619             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08620"></a>08620                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08621"></a>08621 
<a name="l08622"></a>08622                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08623"></a>08623                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l08624"></a>08624                         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *sac= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *) sl;
<a name="l08625"></a>08625                         sac-&gt;v2d.max[0]= 32000;
<a name="l08626"></a>08626                     }
<a name="l08627"></a>08627                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l08628"></a>08628                         <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *sla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *) sl;
<a name="l08629"></a>08629                         sla-&gt;v2d.max[0]= 32000;
<a name="l08630"></a>08630                     }
<a name="l08631"></a>08631                 }
<a name="l08632"></a>08632             }
<a name="l08633"></a>08633         }
<a name="l08634"></a>08634     }
<a name="l08635"></a>08635     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 228) {
<a name="l08636"></a>08636         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l08637"></a>08637         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08638"></a>08638         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l08639"></a>08639 
<a name="l08640"></a>08640 
<a name="l08641"></a>08641         <span class="comment">/* As of now, this insures that the transition from the old Track system</span>
<a name="l08642"></a>08642 <span class="comment">         * to the new full constraint Track is painless for everyone.*/</span>
<a name="l08643"></a>08643         ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08644"></a>08644 
<a name="l08645"></a>08645         <span class="keywordflow">while</span> (ob) {
<a name="l08646"></a>08646             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list;
<a name="l08647"></a>08647             list = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l08648"></a>08648 
<a name="l08649"></a>08649             <span class="comment">/* check for already existing TrackTo constraint</span>
<a name="l08650"></a>08650 <span class="comment">             * set their track and up flag correctly */</span>
<a name="l08651"></a>08651 
<a name="l08652"></a>08652             <span class="keywordflow">if</span> (list) {
<a name="l08653"></a>08653                 <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l08654"></a>08654                 <span class="keywordflow">for</span> (curcon = list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l08655"></a>08655                     <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a0a299f49fea25012a0b3cf4fab903ad7">CONSTRAINT_TYPE_TRACKTO</a>) {
<a name="l08656"></a>08656                         <a class="code" href="../../dd/d05/structbTrackToConstraint.html">bTrackToConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l08657"></a>08657                         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad114fce525aa2f570e9b84abdd4076c2">trackflag</a>;
<a name="l08658"></a>08658                         data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae7c8e191b4cc5210a05f7f1ac8fe0ef0">upflag</a>;
<a name="l08659"></a>08659                     }
<a name="l08660"></a>08660                 }
<a name="l08661"></a>08661             }
<a name="l08662"></a>08662 
<a name="l08663"></a>08663             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l08664"></a>08664                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l08665"></a>08665                     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l08666"></a>08666                     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l08667"></a>08667                     <span class="keywordflow">for</span> (pchan = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08668"></a>08668                          pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l08669"></a>08669                         <span class="keywordflow">for</span> (curcon = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08670"></a>08670                              curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l08671"></a>08671                             <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a0a299f49fea25012a0b3cf4fab903ad7">CONSTRAINT_TYPE_TRACKTO</a>) {
<a name="l08672"></a>08672                                 <a class="code" href="../../dd/d05/structbTrackToConstraint.html">bTrackToConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l08673"></a>08673                                 data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad114fce525aa2f570e9b84abdd4076c2">trackflag</a>;
<a name="l08674"></a>08674                                 data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae7c8e191b4cc5210a05f7f1ac8fe0ef0">upflag</a>;
<a name="l08675"></a>08675                             }
<a name="l08676"></a>08676                         }
<a name="l08677"></a>08677                     }
<a name="l08678"></a>08678                 }
<a name="l08679"></a>08679             }
<a name="l08680"></a>08680 
<a name="l08681"></a>08681             ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08682"></a>08682         }
<a name="l08683"></a>08683 
<a name="l08684"></a>08684         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08685"></a>08685             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af38446c2dfb68ef620bd015cd68aebd2">R_ENVMAP</a>;
<a name="l08686"></a>08686         }
<a name="l08687"></a>08687 
<a name="l08688"></a>08688         <span class="comment">// convert old mainb values for new button panels</span>
<a name="l08689"></a>08689         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08690"></a>08690             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08691"></a>08691 
<a name="l08692"></a>08692             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08693"></a>08693                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08694"></a>08694 
<a name="l08695"></a>08695                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08696"></a>08696                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>) {
<a name="l08697"></a>08697                         <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts= (<a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *) sl;
<a name="l08698"></a>08698 
<a name="l08699"></a>08699                         sbuts-&gt;v2d.maxzoom= 1.2f;
<a name="l08700"></a>08700                         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#ae8238b88ae7fa51605a7c60fceb17994">align</a>= 1;    <span class="comment">/* horizontal default */</span>
<a name="l08701"></a>08701                     
<a name="l08702"></a>08702                         <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aa0c4b9a0ad5680891c83d03e93cc0859">BUTS_LAMP</a>) {
<a name="l08703"></a>08703                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a4a6756ae446ec6c5f99b6ef04ad1ce0f">CONTEXT_SHADING</a>;
<a name="l08704"></a>08704                             <span class="comment">//sbuts-&gt;tab[CONTEXT_SHADING]= TAB_SHADING_LAMP;</span>
<a name="l08705"></a>08705                         }
<a name="l08706"></a>08706                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ac06c7f659057b90c2f8dc62ac3741af8">BUTS_MAT</a>) {
<a name="l08707"></a>08707                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a4a6756ae446ec6c5f99b6ef04ad1ce0f">CONTEXT_SHADING</a>;
<a name="l08708"></a>08708                             <span class="comment">//sbuts-&gt;tab[CONTEXT_SHADING]= TAB_SHADING_MAT;</span>
<a name="l08709"></a>08709                         }
<a name="l08710"></a>08710                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ae190165a9867cb83ec2c55ca7a917988">BUTS_TEX</a>) {
<a name="l08711"></a>08711                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a4a6756ae446ec6c5f99b6ef04ad1ce0f">CONTEXT_SHADING</a>;
<a name="l08712"></a>08712                             <span class="comment">//sbuts-&gt;tab[CONTEXT_SHADING]= TAB_SHADING_TEX;</span>
<a name="l08713"></a>08713                         }
<a name="l08714"></a>08714                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a4bb773072f3a95252a78d02dd20879bd">BUTS_ANIM</a>) {
<a name="l08715"></a>08715                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a9217a5f025dc892c840be37e41222de4">CONTEXT_OBJECT</a>;
<a name="l08716"></a>08716                         }
<a name="l08717"></a>08717                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ac103872735c9af3881e8f2346d5aadce">BUTS_WORLD</a>) {
<a name="l08718"></a>08718                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aba9591440329a6e7ae2579869e4b44bc">CONTEXT_SCENE</a>;
<a name="l08719"></a>08719                             <span class="comment">//sbuts-&gt;tab[CONTEXT_SCENE]= TAB_SCENE_WORLD;</span>
<a name="l08720"></a>08720                         }
<a name="l08721"></a>08721                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a42e5407c09fa72ffae85d3e1343cb8c0">BUTS_RENDER</a>) {
<a name="l08722"></a>08722                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aba9591440329a6e7ae2579869e4b44bc">CONTEXT_SCENE</a>;
<a name="l08723"></a>08723                             <span class="comment">//sbuts-&gt;tab[CONTEXT_SCENE]= TAB_SCENE_RENDER;</span>
<a name="l08724"></a>08724                         }
<a name="l08725"></a>08725                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a6745c2c99c87905ce1d8c1015ae8813d">BUTS_GAME</a>) {
<a name="l08726"></a>08726                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a1a1b4092819bd280fe9303d20ee55367">CONTEXT_LOGIC</a>;
<a name="l08727"></a>08727                         }
<a name="l08728"></a>08728                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5d5d27c3036e3134b04120273b8e9b87">BUTS_FPAINT</a>) {
<a name="l08729"></a>08729                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a0c3080c273b739e22d91c06e68f5baa4">CONTEXT_EDITING</a>;
<a name="l08730"></a>08730                         }
<a name="l08731"></a>08731                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a10da615215e3a4d95071d83f2a08102c">BUTS_RADIO</a>) {
<a name="l08732"></a>08732                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a4a6756ae446ec6c5f99b6ef04ad1ce0f">CONTEXT_SHADING</a>;
<a name="l08733"></a>08733                             <span class="comment">//sbuts-&gt;tab[CONTEXT_SHADING]= TAB_SHADING_RAD;</span>
<a name="l08734"></a>08734                         }
<a name="l08735"></a>08735                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#abdc9f417aef2c72567905c144e044c4d">BUTS_CONSTRAINT</a>) {
<a name="l08736"></a>08736                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a9217a5f025dc892c840be37e41222de4">CONTEXT_OBJECT</a>;
<a name="l08737"></a>08737                         }
<a name="l08738"></a>08738                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ac561bd6e4e37c74a14acdfd55e68eb26">BUTS_SCRIPT</a>) {
<a name="l08739"></a>08739                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a9217a5f025dc892c840be37e41222de4">CONTEXT_OBJECT</a>;
<a name="l08740"></a>08740                         }
<a name="l08741"></a>08741                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a1c450947f42d3fb873bfa1739c0fc1bf">BUTS_EDIT</a>) {
<a name="l08742"></a>08742                             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a0c3080c273b739e22d91c06e68f5baa4">CONTEXT_EDITING</a>;
<a name="l08743"></a>08743                         }
<a name="l08744"></a>08744                         <span class="keywordflow">else</span> sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aba9591440329a6e7ae2579869e4b44bc">CONTEXT_SCENE</a>;
<a name="l08745"></a>08745                     }
<a name="l08746"></a>08746                 }
<a name="l08747"></a>08747             }
<a name="l08748"></a>08748         }
<a name="l08749"></a>08749     }
<a name="l08750"></a>08750     <span class="comment">/* ton: made this 230 instead of 229,</span>
<a name="l08751"></a>08751 <span class="comment">     * to be sure (tuho files) and this is a reliable check anyway</span>
<a name="l08752"></a>08752 <span class="comment">     * nevertheless, we might need to think over a fitness (initialize)</span>
<a name="l08753"></a>08753 <span class="comment">     * check apart from the do_versions() */</span>
<a name="l08754"></a>08754 
<a name="l08755"></a>08755     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 230) {
<a name="l08756"></a>08756         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08757"></a>08757 
<a name="l08758"></a>08758         <span class="comment">// new variable blockscale, for panels in any area</span>
<a name="l08759"></a>08759         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08760"></a>08760             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08761"></a>08761 
<a name="l08762"></a>08762             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08763"></a>08763                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08764"></a>08764 
<a name="l08765"></a>08765                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08766"></a>08766                     <span class="keywordflow">if</span> (sl-&gt;blockscale==0.0f) sl-&gt;blockscale= 0.7f;
<a name="l08767"></a>08767                     <span class="comment">/* added: 5x better zoom in for action */</span>
<a name="l08768"></a>08768                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l08769"></a>08769                         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *sac= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)sl;
<a name="l08770"></a>08770                         sac-&gt;v2d.maxzoom= 50;
<a name="l08771"></a>08771                     }
<a name="l08772"></a>08772                 }
<a name="l08773"></a>08773             }
<a name="l08774"></a>08774         }
<a name="l08775"></a>08775     }
<a name="l08776"></a>08776     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 231) {
<a name="l08777"></a>08777         <span class="comment">/* new bit flags for showing/hiding grid floor and axes */</span>
<a name="l08778"></a>08778         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08779"></a>08779         <span class="keywordflow">while</span> (sc) {
<a name="l08780"></a>08780             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08781"></a>08781             <span class="keywordflow">while</span> (sa) {
<a name="l08782"></a>08782                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08783"></a>08783                 <span class="keywordflow">while</span> (sl) {
<a name="l08784"></a>08784                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l08785"></a>08785                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l08786"></a>08786 
<a name="l08787"></a>08787                         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a>==0) {
<a name="l08788"></a>08788                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab1f13e12fbc9aa7dfde7a301ace8ad8c">V3D_SHOW_X</a>;
<a name="l08789"></a>08789                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a96ee39bb05d78d9409d861aec5d57026">V3D_SHOW_Y</a>;
<a name="l08790"></a>08790                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#aefc15bee33771395e1804b1d33b61969">V3D_SHOW_FLOOR</a>;
<a name="l08791"></a>08791                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> &amp;= ~<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a7a6ddc772c2839589a2b23ec7fed2d91">V3D_SHOW_Z</a>;
<a name="l08792"></a>08792                         }
<a name="l08793"></a>08793                     }
<a name="l08794"></a>08794                     sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l08795"></a>08795                 }
<a name="l08796"></a>08796                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l08797"></a>08797             }
<a name="l08798"></a>08798             sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08799"></a>08799         }
<a name="l08800"></a>08800     }
<a name="l08801"></a>08801     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 231) {
<a name="l08802"></a>08802         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08803"></a>08803         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08804"></a>08804         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l08805"></a>08805         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l08806"></a>08806         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l08807"></a>08807 
<a name="l08808"></a>08808         <span class="comment">/* introduction of raytrace */</span>
<a name="l08809"></a>08809         <span class="keywordflow">while</span> (ma) {
<a name="l08810"></a>08810             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a021f7ea9f2f7721c4e6be2677d269596">fresnel_tra_i</a>==0.0f) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a021f7ea9f2f7721c4e6be2677d269596">fresnel_tra_i</a>= 1.25f;
<a name="l08811"></a>08811             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a8388776b83c1862f3aa946aa7d77b2c1">fresnel_mir_i</a>==0.0f) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a8388776b83c1862f3aa946aa7d77b2c1">fresnel_mir_i</a>= 1.25f;
<a name="l08812"></a>08812 
<a name="l08813"></a>08813             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a2b8a16549ed40b119caf3c494e68c7cc">ang</a>= 1.0;
<a name="l08814"></a>08814             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a4087fa3af66c827a38ad6ed27d7970e8">ray_depth</a>= 2;
<a name="l08815"></a>08815             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a27faa604328ed5ef1ff9855f5242a024">ray_depth_tra</a>= 2;
<a name="l08816"></a>08816             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ae4a30ec1f7d7d6e01e60c93be89bdf2c">fresnel_tra</a>= 0.0;
<a name="l08817"></a>08817             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#af33839a470d13329493d8a28e68417d8">fresnel_mir</a>= 0.0;
<a name="l08818"></a>08818 
<a name="l08819"></a>08819             ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08820"></a>08820         }
<a name="l08821"></a>08821         sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08822"></a>08822         <span class="keywordflow">while</span> (sce) {
<a name="l08823"></a>08823             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ab2470ab7f3cab6d98975373adbb740c7">gauss</a>==0.0f) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ab2470ab7f3cab6d98975373adbb740c7">gauss</a>= 1.0f;
<a name="l08824"></a>08824             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08825"></a>08825         }
<a name="l08826"></a>08826         la= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08827"></a>08827         <span class="keywordflow">while</span> (la) {
<a name="l08828"></a>08828             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a22b3fe7b8602fb88d85a674a808c7931">k</a>==0.0f) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a22b3fe7b8602fb88d85a674a808c7931">k</a>= 1.0;
<a name="l08829"></a>08829             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#af22ba38163822e17a233759d29c5a8ee">ray_samp</a>==0) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#af22ba38163822e17a233759d29c5a8ee">ray_samp</a>= 1;
<a name="l08830"></a>08830             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1eab2e0a0269c41a83c6731e8836d8ec">ray_sampy</a>==0) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1eab2e0a0269c41a83c6731e8836d8ec">ray_sampy</a>= 1;
<a name="l08831"></a>08831             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6075ce6e5a2515afff50c800ebb70aa1">ray_sampz</a>==0) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6075ce6e5a2515afff50c800ebb70aa1">ray_sampz</a>= 1;
<a name="l08832"></a>08832             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a>==0.0f) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a>= 1.0f;
<a name="l08833"></a>08833             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a120b92de2b45623dac956c9caddaeac4">area_sizey</a>==0.0f) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a120b92de2b45623dac956c9caddaeac4">area_sizey</a>= 1.0f;
<a name="l08834"></a>08834             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ac5790fd0667da23f396f8c041557caaa">area_sizez</a>==0.0f) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ac5790fd0667da23f396f8c041557caaa">area_sizez</a>= 1.0f;
<a name="l08835"></a>08835             la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08836"></a>08836         }
<a name="l08837"></a>08837         wrld= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08838"></a>08838         <span class="keywordflow">while</span> (wrld) {
<a name="l08839"></a>08839             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8463b6c20ef9df165c862137d4781b8e">range</a>==0.0f) {
<a name="l08840"></a>08840                 wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8463b6c20ef9df165c862137d4781b8e">range</a>= 1.0f/wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a628fc632b3821fcc4f3872ffaa3c702d">exposure</a>;
<a name="l08841"></a>08841             }
<a name="l08842"></a>08842             wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08843"></a>08843         }
<a name="l08844"></a>08844 
<a name="l08845"></a>08845         <span class="comment">/* new bit flags for showing/hiding grid floor and axes */</span>
<a name="l08846"></a>08846 
<a name="l08847"></a>08847         <span class="keywordflow">while</span> (sc) {
<a name="l08848"></a>08848             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08849"></a>08849             <span class="keywordflow">while</span> (sa) {
<a name="l08850"></a>08850                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08851"></a>08851                 <span class="keywordflow">while</span> (sl) {
<a name="l08852"></a>08852                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l08853"></a>08853                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l08854"></a>08854 
<a name="l08855"></a>08855                         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a>==0) {
<a name="l08856"></a>08856                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab1f13e12fbc9aa7dfde7a301ace8ad8c">V3D_SHOW_X</a>;
<a name="l08857"></a>08857                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a96ee39bb05d78d9409d861aec5d57026">V3D_SHOW_Y</a>;
<a name="l08858"></a>08858                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#aefc15bee33771395e1804b1d33b61969">V3D_SHOW_FLOOR</a>;
<a name="l08859"></a>08859                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a37adbba9358d3056e49aa538bd0bd960">gridflag</a> &amp;= ~<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a7a6ddc772c2839589a2b23ec7fed2d91">V3D_SHOW_Z</a>;
<a name="l08860"></a>08860                         }
<a name="l08861"></a>08861                     }
<a name="l08862"></a>08862                     sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l08863"></a>08863                 }
<a name="l08864"></a>08864                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l08865"></a>08865             }
<a name="l08866"></a>08866             sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08867"></a>08867         }
<a name="l08868"></a>08868     }
<a name="l08869"></a>08869     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 232) {
<a name="l08870"></a>08870         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08871"></a>08871         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08872"></a>08872         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08873"></a>08873         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l08874"></a>08874 
<a name="l08875"></a>08875         <span class="keywordflow">while</span> (tex) {
<a name="l08876"></a>08876             <span class="keywordflow">if</span> ((tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa3d72a0e7a943da508e3f4c1cd1803e7">flag</a> &amp; (<a class="code" href="../../da/ddf/DNA__texture__types_8h.html#ab20d965b17d9413802f33b1c5f1803b1">TEX_CHECKER_ODD</a>+<a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a0b3134d323e259a4e18cf4ae5cb991f7">TEX_CHECKER_EVEN</a>))==0) {
<a name="l08877"></a>08877                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa3d72a0e7a943da508e3f4c1cd1803e7">flag</a> |= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#ab20d965b17d9413802f33b1c5f1803b1">TEX_CHECKER_ODD</a>;
<a name="l08878"></a>08878             }
<a name="l08879"></a>08879             <span class="comment">/* copied from kernel texture.c */</span>
<a name="l08880"></a>08880             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a203fd887682138213c912b11724ba022">ns_outscale</a>==0.0f) {
<a name="l08881"></a>08881                 <span class="comment">/* musgrave */</span>
<a name="l08882"></a>08882                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa3ea44d8bb6dc11999a1ede5a1317558">mg_H</a> = 1.0f;
<a name="l08883"></a>08883                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a55a6949f946fd0a7b3531906d67b445f">mg_lacunarity</a> = 2.0f;
<a name="l08884"></a>08884                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a82d883e5aa3f1bf631bc9f6d66eb994a">mg_octaves</a> = 2.0f;
<a name="l08885"></a>08885                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a5eb9fbe7d06d0483265ce8088944654e">mg_offset</a> = 1.0f;
<a name="l08886"></a>08886                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a6c5267d2eb220d6007101bb10e0d5337">mg_gain</a> = 1.0f;
<a name="l08887"></a>08887                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a203fd887682138213c912b11724ba022">ns_outscale</a> = 1.0f;
<a name="l08888"></a>08888                 <span class="comment">/* distnoise */</span>
<a name="l08889"></a>08889                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0e54dfba0b0788bbb76651f6e65749c7">dist_amount</a> = 1.0f;
<a name="l08890"></a>08890                 <span class="comment">/* voronoi */</span>
<a name="l08891"></a>08891                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#acb9c36bef38b25ddd926a32d70ef1f78">vn_w1</a> = 1.0f;
<a name="l08892"></a>08892                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a6b14d9bd1481f1a27aca089b17ee14c5">vn_mexp</a> = 2.5f;
<a name="l08893"></a>08893             }
<a name="l08894"></a>08894             tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08895"></a>08895         }
<a name="l08896"></a>08896 
<a name="l08897"></a>08897         <span class="keywordflow">while</span> (wrld) {
<a name="l08898"></a>08898             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a5b891e3f490c68964f2952a6febf51b8">aodist</a>==0.0f) {
<a name="l08899"></a>08899                 wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a5b891e3f490c68964f2952a6febf51b8">aodist</a>= 10.0f;
<a name="l08900"></a>08900                 wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a7d49a3469f1d5c5fee02251d0fd1efd7">aobias</a>= 0.05f;
<a name="l08901"></a>08901             }
<a name="l08902"></a>08902             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a055acb019560e974d4f42928edbbbb3e">aosamp</a>==0) wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a055acb019560e974d4f42928edbbbb3e">aosamp</a>= 5;
<a name="l08903"></a>08903             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8ac1ebb22534921871e73ed336d60883">aoenergy</a>==0.0f) wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8ac1ebb22534921871e73ed336d60883">aoenergy</a>= 1.0f;
<a name="l08904"></a>08904             wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08905"></a>08905         }
<a name="l08906"></a>08906 
<a name="l08907"></a>08907 
<a name="l08908"></a>08908         <span class="comment">// new variable blockscale, for panels in any area, do again because new</span>
<a name="l08909"></a>08909         <span class="comment">// areas didnt initialize it to 0.7 yet</span>
<a name="l08910"></a>08910         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08911"></a>08911             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08912"></a>08912             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08913"></a>08913                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08914"></a>08914                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08915"></a>08915                     <span class="keywordflow">if</span> (sl-&gt;blockscale==0.0f) sl-&gt;blockscale= 0.7f;
<a name="l08916"></a>08916 
<a name="l08917"></a>08917                     <span class="comment">/* added: 5x better zoom in for nla */</span>
<a name="l08918"></a>08918                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l08919"></a>08919                         <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l08920"></a>08920                         snla-&gt;v2d.maxzoom= 50;
<a name="l08921"></a>08921                     }
<a name="l08922"></a>08922                 }
<a name="l08923"></a>08923             }
<a name="l08924"></a>08924         }
<a name="l08925"></a>08925         sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08926"></a>08926         <span class="keywordflow">while</span> (sce) {
<a name="l08927"></a>08927             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a245118fb5febf8875cc7eeef054210f6">ocres</a>==0) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a245118fb5febf8875cc7eeef054210f6">ocres</a>= 64;
<a name="l08928"></a>08928             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08929"></a>08929         }
<a name="l08930"></a>08930 
<a name="l08931"></a>08931     }
<a name="l08932"></a>08932     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 233) {
<a name="l08933"></a>08933         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08934"></a>08934         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08935"></a>08935         <span class="comment">/* Object *ob= main-&gt;object.first; */</span>
<a name="l08936"></a>08936         
<a name="l08937"></a>08937         <span class="keywordflow">while</span> (ma) {
<a name="l08938"></a>08938             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a1b8c8eca26238a4bf54476f9e09d19e8">rampfac_col</a>==0.0f) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a1b8c8eca26238a4bf54476f9e09d19e8">rampfac_col</a>= 1.0;
<a name="l08939"></a>08939             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a8524a969b588adf479a52c46e981c746">rampfac_spec</a>==0.0f) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a8524a969b588adf479a52c46e981c746">rampfac_spec</a>= 1.0;
<a name="l08940"></a>08940             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a11ba77a658d68d24e7418729f30492a7">pr_lamp</a>==0) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a11ba77a658d68d24e7418729f30492a7">pr_lamp</a>= 3;
<a name="l08941"></a>08941             ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l08942"></a>08942         }
<a name="l08943"></a>08943         
<a name="l08944"></a>08944         <span class="comment">/* this should have been done loooong before! */</span>
<a name="l08945"></a>08945 <span class="preprocessor">#if 0   </span><span class="comment">/* deprecated in 2.5+ */</span>
<a name="l08946"></a>08946         <span class="keywordflow">while</span> (ob) {
<a name="l08947"></a>08947             <span class="keywordflow">if</span> (ob-&gt;ipowin==0) ob-&gt;ipowin= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>;
<a name="l08948"></a>08948             ob= ob-&gt;id.next;
<a name="l08949"></a>08949         }
<a name="l08950"></a>08950 <span class="preprocessor">#endif</span>
<a name="l08951"></a>08951 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08952"></a>08952             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08953"></a>08953             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08954"></a>08954                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08955"></a>08955                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08956"></a>08956                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l08957"></a>08957                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l08958"></a>08958                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5556e5caae70d11b0f6aacf0ebb02f2f">V3D_SELECT_OUTLINE</a>;
<a name="l08959"></a>08959                     }
<a name="l08960"></a>08960                 }
<a name="l08961"></a>08961             }
<a name="l08962"></a>08962         }
<a name="l08963"></a>08963     }
<a name="l08964"></a>08964 
<a name="l08965"></a>08965 
<a name="l08966"></a>08966     
<a name="l08967"></a>08967 
<a name="l08968"></a>08968     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 234) {
<a name="l08969"></a>08969         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo;
<a name="l08970"></a>08970         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l08971"></a>08971         
<a name="l08972"></a>08972         <span class="comment">// force sumo engine to be active</span>
<a name="l08973"></a>08973         <span class="keywordflow">for</span> (wo = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wo; wo= wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08974"></a>08974             <span class="keywordflow">if</span> (wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad5c9ecc034252c4f223eaca72be39289">physicsEngine</a>==0) wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad5c9ecc034252c4f223eaca72be39289">physicsEngine</a> = 2;
<a name="l08975"></a>08975         }
<a name="l08976"></a>08976         
<a name="l08977"></a>08977         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l08978"></a>08978             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l08979"></a>08979             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l08980"></a>08980                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l08981"></a>08981                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l08982"></a>08982                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l08983"></a>08983                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l08984"></a>08984                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab80fcf8e0e16083a2ef8e7ca72cb6a39">V3D_ZBUF_SELECT</a>;
<a name="l08985"></a>08985                     }
<a name="l08986"></a>08986                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02011ff3a4d991adb9b4c9360dd8b1c3">SPACE_TEXT</a>) {
<a name="l08987"></a>08987                         <a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *st= (<a class="code" href="../../de/d67/structSpaceText.html">SpaceText</a> *)sl;
<a name="l08988"></a>08988                         <span class="keywordflow">if</span> (st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#af84ce20b922dd8a0035e61af89a140f0">tabnumber</a>==0) st-&gt;<a class="code" href="../../de/d67/structSpaceText.html#af84ce20b922dd8a0035e61af89a140f0">tabnumber</a>= 2;
<a name="l08989"></a>08989                     }
<a name="l08990"></a>08990                 }
<a name="l08991"></a>08991             }
<a name="l08992"></a>08992         }
<a name="l08993"></a>08993     }
<a name="l08994"></a>08994     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 235) {
<a name="l08995"></a>08995         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08996"></a>08996         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l08997"></a>08997         <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l08998"></a>08998         <a class="code" href="../../d5/de9/structEditing.html">Editing</a> *ed;
<a name="l08999"></a>08999         
<a name="l09000"></a>09000         <span class="keywordflow">while</span> (tex) {
<a name="l09001"></a>09001             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a66a4a8d083ed2a61cbef84f9683e2829">nabla</a>==0.0f) tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a66a4a8d083ed2a61cbef84f9683e2829">nabla</a>= 0.025f;
<a name="l09002"></a>09002             tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l09003"></a>09003         }
<a name="l09004"></a>09004         <span class="keywordflow">while</span> (sce) {
<a name="l09005"></a>09005             ed= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>;
<a name="l09006"></a>09006             <span class="keywordflow">if</span> (ed) {
<a name="l09007"></a>09007                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l09008"></a>09008                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a>==<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#ac06b183625bca249c8c0d1168f907aeb">SEQ_IMAGE</a> || seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a>==<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af37f12bdb831d524294dcd62ff0a8805">SEQ_MOVIE</a>)
<a name="l09009"></a>09009                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> |= <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a59e3d72162cdd1e1655346fcd9963827">SEQ_MAKE_PREMUL</a>;
<a name="l09010"></a>09010                 }
<a name="l09011"></a>09011                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l09012"></a>09012             }
<a name="l09013"></a>09013             
<a name="l09014"></a>09014             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l09015"></a>09015         }
<a name="l09016"></a>09016     }
<a name="l09017"></a>09017     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 236) {
<a name="l09018"></a>09018         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09019"></a>09019         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a331d71d4f599b49bb6b38e48b7cfc7bf">camera</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09020"></a>09020         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l09021"></a>09021         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l09022"></a>09022 
<a name="l09023"></a>09023         <span class="keywordflow">while</span> (cam) {
<a name="l09024"></a>09024             <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a>==0.0f) {
<a name="l09025"></a>09025                 cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a>= 256.0f/cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>;
<a name="l09026"></a>09026                 <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#abd4c2c91f9398b35caaa737a7bc6da3b">type</a>==<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a75085da10f07c9a36e9a305ca2ecc6d8">CAM_ORTHO</a>) printf(<span class="stringliteral">&quot;NOTE: ortho render has changed, tweak new Camera &#39;scale&#39; value.\n&quot;</span>);
<a name="l09027"></a>09027             }
<a name="l09028"></a>09028             cam= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l09029"></a>09029         }
<a name="l09030"></a>09030         <span class="comment">/* set manipulator type */</span>
<a name="l09031"></a>09031         <span class="comment">/* force oops draw if depgraph was set*/</span>
<a name="l09032"></a>09032         <span class="comment">/* set time line var */</span>
<a name="l09033"></a>09033         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09034"></a>09034             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l09035"></a>09035             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l09036"></a>09036                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l09037"></a>09037                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l09038"></a>09038                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l09039"></a>09039                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l09040"></a>09040                         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4fe725baacd2dde9697fdc67f7449e8b">twtype</a>==0) v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4fe725baacd2dde9697fdc67f7449e8b">twtype</a>= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a1a81a4a704345e89a1e585acdcfba158">V3D_MANIP_TRANSLATE</a>;
<a name="l09041"></a>09041                     }
<a name="l09042"></a>09042                 }
<a name="l09043"></a>09043             }
<a name="l09044"></a>09044         }
<a name="l09045"></a>09045         <span class="comment">// init new shader vars</span>
<a name="l09046"></a>09046         <span class="keywordflow">for</span> (ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09047"></a>09047             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a40486a8cd163fec0286803a1f5396cf8">darkness</a>==0.0f) {
<a name="l09048"></a>09048                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a53416d0f8bb47b62e637ec8ebed26cbc">rms</a>=0.1f;
<a name="l09049"></a>09049                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a40486a8cd163fec0286803a1f5396cf8">darkness</a>=1.0f;
<a name="l09050"></a>09050             }
<a name="l09051"></a>09051         }
<a name="l09052"></a>09052         
<a name="l09053"></a>09053         <span class="comment">/* softbody init new vars */</span>
<a name="l09054"></a>09054         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09055"></a>09055             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>) {
<a name="l09056"></a>09056                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a8c589742e3c220bc85a6c9b657138f5f">defgoal</a>==0.0f) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a8c589742e3c220bc85a6c9b657138f5f">defgoal</a>= 0.7f;
<a name="l09057"></a>09057                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a51a881ede8746efc91ae434a7cab9343">physics_speed</a>==0.0f) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a51a881ede8746efc91ae434a7cab9343">physics_speed</a>= 1.0f;
<a name="l09058"></a>09058                 
<a name="l09059"></a>09059                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a351d7a4918827ed45e707a70f6eeeac5">interval</a>==0) {
<a name="l09060"></a>09060                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a351d7a4918827ed45e707a70f6eeeac5">interval</a>= 2;
<a name="l09061"></a>09061                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a6f391b1b8c35dffcf8bfabeedcd6cf72">sfra</a>= 1;
<a name="l09062"></a>09062                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#aeab54dd692cac376d1341193b3f2a12f">efra</a>= 100;
<a name="l09063"></a>09063                 }
<a name="l09064"></a>09064             }
<a name="l09065"></a>09065             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#acee97df579f1c5a83f10bee47df9ea93">vertgroup</a>==0) {
<a name="l09066"></a>09066                 <a class="code" href="../../de/dad/structbDeformGroup.html">bDeformGroup</a> *locGroup = <a class="code" href="../../d7/dbd/BKE__deform_8h.html#abf203d5606ffc482e88b1d9c6ccffdce">defgroup_find_name</a>(ob, <span class="stringliteral">&quot;SOFTGOAL&quot;</span>);
<a name="l09067"></a>09067                 <span class="keywordflow">if</span> (locGroup) {
<a name="l09068"></a>09068                     <span class="comment">/* retrieve index for that group */</span>
<a name="l09069"></a>09069                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#acee97df579f1c5a83f10bee47df9ea93">vertgroup</a> =  1 + <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a11c2e3299c854eb361471ea041397cb7">defbase</a>, locGroup);
<a name="l09070"></a>09070                 }
<a name="l09071"></a>09071             }
<a name="l09072"></a>09072         }
<a name="l09073"></a>09073     }
<a name="l09074"></a>09074     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 237) {
<a name="l09075"></a>09075         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l09076"></a>09076         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l09077"></a>09077         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09078"></a>09078         <a class="code" href="../../de/de0/structBone.html">Bone</a> *bone;
<a name="l09079"></a>09079         
<a name="l09080"></a>09080         <span class="comment">// armature recode checks </span>
<a name="l09081"></a>09081         <span class="keywordflow">for</span> (arm= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; arm; arm= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09082"></a>09082             <a class="code" href="../../da/d17/BKE__armature_8h.html#a75f672c0ae20fab2d3bc0be46fc17c17">where_is_armature</a>(arm);
<a name="l09083"></a>09083 
<a name="l09084"></a>09084             <span class="keywordflow">for</span> (bone= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bone; bone= bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>)
<a name="l09085"></a>09085                 <a class="code" href="../../d0/d12/readfile_8c.html#a4247b66e4158b2e4d1aaff23f8d93f6c">do_version_bone_head_tail_237</a>(bone);
<a name="l09086"></a>09086         }
<a name="l09087"></a>09087         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09088"></a>09088             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>) {
<a name="l09089"></a>09089                 <a class="code" href="../../de/de7/structObject.html">Object</a> *parent= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l09090"></a>09090                 <span class="keywordflow">if</span> (parent &amp;&amp; parent-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>)
<a name="l09091"></a>09091                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af88b95b0ce3123f10e88d858cbb50f05">PARSKEL</a>;
<a name="l09092"></a>09092             }
<a name="l09093"></a>09093 
<a name="l09094"></a>09094             <span class="comment">// btw. armature_rebuild_pose is further only called on leave editmode</span>
<a name="l09095"></a>09095             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l09096"></a>09096                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>)
<a name="l09097"></a>09097                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483daa8b3bbff9fe194cbe52e3aad051a19a6">POSE_RECALC</a>;
<a name="l09098"></a>09098                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#acd3a68b1b095992c7f50c74a480549bd">OB_RECALC_TIME</a>;   <span class="comment">// cannot call stuff now (pointers!), done in setup_app_data</span>
<a name="l09099"></a>09099 
<a name="l09100"></a>09100                 <span class="comment">/* new generic xray option */</span>
<a name="l09101"></a>09101                 arm= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l09102"></a>09102                 <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac337b0eea0271aed9184660bb1973c1e">flag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad38d1c1c7e5b42142c4cc02bd6800837a6fa7f8e1612e21b486376162304cf3cd">ARM_DRAWXRAY</a>) {
<a name="l09103"></a>09103                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aec24cba637ae295c6076159bac9ff80d">OB_DRAWXRAY</a>;
<a name="l09104"></a>09104                 }
<a name="l09105"></a>09105             }
<a name="l09106"></a>09106             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l09107"></a>09107                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l09108"></a>09108                 
<a name="l09109"></a>09109                 <span class="keywordflow">if</span> ((me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a>&amp;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a1e663aa11236b444df46dc98b8c26207">ME_SUBSURF</a>)) {
<a name="l09110"></a>09110                     <a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a> *smd = (<a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1eb467ffa009a46723f1bf21be5fd730">eModifierType_Subsurf</a>);
<a name="l09111"></a>09111                     
<a name="l09112"></a>09112                     smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a64dfc0dbc8ce587b1e52733070241363">levels</a> = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(1, me-&gt;subdiv);
<a name="l09113"></a>09113                     smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#ae33b8e5900f6cf266e869afb917f32ee">renderLevels</a> = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(1, me-&gt;subdivr);
<a name="l09114"></a>09114                     smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#ac73fe5bff5b1eb4f16b894077e7cd074">subdivType</a> = me-&gt;subsurftype;
<a name="l09115"></a>09115                     
<a name="l09116"></a>09116                     smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a66c90155be286b750aaccfcc7341570b">modifier</a>.<a class="code" href="../../db/ddd/structModifierData.html#a905ab5cd625053441b2e82efe47e95d1">mode</a> = 0;
<a name="l09117"></a>09117                     <span class="keywordflow">if</span> (me-&gt;subdiv!=0)
<a name="l09118"></a>09118                         smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a66c90155be286b750aaccfcc7341570b">modifier</a>.<a class="code" href="../../db/ddd/structModifierData.html#a905ab5cd625053441b2e82efe47e95d1">mode</a> |= 1;
<a name="l09119"></a>09119                     <span class="keywordflow">if</span> (me-&gt;subdivr!=0)
<a name="l09120"></a>09120                         smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a66c90155be286b750aaccfcc7341570b">modifier</a>.<a class="code" href="../../db/ddd/structModifierData.html#a905ab5cd625053441b2e82efe47e95d1">mode</a> |= 2;
<a name="l09121"></a>09121                     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a>&amp;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a4803b5baf21bd97b001cb3d81dc499b9">ME_OPT_EDGES</a>)
<a name="l09122"></a>09122                         smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a855e94b53a58822910cd3f6826e72d2d">flags</a> |= <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#ac6b7c4d55e26c3c444a936564f87bff0ab14bf620bb2b426e1f1a9f94d5c53a2e">eSubsurfModifierFlag_ControlEdges</a>;
<a name="l09123"></a>09123                     
<a name="l09124"></a>09124                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, smd);
<a name="l09125"></a>09125                     
<a name="l09126"></a>09126                     <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a3a5b9d70c91ea8daeaf40173bad993e0">modifier_unique_name</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, (<a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a>*)smd);
<a name="l09127"></a>09127                 }
<a name="l09128"></a>09128             }
<a name="l09129"></a>09129             
<a name="l09130"></a>09130             <span class="comment">// follow path constraint needs to set the &#39;path&#39; option in curves...</span>
<a name="l09131"></a>09131             <span class="keywordflow">for</span> (con=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l09132"></a>09132                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adb7c70567fff24da35d0186e600ee38b">CONSTRAINT_TYPE_FOLLOWPATH</a>) {
<a name="l09133"></a>09133                     <a class="code" href="../../d4/dc4/structbFollowPathConstraint.html">bFollowPathConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09134"></a>09134                     <a class="code" href="../../de/de7/structObject.html">Object</a> *obc= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, data-&gt;<a class="code" href="../../d4/dc4/structbFollowPathConstraint.html#a1320da3c989f7d12ab1e706fb342243e">tar</a>);
<a name="l09135"></a>09135                     
<a name="l09136"></a>09136                     <span class="keywordflow">if</span> (obc &amp;&amp; obc-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l09137"></a>09137                         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, obc-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l09138"></a>09138                         <span class="keywordflow">if</span> (cu) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>;
<a name="l09139"></a>09139                     }
<a name="l09140"></a>09140                 }
<a name="l09141"></a>09141             }
<a name="l09142"></a>09142         }
<a name="l09143"></a>09143     }
<a name="l09144"></a>09144     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 238) {
<a name="l09145"></a>09145         <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt;
<a name="l09146"></a>09146         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09147"></a>09147         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l09148"></a>09148         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l09149"></a>09149         <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l09150"></a>09150         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09151"></a>09151 
<a name="l09152"></a>09152         <span class="keywordflow">while</span> (sce) {
<a name="l09153"></a>09153             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l09154"></a>09154                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a>),<span class="stringliteral">&quot;Tool Settings Struct&quot;</span>);    
<a name="l09155"></a>09155                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a786630a2f1ee3a74866655434692ebd8">cornertype</a>=0;
<a name="l09156"></a>09156                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a122188eb0fcc52a8bf2292d9b1c0079f">degr</a> = 90; 
<a name="l09157"></a>09157                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a20bbed20e36e465d8e57384cb061b72e">step</a> = 9;
<a name="l09158"></a>09158                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a4705c0af5b9c44d048756fc4b62f866c">turn</a> = 1;                
<a name="l09159"></a>09159                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#abcc0f759039f23e18c1ec77a35b2278f">extr_offs</a> = 1; 
<a name="l09160"></a>09160                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8548e36a4a0ab49542ed30ad5fb0f81f">doublimit</a> = 0.001f;
<a name="l09161"></a>09161                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8c8823ebde0350c2426179feae80bf57">segments</a> = 32;
<a name="l09162"></a>09162                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a499d29637864ecd23d92ce6cddea3aac">rings</a> = 32;
<a name="l09163"></a>09163                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a23917f0127ed1a0b34592ba2e90cc4cd">vertices</a> = 32;
<a name="l09164"></a>09164             }
<a name="l09165"></a>09165             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;  
<a name="l09166"></a>09166         }
<a name="l09167"></a>09167 
<a name="l09168"></a>09168         <span class="keywordflow">for</span> (lt=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acc71d9ddb63ba1e24a044109bb6bab45">latt</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lt; lt=lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09169"></a>09169             <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a890bcf536b70a54bbf247eb106baa4f1">fu</a>==0.0f &amp;&amp; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ab25bf3c22d3b315338e9612c0fa11ade">fv</a>==0.0f &amp;&amp; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ac8d406f2db096066240b9d96650de439">fw</a>==0.0f) {
<a name="l09170"></a>09170                 <a class="code" href="../../d8/d8f/BKE__lattice_8h.html#a6864cdf777d3ac562032c300bb2d804b">calc_lat_fudu</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a890bcf536b70a54bbf247eb106baa4f1">fu</a>, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ac4eda643c836dbf1f71fee8b489c1f64">du</a>);
<a name="l09171"></a>09171                 <a class="code" href="../../d8/d8f/BKE__lattice_8h.html#a6864cdf777d3ac562032c300bb2d804b">calc_lat_fudu</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ab25bf3c22d3b315338e9612c0fa11ade">fv</a>, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a5840fb570824b6a0c0bf46b8e3a2bf3c">dv</a>);
<a name="l09172"></a>09172                 <a class="code" href="../../d8/d8f/BKE__lattice_8h.html#a6864cdf777d3ac562032c300bb2d804b">calc_lat_fudu</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ac8d406f2db096066240b9d96650de439">fw</a>, &amp;lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae7e004214556e3101ef9287bcbfe7fda">dw</a>);
<a name="l09173"></a>09173             }
<a name="l09174"></a>09174         }
<a name="l09175"></a>09175 
<a name="l09176"></a>09176         <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09177"></a>09177             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l09178"></a>09178             <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l09179"></a>09179 
<a name="l09180"></a>09180             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l09181"></a>09181                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1eb467ffa009a46723f1bf21be5fd730">eModifierType_Subsurf</a>) {
<a name="l09182"></a>09182                     <a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a> *smd = (<a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a>*) md;
<a name="l09183"></a>09183 
<a name="l09184"></a>09184                     smd-&gt;<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a855e94b53a58822910cd3f6826e72d2d">flags</a> &amp;= ~(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#ac6b7c4d55e26c3c444a936564f87bff0a5a877d9411ae113ffb22ae1c6e362cbe">eSubsurfModifierFlag_Incremental</a>|<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#ac6b7c4d55e26c3c444a936564f87bff0ab0f07566b3d918742c0aeb35b64e5658">eSubsurfModifierFlag_DebugIncr</a>);
<a name="l09185"></a>09185                 }
<a name="l09186"></a>09186             }
<a name="l09187"></a>09187 
<a name="l09188"></a>09188             <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa4ef225512c8db13e0072175a82e5438">softflag</a>&amp;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a80401a8a47519dbd75083224e1bbdba4">OB_SB_ENABLE</a>) &amp;&amp; !<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ae1ec58b8e8caf9b712d9e318c1afebf7">eModifierType_Softbody</a>)) {
<a name="l09189"></a>09189                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa4ef225512c8db13e0072175a82e5438">softflag</a>&amp;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a6f30aa9a01eade040b759e82268ff532">OB_SB_POSTDEF</a>) {
<a name="l09190"></a>09190                     md = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09191"></a>09191 
<a name="l09192"></a>09192                     <span class="keywordflow">while</span> (md &amp;&amp; <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a837a63cd144446bec663f3a02e0ad397">modifierType_getInfo</a>(md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>)-&gt;<a class="code" href="../../db/dc5/structModifierTypeInfo.html#a7a7867ee9773d0b29fd0f4c9d3f390d0">type</a>==<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#abd2410bb81ff1d02c80627595bfc66a7a6f49a6768bd29306ee172bd8126bf4fc">eModifierTypeType_OnlyDeform</a>) {
<a name="l09193"></a>09193                         md = md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>;
<a name="l09194"></a>09194                     }
<a name="l09195"></a>09195 
<a name="l09196"></a>09196                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, md, <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ae1ec58b8e8caf9b712d9e318c1afebf7">eModifierType_Softbody</a>));
<a name="l09197"></a>09197                 }
<a name="l09198"></a>09198                 <span class="keywordflow">else</span> {
<a name="l09199"></a>09199                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ae1ec58b8e8caf9b712d9e318c1afebf7">eModifierType_Softbody</a>));
<a name="l09200"></a>09200                 }
<a name="l09201"></a>09201 
<a name="l09202"></a>09202                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa4ef225512c8db13e0072175a82e5438">softflag</a> &amp;= ~<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a80401a8a47519dbd75083224e1bbdba4">OB_SB_ENABLE</a>;
<a name="l09203"></a>09203             }
<a name="l09204"></a>09204             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l09205"></a>09205                 <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l09206"></a>09206                 <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l09207"></a>09207                 <span class="keywordflow">for</span> (pchan= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l09208"></a>09208                     <span class="comment">// note, pchan-&gt;bone is also lib-link stuff</span>
<a name="l09209"></a>09209                     <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[0] == 0.0f &amp;&amp; pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[0] == 0.0f) {
<a name="l09210"></a>09210                         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[0]= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[1]= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[2]= -180.0f;
<a name="l09211"></a>09211                         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[0]= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[1]= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[2]= 180.0f;
<a name="l09212"></a>09212                         
<a name="l09213"></a>09213                         <span class="keywordflow">for</span> (con= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l09214"></a>09214                             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) {
<a name="l09215"></a>09215                                 <a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a>*)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09216"></a>09216                                 data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a94763884fb93e57a4a80596528af859e">weight</a> = 1.0f;
<a name="l09217"></a>09217                                 data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a9107cfb0638ca19451f437441612ecd9">orientweight</a> = 1.0f;
<a name="l09218"></a>09218                                 data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ad7b9c9e543f98e483728044e9627fb14">flag</a> &amp;= ~<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a151d60aa5af580c422f4b8a2f855af5da0251808fa77e7c319acdfdfa82960545">CONSTRAINT_IK_ROT</a>;
<a name="l09219"></a>09219                                 
<a name="l09220"></a>09220                                 <span class="comment">/* enforce conversion from old IK_TOPARENT to rootbone index */</span>
<a name="l09221"></a>09221                                 data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#afb10d502fbc8bf3fce8f2994e355be56">rootbone</a>= -1;
<a name="l09222"></a>09222                                 
<a name="l09223"></a>09223                                 <span class="comment">/* update_pose_etc handles rootbone==-1 */</span>
<a name="l09224"></a>09224                                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483daa8b3bbff9fe194cbe52e3aad051a19a6">POSE_RECALC</a>;
<a name="l09225"></a>09225                             }   
<a name="l09226"></a>09226                         }
<a name="l09227"></a>09227                     }
<a name="l09228"></a>09228                 }
<a name="l09229"></a>09229             }
<a name="l09230"></a>09230 
<a name="l09231"></a>09231             paf = <a class="code" href="../../d0/d12/readfile_8c.html#a821f02c4c74428a5a16f6574a9de1f25">do_version_give_parteff_245</a>(ob);
<a name="l09232"></a>09232             <span class="keywordflow">if</span> (paf) {
<a name="l09233"></a>09233                 <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#aad88c76efeb31ca2a98b0e9bc19231d2">disp</a> == 0)
<a name="l09234"></a>09234                     paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#aad88c76efeb31ca2a98b0e9bc19231d2">disp</a> = 100;
<a name="l09235"></a>09235                 <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a741a2341effccbb02260e3e5f66aa438">speedtex</a> == 0)
<a name="l09236"></a>09236                     paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a741a2341effccbb02260e3e5f66aa438">speedtex</a> = 8;
<a name="l09237"></a>09237                 <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#abaf4862aefb7a2029de300cc25e86be6">omat</a> == 0)
<a name="l09238"></a>09238                     paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#abaf4862aefb7a2029de300cc25e86be6">omat</a> = 1;
<a name="l09239"></a>09239             }
<a name="l09240"></a>09240         }
<a name="l09241"></a>09241         
<a name="l09242"></a>09242         <span class="keywordflow">for</span> (arm=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; arm; arm= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09243"></a>09243             <a class="code" href="../../d0/d12/readfile_8c.html#a71aef27d3a39bc5d6f7b7ca74edfc2ca">bone_version_238</a>(&amp;arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>);
<a name="l09244"></a>09244             arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7c414a008b307fcd47b2441d93ae2213">deformflag</a> |= <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a8bf4daaf356d08df967fc2caf0d2bc00a5ed89fe6fa4c071ff20da36463151513">ARM_DEF_VGROUP</a>;
<a name="l09245"></a>09245         }
<a name="l09246"></a>09246 
<a name="l09247"></a>09247         <span class="keywordflow">for</span> (me=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09248"></a>09248             <span class="keywordflow">if</span> (!me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>) {
<a name="l09249"></a>09249                 <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a1d7225db424c9d245c694eb3b945bbf9">make_edges</a>(me, 1);  <span class="comment">/* 1 = use mface-&gt;edcode */</span>
<a name="l09250"></a>09250             }
<a name="l09251"></a>09251             <span class="keywordflow">else</span> {
<a name="l09252"></a>09252                 <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a4034d2a61eebc1551bef3dd98c7e25c0">mesh_strip_loose_faces</a>(me);
<a name="l09253"></a>09253             }
<a name="l09254"></a>09254         }
<a name="l09255"></a>09255         
<a name="l09256"></a>09256         <span class="keywordflow">for</span> (key= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1194bb31422b5ad4cd169ea17a08c0a6">key</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; key; key= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09257"></a>09257             <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l09258"></a>09258             <span class="keywordtype">int</span> index = 1;
<a name="l09259"></a>09259 
<a name="l09260"></a>09260             <span class="keywordflow">for</span> (kb= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kb; kb= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>) {
<a name="l09261"></a>09261                 <span class="keywordflow">if</span> (kb==key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>) {
<a name="l09262"></a>09262                     <span class="keywordflow">if</span> (kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a4602d856d6b6e5d9fa6f88dce66b5bb6">name</a>[0]==0)
<a name="l09263"></a>09263                         strcpy(kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a4602d856d6b6e5d9fa6f88dce66b5bb6">name</a>, <span class="stringliteral">&quot;Basis&quot;</span>);
<a name="l09264"></a>09264                 }
<a name="l09265"></a>09265                 <span class="keywordflow">else</span> {
<a name="l09266"></a>09266                     <span class="keywordflow">if</span> (kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a4602d856d6b6e5d9fa6f88dce66b5bb6">name</a>[0]==0) {
<a name="l09267"></a>09267                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a4602d856d6b6e5d9fa6f88dce66b5bb6">name</a>, <span class="keyword">sizeof</span>(kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a4602d856d6b6e5d9fa6f88dce66b5bb6">name</a>), <span class="stringliteral">&quot;Key %d&quot;</span>, index);
<a name="l09268"></a>09268                     }
<a name="l09269"></a>09269                     index++;
<a name="l09270"></a>09270                 }
<a name="l09271"></a>09271             }
<a name="l09272"></a>09272         }
<a name="l09273"></a>09273     }
<a name="l09274"></a>09274     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 239) {
<a name="l09275"></a>09275         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l09276"></a>09276         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09277"></a>09277         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09278"></a>09278         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a331d71d4f599b49bb6b38e48b7cfc7bf">camera</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09279"></a>09279         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09280"></a>09280         <span class="keywordtype">int</span> set_passepartout= 0;
<a name="l09281"></a>09281         
<a name="l09282"></a>09282         <span class="comment">/* deformflag is local in modifier now */</span>
<a name="l09283"></a>09283         <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09284"></a>09284             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l09285"></a>09285             
<a name="l09286"></a>09286             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l09287"></a>09287                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435aa45deecb66e254a60207702a40efa416">eModifierType_Armature</a>) {
<a name="l09288"></a>09288                     <a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a> *amd = (<a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a>*) md;
<a name="l09289"></a>09289                     <span class="keywordflow">if</span> (amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#a590e2df001575f79a07d66a7205ebe75">object</a> &amp;&amp; amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#a0af9660b6f13d55ac8950af32931b043">deformflag</a>==0) {
<a name="l09290"></a>09290                         <a class="code" href="../../de/de7/structObject.html">Object</a> *oba= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#a590e2df001575f79a07d66a7205ebe75">object</a>);
<a name="l09291"></a>09291                         arm= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, oba-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l09292"></a>09292                         amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#a0af9660b6f13d55ac8950af32931b043">deformflag</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7c414a008b307fcd47b2441d93ae2213">deformflag</a>;
<a name="l09293"></a>09293                     }
<a name="l09294"></a>09294                 }
<a name="l09295"></a>09295             }
<a name="l09296"></a>09296         }
<a name="l09297"></a>09297         
<a name="l09298"></a>09298         <span class="comment">/* updating stepsize for ghost drawing */</span>
<a name="l09299"></a>09299         <span class="keywordflow">for</span> (arm= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; arm; arm= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09300"></a>09300             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#add0acc61bcb6818daddc57195f14a07c">ghostsize</a>==0) arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#add0acc61bcb6818daddc57195f14a07c">ghostsize</a>=1;
<a name="l09301"></a>09301             <a class="code" href="../../d0/d12/readfile_8c.html#a01288dafacf4be92ea56be483dcbe874">bone_version_239</a>(&amp;arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>);
<a name="l09302"></a>09302             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac14cfbfc02b044a0a9b933dcbe002780">layer</a>==0) arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac14cfbfc02b044a0a9b933dcbe002780">layer</a>= 1;
<a name="l09303"></a>09303         }
<a name="l09304"></a>09304         
<a name="l09305"></a>09305         <span class="keywordflow">for</span> (;sce;sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09306"></a>09306             <span class="comment">/* make &#39;innervert&#39; the default subdivide type, for backwards compat */</span>
<a name="l09307"></a>09307             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a786630a2f1ee3a74866655434692ebd8">cornertype</a>=1;
<a name="l09308"></a>09308         
<a name="l09309"></a>09309             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad853a19c13a6c728a07b82fbb9f52bc6">scemode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a451a2e29a2db06eaa236653d238247a4">R_PASSEPARTOUT</a>) {
<a name="l09310"></a>09310                 set_passepartout= 1;
<a name="l09311"></a>09311                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad853a19c13a6c728a07b82fbb9f52bc6">scemode</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a451a2e29a2db06eaa236653d238247a4">R_PASSEPARTOUT</a>;
<a name="l09312"></a>09312             }
<a name="l09313"></a>09313             <span class="comment">/* gauss is filter variable now */</span>
<a name="l09314"></a>09314             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af11c60ce8b86e3483ed69a611cd70d10">R_GAUSS</a>) {
<a name="l09315"></a>09315                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4795ac457722fc5af529181f2c1259ab">filtertype</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119953142b5a77a099b57309faf761cc">R_FILTER_GAUSS</a>;
<a name="l09316"></a>09316                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af11c60ce8b86e3483ed69a611cd70d10">R_GAUSS</a>;
<a name="l09317"></a>09317             }
<a name="l09318"></a>09318         }
<a name="l09319"></a>09319         
<a name="l09320"></a>09320         <span class="keywordflow">for</span> (;cam; cam= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09321"></a>09321             <span class="keywordflow">if</span> (set_passepartout)
<a name="l09322"></a>09322                 cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> |= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a30f7e93e83ee6e0ccd626f68f7d08be4">CAM_SHOWPASSEPARTOUT</a>;
<a name="l09323"></a>09323             
<a name="l09324"></a>09324             <span class="comment">/* make sure old cameras have title safe on */</span>
<a name="l09325"></a>09325             <span class="keywordflow">if</span> (!(cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> &amp; <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a36b023062c4d496763eae938aa884e77">CAM_SHOWTITLESAFE</a>))
<a name="l09326"></a>09326                 cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> |= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a36b023062c4d496763eae938aa884e77">CAM_SHOWTITLESAFE</a>;
<a name="l09327"></a>09327             
<a name="l09328"></a>09328             <span class="comment">/* set an appropriate camera passepartout alpha */</span>
<a name="l09329"></a>09329             <span class="keywordflow">if</span> (!(cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab6d918212ec9726f3cb13d9ab1b26105">passepartalpha</a>)) cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab6d918212ec9726f3cb13d9ab1b26105">passepartalpha</a> = 0.2f;
<a name="l09330"></a>09330         }
<a name="l09331"></a>09331         
<a name="l09332"></a>09332         <span class="keywordflow">for</span> (; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09333"></a>09333             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa72afccc378741af6e29de2e20084420">strand_sta</a>==0.0f) {
<a name="l09334"></a>09334                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa72afccc378741af6e29de2e20084420">strand_sta</a>= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ac6a6784cdee68d2bafdea858c57dffcd">strand_end</a>= 1.0f;
<a name="l09335"></a>09335                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> |= <a class="code" href="../../de/db2/DNA__material__types_8h.html#a993de724ede213103155201135760761">MA_TANGENT_STR</a>;
<a name="l09336"></a>09336             }
<a name="l09337"></a>09337             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#acda2cb9524d4e603dae82a0ae552c1a2">MA_TRACEBLE</a>) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> |= <a class="code" href="../../de/db2/DNA__material__types_8h.html#a57a66e703cc7c97d7e2feb1f6b5bccc6">MA_SHADBUF</a>;
<a name="l09338"></a>09338         }
<a name="l09339"></a>09339     }
<a name="l09340"></a>09340     
<a name="l09341"></a>09341     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 241) {
<a name="l09342"></a>09342         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09343"></a>09343         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l09344"></a>09344         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l09345"></a>09345         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo;
<a name="l09346"></a>09346         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l09347"></a>09347         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l09348"></a>09348         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l09349"></a>09349         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l09350"></a>09350         
<a name="l09351"></a>09351         <span class="keywordflow">for</span> (wo = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wo; wo= wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09352"></a>09352             <span class="comment">/* Migrate to Bullet for games, except for the NaN versions */</span>
<a name="l09353"></a>09353             <span class="comment">/* People can still explicitly choose for Sumo (after 2.42 is out) */</span>
<a name="l09354"></a>09354             <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &gt; 225)
<a name="l09355"></a>09355                 wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad5c9ecc034252c4f223eaca72be39289">physicsEngine</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a0bc314c665abe5322ee096d610eca563">WOPHY_BULLET</a>;
<a name="l09356"></a>09356             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3b/DNA__world__types_8h.html#af9df71003fc7bf243ade0852c76fec5b">WO_AODIST</a> == wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a5cd59ca82119bab5bd4228f39e203ab4">aomode</a>)
<a name="l09357"></a>09357                 wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a1effce8171c99d65c3e8d3468223f7bf">aocolor</a>= <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#ac0edbc46dbeb07bbfca2204a4f04d4b9">WO_AOPLAIN</a>;
<a name="l09358"></a>09358         }
<a name="l09359"></a>09359         
<a name="l09360"></a>09360         <span class="comment">/* updating layers still */</span>
<a name="l09361"></a>09361         <span class="keywordflow">for</span> (arm= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; arm; arm= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09362"></a>09362             <a class="code" href="../../d0/d12/readfile_8c.html#a01288dafacf4be92ea56be483dcbe874">bone_version_239</a>(&amp;arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>);
<a name="l09363"></a>09363             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac14cfbfc02b044a0a9b933dcbe002780">layer</a>==0) arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac14cfbfc02b044a0a9b933dcbe002780">layer</a>= 1;
<a name="l09364"></a>09364         }
<a name="l09365"></a>09365         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09366"></a>09366             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a5721059082fb428686ccc3cd9ceaf2e1">mixrate</a>==0) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a5721059082fb428686ccc3cd9ceaf2e1">mixrate</a>= 44100;
<a name="l09367"></a>09367 
<a name="l09368"></a>09368             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ade972d7802ccc8bd375faec2bac270a1">xparts</a>&lt;2) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ade972d7802ccc8bd375faec2bac270a1">xparts</a>= 4;
<a name="l09369"></a>09369             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a663640f6f699dd2991f6866804d3bfa7">yparts</a>&lt;2) sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a663640f6f699dd2991f6866804d3bfa7">yparts</a>= 4;
<a name="l09370"></a>09370             <span class="comment">/* adds default layer */</span>
<a name="l09371"></a>09371             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l09372"></a>09372                 <a class="code" href="../../d8/d53/BKE__scene_8h.html#ad5651ef0505139e68b2e8e385427cea0">scene_add_render_layer</a>(sce, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l09373"></a>09373             <span class="keywordflow">else</span> {
<a name="l09374"></a>09374                 <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl;
<a name="l09375"></a>09375                 <span class="comment">/* new layer flag for sky, was default for solid */</span>
<a name="l09376"></a>09376                 <span class="keywordflow">for</span> (srl= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; srl; srl= srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a9363918698634136fa21bafcabd79d27">next</a>) {
<a name="l09377"></a>09377                     <span class="keywordflow">if</span> (srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a2152a87154b064e13a9b335933505cc6">layflag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b2084ff044d774e42508387794ae956">SCE_LAY_SOLID</a>)
<a name="l09378"></a>09378                         srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a2152a87154b064e13a9b335933505cc6">layflag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac89250f3ae17e3fbd8657471d02b57f2">SCE_LAY_SKY</a>;
<a name="l09379"></a>09379                     srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a88f32fbd005f0f6204f0ed0ffc625b36">passflag</a> &amp;= (<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4e038919a7298d42281bcef6eef0840d">SCE_PASS_COMBINED</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1ae908c61cd1d871b33f30bc2b16c13c">SCE_PASS_Z</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a53ae1d458dab251ffdcc0ccd5312f603">SCE_PASS_NORMAL</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad9100234bef25bcc5128c00fc612f7ca">SCE_PASS_VECTOR</a>);
<a name="l09380"></a>09380                 }
<a name="l09381"></a>09381             }
<a name="l09382"></a>09382             
<a name="l09383"></a>09383             <span class="comment">/* node version changes */</span>
<a name="l09384"></a>09384             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l09385"></a>09385                 <a class="code" href="../../d0/d12/readfile_8c.html#a334601bb9dce50a8cb5eec3fd53be2f4">ntree_version_241</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l09386"></a>09386 
<a name="l09387"></a>09387             <span class="comment">/* uv calculation options moved to toolsettings */</span>
<a name="l09388"></a>09388             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a916ca8303e4eb90c819b292d4d2b2c45">uvcalc_radius</a> == 0.0f) {
<a name="l09389"></a>09389                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a916ca8303e4eb90c819b292d4d2b2c45">uvcalc_radius</a> = 1.0f;
<a name="l09390"></a>09390                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ac1718494b204549b613bd37b062fd3c5">uvcalc_cubesize</a> = 1.0f;
<a name="l09391"></a>09391                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a24cec559c90ca0ac2c634e5a6a9a91f2">uvcalc_mapdir</a> = 1;
<a name="l09392"></a>09392                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a82145a1ec37b066b0b59a188b8c885b6">uvcalc_mapalign</a> = 1;
<a name="l09393"></a>09393                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae22831456ed7c2054a228b320f9d886a">UVCALC_FILLHOLES</a>;
<a name="l09394"></a>09394                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a91e80769ccac6cd72e63a8d5e04d7539">unwrapper</a> = 1;
<a name="l09395"></a>09395             }
<a name="l09396"></a>09396 
<a name="l09397"></a>09397             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a734c49fbcb5788988d667052995f4fa0">R_PANORAMA</a>) {
<a name="l09398"></a>09398                 <span class="comment">/* all these checks to ensure saved files with svn version keep working... */</span>
<a name="l09399"></a>09399                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afac89783028ff848f111de04e0c29fbe">xsch</a> &lt; sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aca3c1ebdf50a6c74730e19e24983217d">ysch</a>) {
<a name="l09400"></a>09400                     <a class="code" href="../../de/de7/structObject.html">Object</a> *obc= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>);
<a name="l09401"></a>09401                     <span class="keywordflow">if</span> (obc &amp;&amp; obc-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>) {
<a name="l09402"></a>09402                         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, obc-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l09403"></a>09403                         <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>&gt;=10.0f) {
<a name="l09404"></a>09404                             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afac89783028ff848f111de04e0c29fbe">xsch</a>*= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ade972d7802ccc8bd375faec2bac270a1">xparts</a>;
<a name="l09405"></a>09405                             cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>*= (float)sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aca3c1ebdf50a6c74730e19e24983217d">ysch</a>/(<span class="keywordtype">float</span>)sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afac89783028ff848f111de04e0c29fbe">xsch</a>;
<a name="l09406"></a>09406                         }
<a name="l09407"></a>09407                     }
<a name="l09408"></a>09408                 }
<a name="l09409"></a>09409             }
<a name="l09410"></a>09410         }
<a name="l09411"></a>09411         
<a name="l09412"></a>09412         <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09413"></a>09413             <a class="code" href="../../d0/d12/readfile_8c.html#a334601bb9dce50a8cb5eec3fd53be2f4">ntree_version_241</a>(ntree);
<a name="l09414"></a>09414         
<a name="l09415"></a>09415         <span class="keywordflow">for</span> (la= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; la; la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09416"></a>09416             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a7adcdd4f09af4fc5f72e8bf815fd0c51">buffers</a>==0)
<a name="l09417"></a>09417                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a7adcdd4f09af4fc5f72e8bf815fd0c51">buffers</a>= 1;
<a name="l09418"></a>09418         
<a name="l09419"></a>09419         <span class="keywordflow">for</span> (tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09420"></a>09420             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#ad779e991bd439bb9c4b571371e774a11">viewscale</a>==0.0f)
<a name="l09421"></a>09421                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>-&gt;<a class="code" href="../../d2/d48/structEnvMap.html#ad779e991bd439bb9c4b571371e774a11">viewscale</a>= 1.0f;
<a name="l09422"></a>09422 <span class="comment">//          tex-&gt;imaflag |= TEX_GAUSS_MIP;</span>
<a name="l09423"></a>09423         }
<a name="l09424"></a>09424         
<a name="l09425"></a>09425         <span class="comment">/* for empty drawsize and drawtype */</span>
<a name="l09426"></a>09426         <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09427"></a>09427             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f106829a25bed222ba018f0d6d4f54a">empty_drawsize</a>==0.0f) {
<a name="l09428"></a>09428                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7c962f95df9a7a7ccb78c59f1234e35c">empty_drawtype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad90dfce658bb46e6844de094b5734af9">OB_ARROWS</a>;
<a name="l09429"></a>09429                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f106829a25bed222ba018f0d6d4f54a">empty_drawsize</a> = 1.0;
<a name="l09430"></a>09430             }
<a name="l09431"></a>09431         }
<a name="l09432"></a>09432         
<a name="l09433"></a>09433         <span class="keywordflow">for</span> (ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09434"></a>09434             <span class="comment">/* stucci returns intensity from now on */</span>
<a name="l09435"></a>09435             <span class="keywordtype">int</span> a;
<a name="l09436"></a>09436             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l09437"></a>09437                 <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a] &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>) {
<a name="l09438"></a>09438                     tex= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l09439"></a>09439                     <span class="keywordflow">if</span> (tex &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a>==<a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a8c188992ebde707d32773f09a2d03d8f">TEX_STUCCI</a>)
<a name="l09440"></a>09440                         ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa28e86f4cbc4330e5e8518b11dcfbc61">mapto</a> &amp;= ~(<a class="code" href="../../de/db2/DNA__material__types_8h.html#af205394e8cf1225dd1746ef3fe0c08cb">MAP_COL</a>|<a class="code" href="../../de/db2/DNA__material__types_8h.html#ae611f4560e7b7acb33d645c437407cd4">MAP_SPEC</a>|<a class="code" href="../../de/db2/DNA__material__types_8h.html#afc80d6a261c2aad5ae750e1d5c163cce">MAP_REF</a>);
<a name="l09441"></a>09441                 }
<a name="l09442"></a>09442             }
<a name="l09443"></a>09443             <span class="comment">/* transmissivity defaults */</span>
<a name="l09444"></a>09444             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a92da5e6b0dcb7aaf12c465b8f40862c6">tx_falloff</a>==0.0f) ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a92da5e6b0dcb7aaf12c465b8f40862c6">tx_falloff</a>= 1.0f;
<a name="l09445"></a>09445         }
<a name="l09446"></a>09446         
<a name="l09447"></a>09447         <span class="comment">/* during 2.41 images with this name were used for viewer node output, lets fix that */</span>
<a name="l09448"></a>09448         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 241) {
<a name="l09449"></a>09449             <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l09450"></a>09450             <span class="keywordflow">for</span> (ima= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09451"></a>09451                 <span class="keywordflow">if</span> (strcmp(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#acfc924ea17aa360720ea5f9779620b84">name</a>, <span class="stringliteral">&quot;Compositor&quot;</span>)==0) {
<a name="l09452"></a>09452                     strcpy(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="stringliteral">&quot;Viewer Node&quot;</span>);
<a name="l09453"></a>09453                     strcpy(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#acfc924ea17aa360720ea5f9779620b84">name</a>, <span class="stringliteral">&quot;Viewer Node&quot;</span>);
<a name="l09454"></a>09454                 }
<a name="l09455"></a>09455         }
<a name="l09456"></a>09456     }
<a name="l09457"></a>09457         
<a name="l09458"></a>09458     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 242) {
<a name="l09459"></a>09459         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l09460"></a>09460         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l09461"></a>09461         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09462"></a>09462         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l09463"></a>09463         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l09464"></a>09464         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l09465"></a>09465         <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l09466"></a>09466         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l09467"></a>09467         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l09468"></a>09468         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l09469"></a>09469         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l09470"></a>09470         <span class="keywordtype">int</span> a;
<a name="l09471"></a>09471         
<a name="l09472"></a>09472         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09473"></a>09473             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l09474"></a>09474             sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09475"></a>09475             <span class="keywordflow">while</span> (sa) {
<a name="l09476"></a>09476                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l09477"></a>09477 
<a name="l09478"></a>09478                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l09479"></a>09479                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l09480"></a>09480                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l09481"></a>09481                         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a69fc4ce9fb26597c3bc6d254aaab798e">gridsubdiv</a> == 0)
<a name="l09482"></a>09482                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a69fc4ce9fb26597c3bc6d254aaab798e">gridsubdiv</a> = 10;
<a name="l09483"></a>09483                     }
<a name="l09484"></a>09484                 }
<a name="l09485"></a>09485                 sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l09486"></a>09486             }
<a name="l09487"></a>09487         }
<a name="l09488"></a>09488         
<a name="l09489"></a>09489         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09490"></a>09490             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a7abdee813c5d1b69023d7652f926c03d">select_thresh</a> == 0.0f)
<a name="l09491"></a>09491                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a7abdee813c5d1b69023d7652f926c03d">select_thresh</a>= 0.01f;
<a name="l09492"></a>09492             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#acf8b80c4ccd0ebc6662f9ae283b6054c">clean_thresh</a> == 0.0f) 
<a name="l09493"></a>09493                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#acf8b80c4ccd0ebc6662f9ae283b6054c">clean_thresh</a> = 0.1f;
<a name="l09494"></a>09494                 
<a name="l09495"></a>09495             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a9edbf2d157a2d3765e97eba62f07ff68">threads</a>==0) {
<a name="l09496"></a>09496                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4165c8a492ce233e24b88bab5de3b93d">R_THREADS</a>)
<a name="l09497"></a>09497                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a9edbf2d157a2d3765e97eba62f07ff68">threads</a>= 2;
<a name="l09498"></a>09498                 <span class="keywordflow">else</span>
<a name="l09499"></a>09499                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a9edbf2d157a2d3765e97eba62f07ff68">threads</a>= 1;
<a name="l09500"></a>09500             }
<a name="l09501"></a>09501             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l09502"></a>09502                 <a class="code" href="../../d0/d12/readfile_8c.html#a27023e78f913967ce6b61181e41f0d3a">ntree_version_242</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l09503"></a>09503         }
<a name="l09504"></a>09504         
<a name="l09505"></a>09505         <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09506"></a>09506             <a class="code" href="../../d0/d12/readfile_8c.html#a27023e78f913967ce6b61181e41f0d3a">ntree_version_242</a>(ntree);
<a name="l09507"></a>09507         
<a name="l09508"></a>09508         <span class="comment">/* add default radius values to old curve points */</span>
<a name="l09509"></a>09509         <span class="keywordflow">for</span> (cu= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cu; cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09510"></a>09510             <span class="keywordflow">for</span> (nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l09511"></a>09511                 <span class="keywordflow">if</span> (nu) {
<a name="l09512"></a>09512                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l09513"></a>09513                         <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, a=0; a&lt;nu-&gt;pntsu; a++, bezt++) {
<a name="l09514"></a>09514                             <span class="keywordflow">if</span> (!bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>= 1.0;
<a name="l09515"></a>09515                         }
<a name="l09516"></a>09516                     }
<a name="l09517"></a>09517                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l09518"></a>09518                         <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, a=0; a&lt;nu-&gt;pntsu*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++, bp++) {
<a name="l09519"></a>09519                             <span class="keywordflow">if</span> (!bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>) bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>= 1.0;
<a name="l09520"></a>09520                         }
<a name="l09521"></a>09521                     }
<a name="l09522"></a>09522                 }
<a name="l09523"></a>09523             }
<a name="l09524"></a>09524         }
<a name="l09525"></a>09525         
<a name="l09526"></a>09526         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09527"></a>09527             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l09528"></a>09528             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list;
<a name="l09529"></a>09529             list = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l09530"></a>09530 
<a name="l09531"></a>09531             <span class="comment">/* check for already existing MinMax (floor) constraint</span>
<a name="l09532"></a>09532 <span class="comment">             * and update the sticky flagging */</span>
<a name="l09533"></a>09533 
<a name="l09534"></a>09534             <span class="keywordflow">if</span> (list) {
<a name="l09535"></a>09535                 <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l09536"></a>09536                 <span class="keywordflow">for</span> (curcon = list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l09537"></a>09537                     <span class="keywordflow">switch</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>) {
<a name="l09538"></a>09538                         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a5912e6744cbb5720e1344e468ca35d8b">CONSTRAINT_TYPE_MINMAX</a>:
<a name="l09539"></a>09539                         {
<a name="l09540"></a>09540                             <a class="code" href="../../da/df5/structbMinMaxConstraint.html">bMinMaxConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09541"></a>09541                             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../da/df5/structbMinMaxConstraint.html#aa47ac5b57f2c33bf43c364d31780f6a2">sticky</a>==1) 
<a name="l09542"></a>09542                                 data-&gt;<a class="code" href="../../da/df5/structbMinMaxConstraint.html#ac23084ba7224a7198570234538db6d02">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a41cfcdba208cfec1a7d6feec2d8a7b18ad5d52512e6b4f1a429633c604e00e731">MINMAX_STICKY</a>;
<a name="l09543"></a>09543                             <span class="keywordflow">else</span> 
<a name="l09544"></a>09544                                 data-&gt;<a class="code" href="../../da/df5/structbMinMaxConstraint.html#ac23084ba7224a7198570234538db6d02">flag</a> &amp;= ~<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a41cfcdba208cfec1a7d6feec2d8a7b18ad5d52512e6b4f1a429633c604e00e731">MINMAX_STICKY</a>;
<a name="l09545"></a>09545                         }
<a name="l09546"></a>09546                             <span class="keywordflow">break</span>;
<a name="l09547"></a>09547                         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a70c9feed7fc4fb8e76891e7491245127">CONSTRAINT_TYPE_ROTLIKE</a>:
<a name="l09548"></a>09548                         {
<a name="l09549"></a>09549                             <a class="code" href="../../d1/d94/structbRotateLikeConstraint.html">bRotateLikeConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09550"></a>09550                             
<a name="l09551"></a>09551                             <span class="comment">/* version patch from buttons_object.c */</span>
<a name="l09552"></a>09552                             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d94/structbRotateLikeConstraint.html#af1f9cc9890259b0c816de1d4dcf3f1f0">flag</a>==0)
<a name="l09553"></a>09553                                 data-&gt;<a class="code" href="../../d1/d94/structbRotateLikeConstraint.html#af1f9cc9890259b0c816de1d4dcf3f1f0">flag</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#ad5448f9712fb6b78b391aa94b4a19206ab909c4e278e4ba22ad21b78e291baf58">ROTLIKE_X</a>|<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#ad5448f9712fb6b78b391aa94b4a19206a23f728c0c342ed552f6422d81d166633">ROTLIKE_Y</a>|<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#ad5448f9712fb6b78b391aa94b4a19206abc05707f128f403e9d8616def0b2eaca">ROTLIKE_Z</a>;
<a name="l09554"></a>09554                         }
<a name="l09555"></a>09555                             <span class="keywordflow">break</span>;
<a name="l09556"></a>09556                     }
<a name="l09557"></a>09557                 }
<a name="l09558"></a>09558             }
<a name="l09559"></a>09559 
<a name="l09560"></a>09560             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l09561"></a>09561                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l09562"></a>09562                     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l09563"></a>09563                     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l09564"></a>09564                     <span class="keywordflow">for</span> (pchan = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l09565"></a>09565                         <span class="keywordflow">for</span> (curcon = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l09566"></a>09566                             <span class="keywordflow">switch</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>) {
<a name="l09567"></a>09567                                 <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a5912e6744cbb5720e1344e468ca35d8b">CONSTRAINT_TYPE_MINMAX</a>:
<a name="l09568"></a>09568                                 {
<a name="l09569"></a>09569                                     <a class="code" href="../../da/df5/structbMinMaxConstraint.html">bMinMaxConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09570"></a>09570                                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../da/df5/structbMinMaxConstraint.html#aa47ac5b57f2c33bf43c364d31780f6a2">sticky</a>==1) 
<a name="l09571"></a>09571                                         data-&gt;<a class="code" href="../../da/df5/structbMinMaxConstraint.html#ac23084ba7224a7198570234538db6d02">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a41cfcdba208cfec1a7d6feec2d8a7b18ad5d52512e6b4f1a429633c604e00e731">MINMAX_STICKY</a>;
<a name="l09572"></a>09572                                     <span class="keywordflow">else</span> 
<a name="l09573"></a>09573                                         data-&gt;<a class="code" href="../../da/df5/structbMinMaxConstraint.html#ac23084ba7224a7198570234538db6d02">flag</a> &amp;= ~<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a41cfcdba208cfec1a7d6feec2d8a7b18ad5d52512e6b4f1a429633c604e00e731">MINMAX_STICKY</a>;
<a name="l09574"></a>09574                                 }
<a name="l09575"></a>09575                                     <span class="keywordflow">break</span>;
<a name="l09576"></a>09576                                 <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>:
<a name="l09577"></a>09577                                 {
<a name="l09578"></a>09578                                     <a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09579"></a>09579                                     <span class="keywordflow">if</span> (!(data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ad7b9c9e543f98e483728044e9627fb14">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a151d60aa5af580c422f4b8a2f855af5da75642965ec8713397d0e81cb9fa4f5d4">CONSTRAINT_IK_POS</a>)) {
<a name="l09580"></a>09580                                         data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ad7b9c9e543f98e483728044e9627fb14">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a151d60aa5af580c422f4b8a2f855af5da75642965ec8713397d0e81cb9fa4f5d4">CONSTRAINT_IK_POS</a>;
<a name="l09581"></a>09581                                         data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ad7b9c9e543f98e483728044e9627fb14">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a151d60aa5af580c422f4b8a2f855af5dac50fe615c0c820802234e6496ed59435">CONSTRAINT_IK_STRETCH</a>;
<a name="l09582"></a>09582                                     }
<a name="l09583"></a>09583                                 }
<a name="l09584"></a>09584                                     <span class="keywordflow">break</span>;
<a name="l09585"></a>09585                                 <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a70c9feed7fc4fb8e76891e7491245127">CONSTRAINT_TYPE_ROTLIKE</a>:
<a name="l09586"></a>09586                                 {
<a name="l09587"></a>09587                                     <a class="code" href="../../d1/d94/structbRotateLikeConstraint.html">bRotateLikeConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09588"></a>09588                                     
<a name="l09589"></a>09589                                     <span class="comment">/* version patch from buttons_object.c */</span>
<a name="l09590"></a>09590                                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d94/structbRotateLikeConstraint.html#af1f9cc9890259b0c816de1d4dcf3f1f0">flag</a>==0)
<a name="l09591"></a>09591                                         data-&gt;<a class="code" href="../../d1/d94/structbRotateLikeConstraint.html#af1f9cc9890259b0c816de1d4dcf3f1f0">flag</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#ad5448f9712fb6b78b391aa94b4a19206ab909c4e278e4ba22ad21b78e291baf58">ROTLIKE_X</a>|<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#ad5448f9712fb6b78b391aa94b4a19206a23f728c0c342ed552f6422d81d166633">ROTLIKE_Y</a>|<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#ad5448f9712fb6b78b391aa94b4a19206abc05707f128f403e9d8616def0b2eaca">ROTLIKE_Z</a>;
<a name="l09592"></a>09592                                 }
<a name="l09593"></a>09593                                     <span class="keywordflow">break</span>;
<a name="l09594"></a>09594                             }
<a name="l09595"></a>09595                         }
<a name="l09596"></a>09596                     }
<a name="l09597"></a>09597                 }
<a name="l09598"></a>09598             }
<a name="l09599"></a>09599             
<a name="l09600"></a>09600             <span class="comment">/* copy old object level track settings to curve modifers */</span>
<a name="l09601"></a>09601             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l09602"></a>09602                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a371fa9ace76cf450ce78e930aafdb2af">eModifierType_Curve</a>) {
<a name="l09603"></a>09603                     <a class="code" href="../../db/d18/structCurveModifierData.html">CurveModifierData</a> *cmd = (<a class="code" href="../../db/d18/structCurveModifierData.html">CurveModifierData</a>*) md;
<a name="l09604"></a>09604 
<a name="l09605"></a>09605                     <span class="keywordflow">if</span> (cmd-&gt;<a class="code" href="../../db/d18/structCurveModifierData.html#ab0f4c6094e1d95b54241e24ff26fedc4">defaxis</a> == 0) cmd-&gt;<a class="code" href="../../db/d18/structCurveModifierData.html#ab0f4c6094e1d95b54241e24ff26fedc4">defaxis</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad114fce525aa2f570e9b84abdd4076c2">trackflag</a>+1;
<a name="l09606"></a>09606                 }
<a name="l09607"></a>09607             }
<a name="l09608"></a>09608             
<a name="l09609"></a>09609         }
<a name="l09610"></a>09610         
<a name="l09611"></a>09611         <span class="keywordflow">for</span> (ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09612"></a>09612             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a0d7be284a93e101bc31ae4a3df31b9ce">shad_alpha</a>==0.0f)
<a name="l09613"></a>09613                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a0d7be284a93e101bc31ae4a3df31b9ce">shad_alpha</a>= 1.0f;
<a name="l09614"></a>09614             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l09615"></a>09615                 <a class="code" href="../../d0/d12/readfile_8c.html#a27023e78f913967ce6b61181e41f0d3a">ntree_version_242</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l09616"></a>09616         }
<a name="l09617"></a>09617 
<a name="l09618"></a>09618         <span class="keywordflow">for</span> (me=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me=me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09619"></a>09619             <a class="code" href="../../d0/d12/readfile_8c.html#a5e18fb337bdbe887db5233d4f3f08862">customdata_version_242</a>(me);
<a name="l09620"></a>09620         
<a name="l09621"></a>09621         <span class="keywordflow">for</span> (group= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09622"></a>09622             <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#aa803ef41a5ebcd860d3345e63c8d242c">layer</a>==0)
<a name="l09623"></a>09623                 group-&gt;<a class="code" href="../../d4/d91/structGroup.html#aa803ef41a5ebcd860d3345e63c8d242c">layer</a>= (1&lt;&lt;20)-1;
<a name="l09624"></a>09624 
<a name="l09625"></a>09625         <span class="comment">/* now, subversion control! */</span>
<a name="l09626"></a>09626         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3) {
<a name="l09627"></a>09627             <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l09628"></a>09628             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l09629"></a>09629             
<a name="l09630"></a>09630             <span class="comment">/* Image refactor initialize */</span>
<a name="l09631"></a>09631             <span class="keywordflow">for</span> (ima= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09632"></a>09632                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a868d306431889e6c2998ca2184fbe18e">source</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#ae1aaf40355c07c5707842c54ae386d96">IMA_SRC_FILE</a>;
<a name="l09633"></a>09633                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a80acd1ed9bc66fb3a9d45e146f6039f0">type</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#a848b9ca26aa15a6debaf59ae235767b1">IMA_TYPE_IMAGE</a>;
<a name="l09634"></a>09634                 
<a name="l09635"></a>09635                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ae2743f2730dbec2bfaf13aea66b99313">gen_x</a>= 256; ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a28c166f9b8c16b57b1777a60fd220f86">gen_y</a>= 256;
<a name="l09636"></a>09636                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a2700acc0fc1f66bbd958a93dac99ca85">gen_type</a>= 1;
<a name="l09637"></a>09637                 
<a name="l09638"></a>09638                 <span class="keywordflow">if</span> (0==strncmp(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="stringliteral">&quot;Viewer Node&quot;</span>, <span class="keyword">sizeof</span>(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)-2)) {
<a name="l09639"></a>09639                     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a868d306431889e6c2998ca2184fbe18e">source</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#ae7af40da3fa37e071c6ce12ac6f987da">IMA_SRC_VIEWER</a>;
<a name="l09640"></a>09640                     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a80acd1ed9bc66fb3a9d45e146f6039f0">type</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#a922dc453e6b157a2da1dc7ffb5fb19f6">IMA_TYPE_COMPOSITE</a>;
<a name="l09641"></a>09641                 }
<a name="l09642"></a>09642                 <span class="keywordflow">if</span> (0==strncmp(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="stringliteral">&quot;Render Result&quot;</span>, <span class="keyword">sizeof</span>(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)-2)) {
<a name="l09643"></a>09643                     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a868d306431889e6c2998ca2184fbe18e">source</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#ae7af40da3fa37e071c6ce12ac6f987da">IMA_SRC_VIEWER</a>;
<a name="l09644"></a>09644                     ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a80acd1ed9bc66fb3a9d45e146f6039f0">type</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#af8eec9b55a49c67ca1effbc2ccf43501">IMA_TYPE_R_RESULT</a>;
<a name="l09645"></a>09645                 }
<a name="l09646"></a>09646                 
<a name="l09647"></a>09647             }
<a name="l09648"></a>09648             <span class="keywordflow">for</span> (tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09649"></a>09649                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#af2375c975e2ce5925f9be76460a1f1c1">TEX_IMAGE</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2c2c4a8437672ea77fc9cfded61ffaf">ima</a>) {
<a name="l09650"></a>09650                     ima= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2c2c4a8437672ea77fc9cfded61ffaf">ima</a>);
<a name="l09651"></a>09651                     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a2f3d295e7caaecf01e345d12d195e76e">imaflag</a> &amp; <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a08f8af198b0dd3aa92d2bfe25589c29e">TEX_ANIM5_</a>)
<a name="l09652"></a>09652                         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a868d306431889e6c2998ca2184fbe18e">source</a>= <a class="code" href="../../d2/d77/BKE__image_8h.html#ad15772d6b95027902c77c6374ceac47b">IMA_SRC_MOVIE</a>;
<a name="l09653"></a>09653                     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a2f3d295e7caaecf01e345d12d195e76e">imaflag</a> &amp; <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a3040bf39f7180c0a02b97fd3deca6310">TEX_FIELDS_</a>)
<a name="l09654"></a>09654                         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a024d51a9f926340fb55740ad53b6d6ec">IMA_FIELDS</a>;
<a name="l09655"></a>09655                     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a2f3d295e7caaecf01e345d12d195e76e">imaflag</a> &amp; <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a6f674c1af00c5b4cd5a53b0e2e0c0e10">TEX_STD_FIELD_</a>)
<a name="l09656"></a>09656                         ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a3a52fcd61acebc5d734fcb820e62fabc">IMA_STD_FIELD</a>;
<a name="l09657"></a>09657                 }
<a name="l09658"></a>09658                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a86cb3e5ecb23a95da68893e43af1c52d">frames</a>= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a7a48a620d71931062bd72a5333873f7c">frames</a>;
<a name="l09659"></a>09659                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#ac4e828b08400ad8bc231081b1ba7969e">fie_ima</a>= (char)tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab0b0362c5711d42b3a2bce783f0cf616">fie_ima</a>;
<a name="l09660"></a>09660                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a576cb0077af7401c73e8634dee46a7f6">offset</a>= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a6abb486cf3fcf5963facdfe912bffe78">offset</a>;
<a name="l09661"></a>09661                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a69e7d2b76006d695daeaae9832df2c83">sfra</a>= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a6a3afde10b4f20169e03c615bd14f217">sfra</a>;
<a name="l09662"></a>09662                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#a22a1db60afef9af31dae54165dce922e">cycl</a>= (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a2f3d295e7caaecf01e345d12d195e76e">imaflag</a> &amp; <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#ab26a1199b64c61ae9d4c07209ff00102">TEX_ANIMCYCLIC_</a>)!=0;
<a name="l09663"></a>09663             }
<a name="l09664"></a>09664             <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09665"></a>09665                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l09666"></a>09666                     <a class="code" href="../../d0/d12/readfile_8c.html#a9326461e0726ca7b4e22d7679d6fb4f0">do_version_ntree_242_2</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l09667"></a>09667             }
<a name="l09668"></a>09668             <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09669"></a>09669                 <a class="code" href="../../d0/d12/readfile_8c.html#a9326461e0726ca7b4e22d7679d6fb4f0">do_version_ntree_242_2</a>(ntree);
<a name="l09670"></a>09670             <span class="keywordflow">for</span> (ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09671"></a>09671                 <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l09672"></a>09672                     <a class="code" href="../../d0/d12/readfile_8c.html#a9326461e0726ca7b4e22d7679d6fb4f0">do_version_ntree_242_2</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l09673"></a>09673             
<a name="l09674"></a>09674             <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09675"></a>09675                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l09676"></a>09676                 <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l09677"></a>09677                     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l09678"></a>09678                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l09679"></a>09679                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>)
<a name="l09680"></a>09680                             ((<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl)-&gt;iuser.fie_ima= 2;
<a name="l09681"></a>09681                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;spacetype==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l09682"></a>09682                             <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l09683"></a>09683                             <a class="code" href="../../df/da6/structBGpic.html">BGpic</a> *bgpic;
<a name="l09684"></a>09684                             <span class="keywordflow">for</span> (bgpic= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bgpic; bgpic= bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a81c485660f1feac2cfa5c5813153c2f0">next</a>)
<a name="l09685"></a>09685                                 bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a16f3925559495b9236d5e8160bc8f842">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#ac4e828b08400ad8bc231081b1ba7969e">fie_ima</a>= 2;
<a name="l09686"></a>09686                         }
<a name="l09687"></a>09687                     }
<a name="l09688"></a>09688                 }
<a name="l09689"></a>09689             }
<a name="l09690"></a>09690         }
<a name="l09691"></a>09691         
<a name="l09692"></a>09692         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4) {
<a name="l09693"></a>09693             <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09694"></a>09694                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4a91a25d74bbbdeccfa32513acbfde28">bake_mode</a>= 1;    <span class="comment">/* prevent to include render stuff here */</span>
<a name="l09695"></a>09695                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a6ad7d51845798984f1050c4314062829">bake_filter</a>= 2;
<a name="l09696"></a>09696                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a7921e15f247899a6f6cc1f9536472f62">bake_osa</a>= 5;
<a name="l09697"></a>09697                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5af2fa5d427f5c99a21dc98b5cc4e91c">bake_flag</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a14571df5abb1ae871ad447e5cff5b967">R_BAKE_CLEAR</a>;
<a name="l09698"></a>09698             }
<a name="l09699"></a>09699         }
<a name="l09700"></a>09700 
<a name="l09701"></a>09701         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 5) {
<a name="l09702"></a>09702             <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09703"></a>09703                 <span class="comment">/* improved triangle to quad conversion settings */</span>
<a name="l09704"></a>09704                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a05de0823fbeed87c090336365b74a65a">jointrilimit</a>==0.0f)
<a name="l09705"></a>09705                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a05de0823fbeed87c090336365b74a65a">jointrilimit</a>= 0.8f;
<a name="l09706"></a>09706             }
<a name="l09707"></a>09707         }
<a name="l09708"></a>09708     }
<a name="l09709"></a>09709     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 243) {
<a name="l09710"></a>09710         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09711"></a>09711         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l09712"></a>09712 
<a name="l09713"></a>09713         <span class="keywordflow">for</span> (ma=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09714"></a>09714             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a15b52d64d58c2e1c1219bd36aea29e08">sss_scale</a>==0.0f) {
<a name="l09715"></a>09715                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aac33d04c37dd2e93b63ed9fa2c33796f">sss_radius</a>[0]= 1.0f;
<a name="l09716"></a>09716                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aac33d04c37dd2e93b63ed9fa2c33796f">sss_radius</a>[1]= 1.0f;
<a name="l09717"></a>09717                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aac33d04c37dd2e93b63ed9fa2c33796f">sss_radius</a>[2]= 1.0f;
<a name="l09718"></a>09718                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[0]= 0.8f;
<a name="l09719"></a>09719                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[1]= 0.8f;
<a name="l09720"></a>09720                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[2]= 0.8f;
<a name="l09721"></a>09721                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3692f860a6fba360c237f0b66b536b71">sss_error</a>= 0.05f;
<a name="l09722"></a>09722                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a15b52d64d58c2e1c1219bd36aea29e08">sss_scale</a>= 0.1f;
<a name="l09723"></a>09723                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a67eedf8afd90e87c466808c825ae8f0a">sss_ior</a>= 1.3f;
<a name="l09724"></a>09724                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#af39b2714577fca48d03a90c7e81f24a8">sss_colfac</a>= 1.0f;
<a name="l09725"></a>09725                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9d4ee8da747a37dcb0c3234ebf8be090">sss_texfac</a>= 0.0f;
<a name="l09726"></a>09726             }
<a name="l09727"></a>09727             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abe9cb8d1adec6289164298eb6e0983c9">sss_front</a>==0 &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#adc1edb419950f5d1a4332e65270f6b49">sss_back</a>==0) {
<a name="l09728"></a>09728                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abe9cb8d1adec6289164298eb6e0983c9">sss_front</a>= 1.0f;
<a name="l09729"></a>09729                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#adc1edb419950f5d1a4332e65270f6b49">sss_back</a>= 1.0f;
<a name="l09730"></a>09730             }
<a name="l09731"></a>09731             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[0]==0 &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[1]==0 &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[2]==0) {
<a name="l09732"></a>09732                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[0]= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9e892cbd7e25b6fd5ee00c383cd9cacf">r</a>;
<a name="l09733"></a>09733                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[1]= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a4b832bd11d2b3d00ab74a269f2f2e9e8">g</a>;
<a name="l09734"></a>09734                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>[2]= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a01ac5d90e907d35afcf7af9cf6b17c04">b</a>;
<a name="l09735"></a>09735             }
<a name="l09736"></a>09736         }
<a name="l09737"></a>09737         
<a name="l09738"></a>09738         <span class="keywordflow">for</span> (; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09739"></a>09739             <a class="code" href="../../de/dad/structbDeformGroup.html">bDeformGroup</a> *curdef;
<a name="l09740"></a>09740             
<a name="l09741"></a>09741             <span class="keywordflow">for</span> (curdef= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a11c2e3299c854eb361471ea041397cb7">defbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curdef; curdef=curdef-&gt;<a class="code" href="../../de/dad/structbDeformGroup.html#a8a7d7781bc9d928bff891de4188de7ad">next</a>) {
<a name="l09742"></a>09742                 <span class="comment">/* replace an empty-string name with unique name */</span>
<a name="l09743"></a>09743                 <span class="keywordflow">if</span> (curdef-&gt;<a class="code" href="../../de/dad/structbDeformGroup.html#ac38b3004d93922163768710dc9b7cf83">name</a>[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l09744"></a>09744                     <a class="code" href="../../d7/dbd/BKE__deform_8h.html#afc0913090d927a2bd0657141a95890c6">defgroup_unique_name</a>(curdef, ob);
<a name="l09745"></a>09745                 }
<a name="l09746"></a>09746             }
<a name="l09747"></a>09747 
<a name="l09748"></a>09748             <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 243 || main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1) {
<a name="l09749"></a>09749                 <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l09750"></a>09750 
<a name="l09751"></a>09751                 <span class="comment">/* translate old mirror modifier axis values to new flags */</span>
<a name="l09752"></a>09752                 <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l09753"></a>09753                     <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a251aba7f50f4d9b2d085279bd96d6ee6">eModifierType_Mirror</a>) {
<a name="l09754"></a>09754                         <a class="code" href="../../d3/dcc/structMirrorModifierData.html">MirrorModifierData</a> *mmd = (<a class="code" href="../../d3/dcc/structMirrorModifierData.html">MirrorModifierData</a>*) md;
<a name="l09755"></a>09755 
<a name="l09756"></a>09756                         <span class="keywordflow">switch</span>(mmd-&gt;axis)
<a name="l09757"></a>09757                         {
<a name="l09758"></a>09758                         <span class="keywordflow">case</span> 0:
<a name="l09759"></a>09759                             mmd-&gt;<a class="code" href="../../d3/dcc/structMirrorModifierData.html#af03c809f339e58d3ce476b4bc46bd4e4">flag</a> |= <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#ac5478fa035ffe227f719b371488e3ec4">MOD_MIR_AXIS_X</a>;
<a name="l09760"></a>09760                             <span class="keywordflow">break</span>;
<a name="l09761"></a>09761                         <span class="keywordflow">case</span> 1:
<a name="l09762"></a>09762                             mmd-&gt;<a class="code" href="../../d3/dcc/structMirrorModifierData.html#af03c809f339e58d3ce476b4bc46bd4e4">flag</a> |= <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#abd93abc70f2b4064c6f3c2173e0f67e8">MOD_MIR_AXIS_Y</a>;
<a name="l09763"></a>09763                             <span class="keywordflow">break</span>;
<a name="l09764"></a>09764                         <span class="keywordflow">case</span> 2:
<a name="l09765"></a>09765                             mmd-&gt;<a class="code" href="../../d3/dcc/structMirrorModifierData.html#af03c809f339e58d3ce476b4bc46bd4e4">flag</a> |= <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a622f972032eead375e5efb14e63bbcac">MOD_MIR_AXIS_Z</a>;
<a name="l09766"></a>09766                             <span class="keywordflow">break</span>;
<a name="l09767"></a>09767                         }
<a name="l09768"></a>09768 
<a name="l09769"></a>09769                         mmd-&gt;axis = 0;
<a name="l09770"></a>09770                     }
<a name="l09771"></a>09771                 }
<a name="l09772"></a>09772             }
<a name="l09773"></a>09773         }
<a name="l09774"></a>09774         
<a name="l09775"></a>09775         <span class="comment">/* render layer added, this is not the active layer */</span>
<a name="l09776"></a>09776         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 243 || main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2) {
<a name="l09777"></a>09777             <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l09778"></a>09778             <span class="keywordflow">for</span> (me=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me=me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09779"></a>09779                 <a class="code" href="../../d0/d12/readfile_8c.html#a47b23c2aa31ffe804ec6bdb76f3379ee">customdata_version_243</a>(me);
<a name="l09780"></a>09780         }       
<a name="l09781"></a>09781 
<a name="l09782"></a>09782     }
<a name="l09783"></a>09783     
<a name="l09784"></a>09784     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 244) {
<a name="l09785"></a>09785         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l09786"></a>09786         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l09787"></a>09787         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l09788"></a>09788         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l09789"></a>09789         
<a name="l09790"></a>09790         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> != 244 || main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2) {
<a name="l09791"></a>09791             <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l09792"></a>09792                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a516c9c9cdf6193e6556b3850eca85510">R_SSS</a>;
<a name="l09793"></a>09793 
<a name="l09794"></a>09794             <span class="comment">/* correct older action editors - incorrect scrolling */</span>
<a name="l09795"></a>09795             <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09796"></a>09796                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l09797"></a>09797                 sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l09798"></a>09798                 <span class="keywordflow">while</span> (sa) {
<a name="l09799"></a>09799                     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l09800"></a>09800 
<a name="l09801"></a>09801                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l09802"></a>09802                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l09803"></a>09803                             <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a>*) sl;
<a name="l09804"></a>09804                             
<a name="l09805"></a>09805                             saction-&gt;v2d.tot.ymin = -1000.0;
<a name="l09806"></a>09806                             saction-&gt;v2d.tot.ymax = 0.0;
<a name="l09807"></a>09807                             
<a name="l09808"></a>09808                             saction-&gt;v2d.cur.ymin = -75.0;
<a name="l09809"></a>09809                             saction-&gt;v2d.cur.ymax = 5.0;
<a name="l09810"></a>09810                         }
<a name="l09811"></a>09811                     }
<a name="l09812"></a>09812                     sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l09813"></a>09813                 }
<a name="l09814"></a>09814             }
<a name="l09815"></a>09815         }
<a name="l09816"></a>09816         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> != 244 || main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3) { 
<a name="l09817"></a>09817             <span class="comment">/* constraints recode version patch used to be here. Moved to 245 now... */</span>
<a name="l09818"></a>09818             
<a name="l09819"></a>09819             
<a name="l09820"></a>09820             <span class="keywordflow">for</span> (wrld=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wrld; wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09821"></a>09821                 <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a97cd565855bf995024151e5a6ad307dc">mode</a> &amp; <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a318ce0a82b265f4b6ad43e4ce3339a49">WO_AMB_OCC</a>)
<a name="l09822"></a>09822                     wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a82cd86b95a27d403b6f0bd2df37aba98">ao_samp_method</a> = <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a77c9804ffd340b77c103022307fc35f8">WO_AOSAMP_CONSTANT</a>;
<a name="l09823"></a>09823                 <span class="keywordflow">else</span>
<a name="l09824"></a>09824                     wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a82cd86b95a27d403b6f0bd2df37aba98">ao_samp_method</a> = <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#ac09953c22c2936605a365894fcf8ff46">WO_AOSAMP_HAMMERSLEY</a>;
<a name="l09825"></a>09825                 
<a name="l09826"></a>09826                 wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a617c69ae03be94d270834d847bfc852a">ao_adapt_thresh</a> = 0.005f;
<a name="l09827"></a>09827             }
<a name="l09828"></a>09828             
<a name="l09829"></a>09829             <span class="keywordflow">for</span> (la=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; la; la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09830"></a>09830                 <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a0f089dd53e59d56d00b73493496fa2c3">LA_AREA</a>)
<a name="l09831"></a>09831                     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a5ce31cf4991ca37ac2ee7837fafc877b">ray_samp_method</a> = <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a3ff7b8015bb3297c57a6fd03d24432b3">LA_SAMP_CONSTANT</a>;
<a name="l09832"></a>09832                 <span class="keywordflow">else</span>
<a name="l09833"></a>09833                     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a5ce31cf4991ca37ac2ee7837fafc877b">ray_samp_method</a> = <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a2158ca4037c0d0dfdd43cea8e8d4a210">LA_SAMP_HALTON</a>;
<a name="l09834"></a>09834                 
<a name="l09835"></a>09835                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add27c699fe523c032f1c186eb5746a6c">adapt_thresh</a> = 0.001f;
<a name="l09836"></a>09836             }
<a name="l09837"></a>09837         }
<a name="l09838"></a>09838     }
<a name="l09839"></a>09839     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 245) {
<a name="l09840"></a>09840         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l09841"></a>09841         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l09842"></a>09842         <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l09843"></a>09843         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l09844"></a>09844         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l09845"></a>09845         <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l09846"></a>09846         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l09847"></a>09847         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l09848"></a>09848         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l09849"></a>09849         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l09850"></a>09850         <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l09851"></a>09851         <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l09852"></a>09852         
<a name="l09853"></a>09853         <span class="comment">/* unless the file was created 2.44.3 but not 2.45, update the constraints */</span>
<a name="l09854"></a>09854         <span class="keywordflow">if</span> ( !(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>==244 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a>==3) &amp;&amp;
<a name="l09855"></a>09855              ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>&lt;245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>==245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a>==0)) ) 
<a name="l09856"></a>09856         {
<a name="l09857"></a>09857             <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09858"></a>09858                 <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list;
<a name="l09859"></a>09859                 list = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l09860"></a>09860                 
<a name="l09861"></a>09861                 <span class="comment">/* fix up constraints due to constraint recode changes (originally at 2.44.3) */</span>
<a name="l09862"></a>09862                 <span class="keywordflow">if</span> (list) {
<a name="l09863"></a>09863                     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l09864"></a>09864                     <span class="keywordflow">for</span> (curcon = list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l09865"></a>09865                         <span class="comment">/* old CONSTRAINT_LOCAL check -&gt; convert to CONSTRAINT_SPACE_LOCAL */</span>
<a name="l09866"></a>09866                         <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; 0x20) {
<a name="l09867"></a>09867                             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>;
<a name="l09868"></a>09868                             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a767b1916ec67e8232fab1172eeec749b">tarspace</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>;
<a name="l09869"></a>09869                         }
<a name="l09870"></a>09870                         
<a name="l09871"></a>09871                         <span class="keywordflow">switch</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>) {
<a name="l09872"></a>09872                             <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aacf7ad78cacd4f1d8e999ef0ab64caf6">CONSTRAINT_TYPE_LOCLIMIT</a>:
<a name="l09873"></a>09873                             {
<a name="l09874"></a>09874                                 <a class="code" href="../../da/d9a/structbLocLimitConstraint.html">bLocLimitConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../da/d9a/structbLocLimitConstraint.html">bLocLimitConstraint</a> *)curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09875"></a>09875                                 
<a name="l09876"></a>09876                                 <span class="comment">/* old limit without parent option for objects */</span>
<a name="l09877"></a>09877                                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../da/d9a/structbLocLimitConstraint.html#af8b7de1edd9f84c62642d1c61d02e1af">flag2</a>)
<a name="l09878"></a>09878                                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>;
<a name="l09879"></a>09879                             }
<a name="l09880"></a>09880                                 <span class="keywordflow">break</span>;
<a name="l09881"></a>09881                         }   
<a name="l09882"></a>09882                     }
<a name="l09883"></a>09883                 }
<a name="l09884"></a>09884                 
<a name="l09885"></a>09885                 <span class="comment">/* correctly initialize constinv matrix */</span>
<a name="l09886"></a>09886                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4c9f37bbb8cd0ea04049c5fcce819101">constinv</a>);
<a name="l09887"></a>09887                 
<a name="l09888"></a>09888                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l09889"></a>09889                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l09890"></a>09890                         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l09891"></a>09891                         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l09892"></a>09892                         
<a name="l09893"></a>09893                         <span class="keywordflow">for</span> (pchan = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l09894"></a>09894                             <span class="comment">/* make sure constraints are all up to date */</span>
<a name="l09895"></a>09895                             <span class="keywordflow">for</span> (curcon = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l09896"></a>09896                                 <span class="comment">/* old CONSTRAINT_LOCAL check -&gt; convert to CONSTRAINT_SPACE_LOCAL */</span>
<a name="l09897"></a>09897                                 <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; 0x20) {
<a name="l09898"></a>09898                                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ab268e791e8e23d51180c7b2bfd478955">ownspace</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>;
<a name="l09899"></a>09899                                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a767b1916ec67e8232fab1172eeec749b">tarspace</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>;
<a name="l09900"></a>09900                                 }
<a name="l09901"></a>09901                                 
<a name="l09902"></a>09902                                 <span class="keywordflow">switch</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>) {
<a name="l09903"></a>09903                                     <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5acb260fa057d2251a78fe7939f09e4613">CONSTRAINT_TYPE_ACTION</a>:
<a name="l09904"></a>09904                                     {
<a name="l09905"></a>09905                                         <a class="code" href="../../da/dc5/structbActionConstraint.html">bActionConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../da/dc5/structbActionConstraint.html">bActionConstraint</a> *)curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l09906"></a>09906                                         
<a name="l09907"></a>09907                                         <span class="comment">/* &#39;data-&gt;local&#39; used to mean that target was in local-space */</span>
<a name="l09908"></a>09908                                         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../da/dc5/structbActionConstraint.html#ae2c58528da01d18d01dbf9f34f173707">local</a>)
<a name="l09909"></a>09909                                             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a767b1916ec67e8232fab1172eeec749b">tarspace</a> = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a70bdab3459b92ba40a7aaed75e56d303adcd072a1a47c05df5aaad749d71b5ebf">CONSTRAINT_SPACE_LOCAL</a>;
<a name="l09910"></a>09910                                     }                           
<a name="l09911"></a>09911                                         <span class="keywordflow">break</span>;
<a name="l09912"></a>09912                                 }
<a name="l09913"></a>09913                             }
<a name="l09914"></a>09914                             
<a name="l09915"></a>09915                             <span class="comment">/* correctly initialize constinv matrix */</span>
<a name="l09916"></a>09916                             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a781122afecc5a7065050db12ea0aa961">constinv</a>);
<a name="l09917"></a>09917                         }
<a name="l09918"></a>09918                     }
<a name="l09919"></a>09919                 }
<a name="l09920"></a>09920             }
<a name="l09921"></a>09921         }
<a name="l09922"></a>09922         
<a name="l09923"></a>09923         <span class="comment">/* fix all versions before 2.45 */</span>
<a name="l09924"></a>09924         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> != 245) {
<a name="l09925"></a>09925 
<a name="l09926"></a>09926             <span class="comment">/* repair preview from 242 - 244*/</span>
<a name="l09927"></a>09927             <span class="keywordflow">for</span> (ima= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09928"></a>09928                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a1c97663701a45c784752d88b3e9b1749">preview</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l09929"></a>09929             }
<a name="l09930"></a>09930         }
<a name="l09931"></a>09931 
<a name="l09932"></a>09932         <span class="comment">/* add point caches */</span>
<a name="l09933"></a>09933         <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09934"></a>09934             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a> &amp;&amp; !ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3cbaa712cbb0289db746f8dbfb34f1bb">pointcache</a>)
<a name="l09935"></a>09935                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3cbaa712cbb0289db746f8dbfb34f1bb">pointcache</a>= <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aaa30cc8980cfa020b23b61066cda11e1">BKE_ptcache_add</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a2b4fe2801e797119094ffa33d7a92d59">ptcaches</a>);
<a name="l09936"></a>09936 
<a name="l09937"></a>09937             <span class="keywordflow">for</span> (psys=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l09938"></a>09938                 <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>) {
<a name="l09939"></a>09939                     <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a895fb976494aba70aaac10d09e880368">PTCACHE_BAKED</a> &amp;&amp; (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4dfd845afe48aca448b8bbcef971cc5d">PTCACHE_DISK_CACHE</a>)==0) {
<a name="l09940"></a>09940                         printf(<span class="stringliteral">&quot;Old memory cache isn&#39;t supported for particles, so re-bake the simulation!\n&quot;</span>);
<a name="l09941"></a>09941                         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp;= ~<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a895fb976494aba70aaac10d09e880368">PTCACHE_BAKED</a>;
<a name="l09942"></a>09942                     }
<a name="l09943"></a>09943                 }
<a name="l09944"></a>09944                 <span class="keywordflow">else</span>
<a name="l09945"></a>09945                     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a>= <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aaa30cc8980cfa020b23b61066cda11e1">BKE_ptcache_add</a>(&amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a18021dc0203ac6bfb44d306d7a008989">ptcaches</a>);
<a name="l09946"></a>09946             }
<a name="l09947"></a>09947 
<a name="l09948"></a>09948             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l09949"></a>09949                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5fc484f055c7aba4c89beda85b5ba321">eModifierType_Cloth</a>) {
<a name="l09950"></a>09950                     <a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *clmd = (<a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a>*) md;
<a name="l09951"></a>09951                     <span class="keywordflow">if</span> (!clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a77605f4a26c5077252abce50377e3de9">point_cache</a>)
<a name="l09952"></a>09952                         clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a77605f4a26c5077252abce50377e3de9">point_cache</a>= <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aaa30cc8980cfa020b23b61066cda11e1">BKE_ptcache_add</a>(&amp;clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a2bfdb45d82b0577deb1cdd5f879e931c">ptcaches</a>);
<a name="l09953"></a>09953                 }
<a name="l09954"></a>09954             }
<a name="l09955"></a>09955         }
<a name="l09956"></a>09956 
<a name="l09957"></a>09957         <span class="comment">/* Copy over old per-level multires vertex data</span>
<a name="l09958"></a>09958 <span class="comment">         * into a single vertex array in struct Multires */</span>
<a name="l09959"></a>09959         <span class="keywordflow">for</span> (me = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me=me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09960"></a>09960             <span class="keywordflow">if</span> (me-&gt;mr &amp;&amp; !me-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a>) {
<a name="l09961"></a>09961                 <a class="code" href="../../db/d78/structMultiresLevel.html">MultiresLevel</a> *lvl = me-&gt;mr-&gt;levels.last;
<a name="l09962"></a>09962                 <span class="keywordflow">if</span> (lvl) {
<a name="l09963"></a>09963                     me-&gt;mr-&gt;<a class="code" href="../../da/d29/structMesh.html#a970aeed1a5d2b4a0064ba17b126cfd8c">verts</a> = lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#acb8687824eb876f24e436ae6864785f2">verts</a>;
<a name="l09964"></a>09964                     lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#acb8687824eb876f24e436ae6864785f2">verts</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l09965"></a>09965                     <span class="comment">/* Don&#39;t need the other vert arrays */</span>
<a name="l09966"></a>09966                     <span class="keywordflow">for</span> (lvl = lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#afcbc4c2e9cd07bf423e97c8851eaf2ea">prev</a>; lvl; lvl = lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#afcbc4c2e9cd07bf423e97c8851eaf2ea">prev</a>) {
<a name="l09967"></a>09967                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#acb8687824eb876f24e436ae6864785f2">verts</a>);
<a name="l09968"></a>09968                         lvl-&gt;<a class="code" href="../../db/d78/structMultiresLevel.html#acb8687824eb876f24e436ae6864785f2">verts</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l09969"></a>09969                     }
<a name="l09970"></a>09970                 }
<a name="l09971"></a>09971             }
<a name="l09972"></a>09972         }
<a name="l09973"></a>09973         
<a name="l09974"></a>09974         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> != 245 || main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1) {
<a name="l09975"></a>09975             <span class="keywordflow">for</span> (la=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; la; la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09976"></a>09976                 <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a2e09bd4d28e8365b52c3e5d67a41deca">LA_QUAD</a>) la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a52235987337869d42c3ad6edfd333fc5">falloff_type</a> = <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a16fdbe0a2c9d247189b0c9d94930cc35">LA_FALLOFF_SLIDERS</a>;
<a name="l09977"></a>09977                 <span class="keywordflow">else</span> la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a52235987337869d42c3ad6edfd333fc5">falloff_type</a> = <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#adb664a05499f6bc8da4c60a8fd181248">LA_FALLOFF_INVLINEAR</a>;
<a name="l09978"></a>09978                 
<a name="l09979"></a>09979                 <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l09980"></a>09980                     la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a> = <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a0fe6bbbc391a99f155add4272972ba6d">curvemapping_add</a>(1, 0.0f, 1.0f, 1.0f, 0.0f);
<a name="l09981"></a>09981                     <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a42d6a337419141c095383cdb94a3a413">curvemapping_initialize</a>(la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>);
<a name="l09982"></a>09982                 }
<a name="l09983"></a>09983             }
<a name="l09984"></a>09984         }       
<a name="l09985"></a>09985         
<a name="l09986"></a>09986         <span class="keywordflow">for</span> (ma=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l09987"></a>09987             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab02ae3ebb0377382070fbd81776e995e">samp_gloss_mir</a> == 0) {
<a name="l09988"></a>09988                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ae9c4f4e3b999725bf1e19a4e4c7159b1">gloss_mir</a> = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a17886fc73bb73e837d2d9e323723aa76">gloss_tra</a>= 1.0f;
<a name="l09989"></a>09989                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a1f806b2d92b5ebca2310e54921687e3f">aniso_gloss_mir</a> = 1.0f;
<a name="l09990"></a>09990                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab02ae3ebb0377382070fbd81776e995e">samp_gloss_mir</a> = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab72aab34f1d2c7f650e136bf63bd024a">samp_gloss_tra</a>= 18;
<a name="l09991"></a>09991                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a906e8a127e0724e4bf84f4dcbc92cc25">adapt_thresh_mir</a> = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a134cebd8c6fa63cd002fb063761dd3b5">adapt_thresh_tra</a> = 0.005f;
<a name="l09992"></a>09992                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ac542fbfdceb2e05821b4ea9c8f3e9c00">dist_mir</a> = 0.0f;
<a name="l09993"></a>09993                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a74dcf1951a4433fa5bd5f0b09ef9dd33">fadeto_mir</a> = <a class="code" href="../../de/db2/DNA__material__types_8h.html#ab9c6283c99761039bcc19a551ba6233d">MA_RAYMIR_FADETOSKY</a>;
<a name="l09994"></a>09994             }
<a name="l09995"></a>09995 
<a name="l09996"></a>09996             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ac81de8a6b5d49fa2a9fefec3914f04a0">strand_min</a> == 0.0f)
<a name="l09997"></a>09997                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ac81de8a6b5d49fa2a9fefec3914f04a0">strand_min</a>= 1.0f;
<a name="l09998"></a>09998         }
<a name="l09999"></a>09999 
<a name="l10000"></a>10000         <span class="keywordflow">for</span> (part=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part=part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10001"></a>10001             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a2929a430557778d28964ff5ed106928e">ren_child_nbr</a>==0)
<a name="l10002"></a>10002                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a2929a430557778d28964ff5ed106928e">ren_child_nbr</a>= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aea3bf72ac907f8262f7c895af2435f0f">child_nbr</a>;
<a name="l10003"></a>10003 
<a name="l10004"></a>10004             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a919468c5c388a69cecd3a16e3df12eb8">simplify_refsize</a>==0) {
<a name="l10005"></a>10005                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a919468c5c388a69cecd3a16e3df12eb8">simplify_refsize</a>= 1920;
<a name="l10006"></a>10006                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9838478bd0633bcf1c8e00eb132250d3">simplify_rate</a>= 1.0f;
<a name="l10007"></a>10007                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82f776e5e4957708763e1da8a60b4230">simplify_transition</a>= 0.1f;
<a name="l10008"></a>10008                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#acc040183b156ed9e9178e8ce9f18bf01">simplify_viewport</a>= 0.8f;
<a name="l10009"></a>10009             }
<a name="l10010"></a>10010         }
<a name="l10011"></a>10011 
<a name="l10012"></a>10012         <span class="keywordflow">for</span> (wrld=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wrld; wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10013"></a>10013             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a26cc93d2a15bb8120edd21656b8bd5ac">ao_approx_error</a> == 0.0f)
<a name="l10014"></a>10014                 wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a26cc93d2a15bb8120edd21656b8bd5ac">ao_approx_error</a>= 0.25f;
<a name="l10015"></a>10015         }
<a name="l10016"></a>10016 
<a name="l10017"></a>10017         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10018"></a>10018             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l10019"></a>10019                 <a class="code" href="../../d0/d12/readfile_8c.html#a4086085aaff87acde51bbbd8bcd8ec81">ntree_version_245</a>(fd, lib, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l10020"></a>10020 
<a name="l10021"></a>10021             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afb2f47ff8d71fcaeb5a3e6bd1c526061">simplify_shadowsamples</a> == 0) {
<a name="l10022"></a>10022                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a12fa5e141ba422aa06aea847fc427b9b">simplify_subsurf</a>= 6;
<a name="l10023"></a>10023                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a2e5b16df1126f4e350a2a5e6fbee68f2">simplify_particles</a>= 1.0f;
<a name="l10024"></a>10024                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afb2f47ff8d71fcaeb5a3e6bd1c526061">simplify_shadowsamples</a>= 16;
<a name="l10025"></a>10025                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a1cdcb1ebf20075aeeeed2335bcadcd42">simplify_aosss</a>= 1.0f;
<a name="l10026"></a>10026             }
<a name="l10027"></a>10027 
<a name="l10028"></a>10028             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.cineongamma == 0) {
<a name="l10029"></a>10029                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.cineonblack= 95;
<a name="l10030"></a>10030                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.cineonwhite= 685;
<a name="l10031"></a>10031                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.cineongamma= 1.7f;
<a name="l10032"></a>10032             }
<a name="l10033"></a>10033         }
<a name="l10034"></a>10034 
<a name="l10035"></a>10035         <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10036"></a>10036             <a class="code" href="../../d0/d12/readfile_8c.html#a4086085aaff87acde51bbbd8bcd8ec81">ntree_version_245</a>(fd, lib, ntree);
<a name="l10037"></a>10037 
<a name="l10038"></a>10038         <span class="comment">/* fix for temporary flag changes during 245 cycle */</span>
<a name="l10039"></a>10039         <span class="keywordflow">for</span> (ima= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10040"></a>10040             <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> &amp; <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>) {
<a name="l10041"></a>10041                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> &amp;= ~<a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>;
<a name="l10042"></a>10042                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>;
<a name="l10043"></a>10043             }
<a name="l10044"></a>10044         }
<a name="l10045"></a>10045 
<a name="l10046"></a>10046         <span class="keywordflow">for</span> (tex=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex=tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10047"></a>10047             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> &amp; <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>) {
<a name="l10048"></a>10048                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> &amp;= ~<a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>;
<a name="l10049"></a>10049                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>;
<a name="l10050"></a>10050 
<a name="l10051"></a>10051             }
<a name="l10052"></a>10052 
<a name="l10053"></a>10053             ima= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2c2c4a8437672ea77fc9cfded61ffaf">ima</a>);
<a name="l10054"></a>10054             <span class="keywordflow">if</span> (ima &amp;&amp; (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a87a10b6d51aa883dcf4a9a1b469a8577">iuser</a>.<a class="code" href="../../de/d31/structImageUser.html#ad75a0d83edbd58ca9c4cfda7da7d77c8">flag</a> &amp; <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>)) {
<a name="l10055"></a>10055                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> &amp;= ~<a class="code" href="../../d2/d94/DNA__image__types_8h.html#a47a4c0ef997ca1581312e1f0e3b2e995">IMA_OLD_PREMUL</a>;
<a name="l10056"></a>10056                 ima-&gt;<a class="code" href="../../d8/d00/classImage.html#ab84c3d099caf0d6ec44c266899839f63">flag</a> |= <a class="code" href="../../d2/d94/DNA__image__types_8h.html#a1312f80c28583b65a650fc20f0a815d0">IMA_DO_PREMUL</a>;
<a name="l10057"></a>10057             }
<a name="l10058"></a>10058         }
<a name="l10059"></a>10059     }
<a name="l10060"></a>10060     
<a name="l10061"></a>10061     <span class="comment">/* sanity check for skgen</span>
<a name="l10062"></a>10062 <span class="comment">     * */</span>
<a name="l10063"></a>10063     {
<a name="l10064"></a>10064         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10065"></a>10065         <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10066"></a>10066         {
<a name="l10067"></a>10067             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[0] == sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[1] ||
<a name="l10068"></a>10068                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[0] == sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[2] ||
<a name="l10069"></a>10069                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[1] == sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[2])
<a name="l10070"></a>10070             {
<a name="l10071"></a>10071                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[0] = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a6bc84f7c60c397a71bee8f1417469e2f">SKGEN_SUB_CORRELATION</a>;
<a name="l10072"></a>10072                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[1] = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa48b85331094d01b26ad9752030db4ab">SKGEN_SUB_LENGTH</a>;
<a name="l10073"></a>10073                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[2] = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a361c0d433ad9e037ce767c0e2993dc27">SKGEN_SUB_ANGLE</a>;
<a name="l10074"></a>10074             }
<a name="l10075"></a>10075         }
<a name="l10076"></a>10076     }
<a name="l10077"></a>10077     
<a name="l10078"></a>10078 
<a name="l10079"></a>10079     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l10080"></a>10080         <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l10081"></a>10081 
<a name="l10082"></a>10082         <span class="comment">/* initialize 1:1 Aspect */</span>
<a name="l10083"></a>10083         <span class="keywordflow">for</span> (ima= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ima; ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10084"></a>10084             ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aa316a0e981811d7eaa7b413e812fc4d8">aspx</a> = ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a5cdb91d931b057cb5bb7ac683e5598a2">aspy</a> = 1.0f;               
<a name="l10085"></a>10085         }
<a name="l10086"></a>10086 
<a name="l10087"></a>10087     }
<a name="l10088"></a>10088 
<a name="l10089"></a>10089     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4)) {
<a name="l10090"></a>10090         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm;
<a name="l10091"></a>10091         <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l10092"></a>10092         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10093"></a>10093         
<a name="l10094"></a>10094         <span class="keywordflow">for</span> (arm= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; arm; arm= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10095"></a>10095             arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7c414a008b307fcd47b2441d93ae2213">deformflag</a> |= <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a8bf4daaf356d08df967fc2caf0d2bc00a0cc6f97591a7c8fabf07138d546416e7">ARM_DEF_B_BONE_REST</a>;
<a name="l10096"></a>10096         
<a name="l10097"></a>10097         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10098"></a>10098             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l10099"></a>10099                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435aa45deecb66e254a60207702a40efa416">eModifierType_Armature</a>)
<a name="l10100"></a>10100                     ((<a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a>*)md)-&gt;deformflag |= <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a8bf4daaf356d08df967fc2caf0d2bc00a0cc6f97591a7c8fabf07138d546416e7">ARM_DEF_B_BONE_REST</a>;
<a name="l10101"></a>10101             }
<a name="l10102"></a>10102         }
<a name="l10103"></a>10103     }
<a name="l10104"></a>10104 
<a name="l10105"></a>10105     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 5)) {
<a name="l10106"></a>10106         <span class="comment">/* foreground color needs to be something other then black */</span>
<a name="l10107"></a>10107         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10108"></a>10108         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10109"></a>10109             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4093cd9ba9690451433964b247d19cc1">fg_stamp</a>[0] = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4093cd9ba9690451433964b247d19cc1">fg_stamp</a>[1] = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4093cd9ba9690451433964b247d19cc1">fg_stamp</a>[2] = 0.8f;
<a name="l10110"></a>10110             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a4093cd9ba9690451433964b247d19cc1">fg_stamp</a>[3] = 1.0f; <span class="comment">/* don&#39;t use text alpha yet */</span>
<a name="l10111"></a>10111             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a78fed2b1e448c4d1bc03eaeba9111739">bg_stamp</a>[3] = 0.25f; <span class="comment">/* make sure the background has full alpha */</span>
<a name="l10112"></a>10112         }
<a name="l10113"></a>10113     }
<a name="l10114"></a>10114 
<a name="l10115"></a>10115     
<a name="l10116"></a>10116     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 6)) {
<a name="l10117"></a>10117         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10118"></a>10118         <span class="comment">/* fix frs_sec_base */</span>
<a name="l10119"></a>10119         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10120"></a>10120             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a11e6b08a8678f04813637f658e867193">frs_sec_base</a> == 0) {
<a name="l10121"></a>10121                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a11e6b08a8678f04813637f658e867193">frs_sec_base</a> = 1;
<a name="l10122"></a>10122             }
<a name="l10123"></a>10123         }
<a name="l10124"></a>10124     }
<a name="l10125"></a>10125     
<a name="l10126"></a>10126     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 7)) {
<a name="l10127"></a>10127         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10128"></a>10128         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l10129"></a>10129         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l10130"></a>10130         <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l10131"></a>10131         
<a name="l10132"></a>10132         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10133"></a>10133             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l10134"></a>10134                 <span class="keywordflow">for</span> (pchan=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l10135"></a>10135                     <span class="keywordflow">for</span> (con=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l10136"></a>10136                         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a7e2841c90e49a4d5c28931df5f82bf32">CONSTRAINT_TYPE_PYTHON</a>) {
<a name="l10137"></a>10137                             <a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l10138"></a>10138                             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a0fb9e337aaca870ff19220e5d288a35b">tar</a>) {
<a name="l10139"></a>10139                                 <span class="comment">/* version patching needs to be done */</span>
<a name="l10140"></a>10140                                 ct= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a>), <span class="stringliteral">&quot;PyConTarget&quot;</span>);
<a name="l10141"></a>10141                                 
<a name="l10142"></a>10142                                 ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> = data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a0fb9e337aaca870ff19220e5d288a35b">tar</a>;
<a name="l10143"></a>10143                                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>, data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a2e5b8171fe87d090892e887d5a7f617a">subtarget</a>, <span class="keyword">sizeof</span>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>));
<a name="l10144"></a>10144                                 ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ae2fa5fa01270c3937913f813da18ca38">space</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a767b1916ec67e8232fab1172eeec749b">tarspace</a>;
<a name="l10145"></a>10145                                 
<a name="l10146"></a>10146                                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#ad08ba0f7208324f62cfe83a3e1aa1405">targets</a>, ct);
<a name="l10147"></a>10147                                 data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a6821219e05c61a6d42ec01b06926c556">tarnum</a>++;
<a name="l10148"></a>10148                                 
<a name="l10149"></a>10149                                 <span class="comment">/* clear old targets to avoid problems */</span>
<a name="l10150"></a>10150                                 data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a0fb9e337aaca870ff19220e5d288a35b">tar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10151"></a>10151                                 data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a2e5b8171fe87d090892e887d5a7f617a">subtarget</a>[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l10152"></a>10152                             }
<a name="l10153"></a>10153                         }
<a name="l10154"></a>10154                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a51cbb625f2e83f56a6e960b8a78f49b7">CONSTRAINT_TYPE_LOCLIKE</a>) {
<a name="l10155"></a>10155                             <a class="code" href="../../db/d11/structbLocateLikeConstraint.html">bLocateLikeConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../db/d11/structbLocateLikeConstraint.html">bLocateLikeConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l10156"></a>10156                             
<a name="l10157"></a>10157                             <span class="comment">/* new headtail functionality makes Bone-Tip function obsolete */</span>
<a name="l10158"></a>10158                             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../db/d11/structbLocateLikeConstraint.html#a8b7867d5ef298be78a4a1c7af359dd23">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adc44505b7f9af60e3c60d7b4c937fb26a8e597ec0082fe01e9e836917bd7d76d7">LOCLIKE_TIP</a>)
<a name="l10159"></a>10159                                 con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a0d68dd0c04e1f14852e9b573dcb6bba6">headtail</a> = 1.0f;
<a name="l10160"></a>10160                         }
<a name="l10161"></a>10161                     }
<a name="l10162"></a>10162                 }
<a name="l10163"></a>10163             }
<a name="l10164"></a>10164             
<a name="l10165"></a>10165             <span class="keywordflow">for</span> (con=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l10166"></a>10166                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a7e2841c90e49a4d5c28931df5f82bf32">CONSTRAINT_TYPE_PYTHON</a>) {
<a name="l10167"></a>10167                     <a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l10168"></a>10168                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a0fb9e337aaca870ff19220e5d288a35b">tar</a>) {
<a name="l10169"></a>10169                         <span class="comment">/* version patching needs to be done */</span>
<a name="l10170"></a>10170                         ct= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a>), <span class="stringliteral">&quot;PyConTarget&quot;</span>);
<a name="l10171"></a>10171                         
<a name="l10172"></a>10172                         ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> = data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a0fb9e337aaca870ff19220e5d288a35b">tar</a>;
<a name="l10173"></a>10173                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>, data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a2e5b8171fe87d090892e887d5a7f617a">subtarget</a>, <span class="keyword">sizeof</span>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>));
<a name="l10174"></a>10174                         ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ae2fa5fa01270c3937913f813da18ca38">space</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a767b1916ec67e8232fab1172eeec749b">tarspace</a>;
<a name="l10175"></a>10175                         
<a name="l10176"></a>10176                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#ad08ba0f7208324f62cfe83a3e1aa1405">targets</a>, ct);
<a name="l10177"></a>10177                         data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a6821219e05c61a6d42ec01b06926c556">tarnum</a>++;
<a name="l10178"></a>10178                         
<a name="l10179"></a>10179                         <span class="comment">/* clear old targets to avoid problems */</span>
<a name="l10180"></a>10180                         data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a0fb9e337aaca870ff19220e5d288a35b">tar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10181"></a>10181                         data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a2e5b8171fe87d090892e887d5a7f617a">subtarget</a>[0]= <span class="charliteral">&#39;\0&#39;</span>;
<a name="l10182"></a>10182                     }
<a name="l10183"></a>10183                 }
<a name="l10184"></a>10184                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a51cbb625f2e83f56a6e960b8a78f49b7">CONSTRAINT_TYPE_LOCLIKE</a>) {
<a name="l10185"></a>10185                     <a class="code" href="../../db/d11/structbLocateLikeConstraint.html">bLocateLikeConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../db/d11/structbLocateLikeConstraint.html">bLocateLikeConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l10186"></a>10186                     
<a name="l10187"></a>10187                     <span class="comment">/* new headtail functionality makes Bone-Tip function obsolete */</span>
<a name="l10188"></a>10188                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../db/d11/structbLocateLikeConstraint.html#a8b7867d5ef298be78a4a1c7af359dd23">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adc44505b7f9af60e3c60d7b4c937fb26a8e597ec0082fe01e9e836917bd7d76d7">LOCLIKE_TIP</a>)
<a name="l10189"></a>10189                         con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a0d68dd0c04e1f14852e9b573dcb6bba6">headtail</a> = 1.0f;
<a name="l10190"></a>10190                 }
<a name="l10191"></a>10191             }
<a name="l10192"></a>10192 
<a name="l10193"></a>10193             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>) {
<a name="l10194"></a>10194                 <a class="code" href="../../df/d9a/structSoftBody.html">SoftBody</a> *sb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>;
<a name="l10195"></a>10195                 <span class="keywordtype">int</span> k;
<a name="l10196"></a>10196 
<a name="l10197"></a>10197                 <span class="keywordflow">for</span> (k=0; k&lt;sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a185adbc18adce47a43552cb4e25f4e11">totkey</a>; k++) {
<a name="l10198"></a>10198                     <span class="keywordflow">if</span> (sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>[k])
<a name="l10199"></a>10199                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>[k]);
<a name="l10200"></a>10200                 }
<a name="l10201"></a>10201 
<a name="l10202"></a>10202                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>);
<a name="l10203"></a>10203 
<a name="l10204"></a>10204                 sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10205"></a>10205                 sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a185adbc18adce47a43552cb4e25f4e11">totkey</a> = 0;
<a name="l10206"></a>10206             }
<a name="l10207"></a>10207         }
<a name="l10208"></a>10208     }
<a name="l10209"></a>10209 
<a name="l10210"></a>10210     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 8)) {
<a name="l10211"></a>10211         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10212"></a>10212         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10213"></a>10213         <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10214"></a>10214 
<a name="l10215"></a>10215         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10216"></a>10216             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>) {
<a name="l10217"></a>10217                 <a class="code" href="../../df/d9a/structSoftBody.html">SoftBody</a> *sb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>;
<a name="l10218"></a>10218                 <span class="keywordtype">int</span> k;
<a name="l10219"></a>10219 
<a name="l10220"></a>10220                 <span class="keywordflow">for</span> (k=0; k&lt;sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a185adbc18adce47a43552cb4e25f4e11">totkey</a>; k++) {
<a name="l10221"></a>10221                     <span class="keywordflow">if</span> (sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>[k])
<a name="l10222"></a>10222                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>[k]);
<a name="l10223"></a>10223                 }
<a name="l10224"></a>10224 
<a name="l10225"></a>10225                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a>);
<a name="l10226"></a>10226 
<a name="l10227"></a>10227                 sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a3bbc389dca349d10f8a3d59268eed7ed">keys</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10228"></a>10228                 sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a185adbc18adce47a43552cb4e25f4e11">totkey</a> = 0;
<a name="l10229"></a>10229             }
<a name="l10230"></a>10230 
<a name="l10231"></a>10231             <span class="comment">/* convert old particles to new system */</span>
<a name="l10232"></a>10232             <span class="keywordflow">if</span> ((paf = <a class="code" href="../../d0/d12/readfile_8c.html#a821f02c4c74428a5a16f6574a9de1f25">do_version_give_parteff_245</a>(ob))) {
<a name="l10233"></a>10233                 <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l10234"></a>10234                 <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l10235"></a>10235                 <a class="code" href="../../d7/da3/structParticleSystemModifierData.html">ParticleSystemModifierData</a> *psmd;
<a name="l10236"></a>10236                 <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l10237"></a>10237 
<a name="l10238"></a>10238                 <span class="comment">/* create new particle system */</span>
<a name="l10239"></a>10239                 psys = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a>), <span class="stringliteral">&quot;particle_system&quot;</span>);
<a name="l10240"></a>10240                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a747471629aff917d4847a094b5c4c811">pointcache</a> = <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aaa30cc8980cfa020b23b61066cda11e1">BKE_ptcache_add</a>(&amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a18021dc0203ac6bfb44d306d7a008989">ptcaches</a>);
<a name="l10241"></a>10241 
<a name="l10242"></a>10242                 part = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a> = <a class="code" href="../../db/dca/BKE__particle_8h.html#a8d4addea4b3bb5ba81838850dfebccf0">psys_new_settings</a>(<span class="stringliteral">&quot;ParticleSettings&quot;</span>, main);
<a name="l10243"></a>10243                 
<a name="l10244"></a>10244                 <span class="comment">/* needed for proper libdata lookup */</span>
<a name="l10245"></a>10245                 <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>, 0);
<a name="l10246"></a>10246                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>;
<a name="l10247"></a>10247 
<a name="l10248"></a>10248                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l10249"></a>10249                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa71ece879319af5180e6283e218dc3f9">LIB_NEEDLINK</a>);
<a name="l10250"></a>10250                 
<a name="l10251"></a>10251                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>=0;
<a name="l10252"></a>10252                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a947c785248ab9746099a34c8bc093e8f">flag</a>= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#af75137c26174cda0a4c2071e862f97dc">PSYS_ENABLED</a>|<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a86c8964f558ef662e720db7bd5574e91">PSYS_CURRENT</a>;
<a name="l10253"></a>10253 
<a name="l10254"></a>10254                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>, psys);
<a name="l10255"></a>10255 
<a name="l10256"></a>10256                 md= <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a08b7b619df960c74b7097e769c4967a4">eModifierType_ParticleSystem</a>);
<a name="l10257"></a>10257                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a11ae633f1d5e802a57abdd651ca99956">name</a>, <span class="keyword">sizeof</span>(md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a11ae633f1d5e802a57abdd651ca99956">name</a>), <span class="stringliteral">&quot;ParticleSystem %i&quot;</span>, <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>));
<a name="l10258"></a>10258                 psmd= (<a class="code" href="../../d7/da3/structParticleSystemModifierData.html">ParticleSystemModifierData</a>*) md;
<a name="l10259"></a>10259                 psmd-&gt;<a class="code" href="../../d7/da3/structParticleSystemModifierData.html#aa9bcfe8519ee16580387345028687078">psys</a>=psys;
<a name="l10260"></a>10260                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, md);
<a name="l10261"></a>10261 
<a name="l10262"></a>10262                 <span class="comment">/* convert settings from old particle system */</span>
<a name="l10263"></a>10263                 <span class="comment">/* general settings */</span>
<a name="l10264"></a>10264                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a987ea41fe09e95054533124966636aca">totpart</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a8143706a053b4f7487b8d3bc99403a13">totpart</a>, 100000);
<a name="l10265"></a>10265                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa177c3d303d19c10eb2ad99fa6fc76dc">sta</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#ab1fa5e4d20adf1b22e497572482e2fa3">sta</a>;
<a name="l10266"></a>10266                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aaad187f6e55e19af7964ef74ef2f7b41">end</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#adfe4dc50984da252dde2d1dd3c18e5c3">end</a>;
<a name="l10267"></a>10267                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad24d73f074832de37255a2f3cb1c16d0">lifetime</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a9a1cfdd5c002795b409aff7914e505e7">lifetime</a>;
<a name="l10268"></a>10268                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a97d9032ef1f58ee39e773e2828ed0490">randlife</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#afba761fe03f9fa65d8dc106fdcd51941">randlife</a>;
<a name="l10269"></a>10269                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#af37463864387a7082f54deefb1d2bdff">seed</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a3e0503da895078546173c6870bb9511a">seed</a>;
<a name="l10270"></a>10270                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae487721b04b5b6187f39a9e768d4630b">disp</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#aad88c76efeb31ca2a98b0e9bc19231d2">disp</a>;
<a name="l10271"></a>10271                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8d022766b802cfbac21330d486f89469">omat</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a07a20d806858ef23000b34320c3ff86d">mat</a>[0];
<a name="l10272"></a>10272                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4c7ce6b3dc7ffa55b4b4dc83bee12b0c">hair_step</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#aa61e8ea41975808cc510a806a139412e">totkey</a>;
<a name="l10273"></a>10273 
<a name="l10274"></a>10274                 part-&gt;eff_group = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a5db52fef13164131ddbbcd82b8824496">group</a>;
<a name="l10275"></a>10275 
<a name="l10276"></a>10276                 <span class="comment">/* old system didn&#39;t interpolate between keypoints at render time */</span>
<a name="l10277"></a>10277                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a3c54e15afd70a949dd2789d6e4b06181">draw_step</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a6a1ea7215d8954c0b91be04e954e07cd">ren_step</a> = 0;
<a name="l10278"></a>10278 
<a name="l10279"></a>10279                 <span class="comment">/* physics */</span>
<a name="l10280"></a>10280                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a564477f1059ae042b0a3d9eebf68163c">normfac</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#aaa64d14a9140e169603fe45c29fe1b1a">normfac</a> * 25.0f;
<a name="l10281"></a>10281                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae46430cdacfa2c8c6802c562e0d94150">obfac</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a98b4819b93469dff13573a04f9fc2ae8">obfac</a>;
<a name="l10282"></a>10282                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a782119199a6589d6d41d32ecbe93868a">randfac</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#ac5f0f95fb4f36f9d8974c10786346e95">randfac</a> * 25.0f;
<a name="l10283"></a>10283                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ac6bff08377a8829ab2758f0fc071505b">dampfac</a> = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a4d7b2701bc962a281d246134dc262db5">damp</a>;
<a name="l10284"></a>10284                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8bdb0eac45f50a0e7b2408335b9a49e9">acc</a>, paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a8fb9a9b1297f11556e099a9a27fc618e">force</a>);
<a name="l10285"></a>10285 
<a name="l10286"></a>10286                 <span class="comment">/* flags */</span>
<a name="l10287"></a>10287                 <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a8c3df15672d24a55b63c46992eb37f38">stype</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a6fcb517c5981340d620170ef6c64ae91">PAF_VECT</a>) {
<a name="l10288"></a>10288                     <span class="keywordflow">if</span> (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a4563792d755b90d7510f7780e7b2a398">PAF_STATIC</a>) {
<a name="l10289"></a>10289                         <span class="comment">/* new hair lifetime is always 100.0f */</span>
<a name="l10290"></a>10290                         <span class="keywordtype">float</span> fac = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a9a1cfdd5c002795b409aff7914e505e7">lifetime</a> / 100.0f;
<a name="l10291"></a>10291 
<a name="l10292"></a>10292                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0a6e2b5b7e3602b7647433415494031d">PART_DRAW_PATH</a>;
<a name="l10293"></a>10293                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a3489e9807bb2c3edb363c7159234ae80">type</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aa38c7f44b9dcf5e9889f23cfae104145">PART_HAIR</a>;
<a name="l10294"></a>10294                         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#af8bbacb64e6295f8799570f41e00868d">recalc</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5547f2bd9a8035cc2e57bb0ede233551">PSYS_RECALC_REDO</a>;
<a name="l10295"></a>10295 
<a name="l10296"></a>10296                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a564477f1059ae042b0a3d9eebf68163c">normfac</a> *= fac;
<a name="l10297"></a>10297                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a782119199a6589d6d41d32ecbe93868a">randfac</a> *= fac;
<a name="l10298"></a>10298                     }
<a name="l10299"></a>10299                     <span class="keywordflow">else</span> {
<a name="l10300"></a>10300                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>;
<a name="l10301"></a>10301                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ace6b318ca43451b7c9faca362907f3c9">PART_DRAW_VEL_LENGTH</a>;
<a name="l10302"></a>10302                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7461f5318b0513e5c424046ceebff77b">draw_line</a>[1] = 0.04f;
<a name="l10303"></a>10303                     }
<a name="l10304"></a>10304                 }
<a name="l10305"></a>10305 
<a name="l10306"></a>10306                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad27b4fdd7271a1de7e2fe38051c3ca44">rotmode</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#acf117996b37af9e17bc18dca3e09b6ea">PART_ROT_VEL</a>;
<a name="l10307"></a>10307                 
<a name="l10308"></a>10308                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a84a57b0c91d35af0da0267c9c4c0f69a">PAF_BSPLINE</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a888e5a2325f4e196a35cb9239128630f">PART_HAIR_BSPLINE</a> : 0;
<a name="l10309"></a>10309                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#aea510f72859262d86c306f202ca185cb">PAF_TRAND</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aac208239c664b8a7512c92b78715e70a">PART_TRAND</a> : 0;
<a name="l10310"></a>10310                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a57a1c24c1a462a67ef68e88dcb28136c">PAF_EDISTR</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a36511d912291f8d1302ac2e9552f6805">PART_EDISTR</a> : 0;
<a name="l10311"></a>10311                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#aa571767e92187d9fc6d64ec357c70641">PAF_UNBORN</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a89887736df27c700e59ef81204839e3c">PART_UNBORN</a> : 0;
<a name="l10312"></a>10312                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a3245e004d19a132ae31b5a51d590d8ac">PAF_DIED</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab0d6dcdc8be44557d3c70b256547df88">PART_DIED</a> : 0;
<a name="l10313"></a>10313                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad9cc01cd6e1bd8ad9943e9d6052b26b1">from</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#a618537656aa4a12daebb3ab08fe67d0f">PAF_FACE</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a1126cd14d8be21a93187d99b6ab90c70">PART_FROM_FACE</a> : 0;
<a name="l10314"></a>10314                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> |= (paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a97670b47159bbb58828e23fd96e07d95">flag</a> &amp; <a class="code" href="../../d7/d8e/DNA__effect__types_8h.html#ae8b691f5ea67df34d4089b3deaa42b8d">PAF_SHOWE</a>) ? <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a02fd6ffe389911bce7838d256312b383">PART_DRAW_EMITTER</a> : 0;
<a name="l10315"></a>10315 
<a name="l10316"></a>10316                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad65cbfe5598e2785a4cbc8e32041adc8">vgroup</a>[<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aa1ab7fc56cc92ec740d60822347a239a">PSYS_VG_DENSITY</a>] = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a01e456c09a3cda27f0c71e67abf9b8b5">vertgroup</a>;
<a name="l10317"></a>10317                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad65cbfe5598e2785a4cbc8e32041adc8">vgroup</a>[<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a77e225b2a12e738d7910c4e9ef3f431c">PSYS_VG_VEL</a>] = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a751b08f5448fb951c6c9fcd07ad10a92">vertgroup_v</a>;
<a name="l10318"></a>10318                 psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad65cbfe5598e2785a4cbc8e32041adc8">vgroup</a>[<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a434a266e46e16bad2c0ab7b160d695ed">PSYS_VG_LENGTH</a>] = paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a751b08f5448fb951c6c9fcd07ad10a92">vertgroup_v</a>;
<a name="l10319"></a>10319 
<a name="l10320"></a>10320                 <span class="comment">/* dupliobjects */</span>
<a name="l10321"></a>10321                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8f68dd8367bd3650458515426ac8f1ff">OB_DUPLIVERTS</a>) {
<a name="l10322"></a>10322                     <a class="code" href="../../de/de7/structObject.html">Object</a> *dup = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l10323"></a>10323 
<a name="l10324"></a>10324                     <span class="keywordflow">for</span> (; dup; dup= dup-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10325"></a>10325                         <span class="keywordflow">if</span> (ob == <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, dup-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>)) {
<a name="l10326"></a>10326                             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a> = dup;
<a name="l10327"></a>10327                             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a4bbbd0230e5c35a5d939a40131bd2df1">OB_DUPLIPARTS</a>;
<a name="l10328"></a>10328                             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp;= ~<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8f68dd8367bd3650458515426ac8f1ff">OB_DUPLIVERTS</a>;
<a name="l10329"></a>10329 
<a name="l10330"></a>10330                             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a2506fdc9f159583f812c900402c5ec54">PART_DRAW_OB</a>;
<a name="l10331"></a>10331 
<a name="l10332"></a>10332                             <span class="comment">/* needed for proper libdata lookup */</span>
<a name="l10333"></a>10333                             <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, dup, dup, 0);
<a name="l10334"></a>10334                         }
<a name="l10335"></a>10335                     }
<a name="l10336"></a>10336                 }
<a name="l10337"></a>10337 
<a name="l10338"></a>10338                 
<a name="l10339"></a>10339                 {
<a name="l10340"></a>10340                     <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fluidmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>);
<a name="l10341"></a>10341                     <span class="keywordflow">if</span> (fluidmd &amp;&amp; fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a> &amp;&amp; fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#aa82fde23a83404f1848b01db5e08c676">type</a> == <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#a59740b4f369e9d886cf9ce13752d6b8f">OB_FLUIDSIM_PARTICLE</a>)
<a name="l10342"></a>10342                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a3489e9807bb2c3edb363c7159234ae80">type</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ad2b156b6908626c14f063e15712fe427">PART_FLUID</a>;
<a name="l10343"></a>10343                 }
<a name="l10344"></a>10344 
<a name="l10345"></a>10345                 <a class="code" href="../../d0/d12/readfile_8c.html#a04a08be8c4070f90a1bbd0f2034dce3f">do_version_free_effects_245</a>(&amp;ob-&gt;effect);
<a name="l10346"></a>10346 
<a name="l10347"></a>10347                 printf(<span class="stringliteral">&quot;Old particle system converted to new system.\n&quot;</span>);
<a name="l10348"></a>10348             }
<a name="l10349"></a>10349         }
<a name="l10350"></a>10350 
<a name="l10351"></a>10351         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10352"></a>10352             <a class="code" href="../../df/db7/structParticleEditSettings.html">ParticleEditSettings</a> *pset= &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a931875e2d55fef9de65c777431a94f31">particle</a>;
<a name="l10353"></a>10353             <span class="keywordtype">int</span> a;
<a name="l10354"></a>10354 
<a name="l10355"></a>10355             <span class="keywordflow">if</span> (pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a23ec19a6f795b0da2361718b51effaa6">brush</a>[0].<a class="code" href="../../d5/d14/structParticleBrushData.html#af1a7856dc1b72f871243748f1b100749">size</a> == 0) {
<a name="l10356"></a>10356                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a3bfdff8f61248e79650bdf43d58b165c">flag</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4ada0b3849ba1ad9d2c52c2c08ff292b">PE_KEEP_LENGTHS</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a9244c6f7c421c6e45a53d845f21bc4a0">PE_LOCK_FIRST</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4eb2fbeba4dbdbba518d73198e5d30a8">PE_DEFLECT_EMITTER</a>;
<a name="l10357"></a>10357                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a8ddb420ffd5bfe8af837f5b41c80cbda">emitterdist</a>= 0.25f;
<a name="l10358"></a>10358                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#ace35dcd6a6e378ff34ad5d71a9763f02">totrekey</a>= 5;
<a name="l10359"></a>10359                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a6c01c6f2c45449e85d87c218b97e41c9">totaddkey</a>= 5;
<a name="l10360"></a>10360                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a5a8b3fad8136f57241b3e47e30abbec1">brushtype</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a43b3b46cd6ccc7c2058b0e949dcb6fd6">PE_BRUSH_NONE</a>;
<a name="l10361"></a>10361 
<a name="l10362"></a>10362                 <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#adacf2d7fb008adfb64554ced30c5fd89">PE_TOT_BRUSH</a>; a++) {
<a name="l10363"></a>10363                     pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a23ec19a6f795b0da2361718b51effaa6">brush</a>[a].<a class="code" href="../../d5/d14/structParticleBrushData.html#aae99022471b53d681c39d0fe3b9a583f">strength</a>= 50;
<a name="l10364"></a>10364                     pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a23ec19a6f795b0da2361718b51effaa6">brush</a>[a].<a class="code" href="../../d5/d14/structParticleBrushData.html#af1a7856dc1b72f871243748f1b100749">size</a>= 50;
<a name="l10365"></a>10365                     pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a23ec19a6f795b0da2361718b51effaa6">brush</a>[a].<a class="code" href="../../d5/d14/structParticleBrushData.html#a49ff869cc1b2fc20c59d7b76b65645ff">step</a>= 10;
<a name="l10366"></a>10366                 }
<a name="l10367"></a>10367 
<a name="l10368"></a>10368                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a23ec19a6f795b0da2361718b51effaa6">brush</a>[<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7246fde765e285de27c4c3690c580a72">PE_BRUSH_CUT</a>].<a class="code" href="../../d5/d14/structParticleBrushData.html#aae99022471b53d681c39d0fe3b9a583f">strength</a>= 100;
<a name="l10369"></a>10369             }
<a name="l10370"></a>10370         }
<a name="l10371"></a>10371     }
<a name="l10372"></a>10372     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 9)) {
<a name="l10373"></a>10373         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l10374"></a>10374         <span class="keywordtype">int</span> a;
<a name="l10375"></a>10375 
<a name="l10376"></a>10376         <span class="keywordflow">for</span> (ma=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10377"></a>10377             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a926ad275bf090eaa4b418b89449236a8">MA_NORMAP_TANG</a>)
<a name="l10378"></a>10378                 <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++)
<a name="l10379"></a>10379                     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a] &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>)
<a name="l10380"></a>10380                         ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#adb61d81e68e9c9d22a8f722ea51ef4d4">normapspace</a> = <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#adfe5660dff8846030a68938e33401aa2">MTEX_NSPACE_TANGENT</a>;
<a name="l10381"></a>10381     }
<a name="l10382"></a>10382     
<a name="l10383"></a>10383     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 10)) {
<a name="l10384"></a>10384         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10385"></a>10385         
<a name="l10386"></a>10386         <span class="comment">/* dupliface scale */</span>
<a name="l10387"></a>10387         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10388"></a>10388             ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad98aa48af97fa698a75581a25ac8d91c">dupfacesca</a> = 1.0f;
<a name="l10389"></a>10389     }
<a name="l10390"></a>10390     
<a name="l10391"></a>10391     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 11)) {
<a name="l10392"></a>10392         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10393"></a>10393         <a class="code" href="../../d5/d84/structbActionStrip.html">bActionStrip</a> *strip;
<a name="l10394"></a>10394         
<a name="l10395"></a>10395         <span class="comment">/* nla-strips - scale */</span>        
<a name="l10396"></a>10396         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10397"></a>10397             <span class="keywordflow">for</span> (strip= ob-&gt;nlastrips.first; strip; strip= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4db006cf84d35eed981ef557bdd9f126">next</a>) {
<a name="l10398"></a>10398                 <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>, actlength, repeat;
<a name="l10399"></a>10399                 
<a name="l10400"></a>10400                 <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#ad7ec9ba02c5f3dce1203a0536e6c7708">flag</a> &amp; <a class="code" href="../../db/db5/DNA__nla__types_8h.html#ac3143e0e96fb3d405cb6160e1a8ab0a3aecd7cb081c4f90e46d9f6e9492753eb3">ACTSTRIP_USESTRIDE</a>)
<a name="l10401"></a>10401                     repeat= 1.0f;
<a name="l10402"></a>10402                 <span class="keywordflow">else</span>
<a name="l10403"></a>10403                     repeat= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a92197783f4f742ad73eaa7d195e222f2">repeat</a>;
<a name="l10404"></a>10404                 
<a name="l10405"></a>10405                 length = strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a835d71d7c8291316173111f9550e2b81">end</a>-strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4e6af4c6c0ab48d38415b188306d2de8">start</a>;
<a name="l10406"></a>10406                 <span class="keywordflow">if</span> (length == 0.0f) length= 1.0f;
<a name="l10407"></a>10407                 actlength = strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a073a7ae656358268ee3d420b9d6869d8">actend</a>-strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a0ed78fc8c736e6d0edf26be043f72f69">actstart</a>;
<a name="l10408"></a>10408                 
<a name="l10409"></a>10409                 strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a930aeaf6ab32582859087b304d0a2d67">scale</a> = length / (repeat * actlength);
<a name="l10410"></a>10410                 <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a930aeaf6ab32582859087b304d0a2d67">scale</a> == 0.0f) strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a930aeaf6ab32582859087b304d0a2d67">scale</a>= 1.0f;
<a name="l10411"></a>10411             }   
<a name="l10412"></a>10412             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>) {
<a name="l10413"></a>10413                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a57a14bd65c23078ed83859a5d0d33b3f">inpush</a> =  ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a612832359b1890ea4cc58fd8fd6c9d2e">inspring</a>;
<a name="l10414"></a>10414                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a9fdde7ead243fec0004fc4847a3358e6">shearstiff</a> = 1.0f; 
<a name="l10415"></a>10415             }
<a name="l10416"></a>10416         }
<a name="l10417"></a>10417     }
<a name="l10418"></a>10418 
<a name="l10419"></a>10419     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 14)) {
<a name="l10420"></a>10420         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10421"></a>10421         <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l10422"></a>10422         
<a name="l10423"></a>10423         <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10424"></a>10424             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l10425"></a>10425                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#ac532cdf45364dcbb87326ac03dc1fe03">blend_mode</a> == 0)
<a name="l10426"></a>10426                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a60bfea924ac0cd3bca3164320a712de7">blend_opacity</a> = 100.0f;
<a name="l10427"></a>10427             }
<a name="l10428"></a>10428             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l10429"></a>10429         }
<a name="l10430"></a>10430     }
<a name="l10431"></a>10431     
<a name="l10432"></a>10432     <span class="comment">/*fix broken group lengths in id properties*/</span>
<a name="l10433"></a>10433     <span class="keywordflow">if</span> ((main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 245) || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 245 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 15)) {
<a name="l10434"></a>10434         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>);
<a name="l10435"></a>10435         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6bffff38363f40d7a1d3678afcba4b90">library</a>);
<a name="l10436"></a>10436         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>);
<a name="l10437"></a>10437         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>);
<a name="l10438"></a>10438         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>);
<a name="l10439"></a>10439         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac1605716bd05f0456c07263500010810">mball</a>);
<a name="l10440"></a>10440         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>);
<a name="l10441"></a>10441         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>);
<a name="l10442"></a>10442         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>);
<a name="l10443"></a>10443         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acc71d9ddb63ba1e24a044109bb6bab45">latt</a>);
<a name="l10444"></a>10444         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>);
<a name="l10445"></a>10445         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a331d71d4f599b49bb6b38e48b7cfc7bf">camera</a>);
<a name="l10446"></a>10446         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a506519dfdc231b82be806d4b53a09a4c">ipo</a>);
<a name="l10447"></a>10447         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1194bb31422b5ad4cd169ea17a08c0a6">key</a>);
<a name="l10448"></a>10448         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>);
<a name="l10449"></a>10449         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>);
<a name="l10450"></a>10450         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3e9b648f3c97050a53bdfc1a2a015916">script</a>);
<a name="l10451"></a>10451         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abef2da7d5c3a1975eb74128e4d70c682">vfont</a>);
<a name="l10452"></a>10452         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#aba48dab3abbe5521b8493006361d2d51">text</a>);
<a name="l10453"></a>10453         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>);
<a name="l10454"></a>10454         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>);
<a name="l10455"></a>10455         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>);
<a name="l10456"></a>10456         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a672d2abaa0d861f3a2d938549cbe212b">action</a>);
<a name="l10457"></a>10457         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>);
<a name="l10458"></a>10458         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>);
<a name="l10459"></a>10459         <a class="code" href="../../d0/d12/readfile_8c.html#aecede184f8a325a55d629588c5d9086f">idproperties_fix_group_lengths</a>(main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>);     
<a name="l10460"></a>10460     }
<a name="l10461"></a>10461 
<a name="l10462"></a>10462     <span class="comment">/* sun/sky */</span>
<a name="l10463"></a>10463     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 246) {
<a name="l10464"></a>10464         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10465"></a>10465         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l10466"></a>10466 
<a name="l10467"></a>10467         <span class="comment">/* dRot actuator change direction in 2.46 */</span>
<a name="l10468"></a>10468         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10469"></a>10469             <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l10470"></a>10470                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l10471"></a>10471                     <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *ba= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l10472"></a>10472 
<a name="l10473"></a>10473                     ba-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>[0] = -ba-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>[0];
<a name="l10474"></a>10474                     ba-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>[1] = -ba-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>[1];
<a name="l10475"></a>10475                     ba-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>[2] = -ba-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>[2];
<a name="l10476"></a>10476                 }
<a name="l10477"></a>10477             }
<a name="l10478"></a>10478         }
<a name="l10479"></a>10479     }
<a name="l10480"></a>10480     
<a name="l10481"></a>10481     <span class="comment">// convert fluids to modifier</span>
<a name="l10482"></a>10482     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 246 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 246 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1))
<a name="l10483"></a>10483     {
<a name="l10484"></a>10484         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10485"></a>10485         
<a name="l10486"></a>10486         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10487"></a>10487             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac9ec82c5bdfa258cad2205e7e6dc73bd">fluidsimSettings</a>)
<a name="l10488"></a>10488             {
<a name="l10489"></a>10489                 <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fluidmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>);
<a name="l10490"></a>10490                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, (<a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *)fluidmd);
<a name="l10491"></a>10491                 
<a name="l10492"></a>10492                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(fluidmd-&gt;fss);
<a name="l10493"></a>10493                 fluidmd-&gt;fss = <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac9ec82c5bdfa258cad2205e7e6dc73bd">fluidsimSettings</a>);
<a name="l10494"></a>10494                 fluidmd-&gt;fss-&gt;ipo = <a class="code" href="../../d0/d12/readfile_8c.html#a85023c62b60ca44e79a06fb8b5985252">newlibadr_us</a>(fd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac9ec82c5bdfa258cad2205e7e6dc73bd">fluidsimSettings</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#ada29cb3e71d30a409e4e895817f637b9">ipo</a>);
<a name="l10495"></a>10495                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac9ec82c5bdfa258cad2205e7e6dc73bd">fluidsimSettings</a>);
<a name="l10496"></a>10496                 
<a name="l10497"></a>10497                 fluidmd-&gt;fss-&gt;lastgoodframe = INT_MAX;
<a name="l10498"></a>10498                 fluidmd-&gt;fss-&gt;flag = 0;
<a name="l10499"></a>10499                 fluidmd-&gt;fss-&gt;meshVelocities = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10500"></a>10500             }
<a name="l10501"></a>10501         }
<a name="l10502"></a>10502     }
<a name="l10503"></a>10503     
<a name="l10504"></a>10504 
<a name="l10505"></a>10505     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 246 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 246 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l10506"></a>10506         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l10507"></a>10507 
<a name="l10508"></a>10508         <span class="keywordflow">for</span> (me=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10509"></a>10509             <a class="code" href="../../d0/d12/readfile_8c.html#a73a7c50f17735f433d4f847146842abd">alphasort_version_246</a>(fd, lib, me);
<a name="l10510"></a>10510     }
<a name="l10511"></a>10511     
<a name="l10512"></a>10512     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 246 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 246 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l10513"></a>10513         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10514"></a>10514         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10515"></a>10515             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba22fb65898d213ba25a4a89bbe5c50fc0">PFIELD_WIND</a>))
<a name="l10516"></a>10516                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a51d118ee833b9c75e26410f145fc3ee8">f_noise</a> = 0.0f;
<a name="l10517"></a>10517         }
<a name="l10518"></a>10518     }
<a name="l10519"></a>10519 
<a name="l10520"></a>10520     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l10521"></a>10521         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10522"></a>10522         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10523"></a>10523             ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c7078a7f5ed6280084e98461c019ac2">OB_COLLISION</a>;
<a name="l10524"></a>10524             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1fc21f5de759e2ad98ee28422d872191">margin</a> = 0.06f;
<a name="l10525"></a>10525         }
<a name="l10526"></a>10526     }
<a name="l10527"></a>10527 
<a name="l10528"></a>10528     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3)) {
<a name="l10529"></a>10529         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10530"></a>10530         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10531"></a>10531             <span class="comment">// Starting from subversion 3, ACTOR is a separate feature.</span>
<a name="l10532"></a>10532             <span class="comment">// Before it was conditioning all the other dynamic flags</span>
<a name="l10533"></a>10533             <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad76bdc9402018000455811d82659d7f4">OB_ACTOR</a>))
<a name="l10534"></a>10534                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp;= ~(<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af296003e3a9b1b16427b1cc72c2509d2">OB_GHOST</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ab0e087d4d1cba100d6aada23fef63137">OB_DYNAMIC</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a134c3f4cef16db08d3532d04adefa6fa">OB_RIGID_BODY</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af92fc03b976c0b0b12655c193bd15a44">OB_SOFT_BODY</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a6d4f379c1afd0aaada360367ba4295ee">OB_COLLISION_RESPONSE</a>);
<a name="l10535"></a>10535             <span class="comment">/* suitable default for older files */</span>
<a name="l10536"></a>10536         }
<a name="l10537"></a>10537     }
<a name="l10538"></a>10538 
<a name="l10539"></a>10539     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 5)) {
<a name="l10540"></a>10540         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l10541"></a>10541         <span class="keywordflow">for</span> (; la; la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10542"></a>10542             la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a4d7951e6944fc10ad9984eeecf11f47a">skyblendtype</a>= <a class="code" href="../../de/db2/DNA__material__types_8h.html#af8d237bee50be22fce6d0822f0bdd6f0">MA_RAMP_ADD</a>;
<a name="l10543"></a>10543             la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aaf1c0a0b108ae09435ab393b85eb67ea">skyblendfac</a>= 1.0f;
<a name="l10544"></a>10544         }
<a name="l10545"></a>10545     }
<a name="l10546"></a>10546     
<a name="l10547"></a>10547     <span class="comment">/* set the curve radius interpolation to 2.47 default - easy */</span>
<a name="l10548"></a>10548     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 6)) {
<a name="l10549"></a>10549         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l10550"></a>10550         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l10551"></a>10551         
<a name="l10552"></a>10552         <span class="keywordflow">for</span> (cu= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cu; cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10553"></a>10553             <span class="keywordflow">for</span> (nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l10554"></a>10554                 <span class="keywordflow">if</span> (nu) {
<a name="l10555"></a>10555                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#abb72597159d8b0d99fa12f07d275ce60">radius_interp</a> = 3;
<a name="l10556"></a>10556                     
<a name="l10557"></a>10557                     <span class="comment">/* resolu and resolv are now used differently for surfaces</span>
<a name="l10558"></a>10558 <span class="comment">                     * rather than using the resolution to define the entire number of divisions,</span>
<a name="l10559"></a>10559 <span class="comment">                     * use it for the number of divisions per segment</span>
<a name="l10560"></a>10560 <span class="comment">                     */</span>
<a name="l10561"></a>10561                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &gt; 1) {
<a name="l10562"></a>10562                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a> = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>( 1, (<span class="keywordtype">int</span>)(((<span class="keywordtype">float</span>)nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a> / (<span class="keywordtype">float</span>)nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)+0.5f) );
<a name="l10563"></a>10563                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a> = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>( 1, (<span class="keywordtype">int</span>)(((<span class="keywordtype">float</span>)nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a> / (<span class="keywordtype">float</span>)nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>)+0.5f) );
<a name="l10564"></a>10564                     }
<a name="l10565"></a>10565                 }
<a name="l10566"></a>10566             }
<a name="l10567"></a>10567         }
<a name="l10568"></a>10568     }
<a name="l10569"></a>10569     <span class="comment">/* direction constraint actuators were always local in previous version */</span>
<a name="l10570"></a>10570     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 7)) {
<a name="l10571"></a>10571         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l10572"></a>10572         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10573"></a>10573         
<a name="l10574"></a>10574         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10575"></a>10575             <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l10576"></a>10576                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af4219f856735c8b17e378aa709b9a180">ACT_CONSTRAINT</a>) {
<a name="l10577"></a>10577                     <a class="code" href="../../de/d82/structbConstraintActuator.html">bConstraintActuator</a> *coa = act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l10578"></a>10578                     <span class="keywordflow">if</span> (coa-&gt;<a class="code" href="../../de/d82/structbConstraintActuator.html#a6e0f67b45be550b8e98c1025075d21f8">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a03f0df83dcd34398543360ee97c13123">ACT_CONST_TYPE_DIST</a>) {
<a name="l10579"></a>10579                         coa-&gt;<a class="code" href="../../de/d82/structbConstraintActuator.html#a1c711231f7a0ee410ae093f04f125137">flag</a> |= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a2f2957ad103da5a8e4112c95e984b80d">ACT_CONST_LOCAL</a>;
<a name="l10580"></a>10580                     }
<a name="l10581"></a>10581                 }
<a name="l10582"></a>10582             }
<a name="l10583"></a>10583         }
<a name="l10584"></a>10584     }
<a name="l10585"></a>10585 
<a name="l10586"></a>10586     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 9)) {
<a name="l10587"></a>10587         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l10588"></a>10588         <span class="keywordflow">for</span> (; la; la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10589"></a>10589             la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a5ad9d5d11b7d1b3c64ca40c63d599982">sky_exposure</a>= 1.0f;
<a name="l10590"></a>10590         }
<a name="l10591"></a>10591     }
<a name="l10592"></a>10592     
<a name="l10593"></a>10593     <span class="comment">/* BGE message actuators needed OB prefix, very confusing */</span>
<a name="l10594"></a>10594     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 247 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 247 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 10)) {
<a name="l10595"></a>10595         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l10596"></a>10596         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10597"></a>10597         
<a name="l10598"></a>10598         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10599"></a>10599             <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l10600"></a>10600                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae4015d5dd2b07f1caedc5039e7dd3753">ACT_MESSAGE</a>) {
<a name="l10601"></a>10601                     <a class="code" href="../../df/d12/structbMessageActuator.html">bMessageActuator</a> *msgAct = (<a class="code" href="../../df/d12/structbMessageActuator.html">bMessageActuator</a> *) act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l10602"></a>10602                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d3/db3/BLI__string_8h.html#a4657f9ca919c8124abd611331344d5eb">BLI_strnlen</a>(msgAct-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a3a3cc183a0b1db937d9ef2e732451111">toPropName</a>, 3) &gt; 2) {
<a name="l10603"></a>10603                         <span class="comment">/* strip first 2 chars, would have only worked if these were OB anyway */</span>
<a name="l10604"></a>10604                         memmove(msgAct-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a3a3cc183a0b1db937d9ef2e732451111">toPropName</a>, msgAct-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a3a3cc183a0b1db937d9ef2e732451111">toPropName</a> + 2, <span class="keyword">sizeof</span>(msgAct-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a3a3cc183a0b1db937d9ef2e732451111">toPropName</a>) - 2);
<a name="l10605"></a>10605                     }
<a name="l10606"></a>10606                     <span class="keywordflow">else</span> {
<a name="l10607"></a>10607                         msgAct-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a3a3cc183a0b1db937d9ef2e732451111">toPropName</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l10608"></a>10608                     }
<a name="l10609"></a>10609                 }
<a name="l10610"></a>10610             }
<a name="l10611"></a>10611         }
<a name="l10612"></a>10612     }
<a name="l10613"></a>10613 
<a name="l10614"></a>10614     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 248) {
<a name="l10615"></a>10615         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l10616"></a>10616 
<a name="l10617"></a>10617         <span class="keywordflow">for</span> (la=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; la; la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10618"></a>10618             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a57704fb95867650e3cd5ccd3f8e8e7a5">atm_turbidity</a> == 0.0f) {
<a name="l10619"></a>10619                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a24f8a2566a937e0d6e71b654981155b7">sun_effect_type</a> = 0;
<a name="l10620"></a>10620                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aeeca86969386970112fbedcb4d062b46">horizon_brightness</a> = 1.0f;
<a name="l10621"></a>10621                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a58c58abc764824dd8a9105493ed315da">spread</a> = 1.0f;
<a name="l10622"></a>10622                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a886cdc0af5a053e4cc18fb5c7cc29656">sun_brightness</a> = 1.0f;
<a name="l10623"></a>10623                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ac7679fe5d6d432623b397074142e763e">sun_size</a> = 1.0f;
<a name="l10624"></a>10624                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#af657e9af8c9cd30a9d3f67a1cbde6c26">backscattered_light</a> = 1.0f;
<a name="l10625"></a>10625                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a57704fb95867650e3cd5ccd3f8e8e7a5">atm_turbidity</a> = 2.0f;
<a name="l10626"></a>10626                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a2f34b114dde0ef2017269b54e5d25cbf">atm_inscattering_factor</a> = 1.0f;
<a name="l10627"></a>10627                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a3453aa42999f6e85a196136230a99d79">atm_extinction_factor</a> = 1.0f;
<a name="l10628"></a>10628                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a0cc554c5691da901eec00e78060ea1fd">atm_distance_factor</a> = 1.0f;
<a name="l10629"></a>10629                 la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ade5c6e06edfa2cf2c8214d8f639b7fca">sun_intensity</a> = 1.0f;
<a name="l10630"></a>10630             }
<a name="l10631"></a>10631         }
<a name="l10632"></a>10632     }
<a name="l10633"></a>10633 
<a name="l10634"></a>10634     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 248 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 248 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l10635"></a>10635         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10636"></a>10636         
<a name="l10637"></a>10637         <span class="comment">/* Note, these will need to be added for painting */</span>
<a name="l10638"></a>10638         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10639"></a>10639             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a1a36b13607238910a064c1b9b61430e5">imapaint</a>.<a class="code" href="../../d1/d54/structImagePaintSettings.html#ae5925dc4ec1c892dbdad54d31840fac0">seam_bleed</a> = 2;
<a name="l10640"></a>10640             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a1a36b13607238910a064c1b9b61430e5">imapaint</a>.<a class="code" href="../../d1/d54/structImagePaintSettings.html#ad31c396b208e9e258d1d29f2728dd23f">normal_angle</a> = 80;
<a name="l10641"></a>10641 
<a name="l10642"></a>10642             <span class="comment">/* initialize skeleton generation toolsettings */</span>
<a name="l10643"></a>10643             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad35016b3588c2e982a56d823d6d42931">skgen_resolution</a> = 250;
<a name="l10644"></a>10644             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad611fe2d827aef3a4dddb037319521ab">skgen_threshold_internal</a>     = 0.1f;
<a name="l10645"></a>10645             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a7d9c2ffcc30090dc0e2771fe98aa973d">skgen_threshold_external</a>     = 0.1f;
<a name="l10646"></a>10646             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a713edf332679a877df0768ff4483da6b">skgen_angle_limit</a>            = 30.0f;
<a name="l10647"></a>10647             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa7250ee91727d25fc0275bc0c24e7ab0">skgen_length_ratio</a>           = 1.3f;
<a name="l10648"></a>10648             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa2790c37c143dde5059ab46b2ac762b3">skgen_length_limit</a>           = 1.5f;
<a name="l10649"></a>10649             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ac16453770a42da352046774f40bf68e8">skgen_correlation_limit</a>      = 0.98f;
<a name="l10650"></a>10650             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad770c942287a18f84ffc8b6020081dbc">skgen_symmetry_limit</a>         = 0.1f;
<a name="l10651"></a>10651             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa74543b96456a0884b16ee0a94e30621">skgen_postpro</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#acc807c5db90884d879a648f0e59ed251">SKGEN_SMOOTH</a>;
<a name="l10652"></a>10652             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ae616d6e3ba62b191a05aac732df4c3d1">skgen_postpro_passes</a> = 3;
<a name="l10653"></a>10653             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#af0b94a84b1f5e158a318aad58c19ea4b">skgen_options</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a76f0f1e1f080a612e46a76cc88364305">SKGEN_FILTER_INTERNAL</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac4438acbff074ca6751ff8cad840e944">SKGEN_FILTER_EXTERNAL</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac6623cbafad283f059205b8d57d60d0f">SKGEN_FILTER_SMART</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a6bc84f7c60c397a71bee8f1417469e2f">SKGEN_SUB_CORRELATION</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1396a8dca33b937bb73a34a9a420b45a">SKGEN_HARMONIC</a>;
<a name="l10654"></a>10654             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[0] = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a6bc84f7c60c397a71bee8f1417469e2f">SKGEN_SUB_CORRELATION</a>;
<a name="l10655"></a>10655             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[1] = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa48b85331094d01b26ad9752030db4ab">SKGEN_SUB_LENGTH</a>;
<a name="l10656"></a>10656             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a9fb75687b5956f6aff36ea0d5a6f587e">skgen_subdivisions</a>[2] = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a361c0d433ad9e037ce767c0e2993dc27">SKGEN_SUB_ANGLE</a>;
<a name="l10657"></a>10657 
<a name="l10658"></a>10658             
<a name="l10659"></a>10659             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a980e98ee45fdaf83e3293df658c0fc90">skgen_retarget_angle_weight</a> = 1.0f;
<a name="l10660"></a>10660             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a282cf4291dde76a13fc9b71cd9dc30fd">skgen_retarget_length_weight</a> = 1.0f;
<a name="l10661"></a>10661             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#affad1377427fe2904858bb35ac327ab5">skgen_retarget_distance_weight</a> = 1.0f;
<a name="l10662"></a>10662     
<a name="l10663"></a>10663             <span class="comment">/* Skeleton Sketching */</span>
<a name="l10664"></a>10664             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a8e9ff59a2723500fe3dd5268ec030d72">bone_sketching</a> = 0;
<a name="l10665"></a>10665             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a586ff00d105596f00d4536be03a65380">skgen_retarget_roll</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a01e081c69b0b3fd6a65672a1f4f6fe2a">SK_RETARGET_ROLL_VIEW</a>;
<a name="l10666"></a>10666         }
<a name="l10667"></a>10667     }
<a name="l10668"></a>10668     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 248 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 248 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3)) {
<a name="l10669"></a>10669         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l10670"></a>10670         
<a name="l10671"></a>10671         <span class="comment">/* adjust default settings for Animation Editors */</span>
<a name="l10672"></a>10672         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10673"></a>10673             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l10674"></a>10674             
<a name="l10675"></a>10675             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) { 
<a name="l10676"></a>10676                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l10677"></a>10677                 
<a name="l10678"></a>10678                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l10679"></a>10679                     <span class="keywordflow">switch</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>) {
<a name="l10680"></a>10680                         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>:
<a name="l10681"></a>10681                         {
<a name="l10682"></a>10682                             <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *sact= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)sl;
<a name="l10683"></a>10683                             
<a name="l10684"></a>10684                             sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a4f4f54282a990ada2404fd3f3307bf81">SACTCONT_DOPESHEET</a>;
<a name="l10685"></a>10685                             sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#ae9227fbb8c3fe17e7abdaee5ffc533fe">autosnap</a>= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dabb28c3972c6e6afc95d25b1d67c87998">SACTSNAP_FRAME</a>;
<a name="l10686"></a>10686                         }
<a name="l10687"></a>10687                             <span class="keywordflow">break</span>;
<a name="l10688"></a>10688                         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>:
<a name="l10689"></a>10689                         {
<a name="l10690"></a>10690                             <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)sl;
<a name="l10691"></a>10691                             sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a8ddd7ffb9a5028e877633d4a2830dd50">autosnap</a>= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dabb28c3972c6e6afc95d25b1d67c87998">SACTSNAP_FRAME</a>;
<a name="l10692"></a>10692                         }
<a name="l10693"></a>10693                             <span class="keywordflow">break</span>;
<a name="l10694"></a>10694                         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>:
<a name="l10695"></a>10695                         {
<a name="l10696"></a>10696                             <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l10697"></a>10697                             snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#a3df211992f234d0bebd62cb836ab5a7f">autosnap</a>= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a2640d39c6087e21706402898875da80dabb28c3972c6e6afc95d25b1d67c87998">SACTSNAP_FRAME</a>;
<a name="l10698"></a>10698                         }
<a name="l10699"></a>10699                             <span class="keywordflow">break</span>;
<a name="l10700"></a>10700                     }
<a name="l10701"></a>10701                 }
<a name="l10702"></a>10702             }
<a name="l10703"></a>10703         }
<a name="l10704"></a>10704     }
<a name="l10705"></a>10705 
<a name="l10706"></a>10706     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 248 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 248 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3)) {
<a name="l10707"></a>10707         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10708"></a>10708 
<a name="l10709"></a>10709         <span class="comment">/* Adjustments needed after Bullets update */</span>
<a name="l10710"></a>10710         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10711"></a>10711             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0f7412e63750dbfc2e4bd485ff7a9920">damping</a> *= 0.635f;
<a name="l10712"></a>10712             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0216bf8bf0f5207ab1ff917f30305d79">rdamping</a> = 0.1f + (0.8f * ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0216bf8bf0f5207ab1ff917f30305d79">rdamping</a>);
<a name="l10713"></a>10713         }
<a name="l10714"></a>10714     }
<a name="l10715"></a>10715     
<a name="l10716"></a>10716     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 248 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 248 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4)) {
<a name="l10717"></a>10717         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10718"></a>10718         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l10719"></a>10719 
<a name="l10720"></a>10720         <span class="comment">/*  Dome (Fisheye) default parameters  */</span>
<a name="l10721"></a>10721         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10722"></a>10722             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domeangle = 180;
<a name="l10723"></a>10723             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domemode = 1;
<a name="l10724"></a>10724             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domeres = 4;
<a name="l10725"></a>10725             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domeresbuf = 1.0f;
<a name="l10726"></a>10726             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.dometilt = 0;
<a name="l10727"></a>10727         }
<a name="l10728"></a>10728         <span class="comment">/* DBVT culling by default */</span>
<a name="l10729"></a>10729         <span class="keywordflow">for</span> (wrld=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wrld; wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10730"></a>10730             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a97cd565855bf995024151e5a6ad307dc">mode</a> |= <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a70627b3eb11e0243d1b14fe206bef808">WO_DBVT_CULLING</a>;
<a name="l10731"></a>10731             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#acfda52808c7861f0aa7dd0d89ee90e86">occlusionRes</a> = 128;
<a name="l10732"></a>10732         }
<a name="l10733"></a>10733     }
<a name="l10734"></a>10734 
<a name="l10735"></a>10735     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 248 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 248 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 5)) {
<a name="l10736"></a>10736         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10737"></a>10737         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l10738"></a>10738         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10739"></a>10739             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a831b12aa59859bda341c6e7363cc6e5d">m_contactProcessingThreshold</a> = 1.0f; <span class="comment">//pad3 is used for m_contactProcessingThreshold</span>
<a name="l10740"></a>10740             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>) {
<a name="l10741"></a>10741                 <span class="comment">/* check if top parent has compound shape set and if yes, set this object</span>
<a name="l10742"></a>10742 <span class="comment">                 * to compound shaper as well (was the behavior before, now it&#39;s optional) */</span>
<a name="l10743"></a>10743                 <a class="code" href="../../de/de7/structObject.html">Object</a> *parent= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l10744"></a>10744                 <span class="keywordflow">while</span> (parent &amp;&amp; parent != ob &amp;&amp;  parent-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l10745"></a>10745                     parent = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, parent-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l10746"></a>10746                 }
<a name="l10747"></a>10747                 <span class="keywordflow">if</span> (parent) {
<a name="l10748"></a>10748                     <span class="keywordflow">if</span> (parent-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a4fd624f7103b4845d856dcd7f9d6c179">OB_CHILD</a>)
<a name="l10749"></a>10749                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a4fd624f7103b4845d856dcd7f9d6c179">OB_CHILD</a>;
<a name="l10750"></a>10750                 }
<a name="l10751"></a>10751             }
<a name="l10752"></a>10752         }
<a name="l10753"></a>10753         <span class="keywordflow">for</span> (wrld=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wrld; wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10754"></a>10754             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#abfdb7f328f3147028d0511355b86b43a">ticrate</a> = 60;
<a name="l10755"></a>10755             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a55ba0c8bf235a84cc3133f793ca29445">maxlogicstep</a> = 5;
<a name="l10756"></a>10756             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a6bb97a0c2e2b32d22c74c97bf1567a5f">physubstep</a> = 1;
<a name="l10757"></a>10757             wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa81354e2886debb6ab68cbaaa3afe14b">maxphystep</a> = 5;
<a name="l10758"></a>10758         }
<a name="l10759"></a>10759     }
<a name="l10760"></a>10760     
<a name="l10761"></a>10761     <span class="comment">// correct introduce of seed for wind force</span>
<a name="l10762"></a>10762     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 249 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1) {
<a name="l10763"></a>10763         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10764"></a>10764         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10765"></a>10765             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>)
<a name="l10766"></a>10766                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a0f7a3f82ff39133f40f053481067d2f2">seed</a> = ((<span class="keywordtype">unsigned</span> int)(ceil(<a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>()))+1) % 128;
<a name="l10767"></a>10767         }
<a name="l10768"></a>10768     
<a name="l10769"></a>10769     }
<a name="l10770"></a>10770 
<a name="l10771"></a>10771     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 249 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2) {
<a name="l10772"></a>10772         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l10773"></a>10773         <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l10774"></a>10774         <a class="code" href="../../d5/de9/structEditing.html">Editing</a> *ed;
<a name="l10775"></a>10775         
<a name="l10776"></a>10776         <span class="keywordflow">while</span> (sce) {
<a name="l10777"></a>10777             ed= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>;
<a name="l10778"></a>10778             <span class="keywordflow">if</span> (ed) {
<a name="l10779"></a>10779                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#aec8906c47a30af947fb6945abd9d0dab">SEQP_BEGIN</a>(ed, seq) {
<a name="l10780"></a>10780                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a> &amp;&amp; seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>) {
<a name="l10781"></a>10781                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>-&gt;<a class="code" href="../../da/d3b/structStripProxy.html#a6dc5bd673453f504820dff01db87f935">quality</a> =90;
<a name="l10782"></a>10782                     }
<a name="l10783"></a>10783                 }
<a name="l10784"></a>10784                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l10785"></a>10785             }
<a name="l10786"></a>10786             
<a name="l10787"></a>10787             sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l10788"></a>10788         }
<a name="l10789"></a>10789 
<a name="l10790"></a>10790     }
<a name="l10791"></a>10791 
<a name="l10792"></a>10792     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250) {
<a name="l10793"></a>10793         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l10794"></a>10794         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l10795"></a>10795         <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l10796"></a>10796         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l10797"></a>10797         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam;
<a name="l10798"></a>10798         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l10799"></a>10799         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l10800"></a>10800         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10801"></a>10801         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tx;
<a name="l10802"></a>10802         <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l10803"></a>10803         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10804"></a>10804         <span class="comment">//PTCacheID *pid;</span>
<a name="l10805"></a>10805         <span class="comment">//ListBase pidlist;</span>
<a name="l10806"></a>10806 
<a name="l10807"></a>10807         <a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *sound;
<a name="l10808"></a>10808         <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l10809"></a>10809         <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l10810"></a>10810         <span class="keywordtype">int</span> a;
<a name="l10811"></a>10811 
<a name="l10812"></a>10812         <span class="keywordflow">for</span> (sound = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sound; sound = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10813"></a>10813         {
<a name="l10814"></a>10814             <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a>)
<a name="l10815"></a>10815             {
<a name="l10816"></a>10816                 sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a>;
<a name="l10817"></a>10817                 sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a54c1dc4f85eb76949f8b63eca0eb695b">newpackedfile</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l10818"></a>10818             }
<a name="l10819"></a>10819         }
<a name="l10820"></a>10820 
<a name="l10821"></a>10821         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10822"></a>10822             <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l10823"></a>10823                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a8886ccc844380010702d2a9cbb991ee3">ACT_SOUND</a>) {
<a name="l10824"></a>10824                     <a class="code" href="../../d1/da3/structbSoundActuator.html">bSoundActuator</a> *sAct = (<a class="code" href="../../d1/da3/structbSoundActuator.html">bSoundActuator</a>*) act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l10825"></a>10825                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#a4d73983f46d44a780d3a82a310c327ca">sound</a>)
<a name="l10826"></a>10826                     {
<a name="l10827"></a>10827                         sound = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#a4d73983f46d44a780d3a82a310c327ca">sound</a>);
<a name="l10828"></a>10828                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad53244682640cbc094a22907ae86f92e">flag</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a3359f77bc2f3c090848eee0746d7ae9e">flags</a> &amp; <a class="code" href="../../d1/d66/DNA__sound__types_8h.html#ac432068439ce729c93c9d632bd430c1a">SOUND_FLAGS_3D</a> ? <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae6ede83b5d243ee638677c7abdadc25d">ACT_SND_3D_SOUND</a> : 0;
<a name="l10829"></a>10829                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#a2b2e46ef57c7d3e96903413c70442c34">pitch</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#ae214508acea3be0ce45cbaa85e9f414e">pitch</a>;
<a name="l10830"></a>10830                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#adbd7f3a297549818be9239b1530650d0">volume</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#af9dd369d781b776bba60c5d09942bdc3">volume</a>;
<a name="l10831"></a>10831                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#aee38aca48e841c716b0de6a61e9b0408">reference_distance</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#adb5034a33a7b60d01d5cb4cb32ee1a0a">distance</a>;
<a name="l10832"></a>10832                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#ac93039b4596f60a72306a05fcb7d3328">max_gain</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#acafbe293846803a34a5b8e7916ed0bd4">max_gain</a>;
<a name="l10833"></a>10833                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#aebb43ad2885eee67d7b4cbd44e9cbb35">min_gain</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a6d4a1c6677a81f0b6560b407c4dc6176">min_gain</a>;
<a name="l10834"></a>10834                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#acc49f3d0252578f1b55733998d9eb6ad">rolloff_factor</a> = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#ae3a69a9ea18ff22bc066cd25ad3660e7">attenuation</a>;
<a name="l10835"></a>10835                     }
<a name="l10836"></a>10836                     <span class="keywordflow">else</span> {
<a name="l10837"></a>10837                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#aee38aca48e841c716b0de6a61e9b0408">reference_distance</a> = 1.0f;
<a name="l10838"></a>10838                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#adbd7f3a297549818be9239b1530650d0">volume</a> = 1.0f;
<a name="l10839"></a>10839                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#ac93039b4596f60a72306a05fcb7d3328">max_gain</a> = 1.0f;
<a name="l10840"></a>10840                         sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#acc49f3d0252578f1b55733998d9eb6ad">rolloff_factor</a> = 1.0f;
<a name="l10841"></a>10841                     }
<a name="l10842"></a>10842                     sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#a64b8bcb6e3f60cfee59703780903290e">cone_inner_angle</a> = 360.0f;
<a name="l10843"></a>10843                     sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#a25404b7ac91920499b61867845c93768">cone_outer_angle</a> = 360.0f;
<a name="l10844"></a>10844                     sAct-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#ad5af94cd60a90c8c9d55c1682c943dfd">sound3D</a>.<a class="code" href="../../d4/ddb/structSound3D.html#a028efb0927a03661c7647881c9b58c7e">max_distance</a> = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l10845"></a>10845                 }
<a name="l10846"></a>10846             }
<a name="l10847"></a>10847         }
<a name="l10848"></a>10848 
<a name="l10849"></a>10849         <span class="keywordflow">for</span> (scene = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l10850"></a>10850         {
<a name="l10851"></a>10851             <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a> &amp;&amp; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a>)
<a name="l10852"></a>10852             {
<a name="l10853"></a>10853                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l10854"></a>10854                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af135daf13efd69a8d844dc7d9058cdc1">SEQ_HD_SOUND</a>)
<a name="l10855"></a>10855                     {
<a name="l10856"></a>10856                         <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l10857"></a>10857                         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af06511817c824c772ec102e6b23a3207">BLI_join_dirfile</a>(str, <span class="keyword">sizeof</span>(str), seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a8875219904331387919a2a290cde7d78">dir</a>, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a>-&gt;<a class="code" href="../../d0/d38/structStripElem.html#a68eca881ea502f351f9a21fcdc99955d">name</a>);
<a name="l10858"></a>10858                         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(str, main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>);
<a name="l10859"></a>10859                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a> = <a class="code" href="../../d2/db1/BKE__sound_8h.html#a4f4df459c6732bfefb982c57c65fc1c1">sound_new_file</a>(main, str);
<a name="l10860"></a>10860                     }
<a name="l10861"></a>10861                     <span class="comment">/* don&#39;t know, if anybody used that</span>
<a name="l10862"></a>10862 <span class="comment">                     * this way, but just in case, upgrade</span>
<a name="l10863"></a>10863 <span class="comment">                     * to new way... */</span>
<a name="l10864"></a>10864                     <span class="keywordflow">if</span> ((seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#aa0166cf0ed112853e8f085bf01ed29e8">SEQ_USE_PROXY_CUSTOM_FILE</a>) &amp;&amp;
<a name="l10865"></a>10865                        !(seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a5821413d153af2a0c60308b945ba1144">SEQ_USE_PROXY_CUSTOM_DIR</a>))
<a name="l10866"></a>10866                     {
<a name="l10867"></a>10867                         
<a name="l10868"></a>10868                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>-&gt;<a class="code" href="../../da/d3b/structStripProxy.html#ac951a3bb1c4b0b283ad1abd19caf36c8">dir</a>, 
<a name="l10869"></a>10869                              <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#af231ebb113f3f085906d83d6424abefb">FILE_MAXDIR</a>, <span class="stringliteral">&quot;%s/BL_proxy&quot;</span>, 
<a name="l10870"></a>10870                              seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a8875219904331387919a2a290cde7d78">dir</a>);
<a name="l10871"></a>10871                     }
<a name="l10872"></a>10872                 }
<a name="l10873"></a>10873                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l10874"></a>10874             }
<a name="l10875"></a>10875         }
<a name="l10876"></a>10876 
<a name="l10877"></a>10877         <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10878"></a>10878             <a class="code" href="../../d0/d12/readfile_8c.html#a34234d79051c3c1e0b29e0baeb5ed024">do_versions_windowmanager_2_50</a>(screen);
<a name="l10879"></a>10879             <a class="code" href="../../d0/d12/readfile_8c.html#aa42b2524cbe854c45510e8e0e9b1b9e6">do_versions_gpencil_2_50</a>(main, screen);
<a name="l10880"></a>10880         }
<a name="l10881"></a>10881         
<a name="l10882"></a>10882         <span class="comment">/* shader, composite and texture node trees have id.name empty, put something in</span>
<a name="l10883"></a>10883 <span class="comment">         * to have them show in RNA viewer and accessible otherwise.</span>
<a name="l10884"></a>10884 <span class="comment">         */</span>
<a name="l10885"></a>10885         <span class="keywordflow">for</span> (ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10886"></a>10886             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a> &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[0] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l10887"></a>10887                 strcpy(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>, <span class="stringliteral">&quot;NTShader Nodetree&quot;</span>);
<a name="l10888"></a>10888             
<a name="l10889"></a>10889             <span class="comment">/* which_output 0 is now &quot;not specified&quot; */</span>
<a name="l10890"></a>10890             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l10891"></a>10891                 <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]) {
<a name="l10892"></a>10892                     tx= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l10893"></a>10893                     <span class="keywordflow">if</span> (tx &amp;&amp; tx-&gt;<a class="code" href="../../df/d2d/structTex.html#a68462151f8b18293c51d8928f2d3af9c">use_nodes</a>)
<a name="l10894"></a>10894                         ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a99b01f17feb6ed940e3b3a411d79aad7">which_output</a>++;
<a name="l10895"></a>10895                 }
<a name="l10896"></a>10896             }
<a name="l10897"></a>10897         }
<a name="l10898"></a>10898         <span class="comment">/* and composite trees */</span>
<a name="l10899"></a>10899         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10900"></a>10900             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a> &amp;&amp; sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[0] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l10901"></a>10901                 strcpy(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>, <span class="stringliteral">&quot;NTCompositing Nodetree&quot;</span>);
<a name="l10902"></a>10902 
<a name="l10903"></a>10903             <span class="comment">/* move to cameras */</span>
<a name="l10904"></a>10904             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a734c49fbcb5788988d667052995f4fa0">R_PANORAMA</a>) {
<a name="l10905"></a>10905                 <span class="keywordflow">for</span> (base=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base=base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l10906"></a>10906                     ob= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>);
<a name="l10907"></a>10907 
<a name="l10908"></a>10908                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a> &amp;&amp; !ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l10909"></a>10909                         cam= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l10910"></a>10910                         cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> |= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a2cc8f6e08560c47032ee909c2d7cc2ea">CAM_PANORAMA</a>;
<a name="l10911"></a>10911                     }
<a name="l10912"></a>10912                 }
<a name="l10913"></a>10913 
<a name="l10914"></a>10914                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a734c49fbcb5788988d667052995f4fa0">R_PANORAMA</a>;
<a name="l10915"></a>10915             }
<a name="l10916"></a>10916         }
<a name="l10917"></a>10917         <span class="comment">/* and texture trees */</span>
<a name="l10918"></a>10918         <span class="keywordflow">for</span> (tx= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tx; tx= tx-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10919"></a>10919             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l10920"></a>10920 
<a name="l10921"></a>10921             <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>) {
<a name="l10922"></a>10922                 <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[0] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l10923"></a>10923                     strcpy(tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>, <span class="stringliteral">&quot;NTTexture Nodetree&quot;</span>);
<a name="l10924"></a>10924 
<a name="l10925"></a>10925                 <span class="comment">/* which_output 0 is now &quot;not specified&quot; */</span>
<a name="l10926"></a>10926                 <span class="keywordflow">for</span> (node=tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l10927"></a>10927                     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ac211721c4d688750f281901d7619001d">TEX_NODE_OUTPUT</a>)
<a name="l10928"></a>10928                         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>++;
<a name="l10929"></a>10929             }
<a name="l10930"></a>10930         }
<a name="l10931"></a>10931         
<a name="l10932"></a>10932         <span class="comment">/* copy standard draw flag to meshes(used to be global, is not available here) */</span>
<a name="l10933"></a>10933         <span class="keywordflow">for</span> (me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10934"></a>10934             me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a>= <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a709689534fb2da54ef7af3a643e664e3">ME_DRAWEDGES</a>|<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#ad2e35ed3d2158ed9ffed13dcdc9cfbba">ME_DRAWFACES</a>|<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a4adb0704ed596d70aff2290e1894a237">ME_DRAWCREASES</a>;
<a name="l10935"></a>10935         }
<a name="l10936"></a>10936 
<a name="l10937"></a>10937         <span class="comment">/* particle draw and render types */</span>
<a name="l10938"></a>10938         <span class="keywordflow">for</span> (part= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10939"></a>10939             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a>) {
<a name="l10940"></a>10940                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>) {
<a name="l10941"></a>10941                     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a059fe997c5d0c2a058994d5d1f965ee9">PART_DRAW_HALO</a>;
<a name="l10942"></a>10942                     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a4c845dcc070e77eedb10185fc4d61d06">PART_DRAW_REND</a>;
<a name="l10943"></a>10943                 }
<a name="l10944"></a>10944                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> &lt;= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>) {
<a name="l10945"></a>10945                     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a059fe997c5d0c2a058994d5d1f965ee9">PART_DRAW_HALO</a>;
<a name="l10946"></a>10946                 }
<a name="l10947"></a>10947                 <span class="keywordflow">else</span> {
<a name="l10948"></a>10948                     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a>;
<a name="l10949"></a>10949                     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a4c845dcc070e77eedb10185fc4d61d06">PART_DRAW_REND</a>;
<a name="l10950"></a>10950                 }
<a name="l10951"></a>10951             }
<a name="l10952"></a>10952             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a15135d6b7e6634c4b7411a842b64a4ad">path_end</a> = 1.0f;
<a name="l10953"></a>10953             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a85af53a77afb1f903552d61e3fe9e8b6">clength</a> = 1.0f;
<a name="l10954"></a>10954         }
<a name="l10955"></a>10955         <span class="comment">/* set old pointcaches to have disk cache flag */</span>
<a name="l10956"></a>10956         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10957"></a>10957 
<a name="l10958"></a>10958             <span class="comment">//BKE_ptcache_ids_from_object(&amp;pidlist, ob);</span>
<a name="l10959"></a>10959 
<a name="l10960"></a>10960             <span class="comment">//for (pid=pidlist.first; pid; pid=pid-&gt;next)</span>
<a name="l10961"></a>10961             <span class="comment">//  pid-&gt;cache-&gt;flag |= PTCACHE_DISK_CACHE;</span>
<a name="l10962"></a>10962 
<a name="l10963"></a>10963             <span class="comment">//BLI_freelistN(&amp;pidlist);</span>
<a name="l10964"></a>10964         }
<a name="l10965"></a>10965 
<a name="l10966"></a>10966         <span class="comment">/* type was a mixed flag &amp; enum. move the 2d flag elsewhere */</span>
<a name="l10967"></a>10967         <span class="keywordflow">for</span> (cu = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cu; cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10968"></a>10968             <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l10969"></a>10969 
<a name="l10970"></a>10970             <span class="keywordflow">for</span> (nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l10971"></a>10971                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> |= (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aaff7c75290c54fa64f73a97718c2faf8">CU_2D</a>);
<a name="l10972"></a>10972                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> &amp;= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a899c94b9a6caab6a3987326c0604c31f">CU_TYPE</a>;
<a name="l10973"></a>10973             }
<a name="l10974"></a>10974         }
<a name="l10975"></a>10975     }
<a name="l10976"></a>10976 
<a name="l10977"></a>10977     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l10978"></a>10978         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l10979"></a>10979         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l10980"></a>10980         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l10981"></a>10981         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l10982"></a>10982         <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts;
<a name="l10983"></a>10983         <span class="comment">//PTCacheID *pid;</span>
<a name="l10984"></a>10984         <span class="comment">//ListBase pidlist;</span>
<a name="l10985"></a>10985 
<a name="l10986"></a>10986         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l10987"></a>10987             <span class="comment">//BKE_ptcache_ids_from_object(&amp;pidlist, ob);</span>
<a name="l10988"></a>10988 
<a name="l10989"></a>10989             <span class="comment">//for (pid=pidlist.first; pid; pid=pid-&gt;next) {</span>
<a name="l10990"></a>10990             <span class="comment">//  if (pid-&gt;ptcaches-&gt;first == NULL)</span>
<a name="l10991"></a>10991             <span class="comment">//      pid-&gt;ptcaches-&gt;first = pid-&gt;ptcaches-&gt;last = pid-&gt;cache;</span>
<a name="l10992"></a>10992             <span class="comment">//}</span>
<a name="l10993"></a>10993 
<a name="l10994"></a>10994             <span class="comment">//BLI_freelistN(&amp;pidlist);</span>
<a name="l10995"></a>10995 
<a name="l10996"></a>10996             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l10997"></a>10997                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l10998"></a>10998                 <span class="keywordtype">void</span> *olddata = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l10999"></a>10999                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> = me;
<a name="l11000"></a>11000 
<a name="l11001"></a>11001                 <span class="comment">/* XXX - library meshes crash on loading most yoFrankie levels,</span>
<a name="l11002"></a>11002 <span class="comment">                 * the multires pointer gets invalid -  Campbell */</span>
<a name="l11003"></a>11003                 <span class="keywordflow">if</span> (me &amp;&amp; me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; me-&gt;mr &amp;&amp; me-&gt;mr-&gt;level_count &gt; 1) {
<a name="l11004"></a>11004                     <a class="code" href="../../d1/d37/BKE__multires_8h.html#af631d63710c52b941a161a8e599ff093">multires_load_old</a>(ob, me);
<a name="l11005"></a>11005                 }
<a name="l11006"></a>11006 
<a name="l11007"></a>11007                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> = olddata;
<a name="l11008"></a>11008             }
<a name="l11009"></a>11009 
<a name="l11010"></a>11010             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a58e55b421436f3c376299a2179619150">matbits</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l11011"></a>11011                 <span class="keywordtype">int</span> a;
<a name="l11012"></a>11012 
<a name="l11013"></a>11013                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a58e55b421436f3c376299a2179619150">matbits</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>, <span class="stringliteral">&quot;ob-&gt;matbits&quot;</span>);
<a name="l11014"></a>11014                 <span class="keywordflow">for</span> (a=0; a&lt;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>; a++)
<a name="l11015"></a>11015                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a58e55b421436f3c376299a2179619150">matbits</a>[a]= ob-&gt;colbits &amp; (1&lt;&lt;a);
<a name="l11016"></a>11016             }
<a name="l11017"></a>11017         }
<a name="l11018"></a>11018 
<a name="l11019"></a>11019         <span class="comment">/* texture filter */</span>
<a name="l11020"></a>11020         <span class="keywordflow">for</span> (tex = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex = tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11021"></a>11021             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a901fc545220eddc1947d1a28a9ee2d6d">afmax</a> == 0)
<a name="l11022"></a>11022                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a901fc545220eddc1947d1a28a9ee2d6d">afmax</a>= 8;
<a name="l11023"></a>11023         }
<a name="l11024"></a>11024 
<a name="l11025"></a>11025         <span class="keywordflow">for</span> (ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11026"></a>11026             <span class="keywordtype">int</span> a;
<a name="l11027"></a>11027             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a9570b4bc0dd8a0d793a5e994e498fea9">MA_WIRE</a>) {
<a name="l11028"></a>11028                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab2181c8ca6ce7ebdb8858702b9dd044c">material_type</a>= <a class="code" href="../../de/db2/DNA__material__types_8h.html#ace7b0e47f96304e3d85afdf3d6f4ee51">MA_TYPE_WIRE</a>;
<a name="l11029"></a>11029                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp;= ~<a class="code" href="../../de/db2/DNA__material__types_8h.html#a9570b4bc0dd8a0d793a5e994e498fea9">MA_WIRE</a>;
<a name="l11030"></a>11030             }
<a name="l11031"></a>11031             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a0dcc062bc07ac15e934eccc6745eacbb">MA_HALO</a>) {
<a name="l11032"></a>11032                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab2181c8ca6ce7ebdb8858702b9dd044c">material_type</a>= <a class="code" href="../../de/db2/DNA__material__types_8h.html#a263f8a32d8cbe3456366b40cb01deab1">MA_TYPE_HALO</a>;
<a name="l11033"></a>11033                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp;= ~<a class="code" href="../../de/db2/DNA__material__types_8h.html#a0dcc062bc07ac15e934eccc6745eacbb">MA_HALO</a>;
<a name="l11034"></a>11034             }
<a name="l11035"></a>11035 
<a name="l11036"></a>11036             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; (<a class="code" href="../../de/db2/DNA__material__types_8h.html#a582c0fe9d451f1c0ede8929648f9dd52">MA_ZTRANSP</a>|<a class="code" href="../../de/db2/DNA__material__types_8h.html#a2f301bfe492802b8461b969fc72b3652">MA_RAYTRANSP</a>)) {
<a name="l11037"></a>11037                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> |= <a class="code" href="../../de/db2/DNA__material__types_8h.html#ab93c6e013760ce505229d6c6686b1478">MA_TRANSP</a>;
<a name="l11038"></a>11038             }
<a name="l11039"></a>11039             <span class="keywordflow">else</span> {
<a name="l11040"></a>11040                 <span class="comment">/* ma-&gt;mode |= MA_ZTRANSP; */</span> <span class="comment">/* leave ztransp as is even if its not used [#28113] */</span>
<a name="l11041"></a>11041                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp;= ~<a class="code" href="../../de/db2/DNA__material__types_8h.html#ab93c6e013760ce505229d6c6686b1478">MA_TRANSP</a>;
<a name="l11042"></a>11042             }
<a name="l11043"></a>11043 
<a name="l11044"></a>11044             <span class="comment">/* set new bump for unused slots */</span>
<a name="l11045"></a>11045             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l11046"></a>11046                 <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]) {
<a name="l11047"></a>11047                     tex= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>;
<a name="l11048"></a>11048                     <span class="keywordflow">if</span> (!tex) {
<a name="l11049"></a>11049                         ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab51470b87b40b19a8ca3781d30b70f12">texflag</a> |= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a78d33d68b2f0fc1c737b133b85e0ab71">MTEX_3TAP_BUMP</a>;
<a name="l11050"></a>11050                         ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab51470b87b40b19a8ca3781d30b70f12">texflag</a> |= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a32deda6621ccfb3490fd2f7d7924566a">MTEX_BUMP_OBJECTSPACE</a>;
<a name="l11051"></a>11051                     }
<a name="l11052"></a>11052                     <span class="keywordflow">else</span> {
<a name="l11053"></a>11053                         tex= (<a class="code" href="../../df/d2d/structTex.html">Tex</a>*)<a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, tex);
<a name="l11054"></a>11054                         <span class="keywordflow">if</span> (tex &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == 0) { <span class="comment">/* invalid type */</span>
<a name="l11055"></a>11055                             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab51470b87b40b19a8ca3781d30b70f12">texflag</a> |= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a78d33d68b2f0fc1c737b133b85e0ab71">MTEX_3TAP_BUMP</a>;
<a name="l11056"></a>11056                             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#ab51470b87b40b19a8ca3781d30b70f12">texflag</a> |= <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a32deda6621ccfb3490fd2f7d7924566a">MTEX_BUMP_OBJECTSPACE</a>;
<a name="l11057"></a>11057                         }
<a name="l11058"></a>11058                     }
<a name="l11059"></a>11059                 }
<a name="l11060"></a>11060             }
<a name="l11061"></a>11061             
<a name="l11062"></a>11062             <span class="comment">/* volume rendering settings */</span>
<a name="l11063"></a>11063             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a98b5b7c925b13d8f1439b4d30e7c7698">stepsize</a> &lt; 0.0001f) {
<a name="l11064"></a>11064                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#af8e1903e47e2379a39a8fdcf5eb68182">density</a> = 1.0f;
<a name="l11065"></a>11065                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a68432dca33de524f132d6b8243a1f39a">emission</a> = 0.0f;
<a name="l11066"></a>11066                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a9c78af11a10b6261ca4803ddeb8b91d2">scattering</a> = 1.0f;
<a name="l11067"></a>11067                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a47e63af793faca1e9dbbc1c979bf4146">emission_col</a>[0] = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a47e63af793faca1e9dbbc1c979bf4146">emission_col</a>[1] = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a47e63af793faca1e9dbbc1c979bf4146">emission_col</a>[2] = 1.0f;
<a name="l11068"></a>11068                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a59bcd9bd36a42d2996b5ca285b96241b">density_scale</a> = 1.0f;
<a name="l11069"></a>11069                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a0bbbcd4074e66b84f0040160be9438d9">depth_cutoff</a> = 0.01f;
<a name="l11070"></a>11070                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#aecb1400b13076a4a24fa1776f7a89d8b">stepsize_type</a> = <a class="code" href="../../de/db2/DNA__material__types_8h.html#a5b20c1a083b3b931acb2d762aefaf3e5">MA_VOL_STEP_RANDOMIZED</a>;
<a name="l11071"></a>11071                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a98b5b7c925b13d8f1439b4d30e7c7698">stepsize</a> = 0.2f;
<a name="l11072"></a>11072                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a3679735c1c227c148e73fc3f142c4860">shade_type</a> = <a class="code" href="../../de/db2/DNA__material__types_8h.html#a36f2a22a5d7cc4e012fe3edf790c114b">MA_VOL_SHADE_SHADED</a>;
<a name="l11073"></a>11073                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a1a564cb47c8f9495decc040c354b041a">shadeflag</a> |= <a class="code" href="../../de/db2/DNA__material__types_8h.html#af464d0b39985086bfc41bd0c150e38dc">MA_VOL_PRECACHESHADING</a>;
<a name="l11074"></a>11074                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a2a43eaf876b8067030a9dc7b5fcb27ed">precache_resolution</a> = 50;
<a name="l11075"></a>11075             }
<a name="l11076"></a>11076         }
<a name="l11077"></a>11077 
<a name="l11078"></a>11078         <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11079"></a>11079             ts= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l11080"></a>11080             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a061a6cacabb6dda02f9bc27be4df8628">normalsize</a> == 0.0f || !ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a62dc1f21975c05d9cd31510257d31fe8">uv_selectmode</a> || ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a6af6c729861d662aef1aac6913832c74">vgroup_weight</a> == 0.0f) {
<a name="l11081"></a>11081                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a061a6cacabb6dda02f9bc27be4df8628">normalsize</a>= 0.1f;
<a name="l11082"></a>11082                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>;
<a name="l11083"></a>11083                 
<a name="l11084"></a>11084                 <span class="comment">/* autokeying - setting should be taken from the user-prefs</span>
<a name="l11085"></a>11085 <span class="comment">                 * but the userprefs version may not have correct flags set </span>
<a name="l11086"></a>11086 <span class="comment">                 * (i.e. will result in blank box when enabled)</span>
<a name="l11087"></a>11087 <span class="comment">                 */</span>
<a name="l11088"></a>11088                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a4b150607e8aac0ff197e193676722a8b">autokey_mode</a>= <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.autokey_mode;
<a name="l11089"></a>11089                 <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a4b150607e8aac0ff197e193676722a8b">autokey_mode</a> == 0) 
<a name="l11090"></a>11090                     ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a4b150607e8aac0ff197e193676722a8b">autokey_mode</a>= 2; <span class="comment">/* &#39;add/replace&#39; but not on */</span>
<a name="l11091"></a>11091                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a62dc1f21975c05d9cd31510257d31fe8">uv_selectmode</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a9cb5698cc28e547454fc69e311451309">UV_SELECT_VERTEX</a>;
<a name="l11092"></a>11092                 ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a6af6c729861d662aef1aac6913832c74">vgroup_weight</a>= 1.0f;
<a name="l11093"></a>11093             }
<a name="l11094"></a>11094 
<a name="l11095"></a>11095             <span class="comment">/* Game Settings */</span>
<a name="l11096"></a>11096             <span class="comment">//Dome</span>
<a name="l11097"></a>11097             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a73bc19da37560a524ede1435ab9f3a64">angle</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domeangle;
<a name="l11098"></a>11098             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a9f8ab404d203646e515e256f9aaae20a">mode</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domemode;
<a name="l11099"></a>11099             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#acd7cb7ca7c8b775320f4c2736afefc67">res</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domeres;
<a name="l11100"></a>11100             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a0580190e61baa3d56f1cb4b57a68b032">resbuf</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.domeresbuf;
<a name="l11101"></a>11101             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a0ffd41b1ff60a6db279a7adf0b4d6bc3">tilt</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.dometilt;
<a name="l11102"></a>11102             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a66ee375e57bb5216b7317965976aaadf">warptext</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.dometext;
<a name="l11103"></a>11103 
<a name="l11104"></a>11104             <span class="comment">//Stand Alone</span>
<a name="l11105"></a>11105             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#abba647d62e5f0390d051e9500da3cd46">playerflag</a> |= (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.fullscreen?<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3df4d0e78bbd0f753ec6870faa9af900">GAME_PLAYER_FULLSCREEN</a>:0);
<a name="l11106"></a>11106             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a07a78e5e4c4adfa40a084aecb4967273">xplay</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.xplay;
<a name="l11107"></a>11107             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a8fbc9644a24b8648a46241c5e611c619">yplay</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.yplay;
<a name="l11108"></a>11108             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a2adc22c3619215553bedf4dff46c099c">freqplay</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.freqplay;
<a name="l11109"></a>11109             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#afba6a54004f586435c5ced4fb246c080">depth</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.depth;
<a name="l11110"></a>11110             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a00052180a0454073b6089ebac2e301a5">attrib</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.attrib;
<a name="l11111"></a>11111 
<a name="l11112"></a>11112             <span class="comment">//Stereo</span>
<a name="l11113"></a>11113             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.stereomode;
<a name="l11114"></a>11114             <span class="comment">/* reassigning stereomode NO_STEREO and DOME to a separeted flag*/</span>
<a name="l11115"></a>11115             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a> == 1) { <span class="comment">//1 = STEREO_NOSTEREO</span>
<a name="l11116"></a>11116                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ac2cf122f92bac27e00590265209d6e58">stereoflag</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a31f7ce778f992e5ea7d00801758564df">STEREO_NOSTEREO</a>;
<a name="l11117"></a>11117                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad7e901b34a0bc8b490de89009e690181">STEREO_ANAGLYPH</a>;
<a name="l11118"></a>11118             }
<a name="l11119"></a>11119             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a> == 8) { <span class="comment">//8 = STEREO_DOME</span>
<a name="l11120"></a>11120                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ac2cf122f92bac27e00590265209d6e58">stereoflag</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a05deaaea1e95267145eb91590f3e26d5">STEREO_DOME</a>;
<a name="l11121"></a>11121                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#af870360e52f5fc934a6bcb6cdebdc229">stereomode</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad7e901b34a0bc8b490de89009e690181">STEREO_ANAGLYPH</a>;
<a name="l11122"></a>11122             }
<a name="l11123"></a>11123             <span class="keywordflow">else</span>
<a name="l11124"></a>11124                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ac2cf122f92bac27e00590265209d6e58">stereoflag</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a04acbf84fc1ebc7753e9e70d7e20574b">STEREO_ENABLED</a>;
<a name="l11125"></a>11125 
<a name="l11126"></a>11126             <span class="comment">//Framing</span>
<a name="l11127"></a>11127             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a455f9432e63ad072096755fd65b00bb0">framing</a> = sce-&gt;framing;
<a name="l11128"></a>11128             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a07a78e5e4c4adfa40a084aecb4967273">xplay</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.xplay;
<a name="l11129"></a>11129             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a8fbc9644a24b8648a46241c5e611c619">yplay</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.yplay;
<a name="l11130"></a>11130             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a2adc22c3619215553bedf4dff46c099c">freqplay</a>= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.freqplay;
<a name="l11131"></a>11131             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#afba6a54004f586435c5ced4fb246c080">depth</a>= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.depth;
<a name="l11132"></a>11132 
<a name="l11133"></a>11133             <span class="comment">//Physic (previously stored in world)</span>
<a name="l11134"></a>11134             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a8325142eaa7981729c64e6132dccf4a9">gravity</a> =9.8f;
<a name="l11135"></a>11135             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ae830149c6f77170b21f7a12372722b62">physicsEngine</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a0bc314c665abe5322ee096d610eca563">WOPHY_BULLET</a>;<span class="comment">// Bullet by default</span>
<a name="l11136"></a>11136             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#abb0b4ef8392647aaeab643b9e4164673">mode</a> = <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a70627b3eb11e0243d1b14fe206bef808">WO_DBVT_CULLING</a>; <span class="comment">// DBVT culling by default</span>
<a name="l11137"></a>11137             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ac819ad31ba0039ce7494c9aacdd05fc7">occlusionRes</a> = 128;
<a name="l11138"></a>11138             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ae1277244e4b1793eba178169cdd1bdf3">ticrate</a> = 60;
<a name="l11139"></a>11139             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ad39c8d791df4a2e4ad27767c34ecef9f">maxlogicstep</a> = 5;
<a name="l11140"></a>11140             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a68cf2f350be387f179d3c408eb84f25d">physubstep</a> = 1;
<a name="l11141"></a>11141             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#aa715280c28dfe18cf8f9c7a19ffe230e">maxphystep</a> = 5;
<a name="l11142"></a>11142         }
<a name="l11143"></a>11143     }
<a name="l11144"></a>11144 
<a name="l11145"></a>11145     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l11146"></a>11146         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l11147"></a>11147         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11148"></a>11148 
<a name="l11149"></a>11149         <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11150"></a>11150             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a5f0de22a4e06811511a67e8c56b0242a">G_FILE_ENABLE_ALL_FRAMES</a>)
<a name="l11151"></a>11151                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af6dc5625a0e0f1c867e0827ee663b4f1">GAME_ENABLE_ALL_FRAMES</a>;
<a name="l11152"></a>11152             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a5465fcc4edf699dc015a593c24820c07">G_FILE_SHOW_DEBUG_PROPS</a>)
<a name="l11153"></a>11153                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad4c210879f82b2b996674d1973f83d34">GAME_SHOW_DEBUG_PROPS</a>;
<a name="l11154"></a>11154             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#ae7e61dee567b1ccc09ad26c4a5f31741">G_FILE_SHOW_FRAMERATE</a>)
<a name="l11155"></a>11155                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa461ea7bee6d72cd13f76bc892599b7b">GAME_SHOW_FRAMERATE</a>;
<a name="l11156"></a>11156             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a992d29d93363cabf1c7eaf7858fa82a2">G_FILE_SHOW_PHYSICS</a>)
<a name="l11157"></a>11157                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a61cb97b821c5071ac393fe7e059e61c5">GAME_SHOW_PHYSICS</a>;
<a name="l11158"></a>11158             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a15b70b42799b0597e1da6352dc546c94">G_FILE_GLSL_NO_SHADOWS</a>)
<a name="l11159"></a>11159                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae295a418b58d9df5376ecdff6c6e5610">GAME_GLSL_NO_SHADOWS</a>;
<a name="l11160"></a>11160             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#ac9bc675a3902522ba039a10ffbe99475">G_FILE_GLSL_NO_SHADERS</a>)
<a name="l11161"></a>11161                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5797d3291802ed14e928d5542b2f5d98">GAME_GLSL_NO_SHADERS</a>;
<a name="l11162"></a>11162             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#abfa91878c3878f33f4544ca7446ca31b">G_FILE_GLSL_NO_RAMPS</a>)
<a name="l11163"></a>11163                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a204d6fab2cc2d3eb7ae124c53ea44a59">GAME_GLSL_NO_RAMPS</a>;
<a name="l11164"></a>11164             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a12a1368b1f3677e031b51548a04d5ef5">G_FILE_GLSL_NO_NODES</a>)
<a name="l11165"></a>11165                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a90bf805f6b7c96cc218581bfbe717672">GAME_GLSL_NO_NODES</a>;
<a name="l11166"></a>11166             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#ad396d3dd62110bf51998bfcfdd18d1e2">G_FILE_GLSL_NO_EXTRA_TEX</a>)
<a name="l11167"></a>11167                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1c8c7a6a95691eff15a8cdd8957a48b7">GAME_GLSL_NO_EXTRA_TEX</a>;
<a name="l11168"></a>11168             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a8f56648fe013052d7365d06c2f7430ed">G_FILE_IGNORE_DEPRECATION_WARNINGS</a>)
<a name="l11169"></a>11169                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a31c6e9e052e5648cdfe18cb8c1e32add">GAME_IGNORE_DEPRECATION_WARNINGS</a>;
<a name="l11170"></a>11170 
<a name="l11171"></a>11171             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#ad2a2aa6ea7edf2c70957fb34664ca669">G_FILE_GAME_MAT_GLSL</a>)
<a name="l11172"></a>11172                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6cede4314df04c85946a10fbd7e109f0">matmode</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a488f8a5dafd4bf3954c021a5a9ffecc6">GAME_MAT_GLSL</a>;
<a name="l11173"></a>11173             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc4fbf9d012fa8cafd4871aa3cff166">fileflags</a> &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7c7c9faa44a1fab0d0c5b2489b35e791">G_FILE_GAME_MAT</a>)
<a name="l11174"></a>11174                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6cede4314df04c85946a10fbd7e109f0">matmode</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a02c081d2634555f92bb39872cf6ef8d2">GAME_MAT_MULTITEX</a>;
<a name="l11175"></a>11175             <span class="keywordflow">else</span>
<a name="l11176"></a>11176                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6cede4314df04c85946a10fbd7e109f0">matmode</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac0494c33e52af8307259b23830a6d918">GAME_MAT_TEXFACE</a>;
<a name="l11177"></a>11177 
<a name="l11178"></a>11178             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ab5fe3ddcaef72618f1ba7a06fce36cde">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a2a1783538db83d7451d84584108b10dc">GAME_DISPLAY_LISTS</a>;
<a name="l11179"></a>11179         }
<a name="l11180"></a>11180         
<a name="l11181"></a>11181         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11182"></a>11182             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; 8192) <span class="comment">// OB_POSEMODE = 8192</span>
<a name="l11183"></a>11183                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550acfed9b4bf4a7e2d3c5ae0b3571e38950">OB_MODE_POSE</a>;
<a name="l11184"></a>11184         }
<a name="l11185"></a>11185     }
<a name="l11186"></a>11186 
<a name="l11187"></a>11187     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4)) {
<a name="l11188"></a>11188         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l11189"></a>11189         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11190"></a>11190         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l11191"></a>11191         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l11192"></a>11192         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo;
<a name="l11193"></a>11193         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l11194"></a>11194         <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l11195"></a>11195         <span class="keywordtype">int</span> do_gravity = 0;
<a name="l11196"></a>11196 
<a name="l11197"></a>11197         <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11198"></a>11198             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a> == 0.0f)
<a name="l11199"></a>11199                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>.<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a>= 1.0f;
<a name="l11200"></a>11200         
<a name="l11201"></a>11201         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11202"></a>11202             <span class="comment">/* fluid-sim stuff */</span>
<a name="l11203"></a>11203             <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fluidmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>);
<a name="l11204"></a>11204             <span class="keywordflow">if</span> (fluidmd) fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#aa0899b45f7749666148b215e0b6123d1">fmd</a> = fluidmd;
<a name="l11205"></a>11205             
<a name="l11206"></a>11206             <span class="comment">/* rotation modes were added, but old objects would now default to being &#39;quaternion based&#39; */</span>
<a name="l11207"></a>11207             ob-&gt;<a class="code" href="../../de/de7/structObject.html#aacca751408fdb1bc64d18670bcc4d73e">rotmode</a>= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a753c8daa50876b6f5773b9ec831dddacaab17f62773635010f913dedee89a8b3d">ROT_MODE_EUL</a>;
<a name="l11208"></a>11208         }
<a name="l11209"></a>11209         
<a name="l11210"></a>11210         <span class="keywordflow">for</span> (ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma=ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11211"></a>11211             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a3e0dbc4fec9bb227cc1b773762f60052">reflection</a> == 0.f) {
<a name="l11212"></a>11212                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a3e0dbc4fec9bb227cc1b773762f60052">reflection</a> = 1.f;
<a name="l11213"></a>11213                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a283e4eb614410dc5961964959288f9ec">transmission_col</a>[0] = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a283e4eb614410dc5961964959288f9ec">transmission_col</a>[1] = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a283e4eb614410dc5961964959288f9ec">transmission_col</a>[2] = 1.0f;
<a name="l11214"></a>11214                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a570c152bc25f58beb1e037c729ac07a4">reflection_col</a>[0] = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a570c152bc25f58beb1e037c729ac07a4">reflection_col</a>[1] = ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a570c152bc25f58beb1e037c729ac07a4">reflection_col</a>[2] = 1.0f;
<a name="l11215"></a>11215             }
<a name="l11216"></a>11216 
<a name="l11217"></a>11217             <a class="code" href="../../d0/d12/readfile_8c.html#afb691777f5db3b1cd49fe058e11d6573">do_version_mtex_factor_2_50</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>);
<a name="l11218"></a>11218         }
<a name="l11219"></a>11219 
<a name="l11220"></a>11220         <span class="keywordflow">for</span> (la = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; la; la=la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11221"></a>11221             <a class="code" href="../../d0/d12/readfile_8c.html#afb691777f5db3b1cd49fe058e11d6573">do_version_mtex_factor_2_50</a>(la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>);
<a name="l11222"></a>11222 
<a name="l11223"></a>11223         <span class="keywordflow">for</span> (wo = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wo; wo=wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11224"></a>11224             <a class="code" href="../../d0/d12/readfile_8c.html#afb691777f5db3b1cd49fe058e11d6573">do_version_mtex_factor_2_50</a>(wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>);
<a name="l11225"></a>11225 
<a name="l11226"></a>11226         <span class="keywordflow">for</span> (tex = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex=tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11227"></a>11227             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>)
<a name="l11228"></a>11228                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>-&gt;<a class="code" href="../../d8/d04/structVoxelData.html#a2db99a31187ad1410387cd420f25bab9">extend</a> == 0)
<a name="l11229"></a>11229                     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>-&gt;<a class="code" href="../../d8/d04/structVoxelData.html#a2db99a31187ad1410387cd420f25bab9">extend</a> = <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#ae216dc5ade0b0babd139ea7ef16f6e19">TEX_CLIP</a>;
<a name="l11230"></a>11230         
<a name="l11231"></a>11231         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11232"></a>11232         {
<a name="l11233"></a>11233             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a175df92e16ce4a5e4e66afda7a1f02e4">main</a> == 0.0f)
<a name="l11234"></a>11234                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a175df92e16ce4a5e4e66afda7a1f02e4">main</a> = 1.0f;
<a name="l11235"></a>11235 
<a name="l11236"></a>11236             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a0d9a6f46aca2f92cf18b024ad8b180d6">audio_mixrate</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a5721059082fb428686ccc3cd9ceaf2e1">mixrate</a>;
<a name="l11237"></a>11237             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#abf39dfb6d640659f1bf088427a8f7657">audio_volume</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a175df92e16ce4a5e4e66afda7a1f02e4">main</a>;
<a name="l11238"></a>11238             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a7a974ec87d9bd47263b8d5fc8f06eea9">distance_model</a> = 2;
<a name="l11239"></a>11239             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a6dd724c9a669d3564bbe354c091eb82b">doppler_factor</a> = 1.0f;
<a name="l11240"></a>11240             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#a9ea9a0d7307a8c05e8428a8e5656240f">speed_of_sound</a> = 343.3f;
<a name="l11241"></a>11241         }
<a name="l11242"></a>11242 
<a name="l11243"></a>11243         <span class="comment">/* Add default gravity to scenes */</span>
<a name="l11244"></a>11244         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11245"></a>11245             <span class="keywordflow">if</span> ((sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a2af54e63511dbe75e7b3c736288ed4d4">physics_settings</a>.<a class="code" href="../../d6/d40/structPhysicsSettings.html#ae4c1524b30f9e72a87543f428be1549c">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a508bb80abc11d94db2661ef7f6d0cc00">PHYS_GLOBAL_GRAVITY</a>) == 0 &amp;&amp;
<a name="l11246"></a>11246                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a2af54e63511dbe75e7b3c736288ed4d4">physics_settings</a>.<a class="code" href="../../d6/d40/structPhysicsSettings.html#a1ad145e35a189d541a16b143c20f3fd6">gravity</a>) == 0.0f)
<a name="l11247"></a>11247             {
<a name="l11248"></a>11248                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a2af54e63511dbe75e7b3c736288ed4d4">physics_settings</a>.<a class="code" href="../../d6/d40/structPhysicsSettings.html#a1ad145e35a189d541a16b143c20f3fd6">gravity</a>[0] = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a2af54e63511dbe75e7b3c736288ed4d4">physics_settings</a>.<a class="code" href="../../d6/d40/structPhysicsSettings.html#a1ad145e35a189d541a16b143c20f3fd6">gravity</a>[1] = 0.0f;
<a name="l11249"></a>11249                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a2af54e63511dbe75e7b3c736288ed4d4">physics_settings</a>.<a class="code" href="../../d6/d40/structPhysicsSettings.html#a1ad145e35a189d541a16b143c20f3fd6">gravity</a>[2] = -9.81f;
<a name="l11250"></a>11250                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a2af54e63511dbe75e7b3c736288ed4d4">physics_settings</a>.<a class="code" href="../../d6/d40/structPhysicsSettings.html#ae4c1524b30f9e72a87543f428be1549c">flag</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a508bb80abc11d94db2661ef7f6d0cc00">PHYS_GLOBAL_GRAVITY</a>;
<a name="l11251"></a>11251                 do_gravity = 1;
<a name="l11252"></a>11252             }
<a name="l11253"></a>11253         }
<a name="l11254"></a>11254 
<a name="l11255"></a>11255         <span class="comment">/* Assign proper global gravity weights for dynamics (only z-coordinate is taken into account) */</span>
<a name="l11256"></a>11256         <span class="keywordflow">if</span> (do_gravity) <span class="keywordflow">for</span> (part= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11257"></a>11257             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#af1e527b00a665e3ac926d0aa7c54b9d0">global_gravity</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8bdb0eac45f50a0e7b2408335b9a49e9">acc</a>[2]/-9.81f;
<a name="l11258"></a>11258 
<a name="l11259"></a>11259         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11260"></a>11260             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l11261"></a>11261 
<a name="l11262"></a>11262             <span class="keywordflow">if</span> (do_gravity) {
<a name="l11263"></a>11263                 <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l11264"></a>11264                     <a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *clmd = (<a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5fc484f055c7aba4c89beda85b5ba321">eModifierType_Cloth</a>);
<a name="l11265"></a>11265                     <span class="keywordflow">if</span> (clmd)
<a name="l11266"></a>11266                         clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#af1e527b00a665e3ac926d0aa7c54b9d0">global_gravity</a> = clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#ad464575184b0c084ef696c150ce39e93">gravity</a>[2]/-9.81f;
<a name="l11267"></a>11267                 }
<a name="l11268"></a>11268 
<a name="l11269"></a>11269                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>)
<a name="l11270"></a>11270                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a>-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#af1e527b00a665e3ac926d0aa7c54b9d0">global_gravity</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#aa6e2e4f44e92c16170dedf74885fbf65">grav</a>/9.81f;
<a name="l11271"></a>11271             }
<a name="l11272"></a>11272 
<a name="l11273"></a>11273             <span class="comment">/* Normal wind shape is plane */</span>
<a name="l11274"></a>11274             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>) {
<a name="l11275"></a>11275                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba22fb65898d213ba25a4a89bbe5c50fc0">PFIELD_WIND</a>)
<a name="l11276"></a>11276                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> = <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a5b5d514f756439c8010a56c2f821712f">PFIELD_SHAPE_PLANE</a>;
<a name="l11277"></a>11277                 
<a name="l11278"></a>11278                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3fb237249c4efc9bb51d49224a78de6c">PFIELD_PLANAR</a>)
<a name="l11279"></a>11279                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> = <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a5b5d514f756439c8010a56c2f821712f">PFIELD_SHAPE_PLANE</a>;
<a name="l11280"></a>11280                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a55978f54a82bde929cf9bcf3879ea18f">PFIELD_SURFACE</a>)
<a name="l11281"></a>11281                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> = <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a0bdeb46403257fa557dc3abeaccb2b6d">PFIELD_SHAPE_SURFACE</a>;
<a name="l11282"></a>11282 
<a name="l11283"></a>11283                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> |= <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a7d6e9762b62db2b3edfbe874453d6204">PFIELD_DO_LOCATION</a>;
<a name="l11284"></a>11284             }
<a name="l11285"></a>11285         }
<a name="l11286"></a>11286     }
<a name="l11287"></a>11287 
<a name="l11288"></a>11288     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 6)) {
<a name="l11289"></a>11289         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11290"></a>11290         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l11291"></a>11291         
<a name="l11292"></a>11292         <span class="comment">/* New variables for axis-angle rotations and/or quaternion rotations were added, and need proper initialization */</span>
<a name="l11293"></a>11293         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11294"></a>11294             <span class="comment">/* new variables for all objects */</span>
<a name="l11295"></a>11295             ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa6c96b622574614389429499cf9c158a">quat</a>[0]= 1.0f;
<a name="l11296"></a>11296             ob-&gt;<a class="code" href="../../de/de7/structObject.html#ab786c32edfb27c8976e5e8e84ba7aaa0">rotAxis</a>[1]= 1.0f;
<a name="l11297"></a>11297             
<a name="l11298"></a>11298             <span class="comment">/* bones */</span>
<a name="l11299"></a>11299             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l11300"></a>11300                 <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l11301"></a>11301                 
<a name="l11302"></a>11302                 <span class="keywordflow">for</span> (pchan= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l11303"></a>11303                     <span class="comment">/* just need to initalise rotation axis properly... */</span>
<a name="l11304"></a>11304                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a333f3e39794d13ca0105efed79e95e62">rotAxis</a>[1]= 1.0f;
<a name="l11305"></a>11305                 }
<a name="l11306"></a>11306             }
<a name="l11307"></a>11307         }
<a name="l11308"></a>11308 
<a name="l11309"></a>11309         <span class="keywordflow">for</span> (la = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; la; la=la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11310"></a>11310             la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ac8e0d1df3ac8ed1526436cbaa7d000ed">compressthresh</a>= 0.05f;
<a name="l11311"></a>11311     }
<a name="l11312"></a>11312 
<a name="l11313"></a>11313     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 7)) {
<a name="l11314"></a>11314         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l11315"></a>11315         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l11316"></a>11316         <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt;
<a name="l11317"></a>11317         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l11318"></a>11318         <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l11319"></a>11319         <span class="keywordtype">float</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l11320"></a>11320         <span class="keywordtype">int</span> a, tot;
<a name="l11321"></a>11321 
<a name="l11322"></a>11322         <span class="comment">/* shape keys are no longer applied to the mesh itself, but rather</span>
<a name="l11323"></a>11323 <span class="comment">         * to the derivedmesh/displist, so here we ensure that the basis</span>
<a name="l11324"></a>11324 <span class="comment">         * shape key is always set in the mesh coordinates. */</span>
<a name="l11325"></a>11325 
<a name="l11326"></a>11326         <span class="keywordflow">for</span> (me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11327"></a>11327             <span class="keywordflow">if</span> ((key = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>)) &amp;&amp; key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>) {
<a name="l11328"></a>11328                 data= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l11329"></a>11329                 tot= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a48866fbfcc064f4777e2d2841ce42fe4">totelem</a>);
<a name="l11330"></a>11330 
<a name="l11331"></a>11331                 <span class="keywordflow">for</span> (a=0; a&lt;tot; a++, data+=3)
<a name="l11332"></a>11332                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>[a].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>, data);
<a name="l11333"></a>11333             }
<a name="l11334"></a>11334         }
<a name="l11335"></a>11335 
<a name="l11336"></a>11336         <span class="keywordflow">for</span> (lt= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acc71d9ddb63ba1e24a044109bb6bab45">latt</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lt; lt= lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11337"></a>11337             <span class="keywordflow">if</span> ((key = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a17c6975adcc7144ed734252d6038b7d5">key</a>)) &amp;&amp; key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>) {
<a name="l11338"></a>11338                 data= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l11339"></a>11339                 tot= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a48866fbfcc064f4777e2d2841ce42fe4">totelem</a>);
<a name="l11340"></a>11340 
<a name="l11341"></a>11341                 <span class="keywordflow">for</span> (a=0; a&lt;tot; a++, data+=3)
<a name="l11342"></a>11342                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>[a].<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, data);
<a name="l11343"></a>11343             }
<a name="l11344"></a>11344         }
<a name="l11345"></a>11345 
<a name="l11346"></a>11346         <span class="keywordflow">for</span> (cu= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cu; cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11347"></a>11347             <span class="keywordflow">if</span> ((key = <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>)) &amp;&amp; key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>) {
<a name="l11348"></a>11348                 data= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l11349"></a>11349 
<a name="l11350"></a>11350                 <span class="keywordflow">for</span> (nu=cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l11351"></a>11351                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l11352"></a>11352                         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l11353"></a>11353 
<a name="l11354"></a>11354                         <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bezt++) {
<a name="l11355"></a>11355                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], data); data+=3;
<a name="l11356"></a>11356                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], data); data+=3;
<a name="l11357"></a>11357                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], data); data+=3;
<a name="l11358"></a>11358                             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>; data++;
<a name="l11359"></a>11359                         }
<a name="l11360"></a>11360                     }
<a name="l11361"></a>11361                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l11362"></a>11362                         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l11363"></a>11363 
<a name="l11364"></a>11364                         <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++, bp++) {
<a name="l11365"></a>11365                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, data); data+=3;
<a name="l11366"></a>11366                             bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>= *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>; data++;
<a name="l11367"></a>11367                         }
<a name="l11368"></a>11368                     }
<a name="l11369"></a>11369                 }
<a name="l11370"></a>11370             }
<a name="l11371"></a>11371         }
<a name="l11372"></a>11372     }
<a name="l11373"></a>11373 
<a name="l11374"></a>11374     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 8))
<a name="l11375"></a>11375     {
<a name="l11376"></a>11376         {
<a name="l11377"></a>11377             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11378"></a>11378             <span class="keywordflow">while</span> (sce) {
<a name="l11379"></a>11379                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a252e009f6db4a41b7efd7eb211de2963">frame_step</a>==0)
<a name="l11380"></a>11380                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a252e009f6db4a41b7efd7eb211de2963">frame_step</a>= 1;
<a name="l11381"></a>11381                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ae4796e02b0a0ef82ac519c197c7b864d">mblur_samples</a>==0)
<a name="l11382"></a>11382                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ae4796e02b0a0ef82ac519c197c7b864d">mblur_samples</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a9f9743267b1d3ba032f5e0d1a81a4073">osa</a>;
<a name="l11383"></a>11383                 
<a name="l11384"></a>11384                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a> &amp;&amp; sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l11385"></a>11385                     <a class="code" href="../../d0/d12/readfile_8c.html#ad02511ad9f2b1e83294f53838f8ed664">do_versions_seq_unique_name_all_strips</a>(
<a name="l11386"></a>11386                         sce, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>-&gt;<a class="code" href="../../d5/de9/structEditing.html#a0395eb82d0ea9133b88e856ac3004a21">seqbase</a>);
<a name="l11387"></a>11387                 }
<a name="l11388"></a>11388             
<a name="l11389"></a>11389                 sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11390"></a>11390             }
<a name="l11391"></a>11391         }
<a name="l11392"></a>11392         {
<a name="l11393"></a>11393             <span class="comment">/* ensure all nodes have unique names */</span>
<a name="l11394"></a>11394             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11395"></a>11395             <span class="keywordflow">while</span> (ntree) {
<a name="l11396"></a>11396                 <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11397"></a>11397                 
<a name="l11398"></a>11398                 <span class="keywordflow">while</span> (node) {
<a name="l11399"></a>11399                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a08e88749decf79e52c9536bfc45ea407">nodeUniqueName</a>(ntree, node);
<a name="l11400"></a>11400                     node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l11401"></a>11401                 }
<a name="l11402"></a>11402                 
<a name="l11403"></a>11403                 ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11404"></a>11404             }
<a name="l11405"></a>11405         }
<a name="l11406"></a>11406         {
<a name="l11407"></a>11407             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11408"></a>11408             <span class="keywordflow">while</span> (ob) {
<a name="l11409"></a>11409                 <span class="comment">/* shaded mode disabled for now */</span>
<a name="l11410"></a>11410                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c65a551de1e814cda97b11b53904c8e">OB_MATERIAL</a>) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a12c14080c880d52c6a50c271e8bb87f8">OB_TEXTURE</a>;
<a name="l11411"></a>11411                 ob=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11412"></a>11412             }
<a name="l11413"></a>11413         }
<a name="l11414"></a>11414         
<a name="l11415"></a>11415         {
<a name="l11416"></a>11416             <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l11417"></a>11417             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11418"></a>11418             <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11419"></a>11419             
<a name="l11420"></a>11420             <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11421"></a>11421                 <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11422"></a>11422                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11423"></a>11423                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l11424"></a>11424                             <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l11425"></a>11425                             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c65a551de1e814cda97b11b53904c8e">OB_MATERIAL</a>) v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>;
<a name="l11426"></a>11426                         }
<a name="l11427"></a>11427                     }
<a name="l11428"></a>11428                 }
<a name="l11429"></a>11429             }
<a name="l11430"></a>11430         }
<a name="l11431"></a>11431         
<a name="l11432"></a>11432         <span class="comment">/* only convert old 2.50 files with color management */</span>
<a name="l11433"></a>11433         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250) {
<a name="l11434"></a>11434             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11435"></a>11435             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11436"></a>11436             <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11437"></a>11437             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11438"></a>11438             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../d1/ded/namespacePixelFormat.html#a370df43b7b80c861bfeee383c97351fb">convert</a>=0;
<a name="l11439"></a>11439             
<a name="l11440"></a>11440             <span class="comment">/* convert to new color management system:</span>
<a name="l11441"></a>11441 <span class="comment">             * while previously colors were stored as srgb,</span>
<a name="l11442"></a>11442 <span class="comment">             * now they are stored as linear internally,</span>
<a name="l11443"></a>11443 <span class="comment">             * with screen gamma correction in certain places in the UI. */</span>
<a name="l11444"></a>11444 
<a name="l11445"></a>11445             <span class="comment">/* don&#39;t know what scene is active, so we&#39;ll convert if any scene has it enabled... */</span>
<a name="l11446"></a>11446             <span class="keywordflow">while</span> (sce) {
<a name="l11447"></a>11447                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aa9a0521ac4e22707d09ddeac4bf104b2">color_mgt_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aea9753cc8aec8bc51c69f789cd188848">R_COLOR_MANAGEMENT</a>)
<a name="l11448"></a>11448                     convert=1;
<a name="l11449"></a>11449                 sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11450"></a>11450             }
<a name="l11451"></a>11451             
<a name="l11452"></a>11452             <span class="keywordflow">if</span> (convert) {
<a name="l11453"></a>11453                 <span class="keywordflow">while</span> (ma) {
<a name="l11454"></a>11454                     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a64069c881aa121bf9faa495da7768b5f">ramp_col</a>) {
<a name="l11455"></a>11455                         <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *band = (<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *)ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a64069c881aa121bf9faa495da7768b5f">ramp_col</a>;
<a name="l11456"></a>11456                         for (i=0; i&lt;band-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a9a5aeaf310abd70ad22e33ecc7040c3c">tot</a>; i++) {
<a name="l11457"></a>11457                             <a class="code" href="../../d6/de7/structCBData.html">CBData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = band-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a7d2f29fb0327fd1db93ad7f6e4760a28">data</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l11458"></a>11458                             <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;data-&gt;<a class="code" href="../../d6/de7/structCBData.html#aa1776eddfa93436617bb76d618dd4b43">r</a>, &amp;data-&gt;<a class="code" href="../../d6/de7/structCBData.html#aa1776eddfa93436617bb76d618dd4b43">r</a>);
<a name="l11459"></a>11459                         }
<a name="l11460"></a>11460                     }
<a name="l11461"></a>11461                     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a60395437e9ccda837921ab3bfa8e009c">ramp_spec</a>) {
<a name="l11462"></a>11462                         <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *band = (<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *)ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a60395437e9ccda837921ab3bfa8e009c">ramp_spec</a>;
<a name="l11463"></a>11463                         for (i=0; i&lt;band-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a9a5aeaf310abd70ad22e33ecc7040c3c">tot</a>; i++) {
<a name="l11464"></a>11464                             <a class="code" href="../../d6/de7/structCBData.html">CBData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = band-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a7d2f29fb0327fd1db93ad7f6e4760a28">data</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l11465"></a>11465                             <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;data-&gt;<a class="code" href="../../d6/de7/structCBData.html#aa1776eddfa93436617bb76d618dd4b43">r</a>, &amp;data-&gt;<a class="code" href="../../d6/de7/structCBData.html#aa1776eddfa93436617bb76d618dd4b43">r</a>);
<a name="l11466"></a>11466                         }
<a name="l11467"></a>11467                     }
<a name="l11468"></a>11468                     
<a name="l11469"></a>11469                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9e892cbd7e25b6fd5ee00c383cd9cacf">r</a>, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9e892cbd7e25b6fd5ee00c383cd9cacf">r</a>);
<a name="l11470"></a>11470                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#af595797ad989716e9a27949aa0fc3fcb">specr</a>, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#af595797ad989716e9a27949aa0fc3fcb">specr</a>);
<a name="l11471"></a>11471                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a5f52fd66a8540b2442213722f9715e41">mirr</a>, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a5f52fd66a8540b2442213722f9715e41">mirr</a>);
<a name="l11472"></a>11472                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aa3f32e902f55f86c60b3b9a87c18aad5">sss_col</a>);
<a name="l11473"></a>11473                     ma=ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11474"></a>11474                 }
<a name="l11475"></a>11475                 
<a name="l11476"></a>11476                 <span class="keywordflow">while</span> (tex) {
<a name="l11477"></a>11477                     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8a9db83c0f33abeb5ff2bf434abeac9e">coba</a>) {
<a name="l11478"></a>11478                         <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *band = (<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *)tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8a9db83c0f33abeb5ff2bf434abeac9e">coba</a>;
<a name="l11479"></a>11479                         for (i=0; i&lt;band-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a9a5aeaf310abd70ad22e33ecc7040c3c">tot</a>; i++) {
<a name="l11480"></a>11480                             <a class="code" href="../../d6/de7/structCBData.html">CBData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = band-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a7d2f29fb0327fd1db93ad7f6e4760a28">data</a> + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l11481"></a>11481                             <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;data-&gt;<a class="code" href="../../d6/de7/structCBData.html#aa1776eddfa93436617bb76d618dd4b43">r</a>, &amp;data-&gt;<a class="code" href="../../d6/de7/structCBData.html#aa1776eddfa93436617bb76d618dd4b43">r</a>);
<a name="l11482"></a>11482                         }
<a name="l11483"></a>11483                     }
<a name="l11484"></a>11484                     tex=tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11485"></a>11485                 }
<a name="l11486"></a>11486                 
<a name="l11487"></a>11487                 <span class="keywordflow">while</span> (wo) {
<a name="l11488"></a>11488                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#afe57a3755ed6c82d7e6462e7bc0c0525">ambr</a>, &amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#afe57a3755ed6c82d7e6462e7bc0c0525">ambr</a>);
<a name="l11489"></a>11489                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#af555a01e6a98f5768255cd8be50d0a6a">horr</a>, &amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#af555a01e6a98f5768255cd8be50d0a6a">horr</a>);
<a name="l11490"></a>11490                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a1a32a8dcd1fca2ac08d3df36cd1adcd7">srgb_to_linearrgb_v3_v3</a>(&amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a571f06069d46e1f6946d58ab52d32ac8">zenr</a>, &amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a571f06069d46e1f6946d58ab52d32ac8">zenr</a>);
<a name="l11491"></a>11491                     wo=wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l11492"></a>11492                 }
<a name="l11493"></a>11493             }
<a name="l11494"></a>11494         }
<a name="l11495"></a>11495     }
<a name="l11496"></a>11496     
<a name="l11497"></a>11497     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 9))
<a name="l11498"></a>11498     {
<a name="l11499"></a>11499         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l11500"></a>11500         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l11501"></a>11501         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11502"></a>11502 
<a name="l11503"></a>11503         <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11504"></a>11504             <span class="keywordflow">if</span> (!sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a931875e2d55fef9de65c777431a94f31">particle</a>.<a class="code" href="../../df/db7/structParticleEditSettings.html#a1ec9fc0bf8c9038769de37144f7099da">selectmode</a>)
<a name="l11505"></a>11505                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a931875e2d55fef9de65c777431a94f31">particle</a>.<a class="code" href="../../df/db7/structParticleEditSettings.html#a1ec9fc0bf8c9038769de37144f7099da">selectmode</a>= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a25a19c97747b2f50583d8bf6298cfc68">SCE_SELECT_PATH</a>;
<a name="l11506"></a>11506 
<a name="l11507"></a>11507         <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &gt; 1) {
<a name="l11508"></a>11508             <span class="keywordflow">for</span> (me=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me=me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11509"></a>11509                 <a class="code" href="../../d1/d37/BKE__multires_8h.html#a7db1d869c03bb552253e4a561e7e6db2">multires_load_old_250</a>(me);
<a name="l11510"></a>11510 
<a name="l11511"></a>11511             <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11512"></a>11512                 <a class="code" href="../../dd/dd2/structMultiresModifierData.html">MultiresModifierData</a> *mmd = (<a class="code" href="../../dd/dd2/structMultiresModifierData.html">MultiresModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ae66e8d1df0f230926a6ec95cae4c7a8d">eModifierType_Multires</a>);
<a name="l11513"></a>11513 
<a name="l11514"></a>11514                 <span class="keywordflow">if</span> (mmd) {
<a name="l11515"></a>11515                     mmd-&gt;<a class="code" href="../../dd/dd2/structMultiresModifierData.html#a1471c3c37841cbfe33f8be4783bcf95b">totlvl</a>--;
<a name="l11516"></a>11516                     mmd-&gt;<a class="code" href="../../dd/dd2/structMultiresModifierData.html#a816e0ca5629d18ea4d1caf55cc76e8e5">lvl</a>--;
<a name="l11517"></a>11517                     mmd-&gt;<a class="code" href="../../dd/dd2/structMultiresModifierData.html#a80a926d4fb1ecdf396aa270b0d1724e1">sculptlvl</a>= mmd-&gt;<a class="code" href="../../dd/dd2/structMultiresModifierData.html#a816e0ca5629d18ea4d1caf55cc76e8e5">lvl</a>;
<a name="l11518"></a>11518                     mmd-&gt;<a class="code" href="../../dd/dd2/structMultiresModifierData.html#aca86bb9d2ce9b1ed3a6e98b4c84ebe56">renderlvl</a>= mmd-&gt;<a class="code" href="../../dd/dd2/structMultiresModifierData.html#a816e0ca5629d18ea4d1caf55cc76e8e5">lvl</a>;
<a name="l11519"></a>11519                 }
<a name="l11520"></a>11520             }
<a name="l11521"></a>11521         }
<a name="l11522"></a>11522     }
<a name="l11523"></a>11523 
<a name="l11524"></a>11524     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 10))
<a name="l11525"></a>11525     {
<a name="l11526"></a>11526         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11527"></a>11527 
<a name="l11528"></a>11528         <span class="comment">/* properly initialize hair clothsim data on old files */</span>
<a name="l11529"></a>11529         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11530"></a>11530             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l11531"></a>11531             <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l11532"></a>11532                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5fc484f055c7aba4c89beda85b5ba321">eModifierType_Cloth</a>) {
<a name="l11533"></a>11533                     <a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *clmd = (<a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *)md;
<a name="l11534"></a>11534                     <span class="keywordflow">if</span> (clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#ab7abd2766019b767d111020a616e4087">velocity_smooth</a> &lt; 0.01f)
<a name="l11535"></a>11535                         clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#ab7abd2766019b767d111020a616e4087">velocity_smooth</a> = 0.f;
<a name="l11536"></a>11536                 }
<a name="l11537"></a>11537             }
<a name="l11538"></a>11538         }
<a name="l11539"></a>11539     }
<a name="l11540"></a>11540 
<a name="l11541"></a>11541     <span class="comment">/* fix bad area setup in subversion 10 */</span>
<a name="l11542"></a>11542     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> == 10)
<a name="l11543"></a>11543     {
<a name="l11544"></a>11544         <span class="comment">/* fix for new view type in sequencer */</span>
<a name="l11545"></a>11545         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l11546"></a>11546         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11547"></a>11547         <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11548"></a>11548 
<a name="l11549"></a>11549 
<a name="l11550"></a>11550         <span class="comment">/* remove all preview window in wrong spaces */</span>
<a name="l11551"></a>11551         <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11552"></a>11552             <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11553"></a>11553                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11554"></a>11554                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>!=<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l11555"></a>11555                         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l11556"></a>11556                         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *regionbase;
<a name="l11557"></a>11557 
<a name="l11558"></a>11558                         <span class="keywordflow">if</span> (sl == sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l11559"></a>11559                             regionbase = &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>;
<a name="l11560"></a>11560                         }
<a name="l11561"></a>11561                         <span class="keywordflow">else</span> {
<a name="l11562"></a>11562                             regionbase = &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>;
<a name="l11563"></a>11563                         }
<a name="l11564"></a>11564 
<a name="l11565"></a>11565 
<a name="l11566"></a>11566                         <span class="keywordflow">for</span> ( ar = regionbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l11567"></a>11567                             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a9c229d954ba6692b9ea76f4a444a6ad5">RGN_TYPE_PREVIEW</a>)
<a name="l11568"></a>11568                                 <span class="keywordflow">break</span>;
<a name="l11569"></a>11569                         }
<a name="l11570"></a>11570 
<a name="l11571"></a>11571                         <span class="keywordflow">if</span> (ar &amp;&amp; (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a9c229d954ba6692b9ea76f4a444a6ad5">RGN_TYPE_PREVIEW</a>)) {
<a name="l11572"></a>11572                             <a class="code" href="../../dd/d66/structSpaceType.html">SpaceType</a> *st= <a class="code" href="../../d7/da3/BKE__screen_8h.html#aa38a17435264e8ed7fe5c0518b45e431">BKE_spacetype_from_id</a>(<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>);
<a name="l11573"></a>11573                             <a class="code" href="../../d7/da3/BKE__screen_8h.html#acb926d438975e5a30f778c32ce39dbfe">BKE_area_region_free</a>(st, ar);
<a name="l11574"></a>11574                             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a2bb7ce226f8b42d21eb35100f0bb4580">BLI_freelinkN</a>(regionbase, ar);
<a name="l11575"></a>11575                         }
<a name="l11576"></a>11576                     }
<a name="l11577"></a>11577                 }
<a name="l11578"></a>11578             }
<a name="l11579"></a>11579         }
<a name="l11580"></a>11580     }
<a name="l11581"></a>11581 
<a name="l11582"></a>11582     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 11))
<a name="l11583"></a>11583     {
<a name="l11584"></a>11584         {
<a name="l11585"></a>11585             <span class="comment">/* fix for new view type in sequencer */</span>
<a name="l11586"></a>11586             <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l11587"></a>11587             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11588"></a>11588             <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11589"></a>11589 
<a name="l11590"></a>11590 
<a name="l11591"></a>11591             <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11592"></a>11592                 <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11593"></a>11593                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11594"></a>11594                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l11595"></a>11595                             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l11596"></a>11596                             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar_main;
<a name="l11597"></a>11597                             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *regionbase;
<a name="l11598"></a>11598                             <a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *sseq = (<a class="code" href="../../df/d05/structSpaceSeq.html">SpaceSeq</a> *)sl;
<a name="l11599"></a>11599 
<a name="l11600"></a>11600                             <span class="keywordflow">if</span> (sl == sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l11601"></a>11601                                 regionbase = &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>;
<a name="l11602"></a>11602                             }
<a name="l11603"></a>11603                             <span class="keywordflow">else</span> {
<a name="l11604"></a>11604                                 regionbase = &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>;
<a name="l11605"></a>11605                             }
<a name="l11606"></a>11606 
<a name="l11607"></a>11607                             <span class="keywordflow">if</span> (sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a279bac440748b0c0101a89c84d8ec005">view</a> == 0) sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a279bac440748b0c0101a89c84d8ec005">view</a> = <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a44c6fecd8977fde13fdf2c2cdc45015b">SEQ_VIEW_SEQUENCE</a>;
<a name="l11608"></a>11608                             <span class="keywordflow">if</span> (sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a1690fabe7e2ef701c6a63ed2b2406840">mainb</a> == 0) sseq-&gt;<a class="code" href="../../df/d05/structSpaceSeq.html#a1690fabe7e2ef701c6a63ed2b2406840">mainb</a> = <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ad5b89b5996803f2f045d524b8d5fad70">SEQ_DRAW_IMG_IMBUF</a>;
<a name="l11609"></a>11609 
<a name="l11610"></a>11610                             ar_main = (<a class="code" href="../../da/d23/structARegion.html">ARegion</a>*)regionbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11611"></a>11611                             for (; ar_main; ar_main = ar_main-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l11612"></a>11612                                 <span class="keywordflow">if</span> (ar_main-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>)
<a name="l11613"></a>11613                                     <span class="keywordflow">break</span>;
<a name="l11614"></a>11614                             }
<a name="l11615"></a>11615                             ar= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a>), <span class="stringliteral">&quot;preview area for sequencer&quot;</span>);
<a name="l11616"></a>11616                             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(regionbase, ar_main, ar);
<a name="l11617"></a>11617                             <a class="code" href="../../d0/d12/readfile_8c.html#a2181aed3654255aec35f9ceb3d8f80ee">sequencer_init_preview_region</a>(ar);
<a name="l11618"></a>11618                         }
<a name="l11619"></a>11619                     }
<a name="l11620"></a>11620                 }
<a name="l11621"></a>11621             }
<a name="l11622"></a>11622         }
<a name="l11623"></a>11623     }
<a name="l11624"></a>11624 
<a name="l11625"></a>11625     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 12))
<a name="l11626"></a>11626     {
<a name="l11627"></a>11627         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l11628"></a>11628         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11629"></a>11629         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l11630"></a>11630         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l11631"></a>11631         
<a name="l11632"></a>11632         <span class="comment">/* game engine changes */</span>
<a name="l11633"></a>11633         <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11634"></a>11634             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6753d20785372215b27ee4598a779563">eyeseparation</a> = 0.10f;
<a name="l11635"></a>11635         }
<a name="l11636"></a>11636         
<a name="l11637"></a>11637         <span class="comment">/* anim viz changes */</span>
<a name="l11638"></a>11638         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11639"></a>11639             <span class="comment">/* initialize object defaults */</span>
<a name="l11640"></a>11640             <a class="code" href="../../df/dd0/BKE__anim_8h.html#a5d6fe871f52b3912c34e29f29e6968ff">animviz_settings_init</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#afcef3a6289a8d4b0d84542f25b7ba7e1">avs</a>);
<a name="l11641"></a>11641             
<a name="l11642"></a>11642             <span class="comment">/* if armature, copy settings for pose from armature data </span>
<a name="l11643"></a>11643 <span class="comment">             * performing initialization where appropriate</span>
<a name="l11644"></a>11644 <span class="comment">             */</span>
<a name="l11645"></a>11645             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>) {
<a name="l11646"></a>11646                 <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= <a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l11647"></a>11647                 <span class="keywordflow">if</span> (arm) { <span class="comment">/* XXX - why does this fail in some cases? */</span>
<a name="l11648"></a>11648                     <a class="code" href="../../db/de3/structbAnimVizSettings.html">bAnimVizSettings</a> *avs= &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a66f05f761e3d89a2717137132fff43cc">avs</a>;
<a name="l11649"></a>11649                     
<a name="l11650"></a>11650                     <span class="comment">/* ghosting settings ---------------- */</span>
<a name="l11651"></a>11651                         <span class="comment">/* ranges */</span>
<a name="l11652"></a>11652                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#aad1fe348a228fc4fdfc720681e890884">ghost_bc</a>= avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a574f8b7d27de3041f2573f5909f88d26">ghost_ac</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#af41c561ffde5c453f58dd0dce79c44dc">ghostep</a>;
<a name="l11653"></a>11653                     
<a name="l11654"></a>11654                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae178f9274fdb67d25fc08371cab9049c">ghost_sf</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a73e0a54f71d849c409eee24be7798d9a">ghostsf</a>;
<a name="l11655"></a>11655                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a8cb2c680f1789cdb7ad7f079cd1b7526">ghost_ef</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ae00950f4dac6162a9150488ac66c5edd">ghostef</a>;
<a name="l11656"></a>11656                     <span class="keywordflow">if</span> ((avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae178f9274fdb67d25fc08371cab9049c">ghost_sf</a> == avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a8cb2c680f1789cdb7ad7f079cd1b7526">ghost_ef</a>) &amp;&amp; (avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae178f9274fdb67d25fc08371cab9049c">ghost_sf</a> == 0)) {
<a name="l11657"></a>11657                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae178f9274fdb67d25fc08371cab9049c">ghost_sf</a>= 1;
<a name="l11658"></a>11658                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a8cb2c680f1789cdb7ad7f079cd1b7526">ghost_ef</a>= 100;
<a name="l11659"></a>11659                     }
<a name="l11660"></a>11660                     
<a name="l11661"></a>11661                         <span class="comment">/* type */</span>
<a name="l11662"></a>11662                     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#af41c561ffde5c453f58dd0dce79c44dc">ghostep</a> == 0)
<a name="l11663"></a>11663                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a2669c7c1cd3de7a1d7fcb81272d15a88">ghost_type</a>= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a610ba7431d548def26692c7a85bfb98ba8c3c0f2ad3e9228c20bd6085392c468c">GHOST_TYPE_NONE</a>;
<a name="l11664"></a>11664                     <span class="keywordflow">else</span>
<a name="l11665"></a>11665                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a2669c7c1cd3de7a1d7fcb81272d15a88">ghost_type</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a23cbee4064ca48652e7c5e1fb16b4ed9">ghosttype</a> + 1;
<a name="l11666"></a>11666                     
<a name="l11667"></a>11667                         <span class="comment">/* stepsize */</span>
<a name="l11668"></a>11668                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a7f6231a9d42054382de8ddcd8d397ca4">ghost_step</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#add0acc61bcb6818daddc57195f14a07c">ghostsize</a>;
<a name="l11669"></a>11669                     <span class="keywordflow">if</span> (avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a7f6231a9d42054382de8ddcd8d397ca4">ghost_step</a> == 0)
<a name="l11670"></a>11670                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a7f6231a9d42054382de8ddcd8d397ca4">ghost_step</a>= 1;
<a name="l11671"></a>11671                     
<a name="l11672"></a>11672                     <span class="comment">/* path settings --------------------- */</span>
<a name="l11673"></a>11673                         <span class="comment">/* ranges */</span>
<a name="l11674"></a>11674                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a55425d15886ddc27f5fddea34c13b78b">path_bc</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a2f3d5305fc7a881d11eedbb3f5c5f91f">pathbc</a>;
<a name="l11675"></a>11675                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a913f7612a372d59d8b1985ced98602e0">path_ac</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a065bb0a08612ce76ee8a17f777c7df6a">pathac</a>;
<a name="l11676"></a>11676                     <span class="keywordflow">if</span> ((avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a55425d15886ddc27f5fddea34c13b78b">path_bc</a> == avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a913f7612a372d59d8b1985ced98602e0">path_ac</a>) &amp;&amp; (avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a55425d15886ddc27f5fddea34c13b78b">path_bc</a> == 0))
<a name="l11677"></a>11677                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a55425d15886ddc27f5fddea34c13b78b">path_bc</a>= avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a913f7612a372d59d8b1985ced98602e0">path_ac</a>= 10;
<a name="l11678"></a>11678                     
<a name="l11679"></a>11679                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ad35998f0ebc436fe8dbf8555b6ed2bd4">path_sf</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a6c9a76c640be66708063e94106a8a2e1">pathsf</a>;
<a name="l11680"></a>11680                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a1c7f367c8297ea8f6b1f109c18c64dfa">path_ef</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a801403955ddf74e25f5f414bdde77090">pathef</a>;
<a name="l11681"></a>11681                     <span class="keywordflow">if</span> ((avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ad35998f0ebc436fe8dbf8555b6ed2bd4">path_sf</a> == avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a1c7f367c8297ea8f6b1f109c18c64dfa">path_ef</a>) &amp;&amp; (avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ad35998f0ebc436fe8dbf8555b6ed2bd4">path_sf</a> == 0)) {
<a name="l11682"></a>11682                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ad35998f0ebc436fe8dbf8555b6ed2bd4">path_sf</a>= 1;
<a name="l11683"></a>11683                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a1c7f367c8297ea8f6b1f109c18c64dfa">path_ef</a>= 250;
<a name="l11684"></a>11684                     }
<a name="l11685"></a>11685                     
<a name="l11686"></a>11686                         <span class="comment">/* flags */</span>
<a name="l11687"></a>11687                     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a450f1fe942d992a7e68995f25d356dd4">pathflag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a52b6d46f46b736fef35f19bd01c77f9da174aacef515bb7496d8dee9eae121de4">ARM_PATH_FNUMS</a>)
<a name="l11688"></a>11688                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae2531f412a609c0c44f91f0609eab215">path_viewflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a71ee38f167a2a11825351e6a24122332a9320e46b1c2b8b3186055efb44aa277e">MOTIONPATH_VIEW_FNUMS</a>;
<a name="l11689"></a>11689                     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a450f1fe942d992a7e68995f25d356dd4">pathflag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a52b6d46f46b736fef35f19bd01c77f9dae94700876d5a5ca4a71a8c892a74db8c">ARM_PATH_KFRAS</a>)
<a name="l11690"></a>11690                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae2531f412a609c0c44f91f0609eab215">path_viewflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a71ee38f167a2a11825351e6a24122332ab976a73b3b08823a8405307289b6c427">MOTIONPATH_VIEW_KFRAS</a>;
<a name="l11691"></a>11691                     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a450f1fe942d992a7e68995f25d356dd4">pathflag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a52b6d46f46b736fef35f19bd01c77f9daa1f316623f194c78a5edaf448213ec9c">ARM_PATH_KFNOS</a>)
<a name="l11692"></a>11692                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae2531f412a609c0c44f91f0609eab215">path_viewflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a71ee38f167a2a11825351e6a24122332a30f856393b9576d2758f4e01d2ee9cf0">MOTIONPATH_VIEW_KFNOS</a>;
<a name="l11693"></a>11693                     
<a name="l11694"></a>11694                         <span class="comment">/* bake flags */</span>
<a name="l11695"></a>11695                     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a450f1fe942d992a7e68995f25d356dd4">pathflag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a52b6d46f46b736fef35f19bd01c77f9da8b3feee6c0191c4a04b7adeddf0f66cd">ARM_PATH_HEADS</a>)
<a name="l11696"></a>11696                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a1811764f4a3741028ebe2bf5e43496de">path_bakeflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a10649c21734145b9ff1cd2248d610e7ba4bf814c0379f7672e4dd1da0ba50c58a">MOTIONPATH_BAKE_HEADS</a>;
<a name="l11697"></a>11697                     
<a name="l11698"></a>11698                         <span class="comment">/* type */</span>
<a name="l11699"></a>11699                     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a450f1fe942d992a7e68995f25d356dd4">pathflag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#a52b6d46f46b736fef35f19bd01c77f9dac475ab2a5b33770291c619f6e0dcd3ad">ARM_PATH_ACFRA</a>)
<a name="l11700"></a>11700                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#a097b3aad81b763d4b62add2056824133">path_type</a> = <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a1a8481e9f50b1da0a115c1b237202f7fa618a3afe670bbbfe74ca8f9dfe946ef8">MOTIONPATH_TYPE_ACFRA</a>;
<a name="l11701"></a>11701                     
<a name="l11702"></a>11702                         <span class="comment">/* stepsize */</span>
<a name="l11703"></a>11703                     avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae3549c68e2e78ee6e68bbebc9fbf7718">path_step</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aa33d7bb70160b23b22edc7639a7f9e71">pathsize</a>;
<a name="l11704"></a>11704                     <span class="keywordflow">if</span> (avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae3549c68e2e78ee6e68bbebc9fbf7718">path_step</a> == 0)
<a name="l11705"></a>11705                         avs-&gt;<a class="code" href="../../db/de3/structbAnimVizSettings.html#ae3549c68e2e78ee6e68bbebc9fbf7718">path_step</a>= 1;
<a name="l11706"></a>11706                 }
<a name="l11707"></a>11707                 <span class="keywordflow">else</span>
<a name="l11708"></a>11708                     <a class="code" href="../../df/dd0/BKE__anim_8h.html#a5d6fe871f52b3912c34e29f29e6968ff">animviz_settings_init</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a66f05f761e3d89a2717137132fff43cc">avs</a>);
<a name="l11709"></a>11709             }
<a name="l11710"></a>11710         }
<a name="l11711"></a>11711         
<a name="l11712"></a>11712         <span class="comment">/* brush texture changes */</span>
<a name="l11713"></a>11713         <span class="keywordflow">for</span> (brush= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11714"></a>11714             <a class="code" href="../../d2/d66/BKE__texture_8h.html#a804c8b305f091b569244c79fc98a295b">default_mtex</a>(&amp;brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>);
<a name="l11715"></a>11715         }
<a name="l11716"></a>11716 
<a name="l11717"></a>11717         <span class="keywordflow">for</span> (ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11718"></a>11718             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a981543a30412a03fdfff78a5f991c43a">ms_spread</a> &lt; 0.0001f) {
<a name="l11719"></a>11719                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a981543a30412a03fdfff78a5f991c43a">ms_spread</a> = 0.2f;
<a name="l11720"></a>11720                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#a1fe8f511acd36361bb828e14ed3ba010">ms_diff</a> = 1.f;
<a name="l11721"></a>11721                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a26599dc117dcc1cd6e228e74864a39f7">vol</a>.<a class="code" href="../../d5/d16/structVolumeSettings.html#af30f9005d0970a254ef466687dbc8ce3">ms_intensity</a> = 1.f; 
<a name="l11722"></a>11722             }
<a name="l11723"></a>11723         }
<a name="l11724"></a>11724     }
<a name="l11725"></a>11725     
<a name="l11726"></a>11726     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 13)) {
<a name="l11727"></a>11727         <span class="comment">/* NOTE: if you do more conversion, be sure to do it outside of this and</span>
<a name="l11728"></a>11728 <span class="comment">         * increase subversion again, otherwise it will not be correct */</span>
<a name="l11729"></a>11729         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11730"></a>11730         
<a name="l11731"></a>11731         <span class="comment">/* convert degrees to radians for internal use */</span>
<a name="l11732"></a>11732         <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11733"></a>11733             <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l11734"></a>11734 
<a name="l11735"></a>11735             <a class="code" href="../../d0/d12/readfile_8c.html#aab2c29513b121716e8ed992816e03102">do_version_constraints_radians_degrees_250</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>);
<a name="l11736"></a>11736 
<a name="l11737"></a>11737             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l11738"></a>11738                 <span class="keywordflow">for</span> (pchan=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l11739"></a>11739                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[0] *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l11740"></a>11740                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[1] *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l11741"></a>11741                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a2b5b827016a19c9a839d1f06b3e6ca68">limitmin</a>[2] *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l11742"></a>11742                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[0] *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l11743"></a>11743                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[1] *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l11744"></a>11744                     pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a04689447b807d93a11d9c96c6446a892">limitmax</a>[2] *= (float)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.0);
<a name="l11745"></a>11745 
<a name="l11746"></a>11746                     <a class="code" href="../../d0/d12/readfile_8c.html#aab2c29513b121716e8ed992816e03102">do_version_constraints_radians_degrees_250</a>(&amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>);
<a name="l11747"></a>11747                 }
<a name="l11748"></a>11748             }
<a name="l11749"></a>11749         }
<a name="l11750"></a>11750     }
<a name="l11751"></a>11751     
<a name="l11752"></a>11752     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 14)) {
<a name="l11753"></a>11753         <span class="comment">/* fix for bad View2D extents for Animation Editors */</span>
<a name="l11754"></a>11754         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l11755"></a>11755         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11756"></a>11756         <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11757"></a>11757         
<a name="l11758"></a>11758         <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11759"></a>11759             <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11760"></a>11760                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11761"></a>11761                     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *regionbase;
<a name="l11762"></a>11762                     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l11763"></a>11763                     
<a name="l11764"></a>11764                     <span class="keywordflow">if</span> (sl == sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l11765"></a>11765                         regionbase = &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>;
<a name="l11766"></a>11766                     <span class="keywordflow">else</span>
<a name="l11767"></a>11767                         regionbase = &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>;
<a name="l11768"></a>11768                         
<a name="l11769"></a>11769                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>)) {
<a name="l11770"></a>11770                         <span class="keywordflow">for</span> (ar = (<a class="code" href="../../da/d23/structARegion.html">ARegion</a>*)regionbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l11771"></a>11771                             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l11772"></a>11772                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0.0f;
<a name="l11773"></a>11773                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a08871e1668409d82d50b637bab889f74">tot</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = (float)(-sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9bf030bfae8e6e6ff63acd63f0d499df">winy</a>) / 3.0f;
<a name="l11774"></a>11774                             }
<a name="l11775"></a>11775                         }
<a name="l11776"></a>11776                     }
<a name="l11777"></a>11777                 }
<a name="l11778"></a>11778             }
<a name="l11779"></a>11779         }
<a name="l11780"></a>11780     }
<a name="l11781"></a>11781     
<a name="l11782"></a>11782     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 15)) {
<a name="l11783"></a>11783         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo;
<a name="l11784"></a>11784         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l11785"></a>11785 
<a name="l11786"></a>11786         <span class="comment">/* ambient default from 0.5f to 1.0f */</span>
<a name="l11787"></a>11787         <span class="keywordflow">for</span> (ma= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma=ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11788"></a>11788             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a870998ec12271918c097d9077d771aef">amb</a> *= 2.0f;
<a name="l11789"></a>11789 
<a name="l11790"></a>11790         <span class="keywordflow">for</span> (wo= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wo; wo=wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11791"></a>11791             <span class="comment">/* ao splitting into ao/env/indirect */</span>
<a name="l11792"></a>11792             wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ace038b13e38d640594d07e0b8967fb8f">ao_env_energy</a>= wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8ac1ebb22534921871e73ed336d60883">aoenergy</a>;
<a name="l11793"></a>11793             wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8ac1ebb22534921871e73ed336d60883">aoenergy</a>= 1.0f;
<a name="l11794"></a>11794 
<a name="l11795"></a>11795             <span class="keywordflow">if</span> (wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aea187ee925e4082c730847109f483609">ao_indirect_bounces</a> == 0)
<a name="l11796"></a>11796                 wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aea187ee925e4082c730847109f483609">ao_indirect_bounces</a>= 1;
<a name="l11797"></a>11797             <span class="keywordflow">else</span>
<a name="l11798"></a>11798                 wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a97cd565855bf995024151e5a6ad307dc">mode</a> |= <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#ab22674234b5c090b07634ed24c7d844d">WO_INDIRECT_LIGHT</a>;
<a name="l11799"></a>11799 
<a name="l11800"></a>11800             <span class="keywordflow">if</span> (wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad2c2735abeec2356a7c4838735d00dc5">aomix</a> == <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a4cfe1354e5765598ae2b60d9d816564b">WO_AOSUB</a>)
<a name="l11801"></a>11801                 wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ace038b13e38d640594d07e0b8967fb8f">ao_env_energy</a>= -wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ace038b13e38d640594d07e0b8967fb8f">ao_env_energy</a>;
<a name="l11802"></a>11802             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad2c2735abeec2356a7c4838735d00dc5">aomix</a> == <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a3b2a3eb7a91fad836100970d2593ebf6">WO_AOADDSUB</a>)
<a name="l11803"></a>11803                 wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a97cd565855bf995024151e5a6ad307dc">mode</a> |= <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a318ce0a82b265f4b6ad43e4ce3339a49">WO_AMB_OCC</a>;
<a name="l11804"></a>11804 
<a name="l11805"></a>11805             wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ad2c2735abeec2356a7c4838735d00dc5">aomix</a>= <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#ac6f043e1d5ffb88a181e5a8b89e86591">WO_AOMUL</a>;
<a name="l11806"></a>11806 
<a name="l11807"></a>11807             <span class="comment">/* ambient default from 0.5f to 1.0f */</span>
<a name="l11808"></a>11808             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(&amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#afe57a3755ed6c82d7e6462e7bc0c0525">ambr</a>, 0.5f);
<a name="l11809"></a>11809             wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ace038b13e38d640594d07e0b8967fb8f">ao_env_energy</a> *= 0.5f;
<a name="l11810"></a>11810         }
<a name="l11811"></a>11811     }
<a name="l11812"></a>11812     
<a name="l11813"></a>11813     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 250 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 17)) {
<a name="l11814"></a>11814         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l11815"></a>11815         <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l11816"></a>11816         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l11817"></a>11817 
<a name="l11818"></a>11818         <span class="comment">/* initialize to sane default so toggling on border shows something */</span>
<a name="l11819"></a>11819         <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11820"></a>11820             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> == 0.0f &amp;&amp; sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> == 0.0f &amp;&amp;
<a name="l11821"></a>11821                sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> == 0.0f &amp;&amp; sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> == 0.0f) {
<a name="l11822"></a>11822                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = 0.0f;
<a name="l11823"></a>11823                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = 0.0f;
<a name="l11824"></a>11824                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = 1.0f;
<a name="l11825"></a>11825                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaaf1a7daed17e111b846fe8632874e5d">border</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 1.0f;
<a name="l11826"></a>11826             }
<a name="l11827"></a>11827 
<a name="l11828"></a>11828             <span class="keywordflow">if</span> ((sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a148e3a37c8b0e1fda614b3b094f2787c">flags</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ab8463d65c477679e996be81cf9761e7a">FFMPEG_MULTIPLEX_AUDIO</a>) == 0)
<a name="l11829"></a>11829                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a273003576955e64b38c5f657bea3e301">audio_codec</a> = 0x0; <span class="comment">// CODEC_ID_NONE</span>
<a name="l11830"></a>11830 
<a name="l11831"></a>11831             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l11832"></a>11832                 seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#ad5358474c9dc2cf62dfd70ea26dd6953">volume</a> = 1.0f;
<a name="l11833"></a>11833             }
<a name="l11834"></a>11834             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l11835"></a>11835         }
<a name="l11836"></a>11836 
<a name="l11837"></a>11837         <span class="comment">/* particle brush strength factor was changed from int to float */</span>
<a name="l11838"></a>11838         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11839"></a>11839             <a class="code" href="../../df/db7/structParticleEditSettings.html">ParticleEditSettings</a> *pset= &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a931875e2d55fef9de65c777431a94f31">particle</a>;
<a name="l11840"></a>11840             <span class="keywordtype">int</span> a;
<a name="l11841"></a>11841 
<a name="l11842"></a>11842             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#adacf2d7fb008adfb64554ced30c5fd89">PE_TOT_BRUSH</a>; a++)
<a name="l11843"></a>11843                 pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a23ec19a6f795b0da2361718b51effaa6">brush</a>[a].<a class="code" href="../../d5/d14/structParticleBrushData.html#aae99022471b53d681c39d0fe3b9a583f">strength</a> /= 100.0f;
<a name="l11844"></a>11844         }
<a name="l11845"></a>11845 
<a name="l11846"></a>11846         <span class="keywordflow">for</span> (ma = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma=ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11847"></a>11847             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#acda2cb9524d4e603dae82a0ae552c1a2">MA_TRACEBLE</a>)
<a name="l11848"></a>11848                 ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#aeef8bf00cf7a52e2e5568f5e4d4ca6e5">shade_flag</a> |= <a class="code" href="../../de/db2/DNA__material__types_8h.html#ab8ca00252c48545c835ce23b7cec5642">MA_APPROX_OCCLUSION</a>;
<a name="l11849"></a>11849 
<a name="l11850"></a>11850         <span class="comment">/* sequencer changes */</span>
<a name="l11851"></a>11851         {
<a name="l11852"></a>11852             <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l11853"></a>11853             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11854"></a>11854             <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11855"></a>11855 
<a name="l11856"></a>11856             <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11857"></a>11857                 <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11858"></a>11858                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11859"></a>11859                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l11860"></a>11860                             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar_preview;
<a name="l11861"></a>11861                             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *regionbase;
<a name="l11862"></a>11862 
<a name="l11863"></a>11863                             <span class="keywordflow">if</span> (sl == sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l11864"></a>11864                                 regionbase = &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>;
<a name="l11865"></a>11865                             }
<a name="l11866"></a>11866                             <span class="keywordflow">else</span> {
<a name="l11867"></a>11867                                 regionbase = &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>;
<a name="l11868"></a>11868                             }
<a name="l11869"></a>11869 
<a name="l11870"></a>11870                             ar_preview = (<a class="code" href="../../da/d23/structARegion.html">ARegion</a>*)regionbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11871"></a>11871                             for (; ar_preview; ar_preview = ar_preview-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l11872"></a>11872                                 <span class="keywordflow">if</span> (ar_preview-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a9c229d954ba6692b9ea76f4a444a6ad5">RGN_TYPE_PREVIEW</a>)
<a name="l11873"></a>11873                                     <span class="keywordflow">break</span>;
<a name="l11874"></a>11874                             }
<a name="l11875"></a>11875                             <span class="keywordflow">if</span> (ar_preview &amp;&amp; (ar_preview-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a9c229d954ba6692b9ea76f4a444a6ad5">RGN_TYPE_PREVIEW</a>)) {
<a name="l11876"></a>11876                                 <a class="code" href="../../d0/d12/readfile_8c.html#a2181aed3654255aec35f9ceb3d8f80ee">sequencer_init_preview_region</a>(ar_preview);
<a name="l11877"></a>11877                             }
<a name="l11878"></a>11878                         }
<a name="l11879"></a>11879                     }
<a name="l11880"></a>11880                 }
<a name="l11881"></a>11881             }
<a name="l11882"></a>11882         } <span class="comment">/* sequencer changes */</span>
<a name="l11883"></a>11883     }
<a name="l11884"></a>11884     
<a name="l11885"></a>11885     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt;= 251) { <span class="comment">/* 2.5.1 had no subversions */</span>
<a name="l11886"></a>11886         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l11887"></a>11887         
<a name="l11888"></a>11888         <span class="comment">/* Blender 2.5.2 - subversion 0 introduced a new setting: V3D_RENDER_OVERRIDE.</span>
<a name="l11889"></a>11889 <span class="comment">         * This bit was used in the past for V3D_TRANSFORM_SNAP, which is now deprecated. </span>
<a name="l11890"></a>11890 <span class="comment">         * Here we clear it for old files so they don&#39;t come in with V3D_RENDER_OVERRIDE set,</span>
<a name="l11891"></a>11891 <span class="comment">         * which would cause cameras, lamps, etc to become invisible */</span>
<a name="l11892"></a>11892         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11893"></a>11893             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11894"></a>11894             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11895"></a>11895                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11896"></a>11896                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11897"></a>11897                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l11898"></a>11898                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a>* v3d = (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l11899"></a>11899                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp;= ~<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>;
<a name="l11900"></a>11900                     }
<a name="l11901"></a>11901                 }
<a name="l11902"></a>11902             }
<a name="l11903"></a>11903         }
<a name="l11904"></a>11904     }
<a name="l11905"></a>11905 
<a name="l11906"></a>11906     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 252 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 252 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l11907"></a>11907         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l11908"></a>11908         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11909"></a>11909         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l11910"></a>11910         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l11911"></a>11911         
<a name="l11912"></a>11912         <span class="keywordflow">for</span> (brush= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11913"></a>11913             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>) brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a799bee38fb167d41e7ff198e86e359f5">preset</a> = <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409cea8880071f13cceaa7a4341aee8e65bbe3">CURVE_PRESET_SMOOTH</a>;
<a name="l11914"></a>11914         }
<a name="l11915"></a>11915         
<a name="l11916"></a>11916         <span class="comment">/* properly initialize active flag for fluidsim modifiers */</span>
<a name="l11917"></a>11917         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11918"></a>11918             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l11919"></a>11919             <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l11920"></a>11920                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>) {
<a name="l11921"></a>11921                     <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)md;
<a name="l11922"></a>11922                     fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a71cd12d25749b0af83047f181a541b6f">flag</a> |= <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#a69170b974b3c3d68a6afad9158378239">OB_FLUIDSIM_ACTIVE</a>; 
<a name="l11923"></a>11923                     fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a71cd12d25749b0af83047f181a541b6f">flag</a> |= <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#a748b9ac4eb5bc09112050c3b1b842350">OB_FLUIDSIM_OVERRIDE_TIME</a>;
<a name="l11924"></a>11924                 }
<a name="l11925"></a>11925             }
<a name="l11926"></a>11926         }
<a name="l11927"></a>11927         
<a name="l11928"></a>11928         <span class="comment">/* adjustment to color balance node values */</span>
<a name="l11929"></a>11929         <span class="keywordflow">for</span> (scene= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11930"></a>11930             <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l11931"></a>11931                 <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11932"></a>11932                 
<a name="l11933"></a>11933                 <span class="keywordflow">while</span> (node) {
<a name="l11934"></a>11934                     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#a4672570afdd228945b0e5cc97dc9bad6">CMP_NODE_COLORBALANCE</a>) {
<a name="l11935"></a>11935                         <a class="code" href="../../dc/dcd/structNodeColorBalance.html">NodeColorBalance</a> *n= (<a class="code" href="../../dc/dcd/structNodeColorBalance.html">NodeColorBalance</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l11936"></a>11936                         n-&gt;<a class="code" href="../../dc/dcd/structNodeColorBalance.html#ab7c49f7be7902eb811b4f23ac7899d06">lift</a>[0] += 1.f;
<a name="l11937"></a>11937                         n-&gt;<a class="code" href="../../dc/dcd/structNodeColorBalance.html#ab7c49f7be7902eb811b4f23ac7899d06">lift</a>[1] += 1.f;
<a name="l11938"></a>11938                         n-&gt;<a class="code" href="../../dc/dcd/structNodeColorBalance.html#ab7c49f7be7902eb811b4f23ac7899d06">lift</a>[2] += 1.f;
<a name="l11939"></a>11939                     }
<a name="l11940"></a>11940                     node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l11941"></a>11941                 }
<a name="l11942"></a>11942             }
<a name="l11943"></a>11943         }
<a name="l11944"></a>11944         <span class="comment">/* check inside node groups too */</span>
<a name="l11945"></a>11945         <span class="keywordflow">for</span> (ntree= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11946"></a>11946             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l11947"></a>11947             
<a name="l11948"></a>11948             <span class="keywordflow">while</span> (node) {
<a name="l11949"></a>11949                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#a4672570afdd228945b0e5cc97dc9bad6">CMP_NODE_COLORBALANCE</a>) {
<a name="l11950"></a>11950                     <a class="code" href="../../dc/dcd/structNodeColorBalance.html">NodeColorBalance</a> *n= (<a class="code" href="../../dc/dcd/structNodeColorBalance.html">NodeColorBalance</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l11951"></a>11951                     n-&gt;<a class="code" href="../../dc/dcd/structNodeColorBalance.html#ab7c49f7be7902eb811b4f23ac7899d06">lift</a>[0] += 1.f;
<a name="l11952"></a>11952                     n-&gt;<a class="code" href="../../dc/dcd/structNodeColorBalance.html#ab7c49f7be7902eb811b4f23ac7899d06">lift</a>[1] += 1.f;
<a name="l11953"></a>11953                     n-&gt;<a class="code" href="../../dc/dcd/structNodeColorBalance.html#ab7c49f7be7902eb811b4f23ac7899d06">lift</a>[2] += 1.f;
<a name="l11954"></a>11954                 }
<a name="l11955"></a>11955                 node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l11956"></a>11956             }
<a name="l11957"></a>11957         }
<a name="l11958"></a>11958     }
<a name="l11959"></a>11959     
<a name="l11960"></a>11960     <span class="comment">/* old-track -&gt; constraints (this time we&#39;re really doing it!) */</span>
<a name="l11961"></a>11961     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 252 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 252 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l11962"></a>11962         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11963"></a>11963         
<a name="l11964"></a>11964         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l11965"></a>11965             <a class="code" href="../../d0/d12/readfile_8c.html#af30ff8b22789c2549e3c3c0931701a1b">do_version_old_trackto_to_constraints</a>(ob);
<a name="l11966"></a>11966     }
<a name="l11967"></a>11967     
<a name="l11968"></a>11968     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 252 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 252 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 5)) {
<a name="l11969"></a>11969         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l11970"></a>11970         
<a name="l11971"></a>11971         <span class="comment">/* Image editor scopes */</span>
<a name="l11972"></a>11972         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11973"></a>11973             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11974"></a>11974             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11975"></a>11975                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11976"></a>11976                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l11977"></a>11977                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l11978"></a>11978                         <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima = (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l11979"></a>11979                         <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a928b75fffc5a17a4c05e812a136bb04d">scopes_new</a>(&amp;sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a1172abd96c9c13da82bca2bb798d5451">scopes</a>);
<a name="l11980"></a>11980                     }
<a name="l11981"></a>11981                 }
<a name="l11982"></a>11982             }
<a name="l11983"></a>11983         }
<a name="l11984"></a>11984     }
<a name="l11985"></a>11985     
<a name="l11986"></a>11986 
<a name="l11987"></a>11987     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 253)
<a name="l11988"></a>11988     {
<a name="l11989"></a>11989         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l11990"></a>11990         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l11991"></a>11991         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l11992"></a>11992         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l11993"></a>11993         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l11994"></a>11994 
<a name="l11995"></a>11995         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l11996"></a>11996             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l11997"></a>11997             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l11998"></a>11998                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l11999"></a>11999                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12000"></a>12000                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l12001"></a>12001                         <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= (<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *)sl;
<a name="l12002"></a>12002                         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *regionbase;
<a name="l12003"></a>12003                         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l12004"></a>12004 
<a name="l12005"></a>12005                         <span class="keywordflow">if</span> (sl == sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l12006"></a>12006                             regionbase = &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>;
<a name="l12007"></a>12007                         <span class="keywordflow">else</span>
<a name="l12008"></a>12008                             regionbase = &amp;sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>;
<a name="l12009"></a>12009 
<a name="l12010"></a>12010                         <span class="keywordflow">if</span> (snode-&gt;v2d.minzoom &gt; 0.09f)
<a name="l12011"></a>12011                             snode-&gt;v2d.minzoom= 0.09f;
<a name="l12012"></a>12012                         <span class="keywordflow">if</span> (snode-&gt;v2d.maxzoom &lt; 2.31f)
<a name="l12013"></a>12013                             snode-&gt;v2d.maxzoom= 2.31f;
<a name="l12014"></a>12014 
<a name="l12015"></a>12015                         <span class="keywordflow">for</span> (ar= regionbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l12016"></a>12016                             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l12017"></a>12017                                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a> &gt; 0.09f)
<a name="l12018"></a>12018                                     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= 0.09f;
<a name="l12019"></a>12019                                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a> &lt; 2.31f)
<a name="l12020"></a>12020                                     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= 2.31f;
<a name="l12021"></a>12021                             }
<a name="l12022"></a>12022                         }
<a name="l12023"></a>12023                     }
<a name="l12024"></a>12024                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca51011faadfd7d38d3d7a810c600e9458">SPACE_TIME</a>) {
<a name="l12025"></a>12025                         <a class="code" href="../../d5/d0c/structSpaceTime.html">SpaceTime</a> *stime= (<a class="code" href="../../d5/d0c/structSpaceTime.html">SpaceTime</a> *)sl;
<a name="l12026"></a>12026                         
<a name="l12027"></a>12027                         <span class="comment">/* enable all cache display */</span>
<a name="l12028"></a>12028                         stime-&gt;<a class="code" href="../../d5/d0c/structSpaceTime.html#a7b78a4f9799855f8a880ce349fe7a251">cache_display</a> |= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a7f60b041371657035eb461248fe1cd81">TIME_CACHE_DISPLAY</a>;
<a name="l12029"></a>12029                         stime-&gt;<a class="code" href="../../d5/d0c/structSpaceTime.html#a7b78a4f9799855f8a880ce349fe7a251">cache_display</a> |= (<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a67484f8cfbc4f2f9ed2c66eea6e95ae2">TIME_CACHE_SOFTBODY</a>|<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a877f29ce92511969c84e62cdc9ee3386">TIME_CACHE_PARTICLES</a>);
<a name="l12030"></a>12030                         stime-&gt;<a class="code" href="../../d5/d0c/structSpaceTime.html#a7b78a4f9799855f8a880ce349fe7a251">cache_display</a> |= (<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a2b1ea9a8e0f1fd0672376b8a357935fa">TIME_CACHE_CLOTH</a>|<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a39e10eb72f7b045390ae5b04f360ee04">TIME_CACHE_SMOKE</a>|<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#adc4b22251a0588e73be73d4497a02b49">TIME_CACHE_DYNAMICPAINT</a>);
<a name="l12031"></a>12031                     }
<a name="l12032"></a>12032                 }
<a name="l12033"></a>12033             }
<a name="l12034"></a>12034         }
<a name="l12035"></a>12035 
<a name="l12036"></a>12036         <a class="code" href="../../d0/d12/readfile_8c.html#ac1d1392aa792d706bcb963bac44eb9e3">do_version_mdef_250</a>(main);
<a name="l12037"></a>12037 
<a name="l12038"></a>12038         <span class="comment">/* parent type to modifier */</span>
<a name="l12039"></a>12039         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12040"></a>12040             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>) {
<a name="l12041"></a>12041                 <a class="code" href="../../de/de7/structObject.html">Object</a> *parent= (<a class="code" href="../../de/de7/structObject.html">Object</a> *)<a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l12042"></a>12042                 <span class="keywordflow">if</span> (parent) { <span class="comment">/* parent may not be in group */</span>
<a name="l12043"></a>12043                     <span class="keywordflow">if</span> (parent-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af88b95b0ce3123f10e88d858cbb50f05">PARSKEL</a>) {
<a name="l12044"></a>12044                         <a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a> *amd;
<a name="l12045"></a>12045                         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= (<a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *)<a class="code" href="../../d0/d12/readfile_8c.html#aab9ad7203b84b202556b039fab9d5cff">newlibadr</a>(fd, lib, parent-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l12046"></a>12046 
<a name="l12047"></a>12047                         amd = (<a class="code" href="../../de/d02/structArmatureModifierData.html">ArmatureModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435aa45deecb66e254a60207702a40efa416">eModifierType_Armature</a>);
<a name="l12048"></a>12048                         amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#a590e2df001575f79a07d66a7205ebe75">object</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>;
<a name="l12049"></a>12049                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>((<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>*)&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, amd);
<a name="l12050"></a>12050                         amd-&gt;<a class="code" href="../../de/d02/structArmatureModifierData.html#a0af9660b6f13d55ac8950af32931b043">deformflag</a>= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7c414a008b307fcd47b2441d93ae2213">deformflag</a>;
<a name="l12051"></a>12051                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#accc5a1256f709e67b3448b2eb695bd8a">PAROBJECT</a>;
<a name="l12052"></a>12052                     }
<a name="l12053"></a>12053                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parent-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af88b95b0ce3123f10e88d858cbb50f05">PARSKEL</a>) {
<a name="l12054"></a>12054                         <a class="code" href="../../d8/db7/structLatticeModifierData.html">LatticeModifierData</a> *lmd;
<a name="l12055"></a>12055 
<a name="l12056"></a>12056                         lmd = (<a class="code" href="../../d8/db7/structLatticeModifierData.html">LatticeModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a405445d7a24594136497267fc4c46f69">eModifierType_Lattice</a>);
<a name="l12057"></a>12057                         lmd-&gt;<a class="code" href="../../d8/db7/structLatticeModifierData.html#af7501587d1a206d3111f781d4c4a0bca">object</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>;
<a name="l12058"></a>12058                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>((<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>*)&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, lmd);
<a name="l12059"></a>12059                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#accc5a1256f709e67b3448b2eb695bd8a">PAROBJECT</a>;
<a name="l12060"></a>12060                     }
<a name="l12061"></a>12061                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parent-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a0d6cab54d20290ca6a45c4940da96745">PARCURVE</a>) {
<a name="l12062"></a>12062                         <a class="code" href="../../db/d18/structCurveModifierData.html">CurveModifierData</a> *cmd;
<a name="l12063"></a>12063 
<a name="l12064"></a>12064                         cmd = (<a class="code" href="../../db/d18/structCurveModifierData.html">CurveModifierData</a>*) <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ad792bc6e3890679e671ffd17a10194c5">modifier_new</a>(<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a371fa9ace76cf450ce78e930aafdb2af">eModifierType_Curve</a>);
<a name="l12065"></a>12065                         cmd-&gt;<a class="code" href="../../db/d18/structCurveModifierData.html#ad80dd389d2f3ff690cb9318eeca777e9">object</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>;
<a name="l12066"></a>12066                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>((<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>*)&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>, cmd);
<a name="l12067"></a>12067                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a> = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#accc5a1256f709e67b3448b2eb695bd8a">PAROBJECT</a>;
<a name="l12068"></a>12068                     }
<a name="l12069"></a>12069                 }
<a name="l12070"></a>12070             }
<a name="l12071"></a>12071         }
<a name="l12072"></a>12072         
<a name="l12073"></a>12073         <span class="comment">/* initialize scene active layer */</span>
<a name="l12074"></a>12074         <span class="keywordflow">for</span> (scene= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12075"></a>12075             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l12076"></a>12076             <span class="keywordflow">for</span> (i=0; i&lt;20; i++) {
<a name="l12077"></a>12077                 <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a> &amp; (1&lt;&lt;i)) {
<a name="l12078"></a>12078                     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#af04604238d2057e2ac31625911a0f26e">layact</a>= 1&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l12079"></a>12079                     <span class="keywordflow">break</span>;
<a name="l12080"></a>12080                 }
<a name="l12081"></a>12081             }
<a name="l12082"></a>12082         }
<a name="l12083"></a>12083 
<a name="l12084"></a>12084         <span class="keywordflow">for</span> (tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12085"></a>12085             <span class="comment">/* if youre picky, this isn&#39;t correct until we do a version bump</span>
<a name="l12086"></a>12086 <span class="comment">             * since you could set saturation to be 0.0*/</span>
<a name="l12087"></a>12087             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a6e68ea064738eff3148ae626359bde77">saturation</a>==0.0f)
<a name="l12088"></a>12088                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a6e68ea064738eff3148ae626359bde77">saturation</a>= 1.0f;
<a name="l12089"></a>12089         }
<a name="l12090"></a>12090 
<a name="l12091"></a>12091         {
<a name="l12092"></a>12092             <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l12093"></a>12093             <span class="keywordflow">for</span> (cu= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cu; cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12094"></a>12094                 cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac5addf9f547e56142edf1936e78608ef">smallcaps_scale</a>= 0.75f;
<a name="l12095"></a>12095             }
<a name="l12096"></a>12096         }
<a name="l12097"></a>12097 
<a name="l12098"></a>12098         <span class="keywordflow">for</span> (scene= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12099"></a>12099             <span class="keywordflow">if</span> (scene) {
<a name="l12100"></a>12100                 <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l12101"></a>12101                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l12102"></a>12102                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a27c4c9b8aec6019d70ff323d2f49e36f">sat</a>==0.0f) {
<a name="l12103"></a>12103                         seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a27c4c9b8aec6019d70ff323d2f49e36f">sat</a>= 1.0f;
<a name="l12104"></a>12104                     }
<a name="l12105"></a>12105                 }
<a name="l12106"></a>12106                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l12107"></a>12107             }
<a name="l12108"></a>12108         }
<a name="l12109"></a>12109 
<a name="l12110"></a>12110         <span class="comment">/* GSOC 2010 Sculpt - New settings for Brush */</span>
<a name="l12111"></a>12111 
<a name="l12112"></a>12112         <span class="keywordflow">for</span> (brush= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12113"></a>12113             <span class="comment">/* Sanity Check */</span>
<a name="l12114"></a>12114 
<a name="l12115"></a>12115             <span class="comment">// infinite number of dabs</span>
<a name="l12116"></a>12116             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aad34a21e33c74412c20c9a20c5535424">spacing</a> == 0)
<a name="l12117"></a>12117                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aad34a21e33c74412c20c9a20c5535424">spacing</a> = 10;
<a name="l12118"></a>12118 
<a name="l12119"></a>12119             <span class="comment">// will have no effect</span>
<a name="l12120"></a>12120             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a05d1b34fb95a0932190b690b61b276ee">alpha</a> == 0)
<a name="l12121"></a>12121                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a05d1b34fb95a0932190b690b61b276ee">alpha</a> = 0.5f;
<a name="l12122"></a>12122 
<a name="l12123"></a>12123             <span class="comment">// bad radius</span>
<a name="l12124"></a>12124             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3eaaeca69e25ae6877ea6a318c61a9f6">unprojected_radius</a> == 0)
<a name="l12125"></a>12125                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3eaaeca69e25ae6877ea6a318c61a9f6">unprojected_radius</a> = 0.125f;
<a name="l12126"></a>12126 
<a name="l12127"></a>12127             <span class="comment">// unusable size</span>
<a name="l12128"></a>12128             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a9cf9fcecab64b7e853066eb75d4c78d4">size</a> == 0)
<a name="l12129"></a>12129                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a9cf9fcecab64b7e853066eb75d4c78d4">size</a> = 35;
<a name="l12130"></a>12130 
<a name="l12131"></a>12131             <span class="comment">// can&#39;t see overlay</span>
<a name="l12132"></a>12132             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a370eb070b1a9ae34e7f2190f347046aa">texture_overlay_alpha</a> == 0)
<a name="l12133"></a>12133                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a370eb070b1a9ae34e7f2190f347046aa">texture_overlay_alpha</a> = 33;
<a name="l12134"></a>12134 
<a name="l12135"></a>12135             <span class="comment">// same as draw brush</span>
<a name="l12136"></a>12136             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aad35bfdb13e68eef83a2b959d57c80f6">crease_pinch_factor</a> == 0)
<a name="l12137"></a>12137                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aad35bfdb13e68eef83a2b959d57c80f6">crease_pinch_factor</a> = 0.5f;
<a name="l12138"></a>12138 
<a name="l12139"></a>12139             <span class="comment">// will sculpt no vertexes</span>
<a name="l12140"></a>12140             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a757759e952a4e503c94975bc9625315b">plane_trim</a> == 0)
<a name="l12141"></a>12141                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a757759e952a4e503c94975bc9625315b">plane_trim</a> = 0.5f;
<a name="l12142"></a>12142 
<a name="l12143"></a>12143             <span class="comment">// same as smooth stroke off</span>
<a name="l12144"></a>12144             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a4c80a74f85b613bb78050daca2560af5">smooth_stroke_radius</a> == 0)
<a name="l12145"></a>12145                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a4c80a74f85b613bb78050daca2560af5">smooth_stroke_radius</a>= 75;
<a name="l12146"></a>12146 
<a name="l12147"></a>12147             <span class="comment">// will keep cursor in one spot</span>
<a name="l12148"></a>12148             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a4c80a74f85b613bb78050daca2560af5">smooth_stroke_radius</a> == 1)
<a name="l12149"></a>12149                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a4527e8e14e477e793c46db01777c1ca2">smooth_stroke_factor</a>= 0.9f;
<a name="l12150"></a>12150 
<a name="l12151"></a>12151             <span class="comment">// same as dots</span>
<a name="l12152"></a>12152             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#acda87e5d0baba3a86b0fed2d3f5a13f4">rate</a> == 0)
<a name="l12153"></a>12153                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#acda87e5d0baba3a86b0fed2d3f5a13f4">rate</a> = 0.1f;
<a name="l12154"></a>12154 
<a name="l12155"></a>12155             <span class="comment">/* New Settings */</span>
<a name="l12156"></a>12156             <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 252 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 252 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 5)) {
<a name="l12157"></a>12157                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a45f7d9dd35234376f5d6822ed734f162">flag</a> |= <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a54ce80e56a089d8035b76a3071e3b0baa226d1c367c16acd4d07469b4f1f31304">BRUSH_SPACE_ATTEN</a>; <span class="comment">// explicitly enable adaptive space</span>
<a name="l12158"></a>12158 
<a name="l12159"></a>12159                 <span class="comment">// spacing was originally in pixels, convert it to percentage for new version</span>
<a name="l12160"></a>12160                 <span class="comment">// size should not be zero due to sanity check above</span>
<a name="l12161"></a>12161                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aad34a21e33c74412c20c9a20c5535424">spacing</a> = (int)(100*((<span class="keywordtype">float</span>)brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aad34a21e33c74412c20c9a20c5535424">spacing</a>) / ((float)brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a9cf9fcecab64b7e853066eb75d4c78d4">size</a>));
<a name="l12162"></a>12162 
<a name="l12163"></a>12163                 <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>[0] == 0 &amp;&amp;
<a name="l12164"></a>12164                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>[1] == 0 &amp;&amp;
<a name="l12165"></a>12165                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>[2] == 0)
<a name="l12166"></a>12166                 {
<a name="l12167"></a>12167                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>[0] = 1.00f;
<a name="l12168"></a>12168                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>[1] = 0.39f;
<a name="l12169"></a>12169                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>[2] = 0.39f;
<a name="l12170"></a>12170                 }
<a name="l12171"></a>12171 
<a name="l12172"></a>12172                 <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>[0] == 0 &amp;&amp;
<a name="l12173"></a>12173                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>[1] == 0 &amp;&amp;
<a name="l12174"></a>12174                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>[2] == 0)
<a name="l12175"></a>12175                 {
<a name="l12176"></a>12176                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>[0] = 0.39f;
<a name="l12177"></a>12177                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>[1] = 0.39f;
<a name="l12178"></a>12178                     brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>[2] = 1.00f;
<a name="l12179"></a>12179                 }
<a name="l12180"></a>12180             }
<a name="l12181"></a>12181         }
<a name="l12182"></a>12182     }
<a name="l12183"></a>12183 
<a name="l12184"></a>12184     <span class="comment">/* GSOC Sculpt 2010 - Sanity check on Sculpt/Paint settings */</span>
<a name="l12185"></a>12185     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 253) {
<a name="l12186"></a>12186         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l12187"></a>12187         <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12188"></a>12188             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;sculpt_paint_unified_alpha == 0)
<a name="l12189"></a>12189                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;sculpt_paint_unified_alpha = 0.5f;
<a name="l12190"></a>12190 
<a name="l12191"></a>12191             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;sculpt_paint_unified_unprojected_radius == 0) 
<a name="l12192"></a>12192                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;sculpt_paint_unified_unprojected_radius = 0.125f;
<a name="l12193"></a>12193 
<a name="l12194"></a>12194             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;sculpt_paint_unified_size == 0)
<a name="l12195"></a>12195                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;sculpt_paint_unified_size = 35;
<a name="l12196"></a>12196         }
<a name="l12197"></a>12197     }
<a name="l12198"></a>12198 
<a name="l12199"></a>12199     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 253 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 253 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1))
<a name="l12200"></a>12200         {
<a name="l12201"></a>12201             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12202"></a>12202 
<a name="l12203"></a>12203             <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12204"></a>12204                 <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l12205"></a>12205                 <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l12206"></a>12206                     <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a7a78843e9dd6590fafc9b7682e691ac5">eModifierType_Smoke</a>) {
<a name="l12207"></a>12207                         <a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *smd = (<a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *)md;
<a name="l12208"></a>12208 
<a name="l12209"></a>12209                         <span class="keywordflow">if</span> ((smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a88bed02ad1eb599ef628931fc9ab7973">MOD_SMOKE_TYPE_DOMAIN</a>) &amp;&amp; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>)
<a name="l12210"></a>12210                         {
<a name="l12211"></a>12211                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a30132738336e8048f4ac7134970033c3">vorticity</a> = 2.0f;
<a name="l12212"></a>12212                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a1dc0d941af97c9959c04e5cd6360e723">time_scale</a> = 1.0f;
<a name="l12213"></a>12213 
<a name="l12214"></a>12214                             <span class="keywordflow">if</span> (!(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#ad6dc6d0356b72929c29a660e36911940">flags</a> &amp; (1&lt;&lt;4)))
<a name="l12215"></a>12215                                 <span class="keywordflow">continue</span>;
<a name="l12216"></a>12216 
<a name="l12217"></a>12217                             <span class="comment">/* delete old MOD_SMOKE_INITVELOCITY flag */</span>
<a name="l12218"></a>12218                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#ad6dc6d0356b72929c29a660e36911940">flags</a> &amp;= ~(1&lt;&lt;4);
<a name="l12219"></a>12219 
<a name="l12220"></a>12220                             <span class="comment">/* for now just add it to all flow objects in the scene */</span>
<a name="l12221"></a>12221                             {
<a name="l12222"></a>12222                                 <a class="code" href="../../de/de7/structObject.html">Object</a> *ob2;
<a name="l12223"></a>12223                                 <span class="keywordflow">for</span> (ob2 = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob2; ob2 = ob2-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12224"></a>12224                                     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md2;
<a name="l12225"></a>12225                                     <span class="keywordflow">for</span> (md2= ob2-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md2; md2= md2-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l12226"></a>12226                                         <span class="keywordflow">if</span> (md2-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a7a78843e9dd6590fafc9b7682e691ac5">eModifierType_Smoke</a>) {
<a name="l12227"></a>12227                                             <a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *smd2 = (<a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *)md2;
<a name="l12228"></a>12228 
<a name="l12229"></a>12229                                             <span class="keywordflow">if</span> ((smd2-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a36fe9119d95e89e9f77fcca43030c798">MOD_SMOKE_TYPE_FLOW</a>) &amp;&amp; smd2-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>)
<a name="l12230"></a>12230                                             {
<a name="l12231"></a>12231                                                 smd2-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>-&gt;<a class="code" href="../../db/dbe/structSmokeFlowSettings.html#a5349c94914636882d2f36ce5cb5f0774">flags</a> |= <a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html#a3bbd917b3fcdad6e1e615dc562bf10e6">MOD_SMOKE_FLOW_INITVELOCITY</a>;
<a name="l12232"></a>12232                                             }
<a name="l12233"></a>12233                                         }
<a name="l12234"></a>12234                                     }
<a name="l12235"></a>12235                                 }
<a name="l12236"></a>12236                             }
<a name="l12237"></a>12237 
<a name="l12238"></a>12238                         }
<a name="l12239"></a>12239                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a36fe9119d95e89e9f77fcca43030c798">MOD_SMOKE_TYPE_FLOW</a>) &amp;&amp; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>) {
<a name="l12240"></a>12240                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>-&gt;<a class="code" href="../../db/dbe/structSmokeFlowSettings.html#a04e33b960f74b0b46ac2150460d35309">vel_multi</a> = 1.0f;
<a name="l12241"></a>12241                         }
<a name="l12242"></a>12242 
<a name="l12243"></a>12243                     }
<a name="l12244"></a>12244                 }
<a name="l12245"></a>12245             }
<a name="l12246"></a>12246         }
<a name="l12247"></a>12247 
<a name="l12248"></a>12248     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 255 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 255 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l12249"></a>12249         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *br;
<a name="l12250"></a>12250         <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l12251"></a>12251         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l12252"></a>12252         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12253"></a>12253 
<a name="l12254"></a>12254         <span class="keywordflow">for</span> (br= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; br; br= br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12255"></a>12255             <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a472884ac26c7633c6486940a4cf79089">ob_mode</a>==0)
<a name="l12256"></a>12256                 br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a472884ac26c7633c6486940a4cf79089">ob_mode</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a71c18d7335332f6a2fb10b7b1f9f94f5">OB_MODE_ALL_PAINT</a>;
<a name="l12257"></a>12257         }
<a name="l12258"></a>12258 
<a name="l12259"></a>12259         <span class="keywordflow">for</span> (part = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12260"></a>12260             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>)
<a name="l12261"></a>12261                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>-&gt;<a class="code" href="../../dd/d94/structBoidSettings.html#abdf77c107812978a379da19c8c847fa9">pitch</a> = 1.0f;
<a name="l12262"></a>12262 
<a name="l12263"></a>12263             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> &amp;= ~<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab03a4cb2c2c44efc04593c36d185c57e">PART_HAIR_REGROW</a>; <span class="comment">/* this was a deprecated flag before */</span>
<a name="l12264"></a>12264             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a016a18acd36a3292b6adcfab59610097">kink_amp_clump</a> = 1.f; <span class="comment">/* keep old files looking similar */</span>
<a name="l12265"></a>12265         }
<a name="l12266"></a>12266 
<a name="l12267"></a>12267         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12268"></a>12268             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l12269"></a>12269             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l12270"></a>12270                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l12271"></a>12271                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12272"></a>12272                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cafbebfeeb0fd0f7c61564dec31fe64450">SPACE_INFO</a>) {
<a name="l12273"></a>12273                         <a class="code" href="../../db/dbd/structSpaceInfo.html">SpaceInfo</a> *sinfo= (<a class="code" href="../../db/dbd/structSpaceInfo.html">SpaceInfo</a> *)sl;
<a name="l12274"></a>12274                         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l12275"></a>12275 
<a name="l12276"></a>12276                         sinfo-&gt;<a class="code" href="../../db/dbd/structSpaceInfo.html#abf3e117d68163d0a64e2bd22570e6ab7">rpt_mask</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a6739788b75165c40c5fa298fbd9c18bdaadafa8e347d5d52ed0c9c1b891213403">INFO_RPT_OP</a>;
<a name="l12277"></a>12277 
<a name="l12278"></a>12278                         <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l12279"></a>12279                             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l12280"></a>12280                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>);
<a name="l12281"></a>12281                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a9e75d9c4cc082bfcdca415b211bdae88">V2D_ALIGN_NO_NEG_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#adef4c229c91733757ad48327e398f168">V2D_ALIGN_NO_NEG_Y</a>; <span class="comment">/* align bottom left */</span>
<a name="l12282"></a>12282                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a> = <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a22443b88c8a284c1787a0b1240dfe459">V2D_LOCKOFS_X</a>;
<a name="l12283"></a>12283                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a> = (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa7b8eb523468a32a1cb67875982a36b0">V2D_LOCKZOOM_X</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a416c786300b905073b694af1e1a5110a">V2D_LOCKZOOM_Y</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a3344658e1cbe75ca187be39f1b34bb75">V2D_LIMITZOOM</a>|<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#aa366789f03a66ff87dadb3edec360b4b">V2D_KEEPASPECT</a>);
<a name="l12284"></a>12284                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a50dda81163a7de1fba335adcbe0c8995">keeptot</a>= <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a917431be204e5217aebe133e30ef961f">V2D_KEEPTOT_BOUNDS</a>;
<a name="l12285"></a>12285                                 ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= 1.0f;
<a name="l12286"></a>12286                             }
<a name="l12287"></a>12287                         }
<a name="l12288"></a>12288                     }
<a name="l12289"></a>12289                 }
<a name="l12290"></a>12290             }
<a name="l12291"></a>12291         }
<a name="l12292"></a>12292 
<a name="l12293"></a>12293         <span class="comment">/* fix rotation actuators for objects so they use real angles (radians)</span>
<a name="l12294"></a>12294 <span class="comment">         * since before blender went opensource this strange scalar was used: (1 / 0.02) * 2 * math.pi/360 */</span>
<a name="l12295"></a>12295         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12296"></a>12296             <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l12297"></a>12297             <span class="keywordflow">while</span> (act) {
<a name="l12298"></a>12298                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l12299"></a>12299                     <span class="comment">/* multiply velocity with 50 in old files */</span>
<a name="l12300"></a>12300                     <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l12301"></a>12301                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a0f40efe70da30ebfba49536ab936eea6">drot</a>, 0.8726646259971648f);
<a name="l12302"></a>12302                 }
<a name="l12303"></a>12303                 act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l12304"></a>12304             }
<a name="l12305"></a>12305         }
<a name="l12306"></a>12306     }
<a name="l12307"></a>12307     
<a name="l12308"></a>12308     <span class="comment">// init facing axis property of steering actuators</span>
<a name="l12309"></a>12309     {                   
<a name="l12310"></a>12310         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12311"></a>12311         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12312"></a>12312             <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l12313"></a>12313             <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l12314"></a>12314                 <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a68b54400142bd60b87940076e4d92471">ACT_STEERING</a>) {
<a name="l12315"></a>12315                     <a class="code" href="../../dc/dbe/structbSteeringActuator.html">bSteeringActuator</a>* stact = act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l12316"></a>12316                     <span class="keywordflow">if</span> (stact-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#ace2105076960660d1c2af9e2b68210f2">facingaxis</a>==0)
<a name="l12317"></a>12317                     {
<a name="l12318"></a>12318                         stact-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#ace2105076960660d1c2af9e2b68210f2">facingaxis</a>=1;
<a name="l12319"></a>12319                     }                       
<a name="l12320"></a>12320                 }
<a name="l12321"></a>12321             }
<a name="l12322"></a>12322         }
<a name="l12323"></a>12323     }
<a name="l12324"></a>12324 
<a name="l12325"></a>12325     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 255 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 255 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3)) {
<a name="l12326"></a>12326         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12327"></a>12327 
<a name="l12328"></a>12328         <span class="comment">/* ocean res is now squared, reset old ones - will be massive */</span>
<a name="l12329"></a>12329         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12330"></a>12330             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l12331"></a>12331             <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l12332"></a>12332                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a996bb95cdb69b90cf0b467d26acda2cf">eModifierType_Ocean</a>) {
<a name="l12333"></a>12333                     <a class="code" href="../../dd/da2/structOceanModifierData.html">OceanModifierData</a> *omd = (<a class="code" href="../../dd/da2/structOceanModifierData.html">OceanModifierData</a> *)md;
<a name="l12334"></a>12334                     omd-&gt;<a class="code" href="../../dd/da2/structOceanModifierData.html#aecc7a2d662068f684dc5bf274802d01d">resolution</a> = 7;
<a name="l12335"></a>12335                     omd-&gt;<a class="code" href="../../dd/da2/structOceanModifierData.html#a78587d758f8b21d9fdc1921152f2bb23">oceancache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l12336"></a>12336                 }
<a name="l12337"></a>12337             }
<a name="l12338"></a>12338         }       
<a name="l12339"></a>12339     }
<a name="l12340"></a>12340 
<a name="l12341"></a>12341     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 256) {
<a name="l12342"></a>12342         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l12343"></a>12343         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l12344"></a>12344         <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l12345"></a>12345         
<a name="l12346"></a>12346         <span class="comment">/* Fix for sample line scope initializing with no height */</span>
<a name="l12347"></a>12347         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12348"></a>12348             sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l12349"></a>12349             <span class="keywordflow">while</span> (sa) {
<a name="l12350"></a>12350                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l12351"></a>12351                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12352"></a>12352                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l12353"></a>12353                         <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l12354"></a>12354                         <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a940c07c5bd6e2e40e1476edd3b648bd2">sample_line_hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#aa745e9495c4fb8768c0f1bfb65415030">height</a> == 0 )
<a name="l12355"></a>12355                             sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a940c07c5bd6e2e40e1476edd3b648bd2">sample_line_hist</a>.<a class="code" href="../../d4/d8b/structHistogram.html#aa745e9495c4fb8768c0f1bfb65415030">height</a> = 100;
<a name="l12356"></a>12356                     }
<a name="l12357"></a>12357                 }
<a name="l12358"></a>12358                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l12359"></a>12359             }
<a name="l12360"></a>12360         }
<a name="l12361"></a>12361         
<a name="l12362"></a>12362         <span class="comment">/* old files could have been saved with slidermin = slidermax = 0.0, but the UI in</span>
<a name="l12363"></a>12363 <span class="comment">         * 2.4x would never reveal this to users as a dummy value always ended up getting used</span>
<a name="l12364"></a>12364 <span class="comment">         * instead</span>
<a name="l12365"></a>12365 <span class="comment">         */</span>
<a name="l12366"></a>12366         <span class="keywordflow">for</span> (key = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1194bb31422b5ad4cd169ea17a08c0a6">key</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; key; key = key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12367"></a>12367             <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l12368"></a>12368             
<a name="l12369"></a>12369             <span class="keywordflow">for</span> (kb = key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kb; kb = kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>) {
<a name="l12370"></a>12370                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#acc074658bb6b51cde503721347a81b33">IS_EQF</a>(kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a8e5b8c77a2cd0917bec223fe2c95700d">slidermin</a>, kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a6988c26f75f263effa622fcac6a2b618">slidermax</a>) &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa35a6894bca38a8ffb558c2c22a1eee1">IS_EQ</a>(kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a6988c26f75f263effa622fcac6a2b618">slidermax</a>, 0))
<a name="l12371"></a>12371                     kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a6988c26f75f263effa622fcac6a2b618">slidermax</a> = kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a8e5b8c77a2cd0917bec223fe2c95700d">slidermin</a> + 1.0f;
<a name="l12372"></a>12372             }
<a name="l12373"></a>12373         }
<a name="l12374"></a>12374     }
<a name="l12375"></a>12375     
<a name="l12376"></a>12376     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 256 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 256 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l12377"></a>12377         <span class="comment">/* fix for bones that didn&#39;t have arm_roll before */</span>
<a name="l12378"></a>12378         <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a>* arm;
<a name="l12379"></a>12379         <a class="code" href="../../de/de0/structBone.html">Bone</a>* bone;
<a name="l12380"></a>12380         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12381"></a>12381 
<a name="l12382"></a>12382         <span class="keywordflow">for</span> (arm = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; arm; arm = arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12383"></a>12383             <span class="keywordflow">for</span> (bone = arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bone; bone = bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>)
<a name="l12384"></a>12384                 <a class="code" href="../../d0/d12/readfile_8c.html#ac19d6baee72c183890b4d330242a011d">do_version_bone_roll_256</a>(bone);
<a name="l12385"></a>12385 
<a name="l12386"></a>12386         <span class="comment">/* fix for objects which have zero dquat&#39;s</span>
<a name="l12387"></a>12387 <span class="comment">         * since this is multiplied with the quat rather than added */</span>
<a name="l12388"></a>12388         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12389"></a>12389             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab8b0f0b00a0f7c97cf20d7d483a05add">is_zero_v4</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a340465bc2b585500eb421458bed679e9">dquat</a>)) {
<a name="l12390"></a>12390                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a66672ccf9e1308f3ba8c6b6f55fd2a8c">unit_qt</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a340465bc2b585500eb421458bed679e9">dquat</a>);
<a name="l12391"></a>12391             }
<a name="l12392"></a>12392             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a212d65c08323cdf9e10d72e1775e94c2">is_zero_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f017fd2769a1e68a10b48ba74630a15">drotAxis</a>) &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#abcb53c7498affb434c2fd0e91c35a4e1">drotAngle</a> == 0.0f) {
<a name="l12393"></a>12393                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#acceefe4ea6d15958a0e4e059c114b00e">unit_axis_angle</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f017fd2769a1e68a10b48ba74630a15">drotAxis</a>, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#abcb53c7498affb434c2fd0e91c35a4e1">drotAngle</a>);
<a name="l12394"></a>12394             }
<a name="l12395"></a>12395         }
<a name="l12396"></a>12396     }
<a name="l12397"></a>12397 
<a name="l12398"></a>12398     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 256 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 256 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l12399"></a>12399         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l12400"></a>12400         
<a name="l12401"></a>12401         <span class="comment">/* node sockets are not exposed automatically any more,</span>
<a name="l12402"></a>12402 <span class="comment">         * this mimics the old behavior by adding all unlinked sockets to groups.</span>
<a name="l12403"></a>12403 <span class="comment">         */</span>
<a name="l12404"></a>12404         <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12405"></a>12405             <span class="comment">/* XXX Only setting a flag here. Actual adding of group sockets</span>
<a name="l12406"></a>12406 <span class="comment">             * is done in lib_verify_nodetree, because at this point the internal</span>
<a name="l12407"></a>12407 <span class="comment">             * nodes may not be up-to-date! (missing lib-link)</span>
<a name="l12408"></a>12408 <span class="comment">             */</span>
<a name="l12409"></a>12409             ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af587a15172ef19a8790c18899a56e66d">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a14f17fb913f9c6a7ec0a9d481524650d">NTREE_DO_VERSIONS_GROUP_EXPOSE</a>;
<a name="l12410"></a>12410         }
<a name="l12411"></a>12411     }
<a name="l12412"></a>12412 
<a name="l12413"></a>12413     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 256 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 256 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt;3)) {
<a name="l12414"></a>12414         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l12415"></a>12415         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l12416"></a>12416         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12417"></a>12417         <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l12418"></a>12418         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat;
<a name="l12419"></a>12419         <span class="keywordtype">int</span> tex_nr, transp_tex;
<a name="l12420"></a>12420         
<a name="l12421"></a>12421         <span class="keywordflow">for</span> (mat = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; mat; mat = mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12422"></a>12422             <span class="keywordflow">if</span> (!(mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#ab93c6e013760ce505229d6c6686b1478">MA_TRANSP</a>) &amp;&amp; !(mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab2181c8ca6ce7ebdb8858702b9dd044c">material_type</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#adaea506ad43f2c01368fc0d3ac083baf">MA_TYPE_VOLUME</a>)) {
<a name="l12423"></a>12423                 
<a name="l12424"></a>12424                 transp_tex= 0;
<a name="l12425"></a>12425                 
<a name="l12426"></a>12426                 <span class="keywordflow">for</span> (tex_nr=0; tex_nr&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; tex_nr++) {
<a name="l12427"></a>12427                     <span class="keywordflow">if</span> (!mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[tex_nr]) <span class="keywordflow">continue</span>;
<a name="l12428"></a>12428                     <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[tex_nr]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa28e86f4cbc4330e5e8518b11dcfbc61">mapto</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a4d4d91166a52a89f90553ad91d3efd06">MAP_ALPHA</a>) transp_tex= 1;
<a name="l12429"></a>12429                 }
<a name="l12430"></a>12430 
<a name="l12431"></a>12431                 <span class="comment">/* weak! material alpha could be animated */</span>
<a name="l12432"></a>12432                 <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ac0f2eb80623ad884c7fa770e47ae92a2">alpha</a> &lt; 1.0f || mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ae4a30ec1f7d7d6e01e60c93be89bdf2c">fresnel_tra</a> &gt; 0.0f || transp_tex) {
<a name="l12433"></a>12433                     mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> |= <a class="code" href="../../de/db2/DNA__material__types_8h.html#ab93c6e013760ce505229d6c6686b1478">MA_TRANSP</a>;
<a name="l12434"></a>12434                     mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp;= ~(<a class="code" href="../../de/db2/DNA__material__types_8h.html#a582c0fe9d451f1c0ede8929648f9dd52">MA_ZTRANSP</a>|<a class="code" href="../../de/db2/DNA__material__types_8h.html#a2f301bfe492802b8461b969fc72b3652">MA_RAYTRANSP</a>);
<a name="l12435"></a>12435                 }
<a name="l12436"></a>12436             }
<a name="l12437"></a>12437         }
<a name="l12438"></a>12438 
<a name="l12439"></a>12439         <span class="comment">/* redraws flag in SpaceTime has been moved to Screen level */</span>
<a name="l12440"></a>12440         <span class="keywordflow">for</span> (sc = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12441"></a>12441             <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe1a5457dd4e28f0ead11527da733c5d">redraws_flag</a> == 0) {
<a name="l12442"></a>12442                 <span class="comment">/* just initialize to default? */</span>
<a name="l12443"></a>12443                 <span class="comment">// XXX: we could also have iterated through areas, and taken them from the first timeline available...</span>
<a name="l12444"></a>12444                 sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe1a5457dd4e28f0ead11527da733c5d">redraws_flag</a> = <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a51e924d3814926d33e77fd7d911c8f3f">TIME_ALL_3D_WIN</a>|<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a6ef6dfba4f1fd8a63ff156505056e953">TIME_ALL_ANIM_WIN</a>;
<a name="l12445"></a>12445             }
<a name="l12446"></a>12446         }
<a name="l12447"></a>12447 
<a name="l12448"></a>12448         <span class="keywordflow">for</span> (brush= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12449"></a>12449             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aa2380afd398456143fac81f913c39e36">height</a> == 0)
<a name="l12450"></a>12450                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#aa2380afd398456143fac81f913c39e36">height</a>= 0.4f;
<a name="l12451"></a>12451         }
<a name="l12452"></a>12452 
<a name="l12453"></a>12453         <span class="comment">/* replace &#39;rim material&#39; option for in offset*/</span>
<a name="l12454"></a>12454         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12455"></a>12455             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l12456"></a>12456             <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l12457"></a>12457                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a17ce6867a3076ac703e9559879672879">eModifierType_Solidify</a>) {
<a name="l12458"></a>12458                     <a class="code" href="../../d8/d49/structSolidifyModifierData.html">SolidifyModifierData</a> *smd = (<a class="code" href="../../d8/d49/structSolidifyModifierData.html">SolidifyModifierData</a> *)md;
<a name="l12459"></a>12459                     <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d8/d49/structSolidifyModifierData.html#adbd2ef41d5c99a84d52e5fecd8964017">flag</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#aacac9499815356da51f7ea63ca23b04f">MOD_SOLIDIFY_RIM_MATERIAL</a>) {
<a name="l12460"></a>12460                         smd-&gt;<a class="code" href="../../d8/d49/structSolidifyModifierData.html#a131443db69d4eedf72eedbfdcba4b5ae">mat_ofs_rim</a>= 1;
<a name="l12461"></a>12461                         smd-&gt;<a class="code" href="../../d8/d49/structSolidifyModifierData.html#adbd2ef41d5c99a84d52e5fecd8964017">flag</a> &amp;= ~<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#aacac9499815356da51f7ea63ca23b04f">MOD_SOLIDIFY_RIM_MATERIAL</a>;
<a name="l12462"></a>12462                     }
<a name="l12463"></a>12463                 }
<a name="l12464"></a>12464             }
<a name="l12465"></a>12465         }
<a name="l12466"></a>12466 
<a name="l12467"></a>12467         <span class="comment">/* particle draw color from material */</span>
<a name="l12468"></a>12468         <span class="keywordflow">for</span> (part = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12469"></a>12469             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#abae82709b04ba97632607f9afdd2b9a8">PART_DRAW_MAT_COL</a>)
<a name="l12470"></a>12470                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>;
<a name="l12471"></a>12471         }
<a name="l12472"></a>12472     }
<a name="l12473"></a>12473 
<a name="l12474"></a>12474     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 256 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 256 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 6)) {
<a name="l12475"></a>12475         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l12476"></a>12476 
<a name="l12477"></a>12477         <span class="keywordflow">for</span> (me= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12478"></a>12478             <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a19b001a7d763c08b54cc47eaa8234f27">mesh_calc_normals_tessface</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l12479"></a>12479     }
<a name="l12480"></a>12480 
<a name="l12481"></a>12481     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 256 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 256 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l12482"></a>12482         <span class="comment">/* update blur area sizes from 0..1 range to 0..100 percentage */</span>
<a name="l12483"></a>12483         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l12484"></a>12484         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l12485"></a>12485         <span class="keywordflow">for</span> (scene=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12486"></a>12486             <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l12487"></a>12487                 <span class="keywordflow">for</span> (node=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l12488"></a>12488                     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ae837dcd1a79a0a74c588e72a263f8171">CMP_NODE_BLUR</a>) {
<a name="l12489"></a>12489                         <a class="code" href="../../d4/d1a/structNodeBlurData.html">NodeBlurData</a> *nbd= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>;
<a name="l12490"></a>12490                         nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#a9bfcd644d68daebffbb517f172b9a76e">percentx</a> *= 100.0f;
<a name="l12491"></a>12491                         nbd-&gt;<a class="code" href="../../d4/d1a/structNodeBlurData.html#ac48415b7e218754173848413e4936a32">percenty</a> *= 100.0f;
<a name="l12492"></a>12492                     }
<a name="l12493"></a>12493     }
<a name="l12494"></a>12494 
<a name="l12495"></a>12495     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 258 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 258 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l12496"></a>12496         <span class="comment">/* screen view2d settings were not properly initialized [#27164]</span>
<a name="l12497"></a>12497 <span class="comment">         * v2d-&gt;scroll caused the bug but best reset other values too which are in old blend files only.</span>
<a name="l12498"></a>12498 <span class="comment">         * need to make less ugly - possibly an iterator? */</span>
<a name="l12499"></a>12499         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l12500"></a>12500         <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12501"></a>12501             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l12502"></a>12502             <span class="comment">/* add regions */</span>
<a name="l12503"></a>12503             <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l12504"></a>12504                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l12505"></a>12505                 <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l12506"></a>12506                     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l12507"></a>12507                     <span class="keywordflow">for</span> (ar=sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l12508"></a>12508                         <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l12509"></a>12509                             <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l12510"></a>12510                             v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50dda81163a7de1fba335adcbe0c8995">keeptot</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a>= 0;
<a name="l12511"></a>12511                         }
<a name="l12512"></a>12512                     }
<a name="l12513"></a>12513                 }
<a name="l12514"></a>12514                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12515"></a>12515                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l12516"></a>12516                         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l12517"></a>12517                         <span class="keywordflow">for</span> (ar=sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l12518"></a>12518                             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l12519"></a>12519                                 <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l12520"></a>12520                                 v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a1a1ba55633a9d85b181502f2a178fa37">minzoom</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#acdbd3411c9a6e58974968ca4e3ecd34b">maxzoom</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50dda81163a7de1fba335adcbe0c8995">keeptot</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a7120051e48d53727c374ffbe433f9802">keepzoom</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a8212f2963082b37388fce9225ea5d041">keepofs</a>= v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a50d8ffdaa4d99eb1c33ba22e22970996">align</a>= 0;
<a name="l12521"></a>12521                             }
<a name="l12522"></a>12522                         }
<a name="l12523"></a>12523                     }
<a name="l12524"></a>12524                 }
<a name="l12525"></a>12525             }
<a name="l12526"></a>12526         }
<a name="l12527"></a>12527 
<a name="l12528"></a>12528         {
<a name="l12529"></a>12529             <span class="comment">/* Initialize texture point density curve falloff */</span>
<a name="l12530"></a>12530             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l12531"></a>12531             <span class="keywordflow">for</span> (tex= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12532"></a>12532                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>) {
<a name="l12533"></a>12533                     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a12015ed70392980f98424265007ff561">falloff_speed_scale</a> == 0.0f)
<a name="l12534"></a>12534                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a12015ed70392980f98424265007ff561">falloff_speed_scale</a> = 100.0f;
<a name="l12535"></a>12535                     
<a name="l12536"></a>12536                     <span class="keywordflow">if</span> (!tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>) {
<a name="l12537"></a>12537                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a> = <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a0fe6bbbc391a99f155add4272972ba6d">curvemapping_add</a>(1, 0, 0, 1, 1);
<a name="l12538"></a>12538                         
<a name="l12539"></a>12539                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a799bee38fb167d41e7ff198e86e359f5">preset</a> = <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a6dd78cb24fdca0792ce9e05b433409ceab43f7b14706115e66df1ba82ad101cc0">CURVE_PRESET_LINE</a>;
<a name="l12540"></a>12540                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>-&gt;<a class="code" href="../../df/d78/structCurveMap.html#ab8bdb4a30d4ac21edb9c7f0fe4784c9c">flag</a> &amp;= ~<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a53e0b7a779b29f4940c4eae3fd37ad8d">CUMA_EXTEND_EXTRAPOLATE</a>;
<a name="l12541"></a>12541                         <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ac3ec3c6480f50624abef2aa621aba9b1">curvemap_reset</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>, &amp;tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a799bee38fb167d41e7ff198e86e359f5">preset</a>, <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a3f661a1286c9eae498b8e25041407840">CURVEMAP_SLOPE_POSITIVE</a>);
<a name="l12542"></a>12542                         <a class="code" href="../../d4/dca/BKE__colortools_8h.html#af77727c97a9f13c114da3e7dc320f41e">curvemapping_changed</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>, 0);
<a name="l12543"></a>12543                     }
<a name="l12544"></a>12544                 }
<a name="l12545"></a>12545             }
<a name="l12546"></a>12546         }
<a name="l12547"></a>12547 
<a name="l12548"></a>12548         {
<a name="l12549"></a>12549             <span class="comment">/* add default value for behind strength of camera actuator */</span>
<a name="l12550"></a>12550             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12551"></a>12551             <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l12552"></a>12552             <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12553"></a>12553                 <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l12554"></a>12554                     <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ad0a80e945d2f9f52b83f903c6f0a8bcd">ACT_CAMERA</a>) {
<a name="l12555"></a>12555                         <a class="code" href="../../d3/d76/structbCameraActuator.html">bCameraActuator</a> *ba= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l12556"></a>12556 
<a name="l12557"></a>12557                         ba-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#ae48b4bcec0a8f915245cea4b90960c9e">damping</a> = 1.0/32.0;
<a name="l12558"></a>12558                     }
<a name="l12559"></a>12559                 }
<a name="l12560"></a>12560             }
<a name="l12561"></a>12561         }
<a name="l12562"></a>12562 
<a name="l12563"></a>12563         {
<a name="l12564"></a>12564             <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l12565"></a>12565             <span class="keywordflow">for</span> (part = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12566"></a>12566                 <span class="comment">/* Initialize particle billboard scale */</span>
<a name="l12567"></a>12567                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[0] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[1] = 1.0f;
<a name="l12568"></a>12568             }
<a name="l12569"></a>12569         }
<a name="l12570"></a>12570     }
<a name="l12571"></a>12571 
<a name="l12572"></a>12572     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 259 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 259 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l12573"></a>12573         {
<a name="l12574"></a>12574             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l12575"></a>12575             <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l12576"></a>12576 
<a name="l12577"></a>12577             <span class="keywordflow">for</span> (scene=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12578"></a>12578             {
<a name="l12579"></a>12579                 scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#af3224addac00d2e3542afe1610190887">audio_channels</a> = 2;
<a name="l12580"></a>12580                 scene-&gt;<a class="code" href="../../d9/d27/structScene.html#af91931f1ea3f417f2d9ffba420e7290c">audio</a>.<a class="code" href="../../df/de3/structAudioData.html#aab3bbf20b589d1bad05b40ddcb5a10f9">volume</a> = 1.0f;
<a name="l12581"></a>12581                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l12582"></a>12582                     seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a295ec984969c6c3a15ef4068089e9a1b">pitch</a> = 1.0f;
<a name="l12583"></a>12583                 }
<a name="l12584"></a>12584                 <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l12585"></a>12585             }
<a name="l12586"></a>12586         }
<a name="l12587"></a>12587         {
<a name="l12588"></a>12588             <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l12589"></a>12589             <span class="keywordflow">for</span> (screen= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; screen; screen= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12590"></a>12590                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l12591"></a>12591                 <span class="comment">/* add regions */</span>
<a name="l12592"></a>12592                 <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l12593"></a>12593                     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l12594"></a>12594                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l12595"></a>12595                         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l12596"></a>12596                         <span class="keywordflow">for</span> (ar=sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l12597"></a>12597                             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l12598"></a>12598                                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1] == 4.0f)
<a name="l12599"></a>12599                                     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1]= 0.5f;
<a name="l12600"></a>12600                             }
<a name="l12601"></a>12601                         }
<a name="l12602"></a>12602                     }
<a name="l12603"></a>12603                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12604"></a>12604                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l12605"></a>12605                             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l12606"></a>12606                             <span class="keywordflow">for</span> (ar=sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l12607"></a>12607                                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l12608"></a>12608                                     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1] == 4.0f)
<a name="l12609"></a>12609                                         ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a96a43b547870b3286817360d609cb43e">min</a>[1]= 0.5f;
<a name="l12610"></a>12610                                 }
<a name="l12611"></a>12611                             }
<a name="l12612"></a>12612                         }
<a name="l12613"></a>12613                     }
<a name="l12614"></a>12614                 }
<a name="l12615"></a>12615             }
<a name="l12616"></a>12616         }
<a name="l12617"></a>12617         {
<a name="l12618"></a>12618             <span class="comment">/* Make &quot;auto-clamped&quot; handles a per-keyframe setting instead of per-FCurve </span>
<a name="l12619"></a>12619 <span class="comment">             *</span>
<a name="l12620"></a>12620 <span class="comment">             * We&#39;re only patching F-Curves in Actions here, since it is assumed that most</span>
<a name="l12621"></a>12621 <span class="comment">             * drivers out there won&#39;t be using this (and if they are, they&#39;re in the minority).</span>
<a name="l12622"></a>12622 <span class="comment">             * While we should aim to fix everything ideally, in practice it&#39;s far too hard</span>
<a name="l12623"></a>12623 <span class="comment">             * to get to every animdata block, not to mention the performance hit that&#39;d have</span>
<a name="l12624"></a>12624 <span class="comment">             */</span>
<a name="l12625"></a>12625             <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act;
<a name="l12626"></a>12626             <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l12627"></a>12627             
<a name="l12628"></a>12628             <span class="keywordflow">for</span> (act = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a672d2abaa0d861f3a2d938549cbe212b">action</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act = act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12629"></a>12629                 <span class="keywordflow">for</span> (fcu = act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu = fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l12630"></a>12630                     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l12631"></a>12631                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l12632"></a>12632                     
<a name="l12633"></a>12633                     <span class="comment">/* only need to touch curves that had this flag set */</span>
<a name="l12634"></a>12634                     <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a3b6319466e88b2fe1564ccf6de4ad8f1">FCURVE_AUTO_HANDLES</a>) == 0)
<a name="l12635"></a>12635                         <span class="keywordflow">continue</span>;
<a name="l12636"></a>12636                     <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a> == 0) || (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l12637"></a>12637                         <span class="keywordflow">continue</span>;
<a name="l12638"></a>12638                         
<a name="l12639"></a>12639                     <span class="comment">/* only change auto-handles to auto-clamped */</span>
<a name="l12640"></a>12640                     <span class="keywordflow">for</span> (bezt=fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>; i &lt; fcu-&gt;totvert; i++, bezt++) {
<a name="l12641"></a>12641                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>;
<a name="l12642"></a>12642                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>;
<a name="l12643"></a>12643                     }
<a name="l12644"></a>12644                     
<a name="l12645"></a>12645                     fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> &amp;= ~<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a3b6319466e88b2fe1564ccf6de4ad8f1">FCURVE_AUTO_HANDLES</a>;
<a name="l12646"></a>12646                 }
<a name="l12647"></a>12647             }
<a name="l12648"></a>12648         }
<a name="l12649"></a>12649         {
<a name="l12650"></a>12650             <span class="comment">/* convert fcurve and shape action actuators to action actuators */</span>
<a name="l12651"></a>12651             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12652"></a>12652             <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l12653"></a>12653             <a class="code" href="../../d1/d86/structbIpoActuator.html">bIpoActuator</a> *ia;
<a name="l12654"></a>12654             <a class="code" href="../../d6/d15/structbActionActuator.html">bActionActuator</a> *aa;
<a name="l12655"></a>12655 
<a name="l12656"></a>12656             <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12657"></a>12657                 <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l12658"></a>12658                     <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a548a3bb674b346430996bd2431126833">ACT_IPO</a>) {
<a name="l12659"></a>12659                         <span class="comment">// Create the new actuator</span>
<a name="l12660"></a>12660                         ia= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l12661"></a>12661                         aa= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d15/structbActionActuator.html">bActionActuator</a>), <span class="stringliteral">&quot;fcurve -&gt; action actuator do_version&quot;</span>);
<a name="l12662"></a>12662 
<a name="l12663"></a>12663                         <span class="comment">// Copy values</span>
<a name="l12664"></a>12664                         aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#abd21d9a46005f2a863f93d6ec8bb665d">type</a> = ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#ab87205c10a80d10af8b8ff59feecdc0c">type</a>;
<a name="l12665"></a>12665                         aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#ae3e8a97e6a1bfb7b0100dbb4b30b820e">flag</a> = ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#a01701e5e0a561b8a9be84907c8c9b506">flag</a>;
<a name="l12666"></a>12666                         aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a508f56339b46f1d3fc63d0b81d88106a">sta</a> = ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#a520a7148b6e247d6993d77feb1304f24">sta</a>;
<a name="l12667"></a>12667                         aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a841ec9afe9c2c3833984663831f552f9">end</a> = ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#a5e423dda640fe6d2d117db56275af7ff">end</a>;
<a name="l12668"></a>12668                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#af3fe32566122fb85c12815de94c289bd">name</a>, ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#a71979f0c1b6fb85f2874411a13c267a7">name</a>, <span class="keyword">sizeof</span>(aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#af3fe32566122fb85c12815de94c289bd">name</a>));
<a name="l12669"></a>12669                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#af1d1bfee8af9a1f671d6630a0ae8b48e">frameProp</a>, ia-&gt;<a class="code" href="../../d1/d86/structbIpoActuator.html#a0d359c0c01f51e6766c35eb99588cd41">frameProp</a>, <span class="keyword">sizeof</span>(aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#af1d1bfee8af9a1f671d6630a0ae8b48e">frameProp</a>));
<a name="l12670"></a>12670                         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)
<a name="l12671"></a>12671                             aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a> = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l12672"></a>12672 
<a name="l12673"></a>12673                         <span class="comment">// Get rid of the old actuator</span>
<a name="l12674"></a>12674                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ia);
<a name="l12675"></a>12675 
<a name="l12676"></a>12676                         <span class="comment">// Assign the new actuator</span>
<a name="l12677"></a>12677                         act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a> = aa;
<a name="l12678"></a>12678                         act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a3110f376c5613124c3ae2fba8e48bf54">otype</a>= <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a64df7df8bf7e040450f186a4ac9c3753">ACT_ACTION</a>;
<a name="l12679"></a>12679                         
<a name="l12680"></a>12680                     }
<a name="l12681"></a>12681                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af3367e7ebe5e98e65421b9a957c6ccb8">ACT_SHAPEACTION</a>) {
<a name="l12682"></a>12682                         act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> = act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a3110f376c5613124c3ae2fba8e48bf54">otype</a> = <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a64df7df8bf7e040450f186a4ac9c3753">ACT_ACTION</a>;
<a name="l12683"></a>12683                     }
<a name="l12684"></a>12684                 }
<a name="l12685"></a>12685             }
<a name="l12686"></a>12686         }
<a name="l12687"></a>12687     }
<a name="l12688"></a>12688 
<a name="l12689"></a>12689     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 259 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 259 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l12690"></a>12690         {
<a name="l12691"></a>12691             <span class="comment">/* Convert default socket values from bNodeStack */</span>
<a name="l12692"></a>12692             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l12693"></a>12693             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat;
<a name="l12694"></a>12694             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l12695"></a>12695             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l12696"></a>12696             <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12697"></a>12697                 <a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">do_versions_nodetree_default_value</a>(ntree);
<a name="l12698"></a>12698                 ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa9f2cec5015fe968da62576381bf2920">NTREE_UPDATE</a>;
<a name="l12699"></a>12699             }
<a name="l12700"></a>12700             <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12701"></a>12701                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l12702"></a>12702                 <a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">do_versions_nodetree_default_value</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l12703"></a>12703                 sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa9f2cec5015fe968da62576381bf2920">NTREE_UPDATE</a>;
<a name="l12704"></a>12704             }
<a name="l12705"></a>12705             <span class="keywordflow">for</span> (mat=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; mat; mat=mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12706"></a>12706                 <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>) {
<a name="l12707"></a>12707                 <a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">do_versions_nodetree_default_value</a>(mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l12708"></a>12708                 mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa9f2cec5015fe968da62576381bf2920">NTREE_UPDATE</a>;
<a name="l12709"></a>12709             }
<a name="l12710"></a>12710             <span class="keywordflow">for</span> (tex=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex=tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12711"></a>12711                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>) {
<a name="l12712"></a>12712                 <a class="code" href="../../d0/d12/readfile_8c.html#a26f4ce81ac4dc11655ca7409a29055b7">do_versions_nodetree_default_value</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l12713"></a>12713                 tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa9f2cec5015fe968da62576381bf2920">NTREE_UPDATE</a>;
<a name="l12714"></a>12714             }
<a name="l12715"></a>12715         }
<a name="l12716"></a>12716 
<a name="l12717"></a>12717         <span class="comment">/* add SOCK_DYNAMIC flag to existing group sockets */</span>
<a name="l12718"></a>12718         {
<a name="l12719"></a>12719             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l12720"></a>12720             <span class="comment">/* only need to do this for trees in main, local trees are not used as groups */</span>
<a name="l12721"></a>12721             <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12722"></a>12722                 <a class="code" href="../../d0/d12/readfile_8c.html#ab0ed6adc3cd60d5603ff3282d2b525ae">do_versions_nodetree_dynamic_sockets</a>(ntree);
<a name="l12723"></a>12723                 ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa9f2cec5015fe968da62576381bf2920">NTREE_UPDATE</a>;
<a name="l12724"></a>12724             }
<a name="l12725"></a>12725         }
<a name="l12726"></a>12726 
<a name="l12727"></a>12727         {
<a name="l12728"></a>12728             <span class="comment">/* Initialize group tree nodetypes.</span>
<a name="l12729"></a>12729 <span class="comment">             * These are used to distinguish tree types and</span>
<a name="l12730"></a>12730 <span class="comment">             * associate them with specific node types for polling.</span>
<a name="l12731"></a>12731 <span class="comment">             */</span>
<a name="l12732"></a>12732             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l12733"></a>12733             <span class="comment">/* all node trees in main-&gt;nodetree are considered groups */</span>
<a name="l12734"></a>12734             <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12735"></a>12735                 ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae174135c0568adeb8a45d7697ae378a9">nodetype</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>;
<a name="l12736"></a>12736         }
<a name="l12737"></a>12737     }
<a name="l12738"></a>12738 
<a name="l12739"></a>12739     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 259 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 259 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4)) {
<a name="l12740"></a>12740         {
<a name="l12741"></a>12741             <span class="comment">/* Adaptive time step for particle systems */</span>
<a name="l12742"></a>12742             <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l12743"></a>12743             <span class="keywordflow">for</span> (part = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12744"></a>12744                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a3a5e7f67257c4c73091d2b35fef9751e">courant_target</a> = 0.2f;
<a name="l12745"></a>12745                 part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a87b70b67957deff5879733ebe0199189">time_flag</a> &amp;= ~<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a3668a7bcb08c9f9af95dd5a2d4b1867b">PART_TIME_AUTOSF</a>;
<a name="l12746"></a>12746             }
<a name="l12747"></a>12747         }
<a name="l12748"></a>12748 
<a name="l12749"></a>12749         {
<a name="l12750"></a>12750             <span class="comment">/* set defaults for obstacle avoidance, recast data */</span>
<a name="l12751"></a>12751             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l12752"></a>12752             <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12753"></a>12753             {
<a name="l12754"></a>12754                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6615b32747780b4b9df427eb68c19598">levelHeight</a> == 0.f)
<a name="l12755"></a>12755                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6615b32747780b4b9df427eb68c19598">levelHeight</a> = 2.f;
<a name="l12756"></a>12756 
<a name="l12757"></a>12757                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a557011423b10a07a47a0691b796a10c3">cellsize</a> == 0.0f)
<a name="l12758"></a>12758                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a557011423b10a07a47a0691b796a10c3">cellsize</a> = 0.3f;
<a name="l12759"></a>12759                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a6fc3b4a44beceb190b25cf8ee3e86ba9">cellheight</a> == 0.0f)
<a name="l12760"></a>12760                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a6fc3b4a44beceb190b25cf8ee3e86ba9">cellheight</a> = 0.2f;
<a name="l12761"></a>12761                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a68e56b4e9ff853c197de09eb55555abe">agentmaxslope</a> == 0.0f)
<a name="l12762"></a>12762                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a68e56b4e9ff853c197de09eb55555abe">agentmaxslope</a> = (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/4;
<a name="l12763"></a>12763                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#ad56fb5609b01454ed2132b7827a029f5">agentmaxclimb</a> == 0.0f)
<a name="l12764"></a>12764                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#ad56fb5609b01454ed2132b7827a029f5">agentmaxclimb</a> = 0.9f;
<a name="l12765"></a>12765                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a8758e27b8b0554e397060f147f93ef9e">agentheight</a> == 0.0f)
<a name="l12766"></a>12766                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a8758e27b8b0554e397060f147f93ef9e">agentheight</a> = 2.0f;
<a name="l12767"></a>12767                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#adcf0151569e354b09978eb8d39fbda60">agentradius</a> == 0.0f)
<a name="l12768"></a>12768                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#adcf0151569e354b09978eb8d39fbda60">agentradius</a> = 0.6f;
<a name="l12769"></a>12769                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#aadfa23f1ac3507ab60553f6cdd7d03cd">edgemaxlen</a> == 0.0f)
<a name="l12770"></a>12770                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#aadfa23f1ac3507ab60553f6cdd7d03cd">edgemaxlen</a> = 12.0f;
<a name="l12771"></a>12771                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a6b61f6bbfa2c13779c77f3d8788180b6">edgemaxerror</a> == 0.0f)
<a name="l12772"></a>12772                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a6b61f6bbfa2c13779c77f3d8788180b6">edgemaxerror</a> = 1.3f;
<a name="l12773"></a>12773                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#aed5b8f65e5e95ca13d05b994c975ab5b">regionminsize</a> == 0.0f)
<a name="l12774"></a>12774                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#aed5b8f65e5e95ca13d05b994c975ab5b">regionminsize</a> = 8.f;
<a name="l12775"></a>12775                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#abd9df987166e04ff7b8a87a70ccd7a34">regionmergesize</a> == 0.0f)
<a name="l12776"></a>12776                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#abd9df987166e04ff7b8a87a70ccd7a34">regionmergesize</a> = 20.f;
<a name="l12777"></a>12777                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a8accd2f8c9b77cba85d57761f872427c">vertsperpoly</a>&lt;3)
<a name="l12778"></a>12778                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a8accd2f8c9b77cba85d57761f872427c">vertsperpoly</a> = 6;
<a name="l12779"></a>12779                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a845f3ef148b50246c2ffb51f0910b2f7">detailsampledist</a> == 0.0f)
<a name="l12780"></a>12780                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a845f3ef148b50246c2ffb51f0910b2f7">detailsampledist</a> = 6.0f;
<a name="l12781"></a>12781                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a2fb6d1d4a67537eb536128e14209a8df">detailsamplemaxerror</a> == 0.0f)
<a name="l12782"></a>12782                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a1d6d95b75f5fc8e765f8715043424074">recastData</a>.<a class="code" href="../../d3/de4/structRecastData.html#a2fb6d1d4a67537eb536128e14209a8df">detailsamplemaxerror</a> = 1.0f;
<a name="l12783"></a>12783             }
<a name="l12784"></a>12784         }
<a name="l12785"></a>12785     }
<a name="l12786"></a>12786 
<a name="l12787"></a>12787     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 260) {
<a name="l12788"></a>12788         {
<a name="l12789"></a>12789             <span class="comment">/* set default alpha value of Image outputs in image and render layer nodes to 0 */</span>
<a name="l12790"></a>12790             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l12791"></a>12791             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l12792"></a>12792             
<a name="l12793"></a>12793             <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12794"></a>12794                 <span class="comment">/* there are files with invalid audio_channels value, the real cause</span>
<a name="l12795"></a>12795 <span class="comment">                 * is unknown, but we fix it here anyway to avoid crashes */</span>
<a name="l12796"></a>12796                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#af3224addac00d2e3542afe1610190887">audio_channels</a> == 0)
<a name="l12797"></a>12797                     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#af3224addac00d2e3542afe1610190887">audio_channels</a> = 2;
<a name="l12798"></a>12798 
<a name="l12799"></a>12799                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l12800"></a>12800                     <a class="code" href="../../d0/d12/readfile_8c.html#abda6d5229171184c482c266991b5b2c0">do_versions_nodetree_image_default_alpha_output</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l12801"></a>12801             }
<a name="l12802"></a>12802 
<a name="l12803"></a>12803             <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12804"></a>12804                 <a class="code" href="../../d0/d12/readfile_8c.html#abda6d5229171184c482c266991b5b2c0">do_versions_nodetree_image_default_alpha_output</a>(ntree);
<a name="l12805"></a>12805         }
<a name="l12806"></a>12806 
<a name="l12807"></a>12807         {
<a name="l12808"></a>12808             <span class="comment">/* support old particle dupliobject rotation settings */</span>
<a name="l12809"></a>12809             <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l12810"></a>12810 
<a name="l12811"></a>12811             <span class="keywordflow">for</span> (part=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part=part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12812"></a>12812                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a>, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a2506fdc9f159583f812c900402c5ec54">PART_DRAW_OB</a>, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ababc8a40b78ea25bfdb9cd7b85c83f19">PART_DRAW_GR</a>)) {
<a name="l12813"></a>12813                     part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a507c06cacf2b86a049d2ca5b0fd12521">PART_DRAW_ROTATE_OB</a>;
<a name="l12814"></a>12814 
<a name="l12815"></a>12815                     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad27b4fdd7271a1de7e2fe38051c3ca44">rotmode</a> == 0)
<a name="l12816"></a>12816                         part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad27b4fdd7271a1de7e2fe38051c3ca44">rotmode</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#acf117996b37af9e17bc18dca3e09b6ea">PART_ROT_VEL</a>;
<a name="l12817"></a>12817                 }
<a name="l12818"></a>12818             }
<a name="l12819"></a>12819         }
<a name="l12820"></a>12820     }
<a name="l12821"></a>12821 
<a name="l12822"></a>12822     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 260 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 260 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1)) {
<a name="l12823"></a>12823         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12824"></a>12824 
<a name="l12825"></a>12825         <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12826"></a>12826             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a16dc75c68bc6868b924999fea2e85183">collision_boundtype</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>;
<a name="l12827"></a>12827         }
<a name="l12828"></a>12828 
<a name="l12829"></a>12829         {
<a name="l12830"></a>12830             <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam;
<a name="l12831"></a>12831             <span class="keywordflow">for</span> (cam= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a331d71d4f599b49bb6b38e48b7cfc7bf">camera</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cam; cam= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12832"></a>12832                 <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#acdf39c5ffbd9b9363fd230256a6a5bef">sensor_x</a> &lt; 0.01f)
<a name="l12833"></a>12833                     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#acdf39c5ffbd9b9363fd230256a6a5bef">sensor_x</a> = <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#ace9c8f3f81ece0fc989dae8302a2911c">DEFAULT_SENSOR_WIDTH</a>;
<a name="l12834"></a>12834 
<a name="l12835"></a>12835                 <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a18c42686b5afa4583d29abdf269d2948">sensor_y</a> &lt; 0.01f)
<a name="l12836"></a>12836                     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a18c42686b5afa4583d29abdf269d2948">sensor_y</a> = <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a3725d1d157899ccaf49920dc3c8addc3">DEFAULT_SENSOR_HEIGHT</a>;
<a name="l12837"></a>12837             }
<a name="l12838"></a>12838         }
<a name="l12839"></a>12839     }
<a name="l12840"></a>12840 
<a name="l12841"></a>12841     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 260 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 260 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2)) {
<a name="l12842"></a>12842         <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *ntreetype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>);
<a name="l12843"></a>12843 
<a name="l12844"></a>12844         <span class="keywordflow">if</span> (ntreetype &amp;&amp; ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>)
<a name="l12845"></a>12845             ntreetype-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(main, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d0/d12/readfile_8c.html#aa095408a76ff6e72c3ada1e414c11986">do_version_ntree_tex_mapping_260</a>);
<a name="l12846"></a>12846     }
<a name="l12847"></a>12847 
<a name="l12848"></a>12848     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 260 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 260 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4)) {
<a name="l12849"></a>12849         {
<a name="l12850"></a>12850             <span class="comment">/* Convert node angles to radians! */</span>
<a name="l12851"></a>12851             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l12852"></a>12852             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat;
<a name="l12853"></a>12853             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l12854"></a>12854 
<a name="l12855"></a>12855             <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12856"></a>12856                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l12857"></a>12857                     <a class="code" href="../../d0/d12/readfile_8c.html#a3852583c1310fc61c08b71294ed760f4">do_versions_nodetree_convert_angle</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l12858"></a>12858             }
<a name="l12859"></a>12859 
<a name="l12860"></a>12860             <span class="keywordflow">for</span> (mat=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; mat; mat=mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12861"></a>12861                 <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l12862"></a>12862                     <a class="code" href="../../d0/d12/readfile_8c.html#a3852583c1310fc61c08b71294ed760f4">do_versions_nodetree_convert_angle</a>(mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l12863"></a>12863             }
<a name="l12864"></a>12864 
<a name="l12865"></a>12865             <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l12866"></a>12866                 <a class="code" href="../../d0/d12/readfile_8c.html#a3852583c1310fc61c08b71294ed760f4">do_versions_nodetree_convert_angle</a>(ntree);
<a name="l12867"></a>12867         }
<a name="l12868"></a>12868 
<a name="l12869"></a>12869         {
<a name="l12870"></a>12870             <span class="comment">/* Tomato compatibility code. */</span>
<a name="l12871"></a>12871             <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l12872"></a>12872             <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l12873"></a>12873 
<a name="l12874"></a>12874             <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12875"></a>12875                 <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l12876"></a>12876                 <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l12877"></a>12877                     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l12878"></a>12878                     <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12879"></a>12879                         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l12880"></a>12880                             <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l12881"></a>12881                             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a1403b2a117470cc7d9dd920e410a0dfe">bundle_size</a>==0.0f) {
<a name="l12882"></a>12882                                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a1403b2a117470cc7d9dd920e410a0dfe">bundle_size</a>= 0.2f;
<a name="l12883"></a>12883                                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> |= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a80073cb1e48d29283ad830be5353bdb3">V3D_SHOW_RECONSTRUCTION</a>;
<a name="l12884"></a>12884                             }
<a name="l12885"></a>12885                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l12886"></a>12886                                 <a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *sc= (<a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *)sl;
<a name="l12887"></a>12887                                 <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#a4f73cdebcf5d0c311f989ce286b78431">scopes</a>.<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2befc9d0050388ebdd9809a893568711">track_preview_height</a>==0)
<a name="l12888"></a>12888                                     sc-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#a4f73cdebcf5d0c311f989ce286b78431">scopes</a>.<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2befc9d0050388ebdd9809a893568711">track_preview_height</a>= 120;
<a name="l12889"></a>12889                             }
<a name="l12890"></a>12890 
<a name="l12891"></a>12891                             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aeb48804272fd41192e6d642a030447b7">bundle_drawtype</a>==0)
<a name="l12892"></a>12892                                 v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aeb48804272fd41192e6d642a030447b7">bundle_drawtype</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9d1de056519bc074a2b9274320833f46">OB_PLAINAXES</a>;
<a name="l12893"></a>12893                         }
<a name="l12894"></a>12894                     }
<a name="l12895"></a>12895                 }
<a name="l12896"></a>12896             }
<a name="l12897"></a>12897 
<a name="l12898"></a>12898             <span class="keywordflow">for</span> (clip= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; clip; clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12899"></a>12899                 <a class="code" href="../../da/d5f/structMovieTrackingTrack.html">MovieTrackingTrack</a> *track;
<a name="l12900"></a>12900 
<a name="l12901"></a>12901                 <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac71a4ef10a1ee3891dfb6bf6efbd38d7">aspx</a>&lt;1.0f) {
<a name="l12902"></a>12902                     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac71a4ef10a1ee3891dfb6bf6efbd38d7">aspx</a>= 1.0f;
<a name="l12903"></a>12903                     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a5ed433e9da49af20b98b40d6d460b03a">aspy</a>= 1.0f;
<a name="l12904"></a>12904                 }
<a name="l12905"></a>12905 
<a name="l12906"></a>12906                 clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#a344b52a7078bcb6d5efb3638dcad54d1">build_tc_flag</a>= <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1cafd4bc8417b7f6bce9b94c63008b268bd">IMB_TC_RECORD_RUN</a> |
<a name="l12907"></a>12907                                            <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1caf970abe0aba31c001a91573f180e86ac">IMB_TC_FREE_RUN</a> |
<a name="l12908"></a>12908                                            <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1ca08fdea61b9e1cf9f3aafb06e4e990637">IMB_TC_INTERPOLATED_REC_DATE_FREE_RUN</a>;
<a name="l12909"></a>12909 
<a name="l12910"></a>12910                 <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#acf763c2af49e997d3cbca94ac29413a1">build_size_flag</a>==0)
<a name="l12911"></a>12911                     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#acf763c2af49e997d3cbca94ac29413a1">build_size_flag</a>= <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9ae37bc65ce8665eb2ed8b7c4c7f62a5c1">IMB_PROXY_25</a>;
<a name="l12912"></a>12912 
<a name="l12913"></a>12913                 <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#aae85a2ae52d33d27191e78b88ea10544">quality</a>==0)
<a name="l12914"></a>12914                     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#aae85a2ae52d33d27191e78b88ea10544">quality</a>= 90;
<a name="l12915"></a>12915 
<a name="l12916"></a>12916                 <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aff807f14ebd4dc9c7855d996745ea2eb">pixel_aspect</a>&lt;0.01f)
<a name="l12917"></a>12917                     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aff807f14ebd4dc9c7855d996745ea2eb">pixel_aspect</a>= 1.f;
<a name="l12918"></a>12918 
<a name="l12919"></a>12919                 track= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#a74fe531242e070b2108266db9046bf8f">tracks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l12920"></a>12920                 <span class="keywordflow">while</span> (track) {
<a name="l12921"></a>12921                     <span class="keywordflow">if</span> (track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a3b2201f25d4e0cda7faef59a6d5730e5">pyramid_levels</a>==0)
<a name="l12922"></a>12922                         track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a3b2201f25d4e0cda7faef59a6d5730e5">pyramid_levels</a>= 2;
<a name="l12923"></a>12923 
<a name="l12924"></a>12924                     <span class="keywordflow">if</span> (track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a23bc9b573f87bc80922ae41904e02b50">minimum_correlation</a>==0.0f)
<a name="l12925"></a>12925                         track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a23bc9b573f87bc80922ae41904e02b50">minimum_correlation</a>= 0.75f;
<a name="l12926"></a>12926 
<a name="l12927"></a>12927                     track= track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#aec565ab687123b2707c7be0182b24ea6">next</a>;
<a name="l12928"></a>12928                 }
<a name="l12929"></a>12929             }
<a name="l12930"></a>12930         }
<a name="l12931"></a>12931     }
<a name="l12932"></a>12932 
<a name="l12933"></a>12933     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 260 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 260 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 6))
<a name="l12934"></a>12934     {
<a name="l12935"></a>12935         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l12936"></a>12936         <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l12937"></a>12937         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l12938"></a>12938 
<a name="l12939"></a>12939         <span class="keywordflow">for</span> (sce = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12940"></a>12940             <a class="code" href="../../d0/d12/readfile_8c.html#a4dfd0402183ebf4cc246c063db292100">do_versions_image_settings_2_60</a>(sce);
<a name="l12941"></a>12941         }
<a name="l12942"></a>12942 
<a name="l12943"></a>12943         <span class="keywordflow">for</span> (clip= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; clip; clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12944"></a>12944             <a class="code" href="../../da/ddb/structMovieTrackingSettings.html">MovieTrackingSettings</a> *settings= &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#afa585c1d91bd61a9a0de3ace505685f0">settings</a>;
<a name="l12945"></a>12945 
<a name="l12946"></a>12946             <span class="keywordflow">if</span> (settings-&gt;<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#ac321bfb4a73f930617dd5c7bcb521400">default_pyramid_levels</a>==0) {
<a name="l12947"></a>12947                 settings-&gt;<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#ad798c871b88d151b983fe028536118f7">default_tracker</a>= <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#ab5f0286aa6aad0ba36259383ce88e01a">TRACKER_KLT</a>;
<a name="l12948"></a>12948                 settings-&gt;<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#ac321bfb4a73f930617dd5c7bcb521400">default_pyramid_levels</a>= 2;
<a name="l12949"></a>12949                 settings-&gt;<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#a6aee59cdcaef29f803e6fcd8dac76af7">default_minimum_correlation</a>= 0.75;
<a name="l12950"></a>12950                 settings-&gt;<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#a7004be3b02da2b819c9aab2c93ed9c47">default_pattern_size</a>= 11;
<a name="l12951"></a>12951                 settings-&gt;<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#ae0d9d6de3b92c0e28200fe384043760a">default_search_size</a>= 51;
<a name="l12952"></a>12952             }
<a name="l12953"></a>12953         }
<a name="l12954"></a>12954 
<a name="l12955"></a>12955         <span class="keywordflow">for</span> (sc= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12956"></a>12956             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l12957"></a>12957             <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l12958"></a>12958                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l12959"></a>12959                 <span class="keywordflow">for</span> (sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l12960"></a>12960                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l12961"></a>12961                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *)sl;
<a name="l12962"></a>12962                         v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a>&amp;= ~<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#afb3cea5af9bdf7d33facf737c539460b">V3D_RENDER_SHADOW</a>;
<a name="l12963"></a>12963                     }
<a name="l12964"></a>12964                 }
<a name="l12965"></a>12965             }
<a name="l12966"></a>12966         }
<a name="l12967"></a>12967 
<a name="l12968"></a>12968         {
<a name="l12969"></a>12969             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12970"></a>12970             <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12971"></a>12971                 <span class="comment">/* convert delta addition into delta scale */</span>
<a name="l12972"></a>12972                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l12973"></a>12973                 <span class="keywordflow">for</span> (i= 0; i &lt; 3; i++) {
<a name="l12974"></a>12974                     <span class="keywordflow">if</span> ( (ob-&gt;dsize[i] == 0.0f) || <span class="comment">/* simple case, user never touched dsize */</span>
<a name="l12975"></a>12975                          (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]  == 0.0f))   <span class="comment">/* cant scale the dsize to give a non zero result, so fallback to 1.0f */</span>
<a name="l12976"></a>12976                     {
<a name="l12977"></a>12977                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac0afd409155d40dcdbedb76aa45b8ee2">dscale</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= 1.0f;
<a name="l12978"></a>12978                     }
<a name="l12979"></a>12979                     <span class="keywordflow">else</span> {
<a name="l12980"></a>12980                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac0afd409155d40dcdbedb76aa45b8ee2">dscale</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] + ob-&gt;dsize[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) / ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[i];
<a name="l12981"></a>12981                     }
<a name="l12982"></a>12982                 }
<a name="l12983"></a>12983             }
<a name="l12984"></a>12984         }
<a name="l12985"></a>12985     }
<a name="l12986"></a>12986     <span class="comment">/* sigh, this dscale vs dsize version patching was not done right, fix for fix,</span>
<a name="l12987"></a>12987 <span class="comment">     * this intentionally checks an exact subversion, also note this was never in a release,</span>
<a name="l12988"></a>12988 <span class="comment">     * at some point this could be removed. */</span>
<a name="l12989"></a>12989     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 260 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> == 6) {
<a name="l12990"></a>12990         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l12991"></a>12991         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l12992"></a>12992             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a212d65c08323cdf9e10d72e1775e94c2">is_zero_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac0afd409155d40dcdbedb76aa45b8ee2">dscale</a>)) {
<a name="l12993"></a>12993                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a7049bd8d71df5798aa35be0ad27ca513">fill_vn_fl</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac0afd409155d40dcdbedb76aa45b8ee2">dscale</a>, 3, 1.0f);
<a name="l12994"></a>12994             }
<a name="l12995"></a>12995         }
<a name="l12996"></a>12996     }
<a name="l12997"></a>12997 
<a name="l12998"></a>12998     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 260 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 260 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 8))
<a name="l12999"></a>12999     {
<a name="l13000"></a>13000         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l13001"></a>13001 
<a name="l13002"></a>13002         <span class="keywordflow">for</span> (brush= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13003"></a>13003             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#ab1a9175890a69550b6dae0cd66e5a8d6">sculpt_tool</a> == <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a32b04aa41966305a60754f234d6a39ebaea2e7c98691af9e799de42c097e93405">SCULPT_TOOL_ROTATE</a>)
<a name="l13004"></a>13004                 brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a05d1b34fb95a0932190b690b61b276ee">alpha</a>= 1.0f;
<a name="l13005"></a>13005         }
<a name="l13006"></a>13006     }
<a name="l13007"></a>13007 
<a name="l13008"></a>13008     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 261 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 261 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1))
<a name="l13009"></a>13009     {
<a name="l13010"></a>13010         {
<a name="l13011"></a>13011             <span class="comment">/* update use flags for node sockets (was only temporary before) */</span>
<a name="l13012"></a>13012             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l13013"></a>13013             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat;
<a name="l13014"></a>13014             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l13015"></a>13015             <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *lamp;
<a name="l13016"></a>13016             <a class="code" href="../../d7/d3f/structWorld.html">World</a> *world;
<a name="l13017"></a>13017             <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l13018"></a>13018 
<a name="l13019"></a>13019             <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13020"></a>13020                 <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l13021"></a>13021                     <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l13022"></a>13022 
<a name="l13023"></a>13023             <span class="keywordflow">for</span> (mat=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; mat; mat=mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13024"></a>13024                 <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l13025"></a>13025                     <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(mat-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l13026"></a>13026 
<a name="l13027"></a>13027             <span class="keywordflow">for</span> (tex=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex=tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13028"></a>13028                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>)
<a name="l13029"></a>13029                     <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l13030"></a>13030 
<a name="l13031"></a>13031             <span class="keywordflow">for</span> (lamp=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lamp; lamp=lamp-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13032"></a>13032                 <span class="keywordflow">if</span> (lamp-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>)
<a name="l13033"></a>13033                     <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(lamp-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l13034"></a>13034 
<a name="l13035"></a>13035             <span class="keywordflow">for</span> (world=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; world; world=world-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13036"></a>13036                 <span class="keywordflow">if</span> (world-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>)
<a name="l13037"></a>13037                     <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(world-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l13038"></a>13038 
<a name="l13039"></a>13039             <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13040"></a>13040                 <a class="code" href="../../d0/d12/readfile_8c.html#a87a8196f15998b390ece69974b13454b">do_versions_nodetree_socket_use_flags_2_62</a>(ntree);
<a name="l13041"></a>13041         }
<a name="l13042"></a>13042         {
<a name="l13043"></a>13043             <span class="comment">/* Initialize BGE exit key to esc key */</span>
<a name="l13044"></a>13044             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l13045"></a>13045             <span class="keywordflow">for</span> (scene= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13046"></a>13046                 <span class="keywordflow">if</span> (!scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a2f6932759dc1dd4f11a97189aa38f088">exitkey</a>)
<a name="l13047"></a>13047                     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a2f6932759dc1dd4f11a97189aa38f088">exitkey</a> = 218; <span class="comment">// Blender key code for ESC</span>
<a name="l13048"></a>13048             }
<a name="l13049"></a>13049         }
<a name="l13050"></a>13050         {
<a name="l13051"></a>13051             <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l13052"></a>13052             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13053"></a>13053 
<a name="l13054"></a>13054             <span class="keywordflow">for</span> (clip= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; clip; clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13055"></a>13055                 <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking= &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l13056"></a>13056                 <a class="code" href="../../d2/de6/structMovieTrackingObject.html">MovieTrackingObject</a> *tracking_object= tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a8b83f22c1c9fa84904d2a6689973b789">objects</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l13057"></a>13057 
<a name="l13058"></a>13058                 clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#a344b52a7078bcb6d5efb3638dcad54d1">build_tc_flag</a>|= <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1ca1dffbb864c697c616e1e8c5508fa7b7a">IMB_TC_RECORD_RUN_NO_GAPS</a>;
<a name="l13059"></a>13059 
<a name="l13060"></a>13060                 <span class="keywordflow">if</span> (!tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#afa585c1d91bd61a9a0de3ace505685f0">settings</a>.<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#a5f58d8985917757d7104c82f546ee27f">object_distance</a>)
<a name="l13061"></a>13061                     tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#afa585c1d91bd61a9a0de3ace505685f0">settings</a>.<a class="code" href="../../da/ddb/structMovieTrackingSettings.html#a5f58d8985917757d7104c82f546ee27f">object_distance</a>= 1.0f;
<a name="l13062"></a>13062 
<a name="l13063"></a>13063                 <span class="keywordflow">if</span> (tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a8b83f22c1c9fa84904d2a6689973b789">objects</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l13064"></a>13064                     <a class="code" href="../../da/d72/BKE__tracking_8h.html#aaa24525c80d4ace1d53606d850992e76">BKE_tracking_new_object</a>(tracking, <span class="stringliteral">&quot;Camera&quot;</span>);
<a name="l13065"></a>13065 
<a name="l13066"></a>13066                 <span class="keywordflow">while</span> (tracking_object) {
<a name="l13067"></a>13067                     <span class="keywordflow">if</span> (!tracking_object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#af6debc27f132b1e44dad10c459b3a6bc">scale</a>)
<a name="l13068"></a>13068                         tracking_object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#af6debc27f132b1e44dad10c459b3a6bc">scale</a>= 1.0f;
<a name="l13069"></a>13069 
<a name="l13070"></a>13070                     tracking_object= tracking_object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#a9c25b559861625fafa9281d308689f46">next</a>;
<a name="l13071"></a>13071                 }
<a name="l13072"></a>13072             }
<a name="l13073"></a>13073 
<a name="l13074"></a>13074             <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13075"></a>13075                 <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l13076"></a>13076                 <span class="keywordflow">for</span> (con= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l13077"></a>13077                     <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l13078"></a>13078 
<a name="l13079"></a>13079                     <span class="keywordflow">if</span> (!cti)
<a name="l13080"></a>13080                         <span class="keywordflow">continue</span>;
<a name="l13081"></a>13081 
<a name="l13082"></a>13082                     <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>) {
<a name="l13083"></a>13083                         <a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l13084"></a>13084 
<a name="l13085"></a>13085                         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#acd5dc3b174b603a620c44ff8a6824576">invmat</a>[3][3]==0.0f)
<a name="l13086"></a>13086                             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#acd5dc3b174b603a620c44ff8a6824576">invmat</a>);
<a name="l13087"></a>13087                     }
<a name="l13088"></a>13088                 }
<a name="l13089"></a>13089             }
<a name="l13090"></a>13090         }
<a name="l13091"></a>13091         {
<a name="l13092"></a>13092         <span class="comment">/* Warn the user if he is using [&quot;Text&quot;] properties for Font objects */</span>
<a name="l13093"></a>13093             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13094"></a>13094             <a class="code" href="../../d8/d4a/structbProperty.html">bProperty</a> *prop;
<a name="l13095"></a>13095 
<a name="l13096"></a>13096             <span class="keywordflow">for</span> (ob= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13097"></a>13097                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>) {
<a name="l13098"></a>13098                     prop = <a class="code" href="../../d1/db8/BKE__property_8h.html#a5eb6a05f373ac49c852787f0f0603327">get_ob_property</a>(ob, <span class="stringliteral">&quot;Text&quot;</span>);
<a name="l13099"></a>13099                     <span class="keywordflow">if</span> (prop) {
<a name="l13100"></a>13100                         <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>,
<a name="l13101"></a>13101                                          <span class="stringliteral">&quot;Game property name conflict in object: \&quot;%s\&quot;.\nText objects reserve the &quot;</span>
<a name="l13102"></a>13102                                          <span class="stringliteral">&quot;[\&quot;Text\&quot;] game property to change their content through Logic Bricks.\n&quot;</span>,
<a name="l13103"></a>13103                                          ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l13104"></a>13104                     }
<a name="l13105"></a>13105                 }
<a name="l13106"></a>13106             }
<a name="l13107"></a>13107         }
<a name="l13108"></a>13108     }
<a name="l13109"></a>13109 
<a name="l13110"></a>13110     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 261 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 261 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2))
<a name="l13111"></a>13111     {
<a name="l13112"></a>13112         {
<a name="l13113"></a>13113             <span class="comment">/* convert Camera Actuator values to defines */</span>
<a name="l13114"></a>13114             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13115"></a>13115             <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l13116"></a>13116             <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13117"></a>13117                 <span class="keywordflow">for</span> (act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l13118"></a>13118                     <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ad0a80e945d2f9f52b83f903c6f0a8bcd">ACT_CAMERA</a>) {
<a name="l13119"></a>13119                         <a class="code" href="../../d3/d76/structbCameraActuator.html">bCameraActuator</a> *ba= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l13120"></a>13120 
<a name="l13121"></a>13121                         <span class="keywordflow">if</span> (ba-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a2017686b6e0c0a6fdc040669d0288747">axis</a>==(<span class="keywordtype">float</span>) <span class="charliteral">&#39;x&#39;</span>) ba-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a2017686b6e0c0a6fdc040669d0288747">axis</a>=<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a3a0ed013002b178c9387599704a33991">OB_POSX</a>;
<a name="l13122"></a>13122                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ba-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a2017686b6e0c0a6fdc040669d0288747">axis</a>==(<span class="keywordtype">float</span>)<span class="charliteral">&#39;y&#39;</span>) ba-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a2017686b6e0c0a6fdc040669d0288747">axis</a>=<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a697280b7eee0193c135d0d244f5b6a12">OB_POSY</a>;
<a name="l13123"></a>13123                         <span class="comment">/* don&#39;t do an if/else to avoid imediate subversion bump*/</span>
<a name="l13124"></a>13124 <span class="comment">//                  ba-&gt;axis=((ba-&gt;axis == (float) &#39;x&#39;)?OB_POSX_X:OB_POSY);</span>
<a name="l13125"></a>13125                     }
<a name="l13126"></a>13126                 }
<a name="l13127"></a>13127             }
<a name="l13128"></a>13128         }
<a name="l13129"></a>13129 
<a name="l13130"></a>13130         {
<a name="l13131"></a>13131             <span class="comment">/* convert deprecated sculpt_paint_unified_* fields to</span>
<a name="l13132"></a>13132 <span class="comment">             * UnifiedPaintSettings */</span>
<a name="l13133"></a>13133             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l13134"></a>13134             <span class="keywordflow">for</span> (scene= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13135"></a>13135                 <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l13136"></a>13136                 <a class="code" href="../../d0/dbe/structUnifiedPaintSettings.html">UnifiedPaintSettings</a> *ups= &amp;ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a588da956ca487565352dd4fc8f8cef08">unified_paint_settings</a>;
<a name="l13137"></a>13137                 ups-&gt;<a class="code" href="../../d0/dbe/structUnifiedPaintSettings.html#a04acc9601d0f85542b037b823d004da0">size</a>= ts-&gt;sculpt_paint_unified_size;
<a name="l13138"></a>13138                 ups-&gt;<a class="code" href="../../d0/dbe/structUnifiedPaintSettings.html#a7640bf1c669a3f0ecd9f3dd73e64e4d4">unprojected_radius</a>= ts-&gt;sculpt_paint_unified_unprojected_radius;
<a name="l13139"></a>13139                 ups-&gt;<a class="code" href="../../d0/dbe/structUnifiedPaintSettings.html#a54a33983d3e43124d7c3b908cbb98e3f">alpha</a>= ts-&gt;sculpt_paint_unified_alpha;
<a name="l13140"></a>13140                 ups-&gt;<a class="code" href="../../d0/dbe/structUnifiedPaintSettings.html#a211cc9a005afbe46b6b31d685ad02721">flag</a>= ts-&gt;sculpt_paint_settings;
<a name="l13141"></a>13141             }
<a name="l13142"></a>13142         }
<a name="l13143"></a>13143     }
<a name="l13144"></a>13144 
<a name="l13145"></a>13145     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 261 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 261 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3))
<a name="l13146"></a>13146     {
<a name="l13147"></a>13147         {
<a name="l13148"></a>13148             <span class="comment">/* convert extended ascii to utf-8 for text editor */</span>
<a name="l13149"></a>13149             <a class="code" href="../../d2/dda/structText.html">Text</a> *text;
<a name="l13150"></a>13150             <span class="keywordflow">for</span> (text= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#aba48dab3abbe5521b8493006361d2d51">text</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; text; text= text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13151"></a>13151                 <span class="keywordflow">if</span> (!(text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> &amp; <a class="code" href="../../d7/d71/DNA__text__types_8h.html#a1cab0fb665bac909f466de9fc056da9b">TXT_ISEXT</a>)) {
<a name="l13152"></a>13152                     <a class="code" href="../../d8/de6/structTextLine.html">TextLine</a> *tl;
<a name="l13153"></a>13153                     
<a name="l13154"></a>13154                     <span class="keywordflow">for</span> (tl= text-&gt;<a class="code" href="../../d2/dda/structText.html#a04317b744e009e393be9cbee3fe41998">lines</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tl; tl= tl-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a9af045586797cc431ac66acd0c59fa76">next</a>) {
<a name="l13155"></a>13155                         <span class="keywordtype">int</span> added= <a class="code" href="../../d9/d6d/BKE__text_8h.html#afc6be34a8c75eb1a8b449cef3ae83d98">txt_extended_ascii_as_utf8</a>(&amp;tl-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a2287a51f99b6d16c3f2086d8554dc800">line</a>);
<a name="l13156"></a>13156                         tl-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a5b616daa2580786a91db9f7329c91197">len</a>+= added;
<a name="l13157"></a>13157                         
<a name="l13158"></a>13158                         <span class="comment">/* reset cursor position if line was changed */</span>
<a name="l13159"></a>13159                         <span class="keywordflow">if</span> (added &amp;&amp; tl == text-&gt;<a class="code" href="../../d2/dda/structText.html#a3d8d1ee6b07201677b308934c3a35cec">curl</a>)
<a name="l13160"></a>13160                             text-&gt;<a class="code" href="../../d2/dda/structText.html#a9550065a3bb23faf72daf820c9422847">curc</a> = 0;
<a name="l13161"></a>13161                     }
<a name="l13162"></a>13162                 }
<a name="l13163"></a>13163         }
<a name="l13164"></a>13164         {
<a name="l13165"></a>13165             <span class="comment">/* set new dynamic paint values */</span>
<a name="l13166"></a>13166             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13167"></a>13167             <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13168"></a>13168                 <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l13169"></a>13169                 <span class="keywordflow">for</span> (md= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l13170"></a>13170                     <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435abf6c2369ea1f5b0cab992eb27906823c">eModifierType_DynamicPaint</a>) {
<a name="l13171"></a>13171                         <a class="code" href="../../de/d70/structDynamicPaintModifierData.html">DynamicPaintModifierData</a> *pmd = (<a class="code" href="../../de/d70/structDynamicPaintModifierData.html">DynamicPaintModifierData</a> *)md;
<a name="l13172"></a>13172                         <span class="keywordflow">if</span> (pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>)
<a name="l13173"></a>13173                         {
<a name="l13174"></a>13174                             <a class="code" href="../../dc/d46/structDynamicPaintSurface.html">DynamicPaintSurface</a> *surface = pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#ad228b42281d1a30b3a1471918032d6a5">surfaces</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l13175"></a>13175                             <span class="keywordflow">for</span> (; surface; surface=surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a844dd16f25eea3afb63262bf54937b05">next</a>) {
<a name="l13176"></a>13176                                 surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a82fe59b159add8d45cb128b020384843">color_dry_threshold</a> = 1.0f;
<a name="l13177"></a>13177                                 surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#af32fe17f9f57b0d7471a49a0c48e4e77">influence_scale</a> = 1.0f;
<a name="l13178"></a>13178                                 surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a890eab6b7a092e787dfa4ab1282efdfd">radius_scale</a> = 1.0f;
<a name="l13179"></a>13179                                 surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a92478313cccf8148377b92b20349952d">flags</a> |= <a class="code" href="../../dd/daf/DNA__dynamicpaint__types_8h.html#ade0a225742e34db4d25bf46b6ad81be4">MOD_DPAINT_USE_DRYING</a>;
<a name="l13180"></a>13180                             }
<a name="l13181"></a>13181                         }
<a name="l13182"></a>13182                     }
<a name="l13183"></a>13183                 }
<a name="l13184"></a>13184             }
<a name="l13185"></a>13185         }
<a name="l13186"></a>13186     }
<a name="l13187"></a>13187     
<a name="l13188"></a>13188     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 262)
<a name="l13189"></a>13189     {
<a name="l13190"></a>13190         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13191"></a>13191         <span class="keywordflow">for</span> (ob=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13192"></a>13192             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l13193"></a>13193 
<a name="l13194"></a>13194             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l13195"></a>13195                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5fc484f055c7aba4c89beda85b5ba321">eModifierType_Cloth</a>) {
<a name="l13196"></a>13196                     <a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *clmd = (<a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a>*) md;
<a name="l13197"></a>13197                     <span class="keywordflow">if</span> (clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>)
<a name="l13198"></a>13198                         clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#ad5ac5e508785352822769a21d30aaed7">vel_damping</a> = 1.0f;
<a name="l13199"></a>13199                 }
<a name="l13200"></a>13200             }
<a name="l13201"></a>13201         }
<a name="l13202"></a>13202     }
<a name="l13203"></a>13203 
<a name="l13204"></a>13204     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 263)
<a name="l13205"></a>13205     {
<a name="l13206"></a>13206         <span class="comment">/* set fluidsim rate. the version patch for this in 2.62 was wrong, so</span>
<a name="l13207"></a>13207 <span class="comment">         * try to correct it, if rate is 0.0 that&#39;s likely not intentional */</span>
<a name="l13208"></a>13208         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13209"></a>13209 
<a name="l13210"></a>13210         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13211"></a>13211             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l13212"></a>13212             <span class="keywordflow">for</span> (md = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md = md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l13213"></a>13213                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>) {
<a name="l13214"></a>13214                     <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)md;
<a name="l13215"></a>13215                     <span class="keywordflow">if</span> (fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a2d5eec45a4cdd40ec245fec4481e85f0">animRate</a> == 0.0f)
<a name="l13216"></a>13216                         fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a2d5eec45a4cdd40ec245fec4481e85f0">animRate</a> = 1.0f;
<a name="l13217"></a>13217                 }
<a name="l13218"></a>13218             }
<a name="l13219"></a>13219         }
<a name="l13220"></a>13220     }
<a name="l13221"></a>13221 
<a name="l13222"></a>13222     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 262 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 262 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 1))
<a name="l13223"></a>13223     {
<a name="l13224"></a>13224         <span class="comment">/* update use flags for node sockets (was only temporary before) */</span>
<a name="l13225"></a>13225         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l13226"></a>13226         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l13227"></a>13227         
<a name="l13228"></a>13228         <span class="keywordflow">for</span> (sce=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce=sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13229"></a>13229             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l13230"></a>13230                 <a class="code" href="../../d0/d12/readfile_8c.html#af35850180edf167baf82af3fd5ca852e">do_versions_nodetree_multi_file_output_format_2_62_1</a>(sce, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l13231"></a>13231         
<a name="l13232"></a>13232         <span class="comment">/* XXX can&#39;t associate with scene for group nodes, image format will stay uninitialized */</span>
<a name="l13233"></a>13233         <span class="keywordflow">for</span> (ntree=main-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13234"></a>13234             <a class="code" href="../../d0/d12/readfile_8c.html#af35850180edf167baf82af3fd5ca852e">do_versions_nodetree_multi_file_output_format_2_62_1</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ntree);
<a name="l13235"></a>13235     }
<a name="l13236"></a>13236 
<a name="l13237"></a>13237     <span class="comment">/* only swap for pre-release bmesh merge which had MLoopCol red/blue swap */</span>
<a name="l13238"></a>13238     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 262 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> == 1)
<a name="l13239"></a>13239     {
<a name="l13240"></a>13240         {
<a name="l13241"></a>13241             <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l13242"></a>13242             <span class="keywordflow">for</span> (me = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; me; me = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13243"></a>13243                 <a class="code" href="../../d0/d12/readfile_8c.html#abf9024295b339538aabb0048f2fe4da1">do_versions_mesh_mloopcol_swap_2_62_1</a>(me);
<a name="l13244"></a>13244             }
<a name="l13245"></a>13245         }
<a name="l13246"></a>13246 
<a name="l13247"></a>13247     }
<a name="l13248"></a>13248 
<a name="l13249"></a>13249     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 262 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 262 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 2))
<a name="l13250"></a>13250     {
<a name="l13251"></a>13251         {
<a name="l13252"></a>13252             <span class="comment">/* Set new idname of keyingsets from their now &quot;label-only&quot; name. */</span>
<a name="l13253"></a>13253             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l13254"></a>13254             <span class="keywordflow">for</span> (scene = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13255"></a>13255                 <a class="code" href="../../d4/d2c/structKeyingSet.html">KeyingSet</a> *ks;
<a name="l13256"></a>13256                 <span class="keywordflow">for</span> (ks = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a61668a1aa7d493a6c770b8cd7a9c9e4e">keyingsets</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ks; ks = ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a7ebf1a5f7b5ec817bf053a9ace717a07">next</a>) {
<a name="l13257"></a>13257                     <span class="keywordflow">if</span> (!ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a5a78fae59ee603640f845ee535730d99">idname</a>[0])
<a name="l13258"></a>13258                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a5a78fae59ee603640f845ee535730d99">idname</a>, ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a25a8d7a6a01dc5b67be8d0351c36de23">name</a>, <span class="keyword">sizeof</span>(ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a5a78fae59ee603640f845ee535730d99">idname</a>));
<a name="l13259"></a>13259                 }
<a name="l13260"></a>13260             }
<a name="l13261"></a>13261         }
<a name="l13262"></a>13262     }
<a name="l13263"></a>13263     
<a name="l13264"></a>13264     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 262 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 262 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 3))
<a name="l13265"></a>13265     {
<a name="l13266"></a>13266         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13267"></a>13267         <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l13268"></a>13268     
<a name="l13269"></a>13269         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13270"></a>13270             <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l13271"></a>13271                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a405445d7a24594136497267fc4c46f69">eModifierType_Lattice</a>) {
<a name="l13272"></a>13272                     <a class="code" href="../../d8/db7/structLatticeModifierData.html">LatticeModifierData</a> *lmd = (<a class="code" href="../../d8/db7/structLatticeModifierData.html">LatticeModifierData</a> *)md;
<a name="l13273"></a>13273                     lmd-&gt;<a class="code" href="../../d8/db7/structLatticeModifierData.html#a54a63ec3c61c08e510a8fae94aa20faa">strength</a> = 1.0f;
<a name="l13274"></a>13274                 }
<a name="l13275"></a>13275             }
<a name="l13276"></a>13276         }
<a name="l13277"></a>13277     }
<a name="l13278"></a>13278 
<a name="l13279"></a>13279     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 262 || (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> == 262 &amp;&amp; main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a2b07358be00afe071757c0f10082f2dc">subversionfile</a> &lt; 4))
<a name="l13280"></a>13280     {
<a name="l13281"></a>13281         <span class="comment">/* Read Viscosity presets from older files */</span>
<a name="l13282"></a>13282         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l13283"></a>13283 
<a name="l13284"></a>13284         <span class="keywordflow">for</span> (ob = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l13285"></a>13285             <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l13286"></a>13286             <span class="keywordflow">for</span> (md = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md = md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l13287"></a>13287                 <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>) {
<a name="l13288"></a>13288                     <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *)md;
<a name="l13289"></a>13289                     <span class="keywordflow">if</span> (fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;viscosityMode == 3) {
<a name="l13290"></a>13290                         fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a05c96771133d1da337172a3297123f8d">viscosityValue</a> = 5.0;
<a name="l13291"></a>13291                         fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a27f21b44babb4413ee54a96e37fab65c">viscosityExponent</a> = 5;
<a name="l13292"></a>13292                     }
<a name="l13293"></a>13293                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;viscosityMode == 4) {
<a name="l13294"></a>13294                         fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a05c96771133d1da337172a3297123f8d">viscosityValue</a> = 2.0;
<a name="l13295"></a>13295                         fmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>-&gt;<a class="code" href="../../d9/d03/structFluidsimSettings.html#a27f21b44babb4413ee54a96e37fab65c">viscosityExponent</a> = 3;
<a name="l13296"></a>13296                     }
<a name="l13297"></a>13297                 }
<a name="l13298"></a>13298             }
<a name="l13299"></a>13299         }
<a name="l13300"></a>13300     }
<a name="l13301"></a>13301 
<a name="l13302"></a>13302 
<a name="l13303"></a>13303 
<a name="l13304"></a>13304     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 263)
<a name="l13305"></a>13305     {
<a name="l13306"></a>13306         <span class="comment">/* Default for old files is to save particle rotations to pointcache */</span>
<a name="l13307"></a>13307         <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l13308"></a>13308         <span class="keywordflow">for</span> (part = main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; part; part = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l13309"></a>13309             part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#acb1eead271635dccefc77a7126e214a2">PART_ROTATIONS</a>;
<a name="l13310"></a>13310     }
<a name="l13311"></a>13311 
<a name="l13312"></a>13312     <span class="comment">/* WATCH IT!!!: pointers from libdata have not been converted yet here! */</span>
<a name="l13313"></a>13313     <span class="comment">/* WATCH IT 2!: Userdef struct init has to be in editors/interface/resources.c! */</span>
<a name="l13314"></a>13314 
<a name="l13315"></a>13315     <span class="comment">/* don&#39;t forget to set version number in blender.c! */</span>
<a name="l13316"></a>13316 }
<a name="l13317"></a>13317 
<a name="l13318"></a>13318 <span class="preprocessor">#if 0 // XXX: disabled for now... we still don&#39;t have this in the right place in the loading code for it to work</span>
<a name="l13319"></a>13319 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> do_versions_after_linking(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l13320"></a>13320 {
<a name="l13321"></a>13321     <span class="comment">/* old Animation System (using IPO&#39;s) needs to be converted to the new Animato system */</span>
<a name="l13322"></a>13322     <span class="keywordflow">if</span> (main-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a> &lt; 250)
<a name="l13323"></a>13323         <a class="code" href="../../db/d48/BKE__ipo_8h.html#aa3fcf10503e305a71e9df87ff61e8bab">do_versions_ipos_to_animato</a>(main);
<a name="l13324"></a>13324 }
<a name="l13325"></a>13325 <span class="preprocessor">#endif</span>
<a name="l13326"></a>13326 <span class="preprocessor"></span>
<a name="l13327"></a><a class="code" href="../../d0/d12/readfile_8c.html#a513b60f5271c556e04d2a401e2299728">13327</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a513b60f5271c556e04d2a401e2299728">lib_link_all</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main)
<a name="l13328"></a>13328 {
<a name="l13329"></a>13329     <a class="code" href="../../d0/d12/readfile_8c.html#aa8853f362ec1d38f52d4df67413d3d15">oldnewmap_sort</a>(fd);
<a name="l13330"></a>13330     
<a name="l13331"></a>13331     <a class="code" href="../../d0/d12/readfile_8c.html#a2090ebe3c7b507c749c64c1057899e9a">lib_link_windowmanager</a>(fd, main);
<a name="l13332"></a>13332     <a class="code" href="../../d0/d12/readfile_8c.html#a178776c5865f482c80c503bfa2e4973f">lib_link_screen</a>(fd, main);
<a name="l13333"></a>13333     <a class="code" href="../../d0/d12/readfile_8c.html#aa12d0dda3a7a01dffa62536294ba1f47">lib_link_scene</a>(fd, main);
<a name="l13334"></a>13334     <a class="code" href="../../d0/d12/readfile_8c.html#a788fda9781017574efb10ba664298f04">lib_link_object</a>(fd, main);
<a name="l13335"></a>13335     <a class="code" href="../../d0/d12/readfile_8c.html#a4770c8b602a3d1c639876c6f5716c221">lib_link_curve</a>(fd, main);
<a name="l13336"></a>13336     <a class="code" href="../../d0/d12/readfile_8c.html#a3285f0fb40a62ead7a89a8013dbe21b2">lib_link_mball</a>(fd, main);
<a name="l13337"></a>13337     <a class="code" href="../../d0/d12/readfile_8c.html#a1ba67347b63c98e093680ff46e132cd4">lib_link_material</a>(fd, main);
<a name="l13338"></a>13338     <a class="code" href="../../d0/d12/readfile_8c.html#acd28cac2a368c21e0c20d4de77f593c6">lib_link_texture</a>(fd, main);
<a name="l13339"></a>13339     <a class="code" href="../../d0/d12/readfile_8c.html#ac087f1895730eed1a25afda39cdf4835">lib_link_image</a>(fd, main);
<a name="l13340"></a>13340     <a class="code" href="../../d0/d12/readfile_8c.html#afeb2fd709c0c237dbd4eb70e6636c178">lib_link_ipo</a>(fd, main);     <span class="comment">// XXX depreceated... still needs to be maintained for version patches still</span>
<a name="l13341"></a>13341     <a class="code" href="../../d0/d12/readfile_8c.html#a6b7664f42de447cb99205e6f5db680eb">lib_link_key</a>(fd, main);
<a name="l13342"></a>13342     <a class="code" href="../../d0/d12/readfile_8c.html#a775f6f10ac449ef09f14ad6fb91f4b67">lib_link_world</a>(fd, main);
<a name="l13343"></a>13343     <a class="code" href="../../d0/d12/readfile_8c.html#a3e0d9e002217c51047510a4f64f514fa">lib_link_lamp</a>(fd, main);
<a name="l13344"></a>13344     <a class="code" href="../../d0/d12/readfile_8c.html#ad250698250be5256a2ee9077822159db">lib_link_latt</a>(fd, main);
<a name="l13345"></a>13345     <a class="code" href="../../d0/d12/readfile_8c.html#aefb920d224a5fdb12266a73dcb154e43">lib_link_text</a>(fd, main);
<a name="l13346"></a>13346     <a class="code" href="../../d0/d12/readfile_8c.html#a99268eaac27603263d41a59dd1a09465">lib_link_camera</a>(fd, main);
<a name="l13347"></a>13347     <a class="code" href="../../d0/d12/readfile_8c.html#a59a2d536382b8c7c988486796b3326d1">lib_link_speaker</a>(fd, main);
<a name="l13348"></a>13348     <a class="code" href="../../d0/d12/readfile_8c.html#ad2857ea584f3cca15be3a8983646f1b0">lib_link_sound</a>(fd, main);
<a name="l13349"></a>13349     <a class="code" href="../../d0/d12/readfile_8c.html#a27e8ccc208b85b6149be8c6fa995d310">lib_link_group</a>(fd, main);
<a name="l13350"></a>13350     <a class="code" href="../../d0/d12/readfile_8c.html#a94512ed8ad2b1cf7332aa8163b3f3e13">lib_link_armature</a>(fd, main);
<a name="l13351"></a>13351     <a class="code" href="../../d0/d12/readfile_8c.html#a8b8daffc2cd002c721a0c166aed44709">lib_link_action</a>(fd, main);
<a name="l13352"></a>13352     <a class="code" href="../../d0/d12/readfile_8c.html#a28c32f87e5765b01dc0d2daaf75935ea">lib_link_vfont</a>(fd, main);
<a name="l13353"></a>13353     <a class="code" href="../../d0/d12/readfile_8c.html#a83289a8bf399e4c755f5cd5589096d6d">lib_link_nodetree</a>(fd, main);    <span class="comment">/* has to be done after scene/materials, this will verify group nodes */</span>
<a name="l13354"></a>13354     <a class="code" href="../../d0/d12/readfile_8c.html#aae06afcd14ed542020cffe2816ac132a">lib_link_brush</a>(fd, main);
<a name="l13355"></a>13355     <a class="code" href="../../d0/d12/readfile_8c.html#aac02b96a9129ff4a3588edfc0c2e552d">lib_link_particlesettings</a>(fd, main);
<a name="l13356"></a>13356     <a class="code" href="../../d0/d12/readfile_8c.html#a2f13b06d9affcef04703f64794e79f09">lib_link_movieclip</a>(fd, main);
<a name="l13357"></a>13357 
<a name="l13358"></a>13358     <a class="code" href="../../d0/d12/readfile_8c.html#a45a57114eca6884bd4e9b14943496391">lib_link_mesh</a>(fd, main);        <span class="comment">/* as last: tpage images with users at zero */</span>
<a name="l13359"></a>13359 
<a name="l13360"></a>13360     <a class="code" href="../../d0/d12/readfile_8c.html#aa09d77a512e9ac511f256537a34764c7">lib_link_library</a>(fd, main);     <span class="comment">/* only init users */</span>
<a name="l13361"></a>13361 }
<a name="l13362"></a>13362 
<a name="l13363"></a><a class="code" href="../../d0/d12/readfile_8c.html#a45366a5cbb48cac4173e04504f987612">13363</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a45366a5cbb48cac4173e04504f987612">direct_link_keymapitem</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi)
<a name="l13364"></a>13364 {
<a name="l13365"></a>13365     kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af438f7c1ba87d767332b810e2711ac14">properties</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af438f7c1ba87d767332b810e2711ac14">properties</a>);
<a name="l13366"></a>13366     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af438f7c1ba87d767332b810e2711ac14">properties</a>)
<a name="l13367"></a>13367         <a class="code" href="../../d0/d12/readfile_8c.html#af091d585da148d01022b99771d885b94">IDP_DirectLinkProperty</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af438f7c1ba87d767332b810e2711ac14">properties</a>, (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a0a8bb6cc39ada706f6feffec064c3a29">flags</a> &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>), fd);
<a name="l13368"></a>13368     kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a17c86417e0dedf1a101de028ec6a2bd6">ptr</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13369"></a>13369     kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#ae87cf259d931977dc4cae5e3dc3b3e21">flag</a> &amp;= ~<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a12e1f7bedaaffc236f692ad317482d43">KMI_UPDATE</a>;
<a name="l13370"></a>13370 }
<a name="l13371"></a>13371 
<a name="l13372"></a><a class="code" href="../../d0/d12/readfile_8c.html#a90a4c04cc6afbbb3da13fa8931144b28">13372</a> <span class="keyword">static</span> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a90a4c04cc6afbbb3da13fa8931144b28">read_userdef</a>(<a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead)
<a name="l13373"></a>13373 {
<a name="l13374"></a>13374     <a class="code" href="../../d6/de3/structUserDef.html">UserDef</a> *user;
<a name="l13375"></a>13375     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap;
<a name="l13376"></a>13376     <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l13377"></a>13377     <a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html">wmKeyMapDiffItem</a> *kmdi;
<a name="l13378"></a>13378 
<a name="l13379"></a>13379     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#af11d7e43345220a1e16989cab7dc55ef">user</a>= user= <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bhead, <span class="stringliteral">&quot;user def&quot;</span>);
<a name="l13380"></a>13380 
<a name="l13381"></a>13381     <span class="comment">/* read all data into fd-&gt;datamap */</span>
<a name="l13382"></a>13382     bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aabc4bcc829936539892ac7a711c9ad27">read_data_into_oldnewmap</a>(fd, bhead, <span class="stringliteral">&quot;user def&quot;</span>);
<a name="l13383"></a>13383 
<a name="l13384"></a>13384     <span class="keywordflow">if</span> (user-&gt;keymaps.first) {
<a name="l13385"></a>13385         <span class="comment">/* backwards compatibility */</span>
<a name="l13386"></a>13386         user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#a5e274bc131da7b1ce436e2ec513f27e8">user_keymaps</a>= user-&gt;keymaps;
<a name="l13387"></a>13387         user-&gt;keymaps.first= user-&gt;keymaps.last= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13388"></a>13388     }
<a name="l13389"></a>13389 
<a name="l13390"></a>13390     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#a76335c6f572030d4bd8ebfaf5f0e85e0">themes</a>);
<a name="l13391"></a>13391     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#a5e274bc131da7b1ce436e2ec513f27e8">user_keymaps</a>);
<a name="l13392"></a>13392     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#a1194fdc9fddb18a7b31e676e76f1c4e6">addons</a>);
<a name="l13393"></a>13393 
<a name="l13394"></a>13394     <span class="keywordflow">for</span> (keymap=user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#a5e274bc131da7b1ce436e2ec513f27e8">user_keymaps</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; keymap; keymap=keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#ac3bb52f35350d40470edbeadb43f2bba">next</a>) {
<a name="l13395"></a>13395         keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a57f97680d51c38bebb32d9dd4a546fd4">modal_items</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13396"></a>13396         keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a6bd6ed052aac9fe1b3ae3b18143b77c1">poll</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13397"></a>13397         keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a279a4a4f84ee6bb3f7f9af9e9d020143">flag</a> &amp;= ~<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#aa0e9c90cb63fd6276fe8034b86dec418">KEYMAP_UPDATE</a>;
<a name="l13398"></a>13398 
<a name="l13399"></a>13399         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a7177a12403442c4ced5970fbc30eba7b">diff_items</a>);
<a name="l13400"></a>13400         <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a0ae48f8a4481c3faf008d60d6d61b4ad">items</a>);
<a name="l13401"></a>13401         
<a name="l13402"></a>13402         <span class="keywordflow">for</span> (kmdi=keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a7177a12403442c4ced5970fbc30eba7b">diff_items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmdi; kmdi=kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a8c54a042e7cc06a68be027eca355398e">next</a>) {
<a name="l13403"></a>13403             kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a036ecd7f91293d701d03985bab2094e2">remove_item</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a036ecd7f91293d701d03985bab2094e2">remove_item</a>);
<a name="l13404"></a>13404             kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a7ffaea212b8e4e053246bacb0c04c902">add_item</a>= <a class="code" href="../../d0/d12/readfile_8c.html#a9e2fec4280a96a9d7600448be7d07b69">newdataadr</a>(fd, kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a7ffaea212b8e4e053246bacb0c04c902">add_item</a>);
<a name="l13405"></a>13405 
<a name="l13406"></a>13406             <span class="keywordflow">if</span> (kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a036ecd7f91293d701d03985bab2094e2">remove_item</a>)
<a name="l13407"></a>13407                 <a class="code" href="../../d0/d12/readfile_8c.html#a45366a5cbb48cac4173e04504f987612">direct_link_keymapitem</a>(fd, kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a036ecd7f91293d701d03985bab2094e2">remove_item</a>);
<a name="l13408"></a>13408             <span class="keywordflow">if</span> (kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a7ffaea212b8e4e053246bacb0c04c902">add_item</a>)
<a name="l13409"></a>13409                 <a class="code" href="../../d0/d12/readfile_8c.html#a45366a5cbb48cac4173e04504f987612">direct_link_keymapitem</a>(fd, kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a7ffaea212b8e4e053246bacb0c04c902">add_item</a>);
<a name="l13410"></a>13410         }
<a name="l13411"></a>13411 
<a name="l13412"></a>13412         <span class="keywordflow">for</span> (kmi=keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a0ae48f8a4481c3faf008d60d6d61b4ad">items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmi; kmi=kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a5cb105349fd3c21f73142d637602a75e">next</a>)
<a name="l13413"></a>13413             <a class="code" href="../../d0/d12/readfile_8c.html#a45366a5cbb48cac4173e04504f987612">direct_link_keymapitem</a>(fd, kmi);
<a name="l13414"></a>13414     }
<a name="l13415"></a>13415 
<a name="l13416"></a>13416     <span class="comment">// XXX</span>
<a name="l13417"></a>13417     user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#aa371e14fd743804fbb452307e56dc0da">uifonts</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#aa371e14fd743804fbb452307e56dc0da">uifonts</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13418"></a>13418     
<a name="l13419"></a>13419     <a class="code" href="../../d0/d12/readfile_8c.html#a8561829b219dcc0f32400b6b255deb30">link_list</a>(fd, &amp;user-&gt;<a class="code" href="../../d6/de3/structUserDef.html#a2c9ec4144be7ba5269bc78c80a743557">uistyles</a>);
<a name="l13420"></a>13420 
<a name="l13421"></a>13421     <span class="comment">/* free fd-&gt;datamap again */</span>
<a name="l13422"></a>13422     <a class="code" href="../../d0/d12/readfile_8c.html#a6c9bdd398865fbc03c3e15c9a27ae6fe">oldnewmap_free_unused</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>);
<a name="l13423"></a>13423     <a class="code" href="../../d0/d12/readfile_8c.html#aba079f09686eff5205d81438bc402689">oldnewmap_clear</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7f33e832b3f06caf0b9a41079bb2749b">datamap</a>);
<a name="l13424"></a>13424 
<a name="l13425"></a>13425     <span class="keywordflow">return</span> bhead;
<a name="l13426"></a>13426 }
<a name="l13427"></a>13427 
<a name="l13428"></a><a class="code" href="../../de/d65/readfile_8h.html#a1e98dff51781204272be852ecb515a11">13428</a> <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a1e98dff51781204272be852ecb515a11">blo_read_file_internal</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *filepath)
<a name="l13429"></a>13429 {
<a name="l13430"></a>13430     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd);
<a name="l13431"></a>13431     <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd;
<a name="l13432"></a>13432 
<a name="l13433"></a>13433     bfd= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a>), <span class="stringliteral">&quot;blendfiledata&quot;</span>);
<a name="l13434"></a>13434     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc0/structMain.html">Main</a>), <span class="stringliteral">&quot;readfile_Main&quot;</span>);
<a name="l13435"></a>13435     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>);
<a name="l13436"></a>13436 
<a name="l13437"></a>13437     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a2b42cde3bebb0b947a06543767f620d5">fileversion</a>;
<a name="l13438"></a>13438     
<a name="l13439"></a>13439     bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#a79756361200fa87d865592f707736cef">type</a>= <a class="code" href="../../da/d01/BLO__readfile_8h.html#a3493532e8e9bc40f74adb5de3ba18da7a75011aa02d5f5eb78855830517e6d27c">BLENFILETYPE_BLEND</a>;
<a name="l13440"></a>13440     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, filepath, <span class="keyword">sizeof</span>(bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>));
<a name="l13441"></a>13441 
<a name="l13442"></a>13442     <span class="keywordflow">while</span> (bhead) {
<a name="l13443"></a>13443         <span class="keywordflow">switch</span>(bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>) {
<a name="l13444"></a>13444         <span class="keywordflow">case</span> <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>:
<a name="l13445"></a>13445         <span class="keywordflow">case</span> <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#af0b81c59b7165b704a231edc708875a5">DNA1</a>:
<a name="l13446"></a>13446         <span class="keywordflow">case</span> <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#ab946e2e7f7679350627acfded8e2658b">TEST</a>: <span class="comment">/* used as preview since 2.5x */</span>
<a name="l13447"></a>13447         <span class="keywordflow">case</span> <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a717326380225f15b6c722685151c200f">REND</a>:
<a name="l13448"></a>13448             bhead = <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l13449"></a>13449             <span class="keywordflow">break</span>;
<a name="l13450"></a>13450         <span class="keywordflow">case</span> <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2a900ad5a15c2c67fb345854b3d2ad09">GLOB</a>:
<a name="l13451"></a>13451             bhead= <a class="code" href="../../d0/d12/readfile_8c.html#adc7ea50765ff1877a81e7c98ec047cfb">read_global</a>(bfd, fd, bhead);
<a name="l13452"></a>13452             <span class="keywordflow">break</span>;
<a name="l13453"></a>13453         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a494fe72ce954689dd95399ea9f1d87f6ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>:
<a name="l13454"></a>13454             bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a90a4c04cc6afbbb3da13fa8931144b28">read_userdef</a>(bfd, fd, bhead);
<a name="l13455"></a>13455             <span class="keywordflow">break</span>;
<a name="l13456"></a>13456         <span class="keywordflow">case</span> <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>:
<a name="l13457"></a>13457             bhead = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13458"></a>13458             <span class="keywordflow">break</span>;
<a name="l13459"></a>13459 
<a name="l13460"></a>13460         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abaf1999f335a0db6ef4f452fae0fbd06">ID_LI</a>:
<a name="l13461"></a>13461             <span class="comment">/* skip library datablocks in undo, this works together with</span>
<a name="l13462"></a>13462 <span class="comment">             * BLO_read_from_memfile, where the old main-&gt;library is restored</span>
<a name="l13463"></a>13463 <span class="comment">             * overwriting  the libraries from the memory file. previously</span>
<a name="l13464"></a>13464 <span class="comment">             * it did not save ID_LI/ID_ID blocks in this case, but they are</span>
<a name="l13465"></a>13465 <span class="comment">             * needed to make quit.blend recover them correctly. */</span>
<a name="l13466"></a>13466             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a6467e0cc2b7091ece80c86fdfba85b75">memfile</a>)
<a name="l13467"></a>13467                 bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l13468"></a>13468             <span class="keywordflow">else</span>
<a name="l13469"></a>13469                 bhead= <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>, bhead, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0a3ee3d43067d2a2ad22c155985dc533">LIB_LOCAL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l13470"></a>13470             <span class="keywordflow">break</span>;
<a name="l13471"></a>13471         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae719dff14cceff0aafe109635eac72ea">ID_ID</a>:
<a name="l13472"></a>13472             <span class="comment">/* same as above */</span>
<a name="l13473"></a>13473             <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a6467e0cc2b7091ece80c86fdfba85b75">memfile</a>)
<a name="l13474"></a>13474                 bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead);
<a name="l13475"></a>13475             <span class="keywordflow">else</span>
<a name="l13476"></a>13476                 <span class="comment">/* always adds to the most recently loaded</span>
<a name="l13477"></a>13477 <span class="comment">                 * ID_LI block, see direct_link_library.</span>
<a name="l13478"></a>13478 <span class="comment">                 * this is part of the file format definition. */</span>
<a name="l13479"></a>13479                 bhead = <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>, bhead, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a04f8870815d984fe3df7edaf5f1a4aca">LIB_READ</a>+<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a48cc004c21e097c0d7c1c5fa8dc03b96">LIB_EXTERN</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l13480"></a>13480             <span class="keywordflow">break</span>;
<a name="l13481"></a>13481             
<a name="l13482"></a>13482             <span class="comment">/* in 2.50+ files, the file identifier for screens is patched, forward compatibility */</span>
<a name="l13483"></a>13483         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8d16b9f1a746ad032e45127b34ccc452">ID_SCRN</a>:
<a name="l13484"></a>13484             bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad177ecff9697780942b6ff5576c153e9">ID_SCR</a>;
<a name="l13485"></a>13485             <span class="comment">/* deliberate pass on to default */</span>
<a name="l13486"></a>13486         <span class="keywordflow">default</span>:
<a name="l13487"></a>13487             bhead = <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>, bhead, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0a3ee3d43067d2a2ad22c155985dc533">LIB_LOCAL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l13488"></a>13488         }
<a name="l13489"></a>13489     }
<a name="l13490"></a>13490 
<a name="l13491"></a>13491     <span class="comment">/* do before read_libraries, but skip undo case */</span>
<a name="l13492"></a>13492 <span class="comment">//  if (fd-&gt;memfile==NULL) (the mesh shuffle hacks don&#39;t work yet? ton)</span>
<a name="l13493"></a>13493         <a class="code" href="../../d0/d12/readfile_8c.html#a9c6d7f2a5e3846ef77dc9b04e8884e42">do_versions</a>(fd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>);
<a name="l13494"></a>13494 
<a name="l13495"></a>13495     <a class="code" href="../../d0/d12/readfile_8c.html#a04b6bacd8b4fd46514604fa8c3e427dc">read_libraries</a>(fd, &amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>);
<a name="l13496"></a>13496     
<a name="l13497"></a>13497     <a class="code" href="../../d0/d12/readfile_8c.html#af48dcb9e6b4ce80b32f0bd8ac0f6b7a6">blo_join_main</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>);
<a name="l13498"></a>13498 
<a name="l13499"></a>13499     <a class="code" href="../../d0/d12/readfile_8c.html#a513b60f5271c556e04d2a401e2299728">lib_link_all</a>(fd, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>);
<a name="l13500"></a>13500     <span class="comment">//do_versions_after_linking(fd, NULL, bfd-&gt;main); // XXX: not here (or even in this function at all)! this causes crashes on many files - Aligorith (July 04, 2010)</span>
<a name="l13501"></a>13501     <a class="code" href="../../d0/d12/readfile_8c.html#af534cada95dabc774631c0383f5e92d9">lib_verify_nodetree</a>(bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l13502"></a>13502     <a class="code" href="../../d0/d12/readfile_8c.html#a728bf2d00e314cdf430b210dc5a858db">fix_relpaths_library</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>, bfd-&gt;<a class="code" href="../../db/d57/structBlendFileData.html#ae7127e54861595c3050bb298140997cf">main</a>); <span class="comment">/* make all relative paths, relative to the open blend file */</span>
<a name="l13503"></a>13503     
<a name="l13504"></a>13504     <a class="code" href="../../d0/d12/readfile_8c.html#a2d766246a05e4ed199fec8899591a544">link_global</a>(fd, bfd);   <span class="comment">/* as last */</span>
<a name="l13505"></a>13505     
<a name="l13506"></a>13506     <span class="keywordflow">return</span> bfd;
<a name="l13507"></a>13507 }
<a name="l13508"></a>13508 
<a name="l13509"></a>13509 <span class="comment">/* ************* APPEND LIBRARY ************** */</span>
<a name="l13510"></a>13510 
<a name="l13511"></a><a class="code" href="../../d4/da0/structbheadsort.html">13511</a> <span class="keyword">struct </span><a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a> {
<a name="l13512"></a><a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">13512</a>     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13513"></a><a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">13513</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a>;
<a name="l13514"></a>13514 };
<a name="l13515"></a>13515 
<a name="l13516"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab128b8bca72ca2b552cf1375ac8f6380">13516</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab128b8bca72ca2b552cf1375ac8f6380">verg_bheadsort</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *v1, <span class="keyword">const</span> <span class="keywordtype">void</span> *v2)
<a name="l13517"></a>13517 {
<a name="l13518"></a>13518     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a> *x1=v1, *x2=v2;
<a name="l13519"></a>13519     
<a name="l13520"></a>13520     <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a> &gt; x2-&gt;old) <span class="keywordflow">return</span> 1;
<a name="l13521"></a>13521     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a> &lt; x2-&gt;old) <span class="keywordflow">return</span> -1;
<a name="l13522"></a>13522     <span class="keywordflow">return</span> 0;
<a name="l13523"></a>13523 }
<a name="l13524"></a>13524 
<a name="l13525"></a><a class="code" href="../../d0/d12/readfile_8c.html#a705ce425259d232f3342617b4980a70e">13525</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a705ce425259d232f3342617b4980a70e">sort_bhead_old_map</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd)
<a name="l13526"></a>13526 {
<a name="l13527"></a>13527     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13528"></a>13528     <span class="keyword">struct </span><a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a> *bhs;
<a name="l13529"></a>13529     <span class="keywordtype">int</span> tot= 0;
<a name="l13530"></a>13530     
<a name="l13531"></a>13531     <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead))
<a name="l13532"></a>13532         tot++;
<a name="l13533"></a>13533     
<a name="l13534"></a>13534     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#abca98b8f8c84140ab84d610788fe5044">tot_bheadmap</a>= tot;
<a name="l13535"></a>13535     <span class="keywordflow">if</span> (tot==0) <span class="keywordflow">return</span>;
<a name="l13536"></a>13536     
<a name="l13537"></a>13537     bhs= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aae8938088bb13332fa3c4a952364fb09">bheadmap</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(tot*<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a>), <span class="stringliteral">&quot;bheadsort&quot;</span>);
<a name="l13538"></a>13538     
<a name="l13539"></a>13539     <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead), bhs++) {
<a name="l13540"></a>13540         bhs-&gt;<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>= <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13541"></a>13541         bhs-&gt;<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a>= bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>;
<a name="l13542"></a>13542     }
<a name="l13543"></a>13543     
<a name="l13544"></a>13544     qsort(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aae8938088bb13332fa3c4a952364fb09">bheadmap</a>, tot, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a>), <a class="code" href="../../d0/d12/readfile_8c.html#ab128b8bca72ca2b552cf1375ac8f6380">verg_bheadsort</a>);
<a name="l13545"></a>13545         
<a name="l13546"></a>13546 }
<a name="l13547"></a>13547 
<a name="l13548"></a><a class="code" href="../../d0/d12/readfile_8c.html#a73827f78a3cca9353ae10d5c6e623687">13548</a> <span class="keyword">static</span> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a73827f78a3cca9353ae10d5c6e623687">find_previous_lib</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>)
<a name="l13549"></a>13549 {
<a name="l13550"></a>13550     <span class="comment">/* skip library datablocks in undo, see comment in read_libblock */</span>
<a name="l13551"></a>13551     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a6467e0cc2b7091ece80c86fdfba85b75">memfile</a>)
<a name="l13552"></a>13552         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13553"></a>13553 
<a name="l13554"></a>13554     <span class="keywordflow">for</span> (; <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a11bcec81656d8d2e65040eedb638fdaa">blo_prevbhead</a>(fd, bhead))
<a name="l13555"></a>13555         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#abaf1999f335a0db6ef4f452fae0fbd06">ID_LI</a>)
<a name="l13556"></a>13556             <span class="keywordflow">break</span>;
<a name="l13557"></a>13557 
<a name="l13558"></a>13558     <span class="keywordflow">return</span> <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13559"></a>13559 }
<a name="l13560"></a>13560 
<a name="l13561"></a><a class="code" href="../../d0/d12/readfile_8c.html#a54ec53db4834c4c992fc06cda25633df">13561</a> <span class="keyword">static</span> <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a54ec53db4834c4c992fc06cda25633df">find_bhead</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keywordtype">void</span> *<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a>)
<a name="l13562"></a>13562 {
<a name="l13563"></a>13563 <span class="preprocessor">#if 0</span>
<a name="l13564"></a>13564 <span class="preprocessor"></span>    <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13565"></a>13565 <span class="preprocessor">#endif</span>
<a name="l13566"></a>13566 <span class="preprocessor"></span>    <span class="keyword">struct </span><a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a> *bhs, bhs_s;
<a name="l13567"></a>13567     
<a name="l13568"></a>13568     <span class="keywordflow">if</span> (!old)
<a name="l13569"></a>13569         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13570"></a>13570 
<a name="l13571"></a>13571     <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aae8938088bb13332fa3c4a952364fb09">bheadmap</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l13572"></a>13572         <a class="code" href="../../d0/d12/readfile_8c.html#a705ce425259d232f3342617b4980a70e">sort_bhead_old_map</a>(fd);
<a name="l13573"></a>13573     
<a name="l13574"></a>13574     bhs_s.<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a>= <a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a>;
<a name="l13575"></a>13575     bhs= bsearch(&amp;bhs_s, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#aae8938088bb13332fa3c4a952364fb09">bheadmap</a>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#abca98b8f8c84140ab84d610788fe5044">tot_bheadmap</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d4/da0/structbheadsort.html">bheadsort</a>), <a class="code" href="../../d0/d12/readfile_8c.html#ab128b8bca72ca2b552cf1375ac8f6380">verg_bheadsort</a>);
<a name="l13576"></a>13576 
<a name="l13577"></a>13577     <span class="keywordflow">if</span> (bhs)
<a name="l13578"></a>13578         <span class="keywordflow">return</span> bhs-&gt;<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13579"></a>13579     
<a name="l13580"></a>13580 <span class="preprocessor">#if 0</span>
<a name="l13581"></a>13581 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead))
<a name="l13582"></a>13582         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>==old)
<a name="l13583"></a>13583             <span class="keywordflow">return</span> <a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13584"></a>13584 <span class="preprocessor">#endif</span>
<a name="l13585"></a>13585 <span class="preprocessor"></span>
<a name="l13586"></a>13586     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l13587"></a>13587 }
<a name="l13588"></a>13588 
<a name="l13589"></a><a class="code" href="../../de/d65/readfile_8h.html#a6a83e53ed1153de6a247728039e777c7">13589</a> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d12/readfile_8c.html#a6a83e53ed1153de6a247728039e777c7">bhead_id_name</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>)
<a name="l13590"></a>13590 {
<a name="l13591"></a>13591     <span class="keywordflow">return</span> ((<span class="keywordtype">char</span> *)(bhead+1)) + fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a40fda8eb3f6af23fc4b8fff55fcd7cec">id_name_offs</a>;
<a name="l13592"></a>13592 }
<a name="l13593"></a>13593 
<a name="l13594"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad0655f0cabe15c0b66aa9c70d4308258">13594</a> <span class="keyword">static</span> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../d0/d12/readfile_8c.html#ad0655f0cabe15c0b66aa9c70d4308258">is_yet_read</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>)
<a name="l13595"></a>13595 {
<a name="l13596"></a>13596     <span class="keyword">const</span> <span class="keywordtype">char</span> *idname= <a class="code" href="../../d0/d12/readfile_8c.html#a6a83e53ed1153de6a247728039e777c7">bhead_id_name</a>(fd, bhead);
<a name="l13597"></a>13597     <span class="comment">/* which_libbase can be NULL, intentionally not using idname+2 */</span>
<a name="l13598"></a>13598     <span class="keywordflow">return</span> <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a07f40c87b9211c9d5fef01d4a4e9054d">BLI_findstring</a>(<a class="code" href="../../d8/db1/BKE__library_8h.html#a2dc345b18171d710d51f14d814121381">which_libbase</a>(mainvar, <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(idname)), idname, offsetof(<a class="code" href="../../d8/d7e/structID.html">ID</a>, name));
<a name="l13599"></a>13599 }
<a name="l13600"></a>13600 
<a name="l13601"></a><a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">13601</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <span class="keywordtype">void</span> *<a class="code" href="../../d4/da0/structbheadsort.html#a62e09af7438d7c0b0938a073a0c4c926">old</a>)
<a name="l13602"></a>13602 {
<a name="l13603"></a>13603     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *<a class="code" href="../../d4/da0/structbheadsort.html#ad903293aaa4892dc4bf199a3a9ab7d5b">bhead</a>;
<a name="l13604"></a>13604     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l13605"></a>13605 
<a name="l13606"></a>13606     bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a54ec53db4834c4c992fc06cda25633df">find_bhead</a>(fd, old);
<a name="l13607"></a>13607     <span class="keywordflow">if</span> (bhead) {
<a name="l13608"></a>13608             <span class="comment">/* from another library? */</span>
<a name="l13609"></a>13609         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae719dff14cceff0aafe109635eac72ea">ID_ID</a>) {
<a name="l13610"></a>13610             <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bheadlib= <a class="code" href="../../d0/d12/readfile_8c.html#a73827f78a3cca9353ae10d5c6e623687">find_previous_lib</a>(fd, bhead);
<a name="l13611"></a>13611 
<a name="l13612"></a>13612             <span class="keywordflow">if</span> (bheadlib) {
<a name="l13613"></a>13613                 <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib= <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bheadlib, <span class="stringliteral">&quot;Library&quot;</span>);
<a name="l13614"></a>13614                 <a class="code" href="../../d0/dc0/structMain.html">Main</a> *ptr= <a class="code" href="../../d0/d12/readfile_8c.html#a24a5d36cb3cf8466e0e301f6b453b437">blo_find_main</a>(fd, &amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, lib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>);
<a name="l13615"></a>13615 
<a name="l13616"></a>13616                 <span class="keywordtype">id</span>= <a class="code" href="../../d0/d12/readfile_8c.html#ad0655f0cabe15c0b66aa9c70d4308258">is_yet_read</a>(fd, ptr, bhead);
<a name="l13617"></a>13617 
<a name="l13618"></a>13618                 <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l13619"></a>13619                     <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, ptr, bhead, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a04f8870815d984fe3df7edaf5f1a4aca">LIB_READ</a>+<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab205643c2c50ad2f8b3555a5d2314924">LIB_INDIRECT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l13620"></a>13620                     <span class="comment">// commented because this can print way too much</span>
<a name="l13621"></a>13621                     <span class="comment">// if (G.debug &amp; G_DEBUG) printf(&quot;expand_doit: other lib %s\n&quot;, lib-&gt;name);</span>
<a name="l13622"></a>13622                     
<a name="l13623"></a>13623                     <span class="comment">/* for outliner dependency only */</span>
<a name="l13624"></a>13624                     ptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#aa62a40a009720ec1a80ec1f050c3e13c">parent</a>= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>;
<a name="l13625"></a>13625                 }
<a name="l13626"></a>13626                 <span class="keywordflow">else</span> {
<a name="l13627"></a>13627                     <span class="comment">/* The line below was commented by Ton (I assume), when Hos did the merge from the orange branch. rev 6568</span>
<a name="l13628"></a>13628 <span class="comment">                     * This line is NEEDED, the case is that you have 3 blend files...</span>
<a name="l13629"></a>13629 <span class="comment">                     * user.blend, lib.blend and lib_indirect.blend - if user.blend already references a &quot;tree&quot; from</span>
<a name="l13630"></a>13630 <span class="comment">                     * lib_indirect.blend but lib.blend does too, linking in a Scene or Group from lib.blend can result in an</span>
<a name="l13631"></a>13631 <span class="comment">                     * empty without the dupli group referenced. Once you save and reload the group would appier. - Campbell */</span>
<a name="l13632"></a>13632                     <span class="comment">/* This crashes files, must look further into it */</span>
<a name="l13633"></a>13633                     
<a name="l13634"></a>13634                     <span class="comment">/* Update: the issue is that in file reading, the oldnewmap is OK, but for existing data, it has to be</span>
<a name="l13635"></a>13635 <span class="comment">                     * inserted in the map to be found! */</span>
<a name="l13636"></a>13636                     <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afe13a862d1bd4ab218a014d5b093fb63">LIB_PRE_EXISTING</a>)
<a name="l13637"></a>13637                         <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>, <span class="keywordtype">id</span>, 1);
<a name="l13638"></a>13638                     
<a name="l13639"></a>13639                     <a class="code" href="../../d0/d12/readfile_8c.html#a9c77eadd91c9abd3ddcf046fc86f5f7e">change_idid_adr_fd</a>(fd, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>, <span class="keywordtype">id</span>);
<a name="l13640"></a>13640                     <span class="comment">// commented because this can print way too much</span>
<a name="l13641"></a>13641                     <span class="comment">// if (G.debug &amp; G_DEBUG) printf(&quot;expand_doit: already linked: %s lib: %s\n&quot;, id-&gt;name, lib-&gt;name);</span>
<a name="l13642"></a>13642                 }
<a name="l13643"></a>13643                 
<a name="l13644"></a>13644                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(lib);
<a name="l13645"></a>13645             }
<a name="l13646"></a>13646         }
<a name="l13647"></a>13647         <span class="keywordflow">else</span> {
<a name="l13648"></a>13648             <span class="keywordtype">id</span>= <a class="code" href="../../d0/d12/readfile_8c.html#ad0655f0cabe15c0b66aa9c70d4308258">is_yet_read</a>(fd, mainvar, bhead);
<a name="l13649"></a>13649             <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l13650"></a>13650                 <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, mainvar, bhead, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a9cbb13a166c7759dff2f8c98a28791f8">LIB_TESTIND</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l13651"></a>13651             }
<a name="l13652"></a>13652             <span class="keywordflow">else</span> {
<a name="l13653"></a>13653                 <span class="comment">/* this is actually only needed on UI call? when ID was already read before, and another append</span>
<a name="l13654"></a>13654 <span class="comment">                 * happens which invokes same ID... in that case the lookup table needs this entry */</span>
<a name="l13655"></a>13655                 <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>, <span class="keywordtype">id</span>, 1);
<a name="l13656"></a>13656                 <span class="comment">// commented because this can print way too much</span>
<a name="l13657"></a>13657                 <span class="comment">// if (G.debug &amp; G_DEBUG) printf(&quot;expand: already read %s\n&quot;, id-&gt;name);</span>
<a name="l13658"></a>13658             }
<a name="l13659"></a>13659         }
<a name="l13660"></a>13660     }
<a name="l13661"></a>13661 }
<a name="l13662"></a>13662 
<a name="l13663"></a>13663 
<a name="l13664"></a>13664 
<a name="l13665"></a>13665 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13666"></a><a class="code" href="../../d0/d12/readfile_8c.html#adb7c8af82acfad94ad6a2b4949d8bd81">13666</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#adb7c8af82acfad94ad6a2b4949d8bd81">expand_ipo</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d2/dc5/structIpo.html">Ipo</a> *ipo)
<a name="l13667"></a>13667 {
<a name="l13668"></a>13668     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu;
<a name="l13669"></a>13669     <span class="keywordflow">for</span> (icu= ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; icu; icu= icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#afe828a2dd44460b47a95430528ec274d">next</a>) {
<a name="l13670"></a>13670         <span class="keywordflow">if</span> (icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>)
<a name="l13671"></a>13671             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a5fbfb6b72ef8f0c70b61ce7ae8350e79">driver</a>-&gt;<a class="code" href="../../d0/d89/structIpoDriver.html#a9650006b4c72ef892c17e815f3a6c3dd">ob</a>);
<a name="l13672"></a>13672     }
<a name="l13673"></a>13673 }
<a name="l13674"></a>13674 
<a name="l13675"></a>13675 <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13676"></a><a class="code" href="../../d0/d12/readfile_8c.html#afe62eafa0767a5429926c7a839648cc6">13676</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#afe62eafa0767a5429926c7a839648cc6">expand_constraint_channels</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *chanbase)
<a name="l13677"></a>13677 {
<a name="l13678"></a>13678     <a class="code" href="../../d7/dbe/structbConstraintChannel.html">bConstraintChannel</a> *chan;
<a name="l13679"></a>13679     <span class="keywordflow">for</span> (chan=chanbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; chan; chan=chan-&gt;<a class="code" href="../../d7/dbe/structbConstraintChannel.html#acac0a238b06eef93fe5ae0a1051a510b">next</a>) {
<a name="l13680"></a>13680         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, chan-&gt;<a class="code" href="../../d7/dbe/structbConstraintChannel.html#a45e2b4eb3c4093b7f136b0c2e7a360eb">ipo</a>);
<a name="l13681"></a>13681     }
<a name="l13682"></a>13682 }
<a name="l13683"></a>13683 
<a name="l13684"></a><a class="code" href="../../d0/d12/readfile_8c.html#a66ce2efe6b0655233decbc543be280c8">13684</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a66ce2efe6b0655233decbc543be280c8">expand_fmodifiers</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l13685"></a>13685 {
<a name="l13686"></a>13686     <a class="code" href="../../dc/d68/structFModifier.html">FModifier</a> *fcm;
<a name="l13687"></a>13687     
<a name="l13688"></a>13688     <span class="keywordflow">for</span> (fcm= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcm; fcm= fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2b03be89329aab5401fcd674e0f2d9ca">next</a>) {
<a name="l13689"></a>13689         <span class="comment">/* library data for specific F-Modifier types */</span>
<a name="l13690"></a>13690         <span class="keywordflow">switch</span> (fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2618b2144f7498de1afe54faa6692344">type</a>) {
<a name="l13691"></a>13691             <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97baa6f502fa0bc4eaa22eea8ee09ab8df62">FMODIFIER_TYPE_PYTHON</a>:
<a name="l13692"></a>13692             {
<a name="l13693"></a>13693                 <a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l13694"></a>13694                 
<a name="l13695"></a>13695                 <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a95410af8c712f9ab5118aa9463dfebee">script</a>);
<a name="l13696"></a>13696             }
<a name="l13697"></a>13697                 <span class="keywordflow">break</span>;
<a name="l13698"></a>13698         }
<a name="l13699"></a>13699     }
<a name="l13700"></a>13700 }
<a name="l13701"></a>13701 
<a name="l13702"></a><a class="code" href="../../d0/d12/readfile_8c.html#aa7eefab59d4b22362b8e269759ec6628">13702</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aa7eefab59d4b22362b8e269759ec6628">expand_fcurves</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l13703"></a>13703 {
<a name="l13704"></a>13704     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l13705"></a>13705     
<a name="l13706"></a>13706     <span class="keywordflow">for</span> (fcu= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l13707"></a>13707         <span class="comment">/* Driver targets if there is a driver */</span>
<a name="l13708"></a>13708         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>) {
<a name="l13709"></a>13709             <a class="code" href="../../d3/d1e/structChannelDriver.html">ChannelDriver</a> *driver= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>;
<a name="l13710"></a>13710             <a class="code" href="../../d1/d24/structDriverVar.html">DriverVar</a> *dvar;
<a name="l13711"></a>13711             
<a name="l13712"></a>13712             <span class="keywordflow">for</span> (dvar= driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a14d54c061db1124addaba9a6a80cce1e">variables</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dvar; dvar= dvar-&gt;<a class="code" href="../../d1/d24/structDriverVar.html#a6cbe874a49fab44dd2e2ec49b5a35da1">next</a>) {
<a name="l13713"></a>13713                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a94a8b2b8c805858b0e72e8652b5d79b6">DRIVER_TARGETS_LOOPER</a>(dvar) 
<a name="l13714"></a>13714                 {
<a name="l13715"></a>13715                     <span class="comment">// TODO: only expand those that are going to get used?</span>
<a name="l13716"></a>13716                     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, dtar-&gt;id);
<a name="l13717"></a>13717                 }
<a name="l13718"></a>13718                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ae6f978c887bc26c0da1235ccef77444b">DRIVER_TARGETS_LOOPER_END</a>
<a name="l13719"></a>13719             }
<a name="l13720"></a>13720         }
<a name="l13721"></a>13721         
<a name="l13722"></a>13722         <span class="comment">/* F-Curve Modifiers */</span>
<a name="l13723"></a>13723         <a class="code" href="../../d0/d12/readfile_8c.html#a66ce2efe6b0655233decbc543be280c8">expand_fmodifiers</a>(fd, mainvar, &amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>);
<a name="l13724"></a>13724     }
<a name="l13725"></a>13725 }
<a name="l13726"></a>13726 
<a name="l13727"></a><a class="code" href="../../d0/d12/readfile_8c.html#a997eda3887de1e490477454ed3f6343e">13727</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a997eda3887de1e490477454ed3f6343e">expand_action</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act)
<a name="l13728"></a>13728 {
<a name="l13729"></a>13729     <a class="code" href="../../da/d47/structbActionChannel.html">bActionChannel</a> *chan;
<a name="l13730"></a>13730     
<a name="l13731"></a>13731     <span class="comment">// XXX depreceated - old animation system --------------</span>
<a name="l13732"></a>13732     <span class="keywordflow">for</span> (chan=act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a3d353dd48d5478f1a943612bf1ac2388">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; chan; chan=chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#a5bffc2b5bcea64ed3cfefa67496d1e4b">next</a>) {
<a name="l13733"></a>13733         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#abfaa53320e65308e3da97133a46bd95d">ipo</a>);
<a name="l13734"></a>13734         <a class="code" href="../../d0/d12/readfile_8c.html#afe62eafa0767a5429926c7a839648cc6">expand_constraint_channels</a>(fd, mainvar, &amp;chan-&gt;<a class="code" href="../../da/d47/structbActionChannel.html#ac7fb7ef70989a9a2ee883109d9b098a3">constraintChannels</a>);
<a name="l13735"></a>13735     }
<a name="l13736"></a>13736     <span class="comment">// ---------------------------------------------------</span>
<a name="l13737"></a>13737     
<a name="l13738"></a>13738     <span class="comment">/* F-Curves in Action */</span>
<a name="l13739"></a>13739     <a class="code" href="../../d0/d12/readfile_8c.html#aa7eefab59d4b22362b8e269759ec6628">expand_fcurves</a>(fd, mainvar, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l13740"></a>13740 }
<a name="l13741"></a>13741 
<a name="l13742"></a><a class="code" href="../../d0/d12/readfile_8c.html#a4e0a1422c80e5a7bc583588cedf6c475">13742</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a4e0a1422c80e5a7bc583588cedf6c475">expand_keyingsets</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l13743"></a>13743 {
<a name="l13744"></a>13744     <a class="code" href="../../d4/d2c/structKeyingSet.html">KeyingSet</a> *ks;
<a name="l13745"></a>13745     <a class="code" href="../../dc/d37/structKS__Path.html">KS_Path</a> *ksp;
<a name="l13746"></a>13746     
<a name="l13747"></a>13747     <span class="comment">/* expand the ID-pointers in KeyingSets&#39;s paths */</span>
<a name="l13748"></a>13748     <span class="keywordflow">for</span> (ks= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ks; ks= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a7ebf1a5f7b5ec817bf053a9ace717a07">next</a>) {
<a name="l13749"></a>13749         <span class="keywordflow">for</span> (ksp= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a886536223416f3dbc721fe77a43a350b">paths</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ksp; ksp= ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a1a4c3bf627d5885bdaf1cd80f27d3811">next</a>) {
<a name="l13750"></a>13750             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a5aeacd5ecdb1482cc651db9ba8f6ebd8">id</a>);
<a name="l13751"></a>13751         }
<a name="l13752"></a>13752     }
<a name="l13753"></a>13753 }
<a name="l13754"></a>13754 
<a name="l13755"></a><a class="code" href="../../d0/d12/readfile_8c.html#a08d8d19b42a4d96ccc4b01c192ab1770">13755</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a08d8d19b42a4d96ccc4b01c192ab1770">expand_animdata_nlastrips</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l13756"></a>13756 {
<a name="l13757"></a>13757     <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l13758"></a>13758     
<a name="l13759"></a>13759     <span class="keywordflow">for</span> (strip= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>) {
<a name="l13760"></a>13760         <span class="comment">/* check child strips */</span>
<a name="l13761"></a>13761         <a class="code" href="../../d0/d12/readfile_8c.html#a08d8d19b42a4d96ccc4b01c192ab1770">expand_animdata_nlastrips</a>(fd, mainvar, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a9cc3337843773f5b953893c79784044d">strips</a>);
<a name="l13762"></a>13762         
<a name="l13763"></a>13763         <span class="comment">/* check F-Curves */</span>
<a name="l13764"></a>13764         <a class="code" href="../../d0/d12/readfile_8c.html#aa7eefab59d4b22362b8e269759ec6628">expand_fcurves</a>(fd, mainvar, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a58b04df157b3c8b38a99ef2ac6ba7948">fcurves</a>);
<a name="l13765"></a>13765         
<a name="l13766"></a>13766         <span class="comment">/* check F-Modifiers */</span>
<a name="l13767"></a>13767         <a class="code" href="../../d0/d12/readfile_8c.html#a66ce2efe6b0655233decbc543be280c8">expand_fmodifiers</a>(fd, mainvar, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ac5ddce08df422b81dfa7a65674b5b296">modifiers</a>);
<a name="l13768"></a>13768         
<a name="l13769"></a>13769         <span class="comment">/* relink referenced action */</span>
<a name="l13770"></a>13770         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#af4a3969b3858c5536d1842f7a55f11ac">act</a>);
<a name="l13771"></a>13771     }
<a name="l13772"></a>13772 }
<a name="l13773"></a>13773 
<a name="l13774"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">13774</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt)
<a name="l13775"></a>13775 {
<a name="l13776"></a>13776     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt;
<a name="l13777"></a>13777     
<a name="l13778"></a>13778     <span class="comment">/* own action */</span>
<a name="l13779"></a>13779     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>);
<a name="l13780"></a>13780     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a83b840e7e27825c0cb79de4433a92a03">tmpact</a>);
<a name="l13781"></a>13781     
<a name="l13782"></a>13782     <span class="comment">/* drivers - assume that these F-Curves have driver data to be in this list... */</span>
<a name="l13783"></a>13783     <a class="code" href="../../d0/d12/readfile_8c.html#aa7eefab59d4b22362b8e269759ec6628">expand_fcurves</a>(fd, mainvar, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l13784"></a>13784     
<a name="l13785"></a>13785     <span class="comment">/* nla-data - referenced actions */</span>
<a name="l13786"></a>13786     <span class="keywordflow">for</span> (nlt= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nlt; nlt= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>) 
<a name="l13787"></a>13787         <a class="code" href="../../d0/d12/readfile_8c.html#a08d8d19b42a4d96ccc4b01c192ab1770">expand_animdata_nlastrips</a>(fd, mainvar, &amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>);
<a name="l13788"></a>13788 }   
<a name="l13789"></a>13789 
<a name="l13790"></a><a class="code" href="../../d0/d12/readfile_8c.html#a296318ae034a4392fc6f4fe2702f481e">13790</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a296318ae034a4392fc6f4fe2702f481e">expand_particlesettings</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part)
<a name="l13791"></a>13791 {
<a name="l13792"></a>13792     <span class="keywordtype">int</span> a;
<a name="l13793"></a>13793 
<a name="l13794"></a>13794     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a>);
<a name="l13795"></a>13795     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>);
<a name="l13796"></a>13796     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, part-&gt;eff_group);
<a name="l13797"></a>13797     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4558fec04ca4894122276ad8980afc57">bb_ob</a>);
<a name="l13798"></a>13798     
<a name="l13799"></a>13799     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>)
<a name="l13800"></a>13800         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>);
<a name="l13801"></a>13801 
<a name="l13802"></a>13802     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l13803"></a>13803         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]) {
<a name="l13804"></a>13804             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l13805"></a>13805             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l13806"></a>13806         }
<a name="l13807"></a>13807     }
<a name="l13808"></a>13808 }
<a name="l13809"></a>13809 
<a name="l13810"></a><a class="code" href="../../d0/d12/readfile_8c.html#accca8e09ad92a7b51236aac5db9f6b3f">13810</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#accca8e09ad92a7b51236aac5db9f6b3f">expand_group</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group)
<a name="l13811"></a>13811 {
<a name="l13812"></a>13812     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l13813"></a>13813     
<a name="l13814"></a>13814     <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l13815"></a>13815         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>);
<a name="l13816"></a>13816     }
<a name="l13817"></a>13817 }
<a name="l13818"></a>13818 
<a name="l13819"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad7fb7c22f2f877732646a3596cf06b96">13819</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad7fb7c22f2f877732646a3596cf06b96">expand_key</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key)
<a name="l13820"></a>13820 {
<a name="l13821"></a>13821     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, key-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13822"></a>13822     
<a name="l13823"></a>13823     <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>)
<a name="l13824"></a>13824         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>);
<a name="l13825"></a>13825 }
<a name="l13826"></a>13826 
<a name="l13827"></a><a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">13827</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l13828"></a>13828 {
<a name="l13829"></a>13829     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l13830"></a>13830     
<a name="l13831"></a>13831     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>)
<a name="l13832"></a>13832         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>);
<a name="l13833"></a>13833         
<a name="l13834"></a>13834     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a7ef055ce6415a7293a1bc5fa307dd2b5">gpd</a>)
<a name="l13835"></a>13835         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a7ef055ce6415a7293a1bc5fa307dd2b5">gpd</a>);
<a name="l13836"></a>13836     
<a name="l13837"></a>13837     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l13838"></a>13838         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>!=<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>)
<a name="l13839"></a>13839             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l13840"></a>13840 
<a name="l13841"></a>13841 }
<a name="l13842"></a>13842 
<a name="l13843"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad5ba9cdeb19dd32dc1723fb57b16c7b2">13843</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad5ba9cdeb19dd32dc1723fb57b16c7b2">expand_texture</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex)
<a name="l13844"></a>13844 {
<a name="l13845"></a>13845     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ad2c2c4a8437672ea77fc9cfded61ffaf">ima</a>);
<a name="l13846"></a>13846     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, tex-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13847"></a>13847     
<a name="l13848"></a>13848     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>)
<a name="l13849"></a>13849         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>);
<a name="l13850"></a>13850     
<a name="l13851"></a>13851     <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>)
<a name="l13852"></a>13852         <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(fd, mainvar, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l13853"></a>13853 }
<a name="l13854"></a>13854 
<a name="l13855"></a><a class="code" href="../../d0/d12/readfile_8c.html#a27c834bf3818d0ae387d9a4c05eff8f5">13855</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a27c834bf3818d0ae387d9a4c05eff8f5">expand_brush</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush)
<a name="l13856"></a>13856 {
<a name="l13857"></a>13857     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l13858"></a>13858     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a15f49f4f869d830a7790726017395b31">clone</a>.<a class="code" href="../../db/d3d/structBrushClone.html#a5786aeede42c79da77f44c8a7ed27650">image</a>);
<a name="l13859"></a>13859 }
<a name="l13860"></a>13860 
<a name="l13861"></a><a class="code" href="../../d0/d12/readfile_8c.html#a241e3a26511ae87ba757df7dd8a2e7c8">13861</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a241e3a26511ae87ba757df7dd8a2e7c8">expand_material</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma)
<a name="l13862"></a>13862 {
<a name="l13863"></a>13863     <span class="keywordtype">int</span> a;
<a name="l13864"></a>13864 
<a name="l13865"></a>13865     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l13866"></a>13866         <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]) {
<a name="l13867"></a>13867             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l13868"></a>13868             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l13869"></a>13869         }
<a name="l13870"></a>13870     }
<a name="l13871"></a>13871     
<a name="l13872"></a>13872     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ma-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13873"></a>13873     
<a name="l13874"></a>13874     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>)
<a name="l13875"></a>13875         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>);
<a name="l13876"></a>13876     
<a name="l13877"></a>13877     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>)
<a name="l13878"></a>13878         <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(fd, mainvar, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l13879"></a>13879     
<a name="l13880"></a>13880     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a67df82e791d0a7e8d62425b4d2cbc364">group</a>)
<a name="l13881"></a>13881         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a67df82e791d0a7e8d62425b4d2cbc364">group</a>);
<a name="l13882"></a>13882 }
<a name="l13883"></a>13883 
<a name="l13884"></a><a class="code" href="../../d0/d12/readfile_8c.html#ad3c396a1a96bdd30b98a7fb1dae950a7">13884</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ad3c396a1a96bdd30b98a7fb1dae950a7">expand_lamp</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la)
<a name="l13885"></a>13885 {
<a name="l13886"></a>13886     <span class="keywordtype">int</span> a;
<a name="l13887"></a>13887 
<a name="l13888"></a>13888     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l13889"></a>13889         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]) {
<a name="l13890"></a>13890             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l13891"></a>13891             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l13892"></a>13892         }
<a name="l13893"></a>13893     }
<a name="l13894"></a>13894     
<a name="l13895"></a>13895     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, la-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13896"></a>13896     
<a name="l13897"></a>13897     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>)
<a name="l13898"></a>13898         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>);
<a name="l13899"></a>13899 
<a name="l13900"></a>13900     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>)
<a name="l13901"></a>13901         <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(fd, mainvar, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l13902"></a>13902 }
<a name="l13903"></a>13903 
<a name="l13904"></a><a class="code" href="../../d0/d12/readfile_8c.html#a68b04a925af9f4915f5fa3c1902ed52a">13904</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a68b04a925af9f4915f5fa3c1902ed52a">expand_lattice</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt)
<a name="l13905"></a>13905 {
<a name="l13906"></a>13906     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, lt-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13907"></a>13907     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a17c6975adcc7144ed734252d6038b7d5">key</a>);
<a name="l13908"></a>13908     
<a name="l13909"></a>13909     <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>)
<a name="l13910"></a>13910         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>);
<a name="l13911"></a>13911 }
<a name="l13912"></a>13912 
<a name="l13913"></a>13913 
<a name="l13914"></a><a class="code" href="../../d0/d12/readfile_8c.html#aeb5d7cadd57c2bf57e75400401926135">13914</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aeb5d7cadd57c2bf57e75400401926135">expand_world</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld)
<a name="l13915"></a>13915 {
<a name="l13916"></a>13916     <span class="keywordtype">int</span> a;
<a name="l13917"></a>13917 
<a name="l13918"></a>13918     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l13919"></a>13919         <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]) {
<a name="l13920"></a>13920             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>);
<a name="l13921"></a>13921             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aaf7b9758f217a9aa59a16b1768c2753e">object</a>);
<a name="l13922"></a>13922         }
<a name="l13923"></a>13923     }
<a name="l13924"></a>13924     
<a name="l13925"></a>13925     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, wrld-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13926"></a>13926     
<a name="l13927"></a>13927     <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>)
<a name="l13928"></a>13928         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>);
<a name="l13929"></a>13929 
<a name="l13930"></a>13930     <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>)
<a name="l13931"></a>13931         <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(fd, mainvar, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l13932"></a>13932 }
<a name="l13933"></a>13933 
<a name="l13934"></a>13934 
<a name="l13935"></a><a class="code" href="../../d0/d12/readfile_8c.html#ae37b511bc6ed8db151c6c632621f80f8">13935</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ae37b511bc6ed8db151c6c632621f80f8">expand_mball</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l13936"></a>13936 {
<a name="l13937"></a>13937     <span class="keywordtype">int</span> a;
<a name="l13938"></a>13938 
<a name="l13939"></a>13939     <span class="keywordflow">for</span> (a=0; a&lt;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab8971ac14c6143431474bce14b1ea887">totcol</a>; a++) {
<a name="l13940"></a>13940         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]);
<a name="l13941"></a>13941     }
<a name="l13942"></a>13942     
<a name="l13943"></a>13943     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>)
<a name="l13944"></a>13944         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>);
<a name="l13945"></a>13945 }
<a name="l13946"></a>13946 
<a name="l13947"></a><a class="code" href="../../d0/d12/readfile_8c.html#aba60b61c8638d08424cc54eb10d31e65">13947</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aba60b61c8638d08424cc54eb10d31e65">expand_curve</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l13948"></a>13948 {
<a name="l13949"></a>13949     <span class="keywordtype">int</span> a;
<a name="l13950"></a>13950 
<a name="l13951"></a>13951     <span class="keywordflow">for</span> (a=0; a&lt;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a178aa2fd33adfb5df2b311a7d398ac36">totcol</a>; a++) {
<a name="l13952"></a>13952         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]);
<a name="l13953"></a>13953     }
<a name="l13954"></a>13954     
<a name="l13955"></a>13955     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>);
<a name="l13956"></a>13956     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>);   
<a name="l13957"></a>13957     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>);
<a name="l13958"></a>13958     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>);
<a name="l13959"></a>13959     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>);
<a name="l13960"></a>13960     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l13961"></a>13961     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>);
<a name="l13962"></a>13962     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aee5423fad7444492028435713c64be0f">taperobj</a>);
<a name="l13963"></a>13963     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aab9f61871625a95c78c288429b4b6d74">textoncurve</a>);
<a name="l13964"></a>13964     
<a name="l13965"></a>13965     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>)
<a name="l13966"></a>13966         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>);
<a name="l13967"></a>13967 }
<a name="l13968"></a>13968 
<a name="l13969"></a><a class="code" href="../../d0/d12/readfile_8c.html#a396e216d0ea82b0736f98488ded5efde">13969</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a396e216d0ea82b0736f98488ded5efde">expand_mesh</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l13970"></a>13970 {
<a name="l13971"></a>13971     <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer;
<a name="l13972"></a>13972     <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a> *mtf;
<a name="l13973"></a>13973     <a class="code" href="../../df/de0/structTFace.html">TFace</a> *tf;
<a name="l13974"></a>13974     <span class="keywordtype">int</span> a, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l13975"></a>13975     
<a name="l13976"></a>13976     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>)
<a name="l13977"></a>13977         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>);
<a name="l13978"></a>13978         
<a name="l13979"></a>13979     <span class="keywordflow">for</span> (a=0; a&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>; a++) {
<a name="l13980"></a>13980         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[a]);
<a name="l13981"></a>13981     }
<a name="l13982"></a>13982 
<a name="l13983"></a>13983     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>);
<a name="l13984"></a>13984     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a129e37fe8312d017a74c44f1b508e1d4">texcomesh</a>);
<a name="l13985"></a>13985 
<a name="l13986"></a>13986     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>) {
<a name="l13987"></a>13987         tf= me-&gt;<a class="code" href="../../da/d29/structMesh.html#aecb48907d275067025f6a2d8705f51bf">tface</a>;
<a name="l13988"></a>13988         <span class="keywordflow">for</span> (i=0; i&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; i++, tf++)
<a name="l13989"></a>13989             <span class="keywordflow">if</span> (tf-&gt;<a class="code" href="../../df/de0/structTFace.html#ad2a5955b75abf6c03fef3e362c3ed0db">tpage</a>)
<a name="l13990"></a>13990                 <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, tf-&gt;<a class="code" href="../../df/de0/structTFace.html#ad2a5955b75abf6c03fef3e362c3ed0db">tpage</a>);
<a name="l13991"></a>13991     }
<a name="l13992"></a>13992 
<a name="l13993"></a>13993     <span class="keywordflow">for</span> (a=0; a&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; a++) {
<a name="l13994"></a>13994         layer= &amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>.<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[a];
<a name="l13995"></a>13995 
<a name="l13996"></a>13996         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#af23f4c9ba200ae24e0a1ac80464e7b21">CD_MTFACE</a>) {
<a name="l13997"></a>13997             mtf= (<a class="code" href="../../da/d7f/structMTFace.html">MTFace</a>*)layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>;
<a name="l13998"></a>13998             for (i=0; i&lt;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>; i++, mtf++)
<a name="l13999"></a>13999                 <span class="keywordflow">if</span> (mtf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>)
<a name="l14000"></a>14000                     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, mtf-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>);
<a name="l14001"></a>14001         }
<a name="l14002"></a>14002     }
<a name="l14003"></a>14003 }
<a name="l14004"></a>14004 
<a name="l14005"></a>14005 <span class="comment">/* temp struct used to transport needed info to expand_constraint_cb() */</span>
<a name="l14006"></a><a class="code" href="../../d1/db5/structtConstraintExpandData.html">14006</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/db5/structtConstraintExpandData.html">tConstraintExpandData</a> {
<a name="l14007"></a><a class="code" href="../../d1/db5/structtConstraintExpandData.html#af1b934250a349e7c51ff0e281536b81f">14007</a>     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *<a class="code" href="../../d1/db5/structtConstraintExpandData.html#af1b934250a349e7c51ff0e281536b81f">fd</a>;
<a name="l14008"></a><a class="code" href="../../d1/db5/structtConstraintExpandData.html#a13a3f90325930fdee92804d57598e872">14008</a>     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d1/db5/structtConstraintExpandData.html#a13a3f90325930fdee92804d57598e872">mainvar</a>;
<a name="l14009"></a>14009 } <a class="code" href="../../d0/d12/readfile_8c.html#a1b79fe33dc04d580a899f7a0b1874c8f">tConstraintExpandData</a>;
<a name="l14010"></a>14010 <span class="comment">/* callback function used to expand constraint ID-links */</span>
<a name="l14011"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8fbc575bb84f42e456288480c31769da">14011</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8fbc575bb84f42e456288480c31769da">expand_constraint_cb</a>(<a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(con), <a class="code" href="../../d8/d7e/structID.html">ID</a> **idpoin, <span class="keywordtype">void</span> *userdata)
<a name="l14012"></a>14012 {
<a name="l14013"></a>14013     <a class="code" href="../../d1/db5/structtConstraintExpandData.html">tConstraintExpandData</a> *ced= (<a class="code" href="../../d1/db5/structtConstraintExpandData.html">tConstraintExpandData</a> *)userdata;
<a name="l14014"></a>14014     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(ced-&gt;<a class="code" href="../../d1/db5/structtConstraintExpandData.html#af1b934250a349e7c51ff0e281536b81f">fd</a>, ced-&gt;<a class="code" href="../../d1/db5/structtConstraintExpandData.html#a13a3f90325930fdee92804d57598e872">mainvar</a>, *idpoin);
<a name="l14015"></a>14015 }
<a name="l14016"></a>14016 
<a name="l14017"></a><a class="code" href="../../d0/d12/readfile_8c.html#a1ff494c44611a3f621e070f9a4c92d16">14017</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a1ff494c44611a3f621e070f9a4c92d16">expand_constraints</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l14018"></a>14018 {
<a name="l14019"></a>14019     <a class="code" href="../../d1/db5/structtConstraintExpandData.html">tConstraintExpandData</a> ced;
<a name="l14020"></a>14020     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l14021"></a>14021     
<a name="l14022"></a>14022     <span class="comment">/* relink all ID-blocks used by the constraints */</span>
<a name="l14023"></a>14023     ced.<a class="code" href="../../d1/db5/structtConstraintExpandData.html#af1b934250a349e7c51ff0e281536b81f">fd</a>= fd;
<a name="l14024"></a>14024     ced.<a class="code" href="../../d1/db5/structtConstraintExpandData.html#a13a3f90325930fdee92804d57598e872">mainvar</a>= mainvar;
<a name="l14025"></a>14025     
<a name="l14026"></a>14026     <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#ab7afb39afe46395f0492eb0a57394d59">id_loop_constraints</a>(lb, <a class="code" href="../../d0/d12/readfile_8c.html#a8fbc575bb84f42e456288480c31769da">expand_constraint_cb</a>, &amp;ced);
<a name="l14027"></a>14027     
<a name="l14028"></a>14028     <span class="comment">/* depreceated manual expansion stuff */</span>
<a name="l14029"></a>14029     <span class="keywordflow">for</span> (curcon=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l14030"></a>14030         <span class="keywordflow">if</span> (curcon-&gt;ipo)
<a name="l14031"></a>14031             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, curcon-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l14032"></a>14032     }
<a name="l14033"></a>14033 }
<a name="l14034"></a>14034 
<a name="l14035"></a><a class="code" href="../../d0/d12/readfile_8c.html#aea86233947b0e819baa862309026db86">14035</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aea86233947b0e819baa862309026db86">expand_bones</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../de/de0/structBone.html">Bone</a> *bone)
<a name="l14036"></a>14036 {
<a name="l14037"></a>14037     <a class="code" href="../../de/de0/structBone.html">Bone</a> *curBone;
<a name="l14038"></a>14038 
<a name="l14039"></a>14039     <span class="keywordflow">for</span> (curBone = bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curBone; curBone=curBone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>) {
<a name="l14040"></a>14040         <a class="code" href="../../d0/d12/readfile_8c.html#aea86233947b0e819baa862309026db86">expand_bones</a>(fd, mainvar, curBone);
<a name="l14041"></a>14041     }
<a name="l14042"></a>14042 
<a name="l14043"></a>14043 }
<a name="l14044"></a>14044 
<a name="l14045"></a><a class="code" href="../../d0/d12/readfile_8c.html#a8837e35218b9ebe0b189dad2ddb714ce">14045</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a8837e35218b9ebe0b189dad2ddb714ce">expand_pose</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d3/de4/structbPose.html">bPose</a> *pose)
<a name="l14046"></a>14046 {
<a name="l14047"></a>14047     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *chan;
<a name="l14048"></a>14048 
<a name="l14049"></a>14049     <span class="keywordflow">if</span> (!pose)
<a name="l14050"></a>14050         <span class="keywordflow">return</span>;
<a name="l14051"></a>14051 
<a name="l14052"></a>14052     <span class="keywordflow">for</span> (chan = pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; chan; chan=chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l14053"></a>14053         <a class="code" href="../../d0/d12/readfile_8c.html#a1ff494c44611a3f621e070f9a4c92d16">expand_constraints</a>(fd, mainvar, &amp;chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>);
<a name="l14054"></a>14054         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a5142a64bf664411e5f73166f8305b6c0">custom</a>);
<a name="l14055"></a>14055     }
<a name="l14056"></a>14056 }
<a name="l14057"></a>14057 
<a name="l14058"></a><a class="code" href="../../d0/d12/readfile_8c.html#afff51da4dc370f3b5f248b4d5c4bf53b">14058</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#afff51da4dc370f3b5f248b4d5c4bf53b">expand_armature</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm)
<a name="l14059"></a>14059 {
<a name="l14060"></a>14060     <a class="code" href="../../de/de0/structBone.html">Bone</a> *curBone;
<a name="l14061"></a>14061 
<a name="l14062"></a>14062     <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>)
<a name="l14063"></a>14063         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>);
<a name="l14064"></a>14064 
<a name="l14065"></a>14065     <span class="keywordflow">for</span> (curBone = arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curBone; curBone=curBone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>) {
<a name="l14066"></a>14066         <a class="code" href="../../d0/d12/readfile_8c.html#aea86233947b0e819baa862309026db86">expand_bones</a>(fd, mainvar, curBone);
<a name="l14067"></a>14067     }
<a name="l14068"></a>14068 }
<a name="l14069"></a>14069 
<a name="l14070"></a><a class="code" href="../../d0/d12/readfile_8c.html#a0749dace1845a65eb65a613b2b869d60">14070</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a0749dace1845a65eb65a613b2b869d60">expand_object_expandModifiers</a>(<span class="keywordtype">void</span> *userData, <a class="code" href="../../de/de7/structObject.html">Object</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ob),
<a name="l14071"></a>14071                                               <a class="code" href="../../d8/d7e/structID.html">ID</a> **idpoin)
<a name="l14072"></a>14072 {
<a name="l14073"></a>14073     <span class="keyword">struct </span>{ <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd; <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar; } *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= userData;
<a name="l14074"></a>14074 
<a name="l14075"></a>14075     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;fd;
<a name="l14076"></a>14076     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar= <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;mainvar;
<a name="l14077"></a>14077 
<a name="l14078"></a>14078     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, *idpoin);
<a name="l14079"></a>14079 }
<a name="l14080"></a>14080 
<a name="l14081"></a><a class="code" href="../../d0/d12/readfile_8c.html#a7d954de102a8b67546ce057ec8ae2495">14081</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a7d954de102a8b67546ce057ec8ae2495">expand_object</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l14082"></a>14082 {
<a name="l14083"></a>14083     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l14084"></a>14084     <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens;
<a name="l14085"></a>14085     <a class="code" href="../../dd/d82/structbController.html">bController</a> *cont;
<a name="l14086"></a>14086     <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l14087"></a>14087     <a class="code" href="../../d5/d84/structbActionStrip.html">bActionStrip</a> *strip;
<a name="l14088"></a>14088     <a class="code" href="../../d2/d6a/structPartEff.html">PartEff</a> *paf;
<a name="l14089"></a>14089     <span class="keywordtype">int</span> a;
<a name="l14090"></a>14090 
<a name="l14091"></a>14091     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l14092"></a>14092 
<a name="l14093"></a>14093     <span class="comment">/* expand_object_expandModifier() */</span>
<a name="l14094"></a>14094     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l14095"></a>14095         <span class="keyword">struct </span>{ <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd; <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar; } <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l14096"></a>14096         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.fd= fd;
<a name="l14097"></a>14097         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.mainvar= mainvar;
<a name="l14098"></a>14098 
<a name="l14099"></a>14099         <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#af58b09917325823d100856df77548492">modifiers_foreachIDLink</a>(ob, <a class="code" href="../../d0/d12/readfile_8c.html#a0749dace1845a65eb65a613b2b869d60">expand_object_expandModifiers</a>, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>);
<a name="l14100"></a>14100     }
<a name="l14101"></a>14101 
<a name="l14102"></a>14102     <a class="code" href="../../d0/d12/readfile_8c.html#a8837e35218b9ebe0b189dad2ddb714ce">expand_pose</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l14103"></a>14103     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0cd974818f733c70574e65b0d0a6045b">poselib</a>);
<a name="l14104"></a>14104     <a class="code" href="../../d0/d12/readfile_8c.html#a1ff494c44611a3f621e070f9a4c92d16">expand_constraints</a>(fd, mainvar, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>);
<a name="l14105"></a>14105     
<a name="l14106"></a>14106     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8c7e94f85e702b071092fbe917f0b707">gpd</a>);
<a name="l14107"></a>14107     
<a name="l14108"></a>14108 <span class="comment">// XXX depreceated - old animation system (for version patching only) </span>
<a name="l14109"></a>14109     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;ipo);
<a name="l14110"></a>14110     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;action);
<a name="l14111"></a>14111     
<a name="l14112"></a>14112     <a class="code" href="../../d0/d12/readfile_8c.html#afe62eafa0767a5429926c7a839648cc6">expand_constraint_channels</a>(fd, mainvar, &amp;ob-&gt;constraintChannels);
<a name="l14113"></a>14113 
<a name="l14114"></a>14114     <span class="keywordflow">for</span> (strip=ob-&gt;nlastrips.first; strip; strip=strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4db006cf84d35eed981ef557bdd9f126">next</a>) {
<a name="l14115"></a>14115         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a1c637ba51a26e1cfe1f946a75043d95e">object</a>);
<a name="l14116"></a>14116         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a357e6e808ddbfc7e09a1b9ff256c2275">act</a>);
<a name="l14117"></a>14117         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a2f286a16ff57b174b84b4e4ab262d9f8">ipo</a>);
<a name="l14118"></a>14118     }
<a name="l14119"></a>14119 <span class="comment">// XXX depreceated - old animation system (for version patching only)</span>
<a name="l14120"></a>14120     
<a name="l14121"></a>14121     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)
<a name="l14122"></a>14122         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>);
<a name="l14123"></a>14123     
<a name="l14124"></a>14124     <span class="keywordflow">for</span> (a=0; a&lt;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>; a++) {
<a name="l14125"></a>14125         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>[a]);
<a name="l14126"></a>14126     }
<a name="l14127"></a>14127     
<a name="l14128"></a>14128     paf = <a class="code" href="../../d0/d12/readfile_8c.html#a821f02c4c74428a5a16f6574a9de1f25">do_version_give_parteff_245</a>(ob);
<a name="l14129"></a>14129     <span class="keywordflow">if</span> (paf &amp;&amp; paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a5db52fef13164131ddbbcd82b8824496">group</a>) 
<a name="l14130"></a>14130         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, paf-&gt;<a class="code" href="../../d2/d6a/structPartEff.html#a5db52fef13164131ddbbcd82b8824496">group</a>);
<a name="l14131"></a>14131 
<a name="l14132"></a>14132     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>)
<a name="l14133"></a>14133         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>);
<a name="l14134"></a>14134     
<a name="l14135"></a>14135     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>)
<a name="l14136"></a>14136         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>);
<a name="l14137"></a>14137     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a090fbae25210a2cf69181f143c683f19">proxy_group</a>)
<a name="l14138"></a>14138         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a090fbae25210a2cf69181f143c683f19">proxy_group</a>);
<a name="l14139"></a>14139 
<a name="l14140"></a>14140     <span class="keywordflow">for</span> (psys=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>)
<a name="l14141"></a>14141         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>);
<a name="l14142"></a>14142 
<a name="l14143"></a>14143     sens= ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14144"></a>14144     <span class="keywordflow">while</span> (sens) {
<a name="l14145"></a>14145         <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a>==<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a7c4f8e3b1bd33b18ebc913c6663a088a">SENS_TOUCH</a>) {
<a name="l14146"></a>14146             <a class="code" href="../../dd/d04/structbTouchSensor.html">bTouchSensor</a> *ts= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l14147"></a>14147             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ts-&gt;<a class="code" href="../../dd/d04/structbTouchSensor.html#a5301c555a7f87b899535305d7b27f579">ma</a>);
<a name="l14148"></a>14148         }
<a name="l14149"></a>14149         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a>==<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#aedf7477b9ae594464a6164c3b18fb4d6">SENS_MESSAGE</a>) {
<a name="l14150"></a>14150             <a class="code" href="../../dc/d60/structbMessageSensor.html">bMessageSensor</a> *ms= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>;
<a name="l14151"></a>14151             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ms-&gt;<a class="code" href="../../dc/d60/structbMessageSensor.html#af836ea3b8de2f362e40258b7dbbffc15">fromObject</a>);
<a name="l14152"></a>14152         }
<a name="l14153"></a>14153         sens= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>;
<a name="l14154"></a>14154     }
<a name="l14155"></a>14155 
<a name="l14156"></a>14156     cont= ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae2499a91d26d9dc8829a0505f6008066">controllers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14157"></a>14157     <span class="keywordflow">while</span> (cont) {
<a name="l14158"></a>14158         <span class="keywordflow">if</span> (cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a48474985990dd426df0fa0816b06d3b2">type</a>==<a class="code" href="../../d0/d3e/DNA__controller__types_8h.html#addf43c3897e74c7dc474df500fb02898">CONT_PYTHON</a>) {
<a name="l14159"></a>14159             <a class="code" href="../../d8/d6d/structbPythonCont.html">bPythonCont</a> *pc= cont-&gt;<a class="code" href="../../dd/d82/structbController.html#af6c30d2aedadc64bc687eb503a44b800">data</a>;
<a name="l14160"></a>14160             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, pc-&gt;<a class="code" href="../../d8/d6d/structbPythonCont.html#abb7f168a9357050153e5386f9b4f3bfc">text</a>);
<a name="l14161"></a>14161         }
<a name="l14162"></a>14162         cont= cont-&gt;<a class="code" href="../../dd/d82/structbController.html#abd185fdf6022047bfd51966024e3820b">next</a>;
<a name="l14163"></a>14163     }
<a name="l14164"></a>14164 
<a name="l14165"></a>14165     act= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14166"></a>14166     <span class="keywordflow">while</span> (act) {
<a name="l14167"></a>14167         <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a8886ccc844380010702d2a9cbb991ee3">ACT_SOUND</a>) {
<a name="l14168"></a>14168             <a class="code" href="../../d1/da3/structbSoundActuator.html">bSoundActuator</a> *sa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14169"></a>14169             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sa-&gt;<a class="code" href="../../d1/da3/structbSoundActuator.html#a4d73983f46d44a780d3a82a310c327ca">sound</a>);
<a name="l14170"></a>14170         }
<a name="l14171"></a>14171         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ad0a80e945d2f9f52b83f903c6f0a8bcd">ACT_CAMERA</a>) {
<a name="l14172"></a>14172             <a class="code" href="../../d3/d76/structbCameraActuator.html">bCameraActuator</a> *ca= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14173"></a>14173             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ca-&gt;<a class="code" href="../../d3/d76/structbCameraActuator.html#a24ae0fc57a2890a5d6c062bb9c038fbd">ob</a>);
<a name="l14174"></a>14174         }
<a name="l14175"></a>14175         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0fc0c7354c3624cb0a4b65934480a969">ACT_EDIT_OBJECT</a>) {
<a name="l14176"></a>14176             <a class="code" href="../../d4/d5c/structbEditObjectActuator.html">bEditObjectActuator</a> *eoa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14177"></a>14177             <span class="keywordflow">if</span> (eoa) {
<a name="l14178"></a>14178                 <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a92767cd10e4f3f3564b295d418714088">ob</a>);
<a name="l14179"></a>14179                 <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, eoa-&gt;<a class="code" href="../../d4/d5c/structbEditObjectActuator.html#a49dc73b1e734e62fc62dd00431076f84">me</a>);
<a name="l14180"></a>14180             }
<a name="l14181"></a>14181         }
<a name="l14182"></a>14182         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>) {
<a name="l14183"></a>14183             <a class="code" href="../../d0/d35/structbObjectActuator.html">bObjectActuator</a> *oa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14184"></a>14184             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, oa-&gt;<a class="code" href="../../d0/d35/structbObjectActuator.html#a9cda7111b23b488749f0c8fa2933446e">reference</a>);
<a name="l14185"></a>14185         }
<a name="l14186"></a>14186         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6550919fb970694bc25d165dd88d4309">ACT_ADD_OBJECT</a>) {
<a name="l14187"></a>14187             <a class="code" href="../../dd/dbe/structbAddObjectActuator.html">bAddObjectActuator</a> *aoa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14188"></a>14188             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, aoa-&gt;<a class="code" href="../../dd/dbe/structbAddObjectActuator.html#a851f2a3455b87598a7ff8032c3e93f39">ob</a>);
<a name="l14189"></a>14189         }
<a name="l14190"></a>14190         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af24723332b675766ad1d11f031ac6cd4">ACT_SCENE</a>) {
<a name="l14191"></a>14191             <a class="code" href="../../d8/d6b/structbSceneActuator.html">bSceneActuator</a> *sa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14192"></a>14192             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sa-&gt;<a class="code" href="../../d8/d6b/structbSceneActuator.html#af681370aee48700269f4b544b4d23484">camera</a>);
<a name="l14193"></a>14193             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sa-&gt;<a class="code" href="../../d8/d6b/structbSceneActuator.html#a314795e300bcb88b199365bc3f248364">scene</a>);
<a name="l14194"></a>14194         }
<a name="l14195"></a>14195         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6b9525822dbf86e1fbd601a18a27dcfb">ACT_2DFILTER</a>) {
<a name="l14196"></a>14196             <a class="code" href="../../d1/dd9/structbTwoDFilterActuator.html">bTwoDFilterActuator</a> *tdfa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14197"></a>14197             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, tdfa-&gt;<a class="code" href="../../d1/dd9/structbTwoDFilterActuator.html#a3190cfa555924909cae3720da5417afc">text</a>);
<a name="l14198"></a>14198         }
<a name="l14199"></a>14199         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a64df7df8bf7e040450f186a4ac9c3753">ACT_ACTION</a>) {
<a name="l14200"></a>14200             <a class="code" href="../../d6/d15/structbActionActuator.html">bActionActuator</a> *aa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14201"></a>14201             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a>);
<a name="l14202"></a>14202         }
<a name="l14203"></a>14203         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af3367e7ebe5e98e65421b9a957c6ccb8">ACT_SHAPEACTION</a>) {
<a name="l14204"></a>14204             <a class="code" href="../../d6/d15/structbActionActuator.html">bActionActuator</a> *aa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14205"></a>14205             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, aa-&gt;<a class="code" href="../../d6/d15/structbActionActuator.html#a0b45812757f4dd20bf162b0efea84e1f">act</a>);
<a name="l14206"></a>14206         }
<a name="l14207"></a>14207         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a3adf808ddc137a603bc4d0d92b31882a">ACT_PROPERTY</a>) {
<a name="l14208"></a>14208             <a class="code" href="../../dc/d13/structbPropertyActuator.html">bPropertyActuator</a> *pa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14209"></a>14209             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, pa-&gt;<a class="code" href="../../dc/d13/structbPropertyActuator.html#aeee0b9339f26d6bfcd93549cd6cac816">ob</a>);
<a name="l14210"></a>14210         }
<a name="l14211"></a>14211         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae4015d5dd2b07f1caedc5039e7dd3753">ACT_MESSAGE</a>) {
<a name="l14212"></a>14212             <a class="code" href="../../df/d12/structbMessageActuator.html">bMessageActuator</a> *ma= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14213"></a>14213             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ma-&gt;<a class="code" href="../../df/d12/structbMessageActuator.html#a132d37e6ba7d93be7eb4d5816a04ee41">toObject</a>);
<a name="l14214"></a>14214         }
<a name="l14215"></a>14215         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#aff16c55b5a12651b7c6902a240530c24">ACT_PARENT</a>) {
<a name="l14216"></a>14216             <a class="code" href="../../de/d83/structbParentActuator.html">bParentActuator</a> *pa= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14217"></a>14217             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, pa-&gt;<a class="code" href="../../de/d83/structbParentActuator.html#a3aca4b9991a861728d6a1cac3ef6ccea">ob</a>);
<a name="l14218"></a>14218         }
<a name="l14219"></a>14219         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#aee9a04f8f07032f50c4743a6499405e7">ACT_ARMATURE</a>) {
<a name="l14220"></a>14220             <a class="code" href="../../db/d53/structbArmatureActuator.html">bArmatureActuator</a> *arma= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14221"></a>14221             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, arma-&gt;<a class="code" href="../../db/d53/structbArmatureActuator.html#af047ecce453fd3fbef5b0b512539af34">target</a>);
<a name="l14222"></a>14222         }
<a name="l14223"></a>14223         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>==<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a68b54400142bd60b87940076e4d92471">ACT_STEERING</a>) {
<a name="l14224"></a>14224             <a class="code" href="../../dc/dbe/structbSteeringActuator.html">bSteeringActuator</a> *sta= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>;
<a name="l14225"></a>14225             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sta-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#ab3d481511001e61afb4eda90ce4edb49">target</a>);
<a name="l14226"></a>14226             <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sta-&gt;<a class="code" href="../../dc/dbe/structbSteeringActuator.html#aa72e26ca2f5e0aa5806c211e5d15ea35">navmesh</a>);
<a name="l14227"></a>14227         }
<a name="l14228"></a>14228         act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l14229"></a>14229     }
<a name="l14230"></a>14230 
<a name="l14231"></a>14231     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>)
<a name="l14232"></a>14232         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>);
<a name="l14233"></a>14233     
<a name="l14234"></a>14234 }
<a name="l14235"></a>14235 
<a name="l14236"></a><a class="code" href="../../d0/d12/readfile_8c.html#ac7f36b92383400221f03c33a79545453">14236</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ac7f36b92383400221f03c33a79545453">expand_scene</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l14237"></a>14237 {
<a name="l14238"></a>14238     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l14239"></a>14239     <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl;
<a name="l14240"></a>14240 
<a name="l14241"></a>14241     <span class="keywordflow">for</span> (base= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l14242"></a>14242         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>);
<a name="l14243"></a>14243     }
<a name="l14244"></a>14244     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>);
<a name="l14245"></a>14245     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>);
<a name="l14246"></a>14246     
<a name="l14247"></a>14247     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>)
<a name="l14248"></a>14248         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>);
<a name="l14249"></a>14249     <a class="code" href="../../d0/d12/readfile_8c.html#a4e0a1422c80e5a7bc583588cedf6c475">expand_keyingsets</a>(fd, mainvar, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a61668a1aa7d493a6c770b8cd7a9c9e4e">keyingsets</a>);
<a name="l14250"></a>14250     
<a name="l14251"></a>14251     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af89a023123108ed72002144681d7621b">set</a>)
<a name="l14252"></a>14252         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#af89a023123108ed72002144681d7621b">set</a>);
<a name="l14253"></a>14253     
<a name="l14254"></a>14254     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l14255"></a>14255         <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l14256"></a>14256     
<a name="l14257"></a>14257     <span class="keywordflow">for</span> (srl= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; srl; srl= srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a9363918698634136fa21bafcabd79d27">next</a>) {
<a name="l14258"></a>14258         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#af2bc33ebc78690c013b75f8cd6003f87">mat_override</a>);
<a name="l14259"></a>14259         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a94cbd24a166c1c093fccd583e08cd3ae">light_override</a>);
<a name="l14260"></a>14260     }
<a name="l14261"></a>14261 
<a name="l14262"></a>14262     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.dometext)
<a name="l14263"></a>14263         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6be618f1264d81c98fec00b879000a3a">dome</a>.<a class="code" href="../../d3/d9d/structGameDome.html#a66ee375e57bb5216b7317965976aaadf">warptext</a>);
<a name="l14264"></a>14264         
<a name="l14265"></a>14265     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa06b54d17dc1e7798392886eb3b0923a">gpd</a>)
<a name="l14266"></a>14266         <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa06b54d17dc1e7798392886eb3b0923a">gpd</a>);
<a name="l14267"></a>14267 
<a name="l14268"></a>14268     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>) {
<a name="l14269"></a>14269         <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l14270"></a>14270 
<a name="l14271"></a>14271         <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>, seq) {
<a name="l14272"></a>14272             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a0bb45bdaca3c3d02919dcc0499f3c886">scene</a>);
<a name="l14273"></a>14273             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1a8c9193dbee5f6be3fd20981083fa9f">scene_camera</a>);
<a name="l14274"></a>14274             <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#aa80c3c765c96ab1aefb4a64ca1c5f672">sound</a>);
<a name="l14275"></a>14275         }
<a name="l14276"></a>14276         <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l14277"></a>14277     }
<a name="l14278"></a>14278 
<a name="l14279"></a>14279 <span class="preprocessor">#ifdef DURIAN_CAMERA_SWITCH</span>
<a name="l14280"></a>14280 <span class="preprocessor"></span>    {
<a name="l14281"></a>14281         <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker;
<a name="l14282"></a>14282 
<a name="l14283"></a>14283         <span class="keywordflow">for</span> (marker= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad75df026c409d765b297e18f988b9d93">markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; marker; marker= marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#ae24b020d13fed8c505c8c6405e31d6a6">next</a>) {
<a name="l14284"></a>14284             <span class="keywordflow">if</span> (marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>) {
<a name="l14285"></a>14285                 <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>);
<a name="l14286"></a>14286             }
<a name="l14287"></a>14287         }
<a name="l14288"></a>14288     }
<a name="l14289"></a>14289 <span class="preprocessor">#endif</span>
<a name="l14290"></a>14290 <span class="preprocessor"></span>
<a name="l14291"></a>14291     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a5ff6096f2dbaa433889794ded2733521">clip</a>);
<a name="l14292"></a>14292 }
<a name="l14293"></a>14293 
<a name="l14294"></a><a class="code" href="../../d0/d12/readfile_8c.html#a752e23ff16406c58d5522f2073d0d24c">14294</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a752e23ff16406c58d5522f2073d0d24c">expand_camera</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *ca)
<a name="l14295"></a>14295 {
<a name="l14296"></a>14296     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, ca-&gt;ipo); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l14297"></a>14297     
<a name="l14298"></a>14298     <span class="keywordflow">if</span> (ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>)
<a name="l14299"></a>14299         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>);
<a name="l14300"></a>14300 }
<a name="l14301"></a>14301 
<a name="l14302"></a><a class="code" href="../../d0/d12/readfile_8c.html#a86f69faf68333b684eadc3488736bb7b">14302</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a86f69faf68333b684eadc3488736bb7b">expand_speaker</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *spk)
<a name="l14303"></a>14303 {
<a name="l14304"></a>14304     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#ae00ffd6b3fc6085cc66731770ff837d5">sound</a>);
<a name="l14305"></a>14305 
<a name="l14306"></a>14306     <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>)
<a name="l14307"></a>14307         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>);
<a name="l14308"></a>14308 }
<a name="l14309"></a>14309 
<a name="l14310"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6bda4ffe3d5c2698ce8b94353f73bdd4">14310</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a6bda4ffe3d5c2698ce8b94353f73bdd4">expand_sound</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *snd)
<a name="l14311"></a>14311 {
<a name="l14312"></a>14312     <a class="code" href="../../d0/d12/readfile_8c.html#a17c6f017ebc882c306240f22eda5e1c3">expand_doit</a>(fd, mainvar, snd-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a60f9608a681f9f2baff429a75ec5d757">ipo</a>); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l14313"></a>14313 }
<a name="l14314"></a>14314 
<a name="l14315"></a><a class="code" href="../../d0/d12/readfile_8c.html#aba93d09ba6e4fcd8f7ce00041dd5dbe7">14315</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#aba93d09ba6e4fcd8f7ce00041dd5dbe7">expand_movieclip</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l14316"></a>14316 {
<a name="l14317"></a>14317     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>)
<a name="l14318"></a>14318         <a class="code" href="../../d0/d12/readfile_8c.html#a2da0c33054e38a4f60e9dd84a5e15dca">expand_animdata</a>(fd, mainvar, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>);
<a name="l14319"></a>14319 }
<a name="l14320"></a>14320 
<a name="l14321"></a><a class="code" href="../../d0/d12/readfile_8c.html#a438260ec0010d8f1997df08d1ec30ece">14321</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a438260ec0010d8f1997df08d1ec30ece">expand_main</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar)
<a name="l14322"></a>14322 {
<a name="l14323"></a>14323     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l14324"></a>14324     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l14325"></a>14325     <span class="keywordtype">int</span> a, doit= 1;
<a name="l14326"></a>14326 
<a name="l14327"></a>14327     <span class="keywordflow">if</span> (fd==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l14328"></a>14328 
<a name="l14329"></a>14329     <span class="keywordflow">while</span> (doit) {
<a name="l14330"></a>14330         doit= 0;
<a name="l14331"></a>14331 
<a name="l14332"></a>14332         a= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(mainvar, lbarray);
<a name="l14333"></a>14333         <span class="keywordflow">while</span> (a--) {
<a name="l14334"></a>14334             <span class="keywordtype">id</span>= lbarray[a]-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14335"></a>14335 
<a name="l14336"></a>14336             <span class="keywordflow">while</span> (<span class="keywordtype">id</span>) {
<a name="l14337"></a>14337                 <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8b02b6f9e976b7858a837ebfa99c37bf">LIB_TEST</a>) {
<a name="l14338"></a>14338 
<a name="l14339"></a>14339                     <span class="keywordflow">switch</span>(<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)) {
<a name="l14340"></a>14340 
<a name="l14341"></a>14341                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>:
<a name="l14342"></a>14342                         <a class="code" href="../../d0/d12/readfile_8c.html#a7d954de102a8b67546ce057ec8ae2495">expand_object</a>(fd, mainvar, (<a class="code" href="../../de/de7/structObject.html">Object</a> *)<span class="keywordtype">id</span>);
<a name="l14343"></a>14343                         <span class="keywordflow">break</span>;
<a name="l14344"></a>14344                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>:
<a name="l14345"></a>14345                         <a class="code" href="../../d0/d12/readfile_8c.html#a396e216d0ea82b0736f98488ded5efde">expand_mesh</a>(fd, mainvar, (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)<span class="keywordtype">id</span>);
<a name="l14346"></a>14346                         <span class="keywordflow">break</span>;
<a name="l14347"></a>14347                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ace150506eaf644d92a5110cf45978379">ID_CU</a>:
<a name="l14348"></a>14348                         <a class="code" href="../../d0/d12/readfile_8c.html#aba60b61c8638d08424cc54eb10d31e65">expand_curve</a>(fd, mainvar, (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)<span class="keywordtype">id</span>);
<a name="l14349"></a>14349                         <span class="keywordflow">break</span>;
<a name="l14350"></a>14350                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3e4005eef9876a2cb9d799bdb2a43998">ID_MB</a>:
<a name="l14351"></a>14351                         <a class="code" href="../../d0/d12/readfile_8c.html#ae37b511bc6ed8db151c6c632621f80f8">expand_mball</a>(fd, mainvar, (<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *)<span class="keywordtype">id</span>);
<a name="l14352"></a>14352                         <span class="keywordflow">break</span>;
<a name="l14353"></a>14353                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>:
<a name="l14354"></a>14354                         <a class="code" href="../../d0/d12/readfile_8c.html#ac7f36b92383400221f03c33a79545453">expand_scene</a>(fd, mainvar, (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<span class="keywordtype">id</span>);
<a name="l14355"></a>14355                         <span class="keywordflow">break</span>;
<a name="l14356"></a>14356                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>:
<a name="l14357"></a>14357                         <a class="code" href="../../d0/d12/readfile_8c.html#a241e3a26511ae87ba757df7dd8a2e7c8">expand_material</a>(fd, mainvar, (<a class="code" href="../../d2/d10/structMaterial.html">Material</a> *)<span class="keywordtype">id</span>);
<a name="l14358"></a>14358                         <span class="keywordflow">break</span>;
<a name="l14359"></a>14359                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>:
<a name="l14360"></a>14360                         <a class="code" href="../../d0/d12/readfile_8c.html#ad5ba9cdeb19dd32dc1723fb57b16c7b2">expand_texture</a>(fd, mainvar, (<a class="code" href="../../df/d2d/structTex.html">Tex</a> *)<span class="keywordtype">id</span>);
<a name="l14361"></a>14361                         <span class="keywordflow">break</span>;
<a name="l14362"></a>14362                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>:
<a name="l14363"></a>14363                         <a class="code" href="../../d0/d12/readfile_8c.html#aeb5d7cadd57c2bf57e75400401926135">expand_world</a>(fd, mainvar, (<a class="code" href="../../d7/d3f/structWorld.html">World</a> *)<span class="keywordtype">id</span>);
<a name="l14364"></a>14364                         <span class="keywordflow">break</span>;
<a name="l14365"></a>14365                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad058b07954b2795eadc855a7a354578b">ID_LT</a>:
<a name="l14366"></a>14366                         <a class="code" href="../../d0/d12/readfile_8c.html#a68b04a925af9f4915f5fa3c1902ed52a">expand_lattice</a>(fd, mainvar, (<a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *)<span class="keywordtype">id</span>);
<a name="l14367"></a>14367                         <span class="keywordflow">break</span>;
<a name="l14368"></a>14368                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>:
<a name="l14369"></a>14369                         <a class="code" href="../../d0/d12/readfile_8c.html#ad3c396a1a96bdd30b98a7fb1dae950a7">expand_lamp</a>(fd, mainvar,(<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *)<span class="keywordtype">id</span>);
<a name="l14370"></a>14370                         <span class="keywordflow">break</span>;
<a name="l14371"></a>14371                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a46c0b029a6e8fc3d7ebb18311b83397d">ID_KE</a>:
<a name="l14372"></a>14372                         <a class="code" href="../../d0/d12/readfile_8c.html#ad7fb7c22f2f877732646a3596cf06b96">expand_key</a>(fd, mainvar, (<a class="code" href="../../d1/d9e/structKey.html">Key</a> *)<span class="keywordtype">id</span>);
<a name="l14373"></a>14373                         <span class="keywordflow">break</span>;
<a name="l14374"></a>14374                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82bdb2fdea7abee55d993c0210101273">ID_CA</a>:
<a name="l14375"></a>14375                         <a class="code" href="../../d0/d12/readfile_8c.html#a752e23ff16406c58d5522f2073d0d24c">expand_camera</a>(fd, mainvar, (<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *)<span class="keywordtype">id</span>);
<a name="l14376"></a>14376                         <span class="keywordflow">break</span>;
<a name="l14377"></a>14377                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0cd81e8a0b1724426ed2d1e36218cdf6">ID_SPK</a>:
<a name="l14378"></a>14378                         <a class="code" href="../../d0/d12/readfile_8c.html#a86f69faf68333b684eadc3488736bb7b">expand_speaker</a>(fd, mainvar,(<a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *)<span class="keywordtype">id</span>);
<a name="l14379"></a>14379                         <span class="keywordflow">break</span>;
<a name="l14380"></a>14380                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3bae74282a62fb44842ff3767a86ec70">ID_SO</a>:
<a name="l14381"></a>14381                         <a class="code" href="../../d0/d12/readfile_8c.html#a6bda4ffe3d5c2698ce8b94353f73bdd4">expand_sound</a>(fd, mainvar, (<a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *)<span class="keywordtype">id</span>);
<a name="l14382"></a>14382                         <span class="keywordflow">break</span>;
<a name="l14383"></a>14383                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae4ba19f70b08895557ef00b489e7d255">ID_AR</a>:
<a name="l14384"></a>14384                         <a class="code" href="../../d0/d12/readfile_8c.html#afff51da4dc370f3b5f248b4d5c4bf53b">expand_armature</a>(fd, mainvar, (<a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *)<span class="keywordtype">id</span>);
<a name="l14385"></a>14385                         <span class="keywordflow">break</span>;
<a name="l14386"></a>14386                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>:
<a name="l14387"></a>14387                         <a class="code" href="../../d0/d12/readfile_8c.html#a997eda3887de1e490477454ed3f6343e">expand_action</a>(fd, mainvar, (<a class="code" href="../../d1/d48/structbAction.html">bAction</a> *)<span class="keywordtype">id</span>); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l14388"></a>14388                         <span class="keywordflow">break</span>;
<a name="l14389"></a>14389                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afc8c3d5178b4130eee3e7542ef0dcae7">ID_GR</a>:
<a name="l14390"></a>14390                         <a class="code" href="../../d0/d12/readfile_8c.html#accca8e09ad92a7b51236aac5db9f6b3f">expand_group</a>(fd, mainvar, (<a class="code" href="../../d4/d91/structGroup.html">Group</a> *)<span class="keywordtype">id</span>);
<a name="l14391"></a>14391                         <span class="keywordflow">break</span>;
<a name="l14392"></a>14392                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>:
<a name="l14393"></a>14393                         <a class="code" href="../../d0/d12/readfile_8c.html#a12817c077eda8e8903746850d75804f3">expand_nodetree</a>(fd, mainvar, (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)<span class="keywordtype">id</span>);
<a name="l14394"></a>14394                         <span class="keywordflow">break</span>;
<a name="l14395"></a>14395                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7f2ccbf688d8c6763420cb2fe028e5a">ID_BR</a>:
<a name="l14396"></a>14396                         <a class="code" href="../../d0/d12/readfile_8c.html#a27c834bf3818d0ae387d9a4c05eff8f5">expand_brush</a>(fd, mainvar, (<a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *)<span class="keywordtype">id</span>);
<a name="l14397"></a>14397                         <span class="keywordflow">break</span>;
<a name="l14398"></a>14398                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a5856d1dba712ee1a816c279762743c1b">ID_IP</a>:
<a name="l14399"></a>14399                         <a class="code" href="../../d0/d12/readfile_8c.html#adb7c8af82acfad94ad6a2b4949d8bd81">expand_ipo</a>(fd, mainvar, (<a class="code" href="../../d2/dc5/structIpo.html">Ipo</a> *)<span class="keywordtype">id</span>); <span class="comment">// XXX depreceated - old animation system</span>
<a name="l14400"></a>14400                         <span class="keywordflow">break</span>;
<a name="l14401"></a>14401                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa64d54c8b860f4a2c7cabc743f60512e">ID_PA</a>:
<a name="l14402"></a>14402                         <a class="code" href="../../d0/d12/readfile_8c.html#a296318ae034a4392fc6f4fe2702f481e">expand_particlesettings</a>(fd, mainvar, (<a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *)<span class="keywordtype">id</span>);
<a name="l14403"></a>14403                         <span class="keywordflow">break</span>;
<a name="l14404"></a>14404                     <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a7f8c4173f43796897d92d5c2ac8ec697">ID_MC</a>:
<a name="l14405"></a>14405                         <a class="code" href="../../d0/d12/readfile_8c.html#aba93d09ba6e4fcd8f7ce00041dd5dbe7">expand_movieclip</a>(fd, mainvar, (<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *)<span class="keywordtype">id</span>);
<a name="l14406"></a>14406                         <span class="keywordflow">break</span>;
<a name="l14407"></a>14407                     }
<a name="l14408"></a>14408 
<a name="l14409"></a>14409                     doit= 1;
<a name="l14410"></a>14410                     <span class="keywordtype">id</span>-&gt;flag -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8b02b6f9e976b7858a837ebfa99c37bf">LIB_TEST</a>;
<a name="l14411"></a>14411 
<a name="l14412"></a>14412                 }
<a name="l14413"></a>14413                 <span class="keywordtype">id</span>= <span class="keywordtype">id</span>-&gt;next;
<a name="l14414"></a>14414             }
<a name="l14415"></a>14415         }
<a name="l14416"></a>14416     }
<a name="l14417"></a>14417 }
<a name="l14418"></a>14418 
<a name="l14419"></a><a class="code" href="../../d0/d12/readfile_8c.html#a5ab8ac4a9a5d65d1d77f0c45a3bb7dbf">14419</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#a5ab8ac4a9a5d65d1d77f0c45a3bb7dbf">object_in_any_scene</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l14420"></a>14420 {
<a name="l14421"></a>14421     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l14422"></a>14422     
<a name="l14423"></a>14423     <span class="keywordflow">for</span> (sce= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l14424"></a>14424         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#af038ab52dca2267b6418721c13b81e74">object_in_scene</a>(ob, sce))
<a name="l14425"></a>14425             <span class="keywordflow">return</span> 1;
<a name="l14426"></a>14426     <span class="keywordflow">return</span> 0;
<a name="l14427"></a>14427 }
<a name="l14428"></a>14428 
<a name="l14429"></a><a class="code" href="../../d0/d12/readfile_8c.html#a22b02b46f9954186d11ebec786292043">14429</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a22b02b46f9954186d11ebec786292043">give_base_to_objects</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *lib, <span class="keyword">const</span> <span class="keywordtype">short</span> idcode, <span class="keyword">const</span> <span class="keywordtype">short</span> is_link)
<a name="l14430"></a>14430 {
<a name="l14431"></a>14431     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l14432"></a>14432     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l14433"></a>14433     <span class="keyword">const</span> <span class="keywordtype">short</span> is_group_append= (is_link==<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> &amp;&amp; idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#afc8c3d5178b4130eee3e7542ef0dcae7">ID_GR</a>);
<a name="l14434"></a>14434 
<a name="l14435"></a>14435     <span class="comment">/* give all objects which are LIB_INDIRECT a base, or for a group when *lib has been set */</span>
<a name="l14436"></a>14436     <span class="keywordflow">for</span> (ob= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l14437"></a>14437         
<a name="l14438"></a>14438         <span class="keywordflow">if</span> ( ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab205643c2c50ad2f8b3555a5d2314924">LIB_INDIRECT</a> ) {
<a name="l14439"></a>14439             
<a name="l14440"></a>14440             <span class="comment">/* IF below is quite confusing!</span>
<a name="l14441"></a>14441 <span class="comment">             * if we are appending, but this object wasnt just added along with a group,</span>
<a name="l14442"></a>14442 <span class="comment">             * then this is already used indirectly in the scene somewhere else and we didnt just append it.</span>
<a name="l14443"></a>14443 <span class="comment">             *</span>
<a name="l14444"></a>14444 <span class="comment">             * (ob-&gt;id.flag &amp; LIB_PRE_EXISTING)==0 means that this is a newly appended object - Campbell */</span>
<a name="l14445"></a>14445             <span class="keywordflow">if</span> (is_group_append==0 || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afe13a862d1bd4ab218a014d5b093fb63">LIB_PRE_EXISTING</a>)==0) {
<a name="l14446"></a>14446                 
<a name="l14447"></a>14447                 <span class="keywordtype">int</span> do_it= 0;
<a name="l14448"></a>14448                 
<a name="l14449"></a>14449                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==0) {
<a name="l14450"></a>14450                     do_it= 1;
<a name="l14451"></a>14451                 }
<a name="l14452"></a>14452                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#afc8c3d5178b4130eee3e7542ef0dcae7">ID_GR</a>) {
<a name="l14453"></a>14453                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==1 &amp;&amp; is_link==<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==lib) {
<a name="l14454"></a>14454                         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>) &amp;&amp; <a class="code" href="../../d0/d12/readfile_8c.html#a5ab8ac4a9a5d65d1d77f0c45a3bb7dbf">object_in_any_scene</a>(mainvar, ob)==0) {
<a name="l14455"></a>14455                             do_it= 1;
<a name="l14456"></a>14456                         }
<a name="l14457"></a>14457                     }
<a name="l14458"></a>14458                 }
<a name="l14459"></a>14459                 <span class="keywordflow">else</span> {
<a name="l14460"></a>14460                     <span class="comment">/* when appending, make sure any indirectly loaded objects</span>
<a name="l14461"></a>14461 <span class="comment">                     * get a base else they cant be accessed at all [#27437] */</span>
<a name="l14462"></a>14462                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==1 &amp;&amp; is_link==<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==lib) {
<a name="l14463"></a>14463 
<a name="l14464"></a>14464                         <span class="comment">/* we may be appending from a scene where we already</span>
<a name="l14465"></a>14465 <span class="comment">                         *  have a linked object which is not in any scene [#27616] */</span>
<a name="l14466"></a>14466                         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afe13a862d1bd4ab218a014d5b093fb63">LIB_PRE_EXISTING</a>)==0) {
<a name="l14467"></a>14467 
<a name="l14468"></a>14468                             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d12/readfile_8c.html#a5ab8ac4a9a5d65d1d77f0c45a3bb7dbf">object_in_any_scene</a>(mainvar, ob)==0) {
<a name="l14469"></a>14469                                 do_it= 1;
<a name="l14470"></a>14470                             }
<a name="l14471"></a>14471                         }
<a name="l14472"></a>14472                     }
<a name="l14473"></a>14473                 }
<a name="l14474"></a>14474 
<a name="l14475"></a>14475                 <span class="keywordflow">if</span> (do_it) {
<a name="l14476"></a>14476                     base= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>( <span class="keyword">sizeof</span>(<a class="code" href="../../d3/da9/structBase.html">Base</a>), <span class="stringliteral">&quot;add_ext_base&quot;</span>);
<a name="l14477"></a>14477                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>), base);
<a name="l14478"></a>14478                     base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>;
<a name="l14479"></a>14479                     base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>= ob;
<a name="l14480"></a>14480                     base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a>;
<a name="l14481"></a>14481                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l14482"></a>14482                     
<a name="l14483"></a>14483                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab205643c2c50ad2f8b3555a5d2314924">LIB_INDIRECT</a>;
<a name="l14484"></a>14484                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a48cc004c21e097c0d7c1c5fa8dc03b96">LIB_EXTERN</a>;
<a name="l14485"></a>14485                 }
<a name="l14486"></a>14486             }
<a name="l14487"></a>14487         }
<a name="l14488"></a>14488     }
<a name="l14489"></a>14489 }
<a name="l14490"></a>14490 
<a name="l14491"></a><a class="code" href="../../d0/d12/readfile_8c.html#adb86884b5ef1a06302e55233ac65605f">14491</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#adb86884b5ef1a06302e55233ac65605f">give_base_to_groups</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene)
<a name="l14492"></a>14492 {
<a name="l14493"></a>14493     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l14494"></a>14494 
<a name="l14495"></a>14495     <span class="comment">/* give all objects which are LIB_INDIRECT a base, or for a group when *lib has been set */</span>
<a name="l14496"></a>14496     <span class="keywordflow">for</span> (group= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l14497"></a>14497         <span class="keywordflow">if</span> (((group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab205643c2c50ad2f8b3555a5d2314924">LIB_INDIRECT</a>)==0 &amp;&amp; (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afe13a862d1bd4ab218a014d5b093fb63">LIB_PRE_EXISTING</a>)==0)) {
<a name="l14498"></a>14498             <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l14499"></a>14499 
<a name="l14500"></a>14500             <span class="comment">/* add_object(...) messes with the selection */</span>
<a name="l14501"></a>14501             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/BKE__object_8h.html#a470a714ef5b3e7fb97f5c35df7d6b3f8">add_only_object</a>(<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>, group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l14502"></a>14502             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>;
<a name="l14503"></a>14503             ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a>;
<a name="l14504"></a>14504 
<a name="l14505"></a>14505             <span class="comment">/* assign the base */</span>
<a name="l14506"></a>14506             base= <a class="code" href="../../d8/d53/BKE__scene_8h.html#a193ea92ce1fbcb89b8320ed73463819b">scene_add_base</a>(scene, ob);
<a name="l14507"></a>14507             base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l14508"></a>14508             base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a>= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a>;
<a name="l14509"></a>14509             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#acd3a68b1b095992c7f50c74a480549bd">OB_RECALC_TIME</a>;
<a name="l14510"></a>14510             scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>= base;
<a name="l14511"></a>14511 
<a name="l14512"></a>14512             <span class="comment">/* assign the group */</span>
<a name="l14513"></a>14513             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>= group;
<a name="l14514"></a>14514             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa1086c43316c4611714f7e459356873e">OB_DUPLIGROUP</a>;
<a name="l14515"></a>14515             <a class="code" href="../../d8/db1/BKE__library_8h.html#a16cc53dc9c28e8f37500f0f255009876">rename_id</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l14516"></a>14516             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a56283253ed00c7461cae7602135fbba9">loc</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a237f7209bae91bebb60015a0fb2001fe">cursor</a>);
<a name="l14517"></a>14517         }
<a name="l14518"></a>14518     }
<a name="l14519"></a>14519 }
<a name="l14520"></a>14520 
<a name="l14521"></a>14521 <span class="comment">/* returns true if the item was found</span>
<a name="l14522"></a>14522 <span class="comment"> * but it may already have already been appended/linked */</span>
<a name="l14523"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2888b875b0c61288ab05fd817c0427a5">14523</a> <span class="keyword">static</span> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a2888b875b0c61288ab05fd817c0427a5">append_named_part</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *idname, <span class="keyword">const</span> <span class="keywordtype">short</span> idcode)
<a name="l14524"></a>14524 {
<a name="l14525"></a>14525     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead;
<a name="l14526"></a>14526     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14527"></a>14527     <span class="keywordtype">int</span> found=0;
<a name="l14528"></a>14528 
<a name="l14529"></a>14529     <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); bhead; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead)) {
<a name="l14530"></a>14530         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==idcode) {
<a name="l14531"></a>14531             <span class="keyword">const</span> <span class="keywordtype">char</span> *idname_test= <a class="code" href="../../d0/d12/readfile_8c.html#a6a83e53ed1153de6a247728039e777c7">bhead_id_name</a>(fd, bhead);
<a name="l14532"></a>14532 
<a name="l14533"></a>14533             <span class="keywordflow">if</span> (strcmp(idname_test + 2, idname)==0) {
<a name="l14534"></a>14534                 found= 1;
<a name="l14535"></a>14535                 <span class="keywordtype">id</span>= <a class="code" href="../../d0/d12/readfile_8c.html#ad0655f0cabe15c0b66aa9c70d4308258">is_yet_read</a>(fd, mainl, bhead);
<a name="l14536"></a>14536                 <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l14537"></a>14537                     <span class="comment">/* not read yet */</span>
<a name="l14538"></a>14538                     <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, mainl, bhead, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aaddd3ce1158724f0f876d24a0c6e4b40">LIB_TESTEXT</a>, &amp;<span class="keywordtype">id</span>);
<a name="l14539"></a>14539 
<a name="l14540"></a>14540                     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>) {
<a name="l14541"></a>14541                         <span class="comment">/* sort by name in list */</span>
<a name="l14542"></a>14542                         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb= <a class="code" href="../../d8/db1/BKE__library_8h.html#a2dc345b18171d710d51f14d814121381">which_libbase</a>(mainl, idcode);
<a name="l14543"></a>14543                         <a class="code" href="../../d8/db1/BKE__library_8h.html#a07258c2c73c810baf5ffdee96bafc98b">id_sort_by_name</a>(lb, <span class="keywordtype">id</span>);
<a name="l14544"></a>14544                     }
<a name="l14545"></a>14545                 }
<a name="l14546"></a>14546                 <span class="keywordflow">else</span> {
<a name="l14547"></a>14547                     <span class="comment">/* already linked */</span>
<a name="l14548"></a>14548                     printf(<span class="stringliteral">&quot;append: already linked\n&quot;</span>);
<a name="l14549"></a>14549                     <a class="code" href="../../d0/d12/readfile_8c.html#acf5eba43aa7cf86f0e50dcc576f3f3de">oldnewmap_insert</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>, bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>, <span class="keywordtype">id</span>, 1);
<a name="l14550"></a>14550                     <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab205643c2c50ad2f8b3555a5d2314924">LIB_INDIRECT</a>) {
<a name="l14551"></a>14551                         <span class="keywordtype">id</span>-&gt;flag -= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab205643c2c50ad2f8b3555a5d2314924">LIB_INDIRECT</a>;
<a name="l14552"></a>14552                         <span class="keywordtype">id</span>-&gt;flag |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a48cc004c21e097c0d7c1c5fa8dc03b96">LIB_EXTERN</a>;
<a name="l14553"></a>14553                     }
<a name="l14554"></a>14554                 }
<a name="l14555"></a>14555 
<a name="l14556"></a>14556                 <span class="keywordflow">break</span>;
<a name="l14557"></a>14557             }
<a name="l14558"></a>14558         }
<a name="l14559"></a>14559         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>) {
<a name="l14560"></a>14560             <span class="keywordflow">break</span>;
<a name="l14561"></a>14561         }
<a name="l14562"></a>14562     }
<a name="l14563"></a>14563 
<a name="l14564"></a>14564     <span class="comment">/* if we found the id but the id is NULL, this is really bad */</span>
<a name="l14565"></a>14565     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((found != 0) == (<span class="keywordtype">id</span> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l14566"></a>14566 
<a name="l14567"></a>14567     <span class="keywordflow">return</span> found ? <span class="keywordtype">id</span> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14568"></a>14568 }
<a name="l14569"></a>14569 
<a name="l14570"></a><a class="code" href="../../d0/d12/readfile_8c.html#a654bdd55381cb5d5015e9e138866e67c">14570</a> <span class="keyword">static</span> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../d0/d12/readfile_8c.html#a654bdd55381cb5d5015e9e138866e67c">append_named_part_ex</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *idname, <span class="keyword">const</span> <span class="keywordtype">int</span> idcode, <span class="keyword">const</span> <span class="keywordtype">int</span> flag)
<a name="l14571"></a>14571 {
<a name="l14572"></a>14572     <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= <a class="code" href="../../d0/d12/readfile_8c.html#a2888b875b0c61288ab05fd817c0427a5">append_named_part</a>(mainl, fd, idname, idcode);
<a name="l14573"></a>14573 
<a name="l14574"></a>14574     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; (<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>)) {    <span class="comment">/* loose object: give a base */</span>
<a name="l14575"></a>14575         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C); <span class="comment">/* can be NULL */</span>
<a name="l14576"></a>14576         <span class="keywordflow">if</span> (scene) {
<a name="l14577"></a>14577             <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l14578"></a>14578             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l14579"></a>14579 
<a name="l14580"></a>14580             base= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>( <span class="keyword">sizeof</span>(<a class="code" href="../../d3/da9/structBase.html">Base</a>), <span class="stringliteral">&quot;app_nam_part&quot;</span>);
<a name="l14581"></a>14581             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>, base);
<a name="l14582"></a>14582 
<a name="l14583"></a>14583             ob= (<a class="code" href="../../de/de7/structObject.html">Object</a> *)<span class="keywordtype">id</span>;
<a name="l14584"></a>14584 
<a name="l14585"></a>14585             <span class="comment">/* link at active layer (view3d-&gt;lay if in context, else scene-&gt;lay */</span>
<a name="l14586"></a>14586             <span class="keywordflow">if</span> ((flag &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a44f3a31aa7711c9c34542016d6e99eb9">FILE_ACTIVELAY</a>)) {
<a name="l14587"></a>14587                 <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C);
<a name="l14588"></a>14588                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a> = v3d ? v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a20eb2672523f97b49bc5fce33828021a">layact</a> : scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a>;
<a name="l14589"></a>14589             }
<a name="l14590"></a>14590 
<a name="l14591"></a>14591             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a>= 0;
<a name="l14592"></a>14592             base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>;
<a name="l14593"></a>14593             base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>= ob;
<a name="l14594"></a>14594             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l14595"></a>14595 
<a name="l14596"></a>14596             <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a31cb59b3549ede3657dc5afb0114abe8">FILE_AUTOSELECT</a>) {
<a name="l14597"></a>14597                 base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l14598"></a>14598                 base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a>;
<a name="l14599"></a>14599                 <span class="comment">/* do NOT make base active here! screws up GUI stuff, if you want it do it on src/ level */</span>
<a name="l14600"></a>14600             }
<a name="l14601"></a>14601         }
<a name="l14602"></a>14602     }
<a name="l14603"></a>14603 
<a name="l14604"></a>14604     <span class="keywordflow">return</span> id;
<a name="l14605"></a>14605 }
<a name="l14606"></a>14606 
<a name="l14607"></a><a class="code" href="../../d0/d12/readfile_8c.html#a6474ae8d8a8607aa8edb2da386de9301">14607</a> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d01/BLO__readfile_8h.html#aaf13182f65db0c51199fda2cc1cc37a7">BLO_library_append_named_part</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl, <a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a>** bh, <span class="keyword">const</span> <span class="keywordtype">char</span> *idname, <span class="keyword">const</span> <span class="keywordtype">int</span> idcode)
<a name="l14608"></a>14608 {
<a name="l14609"></a>14609     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= (<a class="code" href="../../d3/db0/structFileData.html">FileData</a>*)(*bh);
<a name="l14610"></a>14610     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2888b875b0c61288ab05fd817c0427a5">append_named_part</a>(mainl, fd, idname, idcode);
<a name="l14611"></a>14611 }
<a name="l14612"></a>14612 
<a name="l14613"></a><a class="code" href="../../d0/d12/readfile_8c.html#adf8fb6e6a9996a0d1dd726d33de04e79">14613</a> <a class="code" href="../../d8/d7e/structID.html">ID</a> *<a class="code" href="../../da/d01/BLO__readfile_8h.html#adbad6d6fb6347517de0d41685d2a8597">BLO_library_append_named_part_ex</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl, <a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a>** bh, <span class="keyword">const</span> <span class="keywordtype">char</span> *idname, <span class="keyword">const</span> <span class="keywordtype">int</span> idcode, <span class="keyword">const</span> <span class="keywordtype">short</span> flag)
<a name="l14614"></a>14614 {
<a name="l14615"></a>14615     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= (<a class="code" href="../../d3/db0/structFileData.html">FileData</a>*)(*bh);
<a name="l14616"></a>14616     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#a654bdd55381cb5d5015e9e138866e67c">append_named_part_ex</a>(C, mainl, fd, idname, idcode, flag);
<a name="l14617"></a>14617 }
<a name="l14618"></a>14618 
<a name="l14619"></a><a class="code" href="../../d0/d12/readfile_8c.html#ab65901e3f7544b06c679cf6408bc58a2">14619</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#ab65901e3f7544b06c679cf6408bc58a2">append_id_part</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d8/d7e/structID.html">ID</a> **id_r)
<a name="l14620"></a>14620 {
<a name="l14621"></a>14621     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bhead;
<a name="l14622"></a>14622 
<a name="l14623"></a>14623     <span class="keywordflow">for</span> (bhead= <a class="code" href="../../d0/d12/readfile_8c.html#a58434e1620b03636466b700fafed81d2">blo_firstbhead</a>(fd); bhead; bhead= <a class="code" href="../../d0/d12/readfile_8c.html#aada07f0ace2d061bd20f694dd04f5991">blo_nextbhead</a>(fd, bhead)) {
<a name="l14624"></a>14624         <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a> == <a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)) {
<a name="l14625"></a>14625 
<a name="l14626"></a>14626             <span class="keywordflow">if</span> (strcmp(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>, <a class="code" href="../../d0/d12/readfile_8c.html#a6a83e53ed1153de6a247728039e777c7">bhead_id_name</a>(fd, bhead))==0) {
<a name="l14627"></a>14627                 <span class="keywordtype">id</span>-&gt;flag &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a04f8870815d984fe3df7edaf5f1a4aca">LIB_READ</a>;
<a name="l14628"></a>14628                 <span class="keywordtype">id</span>-&gt;flag |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8b02b6f9e976b7858a837ebfa99c37bf">LIB_TEST</a>;
<a name="l14629"></a>14629 <span class="comment">//              printf(&quot;read lib block %s\n&quot;, id-&gt;name);</span>
<a name="l14630"></a>14630                 <a class="code" href="../../d0/d12/readfile_8c.html#ae6c13c3d37c925d04f3c6097a6c9d35c">read_libblock</a>(fd, mainvar, bhead, id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a>, id_r);
<a name="l14631"></a>14631 
<a name="l14632"></a>14632                 <span class="keywordflow">break</span>;
<a name="l14633"></a>14633             }
<a name="l14634"></a>14634         }
<a name="l14635"></a>14635         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bhead-&gt;<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>==<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>)
<a name="l14636"></a>14636             <span class="keywordflow">break</span>;
<a name="l14637"></a>14637     }
<a name="l14638"></a>14638 }
<a name="l14639"></a>14639 
<a name="l14640"></a>14640 <span class="comment">/* common routine to append/link something from a library */</span>
<a name="l14641"></a>14641 
<a name="l14642"></a><a class="code" href="../../d0/d12/readfile_8c.html#afad879bbad3125e3142579b6314fe4a1">14642</a> <span class="keyword">static</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a>* <a class="code" href="../../d0/d12/readfile_8c.html#afad879bbad3125e3142579b6314fe4a1">library_append_begin</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> **fd, <span class="keyword">const</span> <span class="keywordtype">char</span> *filepath)
<a name="l14643"></a>14643 {
<a name="l14644"></a>14644     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl;
<a name="l14645"></a>14645 
<a name="l14646"></a>14646     <span class="comment">/* make mains */</span>
<a name="l14647"></a>14647     <a class="code" href="../../d0/d12/readfile_8c.html#aaf5f25a816c0bd974a821b502bcb6129">blo_split_main</a>(&amp;(*fd)-&gt;mainlist, mainvar);
<a name="l14648"></a>14648 
<a name="l14649"></a>14649     <span class="comment">/* which one do we need? */</span>
<a name="l14650"></a>14650     mainl = <a class="code" href="../../d0/d12/readfile_8c.html#a24a5d36cb3cf8466e0e301f6b453b437">blo_find_main</a>(*fd, &amp;(*fd)-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, filepath, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l14651"></a>14651     
<a name="l14652"></a>14652     <span class="comment">/* needed for do_version */</span>
<a name="l14653"></a>14653     mainl-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>= (*fd)-&gt;fileversion;
<a name="l14654"></a>14654     <a class="code" href="../../d0/d12/readfile_8c.html#aec40e10a1816657984efe58afbe3617a">read_file_version</a>(*fd, mainl);
<a name="l14655"></a>14655     
<a name="l14656"></a>14656     <span class="keywordflow">return</span> mainl;
<a name="l14657"></a>14657 }
<a name="l14658"></a>14658 
<a name="l14659"></a><a class="code" href="../../d0/d12/readfile_8c.html#a9e64d0f9a2849b3f6a84386994e2f201">14659</a> <a class="code" href="../../d0/dc0/structMain.html">Main</a>* <a class="code" href="../../da/d01/BLO__readfile_8h.html#a832d387a5938edeb69c1685ec67e7b7b">BLO_library_append_begin</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a>** bh, <span class="keyword">const</span> <span class="keywordtype">char</span> *filepath)
<a name="l14660"></a>14660 {
<a name="l14661"></a>14661     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= (<a class="code" href="../../d3/db0/structFileData.html">FileData</a>*)(*bh);
<a name="l14662"></a>14662     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#afad879bbad3125e3142579b6314fe4a1">library_append_begin</a>(mainvar, &amp;fd, filepath);
<a name="l14663"></a>14663 }
<a name="l14664"></a>14664 
<a name="l14665"></a>14665 
<a name="l14666"></a>14666 <span class="comment">/* Context == NULL signifies not to do any scene manipulation */</span>
<a name="l14667"></a><a class="code" href="../../d0/d12/readfile_8c.html#a2499f8408d72ec6dc6d3f235882f33e6">14667</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a2499f8408d72ec6dc6d3f235882f33e6">library_append_end</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl, <a class="code" href="../../d3/db0/structFileData.html">FileData</a> **fd, <span class="keywordtype">int</span> idcode, <span class="keywordtype">short</span> flag)
<a name="l14668"></a>14668 {
<a name="l14669"></a>14669     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar;
<a name="l14670"></a>14670     <a class="code" href="../../da/d4d/structLibrary.html">Library</a> *curlib;
<a name="l14671"></a>14671 
<a name="l14672"></a>14672     <span class="comment">/* make main consistent */</span>
<a name="l14673"></a>14673     <a class="code" href="../../d0/d12/readfile_8c.html#a438260ec0010d8f1997df08d1ec30ece">expand_main</a>(*fd, mainl);
<a name="l14674"></a>14674 
<a name="l14675"></a>14675     <span class="comment">/* do this when expand found other libs */</span>
<a name="l14676"></a>14676     <a class="code" href="../../d0/d12/readfile_8c.html#a04b6bacd8b4fd46514604fa8c3e427dc">read_libraries</a>(*fd, &amp;(*fd)-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>);
<a name="l14677"></a>14677     
<a name="l14678"></a>14678     curlib= mainl-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>;
<a name="l14679"></a>14679 
<a name="l14680"></a>14680     <span class="comment">/* make the lib path relative if required */</span>
<a name="l14681"></a>14681     <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a656e169b71a4200e80143c632046ccc0">FILE_RELPATH</a>) {
<a name="l14682"></a>14682 
<a name="l14683"></a>14683         <span class="comment">/* use the full path, this could have been read by other library even */</span>
<a name="l14684"></a>14684         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(curlib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, curlib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, <span class="keyword">sizeof</span>(curlib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>));
<a name="l14685"></a>14685         
<a name="l14686"></a>14686         <span class="comment">/* uses current .blend file as reference */</span>
<a name="l14687"></a>14687         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a885e6044163b103a6c8e811d17286bb6">BLI_path_rel</a>(curlib-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l14688"></a>14688     }
<a name="l14689"></a>14689 
<a name="l14690"></a>14690     <a class="code" href="../../d0/d12/readfile_8c.html#af48dcb9e6b4ce80b32f0bd8ac0f6b7a6">blo_join_main</a>(&amp;(*fd)-&gt;mainlist);
<a name="l14691"></a>14691     mainvar= (*fd)-&gt;mainlist.first;
<a name="l14692"></a>14692     mainl= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* blo_join_main free&#39;s mainl, cant use anymore */</span>
<a name="l14693"></a>14693 
<a name="l14694"></a>14694     <a class="code" href="../../d0/d12/readfile_8c.html#a513b60f5271c556e04d2a401e2299728">lib_link_all</a>(*fd, mainvar);
<a name="l14695"></a>14695     <a class="code" href="../../d0/d12/readfile_8c.html#af534cada95dabc774631c0383f5e92d9">lib_verify_nodetree</a>(mainvar, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l14696"></a>14696     <a class="code" href="../../d0/d12/readfile_8c.html#a728bf2d00e314cdf430b210dc5a858db">fix_relpaths_library</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, mainvar); <span class="comment">/* make all relative paths, relative to the open blend file */</span>
<a name="l14697"></a>14697 
<a name="l14698"></a>14698     <span class="keywordflow">if</span> (C) {
<a name="l14699"></a>14699         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l14700"></a>14700 
<a name="l14701"></a>14701         <span class="comment">/* give a base to loose objects. If group append, do it for objects too */</span>
<a name="l14702"></a>14702         <span class="keywordflow">if</span> (scene) {
<a name="l14703"></a>14703             <span class="keyword">const</span> <span class="keywordtype">short</span> is_link= (flag &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a70b60cdf5a3aaf85c7bf68fbf0b32709">FILE_LINK</a>) != 0;
<a name="l14704"></a>14704             <span class="keywordflow">if</span> (idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>) {
<a name="l14705"></a>14705                 <span class="comment">/* don&#39;t instance anything when linking in scenes, assume the scene its self instances the data */</span>
<a name="l14706"></a>14706             }
<a name="l14707"></a>14707             <span class="keywordflow">else</span> {
<a name="l14708"></a>14708                 <a class="code" href="../../d0/d12/readfile_8c.html#a22b02b46f9954186d11ebec786292043">give_base_to_objects</a>(mainvar, scene, curlib, idcode, is_link);
<a name="l14709"></a>14709 
<a name="l14710"></a>14710                 <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a32d6895528474067229e8af75f1f09ba">FILE_GROUP_INSTANCE</a>) {
<a name="l14711"></a>14711                     <a class="code" href="../../d0/d12/readfile_8c.html#adb86884b5ef1a06302e55233ac65605f">give_base_to_groups</a>(mainvar, scene);
<a name="l14712"></a>14712                 }
<a name="l14713"></a>14713             }
<a name="l14714"></a>14714         }
<a name="l14715"></a>14715         <span class="keywordflow">else</span> {
<a name="l14716"></a>14716             printf(<span class="stringliteral">&quot;library_append_end, scene is NULL (objects wont get bases)\n&quot;</span>);
<a name="l14717"></a>14717         }
<a name="l14718"></a>14718     }
<a name="l14719"></a>14719     <span class="comment">/* has been removed... erm, why? s..ton) */</span>
<a name="l14720"></a>14720     <span class="comment">/* 20040907: looks like they are give base already in append_named_part(); -Nathan L */</span>
<a name="l14721"></a>14721     <span class="comment">/* 20041208: put back. It only linked direct, not indirect objects (ton) */</span>
<a name="l14722"></a>14722     
<a name="l14723"></a>14723     <span class="comment">/* patch to prevent switch_endian happens twice */</span>
<a name="l14724"></a>14724     <span class="keywordflow">if</span> ((*fd)-&gt;flags &amp; <a class="code" href="../../de/d65/readfile_8h.html#ac4a525bacb0b350c025a4b256c7a2449">FD_FLAGS_SWITCH_ENDIAN</a>) {
<a name="l14725"></a>14725         <a class="code" href="../../d0/d12/readfile_8c.html#a3ff9403e8be81e455506f3910dcf24c5">blo_freefiledata</a>( *fd );
<a name="l14726"></a>14726         *fd = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14727"></a>14727     }   
<a name="l14728"></a>14728 }
<a name="l14729"></a>14729 
<a name="l14730"></a><a class="code" href="../../d0/d12/readfile_8c.html#aae2592b83ec7caf4290db995da5b79f6">14730</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d01/BLO__readfile_8h.html#a4f52aad607d0bdf6f02a5a7b28d163a0">BLO_library_append_end</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">struct</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl, <a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a>** bh, <span class="keywordtype">int</span> idcode, <span class="keywordtype">short</span> flag)
<a name="l14731"></a>14731 {
<a name="l14732"></a>14732     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= (<a class="code" href="../../d3/db0/structFileData.html">FileData</a>*)(*bh);
<a name="l14733"></a>14733     <a class="code" href="../../d0/d12/readfile_8c.html#a2499f8408d72ec6dc6d3f235882f33e6">library_append_end</a>(C, mainl, &amp;fd, idcode, flag);
<a name="l14734"></a>14734     *bh= (<a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a>*)fd;
<a name="l14735"></a>14735 }
<a name="l14736"></a>14736 
<a name="l14737"></a><a class="code" href="../../d0/d12/readfile_8c.html#aae74837040e7a6681d63bf8b4ba91a06">14737</a> <span class="keywordtype">void</span> *<a class="code" href="../../da/d01/BLO__readfile_8h.html#ad378548775cb125ad2157df2ba7f34d6">BLO_library_read_struct</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd, <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> *bh, <span class="keyword">const</span> <span class="keywordtype">char</span> *blockname)
<a name="l14738"></a>14738 {
<a name="l14739"></a>14739     <span class="keywordflow">return</span> <a class="code" href="../../d0/d12/readfile_8c.html#a3b59dfb456eb8df809849afd709e0504">read_struct</a>(fd, bh, blockname);
<a name="l14740"></a>14740 }
<a name="l14741"></a>14741 
<a name="l14742"></a>14742 <span class="comment">/* ************* READ LIBRARY ************** */</span>
<a name="l14743"></a>14743 
<a name="l14744"></a><a class="code" href="../../d0/d12/readfile_8c.html#a97ab330b6482cb81307228a21abec055">14744</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d12/readfile_8c.html#a97ab330b6482cb81307228a21abec055">mainvar_count_libread_blocks</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar)
<a name="l14745"></a>14745 {
<a name="l14746"></a>14746     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l14747"></a>14747     <span class="keywordtype">int</span> a, tot= 0;
<a name="l14748"></a>14748 
<a name="l14749"></a>14749     a= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(mainvar, lbarray);
<a name="l14750"></a>14750     <span class="keywordflow">while</span> (a--) {
<a name="l14751"></a>14751         <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l14752"></a>14752 
<a name="l14753"></a>14753         <span class="keywordflow">for</span> (<span class="keywordtype">id</span>= lbarray[a]-&gt;first; id; <span class="keywordtype">id</span>= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l14754"></a>14754             <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a04f8870815d984fe3df7edaf5f1a4aca">LIB_READ</a>)
<a name="l14755"></a>14755                 tot++;
<a name="l14756"></a>14756     }
<a name="l14757"></a>14757     <span class="keywordflow">return</span> tot;
<a name="l14758"></a>14758 }
<a name="l14759"></a>14759 
<a name="l14760"></a><a class="code" href="../../d0/d12/readfile_8c.html#a04b6bacd8b4fd46514604fa8c3e427dc">14760</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d12/readfile_8c.html#a04b6bacd8b4fd46514604fa8c3e427dc">read_libraries</a>(<a class="code" href="../../d3/db0/structFileData.html">FileData</a> *basefd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *mainlist)
<a name="l14761"></a>14761 {
<a name="l14762"></a>14762     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainl= mainlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14763"></a>14763     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainptr;
<a name="l14764"></a>14764     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l14765"></a>14765     <span class="keywordtype">int</span> a, doit= 1;
<a name="l14766"></a>14766 
<a name="l14767"></a>14767     <span class="keywordflow">while</span> (doit) {
<a name="l14768"></a>14768         doit= 0;
<a name="l14769"></a>14769 
<a name="l14770"></a>14770         <span class="comment">/* test 1: read libdata */</span>
<a name="l14771"></a>14771         mainptr= mainl-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>;
<a name="l14772"></a>14772         <span class="keywordflow">while</span> (mainptr) {
<a name="l14773"></a>14773             <span class="keywordtype">int</span> tot= <a class="code" href="../../d0/d12/readfile_8c.html#a97ab330b6482cb81307228a21abec055">mainvar_count_libread_blocks</a>(mainptr);
<a name="l14774"></a>14774             
<a name="l14775"></a>14775             <span class="comment">// printf(&quot;found LIB_READ %s\n&quot;, mainptr-&gt;curlib-&gt;name);</span>
<a name="l14776"></a>14776             <span class="keywordflow">if</span> (tot) {
<a name="l14777"></a>14777                 <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd= mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>;
<a name="l14778"></a>14778 
<a name="l14779"></a>14779                 <span class="keywordflow">if</span> (fd==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l14780"></a>14780 
<a name="l14781"></a>14781                     <span class="comment">/* printf and reports for now... its important users know this */</span>
<a name="l14782"></a>14782                     <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a1c418509aad2eb64fd806b8a99d29f7d">RPT_INFO</a>,
<a name="l14783"></a>14783                                      <span class="stringliteral">&quot;read library:  &#39;%s&#39;, &#39;%s&#39;\n&quot;</span>,
<a name="l14784"></a>14784                                      mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>);
<a name="l14785"></a>14785 
<a name="l14786"></a>14786                     fd= <a class="code" href="../../d0/d12/readfile_8c.html#a8233a740bb1c85530ee2324bb626906f">blo_openblenderfile</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>);
<a name="l14787"></a>14787                     
<a name="l14788"></a>14788                     <span class="comment">/* allow typing in a new lib path */</span>
<a name="l14789"></a>14789                     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rt==-666) {
<a name="l14790"></a>14790                         <span class="keywordflow">while</span> (fd==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l14791"></a>14791                             <span class="keywordtype">char</span> newlib_path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>] = { 0 };
<a name="l14792"></a>14792                             printf(<span class="stringliteral">&quot;Missing library...&#39;\n&quot;</span>);
<a name="l14793"></a>14793                             printf(<span class="stringliteral">&quot;    current file: %s\n&quot;</span>, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l14794"></a>14794                             printf(<span class="stringliteral">&quot;    absolute lib: %s\n&quot;</span>, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l14795"></a>14795                             printf(<span class="stringliteral">&quot;    relative lib: %s\n&quot;</span>, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>);
<a name="l14796"></a>14796                             printf(<span class="stringliteral">&quot;  enter a new path:\n&quot;</span>);
<a name="l14797"></a>14797 
<a name="l14798"></a>14798                             <span class="keywordflow">if</span> (scanf(<span class="stringliteral">&quot;%s&quot;</span>, newlib_path) &gt; 0) {
<a name="l14799"></a>14799                                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>, newlib_path, <span class="keyword">sizeof</span>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac18df5c63a95b296234e87bc66b7dbad">name</a>));
<a name="l14800"></a>14800                                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, newlib_path, <span class="keyword">sizeof</span>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>));
<a name="l14801"></a>14801                                 <a class="code" href="../../d0/d12/readfile_8c.html#a83b06e589c8a2efbff0e61f0d79d3087">cleanup_path</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l14802"></a>14802                                 
<a name="l14803"></a>14803                                 fd= <a class="code" href="../../d0/d12/readfile_8c.html#a8233a740bb1c85530ee2324bb626906f">blo_openblenderfile</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>, basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>);
<a name="l14804"></a>14804 
<a name="l14805"></a>14805                                 <span class="keywordflow">if</span> (fd) {
<a name="l14806"></a>14806                                     printf(<span class="stringliteral">&quot;found: &#39;%s&#39;, party on macuno!\n&quot;</span>, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l14807"></a>14807                                 }
<a name="l14808"></a>14808                             }
<a name="l14809"></a>14809                         }
<a name="l14810"></a>14810                     }
<a name="l14811"></a>14811 
<a name="l14812"></a>14812                     <span class="keywordflow">if</span> (fd) {
<a name="l14813"></a>14813                         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>= basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>;
<a name="l14814"></a>14814                         
<a name="l14815"></a>14815                         <span class="keywordflow">if</span> (fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>)
<a name="l14816"></a>14816                             <a class="code" href="../../d0/d12/readfile_8c.html#a83c676103964e158a9bec41b9f33a11f">oldnewmap_free</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a>);
<a name="l14817"></a>14817 
<a name="l14818"></a>14818                         fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4b111b85656e16cb7fb356d40c92a38d">libmap</a> = <a class="code" href="../../d0/d12/readfile_8c.html#a88ccf896b441aadfad6c5ce5f477dc2f">oldnewmap_new</a>();
<a name="l14819"></a>14819                         
<a name="l14820"></a>14820                         mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>= fd;
<a name="l14821"></a>14821                         mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a2b42cde3bebb0b947a06543767f620d5">fileversion</a>;
<a name="l14822"></a>14822                         
<a name="l14823"></a>14823                         <span class="comment">/* subversion */</span>
<a name="l14824"></a>14824                         <a class="code" href="../../d0/d12/readfile_8c.html#aec40e10a1816657984efe58afbe3617a">read_file_version</a>(fd, mainptr);
<a name="l14825"></a>14825                     }
<a name="l14826"></a>14826                     <span class="keywordflow">else</span> mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14827"></a>14827 
<a name="l14828"></a>14828                     <span class="keywordflow">if</span> (fd==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l14829"></a>14829                         <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>,
<a name="l14830"></a>14830                                          <span class="stringliteral">&quot;Can&#39;t find lib &#39;%s&#39;\n&quot;</span>,
<a name="l14831"></a>14831                                          mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l14832"></a>14832                     }
<a name="l14833"></a>14833                 }
<a name="l14834"></a>14834                 <span class="keywordflow">if</span> (fd) {
<a name="l14835"></a>14835                     doit= 1;
<a name="l14836"></a>14836                     a= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(mainptr, lbarray);
<a name="l14837"></a>14837                     <span class="keywordflow">while</span> (a--) {
<a name="l14838"></a>14838                         <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= lbarray[a]-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14839"></a>14839 
<a name="l14840"></a>14840                         <span class="keywordflow">while</span> (<span class="keywordtype">id</span>) {
<a name="l14841"></a>14841                             <a class="code" href="../../d8/d7e/structID.html">ID</a> *idn= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l14842"></a>14842                             <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a04f8870815d984fe3df7edaf5f1a4aca">LIB_READ</a>) {
<a name="l14843"></a>14843                                 <a class="code" href="../../d8/d7e/structID.html">ID</a> *realid= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14844"></a>14844                                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(lbarray[a], <span class="keywordtype">id</span>);
<a name="l14845"></a>14845 
<a name="l14846"></a>14846                                 <a class="code" href="../../d0/d12/readfile_8c.html#ab65901e3f7544b06c679cf6408bc58a2">append_id_part</a>(fd, mainptr, <span class="keywordtype">id</span>, &amp;realid);
<a name="l14847"></a>14847                                 <span class="keywordflow">if</span> (!realid) {
<a name="l14848"></a>14848                                     <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>,
<a name="l14849"></a>14849                                                      <span class="stringliteral">&quot;LIB ERROR: %s:&#39;%s&#39; missing from &#39;%s&#39;\n&quot;</span>,
<a name="l14850"></a>14850                                                      <a class="code" href="../../d8/de8/BKE__idcode_8h.html#ab81e79c46731dbb842e5d4fdf7d32065">BKE_idcode_to_name</a>(<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)),
<a name="l14851"></a>14851                                                      id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l14852"></a>14852                                 }
<a name="l14853"></a>14853                                 
<a name="l14854"></a>14854                                 <a class="code" href="../../d0/d12/readfile_8c.html#a616ca91ef10e9653cca0974b62762b31">change_idid_adr</a>(mainlist, basefd, <span class="keywordtype">id</span>, realid);
<a name="l14855"></a>14855 
<a name="l14856"></a>14856                                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<span class="keywordtype">id</span>);
<a name="l14857"></a>14857                             }
<a name="l14858"></a>14858                             <span class="keywordtype">id</span>= idn;
<a name="l14859"></a>14859                         }
<a name="l14860"></a>14860                     }
<a name="l14861"></a>14861 
<a name="l14862"></a>14862                     <a class="code" href="../../d0/d12/readfile_8c.html#a438260ec0010d8f1997df08d1ec30ece">expand_main</a>(fd, mainptr);
<a name="l14863"></a>14863                     
<a name="l14864"></a>14864                     <span class="comment">/* dang FileData... now new libraries need to be appended to original filedata,</span>
<a name="l14865"></a>14865 <span class="comment">                     * it is not a good replacement for the old global (ton) */</span>
<a name="l14866"></a>14866                     <span class="keywordflow">while</span> ( fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> ) {
<a name="l14867"></a>14867                         <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mp= fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14868"></a>14868                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, mp);
<a name="l14869"></a>14869                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a4cc8cc238279dc63e56c1286115ae0d0">mainlist</a>, mp);
<a name="l14870"></a>14870                     }
<a name="l14871"></a>14871                 }
<a name="l14872"></a>14872             }
<a name="l14873"></a>14873 
<a name="l14874"></a>14874             mainptr= mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>;
<a name="l14875"></a>14875         }
<a name="l14876"></a>14876     }
<a name="l14877"></a>14877     
<a name="l14878"></a>14878     <span class="comment">/* test if there are unread libblocks */</span>
<a name="l14879"></a>14879     <span class="keywordflow">for</span> (mainptr= mainl-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>; mainptr; mainptr= mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l14880"></a>14880         a= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(mainptr, lbarray);
<a name="l14881"></a>14881         <span class="keywordflow">while</span> (a--) {
<a name="l14882"></a>14882             <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= lbarray[a]-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l14883"></a>14883             <span class="keywordflow">while</span> (<span class="keywordtype">id</span>) {
<a name="l14884"></a>14884                 <a class="code" href="../../d8/d7e/structID.html">ID</a> *idn= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l14885"></a>14885                 <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a04f8870815d984fe3df7edaf5f1a4aca">LIB_READ</a>) {
<a name="l14886"></a>14886                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(lbarray[a], <span class="keywordtype">id</span>);
<a name="l14887"></a>14887                     <a class="code" href="../../d0/d12/readfile_8c.html#a5e98fe0f45771d93bd220c992a29e5f7">BKE_reportf_wrap</a>(basefd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>,
<a name="l14888"></a>14888                                      <span class="stringliteral">&quot;LIB ERROR: %s:&#39;%s&#39; unread libblock missing from &#39;%s&#39;\n&quot;</span>,
<a name="l14889"></a>14889                                      <a class="code" href="../../d8/de8/BKE__idcode_8h.html#ab81e79c46731dbb842e5d4fdf7d32065">BKE_idcode_to_name</a>(<a class="code" href="../../d0/d12/readfile_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)), id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#a1785b34cf2dc18faeab4c39853593d17">filepath</a>);
<a name="l14890"></a>14890                     <a class="code" href="../../d0/d12/readfile_8c.html#a616ca91ef10e9653cca0974b62762b31">change_idid_adr</a>(mainlist, basefd, <span class="keywordtype">id</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l14891"></a>14891 
<a name="l14892"></a>14892                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<span class="keywordtype">id</span>);
<a name="l14893"></a>14893                 }
<a name="l14894"></a>14894                 <span class="keywordtype">id</span>= idn;
<a name="l14895"></a>14895             }
<a name="l14896"></a>14896         }
<a name="l14897"></a>14897     }
<a name="l14898"></a>14898     
<a name="l14899"></a>14899     <span class="comment">/* do versions, link, and free */</span>
<a name="l14900"></a>14900     <span class="keywordflow">for</span> (mainptr= mainl-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>; mainptr; mainptr= mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l14901"></a>14901         <span class="comment">/* some mains still have to be read, then</span>
<a name="l14902"></a>14902 <span class="comment">         * versionfile is still zero! */</span>
<a name="l14903"></a>14903         <span class="keywordflow">if</span> (mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#abb6d63262cd2a22e6d18f962e052eefa">versionfile</a>) {
<a name="l14904"></a>14904             <span class="keywordflow">if</span> (mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>) <span class="comment">// can be zero... with shift+f1 append</span>
<a name="l14905"></a>14905                 <a class="code" href="../../d0/d12/readfile_8c.html#a9c6d7f2a5e3846ef77dc9b04e8884e42">do_versions</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>, mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>, mainptr);
<a name="l14906"></a>14906             <span class="keywordflow">else</span>
<a name="l14907"></a>14907                 <a class="code" href="../../d0/d12/readfile_8c.html#a9c6d7f2a5e3846ef77dc9b04e8884e42">do_versions</a>(basefd, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, mainptr);
<a name="l14908"></a>14908         }
<a name="l14909"></a>14909         
<a name="l14910"></a>14910         <span class="keywordflow">if</span> (mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>)
<a name="l14911"></a>14911             <a class="code" href="../../d0/d12/readfile_8c.html#a513b60f5271c556e04d2a401e2299728">lib_link_all</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>, mainptr);
<a name="l14912"></a>14912         
<a name="l14913"></a>14913         <span class="keywordflow">if</span> (mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>) <a class="code" href="../../d0/d12/readfile_8c.html#a3ff9403e8be81e455506f3910dcf24c5">blo_freefiledata</a>(mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>);
<a name="l14914"></a>14914         mainptr-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>-&gt;<a class="code" href="../../da/d4d/structLibrary.html#ac486d41a7c762892f4f07cb3442b558a">filedata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14915"></a>14915     }
<a name="l14916"></a>14916 }
<a name="l14917"></a>14917 
<a name="l14918"></a>14918 
<a name="l14919"></a>14919 <span class="comment">/* reading runtime */</span>
<a name="l14920"></a>14920 
<a name="l14921"></a><a class="code" href="../../d0/d12/readfile_8c.html#af87ab45893dbe8154f9b0bc8eca20239">14921</a> <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *<a class="code" href="../../da/d01/BLO__readfile_8h.html#a17d5b8c45f2165011c96b0323f39c743">blo_read_blendafterruntime</a>(<span class="keywordtype">int</span> file, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> actualsize, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l14922"></a>14922 {
<a name="l14923"></a>14923     <a class="code" href="../../db/d57/structBlendFileData.html">BlendFileData</a> *bfd = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14924"></a>14924     <a class="code" href="../../d3/db0/structFileData.html">FileData</a> *fd = <a class="code" href="../../d0/d12/readfile_8c.html#a970260bd2fde4783885be4305f2aa0a0">filedata_new</a>();
<a name="l14925"></a>14925     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#ad5ba9af5f3d5d8f72996d36a816b9372">filedes</a> = file;
<a name="l14926"></a>14926     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#adf5d23e39de34d2cdd622409e3c312eb">buffersize</a> = actualsize;
<a name="l14927"></a>14927     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a1d014d883b95c2873cca8e1faf25f723">read</a> = <a class="code" href="../../d0/d12/readfile_8c.html#ab61ad9663e97db266f8b9d5e6fa49996">fd_read_from_file</a>;
<a name="l14928"></a>14928 
<a name="l14929"></a>14929     <span class="comment">/* needed for library_append and read_libraries */</span>
<a name="l14930"></a>14930     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>, name, <span class="keyword">sizeof</span>(fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a7e775837afb68cbe918badb71fa78b10">relabase</a>));
<a name="l14931"></a>14931 
<a name="l14932"></a>14932     fd = <a class="code" href="../../d0/d12/readfile_8c.html#a3f8caf22340df25ac88e92ac4d212308">blo_decode_and_check</a>(fd, reports);
<a name="l14933"></a>14933     <span class="keywordflow">if</span> (!fd)
<a name="l14934"></a>14934         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l14935"></a>14935 
<a name="l14936"></a>14936     fd-&gt;<a class="code" href="../../d3/db0/structFileData.html#a809d9b78f3cf720163fe48e28e095bf9">reports</a>= reports;
<a name="l14937"></a>14937     bfd= <a class="code" href="../../d0/d12/readfile_8c.html#a1e98dff51781204272be852ecb515a11">blo_read_file_internal</a>(fd, <span class="stringliteral">&quot;&quot;</span>);
<a name="l14938"></a>14938     <a class="code" href="../../d0/d12/readfile_8c.html#a3ff9403e8be81e455506f3910dcf24c5">blo_freefiledata</a>(fd);
<a name="l14939"></a>14939 
<a name="l14940"></a>14940     <span class="keywordflow">return</span> bfd;
<a name="l14941"></a>14941 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:46 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: KX_BlenderMaterial.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">KX_BlenderMaterial.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d0/d32/KX__BlenderMaterial_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00005"></a>00005 <span class="comment">// ------------------------------------</span>
<a name="l00006"></a>00006 <span class="comment">// ...</span>
<a name="l00007"></a>00007 <span class="comment">// ------------------------------------</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;GL/glew.h&quot;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d9b/KX__BlenderMaterial_8h.html">KX_BlenderMaterial.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4a/BL__Material_8h.html">BL_Material.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da5/KX__Scene_8h.html">KX_Scene.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d58/KX__Light_8h.html">KX_Light.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc5/KX__GameObject_8h.html" title="General KX game object.">KX_GameObject.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d4e/KX__MeshProxy_8h.html">KX_MeshProxy.h</a>&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/db5/MT__Vector3_8h.html">MT_Vector3.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/ded/MT__Vector4_8h.html">MT_Vector4.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d23/MT__Matrix4x4_8h.html">MT_Matrix4x4.h</a>&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dfd/RAS__BucketManager_8h.html">RAS_BucketManager.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d0f/RAS__IRasterizer_8h.html">RAS_IRasterizer.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d21/RAS__GLExtensionManager_8h.html">RAS_OpenGLRasterizer/RAS_GLExtensionManager.h</a>&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/df0/GPU__draw_8h.html">GPU_draw.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/daa/STR__HashedString_8h.html">STR_HashedString.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">// ------------------------------------</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d94/DNA__image__types_8h.html">DNA_image_types.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="comment">// ------------------------------------</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">00039</a> <span class="preprocessor">#define spit(x) std::cout &lt;&lt; x &lt;&lt; std::endl;</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <a class="code" href="../../dd/da0/classBL__Shader.html">BL_Shader</a> *KX_BlenderMaterial::mLastShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00042"></a>00042 <a class="code" href="../../de/dd2/classBL__BlenderShader.html">BL_BlenderShader</a> *KX_BlenderMaterial::mLastBlenderShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">//static PyObject *gTextureDict = 0;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a44e09a6b9290daefaab232e1d7bd3cfa">00046</a> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a44e09a6b9290daefaab232e1d7bd3cfa">KX_BlenderMaterial::KX_BlenderMaterial</a>()
<a name="l00047"></a>00047 :   <a class="code" href="../../d0/dbc/classPyObjectPlus.html">PyObjectPlus</a>(),
<a name="l00048"></a>00048     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a>(),
<a name="l00049"></a>00049     mMaterial(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00050"></a>00050     mShader(0),
<a name="l00051"></a>00051     mBlenderShader(0),
<a name="l00052"></a>00052     mScene(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00053"></a>00053     mUserDefBlend(0),
<a name="l00054"></a>00054     mModified(0),
<a name="l00055"></a>00055     mConstructed(false),
<a name="l00056"></a>00056     mPass(0)
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a53dab4a50dac5e47ea48b20b43ee1f81">00060</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a53dab4a50dac5e47ea48b20b43ee1f81">KX_BlenderMaterial::Initialize</a>(
<a name="l00061"></a>00061     <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *scene,
<a name="l00062"></a>00062     <a class="code" href="../../d3/de1/classBL__Material.html">BL_Material</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>,
<a name="l00063"></a>00063     <a class="code" href="../../d1/d3d/structGameSettings.html">GameSettings</a> *game)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a53dab4a50dac5e47ea48b20b43ee1f81">RAS_IPolyMaterial::Initialize</a>(
<a name="l00066"></a>00066         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ae3d218348db649f1e861f4e76225a5fa">texname</a>[0],
<a name="l00067"></a>00067         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a83e2f8154d4280bb3a23a54d65f411c0">matname</a>,
<a name="l00068"></a>00068         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a6cc7258f646856ab704d75aa1ce30c0d">materialindex</a>,
<a name="l00069"></a>00069         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a384e9bb3b6d6f3266b8142b890437da2">tile</a>,
<a name="l00070"></a>00070         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#addced321419df8b2979b251fa86a7845">tilexrep</a>[0],
<a name="l00071"></a>00071         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a8dfcabfb58595c7a2dd9d258f47f175d">tileyrep</a>[0],
<a name="l00072"></a>00072         data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>,
<a name="l00073"></a>00073         ((data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba47e073572a47a01522b766b027f1a16c">ALPHA</a>)!=0),
<a name="l00074"></a>00074         ((data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba461cb9ec6757c83e365846ba10e1ccfb">ZSORT</a>)!=0),
<a name="l00075"></a>00075         ((data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba0d555ae0f2870d6dd8e4c19e1dad1d41">USE_LIGHT</a>)!=0),
<a name="l00076"></a>00076         ((data-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>)),
<a name="l00077"></a>00077         game
<a name="l00078"></a>00078     );
<a name="l00079"></a>00079     mMaterial = <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l00080"></a>00080     mShader = 0;
<a name="l00081"></a>00081     mBlenderShader = 0;
<a name="l00082"></a>00082     mScene = scene;
<a name="l00083"></a>00083     mUserDefBlend = 0;
<a name="l00084"></a>00084     mModified = 0;
<a name="l00085"></a>00085     mConstructed = <span class="keyword">false</span>;
<a name="l00086"></a>00086     mPass = 0;
<a name="l00087"></a>00087     <span class="comment">// --------------------------------</span>
<a name="l00088"></a>00088     <span class="comment">// RAS_IPolyMaterial variables...</span>
<a name="l00089"></a>00089     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#aabbecc9d4a0469faf0def163ec44e8fe">m_flag</a> |= <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fa7f731696da676a0b2f7bb0dec1210248">RAS_BLENDERMAT</a>;
<a name="l00090"></a>00090     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#aabbecc9d4a0469faf0def163ec44e8fe">m_flag</a> |= (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aefaccf78793cc724e61ecf71fa108bad">IdMode</a>&gt;=<a class="code" href="../../d1/d4a/BL__Material_8h.html#a366893b30d0095c834c9aba7df3f598ca011124efb1a0b3dee7770635e0449440">ONETEX</a>)? <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fad5cf77d0c1a51c17e205848655010a7b">RAS_MULTITEX</a>: 0;
<a name="l00091"></a>00091     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#aabbecc9d4a0469faf0def163ec44e8fe">m_flag</a> |= ((mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp; <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba0d555ae0f2870d6dd8e4c19e1dad1d41">USE_LIGHT</a>)!=0)? <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fa280b504f22ba30f84b4744bd5d93cf9e">RAS_MULTILIGHT</a>: 0;
<a name="l00092"></a>00092     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#aabbecc9d4a0469faf0def163ec44e8fe">m_flag</a> |= (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a0899468804a495f1c852d1104a18463c">glslmat</a>)? <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fadab579ec79c6a9b673048d6303b85a88">RAS_BLENDERGLSL</a>: 0;
<a name="l00093"></a>00093     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#aabbecc9d4a0469faf0def163ec44e8fe">m_flag</a> |= ((mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp; <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1feb68b140a38104812c1d83ec87ca18">CAST_SHADOW</a>)!=0)? <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fa4cb5a40d83a4269a5f931ddcf1c87354">RAS_CASTSHADOW</a>: 0;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="comment">// figure max</span>
<a name="l00096"></a>00096     <span class="keywordtype">int</span> enabled = mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>;
<a name="l00097"></a>00097     <span class="keywordtype">int</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = <a class="code" href="../../dd/d62/classBL__Texture.html#a6ca70644f3397290d1ae6171164bb62a">BL_Texture::GetMaxUnits</a>();
<a name="l00098"></a>00098     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a> = enabled&gt;=max?max:enabled;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="comment">// test the sum of the various modes for equality</span>
<a name="l00101"></a>00101     <span class="comment">// so we can ether accept or reject this material</span>
<a name="l00102"></a>00102     <span class="comment">// as being equal, this is rather important to</span>
<a name="l00103"></a>00103     <span class="comment">// prevent material bleeding</span>
<a name="l00104"></a>00104     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00105"></a>00105         <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#ade3b8a5ffd1b3818a2b6d1673434b124">m_multimode</a> += (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a60e7f41e2e8633068547ccf5556f4ce4">flag</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] + mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a6d418e41b6e0c13e366f94bd4a7abee1">blend_mode</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#ade3b8a5ffd1b3818a2b6d1673434b124">m_multimode</a> += mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aefaccf78793cc724e61ecf71fa108bad">IdMode</a>+ (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp; ~(<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba0d555ae0f2870d6dd8e4c19e1dad1d41">USE_LIGHT</a>));
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a3bd5c32a6bdf2d7ff67a953371d6cb25">00110</a> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a3bd5c32a6bdf2d7ff67a953371d6cb25">KX_BlenderMaterial::~KX_BlenderMaterial</a>()
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     <span class="comment">// cleanup work</span>
<a name="l00113"></a>00113     <span class="keywordflow">if</span> (mConstructed)
<a name="l00114"></a>00114         <span class="comment">// clean only if material was actually used</span>
<a name="l00115"></a>00115         OnExit();
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#aa38c22ae1b7929edbb6a7ed678946ba5">00118</a> <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a>* <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#aa38c22ae1b7929edbb6a7ed678946ba5">KX_BlenderMaterial::GetMTFace</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>
<a name="l00119"></a>00119 <span class="keyword"></span>{
<a name="l00120"></a>00120     <span class="comment">// fonts on polys</span>
<a name="l00121"></a>00121     <span class="keywordflow">return</span> &amp;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a343e46e95bf2772c130b24455a8e6b27">tface</a>;
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a6e1a3aa73b81557fe94b6626b8747b65">00124</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a6e1a3aa73b81557fe94b6626b8747b65">KX_BlenderMaterial::GetMCol</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>
<a name="l00125"></a>00125 <span class="keyword"></span>{
<a name="l00126"></a>00126     <span class="comment">// fonts on polys</span>
<a name="l00127"></a>00127     <span class="keywordflow">return</span> mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ae8102377fa35b40086f0a1505126f1a8">rgb</a>;
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="keywordtype">void</span> KX_BlenderMaterial::GetMaterialRGBAColor(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *rgba)<span class="keyword"> const</span>
<a name="l00131"></a>00131 <span class="keyword"></span>{
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (mMaterial) {
<a name="l00133"></a>00133         *rgba++ = (<span class="keywordtype">unsigned</span> char) (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[0]*255.0);
<a name="l00134"></a>00134         *rgba++ = (<span class="keywordtype">unsigned</span> char) (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[1]*255.0);
<a name="l00135"></a>00135         *rgba++ = (<span class="keywordtype">unsigned</span> char) (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[2]*255.0);
<a name="l00136"></a>00136         *rgba++ = (<span class="keywordtype">unsigned</span> char) (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[3]*255.0);
<a name="l00137"></a>00137     } <span class="keywordflow">else</span>
<a name="l00138"></a>00138         <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a9dab4556172b9d78e51c242901b7eda6">RAS_IPolyMaterial::GetMaterialRGBAColor</a>(rgba);
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a0e17077cb5f3111b6a7c0d86ea9288c8">00141</a> <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a0e17077cb5f3111b6a7c0d86ea9288c8">KX_BlenderMaterial::GetBlenderMaterial</a>()<span class="keyword"> const</span>
<a name="l00142"></a>00142 <span class="keyword"></span>{
<a name="l00143"></a>00143     <span class="keywordflow">return</span> mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a81464bdc9a517649d0f2342cb801e9dd">material</a>;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <a class="code" href="../../d9/d27/structScene.html">Scene</a>* KX_BlenderMaterial::GetBlenderScene()<span class="keyword"> const</span>
<a name="l00147"></a>00147 <span class="keyword"></span>{
<a name="l00148"></a>00148     <span class="keywordflow">return</span> mScene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a217279a18aca964cf8d28d3ad6bdb95d">GetBlenderScene</a>();
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="keywordtype">void</span> KX_BlenderMaterial::ReleaseMaterial()
<a name="l00152"></a>00152 {
<a name="l00153"></a>00153     <span class="keywordflow">if</span> (mBlenderShader)
<a name="l00154"></a>00154         mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#ad639c7945588bba20f85d807a81e1a2b">ReloadMaterial</a>();
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a5e75d07d1073ed18775558d8004f89cf">00157</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a5e75d07d1073ed18775558d8004f89cf">KX_BlenderMaterial::OnConstruction</a>(<span class="keywordtype">int</span> layer)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (mConstructed)
<a name="l00160"></a>00160         <span class="comment">// when material are reused between objects</span>
<a name="l00161"></a>00161         <span class="keywordflow">return</span>;
<a name="l00162"></a>00162     
<a name="l00163"></a>00163     <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a0899468804a495f1c852d1104a18463c">glslmat</a>)
<a name="l00164"></a>00164         SetBlenderGLSLShader(layer);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">// for each unique material...</span>
<a name="l00167"></a>00167     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00168"></a>00168     <span class="keywordflow">for</span> (i=0; i&lt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>; i++) {
<a name="l00169"></a>00169         <span class="keywordflow">if</span> ( mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a34bca173c0f2927d473ecad059e506c3">mapping</a> &amp; <a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1adb0d275790d6a0ec87b8c1039d889d2f">USEENV</a> ) {
<a name="l00170"></a>00170             <span class="keywordflow">if</span> (!GLEW_ARB_texture_cube_map) {
<a name="l00171"></a>00171                 <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">spit</a>(<span class="stringliteral">&quot;CubeMap textures not supported&quot;</span>);
<a name="l00172"></a>00172                 <span class="keywordflow">continue</span>;
<a name="l00173"></a>00173             }
<a name="l00174"></a>00174             <span class="keywordflow">if</span> (!mTextures[i].InitCubeMap(i, mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad407568dc1d5ffb2f357aa0a24601b89">cubemap</a>[i] ) )
<a name="l00175"></a>00175                 <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">spit</a>(<span class="stringliteral">&quot;unable to initialize image(&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;) in &quot;</span>&lt;&lt; 
<a name="l00176"></a>00176                          mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a83e2f8154d4280bb3a23a54d65f411c0">matname</a>&lt;&lt; <span class="stringliteral">&quot;, image will not be available&quot;</span>);
<a name="l00177"></a>00177         } 
<a name="l00178"></a>00178     
<a name="l00179"></a>00179         <span class="keywordflow">else</span> {
<a name="l00180"></a>00180             <span class="keywordflow">if</span> ( mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad88d5442b5b764fe17a444142ab6ffef">img</a>[i] ) {
<a name="l00181"></a>00181                 <span class="keywordflow">if</span> ( ! mTextures[i].InitFromImage(i, mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad88d5442b5b764fe17a444142ab6ffef">img</a>[i], (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a60e7f41e2e8633068547ccf5556f4ce4">flag</a>[i] &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#ad485bc2b4478f83a4ae54f8939cbcd65a07e649496c491cfeb099de6684fdcdd9">MIPMAP</a>)!=0 ))
<a name="l00182"></a>00182                     <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">spit</a>(<span class="stringliteral">&quot;unable to initialize image(&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;) in &quot;</span>&lt;&lt; 
<a name="l00183"></a>00183                         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a83e2f8154d4280bb3a23a54d65f411c0">matname</a>&lt;&lt; <span class="stringliteral">&quot;, image will not be available&quot;</span>);
<a name="l00184"></a>00184             }
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     mBlendFunc[0] =0;
<a name="l00189"></a>00189     mBlendFunc[1] =0;
<a name="l00190"></a>00190     mConstructed = <span class="keyword">true</span>;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#acac68937ea1fdde98a4d98701d03636c">00193</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#acac68937ea1fdde98a4d98701d03636c">KX_BlenderMaterial::EndFrame</a>()
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195     <span class="keywordflow">if</span> (mLastBlenderShader) {
<a name="l00196"></a>00196         mLastBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">false</span>);
<a name="l00197"></a>00197         mLastBlenderShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (mLastShader) {
<a name="l00201"></a>00201         mLastShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">false</span>);
<a name="l00202"></a>00202         mLastShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="keywordtype">void</span> KX_BlenderMaterial::OnExit()
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208     <span class="keywordflow">if</span> ( mShader ) {
<a name="l00209"></a>00209         <span class="comment">//note, the shader here is allocated, per unique material</span>
<a name="l00210"></a>00210         <span class="comment">//and this function is called per face</span>
<a name="l00211"></a>00211         <span class="keywordflow">if</span> (mShader == mLastShader) {
<a name="l00212"></a>00212             mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">false</span>);
<a name="l00213"></a>00213             mLastShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00214"></a>00214         }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="keyword">delete</span> mShader;
<a name="l00217"></a>00217         mShader = 0;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">if</span> ( mBlenderShader ) {
<a name="l00221"></a>00221         <span class="keywordflow">if</span> (mBlenderShader == mLastBlenderShader) {
<a name="l00222"></a>00222             mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">false</span>);
<a name="l00223"></a>00223             mLastBlenderShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         <span class="keyword">delete</span> mBlenderShader;
<a name="l00227"></a>00227         mBlenderShader = 0;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <a class="code" href="../../dd/d62/classBL__Texture.html#a34aa44476783a77eb455c0d8a0711bd4">BL_Texture::ActivateFirst</a>();
<a name="l00231"></a>00231     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00232"></a>00232         <a class="code" href="../../dd/d62/classBL__Texture.html#af435bc77814a55561777bad98ed5a80f">BL_Texture::ActivateUnit</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00233"></a>00233         mTextures[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dd/d62/classBL__Texture.html#aeb5bca03961ffc58549f08eea0711f7b">DeleteTex</a>();
<a name="l00234"></a>00234         mTextures[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dd/d62/classBL__Texture.html#a016107f0574d64e21cd2660f26a210d5">DisableUnit</a>();
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="comment">/* used to call with &#39;mMaterial-&gt;tface&#39; but this can be a freed array,</span>
<a name="l00238"></a>00238 <span class="comment">     * see: [#30493], so just call with NULL, this is best since it clears</span>
<a name="l00239"></a>00239 <span class="comment">     * the &#39;lastface&#39; pointer in GPU too - campbell */</span>
<a name="l00240"></a>00240     <a class="code" href="../../d3/df0/GPU__draw_8h.html#a6eb498dab9d137ba07fd03d44602b591">GPU_set_tpage</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1, mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>);
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="keywordtype">void</span> KX_BlenderMaterial::setShaderData( <span class="keywordtype">bool</span> enable, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a> *ras)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246     <a class="code" href="../../dc/d60/MT__assert_8h.html#a9a255d1fa64eae77485b7bc71c1b4c97">MT_assert</a>(GLEW_ARB_shader_objects &amp;&amp; mShader);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00249"></a>00249     <span class="keywordflow">if</span> ( !enable || !mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a2d3744535bfbcb27f43b16055d9b84dd">Ok</a>() ) {
<a name="l00250"></a>00250         <span class="comment">// frame cleanup.</span>
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (mShader == mLastShader) {
<a name="l00252"></a>00252             mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">false</span>);
<a name="l00253"></a>00253             mLastShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac46ac17f231437d1a99a5e05a4be6300">TF_SOLID</a>);
<a name="l00257"></a>00257         <a class="code" href="../../dd/d62/classBL__Texture.html#a7465c3fb399a93acc4d81df4d1f7e23d">BL_Texture::DisableAllTextures</a>();
<a name="l00258"></a>00258         <span class="keywordflow">return</span>;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <a class="code" href="../../dd/d62/classBL__Texture.html#a7465c3fb399a93acc4d81df4d1f7e23d">BL_Texture::DisableAllTextures</a>();
<a name="l00262"></a>00262     mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">true</span>);
<a name="l00263"></a>00263     mLastShader = mShader;
<a name="l00264"></a>00264     
<a name="l00265"></a>00265     <a class="code" href="../../dd/d62/classBL__Texture.html#a34aa44476783a77eb455c0d8a0711bd4">BL_Texture::ActivateFirst</a>();
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#acc177144dcc624a34176f07ac7f636af">ApplyShader</a>();
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="comment">// for each enabled unit</span>
<a name="l00270"></a>00270     <span class="keywordflow">for</span> (i=0; i&lt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>; i++) {
<a name="l00271"></a>00271         <span class="keywordflow">if</span> (!mTextures[i].Ok()) <span class="keywordflow">continue</span>;
<a name="l00272"></a>00272         mTextures[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dd/d62/classBL__Texture.html#a44cb4afb3c296282fe62b3eaa6edb784">ActivateTexture</a>();
<a name="l00273"></a>00273         mTextures[0].<a class="code" href="../../dd/d62/classBL__Texture.html#aa7ff36068002312ef7af2da67cfda067">SetMapping</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a34bca173c0f2927d473ecad059e506c3">mapping</a>);
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="keywordflow">if</span> (!mUserDefBlend) {
<a name="l00277"></a>00277         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>);
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279     <span class="keywordflow">else</span> {
<a name="l00280"></a>00280         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac46ac17f231437d1a99a5e05a4be6300">TF_SOLID</a>);
<a name="l00281"></a>00281         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(-1); <span class="comment">// indicates custom mode</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <span class="comment">// tested to be valid enums</span>
<a name="l00284"></a>00284         glEnable(GL_BLEND);
<a name="l00285"></a>00285         glBlendFunc(mBlendFunc[0], mBlendFunc[1]);
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="keywordtype">void</span> KX_BlenderMaterial::setBlenderShaderData( <span class="keywordtype">bool</span> enable, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a> *ras)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291     <span class="keywordflow">if</span> ( !enable || !mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aedebb4bd34a92b2ec631c0c77aeb1e7a">Ok</a>() ) {
<a name="l00292"></a>00292         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac46ac17f231437d1a99a5e05a4be6300">TF_SOLID</a>);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">// frame cleanup.</span>
<a name="l00295"></a>00295         <span class="keywordflow">if</span> (mLastBlenderShader) {
<a name="l00296"></a>00296             mLastBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">false</span>);
<a name="l00297"></a>00297             mLastBlenderShader= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299         <span class="keywordflow">else</span>
<a name="l00300"></a>00300             <a class="code" href="../../dd/d62/classBL__Texture.html#a7465c3fb399a93acc4d81df4d1f7e23d">BL_Texture::DisableAllTextures</a>();
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="keywordflow">return</span>;
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="keywordflow">if</span> (!mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#a31875cae6377054a1045f8f3041e5e90">Equals</a>(mLastBlenderShader)) {
<a name="l00306"></a>00306         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (mLastBlenderShader)
<a name="l00309"></a>00309             mLastBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">false</span>);
<a name="l00310"></a>00310         <span class="keywordflow">else</span>
<a name="l00311"></a>00311             <a class="code" href="../../dd/d62/classBL__Texture.html#a7465c3fb399a93acc4d81df4d1f7e23d">BL_Texture::DisableAllTextures</a>();
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">true</span>, ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#aea34c8bc1e331e480099a510b39b92de">GetTime</a>());
<a name="l00314"></a>00314         mLastBlenderShader= mBlenderShader;
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="keywordtype">void</span> KX_BlenderMaterial::setTexData( <span class="keywordtype">bool</span> enable, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a> *ras)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320     <a class="code" href="../../dd/d62/classBL__Texture.html#a7465c3fb399a93acc4d81df4d1f7e23d">BL_Texture::DisableAllTextures</a>();
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="keywordflow">if</span> ( !enable ) {
<a name="l00323"></a>00323         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac46ac17f231437d1a99a5e05a4be6300">TF_SOLID</a>);
<a name="l00324"></a>00324         <span class="keywordflow">return</span>;
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <a class="code" href="../../dd/d62/classBL__Texture.html#a34aa44476783a77eb455c0d8a0711bd4">BL_Texture::ActivateFirst</a>();
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordflow">if</span> ( mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aefaccf78793cc724e61ecf71fa108bad">IdMode</a> == <a class="code" href="../../d1/d4a/BL__Material_8h.html#a366893b30d0095c834c9aba7df3f598caab313d21aeaa53db371daf27054afaee">DEFAULT_BLENDER</a> ) {
<a name="l00330"></a>00330         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>);
<a name="l00331"></a>00331         <span class="keywordflow">return</span>;
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="keywordflow">if</span> ( mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aefaccf78793cc724e61ecf71fa108bad">IdMode</a> == <a class="code" href="../../d1/d4a/BL__Material_8h.html#a366893b30d0095c834c9aba7df3f598caab4ddca2a74fe70b6f99f100056c6363">TEXFACE</a> ) {
<a name="l00335"></a>00335         <span class="comment">// no material connected to the object</span>
<a name="l00336"></a>00336         <span class="keywordflow">if</span> ( mTextures[0].Ok() ) {
<a name="l00337"></a>00337             mTextures[0].<a class="code" href="../../dd/d62/classBL__Texture.html#a44cb4afb3c296282fe62b3eaa6edb784">ActivateTexture</a>();
<a name="l00338"></a>00338             mTextures[0].<a class="code" href="../../dd/d62/classBL__Texture.html#a56c7981872a8bd2df0a2bcd944613193">setTexEnv</a>(0, <span class="keyword">true</span>);
<a name="l00339"></a>00339             mTextures[0].<a class="code" href="../../dd/d62/classBL__Texture.html#aa7ff36068002312ef7af2da67cfda067">SetMapping</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[0].<a class="code" href="../../df/d83/classBL__Mapping.html#a34bca173c0f2927d473ecad059e506c3">mapping</a>);
<a name="l00340"></a>00340             ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>);
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342         <span class="keywordflow">return</span>;
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordtype">int</span> mode = 0,i=0;
<a name="l00346"></a>00346     <span class="keywordflow">for</span> (i=0; (i&lt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a> &amp;&amp; i&lt;<a class="code" href="../../d1/d4a/BL__Material_8h.html#aeb2da7fb980f205aff939caf5eee99c9">MAXTEX</a>); i++) {
<a name="l00347"></a>00347         <span class="keywordflow">if</span> ( !mTextures[i].Ok() ) <span class="keywordflow">continue</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         mTextures[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dd/d62/classBL__Texture.html#a44cb4afb3c296282fe62b3eaa6edb784">ActivateTexture</a>();
<a name="l00350"></a>00350         mTextures[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dd/d62/classBL__Texture.html#a56c7981872a8bd2df0a2bcd944613193">setTexEnv</a>(mMaterial);
<a name="l00351"></a>00351         mode = mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/d83/classBL__Mapping.html#a34bca173c0f2927d473ecad059e506c3">mapping</a>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         <span class="keywordflow">if</span> (mode &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1a315b58cbd7861d8066148061235d7d70">USEOBJ</a>)
<a name="l00354"></a>00354             setObjectMatrixData(i, ras);
<a name="l00355"></a>00355         <span class="keywordflow">else</span>
<a name="l00356"></a>00356             mTextures[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../dd/d62/classBL__Texture.html#aa7ff36068002312ef7af2da67cfda067">SetMapping</a>(mode);
<a name="l00357"></a>00357         
<a name="l00358"></a>00358         <span class="keywordflow">if</span> (!(mode &amp;USEOBJ))
<a name="l00359"></a>00359             setTexMatrixData( i );
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (!mUserDefBlend) {
<a name="l00363"></a>00363         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>);
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365     <span class="keywordflow">else</span> {
<a name="l00366"></a>00366         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac46ac17f231437d1a99a5e05a4be6300">TF_SOLID</a>);
<a name="l00367"></a>00367         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(-1); <span class="comment">// indicates custom mode</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369         glEnable(GL_BLEND);
<a name="l00370"></a>00370         glBlendFunc(mBlendFunc[0], mBlendFunc[1]);
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="keywordtype">void</span>
<a name="l00375"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#ae648f7591c41ab5116f61365a05924d8">00375</a> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#ae648f7591c41ab5116f61365a05924d8">KX_BlenderMaterial::ActivatShaders</a>(
<a name="l00376"></a>00376     <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty, 
<a name="l00377"></a>00377     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a007a7094925dcc6932e0387f21288c28">TCachingInfo</a>&amp; cachingInfo)<span class="keyword">const</span>
<a name="l00378"></a>00378 <span class="keyword"></span>{
<a name="l00379"></a>00379     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a> *tmp = <span class="keyword">const_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="comment">// reset... </span>
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (tmp-&gt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a2aa102358a31b522449fb376fc9a90a4">IsShared</a>()) 
<a name="l00383"></a>00383         cachingInfo =0;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (mLastBlenderShader) {
<a name="l00386"></a>00386         mLastBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">false</span>);
<a name="l00387"></a>00387         mLastBlenderShader= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a9b4967a4ab8d150de291c235d3492592">GetCachingInfo</a>() != cachingInfo) {
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">if</span> (!cachingInfo)
<a name="l00393"></a>00393             tmp-&gt;setShaderData(<span class="keyword">false</span>, rasty);
<a name="l00394"></a>00394         
<a name="l00395"></a>00395         cachingInfo = <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a9b4967a4ab8d150de291c235d3492592">GetCachingInfo</a>();
<a name="l00396"></a>00396     
<a name="l00397"></a>00397         <span class="keywordflow">if</span> (rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() == <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba4b378cf7c027c56584bd10ef212077ba">RAS_IRasterizer::KX_TEXTURED</a>)
<a name="l00398"></a>00398             tmp-&gt;setShaderData(<span class="keyword">true</span>, rasty);
<a name="l00399"></a>00399         <span class="keywordflow">else</span>
<a name="l00400"></a>00400             tmp-&gt;setShaderData(<span class="keyword">false</span>, rasty);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9bad771d2ec808c427ad0df0c177e9ee400">TWOSIDED</a>)
<a name="l00403"></a>00403             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">false</span>);
<a name="l00404"></a>00404         <span class="keywordflow">else</span>
<a name="l00405"></a>00405             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">true</span>);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         <span class="keywordflow">if</span> ((mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1f1dd8e7a28788f8b1f2635baafe0d9b">WIRE</a>) ||
<a name="l00408"></a>00408             (rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() &lt;= <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba42b1f0cdcb33a403cbbe8c2f1c98d353">RAS_IRasterizer::KX_WIREFRAME</a>))
<a name="l00409"></a>00409         {       
<a name="l00410"></a>00410             <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1f1dd8e7a28788f8b1f2635baafe0d9b">WIRE</a>) 
<a name="l00411"></a>00411                 rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">false</span>);
<a name="l00412"></a>00412             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a13c9704475745a14d182317f8bef274c">SetLines</a>(<span class="keyword">true</span>);
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414         <span class="keywordflow">else</span>
<a name="l00415"></a>00415             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a13c9704475745a14d182317f8bef274c">SetLines</a>(<span class="keyword">false</span>);
<a name="l00416"></a>00416         ActivatGLMaterials(rasty);
<a name="l00417"></a>00417         ActivateTexGen(rasty);
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="comment">//ActivatGLMaterials(rasty);</span>
<a name="l00421"></a>00421     <span class="comment">//ActivateTexGen(rasty);</span>
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keywordtype">void</span>
<a name="l00425"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a8468e34bd6d58d2327b9b1772ca75a3a">00425</a> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a8468e34bd6d58d2327b9b1772ca75a3a">KX_BlenderMaterial::ActivateBlenderShaders</a>(
<a name="l00426"></a>00426     <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty, 
<a name="l00427"></a>00427     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a007a7094925dcc6932e0387f21288c28">TCachingInfo</a>&amp; cachingInfo)<span class="keyword">const</span>
<a name="l00428"></a>00428 <span class="keyword"></span>{
<a name="l00429"></a>00429     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a> *tmp = <span class="keyword">const_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (mLastShader) {
<a name="l00432"></a>00432         mLastShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">false</span>);
<a name="l00433"></a>00433         mLastShader= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a9b4967a4ab8d150de291c235d3492592">GetCachingInfo</a>() != cachingInfo) {
<a name="l00437"></a>00437         <span class="keywordflow">if</span> (!cachingInfo)
<a name="l00438"></a>00438             tmp-&gt;setBlenderShaderData(<span class="keyword">false</span>, rasty);
<a name="l00439"></a>00439         
<a name="l00440"></a>00440         cachingInfo = <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a9b4967a4ab8d150de291c235d3492592">GetCachingInfo</a>();
<a name="l00441"></a>00441     
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() == <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba4b378cf7c027c56584bd10ef212077ba">RAS_IRasterizer::KX_TEXTURED</a>)
<a name="l00443"></a>00443             tmp-&gt;setBlenderShaderData(<span class="keyword">true</span>, rasty);
<a name="l00444"></a>00444         <span class="keywordflow">else</span>
<a name="l00445"></a>00445             tmp-&gt;setBlenderShaderData(<span class="keyword">false</span>, rasty);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447         <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9bad771d2ec808c427ad0df0c177e9ee400">TWOSIDED</a>)
<a name="l00448"></a>00448             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">false</span>);
<a name="l00449"></a>00449         <span class="keywordflow">else</span>
<a name="l00450"></a>00450             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">true</span>);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452         <span class="keywordflow">if</span> ((mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1f1dd8e7a28788f8b1f2635baafe0d9b">WIRE</a>) ||
<a name="l00453"></a>00453             (rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() &lt;= <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba42b1f0cdcb33a403cbbe8c2f1c98d353">RAS_IRasterizer::KX_WIREFRAME</a>))
<a name="l00454"></a>00454         {       
<a name="l00455"></a>00455             <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1f1dd8e7a28788f8b1f2635baafe0d9b">WIRE</a>) 
<a name="l00456"></a>00456                 rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">false</span>);
<a name="l00457"></a>00457             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a13c9704475745a14d182317f8bef274c">SetLines</a>(<span class="keyword">true</span>);
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459         <span class="keywordflow">else</span>
<a name="l00460"></a>00460             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a13c9704475745a14d182317f8bef274c">SetLines</a>(<span class="keyword">false</span>);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         ActivatGLMaterials(rasty);
<a name="l00463"></a>00463         mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#ae1db8988f76a83b02d5fe24fa6d2124f">SetAttribs</a>(rasty, mMaterial);
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465 }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="keywordtype">void</span>
<a name="l00468"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a5dac733de72bcbb89da7d2833972486b">00468</a> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a5dac733de72bcbb89da7d2833972486b">KX_BlenderMaterial::ActivateMat</a>( 
<a name="l00469"></a>00469     <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty,  
<a name="l00470"></a>00470     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a007a7094925dcc6932e0387f21288c28">TCachingInfo</a>&amp; cachingInfo
<a name="l00471"></a>00471     )<span class="keyword">const</span>
<a name="l00472"></a>00472 <span class="keyword"></span>{
<a name="l00473"></a>00473     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a> *tmp = <span class="keyword">const_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (mLastShader) {
<a name="l00476"></a>00476         mLastShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">false</span>);
<a name="l00477"></a>00477         mLastShader= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keywordflow">if</span> (mLastBlenderShader) {
<a name="l00481"></a>00481         mLastBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aea7431301b5c55e7def651871df62f62">SetProg</a>(<span class="keyword">false</span>);
<a name="l00482"></a>00482         mLastBlenderShader= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a9b4967a4ab8d150de291c235d3492592">GetCachingInfo</a>() != cachingInfo) {
<a name="l00486"></a>00486         <span class="keywordflow">if</span> (!cachingInfo) 
<a name="l00487"></a>00487             tmp-&gt;setTexData( <span class="keyword">false</span>,rasty );
<a name="l00488"></a>00488         
<a name="l00489"></a>00489         cachingInfo = <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a9b4967a4ab8d150de291c235d3492592">GetCachingInfo</a>();
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         <span class="keywordflow">if</span> (rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() == <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba4b378cf7c027c56584bd10ef212077ba">RAS_IRasterizer::KX_TEXTURED</a>)
<a name="l00492"></a>00492             tmp-&gt;setTexData( <span class="keyword">true</span>,rasty  );
<a name="l00493"></a>00493         <span class="keywordflow">else</span>
<a name="l00494"></a>00494             tmp-&gt;setTexData( <span class="keyword">false</span>,rasty);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9bad771d2ec808c427ad0df0c177e9ee400">TWOSIDED</a>)
<a name="l00497"></a>00497             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">false</span>);
<a name="l00498"></a>00498         <span class="keywordflow">else</span>
<a name="l00499"></a>00499             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">true</span>);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="keywordflow">if</span> ((mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1f1dd8e7a28788f8b1f2635baafe0d9b">WIRE</a>) ||
<a name="l00502"></a>00502             (rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() &lt;= <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba42b1f0cdcb33a403cbbe8c2f1c98d353">RAS_IRasterizer::KX_WIREFRAME</a>))
<a name="l00503"></a>00503         {       
<a name="l00504"></a>00504             <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a85f714f47470dfdaa7b87fa72965f73e">ras_mode</a> &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba1f1dd8e7a28788f8b1f2635baafe0d9b">WIRE</a>) 
<a name="l00505"></a>00505                 rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1abe5ed9575ed2da1759dd943f0ffac3">SetCullFace</a>(<span class="keyword">false</span>);
<a name="l00506"></a>00506             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a13c9704475745a14d182317f8bef274c">SetLines</a>(<span class="keyword">true</span>);
<a name="l00507"></a>00507         }
<a name="l00508"></a>00508         <span class="keywordflow">else</span>
<a name="l00509"></a>00509             rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a13c9704475745a14d182317f8bef274c">SetLines</a>(<span class="keyword">false</span>);
<a name="l00510"></a>00510         ActivatGLMaterials(rasty);
<a name="l00511"></a>00511         ActivateTexGen(rasty);
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="comment">//ActivatGLMaterials(rasty);</span>
<a name="l00515"></a>00515     <span class="comment">//ActivateTexGen(rasty);</span>
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="keywordtype">bool</span> 
<a name="l00519"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a6ab72f0cde6c81e8ef017433cf91f793">00519</a> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a6ab72f0cde6c81e8ef017433cf91f793">KX_BlenderMaterial::Activate</a>( 
<a name="l00520"></a>00520     <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty,  
<a name="l00521"></a>00521     <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a007a7094925dcc6932e0387f21288c28">TCachingInfo</a>&amp; cachingInfo
<a name="l00522"></a>00522     )<span class="keyword">const</span>
<a name="l00523"></a>00523 <span class="keyword"></span>{
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (GLEW_ARB_shader_objects &amp;&amp; (mShader &amp;&amp; mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a2d3744535bfbcb27f43b16055d9b84dd">Ok</a>())) {
<a name="l00525"></a>00525         <span class="keywordflow">if</span> ((mPass++) &lt; mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a410c569d2de0586dbcff301267f619ff">getNumPass</a>() ) {
<a name="l00526"></a>00526             <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#ae648f7591c41ab5116f61365a05924d8">ActivatShaders</a>(rasty, cachingInfo);
<a name="l00527"></a>00527             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529         <span class="keywordflow">else</span> {
<a name="l00530"></a>00530             <span class="keywordflow">if</span> (mShader == mLastShader) {
<a name="l00531"></a>00531                 mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a96dc19e2aee37061e8b59679ab6e9990">SetProg</a>(<span class="keyword">false</span>);
<a name="l00532"></a>00532                 mLastShader = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00533"></a>00533             }
<a name="l00534"></a>00534             mPass = 0;
<a name="l00535"></a>00535             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GLEW_ARB_shader_objects &amp;&amp; (mBlenderShader &amp;&amp; mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aedebb4bd34a92b2ec631c0c77aeb1e7a">Ok</a>() ) ) {
<a name="l00539"></a>00539         <span class="keywordflow">if</span> (mPass++ == 0) {
<a name="l00540"></a>00540             <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a8468e34bd6d58d2327b9b1772ca75a3a">ActivateBlenderShaders</a>(rasty, cachingInfo);
<a name="l00541"></a>00541             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00542"></a>00542         }
<a name="l00543"></a>00543         <span class="keywordflow">else</span> {
<a name="l00544"></a>00544             mPass = 0;
<a name="l00545"></a>00545             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="keywordflow">else</span> {
<a name="l00549"></a>00549         <span class="keywordflow">if</span> (mPass++ == 0) {
<a name="l00550"></a>00550             <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a5dac733de72bcbb89da7d2833972486b">ActivateMat</a>(rasty, cachingInfo);
<a name="l00551"></a>00551             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553         <span class="keywordflow">else</span> {
<a name="l00554"></a>00554             mPass = 0;
<a name="l00555"></a>00555             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="keywordtype">bool</span> KX_BlenderMaterial::UsesLighting(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a> *rasty)<span class="keyword"> const</span>
<a name="l00561"></a>00561 <span class="keyword"></span>{
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#aeb42978b16eaace7394590109d6ab373">RAS_IPolyMaterial::UsesLighting</a>(rasty))
<a name="l00563"></a>00563         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="keywordflow">if</span> (mShader &amp;&amp; mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a2d3744535bfbcb27f43b16055d9b84dd">Ok</a>())
<a name="l00566"></a>00566         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00567"></a>00567     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mBlenderShader &amp;&amp; mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aedebb4bd34a92b2ec631c0c77aeb1e7a">Ok</a>())
<a name="l00568"></a>00568         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00569"></a>00569     <span class="keywordflow">else</span>
<a name="l00570"></a>00570         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a59254e795246524a4b8c831c50a7ac0d">00573</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a59254e795246524a4b8c831c50a7ac0d">KX_BlenderMaterial::ActivateMeshSlot</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d4a/classRAS__MeshSlot.html">RAS_MeshSlot</a> &amp; ms, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty)<span class="keyword"> const</span>
<a name="l00574"></a>00574 <span class="keyword"></span>{
<a name="l00575"></a>00575     <span class="keywordflow">if</span> (mShader &amp;&amp; GLEW_ARB_shader_objects) {
<a name="l00576"></a>00576         mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#afd0e605292bc5f077470d7508ceec79d">Update</a>(ms, rasty);
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mBlenderShader &amp;&amp; GLEW_ARB_shader_objects) {
<a name="l00579"></a>00579         <span class="keywordtype">int</span> alphablend;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#ac502ac1f461b15f88d92f2f9e93dbc97">Update</a>(ms, rasty);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         <span class="comment">/* we do blend modes here, because they can change per object</span>
<a name="l00584"></a>00584 <span class="comment">         * with the same material due to obcolor/obalpha */</span>
<a name="l00585"></a>00585         alphablend = mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#a0c0cef0a1397f84de1c247509b2e8341">GetAlphaBlend</a>();
<a name="l00586"></a>00586         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(alphablend, <a class="code" href="../../de/db2/DNA__material__types_8h.html#ad7029d7af71941a92a514e74ed001727">GEMAT_SOLID</a>, <a class="code" href="../../de/db2/DNA__material__types_8h.html#a9d7f03d458ed9eb326964cd8733f7b94">GEMAT_ALPHA</a>, <a class="code" href="../../de/db2/DNA__material__types_8h.html#a03ed6bc55badbc77d9c6d9617a54bd0e">GEMAT_ALPHA_SORT</a>) &amp;&amp; mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a> != <a class="code" href="../../de/db2/DNA__material__types_8h.html#ad7029d7af71941a92a514e74ed001727">GEMAT_SOLID</a>)
<a name="l00587"></a>00587             alphablend = mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad5f88801ba2d792a50c4a5c7937922e4">alphablend</a>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad4f1851e577fa001088a43719ab9f710">SetAlphaBlend</a>(alphablend);
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591 }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 <span class="keywordtype">void</span> KX_BlenderMaterial::ActivatGLMaterials( <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a>* rasty )<span class="keyword">const</span>
<a name="l00594"></a>00594 <span class="keyword"></span>{
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (mShader || !mBlenderShader) {
<a name="l00596"></a>00596         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a07e8e7dfd7d07cccbbbbdbb79fd6b30d">SetSpecularity</a>(
<a name="l00597"></a>00597             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#afa6b568dcb05ada4a3fec8bcbedb27ac">speccolor</a>[0]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a5378323b6b6595b39563ef9b48686083">spec_f</a>,
<a name="l00598"></a>00598             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#afa6b568dcb05ada4a3fec8bcbedb27ac">speccolor</a>[1]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a5378323b6b6595b39563ef9b48686083">spec_f</a>,
<a name="l00599"></a>00599             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#afa6b568dcb05ada4a3fec8bcbedb27ac">speccolor</a>[2]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a5378323b6b6595b39563ef9b48686083">spec_f</a>,
<a name="l00600"></a>00600             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a5378323b6b6595b39563ef9b48686083">spec_f</a>
<a name="l00601"></a>00601         );
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a057dc3942ee96896c4734316e8254ee4">SetShinyness</a>( mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ab6dd9213323693fc1462df1cd90293f3">hard</a> );
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a46c32ed855acc3ed4a80587e30cc9434">SetDiffuse</a>(
<a name="l00606"></a>00606             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[0]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a705bf8d05c7b895ab699c4ecfeb17179">ref</a>+mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>, 
<a name="l00607"></a>00607             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[1]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a705bf8d05c7b895ab699c4ecfeb17179">ref</a>+mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>,
<a name="l00608"></a>00608             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[2]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a705bf8d05c7b895ab699c4ecfeb17179">ref</a>+mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>,
<a name="l00609"></a>00609             1.0f);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a25f746fd54402f1acc81e94fbf40f619">SetEmissive</a>( 
<a name="l00612"></a>00612             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[0]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>,
<a name="l00613"></a>00613             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[1]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>,
<a name="l00614"></a>00614             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[2]*mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>,
<a name="l00615"></a>00615             1.0 );
<a name="l00616"></a>00616 
<a name="l00617"></a>00617         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a806ed1a87f19ed9d6c3315e2e7766b08">SetAmbient</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a40cadb7ee87e3413703c569554d3d69c">amb</a>);
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a81464bdc9a517649d0f2342cb801e9dd">material</a>)
<a name="l00621"></a>00621         rasty-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#addab9046a007903147c959bd3faf4ea2">SetPolygonOffset</a>(-mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a81464bdc9a517649d0f2342cb801e9dd">material</a>-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a6b25cd47dfe48cc8708b3694925e0266">zoffs</a>, 0.0);
<a name="l00622"></a>00622 }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="keywordtype">void</span> KX_BlenderMaterial::ActivateTexGen(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a> *ras)<span class="keyword"> const</span>
<a name="l00626"></a>00626 <span class="keyword"></span>{
<a name="l00627"></a>00627     <span class="keywordflow">if</span> (ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() == <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba4b378cf7c027c56584bd10ef212077ba">RAS_IRasterizer::KX_TEXTURED</a>) {
<a name="l00628"></a>00628         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1638afac41df95e717ae710dc3872704">SetAttribNum</a>(0);
<a name="l00629"></a>00629         <span class="keywordflow">if</span> (mShader &amp;&amp; GLEW_ARB_shader_objects) {
<a name="l00630"></a>00630             <span class="keywordflow">if</span> (mShader-&gt;<a class="code" href="../../dd/da0/classBL__Shader.html#a8e3a96e61c6bd840086770948daca107">GetAttribute</a>() == <a class="code" href="../../dd/da0/classBL__Shader.html#adbe050fa99339673ddf7002b9aae9913a8ef7d83d42bc92895ffdd98717830639">BL_Shader::SHD_TANGENT</a>) {
<a name="l00631"></a>00631                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a748bb722f1eff80815fedda651a3a3d1">SetAttrib</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a5385f8d6632e3828505627fae87d3b8d">RAS_IRasterizer::RAS_TEXCO_DISABLE</a>, 0);
<a name="l00632"></a>00632                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a748bb722f1eff80815fedda651a3a3d1">SetAttrib</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14ae93295e7d520e08600a3f62c2131e67d">RAS_IRasterizer::RAS_TEXTANGENT</a>, 1);
<a name="l00633"></a>00633                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1638afac41df95e717ae710dc3872704">SetAttribNum</a>(2);
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6aa8b0e9473cfca759298ba4343be16b">SetTexCoordNum</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad49c1d1d2dab4c87e062eee87ccfd514">num_enabled</a>; i++) {
<a name="l00640"></a>00640             <span class="keywordtype">int</span> mode = mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../df/d83/classBL__Mapping.html#a34bca173c0f2927d473ecad059e506c3">mapping</a>;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642             <span class="keywordflow">if</span> (mode &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1a4a87ef84950a0adb8ad08797e692d026">USECUSTOMUV</a>)
<a name="l00643"></a>00643             {
<a name="l00644"></a>00644                 <span class="keywordflow">if</span> (!mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a24bc80a1d8ee32efd1dfeb288bcddec2">uvCoName</a>.<a class="code" href="../../d6/dce/classSTR__String.html#a0160aebe91ec2ecd92f1190bafea7cf9">IsEmpty</a>())
<a name="l00645"></a>00645                     ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a14356dd609743f32360c34fd35dfd9ec">RAS_IRasterizer::RAS_TEXCO_UV2</a>, i);
<a name="l00646"></a>00646                 <span class="keywordflow">continue</span>;
<a name="l00647"></a>00647             }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649             <span class="keywordflow">if</span> ( mode &amp;(<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1af542db7ac20b88f9e6f21cf6124a8bdd">USEREFL</a>|USEOBJ))
<a name="l00650"></a>00650                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a27ce094de2e12f5ef4f5823de39f5c91">RAS_IRasterizer::RAS_TEXCO_GEN</a>, i);
<a name="l00651"></a>00651             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1ae7fac6f2eced03499db66dbb86b56f2b">USEORCO</a>)
<a name="l00652"></a>00652                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a6a284be92fb9f4dabd31293622ed56b2">RAS_IRasterizer::RAS_TEXCO_ORCO</a>, i);
<a name="l00653"></a>00653             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1a66edc3f6d3c97e493aec1408dd3fff94">USENORM</a>)
<a name="l00654"></a>00654                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a6754e9d445c2d93238ed8442ff23b08a">RAS_IRasterizer::RAS_TEXCO_NORM</a>, i);
<a name="l00655"></a>00655             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1abd3621dd64f8e5135230d56ea99ecff2">USEUV</a>)
<a name="l00656"></a>00656                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a3c232999e770d41316484e39bdc72136">RAS_IRasterizer::RAS_TEXCO_UV1</a>, i);
<a name="l00657"></a>00657             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode &amp;<a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1a8969bc09d7e930014cd4c3734297d3bc">USETANG</a>)
<a name="l00658"></a>00658                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14ae93295e7d520e08600a3f62c2131e67d">RAS_IRasterizer::RAS_TEXTANGENT</a>, i);
<a name="l00659"></a>00659             <span class="keywordflow">else</span> 
<a name="l00660"></a>00660                 ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1809fcaee2d50fa5a22e1964e6bcdbbd">SetTexCoord</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a6af065004b17e2f09464586389d65b14a5385f8d6632e3828505627fae87d3b8d">RAS_IRasterizer::RAS_TEXCO_DISABLE</a>, i);
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="keywordtype">void</span> KX_BlenderMaterial::setTexMatrixData(<span class="keywordtype">int</span> i)
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667     glMatrixMode(GL_TEXTURE);
<a name="l00668"></a>00668     glLoadIdentity();
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="keywordflow">if</span> ( GLEW_ARB_texture_cube_map &amp;&amp; 
<a name="l00671"></a>00671         mTextures[i].GetTextureType() == GL_TEXTURE_CUBE_MAP_ARB &amp;&amp; 
<a name="l00672"></a>00672         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a34bca173c0f2927d473ecad059e506c3">mapping</a> &amp; <a class="code" href="../../d1/d4a/BL__Material_8h.html#afb634ae509c7658da38254fd11f8b8e1af542db7ac20b88f9e6f21cf6124a8bdd">USEREFL</a>) {
<a name="l00673"></a>00673         glScalef( 
<a name="l00674"></a>00674             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[0], 
<a name="l00675"></a>00675             -mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[1], 
<a name="l00676"></a>00676             -mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[2]
<a name="l00677"></a>00677         );
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679     <span class="keywordflow">else</span>
<a name="l00680"></a>00680     {
<a name="l00681"></a>00681         glScalef( 
<a name="l00682"></a>00682             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[0], 
<a name="l00683"></a>00683             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[1], 
<a name="l00684"></a>00684             mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[2]
<a name="l00685"></a>00685         );
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687     glTranslatef(
<a name="l00688"></a>00688         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a4eef8eed260cfad3d7a30b1dfe81760b">offsets</a>[0],
<a name="l00689"></a>00689         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a4eef8eed260cfad3d7a30b1dfe81760b">offsets</a>[1], 
<a name="l00690"></a>00690         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a4eef8eed260cfad3d7a30b1dfe81760b">offsets</a>[2]
<a name="l00691"></a>00691     );
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     glMatrixMode(GL_MODELVIEW);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 }
<a name="l00696"></a>00696 
<a name="l00697"></a><a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#aa2d0a1af05a31e26c4d4861563a38800">00697</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#aa2d0a1af05a31e26c4d4861563a38800">GetProjPlane</a>(<a class="code" href="../../d3/de1/classBL__Material.html">BL_Material</a> *mat, <span class="keywordtype">int</span> index,<span class="keywordtype">int</span> num, <span class="keywordtype">float</span>*param)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     param[0]=param[1]=param[2]=param[3]=0.f;
<a name="l00700"></a>00700     <span class="keywordflow">if</span> ( mat-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[index].<a class="code" href="../../df/d83/classBL__Mapping.html#ae427bbcbd9bb8c1be9cbef56a8556daa">projplane</a>[num] == <a class="code" href="../../d1/d4a/BL__Material_8h.html#afeec838fc2b3f261f772a600c5d4eaeca952e230850b69e18a19b2c0cb6c632ae">PROJX</a> )
<a name="l00701"></a>00701         param[0] = 1.f;
<a name="l00702"></a>00702     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( mat-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[index].<a class="code" href="../../df/d83/classBL__Mapping.html#ae427bbcbd9bb8c1be9cbef56a8556daa">projplane</a>[num] == <a class="code" href="../../d1/d4a/BL__Material_8h.html#afeec838fc2b3f261f772a600c5d4eaeca8e82c55c3a8426e12f35b6c9e53d1475">PROJY</a> )
<a name="l00703"></a>00703         param[1] = 1.f;
<a name="l00704"></a>00704     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( mat-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[index].<a class="code" href="../../df/d83/classBL__Mapping.html#ae427bbcbd9bb8c1be9cbef56a8556daa">projplane</a>[num] == <a class="code" href="../../d1/d4a/BL__Material_8h.html#afeec838fc2b3f261f772a600c5d4eaeca7bf30bff244c0aa446ca4f752d4635ae">PROJZ</a>)
<a name="l00705"></a>00705         param[2] = 1.f;
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 <span class="keywordtype">void</span> KX_BlenderMaterial::setObjectMatrixData(<span class="keywordtype">int</span> i, <a class="code" href="../../d3/d64/classRAS__IRasterizer.html">RAS_IRasterizer</a> *ras)
<a name="l00709"></a>00709 {
<a name="l00710"></a>00710     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *obj = 
<a name="l00711"></a>00711         (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)
<a name="l00712"></a>00712         mScene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>()-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aecd532f5a0cb3c6f6b9bc234267c006e">FindValue</a>(mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a13096967c252a6493acfb7a1c9cd31a6">objconame</a>);
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="keywordflow">if</span> (!obj) <span class="keywordflow">return</span>;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     glTexGeni(GL_S, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR );
<a name="l00717"></a>00717     glTexGeni(GL_T, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR );
<a name="l00718"></a>00718     glTexGeni(GL_R, GL_TEXTURE_GEN_MODE, GL_EYE_LINEAR );
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     GLenum plane = GL_EYE_PLANE;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     <span class="comment">// figure plane gen</span>
<a name="l00723"></a>00723     <span class="keywordtype">float</span> proj[4]= {0.f,0.f,0.f,0.f};
<a name="l00724"></a>00724     <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#aa2d0a1af05a31e26c4d4861563a38800">GetProjPlane</a>(mMaterial, i, 0, proj);
<a name="l00725"></a>00725     glTexGenfv(GL_S, plane, proj);
<a name="l00726"></a>00726     
<a name="l00727"></a>00727     <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#aa2d0a1af05a31e26c4d4861563a38800">GetProjPlane</a>(mMaterial, i, 1, proj);
<a name="l00728"></a>00728     glTexGenfv(GL_T, plane, proj);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#aa2d0a1af05a31e26c4d4861563a38800">GetProjPlane</a>(mMaterial, i, 2, proj);
<a name="l00731"></a>00731     glTexGenfv(GL_R, plane, proj);
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     glEnable(GL_TEXTURE_GEN_S);
<a name="l00734"></a>00734     glEnable(GL_TEXTURE_GEN_T);
<a name="l00735"></a>00735     glEnable(GL_TEXTURE_GEN_R);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="keyword">const</span> <a class="code" href="../../d0/d08/classMT__Matrix4x4.html">MT_Matrix4x4</a>&amp; mvmat = ras-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ad0dd1f5ff12960909f938abff3e5824e">GetViewMatrix</a>();
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     glMatrixMode(GL_TEXTURE);
<a name="l00740"></a>00740     glLoadIdentity();
<a name="l00741"></a>00741     glScalef( 
<a name="l00742"></a>00742         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[0], 
<a name="l00743"></a>00743         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[1], 
<a name="l00744"></a>00744         mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#aaf6969faa26c953fbd56f9cda6f44605">mapping</a>[i].<a class="code" href="../../df/d83/classBL__Mapping.html#a18ce08c8591019f83fd14a3c1128b468">scale</a>[2]
<a name="l00745"></a>00745     );
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> pos = obj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>();
<a name="l00748"></a>00748     <a class="code" href="../../d2/dfc/classMT__Vector4.html">MT_Vector4</a> matmul = <a class="code" href="../../d2/dfc/classMT__Vector4.html">MT_Vector4</a>(pos[0], pos[1], pos[2], 1.f);
<a name="l00749"></a>00749     <a class="code" href="../../d2/dfc/classMT__Vector4.html">MT_Vector4</a> t = mvmat*matmul;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     glTranslatef( (<span class="keywordtype">float</span>)(-t[0]), (<span class="keywordtype">float</span>)(-t[1]), (<span class="keywordtype">float</span>)(-t[2]) );
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     glMatrixMode(GL_MODELVIEW);
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="comment">// ------------------------------------</span>
<a name="l00758"></a><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a8d6948dd21dd1192381747306c778070">00758</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a8d6948dd21dd1192381747306c778070">KX_BlenderMaterial::UpdateIPO</a>(
<a name="l00759"></a>00759     <a class="code" href="../../d2/dfc/classMT__Vector4.html">MT_Vector4</a> rgba,
<a name="l00760"></a>00760     <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> specrgb,
<a name="l00761"></a>00761     <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> hard,
<a name="l00762"></a>00762     <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> <a class="code" href="../../d1/ddb/shadeoutput_8c.html#ad41f5027c52d07f258337a69bddd7ded">spec</a>,
<a name="l00763"></a>00763     <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> ref,
<a name="l00764"></a>00764     <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> emit,
<a name="l00765"></a>00765     <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> alpha
<a name="l00766"></a>00766     )
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <span class="comment">// only works one deep now</span>
<a name="l00769"></a>00769     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#afa6b568dcb05ada4a3fec8bcbedb27ac">speccolor</a>[0] = (float)(specrgb)[0];
<a name="l00770"></a>00770     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#afa6b568dcb05ada4a3fec8bcbedb27ac">speccolor</a>[1] = (float)(specrgb)[1];
<a name="l00771"></a>00771     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#afa6b568dcb05ada4a3fec8bcbedb27ac">speccolor</a>[2] = (float)(specrgb)[2];
<a name="l00772"></a>00772     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[0]  = (float)(rgba[0]);
<a name="l00773"></a>00773     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[1]  = (float)(rgba[1]);
<a name="l00774"></a>00774     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ad59a47825d7ca71b42c0a98a93c72aec">matcolor</a>[2]  = (float)(rgba[2]);
<a name="l00775"></a>00775     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a55b977971c633fa5c857ffc9c3c48a0e">alpha</a>        = (float)(alpha);
<a name="l00776"></a>00776     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#ab6dd9213323693fc1462df1cd90293f3">hard</a>         = (float)(hard);
<a name="l00777"></a>00777     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a07e351056d5590815910e1d2efa66a14">emit</a>         = (float)(emit);
<a name="l00778"></a>00778     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a5378323b6b6595b39563ef9b48686083">spec_f</a>       = (float)(spec);
<a name="l00779"></a>00779     mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a705bf8d05c7b895ab699c4ecfeb17179">ref</a>          = (float)(ref);
<a name="l00780"></a>00780 }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 <span class="keywordtype">void</span> KX_BlenderMaterial::SetBlenderGLSLShader(<span class="keywordtype">int</span> layer)
<a name="l00783"></a>00783 {
<a name="l00784"></a>00784     <span class="keywordflow">if</span> (!mBlenderShader)
<a name="l00785"></a>00785         mBlenderShader = <span class="keyword">new</span> <a class="code" href="../../de/dd2/classBL__BlenderShader.html">BL_BlenderShader</a>(mScene, mMaterial-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a81464bdc9a517649d0f2342cb801e9dd">material</a>, layer);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (!mBlenderShader-&gt;<a class="code" href="../../de/dd2/classBL__BlenderShader.html#aedebb4bd34a92b2ec631c0c77aeb1e7a">Ok</a>()) {
<a name="l00788"></a>00788         <span class="keyword">delete</span> mBlenderShader;
<a name="l00789"></a>00789         mBlenderShader = 0;
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00794"></a>00794 <span class="preprocessor"></span>
<a name="l00795"></a>00795 PyMethodDef KX_BlenderMaterial::Methods[] = 
<a name="l00796"></a>00796 {
<a name="l00797"></a>00797     KX_PYMETHODTABLE( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, getShader ),
<a name="l00798"></a>00798     KX_PYMETHODTABLE( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, getMaterialIndex ),
<a name="l00799"></a>00799     KX_PYMETHODTABLE( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, setBlending ),
<a name="l00800"></a>00800     {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>} <span class="comment">//Sentinel</span>
<a name="l00801"></a>00801 };
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 PyAttributeDef KX_BlenderMaterial::Attributes[] = {
<a name="l00804"></a>00804     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;shader&quot;</span>, <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, pyattr_get_shader),
<a name="l00805"></a>00805     KX_PYATTRIBUTE_RO_FUNCTION(<span class="stringliteral">&quot;material_index&quot;</span>, <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, pyattr_get_materialIndex),
<a name="l00806"></a>00806     KX_PYATTRIBUTE_RW_FUNCTION(<span class="stringliteral">&quot;blending&quot;</span>, <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, pyattr_get_blending, pyattr_set_blending),
<a name="l00807"></a>00807     { <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> }    <span class="comment">//Sentinel</span>
<a name="l00808"></a>00808 };
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 PyTypeObject KX_BlenderMaterial::Type = {
<a name="l00811"></a>00811     PyVarObject_HEAD_INIT(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)
<a name="l00812"></a>00812     <span class="stringliteral">&quot;KX_BlenderMaterial&quot;</span>,
<a name="l00813"></a>00813     <span class="keyword">sizeof</span>(PyObjectPlus_Proxy),
<a name="l00814"></a>00814     0,
<a name="l00815"></a>00815     py_base_dealloc,
<a name="l00816"></a>00816     0,
<a name="l00817"></a>00817     0,
<a name="l00818"></a>00818     0,
<a name="l00819"></a>00819     0,
<a name="l00820"></a>00820     py_base_repr,
<a name="l00821"></a>00821     0,0,0,0,0,0,0,0,0,
<a name="l00822"></a>00822     Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE,
<a name="l00823"></a>00823     0,0,0,0,0,0,0,
<a name="l00824"></a>00824     Methods,
<a name="l00825"></a>00825     0,
<a name="l00826"></a>00826     0,
<a name="l00827"></a>00827     &amp;PyObjectPlus::Type,
<a name="l00828"></a>00828     0,0,0,0,0,0,
<a name="l00829"></a>00829     py_base_new
<a name="l00830"></a>00830 };
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 PyObject* KX_BlenderMaterial::pyattr_get_shader(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l00833"></a>00833 {
<a name="l00834"></a>00834     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l00835"></a>00835     <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;PygetShader(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00836"></a>00836 }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838 PyObject* KX_BlenderMaterial::pyattr_get_materialIndex(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l00839"></a>00839 {
<a name="l00840"></a>00840     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l00841"></a>00841     <span class="keywordflow">return</span> PyLong_FromSsize_t(self-&gt;GetMaterialIndex());
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 PyObject* KX_BlenderMaterial::pyattr_get_blending(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l00845"></a>00845 {
<a name="l00846"></a>00846     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l00847"></a>00847     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* bfunc = <span class="keyword">self</span>-&gt;<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#ac394aba847cf9d769e83a260d7e133fa">getBlendFunc</a>();
<a name="l00848"></a>00848     <span class="keywordflow">return</span> Py_BuildValue(<span class="stringliteral">&quot;(ll)&quot;</span>, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)bfunc[0], (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)bfunc[1]);
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 <span class="keywordtype">int</span> KX_BlenderMaterial::pyattr_set_blending(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef, PyObject *value)
<a name="l00852"></a>00852 {
<a name="l00853"></a>00853     <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l00854"></a>00854     PyObject* obj = <span class="keyword">self</span>-&gt;PysetBlending(value, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (obj)
<a name="l00856"></a>00856     {
<a name="l00857"></a>00857         Py_DECREF(obj);
<a name="l00858"></a>00858         <span class="keywordflow">return</span> 0;
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860     <span class="keywordflow">return</span> -1;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 KX_PYMETHODDEF_DOC( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, getShader , <span class="stringliteral">&quot;getShader()&quot;</span>)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865     <span class="keywordflow">if</span> ( !GLEW_ARB_fragment_shader) {
<a name="l00866"></a>00866         <span class="keywordflow">if</span> (!mModified)
<a name="l00867"></a>00867             <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">spit</a>(<span class="stringliteral">&quot;Fragment shaders not supported&quot;</span>);
<a name="l00868"></a>00868     
<a name="l00869"></a>00869         mModified = <span class="keyword">true</span>;
<a name="l00870"></a>00870         Py_RETURN_NONE;
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="keywordflow">if</span> ( !GLEW_ARB_vertex_shader) {
<a name="l00874"></a>00874         <span class="keywordflow">if</span> (!mModified)
<a name="l00875"></a>00875             <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">spit</a>(<span class="stringliteral">&quot;Vertex shaders not supported&quot;</span>);
<a name="l00876"></a>00876 
<a name="l00877"></a>00877         mModified = <span class="keyword">true</span>;
<a name="l00878"></a>00878         Py_RETURN_NONE;
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     <span class="keywordflow">if</span> (!GLEW_ARB_shader_objects)  {
<a name="l00882"></a>00882         <span class="keywordflow">if</span> (!mModified)
<a name="l00883"></a>00883             <a class="code" href="../../d0/d32/KX__BlenderMaterial_8cpp.html#a7b78f8a1799dfc55680379095001838f">spit</a>(<span class="stringliteral">&quot;GLSL not supported&quot;</span>);
<a name="l00884"></a>00884         mModified = <span class="keyword">true</span>;
<a name="l00885"></a>00885         Py_RETURN_NONE;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887     <span class="keywordflow">else</span> {
<a name="l00888"></a>00888         <span class="comment">// returns Py_None on error</span>
<a name="l00889"></a>00889         <span class="comment">// the calling script will need to check</span>
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         <span class="keywordflow">if</span> (!mShader &amp;&amp; !mModified) {
<a name="l00892"></a>00892             mShader = <span class="keyword">new</span> <a class="code" href="../../dd/da0/classBL__Shader.html">BL_Shader</a>();
<a name="l00893"></a>00893             mModified = <span class="keyword">true</span>;
<a name="l00894"></a>00894         }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         <span class="keywordflow">if</span> (mShader &amp;&amp; !mShader-&gt;GetError()) {
<a name="l00897"></a>00897             m_flag &amp;= ~<a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fadab579ec79c6a9b673048d6303b85a88">RAS_BLENDERGLSL</a>;
<a name="l00898"></a>00898             mMaterial-&gt;SetSharedMaterial(<span class="keyword">true</span>);
<a name="l00899"></a>00899             mScene-&gt;GetBucketManager()-&gt;ReleaseDisplayLists(<span class="keyword">this</span>);
<a name="l00900"></a>00900             <span class="keywordflow">return</span> mShader-&gt;GetProxy();
<a name="l00901"></a>00901         }<span class="keywordflow">else</span>
<a name="l00902"></a>00902         {
<a name="l00903"></a>00903             <span class="comment">// decref all references to the object</span>
<a name="l00904"></a>00904             <span class="comment">// then delete it!</span>
<a name="l00905"></a>00905             <span class="comment">// We will then go back to fixed functionality</span>
<a name="l00906"></a>00906             <span class="comment">// for this material</span>
<a name="l00907"></a>00907             <span class="keywordflow">if</span> (mShader) {
<a name="l00908"></a>00908                 <span class="keyword">delete</span> mShader; <span class="comment">/* will handle python de-referencing */</span>
<a name="l00909"></a>00909                 mShader=0;
<a name="l00910"></a>00910             }
<a name="l00911"></a>00911         }
<a name="l00912"></a>00912         Py_RETURN_NONE;
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914     PyErr_SetString(PyExc_ValueError, <span class="stringliteral">&quot;material.getShader(): KX_BlenderMaterial, GLSL Error&quot;</span>);
<a name="l00915"></a>00915     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 KX_PYMETHODDEF_DOC( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, getMaterialIndex, <span class="stringliteral">&quot;getMaterialIndex()&quot;</span>)
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920     <span class="keywordflow">return</span> PyLong_FromSsize_t( GetMaterialIndex() );
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 KX_PYMETHODDEF_DOC( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, getTexture, <span class="stringliteral">&quot;getTexture( index )&quot;</span> )
<a name="l00924"></a>00924 {
<a name="l00925"></a>00925     <span class="comment">// TODO: enable python switching</span>
<a name="l00926"></a>00926     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 KX_PYMETHODDEF_DOC( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, setTexture , <span class="stringliteral">&quot;setTexture( index, tex)&quot;</span>)
<a name="l00930"></a>00930 {
<a name="l00931"></a>00931     <span class="comment">// TODO: enable python switching</span>
<a name="l00932"></a>00932     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> GL_array[11] = {
<a name="l00936"></a>00936     GL_ZERO,
<a name="l00937"></a>00937     GL_ONE,
<a name="l00938"></a>00938     GL_SRC_COLOR,
<a name="l00939"></a>00939     GL_ONE_MINUS_SRC_COLOR,
<a name="l00940"></a>00940     GL_DST_COLOR,
<a name="l00941"></a>00941     GL_ONE_MINUS_DST_COLOR,
<a name="l00942"></a>00942     GL_SRC_ALPHA,
<a name="l00943"></a>00943     GL_ONE_MINUS_SRC_ALPHA,
<a name="l00944"></a>00944     GL_DST_ALPHA,
<a name="l00945"></a>00945     GL_ONE_MINUS_DST_ALPHA,
<a name="l00946"></a>00946     GL_SRC_ALPHA_SATURATE
<a name="l00947"></a>00947 };
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 KX_PYMETHODDEF_DOC( <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>, setBlending , <span class="stringliteral">&quot;setBlending( bge.logic.src, bge.logic.dest)&quot;</span>)
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> b[2];
<a name="l00952"></a>00952     <span class="keywordflow">if</span> (PyArg_ParseTuple(args, <span class="stringliteral">&quot;ii:setBlending&quot;</span>, &amp;b[0], &amp;b[1]))
<a name="l00953"></a>00953     {
<a name="l00954"></a>00954         <span class="keywordtype">bool</span> value_found[2] = {<span class="keyword">false</span>, <span class="keyword">false</span>};
<a name="l00955"></a>00955         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;11; i++)
<a name="l00956"></a>00956         {
<a name="l00957"></a>00957             <span class="keywordflow">if</span> (b[0] == GL_array[i]) {
<a name="l00958"></a>00958                 value_found[0] = <span class="keyword">true</span>;
<a name="l00959"></a>00959                 mBlendFunc[0] = b[0];
<a name="l00960"></a>00960             }
<a name="l00961"></a>00961             <span class="keywordflow">if</span> (b[1] == GL_array[i]) {
<a name="l00962"></a>00962                 value_found[1] = <span class="keyword">true</span>;
<a name="l00963"></a>00963                 mBlendFunc[1] = b[1];
<a name="l00964"></a>00964             }
<a name="l00965"></a>00965             <span class="keywordflow">if</span> (value_found[0] &amp;&amp; value_found[1]) <span class="keywordflow">break</span>;
<a name="l00966"></a>00966         }
<a name="l00967"></a>00967         <span class="keywordflow">if</span> (!value_found[0] || !value_found[1]) {
<a name="l00968"></a>00968             PyErr_SetString(PyExc_ValueError, <span class="stringliteral">&quot;material.setBlending(int, int): KX_BlenderMaterial, invalid enum.&quot;</span>);
<a name="l00969"></a>00969             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971         mUserDefBlend = <span class="keyword">true</span>;
<a name="l00972"></a>00972         Py_RETURN_NONE;
<a name="l00973"></a>00973     }
<a name="l00974"></a>00974     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977 <span class="preprocessor">#endif // WITH_PYTHON</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:27 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

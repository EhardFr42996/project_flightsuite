<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: node_draw.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">node_draw.c</div>  </div>
</div>
<div class="contents">
<a href="../../d9/d9b/node__draw_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Nathan Letwory</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dbb/BLI__threads_8h.html">BLI_threads.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d61/BLF__translation_8h.html">BLF_translation.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d71/BIF__glutil_8h.html">BIF_glutil.h</a>&quot;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dcc/ED__node_8h.html">ED_node.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dea/ED__gpencil_8h.html">ED_gpencil.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/de1/UI__interface__icons_8h.html">UI_interface_icons.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d05/NOD__composite_8h.html">NOD_composite.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d3a/NOD__shader_8h.html">NOD_shader.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d6e/node__util_8h.html">intern/node_util.h</a>&quot;</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8c/node__intern_8h.html">node_intern.h</a>&quot;</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">/* width of socket columns in group display */</span>
<a name="l00083"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#ad145c6868d190254b25eaf77f732aeae">00083</a> <span class="preprocessor">#define NODE_GROUP_FRAME        120</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 <span class="comment">// XXX interface.h</span>
<a name="l00086"></a>00086 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d86/interface__draw_8c.html#a468f37a013a4eb9c4b7d15638b66eeca">ui_dropshadow</a>(<a class="code" href="../../da/d10/structrctf.html">rctf</a> *rct, <span class="keywordtype">float</span> radius, <span class="keywordtype">float</span> aspect, <span class="keywordtype">int</span> select);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* XXX update functions for node editor are a mess, needs a clear concept */</span>
<a name="l00089"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#ac9a2f13ac11a78bb7b4d071323e6bc0c">00089</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#a5bf38cf7fcad9b80dfc1ac7ba6c45b50">ED_node_tree_update</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <a class="code" href="../../d1/d13/node__edit_8c.html#af3752ed9cce41665ca8279adeee8be39">snode_set_context</a>(snode, scene);
<a name="l00092"></a>00092     
<a name="l00093"></a>00093     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a> &amp;&amp; snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==0)
<a name="l00094"></a>00094         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 1;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#abb5ea7a016e9d6c86131f3d9d340cadd">00097</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#a95b3e3668704677f2f588426b9506419">ED_node_changed_update</a>(<a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../de/d2a/structCompBuf.html#a038134dade39d344849849ecfc879421">node</a>)
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *nodetree, *edittree;
<a name="l00100"></a>00100     <span class="keywordtype">int</span> treetype;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <a class="code" href="../../d1/d13/node__edit_8c.html#ab0f5a4ac5037d67e861a9b0d58e70d3e">node_tree_from_ID</a>(<span class="keywordtype">id</span>, &amp;nodetree, &amp;edittree, &amp;treetype);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (treetype==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>) {
<a name="l00105"></a>00105         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(<span class="keywordtype">id</span>, 0);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>)
<a name="l00108"></a>00108             <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a835f426982dfbc3be8305095253ad793">NC_MATERIAL</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aec47e351fe15423a3f06855b21e11548">ND_SHADING_DRAW</a>, <span class="keywordtype">id</span>);
<a name="l00109"></a>00109         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>)
<a name="l00110"></a>00110             <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a836d92a753bc7d1f05c0c59c18f153da">NC_LAMP</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a2afe5f5099f0957c5e7f47b2b8210cee">ND_LIGHTING_DRAW</a>, <span class="keywordtype">id</span>);
<a name="l00111"></a>00111         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>)
<a name="l00112"></a>00112             <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a03dbfa96e493f56aac353e5550380e8b">NC_WORLD</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#abd3a61b75254bbf02378c26c340c1063">ND_WORLD_DRAW</a>, <span class="keywordtype">id</span>);
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (treetype==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l00115"></a>00115         <span class="keywordflow">if</span> (node)
<a name="l00116"></a>00116             <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(edittree, node);
<a name="l00117"></a>00117         <span class="comment">/* don&#39;t use NodeTagIDChanged, it gives far too many recomposites for image, scene layers, ... */</span>
<a name="l00118"></a>00118             
<a name="l00119"></a>00119         node= <a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(nodetree);
<a name="l00120"></a>00120         <span class="keywordflow">if</span> (node)
<a name="l00121"></a>00121             <a class="code" href="../../d4/d91/BKE__node_8h.html#a7f3de8e85e038cac2d3843fd77a8f05e">nodeUpdateID</a>(nodetree, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, <span class="keywordtype">id</span>);
<a name="l00124"></a>00124     }           
<a name="l00125"></a>00125     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (treetype==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>) {
<a name="l00126"></a>00126         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(<span class="keywordtype">id</span>, 0);
<a name="l00127"></a>00127         <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#aa5d5ad0b941376d3be89c261f876f4fa">NC_TEXTURE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, <span class="keywordtype">id</span>);
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#aea6f5ac5649668a5175043c05e47ad56">00131</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *lookup)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../de/d2a/structCompBuf.html#a038134dade39d344849849ecfc879421">node</a>;
<a name="l00134"></a>00134     
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (ntree == lookup)
<a name="l00136"></a>00136         <span class="keywordflow">return</span> 1;
<a name="l00137"></a>00137     
<a name="l00138"></a>00138     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l00140"></a>00140             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9b/node__draw_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>, lookup))
<a name="l00141"></a>00141                 <span class="keywordflow">return</span> 1;
<a name="l00142"></a>00142     
<a name="l00143"></a>00143     <span class="keywordflow">return</span> 0;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html">00146</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html">NodeUpdateCalldata</a> {
<a name="l00147"></a><a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#addae60a8fb4eb6861b626651dd283593">00147</a>     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#addae60a8fb4eb6861b626651dd283593">ntree</a>;
<a name="l00148"></a><a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#a3a5eee4c1d8a3635144c13ae6b4c44c7">00148</a>     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#a3a5eee4c1d8a3635144c13ae6b4c44c7">node</a>;
<a name="l00149"></a>00149 } <a class="code" href="../../d9/d9b/node__draw_8c.html#aff9c736e3601ebdce18086b4c66103e7">NodeUpdateCalldata</a>;
<a name="l00150"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a2fc7d3cfe2830cc3522a67fa8d75e80c">00150</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a2fc7d3cfe2830cc3522a67fa8d75e80c">node_generic_update_cb</a>(<span class="keywordtype">void</span> *calldata, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152     <a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html">NodeUpdateCalldata</a> *cd= (<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html">NodeUpdateCalldata</a>*)calldata;
<a name="l00153"></a>00153     <span class="comment">/* check if nodetree uses the group stored in calldata */</span>
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9b/node__draw_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>(ntree, cd-&gt;<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#addae60a8fb4eb6861b626651dd283593">ntree</a>))
<a name="l00155"></a>00155         <a class="code" href="../../da/dcc/ED__node_8h.html#a95b3e3668704677f2f588426b9506419">ED_node_changed_update</a>(owner_id, cd-&gt;<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#a3a5eee4c1d8a3635144c13ae6b4c44c7">node</a>);
<a name="l00156"></a>00156 }
<a name="l00157"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a62318e1593e224d9a81484623b51d058">00157</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#a5d76bd5684ce41263f3d1af3f46cdcbc">ED_node_generic_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159     <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> *tti= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2cfb33fceb1c0690b846e95db2cd7795">ntreeGetType</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>);
<a name="l00160"></a>00160     <a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html">NodeUpdateCalldata</a> cd;
<a name="l00161"></a>00161     cd.<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#addae60a8fb4eb6861b626651dd283593">ntree</a> = ntree;
<a name="l00162"></a>00162     cd.<a class="code" href="../../d3/dd9/structNodeUpdateCalldata.html#a3a5eee4c1d8a3635144c13ae6b4c44c7">node</a> = node;
<a name="l00163"></a>00163     <span class="comment">/* look through all datablocks, to support groups */</span>
<a name="l00164"></a>00164     tti-&gt;<a class="code" href="../../d7/d11/structbNodeTreeType.html#a87a553e9993a76fffae6022ed8be10db">foreach_nodetree</a>(bmain, &amp;cd, <a class="code" href="../../d9/d9b/node__draw_8c.html#a2fc7d3cfe2830cc3522a67fa8d75e80c">node_generic_update_cb</a>);
<a name="l00165"></a>00165     
<a name="l00166"></a>00166     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a> == <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>)
<a name="l00167"></a>00167         <a class="code" href="../../d4/d91/BKE__node_8h.html#a91c7768254c9fa6fa54830eba4fa9bb4">ntreeTexCheckCyclics</a>(ntree);
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a3c28226b32f7e5b6213277d79d45384d">00170</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a3c28226b32f7e5b6213277d79d45384d">do_node_internal_buttons</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">void</span> *node_v, <span class="keywordtype">int</span> event)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (event==<a class="code" href="../../d8/d8c/node__intern_8h.html#afeaa6456e370d2eb59f5e139d9f8b00cac408760de760b01da1d40a3bbffdec4a">B_NODE_EXEC</a>) {
<a name="l00173"></a>00173         <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (snode &amp;&amp; snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>)
<a name="l00175"></a>00175             <a class="code" href="../../da/dcc/ED__node_8h.html#a95b3e3668704677f2f588426b9506419">ED_node_changed_update</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>, node_v);
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a787a93d93a860c66d9134a5480224bb4">00180</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a787a93d93a860c66d9134a5480224bb4">node_scaling_widget</a>(<span class="keywordtype">int</span> color_id, <span class="keywordtype">float</span> aspect, <span class="keywordtype">float</span> xmin, <span class="keywordtype">float</span> ymin, <span class="keywordtype">float</span> xmax, <span class="keywordtype">float</span> ymax)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182     <span class="keywordtype">float</span> dx;
<a name="l00183"></a>00183     <span class="keywordtype">float</span> dy;
<a name="l00184"></a>00184     
<a name="l00185"></a>00185     dx= 0.5f*(xmax-xmin);
<a name="l00186"></a>00186     dy= 0.5f*(ymax-ymin);
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(color_id, +30);  
<a name="l00189"></a>00189     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(xmin, ymin, xmax, ymax);
<a name="l00190"></a>00190     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(xmin+dx, ymin, xmax, ymax-dy);
<a name="l00191"></a>00191     
<a name="l00192"></a>00192     <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(color_id, -10);
<a name="l00193"></a>00193     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(xmin, ymin+aspect, xmax, ymax+aspect);
<a name="l00194"></a>00194     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(xmin+dx, ymin+aspect, xmax, ymax-dy+aspect);
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#aac4e6934f7284ec84ab9ecabc844c55c">00197</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#aac4e6934f7284ec84ab9ecabc844c55c">node_uiblocks_init</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00200"></a>00200     <span class="keywordtype">char</span> uiblockstr[32];
<a name="l00201"></a>00201     
<a name="l00202"></a>00202     <span class="comment">/* add node uiBlocks in drawing order - prevents events going to overlapping nodes */</span>
<a name="l00203"></a>00203     
<a name="l00204"></a>00204     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00205"></a>00205         <span class="comment">/* ui block */</span>
<a name="l00206"></a>00206         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(uiblockstr, <span class="keyword">sizeof</span>(uiblockstr), <span class="stringliteral">&quot;node buttons %p&quot;</span>, (<span class="keywordtype">void</span> *)node);
<a name="l00207"></a>00207         node-&gt;block= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8bb41a5814e5120ba3c694cb35667128">uiBeginBlock</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C), uiblockstr, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l00208"></a>00208         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a678b88dc2247856d2d804986daf134cb">uiBlockSetHandleFunc</a>(node-&gt;block, <a class="code" href="../../d9/d9b/node__draw_8c.html#a3c28226b32f7e5b6213277d79d45384d">do_node_internal_buttons</a>, node);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <span class="comment">/* this cancels events for background nodes */</span>
<a name="l00211"></a>00211         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a619156a060c8092bf92b629660cbcc8e">uiBlockSetFlag</a>(node-&gt;block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#aac45ce4b5924bfa448f32a1b2f57be28">UI_BLOCK_CLIP_EVENTS</a>);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">/* based on settings in node, sets drawing rect info. each redraw! */</span>
<a name="l00216"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a86ae862607e9dced1f42b46ca35b7e5e">00216</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a86ae862607e9dced1f42b46ca35b7e5e">node_update_basis</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l00219"></a>00219     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00220"></a>00220     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *nsock;
<a name="l00221"></a>00221     <span class="keywordtype">float</span> locx, locy;
<a name="l00222"></a>00222     <span class="keywordtype">float</span> dy;
<a name="l00223"></a>00223     <span class="keywordtype">int</span> buty;
<a name="l00224"></a>00224     
<a name="l00225"></a>00225     <span class="comment">/* get &quot;global&quot; coords */</span>
<a name="l00226"></a>00226     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c9277adafb36f9bcca7b8f6e27dcb78">nodeSpaceCoords</a>(node, &amp;locx, &amp;locy);
<a name="l00227"></a>00227     dy= locy;
<a name="l00228"></a>00228     
<a name="l00229"></a>00229     <span class="comment">/* header */</span>
<a name="l00230"></a>00230     dy-= <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>;
<a name="l00231"></a>00231     
<a name="l00232"></a>00232     <span class="comment">/* little bit space in top */</span>
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l00234"></a>00234         dy-= <a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>/2;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">/* output sockets */</span>
<a name="l00237"></a>00237     <span class="keywordflow">for</span> (nsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nsock; nsock= nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(nsock)) {
<a name="l00239"></a>00239             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>= locx + node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>;
<a name="l00240"></a>00240             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>= dy - <a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>;
<a name="l00241"></a>00241             dy-= <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>;
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = locx + <a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>;
<a name="l00246"></a>00246     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = locx + node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>- <a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="comment">/* preview rect? */</span>
<a name="l00249"></a>00249     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>) {
<a name="l00250"></a>00250         <span class="comment">/* only recalculate size when there&#39;s a preview actually, otherwise we use stored result */</span>
<a name="l00251"></a>00251         <a class="code" href="../../df/dbb/BLI__threads_8h.html#aeb7fa826429971a6eb6074249ad39a0b">BLI_lock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a1d3b78586c37d966af13099593887610">LOCK_PREVIEW</a>);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>) {
<a name="l00254"></a>00254             <span class="keywordtype">float</span> aspect= 1.0f;
<a name="l00255"></a>00255             
<a name="l00256"></a>00256             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a608ade12fcd89ca6217376f8c65718ba">ysize</a>) 
<a name="l00257"></a>00257                 aspect= (float)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a608ade12fcd89ca6217376f8c65718ba">ysize</a>/(<span class="keywordtype">float</span>)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a>;
<a name="l00258"></a>00258             
<a name="l00259"></a>00259             dy-= NODE_DYS/2;
<a name="l00260"></a>00260             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = dy;
<a name="l00261"></a>00261             
<a name="l00262"></a>00262             <span class="keywordflow">if</span> (aspect &lt;= 1.0f)
<a name="l00263"></a>00263                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = dy - aspect*(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>);
<a name="l00264"></a>00264             <span class="keywordflow">else</span> {
<a name="l00265"></a>00265                 <span class="keywordtype">float</span> dx= (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a> - <a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>) - (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>- NODE_DYS)/aspect;    <span class="comment">/* width correction of image */</span>
<a name="l00266"></a>00266                 
<a name="l00267"></a>00267                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = dy - (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>);
<a name="l00268"></a>00268                 
<a name="l00269"></a>00269                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+= 0.5f*dx;
<a name="l00270"></a>00270                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-= 0.5f*dx;
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273             dy= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> - NODE_DYS/2;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275             <span class="comment">/* make sure that maximums are bigger or equal to minimums */</span>
<a name="l00276"></a>00276             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> &lt; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">float</span>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00277"></a>00277             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> &lt; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>) <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">float</span>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279         <span class="keywordflow">else</span> {
<a name="l00280"></a>00280             <span class="keywordtype">float</span> oldh= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l00281"></a>00281             <span class="keywordflow">if</span> (oldh==0.0f)
<a name="l00282"></a>00282                 oldh= 0.6f*node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>;
<a name="l00283"></a>00283             dy-= NODE_DYS/2;
<a name="l00284"></a>00284             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = dy;
<a name="l00285"></a>00285             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = dy - oldh;
<a name="l00286"></a>00286             dy= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> - NODE_DYS/2;
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <a class="code" href="../../df/dbb/BLI__threads_8h.html#add77b383686cdf9514286b56e3c7939c">BLI_unlock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a1d3b78586c37d966af13099593887610">LOCK_PREVIEW</a>);
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">/* buttons rect? */</span>
<a name="l00293"></a>00293     <span class="keywordflow">if</span> ((node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a>) &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac32ff8ac488298d4e85ec3d03537e7e4" title="Draw the option buttons on the node.">uifunc</a>) {
<a name="l00294"></a>00294         dy-= NODE_DYS/2;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296         <span class="comment">/* set this for uifunc() that don&#39;t use layout engine yet */</span>
<a name="l00297"></a>00297         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a200bc812ec884164013dbd8f2a37d840">butr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = 0;
<a name="l00298"></a>00298         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a200bc812ec884164013dbd8f2a37d840">butr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a> - 2*<a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>;
<a name="l00299"></a>00299         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a200bc812ec884164013dbd8f2a37d840">butr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = 0;
<a name="l00300"></a>00300         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a200bc812ec884164013dbd8f2a37d840">butr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0;
<a name="l00301"></a>00301         
<a name="l00302"></a>00302         <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a0b393a65055e74d24d805993ba618d79">RNA_Node</a>, node, &amp;ptr);
<a name="l00303"></a>00303         
<a name="l00304"></a>00304         layout= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1bb4b00a42cf4a43ed16c8b81ecc5916">uiBlockLayout</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a429a9756ef7e1d855f402d4812d9f734">UI_LAYOUT_VERTICAL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab4e9f04bf2cbd97598f540aa2aac805f">UI_LAYOUT_PANEL</a>,
<a name="l00305"></a>00305                               locx+NODE_DYS, dy, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a200bc812ec884164013dbd8f2a37d840">butr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a16828a47eb4af34d08dce0ead86693b3">UI_GetStyle</a>());
<a name="l00306"></a>00306         
<a name="l00307"></a>00307         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac32ff8ac488298d4e85ec3d03537e7e4" title="Draw the option buttons on the node.">uifunc</a>(layout, (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *)C, &amp;ptr);
<a name="l00308"></a>00308         
<a name="l00309"></a>00309         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a760b83d713e0915ddaf3d307910e1c37">uiBlockEndAlign</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>);
<a name="l00310"></a>00310         <a class="code" href="../../d8/d1e/UI__interface_8h.html#af5a459ec6f6c7ec026184b9f063f4bd3">uiBlockLayoutResolve</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;buty);
<a name="l00311"></a>00311         
<a name="l00312"></a>00312         dy= buty - NODE_DYS/2;
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="comment">/* input sockets */</span>
<a name="l00316"></a>00316     <span class="keywordflow">for</span> (nsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nsock; nsock= nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(nsock)) {
<a name="l00318"></a>00318             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>= locx;
<a name="l00319"></a>00319             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>= dy - <a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>;
<a name="l00320"></a>00320             dy-= <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>;
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     
<a name="l00324"></a>00324     <span class="comment">/* little bit space in end */</span>
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> || (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; (<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a>|<a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>))==0 )
<a name="l00326"></a>00326         dy-= NODE_DYS/2;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = locx;
<a name="l00329"></a>00329     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = locx + node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>;
<a name="l00330"></a>00330     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = locy;
<a name="l00331"></a>00331     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(dy, locy-2*<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>);
<a name="l00332"></a>00332     
<a name="l00333"></a>00333     <span class="comment">/* Set the block bounds to clip mouse events from underlying nodes.</span>
<a name="l00334"></a>00334 <span class="comment">     * Add a margin for sockets on each side.</span>
<a name="l00335"></a>00335 <span class="comment">     */</span>
<a name="l00336"></a>00336     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4040bc57b96247d2f1d76640ef23d93e">uiExplicitBoundsBlock</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>,
<a name="l00337"></a>00337                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> - <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>,
<a name="l00338"></a>00338                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>,
<a name="l00339"></a>00339                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> + <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>,
<a name="l00340"></a>00340                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="comment">/* based on settings in node, sets drawing rect info. each redraw! */</span>
<a name="l00344"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#ade78a759b48b10a83169c3ab71b0ab1d">00344</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#ade78a759b48b10a83169c3ab71b0ab1d">node_update_hidden</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *nsock;
<a name="l00347"></a>00347     <span class="keywordtype">float</span> locx, locy;
<a name="l00348"></a>00348     <span class="keywordtype">float</span> rad, drad, hiddenrad= <a class="code" href="../../d8/d8c/node__intern_8h.html#ac06dfdcbc58caf385e1aa05016e7b8fc">HIDDEN_RAD</a>;
<a name="l00349"></a>00349     <span class="keywordtype">int</span> totin=0, totout=0, tot;
<a name="l00350"></a>00350     
<a name="l00351"></a>00351     <span class="comment">/* get &quot;global&quot; coords */</span>
<a name="l00352"></a>00352     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c9277adafb36f9bcca7b8f6e27dcb78">nodeSpaceCoords</a>(node, &amp;locx, &amp;locy);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="comment">/* calculate minimal radius */</span>
<a name="l00355"></a>00355     <span class="keywordflow">for</span> (nsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nsock; nsock= nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(nsock))
<a name="l00357"></a>00357             totin++;
<a name="l00358"></a>00358     <span class="keywordflow">for</span> (nsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nsock; nsock= nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00359"></a>00359         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(nsock))
<a name="l00360"></a>00360             totout++;
<a name="l00361"></a>00361     
<a name="l00362"></a>00362     tot= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(totin, totout);
<a name="l00363"></a>00363     <span class="keywordflow">if</span> (tot&gt;4) {
<a name="l00364"></a>00364         hiddenrad += 5.0f*(float)(tot-4);
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     
<a name="l00367"></a>00367     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = locx;
<a name="l00368"></a>00368     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = locx + 3*hiddenrad + node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a45344c987d49653cfdedebb4c403a3f2">miniwidth</a>;
<a name="l00369"></a>00369     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = locy + (hiddenrad - 0.5f*<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>);
<a name="l00370"></a>00370     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - 2*hiddenrad;
<a name="l00371"></a>00371     
<a name="l00372"></a>00372     <span class="comment">/* output sockets */</span>
<a name="l00373"></a>00373     rad=drad= (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/(1.0f + (<span class="keywordtype">float</span>)totout);
<a name="l00374"></a>00374     
<a name="l00375"></a>00375     <span class="keywordflow">for</span> (nsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nsock; nsock= nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00376"></a>00376         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(nsock)) {
<a name="l00377"></a>00377             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - hiddenrad + (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(rad)*hiddenrad;
<a name="l00378"></a>00378             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> + hiddenrad + (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(rad)*hiddenrad;
<a name="l00379"></a>00379             rad+= drad;
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382     
<a name="l00383"></a>00383     <span class="comment">/* input sockets */</span>
<a name="l00384"></a>00384     rad=drad= - (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/(1.0f + (<span class="keywordtype">float</span>)totin);
<a name="l00385"></a>00385     
<a name="l00386"></a>00386     <span class="keywordflow">for</span> (nsock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nsock; nsock= nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00387"></a>00387         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(nsock)) {
<a name="l00388"></a>00388             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> + hiddenrad + (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(rad)*hiddenrad;
<a name="l00389"></a>00389             nsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> + hiddenrad + (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(rad)*hiddenrad;
<a name="l00390"></a>00390             rad+= drad;
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <span class="comment">/* Set the block bounds to clip mouse events from underlying nodes.</span>
<a name="l00395"></a>00395 <span class="comment">     * Add a margin for sockets on each side.</span>
<a name="l00396"></a>00396 <span class="comment">     */</span>
<a name="l00397"></a>00397     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4040bc57b96247d2f1d76640ef23d93e">uiExplicitBoundsBlock</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>,
<a name="l00398"></a>00398                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> - <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>,
<a name="l00399"></a>00399                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>,
<a name="l00400"></a>00400                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> + <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>,
<a name="l00401"></a>00401                           node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#afa8cdd4f17256aa5c030527ac55cc35a">00404</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#afa8cdd4f17256aa5c030527ac55cc35a">node_update_default</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a9514398b17ede671295e5c873e7bb3df">NODE_HIDDEN</a>)
<a name="l00407"></a>00407         <a class="code" href="../../d9/d9b/node__draw_8c.html#ade78a759b48b10a83169c3ab71b0ab1d">node_update_hidden</a>(node);
<a name="l00408"></a>00408     <span class="keywordflow">else</span>
<a name="l00409"></a>00409         <a class="code" href="../../d9/d9b/node__draw_8c.html#a86ae862607e9dced1f42b46ca35b7e5e">node_update_basis</a>(C, ntree, node);
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a19ed0df20e1810d576f93e37e8f7431a">00412</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a19ed0df20e1810d576f93e37e8f7431a">node_get_colorid</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#acb9996cce432338c7608f8db542921a7">NODE_CLASS_INPUT</a>)
<a name="l00415"></a>00415         <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af0d693e972792876e17ce738179b8914">TH_NODE_IN_OUT</a>;
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a0c1dfc239a1caee873fa06628a828b02">NODE_CLASS_OUTPUT</a>) {
<a name="l00417"></a>00417         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>)
<a name="l00418"></a>00418             <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af0d693e972792876e17ce738179b8914">TH_NODE_IN_OUT</a>;
<a name="l00419"></a>00419         <span class="keywordflow">else</span>
<a name="l00420"></a>00420             <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a0e4624f23d3e772f8136062cd2cfeb68">TH_NODE</a>;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a68aa0af715862ad4bc845e929f7be84c">NODE_CLASS_CONVERTOR</a>)
<a name="l00423"></a>00423         <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af94271d21a97e91554045c5175001712">TH_NODE_CONVERTOR</a>;
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ac761b7934434e1c3ec14b775245222a7">NODE_CLASS_OP_COLOR</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aac6207c8ff1a01a4ced776f3a98e8ebe">NODE_CLASS_OP_VECTOR</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad0e69ae167f6bf3a2d3488a66b2aafd3">NODE_CLASS_OP_FILTER</a>))
<a name="l00425"></a>00425         <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a58c5d61b67c86afffcf4ef45acd726ea">TH_NODE_OPERATOR</a>;
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad761c7dc010f3b8f1079dda3c90d6899">NODE_CLASS_GROUP</a>)
<a name="l00427"></a>00427         <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a1bdcb9721f16c958193a775c819759bf">TH_NODE_GROUP</a>;
<a name="l00428"></a>00428     <span class="keywordflow">return</span> <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a0e4624f23d3e772f8136062cd2cfeb68">TH_NODE</a>;
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="comment">/* note: in cmp_util.c is similar code, for node_compo_pass_on()</span>
<a name="l00432"></a>00432 <span class="comment"> *       the same goes for shader and texture nodes. */</span>
<a name="l00433"></a>00433 <span class="comment">/* note: in node_edit.c is similar code, for untangle node */</span>
<a name="l00434"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a74ae6839b21ccd71e791ca1415168eb3">00434</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a74ae6839b21ccd71e791ca1415168eb3">node_draw_mute_line</a>(<a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> links;
<a name="l00437"></a>00437     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00440"></a>00440         <span class="keywordflow">return</span>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="comment">/* Get default muting links. */</span>
<a name="l00443"></a>00443     links = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, node);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     glEnable(GL_BLEND);
<a name="l00446"></a>00446     glEnable(GL_LINE_SMOOTH);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordflow">for</span> (link = links.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l00449"></a>00449         <a class="code" href="../../d5/d1d/drawnode_8c.html#ab3fe7e8e6aa1757fbd74b5395f6cab9d">node_draw_link_bezier</a>(v2d, snode, link, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a65e3169909737674a0536441605a5754">TH_REDALERT</a>, 0, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, 0, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     glDisable(GL_BLEND);
<a name="l00452"></a>00452     glDisable(GL_LINE_SMOOTH);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;links);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="comment">/* this might have some more generic use */</span>
<a name="l00458"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a02c94a16899954401a224e0f6a7753a2">00458</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a02c94a16899954401a224e0f6a7753a2">node_circle_draw</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>, <span class="keywordtype">char</span> *col, <span class="keywordtype">int</span> highlight)
<a name="l00459"></a>00459 {
<a name="l00460"></a>00460     <span class="comment">/* 16 values of sin function */</span>
<a name="l00461"></a>00461     <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>[16] = {
<a name="l00462"></a>00462         0.00000000f, 0.39435585f,0.72479278f,0.93775213f,
<a name="l00463"></a>00463         0.99871650f,0.89780453f,0.65137248f,0.29936312f,
<a name="l00464"></a>00464         -0.10116832f,-0.48530196f,-0.79077573f,-0.96807711f,
<a name="l00465"></a>00465         -0.98846832f,-0.84864425f,-0.57126821f,-0.20129852f
<a name="l00466"></a>00466     };
<a name="l00467"></a>00467     <span class="comment">/* 16 values of cos function */</span>
<a name="l00468"></a>00468     <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[16] ={
<a name="l00469"></a>00469         1.00000000f,0.91895781f,0.68896691f,0.34730525f,
<a name="l00470"></a>00470         -0.05064916f,-0.44039415f,-0.75875812f,-0.95413925f,
<a name="l00471"></a>00471         -0.99486932f,-0.87434661f,-0.61210598f,-0.25065253f,
<a name="l00472"></a>00472         0.15142777f,0.52896401f,0.82076344f,0.97952994f,
<a name="l00473"></a>00473     };
<a name="l00474"></a>00474     <span class="keywordtype">int</span> a;
<a name="l00475"></a>00475     
<a name="l00476"></a>00476     glColor3ub(col[0], col[1], col[2]);
<a name="l00477"></a>00477     
<a name="l00478"></a>00478     glBegin(GL_POLYGON);
<a name="l00479"></a>00479     <span class="keywordflow">for</span> (a=0; a&lt;16; a++)
<a name="l00480"></a>00480         glVertex2f(x+size*si[a], y+size*co[a]);
<a name="l00481"></a>00481     glEnd();
<a name="l00482"></a>00482     
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (highlight) {
<a name="l00484"></a>00484         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>);
<a name="l00485"></a>00485         glLineWidth(1.5f);
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487     <span class="keywordflow">else</span> {
<a name="l00488"></a>00488         glColor4ub(0, 0, 0, 150);
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490     glEnable(GL_BLEND);
<a name="l00491"></a>00491     glEnable( GL_LINE_SMOOTH );
<a name="l00492"></a>00492     glBegin(GL_LINE_LOOP);
<a name="l00493"></a>00493     <span class="keywordflow">for</span> (a=0; a&lt;16; a++)
<a name="l00494"></a>00494         glVertex2f(x+size*si[a], y+size*co[a]);
<a name="l00495"></a>00495     glEnd();
<a name="l00496"></a>00496     glDisable( GL_LINE_SMOOTH );
<a name="l00497"></a>00497     glDisable(GL_BLEND);
<a name="l00498"></a>00498     glLineWidth(1.0f);
<a name="l00499"></a>00499 }
<a name="l00500"></a>00500 
<a name="l00501"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a8bca2216d390fd561066ad80a8ddf4f5">00501</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a8bca2216d390fd561066ad80a8ddf4f5">node_socket_circle_draw</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ntree), <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00502"></a>00502 {
<a name="l00503"></a>00503     <a class="code" href="../../dd/dfb/structbNodeSocketType.html">bNodeSocketType</a> *stype = <a class="code" href="../../d4/d91/BKE__node_8h.html#a569537bca3d5248cfc2322a915803d89">ntreeGetSocketType</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00504"></a>00504     <a class="code" href="../../d9/d9b/node__draw_8c.html#a02c94a16899954401a224e0f6a7753a2">node_circle_draw</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>, size, stype-&gt;<a class="code" href="../../dd/dfb/structbNodeSocketType.html#a4fd4f49758fd4628f0740f493922588b">ui_color</a>, (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>));
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="comment">/* **************  Socket callbacks *********** */</span>
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="comment">/* not a callback */</span>
<a name="l00510"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a575a5346a7833f25b11903997f5846b2">00510</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a575a5346a7833f25b11903997f5846b2">node_draw_preview</a>(<a class="code" href="../../de/d14/structbNodePreview.html">bNodePreview</a> *preview, <a class="code" href="../../da/d10/structrctf.html">rctf</a> *prv)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512     <span class="keywordtype">float</span> xscale= (prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>)/((<span class="keywordtype">float</span>)preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a>);
<a name="l00513"></a>00513     <span class="keywordtype">float</span> yscale= (prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-prv-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>)/((<span class="keywordtype">float</span>)preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a608ade12fcd89ca6217376f8c65718ba">ysize</a>);
<a name="l00514"></a>00514     <span class="keywordtype">float</span> tile= (prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>) / 10.0f;
<a name="l00515"></a>00515     <span class="keywordtype">float</span> x, y;
<a name="l00516"></a>00516     
<a name="l00517"></a>00517     <span class="comment">/* draw checkerboard backdrop to show alpha */</span>
<a name="l00518"></a>00518     glColor3ub(120, 120, 120);
<a name="l00519"></a>00519     glRectf(prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00520"></a>00520     glColor3ub(160, 160, 160);
<a name="l00521"></a>00521     
<a name="l00522"></a>00522     <span class="keywordflow">for</span> (y=prv-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>; y&lt;prv-&gt;ymax; y+=tile*2) {
<a name="l00523"></a>00523         <span class="keywordflow">for</span> (x=prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>; x&lt;prv-&gt;xmax; x+=tile*2) {
<a name="l00524"></a>00524             <span class="keywordtype">float</span> tilex= tile, tiley= tile;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526             <span class="keywordflow">if</span> (x+tile &gt; prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>)
<a name="l00527"></a>00527                 tilex= prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-x;
<a name="l00528"></a>00528             <span class="keywordflow">if</span> (y+tile &gt; prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>)
<a name="l00529"></a>00529                 tiley= prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-y;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531             glRectf(x, y, x + tilex, y + tiley);
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534     <span class="keywordflow">for</span> (y=prv-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>+tile; y&lt;prv-&gt;ymax; y+=tile*2) {
<a name="l00535"></a>00535         <span class="keywordflow">for</span> (x=prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+tile; x&lt;prv-&gt;xmax; x+=tile*2) {
<a name="l00536"></a>00536             <span class="keywordtype">float</span> tilex= tile, tiley= tile;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538             <span class="keywordflow">if</span> (x+tile &gt; prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>)
<a name="l00539"></a>00539                 tilex= prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-x;
<a name="l00540"></a>00540             <span class="keywordflow">if</span> (y+tile &gt; prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>)
<a name="l00541"></a>00541                 tiley= prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-y;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543             glRectf(x, y, x + tilex, y + tiley);
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     
<a name="l00547"></a>00547     glPixelZoom(xscale, yscale);
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     glEnable(GL_BLEND);
<a name="l00550"></a>00550     glBlendFunc( GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA );    <span class="comment">/* premul graphics */</span>
<a name="l00551"></a>00551     
<a name="l00552"></a>00552     glColor4f(1.0, 1.0, 1.0, 1.0);
<a name="l00553"></a>00553     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#ac573d112048ba54a7ad1a14235a19601">glaDrawPixelsTex</a>(prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#aa7cb94f2a88ad70bbaa7828b8b4c987a">xsize</a>, preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a608ade12fcd89ca6217376f8c65718ba">ysize</a>, GL_UNSIGNED_BYTE, preview-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>);
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     glDisable(GL_BLEND);
<a name="l00556"></a>00556     glPixelZoom(1.0f, 1.0f);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, -15, +100);
<a name="l00559"></a>00559     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a927bebeabf30bfa7ca451c16fe9336e4">fdrawbox</a>(prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, prv-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00560"></a>00560     
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="comment">/* common handle function for operator buttons that need to select the node first */</span>
<a name="l00564"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a7c6bf99966446d20b40304b0cdfd6025">00564</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a7c6bf99966446d20b40304b0cdfd6025">node_toggle_button_cb</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">void</span> *node_argv, <span class="keywordtype">void</span> *op_argv)
<a name="l00565"></a>00565 {
<a name="l00566"></a>00566     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node = (<a class="code" href="../../dc/daa/structbNode.html">bNode</a>*)node_argv;
<a name="l00567"></a>00567     <span class="keyword">const</span> <span class="keywordtype">char</span> *opname = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)op_argv;
<a name="l00568"></a>00568     
<a name="l00569"></a>00569     <span class="comment">/* select &amp; activate only the button&#39;s node */</span>
<a name="l00570"></a>00570     <a class="code" href="../../d8/d8c/node__intern_8h.html#aea94369e5db29182c3a39107bf98be65">node_select_single</a>(C, node);
<a name="l00571"></a>00571     
<a name="l00572"></a>00572     <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, opname, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a6b43802b9814b3d3e64ee0a03064bbee">00575</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a6b43802b9814b3d3e64ee0a03064bbee">node_draw_basis</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00578"></a>00578     <a class="code" href="../../da/d10/structrctf.html">rctf</a> *rct= &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>;
<a name="l00579"></a>00579     <span class="keywordtype">float</span> iconofs;
<a name="l00580"></a>00580     <span class="comment">/* float socket_size= NODE_SOCKSIZE*U.dpi/72; */</span> <span class="comment">/* UNUSED */</span>
<a name="l00581"></a>00581     <span class="keywordtype">float</span> iconbutw= 0.8f*<a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a>;
<a name="l00582"></a>00582     <span class="keywordtype">int</span> color_id= <a class="code" href="../../d9/d9b/node__draw_8c.html#a19ed0df20e1810d576f93e37e8f7431a">node_get_colorid</a>(node);
<a name="l00583"></a>00583     <span class="keywordtype">char</span> showname[128]; <span class="comment">/* 128 used below */</span>
<a name="l00584"></a>00584     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00585"></a>00585     
<a name="l00586"></a>00586     <span class="comment">/* hurmf... another candidate for callback, have to see how this works first */</span>
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a> &amp;&amp; snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>)
<a name="l00588"></a>00588         <a class="code" href="../../d4/d91/BKE__node_8h.html#a035172de5613c306539a86e26a973107">nodeShaderSynchronizeID</a>(node, 0);
<a name="l00589"></a>00589     
<a name="l00590"></a>00590     <span class="comment">/* skip if out of view */</span>
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> &lt; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> &gt; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> ||
<a name="l00592"></a>00592             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> &lt; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> &gt; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>) {
<a name="l00593"></a>00593         
<a name="l00594"></a>00594         <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac166273cd2c217e8b1da1bdac55a8ef8">uiEndBlock</a>(C, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>);
<a name="l00595"></a>00595         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00596"></a>00596         <span class="keywordflow">return</span>;
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598     
<a name="l00599"></a>00599     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8fc510c8382c62a5af3a095e218d8f3d">uiSetRoundBox</a>(<a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba8caa5a82d9edf3edb0c7803ff59ccc65">UI_CNR_TOP_LEFT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649baa847b3b73afd0cc1dde8a31d8b4e3fce">UI_CNR_TOP_RIGHT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba20182239f010b84a5902746abfe3bdc1">UI_CNR_BOTTOM_LEFT</a>);
<a name="l00600"></a>00600     <a class="code" href="../../d7/d86/interface__draw_8c.html#a468f37a013a4eb9c4b7d15638b66eeca">ui_dropshadow</a>(rct, <a class="code" href="../../d8/d8c/node__intern_8h.html#a359fdc0c895d597a0a4ec57dedf00c52">BASIS_RAD</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l00601"></a>00601     
<a name="l00602"></a>00602     <span class="comment">/* header */</span>
<a name="l00603"></a>00603     <span class="keywordflow">if</span> (color_id==<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a0e4624f23d3e772f8136062cd2cfeb68">TH_NODE</a>)
<a name="l00604"></a>00604         <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(color_id, -20);
<a name="l00605"></a>00605     <span class="keywordflow">else</span>
<a name="l00606"></a>00606         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(color_id);
<a name="l00607"></a>00607     
<a name="l00608"></a>00608     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5ac24732c48b9f55ca854d76228c0ae5">NODE_MUTED</a>)
<a name="l00609"></a>00609         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(color_id, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a65e3169909737674a0536441605a5754">TH_REDALERT</a>, 0.5f);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8fc510c8382c62a5af3a095e218d8f3d">uiSetRoundBox</a>(<a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba8caa5a82d9edf3edb0c7803ff59ccc65">UI_CNR_TOP_LEFT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649baa847b3b73afd0cc1dde8a31d8b4e3fce">UI_CNR_TOP_RIGHT</a>);
<a name="l00612"></a>00612     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5dc97f8bfa5592225dc4966ae18fe85d">uiRoundBox</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#a359fdc0c895d597a0a4ec57dedf00c52">BASIS_RAD</a>);
<a name="l00613"></a>00613     
<a name="l00614"></a>00614     <span class="comment">/* show/hide icons */</span>
<a name="l00615"></a>00615     iconofs= rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - 7.0f;
<a name="l00616"></a>00616     
<a name="l00617"></a>00617     <span class="comment">/* preview */</span>
<a name="l00618"></a>00618     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>) {
<a name="l00619"></a>00619         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00620"></a>00620         iconofs-=iconbutw;
<a name="l00621"></a>00621         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a54c054495b4966d6e51e0c5ccb5d72f4">UI_EMBOSSN</a>);
<a name="l00622"></a>00622         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#afb370449e683507d2b022aec0be66046">uiDefIconBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4ea9f3034b08c53c14d9032798b60901">TOGBUT</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#afeaa6456e370d2eb59f5e139d9f8b00cad2e360c9347074c4ae643fd7f3900bca">B_REDR</a>, ICON_MATERIAL,
<a name="l00623"></a>00623                            iconofs, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>, iconbutw, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00624"></a>00624         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but, <a class="code" href="../../d9/d9b/node__draw_8c.html#a7c6bf99966446d20b40304b0cdfd6025">node_toggle_button_cb</a>, node, (<span class="keywordtype">void</span>*)<span class="stringliteral">&quot;NODE_OT_preview_toggle&quot;</span>);
<a name="l00625"></a>00625         <span class="comment">/* XXX this does not work when node is activated and the operator called right afterwards,</span>
<a name="l00626"></a>00626 <span class="comment">         * since active ID is not updated yet (needs to process the notifier).</span>
<a name="l00627"></a>00627 <span class="comment">         * This can only work as visual indicator!</span>
<a name="l00628"></a>00628 <span class="comment">         */</span>
<a name="l00629"></a>00629 <span class="comment">//      if (!(node-&gt;flag &amp; (NODE_ACTIVE_ID|NODE_DO_OUTPUT)))</span>
<a name="l00630"></a>00630 <span class="comment">//          uiButSetFlag(but, UI_BUT_DISABLED);</span>
<a name="l00631"></a>00631         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633     <span class="comment">/* group edit */</span>
<a name="l00634"></a>00634     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>) {
<a name="l00635"></a>00635         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00636"></a>00636         iconofs-=iconbutw;
<a name="l00637"></a>00637         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a54c054495b4966d6e51e0c5ccb5d72f4">UI_EMBOSSN</a>);
<a name="l00638"></a>00638         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#afb370449e683507d2b022aec0be66046">uiDefIconBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4ea9f3034b08c53c14d9032798b60901">TOGBUT</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#afeaa6456e370d2eb59f5e139d9f8b00cad2e360c9347074c4ae643fd7f3900bca">B_REDR</a>, ICON_NODETREE,
<a name="l00639"></a>00639                            iconofs, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>, iconbutw, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00640"></a>00640         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but, <a class="code" href="../../d9/d9b/node__draw_8c.html#a7c6bf99966446d20b40304b0cdfd6025">node_toggle_button_cb</a>, node, (<span class="keywordtype">void</span>*)<span class="stringliteral">&quot;NODE_OT_group_edit&quot;</span>);
<a name="l00641"></a>00641         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643     
<a name="l00644"></a>00644     <span class="comment">/* title */</span>
<a name="l00645"></a>00645     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) 
<a name="l00646"></a>00646         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>);
<a name="l00647"></a>00647     <span class="keywordflow">else</span>
<a name="l00648"></a>00648         <a class="code" href="../../de/d96/UI__resources_8h.html#aab13d790796ae30ec4c04bee02f85595">UI_ThemeColorBlendShade</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ade800b14585ec3bc83905fe667484c4b">TH_TEXT</a>, color_id, 0.4f, 10);
<a name="l00649"></a>00649     
<a name="l00650"></a>00650     <span class="comment">/* open/close entirely? */</span>
<a name="l00651"></a>00651     {
<a name="l00652"></a>00652         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00653"></a>00653         <span class="keywordtype">int</span> but_size = <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a> *0.6f;
<a name="l00654"></a>00654         <span class="comment">/* XXX button uses a custom triangle draw below, so make it invisible without icon */</span>
<a name="l00655"></a>00655         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a54c054495b4966d6e51e0c5ccb5d72f4">UI_EMBOSSN</a>);
<a name="l00656"></a>00656         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#aff9055599f7d998b2b3ff2f02c6fb597">uiDefBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4ea9f3034b08c53c14d9032798b60901">TOGBUT</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#afeaa6456e370d2eb59f5e139d9f8b00cad2e360c9347074c4ae643fd7f3900bca">B_REDR</a>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00657"></a>00657                        rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+10.0f-but_size/2, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>/2.0f-but_size/2, but_size, but_size, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00658"></a>00658         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but, <a class="code" href="../../d9/d9b/node__draw_8c.html#a7c6bf99966446d20b40304b0cdfd6025">node_toggle_button_cb</a>, node, (<span class="keywordtype">void</span>*)<span class="stringliteral">&quot;NODE_OT_hide_toggle&quot;</span>);
<a name="l00659"></a>00659         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l00660"></a>00660         
<a name="l00661"></a>00661         <span class="comment">/* custom draw function for this button */</span>
<a name="l00662"></a>00662         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53b8b81d129309e89346e8e72293ae8b">UI_DrawTriIcon</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+10.0f, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>/2.0f, <span class="charliteral">&#39;v&#39;</span>);
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664     
<a name="l00665"></a>00665     <span class="comment">/* this isn&#39;t doing anything for the label, so commenting out */</span>
<a name="l00666"></a>00666 <span class="preprocessor">#if 0</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) 
<a name="l00668"></a>00668         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>);
<a name="l00669"></a>00669     <span class="keywordflow">else</span>
<a name="l00670"></a>00670         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ade800b14585ec3bc83905fe667484c4b">TH_TEXT</a>);
<a name="l00671"></a>00671 <span class="preprocessor">#endif</span>
<a name="l00672"></a>00672 <span class="preprocessor"></span>    
<a name="l00673"></a>00673     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(showname, <a class="code" href="../../d4/d91/BKE__node_8h.html#a310ed873e050bce490fb72ebd79c608a">nodeLabel</a>(node), <span class="keyword">sizeof</span>(showname));
<a name="l00674"></a>00674     
<a name="l00675"></a>00675     <span class="comment">//if (node-&gt;flag &amp; NODE_MUTED)</span>
<a name="l00676"></a>00676     <span class="comment">//  BLI_snprintf(showname, sizeof(showname), &quot;[%s]&quot;, showname); // XXX - don&#39;t print into self!</span>
<a name="l00677"></a>00677     
<a name="l00678"></a>00678     <a class="code" href="../../d8/d1e/UI__interface_8h.html#aff9055599f7d998b2b3ff2f02c6fb597">uiDefBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>, 0, showname, (<span class="keywordtype">short</span>)(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+15), (<span class="keywordtype">short</span>)(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>), 
<a name="l00679"></a>00679              (<span class="keywordtype">int</span>)(iconofs - rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>-18.0f), <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>,  <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="comment">/* body */</span>
<a name="l00682"></a>00682     <a class="code" href="../../de/d96/UI__resources_8h.html#ab3928c18aa7a95c23ed48412beb3a5d1">UI_ThemeColor4</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a0e4624f23d3e772f8136062cd2cfeb68">TH_NODE</a>);
<a name="l00683"></a>00683     glEnable(GL_BLEND);
<a name="l00684"></a>00684     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8fc510c8382c62a5af3a095e218d8f3d">uiSetRoundBox</a>(<a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba20182239f010b84a5902746abfe3bdc1">UI_CNR_BOTTOM_LEFT</a>);
<a name="l00685"></a>00685     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5dc97f8bfa5592225dc4966ae18fe85d">uiRoundBox</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#a359fdc0c895d597a0a4ec57dedf00c52">BASIS_RAD</a>);
<a name="l00686"></a>00686     glDisable(GL_BLEND);
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="comment">/* scaling indicator */</span>
<a name="l00689"></a>00689     <a class="code" href="../../d9/d9b/node__draw_8c.html#a787a93d93a860c66d9134a5480224bb4">node_scaling_widget</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a0e4624f23d3e772f8136062cd2cfeb68">TH_NODE</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#a359fdc0c895d597a0a4ec57dedf00c52">BASIS_RAD</a>*snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>+<a class="code" href="../../d8/d8c/node__intern_8h.html#a359fdc0c895d597a0a4ec57dedf00c52">BASIS_RAD</a>*snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="comment">/* outline active and selected emphasis */</span>
<a name="l00692"></a>00692     <span class="keywordflow">if</span> ( node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; (<a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a>|<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l00693"></a>00693         glEnable(GL_BLEND);
<a name="l00694"></a>00694         glEnable( GL_LINE_SMOOTH );
<a name="l00695"></a>00695             <span class="comment">/* using different shades of TH_TEXT_HI for the empasis, like triangle */</span>
<a name="l00696"></a>00696             <span class="keywordflow">if</span> ( node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a> ) 
<a name="l00697"></a>00697                 <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>, 0, -40);
<a name="l00698"></a>00698             <span class="keywordflow">else</span>
<a name="l00699"></a>00699                 <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>, -20, -120);
<a name="l00700"></a>00700             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8fc510c8382c62a5af3a095e218d8f3d">uiSetRoundBox</a>(<a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba8caa5a82d9edf3edb0c7803ff59ccc65">UI_CNR_TOP_LEFT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649baa847b3b73afd0cc1dde8a31d8b4e3fce">UI_CNR_TOP_RIGHT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba20182239f010b84a5902746abfe3bdc1">UI_CNR_BOTTOM_LEFT</a>); <span class="comment">// round all corners except lower right</span>
<a name="l00701"></a>00701             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a363d654a8d24625cd68b8d30e8005609">uiDrawBox</a>(GL_LINE_LOOP, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#a359fdc0c895d597a0a4ec57dedf00c52">BASIS_RAD</a>);
<a name="l00702"></a>00702             
<a name="l00703"></a>00703         glDisable( GL_LINE_SMOOTH );
<a name="l00704"></a>00704         glDisable(GL_BLEND);
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     
<a name="l00707"></a>00707     <span class="comment">/* disable lines */</span>
<a name="l00708"></a>00708     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5ac24732c48b9f55ca854d76228c0ae5">NODE_MUTED</a>)
<a name="l00709"></a>00709         <a class="code" href="../../d9/d9b/node__draw_8c.html#a74ae6839b21ccd71e791ca1415168eb3">node_draw_mute_line</a>(v2d, snode, node);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     
<a name="l00712"></a>00712     <span class="comment">/* socket inputs, buttons */</span>
<a name="l00713"></a>00713     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00714"></a>00714         <a class="code" href="../../dd/dfb/structbNodeSocketType.html">bNodeSocketType</a> *stype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a569537bca3d5248cfc2322a915803d89">ntreeGetSocketType</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00715"></a>00715         
<a name="l00716"></a>00716         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l00717"></a>00717             <span class="keywordflow">continue</span>;
<a name="l00718"></a>00718         
<a name="l00719"></a>00719         <a class="code" href="../../d9/d9b/node__draw_8c.html#a8bca2216d390fd561066ad80a8ddf4f5">node_socket_circle_draw</a>(ntree, sock, <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>);
<a name="l00720"></a>00720         
<a name="l00721"></a>00721         <span class="keywordflow">if</span> (stype-&gt;<a class="code" href="../../dd/dfb/structbNodeSocketType.html#a2500e5a15fb842527478c71cf38f1960">buttonfunc</a>)
<a name="l00722"></a>00722             stype-&gt;<a class="code" href="../../dd/dfb/structbNodeSocketType.html#a2500e5a15fb842527478c71cf38f1960">buttonfunc</a>(C, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, ntree, node, sock, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>), sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>+<a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#a66d2ef6a6ca4f6a66b09e764658182a1">NODE_DYS</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>);
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724     
<a name="l00725"></a>00725     <span class="comment">/* socket outputs */</span>
<a name="l00726"></a>00726     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00727"></a>00727         <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> sockptr;
<a name="l00728"></a>00728         
<a name="l00729"></a>00729         <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a>*)ntree, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a8021e472995d9172eb0407af053cf50e">RNA_NodeSocket</a>, sock, &amp;sockptr);
<a name="l00730"></a>00730         
<a name="l00731"></a>00731         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l00732"></a>00732             <span class="keywordflow">continue</span>;
<a name="l00733"></a>00733         
<a name="l00734"></a>00734         <a class="code" href="../../d9/d9b/node__draw_8c.html#a8bca2216d390fd561066ad80a8ddf4f5">node_socket_circle_draw</a>(ntree, sock, <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>);
<a name="l00735"></a>00735         
<a name="l00736"></a>00736         {
<a name="l00737"></a>00737             <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>);
<a name="l00738"></a>00738             <span class="keywordtype">float</span> slen;
<a name="l00739"></a>00739             <span class="keywordtype">int</span> ofs = 0;
<a name="l00740"></a>00740             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ade800b14585ec3bc83905fe667484c4b">TH_TEXT</a>);
<a name="l00741"></a>00741             slen= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>*<a class="code" href="../../d8/d1e/UI__interface_8h.html#a4bc308293a0e08f38e7a0984fdedf872">UI_GetStringWidth</a>(name);
<a name="l00742"></a>00742             <span class="keywordflow">while</span> (slen &gt; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>) {
<a name="l00743"></a>00743                 ofs++;
<a name="l00744"></a>00744                 slen= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>*<a class="code" href="../../d8/d1e/UI__interface_8h.html#a4bc308293a0e08f38e7a0984fdedf872">UI_GetStringWidth</a>(name+ofs);
<a name="l00745"></a>00745             }
<a name="l00746"></a>00746             <a class="code" href="../../d8/d1e/UI__interface_8h.html#aff9055599f7d998b2b3ff2f02c6fb597">uiDefBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>, 0, name+ofs, (<span class="keywordtype">short</span>)(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>-15.0f-slen), (<span class="keywordtype">short</span>)(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>-9.0f), 
<a name="l00747"></a>00747                      (<span class="keywordtype">short</span>)(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>-<a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>), <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>,  <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     
<a name="l00751"></a>00751     <span class="comment">/* preview */</span>
<a name="l00752"></a>00752     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>) {
<a name="l00753"></a>00753         <a class="code" href="../../df/dbb/BLI__threads_8h.html#aeb7fa826429971a6eb6074249ad39a0b">BLI_lock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a1d3b78586c37d966af13099593887610">LOCK_PREVIEW</a>);
<a name="l00754"></a>00754         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a> &amp;&amp; !<a class="code" href="../../d5/d44/BLI__rect_8h.html#a60695db890d17cf136b5f13f6fbb3a9b">BLI_rctf_is_empty</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>))
<a name="l00755"></a>00755             <a class="code" href="../../d9/d9b/node__draw_8c.html#a575a5346a7833f25b11903997f5846b2">node_draw_preview</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94d2cf23d542e763231dfd0f02465f17">prvr</a>);
<a name="l00756"></a>00756         <a class="code" href="../../df/dbb/BLI__threads_8h.html#add77b383686cdf9514286b56e3c7939c">BLI_unlock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a1d3b78586c37d966af13099593887610">LOCK_PREVIEW</a>);
<a name="l00757"></a>00757     }
<a name="l00758"></a>00758     
<a name="l00759"></a>00759     <a class="code" href="../../de/d96/UI__resources_8h.html#a726a719a5a3b6b944d24fbcab8ed29c6">UI_ThemeClearColor</a>(color_id);
<a name="l00760"></a>00760         
<a name="l00761"></a>00761     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac166273cd2c217e8b1da1bdac55a8ef8">uiEndBlock</a>(C, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>);
<a name="l00762"></a>00762     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4979d0ae4319574956c3ef2f2c3afa06">uiDrawBlock</a>(C, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>);
<a name="l00763"></a>00763     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a1607eee664b3aa0cb8861d62e55ad778">00766</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a1607eee664b3aa0cb8861d62e55ad778">node_draw_hidden</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00769"></a>00769     <a class="code" href="../../da/d10/structrctf.html">rctf</a> *rct= &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>;
<a name="l00770"></a>00770     <span class="keywordtype">float</span> dx, centy= 0.5f*(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>+rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00771"></a>00771     <span class="keywordtype">float</span> hiddenrad= 0.5f*(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00772"></a>00772     <span class="keywordtype">float</span> socket_size= <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>*<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.dpi/72;
<a name="l00773"></a>00773     <span class="keywordtype">int</span> color_id= <a class="code" href="../../d9/d9b/node__draw_8c.html#a19ed0df20e1810d576f93e37e8f7431a">node_get_colorid</a>(node);
<a name="l00774"></a>00774     <span class="keywordtype">char</span> showname[128]; <span class="comment">/* 128 is used below */</span>
<a name="l00775"></a>00775     
<a name="l00776"></a>00776     <span class="comment">/* shadow */</span>
<a name="l00777"></a>00777     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8fc510c8382c62a5af3a095e218d8f3d">uiSetRoundBox</a>(<a class="code" href="../../d8/d1e/UI__interface_8h.html#ab39a415800ebd0d977c477376649649ba7e9af1d815f4277196ed35a049f74148">UI_CNR_ALL</a>);
<a name="l00778"></a>00778     <a class="code" href="../../d7/d86/interface__draw_8c.html#a468f37a013a4eb9c4b7d15638b66eeca">ui_dropshadow</a>(rct, hiddenrad, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     <span class="comment">/* body */</span>
<a name="l00781"></a>00781     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(color_id);
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5ac24732c48b9f55ca854d76228c0ae5">NODE_MUTED</a>)
<a name="l00783"></a>00783         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(color_id, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a65e3169909737674a0536441605a5754">TH_REDALERT</a>, 0.5f);
<a name="l00784"></a>00784     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5dc97f8bfa5592225dc4966ae18fe85d">uiRoundBox</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, hiddenrad);
<a name="l00785"></a>00785     
<a name="l00786"></a>00786     <span class="comment">/* outline active and selected emphasis */</span>
<a name="l00787"></a>00787     <span class="keywordflow">if</span> ( node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; (<a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a>|<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l00788"></a>00788         glEnable(GL_BLEND);
<a name="l00789"></a>00789         glEnable( GL_LINE_SMOOTH );
<a name="l00790"></a>00790             <span class="comment">/* using different shades of TH_TEXT_HI for the empasis, like triangle */</span>
<a name="l00791"></a>00791             <span class="keywordflow">if</span> ( node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a> ) 
<a name="l00792"></a>00792                 <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>, 0, -40);
<a name="l00793"></a>00793             <span class="keywordflow">else</span>
<a name="l00794"></a>00794                 <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>, -20, -120);
<a name="l00795"></a>00795             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a363d654a8d24625cd68b8d30e8005609">uiDrawBox</a>(GL_LINE_LOOP, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, hiddenrad);
<a name="l00796"></a>00796         glDisable( GL_LINE_SMOOTH );
<a name="l00797"></a>00797         glDisable(GL_BLEND);
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799     
<a name="l00800"></a>00800     <span class="comment">/* title */</span>
<a name="l00801"></a>00801     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) 
<a name="l00802"></a>00802         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>);
<a name="l00803"></a>00803     <span class="keywordflow">else</span>
<a name="l00804"></a>00804         <a class="code" href="../../de/d96/UI__resources_8h.html#aab13d790796ae30ec4c04bee02f85595">UI_ThemeColorBlendShade</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ade800b14585ec3bc83905fe667484c4b">TH_TEXT</a>, color_id, 0.4f, 10);
<a name="l00805"></a>00805     
<a name="l00806"></a>00806     <span class="comment">/* open entirely icon */</span>
<a name="l00807"></a>00807     {
<a name="l00808"></a>00808         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00809"></a>00809         <span class="keywordtype">int</span> but_size = <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a> *0.6f;
<a name="l00810"></a>00810         <span class="comment">/* XXX button uses a custom triangle draw below, so make it invisible without icon */</span>
<a name="l00811"></a>00811         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a54c054495b4966d6e51e0c5ccb5d72f4">UI_EMBOSSN</a>);
<a name="l00812"></a>00812         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#aff9055599f7d998b2b3ff2f02c6fb597">uiDefBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4ea9f3034b08c53c14d9032798b60901">TOGBUT</a>, <a class="code" href="../../d8/d8c/node__intern_8h.html#afeaa6456e370d2eb59f5e139d9f8b00cad2e360c9347074c4ae643fd7f3900bca">B_REDR</a>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00813"></a>00813                        rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+10.0f-but_size/2, centy-but_size/2, but_size, but_size, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00814"></a>00814         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but, <a class="code" href="../../d9/d9b/node__draw_8c.html#a7c6bf99966446d20b40304b0cdfd6025">node_toggle_button_cb</a>, node, (<span class="keywordtype">void</span>*)<span class="stringliteral">&quot;NODE_OT_hide_toggle&quot;</span>);
<a name="l00815"></a>00815         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a273f9460f5ebaa8e186d34a949d1f862">uiBlockSetEmboss</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l00816"></a>00816         
<a name="l00817"></a>00817         <span class="comment">/* custom draw function for this button */</span>
<a name="l00818"></a>00818         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53b8b81d129309e89346e8e72293ae8b">UI_DrawTriIcon</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+10.0f, centy, <span class="charliteral">&#39;h&#39;</span>);
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820     
<a name="l00821"></a>00821     <span class="comment">/* disable lines */</span>
<a name="l00822"></a>00822     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5ac24732c48b9f55ca854d76228c0ae5">NODE_MUTED</a>)
<a name="l00823"></a>00823         <a class="code" href="../../d9/d9b/node__draw_8c.html#a74ae6839b21ccd71e791ca1415168eb3">node_draw_mute_line</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, snode, node); 
<a name="l00824"></a>00824     
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) 
<a name="l00826"></a>00826         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aff83a64859a3ca49a01a88357acaf007">TH_TEXT_HI</a>);
<a name="l00827"></a>00827     <span class="keywordflow">else</span>
<a name="l00828"></a>00828         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ade800b14585ec3bc83905fe667484c4b">TH_TEXT</a>);
<a name="l00829"></a>00829     
<a name="l00830"></a>00830     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a45344c987d49653cfdedebb4c403a3f2">miniwidth</a>&gt;0.0f) {
<a name="l00831"></a>00831         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(showname, <a class="code" href="../../d4/d91/BKE__node_8h.html#a310ed873e050bce490fb72ebd79c608a">nodeLabel</a>(node), <span class="keyword">sizeof</span>(showname));
<a name="l00832"></a>00832         
<a name="l00833"></a>00833         <span class="comment">//if (node-&gt;flag &amp; NODE_MUTED)</span>
<a name="l00834"></a>00834         <span class="comment">//  BLI_snprintf(showname, sizeof(showname), &quot;[%s]&quot;, showname); // XXX - don&#39;t print into self!</span>
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aff9055599f7d998b2b3ff2f02c6fb597">uiDefBut</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>, 0, showname, (<span class="keywordtype">short</span>)(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>+15), (<span class="keywordtype">short</span>)(centy-10), 
<a name="l00837"></a>00837                  (<span class="keywordtype">int</span>)(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>-18.0f -12.0f), <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>,  <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00838"></a>00838     }   
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <span class="comment">/* scale widget thing */</span>
<a name="l00841"></a>00841     <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(color_id, -10);  
<a name="l00842"></a>00842     dx= 10.0f;
<a name="l00843"></a>00843     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx, centy-4.0f, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx, centy+4.0f);
<a name="l00844"></a>00844     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx-3.0f*snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, centy-4.0f, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx-3.0f*snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, centy+4.0f);
<a name="l00845"></a>00845     
<a name="l00846"></a>00846     <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(color_id, +30);
<a name="l00847"></a>00847     dx-= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>;
<a name="l00848"></a>00848     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx, centy-4.0f, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx, centy+4.0f);
<a name="l00849"></a>00849     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a7354f70d0e522da34583d29bbec4d194">fdrawline</a>(rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx-3.0f*snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, centy-4.0f, rct-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>-dx-3.0f*snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>, centy+4.0f);
<a name="l00850"></a>00850     
<a name="l00851"></a>00851     <span class="comment">/* sockets */</span>
<a name="l00852"></a>00852     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00853"></a>00853         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l00854"></a>00854             <a class="code" href="../../d9/d9b/node__draw_8c.html#a8bca2216d390fd561066ad80a8ddf4f5">node_socket_circle_draw</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, sock, socket_size);
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856     
<a name="l00857"></a>00857     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00858"></a>00858         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l00859"></a>00859             <a class="code" href="../../d9/d9b/node__draw_8c.html#a8bca2216d390fd561066ad80a8ddf4f5">node_socket_circle_draw</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, sock, socket_size);
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861     
<a name="l00862"></a>00862     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac166273cd2c217e8b1da1bdac55a8ef8">uiEndBlock</a>(C, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>);
<a name="l00863"></a>00863     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4979d0ae4319574956c3ef2f2c3afa06">uiDrawBlock</a>(C, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>);
<a name="l00864"></a>00864     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a21b2e317e978852ba0e0df2ce2dd6859">block</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00865"></a>00865 }
<a name="l00866"></a>00866 
<a name="l00867"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a33b9e96dcd45180ddcdfe3fea0a9ce61">00867</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a33b9e96dcd45180ddcdfe3fea0a9ce61">node_draw_default</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00868"></a>00868 {
<a name="l00869"></a>00869     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a9514398b17ede671295e5c873e7bb3df">NODE_HIDDEN</a>)
<a name="l00870"></a>00870         <a class="code" href="../../d9/d9b/node__draw_8c.html#a1607eee664b3aa0cb8861d62e55ad778">node_draw_hidden</a>(C, ar, snode, node);
<a name="l00871"></a>00871     <span class="keywordflow">else</span>
<a name="l00872"></a>00872         <a class="code" href="../../d9/d9b/node__draw_8c.html#a6b43802b9814b3d3e64ee0a03064bbee">node_draw_basis</a>(C, ar, snode, ntree, node);
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#ad5c443fb31f1496f4a83ceee13f548b2">00875</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#ad5c443fb31f1496f4a83ceee13f548b2">node_update</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00876"></a>00876 {
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#adf5b93611397444d22527b1ad1969a38" title="Updates the node geometry attributes according to internal state before actual drawing.">drawupdatefunc</a>)
<a name="l00878"></a>00878         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#adf5b93611397444d22527b1ad1969a38" title="Updates the node geometry attributes according to internal state before actual drawing.">drawupdatefunc</a>(C, ntree, node);
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a255034af49f4ae4e0c1e87c175717326">00881</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a255034af49f4ae4e0c1e87c175717326">node_update_nodetree</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">float</span> offsetx, <span class="keywordtype">float</span> offsety)
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00884"></a>00884     
<a name="l00885"></a>00885     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00886"></a>00886         <span class="comment">/* XXX little hack */</span>
<a name="l00887"></a>00887         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a> += offsetx;
<a name="l00888"></a>00888         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a> += offsety;
<a name="l00889"></a>00889         
<a name="l00890"></a>00890         <a class="code" href="../../d9/d9b/node__draw_8c.html#ad5c443fb31f1496f4a83ceee13f548b2">node_update</a>(C, ntree, node);
<a name="l00891"></a>00891         
<a name="l00892"></a>00892         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a> -= offsetx;
<a name="l00893"></a>00893         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a> -= offsety;
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 
<a name="l00897"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a02a556311996ecef5b8a7149856f5027">00897</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a02a556311996ecef5b8a7149856f5027">node_draw</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac4bbe81a1e6c6cf2011c782addc6c255" title="Main draw function for the node.">drawfunc</a>)
<a name="l00900"></a>00900         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac4bbe81a1e6c6cf2011c782addc6c255" title="Main draw function for the node.">drawfunc</a>(C, ar, snode, ntree, node);
<a name="l00901"></a>00901 }
<a name="l00902"></a>00902 
<a name="l00903"></a><a class="code" href="../../d9/d9b/node__draw_8c.html#a75f392ad92a1ef2a57d58ed4a93796e8">00903</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#a75f392ad92a1ef2a57d58ed4a93796e8">node_draw_nodetree</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00906"></a>00906     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00907"></a>00907     <span class="keywordtype">int</span> a;
<a name="l00908"></a>00908     
<a name="l00909"></a>00909     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;        <span class="comment">/* groups... */</span>
<a name="l00910"></a>00910     
<a name="l00911"></a>00911     <span class="comment">/* node lines */</span>
<a name="l00912"></a>00912     glEnable(GL_BLEND);
<a name="l00913"></a>00913     glEnable(GL_LINE_SMOOTH);
<a name="l00914"></a>00914     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l00915"></a>00915         <a class="code" href="../../d5/d1d/drawnode_8c.html#a2d397f6e2f54e2a060088a0a0041d2e9">node_draw_link</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, snode, link);
<a name="l00916"></a>00916     glDisable(GL_LINE_SMOOTH);
<a name="l00917"></a>00917     glDisable(GL_BLEND);
<a name="l00918"></a>00918     
<a name="l00919"></a>00919     <span class="comment">/* draw nodes, last nodes in front */</span>
<a name="l00920"></a>00920     <span class="keywordflow">for</span> (a=0, node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>, a++) {
<a name="l00921"></a>00921         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a755e2589553e16ad63c4431c6ec2c5c2">nr</a>= a;        <span class="comment">/* index of node in list, used for exec event code */</span>
<a name="l00922"></a>00922         <a class="code" href="../../d9/d9b/node__draw_8c.html#a02a556311996ecef5b8a7149856f5027">node_draw</a>(C, ar, snode, ntree, node);
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924 }
<a name="l00925"></a>00925 
<a name="l00926"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ac338b81d93bb045d2ad061555b017b28">00926</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d9b/node__draw_8c.html#ac338b81d93bb045d2ad061555b017b28">drawnodespace</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d)
<a name="l00927"></a>00927 {
<a name="l00928"></a>00928     <a class="code" href="../../d6/dfa/structView2DScrollers.html">View2DScrollers</a> *scrollers;
<a name="l00929"></a>00929     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00930"></a>00930     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00931"></a>00931     <span class="keywordtype">int</span> color_manage = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aa9a0521ac4e22707d09ddeac4bf104b2">color_mgt_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aea9753cc8aec8bc51c69f789cd188848">R_COLOR_MANAGEMENT</a>;
<a name="l00932"></a>00932     <a class="code" href="../../d2/d39/structbNodeLinkDrag.html">bNodeLinkDrag</a> *nldrag;
<a name="l00933"></a>00933     
<a name="l00934"></a>00934     <a class="code" href="../../de/d96/UI__resources_8h.html#a726a719a5a3b6b944d24fbcab8ed29c6">UI_ThemeClearColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>);
<a name="l00935"></a>00935     glClear(GL_COLOR_BUFFER_BIT);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937     <a class="code" href="../../d5/d63/UI__view2d_8h.html#a10df649f115243423dbd5d9777d182f7">UI_view2d_view_ortho</a>(v2d);
<a name="l00938"></a>00938     
<a name="l00939"></a>00939     <span class="comment">//uiFreeBlocksWin(&amp;sa-&gt;uiblocks, sa-&gt;win);</span>
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="comment">/* only set once */</span>
<a name="l00942"></a>00942     glBlendFunc( GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA );
<a name="l00943"></a>00943     glEnable(GL_MAP1_VERTEX_3);
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="comment">/* aspect+font, set each time */</span>
<a name="l00946"></a>00946     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94dda3de52a27a19eadb6bc2881f3337">aspect</a>= (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>)/((<span class="keywordtype">float</span>)ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>);
<a name="l00947"></a>00947     <span class="comment">// XXX snode-&gt;curfont= uiSetCurFont_ext(snode-&gt;aspect);</span>
<a name="l00948"></a>00948 
<a name="l00949"></a>00949     <a class="code" href="../../d5/d63/UI__view2d_8h.html#a8d5d55e9ee2a35d73c9ae73349968713">UI_view2d_constant_grid_draw</a>(v2d);
<a name="l00950"></a>00950     <span class="comment">/* backdrop */</span>
<a name="l00951"></a>00951     <a class="code" href="../../d5/d1d/drawnode_8c.html#a1916d5aabec12fdd02901bba2fbb498d">draw_nodespace_back_pix</a>(ar, snode, color_manage);
<a name="l00952"></a>00952     
<a name="l00953"></a>00953     <span class="comment">/* nodes */</span>
<a name="l00954"></a>00954     <a class="code" href="../../d1/d13/node__edit_8c.html#af3752ed9cce41665ca8279adeee8be39">snode_set_context</a>(snode, <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C));
<a name="l00955"></a>00955     
<a name="l00956"></a>00956     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>) {
<a name="l00957"></a>00957         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00958"></a>00958         
<a name="l00959"></a>00959         <a class="code" href="../../d9/d9b/node__draw_8c.html#aac4e6934f7284ec84ab9ecabc844c55c">node_uiblocks_init</a>(C, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l00960"></a>00960         
<a name="l00961"></a>00961         <span class="comment">/* uiBlocks must be initialized in drawing order for correct event clipping.</span>
<a name="l00962"></a>00962 <span class="comment">         * Node group internal blocks added after the main group block.</span>
<a name="l00963"></a>00963 <span class="comment">         */</span>
<a name="l00964"></a>00964         <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00965"></a>00965             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>)
<a name="l00966"></a>00966                 <a class="code" href="../../d9/d9b/node__draw_8c.html#aac4e6934f7284ec84ab9ecabc844c55c">node_uiblocks_init</a>(C, (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00967"></a>00967         }
<a name="l00968"></a>00968         
<a name="l00969"></a>00969         <a class="code" href="../../d9/d9b/node__draw_8c.html#a255034af49f4ae4e0c1e87c175717326">node_update_nodetree</a>(C, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, 0.0f, 0.0f);
<a name="l00970"></a>00970         <a class="code" href="../../d9/d9b/node__draw_8c.html#a75f392ad92a1ef2a57d58ed4a93796e8">node_draw_nodetree</a>(C, ar, snode, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l00971"></a>00971         
<a name="l00972"></a>00972 <span class="preprocessor">        #if 0</span>
<a name="l00973"></a>00973 <span class="preprocessor"></span>        <span class="comment">/* active group */</span>
<a name="l00974"></a>00974         <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00975"></a>00975             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>)
<a name="l00976"></a>00976                 <a class="code" href="../../d5/d1d/drawnode_8c.html#a088cf434b766ec3165ee1b35fb242651">node_draw_group</a>(C, ar, snode, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, node);
<a name="l00977"></a>00977         }
<a name="l00978"></a>00978 <span class="preprocessor">        #endif</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span>    }
<a name="l00980"></a>00980     
<a name="l00981"></a>00981     <span class="comment">/* temporary links */</span>
<a name="l00982"></a>00982     glEnable(GL_BLEND);
<a name="l00983"></a>00983     glEnable(GL_LINE_SMOOTH);
<a name="l00984"></a>00984     <span class="keywordflow">for</span> (nldrag= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1e16ca4023bb5f8981c0c8c79cd7cdc8">linkdrag</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nldrag; nldrag= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a6327d827aa0f6763dfdd6ce99b7eab8a">next</a>)
<a name="l00985"></a>00985         <a class="code" href="../../d5/d1d/drawnode_8c.html#a2d397f6e2f54e2a060088a0a0041d2e9">node_draw_link</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, snode, nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>);
<a name="l00986"></a>00986     glDisable(GL_LINE_SMOOTH);
<a name="l00987"></a>00987     glDisable(GL_BLEND);
<a name="l00988"></a>00988     
<a name="l00989"></a>00989     <span class="comment">/* draw grease-pencil (&#39;canvas&#39; strokes) */</span>
<a name="l00990"></a>00990     <span class="keywordflow">if</span> (<span class="comment">/*(snode-&gt;flag &amp; SNODE_DISPGP) &amp;&amp;*/</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>))
<a name="l00991"></a>00991         <a class="code" href="../../dd/d3e/drawgpencil_8c.html#a72421cf8e9f970f95f346c8d788d0b38">draw_gpencil_view2d</a>((<a class="code" href="../../d5/df1/structbContext.html">bContext</a>*)C, 1);
<a name="l00992"></a>00992     
<a name="l00993"></a>00993     <span class="comment">/* reset view matrix */</span>
<a name="l00994"></a>00994     <a class="code" href="../../d5/d63/UI__view2d_8h.html#a665a1f0de807248abff87b62a4d2ac8b">UI_view2d_view_restore</a>(C);
<a name="l00995"></a>00995     
<a name="l00996"></a>00996     <span class="comment">/* draw grease-pencil (screen strokes, and also paintbuffer) */</span>
<a name="l00997"></a>00997     <span class="keywordflow">if</span> (<span class="comment">/*(snode-&gt;flag &amp; SNODE_DISPGP) &amp;&amp; */</span>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>))
<a name="l00998"></a>00998         <a class="code" href="../../dd/d3e/drawgpencil_8c.html#a72421cf8e9f970f95f346c8d788d0b38">draw_gpencil_view2d</a>((<a class="code" href="../../d5/df1/structbContext.html">bContext</a>*)C, 0);
<a name="l00999"></a>00999     
<a name="l01000"></a>01000     <span class="comment">/* scrollers */</span>
<a name="l01001"></a>01001     scrollers= <a class="code" href="../../d5/d63/UI__view2d_8h.html#ac59b39b29261b0af35bff6a60231319a">UI_view2d_scrollers_calc</a>(C, v2d, 10, <a class="code" href="../../d5/d63/UI__view2d_8h.html#aad393aa3e173d7f081ab4bbc6ba5027da71e446c960198bb1449ff8f02d258a6e">V2D_GRID_CLAMP</a>, <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab5ba307cf79a2ef296222e3681de4b05">V2D_ARG_DUMMY</a>, <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab5ba307cf79a2ef296222e3681de4b05">V2D_ARG_DUMMY</a>);
<a name="l01002"></a>01002     <a class="code" href="../../d5/d63/UI__view2d_8h.html#a8e930eb3c26f1c4389bb0a147e47781b">UI_view2d_scrollers_draw</a>(C, v2d, scrollers);
<a name="l01003"></a>01003     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ac30f32ea757898d20f76ae42e6cbdb2b">UI_view2d_scrollers_free</a>(scrollers);
<a name="l01004"></a>01004 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:35 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

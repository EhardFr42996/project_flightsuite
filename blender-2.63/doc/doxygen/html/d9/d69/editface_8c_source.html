<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: editface.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">editface.c</div>  </div>
</div>
<div class="contents">
<a href="../../d9/d69/editface_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Blender Foundation, Campbell Barton</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html" title="A general unordered 2-int pair hash table ADT.">BLI_edgehash.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html">BKE_DerivedMesh.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html">BKE_tessmesh.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd6/ED__mesh_8h.html">ED_mesh.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/* own include */</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d5c/mesh__intern_8h.html">mesh_intern.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/* copy the face flags, most importantly selection from the mesh to the final derived mesh,</span>
<a name="l00067"></a>00067 <span class="comment"> * use in object mode when selecting faces (while painting) */</span>
<a name="l00068"></a><a class="code" href="../../d9/d69/editface_8c.html#a91759d53f29745eafffeae8fce540cf6">00068</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00071"></a>00071     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>;
<a name="l00072"></a>00072     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *polys, *mp_orig;
<a name="l00073"></a>00073     <a class="code" href="../../d6/da0/structMFace.html">MFace</a> *faces;
<a name="l00074"></a>00074     <span class="keywordtype">int</span> *index_array = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00075"></a>00075     <span class="keywordtype">int</span> totface, totpoly;
<a name="l00076"></a>00076     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00077"></a>00077     
<a name="l00078"></a>00078     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || dm == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00079"></a>00079         <span class="keywordflow">return</span>;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">/*</span>
<a name="l00082"></a>00082 <span class="comment">     * Try to push updated mesh poly flags to three other data sets:</span>
<a name="l00083"></a>00083 <span class="comment">     *  - Mesh polys =&gt; Mesh tess faces</span>
<a name="l00084"></a>00084 <span class="comment">     *  - Mesh polys =&gt; Final derived polys</span>
<a name="l00085"></a>00085 <span class="comment">     *  - Final derived polys =&gt; Final derived tessfaces</span>
<a name="l00086"></a>00086 <span class="comment">     */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="keywordflow">if</span> ((index_array = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab05e3a5a972a7132cc6e254914fb5743">CustomData_get_layer</a>(&amp;me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#aa372d7e079afb57b1c244af8b8906509">CD_POLYINDEX</a>))) {
<a name="l00089"></a>00089         faces = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>;
<a name="l00090"></a>00090         totface = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>;
<a name="l00091"></a>00091         
<a name="l00092"></a>00092         <span class="comment">/* loop over tessfaces */</span>
<a name="l00093"></a>00093         <span class="keywordflow">for</span> (i = 0; i &lt; totface; i++) {
<a name="l00094"></a>00094             <span class="comment">/* Copy flags onto the original tessface from its original poly */</span>
<a name="l00095"></a>00095             mp_orig = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> + index_array[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00096"></a>00096             faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/da0/structMFace.html#a729da859ed02b2946331e7f82f3ff20c">flag</a> = mp_orig-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a>;
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keywordflow">if</span> ((index_array = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab05e3a5a972a7132cc6e254914fb5743">CustomData_get_layer</a>(&amp;dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a6fef20d1e0da7b52c44be7a98b2fb388">polyData</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5e2cdbe47f447a68d43a9410d8c42100">CD_ORIGINDEX</a>))) {
<a name="l00101"></a>00101         polys = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ab8b054b009b29543deee65428097ee83">getPolyArray</a>(dm);
<a name="l00102"></a>00102         totpoly = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a316a9297495999cd00e5fa1107c67efd">getNumPolys</a>(dm);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="comment">/* loop over final derived polys */</span>
<a name="l00105"></a>00105         <span class="keywordflow">for</span> (i = 0; i &lt; totpoly; i++) {
<a name="l00106"></a>00106             <span class="comment">/* Copy flags onto the final derived poly from the original mesh poly */</span>
<a name="l00107"></a>00107             mp_orig = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> + index_array[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00108"></a>00108             polys[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> = mp_orig-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a>;
<a name="l00109"></a>00109         }
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="keywordflow">if</span> ((index_array = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ab05e3a5a972a7132cc6e254914fb5743">CustomData_get_layer</a>(&amp;dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a12722e14b04d5f053d93d2a3bb81203e">faceData</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#aa372d7e079afb57b1c244af8b8906509">CD_POLYINDEX</a>))) {
<a name="l00113"></a>00113         polys = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ab8b054b009b29543deee65428097ee83">getPolyArray</a>(dm);
<a name="l00114"></a>00114         faces = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#aebdc3d5680e822d40c479530c23a56a1">getTessFaceArray</a>(dm);
<a name="l00115"></a>00115         totface = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3481fefe300b7d6b456071320be70c56">getNumTessFaces</a>(dm);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="comment">/* loop over tessfaces */</span>
<a name="l00118"></a>00118         <span class="keywordflow">for</span> (i = 0; i &lt; totface; i++) {
<a name="l00119"></a>00119             <span class="comment">/* Copy flags onto the final tessface from its final poly */</span>
<a name="l00120"></a>00120             mp_orig = polys + index_array[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00121"></a>00121             faces[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d6/da0/structMFace.html#a729da859ed02b2946331e7f82f3ff20c">flag</a> = mp_orig-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a>;
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">/* returns 0 if not found, otherwise 1 */</span>
<a name="l00127"></a><a class="code" href="../../d9/d69/editface_8c.html#a73613ea950d713f18500f26abb77b6d7">00127</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d69/editface_8c.html#a73613ea950d713f18500f26abb77b6d7">facesel_face_pick</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *index, <span class="keywordtype">short</span> rect)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00130"></a>00130     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> vc;
<a name="l00131"></a>00131     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa18efc327ab12e74064a2c1129237431">view3d_set_viewcontext</a>(C, &amp;vc);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (!me || me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> == 0)
<a name="l00134"></a>00134         <span class="keywordflow">return</span> 0;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae5f8948de8154f33137ad68f4446d193">makeDerivedMesh</a>(scene, ob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ac302305683fc6e7bba64ef68c74a1404">CD_MASK_BAREMESH</a>, 0);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="comment">// XXX  if (v3d-&gt;flag &amp; V3D_INVALID_BACKBUF) {</span>
<a name="l00139"></a>00139 <span class="comment">// XXX drawview.c!      check_backbuf();</span>
<a name="l00140"></a>00140 <span class="comment">// XXX      persp(PERSP_VIEW);</span>
<a name="l00141"></a>00141 <span class="comment">// XXX  }</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (rect) {
<a name="l00144"></a>00144         <span class="comment">/* sample rect to increase changes of selecting, so that when clicking</span>
<a name="l00145"></a>00145 <span class="comment">         * on an edge in the backbuf, we can still select a face */</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="keywordtype">int</span> dist;
<a name="l00148"></a>00148         *index = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ac058a8ae08ac7b3043c0a19cdeafe0a8">view3d_sample_backbuf_rect</a>(&amp;vc, mval, 3, 1, me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> + 1, &amp;dist, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150     <span class="keywordflow">else</span> {
<a name="l00151"></a>00151         <span class="comment">/* sample only on the exact position */</span>
<a name="l00152"></a>00152         *index = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aba40efd013e32afa64b4059112bcaede">view3d_sample_backbuf</a>(&amp;vc, mval[0], mval[1]);
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordflow">if</span> ((*index) &lt;= 0 || (*index) &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>)
<a name="l00156"></a>00156         <span class="keywordflow">return</span> 0;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     (*index)--;
<a name="l00159"></a>00159     
<a name="l00160"></a>00160     <span class="keywordflow">return</span> 1;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="../../d9/d69/editface_8c.html#ae29a7efe272c1738ee81a026b657d645">00163</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ab624fc51740a412c27cf0a80cdf19c63">paintface_hide</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keyword">const</span> <span class="keywordtype">int</span> unselected)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00166"></a>00166     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mpoly;
<a name="l00167"></a>00167     <span class="keywordtype">int</span> a;
<a name="l00168"></a>00168     
<a name="l00169"></a>00169     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> == 0) <span class="keywordflow">return</span>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00173"></a>00173     a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l00174"></a>00174     <span class="keywordflow">while</span> (a--) {
<a name="l00175"></a>00175         <span class="keywordflow">if</span> ((mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0) {
<a name="l00176"></a>00176             <span class="keywordflow">if</span> (unselected) {
<a name="l00177"></a>00177                 <span class="keywordflow">if</span> ( (mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>) == 0) mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>;
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179             <span class="keywordflow">else</span> {
<a name="l00180"></a>00180                 <span class="keywordflow">if</span> ( (mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>)) mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>;
<a name="l00181"></a>00181             }
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         <span class="keywordflow">if</span> (mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00184"></a>00184         
<a name="l00185"></a>00185         mpoly++;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(ob);
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="../../d9/d69/editface_8c.html#a9a92a15b516765a1d45956f0ebbf1d96">00192</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a814be25c6c63fac9d6ede0ba249f24f3">paintface_reveal</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00195"></a>00195     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mpoly;
<a name="l00196"></a>00196     <span class="keywordtype">int</span> a;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> == 0) <span class="keywordflow">return</span>;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00202"></a>00202     a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l00203"></a>00203     <span class="keywordflow">while</span> (a--) {
<a name="l00204"></a>00204         <span class="keywordflow">if</span> (mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) {
<a name="l00205"></a>00205             mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00206"></a>00206             mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> -= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>;
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208         mpoly++;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(ob);
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="comment">/* Set tface seams based on edge data, uses hash table to find seam edges. */</span>
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="../../d9/d69/editface_8c.html#aee9acaad2f5c41cbfb372f409cb5820a">00216</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d69/editface_8c.html#aee9acaad2f5c41cbfb372f409cb5820a">hash_add_face</a>(<a class="code" href="../../db/d6c/structEdgeHash.html">EdgeHash</a> *ehash, <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mp, <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *mloop)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *ml;
<a name="l00219"></a>00219     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">for</span> (i = 0, ml = mloop; i &lt; mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a>; i++, ml++) {
<a name="l00222"></a>00222         <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a2e0f4e2b0d6efaccac6f6d7c595955eb">BLI_edgehash_insert</a>(ehash, ml-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>, <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#ac84d2772f3397eb5ea9d3ffa3c23ef5a">ME_POLY_LOOP_NEXT</a>(mloop, mp, i)-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="../../d9/d69/editface_8c.html#ab8100c56856cfd71738ebf232dbf2e3c">00227</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d69/editface_8c.html#ab8100c56856cfd71738ebf232dbf2e3c">select_linked_tfaces_with_seams</a>(<span class="keywordtype">int</span> mode, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229     <a class="code" href="../../db/d6c/structEdgeHash.html">EdgeHash</a> *ehash, *seamhash;
<a name="l00230"></a>00230     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mp;
<a name="l00231"></a>00231     <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *ml;
<a name="l00232"></a>00232     <a class="code" href="../../d6/ded/structMEdge.html">MEdge</a> *med;
<a name="l00233"></a>00233     <span class="keywordtype">char</span> *linkflag;
<a name="l00234"></a>00234     <span class="keywordtype">int</span> a, b, doit = 1, mark = 0;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     ehash = <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#aa74e7b101fe3c5b8acf0f169efdf0cfb">BLI_edgehash_new</a>();
<a name="l00237"></a>00237     seamhash = <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#aa74e7b101fe3c5b8acf0f169efdf0cfb">BLI_edgehash_new</a>();
<a name="l00238"></a>00238     linkflag = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>, <span class="stringliteral">&quot;linkflaguv&quot;</span>);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     <span class="keywordflow">for</span> (med = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>, a = 0; a &lt; me-&gt;totedge; a++, med++)
<a name="l00241"></a>00241         <span class="keywordflow">if</span> (med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a5c86d036e926ac7e671699d149a75da0">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a87e315b9b33dbdef3f54ab2f6e951e06">ME_SEAM</a>)
<a name="l00242"></a>00242             <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a2e0f4e2b0d6efaccac6f6d7c595955eb">BLI_edgehash_insert</a>(seamhash, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (mode == 0 || mode == 1) {
<a name="l00245"></a>00245         <span class="comment">/* only put face under cursor in array */</span>
<a name="l00246"></a>00246         mp = ((<a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *)me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>) + index;
<a name="l00247"></a>00247         <a class="code" href="../../d9/d69/editface_8c.html#aee9acaad2f5c41cbfb372f409cb5820a">hash_add_face</a>(ehash, mp, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>);
<a name="l00248"></a>00248         linkflag[index] = 1;
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250     <span class="keywordflow">else</span> {
<a name="l00251"></a>00251         <span class="comment">/* fill array by selection */</span>
<a name="l00252"></a>00252         mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00253"></a>00253         <span class="keywordflow">for</span> (a = 0; a &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>; a++, mp++) {
<a name="l00254"></a>00254             <span class="keywordflow">if</span> (mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) ;
<a name="l00255"></a>00255             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>) {
<a name="l00256"></a>00256                 <a class="code" href="../../d9/d69/editface_8c.html#aee9acaad2f5c41cbfb372f409cb5820a">hash_add_face</a>(ehash, mp, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>);
<a name="l00257"></a>00257                 linkflag[a] = 1;
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">while</span> (doit) {
<a name="l00263"></a>00263         doit = 0;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="comment">/* expand selection */</span>
<a name="l00266"></a>00266         mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00267"></a>00267         <span class="keywordflow">for</span> (a = 0; a &lt; me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>; a++, mp++) {
<a name="l00268"></a>00268             <span class="keywordflow">if</span> (mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>)
<a name="l00269"></a>00269                 <span class="keywordflow">continue</span>;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271             <span class="keywordflow">if</span> (!linkflag[a]) {
<a name="l00272"></a>00272                 <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *mnextl;
<a name="l00273"></a>00273                 mark = 0;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                 ml = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>;
<a name="l00276"></a>00276                 <span class="keywordflow">for</span> (b = 0; b &lt; mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a>; b++, ml++) {
<a name="l00277"></a>00277                     mnextl = b &lt; mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a> - 1 ? ml - 1 : me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>;
<a name="l00278"></a>00278                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a3c65288faeadad320694712e249bfeea">BLI_edgehash_haskey</a>(seamhash, ml-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>, mnextl-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>))
<a name="l00279"></a>00279                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a3c65288faeadad320694712e249bfeea">BLI_edgehash_haskey</a>(ehash, ml-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>, mnextl-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>))
<a name="l00280"></a>00280                             mark = 1;
<a name="l00281"></a>00281                 }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283                 <span class="keywordflow">if</span> (mark) {
<a name="l00284"></a>00284                     linkflag[a] = 1;
<a name="l00285"></a>00285                     <a class="code" href="../../d9/d69/editface_8c.html#aee9acaad2f5c41cbfb372f409cb5820a">hash_add_face</a>(ehash, mp, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>);
<a name="l00286"></a>00286                     doit = 1;
<a name="l00287"></a>00287                 }
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a14b3a8c9081b5a9c40edd7294856c45c">BLI_edgehash_free</a>(ehash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00294"></a>00294     <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a14b3a8c9081b5a9c40edd7294856c45c">BLI_edgehash_free</a>(seamhash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="keywordflow">if</span> (mode == 0 || mode == 2) {
<a name="l00297"></a>00297         <span class="keywordflow">for</span> (a = 0, mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>; a &lt; me-&gt;totpoly; a++, mp++)
<a name="l00298"></a>00298             <span class="keywordflow">if</span> (linkflag[a])
<a name="l00299"></a>00299                 mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00300"></a>00300             <span class="keywordflow">else</span>
<a name="l00301"></a>00301                 mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == 1) {
<a name="l00304"></a>00304         <span class="keywordflow">for</span> (a = 0, mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>; a &lt; me-&gt;totpoly; a++, mp++)
<a name="l00305"></a>00305             <span class="keywordflow">if</span> (linkflag[a] &amp;&amp; (mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>))
<a name="l00306"></a>00306                 <span class="keywordflow">break</span>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (a &lt; me-&gt;totpoly) {
<a name="l00309"></a>00309             <span class="keywordflow">for</span> (a = 0, mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>; a &lt; me-&gt;totpoly; a++, mp++)
<a name="l00310"></a>00310                 <span class="keywordflow">if</span> (linkflag[a])
<a name="l00311"></a>00311                     mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313         <span class="keywordflow">else</span> {
<a name="l00314"></a>00314             <span class="keywordflow">for</span> (a = 0, mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>; a &lt; me-&gt;totpoly; a++, mp++)
<a name="l00315"></a>00315                 <span class="keywordflow">if</span> (linkflag[a])
<a name="l00316"></a>00316                     mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(linkflag);
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="../../d9/d69/editface_8c.html#a6530b144fdd784ed6a08d146b300b2dc">00323</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#adff9e7d7dd2f0219d9988568f05a440f">paintface_select_linked</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mval[2]), <span class="keywordtype">int</span> mode)
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00326"></a>00326     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> == 0) <span class="keywordflow">return</span>;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordflow">if</span> (mode == 0 || mode == 1) {
<a name="l00332"></a>00332         <span class="comment">// XXX - Causes glitches, not sure why</span>
<a name="l00333"></a>00333 <span class="preprocessor">#if 0</span>
<a name="l00334"></a>00334 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/editface_8c.html#a73613ea950d713f18500f26abb77b6d7">facesel_face_pick</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, me, mval, &amp;index, 1))
<a name="l00335"></a>00335             <span class="keywordflow">return</span>;
<a name="l00336"></a>00336 <span class="preprocessor">#endif</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>    }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <a class="code" href="../../d9/d69/editface_8c.html#ab8100c56856cfd71738ebf232dbf2e3c">select_linked_tfaces_with_seams</a>(mode, me, index);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(ob);
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a><a class="code" href="../../d9/d69/editface_8c.html#a8f660f76c1f65ec4baac11b046ee225f">00344</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a53413fc666e9814acb138e78603937d8">paintface_deselect_all_visible</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> action, <span class="keywordtype">short</span> flush_flags)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00347"></a>00347     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mpoly;
<a name="l00348"></a>00348     <span class="keywordtype">int</span> a;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00352"></a>00352     
<a name="l00353"></a>00353     <span class="keywordflow">if</span> (action == <a class="code" href="../../d4/d7f/WM__api_8h.html#ac906797cc9a2787004c6ad16b8151913">SEL_INVERT</a>) {
<a name="l00354"></a>00354         mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00355"></a>00355         a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l00356"></a>00356         <span class="keywordflow">while</span> (a--) {
<a name="l00357"></a>00357             <span class="keywordflow">if</span> ((mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0) {
<a name="l00358"></a>00358                 mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> ^= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00359"></a>00359             }
<a name="l00360"></a>00360             mpoly++;
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363     <span class="keywordflow">else</span> {
<a name="l00364"></a>00364         <span class="keywordflow">if</span> (action == <a class="code" href="../../d4/d7f/WM__api_8h.html#a070b8f09bd544f3d0bd5786ca00cda02">SEL_TOGGLE</a>) {
<a name="l00365"></a>00365             action = <a class="code" href="../../d4/d7f/WM__api_8h.html#af76323cc5b70d4cbeca6b3887e166fb8">SEL_SELECT</a>;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367             mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00368"></a>00368             a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l00369"></a>00369             <span class="keywordflow">while</span> (a--) {
<a name="l00370"></a>00370                 <span class="keywordflow">if</span> ((mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0 &amp;&amp; mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>) {
<a name="l00371"></a>00371                     action = <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>;
<a name="l00372"></a>00372                     <span class="keywordflow">break</span>;
<a name="l00373"></a>00373                 }
<a name="l00374"></a>00374                 mpoly++;
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00379"></a>00379         a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l00380"></a>00380         <span class="keywordflow">while</span> (a--) {
<a name="l00381"></a>00381             <span class="keywordflow">if</span> ((mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0) {
<a name="l00382"></a>00382                 <span class="keywordflow">switch</span> (action) {
<a name="l00383"></a>00383                     <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#af76323cc5b70d4cbeca6b3887e166fb8">SEL_SELECT</a>:
<a name="l00384"></a>00384                         mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00385"></a>00385                         <span class="keywordflow">break</span>;
<a name="l00386"></a>00386                     <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>:
<a name="l00387"></a>00387                         mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00388"></a>00388                         <span class="keywordflow">break</span>;
<a name="l00389"></a>00389                     <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#ac906797cc9a2787004c6ad16b8151913">SEL_INVERT</a>:
<a name="l00390"></a>00390                         mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> ^= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00391"></a>00391                         <span class="keywordflow">break</span>;
<a name="l00392"></a>00392                 }
<a name="l00393"></a>00393             }
<a name="l00394"></a>00394             mpoly++;
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (flush_flags) {
<a name="l00399"></a>00399         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(ob);
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00403"></a><a class="code" href="../../d9/d69/editface_8c.html#ad6760bcff6cb5eddeed280e84b163f19">00403</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#af8c185155c3f178bbbb15e3158c1e068">paintface_minmax</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>)
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00406"></a>00406     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mp;
<a name="l00407"></a>00407     <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf;
<a name="l00408"></a>00408     <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *ml;
<a name="l00409"></a>00409     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *mvert;
<a name="l00410"></a>00410     <span class="keywordtype">int</span> a, b, ok = 0;
<a name="l00411"></a>00411     <span class="keywordtype">float</span> vec[3], bmat[3][3];
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00414"></a>00414     <span class="keywordflow">if</span> (!me || !me-&gt;<a class="code" href="../../da/d29/structMesh.html#a33e1a6e421ec6271ac147aea17092ec1">mtpoly</a>) <span class="keywordflow">return</span> ok;
<a name="l00415"></a>00415     
<a name="l00416"></a>00416     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(bmat, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     mvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>;
<a name="l00419"></a>00419     mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00420"></a>00420     tf = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a33e1a6e421ec6271ac147aea17092ec1">mtpoly</a>;
<a name="l00421"></a>00421     <span class="keywordflow">for</span> (a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>; a &gt; 0; a--, mp++, tf++) {
<a name="l00422"></a>00422         <span class="keywordflow">if</span> (mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a> || !(mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>))
<a name="l00423"></a>00423             <span class="keywordflow">continue</span>;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         ml = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a>;
<a name="l00426"></a>00426         <span class="keywordflow">for</span> (b = 0; b &lt; mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a>; b++, ml++) {
<a name="l00427"></a>00427             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, (mvert[ml-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>));
<a name="l00428"></a>00428             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(bmat, vec);
<a name="l00429"></a>00429             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(vec, vec, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l00430"></a>00430             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(vec, min, max);       
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         ok = 1;
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436     <span class="keywordflow">return</span> ok;
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="comment">/* *************************************** */</span>
<a name="l00440"></a>00440 <span class="preprocessor">#if 0</span>
<a name="l00441"></a>00441 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> seam_edgehash_insert_face(<a class="code" href="../../db/d6c/structEdgeHash.html">EdgeHash</a> *ehash, <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mp, <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *loopstart)
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443     <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *ml1, *ml2;
<a name="l00444"></a>00444     <span class="keywordtype">int</span> a;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">for</span> (a = 0; a &lt; mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a>; a++) {
<a name="l00447"></a>00447         ml1 = loopstart + a;
<a name="l00448"></a>00448         ml2 = loopstart + (a + 1) % mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a056a6dcc2dd557fc8b14db5aa6dfa8b0">totloop</a>;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a2e0f4e2b0d6efaccac6f6d7c595955eb">BLI_edgehash_insert</a>(ehash, ml1-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>, ml2-&gt;<a class="code" href="../../d7/d72/structMLoop.html#ae5aa5a4861aba2bd5145f0b2c4ab4412">v</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keywordtype">void</span> seam_mark_clear_tface(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">short</span> mode)
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00457"></a>00457     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mp;
<a name="l00458"></a>00458     <a class="code" href="../../d7/d72/structMLoop.html">MLoop</a> *ml1, *ml2;
<a name="l00459"></a>00459     <a class="code" href="../../d6/ded/structMEdge.html">MEdge</a> *med;
<a name="l00460"></a>00460     <span class="keywordtype">int</span> a, b;
<a name="l00461"></a>00461     
<a name="l00462"></a>00462     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>);
<a name="l00463"></a>00463     <span class="keywordflow">if</span> (me == 0 ||  me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> == 0) <span class="keywordflow">return</span>;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keywordflow">if</span> (mode == 0)
<a name="l00466"></a>00466         mode = <a class="code" href="../../d6/db5/object__edit_8c.html#a6f935fee7a3c6e413fac3693c8305992">pupmenu</a>(<span class="stringliteral">&quot;Seams%t|Mark Border Seam %x1|Clear Seam %x2&quot;</span>);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <span class="keywordflow">if</span> (mode != 1 &amp;&amp; mode != 2)
<a name="l00469"></a>00469         <span class="keywordflow">return</span>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (mode == 2) {
<a name="l00472"></a>00472         <a class="code" href="../../db/d6c/structEdgeHash.html">EdgeHash</a> *ehash = <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#aa74e7b101fe3c5b8acf0f169efdf0cfb">BLI_edgehash_new</a>();
<a name="l00473"></a>00473 
<a name="l00474"></a>00474         <span class="keywordflow">for</span> (a = 0, mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>; a &lt; me-&gt;totpoly; a++, mp++)
<a name="l00475"></a>00475             <span class="keywordflow">if</span> (!(mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) &amp;&amp; (mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>))
<a name="l00476"></a>00476                 seam_edgehash_insert_face(ehash, mp, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="keywordflow">for</span> (a = 0, med = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>; a &lt; me-&gt;totedge; a++, med++)
<a name="l00479"></a>00479             <span class="keywordflow">if</span> (<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a3c65288faeadad320694712e249bfeea">BLI_edgehash_haskey</a>(ehash, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>))
<a name="l00480"></a>00480                 med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a5c86d036e926ac7e671699d149a75da0">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a87e315b9b33dbdef3f54ab2f6e951e06">ME_SEAM</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a14b3a8c9081b5a9c40edd7294856c45c">BLI_edgehash_free</a>(ehash, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484     <span class="keywordflow">else</span> {
<a name="l00485"></a>00485         <span class="comment">/* mark edges that are on both selected and deselected faces */</span>
<a name="l00486"></a>00486         <a class="code" href="../../db/d6c/structEdgeHash.html">EdgeHash</a> *ehash1 = <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#aa74e7b101fe3c5b8acf0f169efdf0cfb">BLI_edgehash_new</a>();
<a name="l00487"></a>00487         <a class="code" href="../../db/d6c/structEdgeHash.html">EdgeHash</a> *ehash2 = <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#aa74e7b101fe3c5b8acf0f169efdf0cfb">BLI_edgehash_new</a>();
<a name="l00488"></a>00488 
<a name="l00489"></a>00489         <span class="keywordflow">for</span> (a = 0, mp = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>; a &lt; me-&gt;totpoly; a++, mp++) {
<a name="l00490"></a>00490             <span class="keywordflow">if</span> ((mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) || !(mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>))
<a name="l00491"></a>00491                 seam_edgehash_insert_face(ehash1, mp, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>);
<a name="l00492"></a>00492             <span class="keywordflow">else</span>
<a name="l00493"></a>00493                 seam_edgehash_insert_face(ehash2, mp, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a9ae8024c777dd16443d6fc13a8b30880">mloop</a> + mp-&gt;<a class="code" href="../../d2/dca/structMPoly.html#af553fa511f9a5475e5ff8cca8fa0b115">loopstart</a>);
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="keywordflow">for</span> (a = 0, med = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>; a &lt; me-&gt;totedge; a++, med++)
<a name="l00497"></a>00497             <span class="keywordflow">if</span> (<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a3c65288faeadad320694712e249bfeea">BLI_edgehash_haskey</a>(ehash1, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>) &amp;&amp;
<a name="l00498"></a>00498                 <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a3c65288faeadad320694712e249bfeea">BLI_edgehash_haskey</a>(ehash2, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>, med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>))
<a name="l00499"></a>00499                 med-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a5c86d036e926ac7e671699d149a75da0">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a87e315b9b33dbdef3f54ab2f6e951e06">ME_SEAM</a>;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a14b3a8c9081b5a9c40edd7294856c45c">BLI_edgehash_free</a>(ehash1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00502"></a>00502         <a class="code" href="../../d5/dfb/BLI__edgehash_8h.html#a14b3a8c9081b5a9c40edd7294856c45c">BLI_edgehash_free</a>(ehash2, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="comment">// XXX  if (G.rt == 8)</span>
<a name="l00506"></a>00506 <span class="comment">//      unwrap_lscm(1);</span>
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> |= <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#adacf5e88838f2b4f436a14bf1fb3802c">ME_DRAWSEAMS</a>;
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 <span class="preprocessor">#endif</span>
<a name="l00511"></a>00511 <span class="preprocessor"></span>
<a name="l00512"></a><a class="code" href="../../d9/d69/editface_8c.html#a11f8717d8a5ec5bcdb6366c5c0b8db6e">00512</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ae5ac8d79cba5e96bf6065647eb359639">paintface_mouse_select</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">int</span> extend)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00515"></a>00515     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mpoly, *mpoly_sel;
<a name="l00516"></a>00516     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a, index;
<a name="l00517"></a>00517     
<a name="l00518"></a>00518     <span class="comment">/* Get the face under the cursor */</span>
<a name="l00519"></a>00519     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d69/editface_8c.html#a73613ea950d713f18500f26abb77b6d7">facesel_face_pick</a>(C, me, ob, mval, &amp;index, 1))
<a name="l00522"></a>00522         <span class="keywordflow">return</span> 0;
<a name="l00523"></a>00523     
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (index &gt;= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> || index &lt; 0)
<a name="l00525"></a>00525         <span class="keywordflow">return</span> 0;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     mpoly_sel = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> + index;
<a name="l00528"></a>00528     <span class="keywordflow">if</span> (mpoly_sel-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) <span class="keywordflow">return</span> 0;
<a name="l00529"></a>00529     
<a name="l00530"></a>00530     <span class="comment">/* clear flags */</span>
<a name="l00531"></a>00531     mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00532"></a>00532     a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (!extend) {
<a name="l00534"></a>00534         <span class="keywordflow">while</span> (a--) {
<a name="l00535"></a>00535             mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00536"></a>00536             mpoly++;
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539     
<a name="l00540"></a>00540     me-&gt;<a class="code" href="../../da/d29/structMesh.html#a78559d754c4de82856ae572ac05e04af">act_face</a> = (int)index;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (extend) {
<a name="l00543"></a>00543         <span class="keywordflow">if</span> (mpoly_sel-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>)
<a name="l00544"></a>00544             mpoly_sel-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00545"></a>00545         <span class="keywordflow">else</span>
<a name="l00546"></a>00546             mpoly_sel-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="keywordflow">else</span> mpoly_sel-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00549"></a>00549     
<a name="l00550"></a>00550     <span class="comment">/* image window redraw */</span>
<a name="l00551"></a>00551     
<a name="l00552"></a>00552     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(ob);
<a name="l00553"></a>00553     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00554"></a>00554     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C)); <span class="comment">// XXX - should redraw all 3D views</span>
<a name="l00555"></a>00555     <span class="keywordflow">return</span> 1;
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a><a class="code" href="../../d9/d69/editface_8c.html#a3a6c16a13adac1f46cb94fc4f4902d0f">00558</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a4be41e294de1f6754d16f444371539cf">do_paintface_box_select</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *rect, <span class="keywordtype">int</span> select, <span class="keywordtype">int</span> extend)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>;
<a name="l00561"></a>00561     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00562"></a>00562     <a class="code" href="../../d2/dca/structMPoly.html">MPoly</a> *mpoly;
<a name="l00563"></a>00563     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf;
<a name="l00564"></a>00564     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rt;
<a name="l00565"></a>00565     <span class="keywordtype">char</span> *selar;
<a name="l00566"></a>00566     <span class="keywordtype">int</span> a, <a class="code" href="../../d3/dd9/structImBuf.html#ab8d52a453c4886f4fe00230c6387f964">index</a>;
<a name="l00567"></a>00567     <span class="keywordtype">int</span> sx = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> + 1;
<a name="l00568"></a>00568     <span class="keywordtype">int</span> sy = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> + 1;
<a name="l00569"></a>00569     
<a name="l00570"></a>00570     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> == 0 || sx * sy &lt;= 0)
<a name="l00573"></a>00573         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575     selar = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> + 1, <span class="stringliteral">&quot;selar&quot;</span>);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <span class="keywordflow">if</span> (extend == 0 &amp;&amp; select) {
<a name="l00578"></a>00578         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a53413fc666e9814acb138e78603937d8">paintface_deselect_all_visible</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>, <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580         mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00581"></a>00581         <span class="keywordflow">for</span> (a = 1; a &lt;= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>; a++, mpoly++) {
<a name="l00582"></a>00582             <span class="keywordflow">if</span> ((mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0)
<a name="l00583"></a>00583                 mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a679f6c1cdac2d683e9bdbf2d1ecb8ba8">view3d_validate_backbuf</a>(vc);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     ibuf = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a439680f7777db0973e76f25001cff0cd">IMB_allocImBuf</a>(sx, sy, 32, <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>);
<a name="l00590"></a>00590     rt = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>;
<a name="l00591"></a>00591     glReadPixels(rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> + vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>,  rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> + vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>, sx, sy, GL_RGBA, GL_UNSIGNED_BYTE,  ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>);
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/BKE__global_8h.html#ab29b2916516ef2ec36d2f8f85ae20a78">ENDIAN_ORDER</a> == <a class="code" href="../../d1/d8c/BKE__global_8h.html#a497f70c46327d9156e6cf4d2d77a4500">B_ENDIAN</a>) <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aadf6bf75e8af0e36aae058351ad1ac72">IMB_convert_rgba_to_abgr</a>(ibuf);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     a = sx * sy;
<a name="l00595"></a>00595     <span class="keywordflow">while</span> (a--) {
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (*rt) {
<a name="l00597"></a>00597             index = <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a9ee3b53c087965dadbc7b770ffc56100">WM_framebuffer_to_index</a>(*rt);
<a name="l00598"></a>00598             <span class="keywordflow">if</span> (index &lt;= me-&gt;totpoly) selar[<a class="code" href="../../d3/dd9/structImBuf.html#ab8d52a453c4886f4fe00230c6387f964">index</a>] = 1;
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         rt++;
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     mpoly = me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l00604"></a>00604     <span class="keywordflow">for</span> (a = 1; a &lt;= me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>; a++, mpoly++) {
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (selar[a]) {
<a name="l00606"></a>00606             <span class="keywordflow">if</span> (mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) ;
<a name="l00607"></a>00607             <span class="keywordflow">else</span> {
<a name="l00608"></a>00608                 <span class="keywordflow">if</span> (select) mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> |= <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00609"></a>00609                 <span class="keywordflow">else</span> mpoly-&gt;<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp;= ~<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a893637457f3055c76b2bddc12f1b5d52">ME_FACE_SEL</a>;
<a name="l00610"></a>00610             }
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(ibuf);
<a name="l00615"></a>00615     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(selar);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="preprocessor">#ifdef __APPLE__    </span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>    glReadBuffer(GL_BACK);
<a name="l00619"></a>00619 <span class="preprocessor">#endif</span>
<a name="l00620"></a>00620 <span class="preprocessor"></span>
<a name="l00621"></a>00621     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a60bd345d0f1d382738033690415f61d7">paintface_flush_flags</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 <span class="comment">/*  (similar to void paintface_flush_flags(Object *ob))</span>
<a name="l00628"></a>00628 <span class="comment"> * copy the vertex flags, most importantly selection from the mesh to the final derived mesh,</span>
<a name="l00629"></a>00629 <span class="comment"> * use in object mode when selecting vertices (while painting) */</span>
<a name="l00630"></a><a class="code" href="../../d9/d69/editface_8c.html#a48cab2235e000924a735a6a6eecc399f">00630</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8a53b21bbd56d32fdec74fe5e3e61d64">paintvert_flush_flags</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00631"></a>00631 {
<a name="l00632"></a>00632     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00633"></a>00633     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>;
<a name="l00634"></a>00634     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *dm_mvert, *dm_mv;
<a name="l00635"></a>00635     <span class="keywordtype">int</span> *index_array = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00636"></a>00636     <span class="keywordtype">int</span> totvert;
<a name="l00637"></a>00637     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || dm == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00640"></a>00640         <span class="keywordflow">return</span>;
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     index_array = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#aac2f1d3ce8a7a1a66926e1d295707e67">getVertDataArray</a>(dm, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5e2cdbe47f447a68d43a9410d8c42100">CD_ORIGINDEX</a>);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     dm_mvert = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#adf25b9f9aee2bb3846fe2d0c4a2ab1d4">getVertArray</a>(dm);
<a name="l00645"></a>00645     totvert = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3d5c5a506b0705a9071680807da2e7ee">getNumVerts</a>(dm);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     dm_mv = dm_mvert;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (index_array) {
<a name="l00650"></a>00650         <span class="keywordtype">int</span> orig_index;
<a name="l00651"></a>00651         <span class="keywordflow">for</span> (i = 0; i &lt; totvert; i++, dm_mv++) {
<a name="l00652"></a>00652             orig_index = index_array[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00653"></a>00653             <span class="keywordflow">if</span> (orig_index != <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a9c45061d42a9d82ed1a425e2b997c200">ORIGINDEX_NONE</a>) {
<a name="l00654"></a>00654                 dm_mv-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>[index_array[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]].<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a>;
<a name="l00655"></a>00655             }
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658     <span class="keywordflow">else</span> {
<a name="l00659"></a>00659         <span class="keywordflow">for</span> (i = 0; i &lt; totvert; i++, dm_mv++) {
<a name="l00660"></a>00660             dm_mv-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a>;
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 <span class="comment">/*  note: if the caller passes FALSE to flush_flags, then they will need to run paintvert_flush_flags(ob) themselves */</span>
<a name="l00665"></a><a class="code" href="../../d9/d69/editface_8c.html#a88e549b9c08a0928f6aff4c2cc5b7c4e">00665</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#adf270cc1ffd81c0d4dd8e38e9b49e9d3">paintvert_deselect_all_visible</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> action, <span class="keywordtype">short</span> flush_flags)
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l00668"></a>00668     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *mvert;
<a name="l00669"></a>00669     <span class="keywordtype">int</span> a;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     me = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a80d6c41e95a49af12ddf2f2b48dc659d">get_mesh</a>(ob);
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (me == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00673"></a>00673     
<a name="l00674"></a>00674     <span class="keywordflow">if</span> (action == <a class="code" href="../../d4/d7f/WM__api_8h.html#ac906797cc9a2787004c6ad16b8151913">SEL_INVERT</a>) {
<a name="l00675"></a>00675         mvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>;
<a name="l00676"></a>00676         a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>;
<a name="l00677"></a>00677         <span class="keywordflow">while</span> (a--) {
<a name="l00678"></a>00678             <span class="keywordflow">if</span> ((mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0) {
<a name="l00679"></a>00679                 mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l00680"></a>00680             }
<a name="l00681"></a>00681             mvert++;
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684     <span class="keywordflow">else</span> {
<a name="l00685"></a>00685         <span class="keywordflow">if</span> (action == <a class="code" href="../../d4/d7f/WM__api_8h.html#a070b8f09bd544f3d0bd5786ca00cda02">SEL_TOGGLE</a>) {
<a name="l00686"></a>00686             action = <a class="code" href="../../d4/d7f/WM__api_8h.html#af76323cc5b70d4cbeca6b3887e166fb8">SEL_SELECT</a>;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688             mvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>;
<a name="l00689"></a>00689             a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>;
<a name="l00690"></a>00690             <span class="keywordflow">while</span> (a--) {
<a name="l00691"></a>00691                 <span class="keywordflow">if</span> ((mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0 &amp;&amp; mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l00692"></a>00692                     action = <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>;
<a name="l00693"></a>00693                     <span class="keywordflow">break</span>;
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695                 mvert++;
<a name="l00696"></a>00696             }
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699         mvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>;
<a name="l00700"></a>00700         a = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>;
<a name="l00701"></a>00701         <span class="keywordflow">while</span> (a--) {
<a name="l00702"></a>00702             <span class="keywordflow">if</span> ((mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>) == 0) {
<a name="l00703"></a>00703                 <span class="keywordflow">switch</span> (action) {
<a name="l00704"></a>00704                     <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#af76323cc5b70d4cbeca6b3887e166fb8">SEL_SELECT</a>:
<a name="l00705"></a>00705                         mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l00706"></a>00706                         <span class="keywordflow">break</span>;
<a name="l00707"></a>00707                     <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>:
<a name="l00708"></a>00708                         mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp;= ~<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l00709"></a>00709                         <span class="keywordflow">break</span>;
<a name="l00710"></a>00710                     <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#ac906797cc9a2787004c6ad16b8151913">SEL_INVERT</a>:
<a name="l00711"></a>00711                         mvert-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l00712"></a>00712                         <span class="keywordflow">break</span>;
<a name="l00713"></a>00713                 }
<a name="l00714"></a>00714             }
<a name="l00715"></a>00715             mvert++;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719     <span class="keywordflow">if</span> (flush_flags) {
<a name="l00720"></a>00720         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a8a53b21bbd56d32fdec74fe5e3e61d64">paintvert_flush_flags</a>(ob);
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="comment">/* ********************* MESH VERTEX MIRR TOPO LOOKUP *************** */</span>
<a name="l00726"></a>00726 <span class="comment">/* note, this is not the best place for the function to be but moved</span>
<a name="l00727"></a>00727 <span class="comment"> * here to for the purpose of syncing with bmesh */</span>
<a name="l00728"></a>00728 
<a name="l00729"></a><a class="code" href="../../d9/d69/editface_8c.html#ae160893ba96e623b98816ef25d7e5124">00729</a> <span class="keyword">typedef</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d69/editface_8c.html#ae160893ba96e623b98816ef25d7e5124">MirrTopoHash_t</a>;
<a name="l00730"></a>00730 
<a name="l00731"></a><a class="code" href="../../d1/dad/structMirrTopoVert__t.html">00731</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a> {
<a name="l00732"></a><a class="code" href="../../d1/dad/structMirrTopoVert__t.html#afb314cfbb27754ebe8e22d7bc63df7c0">00732</a>     MirrTopoHash_t <a class="code" href="../../d1/dad/structMirrTopoVert__t.html#afb314cfbb27754ebe8e22d7bc63df7c0">hash</a>;
<a name="l00733"></a><a class="code" href="../../d1/dad/structMirrTopoVert__t.html#a697f66f32e6129b9b2006c86073b7729">00733</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/dad/structMirrTopoVert__t.html#a697f66f32e6129b9b2006c86073b7729">v_index</a>;
<a name="l00734"></a>00734 } <a class="code" href="../../d9/d69/editface_8c.html#af6fa3c0c39a16a6f0c9248311421e297">MirrTopoVert_t</a>;
<a name="l00735"></a>00735 
<a name="l00736"></a><a class="code" href="../../d9/d69/editface_8c.html#a4577eb01a27fe1e0e44dc80b509f82a8">00736</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d69/editface_8c.html#a4577eb01a27fe1e0e44dc80b509f82a8">mirrtopo_hash_sort</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *l1, <span class="keyword">const</span> <span class="keywordtype">void</span> *l2)
<a name="l00737"></a>00737 {
<a name="l00738"></a>00738     <span class="keywordflow">if</span>      ((MirrTopoHash_t)(intptr_t)l1 &gt; (MirrTopoHash_t)(intptr_t)l2) <span class="keywordflow">return</span> 1;
<a name="l00739"></a>00739     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((MirrTopoHash_t)(intptr_t)l1 &lt; (MirrTopoHash_t)(intptr_t)l2) <span class="keywordflow">return</span> -1;
<a name="l00740"></a>00740     <span class="keywordflow">return</span> 0;
<a name="l00741"></a>00741 }
<a name="l00742"></a>00742 
<a name="l00743"></a><a class="code" href="../../d9/d69/editface_8c.html#a2aa1531c11f7dad070c38d1a6e7e348d">00743</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d69/editface_8c.html#a2aa1531c11f7dad070c38d1a6e7e348d">mirrtopo_vert_sort</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *v1, <span class="keyword">const</span> <span class="keywordtype">void</span> *v2)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745     <span class="keywordflow">if</span>      (((<a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a> *)v1)-&gt;<a class="code" href="../../dd/d05/noise_8c.html#a3525fa37a20c01dcef02177785596cd9">hash</a> &gt; ((<a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a> *)v2)-&gt;<a class="code" href="../../dd/d05/noise_8c.html#a3525fa37a20c01dcef02177785596cd9">hash</a>) <span class="keywordflow">return</span> 1;
<a name="l00746"></a>00746     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a> *)v1)-&gt;<a class="code" href="../../dd/d05/noise_8c.html#a3525fa37a20c01dcef02177785596cd9">hash</a> &lt; ((<a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a> *)v2)-&gt;<a class="code" href="../../dd/d05/noise_8c.html#a3525fa37a20c01dcef02177785596cd9">hash</a>) <span class="keywordflow">return</span> -1;
<a name="l00747"></a>00747     <span class="keywordflow">return</span> 0;
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 
<a name="l00750"></a><a class="code" href="../../d9/d69/editface_8c.html#a38a37f90dddf16c96a015c34f0dbb202">00750</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a3deb2f74fb42f4c98454c49abdec8cd9">ED_mesh_mirrtopo_recalc_check</a>(<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <span class="keyword">const</span> <span class="keywordtype">int</span> ob_mode, <a class="code" href="../../db/d5d/structMirrTopoStore__t.html">MirrTopoStore_t</a> *<a class="code" href="../../d7/d35/meshtools_8c.html#a8786d5aea96d17aa2a4346749a1d1807">mesh_topo_store</a>)
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752     <span class="keywordtype">int</span> totvert;
<a name="l00753"></a>00753     <span class="keywordtype">int</span> totedge;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>) {
<a name="l00756"></a>00756         totvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>;
<a name="l00757"></a>00757         totedge = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3f12552bb4c91af433df2e26260ac672">totedge</a>;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759     <span class="keywordflow">else</span> {
<a name="l00760"></a>00760         totvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>;
<a name="l00761"></a>00761         totedge = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a686df37ba278d2bdc080e4d5a0f70dd5">totedge</a>;
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     <span class="keywordflow">if</span> ((mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a054f4fb9ba516f11630cb85a1a783c19">index_lookup</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l00765"></a>00765         (mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a213977e7bacb06c61f871fb241e0b178">prev_ob_mode</a> != ob_mode) ||
<a name="l00766"></a>00766         (totvert != mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#af09163ba310ef3f88c210ae8ac75779c">prev_vert_tot</a>) ||
<a name="l00767"></a>00767         (totedge != mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#ab4ae6463d79d5bd969925036584dca76">prev_edge_tot</a>))
<a name="l00768"></a>00768     {
<a name="l00769"></a>00769         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771     <span class="keywordflow">else</span> {
<a name="l00772"></a>00772         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a><a class="code" href="../../d9/d69/editface_8c.html#ace1c07e15155d19a829f8e5fab7c8054">00777</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a59f430bdd02e0b8160d247f3b974abad">ED_mesh_mirrtopo_init</a>(<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <span class="keyword">const</span> <span class="keywordtype">int</span> ob_mode, <a class="code" href="../../db/d5d/structMirrTopoStore__t.html">MirrTopoStore_t</a> *<a class="code" href="../../d7/d35/meshtools_8c.html#a8786d5aea96d17aa2a4346749a1d1807">mesh_topo_store</a>,
<a name="l00778"></a>00778                            <span class="keyword">const</span> <span class="keywordtype">short</span> skip_em_vert_array_init)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780     <a class="code" href="../../d6/ded/structMEdge.html">MEdge</a> *medge;
<a name="l00781"></a>00781     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="comment">/* editmode*/</span>
<a name="l00784"></a>00784     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed;
<a name="l00785"></a>00785     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="keywordtype">int</span> a, last;
<a name="l00788"></a>00788     <span class="keywordtype">int</span> totvert, totedge;
<a name="l00789"></a>00789     <span class="keywordtype">int</span> tot_unique = -1, tot_unique_prev = -1;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     MirrTopoHash_t *topo_hash = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00792"></a>00792     MirrTopoHash_t *topo_hash_prev = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00793"></a>00793     <a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a> *topo_pairs;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     intptr_t *index_lookup; <span class="comment">/* direct access to mesh_topo_store-&gt;index_lookup */</span>
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="comment">/* reallocate if needed */</span>
<a name="l00798"></a>00798     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a9530ab6c17a68f34b530f074bb7dd66f">ED_mesh_mirrtopo_free</a>(mesh_topo_store);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a213977e7bacb06c61f871fb241e0b178">prev_ob_mode</a> = ob_mode;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     <span class="keywordflow">if</span> (em) {
<a name="l00803"></a>00803         <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#af3c1d0fa5b86a3ce17293fff3d2d0fcd">BM_mesh_elem_index_ensure</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a>);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805         totvert = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>;
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807     <span class="keywordflow">else</span> {
<a name="l00808"></a>00808         totvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>;
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811     topo_hash = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(totvert * <span class="keyword">sizeof</span>(MirrTopoHash_t), <span class="stringliteral">&quot;TopoMirr&quot;</span>);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="comment">/* Initialize the vert-edge-user counts used to detect unique topology */</span>
<a name="l00814"></a>00814     <span class="keywordflow">if</span> (em) {
<a name="l00815"></a>00815         totedge = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3f12552bb4c91af433df2e26260ac672">totedge</a>;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (eed, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l00818"></a>00818             topo_hash[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>)]++;
<a name="l00819"></a>00819             topo_hash[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>)]++;
<a name="l00820"></a>00820         }
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822     <span class="keywordflow">else</span> {
<a name="l00823"></a>00823         totedge = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a686df37ba278d2bdc080e4d5a0f70dd5">totedge</a>;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825         <span class="keywordflow">for</span> (a = 0, medge = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>; a &lt; me-&gt;totedge; a++, medge++) {
<a name="l00826"></a>00826             topo_hash[medge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>]++;
<a name="l00827"></a>00827             topo_hash[medge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>]++;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     topo_hash_prev = <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(topo_hash);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     tot_unique_prev = -1;
<a name="l00834"></a>00834     <span class="keywordflow">while</span> (1) {
<a name="l00835"></a>00835         <span class="comment">/* use the number of edges per vert to give verts unique topology IDs */</span>
<a name="l00836"></a>00836 
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (em) {
<a name="l00838"></a>00838             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (eed, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l00839"></a>00839                 topo_hash[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>)] += topo_hash_prev[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>)];
<a name="l00840"></a>00840                 topo_hash[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>)] += topo_hash_prev[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>)];
<a name="l00841"></a>00841             }
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843         <span class="keywordflow">else</span> {
<a name="l00844"></a>00844             <span class="keywordflow">for</span> (a = 0, medge = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a06722494d8fa0bf3af4b2d2b490da8dc">medge</a>; a &lt; me-&gt;totedge; a++, medge++) {
<a name="l00845"></a>00845                 <span class="comment">/* This can make really big numbers, wrapping around here is fine */</span>
<a name="l00846"></a>00846                 topo_hash[medge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>] += topo_hash_prev[medge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>];
<a name="l00847"></a>00847                 topo_hash[medge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>] += topo_hash_prev[medge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>];
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850         memcpy(topo_hash_prev, topo_hash, <span class="keyword">sizeof</span>(MirrTopoHash_t) * totvert);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852         <span class="comment">/* sort so we can count unique values */</span>
<a name="l00853"></a>00853         qsort(topo_hash_prev, totvert, <span class="keyword">sizeof</span>(MirrTopoHash_t), <a class="code" href="../../d9/d69/editface_8c.html#a4577eb01a27fe1e0e44dc80b509f82a8">mirrtopo_hash_sort</a>);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         tot_unique = 1; <span class="comment">/* account for skiping the first value */</span>
<a name="l00856"></a>00856         <span class="keywordflow">for</span> (a = 1; a &lt; totvert; a++) {
<a name="l00857"></a>00857             <span class="keywordflow">if</span> (topo_hash_prev[a - 1] != topo_hash_prev[a]) {
<a name="l00858"></a>00858                 tot_unique++;
<a name="l00859"></a>00859             }
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862         <span class="keywordflow">if</span> (tot_unique &lt;= tot_unique_prev) {
<a name="l00863"></a>00863             <span class="comment">/* Finish searching for unique valus when 1 loop dosnt give a</span>
<a name="l00864"></a>00864 <span class="comment">             * higher number of unique values compared to the previous loop */</span>
<a name="l00865"></a>00865             <span class="keywordflow">break</span>;
<a name="l00866"></a>00866         }
<a name="l00867"></a>00867         <span class="keywordflow">else</span> {
<a name="l00868"></a>00868             tot_unique_prev = tot_unique;
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870         <span class="comment">/* Copy the hash calculated this iter, so we can use them next time */</span>
<a name="l00871"></a>00871         memcpy(topo_hash_prev, topo_hash, <span class="keyword">sizeof</span>(MirrTopoHash_t) * totvert);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <span class="comment">/* Hash/Index pairs are needed for sorting to find index pairs */</span>
<a name="l00875"></a>00875     topo_pairs = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a>) * totvert, <span class="stringliteral">&quot;MirrTopoPairs&quot;</span>);
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <span class="comment">/* since we are looping through verts, initialize these values here too */</span>
<a name="l00878"></a>00878     index_lookup = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(totvert * <span class="keyword">sizeof</span>(*index_lookup), <span class="stringliteral">&quot;mesh_topo_lookup&quot;</span>);
<a name="l00879"></a>00879 
<a name="l00880"></a>00880     <span class="keywordflow">if</span> (em) {
<a name="l00881"></a>00881         <span class="keywordflow">if</span> (skip_em_vert_array_init == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00882"></a>00882             <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(em, 1, 0, 0);
<a name="l00883"></a>00883         }
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 
<a name="l00887"></a>00887     <span class="keywordflow">for</span> (a = 0; a &lt; totvert; a++) {
<a name="l00888"></a>00888         topo_pairs[a].<a class="code" href="../../d1/dad/structMirrTopoVert__t.html#afb314cfbb27754ebe8e22d7bc63df7c0">hash</a>    = topo_hash[a];
<a name="l00889"></a>00889         topo_pairs[a].<a class="code" href="../../d1/dad/structMirrTopoVert__t.html#a697f66f32e6129b9b2006c86073b7729">v_index</a> = a;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         <span class="comment">/* initialize lookup */</span>
<a name="l00892"></a>00892         index_lookup[a] = -1;
<a name="l00893"></a>00893     }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     qsort(topo_pairs, totvert, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/dad/structMirrTopoVert__t.html">MirrTopoVert_t</a>), <a class="code" href="../../d9/d69/editface_8c.html#a2aa1531c11f7dad070c38d1a6e7e348d">mirrtopo_vert_sort</a>);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="comment">/* Since the loop starts at 2, we must define the last index where the hash&#39;s differ */</span>
<a name="l00898"></a>00898     last = ((totvert &gt;= 2) &amp;&amp; (topo_pairs[0].<a class="code" href="../../dd/d05/noise_8c.html#a3525fa37a20c01dcef02177785596cd9">hash</a> == topo_pairs[1].<a class="code" href="../../dd/d05/noise_8c.html#a3525fa37a20c01dcef02177785596cd9">hash</a>)) ? 0 : 1;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900     <span class="comment">/* Get the pairs out of the sorted hashes, note, totvert+1 means we can use the previous 2,</span>
<a name="l00901"></a>00901 <span class="comment">     * but you cant ever access the last &#39;a&#39; index of MirrTopoPairs */</span>
<a name="l00902"></a>00902     <span class="keywordflow">for</span> (a = 2; a &lt;= totvert; a++) {
<a name="l00903"></a>00903         <span class="comment">/* printf(&quot;I %d %ld %d\n&quot;, (a-last), MirrTopoPairs[a  ].hash, MirrTopoPairs[a  ].v_index ); */</span>
<a name="l00904"></a>00904         <span class="keywordflow">if</span> ((a == totvert) || (topo_pairs[a - 1].<a class="code" href="../../d1/dad/structMirrTopoVert__t.html#afb314cfbb27754ebe8e22d7bc63df7c0">hash</a> != topo_pairs[a].<a class="code" href="../../d1/dad/structMirrTopoVert__t.html#afb314cfbb27754ebe8e22d7bc63df7c0">hash</a>)) {
<a name="l00905"></a>00905             <span class="keywordflow">if</span> (a - last == 2) {
<a name="l00906"></a>00906                 <span class="keywordflow">if</span> (em) {
<a name="l00907"></a>00907                     index_lookup[topo_pairs[a - 1].<a class="code" href="../../d1/dad/structMirrTopoVert__t.html#a697f66f32e6129b9b2006c86073b7729">v_index</a>] = (intptr_t)<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(em, topo_pairs[a - 2].v_index);
<a name="l00908"></a>00908                     index_lookup[topo_pairs[a - 2].v_index] = (intptr_t)<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(em, topo_pairs[a - 1].v_index);
<a name="l00909"></a>00909                 }
<a name="l00910"></a>00910                 <span class="keywordflow">else</span> {
<a name="l00911"></a>00911                     index_lookup[topo_pairs[a - 1].<a class="code" href="../../d1/dad/structMirrTopoVert__t.html#a697f66f32e6129b9b2006c86073b7729">v_index</a>] = topo_pairs[a - 2].v_index;
<a name="l00912"></a>00912                     index_lookup[topo_pairs[a - 2].v_index] = topo_pairs[a - 1].v_index;
<a name="l00913"></a>00913                 }
<a name="l00914"></a>00914             }
<a name="l00915"></a>00915             last = a;
<a name="l00916"></a>00916         }
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (em) {
<a name="l00919"></a>00919         <span class="keywordflow">if</span> (skip_em_vert_array_init == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00920"></a>00920             <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l00921"></a>00921         }
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(topo_pairs);
<a name="l00925"></a>00925     topo_pairs = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(topo_hash);
<a name="l00928"></a>00928     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(topo_hash_prev);
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a054f4fb9ba516f11630cb85a1a783c19">index_lookup</a>  = index_lookup;
<a name="l00931"></a>00931     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#af09163ba310ef3f88c210ae8ac75779c">prev_vert_tot</a> = totvert;
<a name="l00932"></a>00932     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#ab4ae6463d79d5bd969925036584dca76">prev_edge_tot</a> = totedge;
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a><a class="code" href="../../d9/d69/editface_8c.html#a9530ab6c17a68f34b530f074bb7dd66f">00935</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a9530ab6c17a68f34b530f074bb7dd66f">ED_mesh_mirrtopo_free</a>(<a class="code" href="../../db/d5d/structMirrTopoStore__t.html">MirrTopoStore_t</a> *<a class="code" href="../../d7/d35/meshtools_8c.html#a8786d5aea96d17aa2a4346749a1d1807">mesh_topo_store</a>)
<a name="l00936"></a>00936 {
<a name="l00937"></a>00937     <span class="keywordflow">if</span> (mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a054f4fb9ba516f11630cb85a1a783c19">index_lookup</a>) {
<a name="l00938"></a>00938         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a054f4fb9ba516f11630cb85a1a783c19">index_lookup</a>);
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#a054f4fb9ba516f11630cb85a1a783c19">index_lookup</a>  = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00941"></a>00941     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#af09163ba310ef3f88c210ae8ac75779c">prev_vert_tot</a> = -1;
<a name="l00942"></a>00942     mesh_topo_store-&gt;<a class="code" href="../../db/d5d/structMirrTopoStore__t.html#ab4ae6463d79d5bd969925036584dca76">prev_edge_tot</a> = -1;
<a name="l00943"></a>00943 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:16 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

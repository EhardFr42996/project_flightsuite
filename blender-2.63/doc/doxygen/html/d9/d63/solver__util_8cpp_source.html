<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: solver_util.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">solver_util.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d9/d63/solver__util_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - Free Surface Fluid Simulation with the Lattice Boltzmann Method</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Standard LBM Factory implementation</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *****************************************************************************/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d24/solver__class_8h.html">solver_class.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d75/solver__relax_8h.html">solver_relax.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d69/particletracer_8h.html">particletracer.h</a>&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">// MPT</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d8d/ntl__world_8h.html">ntl_world.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/db9/simulation__object_8h.html">simulation_object.h</a>&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;zlib.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#ifndef sqrtf</span>
<a name="l00024"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a3d93f9727a460ef2670f5cfd91029fc6">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define sqrtf sqrt</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="comment">/******************************************************************************</span>
<a name="l00028"></a>00028 <span class="comment"> * helper functions</span>
<a name="l00029"></a>00029 <span class="comment"> *****************************************************************************/</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// try to enhance surface?</span>
<a name="l00032"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a1e6a1ed954dee421d708ae593b9ae709">00032</a> <span class="preprocessor">#define SURFACE_ENH 2</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a8557d7859f8e6298ad044884ae8212f1">glob_mpactive</a>;
<a name="l00035"></a>00035 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a>;
<a name="l00036"></a>00036 <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a>;
<a name="l00037"></a>00037 
<a name="l00039"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a392e35e14aa1e21488853086c0a50ff1">00039</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a392e35e14aa1e21488853086c0a50ff1" title="for raytracing, preprocess">LbmFsgrSolver::prepareVisualization</a>( <span class="keywordtype">void</span> ) {
<a name="l00040"></a>00040     <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00041"></a>00041     <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043     <span class="keywordtype">int</span> mainGravDir=6; <span class="comment">// if normalizing fails, we asume z-direction gravity</span>
<a name="l00044"></a>00044     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> mainGravLen = 0.;
<a name="l00045"></a>00045     <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a>{
<a name="l00046"></a>00046         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> thisGravLen = <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l],<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l],<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l]), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].gravity ); 
<a name="l00047"></a>00047         <span class="keywordflow">if</span>(thisGravLen&gt;mainGravLen) {
<a name="l00048"></a>00048             mainGravLen = thisGravLen;
<a name="l00049"></a>00049             mainGravDir = l;
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051     }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#if LBMDIM==2</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>    <span class="comment">// 2d, place in the middle of isofield slice (k=2)</span>
<a name="l00055"></a>00055 <span class="preprocessor">#  define ZKD1 0</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>    <span class="comment">// 2d z offset = 2, lbmGetData adds 1, so use one here</span>
<a name="l00057"></a>00057 <span class="preprocessor">#  define ZKOFF 1</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>    <span class="comment">// reset all values...</span>
<a name="l00059"></a>00059     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= 0; k&lt; 5; ++k) 
<a name="l00060"></a>00060    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++) 
<a name="l00061"></a>00061     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00062"></a>00062         *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>)=0.0;
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064 <span class="preprocessor">#else // LBMDIM==2</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>    <span class="comment">// 3d, use normal bounds</span>
<a name="l00066"></a>00066 <span class="preprocessor">#  define ZKD1 1</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#  define ZKOFF k</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>    <span class="comment">// reset all values...</span>
<a name="l00069"></a>00069     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev); ++k) 
<a name="l00070"></a>00070    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++) 
<a name="l00071"></a>00071     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00072"></a>00072         *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>)=0.0;
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074 <span class="preprocessor">#endif // LBMDIM==2</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076     <span class="comment">// MPT, ignore</span>
<a name="l00077"></a>00077     <span class="keywordflow">if</span>((<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a8557d7859f8e6298ad044884ae8212f1">glob_mpactive</a>) &amp;&amp; (<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#ab6ff78cb4ce2a353f47a92a3c21018f8">glob_mpnum</a>&gt;1) &amp;&amp; (<a class="code" href="../../d4/d97/ntl__blenderdumper_8cpp.html#a3b6d65f6326c7f625f30ff37ae4e3ead">glob_mpindex</a>==0)) {
<a name="l00078"></a>00078         <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ac2cd4816d36191b6113c36435dd2aa8d">resetAll</a>(0.);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> minval = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a>*1.05; <span class="comment">// / mIsoWeight[13]; </span>
<a name="l00083"></a>00083     <span class="comment">// add up...</span>
<a name="l00084"></a>00084     <span class="keywordtype">float</span> val = 0.0;
<a name="l00085"></a>00085     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(lev); ++k) 
<a name="l00086"></a>00086    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++) 
<a name="l00087"></a>00087     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00088"></a>00088             <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> cflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet);
<a name="l00089"></a>00089             <span class="comment">//if(cflag&amp;(CFBnd|CFEmpty)) {</span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="preprocessor">#if SURFACE_ENH==0</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093             <span class="comment">// no enhancements...</span>
<a name="l00094"></a>00094             <span class="keywordflow">if</span>( (cflag&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>)) ) {
<a name="l00095"></a>00095                 val = 1.;
<a name="l00096"></a>00096             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( (cflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) ) {
<a name="l00097"></a>00097                 val = (<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>)); 
<a name="l00098"></a>00098             } <span class="keywordflow">else</span> {
<a name="l00099"></a>00099                 <span class="keywordflow">continue</span>;
<a name="l00100"></a>00100             }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="preprocessor">#else // SURFACE_ENH!=1</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>            <span class="keywordflow">if</span>(cflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>) {
<a name="l00104"></a>00104                 <span class="comment">// treated in second loop</span>
<a name="l00105"></a>00105                 <span class="keywordflow">continue</span>;
<a name="l00106"></a>00106             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>) {
<a name="l00107"></a>00107                 val = 1.;
<a name="l00108"></a>00108             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( (cflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) &amp;&amp; (cflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>)) {
<a name="l00109"></a>00109                 <span class="comment">// optimized fluid</span>
<a name="l00110"></a>00110                 val = 1.;
<a name="l00111"></a>00111             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( (cflag&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>|CFInter|CFFluid)) ) {
<a name="l00112"></a>00112                 <span class="keywordtype">int</span> noslipbnd = 0;
<a name="l00113"></a>00113                 <span class="keywordtype">int</span> intercnt = 0;
<a name="l00114"></a>00114                 <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { 
<a name="l00115"></a>00115                     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> nbflag = <a class="code" href="../../d1/d24/solver__class_8h.html#ab7241eb60f02ecd564250f80e7cd5f74">RFLAG_NB</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet,l);
<a name="l00116"></a>00116                     <span class="keywordflow">if</span>(nbflag&amp;CFInter){ intercnt++; }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                     <span class="comment">// check all directions otherwise we get bugs with splashes on obstacles</span>
<a name="l00119"></a>00119                     <span class="keywordflow">if</span>(l!=mainGravDir) <span class="keywordflow">continue</span>; <span class="comment">// only check bnd along main grav. dir</span>
<a name="l00120"></a>00120                     <span class="comment">//if((nbflag&amp;CFBnd)&amp;&amp;(nbflag&amp;CFBndNoslip)){ noslipbnd=1; }</span>
<a name="l00121"></a>00121                     <span class="keywordflow">if</span>((nbflag&amp;CFBnd)){ noslipbnd=1; }
<a name="l00122"></a>00122                 }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124                 <span class="keywordflow">if</span>(cflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>) {
<a name="l00125"></a>00125                     <span class="comment">// special empty treatment</span>
<a name="l00126"></a>00126                     <span class="keywordflow">if</span>((noslipbnd)&amp;&amp;(intercnt&gt;6)) {
<a name="l00127"></a>00127                         *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) += minval;
<a name="l00128"></a>00128                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((noslipbnd)&amp;&amp;(intercnt&gt;0)) {
<a name="l00129"></a>00129                         <span class="comment">// necessary?</span>
<a name="l00130"></a>00130                         *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) += <a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a>*0.9;
<a name="l00131"></a>00131                     } <span class="keywordflow">else</span> {
<a name="l00132"></a>00132                         <span class="comment">// nothing to do...</span>
<a name="l00133"></a>00133                     }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                     <span class="keywordflow">continue</span>;
<a name="l00136"></a>00136                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cflag&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a5ea9e718dc4beefcceab4d0b849e939c">CFNoNbEmpty</a>|CFFluid)) {
<a name="l00137"></a>00137                     <span class="comment">// no empty nb interface cells are treated as full</span>
<a name="l00138"></a>00138                     val=1.0;
<a name="l00139"></a>00139                 } <span class="keywordflow">else</span> {
<a name="l00140"></a>00140                     val = (<a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>)); 
<a name="l00141"></a>00141                 }
<a name="l00142"></a>00142                 
<a name="l00143"></a>00143                 <span class="keywordflow">if</span>(noslipbnd) {
<a name="l00144"></a>00144                     <span class="keywordflow">if</span>(val&lt;minval) val = minval; 
<a name="l00145"></a>00145                     *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) += minval-( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[13] ); 
<a name="l00146"></a>00146                 }
<a name="l00147"></a>00147             } <span class="keywordflow">else</span> { <span class="comment">// all others, unused?</span>
<a name="l00148"></a>00148                 <span class="keywordflow">continue</span>;
<a name="l00149"></a>00149             } 
<a name="l00150"></a>00150 <span class="preprocessor">#endif // SURFACE_ENH&gt;0</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00152"></a>00152             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j-1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[0] ); 
<a name="l00153"></a>00153             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j-1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[1] ); 
<a name="l00154"></a>00154             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j-1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[2] ); 
<a name="l00155"></a>00155 
<a name="l00156"></a>00156             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j   ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[3] ); 
<a name="l00157"></a>00157             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j   ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[4] ); 
<a name="l00158"></a>00158             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j   ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[5] ); 
<a name="l00159"></a>00159 
<a name="l00160"></a>00160             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j+1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[6] ); 
<a name="l00161"></a>00161             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j+1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[7] ); 
<a name="l00162"></a>00162             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j+1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>-<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[8] ); 
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j-1  ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[9] ); 
<a name="l00166"></a>00166             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j-1  ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[10] ); 
<a name="l00167"></a>00167             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j-1  ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[11] ); 
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j    ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[12] ); 
<a name="l00170"></a>00170             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j    ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[13] ); 
<a name="l00171"></a>00171             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j    ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[14] ); 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j+1  ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[15] ); 
<a name="l00174"></a>00174             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j+1  ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[16] ); 
<a name="l00175"></a>00175             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j+1  ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>  ) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[17] ); 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a>00178             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j-1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[18] ); 
<a name="l00179"></a>00179             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j-1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[19] ); 
<a name="l00180"></a>00180             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j-1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[20] ); 
<a name="l00181"></a>00181 
<a name="l00182"></a>00182             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j   ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[21] ); 
<a name="l00183"></a>00183             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j   ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>)+= ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[22] ); 
<a name="l00184"></a>00184             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j   ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[23] ); 
<a name="l00185"></a>00185 
<a name="l00186"></a>00186             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1 , j+1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[24] ); 
<a name="l00187"></a>00187             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>   , j+1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[25] ); 
<a name="l00188"></a>00188             *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 , j+1 ,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d9/d63/solver__util_8cpp.html#a514e04108cbe859165338d6bb3e172f2">ZKD1</a>) += ( val * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acb844b0f6462828dcd8ba759ac086de7">mIsoWeight</a>[26] ); 
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment">// TEST!?</span>
<a name="l00192"></a>00192 <span class="preprocessor">#if SURFACE_ENH&gt;=2</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba9e79a075c2509a4f6f29ca96e80036c7">fssgNoObs</a>) {
<a name="l00195"></a>00195         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(lev); ++k) 
<a name="l00196"></a>00196          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++) 
<a name="l00197"></a>00197             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00198"></a>00198                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> cflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet);
<a name="l00199"></a>00199                 <span class="keywordflow">if</span>(cflag&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>)) {
<a name="l00200"></a>00200                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> nbored=0;
<a name="l00201"></a>00201                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> avgfill=0.,avgfcnt=0.;
<a name="l00202"></a>00202                     <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { 
<a name="l00203"></a>00203                         <span class="keyword">const</span> <span class="keywordtype">int</span> ni = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l];
<a name="l00204"></a>00204                         <span class="keyword">const</span> <span class="keywordtype">int</span> nj = j+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l];
<a name="l00205"></a>00205                         <span class="keyword">const</span> <span class="keywordtype">int</span> nk = <a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l];
<a name="l00206"></a>00206 
<a name="l00207"></a>00207                         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> nbflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, ni,nj,nk, workSet);
<a name="l00208"></a>00208                         nbored |= nbflag;
<a name="l00209"></a>00209                         <span class="keywordflow">if</span>(nbflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) {
<a name="l00210"></a>00210                             avgfill += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, ni,nj,nk, workSet,<a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>); avgfcnt += 1.;
<a name="l00211"></a>00211                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nbflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) {
<a name="l00212"></a>00212                             avgfill += 1.; avgfcnt += 1.;
<a name="l00213"></a>00213                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nbflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>) {
<a name="l00214"></a>00214                             avgfill += 0.; avgfcnt += 1.;
<a name="l00215"></a>00215                         }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                         <span class="comment">//if( (ni&lt;0) || (nj&lt;0) || (nk&lt;0) </span>
<a name="l00218"></a>00218                          <span class="comment">//|| (ni&gt;=mLevel[mMaxRefine].lSizex) </span>
<a name="l00219"></a>00219                          <span class="comment">//|| (nj&gt;=mLevel[mMaxRefine].lSizey) </span>
<a name="l00220"></a>00220                          <span class="comment">//|| (nk&gt;=mLevel[mMaxRefine].lSizez) ) continue;</span>
<a name="l00221"></a>00221                     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223                     <span class="keywordflow">if</span>(nbored&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) {
<a name="l00224"></a>00224                         <span class="keywordflow">if</span>(avgfcnt&gt;0.) avgfill/=avgfcnt;
<a name="l00225"></a>00225                         *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) = avgfill; <span class="keywordflow">continue</span>;
<a name="l00226"></a>00226                     } 
<a name="l00227"></a>00227                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nbored&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) {
<a name="l00228"></a>00228                         *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) = 1.; <span class="keywordflow">continue</span>;
<a name="l00229"></a>00229                     }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231                 }
<a name="l00232"></a>00232             }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="comment">// move surface towards inner &quot;row&quot; of obstacle</span>
<a name="l00235"></a>00235         <span class="comment">// cells if necessary (all obs cells without fluid/inter</span>
<a name="l00236"></a>00236         <span class="comment">// nbs (=iso==0) next to obstacles...)</span>
<a name="l00237"></a>00237         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad066dc119f1bcd9dd4ec5849210c4fda">getForZMin1</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(lev); ++k) 
<a name="l00238"></a>00238             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-1;j++) 
<a name="l00239"></a>00239                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00240"></a>00240                     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> cflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k,workSet);
<a name="l00241"></a>00241                     <span class="keywordflow">if</span>( (cflag&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>)) &amp;&amp; (*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>)==0.)) {
<a name="l00242"></a>00242                         <span class="keywordtype">int</span> bndnbcnt=0;
<a name="l00243"></a>00243                         <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a> { 
<a name="l00244"></a>00244                             <span class="keyword">const</span> <span class="keywordtype">int</span> ni = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l];
<a name="l00245"></a>00245                             <span class="keyword">const</span> <span class="keywordtype">int</span> nj = j+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l];
<a name="l00246"></a>00246                             <span class="keyword">const</span> <span class="keywordtype">int</span> nk = <a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l];
<a name="l00247"></a>00247                             <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> nbflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev, ni,nj,nk, workSet);
<a name="l00248"></a>00248                             <span class="keywordflow">if</span>(nbflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>) bndnbcnt++;
<a name="l00249"></a>00249                         }
<a name="l00250"></a>00250                         <span class="keywordflow">if</span>(bndnbcnt&gt;0) *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>)=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a49e4a21ad7d3557a8246650e075bd815">mIsoValue</a>*0.95; 
<a name="l00251"></a>00251                     }
<a name="l00252"></a>00252                 }
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254     <span class="comment">// */</span>
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba861eeffb2b9ce624d831c5adb2566777">fssgNoNorth</a>) 
<a name="l00257"></a>00257         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev); ++k) 
<a name="l00258"></a>00258             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++) {
<a name="l00259"></a>00259                 *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(0,                   j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(1,                   j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>);
<a name="l00260"></a>00260             }
<a name="l00261"></a>00261     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba5f86194cbe464dbed226f3fbac8dd344">fssgNoEast</a>) 
<a name="l00262"></a>00262         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev); ++k) 
<a name="l00263"></a>00263             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00264"></a>00264                 *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,0,                   <a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,1,                   <a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>);
<a name="l00265"></a>00265             }
<a name="l00266"></a>00266     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba8239b482337fac4674d376c88f4820a3">fssgNoSouth</a>) 
<a name="l00267"></a>00267         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev); ++k) 
<a name="l00268"></a>00268             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++) {
<a name="l00269"></a>00269                 *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex-1,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex-2,j,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>);
<a name="l00270"></a>00270             }
<a name="l00271"></a>00271     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba5906559576900d234453a66c09dfc5de">fssgNoWest</a>) 
<a name="l00272"></a>00272         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev); ++k) 
<a name="l00273"></a>00273             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00274"></a>00274                 *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey-1,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey-2,<a class="code" href="../../d9/d63/solver__util_8cpp.html#a6d69ccec86840089bcb1e6fb8d662fce">ZKOFF</a>);
<a name="l00275"></a>00275             }
<a name="l00276"></a>00276     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>&gt;2) {
<a name="l00277"></a>00277         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba21e04f8485678932af8da21b7deaff73">fssgNoBottom</a>) 
<a name="l00278"></a>00278             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++) 
<a name="l00279"></a>00279                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00280"></a>00280                     *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0                   ) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,1                   );
<a name="l00281"></a>00281                 } 
<a name="l00282"></a>00282         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8e84b6ca755dadd342c54a4a23f3ae6d">mFsSurfGenSetting</a>&amp;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a896fd63a091ec79147df0d3b2706110ba50171f62e677541cf66a9923f866aaf5">fssgNoTop</a>) 
<a name="l00283"></a>00283             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++) 
<a name="l00284"></a>00284                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00285"></a>00285                     *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizez-1) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizez-2);
<a name="l00286"></a>00286                 } 
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 <span class="preprocessor">#endif // SURFACE_ENH&gt;=2</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span>
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="comment">// update preview, remove 2d?</span>
<a name="l00292"></a>00292     <span class="keywordflow">if</span>((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a>)&amp;&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==3)) {
<a name="l00293"></a>00293         <span class="keywordtype">int</span> pvsx = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#afb3d0e159ab86d50d2ac3850396618d9">mPreviewFactor</a>*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>);
<a name="l00294"></a>00294         <span class="keywordtype">int</span> pvsy = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#afb3d0e159ab86d50d2ac3850396618d9">mPreviewFactor</a>*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>);
<a name="l00295"></a>00295         <span class="keywordtype">int</span> pvsz = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#afb3d0e159ab86d50d2ac3850396618d9">mPreviewFactor</a>*<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>);
<a name="l00296"></a>00296         <span class="comment">//float scale = (float)mSizex / previewSize;</span>
<a name="l00297"></a>00297         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> scalex = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)mSizex/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)pvsx;
<a name="l00298"></a>00298         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> scaley = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)mSizey/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)pvsy;
<a name="l00299"></a>00299         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> scalez = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)mSizez/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)pvsz;
<a name="l00300"></a>00300         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= 0; k&lt; (pvsz-1); ++k) 
<a name="l00301"></a>00301         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt; pvsy;j++) 
<a name="l00302"></a>00302             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt; pvsx;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00303"></a>00303                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( (<span class="keywordtype">int</span>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*scalex), (<span class="keywordtype">int</span>)(j*scaley), (<span class="keywordtype">int</span>)(k*scalez) );
<a name="l00304"></a>00304                 }
<a name="l00305"></a>00305         <span class="comment">// set borders again...</span>
<a name="l00306"></a>00306         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= 0; k&lt; (pvsz-1); ++k) {
<a name="l00307"></a>00307             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt; pvsy;j++) {
<a name="l00308"></a>00308                 *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(0,j,k) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( 0, (<span class="keywordtype">int</span>)(j*scaley), (<span class="keywordtype">int</span>)(k*scalez) );
<a name="l00309"></a>00309                 *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(pvsx-1,j,k) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( mSizex-1, (<span class="keywordtype">int</span>)(j*scaley), (<span class="keywordtype">int</span>)(k*scalez) );
<a name="l00310"></a>00310             }
<a name="l00311"></a>00311             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt; pvsx;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00312"></a>00312                 *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,0,k) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( (<span class="keywordtype">int</span>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*scalex), 0, (<span class="keywordtype">int</span>)(k*scalez) );
<a name="l00313"></a>00313                 *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,pvsy-1,k) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( (<span class="keywordtype">int</span>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*scalex), mSizey-1, (<span class="keywordtype">int</span>)(k*scalez) );
<a name="l00314"></a>00314             }
<a name="l00315"></a>00315         }
<a name="l00316"></a>00316         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;pvsy;j++)
<a name="l00317"></a>00317             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;pvsx;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {      
<a name="l00318"></a>00318                 *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( (<span class="keywordtype">int</span>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*scalex), (<span class="keywordtype">int</span>)(j*scaley) , 0);
<a name="l00319"></a>00319                 *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,pvsz-1) = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( (<span class="keywordtype">int</span>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*scalex), (<span class="keywordtype">int</span>)(j*scaley) , mSizez-1);
<a name="l00320"></a>00320             }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322         <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a10f9f663715f1587859a0106518a355c">mFarFieldSize</a>&gt;=1.2) {
<a name="l00323"></a>00323             <span class="comment">// also remove preview border</span>
<a name="l00324"></a>00324             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= 0; k&lt; (pvsz-1); ++k) {
<a name="l00325"></a>00325                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt; pvsy;j++) {
<a name="l00326"></a>00326                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(0,j,k) = 
<a name="l00327"></a>00327                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(1,j,k) =  
<a name="l00328"></a>00328                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(2,j,k);
<a name="l00329"></a>00329                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(pvsx-1,j,k) = 
<a name="l00330"></a>00330                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(pvsx-2,j,k) = 
<a name="l00331"></a>00331                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(pvsx-3,j,k);
<a name="l00332"></a>00332                     <span class="comment">//0.0;</span>
<a name="l00333"></a>00333                 }
<a name="l00334"></a>00334                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt; pvsx;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00335"></a>00335                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,0,k) = 
<a name="l00336"></a>00336                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,1,k) = 
<a name="l00337"></a>00337                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,2,k);
<a name="l00338"></a>00338                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,pvsy-1,k) = 
<a name="l00339"></a>00339                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,pvsy-2,k) = 
<a name="l00340"></a>00340                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,pvsy-3,k);
<a name="l00341"></a>00341                     <span class="comment">//0.0;</span>
<a name="l00342"></a>00342                 }
<a name="l00343"></a>00343             }
<a name="l00344"></a>00344             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;pvsy;j++)
<a name="l00345"></a>00345                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;pvsx;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {      
<a name="l00346"></a>00346                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,0) = 
<a name="l00347"></a>00347                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,1) = 
<a name="l00348"></a>00348                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,2);
<a name="l00349"></a>00349                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,pvsz-1) = 
<a name="l00350"></a>00350                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,pvsz-2) = 
<a name="l00351"></a>00351                     *<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,pvsz-3);
<a name="l00352"></a>00352                     <span class="comment">//0.0;</span>
<a name="l00353"></a>00353             }
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">// MPT</span>
<a name="l00358"></a>00358 <span class="preprocessor">    #if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>    mrIsoExchange();
<a name="l00360"></a>00360 <span class="preprocessor">    #endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>
<a name="l00362"></a>00362     <span class="keywordflow">return</span>;
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00366"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a82c5192861cccab2c23bb463a6b200ff">00366</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a82c5192861cccab2c23bb463a6b200ff" title="init mObjectSpeeds for current parametrization">LbmFsgrSolver::recalculateObjectSpeeds</a>() {
<a name="l00367"></a>00367     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugRecalc = <span class="keyword">false</span>;
<a name="l00368"></a>00368     <span class="keywordtype">int</span> numobjs = (int)(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>-&gt;size());
<a name="l00369"></a>00369     <span class="comment">// note - (numobjs + 1) is entry for domain settings</span>
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span>(debugRecalc) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;recalculateObjectSpeeds&quot;</span>,<span class="stringliteral">&quot;start, #obj:&quot;</span>&lt;&lt;numobjs);
<a name="l00372"></a>00372     <span class="keywordflow">if</span>(numobjs&gt;255-1) {
<a name="l00373"></a>00373         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;LbmFsgrSolver::recalculateObjectSpeeds&quot;</span>,<span class="stringliteral">&quot;More than 256 objects currently not supported...&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00374"></a>00374         <span class="keywordflow">return</span>;
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>.resize(numobjs+1);
<a name="l00377"></a>00377     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)(numobjs+0); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00378"></a>00378         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a6876e6f7f70128c9e931df8dffbf53da">calculateLattVelocityFromRw</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3354c71d4798004f2f6962993794ee76">vec2P</a>( (*this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getInitialVelocity(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) )));
<a name="l00379"></a>00379         <span class="keywordflow">if</span>(debugRecalc) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;recalculateObjectSpeeds&quot;</span>,<span class="stringliteral">&quot;id&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; set to &quot;</span>&lt;&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad0dc1680ff9a031cf632cbca05c72f25" title="precalculated objects speeds for current parametrization">mObjectSpeeds</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]&lt;&lt;<span class="stringliteral">&quot;, unscaled:&quot;</span>&lt;&lt; (*this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getInitialVelocity(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) );
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">// also reinit part slip values here</span>
<a name="l00383"></a>00383     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>.resize(numobjs+1);
<a name="l00384"></a>00384     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=(int)(numobjs+0); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00385"></a>00385         <span class="keywordflow">if</span>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numobjs) {
<a name="l00386"></a>00386             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(*this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getGeoPartSlipValue();
<a name="l00387"></a>00387         } <span class="keywordflow">else</span> {
<a name="l00388"></a>00388             <span class="comment">// domain setting</span>
<a name="l00389"></a>00389             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#af25e799a38280a056e6c671e9b04fb6b" title="part slip value for domain">mDomainPartSlipValue</a>;
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <span class="keyword">set</span> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         <span class="comment">// as in setInfluenceVelocity</span>
<a name="l00394"></a>00394         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> dt = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>;
<a name="l00395"></a>00395         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> dtInter = 0.01;
<a name="l00396"></a>00396         <span class="comment">//LbmFloat facFv = 1.-set;</span>
<a name="l00397"></a>00397         <span class="comment">// mLevel[mMaxRefine].timestep</span>
<a name="l00398"></a>00398         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> facNv = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)( 1.-<a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>( (<span class="keywordtype">double</span>)(<span class="keyword">set</span>), (<span class="keywordtype">double</span>)(dt/dtInter)) );
<a name="l00399"></a>00399         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;mObjectPartslips&quot;</span>,<span class="stringliteral">&quot;id:&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;numobjs&lt;&lt;<span class="stringliteral">&quot;  ts:&quot;</span>&lt;&lt;dt&lt;&lt; <span class="stringliteral">&quot; its:&quot;</span>&lt;&lt;(dt/dtInter) &lt;&lt;<span class="stringliteral">&quot; set&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; nv&quot;</span>&lt;&lt;facNv&lt;&lt;<span class="stringliteral">&quot; test:&quot;</span>&lt;&lt;
<a name="l00400"></a>00400              <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>( (<span class="keywordtype">double</span>)(1.-facNv),(<span class="keywordtype">double</span>)(dtInter/dt))  );
<a name="l00401"></a>00401         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = facNv;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403         <span class="keywordflow">if</span>(debugRecalc) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;recalculateObjectSpeeds&quot;</span>,<span class="stringliteral">&quot;id&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; parts &quot;</span>&lt;&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] );
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordflow">if</span>(debugRecalc) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;recalculateObjectSpeeds&quot;</span>,<span class="stringliteral">&quot;done, domain:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ca9e0559cad69c1aec27c6a662277fc" title="partslip bc. values for obstacle boundary conditions">mObjectPartslips</a>[numobjs]&lt;&lt;<span class="stringliteral">&quot; n&quot;</span>&lt;&lt;numobjs);
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">/*****************************************************************************/</span>
<a name="l00413"></a>00413 <span class="comment">/*****************************************************************************/</span>
<a name="l00414"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abf56f1fbaf6d2920e17fca8c28d5876e">00414</a> vector&lt;ntlGeometryObject*&gt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#abf56f1fbaf6d2920e17fca8c28d5876e">LbmFsgrSolver::getDebugObjects</a>() { 
<a name="l00415"></a>00415     vector&lt;ntlGeometryObject*&gt; debo; 
<a name="l00416"></a>00416     <span class="keywordflow">if</span>(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4cd98070ec0478105fff407f45df18d0" title="output surface preview? if &gt;0 yes, and use as reduzed size">mOutputSurfacePreview</a>) {
<a name="l00417"></a>00417         debo.push_back( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1ed2e47640a54309e46ed3c909a729c9" title="Mcubes object for surface reconstruction.">mpPreviewSurface</a> );
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>) {
<a name="l00421"></a>00421         vector&lt;ntlGeometryObject*&gt; tdebo; 
<a name="l00422"></a>00422         tdebo = mpTest-&gt;getDebugObjects();
<a name="l00423"></a>00423         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;tdebo.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) debo.push_back( tdebo[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] );
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425 <span class="preprocessor">#endif // ELBEEM_PLUGIN</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span>    <span class="keywordflow">return</span> debo; 
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="comment">/******************************************************************************</span>
<a name="l00430"></a>00430 <span class="comment"> * particle handling</span>
<a name="l00431"></a>00431 <span class="comment"> *****************************************************************************/</span>
<a name="l00432"></a>00432 
<a name="l00434"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aebd211baccbc8719a4e27b7c93c465e9">00434</a> <span class="keywordtype">int</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aebd211baccbc8719a4e27b7c93c465e9">LbmFsgrSolver::initParticles</a>() { 
<a name="l00435"></a>00435   <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l00436"></a>00436   <span class="keywordtype">int</span> tries = 0;
<a name="l00437"></a>00437   <span class="keywordtype">int</span> num = 0;
<a name="l00438"></a>00438     <a class="code" href="../../de/db7/classParticleTracer.html" title="A whole particle array.">ParticleTracer</a> *partt = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a7bd40e52668f56886ebd07d08eab3f5f">setStart</a>( this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].nodeSize*0.5) );
<a name="l00441"></a>00441   partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#ab71ce99fb290c9805a4e957689bb4fce">setEnd</a>  ( this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>   + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].nodeSize*0.5) );
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a4a276ac21168f5deedd9151418391743">setSimStart</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0) );
<a name="l00444"></a>00444   partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#acc9fd86cfdf9b9f910742aa118fe517a">setSimEnd</a>  ( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>,   <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>,   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>)) );
<a name="l00445"></a>00445   
<a name="l00446"></a>00446   <span class="keywordflow">while</span>( (num&lt;partt-&gt;getNumInitialParticles()) &amp;&amp; (tries&lt;100*partt-&gt;getNumInitialParticles()) ) {
<a name="l00447"></a>00447     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> x,y,z,t;
<a name="l00448"></a>00448     x = 1.0+(( (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-3.) )          * (rand()/(RAND_MAX+1.0)) );
<a name="l00449"></a>00449     y = 1.0+(( (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>-3.) )          * (rand()/(RAND_MAX+1.0)) );
<a name="l00450"></a>00450     z = 1.0+(( (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab174bfba48094afdd7847a7cec4a82a2">getForZMax1</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>)-2. )* (rand()/(RAND_MAX+1.0)) );
<a name="l00451"></a>00451     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = (int)(x+0.5);
<a name="l00452"></a>00452     <span class="keywordtype">int</span> j = (int)(y+0.5);
<a name="l00453"></a>00453     <span class="keywordtype">int</span> k = (int)(z+0.5);
<a name="l00454"></a>00454     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l00455"></a>00455       k = 0; z = 0.5; <span class="comment">// place in the middle of domain</span>
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="comment">//if( RFLAG(mMaxRefine, i,j,k, workSet)&amp; (CFFluid) ) </span>
<a name="l00459"></a>00459     <span class="comment">//&amp;&amp; ( RFLAG(mMaxRefine, i,j,k, workSet)&amp; CFNoNbFluid ) </span>
<a name="l00460"></a>00460     <span class="comment">//if( RFLAG(mMaxRefine, i,j,k, workSet) &amp; (CFFluid|CFInter|CFMbndInflow) ) { </span>
<a name="l00461"></a>00461     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, i,j,k, workSet) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>) ) { 
<a name="l00462"></a>00462             <span class="keywordtype">bool</span> cellOk = <span class="keyword">true</span>;
<a name="l00463"></a>00463             <span class="comment">//? FORDF1 { if(!(RFLAG_NB(mMaxRefine,i,j,k,workSet, l) &amp; CFFluid)) cellOk = false; }</span>
<a name="l00464"></a>00464             <span class="keywordflow">if</span>(!cellOk) <span class="keywordflow">continue</span>;
<a name="l00465"></a>00465       <span class="comment">// in fluid...</span>
<a name="l00466"></a>00466       partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a992ad77a01da5a9dd1747f26179397a9" title="add a particle at this position">addParticle</a>(x,y,z);
<a name="l00467"></a>00467             partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>);
<a name="l00468"></a>00468             partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#abc8af5d01d8df0cdac14d241784c7d5e" title="set type (lower byte)">setType</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#af80e60f2b2aba7efc61fb77db1e22b63">PART_TRACER</a>);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470             partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad060ac475f1f772e5d08d97d76039ce9">setSize</a>(1.);
<a name="l00471"></a>00471             <span class="comment">// randomize size</span>
<a name="l00472"></a>00472             partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad060ac475f1f772e5d08d97d76039ce9">setSize</a>(0.5 + (rand()/(RAND_MAX+1.0)));
<a name="l00473"></a>00473 
<a name="l00474"></a>00474             <span class="keywordflow">if</span>( ( partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a9de9cee8f2ca6ee2832ac206fb18309e">getInitStart</a>()&gt;0.)
<a name="l00475"></a>00475                     &amp;&amp; ( partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#aa8a41b0f4e922a34377c18048701e49a">getInitEnd</a>()&gt;0.)
<a name="l00476"></a>00476                     &amp;&amp; ( partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#aa8a41b0f4e922a34377c18048701e49a">getInitEnd</a>()&gt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a9de9cee8f2ca6ee2832ac206fb18309e">getInitStart</a>() )) {
<a name="l00477"></a>00477             t = partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a9de9cee8f2ca6ee2832ac206fb18309e">getInitStart</a>()+ (partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#aa8a41b0f4e922a34377c18048701e49a">getInitEnd</a>()-partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a9de9cee8f2ca6ee2832ac206fb18309e">getInitStart</a>())*(rand()/(RAND_MAX+1.0));
<a name="l00478"></a>00478                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae89d4d5c03f427327b3eb47d2e380c7c" title="set type (lower byte)">setLifeTime</a>( -t );
<a name="l00479"></a>00479             }
<a name="l00480"></a>00480       num++;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482     tries++;
<a name="l00483"></a>00483   } <span class="comment">// */</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="comment">/*FSGR_FORIJK1(mMaxRefine) {</span>
<a name="l00486"></a>00486 <span class="comment">        if( (RFLAG(mMaxRefine,i,j,k, workSet) &amp; (CFNoBndFluid)) ) {</span>
<a name="l00487"></a>00487 <span class="comment">        LbmFloat rndn = (rand()/(RAND_MAX+1.0));</span>
<a name="l00488"></a>00488 <span class="comment">            if(rndn&gt;0.0) {</span>
<a name="l00489"></a>00489 <span class="comment">                ntlVec3Gfx pos( (LbmFloat)(i)-0.5, (LbmFloat)(j)-0.5, (LbmFloat)(k)-0.5 );</span>
<a name="l00490"></a>00490 <span class="comment">                if(LBMDIM==2) { pos[2]=0.5; }</span>
<a name="l00491"></a>00491 <span class="comment">                partt-&gt;addParticle( pos[0],pos[1],pos[2] );</span>
<a name="l00492"></a>00492 <span class="comment">                partt-&gt;getLast()-&gt;setStatus(PART_IN);</span>
<a name="l00493"></a>00493 <span class="comment">                partt-&gt;getLast()-&gt;setType(PART_TRACER);</span>
<a name="l00494"></a>00494 <span class="comment">                partt-&gt;getLast()-&gt;setSize(1.0);</span>
<a name="l00495"></a>00495 <span class="comment">            }</span>
<a name="l00496"></a>00496 <span class="comment">        }</span>
<a name="l00497"></a>00497 <span class="comment">    } // */</span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="comment">// DEBUG TEST</span>
<a name="l00501"></a>00501 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00502"></a>00502 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>) { 
<a name="l00503"></a>00503         <span class="keyword">const</span> <span class="keywordtype">bool</span> partDebug=<span class="keyword">false</span>;
<a name="l00504"></a>00504         <span class="keywordflow">if</span>(mpTest-&gt;mPartTestcase==0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmTestdata&quot;</span>,<span class="stringliteral">&quot; part init &quot;</span>&lt;&lt;mpTest-&gt;mPartTestcase); }
<a name="l00505"></a>00505         <span class="keywordflow">if</span>(mpTest-&gt;mPartTestcase==-12){ 
<a name="l00506"></a>00506             <span class="keyword">const</span> <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00507"></a>00507             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=5;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;15;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00508"></a>00508                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> x,y,z;
<a name="l00509"></a>00509                 y = 0.5+(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00510"></a>00510                 x = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>/20.0*10.0;
<a name="l00511"></a>00511                 z = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>/20.0*2.0;
<a name="l00512"></a>00512                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a992ad77a01da5a9dd1747f26179397a9" title="add a particle at this position">addParticle</a>(x,y,z);
<a name="l00513"></a>00513                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>);
<a name="l00514"></a>00514                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#abc8af5d01d8df0cdac14d241784c7d5e" title="set type (lower byte)">setType</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#ab1e276b291ebf48d52d4d87b4520978d">PART_BUBBLE</a>);
<a name="l00515"></a>00515                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad060ac475f1f772e5d08d97d76039ce9">setSize</a>(  (-4.0+(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)/1.0  );
<a name="l00516"></a>00516                 <span class="keywordflow">if</span>(partDebug) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;PARTTT&quot;</span>,<span class="stringliteral">&quot;SET &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(x,y,z)&lt;&lt;<span class="stringliteral">&quot; p&quot;</span>&lt;&lt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>() &lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>() );
<a name="l00517"></a>00517             }
<a name="l00518"></a>00518         }
<a name="l00519"></a>00519         <span class="keywordflow">if</span>(mpTest-&gt;mPartTestcase==-11){ 
<a name="l00520"></a>00520             <span class="keyword">const</span> <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00521"></a>00521             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=5;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;15;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00522"></a>00522                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> x,y,z;
<a name="l00523"></a>00523                 y = 10.5+(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00524"></a>00524                 x = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>/20.0*10.0;
<a name="l00525"></a>00525                 z = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>/20.0*40.0;
<a name="l00526"></a>00526                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a992ad77a01da5a9dd1747f26179397a9" title="add a particle at this position">addParticle</a>(x,y,z);
<a name="l00527"></a>00527                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>);
<a name="l00528"></a>00528                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#abc8af5d01d8df0cdac14d241784c7d5e" title="set type (lower byte)">setType</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#aa34c342137a60a8d1b9504cea2791919">PART_DROP</a>);
<a name="l00529"></a>00529                 partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad060ac475f1f772e5d08d97d76039ce9">setSize</a>(  (-4.0+(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)/1.0  );
<a name="l00530"></a>00530                 <span class="keywordflow">if</span>(partDebug) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;PARTTT&quot;</span>,<span class="stringliteral">&quot;SET &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(x,y,z)&lt;&lt;<span class="stringliteral">&quot; p&quot;</span>&lt;&lt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>() &lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>() );
<a name="l00531"></a>00531             }
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533         <span class="comment">// place floats on rectangular region FLOAT_JITTER_BND</span>
<a name="l00534"></a>00534         <span class="keywordflow">if</span>(mpTest-&gt;mPartTestcase==-10){ 
<a name="l00535"></a>00535             <span class="keyword">const</span> <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00536"></a>00536             <span class="keyword">const</span> <span class="keywordtype">int</span> sx = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>;
<a name="l00537"></a>00537             <span class="keyword">const</span> <span class="keywordtype">int</span> sy = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>;
<a name="l00538"></a>00538             <span class="comment">//for(int j=-(int)(sy*0.25);j&lt;-(int)(sy*0.25)+2;++j) { for(int i=-(int)(sx*0.25);i&lt;-(int)(sy*0.25)+2;++i) {</span>
<a name="l00539"></a>00539             <span class="comment">//for(int j=-(int)(sy*1.25);j&lt;(int)(2.25*sy);++j) { for(int i=-(int)(sx*1.25);i&lt;(int)(2.25*sx);++i) {</span>
<a name="l00540"></a>00540             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=-(<span class="keywordtype">int</span>)(sy*0.3);j&lt;(int)(1.3*sy);++j) { <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=-(<span class="keywordtype">int</span>)(sx*0.3);<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)(1.3*sx);++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00541"></a>00541             <span class="comment">//for(int j=-(int)(sy*0.2);j&lt;(int)(0.2*sy);++j) { for(int i= (int)(sx*0.5);i&lt;= (int)(0.51*sx);++i) {</span>
<a name="l00542"></a>00542                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> x,y,z;
<a name="l00543"></a>00543                     x = 0.0+(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00544"></a>00544                     y = 0.0+(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(j);
<a name="l00545"></a>00545                     <span class="comment">//z = mLevel[lev].lSizez/10.0*2.5 - 1.0;</span>
<a name="l00546"></a>00546                     z = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>/20.0*9.5 - 1.0;
<a name="l00547"></a>00547                     <span class="comment">//z = mLevel[lev].lSizez/20.0*4.5 - 1.0;</span>
<a name="l00548"></a>00548                     partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a992ad77a01da5a9dd1747f26179397a9" title="add a particle at this position">addParticle</a>(x,y,z);
<a name="l00549"></a>00549                     <span class="comment">//if( (i&gt;0)&amp;&amp;(i&lt;sx) &amp;&amp; (j&gt;0)&amp;&amp;(j&lt;sy) ) { partt-&gt;getLast()-&gt;setStatus(PART_IN); } else { partt-&gt;getLast()-&gt;setStatus(PART_OUT); }</span>
<a name="l00550"></a>00550                     partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>);
<a name="l00551"></a>00551                     partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#abc8af5d01d8df0cdac14d241784c7d5e" title="set type (lower byte)">setType</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#aa583a8e6c70a28f43ac14cbe6313be2d">PART_FLOAT</a>);
<a name="l00552"></a>00552                     partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad060ac475f1f772e5d08d97d76039ce9">setSize</a>( 15.0 );
<a name="l00553"></a>00553                     <span class="keywordflow">if</span>(partDebug) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;PARTTT&quot;</span>,<span class="stringliteral">&quot;SET &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(x,y,z)&lt;&lt;<span class="stringliteral">&quot; p&quot;</span>&lt;&lt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>() &lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#af77ca566e251bb83a925abffb0ff2425" title="end iterator for newest particles">getLast</a>()-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>() );
<a name="l00554"></a>00554              }
<a name="l00555"></a>00555         }   }
<a name="l00556"></a>00556     } 
<a name="l00557"></a>00557     <span class="comment">// DEBUG TEST</span>
<a name="l00558"></a>00558 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS</span>
<a name="l00559"></a>00559 <span class="preprocessor"></span>
<a name="l00560"></a>00560     
<a name="l00561"></a>00561   <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initParticles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Added &quot;</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">&quot; particles, genProb:&quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6358cc8e1b4774a3f353c281363588f8" title="particle generation probability">mPartGenProb</a>&lt;&lt;<span class="stringliteral">&quot;, tries:&quot;</span>&lt;&lt;tries, 10);
<a name="l00562"></a>00562   <span class="keywordflow">if</span>(num != partt-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a8f69f240778943a3dfb30f4720ed98fb" title="get the number of particles">getNumParticles</a>()) <span class="keywordflow">return</span> 1;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keywordflow">return</span> 0;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="comment">// helper function for particle debugging</span>
<a name="l00568"></a>00568 <span class="comment">/*static string getParticleStatusString(int state) {</span>
<a name="l00569"></a>00569 <span class="comment">    std::ostringstream out;</span>
<a name="l00570"></a>00570 <span class="comment">    if(state&amp;PART_DROP)   out &lt;&lt; &quot;dropp &quot;;</span>
<a name="l00571"></a>00571 <span class="comment">    if(state&amp;PART_TRACER) out &lt;&lt; &quot;tracr &quot;;</span>
<a name="l00572"></a>00572 <span class="comment">    if(state&amp;PART_BUBBLE) out &lt;&lt; &quot;bubbl &quot;;</span>
<a name="l00573"></a>00573 <span class="comment">    if(state&amp;PART_FLOAT)  out &lt;&lt; &quot;float &quot;;</span>
<a name="l00574"></a>00574 <span class="comment">    if(state&amp;PART_INTER)  out &lt;&lt; &quot;inter &quot;;</span>
<a name="l00575"></a>00575 <span class="comment"></span>
<a name="l00576"></a>00576 <span class="comment">    if(state&amp;PART_IN)   out &lt;&lt; &quot;inn &quot;;</span>
<a name="l00577"></a>00577 <span class="comment">    if(state&amp;PART_OUT)  out &lt;&lt; &quot;out &quot;;</span>
<a name="l00578"></a>00578 <span class="comment">    if(state&amp;PART_INACTIVE)  out &lt;&lt; &quot;INACT &quot;;</span>
<a name="l00579"></a>00579 <span class="comment">    if(state&amp;PART_OUTFLUID)  out &lt;&lt; &quot;outfluid &quot;;</span>
<a name="l00580"></a>00580 <span class="comment">    return out.str();</span>
<a name="l00581"></a>00581 <span class="comment">} // */</span>
<a name="l00582"></a>00582 
<a name="l00583"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a977448711f668fb7fd49cc4743ff2a51">00583</a> <span class="preprocessor">#define P_CHANGETYPE(p, newtype) \</span>
<a name="l00584"></a>00584 <span class="preprocessor">        p-&gt;setLifeTime(0.); \</span>
<a name="l00585"></a>00585 <span class="preprocessor">    </span><span class="comment">/* errMsg(&quot;PIT&quot;,&quot;U pit&quot;&lt;&lt;(p)-&gt;getId()&lt;&lt;&quot; pos:&quot;&lt;&lt; (p)-&gt;getPos()&lt;&lt;&quot; status:&quot;&lt;&lt;convertFlags2String((p)-&gt;getFlags())&lt;&lt;&quot; to &quot;&lt;&lt; (newtype) ); */</span> \
<a name="l00586"></a>00586         p-&gt;setType(newtype); 
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">// tracer defines</span>
<a name="l00589"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#afeb411426e3daa877440c575b8d90ac2">00589</a> <span class="preprocessor">#define TRACE_JITTER 0.025</span>
<a name="l00590"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#ae0320c3605d4ba7a319164b0c65e9979">00590</a> <span class="preprocessor"></span><span class="preprocessor">#define TRACE_RAND (rand()/(RAND_MAX+1.0))*TRACE_JITTER-(TRACE_JITTER*0.5)</span>
<a name="l00591"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">00591</a> <span class="preprocessor"></span><span class="preprocessor">#define FFGET_NORM(var,dl) \</span>
<a name="l00592"></a>00592 <span class="preprocessor">                            if(RFLAG_NB(lev,i,j,k,workSet, dl) &amp;(CFInter)){ (var) = QCELL_NB(lev,i,j,k,workSet,dl,dFfrac); } \</span>
<a name="l00593"></a>00593 <span class="preprocessor">                            else if(RFLAG_NB(lev,i,j,k,workSet, dl) &amp;(CFFluid|CFUnused)){ (var) = 1.; } else (var) = 0.0;</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>
<a name="l00595"></a>00595 <span class="comment">// float jitter</span>
<a name="l00596"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a149311d83ed608c233b9a06776726995">00596</a> <span class="preprocessor">#define FLOAT_JITTER_BND (FLOAT_JITTER*2.0)</span>
<a name="l00597"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#adcaa31cff864d63850a996bab81a62da">00597</a> <span class="preprocessor"></span><span class="preprocessor">#define FLOAT_JITTBNDRAND(x) ((rand()/(RAND_MAX+1.0))*FLOAT_JITTER_BND*(1.-(x/(LbmFloat)maxdw))-(FLOAT_JITTER_BND*(1.-(x)/(LbmFloat)maxdw)*0.5)) </span>
<a name="l00598"></a>00598 <span class="preprocessor"></span>
<a name="l00599"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">00599</a> <span class="preprocessor">#define DEL_PART { \</span>
<a name="l00600"></a>00600 <span class="preprocessor">    </span><span class="comment">/*errMsg(&quot;PIT&quot;,&quot;DEL AT &quot;&lt;&lt; __LINE__&lt;&lt;&quot; type:&quot;&lt;&lt;p-&gt;getType()&lt;&lt;&quot;  &quot;);  */</span> \
<a name="l00601"></a>00601     p-&gt;setActive( false ); \
<a name="l00602"></a>00602     continue; }
<a name="l00603"></a>00603 
<a name="l00604"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aef81da55d27713fcfd97d3e5f756f29f">00604</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aef81da55d27713fcfd97d3e5f756f29f">LbmFsgrSolver::advanceParticles</a>() { 
<a name="l00605"></a>00605   <span class="keyword">const</span> <span class="keywordtype">int</span> level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00606"></a>00606   <span class="keyword">const</span> <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l00607"></a>00607     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> vx=0.0,vy=0.0,vz=0.0;
<a name="l00608"></a>00608     <span class="comment">//int debugOutCounter=0; // debug output counter</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> parttstart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l00611"></a>00611     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cellsize = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#aa7e8e09c77dc2d8edc1a19708688318e">getCellSize</a>();
<a name="l00612"></a>00612     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> timestep = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>();
<a name="l00613"></a>00613     <span class="comment">//const LbmFloat viscAir = 1.79 * 1e-5; // RW2L kin. viscosity, mu</span>
<a name="l00614"></a>00614     <span class="comment">//const LbmFloat viscWater = 1.0 * 1e-6; // RW2L kin. viscosity, mu</span>
<a name="l00615"></a>00615     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rhoAir = 1.2;  <span class="comment">// [kg m^-3] RW2L</span>
<a name="l00616"></a>00616     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rhoWater = 1000.0; <span class="comment">// RW2L</span>
<a name="l00617"></a>00617     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> minDropSize = 0.0005; <span class="comment">// [m], = 2mm  RW2L</span>
<a name="l00618"></a>00618     <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   velAir(0.); <span class="comment">// [m / s]</span>
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> r1 = 0.005;  <span class="comment">// r max</span>
<a name="l00621"></a>00621     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> r2 = 0.0005; <span class="comment">// r min</span>
<a name="l00622"></a>00622     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> v1 = 9.0; <span class="comment">// v max</span>
<a name="l00623"></a>00623     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> v2 = 2.0; <span class="comment">// v min</span>
<a name="l00624"></a>00624     <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> rwgrav = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>( this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ac71321001da185da3b6bbe8d11f2a7e9">getGravity</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) );
<a name="l00625"></a>00625     <span class="keyword">const</span> <span class="keywordtype">bool</span> useff = (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a10f9f663715f1587859a0106518a355c">mFarFieldSize</a>&gt;1.2); <span class="comment">// if(mpTest-&gt;mFarfMode&gt;0){ </span>
<a name="l00626"></a>00626 
<a name="l00627"></a>00627     <span class="comment">// TODO scale bubble/part damping dep. on timestep, also drop bnd rev damping</span>
<a name="l00628"></a>00628     <span class="keyword">const</span> <span class="keywordtype">int</span> cutval = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a883de517b6b8407dbd30c35169b53c84" title="border cutoff value">mCutoff</a>; <span class="comment">// use full border!?</span>
<a name="l00629"></a>00629     <span class="keywordflow">if</span>(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#ae22fd479f492ac4bcc02d0a510ab21dd">mStepCnt</a>%50==49) { <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#ae140cb0ea30c7cb69077efac0cc5caf3">cleanup</a>(); }
<a name="l00630"></a>00630   <span class="keywordflow">for</span>(vector&lt;ParticleObject&gt;::iterator pit= <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a20290de63584566fbbddc3e6ae6319f7" title="iterate over all newest particles (for advancing positions)">getParticlesBegin</a>();
<a name="l00631"></a>00631       pit!= <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#ab7ca394089e5aff25442abf4524fa147" title="end iterator for newest particles">getParticlesEnd</a>(); pit++) {
<a name="l00632"></a>00632     <span class="comment">//if((*pit).getPos()[2]&gt;10.) errMsg(&quot;PIT&quot;,&quot; pit&quot;&lt;&lt;(*pit).getId()&lt;&lt;&quot; pos:&quot;&lt;&lt; (*pit).getPos()&lt;&lt;&quot; status:[&quot;&lt;&lt;getParticleStatusString((*pit).getFlags())&lt;&lt;&quot;] vel:&quot;&lt;&lt; (*pit).getVel()  );</span>
<a name="l00633"></a>00633     <span class="keywordflow">if</span>( (*pit).getActive()==false ) <span class="keywordflow">continue</span>;
<a name="l00634"></a>00634         <span class="comment">// skip until reached</span>
<a name="l00635"></a>00635         <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = &amp;(*pit);
<a name="l00636"></a>00636         <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae275580a67b213577b3facd4f3f045f9" title="get/set lifetime">getLifeTime</a>()&lt;0.){ 
<a name="l00637"></a>00637             <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae275580a67b213577b3facd4f3f045f9" title="get/set lifetime">getLifeTime</a>() &lt; -<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) <span class="keywordflow">continue</span>; 
<a name="l00638"></a>00638             <span class="keywordflow">else</span> p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae89d4d5c03f427327b3eb47d2e380c7c" title="set type (lower byte)">setLifeTime</a>(-<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].timestep); <span class="comment">// zero for following update</span>
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k;
<a name="l00641"></a>00641         p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae89d4d5c03f427327b3eb47d2e380c7c" title="set type (lower byte)">setLifeTime</a>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae275580a67b213577b3facd4f3f045f9" title="get/set lifetime">getLifeTime</a>()+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">// nearest neighbor, particle positions don&#39;t include empty bounds</span>
<a name="l00644"></a>00644         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pos = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>();
<a name="l00645"></a>00645         i= (int)pos[0]; j= (int)pos[1]; k= (int)pos[2];<span class="comment">// no offset necessary</span>
<a name="l00646"></a>00646         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { k = 0; }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         <span class="comment">// only testdata handling, all for sws</span>
<a name="l00649"></a>00649 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00650"></a>00650 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(useff &amp;&amp; (mpTest-&gt;mFarfMode&gt;0)) {
<a name="l00651"></a>00651             p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#abb1694e64b1526eea38ea3598bc362b9">PART_OUT</a>);
<a name="l00652"></a>00652             mpTest-&gt;handleParticle(p, i,j,k); <span class="keywordflow">continue</span>;
<a name="l00653"></a>00653         } 
<a name="l00654"></a>00654 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span>
<a name="l00656"></a>00656         <span class="comment">// in out tests</span>
<a name="l00657"></a>00657         <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a60442421df8a831283965e094fea1c61" title="get status (higher byte)">getStatus</a>()&amp;<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>) { <span class="comment">// IN</span>
<a name="l00658"></a>00658             <span class="keywordflow">if</span>( (i&lt;cutval)||(i&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-1-cutval)||
<a name="l00659"></a>00659                     (j&lt;cutval)||(j&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>-1-cutval)
<a name="l00660"></a>00660                     <span class="comment">//||(k&lt;cutval)||(k&gt;mSizez-1-cutval) </span>
<a name="l00661"></a>00661                     ) {
<a name="l00662"></a>00662                 <span class="keywordflow">if</span>(!useff) { <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>;
<a name="l00663"></a>00663                 } <span class="keywordflow">else</span> { 
<a name="l00664"></a>00664                     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#abb1694e64b1526eea38ea3598bc362b9">PART_OUT</a>); 
<a name="l00665"></a>00665                 }
<a name="l00666"></a>00666             } 
<a name="l00667"></a>00667         } <span class="keywordflow">else</span> { <span class="comment">// OUT rough check</span>
<a name="l00668"></a>00668             <span class="comment">// check in again?</span>
<a name="l00669"></a>00669             <span class="keywordflow">if</span>( (i&gt;=cutval)&amp;&amp;(i&lt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-1-cutval)&amp;&amp;
<a name="l00670"></a>00670                     (j&gt;=cutval)&amp;&amp;(j&lt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>-1-cutval)
<a name="l00671"></a>00671                     ) {
<a name="l00672"></a>00672                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae71d7fecdc83a8c57aa384296cf8e658" title="set status (higher byte)">setStatus</a>(<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>);
<a name="l00673"></a>00673             }
<a name="l00674"></a>00674         }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676         <span class="keywordflow">if</span>( (p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#ab1e276b291ebf48d52d4d87b4520978d">PART_BUBBLE</a>) ||
<a name="l00677"></a>00677             (p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#af80e60f2b2aba7efc61fb77db1e22b63">PART_TRACER</a>) ) {
<a name="l00678"></a>00678 
<a name="l00679"></a>00679             <span class="comment">// no interpol</span>
<a name="l00680"></a>00680             vx = vy = vz = 0.0;
<a name="l00681"></a>00681             <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a60442421df8a831283965e094fea1c61" title="get status (higher byte)">getStatus</a>()&amp;<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>) { <span class="comment">// IN</span>
<a name="l00682"></a>00682                 <span class="keywordflow">if</span>(k&gt;=cutval) {
<a name="l00683"></a>00683                     <span class="keywordflow">if</span>(k&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>-1-cutval) <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l00684"></a>00684 
<a name="l00685"></a>00685                     <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>) ) {
<a name="l00686"></a>00686                         <span class="comment">// still ok</span>
<a name="l00687"></a>00687                         <span class="keywordtype">int</span> partLev = level;
<a name="l00688"></a>00688                         <span class="keywordtype">int</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, sj=j, sk=k;
<a name="l00689"></a>00689                         <span class="keywordflow">while</span>(partLev&gt;0 &amp;&amp; <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(partLev, si,sj,sk, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>)) {
<a name="l00690"></a>00690                             partLev--;
<a name="l00691"></a>00691                             si/=2;
<a name="l00692"></a>00692                             sj/=2;
<a name="l00693"></a>00693                             sk/=2;
<a name="l00694"></a>00694                         }
<a name="l00695"></a>00695                         <span class="comment">// get velocity from fluid cell</span>
<a name="l00696"></a>00696                         <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(partLev, si,sj,sk, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) ) {
<a name="l00697"></a>00697                             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *ccel = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(partLev, si,sj,sk, workSet);
<a name="l00698"></a>00698                             <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a>{
<a name="l00699"></a>00699                                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cdf = <a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(ccel, l);
<a name="l00700"></a>00700                                 <span class="comment">// TODO update below</span>
<a name="l00701"></a>00701                                 vx  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]*cdf); 
<a name="l00702"></a>00702                                 vy  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]*cdf);  
<a name="l00703"></a>00703                                 vz  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]*cdf);  
<a name="l00704"></a>00704                             }
<a name="l00705"></a>00705                             <span class="comment">// remove gravity influence</span>
<a name="l00706"></a>00706                             <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> lesomega = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#ac6762159f4cf08bae1f6209cdc8af72f" title="quadtree node relaxation parameter">omega</a>; <span class="comment">// no les</span>
<a name="l00707"></a>00707                             vx -= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[0] * lesomega*0.5;
<a name="l00708"></a>00708                             vy -= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[1] * lesomega*0.5;
<a name="l00709"></a>00709                             vz -= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[2] * lesomega*0.5;
<a name="l00710"></a>00710                         } <span class="comment">// fluid vel</span>
<a name="l00711"></a>00711 
<a name="l00712"></a>00712                     } <span class="keywordflow">else</span> { <span class="comment">// OUT</span>
<a name="l00713"></a>00713                         <span class="comment">// out of bounds, deactivate...</span>
<a name="l00714"></a>00714                         <span class="comment">// FIXME make fsgr treatment</span>
<a name="l00715"></a>00715                         <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#ab1e276b291ebf48d52d4d87b4520978d">PART_BUBBLE</a>) { <a class="code" href="../../d9/d63/solver__util_8cpp.html#a977448711f668fb7fd49cc4743ff2a51">P_CHANGETYPE</a>(p, <a class="code" href="../../d0/d69/particletracer_8h.html#aa583a8e6c70a28f43ac14cbe6313be2d">PART_FLOAT</a> ); <span class="keywordflow">continue</span>; }
<a name="l00716"></a>00716                     }
<a name="l00717"></a>00717                 } <span class="keywordflow">else</span> {
<a name="l00718"></a>00718                     <span class="comment">// below 3d region, just rise</span>
<a name="l00719"></a>00719                 }
<a name="l00720"></a>00720             } <span class="keywordflow">else</span> { <span class="comment">// OUT</span>
<a name="l00721"></a>00721 <span class="preprocessor">#               if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00722"></a>00722 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(useff) { mpTest-&gt;handleParticle(p, i,j,k); }
<a name="l00723"></a>00723                 <span class="keywordflow">else</span> <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>;
<a name="l00724"></a>00724 <span class="preprocessor">#               else // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00725"></a>00725 <span class="preprocessor"></span>                <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>;
<a name="l00726"></a>00726 <span class="preprocessor">#               endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00727"></a>00727 <span class="preprocessor"></span>                <span class="comment">// TODO use x,y vel...?</span>
<a name="l00728"></a>00728             }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> v = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>(); <span class="comment">// dampen...</span>
<a name="l00731"></a>00731             <span class="keywordflow">if</span>( (useff)&amp;&amp; (p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#ab1e276b291ebf48d52d4d87b4520978d">PART_BUBBLE</a>) ) {
<a name="l00732"></a>00732                 <span class="comment">// test rise</span>
<a name="l00733"></a>00733 
<a name="l00734"></a>00734                 <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a0e5f18391be45ce21aaa215fe24ebe09">mPartUsePhysModel</a>) {
<a name="l00735"></a>00735                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> radius = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>() * minDropSize;
<a name="l00736"></a>00736                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   velPart = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>()) *cellsize/timestep; <span class="comment">// L2RW, lattice velocity</span>
<a name="l00737"></a>00737                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   velWater = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(vx,vy,vz) *cellsize/timestep;<span class="comment">// L2RW, fluid velocity</span>
<a name="l00738"></a>00738                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   velRel = velWater - velPart;
<a name="l00739"></a>00739                     <span class="comment">//LbmFloat velRelNorm = norm(velRel);</span>
<a name="l00740"></a>00740                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> pvolume = rhoAir * 4.0/3.0 * <a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>* radius*radius*radius; <span class="comment">// volume: 4/3 pi r^3</span>
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> <a class="code" href="../../dc/d53/implicit_8c.html#a6593817fe20dfc95a3fb3f71c7b8c996">fb</a> = -rwgrav* pvolume *rhoWater;
<a name="l00743"></a>00743                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> fd = velRel*6.0*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>*radius* (1e-3); <span class="comment">//viscWater;</span>
<a name="l00744"></a>00744                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> change = (fb+fd) *10.0*timestep  *(timestep/cellsize);
<a name="l00745"></a>00745                     <span class="comment">/*if(debugOutCounter&lt;0) {</span>
<a name="l00746"></a>00746 <span class="comment">                        errMsg(&quot;PIT&quot;,&quot;BTEST1   vol=&quot;&lt;&lt;pvolume&lt;&lt;&quot; radius=&quot;&lt;&lt;radius&lt;&lt;&quot; vn=&quot;&lt;&lt;velRelNorm&lt;&lt;&quot; velPart=&quot;&lt;&lt;velPart&lt;&lt;&quot; velRel&quot;&lt;&lt;velRel);</span>
<a name="l00747"></a>00747 <span class="comment">                        errMsg(&quot;PIT&quot;,&quot;BTEST2        cellsize=&quot;&lt;&lt;cellsize&lt;&lt;&quot; timestep=&quot;&lt;&lt;timestep&lt;&lt;&quot; viscW=&quot;&lt;&lt;viscWater&lt;&lt;&quot; ss/mb=&quot;&lt;&lt;(timestep/(pvolume*rhoAir)));</span>
<a name="l00748"></a>00748 <span class="comment">                        errMsg(&quot;PIT&quot;,&quot;BTEST2        grav=&quot;&lt;&lt;rwgrav&lt;&lt;&quot;  &quot; );</span>
<a name="l00749"></a>00749 <span class="comment">                        errMsg(&quot;PIT&quot;,&quot;BTEST2        change=&quot;&lt;&lt;(change)&lt;&lt;&quot; fb=&quot;&lt;&lt;(fb)&lt;&lt;&quot; fd=&quot;&lt;&lt;(fd)&lt;&lt;&quot; &quot;);</span>
<a name="l00750"></a>00750 <span class="comment">                        errMsg(&quot;PIT&quot;,&quot;BTEST2        change=&quot;&lt;&lt;norm(change)&lt;&lt;&quot; fb=&quot;&lt;&lt;norm(fb)&lt;&lt;&quot; fd=&quot;&lt;&lt;norm(fd)&lt;&lt;&quot; &quot;);</span>
<a name="l00751"></a>00751 <span class="comment">                    } // DEBUG */</span>
<a name="l00752"></a>00752                         
<a name="l00753"></a>00753                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> fd2 = (<a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(vx,vy,vz)-<a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>())) * 6.0*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>*radius* (1e-3); <span class="comment">//viscWater;</span>
<a name="l00754"></a>00754                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> w = 0.99;
<a name="l00755"></a>00755                     vz = (1.0-w)*vz + w*(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>()[2]-0.5*(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>()/5.0)*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[2]);
<a name="l00756"></a>00756                     v = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(vx,vy,vz)+<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(fd2);
<a name="l00757"></a>00757                     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>( v );
<a name="l00758"></a>00758                 } <span class="keywordflow">else</span> {
<a name="l00759"></a>00759                     <span class="comment">// non phys, half old, half fluid, use slightly slower acc</span>
<a name="l00760"></a>00760                     v = v*0.5 + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(vx,vy,vz)* 0.5-<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].gravity)*0.5;
<a name="l00761"></a>00761                     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>( v * 0.99 );
<a name="l00762"></a>00762                 }
<a name="l00763"></a>00763                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a24e68f518302f4d9839ab1a170a4793c" title="advance with own velocity">advanceVel</a>();
<a name="l00764"></a>00764 
<a name="l00765"></a>00765             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#af80e60f2b2aba7efc61fb77db1e22b63">PART_TRACER</a>) {
<a name="l00766"></a>00766                 v = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(vx,vy,vz);
<a name="l00767"></a>00767                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> fflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet);
<a name="l00768"></a>00768 
<a name="l00769"></a>00769                 <span class="keywordflow">if</span>(fflag&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) ) { p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a2026506b0b48f33438eef905d4b93d8c" title="set influid flag">setInFluid</a>(<span class="keyword">true</span>);
<a name="l00770"></a>00770                 } <span class="keywordflow">else</span> { p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a2026506b0b48f33438eef905d4b93d8c" title="set influid flag">setInFluid</a>(<span class="keyword">false</span>); }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772                 <span class="keywordflow">if</span>( (( fflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a> ) &amp;&amp; ( fflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a> )) ||
<a name="l00773"></a>00773                         (( fflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a> ) &amp;&amp; (!(fflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#ae4360cd40e495db2052638b5e37917f1">CFNoNbFluid</a>)) ) ) {
<a name="l00774"></a>00774                     <span class="comment">// only real fluid</span>
<a name="l00775"></a>00775 <span class="preprocessor">#                   if LBMDIM==3</span>
<a name="l00776"></a>00776 <span class="preprocessor"></span>                    p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a0a6e6ae4d7899f9bb6fd5a685a794042" title="add vector to position">advance</a>( <a class="code" href="../../d9/d63/solver__util_8cpp.html#ae0320c3605d4ba7a319164b0c65e9979">TRACE_RAND</a>,<a class="code" href="../../d9/d63/solver__util_8cpp.html#ae0320c3605d4ba7a319164b0c65e9979">TRACE_RAND</a>,<a class="code" href="../../d9/d63/solver__util_8cpp.html#ae0320c3605d4ba7a319164b0c65e9979">TRACE_RAND</a>);
<a name="l00777"></a>00777 <span class="preprocessor">#                   else</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span>                    p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a0a6e6ae4d7899f9bb6fd5a685a794042" title="add vector to position">advance</a>( <a class="code" href="../../d9/d63/solver__util_8cpp.html#ae0320c3605d4ba7a319164b0c65e9979">TRACE_RAND</a>,<a class="code" href="../../d9/d63/solver__util_8cpp.html#ae0320c3605d4ba7a319164b0c65e9979">TRACE_RAND</a>, 0.);
<a name="l00779"></a>00779 <span class="preprocessor">#                   endif</span>
<a name="l00780"></a>00780 <span class="preprocessor"></span>
<a name="l00781"></a>00781                 } <span class="keywordflow">else</span> {
<a name="l00782"></a>00782                     <span class="comment">// move inwards along normal, make sure normal is valid first</span>
<a name="l00783"></a>00783                     <span class="comment">// todo use class funcs!</span>
<a name="l00784"></a>00784                     <span class="keyword">const</span> <span class="keywordtype">int</span> lev = level;
<a name="l00785"></a>00785                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nx=0.,ny=0.,nz=0., nv1,nv2;
<a name="l00786"></a>00786                     <span class="keywordtype">bool</span> nonorm = <span class="keyword">false</span>;
<a name="l00787"></a>00787                     <span class="keywordflow">if</span>(i&lt;=0)              { nx = -1.; nonorm = <span class="keyword">true</span>; }
<a name="l00788"></a>00788                     <span class="keywordflow">if</span>(i&gt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-1) { nx =  1.; nonorm = <span class="keyword">true</span>; }
<a name="l00789"></a>00789                     <span class="keywordflow">if</span>(j&lt;=0)              { ny = -1.; nonorm = <span class="keyword">true</span>; }
<a name="l00790"></a>00790                     <span class="keywordflow">if</span>(j&gt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>-1) { ny =  1.; nonorm = <span class="keyword">true</span>; }
<a name="l00791"></a>00791 <span class="preprocessor">#                   if LBMDIM==3</span>
<a name="l00792"></a>00792 <span class="preprocessor"></span>                    <span class="keywordflow">if</span>(k&lt;=0)              { nz = -1.; nonorm = <span class="keyword">true</span>; }
<a name="l00793"></a>00793                     <span class="keywordflow">if</span>(k&gt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>-1) { nz =  1.; nonorm = <span class="keyword">true</span>; }
<a name="l00794"></a>00794 <span class="preprocessor">#                   endif // LBMDIM==3</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span>                    <span class="keywordflow">if</span>(!nonorm) {
<a name="l00796"></a>00796                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">FFGET_NORM</a>(nv1,<a class="code" href="../../d1/d24/solver__class_8h.html#a7c88964022af72871b9fed013b1ddc8f">dE</a>); <a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">FFGET_NORM</a>(nv2,<a class="code" href="../../d1/d24/solver__class_8h.html#a44be9b1eefe60b7e27b556d88abcc6f4">dW</a>);
<a name="l00797"></a>00797                         nx = 0.5* (nv2-nv1);
<a name="l00798"></a>00798                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">FFGET_NORM</a>(nv1,<a class="code" href="../../d1/d24/solver__class_8h.html#ac31c474a9697f863a9dfbe46db76b415">dN</a>); <a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">FFGET_NORM</a>(nv2,<a class="code" href="../../d1/d24/solver__class_8h.html#ac46cfcc8d7eaa4512d9841b305fbe4a4">dS</a>);
<a name="l00799"></a>00799                         ny = 0.5* (nv2-nv1);
<a name="l00800"></a>00800 <span class="preprocessor">#                       if LBMDIM==3</span>
<a name="l00801"></a>00801 <span class="preprocessor"></span>                        <a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">FFGET_NORM</a>(nv1,<a class="code" href="../../d1/d24/solver__class_8h.html#a9089721cd57ed2f745c1f7e29c07b100">dT</a>); <a class="code" href="../../d9/d63/solver__util_8cpp.html#a87108840253ee03c19191f3ed65c532a">FFGET_NORM</a>(nv2,<a class="code" href="../../d1/d24/solver__class_8h.html#ab27d62f5a54da9ba6aa17c4c3ed57b30">dB</a>);
<a name="l00802"></a>00802                         nz = 0.5* (nv2-nv1);
<a name="l00803"></a>00803 <span class="preprocessor">#                       else // LBMDIM==3</span>
<a name="l00804"></a>00804 <span class="preprocessor"></span>                        nz = 0.;
<a name="l00805"></a>00805 <span class="preprocessor">#                       endif // LBMDIM==3</span>
<a name="l00806"></a>00806 <span class="preprocessor"></span>                    } <span class="keywordflow">else</span> {
<a name="l00807"></a>00807                         v = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>() + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].gravity);
<a name="l00808"></a>00808                     }
<a name="l00809"></a>00809                     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a4e582c76f25020f53aa018a210582bb6">advanceVec</a>( (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(nx,ny,nz)) * -0.1 ); <span class="comment">// + vec2G(mLevel[level].gravity);</span>
<a name="l00810"></a>00810                 }
<a name="l00811"></a>00811             }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>( v );
<a name="l00814"></a>00814             p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a24e68f518302f4d9839ab1a170a4793c" title="advance with own velocity">advanceVel</a>();
<a name="l00815"></a>00815         } 
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="comment">// drop handling</span>
<a name="l00818"></a>00818         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#aa34c342137a60a8d1b9504cea2791919">PART_DROP</a>) {
<a name="l00819"></a>00819             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> v = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>(); <span class="comment">// dampen...</span>
<a name="l00820"></a>00820 
<a name="l00821"></a>00821             <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a0e5f18391be45ce21aaa215fe24ebe09">mPartUsePhysModel</a>) {
<a name="l00822"></a>00822                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> radius = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>() * minDropSize;
<a name="l00823"></a>00823                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   velPart = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>()) *cellsize /timestep; <span class="comment">// * cellsize / timestep; // L2RW, lattice velocity</span>
<a name="l00824"></a>00824                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   velRel = velAir - velPart;
<a name="l00825"></a>00825                 <span class="comment">//LbmVec   velRelLat = velRel /cellsize*timestep; // L2RW</span>
<a name="l00826"></a>00826                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> velRelNorm = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(velRel);
<a name="l00827"></a>00827                 <span class="comment">// TODO calculate values in lattice units, compute CD?!??!</span>
<a name="l00828"></a>00828                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> mb = rhoWater * 4.0/3.0 * <a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>* radius*radius*radius; <span class="comment">// mass: 4/3 pi r^3 rho</span>
<a name="l00829"></a>00829                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rw = (r1-radius)/(r1-r2);
<a name="l00830"></a>00830                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rmax = (0.5 + 0.5*rw);
<a name="l00831"></a>00831                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> vmax = (v2 + (v1-v2)* (1.0-rw) );
<a name="l00832"></a>00832                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cd = (rmax) * (velRelNorm)/(vmax);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> fg = rwgrav * mb;<span class="comment">//  * (1.0-rhoAir/rhoWater);</span>
<a name="l00835"></a>00835                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> fd = velRel* velRelNorm* cd*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> *rhoAir *0.5 *radius*radius;
<a name="l00836"></a>00836                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> change = (fg+   fd ) *timestep / mb  *(timestep/cellsize);
<a name="l00837"></a>00837                 <span class="comment">//if(k&gt;0) { errMsg(&quot;\nPIT&quot;,&quot;NTEST1   mb=&quot;&lt;&lt;mb&lt;&lt;&quot; radius=&quot;&lt;&lt;radius&lt;&lt;&quot; vn=&quot;&lt;&lt;velRelNorm&lt;&lt;&quot; velPart=&quot;&lt;&lt;velPart&lt;&lt;&quot; velRel&quot;&lt;&lt;velRel&lt;&lt;&quot; pgetVel=&quot;&lt;&lt;p-&gt;getVel() ); }</span>
<a name="l00838"></a>00838 
<a name="l00839"></a>00839                 v += <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(change);
<a name="l00840"></a>00840                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>(v); 
<a name="l00841"></a>00841                 <span class="comment">// NEW</span>
<a name="l00842"></a>00842             } <span class="keywordflow">else</span> {
<a name="l00843"></a>00843                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>( v ); 
<a name="l00844"></a>00844                 <span class="keywordtype">int</span> gravk = (int)(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>()[2]+<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[2]);
<a name="l00845"></a>00845                 <span class="keywordflow">if</span>(gravk&gt;=0 &amp;&amp; gravk&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a> &amp;&amp; <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,gravk, workSet)&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>) {
<a name="l00846"></a>00846                     <span class="comment">// dont add for &quot;resting&quot; parts</span>
<a name="l00847"></a>00847                     v[2] = 0.;
<a name="l00848"></a>00848                     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>( v*0.9 ); <span class="comment">// restdamping</span>
<a name="l00849"></a>00849                 } <span class="keywordflow">else</span> {
<a name="l00850"></a>00850                     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a25997e93a08e33a35bb0a26f5139e490" title="add acceleration to velocity">addToVel</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].gravity) );
<a name="l00851"></a>00851                 }
<a name="l00852"></a>00852             } <span class="comment">// OLD</span>
<a name="l00853"></a>00853             p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a24e68f518302f4d9839ab1a170a4793c" title="advance with own velocity">advanceVel</a>();
<a name="l00854"></a>00854 
<a name="l00855"></a>00855             <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a60442421df8a831283965e094fea1c61" title="get status (higher byte)">getStatus</a>()&amp;<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>) { <span class="comment">// IN</span>
<a name="l00856"></a>00856                 <span class="keywordflow">if</span>(k&lt;cutval) { <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; <span class="keywordflow">continue</span>; }
<a name="l00857"></a>00857                 <span class="keywordflow">if</span>(k&lt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>-1-cutval){ 
<a name="l00858"></a>00858                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> pflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet);
<a name="l00859"></a>00859                     <span class="comment">//errMsg(&quot;PIT move&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; flag&quot;&lt;&lt;convertCellFlagType2String(pflag) );</span>
<a name="l00860"></a>00860                     <span class="keywordflow">if</span>(pflag &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>)) {
<a name="l00861"></a>00861                         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55d2fb00f7fd9e8e3e64c9ff06f3204b">handleObstacleParticle</a>(p);
<a name="l00862"></a>00862                         <span class="keywordflow">continue</span>;
<a name="l00863"></a>00863                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pflag &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) {
<a name="l00864"></a>00864                         <span class="comment">// still ok</span>
<a name="l00865"></a>00865                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((pflag &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) 
<a name="l00866"></a>00866                               <span class="comment">//&amp;&amp;(!(RFLAG(level, i,j,k, workSet)&amp; CFNoNbFluid)) </span>
<a name="l00867"></a>00867                                         ) {
<a name="l00868"></a>00868                         <span class="comment">// add to no nb fluid i.f.&#39;s, so skip if interface with fluid nb</span>
<a name="l00869"></a>00869                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pflag  &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>|CFInter) ){ <span class="comment">// interface cells ignored here due to previous check!</span>
<a name="l00870"></a>00870                         <span class="comment">// add dropmass again, (these are only interf. with nonbfl.)</span>
<a name="l00871"></a>00871                         <span class="keywordtype">int</span> oi= (int)(pos[0]-1.25*v[0]+0.5);
<a name="l00872"></a>00872                         <span class="keywordtype">int</span> oj= (int)(pos[1]-1.25*v[1]+0.5);
<a name="l00873"></a>00873                         <span class="keywordtype">int</span> ok= (int)(pos[2]-1.25*v[2]+0.5);
<a name="l00874"></a>00874                         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>();
<a name="l00875"></a>00875                         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> dropmass = <a class="code" href="../../d5/d15/classParticleObject.html#aab9cc6e259f23d202bb762cf689c3bc0">ParticleObject::getMass</a>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a96b365a3ed6985783709033fc3ebeb18">mPartDropMassSub</a>*size);
<a name="l00876"></a>00876                         <span class="keywordtype">bool</span> orgcellok = <span class="keyword">false</span>;
<a name="l00877"></a>00877                         <span class="keywordflow">if</span>( (oi&lt;0)||(oi&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-1)||
<a name="l00878"></a>00878                             (oj&lt;0)||(oj&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>-1)||
<a name="l00879"></a>00879                             (ok&lt;0)||(ok&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>-1) ) {
<a name="l00880"></a>00880                             <span class="comment">// org cell not ok!</span>
<a name="l00881"></a>00881                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, oi,oj,ok, workSet) &amp; (CFInter) ){
<a name="l00882"></a>00882                             orgcellok = <span class="keyword">true</span>;
<a name="l00883"></a>00883                         } <span class="keywordflow">else</span> {
<a name="l00884"></a>00884                             <span class="comment">// search upward for interface</span>
<a name="l00885"></a>00885                             oi=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; oj=j; ok=k;
<a name="l00886"></a>00886                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kk=0; kk&lt;5 &amp;&amp; ok&lt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>-2; kk++) {
<a name="l00887"></a>00887                                 ok++; <span class="comment">// check sizez-2 due to this increment!</span>
<a name="l00888"></a>00888                                 <span class="keywordflow">if</span>( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, oi,oj,ok, workSet) &amp; (CFInter) ){
<a name="l00889"></a>00889                                     kk = 5; orgcellok = <span class="keyword">true</span>;
<a name="l00890"></a>00890                                 }
<a name="l00891"></a>00891                             }
<a name="l00892"></a>00892                         }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894                         <span class="comment">//errMsg(&quot;PTIMPULSE&quot;,&quot; new v&quot;&lt;&lt;v&lt;&lt;&quot; at &quot;&lt;&lt;PRINT_VEC(oi,oj,ok)&lt;&lt;&quot; , was &quot;&lt;&lt;PRINT_VEC(i,j,k)&lt;&lt;&quot; ok &quot;&lt;&lt;orgcellok );</span>
<a name="l00895"></a>00895                         <span class="keywordflow">if</span>(orgcellok) {
<a name="l00896"></a>00896                             <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, oi,oj,ok, workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) += dropmass;
<a name="l00897"></a>00897                             <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, oi,oj,ok, workSet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) += dropmass; <span class="comment">// assume rho=1?</span>
<a name="l00898"></a>00898 
<a name="l00899"></a>00899                             <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, oi,oj,ok, workSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>){
<a name="l00900"></a>00900                             <span class="comment">// check speed, perhaps normalize</span>
<a name="l00901"></a>00901                             <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> vlensqr = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(v);
<a name="l00902"></a>00902                             <span class="keywordflow">if</span>(vlensqr &gt; 0.166*0.166) {
<a name="l00903"></a>00903                                 v *= 1./<a class="code" href="../../d9/d63/solver__util_8cpp.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>((<span class="keywordtype">float</span>)vlensqr)*0.166;
<a name="l00904"></a>00904                             }
<a name="l00905"></a>00905                             <span class="comment">// compute cell velocity</span>
<a name="l00906"></a>00906                             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *tcel = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(level, oi,oj,ok, workSet);
<a name="l00907"></a>00907                             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> velUx=0., velUy=0., velUz=0.;
<a name="l00908"></a>00908                             <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> { 
<a name="l00909"></a>00909                                 velUx  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]*<a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel,l));
<a name="l00910"></a>00910                                 velUy  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]*<a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel,l)); 
<a name="l00911"></a>00911                                 velUz  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]*<a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(tcel,l)); 
<a name="l00912"></a>00912                             }
<a name="l00913"></a>00913                             <span class="comment">// add impulse</span>
<a name="l00914"></a>00914                             <span class="comment">/*</span>
<a name="l00915"></a>00915 <span class="comment">                            LbmFloat cellVelSqr = velUx*velUx+ velUy*velUy+ velUz*velUz;</span>
<a name="l00916"></a>00916 <span class="comment">                            //errMsg(&quot;PTIMPULSE&quot;,&quot; new v&quot;&lt;&lt;v&lt;&lt;&quot; cvs&quot;&lt;&lt;cellVelSqr&lt;&lt;&quot;=&quot;&lt;&lt;sqrt(cellVelSqr));</span>
<a name="l00917"></a>00917 <span class="comment">                            if(cellVelSqr&lt; 0.166*0.166) {</span>
<a name="l00918"></a>00918 <span class="comment">                                FORDF1 { </span>
<a name="l00919"></a>00919 <span class="comment">                                    const LbmFloat add = 3. * dropmass * this-&gt;dfLength[l]*(v[0]*this-&gt;dfDvecX[l]+v[1]*this-&gt;dfDvecY[l]+v[2]*this-&gt;dfDvecZ[l]);</span>
<a name="l00920"></a>00920 <span class="comment">                                    RAC(tcel,l) += add;</span>
<a name="l00921"></a>00921 <span class="comment">                                } } // */</span>
<a name="l00922"></a>00922                             } <span class="comment">// only add impulse away from obstacles! </span>
<a name="l00923"></a>00923                         } <span class="comment">// orgcellok</span>
<a name="l00924"></a>00924 
<a name="l00925"></a>00925                         <span class="comment">// FIXME make fsgr treatment</span>
<a name="l00926"></a>00926                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#a977448711f668fb7fd49cc4743ff2a51">P_CHANGETYPE</a>(p, <a class="code" href="../../d0/d69/particletracer_8h.html#aa583a8e6c70a28f43ac14cbe6313be2d">PART_FLOAT</a> ); <span class="keywordflow">continue</span>; 
<a name="l00927"></a>00927                         <span class="comment">// jitter in cell to prevent stacking when hitting a steep surface</span>
<a name="l00928"></a>00928                         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> cpos = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>(); 
<a name="l00929"></a>00929                         cpos[0] += (rand()/(RAND_MAX+1.0))-0.5;
<a name="l00930"></a>00930                         cpos[1] += (rand()/(RAND_MAX+1.0))-0.5; 
<a name="l00931"></a>00931                         cpos[2] += (rand()/(RAND_MAX+1.0))-0.5; 
<a name="l00932"></a>00932                         p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1054c2da309bde3c8a4d5ee8c60121a1">setPos</a>(cpos);
<a name="l00933"></a>00933                     } <span class="keywordflow">else</span> {
<a name="l00934"></a>00934                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>;
<a name="l00935"></a>00935                         this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6896994c7e29bf77d61121c885de38f5">mNumParticlesLost</a>++;
<a name="l00936"></a>00936                     }
<a name="l00937"></a>00937                 }
<a name="l00938"></a>00938             } <span class="keywordflow">else</span> { <span class="comment">// OUT</span>
<a name="l00939"></a>00939 <span class="preprocessor">#               if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00940"></a>00940 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(useff) { mpTest-&gt;handleParticle(p, i,j,k); }
<a name="l00941"></a>00941                 <span class="keywordflow">else</span>{ <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; }
<a name="l00942"></a>00942 <span class="preprocessor">#               else // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00943"></a>00943 <span class="preprocessor"></span>                <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l00944"></a>00944 <span class="preprocessor">#               endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l00945"></a>00945 <span class="preprocessor"></span>            }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947         } <span class="comment">// air particle</span>
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         <span class="comment">// inter particle</span>
<a name="l00950"></a>00950         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#a4b3ac62b009fe515c8244b785c9df029">PART_INTER</a>) {
<a name="l00951"></a>00951             <span class="comment">// unused!?</span>
<a name="l00952"></a>00952             <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a60442421df8a831283965e094fea1c61" title="get status (higher byte)">getStatus</a>()&amp;<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>) { <span class="comment">// IN</span>
<a name="l00953"></a>00953                 <span class="keywordflow">if</span>((k&lt;cutval)||(k&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>-1-cutval)) {
<a name="l00954"></a>00954                     <span class="comment">// undecided particle above or below... remove?</span>
<a name="l00955"></a>00955                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l00956"></a>00956                 }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> pflag = <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet);
<a name="l00959"></a>00959                 <span class="keywordflow">if</span>(pflag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a> ) {
<a name="l00960"></a>00960                     <span class="comment">// still ok</span>
<a name="l00961"></a>00961                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pflag&amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>) ) {
<a name="l00962"></a>00962                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#a977448711f668fb7fd49cc4743ff2a51">P_CHANGETYPE</a>(p, <a class="code" href="../../d0/d69/particletracer_8h.html#aa583a8e6c70a28f43ac14cbe6313be2d">PART_FLOAT</a> ); <span class="keywordflow">continue</span>;
<a name="l00963"></a>00963                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pflag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a> ) {
<a name="l00964"></a>00964                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#a977448711f668fb7fd49cc4743ff2a51">P_CHANGETYPE</a>(p, <a class="code" href="../../d0/d69/particletracer_8h.html#aa34c342137a60a8d1b9504cea2791919">PART_DROP</a> ); <span class="keywordflow">continue</span>;
<a name="l00965"></a>00965                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pflag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a> ) {
<a name="l00966"></a>00966                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#a977448711f668fb7fd49cc4743ff2a51">P_CHANGETYPE</a>(p, <a class="code" href="../../d0/d69/particletracer_8h.html#aa583a8e6c70a28f43ac14cbe6313be2d">PART_FLOAT</a> ); <span class="keywordflow">continue</span>;
<a name="l00967"></a>00967                 }
<a name="l00968"></a>00968             } <span class="keywordflow">else</span> { <span class="comment">// OUT</span>
<a name="l00969"></a>00969                 <span class="comment">// undecided particle outside... remove?</span>
<a name="l00970"></a>00970                 <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l00971"></a>00971             }
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974         <span class="comment">// float particle</span>
<a name="l00975"></a>00975         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aff157178290896627ee05459a8019eed" title="get type (lower byte)">getType</a>()==<a class="code" href="../../d0/d69/particletracer_8h.html#aa583a8e6c70a28f43ac14cbe6313be2d">PART_FLOAT</a>) {
<a name="l00976"></a>00976 
<a name="l00977"></a>00977             <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a60442421df8a831283965e094fea1c61" title="get status (higher byte)">getStatus</a>()&amp;<a class="code" href="../../d0/d69/particletracer_8h.html#a1cfbfeb8d8bcbede78dd8ead8420b237">PART_IN</a>) { <span class="comment">// IN</span>
<a name="l00978"></a>00978                 <span class="keywordflow">if</span>(k&lt;cutval) <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l00979"></a>00979                 <span class="comment">// not valid for mass... </span>
<a name="l00980"></a>00980                 vx = vy = vz = 0.0;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982                 <span class="comment">// define from particletracer.h</span>
<a name="l00983"></a>00983 <span class="preprocessor">#if MOVE_FLOATS==1</span>
<a name="l00984"></a>00984 <span class="preprocessor"></span>                <span class="keyword">const</span> <span class="keywordtype">int</span> DEPTH_AVG=3; <span class="comment">// only average interface vels</span>
<a name="l00985"></a>00985                 <span class="keywordtype">int</span> ccnt=0;
<a name="l00986"></a>00986                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kk=0;kk&lt;DEPTH_AVG;kk+=1) {
<a name="l00987"></a>00987                     <span class="keywordflow">if</span>((k-kk)&lt;1) <span class="keywordflow">continue</span>;
<a name="l00988"></a>00988                     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {} <span class="keywordflow">else</span> <span class="keywordflow">continue</span>;
<a name="l00989"></a>00989                     ccnt++;
<a name="l00990"></a>00990                     <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a>{
<a name="l00991"></a>00991                         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cdf = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(level, i,j,k-kk, workSet, l);
<a name="l00992"></a>00992                         vx  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]*cdf); 
<a name="l00993"></a>00993                         vy  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]*cdf);  
<a name="l00994"></a>00994                         vz  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]*cdf);  
<a name="l00995"></a>00995                     }
<a name="l00996"></a>00996                 }
<a name="l00997"></a>00997                 <span class="keywordflow">if</span>(ccnt) {
<a name="l00998"></a>00998                 <span class="comment">// use halved surface velocity (todo, use omega instead)</span>
<a name="l00999"></a>00999                 vx /=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(ccnt * 2.0); <span class="comment">// half xy speed! value2</span>
<a name="l01000"></a>01000                 vy /=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(ccnt * 2.0);
<a name="l01001"></a>01001                 vz /=(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)(ccnt); }
<a name="l01002"></a>01002 <span class="preprocessor">#else // MOVE_FLOATS==1</span>
<a name="l01003"></a>01003 <span class="preprocessor"></span>                vx=vy=0.; <span class="comment">//p-&gt;setVel(ntlVec3Gfx(0.) ); // static_float</span>
<a name="l01004"></a>01004 <span class="preprocessor">#endif // MOVE_FLOATS==1</span>
<a name="l01005"></a>01005 <span class="preprocessor"></span>                vx += (rand()/(RAND_MAX+1.0))*(<a class="code" href="../../d0/d69/particletracer_8h.html#a2a9966e1562f7169f5fb505e5e6280f0">FLOAT_JITTER</a>*0.2)-(<a class="code" href="../../d0/d69/particletracer_8h.html#a2a9966e1562f7169f5fb505e5e6280f0">FLOAT_JITTER</a>*0.2*0.5);
<a name="l01006"></a>01006                 vy += (rand()/(RAND_MAX+1.0))*(<a class="code" href="../../d0/d69/particletracer_8h.html#a2a9966e1562f7169f5fb505e5e6280f0">FLOAT_JITTER</a>*0.2)-(<a class="code" href="../../d0/d69/particletracer_8h.html#a2a9966e1562f7169f5fb505e5e6280f0">FLOAT_JITTER</a>*0.2*0.5);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008                 <span class="comment">//bool delfloat = false;</span>
<a name="l01009"></a>01009                 <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet)&amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>) ) ) {
<a name="l01010"></a>01010                     <span class="comment">// in fluid cell</span>
<a name="l01011"></a>01011                     vz = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>()[2]-1.0*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[2]; <span class="comment">// simply rise...</span>
<a name="l01012"></a>01012                     <span class="keywordflow">if</span>(vz&lt;0.) vz=0.;
<a name="l01013"></a>01013                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a> ) ) {
<a name="l01014"></a>01014                     <span class="comment">// force downwards movement, move below obstacle...</span>
<a name="l01015"></a>01015                     <span class="comment">//vz = p-&gt;getVel()[2]+1.0*mLevel[level].gravity[2]; // fall...</span>
<a name="l01016"></a>01016                     <span class="comment">//if(vz&gt;0.) vz=0.;</span>
<a name="l01017"></a>01017                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l01018"></a>01018                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, workSet)&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a> ) ) {
<a name="l01019"></a>01019                     <span class="comment">// keep in interface , one grid cell offset is added in part. gen</span>
<a name="l01020"></a>01020                 } <span class="keywordflow">else</span> { <span class="comment">// all else...</span>
<a name="l01021"></a>01021                     <span class="keywordflow">if</span>( ( <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k-1, workSet)&amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|CFInter) ) ) {
<a name="l01022"></a>01022                         vz = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>()[2]+2.0*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aee10f28f4bb002854da33f2d08053df1" title="gravity force for this level">gravity</a>[2]; <span class="comment">// fall...</span>
<a name="l01023"></a>01023                         <span class="keywordflow">if</span>(vz&gt;0.) vz=0.; }
<a name="l01024"></a>01024                     <span class="keywordflow">else</span> { <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; }
<a name="l01025"></a>01025                 }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(vx,vy,vz) ) ); <span class="comment">//?</span>
<a name="l01028"></a>01028                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a24e68f518302f4d9839ab1a170a4793c" title="advance with own velocity">advanceVel</a>();
<a name="l01029"></a>01029             } <span class="keywordflow">else</span> {
<a name="l01030"></a>01030 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01031"></a>01031 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(useff) { mpTest-&gt;handleParticle(p, i,j,k); }
<a name="l01032"></a>01032                 <span class="keywordflow">else</span> <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l01033"></a>01033 <span class="preprocessor">#else // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01034"></a>01034 <span class="preprocessor"></span>                <a class="code" href="../../d9/d63/solver__util_8cpp.html#ab3f3687a9f6a4f517bb974d100dde81d">DEL_PART</a>; 
<a name="l01035"></a>01035 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01036"></a>01036 <span class="preprocessor"></span>            }
<a name="l01037"></a>01037                 
<a name="l01038"></a>01038             <span class="comment">// additional bnd jitter</span>
<a name="l01039"></a>01039             <span class="keywordflow">if</span>((0) &amp;&amp; (useff) &amp;&amp; (p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ae275580a67b213577b3facd4f3f045f9" title="get/set lifetime">getLifeTime</a>()&lt;3.*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>)) {
<a name="l01040"></a>01040                 <span class="comment">// use half butoff border 1/8</span>
<a name="l01041"></a>01041                 <span class="keywordtype">int</span> maxdw = (int)(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizex*0.125*0.5);
<a name="l01042"></a>01042                 <span class="keywordflow">if</span>(maxdw&lt;3) maxdw=3;
<a name="l01043"></a>01043                 <span class="keywordflow">if</span>((j&gt;=0)&amp;&amp;(j&lt;=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>-1)) {
<a name="l01044"></a>01044                     <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(i-(               cutval))&lt;maxdw) { p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a0a6e6ae4d7899f9bb6fd5a685a794042" title="add vector to position">advance</a>(  <a class="code" href="../../d9/d63/solver__util_8cpp.html#adcaa31cff864d63850a996bab81a62da">FLOAT_JITTBNDRAND</a>( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(i-(               cutval))), 0.,0.); }
<a name="l01045"></a>01045                     <span class="keywordflow">if</span>(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(i-(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-1-cutval))&lt;maxdw) { p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a0a6e6ae4d7899f9bb6fd5a685a794042" title="add vector to position">advance</a>(  <a class="code" href="../../d9/d63/solver__util_8cpp.html#adcaa31cff864d63850a996bab81a62da">FLOAT_JITTBNDRAND</a>( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(i-(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>-1-cutval))), 0.,0.); }
<a name="l01046"></a>01046                 }
<a name="l01047"></a>01047             }
<a name="l01048"></a>01048         }  <span class="comment">// PART_FLOAT</span>
<a name="l01049"></a>01049         
<a name="l01050"></a>01050         <span class="comment">// unknown particle type    </span>
<a name="l01051"></a>01051         <span class="keywordflow">else</span> {
<a name="l01052"></a>01052             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::advanceParticles&quot;</span>,<span class="stringliteral">&quot;PIT pit invalid type!? &quot;</span>&lt;&lt;p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a60442421df8a831283965e094fea1c61" title="get status (higher byte)">getStatus</a>() );
<a name="l01053"></a>01053         }
<a name="l01054"></a>01054   }
<a name="l01055"></a>01055     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> parttend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l01056"></a>01056     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::advanceParticles&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Time for particle update:&quot;</span>&lt;&lt; <a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(parttend-parttstart)&lt;&lt;<span class="stringliteral">&quot;, #particles:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a8f69f240778943a3dfb30f4720ed98fb" title="get the number of particles">getNumParticles</a>() , 10 );
<a name="l01057"></a>01057 }
<a name="l01058"></a>01058 
<a name="l01059"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a575f48db484157f18b927f2c95962c14">01059</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a575f48db484157f18b927f2c95962c14" title="notify object that dump is in progress (e.g. for field dump)">LbmFsgrSolver::notifySolverOfDump</a>(<span class="keywordtype">int</span> dumptype, <span class="keywordtype">int</span> frameNr,<span class="keywordtype">char</span> *frameNrStr,<span class="keywordtype">string</span> outfilename) {
<a name="l01060"></a>01060     <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l01061"></a>01061     std::ostringstream name;
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     <span class="comment">// debug - raw dump of ffrac values, as text!</span>
<a name="l01064"></a>01064     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a9ed14e7f547e4f00560656b2a58daa46" title="dumping modes">mDumpRawText</a>) { 
<a name="l01065"></a>01065         name &lt;&lt; outfilename&lt;&lt; frameNrStr &lt;&lt;<span class="stringliteral">&quot;.dump&quot;</span>;
<a name="l01066"></a>01066         FILE *file = fopen(name.str().c_str(),<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01067"></a>01067         <span class="keywordflow">if</span>(file) {
<a name="l01068"></a>01068 
<a name="l01069"></a>01069             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>); ++k)  {
<a name="l01070"></a>01070                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++)  {
<a name="l01071"></a>01071                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01072"></a>01072                         <span class="keywordtype">float</span> val = 0.;
<a name="l01073"></a>01073                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) {
<a name="l01074"></a>01074                             val = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr,<a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>);
<a name="l01075"></a>01075                             <span class="keywordflow">if</span>(val&lt;0.) val=0.;
<a name="l01076"></a>01076                             <span class="keywordflow">if</span>(val&gt;1.) val=1.;
<a name="l01077"></a>01077                         }
<a name="l01078"></a>01078                         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) val = 1.;
<a name="l01079"></a>01079                         fprintf(file, <span class="stringliteral">&quot;%f &quot;</span>,val); <span class="comment">// text</span>
<a name="l01080"></a>01080                         <span class="comment">//errMsg(&quot;W&quot;, PRINT_IJK&lt;&lt;&quot; val:&quot;&lt;&lt;val);</span>
<a name="l01081"></a>01081                     }
<a name="l01082"></a>01082                     fprintf(file, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// text</span>
<a name="l01083"></a>01083                 }
<a name="l01084"></a>01084                 fprintf(file, <span class="stringliteral">&quot;\n&quot;</span>); <span class="comment">// text</span>
<a name="l01085"></a>01085             }
<a name="l01086"></a>01086             fclose(file);
<a name="l01087"></a>01087 
<a name="l01088"></a>01088         } <span class="comment">// file</span>
<a name="l01089"></a>01089     } <span class="comment">// */</span>
<a name="l01090"></a>01090 
<a name="l01091"></a>01091     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5a2eb6e2684e9658d1e5abd2d19da7f5">mDumpRawBinary</a>) {
<a name="l01092"></a>01092         <span class="keywordflow">if</span>(!<a class="code" href="../../db/dff/classLbmSolverInterface.html#a09be11393243c0937676db2efbb90063">mDumpRawBinaryZip</a>) {
<a name="l01093"></a>01093             <span class="comment">// unzipped, only fill</span>
<a name="l01094"></a>01094             name &lt;&lt; outfilename&lt;&lt; frameNrStr &lt;&lt;<span class="stringliteral">&quot;.bdump&quot;</span>;
<a name="l01095"></a>01095             FILE *file = fopen(name.str().c_str(),<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01096"></a>01096             <span class="keywordflow">if</span>(file) {
<a name="l01097"></a>01097                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>); ++k)  {
<a name="l01098"></a>01098                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>-0;j++)  {
<a name="l01099"></a>01099                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>-0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01100"></a>01100                             <span class="keywordtype">float</span> val = 0.;
<a name="l01101"></a>01101                             <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) {
<a name="l01102"></a>01102                                 val = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].setCurr,<a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>);
<a name="l01103"></a>01103                                 <span class="keywordflow">if</span>(val&lt;0.) val=0.;
<a name="l01104"></a>01104                                 <span class="keywordflow">if</span>(val&gt;1.) val=1.;
<a name="l01105"></a>01105                             }
<a name="l01106"></a>01106                             <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet) &amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) val = 1.;
<a name="l01107"></a>01107                             fwrite( &amp;val, <span class="keyword">sizeof</span>(val), 1, file); <span class="comment">// binary</span>
<a name="l01108"></a>01108                         }
<a name="l01109"></a>01109                     }
<a name="l01110"></a>01110                 }
<a name="l01111"></a>01111                 fclose(file);
<a name="l01112"></a>01112             } <span class="comment">// file</span>
<a name="l01113"></a>01113         } <span class="comment">// unzipped</span>
<a name="l01114"></a>01114         <span class="keywordflow">else</span> {
<a name="l01115"></a>01115             <span class="comment">// zipped, use iso values</span>
<a name="l01116"></a>01116             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a392e35e14aa1e21488853086c0a50ff1" title="for raytracing, preprocess">prepareVisualization</a>();
<a name="l01117"></a>01117             name &lt;&lt; outfilename&lt;&lt; frameNrStr &lt;&lt;<span class="stringliteral">&quot;.bdump.gz&quot;</span>;
<a name="l01118"></a>01118             gzFile gzf = gzopen(name.str().c_str(),<span class="stringliteral">&quot;wb9&quot;</span>);
<a name="l01119"></a>01119             <span class="keywordflow">if</span>(gzf) {
<a name="l01120"></a>01120                 <span class="comment">// write size</span>
<a name="l01121"></a>01121                 <span class="keywordtype">int</span> s;
<a name="l01122"></a>01122                 s=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a6c95b1f65877b7605046bb8f7ff19257">mSizex</a>;   gzwrite(gzf, &amp;s, <span class="keyword">sizeof</span>(s));
<a name="l01123"></a>01123                 s=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5afdd08e7db9e06e186eeadf4abe918e">mSizey</a>;   gzwrite(gzf, &amp;s, <span class="keyword">sizeof</span>(s));
<a name="l01124"></a>01124                 s=<a class="code" href="../../db/dff/classLbmSolverInterface.html#a60ade6ab109112eeb2fce766c258eb7e">mSizez</a>;   gzwrite(gzf, &amp;s, <span class="keyword">sizeof</span>(s));
<a name="l01125"></a>01125 
<a name="l01126"></a>01126                 <span class="comment">// write isovalues</span>
<a name="l01127"></a>01127                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(); k&lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>); ++k)  {
<a name="l01128"></a>01128                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>;j++)  {
<a name="l01129"></a>01129                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01130"></a>01130                             <span class="keywordtype">float</span> val = 0.;
<a name="l01131"></a>01131                             val = *<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5b36096d976b2acc4f559ce3e371f3ee" title="Mcubes object for surface reconstruction.">mpIso</a>-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a6f8ab3d8ac01f31120c3f139d3656965">lbmGetData</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k );
<a name="l01132"></a>01132                             gzwrite(gzf, &amp;val, <span class="keyword">sizeof</span>(val));
<a name="l01133"></a>01133                         }
<a name="l01134"></a>01134                     }
<a name="l01135"></a>01135                 }
<a name="l01136"></a>01136                 gzclose(gzf);
<a name="l01137"></a>01137             } <span class="comment">// gzf</span>
<a name="l01138"></a>01138         } <span class="comment">// zip</span>
<a name="l01139"></a>01139     } <span class="comment">// bin dump</span>
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     dumptype = 0; frameNr = 0; <span class="comment">// get rid of warning</span>
<a name="l01142"></a>01142 }
<a name="l01143"></a>01143 
<a name="l01145"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55d2fb00f7fd9e8e3e64c9ff06f3204b">01145</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55d2fb00f7fd9e8e3e64c9ff06f3204b">LbmFsgrSolver::handleObstacleParticle</a>(<a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>) {
<a name="l01146"></a>01146     <span class="comment">//if(normNoSqrt(v)&lt;=0.) continue; // skip stuck</span>
<a name="l01147"></a>01147     <span class="comment">/*</span>
<a name="l01148"></a>01148 <span class="comment">         p-&gt;setVel( v * -1. ); // revert</span>
<a name="l01149"></a>01149 <span class="comment">         p-&gt;advanceVel(); // move back twice...</span>
<a name="l01150"></a>01150 <span class="comment">         if( RFLAG(mMaxRefine, i,j,k, workSet)&amp; (CFBndNoslip)) {</span>
<a name="l01151"></a>01151 <span class="comment">         p-&gt;setVel( v * -0.5 ); // revert &amp; dampen</span>
<a name="l01152"></a>01152 <span class="comment">         }</span>
<a name="l01153"></a>01153 <span class="comment">         p-&gt;advanceVel();  </span>
<a name="l01154"></a>01154 <span class="comment">    // */</span>
<a name="l01155"></a>01155     <span class="comment">// TODO mark/remove stuck parts!?</span>
<a name="l01156"></a>01156 
<a name="l01157"></a>01157     <span class="keyword">const</span> <span class="keywordtype">int</span> level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01158"></a>01158     <span class="keyword">const</span> <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l01159"></a>01159     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> v = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>( p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>() );
<a name="l01160"></a>01160     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(v)&lt;=0.) { 
<a name="l01161"></a>01161         p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].gravity)); 
<a name="l01162"></a>01162     }
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> pflag = <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>;
<a name="l01165"></a>01165     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> posOrg(p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>());
<a name="l01166"></a>01166     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> npos(0.);
<a name="l01167"></a>01167     <span class="keywordtype">int</span> ni=1,nj=1,nk=1;
<a name="l01168"></a>01168     <span class="keywordtype">int</span> tries = 0;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170     <span class="comment">// try to undo movement</span>
<a name="l01171"></a>01171     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a4e582c76f25020f53aa018a210582bb6">advanceVec</a>( (p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a3ea708c42af32c721f52d130960abc12" title="get velocity">getVel</a>()-<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].gravity)) * -2.);  
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     npos = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>(); ni= (int)npos[0]; 
<a name="l01174"></a>01174     nj= (int)npos[1]; nk= (int)npos[2];
<a name="l01175"></a>01175     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { nk = 0; }
<a name="l01176"></a>01176     <span class="comment">//errMsg(&quot;BOUNDCPAR&quot;,&quot; t&quot;&lt;&lt;PRINT_VEC(ni,nj,nk)&lt;&lt;&quot; v&quot;&lt;&lt;v&lt;&lt;&quot; p&quot;&lt;&lt;npos);</span>
<a name="l01177"></a>01177 
<a name="l01178"></a>01178     <span class="comment">// delete out of domain</span>
<a name="l01179"></a>01179     <span class="keywordflow">if</span>(!<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a9fb26b465f8960a7e71529044dfca1e3">checkDomainBounds</a>(level,ni,nj,nk)) {
<a name="l01180"></a>01180         <span class="comment">//errMsg(&quot;BOUNDCPAR&quot;,&quot; DEL! &quot;);</span>
<a name="l01181"></a>01181         p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a594ffbd7a34396643c12d77a0a6c7a16" title="set active flag">setActive</a>( <span class="keyword">false</span> ); 
<a name="l01182"></a>01182         <span class="keywordflow">return</span>;
<a name="l01183"></a>01183     }
<a name="l01184"></a>01184     pflag =  <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, ni,nj,nk, workSet);
<a name="l01185"></a>01185     
<a name="l01186"></a>01186     <span class="comment">// try to force particle out of boundary</span>
<a name="l01187"></a>01187     <span class="keywordtype">bool</span> haveNorm = <span class="keyword">false</span>;
<a name="l01188"></a>01188     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> bnormal;
<a name="l01189"></a>01189     <span class="keywordflow">if</span>(pflag&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>) {
<a name="l01190"></a>01190         npos = posOrg; ni= (int)npos[0]; 
<a name="l01191"></a>01191         nj= (int)npos[1]; nk= (int)npos[2];
<a name="l01192"></a>01192         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { nk = 0; }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2fee97b68562a4028f43922b1d81161e">computeObstacleSurfaceNormalAcc</a>(ni,nj,nk, &amp;bnormal[0]);
<a name="l01195"></a>01195         haveNorm = <span class="keyword">true</span>;
<a name="l01196"></a>01196         <a class="code" href="../../d1/d22/stdosl_8h.html#a03960008c09030a58b2c79672320cb3f">normalize</a>(bnormal);
<a name="l01197"></a>01197         bnormal *= 0.25;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199         tries = 1;
<a name="l01200"></a>01200         <span class="keywordflow">while</span>(pflag&amp;CFBnd &amp;&amp; tries&lt;=5) {
<a name="l01201"></a>01201             <span class="comment">// use increasing step sizes</span>
<a name="l01202"></a>01202             p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a4e582c76f25020f53aa018a210582bb6">advanceVec</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>( bnormal *0.5 *(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)tries ) );  
<a name="l01203"></a>01203             npos = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>();
<a name="l01204"></a>01204             ni= (int)npos[0]; 
<a name="l01205"></a>01205             nj= (int)npos[1]; 
<a name="l01206"></a>01206             nk= (int)npos[2];
<a name="l01207"></a>01207 
<a name="l01208"></a>01208             <span class="comment">// delete out of domain</span>
<a name="l01209"></a>01209             <span class="keywordflow">if</span>(!<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a9fb26b465f8960a7e71529044dfca1e3">checkDomainBounds</a>(level,ni,nj,nk)) {
<a name="l01210"></a>01210                 <span class="comment">//errMsg(&quot;BOUNDCPAR&quot;,&quot; DEL! &quot;);</span>
<a name="l01211"></a>01211                 p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a594ffbd7a34396643c12d77a0a6c7a16" title="set active flag">setActive</a>( <span class="keyword">false</span> ); 
<a name="l01212"></a>01212                 <span class="keywordflow">return</span>;
<a name="l01213"></a>01213             }
<a name="l01214"></a>01214             pflag =  <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, ni,nj,nk, workSet);
<a name="l01215"></a>01215             tries++;
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218         <span class="comment">// really stuck, delete...</span>
<a name="l01219"></a>01219         <span class="keywordflow">if</span>(pflag&amp;CFBnd) {
<a name="l01220"></a>01220             p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a594ffbd7a34396643c12d77a0a6c7a16" title="set active flag">setActive</a>( <span class="keyword">false</span> ); 
<a name="l01221"></a>01221             <span class="keywordflow">return</span>;
<a name="l01222"></a>01222         }
<a name="l01223"></a>01223     }
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     <span class="comment">// not in bound anymore!</span>
<a name="l01226"></a>01226     <span class="keywordflow">if</span>(!haveNorm) {
<a name="l01227"></a>01227         <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> *bflag = &amp;<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, ni,nj,nk, workSet);
<a name="l01228"></a>01228         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>     *bcell = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(level, ni,nj,nk, workSet);
<a name="l01229"></a>01229         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5f1eddb40c78005c16ae61680cc27fc7">computeObstacleSurfaceNormal</a>(bcell,bflag, &amp;bnormal[0]);
<a name="l01230"></a>01230     }
<a name="l01231"></a>01231     <a class="code" href="../../d1/d22/stdosl_8h.html#a03960008c09030a58b2c79672320cb3f">normalize</a>(bnormal);
<a name="l01232"></a>01232     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> normComp = bnormal * <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(v),bnormal);
<a name="l01233"></a>01233     <span class="comment">//errMsg(&quot;BOUNDCPAR&quot;,&quot;bnormal&quot;&lt;&lt;bnormal&lt;&lt;&quot; normComp&quot;&lt;&lt;normComp&lt;&lt;&quot; newv&quot;&lt;&lt;(v-normComp) );</span>
<a name="l01234"></a>01234     v = (v-normComp)*0.9; <span class="comment">// only move tangential</span>
<a name="l01235"></a>01235     v *= 0.9; <span class="comment">// restdamping , todo use timestep</span>
<a name="l01236"></a>01236     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#ad3c2934de916bb194798f656f8e53e7b" title="set velocity">setVel</a>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(v));
<a name="l01237"></a>01237     p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a24e68f518302f4d9839ab1a170a4793c" title="advance with own velocity">advanceVel</a>();
<a name="l01238"></a>01238 }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 <span class="comment">/*****************************************************************************/</span>
<a name="l01242"></a>01242 <span class="comment">/*****************************************************************************/</span>
<a name="l01243"></a>01243 <span class="keywordtype">void</span> 
<a name="l01244"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a58362bf0afc375950175bc78125b9462">01244</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a58362bf0afc375950175bc78125b9462" title="internal quick print function (for debugging)">LbmFsgrSolver::printLbmCell</a>(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> <span class="keyword">set</span>) {
<a name="l01245"></a>01245     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *newcid = <span class="keyword">new</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3ca0108439d486ccd82d1d2905220638">stdCellId</a>;
<a name="l01246"></a>01246     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> = level;
<a name="l01247"></a>01247     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01248"></a>01248     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> = j;
<a name="l01249"></a>01249     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> = k;
<a name="l01250"></a>01250 
<a name="l01251"></a>01251     <span class="comment">// this function is not called upon clicking, then its from setMouseClick</span>
<a name="l01252"></a>01252     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a280807c1f40c13e806a253b087ef98e7" title="display a single node">debugPrintNodeInfo</a>( newcid, <span class="keyword">set</span> );
<a name="l01253"></a>01253     <span class="keyword">delete</span> newcid;
<a name="l01254"></a>01254 }
<a name="l01255"></a>01255 <span class="keywordtype">void</span> 
<a name="l01256"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5eaa31bae2713b3b595b3dc3da84d2f0">01256</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5eaa31bae2713b3b595b3dc3da84d2f0">LbmFsgrSolver::debugMarkCellCall</a>(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> vi,<span class="keywordtype">int</span> vj,<span class="keywordtype">int</span> vk) {
<a name="l01257"></a>01257     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *newcid = <span class="keyword">new</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3ca0108439d486ccd82d1d2905220638">stdCellId</a>;
<a name="l01258"></a>01258     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> = level;
<a name="l01259"></a>01259     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> = vi;
<a name="l01260"></a>01260     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> = vj;
<a name="l01261"></a>01261     newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> = vk;
<a name="l01262"></a>01262     this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a4156d9a9b92eb9821bc67bd8cbc6bb84" title="add cell to mMarkedCells list">addCellToMarkedList</a>( newcid );
<a name="l01263"></a>01263 }
<a name="l01264"></a>01264 
<a name="l01265"></a>01265         
<a name="l01266"></a>01266 <span class="comment">/*****************************************************************************/</span>
<a name="l01267"></a>01267 <span class="comment">// implement CellIterator&lt;UniformFsgrCellIdentifier&gt; interface</span>
<a name="l01268"></a>01268 <span class="comment">/*****************************************************************************/</span>
<a name="l01269"></a>01269 
<a name="l01270"></a>01270 
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 <span class="comment">// values from guiflkt.cpp</span>
<a name="l01273"></a>01273 <span class="keyword">extern</span> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a1bdbe3cd93203c2dfa534b17a7e8253c">guiRoiSX</a>, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a8a67e3afaa4df5dcfd5f58f0bfaa7e63">guiRoiSY</a>, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a83d1dc02c62a6076bc710b29d5d9c3fe">guiRoiSZ</a>, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a78fc1bddd0cabfeba274d93eeed60d38">guiRoiEX</a>, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a7106fc57dee959411afcb0ab320ab55e">guiRoiEY</a>, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a43bb3709dde57cf65283129487dd3aa4">guiRoiEZ</a>;
<a name="l01274"></a>01274 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a75fdca2cb22a2ad0c5e594f92a5e7003">guiRoiMaxLev</a>, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a5eb5b4a4d0f18074fbe1a96246619802">guiRoiMinLev</a>;
<a name="l01275"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#aa755b91848afd87bc225bd14b03e145f">01275</a> <span class="preprocessor">#define CID_SX (int)( (mLevel[cid-&gt;level].lSizex-1) * guiRoiSX )</span>
<a name="l01276"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#af07809bce5cce51fa01556d715bd484e">01276</a> <span class="preprocessor"></span><span class="preprocessor">#define CID_SY (int)( (mLevel[cid-&gt;level].lSizey-1) * guiRoiSY )</span>
<a name="l01277"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a04d44177f45f334e3cf6ca5f70562782">01277</a> <span class="preprocessor"></span><span class="preprocessor">#define CID_SZ (int)( (mLevel[cid-&gt;level].lSizez-1) * guiRoiSZ )</span>
<a name="l01278"></a>01278 <span class="preprocessor"></span>
<a name="l01279"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#ababcfe67ef3fd225f254bb58426d6a51">01279</a> <span class="preprocessor">#define CID_EX (int)( (mLevel[cid-&gt;level].lSizex-1) * guiRoiEX )</span>
<a name="l01280"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#abc00298a7fd333b659a4ae6cc6736a6d">01280</a> <span class="preprocessor"></span><span class="preprocessor">#define CID_EY (int)( (mLevel[cid-&gt;level].lSizey-1) * guiRoiEY )</span>
<a name="l01281"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a6f977485eb175490fbdf6e2780a911a5">01281</a> <span class="preprocessor"></span><span class="preprocessor">#define CID_EZ (int)( (mLevel[cid-&gt;level].lSizez-1) * guiRoiEZ )</span>
<a name="l01282"></a>01282 <span class="preprocessor"></span>
<a name="l01283"></a>01283 <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* 
<a name="l01284"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5a8025d0605521cce7a5b0fb6395274b">01284</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5a8025d0605521cce7a5b0fb6395274b" title="cell iteration methods">LbmFsgrSolver::getFirstCell</a>( ) {
<a name="l01285"></a>01285     <span class="keywordtype">int</span> level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 <span class="preprocessor">#if LBMDIM==3</span>
<a name="l01288"></a>01288 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>&gt;0) { level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>-1; } <span class="comment">// NO1HIGHESTLEV DEBUG</span>
<a name="l01289"></a>01289 <span class="preprocessor">#endif</span>
<a name="l01290"></a>01290 <span class="preprocessor"></span>    level = <a class="code" href="../../dc/d59/elbeem_8cpp.html#a75fdca2cb22a2ad0c5e594f92a5e7003">guiRoiMaxLev</a>;
<a name="l01291"></a>01291     <span class="keywordflow">if</span>(level&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01292"></a>01292     
<a name="l01293"></a>01293     <span class="comment">//errMsg(&quot;LbmFsgrSolver::getFirstCell&quot;,&quot;Celliteration started...&quot;);</span>
<a name="l01294"></a>01294     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <span class="keyword">new</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3ca0108439d486ccd82d1d2905220638">stdCellId</a>;
<a name="l01295"></a>01295     cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> = level;
<a name="l01296"></a>01296     cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#aa755b91848afd87bc225bd14b03e145f">CID_SX</a>;
<a name="l01297"></a>01297     cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#af07809bce5cce51fa01556d715bd484e">CID_SY</a>;
<a name="l01298"></a>01298     cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#a04d44177f45f334e3cf6ca5f70562782">CID_SZ</a>;
<a name="l01299"></a>01299     <span class="keywordflow">return</span> cid;
<a name="l01300"></a>01300 }
<a name="l01301"></a>01301 
<a name="l01302"></a>01302 <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">LbmFsgrSolver::stdCellId</a>* 
<a name="l01303"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">01303</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">LbmFsgrSolver::convertBaseCidToStdCid</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01304"></a>01304     <span class="comment">//stdCellId *cid = dynamic_cast&lt;stdCellId*&gt;( basecid );</span>
<a name="l01305"></a>01305     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = (<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a>*)( basecid );
<a name="l01306"></a>01306     <span class="keywordflow">return</span> cid;
<a name="l01307"></a>01307 }
<a name="l01308"></a>01308 
<a name="l01309"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8970a89408155f93337656354886d7ae">01309</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8970a89408155f93337656354886d7ae">LbmFsgrSolver::advanceCell</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01310"></a>01310     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01311"></a>01311     <span class="keywordflow">if</span>(cid-&gt;<a class="code" href="../../dd/dba/classCellIdentifierInterface.html#ac8b3dccefd1c222d913f7e9133fed4f1">getEnd</a>()) <span class="keywordflow">return</span>;
<a name="l01312"></a>01312 
<a name="l01313"></a>01313     <span class="comment">//debugOut(&quot; ADb &quot;&lt;&lt;cid-&gt;x&lt;&lt;&quot;,&quot;&lt;&lt;cid-&gt;y&lt;&lt;&quot;,&quot;&lt;&lt;cid-&gt;z&lt;&lt;&quot; e&quot;&lt;&lt;cid-&gt;getEnd(), 10);</span>
<a name="l01314"></a>01314     cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>++;
<a name="l01315"></a>01315     <span class="keywordflow">if</span>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> &gt; <a class="code" href="../../d9/d63/solver__util_8cpp.html#ababcfe67ef3fd225f254bb58426d6a51">CID_EX</a>){ cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#aa755b91848afd87bc225bd14b03e145f">CID_SX</a>; cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>++; 
<a name="l01316"></a>01316         <span class="keywordflow">if</span>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> &gt; <a class="code" href="../../d9/d63/solver__util_8cpp.html#abc00298a7fd333b659a4ae6cc6736a6d">CID_EY</a>){ cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#af07809bce5cce51fa01556d715bd484e">CID_SY</a>; cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>++; 
<a name="l01317"></a>01317             <span class="keywordflow">if</span>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> &gt; <a class="code" href="../../d9/d63/solver__util_8cpp.html#a6f977485eb175490fbdf6e2780a911a5">CID_EZ</a>){ 
<a name="l01318"></a>01318                 cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>--;
<a name="l01319"></a>01319                 cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#aa755b91848afd87bc225bd14b03e145f">CID_SX</a>; 
<a name="l01320"></a>01320                 cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#af07809bce5cce51fa01556d715bd484e">CID_SY</a>; 
<a name="l01321"></a>01321                 cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> = <a class="code" href="../../d9/d63/solver__util_8cpp.html#a04d44177f45f334e3cf6ca5f70562782">CID_SZ</a>; 
<a name="l01322"></a>01322                 <span class="keywordflow">if</span>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> &lt; <a class="code" href="../../dc/d59/elbeem_8cpp.html#a5eb5b4a4d0f18074fbe1a96246619802">guiRoiMinLev</a>) {
<a name="l01323"></a>01323                     cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> = <a class="code" href="../../dc/d59/elbeem_8cpp.html#a75fdca2cb22a2ad0c5e594f92a5e7003">guiRoiMaxLev</a>;
<a name="l01324"></a>01324                     cid-&gt;<a class="code" href="../../dd/dba/classCellIdentifierInterface.html#a01ce0949058035f1d011159fef88a05a" title="set/get end flag for grid traversal (not needed for marked cells)">setEnd</a>( <span class="keyword">true</span> );
<a name="l01325"></a>01325                 }
<a name="l01326"></a>01326             }
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328     }
<a name="l01329"></a>01329     <span class="comment">//debugOut(&quot; ADa &quot;&lt;&lt;cid-&gt;x&lt;&lt;&quot;,&quot;&lt;&lt;cid-&gt;y&lt;&lt;&quot;,&quot;&lt;&lt;cid-&gt;z&lt;&lt;&quot; e&quot;&lt;&lt;cid-&gt;getEnd(), 10);</span>
<a name="l01330"></a>01330 }
<a name="l01331"></a>01331 
<a name="l01332"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cd91c2e9cef3596a5ad5d7134862aa">01332</a> <span class="keywordtype">bool</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cd91c2e9cef3596a5ad5d7134862aa">LbmFsgrSolver::noEndCell</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01333"></a>01333     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01334"></a>01334     <span class="keywordflow">return</span> (!cid-&gt;<a class="code" href="../../dd/dba/classCellIdentifierInterface.html#ac8b3dccefd1c222d913f7e9133fed4f1">getEnd</a>());
<a name="l01335"></a>01335 }
<a name="l01336"></a>01336 
<a name="l01337"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a794caa127071a8b3bfcb2bf47c698db7">01337</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a794caa127071a8b3bfcb2bf47c698db7" title="clean up iteration, this should be called, when the iteration is not completely finished">LbmFsgrSolver::deleteCellIterator</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>** cid ) {
<a name="l01338"></a>01338     <span class="keyword">delete</span> *cid;
<a name="l01339"></a>01339     *cid = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01340"></a>01340 }
<a name="l01341"></a>01341 
<a name="l01342"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab64f65f78d3634164e299d0209575068">01342</a> <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab64f65f78d3634164e299d0209575068" title="find cell at a given position (returns NULL if not in domain)">LbmFsgrSolver::getCellAt</a>( <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pos ) {
<a name="l01343"></a>01343     <span class="comment">//int cellok = false;</span>
<a name="l01344"></a>01344     pos -= (this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>);
<a name="l01345"></a>01345 
<a name="l01346"></a>01346     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> mmaxsize = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>;
<a name="l01347"></a>01347     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> level=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; level&gt;=0; level--) { <span class="comment">// finest first</span>
<a name="l01348"></a>01348     <span class="comment">//for(int level=0; level&lt;=mMaxRefine; level++) { // coarsest first</span>
<a name="l01349"></a>01349         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nsize = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>;
<a name="l01350"></a>01350         <span class="keywordtype">int</span> x,y,z;
<a name="l01351"></a>01351         <span class="comment">// CHECK +- maxsize?</span>
<a name="l01352"></a>01352         x = (int)((pos[0]+0.5*mmaxsize) / nsize );
<a name="l01353"></a>01353         y = (int)((pos[1]+0.5*mmaxsize) / nsize );
<a name="l01354"></a>01354         z = (int)((pos[2]+0.5*mmaxsize) / nsize );
<a name="l01355"></a>01355         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) z = 0;
<a name="l01356"></a>01356 
<a name="l01357"></a>01357         <span class="comment">// double check...</span>
<a name="l01358"></a>01358         <span class="keywordflow">if</span>(x&lt;0) <span class="keywordflow">continue</span>;
<a name="l01359"></a>01359         <span class="keywordflow">if</span>(y&lt;0) <span class="keywordflow">continue</span>;
<a name="l01360"></a>01360         <span class="keywordflow">if</span>(z&lt;0) <span class="keywordflow">continue</span>;
<a name="l01361"></a>01361         <span class="keywordflow">if</span>(x&gt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizex) <span class="keywordflow">continue</span>;
<a name="l01362"></a>01362         <span class="keywordflow">if</span>(y&gt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizey) <span class="keywordflow">continue</span>;
<a name="l01363"></a>01363         <span class="keywordflow">if</span>(z&gt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizez) <span class="keywordflow">continue</span>;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365         <span class="comment">// return fluid/if/border cells</span>
<a name="l01366"></a>01366         <span class="keywordflow">if</span>( ( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, x,y,z, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>)) ) ||
<a name="l01367"></a>01367               ( (level&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>) &amp;&amp; (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, x,y,z, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>)) ) ) {
<a name="l01368"></a>01368             <span class="keywordflow">continue</span>;
<a name="l01369"></a>01369         } <span class="comment">// */</span>
<a name="l01370"></a>01370 
<a name="l01371"></a>01371         <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *newcid = <span class="keyword">new</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3ca0108439d486ccd82d1d2905220638">stdCellId</a>;
<a name="l01372"></a>01372         newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> = level;
<a name="l01373"></a>01373         newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> = x;
<a name="l01374"></a>01374         newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> = y;
<a name="l01375"></a>01375         newcid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> = z;
<a name="l01376"></a>01376         <span class="comment">//errMsg(&quot;cellAt&quot;,this-&gt;mName&lt;&lt;&quot; &quot;&lt;&lt;pos&lt;&lt;&quot; l&quot;&lt;&lt;level&lt;&lt;&quot;:&quot;&lt;&lt;x&lt;&lt;&quot;,&quot;&lt;&lt;y&lt;&lt;&quot;,&quot;&lt;&lt;z&lt;&lt;&quot; &quot;&lt;&lt;convertCellFlagType2String(RFLAG(level, x,y,z, mLevel[level].setCurr)) );</span>
<a name="l01377"></a>01377         <span class="keywordflow">return</span> newcid;
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01381"></a>01381 }
<a name="l01382"></a>01382 
<a name="l01383"></a>01383 
<a name="l01384"></a>01384 <span class="comment">// INFO functions</span>
<a name="l01385"></a>01385 
<a name="l01386"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a185fff614b095dcca1970a1185c6e637">01386</a> <span class="keywordtype">int</span>      <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a185fff614b095dcca1970a1185c6e637" title="return node information">LbmFsgrSolver::getCellSet</a>      ( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01387"></a>01387     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01388"></a>01388     <span class="keywordflow">return</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l01389"></a>01389     <span class="comment">//return mLevel[cid-&gt;level].setOther;</span>
<a name="l01390"></a>01390 }
<a name="l01391"></a>01391 
<a name="l01392"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa26ae4c84faa640d3b73b4f2d2d638b6">01392</a> <span class="keywordtype">int</span>      <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa26ae4c84faa640d3b73b4f2d2d638b6">LbmFsgrSolver::getCellLevel</a>    ( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01393"></a>01393     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01394"></a>01394     <span class="keywordflow">return</span> cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>;
<a name="l01395"></a>01395 }
<a name="l01396"></a>01396 
<a name="l01397"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2e4be60139e21dfe7e48d1e2d92447e2">01397</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2e4be60139e21dfe7e48d1e2d92447e2">LbmFsgrSolver::getCellOrigin</a>   ( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01398"></a>01398     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> ret;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01401"></a>01401     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> cs( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a> );
<a name="l01402"></a>01402     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { cs[2] = 0.0; }
<a name="l01403"></a>01403 
<a name="l01404"></a>01404     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) {
<a name="l01405"></a>01405         ret =(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>( cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> *cs[0], cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> *cs[1], (this-&gt;mvGeoEnd[2]-this-&gt;mvGeoStart[2])*0.5 )
<a name="l01406"></a>01406                 + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0,0.0,cs[1]*-0.25)*cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a> )
<a name="l01407"></a>01407             +<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a672845c664b5f2831b53cbefdf0394e7">getCellSize</a>(basecid);
<a name="l01408"></a>01408     } <span class="keywordflow">else</span> {
<a name="l01409"></a>01409         ret =(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a> + <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>( cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a> *cs[0], cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a> *cs[1], cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a> *cs[2] ))
<a name="l01410"></a>01410             +<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a672845c664b5f2831b53cbefdf0394e7">getCellSize</a>(basecid);
<a name="l01411"></a>01411     }
<a name="l01412"></a>01412     <span class="keywordflow">return</span> (ret);
<a name="l01413"></a>01413 }
<a name="l01414"></a>01414 
<a name="l01415"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a672845c664b5f2831b53cbefdf0394e7">01415</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a672845c664b5f2831b53cbefdf0394e7">LbmFsgrSolver::getCellSize</a>     ( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid) {
<a name="l01416"></a>01416     <span class="comment">// return half size</span>
<a name="l01417"></a>01417     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01418"></a>01418     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> retvec( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a> * 0.5 );
<a name="l01419"></a>01419     <span class="comment">// 2d display as rectangles</span>
<a name="l01420"></a>01420     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { retvec[2] = 0.0; }
<a name="l01421"></a>01421     <span class="keywordflow">return</span> (retvec);
<a name="l01422"></a>01422 }
<a name="l01423"></a>01423 
<a name="l01424"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac346ceb75e6787dfa4f6f2a1a95c108e">01424</a> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac346ceb75e6787dfa4f6f2a1a95c108e">LbmFsgrSolver::getCellDensity</a>  ( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid,<span class="keywordtype">int</span> <span class="keyword">set</span>) {
<a name="l01425"></a>01425     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427     <span class="comment">// skip non-fluid cells</span>
<a name="l01428"></a>01428     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {
<a name="l01429"></a>01429         <span class="comment">// ok go on...</span>
<a name="l01430"></a>01430     } <span class="keywordflow">else</span> {
<a name="l01431"></a>01431         <span class="keywordflow">return</span> 0.;
<a name="l01432"></a>01432     }
<a name="l01433"></a>01433 
<a name="l01434"></a>01434     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rho = 0.0;
<a name="l01435"></a>01435     <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> { rho += <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, l); } <span class="comment">// ORG</span>
<a name="l01436"></a>01436     <span class="keywordflow">return</span> ((rho-1.0) * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a64d427112a6782a30a22116f381265ae" title="node size on this level in simulation units">simCellSize</a> / <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>) +1.0; <span class="comment">// ORG</span>
<a name="l01437"></a>01437     <span class="comment">/*if(RFLAG(cid-&gt;level, cid-&gt;x,cid-&gt;y,cid-&gt;z, set)&amp;CFInter) { // test</span>
<a name="l01438"></a>01438 <span class="comment">        LbmFloat ux,uy,uz;</span>
<a name="l01439"></a>01439 <span class="comment">        ux=uy=uz= 0.0;</span>
<a name="l01440"></a>01440 <span class="comment">        int lev = cid-&gt;level;</span>
<a name="l01441"></a>01441 <span class="comment">        LbmFloat df[27], feqOld[27];</span>
<a name="l01442"></a>01442 <span class="comment">        FORDF0 {</span>
<a name="l01443"></a>01443 <span class="comment">            rho += QCELL(lev, cid-&gt;x,cid-&gt;y,cid-&gt;z, set, l);</span>
<a name="l01444"></a>01444 <span class="comment">            ux += this-&gt;dfDvecX[l]* QCELL(lev, cid-&gt;x,cid-&gt;y,cid-&gt;z, set, l);</span>
<a name="l01445"></a>01445 <span class="comment">            uy += this-&gt;dfDvecY[l]* QCELL(lev, cid-&gt;x,cid-&gt;y,cid-&gt;z, set, l);</span>
<a name="l01446"></a>01446 <span class="comment">            uz += this-&gt;dfDvecZ[l]* QCELL(lev, cid-&gt;x,cid-&gt;y,cid-&gt;z, set, l);</span>
<a name="l01447"></a>01447 <span class="comment">            df[l] = QCELL(lev, cid-&gt;x,cid-&gt;y,cid-&gt;z, set, l);</span>
<a name="l01448"></a>01448 <span class="comment">        }</span>
<a name="l01449"></a>01449 <span class="comment">        FORDF0 {</span>
<a name="l01450"></a>01450 <span class="comment">            feqOld[l] = getCollideEq(l, rho,ux,uy,uz); </span>
<a name="l01451"></a>01451 <span class="comment">        }</span>
<a name="l01452"></a>01452 <span class="comment">        // debugging mods</span>
<a name="l01453"></a>01453 <span class="comment">        //const LbmFloat Qo = this-&gt;getLesNoneqTensorCoeff(df,feqOld);</span>
<a name="l01454"></a>01454 <span class="comment">        //const LbmFloat modOmega = this-&gt;getLesOmega(mLevel[lev].omega, mLevel[lev].lcsmago,Qo);</span>
<a name="l01455"></a>01455 <span class="comment">        //rho = (2.0-modOmega) *25.0;</span>
<a name="l01456"></a>01456 <span class="comment">        //rho = Qo*100.0;</span>
<a name="l01457"></a>01457 <span class="comment">        //if(cid-&gt;x==24){ errMsg(&quot;MODOMT&quot;,&quot; at &quot;&lt;&lt;PRINT_VEC(cid-&gt;x,cid-&gt;y,cid-&gt;z)&lt;&lt;&quot; = &quot;&lt;&lt;rho&lt;&lt;&quot; &quot;&lt;&lt;Qo); }</span>
<a name="l01458"></a>01458 <span class="comment">        //else{ rho=0.0; }</span>
<a name="l01459"></a>01459 <span class="comment">    } // test </span>
<a name="l01460"></a>01460 <span class="comment">    return rho; // test */</span>
<a name="l01461"></a>01461 }
<a name="l01462"></a>01462 
<a name="l01463"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4e554919f1c6e0a902e3121813eeaf0a">01463</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a>   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4e554919f1c6e0a902e3121813eeaf0a">LbmFsgrSolver::getCellVelocity</a> ( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid,<span class="keywordtype">int</span> <span class="keyword">set</span>) {
<a name="l01464"></a>01464     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     <span class="comment">// skip non-fluid cells</span>
<a name="l01467"></a>01467     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) {
<a name="l01468"></a>01468         <span class="comment">// ok go on...</span>
<a name="l01469"></a>01469     } <span class="keywordflow">else</span> {
<a name="l01470"></a>01470         <span class="keywordflow">return</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(0.0);
<a name="l01471"></a>01471     }
<a name="l01472"></a>01472 
<a name="l01473"></a>01473     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> ux,uy,uz;
<a name="l01474"></a>01474     ux=uy=uz= 0.0;
<a name="l01475"></a>01475     <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a> {
<a name="l01476"></a>01476         ux += this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]* <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, l);
<a name="l01477"></a>01477         uy += this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]* <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, l);
<a name="l01478"></a>01478         uz += this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]* <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, l);
<a name="l01479"></a>01479     }
<a name="l01480"></a>01480     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> vel(ux,uy,uz);
<a name="l01481"></a>01481     <span class="comment">// TODO fix...</span>
<a name="l01482"></a>01482     <span class="keywordflow">return</span> (vel * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a64d427112a6782a30a22116f381265ae" title="node size on this level in simulation units">simCellSize</a> / <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a> * this-&gt;mDebugVelScale); <span class="comment">// normal</span>
<a name="l01483"></a>01483 }
<a name="l01484"></a>01484 
<a name="l01485"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55b35ac4660b0250eb113ac230ee301b">01485</a> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55b35ac4660b0250eb113ac230ee301b">LbmFsgrSolver::getCellDf</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid,<span class="keywordtype">int</span> <span class="keyword">set</span>, <span class="keywordtype">int</span> dir) {
<a name="l01486"></a>01486     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01487"></a>01487     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, dir);
<a name="l01488"></a>01488 }
<a name="l01489"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c59a24baa7b0d75a8678d85ae5feedc">01489</a> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c59a24baa7b0d75a8678d85ae5feedc">LbmFsgrSolver::getCellMass</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid,<span class="keywordtype">int</span> <span class="keyword">set</span>) {
<a name="l01490"></a>01490     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01491"></a>01491     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>);
<a name="l01492"></a>01492 }
<a name="l01493"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a043b1c141d3d141e17242e5769472ff1">01493</a> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>   <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a043b1c141d3d141e17242e5769472ff1">LbmFsgrSolver::getCellFill</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid,<span class="keywordtype">int</span> <span class="keyword">set</span>) {
<a name="l01494"></a>01494     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01495"></a>01495     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>)&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>);
<a name="l01496"></a>01496     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>)&amp;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>) <span class="keywordflow">return</span> 1.0;
<a name="l01497"></a>01497     <span class="keywordflow">return</span> 0.0;
<a name="l01498"></a>01498     <span class="comment">//return QCELL(cid-&gt;level, cid-&gt;x,cid-&gt;y,cid-&gt;z, set, dFfrac);</span>
<a name="l01499"></a>01499 }
<a name="l01500"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a18badb3ac4eef9cec381880247ab92d1">01500</a> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a18badb3ac4eef9cec381880247ab92d1">LbmFsgrSolver::getCellFlag</a>( <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* basecid,<span class="keywordtype">int</span> <span class="keyword">set</span>) {
<a name="l01501"></a>01501     <a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html">stdCellId</a> *cid = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a31855a0725a3cce0c7affb6d0255c9fd">convertBaseCidToStdCid</a>(basecid);
<a name="l01502"></a>01502     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ae1e1de8c7f63994cbc87e9bb5e0d513a" title="which grid level?">level</a>, cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#aaaaaca499c373bed5b078c1b52cec9a0" title="location in grid">x</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#ac0989b8e6285edb7f5a48c8c5e9ae3b5">y</a>,cid-&gt;<a class="code" href="../../d9/d74/classUniformFsgrCellIdentifier.html#a4f51aa56e071b8cfab88e482b3064a74">z</a>, <span class="keyword">set</span>);
<a name="l01503"></a>01503 }
<a name="l01504"></a>01504 
<a name="l01505"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8d40cddf17d338f797920618412cb499">01505</a> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8d40cddf17d338f797920618412cb499">LbmFsgrSolver::getEquilDf</a>( <span class="keywordtype">int</span> l ) {
<a name="l01506"></a>01506     <span class="keywordflow">return</span> this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a840d7fe459d8ae31de541da4d94ed20a">dfEquil</a>[l];
<a name="l01507"></a>01507 }
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 
<a name="l01510"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd2d67c863ed50bd2e3fcae3914f0b30">01510</a> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#acd2d67c863ed50bd2e3fcae3914f0b30">LbmFsgrSolver::getVelocityAt</a>   (<span class="keywordtype">float</span> xp, <span class="keywordtype">float</span> yp, <span class="keywordtype">float</span> zp) {
<a name="l01511"></a>01511     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> avgvel(0.0);
<a name="l01512"></a>01512     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>   avgnum = 0.;
<a name="l01513"></a>01513 
<a name="l01514"></a>01514     <span class="comment">// taken from getCellAt!</span>
<a name="l01515"></a>01515     <span class="keyword">const</span> <span class="keywordtype">int</span> level = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l01516"></a>01516     <span class="keyword">const</span> <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l01517"></a>01517     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nsize = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>;
<a name="l01518"></a>01518     <span class="keyword">const</span> <span class="keywordtype">int</span> x = (int)((-this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0]+xp-0.5*nsize) / nsize );
<a name="l01519"></a>01519     <span class="keyword">const</span> <span class="keywordtype">int</span> y = (int)((-this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1]+yp-0.5*nsize) / nsize );
<a name="l01520"></a>01520     <span class="keywordtype">int</span>       z = (int)((-this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2]+zp-0.5*nsize) / nsize );
<a name="l01521"></a>01521     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) z=0;
<a name="l01522"></a>01522     <span class="comment">//errMsg(&quot;DUMPVEL&quot;,&quot;p&quot;&lt;&lt;PRINT_VEC(xp,yp,zp)&lt;&lt;&quot; at &quot;&lt;&lt;PRINT_VEC(x,y,z)&lt;&lt;&quot; max&quot;&lt;&lt;PRINT_VEC(mLevel[level].lSizex,mLevel[level].lSizey,mLevel[level].lSizez) );</span>
<a name="l01523"></a>01523 
<a name="l01524"></a>01524     <span class="comment">// return fluid/if/border cells</span>
<a name="l01525"></a>01525     <span class="comment">// search neighborhood, do smoothing</span>
<a name="l01526"></a>01526     <a class="code" href="../../d1/d24/solver__class_8h.html#a93c07afda92f7e43d3b70438ef885eb5">FORDF0</a>{ 
<a name="l01527"></a>01527         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = x+this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l];
<a name="l01528"></a>01528         <span class="keyword">const</span> <span class="keywordtype">int</span> j = y+this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l];
<a name="l01529"></a>01529         <span class="keyword">const</span> <span class="keywordtype">int</span> k = z+this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l];
<a name="l01530"></a>01530 
<a name="l01531"></a>01531         <span class="keywordflow">if</span>( (i&lt;0) || (j&lt;0) || (k&lt;0) 
<a name="l01532"></a>01532          || (i&gt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>) 
<a name="l01533"></a>01533          || (j&gt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizey) 
<a name="l01534"></a>01534          || (k&gt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>) ) <span class="keywordflow">continue</span>;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536         <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(level, i,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].setCurr)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>)) ) {
<a name="l01537"></a>01537             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> vel(0.0);
<a name="l01538"></a>01538             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *ccel = <a class="code" href="../../d1/d24/solver__class_8h.html#a8716918cb0374cf433217d8d3078aba5">RACPNT</a>(level, i,j,k ,workSet); <span class="comment">// omp</span>
<a name="l01539"></a>01539             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n=1; n&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; n++) {
<a name="l01540"></a>01540                 vel[0]  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[n]*<a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(ccel,n));
<a name="l01541"></a>01541                 vel[1]  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[n]*<a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(ccel,n)); 
<a name="l01542"></a>01542                 vel[2]  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[n]*<a class="code" href="../../d1/d24/solver__class_8h.html#a392d8362c0d5aa69f1cfbd87109c7833">RAC</a>(ccel,n)); 
<a name="l01543"></a>01543             } 
<a name="l01544"></a>01544 
<a name="l01545"></a>01545             avgvel += vel;
<a name="l01546"></a>01546             avgnum += 1.0;
<a name="l01547"></a>01547             <span class="keywordflow">if</span>(l==0) { <span class="comment">// center slightly more weight</span>
<a name="l01548"></a>01548                 avgvel += vel; avgnum += 1.0;
<a name="l01549"></a>01549             }
<a name="l01550"></a>01550         } <span class="comment">// */</span>
<a name="l01551"></a>01551     }
<a name="l01552"></a>01552 
<a name="l01553"></a>01553     <span class="keywordflow">if</span>(avgnum&gt;0.) {
<a name="l01554"></a>01554         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> retv = avgvel / avgnum;
<a name="l01555"></a>01555         retv *= nsize/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>;
<a name="l01556"></a>01556         <span class="comment">// scale for current animation settings (frame time)</span>
<a name="l01557"></a>01557         retv *= <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#a57f309e675f4d1307f346c2f5e0fde3e">getCurrentAniFrameTime</a>();
<a name="l01558"></a>01558         <span class="comment">//errMsg(&quot;DUMPVEL&quot;,&quot;t&quot;&lt;&lt;mSimulationTime&lt;&lt;&quot; at &quot;&lt;&lt;PRINT_VEC(xp,yp,zp)&lt;&lt;&quot; ret:&quot;&lt;&lt;retv&lt;&lt;&quot;, avgv:&quot;&lt;&lt;avgvel&lt;&lt;&quot; n&quot;&lt;&lt;avgnum&lt;&lt;&quot; nsize&quot;&lt;&lt;nsize&lt;&lt;&quot; ts&quot;&lt;&lt;mLevel[level].timestep&lt;&lt;&quot; fr&quot;&lt;&lt;mpParam-&gt;getCurrentAniFrameTime() );</span>
<a name="l01559"></a>01559         <span class="keywordflow">return</span> retv;
<a name="l01560"></a>01560     }
<a name="l01561"></a>01561     <span class="comment">// no cells here...?</span>
<a name="l01562"></a>01562     <span class="comment">//errMsg(&quot;DUMPVEL&quot;,&quot; at &quot;&lt;&lt;PRINT_VEC(xp,yp,zp)&lt;&lt;&quot; v&quot;&lt;&lt;avgvel&lt;&lt;&quot; n&quot;&lt;&lt;avgnum&lt;&lt;&quot; no vel !?&quot;);</span>
<a name="l01563"></a>01563     <span class="keywordflow">return</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.);
<a name="l01564"></a>01564 }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566 <span class="preprocessor">#if LBM_USE_GUI==1</span>
<a name="l01567"></a>01567 <span class="preprocessor"></span>
<a name="l01568"></a>01568 <span class="keywordtype">void</span> 
<a name="l01569"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae0c0d8c861c205b660036dcdf2787e99">01569</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ae0c0d8c861c205b660036dcdf2787e99" title="show simulation info (implement LbmSolverInterface pure virtual func)">LbmFsgrSolver::debugDisplay</a>(<span class="keywordtype">int</span> <span class="keyword">set</span>){ 
<a name="l01570"></a>01570     <span class="comment">//lbmDebugDisplay&lt; LbmFsgrSolver &gt;( set, this ); </span>
<a name="l01571"></a>01571     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a927364b6770c0fee603c984110456d65" title="debug display function">lbmDebugDisplay</a>( <span class="keyword">set</span> ); 
<a name="l01572"></a>01572 }
<a name="l01573"></a>01573 <span class="preprocessor">#endif</span>
<a name="l01574"></a>01574 <span class="preprocessor"></span>
<a name="l01575"></a>01575 <span class="comment">/*****************************************************************************/</span>
<a name="l01576"></a>01576 <span class="comment">// strict debugging functions</span>
<a name="l01577"></a>01577 <span class="comment">/*****************************************************************************/</span>
<a name="l01578"></a>01578 <span class="preprocessor">#if FSGR_STRICT_DEBUG==1</span>
<a name="l01579"></a>01579 <span class="preprocessor"></span><span class="preprocessor">#define STRICT_EXIT *((int *)0)=0;</span>
<a name="l01580"></a>01580 <span class="preprocessor"></span>
<a name="l01581"></a>01581 <span class="keywordtype">int</span> LbmFsgrSolver::debLBMGI(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> ii,<span class="keywordtype">int</span> ij,<span class="keywordtype">int</span> ik, <span class="keywordtype">int</span> is) {
<a name="l01582"></a>01582     <span class="keywordflow">if</span>(level &lt;  0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict::debLBMGI&quot;</span>,<span class="stringliteral">&quot; invLev- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; } 
<a name="l01583"></a>01583     <span class="keywordflow">if</span>(level &gt;  <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict::debLBMGI&quot;</span>,<span class="stringliteral">&quot; invLev+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; } 
<a name="l01584"></a>01584 
<a name="l01585"></a>01585     <span class="keywordflow">if</span>((ii==-1)&amp;&amp;(ij==0)) {
<a name="l01586"></a>01586         <span class="comment">// special case for main loop, ok</span>
<a name="l01587"></a>01587     } <span class="keywordflow">else</span> {
<a name="l01588"></a>01588         <span class="keywordflow">if</span>(ii&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invX- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01589"></a>01589         <span class="keywordflow">if</span>(ij&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invY- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01590"></a>01590         <span class="keywordflow">if</span>(ii&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizex-1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invX+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01591"></a>01591         <span class="keywordflow">if</span>(ij&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizey-1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invY+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01592"></a>01592     }
<a name="l01593"></a>01593     <span class="keywordflow">if</span>(ik&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invZ- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01594"></a>01594     <span class="keywordflow">if</span>(ik&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizez-1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invZ+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01595"></a>01595     <span class="keywordflow">if</span>(is&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invS- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01596"></a>01596     <span class="keywordflow">if</span>(is&gt;1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invS+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01597"></a>01597     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a7476c6767ae8e224874c7d63eb5ca284">_LBMGI</a>(level, ii,ij,ik, is);
<a name="l01598"></a>01598 };
<a name="l01599"></a>01599 
<a name="l01600"></a>01600 <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>&amp; LbmFsgrSolver::debRFLAG(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> zz,<span class="keywordtype">int</span> <span class="keyword">set</span>){
<a name="l01601"></a>01601     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#aca356f89bf225bb40b806c7fa4be1632" title="flag array acces macro">_RFLAG</a>(level, xx,yy,zz,<span class="keyword">set</span>);   
<a name="l01602"></a>01602 };
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>&amp; LbmFsgrSolver::debRFLAG_NB(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> zz,<span class="keywordtype">int</span> <span class="keyword">set</span>, <span class="keywordtype">int</span> dir) {
<a name="l01605"></a>01605     <span class="keywordflow">if</span>(dir&lt;0)         { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01606"></a>01606     <span class="comment">// warning might access all spatial nbs</span>
<a name="l01607"></a>01607     <span class="keywordflow">if</span>(dir&gt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01608"></a>01608     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#af710f0cac933f49274ca535b3fd7c5f9">_RFLAG_NB</a>(level, xx,yy,zz,<span class="keyword">set</span>, dir);
<a name="l01609"></a>01609 };
<a name="l01610"></a>01610 
<a name="l01611"></a>01611 <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a>&amp; LbmFsgrSolver::debRFLAG_NBINV(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> zz,<span class="keywordtype">int</span> <span class="keyword">set</span>, <span class="keywordtype">int</span> dir) {
<a name="l01612"></a>01612     <span class="keywordflow">if</span>(dir&lt;0)         { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01613"></a>01613     <span class="keywordflow">if</span>(dir&gt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01614"></a>01614     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a6be6694592b7b1b66da63be241524f1e">_RFLAG_NBINV</a>(level, xx,yy,zz,<span class="keyword">set</span>, dir);
<a name="l01615"></a>01615 };
<a name="l01616"></a>01616 
<a name="l01617"></a>01617 <span class="keywordtype">int</span> LbmFsgrSolver::debLBMQI(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> ii,<span class="keywordtype">int</span> ij,<span class="keywordtype">int</span> ik, <span class="keywordtype">int</span> is, <span class="keywordtype">int</span> l) {
<a name="l01618"></a>01618     <span class="keywordflow">if</span>(level &lt;  0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict::debLBMQI&quot;</span>,<span class="stringliteral">&quot; invLev- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; } 
<a name="l01619"></a>01619     <span class="keywordflow">if</span>(level &gt;  <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict::debLBMQI&quot;</span>,<span class="stringliteral">&quot; invLev+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; } 
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keywordflow">if</span>((ii==-1)&amp;&amp;(ij==0)) {
<a name="l01622"></a>01622         <span class="comment">// special case for main loop, ok</span>
<a name="l01623"></a>01623     } <span class="keywordflow">else</span> {
<a name="l01624"></a>01624         <span class="keywordflow">if</span>(ii&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invX- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01625"></a>01625         <span class="keywordflow">if</span>(ij&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invY- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01626"></a>01626         <span class="keywordflow">if</span>(ii&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizex-1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invX+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01627"></a>01627         <span class="keywordflow">if</span>(ij&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizey-1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invY+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01628"></a>01628     }
<a name="l01629"></a>01629     <span class="keywordflow">if</span>(ik&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invZ- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01630"></a>01630     <span class="keywordflow">if</span>(ik&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[level].lSizez-1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invZ+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01631"></a>01631     <span class="keywordflow">if</span>(is&lt;0){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invS- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01632"></a>01632     <span class="keywordflow">if</span>(is&gt;1){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invS+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;ii&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ij&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ik&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;is); STRICT_EXIT; }
<a name="l01633"></a>01633     <span class="keywordflow">if</span>(l&lt;0)        { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD- &quot;</span>&lt;&lt;<span class="stringliteral">&quot; l&quot;</span>&lt;&lt;l); STRICT_EXIT; }
<a name="l01634"></a>01634     <span class="keywordflow">if</span>(l&gt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>){  <span class="comment">// dFfrac is an exception</span>
<a name="l01635"></a>01635         <span class="keywordflow">if</span>((l != <a class="code" href="../../d2/d3c/solver__interface_8h.html#ae3af1df16ce777d054aa7c1798f5f634">dMass</a>) &amp;&amp; (l != <a class="code" href="../../d2/d3c/solver__interface_8h.html#a64b7025f17b762d336e621092066bd7b">dFfrac</a>) &amp;&amp; (l != <a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>)){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD+ &quot;</span>&lt;&lt;<span class="stringliteral">&quot; l&quot;</span>&lt;&lt;l); STRICT_EXIT; } }
<a name="l01636"></a>01636 <span class="preprocessor">#if COMPRESSGRIDS==1</span>
<a name="l01637"></a>01637 <span class="preprocessor"></span>    <span class="comment">//if((!this-&gt;mInitDone) &amp;&amp; (is!=mLevel[level].setCurr)){ STRICT_EXIT; } // COMPRT debug</span>
<a name="l01638"></a>01638 <span class="preprocessor">#endif // COMPRESSGRIDS==1</span>
<a name="l01639"></a>01639 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a42acd17b86238f6333a15f648d5d012a">_LBMQI</a>(level, ii,ij,ik, is, l);
<a name="l01640"></a>01640 };
<a name="l01641"></a>01641 
<a name="l01642"></a>01642 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>&amp; LbmFsgrSolver::debQCELL(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> zz,<span class="keywordtype">int</span> <span class="keyword">set</span>,<span class="keywordtype">int</span> l) {
<a name="l01643"></a>01643     <span class="comment">//errMsg(&quot;LbmStrict&quot;,&quot;debQCELL debug: l&quot;&lt;&lt;level&lt;&lt;&quot;|&quot;&lt;&lt;xx&lt;&lt;&quot;,&quot;&lt;&lt;yy&lt;&lt;&quot;,&quot;&lt;&lt;zz&lt;&lt;&quot; s&quot;&lt;&lt;set&lt;&lt;&quot; l&quot;&lt;&lt;l&lt;&lt;&quot; index&quot;&lt;&lt;LBMGI(level, xx,yy,zz,set)); </span>
<a name="l01644"></a>01644     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#ae1a18e89d84d979812816ff905d7ba84">_QCELL</a>(level, xx,yy,zz,<span class="keyword">set</span>,l);
<a name="l01645"></a>01645 };
<a name="l01646"></a>01646 
<a name="l01647"></a>01647 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>&amp; LbmFsgrSolver::debQCELL_NB(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> zz,<span class="keywordtype">int</span> <span class="keyword">set</span>, <span class="keywordtype">int</span> dir,<span class="keywordtype">int</span> l) {
<a name="l01648"></a>01648     <span class="keywordflow">if</span>(dir&lt;0)        { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01649"></a>01649     <span class="keywordflow">if</span>(dir&gt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01650"></a>01650     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#aa568961467b7fc089020d50a7058fab3">_QCELL_NB</a>(level, xx,yy,zz,<span class="keyword">set</span>, dir,l);
<a name="l01651"></a>01651 };
<a name="l01652"></a>01652 
<a name="l01653"></a>01653 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>&amp; LbmFsgrSolver::debQCELL_NBINV(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> zz,<span class="keywordtype">int</span> <span class="keyword">set</span>, <span class="keywordtype">int</span> dir,<span class="keywordtype">int</span> l) {
<a name="l01654"></a>01654     <span class="keywordflow">if</span>(dir&lt;0)        { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD- l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01655"></a>01655     <span class="keywordflow">if</span>(dir&gt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD+ l&quot;</span>&lt;&lt;level&lt;&lt;<span class="stringliteral">&quot;|&quot;</span>&lt;&lt;xx&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;yy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zz&lt;&lt;<span class="stringliteral">&quot; s&quot;</span>&lt;&lt;<span class="keyword">set</span>&lt;&lt;<span class="stringliteral">&quot; d&quot;</span>&lt;&lt;dir); STRICT_EXIT; }
<a name="l01656"></a>01656     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a98b047830876cde857f13106403b041f">_QCELL_NBINV</a>(level, xx,yy,zz,<span class="keyword">set</span>, dir,l);
<a name="l01657"></a>01657 };
<a name="l01658"></a>01658 
<a name="l01659"></a>01659 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>* LbmFsgrSolver::debRACPNT(<span class="keywordtype">int</span> level,  <span class="keywordtype">int</span> ii,<span class="keywordtype">int</span> ij,<span class="keywordtype">int</span> ik, <span class="keywordtype">int</span> is ) {
<a name="l01660"></a>01660     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#a4c1715407d94d80d1e096bfc6a819b7a">_RACPNT</a>(level, ii,ij,ik, is );
<a name="l01661"></a>01661 };
<a name="l01662"></a>01662 
<a name="l01663"></a>01663 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>&amp; LbmFsgrSolver::debRAC(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>* s,<span class="keywordtype">int</span> l) {
<a name="l01664"></a>01664     <span class="keywordflow">if</span>(l&lt;0)        { <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD- &quot;</span>&lt;&lt;<span class="stringliteral">&quot; l&quot;</span>&lt;&lt;l); STRICT_EXIT; }
<a name="l01665"></a>01665     <span class="keywordflow">if</span>(l&gt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#ab0601b2c1dfd0bf11c64c99be397ed7b">dTotalNum</a>){ <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmStrict&quot;</span>,<span class="stringliteral">&quot; invD+ &quot;</span>&lt;&lt;<span class="stringliteral">&quot; l&quot;</span>&lt;&lt;l); STRICT_EXIT; } 
<a name="l01666"></a>01666     <span class="comment">//if(l&gt;this-&gt;cDfNum){ // dFfrac is an exception </span>
<a name="l01667"></a>01667     <span class="comment">//if((l != dMass) &amp;&amp; (l != dFfrac) &amp;&amp; (l != dFlux)){ errMsg(&quot;LbmStrict&quot;,&quot; invD+ &quot;&lt;&lt;&quot; l&quot;&lt;&lt;l); STRICT_EXIT; } }</span>
<a name="l01668"></a>01668     <span class="keywordflow">return</span> <a class="code" href="../../d1/d24/solver__class_8h.html#aee9af0381e818dff42028f779108d55b">_RAC</a>(s,l);
<a name="l01669"></a>01669 };
<a name="l01670"></a>01670 
<a name="l01671"></a>01671 <span class="preprocessor">#endif // FSGR_STRICT_DEBUG==1</span>
<a name="l01672"></a>01672 <span class="preprocessor"></span>
<a name="l01673"></a>01673 
<a name="l01674"></a>01674 <span class="comment">/******************************************************************************</span>
<a name="l01675"></a>01675 <span class="comment"> * GUI&amp;debugging functions</span>
<a name="l01676"></a>01676 <span class="comment"> *****************************************************************************/</span>
<a name="l01677"></a>01677 
<a name="l01678"></a>01678 
<a name="l01679"></a>01679 <span class="preprocessor">#if LBM_USE_GUI==1</span>
<a name="l01680"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a089e18d42628102e63489ad89318ab8c">01680</a> <span class="preprocessor"></span><span class="preprocessor">#define USE_GLUTILITIES</span>
<a name="l01681"></a>01681 <span class="preprocessor"></span><span class="preprocessor">#include &quot;../gui/gui_utilities.h&quot;</span>
<a name="l01682"></a>01682 
<a name="l01684"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac2f46ef215bab96bc9bbb86f70894030">01684</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac2f46ef215bab96bc9bbb86f70894030" title="display a single node">LbmFsgrSolver::debugDisplayNode</a>(<span class="keywordtype">int</span> dispset, <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* cell ) {
<a name="l01685"></a>01685     <span class="comment">//debugOut(&quot; DD: &quot;&lt;&lt;cell-&gt;getAsString() , 10);</span>
<a name="l01686"></a>01686     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> org      = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2e4be60139e21dfe7e48d1e2d92447e2">getCellOrigin</a>( cell );
<a name="l01687"></a>01687     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> halfsize = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a672845c664b5f2831b53cbefdf0394e7">getCellSize</a>( cell );
<a name="l01688"></a>01688     <span class="keywordtype">int</span>    <span class="keyword">set</span>      = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a185fff614b095dcca1970a1185c6e637" title="return node information">getCellSet</a>( cell );
<a name="l01689"></a>01689     <span class="comment">//debugOut(&quot; DD: &quot;&lt;&lt;cell-&gt;getAsString()&lt;&lt;&quot; &quot;&lt;&lt; (dispset-&gt;type) , 10);</span>
<a name="l01690"></a>01690 
<a name="l01691"></a>01691     <span class="keywordtype">bool</span>     showcell = <span class="keyword">true</span>;
<a name="l01692"></a>01692     <span class="keywordtype">int</span>      linewidth = 1;
<a name="l01693"></a>01693     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> col(0.5);
<a name="l01694"></a>01694     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cscale = 1.0; <span class="comment">//dispset-&gt;scale;</span>
<a name="l01695"></a>01695 
<a name="l01696"></a>01696 <span class="preprocessor">#define DRAWDISPCUBE(col,scale) \</span>
<a name="l01697"></a>01697 <span class="preprocessor">    {   glLineWidth( linewidth ); \</span>
<a name="l01698"></a>01698 <span class="preprocessor">      glColor3f( (col)[0], (col)[1], (col)[2]); \</span>
<a name="l01699"></a>01699 <span class="preprocessor">        ntlVec3Gfx s = org-(halfsize * (scale)); \</span>
<a name="l01700"></a>01700 <span class="preprocessor">        ntlVec3Gfx e = org+(halfsize * (scale)); \</span>
<a name="l01701"></a>01701 <span class="preprocessor">        drawCubeWire( s,e ); }</span>
<a name="l01702"></a>01702 <span class="preprocessor"></span>
<a name="l01703"></a>01703     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> flag = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a18badb3ac4eef9cec381880247ab92d1">getCellFlag</a>(cell, <span class="keyword">set</span> );
<a name="l01704"></a>01704     <span class="comment">// always check types</span>
<a name="l01705"></a>01705     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a1164d59fca82249b6bd7684e6c08785b">CFInvalid</a>  ) { <span class="keywordflow">if</span>(!guiShowInvalid  ) <span class="keywordflow">return</span>; }
<a name="l01706"></a>01706     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>   ) { <span class="keywordflow">if</span>(!guiShowInvalid  ) <span class="keywordflow">return</span>; }
<a name="l01707"></a>01707     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>    ) { <span class="keywordflow">if</span>(!guiShowEmpty    ) <span class="keywordflow">return</span>; }
<a name="l01708"></a>01708     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>    ) { <span class="keywordflow">if</span>(!guiShowInterface) <span class="keywordflow">return</span>; }
<a name="l01709"></a>01709     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#af320996309a9786439306953c5e85340">CFNoDelete</a> ) { <span class="keywordflow">if</span>(!guiShowNoDelete ) <span class="keywordflow">return</span>; }
<a name="l01710"></a>01710     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#aa223bf935d9fbd98aafae01a592ea0a4">CFBnd</a>      ) { <span class="keywordflow">if</span>(!guiShowBnd      ) <span class="keywordflow">return</span>; }
<a name="l01711"></a>01711 
<a name="l01712"></a>01712     <span class="comment">// only dismiss one of these types </span>
<a name="l01713"></a>01713     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a59edb41b92d2b093c8ec53e0fbc53074">CFGrFromCoarse</a>)  { <span class="keywordflow">if</span>(!guiShowCoarseInner  ) <span class="keywordflow">return</span>; } <span class="comment">// inner not really interesting</span>
<a name="l01714"></a>01714     <span class="keywordflow">else</span>
<a name="l01715"></a>01715     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#ac378aafd920a230c4488d4706c816b87">CFGrFromFine</a>) { <span class="keywordflow">if</span>(!guiShowCoarseBorder ) <span class="keywordflow">return</span>; }
<a name="l01716"></a>01716     <span class="keywordflow">else</span>
<a name="l01717"></a>01717     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>    )    { <span class="keywordflow">if</span>(!guiShowFluid    ) <span class="keywordflow">return</span>; }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719     <span class="keywordflow">switch</span>(dispset) {
<a name="l01720"></a>01720         <span class="keywordflow">case</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a2a14cd6c0034837ee3674d9f57a1c0dc">FLUIDDISPNothing</a>: {
<a name="l01721"></a>01721                 showcell = <span class="keyword">false</span>;
<a name="l01722"></a>01722             } <span class="keywordflow">break</span>;
<a name="l01723"></a>01723         <span class="keywordflow">case</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#ab3e9bfb9888ed119d60a529048feb709">FLUIDDISPCelltypes</a>: {
<a name="l01724"></a>01724                 cscale = 0.5;
<a name="l01725"></a>01725 
<a name="l01726"></a>01726                 <span class="keywordflow">if</span>(flag&amp; CFNoDelete) { <span class="comment">// debug, mark nodel cells</span>
<a name="l01727"></a>01727                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> ccol(0.7,0.0,0.0);
<a name="l01728"></a>01728                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(ccol, 0.1);
<a name="l01729"></a>01729                 }
<a name="l01730"></a>01730                 <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a335b2f2f5253501c18dfff81b2ecc71b">CFPersistMask</a>) { <span class="comment">// mark persistent flags</span>
<a name="l01731"></a>01731                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> ccol(0.5);
<a name="l01732"></a>01732                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(ccol, 0.125);
<a name="l01733"></a>01733                 }
<a name="l01734"></a>01734                 <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a06a8f440b330072436f970902fedb653">CFNoBndFluid</a>) { <span class="comment">// mark persistent flags</span>
<a name="l01735"></a>01735                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> ccol(0,0,1);
<a name="l01736"></a>01736                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(ccol, 0.075);
<a name="l01737"></a>01737                 }
<a name="l01738"></a>01738 
<a name="l01739"></a>01739                 <span class="keywordflow">if</span>(flag&amp; CFInvalid) {
<a name="l01740"></a>01740                     cscale = 0.50;
<a name="l01741"></a>01741                     col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0.0,0,0.0);
<a name="l01742"></a>01742                 }
<a name="l01743"></a>01743                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFBnd) {
<a name="l01744"></a>01744                     cscale = 0.59;
<a name="l01745"></a>01745                     col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0.4);
<a name="l01746"></a>01746                 }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFInter) {
<a name="l01749"></a>01749                     cscale = 0.55;
<a name="l01750"></a>01750                     col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,1,1);
<a name="l01751"></a>01751 
<a name="l01752"></a>01752                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFGrFromCoarse) {
<a name="l01753"></a>01753                     <span class="comment">// draw as - with marker</span>
<a name="l01754"></a>01754                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> col2(0.0,1.0,0.3);
<a name="l01755"></a>01755                     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(col2, 0.1);
<a name="l01756"></a>01756                     cscale = 0.5;
<a name="l01757"></a>01757                     showcell=<span class="keyword">false</span>; <span class="comment">// DEBUG</span>
<a name="l01758"></a>01758                 }
<a name="l01759"></a>01759                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFFluid) {
<a name="l01760"></a>01760                     cscale = 0.5;
<a name="l01761"></a>01761                     <span class="keywordflow">if</span>(flag&amp; <a class="code" href="../../d2/d3c/solver__interface_8h.html#afb5b5e7719b4153bfbf061015f9d491a">CFGrToFine</a>) {
<a name="l01762"></a>01762                         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> col2(0.5,0.0,0.5);
<a name="l01763"></a>01763                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(col2, 0.1);
<a name="l01764"></a>01764                         col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,0,1);
<a name="l01765"></a>01765                     }
<a name="l01766"></a>01766                     <span class="keywordflow">if</span>(flag&amp; CFGrFromFine) {
<a name="l01767"></a>01767                         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> col2(1.0,1.0,0.0);
<a name="l01768"></a>01768                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(col2, 0.1);
<a name="l01769"></a>01769                         col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,0,1);
<a name="l01770"></a>01770                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFGrFromCoarse) {
<a name="l01771"></a>01771                         <span class="comment">// draw as fluid with marker</span>
<a name="l01772"></a>01772                         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlColor</a> col2(0.0,1.0,0.3);
<a name="l01773"></a>01773                         <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(col2, 0.1);
<a name="l01774"></a>01774                         col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,0,1);
<a name="l01775"></a>01775                     } <span class="keywordflow">else</span> {
<a name="l01776"></a>01776                         col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,0,1);
<a name="l01777"></a>01777                     }
<a name="l01778"></a>01778                 }
<a name="l01779"></a>01779                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFEmpty) {
<a name="l01780"></a>01780                     showcell=<span class="keyword">false</span>;
<a name="l01781"></a>01781                 }
<a name="l01782"></a>01782 
<a name="l01783"></a>01783             } <span class="keywordflow">break</span>;
<a name="l01784"></a>01784         <span class="keywordflow">case</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a846f6c66145a0b982b94b2cf67b5e0b6">FLUIDDISPVelocities</a>: {
<a name="l01785"></a>01785                 <span class="comment">// dont use cube display</span>
<a name="l01786"></a>01786                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> vel = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4e554919f1c6e0a902e3121813eeaf0a">getCellVelocity</a>( cell, <span class="keyword">set</span> );
<a name="l01787"></a>01787                 glBegin(GL_LINES);
<a name="l01788"></a>01788                 glColor3f( 0.0,0.0,0.0 );
<a name="l01789"></a>01789                 glVertex3f( org[0], org[1], org[2] );
<a name="l01790"></a>01790                 org += <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(vel * 10.0 * cscale);
<a name="l01791"></a>01791                 glColor3f( 1.0,1.0,1.0 );
<a name="l01792"></a>01792                 glVertex3f( org[0], org[1], org[2] );
<a name="l01793"></a>01793                 glEnd();
<a name="l01794"></a>01794                 showcell = <span class="keyword">false</span>;
<a name="l01795"></a>01795             } <span class="keywordflow">break</span>;
<a name="l01796"></a>01796         <span class="keywordflow">case</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a5f3de10aa57721a796c4582b00284933">FLUIDDISPCellfills</a>: {
<a name="l01797"></a>01797                 cscale = 0.5;
<a name="l01798"></a>01798                 <span class="keywordflow">if</span>(flag&amp; CFFluid) {
<a name="l01799"></a>01799                     cscale = 0.75;
<a name="l01800"></a>01800                     col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,0,0.5);
<a name="l01801"></a>01801                 }
<a name="l01802"></a>01802                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(flag&amp; CFInter) {
<a name="l01803"></a>01803                     cscale = 0.75 * this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c59a24baa7b0d75a8678d85ae5feedc">getCellMass</a>(cell,<span class="keyword">set</span>);
<a name="l01804"></a>01804                     col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,1,1);
<a name="l01805"></a>01805                 }
<a name="l01806"></a>01806                 <span class="keywordflow">else</span> {
<a name="l01807"></a>01807                     showcell=<span class="keyword">false</span>;
<a name="l01808"></a>01808                 }
<a name="l01809"></a>01809 
<a name="l01810"></a>01810                     <span class="keywordflow">if</span>( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c59a24baa7b0d75a8678d85ae5feedc">getCellMass</a>(cell,<span class="keyword">set</span>)) &lt; 10.0 ) {
<a name="l01811"></a>01811                         cscale = 0.75 * this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c59a24baa7b0d75a8678d85ae5feedc">getCellMass</a>(cell,<span class="keyword">set</span>);
<a name="l01812"></a>01812                     } <span class="keywordflow">else</span> {
<a name="l01813"></a>01813                         showcell = <span class="keyword">false</span>;
<a name="l01814"></a>01814                     }
<a name="l01815"></a>01815                     <span class="keywordflow">if</span>(cscale&gt;0.0) {
<a name="l01816"></a>01816                         col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(0,1,1);
<a name="l01817"></a>01817                     } <span class="keywordflow">else</span> {
<a name="l01818"></a>01818                         col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(1,1,0);
<a name="l01819"></a>01819                     }
<a name="l01820"></a>01820             <span class="comment">// TODO</span>
<a name="l01821"></a>01821             } <span class="keywordflow">break</span>;
<a name="l01822"></a>01822         <span class="keywordflow">case</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#a6ffb090247cfbd44eaf1dff4ca0ab892">FLUIDDISPDensity</a>: {
<a name="l01823"></a>01823                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rho = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac346ceb75e6787dfa4f6f2a1a95c108e">getCellDensity</a>(cell,<span class="keyword">set</span>);
<a name="l01824"></a>01824                 cscale = rho*rho * 0.25;
<a name="l01825"></a>01825                 col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>( <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#a74e75242132eaabbc1c512488a135926">MIN</a>(0.5+cscale,1.0) , <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#a74e75242132eaabbc1c512488a135926">MIN</a>(0.0+cscale,1.0), <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#a74e75242132eaabbc1c512488a135926">MIN</a>(0.0+cscale,1.0) );
<a name="l01826"></a>01826                 cscale *= 2.0;
<a name="l01827"></a>01827             } <span class="keywordflow">break</span>;
<a name="l01828"></a>01828         <span class="keywordflow">case</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#ac4014e1b7878ea60a3726672d3f6bd76">FLUIDDISPGrid</a>: {
<a name="l01829"></a>01829                 cscale = 0.59;
<a name="l01830"></a>01830                 col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(1.0);
<a name="l01831"></a>01831             } <span class="keywordflow">break</span>;
<a name="l01832"></a>01832         <span class="keywordflow">default</span>: {
<a name="l01833"></a>01833                 cscale = 0.5;
<a name="l01834"></a>01834                 col = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a325b681b6e65a5542b61d20c71eb52bc">ntlColor</a>(1.0,0.0,0.0);
<a name="l01835"></a>01835             } <span class="keywordflow">break</span>;
<a name="l01836"></a>01836     }
<a name="l01837"></a>01837 
<a name="l01838"></a>01838     <span class="keywordflow">if</span>(!showcell) <span class="keywordflow">return</span>;
<a name="l01839"></a>01839     <span class="keywordflow">if</span>(cscale==0.0) <span class="keywordflow">return</span>; <span class="comment">// dont draw zero values</span>
<a name="l01840"></a>01840     <a class="code" href="../../d9/d63/solver__util_8cpp.html#ac28ac78fb14dae7db3690654731d86b0">DRAWDISPCUBE</a>(col, cscale);
<a name="l01841"></a>01841 }
<a name="l01842"></a>01842 
<a name="l01844"></a>01844 <span class="comment">//  D has to implement the CellIterator interface</span>
<a name="l01845"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a927364b6770c0fee603c984110456d65">01845</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a927364b6770c0fee603c984110456d65" title="debug display function">LbmFsgrSolver::lbmDebugDisplay</a>(<span class="keywordtype">int</span> dispset) {
<a name="l01846"></a>01846     <span class="comment">// DEBUG always display testdata</span>
<a name="l01847"></a>01847 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01848"></a>01848 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>){ 
<a name="l01849"></a>01849         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5c1fac94e19f15f600900696963f2bb3">cpDebugDisplay</a>(dispset); 
<a name="l01850"></a>01850         mpTest-&gt;testDebugDisplay(dispset); 
<a name="l01851"></a>01851     }
<a name="l01852"></a>01852 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01853"></a>01853 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(dispset&lt;=<a class="code" href="../../d2/d3c/solver__interface_8h.html#a2a14cd6c0034837ee3674d9f57a1c0dc">FLUIDDISPNothing</a>) <span class="keywordflow">return</span>;
<a name="l01854"></a>01854     <span class="comment">//if(!dispset-&gt;on) return;</span>
<a name="l01855"></a>01855     glDisable( GL_LIGHTING ); <span class="comment">// dont light lines</span>
<a name="l01856"></a>01856 
<a name="l01857"></a>01857 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01858"></a>01858 <span class="preprocessor"></span>    <span class="keywordflow">if</span>((!<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>)|| (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3cbbe08b78aafee0bf1572e5bae2d811">mUseTestdata</a>)&amp;&amp;(mpTest-&gt;mFarfMode&lt;=0)) {
<a name="l01859"></a>01859 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01860"></a>01860 <span class="preprocessor"></span>
<a name="l01861"></a>01861     <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">LbmFsgrSolver::CellIdentifier</a> cid = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5a8025d0605521cce7a5b0fb6395274b" title="cell iteration methods">getFirstCell</a>();
<a name="l01862"></a>01862     <span class="keywordflow">for</span>(; this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad4cd91c2e9cef3596a5ad5d7134862aa">noEndCell</a>( cid );
<a name="l01863"></a>01863           this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a8970a89408155f93337656354886d7ae">advanceCell</a>( cid ) ) {
<a name="l01864"></a>01864         this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac2f46ef215bab96bc9bbb86f70894030" title="display a single node">debugDisplayNode</a>(dispset, cid );
<a name="l01865"></a>01865     }
<a name="l01866"></a>01866     <span class="keyword">delete</span> cid;
<a name="l01867"></a>01867 
<a name="l01868"></a>01868 <span class="preprocessor">#if LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01869"></a>01869 <span class="preprocessor"></span>    } <span class="comment">// 3d check</span>
<a name="l01870"></a>01870 <span class="preprocessor">#endif // LBM_INCLUDE_TESTSOLVERS==1</span>
<a name="l01871"></a>01871 <span class="preprocessor"></span>
<a name="l01872"></a>01872     glEnable( GL_LIGHTING ); <span class="comment">// dont light lines</span>
<a name="l01873"></a>01873 }
<a name="l01874"></a>01874 
<a name="l01876"></a>01876 <span class="comment">//  D has to implement the CellIterator interface</span>
<a name="l01877"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3abae952a82a4f8e4f23b2871d8a8b2a">01877</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3abae952a82a4f8e4f23b2871d8a8b2a" title="debug display function">LbmFsgrSolver::lbmMarkedCellDisplay</a>() {
<a name="l01878"></a>01878     <span class="comment">//fluidDispSettings dispset;</span>
<a name="l01879"></a>01879     <span class="comment">// trick - display marked cells as grid displa -&gt; white, big</span>
<a name="l01880"></a>01880     <span class="keywordtype">int</span> dispset = <a class="code" href="../../d2/d3c/solver__interface_8h.html#ac4014e1b7878ea60a3726672d3f6bd76">FLUIDDISPGrid</a>;
<a name="l01881"></a>01881     glDisable( GL_LIGHTING ); <span class="comment">// dont light lines</span>
<a name="l01882"></a>01882     
<a name="l01883"></a>01883     <a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">LbmFsgrSolver::CellIdentifier</a> cid = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#abc60be7238632ad2d70301b178f9b3c9" title="marked cell iteration methods">markedGetFirstCell</a>();
<a name="l01884"></a>01884     <span class="keywordflow">while</span>(cid) {
<a name="l01885"></a>01885         this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac2f46ef215bab96bc9bbb86f70894030" title="display a single node">debugDisplayNode</a>(dispset, cid );
<a name="l01886"></a>01886         cid = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#adf7e45a8acc1158dd92f1d2bda8240dd">markedAdvanceCell</a>();
<a name="l01887"></a>01887     }
<a name="l01888"></a>01888     <span class="keyword">delete</span> cid;
<a name="l01889"></a>01889 
<a name="l01890"></a>01890     glEnable( GL_LIGHTING ); <span class="comment">// dont light lines</span>
<a name="l01891"></a>01891 }
<a name="l01892"></a>01892 
<a name="l01893"></a>01893 <span class="preprocessor">#endif // LBM_USE_GUI==1</span>
<a name="l01894"></a>01894 <span class="preprocessor"></span>
<a name="l01896"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a280807c1f40c13e806a253b087ef98e7">01896</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a280807c1f40c13e806a253b087ef98e7" title="display a single node">LbmFsgrSolver::debugPrintNodeInfo</a>(<a class="code" href="../../dd/dba/classCellIdentifierInterface.html" title="cell identifier interface">CellIdentifierInterface</a>* cell, <span class="keywordtype">int</span> forceSet) {
<a name="l01897"></a>01897         <span class="comment">//string printInfo,</span>
<a name="l01898"></a>01898         <span class="comment">// force printing of one set? default = -1 = off</span>
<a name="l01899"></a>01899   <span class="keywordtype">bool</span> printDF     = <span class="keyword">false</span>;
<a name="l01900"></a>01900   <span class="keywordtype">bool</span> printRho    = <span class="keyword">false</span>;
<a name="l01901"></a>01901   <span class="keywordtype">bool</span> printVel    = <span class="keyword">false</span>;
<a name="l01902"></a>01902   <span class="keywordtype">bool</span> printFlag   = <span class="keyword">false</span>;
<a name="l01903"></a>01903   <span class="keywordtype">bool</span> printGeom   = <span class="keyword">false</span>;
<a name="l01904"></a>01904   <span class="keywordtype">bool</span> printMass=<span class="keyword">false</span>;
<a name="l01905"></a>01905     <span class="keywordtype">bool</span> printBothSets = <span class="keyword">false</span>;
<a name="l01906"></a>01906     <span class="keywordtype">string</span> printInfo = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a271dd16cfb3d9608cb175c1ffb6bcee4">getNodeInfoString</a>();
<a name="l01907"></a>01907 
<a name="l01908"></a>01908     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;printInfo.length()-0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01909"></a>01909         <span class="keywordtype">char</span> what = printInfo[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01910"></a>01910         <span class="keywordflow">switch</span>(what) {
<a name="l01911"></a>01911             <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>: <span class="comment">// all on</span>
<a name="l01912"></a>01912                                 printDF = <span class="keyword">true</span>; printRho = <span class="keyword">true</span>; printVel = <span class="keyword">true</span>; printFlag = <span class="keyword">true</span>; printGeom = <span class="keyword">true</span>; printMass = true ;
<a name="l01913"></a>01913                                 printBothSets = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01914"></a>01914             <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>: <span class="comment">// all off</span>
<a name="l01915"></a>01915                                 printDF = <span class="keyword">false</span>; printRho = <span class="keyword">false</span>; printVel = <span class="keyword">false</span>; printFlag = <span class="keyword">false</span>; printGeom = <span class="keyword">false</span>; printMass = <span class="keyword">false</span>; 
<a name="l01916"></a>01916                                 printBothSets = <span class="keyword">false</span>; <span class="keywordflow">break</span>;
<a name="l01917"></a>01917             <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>: printDF = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01918"></a>01918             <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>: printRho = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01919"></a>01919             <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: printVel = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01920"></a>01920             <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: printFlag = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01921"></a>01921             <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>: printGeom = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01922"></a>01922             <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: printMass = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01923"></a>01923             <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: printBothSets = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
<a name="l01924"></a>01924             <span class="keywordflow">default</span>: 
<a name="l01925"></a>01925                 <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;debugPrintNodeInfo&quot;</span>,<span class="stringliteral">&quot;Invalid node info id &quot;</span>&lt;&lt;what,<a class="code" href="../../de/df0/utilities_8h.html#af2f6eab59be57681799dbee88ff4c4a7">SIMWORLD_GENERICERROR</a>); <span class="keywordflow">return</span>;
<a name="l01926"></a>01926         }
<a name="l01927"></a>01927     }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> org      = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a2e4be60139e21dfe7e48d1e2d92447e2">getCellOrigin</a>( cell );
<a name="l01930"></a>01930     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> halfsize = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a672845c664b5f2831b53cbefdf0394e7">getCellSize</a>( cell );
<a name="l01931"></a>01931     <span class="keywordtype">int</span>    <span class="keyword">set</span>      = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a185fff614b095dcca1970a1185c6e637" title="return node information">getCellSet</a>( cell );
<a name="l01932"></a>01932     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;debugPrintNodeInfo&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>, <span class="stringliteral">&quot;Printing cell info &#39;&quot;</span>&lt;&lt;printInfo&lt;&lt;<span class="stringliteral">&quot;&#39; for node: &quot;</span>&lt;&lt;cell-&gt;<a class="code" href="../../dd/dba/classCellIdentifierInterface.html#ae58373c67e21e24f922cdb1262cf809b" title="return node as string (with some basic info)">getAsString</a>()&lt;&lt;<span class="stringliteral">&quot; from &quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#aebe73e6fbafee469315fb5d83f1c451c">getName</a>()&lt;&lt;<span class="stringliteral">&quot; currSet:&quot;</span>&lt;&lt;set , 1);
<a name="l01933"></a>01933     <span class="keywordflow">if</span>(printGeom) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Org:&quot;</span>&lt;&lt;org&lt;&lt;<span class="stringliteral">&quot; Halfsize:&quot;</span>&lt;&lt;halfsize&lt;&lt;<span class="stringliteral">&quot; &quot;</span>, 1);
<a name="l01934"></a>01934 
<a name="l01935"></a>01935     <span class="keywordtype">int</span> setmax = 2;
<a name="l01936"></a>01936     <span class="keywordflow">if</span>(!printBothSets) setmax = 1;
<a name="l01937"></a>01937     <span class="keywordflow">if</span>(forceSet&gt;=0) setmax = 1;
<a name="l01938"></a>01938 
<a name="l01939"></a>01939     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;setmax; s++) {
<a name="l01940"></a>01940         <span class="keywordtype">int</span> workset = <span class="keyword">set</span>;
<a name="l01941"></a>01941         <span class="keywordflow">if</span>(s==1){ workset = (<span class="keyword">set</span>^1); }      
<a name="l01942"></a>01942         <span class="keywordflow">if</span>(forceSet&gt;=0) workset = forceSet;
<a name="l01943"></a>01943         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Printing set:&quot;</span>&lt;&lt;workset&lt;&lt;<span class="stringliteral">&quot; orgSet:&quot;</span>&lt;&lt;<span class="keyword">set</span>, 1);
<a name="l01944"></a>01944         
<a name="l01945"></a>01945         <span class="keywordflow">if</span>(printDF) {
<a name="l01946"></a>01946             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#a5b93395a4f54a13f465488eb134e010d">LBM_DFNUM</a>; l++) { <span class="comment">// FIXME ??</span>
<a name="l01947"></a>01947                 <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;  Df&quot;</span>&lt;&lt;l&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55b35ac4660b0250eb113ac230ee301b">getCellDf</a>(cell,workset,l), 1);
<a name="l01948"></a>01948             }
<a name="l01949"></a>01949         }
<a name="l01950"></a>01950         <span class="keywordflow">if</span>(printRho) {
<a name="l01951"></a>01951             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;  Rho: &quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac346ceb75e6787dfa4f6f2a1a95c108e">getCellDensity</a>(cell,workset), 1);
<a name="l01952"></a>01952         }
<a name="l01953"></a>01953         <span class="keywordflow">if</span>(printVel) {
<a name="l01954"></a>01954             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;  Vel: &quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a4e554919f1c6e0a902e3121813eeaf0a">getCellVelocity</a>(cell,workset), 1);
<a name="l01955"></a>01955         }
<a name="l01956"></a>01956         <span class="keywordflow">if</span>(printFlag) {
<a name="l01957"></a>01957             <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> flag = this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a18badb3ac4eef9cec381880247ab92d1">getCellFlag</a>(cell,workset);
<a name="l01958"></a>01958             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;  Flg: &quot;</span>&lt;&lt; flag&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#adac9c60a704d247b648a4ad362d7ed9e" title="helper function that converts a flag field to a readable integer">convertFlags2String</a>( flag ) &lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../da/d9f/solver__interface_8cpp.html#a232a0b36030169b0250e3e21814fcb23" title="helper function to convert flag to string (for debuggin)">convertCellFlagType2String</a>( flag ), 1);
<a name="l01959"></a>01959         }
<a name="l01960"></a>01960         <span class="keywordflow">if</span>(printMass) {
<a name="l01961"></a>01961             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;  Mss: &quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c59a24baa7b0d75a8678d85ae5feedc">getCellMass</a>(cell,workset), 1);
<a name="l01962"></a>01962         }
<a name="l01963"></a>01963         <span class="comment">// dirty... TODO fixme</span>
<a name="l01964"></a>01964         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;                  &quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;  Flx: &quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a55b35ac4660b0250eb113ac230ee301b">getCellDf</a>(cell,workset,<a class="code" href="../../d2/d3c/solver__interface_8h.html#a510b7f66ad01b66603cc08e98ad3aa49">dFlux</a>), 1);
<a name="l01965"></a>01965     }
<a name="l01966"></a>01966 }
<a name="l01967"></a>01967 
<a name="l01968"></a>01968 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:56 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: GHOST_WindowWin32.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">GHOST_WindowWin32.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d6/d29/GHOST__WindowWin32_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html">GHOST_WindowWin32.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d46/GHOST__SystemWin32_8h.html">GHOST_SystemWin32.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../da/da7/GHOST__DropTargetWin32_8h.html">GHOST_DropTargetWin32.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d8d/utfconv_8h.html">utfconv.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d45/utf__winfunc_8h.html">utf_winfunc.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">// Need glew for some defines</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;GL/glew.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;GL/wglew.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// MSVC6 still doesn&#39;t define M_PI</span>
<a name="l00053"></a>00053 <span class="preprocessor">#ifndef M_PI</span>
<a name="l00054"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define M_PI 3.1415926536</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 <span class="comment">// Some more multisample defines</span>
<a name="l00058"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a54739f060fbba5b809f237cbc80cc05d">00058</a> <span class="preprocessor">#define WGL_SAMPLE_BUFERS_ARB   0x2041</span>
<a name="l00059"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a99289a023da8e683eb7de95543e22c87">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define WGL_SAMPLES_ARB         0x2042</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 <span class="comment">// win64 doesn&#39;t define GWL_USERDATA</span>
<a name="l00062"></a>00062 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#ifndef GWL_USERDATA</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#define GWL_USERDATA GWLP_USERDATA</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define GWL_WNDPROC GWLP_WNDPROC</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="keywordtype">wchar_t</span>* <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#acb25f747cdc0393ceb46c5cbabee99c0">GHOST_WindowWin32::s_windowClassName</a> = <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a><span class="stringliteral">&quot;GHOST_WindowClass&quot;</span>;
<a name="l00070"></a>00070 <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a3a58bbcf4d7b74214bb7a390e1d46141">GHOST_WindowWin32::s_maxTitleLength</a> = 128;
<a name="l00071"></a>00071 HGLRC <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">GHOST_WindowWin32::s_firsthGLRc</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00072"></a>00072 HDC <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aaed62814edb3535247517bd6339d5312">GHOST_WindowWin32::s_firstHDC</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0cdbae62f9ba95881e77583d1034854d">WeightPixelFormat</a>(PIXELFORMATDESCRIPTOR&amp; pfd);
<a name="l00075"></a>00075 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ad0e9f1078577536f4920a29ef589cb7a">EnumPixelFormats</a>(HDC hdc);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">/*</span>
<a name="l00078"></a>00078 <span class="comment"> * Color and depth bit values are not to be trusted.</span>
<a name="l00079"></a>00079 <span class="comment"> * For instance, on TNT2:</span>
<a name="l00080"></a>00080 <span class="comment"> * When the screen color depth is set to 16 bit, we get 5 color bits</span>
<a name="l00081"></a>00081 <span class="comment"> * and 16 depth bits.</span>
<a name="l00082"></a>00082 <span class="comment"> * When the screen color depth is set to 32 bit, we get 8 color bits</span>
<a name="l00083"></a>00083 <span class="comment"> * and 24 depth bits.</span>
<a name="l00084"></a>00084 <span class="comment"> * Just to be safe, we request high waulity settings.</span>
<a name="l00085"></a>00085 <span class="comment"> */</span>
<a name="l00086"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">00086</a> <span class="keyword">static</span> PIXELFORMATDESCRIPTOR <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">sPreferredFormat</a> = {
<a name="l00087"></a>00087     <span class="keyword">sizeof</span>(PIXELFORMATDESCRIPTOR),  <span class="comment">/* size */</span>
<a name="l00088"></a>00088     1,                              <span class="comment">/* version */</span>
<a name="l00089"></a>00089     PFD_SUPPORT_OPENGL |
<a name="l00090"></a>00090     PFD_DRAW_TO_WINDOW |
<a name="l00091"></a>00091     PFD_SWAP_COPY |                 <span class="comment">/* support swap copy */</span>
<a name="l00092"></a>00092     PFD_DOUBLEBUFFER,               <span class="comment">/* support double-buffering */</span>
<a name="l00093"></a>00093     PFD_TYPE_RGBA,                  <span class="comment">/* color type */</span>
<a name="l00094"></a>00094     32,                             <span class="comment">/* prefered color depth */</span>
<a name="l00095"></a>00095     0, 0, 0, 0, 0, 0,               <span class="comment">/* color bits (ignored) */</span>
<a name="l00096"></a>00096     0,                              <span class="comment">/* no alpha buffer */</span>
<a name="l00097"></a>00097     0,                              <span class="comment">/* alpha bits (ignored) */</span>
<a name="l00098"></a>00098     0,                              <span class="comment">/* no accumulation buffer */</span>
<a name="l00099"></a>00099     0, 0, 0, 0,                     <span class="comment">/* accum bits (ignored) */</span>
<a name="l00100"></a>00100     32,                             <span class="comment">/* depth buffer */</span>
<a name="l00101"></a>00101     0,                              <span class="comment">/* no stencil buffer */</span>
<a name="l00102"></a>00102     0,                              <span class="comment">/* no auxiliary buffers */</span>
<a name="l00103"></a>00103     PFD_MAIN_PLANE,                 <span class="comment">/* main layer */</span>
<a name="l00104"></a>00104     0,                              <span class="comment">/* reserved */</span>
<a name="l00105"></a>00105     0, 0, 0                         <span class="comment">/* no layer, visible, damage masks */</span>
<a name="l00106"></a>00106 };
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="comment">/* Intel videocards don&#39;t work fine with multiple contexts and</span>
<a name="l00109"></a>00109 <span class="comment">   have to share the same context for all windows.</span>
<a name="l00110"></a>00110 <span class="comment">   But if we just share context for all windows it could work incorrect</span>
<a name="l00111"></a>00111 <span class="comment">   with multiple videocards configuration. Suppose, that Intel videocards</span>
<a name="l00112"></a>00112 <span class="comment">   can&#39;t be in multiple-devices configuration. */</span>
<a name="l00113"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#aca120656f7df1e22e546cabeba59363d">00113</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#aca120656f7df1e22e546cabeba59363d">is_crappy_intel_card</a>(<span class="keywordtype">void</span>)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <span class="keywordtype">int</span> crappy = 0;
<a name="l00116"></a>00116     <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor = (<span class="keyword">const</span> <span class="keywordtype">char</span>*)glGetString(GL_VENDOR);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (strstr(vendor, <span class="stringliteral">&quot;Intel&quot;</span>))
<a name="l00119"></a>00119         crappy = 1;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">return</span> crappy;
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad3840c2bd3e1729647c4a272eacfaefe">00124</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad3840c2bd3e1729647c4a272eacfaefe">GHOST_WindowWin32::GHOST_WindowWin32</a>(
<a name="l00125"></a>00125     <a class="code" href="../../d5/d71/classGHOST__SystemWin32.html">GHOST_SystemWin32</a> * system,
<a name="l00126"></a>00126     <span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; title,
<a name="l00127"></a>00127     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>,
<a name="l00128"></a>00128     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> top,
<a name="l00129"></a>00129     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> width,
<a name="l00130"></a>00130     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> height,
<a name="l00131"></a>00131     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>,
<a name="l00132"></a>00132     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02">GHOST_TDrawingContextType</a> type,
<a name="l00133"></a>00133     <span class="keyword">const</span> <span class="keywordtype">bool</span> stereoVisual,
<a name="l00134"></a>00134     <span class="keyword">const</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a7ec606b4460e506e0be41a33415f2c6e">GHOST_TUns16</a> numOfAASamples,
<a name="l00135"></a>00135     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8b4e84f04dbc6b1b2e31c4841140fac9">GHOST_TEmbedderWindowID</a> parentwindowhwnd,
<a name="l00136"></a>00136     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> msEnabled,
<a name="l00137"></a>00137     <span class="keywordtype">int</span> msPixelFormat)
<a name="l00138"></a>00138 :
<a name="l00139"></a>00139     <a class="code" href="../../de/db8/classGHOST__Window.html">GHOST_Window</a>(width, height, state, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02ad0d42aef821d08b9b01b32da72888cc0">GHOST_kDrawingContextTypeNone</a>,
<a name="l00140"></a>00140     stereoVisual,numOfAASamples),
<a name="l00141"></a>00141     m_system(system),
<a name="l00142"></a>00142     m_hDC(0),
<a name="l00143"></a>00143     m_hGlRc(0),
<a name="l00144"></a>00144     m_hasMouseCaptured(false),
<a name="l00145"></a>00145     m_hasGrabMouse(false),
<a name="l00146"></a>00146     m_nPressedButtons(0),
<a name="l00147"></a>00147     m_customCursor(0),
<a name="l00148"></a>00148     m_wintab(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00149"></a>00149     m_tabletData(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00150"></a>00150     m_tablet(0),
<a name="l00151"></a>00151     m_maxPressure(0),
<a name="l00152"></a>00152     m_multisample(numOfAASamples),
<a name="l00153"></a>00153     m_parentWindowHwnd(parentwindowhwnd),
<a name="l00154"></a>00154     m_multisampleEnabled(msEnabled),
<a name="l00155"></a>00155     m_msPixelFormat(msPixelFormat),
<a name="l00156"></a>00156     <span class="comment">//For recreation</span>
<a name="l00157"></a>00157     m_title(title),
<a name="l00158"></a>00158     m_left(left),
<a name="l00159"></a>00159     m_top(top),
<a name="l00160"></a>00160     m_width(width),
<a name="l00161"></a>00161     m_height(height),
<a name="l00162"></a>00162     m_normal_state(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>),
<a name="l00163"></a>00163     m_stereo(stereoVisual),
<a name="l00164"></a>00164     m_nextWindow(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166     OSVERSIONINFOEX versionInfo;
<a name="l00167"></a>00167     <span class="keywordtype">bool</span> hasMinVersionForTaskbar = <span class="keyword">false</span>;
<a name="l00168"></a>00168     
<a name="l00169"></a>00169     ZeroMemory(&amp;versionInfo, <span class="keyword">sizeof</span>(OSVERSIONINFOEX));
<a name="l00170"></a>00170     
<a name="l00171"></a>00171     versionInfo.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVERSIONINFOEX);
<a name="l00172"></a>00172     
<a name="l00173"></a>00173     <span class="keywordflow">if</span>(!GetVersionEx((OSVERSIONINFO *)&amp;versionInfo)) {
<a name="l00174"></a>00174         versionInfo.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVERSIONINFO);
<a name="l00175"></a>00175         <span class="keywordflow">if</span>(GetVersionEx((OSVERSIONINFO*)&amp;versionInfo)) {
<a name="l00176"></a>00176             <span class="keywordflow">if</span>((versionInfo.dwMajorVersion==6 &amp;&amp; versionInfo.dwMinorVersion&gt;=1) || versionInfo.dwMajorVersion &gt;= 7) {
<a name="l00177"></a>00177                 hasMinVersionForTaskbar = <span class="keyword">true</span>;
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180     } <span class="keywordflow">else</span> {
<a name="l00181"></a>00181         <span class="keywordflow">if</span>((versionInfo.dwMajorVersion==6 &amp;&amp; versionInfo.dwMinorVersion&gt;=1) || versionInfo.dwMajorVersion &gt;= 7) {
<a name="l00182"></a>00182             hasMinVersionForTaskbar = <span class="keyword">true</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="keywordflow">if</span> (state != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>) {
<a name="l00187"></a>00187         RECT rect;
<a name="l00188"></a>00188         MONITORINFO monitor;
<a name="l00189"></a>00189         <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> tw, th; 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         width += GetSystemMetrics(SM_CXSIZEFRAME)*2;
<a name="l00192"></a>00192         height += GetSystemMetrics(SM_CYSIZEFRAME)*2 + GetSystemMetrics(SM_CYCAPTION);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         rect.left = <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>;
<a name="l00195"></a>00195         rect.right = left + width;
<a name="l00196"></a>00196         rect.top = top;
<a name="l00197"></a>00197         rect.bottom = top + height;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         monitor.cbSize=<span class="keyword">sizeof</span>(monitor);
<a name="l00200"></a>00200         monitor.dwFlags=0;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="comment">// take taskbar into account</span>
<a name="l00203"></a>00203         GetMonitorInfo(MonitorFromRect(&amp;rect,MONITOR_DEFAULTTONEAREST),&amp;monitor);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         th = monitor.rcWork.bottom - monitor.rcWork.top;
<a name="l00206"></a>00206         tw = monitor.rcWork.right - monitor.rcWork.left;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <span class="keywordflow">if</span>(tw &lt; width)
<a name="l00209"></a>00209         {
<a name="l00210"></a>00210             width = tw;
<a name="l00211"></a>00211             left = monitor.rcWork.left;
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(monitor.rcWork.right &lt; left + (<span class="keywordtype">int</span>)width)
<a name="l00214"></a>00214             left = monitor.rcWork.right - width;
<a name="l00215"></a>00215         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(left &lt; monitor.rcWork.left)
<a name="l00216"></a>00216             left = monitor.rcWork.left;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <span class="keywordflow">if</span>(th &lt; height)
<a name="l00219"></a>00219         {
<a name="l00220"></a>00220             height = th;
<a name="l00221"></a>00221             top = monitor.rcWork.top;
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(monitor.rcWork.bottom &lt; top + (<span class="keywordtype">int</span>)height)
<a name="l00224"></a>00224             top = monitor.rcWork.bottom - height;
<a name="l00225"></a>00225         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(top &lt; monitor.rcWork.top)
<a name="l00226"></a>00226             top = monitor.rcWork.top;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228         <span class="keywordtype">int</span> wintype = WS_OVERLAPPEDWINDOW;
<a name="l00229"></a>00229         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a37187288d4f8c9c03f08b7495ab2f9b5">m_parentWindowHwnd</a> != 0)
<a name="l00230"></a>00230         {
<a name="l00231"></a>00231             wintype = WS_CHILD;
<a name="l00232"></a>00232             GetWindowRect((HWND)<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a37187288d4f8c9c03f08b7495ab2f9b5">m_parentWindowHwnd</a>, &amp;rect);
<a name="l00233"></a>00233             left = 0;
<a name="l00234"></a>00234             top = 0;
<a name="l00235"></a>00235             width = rect.right - rect.left;
<a name="l00236"></a>00236             height = rect.bottom - rect.top;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238         
<a name="l00239"></a>00239         <span class="keywordtype">wchar_t</span> * title_16 = <a class="code" href="../../d6/d8a/utfconv_8c.html#a92ea6b21a575d411e9fbcbca5428a3cb">alloc_utf16_from_8</a>((<span class="keywordtype">char</span>*)(<span class="keyword">const</span> <span class="keywordtype">char</span>*)title,0);
<a name="l00240"></a>00240         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a> = ::CreateWindowW(
<a name="l00241"></a>00241             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#acb25f747cdc0393ceb46c5cbabee99c0">s_windowClassName</a>,          <span class="comment">// pointer to registered class name</span>
<a name="l00242"></a>00242             title_16,                       <span class="comment">// pointer to window name</span>
<a name="l00243"></a>00243             wintype,                    <span class="comment">// window style</span>
<a name="l00244"></a>00244             <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>,                   <span class="comment">// horizontal position of window</span>
<a name="l00245"></a>00245             top,                    <span class="comment">// vertical position of window</span>
<a name="l00246"></a>00246             width,                      <span class="comment">// window width</span>
<a name="l00247"></a>00247             height,                     <span class="comment">// window height</span>
<a name="l00248"></a>00248             (HWND) <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a37187288d4f8c9c03f08b7495ab2f9b5">m_parentWindowHwnd</a>,  <span class="comment">// handle to parent or owner window</span>
<a name="l00249"></a>00249             0,                          <span class="comment">// handle to menu or child-window identifier</span>
<a name="l00250"></a>00250             ::GetModuleHandle(0),       <span class="comment">// handle to application instance</span>
<a name="l00251"></a>00251             0);                         <span class="comment">// pointer to window-creation data</span>
<a name="l00252"></a>00252         free(title_16);
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254     <span class="keywordflow">else</span> {
<a name="l00255"></a>00255         <span class="keywordtype">wchar_t</span> * title_16 = <a class="code" href="../../d6/d8a/utfconv_8c.html#a92ea6b21a575d411e9fbcbca5428a3cb">alloc_utf16_from_8</a>((<span class="keywordtype">char</span>*)(<span class="keyword">const</span> <span class="keywordtype">char</span>*)title,0);
<a name="l00256"></a>00256         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a> = ::CreateWindowW(
<a name="l00257"></a>00257             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#acb25f747cdc0393ceb46c5cbabee99c0">s_windowClassName</a>,          <span class="comment">// pointer to registered class name</span>
<a name="l00258"></a>00258             title_16,                       <span class="comment">// pointer to window name</span>
<a name="l00259"></a>00259             WS_POPUP | WS_MAXIMIZE,     <span class="comment">// window style</span>
<a name="l00260"></a>00260             <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>,                       <span class="comment">// horizontal position of window</span>
<a name="l00261"></a>00261             top,                        <span class="comment">// vertical position of window</span>
<a name="l00262"></a>00262             width,                      <span class="comment">// window width</span>
<a name="l00263"></a>00263             height,                     <span class="comment">// window height</span>
<a name="l00264"></a>00264             HWND_DESKTOP,               <span class="comment">// handle to parent or owner window</span>
<a name="l00265"></a>00265             0,                          <span class="comment">// handle to menu or child-window identifier</span>
<a name="l00266"></a>00266             ::GetModuleHandle(0),       <span class="comment">// handle to application instance</span>
<a name="l00267"></a>00267             0);                         <span class="comment">// pointer to window-creation data</span>
<a name="l00268"></a>00268         free(title_16);
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>) {
<a name="l00271"></a>00271         <span class="comment">// Register this window as a droptarget. Requires m_hWnd to be valid.</span>
<a name="l00272"></a>00272         <span class="comment">// Note that OleInitialize(0) has to be called prior to this. Done in GHOST_SystemWin32.</span>
<a name="l00273"></a>00273         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9516a0c902ef0179407d88b3d17673dd">m_dropTarget</a> = <span class="keyword">new</span> <a class="code" href="../../de/d9e/classGHOST__DropTargetWin32.html">GHOST_DropTargetWin32</a>(<span class="keyword">this</span>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6441fdc586a0736effa29745323ace24">m_system</a>);
<a name="l00274"></a>00274         <span class="comment">// Store a pointer to this class in the window structure</span>
<a name="l00275"></a>00275         ::SetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_USERDATA, (LONG_PTR)<span class="keyword">this</span>);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">// Store the device context</span>
<a name="l00278"></a>00278         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a> = ::GetDC(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">if</span>(!<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aaed62814edb3535247517bd6339d5312">s_firstHDC</a>) {
<a name="l00281"></a>00281             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aaed62814edb3535247517bd6339d5312">s_firstHDC</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>;
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">// Show the window</span>
<a name="l00285"></a>00285         <span class="keywordtype">int</span> nCmdShow;
<a name="l00286"></a>00286         <span class="keywordflow">switch</span> (state) {
<a name="l00287"></a>00287             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546aa1d6a669a409edc14aabbebddac07aac">GHOST_kWindowStateMaximized</a>:
<a name="l00288"></a>00288                 nCmdShow = SW_SHOWMAXIMIZED;
<a name="l00289"></a>00289                 <span class="keywordflow">break</span>;
<a name="l00290"></a>00290             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546a88de0b7d5b7d4843d7d4133255817078">GHOST_kWindowStateMinimized</a>:
<a name="l00291"></a>00291                 nCmdShow = SW_SHOWMINIMIZED;
<a name="l00292"></a>00292                 <span class="keywordflow">break</span>;
<a name="l00293"></a>00293             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>:
<a name="l00294"></a>00294             <span class="keywordflow">default</span>:
<a name="l00295"></a>00295                 nCmdShow = SW_SHOWNORMAL;
<a name="l00296"></a>00296                 <span class="keywordflow">break</span>;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00299"></a>00299         success = <a class="code" href="../../de/db8/classGHOST__Window.html#a4120ccc4b1e9cc12b6c17a94d8aea350">setDrawingContextType</a>(type);
<a name="l00300"></a>00300 
<a name="l00301"></a>00301         <span class="keywordflow">if</span> (success)
<a name="l00302"></a>00302         {
<a name="l00303"></a>00303             ::ShowWindow(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, nCmdShow);
<a name="l00304"></a>00304             <span class="comment">// Force an initial paint of the window</span>
<a name="l00305"></a>00305             ::UpdateWindow(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>);
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307         <span class="keywordflow">else</span>
<a name="l00308"></a>00308         {
<a name="l00309"></a>00309             <span class="comment">//invalidate the window</span>
<a name="l00310"></a>00310             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a> = 0;
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (parentwindowhwnd != 0) {
<a name="l00315"></a>00315         RAWINPUTDEVICE device = {0};
<a name="l00316"></a>00316         device.usUsagePage  = 0x01; <span class="comment">/* usUsagePage &amp; usUsage for keyboard*/</span>
<a name="l00317"></a>00317         device.usUsage      = 0x06; <span class="comment">/* http://msdn.microsoft.com/en-us/windows/hardware/gg487473.aspx */</span>
<a name="l00318"></a>00318         device.dwFlags |= RIDEV_INPUTSINK; <span class="comment">// makes WM_INPUT is visible for ghost when has parent window</span>
<a name="l00319"></a>00319         device.hwndTarget = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>;
<a name="l00320"></a>00320         RegisterRawInputDevices(&amp;device, 1, <span class="keyword">sizeof</span>(device));
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a> = ::LoadLibrary(<span class="stringliteral">&quot;Wintab32.dll&quot;</span>);
<a name="l00324"></a>00324     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>) {
<a name="l00325"></a>00325         GHOST_WIN32_WTInfo fpWTInfo = ( GHOST_WIN32_WTInfo ) ::GetProcAddress( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>, <span class="stringliteral">&quot;WTInfoA&quot;</span> );
<a name="l00326"></a>00326         GHOST_WIN32_WTOpen fpWTOpen = ( GHOST_WIN32_WTOpen ) ::GetProcAddress( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>, <span class="stringliteral">&quot;WTOpenA&quot;</span> );
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="comment">// let&#39;s see if we can initialize tablet here</span>
<a name="l00329"></a>00329         <span class="comment">/* check if WinTab available. */</span>
<a name="l00330"></a>00330         <span class="keywordflow">if</span> (fpWTInfo &amp;&amp; fpWTInfo(0, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00331"></a>00331             <span class="comment">// Now init the tablet</span>
<a name="l00332"></a>00332             LOGCONTEXT lc;
<a name="l00333"></a>00333             AXIS TabletX, TabletY, Pressure, Orientation[3]; <span class="comment">/* The maximum tablet size, pressure and orientation (tilt) */</span>
<a name="l00334"></a>00334 
<a name="l00335"></a>00335             <span class="comment">// Open a Wintab context</span>
<a name="l00336"></a>00336 
<a name="l00337"></a>00337             <span class="comment">// Get default context information</span>
<a name="l00338"></a>00338             fpWTInfo( WTI_DEFCONTEXT, 0, &amp;lc );
<a name="l00339"></a>00339 
<a name="l00340"></a>00340             <span class="comment">// Open the context</span>
<a name="l00341"></a>00341             lc.lcPktData = <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a6f38d5b91e40463e5ae9412e892dea9a">PACKETDATA</a>;
<a name="l00342"></a>00342             lc.lcPktMode = <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a2cfa5b94a82f36283fbf5a0d8f2b1ce5">PACKETMODE</a>;
<a name="l00343"></a>00343             lc.lcOptions |= CXO_MESSAGES | CXO_SYSTEM;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345             <span class="comment">/* Set the entire tablet as active */</span>
<a name="l00346"></a>00346             fpWTInfo(WTI_DEVICES,DVC_X,&amp;TabletX);
<a name="l00347"></a>00347             fpWTInfo(WTI_DEVICES,DVC_Y,&amp;TabletY);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349             <span class="comment">/* get the max pressure, to divide into a float */</span>
<a name="l00350"></a>00350             <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a3be13892ae7076009afcf121347dd319">BOOL</a> pressureSupport = fpWTInfo (WTI_DEVICES, DVC_NPRESSURE, &amp;Pressure);
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (pressureSupport)
<a name="l00352"></a>00352                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a5e191f8a2ce6d85e7b2508a6e8e6d0bb">m_maxPressure</a> = Pressure.axMax;
<a name="l00353"></a>00353             <span class="keywordflow">else</span>
<a name="l00354"></a>00354                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a5e191f8a2ce6d85e7b2508a6e8e6d0bb">m_maxPressure</a> = 0;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356             <span class="comment">/* get the max tilt axes, to divide into floats */</span>
<a name="l00357"></a>00357             <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a3be13892ae7076009afcf121347dd319">BOOL</a> tiltSupport = fpWTInfo (WTI_DEVICES, DVC_ORIENTATION, &amp;Orientation);
<a name="l00358"></a>00358             <span class="keywordflow">if</span> (tiltSupport) {
<a name="l00359"></a>00359                 <span class="comment">/* does the tablet support azimuth ([0]) and altitude ([1]) */</span>
<a name="l00360"></a>00360                 <span class="keywordflow">if</span> (Orientation[0].axResolution &amp;&amp; Orientation[1].axResolution) {
<a name="l00361"></a>00361                     <span class="comment">/* all this assumes the minimum is 0 */</span>
<a name="l00362"></a>00362                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad73c71089d95ceb79b9d46ba9007556a">m_maxAzimuth</a> = Orientation[0].axMax;
<a name="l00363"></a>00363                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2c1a8a53c01b3988c014b52774c10aa8">m_maxAltitude</a> = Orientation[1].axMax;
<a name="l00364"></a>00364                 }
<a name="l00365"></a>00365                 <span class="keywordflow">else</span> {  <span class="comment">/* no so dont do tilt stuff */</span>
<a name="l00366"></a>00366                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad73c71089d95ceb79b9d46ba9007556a">m_maxAzimuth</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2c1a8a53c01b3988c014b52774c10aa8">m_maxAltitude</a> = 0;
<a name="l00367"></a>00367                 }
<a name="l00368"></a>00368             }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370             <span class="keywordflow">if</span> (fpWTOpen) {
<a name="l00371"></a>00371                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad7ec13e4bbb2e9148e1fbfb59f45ba5f">m_tablet</a> = fpWTOpen( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;lc, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> );
<a name="l00372"></a>00372                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad7ec13e4bbb2e9148e1fbfb59f45ba5f">m_tablet</a>) {
<a name="l00373"></a>00373                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a> = <span class="keyword">new</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a45c914dbbb09d7d35f0e4d0ce280fd19">GHOST_TabletData</a>();
<a name="l00374"></a>00374                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a57004bc9c30cdaaee1e4cd968aacb2b9a45103b9e5bb871499bcc83acfdd7191f">GHOST_kTabletModeNone</a>;
<a name="l00375"></a>00375                 }
<a name="l00376"></a>00376             }
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keywordflow">if</span>(hasMinVersionForTaskbar)
<a name="l00381"></a>00381         CoCreateInstance(<a class="code" href="../../da/d45/GHOST__TaskbarWin32_8h.html#a5bc9d2b52adb966e869a585323367c59">CLSID_TaskbarList</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, CLSCTX_INPROC_SERVER, <a class="code" href="../../da/d45/GHOST__TaskbarWin32_8h.html#abf2d73b1a1d16b7957a676f28a96e77e">IID_ITaskbarList</a> ,(<a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#ae611cd6871649dbfe37273a0253d5e61">LPVOID</a>*)&amp;<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a>);
<a name="l00382"></a>00382     <span class="keywordflow">else</span>
<a name="l00383"></a>00383         m_Bar=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6351763802167447b1f696b615cf7e1a">00387</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6351763802167447b1f696b615cf7e1a">GHOST_WindowWin32::~GHOST_WindowWin32</a>()
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     <span class="keywordflow">if</span>(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a>)
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a>-&gt;SetProgressState(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, <a class="code" href="../../da/d45/GHOST__TaskbarWin32_8h.html#a1fafeab2f8950fbd8edf21f4a2200c39a3570f6f9189f7bcaa722abfce49ea335">TBPF_NOPROGRESS</a>);
<a name="l00392"></a>00392         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a>-&gt;Release();
<a name="l00393"></a>00393     };
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>) {
<a name="l00396"></a>00396         GHOST_WIN32_WTClose fpWTClose = ( GHOST_WIN32_WTClose ) ::GetProcAddress( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>, <span class="stringliteral">&quot;WTClose&quot;</span> );
<a name="l00397"></a>00397         <span class="keywordflow">if</span> (fpWTClose) {
<a name="l00398"></a>00398             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad7ec13e4bbb2e9148e1fbfb59f45ba5f">m_tablet</a>)
<a name="l00399"></a>00399                 fpWTClose(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad7ec13e4bbb2e9148e1fbfb59f45ba5f">m_tablet</a>);
<a name="l00400"></a>00400             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>)
<a name="l00401"></a>00401                 <span class="keyword">delete</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>;
<a name="l00402"></a>00402                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>) {
<a name="l00406"></a>00406         DestroyCursor(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>);
<a name="l00407"></a>00407         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     ::wglMakeCurrent(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00411"></a>00411     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00412"></a>00412     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a15238b2c0078e0e0d67753d0b0db1e59">m_multisample</a> = 0;
<a name="l00413"></a>00413     <a class="code" href="../../de/db8/classGHOST__Window.html#a4120ccc4b1e9cc12b6c17a94d8aea350">setDrawingContextType</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02ad0d42aef821d08b9b01b32da72888cc0">GHOST_kDrawingContextTypeNone</a>);
<a name="l00414"></a>00414     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a> &amp;&amp; <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a> != <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aaed62814edb3535247517bd6339d5312">s_firstHDC</a>) {
<a name="l00415"></a>00415         ::ReleaseDC(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>);
<a name="l00416"></a>00416         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a> = 0;
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>) {
<a name="l00419"></a>00419         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9516a0c902ef0179407d88b3d17673dd">m_dropTarget</a>-&gt;<a class="code" href="../../de/d9e/classGHOST__DropTargetWin32.html#af2562c2622825edb2fd425570ec7afda">Release</a>(); <span class="comment">// frees itself.</span>
<a name="l00420"></a>00420         ::DestroyWindow(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>);
<a name="l00421"></a>00421         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a> = 0;
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a8e95451062b4928b2c2e6130f69c2a0a">00425</a> <a class="code" href="../../de/db8/classGHOST__Window.html">GHOST_Window</a> *<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a8e95451062b4928b2c2e6130f69c2a0a">GHOST_WindowWin32::getNextWindow</a>()
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427     <span class="keywordflow">return</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a8a5f226aaa20ae6c065f4498a0845de8">m_nextWindow</a>;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a15513ab26795911d4976d56a05c1bbf3">00430</a> <span class="keywordtype">bool</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a15513ab26795911d4976d56a05c1bbf3">GHOST_WindowWin32::getValid</a>()<span class="keyword"> const</span>
<a name="l00431"></a>00431 <span class="keyword"></span>{
<a name="l00432"></a>00432     <span class="keywordflow">return</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a> != 0;
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6fb4d43289571c00efa5bd5cd1979dd9">00435</a> HWND <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6fb4d43289571c00efa5bd5cd1979dd9">GHOST_WindowWin32::getHWND</a>()<span class="keyword"> const</span>
<a name="l00436"></a>00436 <span class="keyword"></span>{
<a name="l00437"></a>00437     <span class="keywordflow">return</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>;
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa85be33dac02c3e828962c7dbf0a8181">00440</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa85be33dac02c3e828962c7dbf0a8181">GHOST_WindowWin32::setTitle</a>(<span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; title)
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442     <span class="keywordtype">wchar_t</span> * title_16 = <a class="code" href="../../d6/d8a/utfconv_8c.html#a92ea6b21a575d411e9fbcbca5428a3cb">alloc_utf16_from_8</a>((<span class="keywordtype">char</span>*)(<span class="keyword">const</span> <span class="keywordtype">char</span>*)title, 0);
<a name="l00443"></a>00443     ::SetWindowTextW(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, (<span class="keywordtype">wchar_t</span>*)title_16);
<a name="l00444"></a>00444     free(title_16);
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a350bb3e086aed2c037f2e6eaf237f916">00448</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a350bb3e086aed2c037f2e6eaf237f916">GHOST_WindowWin32::getTitle</a>(<a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; title)<span class="keyword"> const</span>
<a name="l00449"></a>00449 <span class="keyword"></span>{
<a name="l00450"></a>00450     <span class="keywordtype">char</span> buf[<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a3a58bbcf4d7b74214bb7a390e1d46141">s_maxTitleLength</a>];<span class="comment">/*CHANGE + never used yet*/</span>
<a name="l00451"></a>00451     ::GetWindowText(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, buf, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a3a58bbcf4d7b74214bb7a390e1d46141">s_maxTitleLength</a>);
<a name="l00452"></a>00452     <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a> temp (buf);
<a name="l00453"></a>00453     title = buf;
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0ed0909b220fb40b7770bbc480c5c592">00457</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0ed0909b220fb40b7770bbc480c5c592">GHOST_WindowWin32::getWindowBounds</a>(<a class="code" href="../../d1/d86/classGHOST__Rect.html">GHOST_Rect</a>&amp; <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>)<span class="keyword"> const</span>
<a name="l00458"></a>00458 <span class="keyword"></span>{
<a name="l00459"></a>00459     RECT rect;
<a name="l00460"></a>00460     ::GetWindowRect(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;rect);
<a name="l00461"></a>00461     bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ae3e75e271f7683d270cd32a059e26b39">m_b</a> = rect.bottom;
<a name="l00462"></a>00462     bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#aab06205db4db05745895c45dc18b40fa">m_l</a> = rect.left;
<a name="l00463"></a>00463     bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab486237b8431d626d698d9ee1085dc2d">m_r</a> = rect.right;
<a name="l00464"></a>00464     bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab1b96623da2e2521e14ecfd59c333a7c">m_t</a> = rect.top;
<a name="l00465"></a>00465 }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9d9701a2fd02fec6e085088ed6b0996e">00468</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9d9701a2fd02fec6e085088ed6b0996e">GHOST_WindowWin32::getClientBounds</a>(<a class="code" href="../../d1/d86/classGHOST__Rect.html">GHOST_Rect</a>&amp; <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>)<span class="keyword"> const</span>
<a name="l00469"></a>00469 <span class="keyword"></span>{
<a name="l00470"></a>00470     RECT rect;
<a name="l00471"></a>00471     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>= this-&gt;<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac89b7353d2020f2b40801bd83f264176">getState</a>();
<a name="l00472"></a>00472     LONG_PTR result = ::GetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_STYLE);
<a name="l00473"></a>00473     <span class="keywordtype">int</span> sm_cysizeframe = GetSystemMetrics(SM_CYSIZEFRAME);
<a name="l00474"></a>00474     ::GetWindowRect(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;rect);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keywordflow">if</span>((result &amp; (WS_POPUP | WS_MAXIMIZE)) != (WS_POPUP | WS_MAXIMIZE)) {
<a name="l00477"></a>00477         <span class="keywordflow">if</span>(state==<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546aa1d6a669a409edc14aabbebddac07aac">GHOST_kWindowStateMaximized</a>) {
<a name="l00478"></a>00478             <span class="comment">// in maximized state we don&#39;t have borders on the window</span>
<a name="l00479"></a>00479             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ae3e75e271f7683d270cd32a059e26b39">m_b</a> = rect.bottom-GetSystemMetrics(SM_CYCAPTION)- sm_cysizeframe*2;
<a name="l00480"></a>00480             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#aab06205db4db05745895c45dc18b40fa">m_l</a> = rect.left + sm_cysizeframe;
<a name="l00481"></a>00481             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab486237b8431d626d698d9ee1085dc2d">m_r</a> = rect.right - sm_cysizeframe;
<a name="l00482"></a>00482             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab1b96623da2e2521e14ecfd59c333a7c">m_t</a> = rect.top;
<a name="l00483"></a>00483         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ab59f9692bb31f4d22bf0363668bcf79e">GHOST_kWindowStateEmbedded</a>) {
<a name="l00484"></a>00484             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ae3e75e271f7683d270cd32a059e26b39">m_b</a> = rect.bottom;
<a name="l00485"></a>00485             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#aab06205db4db05745895c45dc18b40fa">m_l</a> = rect.left;
<a name="l00486"></a>00486             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab486237b8431d626d698d9ee1085dc2d">m_r</a> = rect.right;
<a name="l00487"></a>00487             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab1b96623da2e2521e14ecfd59c333a7c">m_t</a> = rect.top;
<a name="l00488"></a>00488         } <span class="keywordflow">else</span> {
<a name="l00489"></a>00489             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ae3e75e271f7683d270cd32a059e26b39">m_b</a> = rect.bottom-GetSystemMetrics(SM_CYCAPTION)-sm_cysizeframe*2;
<a name="l00490"></a>00490             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#aab06205db4db05745895c45dc18b40fa">m_l</a> = rect.left;
<a name="l00491"></a>00491             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab486237b8431d626d698d9ee1085dc2d">m_r</a> = rect.right-sm_cysizeframe*2;
<a name="l00492"></a>00492             bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab1b96623da2e2521e14ecfd59c333a7c">m_t</a> = rect.top;
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494     } <span class="keywordflow">else</span> {
<a name="l00495"></a>00495         bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ae3e75e271f7683d270cd32a059e26b39">m_b</a> = rect.bottom;
<a name="l00496"></a>00496         bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#aab06205db4db05745895c45dc18b40fa">m_l</a> = rect.left;
<a name="l00497"></a>00497         bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab486237b8431d626d698d9ee1085dc2d">m_r</a> = rect.right;
<a name="l00498"></a>00498         bounds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab1b96623da2e2521e14ecfd59c333a7c">m_t</a> = rect.top;
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aff1a77573ebe19bc39a5341cd6c9ecc7">00503</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aff1a77573ebe19bc39a5341cd6c9ecc7">GHOST_WindowWin32::setClientWidth</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> width)
<a name="l00504"></a>00504 {
<a name="l00505"></a>00505     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00506"></a>00506     <a class="code" href="../../d1/d86/classGHOST__Rect.html">GHOST_Rect</a> cBnds, wBnds;
<a name="l00507"></a>00507     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9d9701a2fd02fec6e085088ed6b0996e">getClientBounds</a>(cBnds);
<a name="l00508"></a>00508     <span class="keywordflow">if</span> (cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>() != (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>)width) {
<a name="l00509"></a>00509         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0ed0909b220fb40b7770bbc480c5c592">getWindowBounds</a>(wBnds);
<a name="l00510"></a>00510         <span class="keywordtype">int</span> cx = wBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>() + width - cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>();
<a name="l00511"></a>00511         <span class="keywordtype">int</span> cy = wBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>();
<a name="l00512"></a>00512         success =  ::SetWindowPos(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, HWND_TOP, 0, 0, cx, cy, SWP_NOMOVE | SWP_NOZORDER) ?
<a name="l00513"></a>00513             <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     <span class="keywordflow">else</span> {
<a name="l00516"></a>00516         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518     <span class="keywordflow">return</span> success;
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 
<a name="l00522"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab52b91f2547fada69ea13bac37fa3ec6">00522</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab52b91f2547fada69ea13bac37fa3ec6">GHOST_WindowWin32::setClientHeight</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> height)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00525"></a>00525     <a class="code" href="../../d1/d86/classGHOST__Rect.html">GHOST_Rect</a> cBnds, wBnds;
<a name="l00526"></a>00526     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9d9701a2fd02fec6e085088ed6b0996e">getClientBounds</a>(cBnds);
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>() != (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>)height) {
<a name="l00528"></a>00528         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0ed0909b220fb40b7770bbc480c5c592">getWindowBounds</a>(wBnds);
<a name="l00529"></a>00529         <span class="keywordtype">int</span> cx = wBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>();
<a name="l00530"></a>00530         <span class="keywordtype">int</span> cy = wBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>() + height - cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>();
<a name="l00531"></a>00531         success = ::SetWindowPos(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, HWND_TOP, 0, 0, cx, cy, SWP_NOMOVE | SWP_NOZORDER) ?
<a name="l00532"></a>00532             <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534     <span class="keywordflow">else</span> {
<a name="l00535"></a>00535         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537     <span class="keywordflow">return</span> success;
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a60b6ededaeb384ebf2678a2d505e010c">00541</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a60b6ededaeb384ebf2678a2d505e010c">GHOST_WindowWin32::setClientSize</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> width, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> height)
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00544"></a>00544     <a class="code" href="../../d1/d86/classGHOST__Rect.html">GHOST_Rect</a> cBnds, wBnds;
<a name="l00545"></a>00545     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9d9701a2fd02fec6e085088ed6b0996e">getClientBounds</a>(cBnds);
<a name="l00546"></a>00546     <span class="keywordflow">if</span> ((cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>() != (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>)width) || (cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>() != (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>)height)) {
<a name="l00547"></a>00547         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0ed0909b220fb40b7770bbc480c5c592">getWindowBounds</a>(wBnds);
<a name="l00548"></a>00548         <span class="keywordtype">int</span> cx = wBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>() + width - cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a5fdedb67b5a673c7b069c64b81a27e26">getWidth</a>();
<a name="l00549"></a>00549         <span class="keywordtype">int</span> cy = wBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>() + height - cBnds.<a class="code" href="../../d1/d86/classGHOST__Rect.html#a6a3902b255382dddf4c5bb17052dccf2">getHeight</a>();
<a name="l00550"></a>00550         success = ::SetWindowPos(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, HWND_TOP, 0, 0, cx, cy, SWP_NOMOVE | SWP_NOZORDER) ?
<a name="l00551"></a>00551             <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553     <span class="keywordflow">else</span> {
<a name="l00554"></a>00554         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">return</span> success;
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 
<a name="l00560"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac89b7353d2020f2b40801bd83f264176">00560</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac89b7353d2020f2b40801bd83f264176">GHOST_WindowWin32::getState</a>()<span class="keyword"> const</span>
<a name="l00561"></a>00561 <span class="keyword"></span>{
<a name="l00562"></a>00562     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="comment">// XXX 27.04.2011</span>
<a name="l00565"></a>00565     <span class="comment">// we need to find a way to combine parented windows + resizing if we simply set the</span>
<a name="l00566"></a>00566     <span class="comment">// state as GHOST_kWindowStateEmbedded we will need to check for them somewhere else.</span>
<a name="l00567"></a>00567     <span class="comment">// It&#39;s also strange that in Windows is the only platform we need to make this separation.</span>
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a37187288d4f8c9c03f08b7495ab2f9b5">m_parentWindowHwnd</a> != 0) {
<a name="l00569"></a>00569         state = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ab59f9692bb31f4d22bf0363668bcf79e">GHOST_kWindowStateEmbedded</a>;
<a name="l00570"></a>00570         <span class="keywordflow">return</span> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (::IsIconic(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>)) {
<a name="l00573"></a>00573         state = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546a88de0b7d5b7d4843d7d4133255817078">GHOST_kWindowStateMinimized</a>;
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (::IsZoomed(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>)) {
<a name="l00576"></a>00576         LONG_PTR result = ::GetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_STYLE);
<a name="l00577"></a>00577         <span class="keywordflow">if</span>((result &amp; (WS_POPUP | WS_MAXIMIZE)) != (WS_POPUP | WS_MAXIMIZE))
<a name="l00578"></a>00578             state = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546aa1d6a669a409edc14aabbebddac07aac">GHOST_kWindowStateMaximized</a>;
<a name="l00579"></a>00579         <span class="keywordflow">else</span>
<a name="l00580"></a>00580             state = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>;
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582     <span class="keywordflow">else</span> {
<a name="l00583"></a>00583         state = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>;
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585     <span class="keywordflow">return</span> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9572880d618c2419129b39bb4b212281">00589</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a9572880d618c2419129b39bb4b212281">GHOST_WindowWin32::screenToClient</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> inX, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> inY, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>&amp; outX, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>&amp; outY)<span class="keyword"> const</span>
<a name="l00590"></a>00590 <span class="keyword"></span>{
<a name="l00591"></a>00591     POINT <a class="code" href="../../d8/dae/structpoint.html">point</a> = { inX, inY };
<a name="l00592"></a>00592     ::ScreenToClient(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;point);
<a name="l00593"></a>00593     outX = point.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l00594"></a>00594     outY = point.y;
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 
<a name="l00598"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#af4e854821052ff18f45b8ba35d4c12ca">00598</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#af4e854821052ff18f45b8ba35d4c12ca">GHOST_WindowWin32::clientToScreen</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> inX, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> inY, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>&amp; outX, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a>&amp; outY)<span class="keyword"> const</span>
<a name="l00599"></a>00599 <span class="keyword"></span>{
<a name="l00600"></a>00600     POINT <a class="code" href="../../d8/dae/structpoint.html">point</a> = { inX, inY };
<a name="l00601"></a>00601     ::ClientToScreen(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;point);
<a name="l00602"></a>00602     outX = point.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l00603"></a>00603     outY = point.y;
<a name="l00604"></a>00604 }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 
<a name="l00607"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a8fc4cda37e417c8e78818680a1e7a870">00607</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a8fc4cda37e417c8e78818680a1e7a870">GHOST_WindowWin32::setState</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>)
<a name="l00608"></a>00608 {
<a name="l00609"></a>00609     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> curstate = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac89b7353d2020f2b40801bd83f264176">getState</a>();
<a name="l00610"></a>00610     WINDOWPLACEMENT wp;
<a name="l00611"></a>00611     wp.length = <span class="keyword">sizeof</span>(WINDOWPLACEMENT);
<a name="l00612"></a>00612     ::GetWindowPlacement(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;wp);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (state == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>)
<a name="l00615"></a>00615         state = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a401fda72af7fff9ca22a1d88f0fefd86">m_normal_state</a>;
<a name="l00616"></a>00616     <span class="keywordflow">switch</span> (state) {
<a name="l00617"></a>00617     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546a88de0b7d5b7d4843d7d4133255817078">GHOST_kWindowStateMinimized</a>:
<a name="l00618"></a>00618         wp.showCmd = SW_SHOWMINIMIZED;
<a name="l00619"></a>00619         <span class="keywordflow">break</span>;
<a name="l00620"></a>00620     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546aa1d6a669a409edc14aabbebddac07aac">GHOST_kWindowStateMaximized</a>:
<a name="l00621"></a>00621         wp.showCmd = SW_SHOWMAXIMIZED;
<a name="l00622"></a>00622         SetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_STYLE, WS_OVERLAPPEDWINDOW);
<a name="l00623"></a>00623         <span class="keywordflow">break</span>;
<a name="l00624"></a>00624     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>:
<a name="l00625"></a>00625         <span class="keywordflow">if</span> (curstate != state &amp;&amp; curstate != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546a88de0b7d5b7d4843d7d4133255817078">GHOST_kWindowStateMinimized</a>)
<a name="l00626"></a>00626             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a401fda72af7fff9ca22a1d88f0fefd86">m_normal_state</a> = curstate;
<a name="l00627"></a>00627         wp.showCmd = SW_SHOWMAXIMIZED;
<a name="l00628"></a>00628         wp.ptMaxPosition.x = 0;
<a name="l00629"></a>00629         wp.ptMaxPosition.y = 0;
<a name="l00630"></a>00630         SetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_STYLE, WS_POPUP | WS_MAXIMIZE);
<a name="l00631"></a>00631         <span class="keywordflow">break</span>;
<a name="l00632"></a>00632     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ab59f9692bb31f4d22bf0363668bcf79e">GHOST_kWindowStateEmbedded</a>:
<a name="l00633"></a>00633         SetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_STYLE, WS_CHILD);
<a name="l00634"></a>00634         <span class="keywordflow">break</span>;
<a name="l00635"></a>00635     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>:
<a name="l00636"></a>00636     <span class="keywordflow">default</span>:
<a name="l00637"></a>00637         wp.showCmd = SW_SHOWNORMAL;
<a name="l00638"></a>00638         SetWindowLongPtr(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, GWL_STYLE, WS_OVERLAPPEDWINDOW);
<a name="l00639"></a>00639         <span class="keywordflow">break</span>;
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641     SetWindowPos(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, 0, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED); <span class="comment">/*Clears window cache for SetWindowLongPtr */</span>
<a name="l00642"></a>00642     return ::SetWindowPlacement(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, &amp;wp) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 
<a name="l00646"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0f567aaf43f8209f4fa737dd45ae5037">00646</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0f567aaf43f8209f4fa737dd45ae5037">GHOST_WindowWin32::setOrder</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a98e2ea9151fa7e56d5fec53484d83069">GHOST_TWindowOrder</a> order)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648     HWND hWndInsertAfter = order == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a98e2ea9151fa7e56d5fec53484d83069a54095e8130beaf2a5bfbb3c175bad889">GHOST_kWindowOrderTop</a> ? HWND_TOP : HWND_BOTTOM;
<a name="l00649"></a>00649     return ::SetWindowPos(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, hWndInsertAfter, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 
<a name="l00653"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#acc62fee934b94e9eb43c6ecd3bbfb956">00653</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#acc62fee934b94e9eb43c6ecd3bbfb956">GHOST_WindowWin32::swapBuffers</a>()
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655     HDC hDC = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#aca120656f7df1e22e546cabeba59363d">is_crappy_intel_card</a>())
<a name="l00658"></a>00658         hDC = ::wglGetCurrentDC();
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     return ::SwapBuffers(hDC) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00661"></a>00661 }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663 
<a name="l00664"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a4a08c482b9faf7af5836609d1626b708">00664</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a4a08c482b9faf7af5836609d1626b708">GHOST_WindowWin32::activateDrawingContext</a>()
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00667"></a>00667     <span class="keywordflow">if</span> (<a class="code" href="../../de/db8/classGHOST__Window.html#aa1de3505773b74c9d235687b9e810645">m_drawingContextType</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02a39843d48a48ae74cfdc80cf8e880995d">GHOST_kDrawingContextTypeOpenGL</a>) {
<a name="l00668"></a>00668         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a> &amp;&amp; <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) {
<a name="l00669"></a>00669             success = ::wglMakeCurrent(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671         <span class="keywordflow">else</span> {
<a name="l00672"></a>00672             success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674     }
<a name="l00675"></a>00675     <span class="keywordflow">else</span> {
<a name="l00676"></a>00676         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00677"></a>00677     }
<a name="l00678"></a>00678     <span class="keywordflow">return</span> success;
<a name="l00679"></a>00679 }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 
<a name="l00682"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a01771b1d98c925d53bbd094ed0307bdb">00682</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a01771b1d98c925d53bbd094ed0307bdb">GHOST_WindowWin32::invalidate</a>()
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00685"></a>00685     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>) {
<a name="l00686"></a>00686         success = ::InvalidateRect(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>, 0, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) != 0 ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688     <span class="keywordflow">else</span> {
<a name="l00689"></a>00689         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691     <span class="keywordflow">return</span> success;
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00694"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aee272d7afc672a230c62a779a701a042">00694</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aee272d7afc672a230c62a779a701a042">GHOST_WindowWin32::initMultisample</a>(PIXELFORMATDESCRIPTOR pfd)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <span class="keywordtype">int</span> pixelFormat;
<a name="l00697"></a>00697     <span class="keywordtype">bool</span> success = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00698"></a>00698     <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a3420c2b17e706211f43052a3125b10e7">UINT</a> numFormats;
<a name="l00699"></a>00699     HDC hDC = GetDC(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6fb4d43289571c00efa5bd5cd1979dd9">getHWND</a>());
<a name="l00700"></a>00700     <span class="keywordtype">float</span> fAttributes[] = {0, 0};
<a name="l00701"></a>00701     <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a3420c2b17e706211f43052a3125b10e7">UINT</a> nMaxFormats = 1;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="comment">// The attributes to look for</span>
<a name="l00704"></a>00704     <span class="keywordtype">int</span> iAttributes[] = {
<a name="l00705"></a>00705         WGL_DRAW_TO_WINDOW_ARB, GL_TRUE,
<a name="l00706"></a>00706         WGL_SUPPORT_OPENGL_ARB, GL_TRUE,
<a name="l00707"></a>00707         WGL_ACCELERATION_ARB, WGL_FULL_ACCELERATION_ARB,
<a name="l00708"></a>00708         WGL_COLOR_BITS_ARB, pfd.cColorBits,
<a name="l00709"></a>00709         WGL_DEPTH_BITS_ARB, pfd.cDepthBits,
<a name="l00710"></a>00710         WGL_STENCIL_BITS_ARB, pfd.cStencilBits,
<a name="l00711"></a>00711         WGL_DOUBLE_BUFFER_ARB, GL_TRUE,
<a name="l00712"></a>00712         WGL_SAMPLE_BUFFERS_ARB, GL_TRUE,
<a name="l00713"></a>00713         <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a99289a023da8e683eb7de95543e22c87">WGL_SAMPLES_ARB</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a15238b2c0078e0e0d67753d0b0db1e59">m_multisample</a>,
<a name="l00714"></a>00714         0, 0
<a name="l00715"></a>00715     };
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="comment">// Get the function</span>
<a name="l00718"></a>00718     PFNWGLCHOOSEPIXELFORMATARBPROC wglChoosePixelFormatARB = (PFNWGLCHOOSEPIXELFORMATARBPROC)wglGetProcAddress(<span class="stringliteral">&quot;wglChoosePixelFormatARB&quot;</span>);  
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <span class="keywordflow">if</span> (!wglChoosePixelFormatARB)
<a name="l00721"></a>00721     {
<a name="l00722"></a>00722         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00723"></a>00723         <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     <span class="comment">// iAttributes[17] is the initial multisample. If not valid try to use the closest valid value under it.</span>
<a name="l00727"></a>00727     <span class="keywordflow">while</span> (iAttributes[17] &gt; 0) {
<a name="l00728"></a>00728         <span class="comment">// See if the format is valid</span>
<a name="l00729"></a>00729         success = wglChoosePixelFormatARB(hDC, iAttributes, fAttributes, nMaxFormats, &amp;pixelFormat, &amp;numFormats);
<a name="l00730"></a>00730         <a class="code" href="../../dc/d58/GHOST__Debug_8h.html#a7a1ce70ec64ed1ea4c74dba3d243c5df">GHOST_PRINTF</a>(<span class="stringliteral">&quot;WGL_SAMPLES_ARB = %i --&gt; success = %i, %i formats\n&quot;</span>, iAttributes[17], success, numFormats);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732         <span class="keywordflow">if</span> (success &amp;&amp; numFormats &gt;= 1 &amp;&amp; <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>) {
<a name="l00733"></a>00733             <a class="code" href="../../dc/d58/GHOST__Debug_8h.html#a7a1ce70ec64ed1ea4c74dba3d243c5df">GHOST_PRINTF</a>(<span class="stringliteral">&quot;valid pixel format with %i multisamples\n&quot;</span>, iAttributes[17]);
<a name="l00734"></a>00734             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00735"></a>00735             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a687fbd57b1505248cd3419df4f8d1074">m_msPixelFormat</a> = pixelFormat;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737         iAttributes[17] -= 1;
<a name="l00738"></a>00738         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>) {
<a name="l00741"></a>00741         <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     <a class="code" href="../../dc/d58/GHOST__Debug_8h.html#ae52ef493525d48d29cfe5d3e114d9f7a">GHOST_PRINT</a>(<span class="stringliteral">&quot;no available pixel format\n&quot;</span>);
<a name="l00744"></a>00744     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a85a544965a5c330ab74e1601de7dc63d">00747</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a85a544965a5c330ab74e1601de7dc63d">GHOST_WindowWin32::installDrawingContext</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02">GHOST_TDrawingContextType</a> type)
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00750"></a>00750     <span class="keywordflow">switch</span> (type) {
<a name="l00751"></a>00751     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02a39843d48a48ae74cfdc80cf8e880995d">GHOST_kDrawingContextTypeOpenGL</a>:
<a name="l00752"></a>00752         {
<a name="l00753"></a>00753         <span class="comment">// If this window has multisample enabled, use the supplied format</span>
<a name="l00754"></a>00754         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a>)
<a name="l00755"></a>00755         {
<a name="l00756"></a>00756             <span class="keywordflow">if</span> (SetPixelFormat(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a687fbd57b1505248cd3419df4f8d1074">m_msPixelFormat</a>, &amp;<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">sPreferredFormat</a>)==<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00757"></a>00757             {
<a name="l00758"></a>00758                 success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00759"></a>00759                 <span class="keywordflow">break</span>;
<a name="l00760"></a>00760             }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762             <span class="comment">// Create the context</span>
<a name="l00763"></a>00763             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = ::wglCreateContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>);
<a name="l00764"></a>00764             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) {
<a name="l00765"></a>00765                 <span class="keywordflow">if</span> (::wglMakeCurrent(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l00766"></a>00766                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>) {
<a name="l00767"></a>00767                         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#aca120656f7df1e22e546cabeba59363d">is_crappy_intel_card</a>()) {
<a name="l00768"></a>00768                             <span class="keywordflow">if</span> (::wglMakeCurrent(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l00769"></a>00769                                 ::wglDeleteContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>);
<a name="l00770"></a>00770                                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>;
<a name="l00771"></a>00771                             }
<a name="l00772"></a>00772                             <span class="keywordflow">else</span> {
<a name="l00773"></a>00773                                 ::wglDeleteContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>);
<a name="l00774"></a>00774                                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00775"></a>00775                             }
<a name="l00776"></a>00776                         }
<a name="l00777"></a>00777                         <span class="keywordflow">else</span> {
<a name="l00778"></a>00778                             ::wglCopyContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>, GL_ALL_ATTRIB_BITS);
<a name="l00779"></a>00779                             ::wglShareLists(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>);
<a name="l00780"></a>00780                         }
<a name="l00781"></a>00781                     }
<a name="l00782"></a>00782                     <span class="keywordflow">else</span> {
<a name="l00783"></a>00783                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>;
<a name="l00784"></a>00784                     }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) {
<a name="l00787"></a>00787                         success = ::wglMakeCurrent(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00788"></a>00788                     }
<a name="l00789"></a>00789                     <span class="keywordflow">else</span> {
<a name="l00790"></a>00790                         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00791"></a>00791                     }
<a name="l00792"></a>00792                 }
<a name="l00793"></a>00793                 <span class="keywordflow">else</span> {
<a name="l00794"></a>00794                     success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00795"></a>00795                 }
<a name="l00796"></a>00796             }
<a name="l00797"></a>00797             <span class="keywordflow">else</span> {
<a name="l00798"></a>00798                 success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00799"></a>00799             }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             <span class="keywordflow">if</span> (success == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>) {
<a name="l00802"></a>00802                 printf(<span class="stringliteral">&quot;Failed to get a context....\n&quot;</span>);
<a name="l00803"></a>00803             }
<a name="l00804"></a>00804         }
<a name="l00805"></a>00805         <span class="keywordflow">else</span>
<a name="l00806"></a>00806         {
<a name="l00807"></a>00807             <span class="keywordflow">if</span>(<a class="code" href="../../de/db8/classGHOST__Window.html#ac569d782355fb6adaa6754befcccb50a">m_stereoVisual</a>)
<a name="l00808"></a>00808                 <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">sPreferredFormat</a>.dwFlags |= PFD_STEREO;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810             <span class="comment">// Attempt to match device context pixel format to the preferred format</span>
<a name="l00811"></a>00811             <span class="keywordtype">int</span> iPixelFormat = <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ad0e9f1078577536f4920a29ef589cb7a">EnumPixelFormats</a>(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>);
<a name="l00812"></a>00812             <span class="keywordflow">if</span> (iPixelFormat == 0) {
<a name="l00813"></a>00813                 success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00814"></a>00814                 <span class="keywordflow">break</span>;
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816             <span class="keywordflow">if</span> (::SetPixelFormat(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, iPixelFormat, &amp;<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">sPreferredFormat</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00817"></a>00817                 success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00818"></a>00818                 <span class="keywordflow">break</span>;
<a name="l00819"></a>00819             }
<a name="l00820"></a>00820             <span class="comment">// For debugging only: retrieve the pixel format chosen</span>
<a name="l00821"></a>00821             PIXELFORMATDESCRIPTOR preferredFormat;
<a name="l00822"></a>00822             ::DescribePixelFormat(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, iPixelFormat, <span class="keyword">sizeof</span>(PIXELFORMATDESCRIPTOR), &amp;preferredFormat);
<a name="l00823"></a>00823 
<a name="l00824"></a>00824             <span class="comment">// Create the context</span>
<a name="l00825"></a>00825             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = ::wglCreateContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>);
<a name="l00826"></a>00826             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) {
<a name="l00827"></a>00827                 <span class="keywordflow">if</span> (::wglMakeCurrent(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l00828"></a>00828                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>) {
<a name="l00829"></a>00829                         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#aca120656f7df1e22e546cabeba59363d">is_crappy_intel_card</a>()) {
<a name="l00830"></a>00830                             <span class="keywordflow">if</span> (::wglMakeCurrent(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l00831"></a>00831                                 ::wglDeleteContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>);
<a name="l00832"></a>00832                                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>;
<a name="l00833"></a>00833                             }
<a name="l00834"></a>00834                             <span class="keywordflow">else</span> {
<a name="l00835"></a>00835                                 ::wglDeleteContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>);
<a name="l00836"></a>00836                                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00837"></a>00837                             }
<a name="l00838"></a>00838                         }
<a name="l00839"></a>00839                         <span class="keywordflow">else</span> {
<a name="l00840"></a>00840                             ::wglShareLists(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>);
<a name="l00841"></a>00841                         }
<a name="l00842"></a>00842                     }
<a name="l00843"></a>00843                     <span class="keywordflow">else</span> {
<a name="l00844"></a>00844                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>;
<a name="l00845"></a>00845                     }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) {
<a name="l00848"></a>00848                         success = ::wglMakeCurrent(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a58e0fbbe983371cfa7eab17c58e0a093">m_hDC</a>, <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00849"></a>00849                     }
<a name="l00850"></a>00850                     <span class="keywordflow">else</span> {
<a name="l00851"></a>00851                         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00852"></a>00852                     }
<a name="l00853"></a>00853                 }
<a name="l00854"></a>00854                 <span class="keywordflow">else</span> {
<a name="l00855"></a>00855                     success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00856"></a>00856                 }
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858             <span class="keywordflow">else</span> {
<a name="l00859"></a>00859                 success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00860"></a>00860             }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862             <span class="keywordflow">if</span> (success == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>) {
<a name="l00863"></a>00863                 printf(<span class="stringliteral">&quot;Failed to get a context....\n&quot;</span>);
<a name="l00864"></a>00864             }
<a name="l00865"></a>00865                     
<a name="l00866"></a>00866             <span class="comment">// Attempt to enable multisample</span>
<a name="l00867"></a>00867             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a15238b2c0078e0e0d67753d0b0db1e59">m_multisample</a> &amp;&amp; WGL_ARB_multisample &amp;&amp; !<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a>)
<a name="l00868"></a>00868             {
<a name="l00869"></a>00869                 success = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aee272d7afc672a230c62a779a701a042">initMultisample</a>(preferredFormat);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871                 <span class="keywordflow">if</span> (success)
<a name="l00872"></a>00872                 {
<a name="l00873"></a>00873 
<a name="l00874"></a>00874                     <span class="comment">// Make sure we don&#39;t screw up the context</span>
<a name="l00875"></a>00875                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> == <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>)
<a name="l00876"></a>00876                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00877"></a>00877                     <a class="code" href="../../de/db8/classGHOST__Window.html#aa1de3505773b74c9d235687b9e810645">m_drawingContextType</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02a39843d48a48ae74cfdc80cf8e880995d">GHOST_kDrawingContextTypeOpenGL</a>;
<a name="l00878"></a>00878                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2967b584996a02f9a63046e3f8e68818">removeDrawingContext</a>();
<a name="l00879"></a>00879 
<a name="l00880"></a>00880                     <span class="comment">// Create a new window</span>
<a name="l00881"></a>00881                     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> new_state = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac89b7353d2020f2b40801bd83f264176">getState</a>();
<a name="l00882"></a>00882 
<a name="l00883"></a>00883                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a8a5f226aaa20ae6c065f4498a0845de8">m_nextWindow</a> = <span class="keyword">new</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad3840c2bd3e1729647c4a272eacfaefe">GHOST_WindowWin32</a>((<a class="code" href="../../d5/d71/classGHOST__SystemWin32.html">GHOST_SystemWin32</a>*)<a class="code" href="../../d8/db3/classGHOST__ISystem.html#a0b5f61e5a07b611d3ca8780d3e551361">GHOST_ISystem::getSystem</a>(),
<a name="l00884"></a>00884                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0470ee4f1735e20344b9b893c1926390">m_title</a>,
<a name="l00885"></a>00885                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6f18502220ed54afd385762049af4c4d">m_left</a>,
<a name="l00886"></a>00886                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae33b3d34900cfbc935a7777bb341e099">m_top</a>,
<a name="l00887"></a>00887                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae9b3cf32b684014917befca9465d3357">m_width</a>,
<a name="l00888"></a>00888                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2e616c4cc7bffd09414def5c44b0deb2">m_height</a>,
<a name="l00889"></a>00889                                                     new_state,
<a name="l00890"></a>00890                                                     type,
<a name="l00891"></a>00891                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#adce02b4f346c8e028bf3b33f0e27abe4">m_stereo</a>,
<a name="l00892"></a>00892                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a15238b2c0078e0e0d67753d0b0db1e59">m_multisample</a>,
<a name="l00893"></a>00893                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a37187288d4f8c9c03f08b7495ab2f9b5">m_parentWindowHwnd</a>,
<a name="l00894"></a>00894                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a>,
<a name="l00895"></a>00895                                                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a687fbd57b1505248cd3419df4f8d1074">m_msPixelFormat</a>);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897                     <span class="comment">// Return failure so we can trash this window.</span>
<a name="l00898"></a>00898                     success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00899"></a>00899                     <span class="keywordflow">break</span>;
<a name="l00900"></a>00900                 } <span class="keywordflow">else</span> {
<a name="l00901"></a>00901                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa450c16afa2b70fc8612d71bfc81218d">m_multisampleEnabled</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00902"></a>00902                     printf(<span class="stringliteral">&quot;Multisample failed to initialized\n&quot;</span>);
<a name="l00903"></a>00903                     success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00904"></a>00904                 }
<a name="l00905"></a>00905             }
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         }
<a name="l00909"></a>00909         <span class="keywordflow">break</span>;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02ad0d42aef821d08b9b01b32da72888cc0">GHOST_kDrawingContextTypeNone</a>:
<a name="l00912"></a>00912         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00913"></a>00913         <span class="keywordflow">break</span>;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <span class="keywordflow">default</span>:
<a name="l00916"></a>00916         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918     <span class="keywordflow">return</span> success;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2967b584996a02f9a63046e3f8e68818">00921</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2967b584996a02f9a63046e3f8e68818">GHOST_WindowWin32::removeDrawingContext</a>()
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> success;
<a name="l00924"></a>00924     <span class="keywordflow">switch</span> (<a class="code" href="../../de/db8/classGHOST__Window.html#aa1de3505773b74c9d235687b9e810645">m_drawingContextType</a>) {
<a name="l00925"></a>00925     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02a39843d48a48ae74cfdc80cf8e880995d">GHOST_kDrawingContextTypeOpenGL</a>:
<a name="l00926"></a>00926         <span class="comment">// we shouldn&#39;t remove the drawing context if it&#39;s the first OpenGL context</span>
<a name="l00927"></a>00927         <span class="comment">// If we do, we get corrupted drawing. See #19997</span>
<a name="l00928"></a>00928         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> &amp;&amp; <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>!=<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae433038c28fc6f38a6457e6360b2fa6e">s_firsthGLRc</a>) {
<a name="l00929"></a>00929             success = ::wglDeleteContext(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> ? <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a> : <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00930"></a>00930             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a21ea5d626c25d220ba64bef4e0e9eb37">m_hGlRc</a> = 0;
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932         <span class="keywordflow">else</span> {
<a name="l00933"></a>00933             success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00934"></a>00934         }
<a name="l00935"></a>00935         <span class="keywordflow">break</span>;
<a name="l00936"></a>00936     <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02ad0d42aef821d08b9b01b32da72888cc0">GHOST_kDrawingContextTypeNone</a>:
<a name="l00937"></a>00937         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l00938"></a>00938         <span class="keywordflow">break</span>;
<a name="l00939"></a>00939     <span class="keywordflow">default</span>:
<a name="l00940"></a>00940         success = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942     <span class="keywordflow">return</span> success;
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa65ddf2ddc51d976f28102be0dc68eef">00945</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa65ddf2ddc51d976f28102be0dc68eef">GHOST_WindowWin32::lostMouseCapture</a>()
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947     <span class="keywordflow">if</span>(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a50f2b22f9d91124085b21410b5e10ead">m_hasMouseCaptured</a>)
<a name="l00948"></a>00948         {   <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3e16fe5f1e4fbc4e699cd7dfa82298e">m_hasGrabMouse</a> = <span class="keyword">false</span>;
<a name="l00949"></a>00949             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad4d2d964cac8d9cbde648b24e2c79518">m_nPressedButtons</a> = 0;
<a name="l00950"></a>00950             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a50f2b22f9d91124085b21410b5e10ead">m_hasMouseCaptured</a> = <span class="keyword">false</span>;
<a name="l00951"></a>00951         };
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a73787a6a3d17d4e3dc777b8a087b9047">00954</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a73787a6a3d17d4e3dc777b8a087b9047">GHOST_WindowWin32::registerMouseClickEvent</a>(<span class="keywordtype">int</span> press)
<a name="l00955"></a>00955 {
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <span class="keywordflow">switch</span>(press)
<a name="l00958"></a>00958     {
<a name="l00959"></a>00959         <span class="keywordflow">case</span> 0: <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad4d2d964cac8d9cbde648b24e2c79518">m_nPressedButtons</a>++;    <span class="keywordflow">break</span>;
<a name="l00960"></a>00960         <span class="keywordflow">case</span> 1: <span class="keywordflow">if</span>(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad4d2d964cac8d9cbde648b24e2c79518">m_nPressedButtons</a>)   <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad4d2d964cac8d9cbde648b24e2c79518">m_nPressedButtons</a>--; <span class="keywordflow">break</span>;
<a name="l00961"></a>00961         <span class="keywordflow">case</span> 2: <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3e16fe5f1e4fbc4e699cd7dfa82298e">m_hasGrabMouse</a>=<span class="keyword">true</span>;    <span class="keywordflow">break</span>;
<a name="l00962"></a>00962         <span class="keywordflow">case</span> 3: <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3e16fe5f1e4fbc4e699cd7dfa82298e">m_hasGrabMouse</a>=<span class="keyword">false</span>;   <span class="keywordflow">break</span>;
<a name="l00963"></a>00963     }
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="keywordflow">if</span>(!<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad4d2d964cac8d9cbde648b24e2c79518">m_nPressedButtons</a> &amp;&amp; !<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3e16fe5f1e4fbc4e699cd7dfa82298e">m_hasGrabMouse</a> &amp;&amp; <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a50f2b22f9d91124085b21410b5e10ead">m_hasMouseCaptured</a>)
<a name="l00966"></a>00966     {
<a name="l00967"></a>00967             ::ReleaseCapture();
<a name="l00968"></a>00968             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a50f2b22f9d91124085b21410b5e10ead">m_hasMouseCaptured</a> = <span class="keyword">false</span>;
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970     <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad4d2d964cac8d9cbde648b24e2c79518">m_nPressedButtons</a> || <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3e16fe5f1e4fbc4e699cd7dfa82298e">m_hasGrabMouse</a>) &amp;&amp; !<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a50f2b22f9d91124085b21410b5e10ead">m_hasMouseCaptured</a>)
<a name="l00971"></a>00971     {
<a name="l00972"></a>00972             ::SetCapture(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>);
<a name="l00973"></a>00973             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a50f2b22f9d91124085b21410b5e10ead">m_hasMouseCaptured</a> = <span class="keyword">true</span>;
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978 
<a name="l00979"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0289f8f5c60ac67010b86f3c2c1aac87">00979</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0289f8f5c60ac67010b86f3c2c1aac87">GHOST_WindowWin32::loadCursor</a>(<span class="keywordtype">bool</span> visible, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06e">GHOST_TStandardCursor</a> cursor)<span class="keyword"> const</span>
<a name="l00980"></a>00980 <span class="keyword"></span>{
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (!visible) {
<a name="l00982"></a>00982         <span class="keywordflow">while</span> (::ShowCursor(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &gt;= 0);
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984     <span class="keywordflow">else</span> {
<a name="l00985"></a>00985         <span class="keywordflow">while</span> (::ShowCursor(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) &lt; 0);
<a name="l00986"></a>00986     }
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <span class="keywordflow">if</span> (cursor == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea57dae57b0efe9b95b37698d62cb83621">GHOST_kStandardCursorCustom</a> &amp;&amp; <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>) {
<a name="l00989"></a>00989         ::SetCursor( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a> );
<a name="l00990"></a>00990     } <span class="keywordflow">else</span> {
<a name="l00991"></a>00991         <span class="comment">// Convert GHOST cursor to Windows OEM cursor</span>
<a name="l00992"></a>00992         <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;
<a name="l00993"></a>00993         LPCSTR id;
<a name="l00994"></a>00994         <span class="keywordflow">switch</span> (cursor) {
<a name="l00995"></a>00995             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eac77b7fbffdd36d62d4ac1a2b7118264e">GHOST_kStandardCursorDefault</a>:      <span class="keywordtype">id</span> = IDC_ARROW;     <span class="keywordflow">break</span>;
<a name="l00996"></a>00996             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ead531d7f795b9d183243ab5ad192e1d19">GHOST_kStandardCursorRightArrow</a>:       <span class="keywordtype">id</span> = IDC_ARROW;     <span class="keywordflow">break</span>;
<a name="l00997"></a>00997             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eaecca45e3fae2a54c4b6fdd2010e03c9a">GHOST_kStandardCursorLeftArrow</a>:        <span class="keywordtype">id</span> = IDC_ARROW;     <span class="keywordflow">break</span>;
<a name="l00998"></a>00998             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea9122c181dce181bd5540b4d027106552">GHOST_kStandardCursorInfo</a>:         <span class="keywordtype">id</span> = IDC_SIZEALL;   <span class="keywordflow">break</span>;  <span class="comment">// Four-pointed arrow pointing north, south, east, and west</span>
<a name="l00999"></a>00999             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eadaaf11e8d0430fe05f96aa4efa5c203f">GHOST_kStandardCursorDestroy</a>:      <span class="keywordtype">id</span> = IDC_NO;        <span class="keywordflow">break</span>;  <span class="comment">// Slashed circle</span>
<a name="l01000"></a>01000             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea252b25bba08c1a5d04a40b740ef7ca9b">GHOST_kStandardCursorHelp</a>:         <span class="keywordtype">id</span> = IDC_HELP;      <span class="keywordflow">break</span>;  <span class="comment">// Arrow and question mark</span>
<a name="l01001"></a>01001             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea37138f4a11c6ff28c72c7fc9184f45f1">GHOST_kStandardCursorCycle</a>:        <span class="keywordtype">id</span> = IDC_NO;        <span class="keywordflow">break</span>;  <span class="comment">// Slashed circle</span>
<a name="l01002"></a>01002             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eac1bd5a09efa54990bdf5ce2ff1554bd9">GHOST_kStandardCursorSpray</a>:        <span class="keywordtype">id</span> = IDC_SIZEALL;   <span class="keywordflow">break</span>;  <span class="comment">// Four-pointed arrow pointing north, south, east, and west</span>
<a name="l01003"></a>01003             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea277b829dfeae5f295ea7df43cc51b5ed">GHOST_kStandardCursorWait</a>:         <span class="keywordtype">id</span> = IDC_WAIT;      <span class="keywordflow">break</span>;  <span class="comment">// Hourglass</span>
<a name="l01004"></a>01004             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eae0d30ea67c088353988176bfa03bc671">GHOST_kStandardCursorText</a>:         <span class="keywordtype">id</span> = IDC_IBEAM;     <span class="keywordflow">break</span>;  <span class="comment">// I-beam</span>
<a name="l01005"></a>01005             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea57b7085b04a1eb8a7c04b625db86bca7">GHOST_kStandardCursorCrosshair</a>:        <span class="keywordtype">id</span> = IDC_CROSS;     <span class="keywordflow">break</span>;  <span class="comment">// Crosshair</span>
<a name="l01006"></a>01006             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea68fe98e3e82f6c650aa538404686f7d4">GHOST_kStandardCursorUpDown</a>:       <span class="keywordtype">id</span> = IDC_SIZENS;    <span class="keywordflow">break</span>;  <span class="comment">// Double-pointed arrow pointing north and south</span>
<a name="l01007"></a>01007             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea5ba69f513201946e35aa26972f473fba">GHOST_kStandardCursorLeftRight</a>:        <span class="keywordtype">id</span> = IDC_SIZEWE;    <span class="keywordflow">break</span>;  <span class="comment">// Double-pointed arrow pointing west and east</span>
<a name="l01008"></a>01008             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea4f47b844a2937aaf5d99e556d9c3d1e7">GHOST_kStandardCursorTopSide</a>:      <span class="keywordtype">id</span> = IDC_UPARROW;   <span class="keywordflow">break</span>;  <span class="comment">// Vertical arrow</span>
<a name="l01009"></a>01009             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea6e88e8965a3bd971f38debe4f2a66035">GHOST_kStandardCursorBottomSide</a>:       <span class="keywordtype">id</span> = IDC_SIZENS;    <span class="keywordflow">break</span>;
<a name="l01010"></a>01010             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eae00145daa01ffd5a6e2b93223803bc93">GHOST_kStandardCursorLeftSide</a>:     <span class="keywordtype">id</span> = IDC_SIZEWE;    <span class="keywordflow">break</span>;
<a name="l01011"></a>01011             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea953ab4ffea85dfce9177fda5a5848781">GHOST_kStandardCursorTopLeftCorner</a>:    <span class="keywordtype">id</span> = IDC_SIZENWSE;  <span class="keywordflow">break</span>;
<a name="l01012"></a>01012             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ead5872585d1ff4449b58084dc1f0aaa79">GHOST_kStandardCursorTopRightCorner</a>:   <span class="keywordtype">id</span> = IDC_SIZENESW;  <span class="keywordflow">break</span>;
<a name="l01013"></a>01013             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06eac1128ad6bb4ebf043f16d9e343966e92">GHOST_kStandardCursorBottomRightCorner</a>:    <span class="keywordtype">id</span> = IDC_SIZENWSE;  <span class="keywordflow">break</span>;
<a name="l01014"></a>01014             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea13ebf55bb03dea0c41ed96c08067abc2">GHOST_kStandardCursorBottomLeftCorner</a>: <span class="keywordtype">id</span> = IDC_SIZENESW;  <span class="keywordflow">break</span>;
<a name="l01015"></a>01015             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea5cdb8ea6d1ee252429da9dd7c8c48ca6">GHOST_kStandardCursorPencil</a>:       <span class="keywordtype">id</span> = IDC_ARROW;     <span class="keywordflow">break</span>;
<a name="l01016"></a>01016             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea2685cc0954af9321fb9c675e8c307ac8">GHOST_kStandardCursorCopy</a>:         <span class="keywordtype">id</span> = IDC_ARROW;     <span class="keywordflow">break</span>;
<a name="l01017"></a>01017             <span class="keywordflow">default</span>:
<a name="l01018"></a>01018             success = <span class="keyword">false</span>;
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021         <span class="keywordflow">if</span> (success) {
<a name="l01022"></a>01022             ::SetCursor(::LoadCursor(0, id));
<a name="l01023"></a>01023         }
<a name="l01024"></a>01024     }
<a name="l01025"></a>01025 }
<a name="l01026"></a>01026 
<a name="l01027"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a1dbbcd0e111b30f7e60598cc469a5541">01027</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a1dbbcd0e111b30f7e60598cc469a5541">GHOST_WindowWin32::setWindowCursorVisibility</a>(<span class="keywordtype">bool</span> visible)
<a name="l01028"></a>01028 {
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (::GetForegroundWindow() == <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>) {
<a name="l01030"></a>01030         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0289f8f5c60ac67010b86f3c2c1aac87">loadCursor</a>(visible, <a class="code" href="../../de/db8/classGHOST__Window.html#aa484ab2a829e15df94dfbb549ac4dfdd">getCursorShape</a>());
<a name="l01031"></a>01031     }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01036"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3708bbf01fe8ff5d6d410d6cc8f45dd">01036</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ab3708bbf01fe8ff5d6d410d6cc8f45dd">GHOST_WindowWin32::setWindowCursorGrab</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ab7d992d3f8a0de5dd5a41d24f47106bb">GHOST_TGrabCursorMode</a> mode)
<a name="l01037"></a>01037 {
<a name="l01038"></a>01038     <span class="keywordflow">if</span>(mode != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ab7d992d3f8a0de5dd5a41d24f47106bba24da2708acbd111f3e4f284e2378af89">GHOST_kGrabDisable</a>) {
<a name="l01039"></a>01039         <span class="keywordflow">if</span>(mode != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ab7d992d3f8a0de5dd5a41d24f47106bbac90161cefc4f9b522cd11d3a30b61957">GHOST_kGrabNormal</a>) {
<a name="l01040"></a>01040             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6441fdc586a0736effa29745323ace24">m_system</a>-&gt;<a class="code" href="../../d5/d71/classGHOST__SystemWin32.html#a8e3eb46d223573432735dc7f57d50fbc">getCursorPosition</a>(<a class="code" href="../../de/db8/classGHOST__Window.html#a9024a1424e8cace7edc4996b51a57979">m_cursorGrabInitPos</a>[0], <a class="code" href="../../de/db8/classGHOST__Window.html#a9024a1424e8cace7edc4996b51a57979">m_cursorGrabInitPos</a>[1]);
<a name="l01041"></a>01041             <a class="code" href="../../de/db8/classGHOST__Window.html#aaffd36862b6eb4c38d29f9b11332a27e">setCursorGrabAccum</a>(0, 0);
<a name="l01042"></a>01042 
<a name="l01043"></a>01043             <span class="keywordflow">if</span>(mode == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ab7d992d3f8a0de5dd5a41d24f47106bba91b5c9d376132e0eed7641910d197262">GHOST_kGrabHide</a>)
<a name="l01044"></a>01044                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a1dbbcd0e111b30f7e60598cc469a5541">setWindowCursorVisibility</a>(<span class="keyword">false</span>);
<a name="l01045"></a>01045         }
<a name="l01046"></a>01046         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a73787a6a3d17d4e3dc777b8a087b9047">registerMouseClickEvent</a>(2);
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048     <span class="keywordflow">else</span> {
<a name="l01049"></a>01049         <span class="keywordflow">if</span> (<a class="code" href="../../de/db8/classGHOST__Window.html#a305375cb1e6a1d606a65d80868c38981">m_cursorGrab</a>==<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ab7d992d3f8a0de5dd5a41d24f47106bba91b5c9d376132e0eed7641910d197262">GHOST_kGrabHide</a>) {
<a name="l01050"></a>01050             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6441fdc586a0736effa29745323ace24">m_system</a>-&gt;<a class="code" href="../../d5/d71/classGHOST__SystemWin32.html#a98090aef9edb4ad190225fcda9af7f91">setCursorPosition</a>(<a class="code" href="../../de/db8/classGHOST__Window.html#a9024a1424e8cace7edc4996b51a57979">m_cursorGrabInitPos</a>[0], <a class="code" href="../../de/db8/classGHOST__Window.html#a9024a1424e8cace7edc4996b51a57979">m_cursorGrabInitPos</a>[1]);
<a name="l01051"></a>01051             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a1dbbcd0e111b30f7e60598cc469a5541">setWindowCursorVisibility</a>(<span class="keyword">true</span>);
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053         <span class="keywordflow">if</span>(<a class="code" href="../../de/db8/classGHOST__Window.html#a305375cb1e6a1d606a65d80868c38981">m_cursorGrab</a> != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ab7d992d3f8a0de5dd5a41d24f47106bbac90161cefc4f9b522cd11d3a30b61957">GHOST_kGrabNormal</a>) {
<a name="l01054"></a>01054             <span class="comment">/* use to generate a mouse move event, otherwise the last event</span>
<a name="l01055"></a>01055 <span class="comment">             * blender gets can be outside the screen causing menus not to show</span>
<a name="l01056"></a>01056 <span class="comment">             * properly unless the user moves the mouse */</span>
<a name="l01057"></a>01057             <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a5546963354d111d37595ed7d26522699">GHOST_TInt32</a> pos[2];
<a name="l01058"></a>01058             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6441fdc586a0736effa29745323ace24">m_system</a>-&gt;<a class="code" href="../../d5/d71/classGHOST__SystemWin32.html#a8e3eb46d223573432735dc7f57d50fbc">getCursorPosition</a>(pos[0], pos[1]);
<a name="l01059"></a>01059             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a6441fdc586a0736effa29745323ace24">m_system</a>-&gt;<a class="code" href="../../d5/d71/classGHOST__SystemWin32.html#a98090aef9edb4ad190225fcda9af7f91">setCursorPosition</a>(pos[0], pos[1]);
<a name="l01060"></a>01060         }
<a name="l01061"></a>01061 
<a name="l01062"></a>01062         <span class="comment">/* Almost works without but important otherwise the mouse GHOST location can be incorrect on exit */</span>
<a name="l01063"></a>01063         <a class="code" href="../../de/db8/classGHOST__Window.html#aaffd36862b6eb4c38d29f9b11332a27e">setCursorGrabAccum</a>(0, 0);
<a name="l01064"></a>01064         <a class="code" href="../../de/db8/classGHOST__Window.html#a0c0d1da4cf7ffe3d9f245ab6b71c5c91">m_cursorGrabBounds</a>.<a class="code" href="../../d1/d86/classGHOST__Rect.html#aab06205db4db05745895c45dc18b40fa">m_l</a>= <a class="code" href="../../de/db8/classGHOST__Window.html#a0c0d1da4cf7ffe3d9f245ab6b71c5c91">m_cursorGrabBounds</a>.<a class="code" href="../../d1/d86/classGHOST__Rect.html#ab486237b8431d626d698d9ee1085dc2d">m_r</a>= -1; <span class="comment">/* disable */</span>
<a name="l01065"></a>01065         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a73787a6a3d17d4e3dc777b8a087b9047">registerMouseClickEvent</a>(3);
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067     
<a name="l01068"></a>01068     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a62355798734dfdcb6407e0649cb4a5dc">01071</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a62355798734dfdcb6407e0649cb4a5dc">GHOST_WindowWin32::setWindowCursorShape</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06e">GHOST_TStandardCursor</a> cursorShape)
<a name="l01072"></a>01072 {
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>) {
<a name="l01074"></a>01074         DestroyCursor(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>);
<a name="l01075"></a>01075         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01076"></a>01076     }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     <span class="keywordflow">if</span> (::GetForegroundWindow() == <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>) {
<a name="l01079"></a>01079         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0289f8f5c60ac67010b86f3c2c1aac87">loadCursor</a>(<a class="code" href="../../de/db8/classGHOST__Window.html#a2e1fafd59f82089a7b68a3e35ffc3b47">getCursorVisibility</a>(), cursorShape);
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l01083"></a>01083 }
<a name="l01084"></a>01084 
<a name="l01085"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a327d7aac6b0bfb558e168ceaf4a90541">01085</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a327d7aac6b0bfb558e168ceaf4a90541">GHOST_WindowWin32::processWin32TabletInitEvent</a>()
<a name="l01086"></a>01086 {
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>) {
<a name="l01088"></a>01088         GHOST_WIN32_WTInfo fpWTInfo = ( GHOST_WIN32_WTInfo ) ::GetProcAddress( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>, <span class="stringliteral">&quot;WTInfoA&quot;</span> );
<a name="l01089"></a>01089 
<a name="l01090"></a>01090         <span class="comment">// let&#39;s see if we can initialize tablet here</span>
<a name="l01091"></a>01091         <span class="comment">/* check if WinTab available. */</span>
<a name="l01092"></a>01092         <span class="keywordflow">if</span> (fpWTInfo) {
<a name="l01093"></a>01093             AXIS Pressure, Orientation[3]; <span class="comment">/* The maximum tablet size */</span>
<a name="l01094"></a>01094 
<a name="l01095"></a>01095             <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a3be13892ae7076009afcf121347dd319">BOOL</a> pressureSupport = fpWTInfo (WTI_DEVICES, DVC_NPRESSURE, &amp;Pressure);
<a name="l01096"></a>01096             <span class="keywordflow">if</span> (pressureSupport)
<a name="l01097"></a>01097                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a5e191f8a2ce6d85e7b2508a6e8e6d0bb">m_maxPressure</a> = Pressure.axMax;
<a name="l01098"></a>01098             <span class="keywordflow">else</span>
<a name="l01099"></a>01099                 <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a5e191f8a2ce6d85e7b2508a6e8e6d0bb">m_maxPressure</a> = 0;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101             <a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#a3be13892ae7076009afcf121347dd319">BOOL</a> tiltSupport = fpWTInfo (WTI_DEVICES, DVC_ORIENTATION, &amp;Orientation);
<a name="l01102"></a>01102             <span class="keywordflow">if</span> (tiltSupport) {
<a name="l01103"></a>01103                 <span class="comment">/* does the tablet support azimuth ([0]) and altitude ([1]) */</span>
<a name="l01104"></a>01104                 <span class="keywordflow">if</span> (Orientation[0].axResolution &amp;&amp; Orientation[1].axResolution) {
<a name="l01105"></a>01105                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad73c71089d95ceb79b9d46ba9007556a">m_maxAzimuth</a> = Orientation[0].axMax;
<a name="l01106"></a>01106                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2c1a8a53c01b3988c014b52774c10aa8">m_maxAltitude</a> = Orientation[1].axMax;
<a name="l01107"></a>01107                 }
<a name="l01108"></a>01108                 <span class="keywordflow">else</span> {  <span class="comment">/* no so dont do tilt stuff */</span>
<a name="l01109"></a>01109                     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad73c71089d95ceb79b9d46ba9007556a">m_maxAzimuth</a> = <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2c1a8a53c01b3988c014b52774c10aa8">m_maxAltitude</a> = 0;
<a name="l01110"></a>01110                 }
<a name="l01111"></a>01111             }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a57004bc9c30cdaaee1e4cd968aacb2b9a45103b9e5bb871499bcc83acfdd7191f">GHOST_kTabletModeNone</a>;
<a name="l01114"></a>01114         }
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116 }
<a name="l01117"></a>01117 
<a name="l01118"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a7275d625cfb10db2f490adfffc5f0131">01118</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a7275d625cfb10db2f490adfffc5f0131">GHOST_WindowWin32::processWin32TabletEvent</a>(WPARAM wParam, LPARAM lParam)
<a name="l01119"></a>01119 {
<a name="l01120"></a>01120     PACKET pkt;
<a name="l01121"></a>01121     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>) {
<a name="l01122"></a>01122         GHOST_WIN32_WTPacket fpWTPacket = ( GHOST_WIN32_WTPacket ) ::GetProcAddress( <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac78b106bce80f0f85ed724f56f3aac6c">m_wintab</a>, <span class="stringliteral">&quot;WTPacket&quot;</span> );
<a name="l01123"></a>01123         <span class="keywordflow">if</span> (fpWTPacket) {
<a name="l01124"></a>01124             <span class="keywordflow">if</span> (fpWTPacket((<a class="code" href="../../d8/d1d/GHOST__WindowWin32_8h.html#aecd4fbd2f5c4933c312e0d246ce22fee">HCTX</a>)lParam, wParam, &amp;pkt)) {
<a name="l01125"></a>01125                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>) {
<a name="l01126"></a>01126                     <span class="keywordflow">switch</span> (pkt.pkCursor) {
<a name="l01127"></a>01127                         <span class="keywordflow">case</span> 0: <span class="comment">/* first device */</span>
<a name="l01128"></a>01128                         <span class="keywordflow">case</span> 3: <span class="comment">/* second device */</span>
<a name="l01129"></a>01129                             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a57004bc9c30cdaaee1e4cd968aacb2b9a45103b9e5bb871499bcc83acfdd7191f">GHOST_kTabletModeNone</a>; <span class="comment">/* puck - not yet supported */</span>
<a name="l01130"></a>01130                             <span class="keywordflow">break</span>;
<a name="l01131"></a>01131                         <span class="keywordflow">case</span> 1:
<a name="l01132"></a>01132                         <span class="keywordflow">case</span> 4:
<a name="l01133"></a>01133                             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a57004bc9c30cdaaee1e4cd968aacb2b9a028c1c84632a63f11b65894e09cc5887">GHOST_kTabletModeStylus</a>; <span class="comment">/* stylus */</span>
<a name="l01134"></a>01134                             <span class="keywordflow">break</span>;
<a name="l01135"></a>01135                         <span class="keywordflow">case</span> 2:
<a name="l01136"></a>01136                         <span class="keywordflow">case</span> 5:
<a name="l01137"></a>01137                             <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a0b7ade8195901e1fdbec7785e8b10ee6">Active</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a57004bc9c30cdaaee1e4cd968aacb2b9a005291fe3a5aafd394eec0675e747629">GHOST_kTabletModeEraser</a>; <span class="comment">/* eraser */</span>
<a name="l01138"></a>01138                             <span class="keywordflow">break</span>;
<a name="l01139"></a>01139                     }
<a name="l01140"></a>01140                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a5e191f8a2ce6d85e7b2508a6e8e6d0bb">m_maxPressure</a> &gt; 0) {
<a name="l01141"></a>01141                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a901ed84334874122d01cceed78a7c276">Pressure</a> = (float)pkt.pkNormalPressure / (<span class="keywordtype">float</span>)<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a5e191f8a2ce6d85e7b2508a6e8e6d0bb">m_maxPressure</a>;
<a name="l01142"></a>01142                     } <span class="keywordflow">else</span> {
<a name="l01143"></a>01143                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a901ed84334874122d01cceed78a7c276">Pressure</a> = 1.0f;
<a name="l01144"></a>01144                     }
<a name="l01145"></a>01145 
<a name="l01146"></a>01146                     <span class="keywordflow">if</span> ((<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad73c71089d95ceb79b9d46ba9007556a">m_maxAzimuth</a> &gt; 0) &amp;&amp; (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2c1a8a53c01b3988c014b52774c10aa8">m_maxAltitude</a> &gt; 0)) {
<a name="l01147"></a>01147                         ORIENTATION ort = pkt.pkOrientation;
<a name="l01148"></a>01148                         <span class="keywordtype">float</span> vecLen;
<a name="l01149"></a>01149                         <span class="keywordtype">float</span> altRad, azmRad;   <span class="comment">/* in radians */</span>
<a name="l01150"></a>01150 
<a name="l01151"></a>01151                         <span class="comment">/*</span>
<a name="l01152"></a>01152 <span class="comment">                        from the wintab spec:</span>
<a name="l01153"></a>01153 <span class="comment">                        orAzimuth   Specifies the clockwise rotation of the</span>
<a name="l01154"></a>01154 <span class="comment">                        cursor about the z axis through a full circular range.</span>
<a name="l01155"></a>01155 <span class="comment"></span>
<a name="l01156"></a>01156 <span class="comment">                        orAltitude  Specifies the angle with the x-y plane</span>
<a name="l01157"></a>01157 <span class="comment">                        through a signed, semicircular range.  Positive values</span>
<a name="l01158"></a>01158 <span class="comment">                        specify an angle upward toward the positive z axis;</span>
<a name="l01159"></a>01159 <span class="comment">                        negative values specify an angle downward toward the negative z axis.</span>
<a name="l01160"></a>01160 <span class="comment"></span>
<a name="l01161"></a>01161 <span class="comment">                        wintab.h defines .orAltitude as a UINT but documents .orAltitude</span>
<a name="l01162"></a>01162 <span class="comment">                        as positive for upward angles and negative for downward angles.</span>
<a name="l01163"></a>01163 <span class="comment">                        WACOM uses negative altitude values to show that the pen is inverted;</span>
<a name="l01164"></a>01164 <span class="comment">                        therefore we cast .orAltitude as an (int) and then use the absolute value.</span>
<a name="l01165"></a>01165 <span class="comment">                        */</span>
<a name="l01166"></a>01166 
<a name="l01167"></a>01167                         <span class="comment">/* convert raw fixed point data to radians */</span>
<a name="l01168"></a>01168                         altRad = (float)((<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>((<span class="keywordtype">float</span>)ort.orAltitude)/(<span class="keywordtype">float</span>)<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a2c1a8a53c01b3988c014b52774c10aa8">m_maxAltitude</a>) * <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0);
<a name="l01169"></a>01169                         azmRad = (float)(((<span class="keywordtype">float</span>)ort.orAzimuth/(float)<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ad73c71089d95ceb79b9d46ba9007556a">m_maxAzimuth</a>) * <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>*2.0);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171                         <span class="comment">/* find length of the stylus&#39; projected vector on the XY plane */</span>
<a name="l01172"></a>01172                         vecLen = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(altRad);
<a name="l01173"></a>01173 
<a name="l01174"></a>01174                         <span class="comment">/* from there calculate X and Y components based on azimuth */</span>
<a name="l01175"></a>01175                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a727105dd178d62d1945c3bcf1d7a1ced">Xtilt</a> = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(azmRad) * vecLen;
<a name="l01176"></a>01176                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#acf15dee6213e645b1fbf17c9d9aaf880">Ytilt</a> = (float)(<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0 - azmRad) * vecLen);
<a name="l01177"></a>01177 
<a name="l01178"></a>01178                     } <span class="keywordflow">else</span> {
<a name="l01179"></a>01179                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#a727105dd178d62d1945c3bcf1d7a1ced">Xtilt</a> = 0.0f;
<a name="l01180"></a>01180                         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#aa1d5451e05d90c1575bb4db1ea5ba438">m_tabletData</a>-&gt;<a class="code" href="../../d6/da4/structGHOST__TabletData.html#acf15dee6213e645b1fbf17c9d9aaf880">Ytilt</a> = 0.0f;
<a name="l01181"></a>01181                     }
<a name="l01182"></a>01182                 }
<a name="l01183"></a>01183             }
<a name="l01184"></a>01184         }
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186 }
<a name="l01187"></a>01187 
<a name="l01189"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a10cad7e36b09ba4ce4745add16db6a5d">01189</a> <span class="keyword">static</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a10cad7e36b09ba4ce4745add16db6a5d">uns8ReverseBits</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a> ch)
<a name="l01190"></a>01190 {
<a name="l01191"></a>01191     ch= ((ch&gt;&gt;1)&amp;0x55) | ((ch&lt;&lt;1)&amp;0xAA);
<a name="l01192"></a>01192     ch= ((ch&gt;&gt;2)&amp;0x33) | ((ch&lt;&lt;2)&amp;0xCC);
<a name="l01193"></a>01193     ch= ((ch&gt;&gt;4)&amp;0x0F) | ((ch&lt;&lt;4)&amp;0xF0);
<a name="l01194"></a>01194     <span class="keywordflow">return</span> ch;
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01198"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0e5e665aad72b67c5c31cd03c3565965">01198</a> <span class="keyword">static</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a7ec606b4460e506e0be41a33415f2c6e">GHOST_TUns16</a> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0e5e665aad72b67c5c31cd03c3565965">uns16ReverseBits</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a7ec606b4460e506e0be41a33415f2c6e">GHOST_TUns16</a> shrt)
<a name="l01199"></a>01199 {
<a name="l01200"></a>01200     shrt= ((shrt&gt;&gt;1)&amp;0x5555) | ((shrt&lt;&lt;1)&amp;0xAAAA);
<a name="l01201"></a>01201     shrt= ((shrt&gt;&gt;2)&amp;0x3333) | ((shrt&lt;&lt;2)&amp;0xCCCC);
<a name="l01202"></a>01202     shrt= ((shrt&gt;&gt;4)&amp;0x0F0F) | ((shrt&lt;&lt;4)&amp;0xF0F0);
<a name="l01203"></a>01203     shrt= ((shrt&gt;&gt;8)&amp;0x00FF) | ((shrt&lt;&lt;8)&amp;0xFF00);
<a name="l01204"></a>01204     <span class="keywordflow">return</span> shrt;
<a name="l01205"></a>01205 }
<a name="l01206"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0d26318c4a487c5c9c10b4b40889bbbc">01206</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0d26318c4a487c5c9c10b4b40889bbbc">GHOST_WindowWin32::setWindowCustomCursorShape</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a> bitmap[16][2],
<a name="l01207"></a>01207                                                              <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a> mask[16][2],
<a name="l01208"></a>01208                                                              <span class="keywordtype">int</span> hotX, <span class="keywordtype">int</span> hotY)
<a name="l01209"></a>01209 {
<a name="l01210"></a>01210     <span class="keywordflow">return</span> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0d26318c4a487c5c9c10b4b40889bbbc">setWindowCustomCursorShape</a>((<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a>*)bitmap, (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a>*)mask,
<a name="l01211"></a>01211                                       16, 16, hotX, hotY, 0, 1);
<a name="l01212"></a>01212 }
<a name="l01213"></a>01213 
<a name="l01214"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a96bdf5882205d3f3bf5542b7d7937e95">01214</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0d26318c4a487c5c9c10b4b40889bbbc">GHOST_WindowWin32::setWindowCustomCursorShape</a>(<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a> *bitmap,
<a name="l01215"></a>01215                     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a> *mask, <span class="keywordtype">int</span> sizeX, <span class="keywordtype">int</span> sizeY, <span class="keywordtype">int</span> hotX, <span class="keywordtype">int</span> hotY,
<a name="l01216"></a>01216                     <span class="keywordtype">int</span> fg_color, <span class="keywordtype">int</span> bg_color)
<a name="l01217"></a>01217 {
<a name="l01218"></a>01218     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> andData[32];
<a name="l01219"></a>01219     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> xorData[32];
<a name="l01220"></a>01220     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1f63f5e0e5ecc36b36ccd0377ed59d5d">GHOST_TUns32</a> fullBitRow, fullMaskRow;
<a name="l01221"></a>01221     <span class="keywordtype">int</span> x, y, cols;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     cols=sizeX/8; <span class="comment">/* Num of whole bytes per row (width of bm/mask) */</span>
<a name="l01224"></a>01224     <span class="keywordflow">if</span> (sizeX%8) cols++;
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>) {
<a name="l01227"></a>01227         DestroyCursor(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>);
<a name="l01228"></a>01228         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     memset(&amp;andData, 0xFF, <span class="keyword">sizeof</span>(andData));
<a name="l01232"></a>01232     memset(&amp;xorData, 0, <span class="keyword">sizeof</span>(xorData));
<a name="l01233"></a>01233 
<a name="l01234"></a>01234     <span class="keywordflow">for</span> (y=0; y&lt;sizeY; y++) {
<a name="l01235"></a>01235         fullBitRow=0;
<a name="l01236"></a>01236         fullMaskRow=0;
<a name="l01237"></a>01237         <span class="keywordflow">for</span> (x=cols-1; x&gt;=0; x--){
<a name="l01238"></a>01238             fullBitRow&lt;&lt;=8;
<a name="l01239"></a>01239             fullMaskRow&lt;&lt;=8;
<a name="l01240"></a>01240             fullBitRow  |= <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a10cad7e36b09ba4ce4745add16db6a5d">uns8ReverseBits</a>(bitmap[cols*y + x]);
<a name="l01241"></a>01241             fullMaskRow |= <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a10cad7e36b09ba4ce4745add16db6a5d">uns8ReverseBits</a>(  mask[cols*y + x]);
<a name="l01242"></a>01242         }
<a name="l01243"></a>01243         xorData[y]= fullBitRow &amp; fullMaskRow;
<a name="l01244"></a>01244         andData[y]= ~fullMaskRow;
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247     <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a> = ::CreateCursor(::GetModuleHandle(0), hotX, hotY, 32, 32, andData, xorData);
<a name="l01248"></a>01248     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ae2fa9e7f0c05cb695fb8cfc79e65368c">m_customCursor</a>) {
<a name="l01249"></a>01249         <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l01250"></a>01250     }
<a name="l01251"></a>01251 
<a name="l01252"></a>01252     <span class="keywordflow">if</span> (::GetForegroundWindow() == <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>) {
<a name="l01253"></a>01253         <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a0289f8f5c60ac67010b86f3c2c1aac87">loadCursor</a>(<a class="code" href="../../de/db8/classGHOST__Window.html#a2e1fafd59f82089a7b68a3e35ffc3b47">getCursorVisibility</a>(), <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cf002866344cbe21f7538aab00fe06ea57dae57b0efe9b95b37698d62cb83621">GHOST_kStandardCursorCustom</a>);
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 
<a name="l01260"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a25fe59cc1ce8adccee4ffab8e3c2d973">01260</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a25fe59cc1ce8adccee4ffab8e3c2d973">GHOST_WindowWin32::setProgressBar</a>(<span class="keywordtype">float</span> progress)
<a name="l01261"></a>01261 {   
<a name="l01262"></a>01262     <span class="comment">/*SetProgressValue sets state to TBPF_NORMAL automaticly*/</span>
<a name="l01263"></a>01263     <span class="keywordflow">if</span>(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a> &amp;&amp; <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a> == <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a>-&gt;SetProgressValue(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>,10000*progress,10000))
<a name="l01264"></a>01264         <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l01267"></a>01267 }
<a name="l01268"></a>01268 
<a name="l01269"></a><a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac08e95ff774977f44ba9c7e9d9394a3f">01269</a> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7d">GHOST_TSuccess</a> <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#ac08e95ff774977f44ba9c7e9d9394a3f">GHOST_WindowWin32::endProgressBar</a>()
<a name="l01270"></a>01270 {
<a name="l01271"></a>01271     <span class="keywordflow">if</span>(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a> &amp;&amp; <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a> == <a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a82170ffbdf3ab0e505a87dfee3320a9a">m_Bar</a>-&gt;SetProgressState(<a class="code" href="../../d1/dd9/classGHOST__WindowWin32.html#a77cba46e261df2d02ab5df93018b30c3">m_hWnd</a>,<a class="code" href="../../da/d45/GHOST__TaskbarWin32_8h.html#a1fafeab2f8950fbd8edf21f4a2200c39a3570f6f9189f7bcaa722abfce49ea335">TBPF_NOPROGRESS</a>))
<a name="l01272"></a>01272         <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7dabdfeef9ee5de58b8a6d55803a6b8baf8">GHOST_kSuccess</a>;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     <span class="keywordflow">return</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aa2df2b3c68e500b618ce5fdcb1cb1a7da619729d5dc3b0728267762027b82d32e">GHOST_kFailure</a>;
<a name="l01275"></a>01275 }
<a name="l01276"></a>01276 
<a name="l01277"></a>01277 <span class="comment">/*  Ron Fosner&#39;s code for weighting pixel formats and forcing software.</span>
<a name="l01278"></a>01278 <span class="comment">    See http://www.opengl.org/resources/faq/technical/weight.cpp */</span>
<a name="l01279"></a>01279 
<a name="l01280"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0cdbae62f9ba95881e77583d1034854d">01280</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0cdbae62f9ba95881e77583d1034854d">WeightPixelFormat</a>(PIXELFORMATDESCRIPTOR&amp; pfd)
<a name="l01281"></a>01281 {
<a name="l01282"></a>01282     <span class="keywordtype">int</span> weight = 0;
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     <span class="comment">/* assume desktop color depth is 32 bits per pixel */</span>
<a name="l01285"></a>01285 
<a name="l01286"></a>01286     <span class="comment">/* cull unusable pixel formats */</span>
<a name="l01287"></a>01287     <span class="comment">/* if no formats can be found, can we determine why it was rejected? */</span>
<a name="l01288"></a>01288     <span class="keywordflow">if</span>( !(pfd.dwFlags &amp; PFD_SUPPORT_OPENGL) ||
<a name="l01289"></a>01289         !(pfd.dwFlags &amp; PFD_DRAW_TO_WINDOW) ||
<a name="l01290"></a>01290         !(pfd.dwFlags &amp; PFD_DOUBLEBUFFER) || <span class="comment">/* Blender _needs_ this */</span>
<a name="l01291"></a>01291         ( pfd.cDepthBits &lt;= 8 ) ||
<a name="l01292"></a>01292         !(pfd.iPixelType == PFD_TYPE_RGBA))
<a name="l01293"></a>01293         <span class="keywordflow">return</span> 0;
<a name="l01294"></a>01294 
<a name="l01295"></a>01295     weight = 1;  <span class="comment">/* it&#39;s usable */</span>
<a name="l01296"></a>01296 
<a name="l01297"></a>01297     <span class="comment">/* the bigger the depth buffer the better */</span>
<a name="l01298"></a>01298     <span class="comment">/* give no weight to a 16-bit depth buffer, because those are crap */</span>
<a name="l01299"></a>01299     weight += pfd.cDepthBits - 16;
<a name="l01300"></a>01300 
<a name="l01301"></a>01301     weight += pfd.cColorBits - 8;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303     <span class="comment">/* want swap copy capability -- it matters a lot */</span>
<a name="l01304"></a>01304     <span class="keywordflow">if</span>(pfd.dwFlags &amp; PFD_SWAP_COPY) weight += 16;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     <span class="comment">/* but if it&#39;s a generic (not accelerated) view, it&#39;s really bad */</span>
<a name="l01307"></a>01307     <span class="keywordflow">if</span>(pfd.dwFlags &amp; PFD_GENERIC_FORMAT) weight /= 10;
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="keywordflow">return</span> weight;
<a name="l01310"></a>01310 }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 <span class="comment">/* A modification of Ron Fosner&#39;s replacement for ChoosePixelFormat */</span>
<a name="l01313"></a>01313 <span class="comment">/* returns 0 on error, else returns the pixel format number to be used */</span>
<a name="l01314"></a><a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ad0e9f1078577536f4920a29ef589cb7a">01314</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#ad0e9f1078577536f4920a29ef589cb7a">EnumPixelFormats</a>(HDC hdc)
<a name="l01315"></a>01315 {
<a name="l01316"></a>01316     <span class="keywordtype">int</span> iPixelFormat;
<a name="l01317"></a>01317     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, n, w, weight = 0;
<a name="l01318"></a>01318     PIXELFORMATDESCRIPTOR pfd;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320     <span class="comment">/* we need a device context to do anything */</span>
<a name="l01321"></a>01321     <span class="keywordflow">if</span>(!hdc) <span class="keywordflow">return</span> 0;
<a name="l01322"></a>01322 
<a name="l01323"></a>01323     iPixelFormat = 1; <span class="comment">/* careful! PFD numbers are 1 based, not zero based */</span>
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     <span class="comment">/* obtain detailed information about</span>
<a name="l01326"></a>01326 <span class="comment">    the device context&#39;s first pixel format */</span>
<a name="l01327"></a>01327     n = 1+::DescribePixelFormat(hdc, iPixelFormat,
<a name="l01328"></a>01328         <span class="keyword">sizeof</span>(PIXELFORMATDESCRIPTOR), &amp;pfd);
<a name="l01329"></a>01329 
<a name="l01330"></a>01330     <span class="comment">/* choose a pixel format using the useless Windows function in case</span>
<a name="l01331"></a>01331 <span class="comment">        we come up empty handed */</span>
<a name="l01332"></a>01332     iPixelFormat = ::ChoosePixelFormat( hdc, &amp;<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">sPreferredFormat</a> );
<a name="l01333"></a>01333 
<a name="l01334"></a>01334     <span class="keywordflow">if</span>(!iPixelFormat) <span class="keywordflow">return</span> 0; <span class="comment">/* couldn&#39;t find one to use */</span>
<a name="l01335"></a>01335 
<a name="l01336"></a>01336     <span class="keywordflow">for</span>(i=1; i&lt;=n; i++) { <span class="comment">/* not the idiom, but it&#39;s right */</span>
<a name="l01337"></a>01337         ::DescribePixelFormat( hdc, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keyword">sizeof</span>(PIXELFORMATDESCRIPTOR), &amp;pfd );
<a name="l01338"></a>01338         w = <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0cdbae62f9ba95881e77583d1034854d">WeightPixelFormat</a>(pfd);
<a name="l01339"></a>01339         <span class="comment">// be strict on stereo</span>
<a name="l01340"></a>01340         <span class="keywordflow">if</span> (!((<a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#afb898a50e24fe30afd5b337e445475c8">sPreferredFormat</a>.dwFlags ^ pfd.dwFlags) &amp; PFD_STEREO))   {
<a name="l01341"></a>01341             <span class="keywordflow">if</span>(w &gt; weight) {
<a name="l01342"></a>01342                 weight = w;
<a name="l01343"></a>01343                 iPixelFormat = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01344"></a>01344             }
<a name="l01345"></a>01345         }
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     <span class="keywordflow">if</span> (weight == 0) {
<a name="l01348"></a>01348         <span class="comment">// we could find the correct stereo setting, just find any suitable format</span>
<a name="l01349"></a>01349         <span class="keywordflow">for</span>(i=1; i&lt;=n; i++) { <span class="comment">/* not the idiom, but it&#39;s right */</span>
<a name="l01350"></a>01350             ::DescribePixelFormat( hdc, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keyword">sizeof</span>(PIXELFORMATDESCRIPTOR), &amp;pfd );
<a name="l01351"></a>01351             w = <a class="code" href="../../d6/d29/GHOST__WindowWin32_8cpp.html#a0cdbae62f9ba95881e77583d1034854d">WeightPixelFormat</a>(pfd);
<a name="l01352"></a>01352             <span class="keywordflow">if</span>(w &gt; weight) {
<a name="l01353"></a>01353                 weight = w;
<a name="l01354"></a>01354                 iPixelFormat = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01355"></a>01355             }
<a name="l01356"></a>01356         }
<a name="l01357"></a>01357     }
<a name="l01358"></a>01358     <span class="keywordflow">return</span> iPixelFormat;
<a name="l01359"></a>01359 }
<a name="l01360"></a>01360 
<a name="l01361"></a>01361 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:22 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

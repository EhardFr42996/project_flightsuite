<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: isosurface.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">isosurface.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d6/d1e/isosurface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - Free Surface Fluid Simulation with the Lattice Boltzmann Method</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Marching Cubes surface mesh generation</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *****************************************************************************/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d24/isosurface_8h.html">isosurface.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dbe/mcubes__tables_8h.html">mcubes_tables.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d69/particletracer_8h.html">particletracer.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#ifdef sun</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#include &quot;ieeefp.h&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#endif</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="comment">// just use default rounding for platforms where its not available</span>
<a name="l00024"></a>00024 <span class="preprocessor">#ifndef round</span>
<a name="l00025"></a><a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define round(x) (x)</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="comment">/******************************************************************************</span>
<a name="l00029"></a>00029 <span class="comment"> * Constructor</span>
<a name="l00030"></a>00030 <span class="comment"> *****************************************************************************/</span>
<a name="l00031"></a><a class="code" href="../../db/db9/classIsoSurface.html#a97d45f32f4feb2537dd13e3e361e9416">00031</a> <a class="code" href="../../db/db9/classIsoSurface.html#a97d45f32f4feb2537dd13e3e361e9416">IsoSurface::IsoSurface</a>(<span class="keywordtype">double</span> iso) :
<a name="l00032"></a>00032     <a class="code" href="../../df/dc9/classntlGeometryObject.html">ntlGeometryObject</a>(),
<a name="l00033"></a>00033     mSizex(-1), mSizey(-1), mSizez(-1),
<a name="l00034"></a>00034     mpData(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00035"></a>00035   mIsoValue( iso ), 
<a name="l00036"></a>00036     mPoints(), 
<a name="l00037"></a>00037     mUseFullEdgeArrays(false),
<a name="l00038"></a>00038     mpEdgeVerticesX(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), mpEdgeVerticesY(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), mpEdgeVerticesZ(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00039"></a>00039     mEdgeArSize(-1),
<a name="l00040"></a>00040     mIndices(),
<a name="l00041"></a>00041 
<a name="l00042"></a>00042   mStart(0.0), mEnd(0.0), mDomainExtent(0.0),
<a name="l00043"></a>00043   mInitDone(false),
<a name="l00044"></a>00044     mSmoothSurface(0.0), mSmoothNormals(0.0),
<a name="l00045"></a>00045     mAcrossEdge(), mAdjacentFaces(),
<a name="l00046"></a>00046     mCutoff(-1), mCutArray(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), <span class="comment">// off by default</span>
<a name="l00047"></a>00047     mpIsoParts(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), mPartSize(0.), mSubdivs(0),
<a name="l00048"></a>00048     mFlagCnt(1),
<a name="l00049"></a>00049     mSCrad1(0.), mSCrad2(0.), mSCcenter(0.)
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/******************************************************************************</span>
<a name="l00055"></a>00055 <span class="comment"> * The real init...</span>
<a name="l00056"></a>00056 <span class="comment"> *****************************************************************************/</span>
<a name="l00057"></a><a class="code" href="../../db/db9/classIsoSurface.html#a2a3235e3242374847b06c1e929732926">00057</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#a2a3235e3242374847b06c1e929732926">IsoSurface::initializeIsosurface</a>(<span class="keywordtype">int</span> setx, <span class="keywordtype">int</span> sety, <span class="keywordtype">int</span> setz, <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> extent) 
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059     <span class="comment">// range 1-10 (max due to subd array in triangulate)</span>
<a name="l00060"></a>00060     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>&lt;1) <a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>=1;
<a name="l00061"></a>00061     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>&gt;10) <a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>=10;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="comment">// init solver and size</span>
<a name="l00064"></a>00064     <a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a> = setx;
<a name="l00065"></a>00065     <a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a> = sety;
<a name="l00066"></a>00066     <span class="keywordflow">if</span>(setz == 1) {<span class="comment">// 2D, create thin 2D surface</span>
<a name="l00067"></a>00067         setz = 5; 
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069     <a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a> = setz;
<a name="l00070"></a>00070     <a class="code" href="../../db/db9/classIsoSurface.html#afcd5d9811138ef11fc509f2d51bcf1bc" title="normalized domain extent from parametrizer/visualizer">mDomainExtent</a> = extent;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">/* check triangulation size (for raytraing) */</span>
<a name="l00073"></a>00073     <span class="keywordflow">if</span>( ( <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[0] &gt;= <a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a>[0] ) &amp;&amp; ( <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[1] &gt;= <a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a>[1] ) &amp;&amp; ( <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[2] &gt;= <a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a>[2] ) ){
<a name="l00074"></a>00074         <span class="comment">// extent was not set, use normalized one from parametrizer</span>
<a name="l00075"></a>00075         <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a> = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0) - extent*0.5;
<a name="l00076"></a>00076         <a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a> = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0) + extent*0.5;
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <span class="comment">// init </span>
<a name="l00080"></a>00080     <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.clear();
<a name="l00081"></a>00081   <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.clear();
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="keywordtype">int</span> <a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a> = <a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>*<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>*<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>;
<a name="l00084"></a>00084   <a class="code" href="../../db/db9/classIsoSurface.html#a5687cee290b0d0b93d0fc426a456bde8" title="data pointer">mpData</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>];
<a name="l00085"></a>00085   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <a class="code" href="../../db/db9/classIsoSurface.html#a5687cee290b0d0b93d0fc426a456bde8" title="data pointer">mpData</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0; }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087   <span class="comment">// allocate edge arrays  (last slices are never used...)</span>
<a name="l00088"></a>00088     <span class="keywordtype">int</span> initsize = -1;
<a name="l00089"></a>00089     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#acd5fdf108fd742e0e5f45eaa8f703e35" title="use full arrays? (not for farfield)">mUseFullEdgeArrays</a>) {
<a name="l00090"></a>00090         <a class="code" href="../../db/db9/classIsoSurface.html#af7d6dec861dfe111340f8654dad989ea">mEdgeArSize</a> = <a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>;
<a name="l00091"></a>00091         <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>];
<a name="l00092"></a>00092         <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>];
<a name="l00093"></a>00093         <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>];
<a name="l00094"></a>00094         initsize = 3*<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>;
<a name="l00095"></a>00095     } <span class="keywordflow">else</span> {
<a name="l00096"></a>00096         <span class="keywordtype">int</span> sliceNodes = 2*mSizex*<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>*<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>*<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;
<a name="l00097"></a>00097         <a class="code" href="../../db/db9/classIsoSurface.html#af7d6dec861dfe111340f8654dad989ea">mEdgeArSize</a> = sliceNodes;
<a name="l00098"></a>00098         <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[sliceNodes];
<a name="l00099"></a>00099         <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[sliceNodes];
<a name="l00100"></a>00100         <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[sliceNodes];
<a name="l00101"></a>00101         initsize = 3*sliceNodes;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../db/db9/classIsoSurface.html#af7d6dec861dfe111340f8654dad989ea">mEdgeArSize</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1; }
<a name="l00104"></a>00104     <span class="comment">// WARNING - make sure this is consistent with calculateMemreqEstimate</span>
<a name="l00105"></a>00105   
<a name="l00106"></a>00106     <span class="comment">// marching cubes are ready </span>
<a name="l00107"></a>00107     <a class="code" href="../../db/db9/classIsoSurface.html#ad51c70d486b6cf5b68018917478e9f45" title="initialized?">mInitDone</a> = <span class="keyword">true</span>;
<a name="l00108"></a>00108     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;IsoSurface::initializeIsosurface&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Inited, edgenodes:&quot;</span>&lt;&lt;initsize&lt;&lt;<span class="stringliteral">&quot; subdivs:&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>&lt;&lt;<span class="stringliteral">&quot; fulledg:&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#acd5fdf108fd742e0e5f45eaa8f703e35" title="use full arrays? (not for farfield)">mUseFullEdgeArrays</a> , 10);
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00114"></a><a class="code" href="../../db/db9/classIsoSurface.html#ac2cd4816d36191b6113c36435dd2aa8d">00114</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#ac2cd4816d36191b6113c36435dd2aa8d">IsoSurface::resetAll</a>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> val) {
<a name="l00115"></a>00115     <span class="keywordtype">int</span> <a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a> = <a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>*<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>*<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>;
<a name="l00116"></a>00116   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../d5/dff/rna__nodetree_8c.html#a9510ffcfa37bb664f5f3e70f0d9011f9">nodes</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <a class="code" href="../../db/db9/classIsoSurface.html#a5687cee290b0d0b93d0fc426a456bde8" title="data pointer">mpData</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = val; }
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">/******************************************************************************</span>
<a name="l00121"></a>00121 <span class="comment"> * Destructor</span>
<a name="l00122"></a>00122 <span class="comment"> *****************************************************************************/</span>
<a name="l00123"></a><a class="code" href="../../db/db9/classIsoSurface.html#a833b73ead2ef50591b00226a5e4f8608">00123</a> <a class="code" href="../../db/db9/classIsoSurface.html#a833b73ead2ef50591b00226a5e4f8608">IsoSurface::~IsoSurface</a>( <span class="keywordtype">void</span> )
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a5687cee290b0d0b93d0fc426a456bde8" title="data pointer">mpData</a>) <span class="keyword">delete</span> [] <a class="code" href="../../db/db9/classIsoSurface.html#a5687cee290b0d0b93d0fc426a456bde8" title="data pointer">mpData</a>;
<a name="l00126"></a>00126     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>) <span class="keyword">delete</span> [] <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>;
<a name="l00127"></a>00127     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>) <span class="keyword">delete</span> [] <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>;
<a name="l00128"></a>00128     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>) <span class="keyword">delete</span> [] <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>;
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">/******************************************************************************</span>
<a name="l00136"></a>00136 <span class="comment"> * triangulate the scalar field given by pointer</span>
<a name="l00137"></a>00137 <span class="comment"> *****************************************************************************/</span>
<a name="l00138"></a><a class="code" href="../../db/db9/classIsoSurface.html#aa2511905594c07bdc4199ae5eb1893a3">00138</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#aa2511905594c07bdc4199ae5eb1893a3">IsoSurface::triangulate</a>( <span class="keywordtype">void</span> )
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   <span class="keywordtype">double</span> gsx,gsy,gsz; <span class="comment">// grid spacing in x,y,z direction</span>
<a name="l00141"></a>00141   <span class="keywordtype">double</span> px,py,pz;    <span class="comment">// current position in grid in x,y,z direction</span>
<a name="l00142"></a>00142   <a class="code" href="../../d6/da4/structIsoLevelCube.html">IsoLevelCube</a> cubie;    <span class="comment">// struct for a small subcube</span>
<a name="l00143"></a>00143     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> tritimestart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">if</span>(!<a class="code" href="../../db/db9/classIsoSurface.html#a5687cee290b0d0b93d0fc426a456bde8" title="data pointer">mpData</a>) {
<a name="l00146"></a>00146         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;IsoSurface::triangulate&quot;</span>,<span class="stringliteral">&quot;no LBM object, and no scalar field...!&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>);
<a name="l00147"></a>00147         <span class="keywordflow">return</span>;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <span class="comment">// get grid spacing (-2 to have same spacing as sim)</span>
<a name="l00151"></a>00151   gsx = (<a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a>[0]-<a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[0])/(<span class="keywordtype">double</span>)(<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-2.0);
<a name="l00152"></a>00152   gsy = (<a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a>[1]-<a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[1])/(<span class="keywordtype">double</span>)(<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-2.0);
<a name="l00153"></a>00153   gsz = (<a class="code" href="../../db/db9/classIsoSurface.html#a1307cd6787b6b9f3fc1ea06c8a2d9385">mEnd</a>[2]-<a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[2])/(<span class="keywordtype">double</span>)(<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>-2.0);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <span class="comment">// clean up previous frame</span>
<a name="l00156"></a>00156     <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.clear();
<a name="l00157"></a>00157     <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.clear();
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment">// reset edge vertices</span>
<a name="l00160"></a>00160   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="../../db/db9/classIsoSurface.html#af7d6dec861dfe111340f8654dad989ea">mEdgeArSize</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00161"></a>00161         <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1;
<a name="l00162"></a>00162         <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1;
<a name="l00163"></a>00163         <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> pos[8];
<a name="l00167"></a>00167     <span class="keywordtype">float</span> value[8];
<a name="l00168"></a>00168     <span class="keywordtype">int</span> cubeIndex;      <span class="comment">// index entry of the cube </span>
<a name="l00169"></a>00169     <span class="keywordtype">int</span> triIndices[12]; <span class="comment">// vertex indices </span>
<a name="l00170"></a>00170     <span class="keywordtype">int</span> *eVert[12];
<a name="l00171"></a>00171     <a class="code" href="../../d7/d91/structIsoLevelVertex.html">IsoLevelVertex</a> ilv;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="comment">// edges between which points?</span>
<a name="l00174"></a>00174     <span class="keyword">const</span> <span class="keywordtype">int</span> mcEdges[24] = { 
<a name="l00175"></a>00175         0,1,  1,2,  2,3,  3,0,
<a name="l00176"></a>00176         4,5,  5,6,  6,7,  7,4,
<a name="l00177"></a>00177         0,4,  1,5,  2,6,  3,7 };
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="keyword">const</span> <span class="keywordtype">int</span> cubieOffsetX[8] = {
<a name="l00180"></a>00180         0,1,1,0,  0,1,1,0 };
<a name="l00181"></a>00181     <span class="keyword">const</span> <span class="keywordtype">int</span> cubieOffsetY[8] = {
<a name="l00182"></a>00182         0,0,1,1,  0,0,1,1 };
<a name="l00183"></a>00183     <span class="keyword">const</span> <span class="keywordtype">int</span> cubieOffsetZ[8] = {
<a name="l00184"></a>00184         0,0,0,0,  1,1,1,1 };
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="keyword">const</span> <span class="keywordtype">int</span> coAdd=2;
<a name="l00187"></a>00187   <span class="comment">// let the cubes march </span>
<a name="l00188"></a>00188     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>&lt;=1) {
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         pz = <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[2]-gsz*0.5;
<a name="l00191"></a>00191         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=1;k&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>-2);k++) {
<a name="l00192"></a>00192             pz += gsz;
<a name="l00193"></a>00193             py = <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[1]-gsy*0.5;
<a name="l00194"></a>00194             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-2);j++) {
<a name="l00195"></a>00195                 py += gsy;
<a name="l00196"></a>00196                 px = <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[0]-gsx*0.5;
<a name="l00197"></a>00197                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-2);<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00198"></a>00198                     px += gsx;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200                     value[0] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j  ,k  );
<a name="l00201"></a>00201                     value[1] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j  ,k  );
<a name="l00202"></a>00202                     value[2] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j+1,k  );
<a name="l00203"></a>00203                     value[3] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j+1,k  );
<a name="l00204"></a>00204                     value[4] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j  ,k+1);
<a name="l00205"></a>00205                     value[5] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j  ,k+1);
<a name="l00206"></a>00206                     value[6] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j+1,k+1);
<a name="l00207"></a>00207                     value[7] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j+1,k+1);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209                     <span class="comment">// check intersections of isosurface with edges, and calculate cubie index</span>
<a name="l00210"></a>00210                     cubeIndex = 0;
<a name="l00211"></a>00211                     <span class="keywordflow">if</span> (value[0] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 1;
<a name="l00212"></a>00212                     <span class="keywordflow">if</span> (value[1] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 2;
<a name="l00213"></a>00213                     <span class="keywordflow">if</span> (value[2] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 4;
<a name="l00214"></a>00214                     <span class="keywordflow">if</span> (value[3] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 8;
<a name="l00215"></a>00215                     <span class="keywordflow">if</span> (value[4] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 16;
<a name="l00216"></a>00216                     <span class="keywordflow">if</span> (value[5] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 32;
<a name="l00217"></a>00217                     <span class="keywordflow">if</span> (value[6] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 64;
<a name="l00218"></a>00218                     <span class="keywordflow">if</span> (value[7] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 128;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                     <span class="comment">// No triangles to generate?</span>
<a name="l00221"></a>00221                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dbe/mcubes__tables_8h.html#a6ef9db7912a4202bade783a7f591b5dc">mcEdgeTable</a>[cubeIndex] == 0) {
<a name="l00222"></a>00222                         <span class="keywordflow">continue</span>;
<a name="l00223"></a>00223                     }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225                     <span class="comment">// where to look up if this point already exists</span>
<a name="l00226"></a>00226                     <span class="keywordtype">int</span> edgek = 0;
<a name="l00227"></a>00227                     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#acd5fdf108fd742e0e5f45eaa8f703e35" title="use full arrays? (not for farfield)">mUseFullEdgeArrays</a>) edgek=k;
<a name="l00228"></a>00228                     <span class="keyword">const</span> <span class="keywordtype">int</span> baseIn = <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+0, edgek+0);
<a name="l00229"></a>00229                     eVert[ 0] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ baseIn ];
<a name="l00230"></a>00230                     eVert[ 1] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ baseIn + 1 ];
<a name="l00231"></a>00231                     eVert[ 2] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+1, edgek+0) ];
<a name="l00232"></a>00232                     eVert[ 3] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ baseIn ];
<a name="l00233"></a>00233 
<a name="l00234"></a>00234                     eVert[ 4] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+0, edgek+1) ];
<a name="l00235"></a>00235                     eVert[ 5] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1, j+0, edgek+1) ];
<a name="l00236"></a>00236                     eVert[ 6] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+1, edgek+1) ];
<a name="l00237"></a>00237                     eVert[ 7] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+0, edgek+1) ];
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                     eVert[ 8] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ baseIn ];
<a name="l00240"></a>00240                     eVert[ 9] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1, j+0, edgek+0) ];
<a name="l00241"></a>00241                     eVert[10] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1, j+1, edgek+0) ];
<a name="l00242"></a>00242                     eVert[11] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+1, edgek+0) ];
<a name="l00243"></a>00243 
<a name="l00244"></a>00244                     <span class="comment">// grid positions</span>
<a name="l00245"></a>00245                     pos[0] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py    ,pz);
<a name="l00246"></a>00246                     pos[1] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py    ,pz);
<a name="l00247"></a>00247                     pos[2] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py+gsy,pz);
<a name="l00248"></a>00248                     pos[3] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py+gsy,pz);
<a name="l00249"></a>00249                     pos[4] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py    ,pz+gsz);
<a name="l00250"></a>00250                     pos[5] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py    ,pz+gsz);
<a name="l00251"></a>00251                     pos[6] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py+gsy,pz+gsz);
<a name="l00252"></a>00252                     pos[7] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py+gsy,pz+gsz);
<a name="l00253"></a>00253 
<a name="l00254"></a>00254                     <span class="comment">// check all edges</span>
<a name="l00255"></a>00255                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> e=0;e&lt;12;e++) {
<a name="l00256"></a>00256                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dbe/mcubes__tables_8h.html#a6ef9db7912a4202bade783a7f591b5dc">mcEdgeTable</a>[cubeIndex] &amp; (1&lt;&lt;e)) {
<a name="l00257"></a>00257                             <span class="comment">// is the vertex already calculated?</span>
<a name="l00258"></a>00258                             <span class="keywordflow">if</span>(*eVert[ e ] &lt; 0) {
<a name="l00259"></a>00259                                 <span class="comment">// interpolate edge</span>
<a name="l00260"></a>00260                                 <span class="keyword">const</span> <span class="keywordtype">int</span> e1 = mcEdges[e*2  ];
<a name="l00261"></a>00261                                 <span class="keyword">const</span> <span class="keywordtype">int</span> e2 = mcEdges[e*2+1];
<a name="l00262"></a>00262                                 <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p1 = pos[ e1  ];    <span class="comment">// scalar field pos 1</span>
<a name="l00263"></a>00263                                 <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p2 = pos[ e2  ];    <span class="comment">// scalar field pos 2</span>
<a name="l00264"></a>00264                                 <span class="keyword">const</span> <span class="keywordtype">float</span> valp1  = value[ e1  ];  <span class="comment">// scalar field val 1</span>
<a name="l00265"></a>00265                                 <span class="keyword">const</span> <span class="keywordtype">float</span> valp2  = value[ e2  ];  <span class="comment">// scalar field val 2</span>
<a name="l00266"></a>00266                                 <span class="keyword">const</span> <span class="keywordtype">float</span> mu = (<a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a> - valp1) / (valp2 - valp1);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268                                 <span class="comment">// init isolevel vertex</span>
<a name="l00269"></a>00269                                 ilv.<a class="code" href="../../d7/d91/structIsoLevelVertex.html#accb85b93238b60541b622c0493f31b09">v</a> = p1 + (p2-p1)*mu;
<a name="l00270"></a>00270                                 ilv.<a class="code" href="../../d7/d91/structIsoLevelVertex.html#acfda2eaaa8bda7960b1402390d6eafef">n</a> = <a class="code" href="../../db/db9/classIsoSurface.html#a25e885820e1f8cb03415f25c3106f66b" title="compute normal">getNormal</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+cubieOffsetX[e1], j+cubieOffsetY[e1], k+cubieOffsetZ[e1]) * (1.0-mu) +
<a name="l00271"></a>00271                                                 <a class="code" href="../../db/db9/classIsoSurface.html#a25e885820e1f8cb03415f25c3106f66b" title="compute normal">getNormal</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+cubieOffsetX[e2], j+cubieOffsetY[e2], k+cubieOffsetZ[e2]) * (    mu) ;
<a name="l00272"></a>00272                                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.push_back( ilv );
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                                 triIndices[e] = (<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size()-1);
<a name="l00275"></a>00275                                 <span class="comment">// store vertex </span>
<a name="l00276"></a>00276                                 *eVert[ e ] = triIndices[e];
<a name="l00277"></a>00277                             }   <span class="keywordflow">else</span> {
<a name="l00278"></a>00278                                 <span class="comment">// retrieve  from vert array</span>
<a name="l00279"></a>00279                                 triIndices[e] = *eVert[ e ];
<a name="l00280"></a>00280                             }
<a name="l00281"></a>00281                         } <span class="comment">// along all edges </span>
<a name="l00282"></a>00282                     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                     <span class="keywordflow">if</span>( (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;coAdd+<a class="code" href="../../db/db9/classIsoSurface.html#a689d5d094d668d675842fd534947c73f" title="cutoff border area">mCutoff</a>) || (j&lt;coAdd+<a class="code" href="../../db/db9/classIsoSurface.html#a689d5d094d668d675842fd534947c73f" title="cutoff border area">mCutoff</a>) ||
<a name="l00285"></a>00285                             ((<a class="code" href="../../db/db9/classIsoSurface.html#a689d5d094d668d675842fd534947c73f" title="cutoff border area">mCutoff</a>&gt;0) &amp;&amp; (k&lt;coAdd)) ||<span class="comment">// bottom layer</span>
<a name="l00286"></a>00286                             (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-2-coAdd-<a class="code" href="../../db/db9/classIsoSurface.html#a689d5d094d668d675842fd534947c73f" title="cutoff border area">mCutoff</a>) ||
<a name="l00287"></a>00287                             (j&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-2-coAdd-<a class="code" href="../../db/db9/classIsoSurface.html#a689d5d094d668d675842fd534947c73f" title="cutoff border area">mCutoff</a>) ) {
<a name="l00288"></a>00288                         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a15835e2ac665c117e6de4ddddccad0b0" title="cutoff heigh values">mCutArray</a>) {
<a name="l00289"></a>00289                             <span class="keywordflow">if</span>(k &lt; <a class="code" href="../../db/db9/classIsoSurface.html#a15835e2ac665c117e6de4ddddccad0b0" title="cutoff heigh values">mCutArray</a>[j*this-&gt;<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>+<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) <span class="keywordflow">continue</span>;
<a name="l00290"></a>00290                         } <span class="keywordflow">else</span> { <span class="keywordflow">continue</span>; }
<a name="l00291"></a>00291                     }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293                     <span class="comment">// Create the triangles... </span>
<a name="l00294"></a>00294                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> e=0; <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e]!=-1; e+=3) {
<a name="l00295"></a>00295                         <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.push_back( triIndices[ <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e+0] ] );
<a name="l00296"></a>00296                         <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.push_back( triIndices[ <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e+1] ] );
<a name="l00297"></a>00297                         <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.push_back( triIndices[ <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e+2] ] );
<a name="l00298"></a>00298                     }
<a name="l00299"></a>00299                     
<a name="l00300"></a>00300                 }<span class="comment">//i</span>
<a name="l00301"></a>00301             }<span class="comment">// j</span>
<a name="l00302"></a>00302 
<a name="l00303"></a>00303             <span class="comment">// copy edge arrays</span>
<a name="l00304"></a>00304             <span class="keywordflow">if</span>(!<a class="code" href="../../db/db9/classIsoSurface.html#acd5fdf108fd742e0e5f45eaa8f703e35" title="use full arrays? (not for farfield)">mUseFullEdgeArrays</a>) {
<a name="l00305"></a>00305             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-0);j++) 
<a name="l00306"></a>00306                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-0);<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00307"></a>00307                     <span class="comment">//int edgek = 0;</span>
<a name="l00308"></a>00308                     <span class="keyword">const</span> <span class="keywordtype">int</span> dst = <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+0, 0);
<a name="l00309"></a>00309                     <span class="keyword">const</span> <span class="keywordtype">int</span> src = <a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+0, 1);
<a name="l00310"></a>00310                     <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ dst ] = <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ src ];
<a name="l00311"></a>00311                     <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ dst ] = <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ src ];
<a name="l00312"></a>00312                     <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ dst ] = <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ src ];
<a name="l00313"></a>00313                     <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ src ]=-1;
<a name="l00314"></a>00314                     <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ src ]=-1;
<a name="l00315"></a>00315                     <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ src ]=-1;
<a name="l00316"></a>00316                 }
<a name="l00317"></a>00317             } <span class="comment">// */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         } <span class="comment">// k</span>
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="comment">// precalculate normals using an approximation of the scalar field gradient </span>
<a name="l00322"></a>00322         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ni=0;ni&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();ni++) { <a class="code" href="../../d1/d22/stdosl_8h.html#a03960008c09030a58b2c79672320cb3f">normalize</a>( <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[ni].n ); }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     } <span class="keywordflow">else</span> { <span class="comment">// subdivs</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="preprocessor">#define EDGEAR_INDEX(Ai,Aj,Ak, Bi,Bj) ((mSizex*mSizey*mSubdivs*mSubdivs*(Ak))+\</span>
<a name="l00327"></a>00327 <span class="preprocessor">        (mSizex*mSubdivs*((Aj)*mSubdivs+(Bj)))+((Ai)*mSubdivs)+(Bi))</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>
<a name="l00329"></a>00329 <span class="preprocessor">#define ISOTRILININT(fi,fj,fk) ( \</span>
<a name="l00330"></a>00330 <span class="preprocessor">                (1.-(fi))*(1.-(fj))*(1.-(fk))*orgval[0] + \</span>
<a name="l00331"></a>00331 <span class="preprocessor">                (   (fi))*(1.-(fj))*(1.-(fk))*orgval[1] + \</span>
<a name="l00332"></a>00332 <span class="preprocessor">                (   (fi))*(   (fj))*(1.-(fk))*orgval[2] + \</span>
<a name="l00333"></a>00333 <span class="preprocessor">                (1.-(fi))*(   (fj))*(1.-(fk))*orgval[3] + \</span>
<a name="l00334"></a>00334 <span class="preprocessor">                (1.-(fi))*(1.-(fj))*(   (fk))*orgval[4] + \</span>
<a name="l00335"></a>00335 <span class="preprocessor">                (   (fi))*(1.-(fj))*(   (fk))*orgval[5] + \</span>
<a name="l00336"></a>00336 <span class="preprocessor">                (   (fi))*(   (fj))*(   (fk))*orgval[6] + \</span>
<a name="l00337"></a>00337 <span class="preprocessor">                (1.-(fi))*(   (fj))*(   (fk))*orgval[7] )</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span>
<a name="l00339"></a>00339         <span class="comment">// use subdivisions</span>
<a name="l00340"></a>00340         <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> subdfac = 1./(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>);
<a name="l00341"></a>00341         <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> orgGsx = gsx;
<a name="l00342"></a>00342         <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> orgGsy = gsy;
<a name="l00343"></a>00343         <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> orgGsz = gsz;
<a name="l00344"></a>00344         gsx *= subdfac;
<a name="l00345"></a>00345         gsy *= subdfac;
<a name="l00346"></a>00346         gsz *= subdfac;
<a name="l00347"></a>00347         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#acd5fdf108fd742e0e5f45eaa8f703e35" title="use full arrays? (not for farfield)">mUseFullEdgeArrays</a>) {
<a name="l00348"></a>00348             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;IsoSurface::triangulate&quot;</span>,<span class="stringliteral">&quot;Disabling mUseFullEdgeArrays!&quot;</span>);
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="comment">// subdiv local arrays</span>
<a name="l00352"></a>00352         <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> orgval[8];
<a name="l00353"></a>00353         <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> subdAr[2][11][11]; <span class="comment">// max 10 subdivs!</span>
<a name="l00354"></a>00354         <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a>* *arppnt = <span class="keyword">new</span> <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a>*[<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>*<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>*<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>];
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         <span class="comment">// construct pointers</span>
<a name="l00357"></a>00357         <span class="comment">// part test</span>
<a name="l00358"></a>00358         <span class="keywordtype">int</span> pInUse = 0;
<a name="l00359"></a>00359         <span class="keywordtype">int</span> pUsedTest = 0;
<a name="l00360"></a>00360         <span class="comment">// reset particles</span>
<a name="l00361"></a>00361         <span class="comment">// reset list array</span>
<a name="l00362"></a>00362         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>);k++) 
<a name="l00363"></a>00363             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>);j++) 
<a name="l00364"></a>00364                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>);<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00365"></a>00365                     arppnt[<a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k)] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00366"></a>00366                 }
<a name="l00367"></a>00367         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>) {
<a name="l00368"></a>00368             <span class="keywordflow">for</span>(vector&lt;ParticleObject&gt;::iterator pit= <a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a20290de63584566fbbddc3e6ae6319f7" title="iterate over all newest particles (for advancing positions)">getParticlesBegin</a>();
<a name="l00369"></a>00369                     pit!= <a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#ab7ca394089e5aff25442abf4524fa147" title="end iterator for newest particles">getParticlesEnd</a>(); pit++) {
<a name="l00370"></a>00370                 <span class="keywordflow">if</span>( (*pit).getActive()==false ) <span class="keywordflow">continue</span>;
<a name="l00371"></a>00371                 <span class="keywordflow">if</span>( (*pit).getType()!=<a class="code" href="../../d0/d69/particletracer_8h.html#aa34c342137a60a8d1b9504cea2791919">PART_DROP</a>) <span class="keywordflow">continue</span>;
<a name="l00372"></a>00372                 (*pit).setNext(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00373"></a>00373             }
<a name="l00374"></a>00374             <span class="comment">// build per node lists</span>
<a name="l00375"></a>00375             <span class="keywordflow">for</span>(vector&lt;ParticleObject&gt;::iterator pit= <a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a20290de63584566fbbddc3e6ae6319f7" title="iterate over all newest particles (for advancing positions)">getParticlesBegin</a>();
<a name="l00376"></a>00376                     pit!= <a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#ab7ca394089e5aff25442abf4524fa147" title="end iterator for newest particles">getParticlesEnd</a>(); pit++) {
<a name="l00377"></a>00377                 <span class="keywordflow">if</span>( (*pit).getActive()==false ) <span class="keywordflow">continue</span>;
<a name="l00378"></a>00378                 <span class="keywordflow">if</span>( (*pit).getType()!=<a class="code" href="../../d0/d69/particletracer_8h.html#aa34c342137a60a8d1b9504cea2791919">PART_DROP</a>) <span class="keywordflow">continue</span>;
<a name="l00379"></a>00379                 <span class="comment">// check lifetime ignored here</span>
<a name="l00380"></a>00380                 <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = &amp;(*pit);
<a name="l00381"></a>00381                 <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> ppos = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>();
<a name="l00382"></a>00382                 <span class="keyword">const</span> <span class="keywordtype">int</span> pi= (int)<a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">round</a>(ppos[0])+0; 
<a name="l00383"></a>00383                 <span class="keyword">const</span> <span class="keywordtype">int</span> pj= (int)<a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">round</a>(ppos[1])+0; 
<a name="l00384"></a>00384                 <span class="keywordtype">int</span>       pk= (int)<a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">round</a>(ppos[2])+0;<span class="comment">// no offset necessary</span>
<a name="l00385"></a>00385                 <span class="comment">// 2d should be handled by solver. if(LBMDIM==2) { pk = 0; }</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387                 <span class="keywordflow">if</span>(pi&lt;0) <span class="keywordflow">continue</span>;
<a name="l00388"></a>00388                 <span class="keywordflow">if</span>(pj&lt;0) <span class="keywordflow">continue</span>;
<a name="l00389"></a>00389                 <span class="keywordflow">if</span>(pk&lt;0) <span class="keywordflow">continue</span>;
<a name="l00390"></a>00390                 <span class="keywordflow">if</span>(pi&gt;<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-1) <span class="keywordflow">continue</span>;
<a name="l00391"></a>00391                 <span class="keywordflow">if</span>(pj&gt;<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-1) <span class="keywordflow">continue</span>;
<a name="l00392"></a>00392                 <span class="keywordflow">if</span>(pk&gt;<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>-1) <span class="keywordflow">continue</span>;
<a name="l00393"></a>00393                 <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a>* &amp;pnt = arppnt[<a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>(pi,pj,pk)]; 
<a name="l00394"></a>00394                 <span class="keywordflow">if</span>(pnt) {
<a name="l00395"></a>00395                     <span class="comment">// append</span>
<a name="l00396"></a>00396                     <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a>* listpnt = pnt;
<a name="l00397"></a>00397                     <span class="keywordflow">while</span>(listpnt) {
<a name="l00398"></a>00398                         <span class="keywordflow">if</span>(!listpnt-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aefd72b7d90a6920051c4dfe0b31bbc2d" title="get/set next pointer">getNext</a>()) {
<a name="l00399"></a>00399                             listpnt-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a956e5461e46f8ef0253437dc1b0508d8">setNext</a>(p); listpnt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00400"></a>00400                         } <span class="keywordflow">else</span> {
<a name="l00401"></a>00401                             listpnt = listpnt-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aefd72b7d90a6920051c4dfe0b31bbc2d" title="get/set next pointer">getNext</a>();
<a name="l00402"></a>00402                         }
<a name="l00403"></a>00403                     }
<a name="l00404"></a>00404                 } <span class="keywordflow">else</span> {
<a name="l00405"></a>00405                     <span class="comment">// start new list</span>
<a name="l00406"></a>00406                     pnt = <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408                 pInUse++;
<a name="l00409"></a>00409             }
<a name="l00410"></a>00410         } <span class="comment">// mpIsoParts</span>
<a name="l00411"></a>00411 
<a name="l00412"></a>00412         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;IsoSurface::triangulate&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Starting. Parts in use:&quot;</span>&lt;&lt;pInUse&lt;&lt;<span class="stringliteral">&quot;, Subdivs:&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>, 9);
<a name="l00413"></a>00413         pz = <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[2]-(double)(0.*gsz)-0.5*orgGsz;
<a name="l00414"></a>00414         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ok=1;ok&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>-2)*<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;ok++) {
<a name="l00415"></a>00415             pz += gsz;
<a name="l00416"></a>00416             <span class="keyword">const</span> <span class="keywordtype">int</span> k = ok/<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;
<a name="l00417"></a>00417             <span class="keywordflow">if</span>(k&lt;=0) <span class="keywordflow">continue</span>; <span class="comment">// skip zero plane</span>
<a name="l00418"></a>00418             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1;j&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-2);j++) {
<a name="l00419"></a>00419                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-2);<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00420"></a>00420 
<a name="l00421"></a>00421                     orgval[0] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j  ,k  );
<a name="l00422"></a>00422                     orgval[1] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j  ,k  );
<a name="l00423"></a>00423                     orgval[2] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j+1,k  ); <span class="comment">// with subdivs</span>
<a name="l00424"></a>00424                     orgval[3] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j+1,k  );
<a name="l00425"></a>00425                     orgval[4] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j  ,k+1);
<a name="l00426"></a>00426                     orgval[5] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j  ,k+1);
<a name="l00427"></a>00427                     orgval[6] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1,j+1,k+1); <span class="comment">// with subdivs</span>
<a name="l00428"></a>00428                     orgval[7] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>  ,j+1,k+1);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                     <span class="comment">// prebuild subsampled array slice</span>
<a name="l00431"></a>00431                     <span class="keyword">const</span> <span class="keywordtype">int</span> sdkOffset = ok-k*<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>; 
<a name="l00432"></a>00432                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sdk=0; sdk&lt;2; sdk++) 
<a name="l00433"></a>00433                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sdj=0; sdj&lt;mSubdivs+1; sdj++) 
<a name="l00434"></a>00434                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sdi=0; sdi&lt;mSubdivs+1; sdi++) {
<a name="l00435"></a>00435                                 subdAr[sdk][sdj][sdi] = <a class="code" href="../../d6/d1e/isosurface_8cpp.html#aa7cdb9cd647026cce0e1da3a6b40cc9c">ISOTRILININT</a>(sdi*subdfac, sdj*subdfac, (sdkOffset+sdk)*subdfac);
<a name="l00436"></a>00436                             }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438                     <span class="keyword">const</span> <span class="keywordtype">int</span> poDistOffset=2;
<a name="l00439"></a>00439                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> pok=-poDistOffset; pok&lt;1+poDistOffset; pok++) {
<a name="l00440"></a>00440                         <span class="keywordflow">if</span>(k+pok&lt;0) <span class="keywordflow">continue</span>;
<a name="l00441"></a>00441                         <span class="keywordflow">if</span>(k+pok&gt;=<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>-1) <span class="keywordflow">continue</span>;
<a name="l00442"></a>00442                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> poj=-poDistOffset; poj&lt;1+poDistOffset; poj++) {
<a name="l00443"></a>00443                         <span class="keywordflow">if</span>(j+poj&lt;0) <span class="keywordflow">continue</span>;
<a name="l00444"></a>00444                         <span class="keywordflow">if</span>(j+poj&gt;=<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-1) <span class="keywordflow">continue</span>;
<a name="l00445"></a>00445                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> poi=-poDistOffset; poi&lt;1+poDistOffset; poi++) {
<a name="l00446"></a>00446                         <span class="keywordflow">if</span>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+poi&lt;0) <span class="keywordflow">continue</span>;
<a name="l00447"></a>00447                         <span class="keywordflow">if</span>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+poi&gt;=<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-1) <span class="keywordflow">continue</span>; 
<a name="l00448"></a>00448                         <a class="code" href="../../d5/d15/classParticleObject.html" title="A single particle.">ParticleObject</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00449"></a>00449                         p = arppnt[<a class="code" href="../../de/d24/isosurface_8h.html#aa833b443b13a2ebed3b1dafb2491668c">ISOLEVEL_INDEX</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+poi,j+poj,k+pok)];
<a name="l00450"></a>00450                         <span class="keywordflow">while</span>(p) { <span class="comment">// */</span>
<a name="l00451"></a>00451                     <span class="comment">/*</span>
<a name="l00452"></a>00452 <span class="comment">                    for(vector&lt;ParticleObject&gt;::iterator pit= mpIsoParts-&gt;getParticlesBegin();</span>
<a name="l00453"></a>00453 <span class="comment">                            pit!= mpIsoParts-&gt;getParticlesEnd(); pit++) { { { {</span>
<a name="l00454"></a>00454 <span class="comment">                        // debug test! , full list slow!</span>
<a name="l00455"></a>00455 <span class="comment">                        if(( (*pit).getActive()==false ) || ( (*pit).getType()!=PART_DROP)) continue;</span>
<a name="l00456"></a>00456 <span class="comment">                        ParticleObject *p;</span>
<a name="l00457"></a>00457 <span class="comment">                        p = &amp;(*pit); // */</span>
<a name="l00458"></a>00458 
<a name="l00459"></a>00459                             pUsedTest++;
<a name="l00460"></a>00460                             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> ppos = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a1f141e17fceb0bd2dfc4114b84bf34fe" title="get/set vector to position">getPos</a>();
<a name="l00461"></a>00461                             <span class="keyword">const</span> <span class="keywordtype">int</span> spi= (int)<a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">round</a>( (ppos[0]+1.-(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) *(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)mSubdivs-1.5); 
<a name="l00462"></a>00462                             <span class="keyword">const</span> <span class="keywordtype">int</span> spj= (int)<a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">round</a>( (ppos[1]+1.-(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)j) *(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)mSubdivs-1.5); 
<a name="l00463"></a>00463                             <span class="keyword">const</span> <span class="keywordtype">int</span> spk= (int)<a class="code" href="../../d6/d1e/isosurface_8cpp.html#a6ea10f4260b54a61665ead26cb995ba3">round</a>( (ppos[2]+1.-(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)k) *(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)mSubdivs-1.5)-sdkOffset; <span class="comment">// why -2?</span>
<a name="l00464"></a>00464                             <span class="comment">// 2d should be handled by solver. if(LBMDIM==2) { spk = 0; }</span>
<a name="l00465"></a>00465 
<a name="l00466"></a>00466                             <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> pfLen = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#a12bb2dde4512ead5efb421afed5704d9" title="get/set size value">getSize</a>()*1.5*<a class="code" href="../../db/db9/classIsoSurface.html#a424ba268f79d400167f38b53d161b3d2" title="particle size">mPartSize</a>;  <span class="comment">// test, was 1.1</span>
<a name="l00467"></a>00467                             <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> minPfLen = subdfac*0.8;
<a name="l00468"></a>00468                             <span class="keywordflow">if</span>(pfLen&lt;minPfLen) pfLen = minPfLen;
<a name="l00469"></a>00469                             <span class="comment">//errMsg(&quot;ISOPPP&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot;  pp&quot;&lt;&lt;ppos&lt;&lt;&quot;  sp&quot;&lt;&lt;PRINT_VEC(spi,spj,spk)&lt;&lt;&quot; pflen&quot;&lt;&lt;pfLen );</span>
<a name="l00470"></a>00470                             <span class="comment">//errMsg(&quot;ISOPPP&quot;,&quot; subdfac=&quot;&lt;&lt;subdfac&lt;&lt;&quot; size&quot;&lt;&lt;p-&gt;getSize()&lt;&lt;&quot; ps&quot;&lt;&lt;mPartSize );</span>
<a name="l00471"></a>00471                             <span class="keyword">const</span> <span class="keywordtype">int</span> icellpsize = (int)(1.*pfLen*(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>)+1;
<a name="l00472"></a>00472                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> swk=-icellpsize; swk&lt;=icellpsize; swk++) {
<a name="l00473"></a>00473                                 <span class="keywordflow">if</span>(spk+swk&lt;         0) { <span class="keywordflow">continue</span>; }
<a name="l00474"></a>00474                                 <span class="keywordflow">if</span>(spk+swk&gt;         1) { <span class="keywordflow">continue</span>; } <span class="comment">// */</span>
<a name="l00475"></a>00475                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> swj=-icellpsize; swj&lt;=icellpsize; swj++) {
<a name="l00476"></a>00476                                 <span class="keywordflow">if</span>(spj+swj&lt;         0) { <span class="keywordflow">continue</span>; }
<a name="l00477"></a>00477                                 <span class="keywordflow">if</span>(spj+swj&gt;mSubdivs+0) { <span class="keywordflow">continue</span>; } <span class="comment">// */</span>
<a name="l00478"></a>00478                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> swi=-icellpsize; swi&lt;=icellpsize; swi++) {
<a name="l00479"></a>00479                                 <span class="keywordflow">if</span>(spi+swi&lt;         0) { <span class="keywordflow">continue</span>; } 
<a name="l00480"></a>00480                                 <span class="keywordflow">if</span>(spi+swi&gt;mSubdivs+0) { <span class="keywordflow">continue</span>; } <span class="comment">// */</span>
<a name="l00481"></a>00481                                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> cellp = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(
<a name="l00482"></a>00482                                         (1.5+(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(spi+swi))           *subdfac + (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(i-1),
<a name="l00483"></a>00483                                         (1.5+(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(spj+swj))           *subdfac + (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(j-1),
<a name="l00484"></a>00484                                         (1.5+(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(spk+swk)+sdkOffset) *subdfac + (<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)(k-1)
<a name="l00485"></a>00485                                         );
<a name="l00486"></a>00486                                 <span class="comment">//if(swi==0 &amp;&amp; swj==0 &amp;&amp; swk==0) subdAr[spk][spj][spi] = 1.; // DEBUG</span>
<a name="l00487"></a>00487                                 <span class="comment">// clip domain boundaries again </span>
<a name="l00488"></a>00488                                 <span class="keywordflow">if</span>(cellp[0]&lt;1.) { <span class="keywordflow">continue</span>; } 
<a name="l00489"></a>00489                                 <span class="keywordflow">if</span>(cellp[1]&lt;1.) { <span class="keywordflow">continue</span>; } 
<a name="l00490"></a>00490                                 <span class="keywordflow">if</span>(cellp[2]&lt;1.) { <span class="keywordflow">continue</span>; } 
<a name="l00491"></a>00491                                 <span class="keywordflow">if</span>(cellp[0]&gt;(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-3.) { <span class="keywordflow">continue</span>; } 
<a name="l00492"></a>00492                                 <span class="keywordflow">if</span>(cellp[1]&gt;(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-3.) { <span class="keywordflow">continue</span>; } 
<a name="l00493"></a>00493                                 <span class="keywordflow">if</span>(cellp[2]&gt;(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a>)<a class="code" href="../../db/db9/classIsoSurface.html#ab3525464ba3b163c90df41f4bcc12df5">mSizez</a>-3.) { <span class="keywordflow">continue</span>; } 
<a name="l00494"></a>00494                                 <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(cellp-ppos);
<a name="l00495"></a>00495                                 <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> isoadd = 0.; 
<a name="l00496"></a>00496                                 <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> baseIsoVal = <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>*1.1;
<a name="l00497"></a>00497                                 <span class="keywordflow">if</span>(len&lt;pfLen) { 
<a name="l00498"></a>00498                                     isoadd = baseIsoVal*1.;
<a name="l00499"></a>00499                                 } <span class="keywordflow">else</span> { 
<a name="l00500"></a>00500                                     <span class="comment">// falloff linear with pfLen (kernel size=2pfLen</span>
<a name="l00501"></a>00501                                     isoadd = baseIsoVal*(1. - (len-pfLen)/(pfLen)); 
<a name="l00502"></a>00502                                 }
<a name="l00503"></a>00503                                 <span class="keywordflow">if</span>(isoadd&lt;0.) { <span class="keywordflow">continue</span>; }
<a name="l00504"></a>00504                                 <span class="comment">//errMsg(&quot;ISOPPP&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; sp&quot;&lt;&lt;PRINT_VEC(spi+swi,spj+swj,spk+swk)&lt;&lt;&quot; cellp&quot;&lt;&lt;cellp&lt;&lt;&quot; pp&quot;&lt;&lt;ppos &lt;&lt; &quot; l&quot;&lt;&lt; len&lt;&lt; &quot; add&quot;&lt;&lt; isoadd);</span>
<a name="l00505"></a>00505                                 <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> arval = subdAr[spk+swk][spj+swj][spi+swi];
<a name="l00506"></a>00506                                 <span class="keywordflow">if</span>(arval&gt;1.) { <span class="keywordflow">continue</span>; }
<a name="l00507"></a>00507                                 subdAr[spk+swk][spj+swj][spi+swi] = arval + isoadd;
<a name="l00508"></a>00508                             } } }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510                             p = p-&gt;<a class="code" href="../../d5/d15/classParticleObject.html#aefd72b7d90a6920051c4dfe0b31bbc2d" title="get/set next pointer">getNext</a>();
<a name="l00511"></a>00511                         }
<a name="l00512"></a>00512                     } } } <span class="comment">// poDist loops */</span>
<a name="l00513"></a>00513 
<a name="l00514"></a>00514                     py = <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[1]+(((double)j-0.5)*orgGsy)-gsy;
<a name="l00515"></a>00515                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sj=0;sj&lt;<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;sj++) {
<a name="l00516"></a>00516                         py += gsy;
<a name="l00517"></a>00517                         px = <a class="code" href="../../db/db9/classIsoSurface.html#a697cc2113dcc6970d6440c1ebc62e94b" title="start and end vectors for the triangulation region to create triangles in">mStart</a>[0]+(((double)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-0.5)*orgGsx)-gsx;
<a name="l00518"></a>00518                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>=0;<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>&lt;<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>++) {
<a name="l00519"></a>00519                             px += gsx;
<a name="l00520"></a>00520                             value[0] = subdAr[0+0][sj+0][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0]; 
<a name="l00521"></a>00521                             value[1] = subdAr[0+0][sj+0][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1]; 
<a name="l00522"></a>00522                             value[2] = subdAr[0+0][sj+1][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1]; 
<a name="l00523"></a>00523                             value[3] = subdAr[0+0][sj+1][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0]; 
<a name="l00524"></a>00524                             value[4] = subdAr[0+1][sj+0][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0]; 
<a name="l00525"></a>00525                             value[5] = subdAr[0+1][sj+0][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1]; 
<a name="l00526"></a>00526                             value[6] = subdAr[0+1][sj+1][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1]; 
<a name="l00527"></a>00527                             value[7] = subdAr[0+1][sj+1][<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0]; 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529                             <span class="comment">// check intersections of isosurface with edges, and calculate cubie index</span>
<a name="l00530"></a>00530                             cubeIndex = 0;
<a name="l00531"></a>00531                             <span class="keywordflow">if</span> (value[0] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 1;
<a name="l00532"></a>00532                             <span class="keywordflow">if</span> (value[1] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 2; <span class="comment">// with subdivs</span>
<a name="l00533"></a>00533                             <span class="keywordflow">if</span> (value[2] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 4;
<a name="l00534"></a>00534                             <span class="keywordflow">if</span> (value[3] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 8;
<a name="l00535"></a>00535                             <span class="keywordflow">if</span> (value[4] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 16;
<a name="l00536"></a>00536                             <span class="keywordflow">if</span> (value[5] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 32; <span class="comment">// with subdivs</span>
<a name="l00537"></a>00537                             <span class="keywordflow">if</span> (value[6] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 64;
<a name="l00538"></a>00538                             <span class="keywordflow">if</span> (value[7] &lt; <a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a>) cubeIndex |= 128;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540                             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dbe/mcubes__tables_8h.html#a6ef9db7912a4202bade783a7f591b5dc">mcEdgeTable</a>[cubeIndex] &gt;  0) {
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                             <span class="comment">// where to look up if this point already exists</span>
<a name="l00543"></a>00543                             <span class="keyword">const</span> <span class="keywordtype">int</span> edgek = 0;
<a name="l00544"></a>00544                             <span class="keyword">const</span> <span class="keywordtype">int</span> baseIn = <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0, j+0, edgek+0, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>,sj);
<a name="l00545"></a>00545                             eVert[ 0] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ baseIn ];
<a name="l00546"></a>00546                             eVert[ 1] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ baseIn + 1 ];
<a name="l00547"></a>00547                             eVert[ 2] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+0, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0,sj+1) ];
<a name="l00548"></a>00548                             eVert[ 3] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ baseIn ];                             
<a name="l00549"></a>00549                                                                                                                                                                     
<a name="l00550"></a>00550                             eVert[ 4] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+1, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0,sj+0) ];
<a name="l00551"></a>00551                             eVert[ 5] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+1, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1,sj+0) ]; <span class="comment">// with subdivs</span>
<a name="l00552"></a>00552                             eVert[ 6] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+1, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0,sj+1) ];
<a name="l00553"></a>00553                             eVert[ 7] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+1, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0,sj+0) ];
<a name="l00554"></a>00554                                                                                                                                                                     
<a name="l00555"></a>00555                             eVert[ 8] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ baseIn ];                             
<a name="l00556"></a>00556                             eVert[ 9] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+0, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1,sj+0) ]; <span class="comment">// with subdivs</span>
<a name="l00557"></a>00557                             eVert[10] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+0, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+1,sj+1) ];
<a name="l00558"></a>00558                             eVert[11] = &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, edgek+0, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>+0,sj+1) ];
<a name="l00559"></a>00559 
<a name="l00560"></a>00560                             <span class="comment">// grid positions</span>
<a name="l00561"></a>00561                             pos[0] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py    ,pz);
<a name="l00562"></a>00562                             pos[1] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py    ,pz);
<a name="l00563"></a>00563                             pos[2] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py+gsy,pz); <span class="comment">// with subdivs</span>
<a name="l00564"></a>00564                             pos[3] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py+gsy,pz);
<a name="l00565"></a>00565                             pos[4] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py    ,pz+gsz);
<a name="l00566"></a>00566                             pos[5] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py    ,pz+gsz);
<a name="l00567"></a>00567                             pos[6] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px+gsx,py+gsy,pz+gsz); <span class="comment">// with subdivs</span>
<a name="l00568"></a>00568                             pos[7] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(px    ,py+gsy,pz+gsz);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570                             <span class="comment">// check all edges</span>
<a name="l00571"></a>00571                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> e=0;e&lt;12;e++) {
<a name="l00572"></a>00572                                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/dbe/mcubes__tables_8h.html#a6ef9db7912a4202bade783a7f591b5dc">mcEdgeTable</a>[cubeIndex] &amp; (1&lt;&lt;e)) {
<a name="l00573"></a>00573                                     <span class="comment">// is the vertex already calculated?</span>
<a name="l00574"></a>00574                                     <span class="keywordflow">if</span>(*eVert[ e ] &lt; 0) {
<a name="l00575"></a>00575                                         <span class="comment">// interpolate edge</span>
<a name="l00576"></a>00576                                         <span class="keyword">const</span> <span class="keywordtype">int</span> e1 = mcEdges[e*2  ];
<a name="l00577"></a>00577                                         <span class="keyword">const</span> <span class="keywordtype">int</span> e2 = mcEdges[e*2+1];
<a name="l00578"></a>00578                                         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p1 = pos[ e1  ];   <span class="comment">// scalar field pos 1</span>
<a name="l00579"></a>00579                                         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p2 = pos[ e2  ];   <span class="comment">// scalar field pos 2</span>
<a name="l00580"></a>00580                                         <span class="keyword">const</span> <span class="keywordtype">float</span> valp1  = value[ e1  ];  <span class="comment">// scalar field val 1</span>
<a name="l00581"></a>00581                                         <span class="keyword">const</span> <span class="keywordtype">float</span> valp2  = value[ e2  ];  <span class="comment">// scalar field val 2</span>
<a name="l00582"></a>00582                                         <span class="keyword">const</span> <span class="keywordtype">float</span> mu = (<a class="code" href="../../db/db9/classIsoSurface.html#afd7fe5497349fc1d329a679f49cbf268" title="Level of the iso surface.">mIsoValue</a> - valp1) / (valp2 - valp1);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584                                         <span class="comment">// init isolevel vertex</span>
<a name="l00585"></a>00585                                         ilv.<a class="code" href="../../d7/d91/structIsoLevelVertex.html#accb85b93238b60541b622c0493f31b09">v</a> = p1 + (p2-p1)*mu; <span class="comment">// with subdivs</span>
<a name="l00586"></a>00586                                         <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.push_back( ilv );
<a name="l00587"></a>00587                                         triIndices[e] = (<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size()-1);
<a name="l00588"></a>00588                                         <span class="comment">// store vertex </span>
<a name="l00589"></a>00589                                         *eVert[ e ] = triIndices[e]; 
<a name="l00590"></a>00590                                     }   <span class="keywordflow">else</span> {
<a name="l00591"></a>00591                                         <span class="comment">// retrieve  from vert array</span>
<a name="l00592"></a>00592                                         triIndices[e] = *eVert[ e ];
<a name="l00593"></a>00593                                     }
<a name="l00594"></a>00594                                 } <span class="comment">// along all edges </span>
<a name="l00595"></a>00595                             }
<a name="l00596"></a>00596                             <span class="comment">// removed cutoff treatment...</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598                             <span class="comment">// Create the triangles... </span>
<a name="l00599"></a>00599                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> e=0; <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e]!=-1; e+=3) {
<a name="l00600"></a>00600                                 <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.push_back( triIndices[ <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e+0] ] );
<a name="l00601"></a>00601                                 <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.push_back( triIndices[ <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e+1] ] ); <span class="comment">// with subdivs</span>
<a name="l00602"></a>00602                                 <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.push_back( triIndices[ <a class="code" href="../../d1/dbe/mcubes__tables_8h.html#ab56aeba5edf2be8def347353d50ae3bd">mcTriTable</a>[cubeIndex][e+2] ] );
<a name="l00603"></a>00603                                 <span class="comment">//errMsg(&quot;TTT&quot;,&quot; i1&quot;&lt;&lt;mIndices[mIndices.size()-3]&lt;&lt;&quot; &quot;&lt;&lt; &quot; i2&quot;&lt;&lt;mIndices[mIndices.size()-2]&lt;&lt;&quot; &quot;&lt;&lt; &quot; i3&quot;&lt;&lt;mIndices[mIndices.size()-1]&lt;&lt;&quot; &quot;&lt;&lt; mIndices.size() );</span>
<a name="l00604"></a>00604                             }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606                             } <span class="comment">// triangles in edge table?</span>
<a name="l00607"></a>00607                             
<a name="l00608"></a>00608                         }<span class="comment">//si</span>
<a name="l00609"></a>00609                     }<span class="comment">// sj</span>
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                 }<span class="comment">//i</span>
<a name="l00612"></a>00612             }<span class="comment">// j</span>
<a name="l00613"></a>00613 
<a name="l00614"></a>00614             <span class="comment">// copy edge arrays</span>
<a name="l00615"></a>00615             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#a1d1e5c1f5e41fcce1040d21451c7531e">mSizey</a>-0)*<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;j++) 
<a name="l00616"></a>00616                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#aee15d56727b935b79c3632bd18a6dc80" title="size">mSizex</a>-0)*<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00617"></a>00617                     <span class="comment">//int edgek = 0;</span>
<a name="l00618"></a>00618                     <span class="keyword">const</span> <span class="keywordtype">int</span> dst = <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( 0, 0, 0, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j);
<a name="l00619"></a>00619                     <span class="keyword">const</span> <span class="keywordtype">int</span> src = <a class="code" href="../../d6/d1e/isosurface_8cpp.html#a531c2170263491a613d495c25a0a2f27">EDGEAR_INDEX</a>( 0, 0, 1, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j);
<a name="l00620"></a>00620                     <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ dst ] = <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ src ];
<a name="l00621"></a>00621                     <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ dst ] = <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ src ]; <span class="comment">// with subdivs</span>
<a name="l00622"></a>00622                     <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ dst ] = <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ src ];
<a name="l00623"></a>00623                     <a class="code" href="../../db/db9/classIsoSurface.html#a8003338042ee3ec6cbec22d045cbd73a" title="Store indices of calculated points along the cubie edges.">mpEdgeVerticesX</a>[ src ]=-1;
<a name="l00624"></a>00624                     <a class="code" href="../../db/db9/classIsoSurface.html#ab03823f2c3bea9c9e6e69e61f6c38299">mpEdgeVerticesY</a>[ src ]=-1; <span class="comment">// with subdivs</span>
<a name="l00625"></a>00625                     <a class="code" href="../../db/db9/classIsoSurface.html#a40e0e9064c95db3667d17282fe36f1d9">mpEdgeVerticesZ</a>[ src ]=-1;
<a name="l00626"></a>00626                 }
<a name="l00627"></a>00627             <span class="comment">// */</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         } <span class="comment">// ok, k subdiv loop</span>
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         <span class="comment">//delete [] subdAr;</span>
<a name="l00632"></a>00632         <span class="keyword">delete</span> [] arppnt;
<a name="l00633"></a>00633         <a class="code" href="../../db/db9/classIsoSurface.html#a209d1aaaef38d998cbce6624d673dd31">computeNormals</a>();
<a name="l00634"></a>00634     } <span class="comment">// with subdivs</span>
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     <span class="comment">// perform smoothing</span>
<a name="l00637"></a>00637     <span class="keywordtype">float</span> smoSubdfac = 1.;
<a name="l00638"></a>00638     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>&gt;0) {
<a name="l00639"></a>00639         <span class="comment">//smoSubdfac = 1./(float)(mSubdivs);</span>
<a name="l00640"></a>00640         smoSubdfac = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>(0.55,(<span class="keywordtype">double</span>)<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>); <span class="comment">// slightly stronger</span>
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#aba6d5104d86d14264538b211ef6b7ce6" title="amount of surface smoothing">mSmoothSurface</a>&gt;0. || <a class="code" href="../../db/db9/classIsoSurface.html#a89fe836d2988301e23617c3caad7ccab" title="amount of normal smoothing">mSmoothNormals</a>&gt;0.) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;IsoSurface::triangulate&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Smoothing...&quot;</span>,10);
<a name="l00643"></a>00643     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#aba6d5104d86d14264538b211ef6b7ce6" title="amount of surface smoothing">mSmoothSurface</a>&gt;0.0) { 
<a name="l00644"></a>00644         <a class="code" href="../../db/db9/classIsoSurface.html#a2390b6804c7487fc4c977123d35fb958">smoothSurface</a>(<a class="code" href="../../db/db9/classIsoSurface.html#aba6d5104d86d14264538b211ef6b7ce6" title="amount of surface smoothing">mSmoothSurface</a>*smoSubdfac, (<a class="code" href="../../db/db9/classIsoSurface.html#a89fe836d2988301e23617c3caad7ccab" title="amount of normal smoothing">mSmoothNormals</a>&lt;=0.0) ); 
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a89fe836d2988301e23617c3caad7ccab" title="amount of normal smoothing">mSmoothNormals</a>&gt;0.0) { 
<a name="l00647"></a>00647         <a class="code" href="../../db/db9/classIsoSurface.html#a99db97b0c0769455cba7cc683afd2708">smoothNormals</a>(<a class="code" href="../../db/db9/classIsoSurface.html#a89fe836d2988301e23617c3caad7ccab" title="amount of normal smoothing">mSmoothNormals</a>*smoSubdfac); 
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> tritimeend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l00651"></a>00651     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;IsoSurface::triangulate&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;took &quot;</span>&lt;&lt; <a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(tritimeend-tritimestart)&lt;&lt;<span class="stringliteral">&quot;, S(&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#aba6d5104d86d14264538b211ef6b7ce6" title="amount of surface smoothing">mSmoothSurface</a>&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#a89fe836d2988301e23617c3caad7ccab" title="amount of normal smoothing">mSmoothNormals</a>&lt;&lt;<span class="stringliteral">&quot;),&quot;</span>&lt;&lt;
<a name="l00652"></a>00652             <span class="stringliteral">&quot; verts:&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size()&lt;&lt;<span class="stringliteral">&quot; tris:&quot;</span>&lt;&lt;(<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3)&lt;&lt;<span class="stringliteral">&quot; subdivs:&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#aa0096d004f046e0b8155f47641de5505" title="no of subdivisions">mSubdivs</a>
<a name="l00653"></a>00653          , 10 );
<a name="l00654"></a>00654     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>) <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;IsoSurface::triangulate&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;parts:&quot;</span>&lt;&lt;<a class="code" href="../../db/db9/classIsoSurface.html#a392cd2ed6b5c7933b4d62301c4c951eb" title="particle pointer">mpIsoParts</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a8f69f240778943a3dfb30f4720ed98fb" title="get the number of particles">getNumParticles</a>(), 10);
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="comment">/******************************************************************************</span>
<a name="l00662"></a>00662 <span class="comment"> * Get triangles for rendering</span>
<a name="l00663"></a>00663 <span class="comment"> *****************************************************************************/</span>
<a name="l00664"></a><a class="code" href="../../db/db9/classIsoSurface.html#acd815b9d003c865fb5ef80e847045903">00664</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#acd815b9d003c865fb5ef80e847045903">IsoSurface::getTriangles</a>(<span class="keywordtype">double</span> t, vector&lt;ntlTriangle&gt; *triangles, 
<a name="l00665"></a>00665                                                      vector&lt;ntlVec3Gfx&gt; *<a class="code" href="../../d9/d0b/structvertices.html">vertices</a>, 
<a name="l00666"></a>00666                                                      vector&lt;ntlVec3Gfx&gt; *normals, <span class="keywordtype">int</span> objectId )
<a name="l00667"></a>00667 {
<a name="l00668"></a>00668     <span class="keywordflow">if</span>(!<a class="code" href="../../db/db9/classIsoSurface.html#ad51c70d486b6cf5b68018917478e9f45" title="initialized?">mInitDone</a>) {
<a name="l00669"></a>00669         <a class="code" href="../../de/df0/utilities_8h.html#a2b390eed962d9bee00ce58c1f6bfd159">debugOut</a>(<span class="stringliteral">&quot;IsoSurface::getTriangles warning: Not initialized! &quot;</span>, 10);
<a name="l00670"></a>00670         <span class="keywordflow">return</span>;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     t = 0.;
<a name="l00673"></a>00673     <span class="comment">//return; // DEBUG</span>
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   <span class="comment">/* triangulate field */</span>
<a name="l00676"></a>00676   <a class="code" href="../../db/db9/classIsoSurface.html#aa2511905594c07bdc4199ae5eb1893a3">triangulate</a>();
<a name="l00677"></a>00677     <span class="comment">//errMsg(&quot;TRIS&quot;,&quot; &quot;&lt;&lt;mIndices.size() );</span>
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="comment">// new output with vertice reuse</span>
<a name="l00680"></a>00680     <span class="keywordtype">int</span> iniVertIndex = (*vertices).size();
<a name="l00681"></a>00681     <span class="keywordtype">int</span> iniNormIndex = (*normals).size();
<a name="l00682"></a>00682     <span class="keywordflow">if</span>(iniVertIndex != iniNormIndex) {
<a name="l00683"></a>00683         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;getTriangles Error&quot;</span>,<span class="stringliteral">&quot;For &#39;&quot;</span>&lt;&lt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ac9e7557154ccdacd21e86c58c660b866">mName</a>&lt;&lt;<span class="stringliteral">&quot;&#39;: Vertices and normal array sizes to not match!!!&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#af2f6eab59be57681799dbee88ff4c4a7">SIMWORLD_GENERICERROR</a>);
<a name="l00684"></a>00684         <span class="keywordflow">return</span>; 
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686     <span class="comment">//errMsg(&quot;NM&quot;,&quot; ivi&quot;&lt;&lt;iniVertIndex&lt;&lt;&quot; ini&quot;&lt;&lt;iniNormIndex&lt;&lt;&quot; vs&quot;&lt;&lt;vertices-&gt;size()&lt;&lt;&quot; ns&quot;&lt;&lt;normals-&gt;size()&lt;&lt;&quot; ts&quot;&lt;&lt;triangles-&gt;size() );</span>
<a name="l00687"></a>00687     <span class="comment">//errMsg(&quot;NM&quot;,&quot; ovs&quot;&lt;&lt;mVertices.size()&lt;&lt;&quot; ons&quot;&lt;&lt;mVertNormals.size()&lt;&lt;&quot; ots&quot;&lt;&lt;mIndices.size() );</span>
<a name="l00688"></a>00688 
<a name="l00689"></a>00689   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00690"></a>00690         vertices-&gt;push_back( <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].v );
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00693"></a>00693         normals-&gt;push_back( <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n );
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="comment">//errMsg(&quot;N2&quot;,&quot; ivi&quot;&lt;&lt;iniVertIndex&lt;&lt;&quot; ini&quot;&lt;&lt;iniNormIndex&lt;&lt;&quot; vs&quot;&lt;&lt;vertices-&gt;size()&lt;&lt;&quot; ns&quot;&lt;&lt;normals-&gt;size()&lt;&lt;&quot; ts&quot;&lt;&lt;triangles-&gt;size() );</span>
<a name="l00697"></a>00697     <span class="comment">//errMsg(&quot;N2&quot;,&quot; ovs&quot;&lt;&lt;mVertices.size()&lt;&lt;&quot; ons&quot;&lt;&lt;mVertNormals.size()&lt;&lt;&quot; ots&quot;&lt;&lt;mIndices.size() );</span>
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+=3) {
<a name="l00700"></a>00700         <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/df6/sculpt_8c.html#a11919b8f48badb89cbb5b795722c22e3">smooth</a> = 1;
<a name="l00701"></a>00701     <span class="keywordtype">int</span> t1 = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00702"></a>00702     <span class="keywordtype">int</span> t2 = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00703"></a>00703         <span class="keywordtype">int</span> t3 = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+2];
<a name="l00704"></a>00704         <span class="comment">//errMsg(&quot;NM&quot;,&quot; tri&quot;&lt;&lt;t1&lt;&lt;&quot; &quot;&lt;&lt;t2&lt;&lt;&quot; &quot;&lt;&lt;t3 );</span>
<a name="l00705"></a>00705 
<a name="l00706"></a>00706         <a class="code" href="../../d8/da3/classntlTriangle.html">ntlTriangle</a> tri;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[0] = t1+iniVertIndex;
<a name="l00709"></a>00709         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[1] = t2+iniVertIndex;
<a name="l00710"></a>00710         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a01b65af33c04d5444c6567f9c4692afa">getPoints</a>()[2] = t3+iniVertIndex;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         <span class="comment">/* init flags */</span>
<a name="l00713"></a>00713         <span class="keywordtype">int</span> flag = 0; 
<a name="l00714"></a>00714         <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ad0558ea884fc049a12e55dc8643da897">getVisible</a>()){ flag |= <a class="code" href="../../dc/dbe/ntl__ray_8h.html#ad16aabe4ad275186120f5fc48f7fe7a5">TRI_GEOMETRY</a>; }
<a name="l00715"></a>00715         <span class="keywordflow">if</span>(<a class="code" href="../../df/dc9/classntlGeometryObject.html#a7f43f465f89561369e1ed4a8459e3a1b">getCastShadows</a>() ) { 
<a name="l00716"></a>00716             flag |= <a class="code" href="../../dc/dbe/ntl__ray_8h.html#a47d545c4e62e276cf957df78efb0b822">TRI_CASTSHADOWS</a>; } 
<a name="l00717"></a>00717 
<a name="l00718"></a>00718         <span class="comment">/* init geo init id */</span>
<a name="l00719"></a>00719         <span class="keywordtype">int</span> geoiId = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a4ce21e1f1ec7dcb750f4bc1dd3e87d55">getGeoInitId</a>(); 
<a name="l00720"></a>00720         <span class="keywordflow">if</span>(geoiId &gt; 0) { 
<a name="l00721"></a>00721             flag |= (1&lt;&lt; (geoiId+4)); 
<a name="l00722"></a>00722             flag |= <a class="code" href="../../df/dc9/classntlGeometryObject.html#ae7a6debbb3df8aeca19e1a1acbec20d1">mGeoInitType</a>; 
<a name="l00723"></a>00723         } 
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a41f0bc7e01db34a34138a15edbef7bc2">setFlags</a>( flag );
<a name="l00726"></a>00726 
<a name="l00727"></a>00727         <span class="comment">/* triangle normal missing */</span>
<a name="l00728"></a>00728         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#a4b55cba00cdf885e77683568a66f3138">setNormal</a>( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0) );
<a name="l00729"></a>00729         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#ae4184c63599c43500d7c296c1573d03a">setSmoothNormals</a>( smooth );
<a name="l00730"></a>00730         tri.<a class="code" href="../../d8/da3/classntlTriangle.html#ab463e8c2a589e49ed46a92031652ea9b">setObjectId</a>( objectId );
<a name="l00731"></a>00731         triangles-&gt;push_back( tri ); 
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733     <span class="comment">//errMsg(&quot;N3&quot;,&quot; ivi&quot;&lt;&lt;iniVertIndex&lt;&lt;&quot; ini&quot;&lt;&lt;iniNormIndex&lt;&lt;&quot; vs&quot;&lt;&lt;vertices-&gt;size()&lt;&lt;&quot; ns&quot;&lt;&lt;normals-&gt;size()&lt;&lt;&quot; ts&quot;&lt;&lt;triangles-&gt;size() );</span>
<a name="l00734"></a>00734     <span class="keywordflow">return</span>;
<a name="l00735"></a>00735 }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 
<a name="l00739"></a><a class="code" href="../../db/db9/classIsoSurface.html#a25e885820e1f8cb03415f25c3106f66b">00739</a> <span class="keyword">inline</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../db/db9/classIsoSurface.html#a25e885820e1f8cb03415f25c3106f66b" title="compute normal">IsoSurface::getNormal</a>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j,<span class="keywordtype">int</span> k) {
<a name="l00740"></a>00740     <span class="comment">// WARNING - this requires a security boundary layer... </span>
<a name="l00741"></a>00741     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> ret(0.0);
<a name="l00742"></a>00742     ret[0] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(i-1,j  ,k  ) - 
<a name="l00743"></a>00743              *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(i+1,j  ,k  );
<a name="l00744"></a>00744     ret[1] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(i  ,j-1,k  ) - 
<a name="l00745"></a>00745              *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(i  ,j+1,k  );
<a name="l00746"></a>00746     ret[2] = *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(i  ,j  ,k-1  ) - 
<a name="l00747"></a>00747              *<a class="code" href="../../db/db9/classIsoSurface.html#a62ae093dea7851baefc35012d7c452aa" title="access data array">getData</a>(i  ,j  ,k+1  );
<a name="l00748"></a>00748     <span class="keywordflow">return</span> ret;
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="comment">/******************************************************************************</span>
<a name="l00755"></a>00755 <span class="comment"> * </span>
<a name="l00756"></a>00756 <span class="comment"> * Surface improvement, inspired by trimesh2 library</span>
<a name="l00757"></a>00757 <span class="comment"> * (http://www.cs.princeton.edu/gfx/proj/trimesh2/)</span>
<a name="l00758"></a>00758 <span class="comment"> * </span>
<a name="l00759"></a>00759 <span class="comment"> *****************************************************************************/</span>
<a name="l00760"></a>00760 
<a name="l00761"></a><a class="code" href="../../db/db9/classIsoSurface.html#a2f6cb2ee41fd69e3ed0efd17c7a6d9a8">00761</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#a2f6cb2ee41fd69e3ed0efd17c7a6d9a8">IsoSurface::setSmoothRad</a>(<span class="keywordtype">float</span> radi1, <span class="keywordtype">float</span> radi2, <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> mscc) {
<a name="l00762"></a>00762     <a class="code" href="../../db/db9/classIsoSurface.html#a322d540143a401be8cf297dfb2a37e94">mSCrad1</a> = radi1*radi1;
<a name="l00763"></a>00763     <a class="code" href="../../db/db9/classIsoSurface.html#aac8ed078688edf893af1b7d86d3de93f">mSCrad2</a> = radi2*radi2;
<a name="l00764"></a>00764     <a class="code" href="../../db/db9/classIsoSurface.html#a15572dbb242d539b2635c836c9195ea8">mSCcenter</a> = mscc;
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 <span class="comment">// compute normals for all generated triangles</span>
<a name="l00768"></a><a class="code" href="../../db/db9/classIsoSurface.html#a209d1aaaef38d998cbce6624d673dd31">00768</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#a209d1aaaef38d998cbce6624d673dd31">IsoSurface::computeNormals</a>() {
<a name="l00769"></a>00769   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00770"></a>00770         <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.);
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+=3) {
<a name="l00774"></a>00774     <span class="keyword">const</span> <span class="keywordtype">int</span> t1 = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00775"></a>00775     <span class="keyword">const</span> <span class="keywordtype">int</span> t2 = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00776"></a>00776         <span class="keyword">const</span> <span class="keywordtype">int</span> t3 = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+2];
<a name="l00777"></a>00777         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p1 = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[t1].v;
<a name="l00778"></a>00778         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p2 = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[t2].v;
<a name="l00779"></a>00779         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p3 = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[t3].v;
<a name="l00780"></a>00780         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> n1=p1-p2;
<a name="l00781"></a>00781         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> n2=p2-p3;
<a name="l00782"></a>00782         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> n3=p3-p1;
<a name="l00783"></a>00783         <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> len1 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(n1);
<a name="l00784"></a>00784         <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> len2 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(n2);
<a name="l00785"></a>00785         <span class="keyword">const</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> len3 = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(n3);
<a name="l00786"></a>00786         <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>(n1,n2);
<a name="l00787"></a>00787         <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[t1].n += norm * (1./(len1*len3));
<a name="l00788"></a>00788         <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[t2].n += norm * (1./(len1*len2));
<a name="l00789"></a>00789         <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[t3].n += norm * (1./(len2*len3));
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00793"></a>00793         <a class="code" href="../../d1/d22/stdosl_8h.html#a03960008c09030a58b2c79672320cb3f">normalize</a>(<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n);
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="comment">// Diffuse a vector field at 1 vertex, weighted by</span>
<a name="l00798"></a>00798 <span class="comment">// a gaussian of width 1/sqrt(invsigma2)</span>
<a name="l00799"></a><a class="code" href="../../db/db9/classIsoSurface.html#a4a19baa15024a353da34d5f56561278b">00799</a> <span class="keywordtype">bool</span> <a class="code" href="../../db/db9/classIsoSurface.html#a4a19baa15024a353da34d5f56561278b" title="smoothing helper function">IsoSurface::diffuseVertexField</a>(<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> *field, <span class="keyword">const</span> <span class="keywordtype">int</span> pointerScale, <span class="keywordtype">int</span> src, <span class="keywordtype">float</span> invsigma2, <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> &amp;target)
<a name="l00800"></a>00800 {
<a name="l00801"></a>00801     <span class="keywordflow">if</span>((<a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[src].<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>()&lt;1) || (<a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[src]&lt;=0.0)) <span class="keywordflow">return</span> 0;
<a name="l00802"></a>00802     <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> srcp = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[src].v;
<a name="l00803"></a>00803     <span class="keyword">const</span> <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> srcn = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[src].n;
<a name="l00804"></a>00804     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a322d540143a401be8cf297dfb2a37e94">mSCrad1</a>&gt;0.0 &amp;&amp; <a class="code" href="../../db/db9/classIsoSurface.html#aac8ed078688edf893af1b7d86d3de93f">mSCrad2</a>&gt;0.0) {
<a name="l00805"></a>00805         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> dp = <a class="code" href="../../db/db9/classIsoSurface.html#a15572dbb242d539b2635c836c9195ea8">mSCcenter</a>-srcp; dp[2] = 0.0; <span class="comment">// only xy-plane</span>
<a name="l00806"></a>00806         <span class="keywordtype">float</span> rd = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(dp);
<a name="l00807"></a>00807         <span class="keywordflow">if</span>(rd &gt; <a class="code" href="../../db/db9/classIsoSurface.html#aac8ed078688edf893af1b7d86d3de93f">mSCrad2</a>) {
<a name="l00808"></a>00808             <span class="keywordflow">return</span> 0;
<a name="l00809"></a>00809         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rd &gt; <a class="code" href="../../db/db9/classIsoSurface.html#a322d540143a401be8cf297dfb2a37e94">mSCrad1</a>) {
<a name="l00810"></a>00810             <span class="comment">// optimize?</span>
<a name="l00811"></a>00811             <span class="keywordtype">float</span> org = 1.0/<a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(invsigma2);
<a name="l00812"></a>00812             org *= (1.0- (rd-<a class="code" href="../../db/db9/classIsoSurface.html#a322d540143a401be8cf297dfb2a37e94">mSCrad1</a>) / (<a class="code" href="../../db/db9/classIsoSurface.html#aac8ed078688edf893af1b7d86d3de93f">mSCrad2</a>-<a class="code" href="../../db/db9/classIsoSurface.html#a322d540143a401be8cf297dfb2a37e94">mSCrad1</a>));
<a name="l00813"></a>00813             invsigma2 = 1.0/(org*org);
<a name="l00814"></a>00814             <span class="comment">//errMsg(&quot;TRi&quot;,&quot;p&quot;&lt;&lt;srcp&lt;&lt;&quot; rd:&quot;&lt;&lt;rd&lt;&lt;&quot; r1:&quot;&lt;&lt;mSCrad1&lt;&lt;&quot; r2:&quot;&lt;&lt;mSCrad2&lt;&lt;&quot; org:&quot;&lt;&lt;org&lt;&lt;&quot; is:&quot;&lt;&lt;invsigma2);</span>
<a name="l00815"></a>00815         } <span class="keywordflow">else</span> {
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818     target = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0);
<a name="l00819"></a>00819     target += *(field+pointerScale*src) *<a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[src];
<a name="l00820"></a>00820     <span class="keywordtype">float</span> smstrSum = <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[src];
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     <span class="keywordtype">int</span> flag = <a class="code" href="../../db/db9/classIsoSurface.html#abbe4008b5fe26c4a4d83e8b258a6677a">mFlagCnt</a>; 
<a name="l00823"></a>00823     <a class="code" href="../../db/db9/classIsoSurface.html#abbe4008b5fe26c4a4d83e8b258a6677a">mFlagCnt</a>++;
<a name="l00824"></a>00824     <a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>[src] = flag;
<a name="l00825"></a>00825     <a class="code" href="../../db/db9/classIsoSurface.html#aa35120f8ac39a96b1c7e0baa3371db7e">mDboundary</a> = <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[src];
<a name="l00826"></a>00826     <span class="keywordflow">while</span> (!<a class="code" href="../../db/db9/classIsoSurface.html#aa35120f8ac39a96b1c7e0baa3371db7e">mDboundary</a>.empty()) {
<a name="l00827"></a>00827         <span class="keyword">const</span> <span class="keywordtype">int</span> bbn = <a class="code" href="../../db/db9/classIsoSurface.html#aa35120f8ac39a96b1c7e0baa3371db7e">mDboundary</a>.back();
<a name="l00828"></a>00828         <a class="code" href="../../db/db9/classIsoSurface.html#aa35120f8ac39a96b1c7e0baa3371db7e">mDboundary</a>.pop_back();
<a name="l00829"></a>00829         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>[bbn]==flag) <span class="keywordflow">continue</span>;
<a name="l00830"></a>00830         <a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>[bbn] = flag;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832         <span class="comment">// normal check</span>
<a name="l00833"></a>00833         <span class="keyword">const</span> <span class="keywordtype">float</span> nvdot = <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(srcn, <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[bbn].n); <span class="comment">// faster than before d2 calc?</span>
<a name="l00834"></a>00834         <span class="keywordflow">if</span>(nvdot &lt;= 0.0f) <span class="keywordflow">continue</span>;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="comment">// gaussian weight of width 1/sqrt(invsigma2)</span>
<a name="l00837"></a>00837         <span class="keyword">const</span> <span class="keywordtype">float</span> d2 = invsigma2 * <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[bbn].v - srcp);
<a name="l00838"></a>00838         <span class="keywordflow">if</span>(d2 &gt;= 9.0f) <span class="keywordflow">continue</span>;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <span class="comment">// aggressive smoothing factor</span>
<a name="l00841"></a>00841         <span class="keywordtype">float</span> smstr = nvdot * <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[bbn];
<a name="l00842"></a>00842         <span class="comment">// Accumulate weight times field at neighbor</span>
<a name="l00843"></a>00843         target += *(field+pointerScale*bbn)*smstr;
<a name="l00844"></a>00844         smstrSum += smstr;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[bbn].<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00847"></a>00847             <span class="keyword">const</span> <span class="keywordtype">int</span> nn = <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[bbn][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00848"></a>00848             <span class="keywordflow">if</span> (<a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>[nn] == flag) <span class="keywordflow">continue</span>;
<a name="l00849"></a>00849             <a class="code" href="../../db/db9/classIsoSurface.html#aa35120f8ac39a96b1c7e0baa3371db7e">mDboundary</a>.push_back(nn);
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852     target /= smstrSum;
<a name="l00853"></a>00853     <span class="keywordflow">return</span> 1;
<a name="l00854"></a>00854 }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     
<a name="l00857"></a>00857 <span class="comment">// perform smoothing of the surface (and possible normals)</span>
<a name="l00858"></a><a class="code" href="../../db/db9/classIsoSurface.html#a2390b6804c7487fc4c977123d35fb958">00858</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#a2390b6804c7487fc4c977123d35fb958">IsoSurface::smoothSurface</a>(<span class="keywordtype">float</span> sigma, <span class="keywordtype">bool</span> normSmooth)
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860     <span class="keywordtype">int</span> nv = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();
<a name="l00861"></a>00861     <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)<a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>.size() != nv) <a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>.resize(nv);
<a name="l00862"></a>00862     <span class="keywordtype">int</span> nf = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     { <span class="comment">// need neighbors</span>
<a name="l00865"></a>00865         vector&lt;int&gt; numneighbors(<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size());
<a name="l00866"></a>00866         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00867"></a>00867         <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3; i++) {
<a name="l00868"></a>00868             numneighbors[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[i*3+0]]++;
<a name="l00869"></a>00869             numneighbors[mIndices[i*3+1]]++;
<a name="l00870"></a>00870             numneighbors[mIndices[i*3+2]]++;
<a name="l00871"></a>00871         }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873         <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>.clear();
<a name="l00874"></a>00874         <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>.resize(<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size());
<a name="l00875"></a>00875         <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size(); i++) {
<a name="l00876"></a>00876             <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].clear();
<a name="l00877"></a>00877             <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].reserve(numneighbors[i]+2); <span class="comment">// Slop for boundaries</span>
<a name="l00878"></a>00878         }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880         <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3; i++) {
<a name="l00881"></a>00881             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) {
<a name="l00882"></a>00882                 vector&lt;int&gt; &amp;me = <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[ <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[i*3+j]];
<a name="l00883"></a>00883                 <span class="keywordtype">int</span> n1 =  mIndices[i*3+((j+1)%3)];
<a name="l00884"></a>00884                 <span class="keywordtype">int</span> n2 =  mIndices[i*3+((j+2)%3)];
<a name="l00885"></a>00885                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/dea/sp__coletree_8c.html#ae3d5811c1f73da8bff145a1dcd88ef69">std::find</a>(me.begin(), me.end(), n1) == me.end())
<a name="l00886"></a>00886                     me.push_back(n1);
<a name="l00887"></a>00887                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/dea/sp__coletree_8c.html#ae3d5811c1f73da8bff145a1dcd88ef69">std::find</a>(me.begin(), me.end(), n2) == me.end())
<a name="l00888"></a>00888                     me.push_back(n2);
<a name="l00889"></a>00889             }
<a name="l00890"></a>00890         }
<a name="l00891"></a>00891     } <span class="comment">// need neighbor</span>
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     { <span class="comment">// need pointarea</span>
<a name="l00894"></a>00894         <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>.clear();
<a name="l00895"></a>00895         <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>.resize(nv);
<a name="l00896"></a>00896         <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>.clear();
<a name="l00897"></a>00897         <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>.resize(nf);
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nf; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00900"></a>00900             <span class="comment">// Edges</span>
<a name="l00901"></a>00901             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> e[3] = { 
<a name="l00902"></a>00902                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+2]].v - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+1]].v,
<a name="l00903"></a>00903                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+0]].v - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+2]].v,
<a name="l00904"></a>00904                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+1]].v - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+0]].v };
<a name="l00905"></a>00905 
<a name="l00906"></a>00906             <span class="comment">// Compute corner weights</span>
<a name="l00907"></a>00907             <span class="keywordtype">float</span> area = 0.5f * <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>( <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>(e[0], e[1]));
<a name="l00908"></a>00908             <span class="keywordtype">float</span> l2[3] = { <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(e[0]), <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(e[1]), <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(e[2]) };
<a name="l00909"></a>00909             <span class="keywordtype">float</span> ew[3] = { l2[0] * (l2[1] + l2[2] - l2[0]),
<a name="l00910"></a>00910                     l2[1] * (l2[2] + l2[0] - l2[1]),
<a name="l00911"></a>00911                     l2[2] * (l2[0] + l2[1] - l2[2]) };
<a name="l00912"></a>00912             <span class="keywordflow">if</span> (ew[0] &lt;= 0.0f) {
<a name="l00913"></a>00913                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] = -0.25f * l2[2] * area /
<a name="l00914"></a>00914                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[0] , e[2]);
<a name="l00915"></a>00915                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] = -0.25f * l2[1] * area /
<a name="l00916"></a>00916                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[0] , e[1]);
<a name="l00917"></a>00917                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] = area - <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] -
<a name="l00918"></a>00918                                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2];
<a name="l00919"></a>00919             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ew[1] &lt;= 0.0f) {
<a name="l00920"></a>00920                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] = -0.25f * l2[0] * area /
<a name="l00921"></a>00921                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[1] , e[0]);
<a name="l00922"></a>00922                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] = -0.25f * l2[2] * area /
<a name="l00923"></a>00923                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[1] , e[2]);
<a name="l00924"></a>00924                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] = area - <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] -
<a name="l00925"></a>00925                                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l00926"></a>00926             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ew[2] &lt;= 0.0f) {
<a name="l00927"></a>00927                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] = -0.25f * l2[1] * area /
<a name="l00928"></a>00928                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[2] , e[1]);
<a name="l00929"></a>00929                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] = -0.25f * l2[0] * area /
<a name="l00930"></a>00930                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[2] , e[0]);
<a name="l00931"></a>00931                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] = area - <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] -
<a name="l00932"></a>00932                                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1];
<a name="l00933"></a>00933             } <span class="keywordflow">else</span> {
<a name="l00934"></a>00934                 <span class="keywordtype">float</span> ewscale = 0.5f * area / (ew[0] + ew[1] + ew[2]);
<a name="l00935"></a>00935                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)
<a name="l00936"></a>00936                     <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = ewscale * (ew[(j+1)%3] +
<a name="l00937"></a>00937                                              ew[(j+2)%3]);
<a name="l00938"></a>00938             }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940             <span class="comment">// NT important, check this...</span>
<a name="l00941"></a>00941 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00942"></a>00942 <span class="preprocessor"></span>            <span class="keywordflow">if</span>(! finite(<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0]) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][0]=1e-6;
<a name="l00943"></a>00943             <span class="keywordflow">if</span>(! finite(<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]=1e-6;
<a name="l00944"></a>00944             <span class="keywordflow">if</span>(! finite(<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]=1e-6;
<a name="l00945"></a>00945 <span class="preprocessor">#else // WIN32</span>
<a name="l00946"></a>00946 <span class="preprocessor"></span>            <span class="comment">// FIXME check as well...</span>
<a name="l00947"></a>00947             <span class="keywordflow">if</span>(! (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][0]&gt;=0.0) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][0]=1e-6;
<a name="l00948"></a>00948             <span class="keywordflow">if</span>(! (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]&gt;=0.0) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]=1e-6;
<a name="l00949"></a>00949             <span class="keywordflow">if</span>(! (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]&gt;=0.0) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]=1e-6;
<a name="l00950"></a>00950 <span class="preprocessor">#endif // WIN32</span>
<a name="l00951"></a>00951 <span class="preprocessor"></span>
<a name="l00952"></a>00952             <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[i*3+0]] += <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l00953"></a>00953             <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[mIndices[i*3+1]] += <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1];
<a name="l00954"></a>00954             <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[mIndices[i*3+2]] += <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2];
<a name="l00955"></a>00955         }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     } <span class="comment">// need pointarea</span>
<a name="l00958"></a>00958     <span class="comment">// */</span>
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordtype">float</span> invsigma2 = 1.0f / (sigma*sigma);
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     vector&lt;ntlVec3Gfx&gt; dflt(nv);
<a name="l00963"></a>00963     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00964"></a>00964         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a4a19baa15024a353da34d5f56561278b" title="smoothing helper function">diffuseVertexField</a>( &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[0].v, 2,
<a name="l00965"></a>00965                    <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, invsigma2, dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])) {
<a name="l00966"></a>00966             <span class="comment">// Just keep the displacement</span>
<a name="l00967"></a>00967             dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].v;
<a name="l00968"></a>00968         } <span class="keywordflow">else</span> { dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0; } <span class="comment">//?mPoints[i].v; }</span>
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">// Slightly better small-neighborhood approximation</span>
<a name="l00972"></a>00972     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nf; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00973"></a>00973         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> c = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+0]].v +
<a name="l00974"></a>00974               <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+1]].v +
<a name="l00975"></a>00975               <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+2]].v;
<a name="l00976"></a>00976         c /= 3.0f;
<a name="l00977"></a>00977         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) {
<a name="l00978"></a>00978             <span class="keywordtype">int</span> v = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+j];
<a name="l00979"></a>00979             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> d =(c - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[v].v) * 0.5f;
<a name="l00980"></a>00980             dflt[v] += d * (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] /
<a name="l00981"></a>00981                    <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+j]] *
<a name="l00982"></a>00982                    <a class="code" href="../../d0/dbc/namespaceKDL.html#a82c1904677c13464d30566d25edc9034">exp</a>(-0.5f * invsigma2 * <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(d)) );
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     <span class="comment">// Filter displacement field</span>
<a name="l00987"></a>00987     vector&lt;ntlVec3Gfx&gt; dflt2(nv);
<a name="l00988"></a>00988     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00989"></a>00989         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a4a19baa15024a353da34d5f56561278b" title="smoothing helper function">diffuseVertexField</a>( &amp;dflt[0], 1,
<a name="l00990"></a>00990                    <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, invsigma2, dflt2[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])) { }
<a name="l00991"></a>00991         <span class="keywordflow">else</span> { <span class="comment">/*mPoints[i].v=0.0;*/</span> dflt2[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0; }<span class="comment">//dflt2[i]; }</span>
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="comment">// Update vertex positions</span>
<a name="l00995"></a>00995     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00996"></a>00996         <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].v += dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - dflt2[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]; <span class="comment">// second Laplacian</span>
<a name="l00997"></a>00997     }
<a name="l00998"></a>00998 
<a name="l00999"></a>00999     <span class="comment">// when normals smoothing off, this cleans up quite well</span>
<a name="l01000"></a>01000     <span class="comment">// costs ca. 50% additional time though</span>
<a name="l01001"></a>01001     <span class="keywordtype">float</span> nsFac = 1.5f;
<a name="l01002"></a>01002     <span class="keywordflow">if</span>(normSmooth) { <span class="keywordtype">float</span> ninvsigma2 = 1.0f / (nsFac*nsFac*sigma*sigma);
<a name="l01003"></a>01003         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01004"></a>01004             <span class="keywordflow">if</span>( <a class="code" href="../../db/db9/classIsoSurface.html#a4a19baa15024a353da34d5f56561278b" title="smoothing helper function">diffuseVertexField</a>( &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[0].n, 2, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, ninvsigma2, dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) ) {
<a name="l01005"></a>01005                 <a class="code" href="../../d1/d22/stdosl_8h.html#a03960008c09030a58b2c79672320cb3f">normalize</a>(dflt[i]);
<a name="l01006"></a>01006             } <span class="keywordflow">else</span> {
<a name="l01007"></a>01007                 dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n;
<a name="l01008"></a>01008             }
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01011"></a>01011             <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = dflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01012"></a>01012         } 
<a name="l01013"></a>01013     } <span class="comment">// smoothNormals copy */</span>
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     <span class="comment">//errMsg(&quot;SMSURF&quot;,&quot;done v:&quot;&lt;&lt;sigma); // DEBUG</span>
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 
<a name="l01018"></a>01018 <span class="comment">// only smoothen the normals</span>
<a name="l01019"></a><a class="code" href="../../db/db9/classIsoSurface.html#a99db97b0c0769455cba7cc683afd2708">01019</a> <span class="keywordtype">void</span> <a class="code" href="../../db/db9/classIsoSurface.html#a99db97b0c0769455cba7cc683afd2708">IsoSurface::smoothNormals</a>(<span class="keywordtype">float</span> sigma) {
<a name="l01020"></a>01020     <span class="comment">// reuse from smoothSurface</span>
<a name="l01021"></a>01021     <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>.size() != <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size()) { 
<a name="l01022"></a>01022         <span class="comment">// need neighbor</span>
<a name="l01023"></a>01023         vector&lt;int&gt; numneighbors(<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size());
<a name="l01024"></a>01024         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01025"></a>01025         <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3; i++) {
<a name="l01026"></a>01026             numneighbors[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[i*3+0]]++;
<a name="l01027"></a>01027             numneighbors[mIndices[i*3+1]]++;
<a name="l01028"></a>01028             numneighbors[mIndices[i*3+2]]++;
<a name="l01029"></a>01029         }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>.clear();
<a name="l01032"></a>01032         <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>.resize(<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size());
<a name="l01033"></a>01033         <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size(); i++) {
<a name="l01034"></a>01034             <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].clear();
<a name="l01035"></a>01035             <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].reserve(numneighbors[i]+2); <span class="comment">// Slop for boundaries</span>
<a name="l01036"></a>01036         }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038         <span class="keywordflow">for</span> (i = 0; i &lt; (int)<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3; i++) {
<a name="l01039"></a>01039             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) {
<a name="l01040"></a>01040                 vector&lt;int&gt; &amp;me = <a class="code" href="../../db/db9/classIsoSurface.html#ab5913e989f06511a43c4e69459cc3727">neighbors</a>[ <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[i*3+j]];
<a name="l01041"></a>01041                 <span class="keywordtype">int</span> n1 =  mIndices[i*3+((j+1)%3)];
<a name="l01042"></a>01042                 <span class="keywordtype">int</span> n2 =  mIndices[i*3+((j+2)%3)];
<a name="l01043"></a>01043                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/dea/sp__coletree_8c.html#ae3d5811c1f73da8bff145a1dcd88ef69">std::find</a>(me.begin(), me.end(), n1) == me.end())
<a name="l01044"></a>01044                     me.push_back(n1);
<a name="l01045"></a>01045                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/dea/sp__coletree_8c.html#ae3d5811c1f73da8bff145a1dcd88ef69">std::find</a>(me.begin(), me.end(), n2) == me.end())
<a name="l01046"></a>01046                     me.push_back(n2);
<a name="l01047"></a>01047             }
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049     } <span class="comment">// need neighbor</span>
<a name="l01050"></a>01050 
<a name="l01051"></a>01051     { <span class="comment">// need pointarea</span>
<a name="l01052"></a>01052         <span class="keywordtype">int</span> nf = <a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>.size()/3, nv = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();
<a name="l01053"></a>01053         <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>.clear();
<a name="l01054"></a>01054         <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>.resize(nv);
<a name="l01055"></a>01055         <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>.clear();
<a name="l01056"></a>01056         <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>.resize(nf);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nf; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01059"></a>01059             <span class="comment">// Edges</span>
<a name="l01060"></a>01060             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> e[3] = { 
<a name="l01061"></a>01061                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+2]].v - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+1]].v,
<a name="l01062"></a>01062                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+0]].v - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+2]].v,
<a name="l01063"></a>01063                 <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+1]].v - <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+0]].v };
<a name="l01064"></a>01064 
<a name="l01065"></a>01065             <span class="comment">// Compute corner weights</span>
<a name="l01066"></a>01066             <span class="keywordtype">float</span> area = 0.5f * <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>( <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>(e[0], e[1]));
<a name="l01067"></a>01067             <span class="keywordtype">float</span> l2[3] = { <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(e[0]), <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(e[1]), <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(e[2]) };
<a name="l01068"></a>01068             <span class="keywordtype">float</span> ew[3] = { l2[0] * (l2[1] + l2[2] - l2[0]),
<a name="l01069"></a>01069                     l2[1] * (l2[2] + l2[0] - l2[1]),
<a name="l01070"></a>01070                     l2[2] * (l2[0] + l2[1] - l2[2]) };
<a name="l01071"></a>01071             <span class="keywordflow">if</span> (ew[0] &lt;= 0.0f) {
<a name="l01072"></a>01072                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] = -0.25f * l2[2] * area /
<a name="l01073"></a>01073                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[0] , e[2]);
<a name="l01074"></a>01074                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] = -0.25f * l2[1] * area /
<a name="l01075"></a>01075                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[0] , e[1]);
<a name="l01076"></a>01076                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] = area - <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] -
<a name="l01077"></a>01077                                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2];
<a name="l01078"></a>01078             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ew[1] &lt;= 0.0f) {
<a name="l01079"></a>01079                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] = -0.25f * l2[0] * area /
<a name="l01080"></a>01080                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[1] , e[0]);
<a name="l01081"></a>01081                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] = -0.25f * l2[2] * area /
<a name="l01082"></a>01082                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[1] , e[2]);
<a name="l01083"></a>01083                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] = area - <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] -
<a name="l01084"></a>01084                                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l01085"></a>01085             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ew[2] &lt;= 0.0f) {
<a name="l01086"></a>01086                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] = -0.25f * l2[1] * area /
<a name="l01087"></a>01087                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[2] , e[1]);
<a name="l01088"></a>01088                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1] = -0.25f * l2[0] * area /
<a name="l01089"></a>01089                                 <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>(e[2] , e[0]);
<a name="l01090"></a>01090                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2] = area - <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] -
<a name="l01091"></a>01091                                 <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1];
<a name="l01092"></a>01092             } <span class="keywordflow">else</span> {
<a name="l01093"></a>01093                 <span class="keywordtype">float</span> ewscale = 0.5f * area / (ew[0] + ew[1] + ew[2]);
<a name="l01094"></a>01094                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)
<a name="l01095"></a>01095                     <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = ewscale * (ew[(j+1)%3] +
<a name="l01096"></a>01096                                              ew[(j+2)%3]);
<a name="l01097"></a>01097             }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099             <span class="comment">// NT important, check this...</span>
<a name="l01100"></a>01100 <span class="preprocessor">#ifndef WIN32</span>
<a name="l01101"></a>01101 <span class="preprocessor"></span>            <span class="keywordflow">if</span>(! finite(<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0]) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][0]=1e-6;
<a name="l01102"></a>01102             <span class="keywordflow">if</span>(! finite(<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]=1e-6;
<a name="l01103"></a>01103             <span class="keywordflow">if</span>(! finite(<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]=1e-6;
<a name="l01104"></a>01104 <span class="preprocessor">#else // WIN32</span>
<a name="l01105"></a>01105 <span class="preprocessor"></span>            <span class="comment">// FIXME check as well...</span>
<a name="l01106"></a>01106             <span class="keywordflow">if</span>(! (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][0]&gt;=0.0) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][0]=1e-6;
<a name="l01107"></a>01107             <span class="keywordflow">if</span>(! (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]&gt;=0.0) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][1]=1e-6;
<a name="l01108"></a>01108             <span class="keywordflow">if</span>(! (<a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]&gt;=0.0) ) <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[i][2]=1e-6;
<a name="l01109"></a>01109 <span class="preprocessor">#endif // WIN32</span>
<a name="l01110"></a>01110 <span class="preprocessor"></span>
<a name="l01111"></a>01111             <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[<a class="code" href="../../db/db9/classIsoSurface.html#a3f88715c91111d142fadc0639917bf4b" title="vector for all the triangles (stored as 3 indices)">mIndices</a>[i*3+0]] += <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l01112"></a>01112             <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[mIndices[i*3+1]] += <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1];
<a name="l01113"></a>01113             <a class="code" href="../../db/db9/classIsoSurface.html#ae42b17c71c22fe024dd904ac77ea6d34">pointareas</a>[mIndices[i*3+2]] += <a class="code" href="../../db/db9/classIsoSurface.html#a70accb2d850bf49d4da92ecbb136447e">cornerareas</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2];
<a name="l01114"></a>01114         }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116     } <span class="comment">// need pointarea</span>
<a name="l01117"></a>01117 
<a name="l01118"></a>01118     <span class="keywordtype">int</span> nv = <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>.size();
<a name="l01119"></a>01119     <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)<a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>.size() != nv) <a class="code" href="../../db/db9/classIsoSurface.html#a7865943918c0bb32fcf13c2407740cd4" title="trimesh vars">flags</a>.resize(nv);
<a name="l01120"></a>01120     <span class="keywordtype">float</span> invsigma2 = 1.0f / (sigma*sigma);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     vector&lt;ntlVec3Gfx&gt; nflt(nv);
<a name="l01123"></a>01123     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l01124"></a>01124         <span class="keywordflow">if</span>(<a class="code" href="../../db/db9/classIsoSurface.html#a4a19baa15024a353da34d5f56561278b" title="smoothing helper function">diffuseVertexField</a>( &amp;<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[0].n, 2, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, invsigma2, nflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])) {
<a name="l01125"></a>01125             <a class="code" href="../../d1/d22/stdosl_8h.html#a03960008c09030a58b2c79672320cb3f">normalize</a>(nflt[i]);
<a name="l01126"></a>01126         } <span class="keywordflow">else</span> { nflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]=<a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n; }
<a name="l01127"></a>01127     }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129     <span class="comment">// copy results</span>
<a name="l01130"></a>01130     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nv; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <a class="code" href="../../db/db9/classIsoSurface.html#a01d2240485ed81163a8bb7021e6b6ce6" title="Store all the triangles vertices.">mPoints</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].n = nflt[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]; }
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:26 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

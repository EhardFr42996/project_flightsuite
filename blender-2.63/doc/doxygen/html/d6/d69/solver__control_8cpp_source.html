<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: solver_control.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">solver_control.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d6/d69/solver__control_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - the visual lattice boltzmann freesurface simulator</span>
<a name="l00007"></a>00007 <span class="comment"> * All code distributed as part of El&#39;Beem is covered by the version 2 of the </span>
<a name="l00008"></a>00008 <span class="comment"> * GNU General Public License. See the file COPYING for details.  </span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * Copyright 2003-2008 Nils Thuerey </span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * control extensions</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d24/solver__class_8h.html">solver_class.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d75/solver__relax_8h.html">solver_relax.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d69/particletracer_8h.html">particletracer.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d7f/solver__control_8h.html">solver_control.h</a>&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d7c/controlparticles_8h.html">controlparticles.h</a>&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d00/elbeem_8h.html">elbeem.h</a>&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d16/ntl__geometrymodel_8h.html">ntl_geometrymodel.h</a>&quot;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">/******************************************************************************</span>
<a name="l00028"></a>00028 <span class="comment"> * LbmControlData control set</span>
<a name="l00029"></a>00029 <span class="comment"> *****************************************************************************/</span>
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="../../d5/de4/classLbmControlSet.html#ac77f7e4f775804183dc94a52b7b95f8a">00031</a> <a class="code" href="../../d5/de4/classLbmControlSet.html#ac77f7e4f775804183dc94a52b7b95f8a">LbmControlSet::LbmControlSet</a>() :
<a name="l00032"></a>00032     mCparts(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), mCpmotion(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), mContrPartFile(<span class="stringliteral">&quot;&quot;</span>), mCpmotionFile(<span class="stringliteral">&quot;&quot;</span>),
<a name="l00033"></a>00033     mcForceAtt(0.), mcForceVel(0.), mcForceMaxd(0.), 
<a name="l00034"></a>00034     mcRadiusAtt(0.), mcRadiusVel(0.), mcRadiusMind(0.), mcRadiusMaxd(0.), 
<a name="l00035"></a>00035     mcCpScale(1.), mcCpOffset(0.)
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037 }
<a name="l00038"></a><a class="code" href="../../d5/de4/classLbmControlSet.html#ad73cb012cd8849448400489fb9d332b0">00038</a> <a class="code" href="../../d5/de4/classLbmControlSet.html#ad73cb012cd8849448400489fb9d332b0">LbmControlSet::~LbmControlSet</a>() {
<a name="l00039"></a>00039     <span class="keywordflow">if</span>(<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>) <span class="keyword">delete</span> <a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>;
<a name="l00040"></a>00040     <span class="keywordflow">if</span>(<a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>) <span class="keyword">delete</span> <a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>;
<a name="l00041"></a>00041 }
<a name="l00042"></a><a class="code" href="../../d5/de4/classLbmControlSet.html#a77effd7a73a0683d04b8e4a318ddf7f7">00042</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/de4/classLbmControlSet.html#a77effd7a73a0683d04b8e4a318ddf7f7">LbmControlSet::initCparts</a>() {
<a name="l00043"></a>00043     <a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a> = <span class="keyword">new</span> <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a>();
<a name="l00044"></a>00044     <a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a> = <span class="keyword">new</span> <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a>();
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">/******************************************************************************</span>
<a name="l00050"></a>00050 <span class="comment"> * LbmControlData control</span>
<a name="l00051"></a>00051 <span class="comment"> *****************************************************************************/</span>
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="../../d3/de0/classLbmControlData.html#ae6afdfdc1b279a53ff0191dd7ba4cd72">00053</a> <a class="code" href="../../d3/de0/classLbmControlData.html#ae6afdfdc1b279a53ff0191dd7ba4cd72">LbmControlData::LbmControlData</a>() : 
<a name="l00054"></a>00054     mSetForceStrength(0.),
<a name="l00055"></a>00055     mCons(), 
<a name="l00056"></a>00056     mCpUpdateInterval(8), <span class="comment">// DG: was 16 --&gt; causes problems (big sphere after some time), unstable</span>
<a name="l00057"></a>00057     mCpOutfile(<span class="stringliteral">&quot;&quot;</span>), 
<a name="l00058"></a>00058     mCpForces(), mCpKernel(), mMdKernel(),
<a name="l00059"></a>00059     mDiffVelCon(1.),
<a name="l00060"></a>00060     mDebugCpscale(0.), 
<a name="l00061"></a>00061     mDebugVelScale(0.), 
<a name="l00062"></a>00062     mDebugCompavScale(0.), 
<a name="l00063"></a>00063     mDebugAttScale(0.), 
<a name="l00064"></a>00064     mDebugMaxdScale(0.),
<a name="l00065"></a>00065     mDebugAvgVelScale(0.)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="../../d3/de0/classLbmControlData.html#a27e8a57972906e61bf91350ab436c5bd">00069</a> <a class="code" href="../../d3/de0/classLbmControlData.html#a27e8a57972906e61bf91350ab436c5bd">LbmControlData::~LbmControlData</a>() 
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <span class="keywordflow">while</span> (!<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.empty()) {
<a name="l00072"></a>00072         <span class="keyword">delete</span> <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.back();  <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.pop_back();
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="../../d3/de0/classLbmControlData.html#a97756b3496baf57a65e7de699096b862">00077</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/de0/classLbmControlData.html#a97756b3496baf57a65e7de699096b862">LbmControlData::parseControldataAttrList</a>(<a class="code" href="../../d3/d8d/classAttributeList.html" title="The list of configuration attributes.">AttributeList</a> *attr) {
<a name="l00078"></a>00078     <span class="comment">// controlpart vars</span>
<a name="l00079"></a>00079     <a class="code" href="../../d3/de0/classLbmControlData.html#af2adf2dad45adc7cb0dd3aa8f59c8801">mSetForceStrength</a> = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;tforcestrength&quot;</span>, <a class="code" href="../../d3/de0/classLbmControlData.html#af2adf2dad45adc7cb0dd3aa8f59c8801">mSetForceStrength</a>,<span class="stringliteral">&quot;LbmControlData&quot;</span>, <span class="stringliteral">&quot;mSetForceStrength&quot;</span>, <span class="keyword">false</span>);
<a name="l00080"></a>00080     <span class="comment">//errMsg(&quot;tforcestrength set to &quot;,&quot; &quot;&lt;&lt;mSetForceStrength);</span>
<a name="l00081"></a>00081     <a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a> = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;controlparticle_updateinterval&quot;</span>, <a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a>,<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mCpUpdateInterval&quot;</span>, <span class="keyword">false</span>);
<a name="l00082"></a>00082     <span class="comment">// tracer output file</span>
<a name="l00083"></a>00083     <a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a> = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;controlparticle_outfile&quot;</span>,<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>,<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mCpOutfile&quot;</span>, <span class="keyword">false</span>);
<a name="l00084"></a>00084     <span class="keywordflow">if</span>(getenv(<span class="stringliteral">&quot;ELBEEM_CPOUTFILE&quot;</span>)) {
<a name="l00085"></a>00085         <span class="keywordtype">string</span> outfile(getenv(<span class="stringliteral">&quot;ELBEEM_CPOUTFILE&quot;</span>));
<a name="l00086"></a>00086         <a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a> = outfile;
<a name="l00087"></a>00087         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmControlData::parseAttrList&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>,<span class="stringliteral">&quot;Using envvar ELBEEM_CPOUTFILE to set mCpOutfile to &quot;</span>&lt;&lt;outfile&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>,7);
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpii=0; cpii&lt;10; cpii++) {
<a name="l00091"></a>00091         <span class="keywordtype">string</span> suffix(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00092"></a>00092         <span class="comment">//if(cpii&gt;0)</span>
<a name="l00093"></a>00093         {  suffix = string(<span class="stringliteral">&quot;0&quot;</span>); suffix[0]+=cpii; }
<a name="l00094"></a>00094         <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a> *cset;
<a name="l00095"></a>00095         cset = <span class="keyword">new</span> <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a>();
<a name="l00096"></a>00096         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a77effd7a73a0683d04b8e4a318ddf7f7">initCparts</a>();
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a> = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_file&quot;</span>,cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a>,<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cset-&gt;mContrPartFile&quot;</span>, <span class="keyword">false</span>);
<a name="l00099"></a>00099         <span class="keywordflow">if</span>((cpii==0) &amp;&amp; (getenv(<span class="stringliteral">&quot;ELBEEM_CPINFILE&quot;</span>)) ) {
<a name="l00100"></a>00100             <span class="keywordtype">string</span> infile(getenv(<span class="stringliteral">&quot;ELBEEM_CPINFILE&quot;</span>));
<a name="l00101"></a>00101             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a> = infile;
<a name="l00102"></a>00102             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmControlData::parseAttrList&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>,<span class="stringliteral">&quot;Using envvar ELBEEM_CPINFILE to set mContrPartFile to &quot;</span>&lt;&lt;infile&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a>,7);
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpvort=0.;
<a name="l00106"></a>00106         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a741d2a84ca3277c5db124b36b9d1d5bb">mcRadiusAtt</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_radiusatt&quot;</span>, 0., <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcRadiusAtt&quot;</span> );
<a name="l00107"></a>00107         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#adce4e5234fac6f197f5de40e6a11e609">mcRadiusVel</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_radiusvel&quot;</span>, 0., <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcRadiusVel&quot;</span> );
<a name="l00108"></a>00108         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#adce4e5234fac6f197f5de40e6a11e609">mcRadiusVel</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_radiusvel&quot;</span>, 0., <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcRadiusVel&quot;</span> );
<a name="l00109"></a>00109         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a002964f845d0556f49c6b1d5685b20d0">setRadiusAtt</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a741d2a84ca3277c5db124b36b9d1d5bb">mcRadiusAtt</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.));
<a name="l00110"></a>00110         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a5c2fba55a1cc88e9d8923887003e516a">setRadiusVel</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#adce4e5234fac6f197f5de40e6a11e609">mcRadiusVel</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.));
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <span class="comment">// WARNING currently only for first set</span>
<a name="l00113"></a>00113         <span class="comment">//if(cpii==0) {</span>
<a name="l00114"></a>00114         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a71ba5e52e50a4afa4a3f9e8626c222f4">mcForceAtt</a>  =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_attraction&quot;</span>, 0. , <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cset-&gt;mcForceAtt&quot;</span>, <span class="keyword">false</span>);
<a name="l00115"></a>00115         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a2be04b3343543fd810bb809fa131fb62">mcForceVel</a>  =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_velocity&quot;</span>,   0. , <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcForceVel&quot;</span>, <span class="keyword">false</span>);
<a name="l00116"></a>00116         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a87f907ffea689c967c5d442a3deacff2">mcForceMaxd</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_maxdist&quot;</span>,    0. , <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcForceMaxd&quot;</span>, <span class="keyword">false</span>);
<a name="l00117"></a>00117         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a68b785213815af3d4689d2a9253d75d2">setInfluenceAttraction</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a71ba5e52e50a4afa4a3f9e8626c222f4">mcForceAtt</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.) );
<a name="l00118"></a>00118         <span class="comment">// warning - stores temprorarily, value converted to dt dep. factor</span>
<a name="l00119"></a>00119         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2e039ab48abdc6205ec2a2b3dae0e42b">setInfluenceVelocity</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a2be04b3343543fd810bb809fa131fb62">mcForceVel</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.) , 0.01 ); <span class="comment">// dummy dt</span>
<a name="l00120"></a>00120         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a3d520190f4ddb9808d0c3a15262f9b13">setInfluenceMaxdist</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a87f907ffea689c967c5d442a3deacff2">mcForceMaxd</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.) );
<a name="l00121"></a>00121         cpvort =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_vorticity&quot;</span>,   cpvort, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpvort&quot;</span>, <span class="keyword">false</span>);
<a name="l00122"></a>00122         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a05f4b096f56d56914e31e14322e56fef">setInfluenceTangential</a>(cpvort);
<a name="l00123"></a>00123             
<a name="l00124"></a>00124         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a6bedd6ca5a33fc2a04a7c7c358cfb09b">mcRadiusMind</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_radiusmin&quot;</span>, cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a6bedd6ca5a33fc2a04a7c7c358cfb09b">mcRadiusMind</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.), <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcRadiusMind&quot;</span>, <span class="keyword">false</span>);
<a name="l00125"></a>00125         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#ab6515fde447fdadd64d2a1deffb64fe6">mcRadiusMaxd</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a43ccf22c0978bcb755ec0e83cb317c6c">readChannelSinglePrecFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_radiusmax&quot;</span>, cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a6bedd6ca5a33fc2a04a7c7c358cfb09b">mcRadiusMind</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.), <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcRadiusMaxd&quot;</span>, <span class="keyword">false</span>);
<a name="l00126"></a>00126         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2174ecfaab852a97d5eb492593474af8">setRadiusMinMaxd</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a6bedd6ca5a33fc2a04a7c7c358cfb09b">mcRadiusMind</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.));
<a name="l00127"></a>00127         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a54c641eae66e1bada6b6dc6fad1ad981">setRadiusMaxd</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#ab6515fde447fdadd64d2a1deffb64fe6">mcRadiusMaxd</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.));
<a name="l00128"></a>00128         <span class="comment">//}</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="comment">// now local...</span>
<a name="l00131"></a>00131         <span class="comment">//LbmVec cpOffset(0.), cpScale(1.);</span>
<a name="l00132"></a>00132         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpTimescale = 1.;
<a name="l00133"></a>00133         <span class="keywordtype">string</span> cpMirroring(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="comment">//cset-&gt;mcCpOffset = attr-&gt;readChannelVec3f(&quot;controlparticle&quot;+suffix+&quot;_offset&quot;, ntlVec3f(0.),&quot;LbmControlData&quot;,&quot;mcCpOffset&quot;, false);</span>
<a name="l00136"></a>00136         <span class="comment">//cset-&gt;mcCpScale =  attr-&gt;readChannelVec3f(&quot;controlparticle&quot;+suffix+&quot;_scale&quot;,  ntlVec3f(1.), &quot;LbmControlData&quot;,&quot;mcCpScale&quot;, false);</span>
<a name="l00137"></a>00137         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a107bca1b2e0a7d9d2f9668e1e64b62e0">mcCpOffset</a> = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a1f38f6f13698586bb512aee119e771bf">readChannelVec3f</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_offset&quot;</span>, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ad861347c8c1dd3251ff46f64dd468d18">ntlVec3f</a>(0.),<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcCpOffset&quot;</span>, <span class="keyword">false</span>);
<a name="l00138"></a>00138         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a1bcac253b047919356272bb9d2e2f606">mcCpScale</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a1f38f6f13698586bb512aee119e771bf">readChannelVec3f</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_scale&quot;</span>,  <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#ad861347c8c1dd3251ff46f64dd468d18">ntlVec3f</a>(1.), <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcCpScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00139"></a>00139         cpTimescale =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_timescale&quot;</span>,  cpTimescale, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpTimescale&quot;</span>, <span class="keyword">false</span>);
<a name="l00140"></a>00140         cpMirroring =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_mirror&quot;</span>,  cpMirroring, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpMirroring&quot;</span>, <span class="keyword">false</span>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpsWidth = cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#ab189c883ae5cee0997ecea8d612d3d77">getCPSWith</a>();
<a name="l00143"></a>00143         cpsWidth =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_cpswidth&quot;</span>,  cpsWidth, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpsWidth&quot;</span>, <span class="keyword">false</span>);
<a name="l00144"></a>00144         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpsDt = cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a05d8ee9b4289c7ad0ee3488def79586c">getCPSTimestep</a>();
<a name="l00145"></a>00145         cpsDt =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_cpstimestep&quot;</span>,  cpsDt, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpsDt&quot;</span>, <span class="keyword">false</span>);
<a name="l00146"></a>00146         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpsTstart = cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2237ebd768a773a329a1eba17b9c9af6">getCPSTimeStart</a>();
<a name="l00147"></a>00147         cpsTstart =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_cpststart&quot;</span>,  cpsTstart, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpsTstart&quot;</span>, <span class="keyword">false</span>);
<a name="l00148"></a>00148         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpsTend = cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#aa6d14e8f4e94f8a0127cf37182800af5">getCPSTimeEnd</a>();
<a name="l00149"></a>00149         cpsTend =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_cpstend&quot;</span>,  cpsTend, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpsTend&quot;</span>, <span class="keyword">false</span>);
<a name="l00150"></a>00150         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> cpsMvmfac = cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a51417bd397777ec9712442be751745f5">getCPSMvmWeightFac</a>();
<a name="l00151"></a>00151         cpsMvmfac =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_cpsmvmfac&quot;</span>,  cpsMvmfac, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpsMvmfac&quot;</span>, <span class="keyword">false</span>);
<a name="l00152"></a>00152         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#aa024357f273e65c0f9fa3ecd728d8b7c">setCPSWith</a>(cpsWidth);
<a name="l00153"></a>00153         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#afad9ca288761a559380cd691fb1f609e">setCPSTimestep</a>(cpsDt);
<a name="l00154"></a>00154         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6c0c4670dc2a30bcc73c163de88b59a2">setCPSTimeStart</a>(cpsTstart);
<a name="l00155"></a>00155         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#ab496885bd5555bf612c0322c3c78e70b">setCPSTimeEnd</a>(cpsTend);
<a name="l00156"></a>00156         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#acfc5fb60d751034ccaf9f82c710ddf0c">setCPSMvmWeightFac</a>(cpsMvmfac);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#af4e606b0f0b28dadd60c513b774d7777">setOffset</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a107bca1b2e0a7d9d2f9668e1e64b62e0">mcCpOffset</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.)) );
<a name="l00159"></a>00159         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a375ae16744665b69f5883ffbed794fee">setScale</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a1bcac253b047919356272bb9d2e2f606">mcCpScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(0.)) );
<a name="l00160"></a>00160         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a31be55a945999c474ac046166e0db074">setInitTimeScale</a>( cpTimescale );
<a name="l00161"></a>00161         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a3f0b2c2447d581d06d241d229f6e1679">setInitMirror</a>( cpMirroring );
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="keywordtype">int</span> mDebugInit = 0;
<a name="l00164"></a>00164         mDebugInit = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#ae95fe48278d28112a7b0fac13139f315">readInt</a>(<span class="stringliteral">&quot;controlparticle&quot;</span>+suffix+<span class="stringliteral">&quot;_debuginit&quot;</span>, mDebugInit,<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugInit&quot;</span>, <span class="keyword">false</span>);
<a name="l00165"></a>00165         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#af4be025e13fab8d8f0c9262aa1521049">setDebugInit</a>(mDebugInit);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <span class="comment">// motion particle settings</span>
<a name="l00168"></a>00168         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> mcpOffset(0.), mcpScale(1.);
<a name="l00169"></a>00169         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> mcpTimescale = 1.;
<a name="l00170"></a>00170         <span class="keywordtype">string</span> mcpMirroring(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a192e8c3aaacdf1df05b9674b37f5f5b4">mCpmotionFile</a> = attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;cpmotion&quot;</span>+suffix+<span class="stringliteral">&quot;_file&quot;</span>,cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a192e8c3aaacdf1df05b9674b37f5f5b4">mCpmotionFile</a>,<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mCpmotionFile&quot;</span>, <span class="keyword">false</span>);
<a name="l00173"></a>00173         mcpTimescale =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpmotion&quot;</span>+suffix+<span class="stringliteral">&quot;_timescale&quot;</span>,  mcpTimescale, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcpTimescale&quot;</span>, <span class="keyword">false</span>);
<a name="l00174"></a>00174         mcpMirroring =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;cpmotion&quot;</span>+suffix+<span class="stringliteral">&quot;_mirror&quot;</span>,  mcpMirroring, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mcpMirroring&quot;</span>, <span class="keyword">false</span>);
<a name="l00175"></a>00175         mcpOffset = <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>( attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9b49e7f48d12234d2ae59e9e430b1861">readVec3d</a>(<span class="stringliteral">&quot;cpmotion&quot;</span>+suffix+<span class="stringliteral">&quot;_offset&quot;</span>, <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3354c71d4798004f2f6962993794ee76">vec2P</a>(mcpOffset),<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpOffset&quot;</span>, <span class="keyword">false</span>) );
<a name="l00176"></a>00176         mcpScale =  <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>( attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9b49e7f48d12234d2ae59e9e430b1861">readVec3d</a>(<span class="stringliteral">&quot;cpmotion&quot;</span>+suffix+<span class="stringliteral">&quot;_scale&quot;</span>,  <a class="code" href="../../d2/d3c/solver__interface_8h.html#a3354c71d4798004f2f6962993794ee76">vec2P</a>(mcpScale), <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;cpScale&quot;</span>, <span class="keyword">false</span>) );
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#af4e606b0f0b28dadd60c513b774d7777">setOffset</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(mcpOffset) );
<a name="l00179"></a>00179         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a375ae16744665b69f5883ffbed794fee">setScale</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(mcpScale) );
<a name="l00180"></a>00180         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a31be55a945999c474ac046166e0db074">setInitTimeScale</a>( mcpTimescale );
<a name="l00181"></a>00181         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a3f0b2c2447d581d06d241d229f6e1679">setInitMirror</a>( mcpMirroring );
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="keywordflow">if</span>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a>.length()&gt;1) {
<a name="l00184"></a>00184             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;Using control particle set &quot;</span>&lt;&lt;cpii&lt;&lt;<span class="stringliteral">&quot; file:&quot;</span>&lt;&lt;cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a>&lt;&lt;<span class="stringliteral">&quot; cpmfile:&quot;</span>&lt;&lt;cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a192e8c3aaacdf1df05b9674b37f5f5b4">mCpmotionFile</a>&lt;&lt;<span class="stringliteral">&quot; mirr:&#39;&quot;</span>&lt;&lt;cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4d067320f4c5edfb6410556abe50cee0">mCpmotion</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a9dce584d4ddd432d8fa0ed27287b31fb">getInitMirror</a>()&lt;&lt;<span class="stringliteral">&quot;&#39; &quot;</span> );
<a name="l00185"></a>00185             <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.push_back( cset );
<a name="l00186"></a>00186         } <span class="keywordflow">else</span> {
<a name="l00187"></a>00187             <span class="keyword">delete</span> cset;
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment">// debug, testing - make sure theres at least an empty set</span>
<a name="l00192"></a>00192     <span class="keywordflow">if</span>(<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size()&lt;1) {
<a name="l00193"></a>00193         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.push_back( <span class="keyword">new</span> <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a>() );
<a name="l00194"></a>00194         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;initCparts();
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">// take from first set</span>
<a name="l00198"></a>00198     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpii=1; cpii&lt;(int)<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpii++) {
<a name="l00199"></a>00199         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpii]-&gt;mCparts-&gt;setRadiusMinMaxd( <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getRadiusMinMaxd() );
<a name="l00200"></a>00200         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpii]-&gt;mCparts-&gt;setRadiusMaxd(    <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getRadiusMaxd() );
<a name="l00201"></a>00201         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpii]-&gt;mCparts-&gt;setInfluenceAttraction( <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceAttraction() );
<a name="l00202"></a>00202         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpii]-&gt;mCparts-&gt;setInfluenceTangential( <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceTangential() );
<a name="l00203"></a>00203         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpii]-&gt;mCparts-&gt;setInfluenceVelocity( <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceVelocity() , 0.01 ); <span class="comment">// dummy dt</span>
<a name="l00204"></a>00204         <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpii]-&gt;mCparts-&gt;setInfluenceMaxdist( <a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceMaxdist() );
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="comment">// invert for usage in relax macro</span>
<a name="l00208"></a>00208     <a class="code" href="../../d3/de0/classLbmControlData.html#aeb715d484348145c5c0b8524aac38982">mDiffVelCon</a> =  1.-attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdiffvelcon&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#aeb715d484348145c5c0b8524aac38982">mDiffVelCon</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDiffVelCon&quot;</span>, <span class="keyword">false</span>);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a>     =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdebug_cpscale&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugCpscale&quot;</span>, <span class="keyword">false</span>);
<a name="l00211"></a>00211     <a class="code" href="../../d3/de0/classLbmControlData.html#a46a003c30c613e476cae9e57103090e6">mDebugMaxdScale</a>   =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdebug_maxdscale&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#a46a003c30c613e476cae9e57103090e6">mDebugMaxdScale</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugMaxdScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00212"></a>00212     <a class="code" href="../../d3/de0/classLbmControlData.html#a40021b4667f034af47f5ea980a612711">mDebugAttScale</a>    =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdebug_attscale&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#a40021b4667f034af47f5ea980a612711">mDebugAttScale</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugAttScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00213"></a>00213     <a class="code" href="../../d3/de0/classLbmControlData.html#afd94679948a0f636968f6759f6c91967">mDebugVelScale</a>    =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdebug_velscale&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#afd94679948a0f636968f6759f6c91967">mDebugVelScale</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugVelScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00214"></a>00214     <a class="code" href="../../d3/de0/classLbmControlData.html#ae3c38ab0d8e08c367f33579f108963cc">mDebugCompavScale</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdebug_compavscale&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#ae3c38ab0d8e08c367f33579f108963cc">mDebugCompavScale</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugCompavScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00215"></a>00215     <a class="code" href="../../d3/de0/classLbmControlData.html#a6d5217f404b79561ecdf48bab6717910">mDebugAvgVelScale</a> =  attr-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;cpdebug_avgvelsc&quot;</span>,  <a class="code" href="../../d3/de0/classLbmControlData.html#a6d5217f404b79561ecdf48bab6717910">mDebugAvgVelScale</a>, <span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;mDebugAvgVelScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="keywordtype">void</span> 
<a name="l00220"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a650a4f49f4f2c97e6f5202d86717c991">00220</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a650a4f49f4f2c97e6f5202d86717c991">LbmFsgrSolver::initCpdata</a>()
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <span class="comment">// enable for cps via env. vars</span>
<a name="l00223"></a>00223     <span class="comment">//if( (getenv(&quot;ELBEEM_CPINFILE&quot;)) || (getenv(&quot;ELBEEM_CPOUTFILE&quot;)) ){ mUseTestdata=1; }</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     
<a name="l00226"></a>00226     <span class="comment">// manually switch on! if this is zero, nothing is done...</span>
<a name="l00227"></a>00227     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#af2adf2dad45adc7cb0dd3aa8f59c8801">mSetForceStrength</a> = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a25e41bf0a6b6a6292fb0717daa225a64" title="test vars">mTForceStrength</a> = 1.;
<a name="l00228"></a>00228     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.clear();
<a name="l00229"></a>00229     
<a name="l00230"></a>00230     <span class="comment">// init all control fluid objects</span>
<a name="l00231"></a>00231     <span class="keywordtype">int</span> numobjs = (int)(<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>-&gt;size());
<a name="l00232"></a>00232     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> o=0; o&lt;numobjs; o++) {
<a name="l00233"></a>00233         <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html">ntlGeometryObjModel</a> *obj = (<a class="code" href="../../d7/d4d/classntlGeometryObjModel.html">ntlGeometryObjModel</a> *)(*<a class="code" href="../../db/dff/classLbmSolverInterface.html#aedb7b81115f4f4c8d0ff1a8043650401">mpGiObjects</a>)[o];
<a name="l00234"></a>00234         <span class="keywordflow">if</span>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a28d811d0865d2582b04c070e21caa363">getGeoInitType</a>() &amp; <a class="code" href="../../d8/d00/elbeem_8h.html#a521787d995d4318d27481c812333ed1d">FGI_CONTROL</a>) {
<a name="l00235"></a>00235             <span class="comment">// add new control set per object</span>
<a name="l00236"></a>00236             <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a> *cset;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238             cset = <span class="keyword">new</span> <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a>();
<a name="l00239"></a>00239             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a77effd7a73a0683d04b8e4a318ddf7f7">initCparts</a>();
<a name="l00240"></a>00240     
<a name="l00241"></a>00241             <span class="comment">// dont load any file</span>
<a name="l00242"></a>00242             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a> = string(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a71ba5e52e50a4afa4a3f9e8626c222f4">mcForceAtt</a> = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a2d5e81f0314fa00a1cbf2c457af66ef1">getCpsAttrFStr</a>();
<a name="l00245"></a>00245             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a741d2a84ca3277c5db124b36b9d1d5bb">mcRadiusAtt</a> = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a57ccccaa6963b841aaf8a62049605501">getCpsAttrFRad</a>();
<a name="l00246"></a>00246             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a2be04b3343543fd810bb809fa131fb62">mcForceVel</a> = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#aed4f7daebcca225ffb6502dc7567fd7a">getCpsVelFStr</a>();
<a name="l00247"></a>00247             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#adce4e5234fac6f197f5de40e6a11e609">mcRadiusVel</a> = obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a21913c92977327cd46b07e0a8656c9af">getCpsVelFRad</a>();
<a name="l00248"></a>00248 
<a name="l00249"></a>00249             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6c0c4670dc2a30bcc73c163de88b59a2">setCPSTimeStart</a>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab0ea5a557be41d166cac6f7871db01c9">getCpsTimeStart</a>());
<a name="l00250"></a>00250             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#ab496885bd5555bf612c0322c3c78e70b">setCPSTimeEnd</a>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a3573c51ab690d45553e359359c6f55a3">getCpsTimeEnd</a>());
<a name="l00251"></a>00251             
<a name="l00252"></a>00252             <span class="keywordflow">if</span>(obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a498b1da6ad54b09f111a9b31bece1060">getCpsQuality</a>() &gt; <a class="code" href="../../d2/d3c/solver__interface_8h.html#a0a6ff24e88963689483e35acbb53ca28">LBM_EPSILON</a>)
<a name="l00253"></a>00253                 cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#aa024357f273e65c0f9fa3ecd728d8b7c">setCPSWith</a>(1.0 / obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a498b1da6ad54b09f111a9b31bece1060">getCpsQuality</a>());
<a name="l00254"></a>00254             
<a name="l00255"></a>00255             <span class="comment">// this value can be left at 0.5:</span>
<a name="l00256"></a>00256             cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#acfc5fb60d751034ccaf9f82c710ddf0c">setCPSMvmWeightFac</a>(0.5);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.push_back( cset );
<a name="l00259"></a>00259             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size()-1]-&gt;mCparts-&gt;initFromObject(obj);
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     
<a name="l00263"></a>00263     <span class="comment">// NT blender integration manual test setup</span>
<a name="l00264"></a>00264     <span class="keywordflow">if</span>(0) {
<a name="l00265"></a>00265         <span class="comment">// manually switch on! if this is zero, nothing is done...</span>
<a name="l00266"></a>00266         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#af2adf2dad45adc7cb0dd3aa8f59c8801">mSetForceStrength</a> = this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a25e41bf0a6b6a6292fb0717daa225a64" title="test vars">mTForceStrength</a> = 1.;
<a name="l00267"></a>00267         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.clear();
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="comment">// add new set</span>
<a name="l00270"></a>00270         <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a> *cset;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         cset = <span class="keyword">new</span> <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a>();
<a name="l00273"></a>00273         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a77effd7a73a0683d04b8e4a318ddf7f7">initCparts</a>();
<a name="l00274"></a>00274         <span class="comment">// dont load any file</span>
<a name="l00275"></a>00275         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a4c6a16a58b4691b73c7bd5e34802a44d">mContrPartFile</a> = string(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">// set radii for attraction &amp; velocity forces</span>
<a name="l00278"></a>00278         <span class="comment">// set strength of the forces</span>
<a name="l00279"></a>00279         <span class="comment">// don&#39;t set directly! but use channels: </span>
<a name="l00280"></a>00280         <span class="comment">// mcForceAtt, mcForceVel, mcForceMaxd, mcRadiusAtt, mcRadiusVel, mcRadiusMind, mcRadiusMaxd etc.</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <span class="comment">// wrong: cset-&gt;mCparts-&gt;setInfluenceAttraction(1.15); cset-&gt;mCparts-&gt;setRadiusAtt(1.5);</span>
<a name="l00283"></a>00283         <span class="comment">// right, e.g., to init some constant values:</span>
<a name="l00284"></a>00284         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a71ba5e52e50a4afa4a3f9e8626c222f4">mcForceAtt</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;float&gt;</a>(0.2);
<a name="l00285"></a>00285         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a741d2a84ca3277c5db124b36b9d1d5bb">mcRadiusAtt</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;float&gt;</a>(0.75);
<a name="l00286"></a>00286         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a2be04b3343543fd810bb809fa131fb62">mcForceVel</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;float&gt;</a>(0.2);
<a name="l00287"></a>00287         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#adce4e5234fac6f197f5de40e6a11e609">mcRadiusVel</a> = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;float&gt;</a>(0.75);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="comment">// this value can be left at 0.5:</span>
<a name="l00290"></a>00290         cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a5daac8d42234180abb8653897e352521">mCparts</a>-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#acfc5fb60d751034ccaf9f82c710ddf0c">setCPSMvmWeightFac</a>(0.5);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.push_back( cset );
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">// instead of reading from file (cset-&gt;mContrPartFile), manually init some particles</span>
<a name="l00295"></a>00295         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;initBlenderTest();
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="comment">// other values that might be interesting to change:</span>
<a name="l00298"></a>00298         <span class="comment">//cset-&gt;mCparts-&gt;setCPSTimestep(0.02);</span>
<a name="l00299"></a>00299         <span class="comment">//cset-&gt;mCparts-&gt;setCPSTimeStart(0.);</span>
<a name="l00300"></a>00300         <span class="comment">//cset-&gt;mCparts-&gt;setCPSTimeEnd(1.); </span>
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="comment">//mpControl-&gt;mDiffVelCon = 1.; // more rigid velocity control, 0 (default) allows more turbulence</span>
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="comment">// control particle -------------------------------------------------------------------------------------</span>
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="comment">// init cppf stage, use set 0!</span>
<a name="l00308"></a>00308     <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>&gt;0) {
<a name="l00309"></a>00309         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>.length()&lt;1) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a> = <span class="keywordtype">string</span>(<span class="stringliteral">&quot;cpout&quot;</span>); <span class="comment">// use getOutFilename !?</span>
<a name="l00310"></a>00310         <span class="keywordtype">char</span> strbuf[100];
<a name="l00311"></a>00311         <span class="keyword">const</span> <span class="keywordtype">char</span> *cpFormat = <span class="stringliteral">&quot;_d%dcppf%d&quot;</span>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="comment">// initial coarse stage, no input</span>
<a name="l00314"></a>00314         <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>==1) {
<a name="l00315"></a>00315             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mContrPartFile = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00316"></a>00316         } <span class="keywordflow">else</span> {
<a name="l00317"></a>00317             <span class="comment">// read from prev stage</span>
<a name="l00318"></a>00318             <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(strbuf,100, cpFormat  ,<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>,<a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>-1);
<a name="l00319"></a>00319             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mContrPartFile = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>;
<a name="l00320"></a>00320             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mContrPartFile += strbuf;
<a name="l00321"></a>00321             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mContrPartFile += <span class="stringliteral">&quot;.cpart2&quot;</span>;
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(strbuf,100, cpFormat  ,<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>,<a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>);
<a name="l00325"></a>00325         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a> += strbuf;
<a name="l00326"></a>00326     } <span class="comment">// */</span>
<a name="l00327"></a>00327     
<a name="l00328"></a>00328     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=0; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00329"></a>00329         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cparts = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts;
<a name="l00330"></a>00330         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cpmotion = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCpmotion;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="comment">// now set with real dt</span>
<a name="l00333"></a>00333         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2e039ab48abdc6205ec2a2b3dae0e42b">setInfluenceVelocity</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mcForceVel.get(0.), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>);
<a name="l00334"></a>00334         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6aefdc33f1d5531afc4031af1d008cd7">setCharLength</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].nodeSize );
<a name="l00335"></a>00335         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6aefdc33f1d5531afc4031af1d008cd7">setCharLength</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>].nodeSize );
<a name="l00336"></a>00336         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmControlData&quot;</span>,<span class="stringliteral">&quot;CppfStage &quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#afc090f2b486fac6ebb398ec9c81593da">mCppfStage</a>&lt;&lt;<span class="stringliteral">&quot; in:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mContrPartFile&lt;&lt;
<a name="l00337"></a>00337                 <span class="stringliteral">&quot; out:&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>&lt;&lt;<span class="stringliteral">&quot; cl:&quot;</span>&lt;&lt; cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#afc467755d18deac88c0332df083a70e0">getCharLength</a>() );
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="comment">// control particle test init</span>
<a name="l00340"></a>00340         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCpmotionFile.length()&gt;=1) cpmotion-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a0b8592d94ca47de60ebc634472b3acba">initFromTextFile</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCpmotionFile);
<a name="l00341"></a>00341         <span class="comment">// not really necessary...</span>
<a name="l00342"></a>00342         <span class="comment">//? cparts-&gt;setFluidSpacing( mLevel[mMaxRefine].nodeSize    ); // use grid coords!?</span>
<a name="l00343"></a>00343         <span class="comment">//? cparts-&gt;calculateKernelWeight();</span>
<a name="l00344"></a>00344         <span class="comment">//? debMsgStd(&quot;LbmFsgrSolver::initCpdata&quot;,DM_MSG,&quot;ControlParticles - motion inited: &quot;&lt;&lt;cparts-&gt;getSize() ,10);</span>
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <span class="comment">// ensure both are on for env. var settings</span>
<a name="l00347"></a>00347         <span class="comment">// when no particles, but outfile enabled, initialize</span>
<a name="l00348"></a>00348         <span class="keyword">const</span> <span class="keywordtype">int</span> lev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00349"></a>00349         <span class="keywordflow">if</span>((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>) &amp;&amp; (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>.length()&gt;=1) &amp;&amp; (cpssi==0)) {
<a name="l00350"></a>00350             <span class="comment">// check if auto num</span>
<a name="l00351"></a>00351             <span class="keywordflow">if</span>( (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a0bbe2e396af282a41950c72ce262d293">getNumInitialParticles</a>()&lt;=1) &amp;&amp; 
<a name="l00352"></a>00352                     (<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a8f69f240778943a3dfb30f4720ed98fb" title="get the number of particles">getNumParticles</a>()&lt;=1) ) { <span class="comment">// initParticles done afterwards anyway</span>
<a name="l00353"></a>00353                 <span class="keywordtype">int</span> tracers = 0;
<a name="l00354"></a>00354                 <span class="keyword">const</span> <span class="keywordtype">int</span> workSet = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l00355"></a>00355                 <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) { 
<a name="l00356"></a>00356                     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>)) tracers++;
<a name="l00357"></a>00357                 }
<a name="l00358"></a>00358                 <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==3) tracers /= 8;
<a name="l00359"></a>00359                 <span class="keywordflow">else</span>          tracers /= 4;
<a name="l00360"></a>00360                 <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a02d01eb90975254e7f3c10bcf20b6b47" title="set/get the number of particles">setNumInitialParticles</a>(tracers);
<a name="l00361"></a>00361                 <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a5e43fe0b1a122e26b06cd0f013a66e21">setDumpTextFile</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>);
<a name="l00362"></a>00362                 <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initCpdata&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;ControlParticles - set tracers #&quot;</span>&lt;&lt;tracers&lt;&lt;<span class="stringliteral">&quot;, actual #&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a8f69f240778943a3dfb30f4720ed98fb" title="get the number of particles">getNumParticles</a>() ,10);
<a name="l00363"></a>00363             }
<a name="l00364"></a>00364             <span class="keywordflow">if</span>(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#afd638eecde932815ab55ee0df2de031c">getDumpTextInterval</a>()&lt;=0.) {
<a name="l00365"></a>00365                 <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a1de935f852a7cd4b052d9b5e4544d874">setDumpTextInterval</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].timestep * <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex);
<a name="l00366"></a>00366                 <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initCpdata&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;ControlParticles - dump delta t not set, using dti=&quot;</span>&lt;&lt; <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#afd638eecde932815ab55ee0df2de031c">getDumpTextInterval</a>()&lt;&lt;<span class="stringliteral">&quot;, sim dt=&quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>, 5 );
<a name="l00367"></a>00367             }
<a name="l00368"></a>00368             <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#abbf5109536217e3d5656f7119aff0c55">setDumpParts</a>(<span class="keyword">true</span>); <span class="comment">// DEBUG? also dump as particle system</span>
<a name="l00369"></a>00369         }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mContrPartFile.length()&gt;=1) cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a0b8592d94ca47de60ebc634472b3acba">initFromTextFile</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mContrPartFile);
<a name="l00372"></a>00372         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#aa83353fe014aa1065eee5432c00fd148">setFluidSpacing</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].nodeSize   ); <span class="comment">// use grid coords!?</span>
<a name="l00373"></a>00373         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6110880d0c548d650da564f0f0ad0c65">calculateKernelWeight</a>();
<a name="l00374"></a>00374         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initCpdata&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;ControlParticles mCons&quot;</span>&lt;&lt;cpssi&lt;&lt;<span class="stringliteral">&quot; - inited, parts:&quot;</span>&lt;&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7115a709ff61f5fc4d745dbbd5c4c7b0">getTotalSize</a>()&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a849bffbb32b8334479f1b69e203cc070">getSize</a>()&lt;&lt;<span class="stringliteral">&quot; dt:&quot;</span>&lt;&lt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>()&lt;&lt;<span class="stringliteral">&quot; control time:&quot;</span>&lt;&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a22a87e40938a4d80958245892b87be96">getControlTimStart</a>()&lt;&lt;<span class="stringliteral">&quot; to &quot;</span>&lt;&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a35578ba2f98f53de3cacfb8a0efd6a1c">getControlTimEnd</a>() ,10);
<a name="l00375"></a>00375     } <span class="comment">// cpssi</span>
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="keywordflow">if</span>(getenv(<span class="stringliteral">&quot;ELBEEM_CPINFILE&quot;</span>)) {
<a name="l00378"></a>00378         this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a25e41bf0a6b6a6292fb0717daa225a64" title="test vars">mTForceStrength</a> = 1.0;
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a25e41bf0a6b6a6292fb0717daa225a64" title="test vars">mTForceStrength</a> = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#af2adf2dad45adc7cb0dd3aa8f59c8801">mSetForceStrength</a>;
<a name="l00381"></a>00381     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>.length()&gt;=1) <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5bbaae326effab891ecad2f6f9bf4b0d" title="store particle tracer">mpParticles</a>-&gt;<a class="code" href="../../de/db7/classParticleTracer.html#a5e43fe0b1a122e26b06cd0f013a66e21">setDumpTextFile</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a76d22482309dbfa0262923381d33ff06">mCpOutfile</a>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="comment">// control particle  init end -------------------------------------------------------------------------------------</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">// make sure equiv to solver init</span>
<a name="l00386"></a>00386     <span class="keywordflow">if</span>(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a25e41bf0a6b6a6292fb0717daa225a64" title="test vars">mTForceStrength</a>&gt;0.) { \
<a name="l00387"></a>00387         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a8ce49bb4dc21d91d486ba4688d5564e0">mCpForces</a>.resize( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>+1 );
<a name="l00388"></a>00388         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev = 0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l00389"></a>00389             <a class="code" href="../../d2/d3c/solver__interface_8h.html#a41a6a848ac1750ea79579492320f45b6">LONGINT</a> rcellSize = (<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>*<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>);
<a name="l00390"></a>00390             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;mCpForces init, lev=&quot;</span>&lt;&lt;lev&lt;&lt;<span class="stringliteral">&quot; rcs:&quot;</span>&lt;&lt;(<span class="keywordtype">int</span>)(rcellSize+4)&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;(rcellSize*<span class="keyword">sizeof</span>(<a class="code" href="../../d3/df3/classControlForces.html">ControlForces</a>)/(1024*1024)), 9 );
<a name="l00391"></a>00391             <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a8ce49bb4dc21d91d486ba4688d5564e0">mCpForces</a>[lev].resize( (<span class="keywordtype">int</span>)(rcellSize+4) );
<a name="l00392"></a>00392             <span class="comment">//for(int i=0 ;i&lt;rcellSize; i++) mpControl-&gt;mCpForces.push_back( ControlForces() );</span>
<a name="l00393"></a>00393             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0 ;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;rcellSize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a8ce49bb4dc21d91d486ba4688d5564e0">mCpForces</a>[lev][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].resetForces();
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395     } <span class="comment">// on?</span>
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::initCpdata&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;ControlParticles #mCons &quot;</span>&lt;&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size()&lt;&lt;<span class="stringliteral">&quot; done&quot;</span>, 6);
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="../../d6/d69/solver__control_8cpp.html#ac96a064946848d65b3ad3c7257a75c81">00401</a> <span class="preprocessor">#define CPODEBUG 0</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span><span class="comment">//define CPINTER ((int)(mpControl-&gt;mCpUpdateInterval))</span>
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">00404</a> <span class="preprocessor">#define KERN(x,y,z)    mpControl-&gt;mCpKernel[ (((z)*cpkarWidth + (y))*cpkarWidth + (x)) ]</span>
<a name="l00405"></a><a class="code" href="../../d6/d69/solver__control_8cpp.html#aa14b1f389e5694fafe5bff02ebcdfaf6">00405</a> <span class="preprocessor"></span><span class="preprocessor">#define MDKERN(x,y,z)  mpControl-&gt;mMdKernel[ (((z)*mdkarWidth + (y))*mdkarWidth + (x)) ]</span>
<a name="l00406"></a>00406 <span class="preprocessor"></span>
<a name="l00407"></a><a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">00407</a> <span class="preprocessor">#define BOUNDCHECK(x,low,high)  ( ((x)&lt;low) ? low : (((x)&gt;high) ? high : (x) )  )</span>
<a name="l00408"></a><a class="code" href="../../d6/d69/solver__control_8cpp.html#afc187b8c6745db0ab3e537fbfe132fe4">00408</a> <span class="preprocessor"></span><span class="preprocessor">#define BOUNDSKIP(x,low,high)  ( ((x)&lt;low) || ((x)&gt;high) )</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>
<a name="l00410"></a>00410 <span class="keywordtype">void</span> 
<a name="l00411"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#afed938e8ab5789319d9136f00bf754de">00411</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#afed938e8ab5789319d9136f00bf754de">LbmFsgrSolver::handleCpdata</a>()
<a name="l00412"></a>00412 {
<a name="l00413"></a>00413     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> cpstart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l00414"></a>00414     <span class="keywordtype">int</span> cpChecks=0;
<a name="l00415"></a>00415     <span class="keywordtype">int</span> cpInfs=0;
<a name="l00416"></a>00416     <span class="comment">//debMsgStd(&quot;ControlData::handleCpdata&quot;,DM_MSG,&quot;called... &quot;&lt;&lt;this-&gt;mTForceStrength,1);</span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="comment">// add cp influence</span>
<a name="l00419"></a>00419   <span class="keywordflow">if</span>((<span class="keyword">true</span>) &amp;&amp; (this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#a25e41bf0a6b6a6292fb0717daa225a64" title="test vars">mTForceStrength</a>&gt;0.)) {
<a name="l00420"></a>00420         <span class="comment">// ok continue...</span>
<a name="l00421"></a>00421     } <span class="comment">// on off</span>
<a name="l00422"></a>00422     <span class="keywordflow">else</span> {
<a name="l00423"></a>00423         <span class="keywordflow">return</span>;
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425     
<a name="l00426"></a>00426     <span class="comment">// check if we have control objects</span>
<a name="l00427"></a>00427     <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size()==0)
<a name="l00428"></a>00428         <span class="keywordflow">return</span>;
<a name="l00429"></a>00429     
<a name="l00430"></a>00430     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a>&lt;1) || (this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#ae22fd479f492ac4bcc02d0a510ab21dd">mStepCnt</a>%<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a>==0)) {
<a name="l00431"></a>00431         <span class="comment">// do full reinit later on... </span>
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(this-&gt;<a class="code" href="../../db/dff/classLbmSolverInterface.html#ae22fd479f492ac4bcc02d0a510ab21dd">mStepCnt</a>&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a>) {
<a name="l00434"></a>00434         <span class="comment">// only reinit new cells</span>
<a name="l00435"></a>00435         <span class="comment">// TODO !? remove loop dependance!?</span>
<a name="l00436"></a>00436 <span class="preprocessor">#define NOFORCEENTRY(lev, i,j,k) (LBMGET_FORCE(lev, i,j,k).maxDistance==CPF_MAXDINIT) </span>
<a name="l00437"></a>00437 <span class="preprocessor"></span>        <span class="comment">// interpolate missing</span>
<a name="l00438"></a>00438         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l00439"></a>00439         <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) { 
<a name="l00440"></a>00440             <span class="keywordflow">if</span>( (<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr)) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) )  
<a name="l00441"></a>00441             <span class="comment">//if( (RFLAG(lev,i,j,k, mLevel[lev].setCurr)) &amp; (CFInter) )  </span>
<a name="l00442"></a>00442             <span class="comment">//if(0)</span>
<a name="l00443"></a>00443             { <span class="comment">// only check new inter? RFLAG?check</span>
<a name="l00444"></a>00444                 <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#a0ce8998ef55523b608fa00b80eda533e">NOFORCEENTRY</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k)) {
<a name="l00445"></a>00445                     <span class="comment">//errMsg(&quot;CP&quot;,&quot;FE_MISSING at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; f&quot;&lt;&lt;LBMGET_FORCE(lev, i,j,k).weightAtt&lt;&lt;&quot; md&quot;&lt;&lt;LBMGET_FORCE(lev, i,j,k).maxDistance );</span>
<a name="l00446"></a>00446 
<a name="l00447"></a>00447                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nbs=0.;
<a name="l00448"></a>00448                     <a class="code" href="../../d3/df3/classControlForces.html">ControlForces</a> vals;
<a name="l00449"></a>00449                     vals.<a class="code" href="../../d3/df3/classControlForces.html#ad5206fcde364a7f7867bf3c8db6e1f3e">resetForces</a>(); vals.<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a> = 0.;
<a name="l00450"></a>00450                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=1; l&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad318550ee64256981c6300907035b054" title="direction vector contain vecs for all spatial dirs, even if not used for LBM model">cDirNum</a>; l++) { 
<a name="l00451"></a>00451                         <span class="keywordtype">int</span> ni=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ab12c3dc91f1cd691160ee3951e1ae902">dfVecX</a>[l], nj=j+this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7453528e7789d405e13cfb60551aa868">dfVecY</a>[l], nk=k+this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a530c88f9f44a5002ab6aa7ca4a81849f">dfVecZ</a>[l];
<a name="l00452"></a>00452                         <span class="comment">//errMsg(&quot;CP&quot;,&quot;FE_MISSING check &quot;&lt;&lt;PRINT_VEC(ni,nj,nk)&lt;&lt;&quot; f&quot;&lt;&lt;LBMGET_FORCE(lev, ni,nj,nk).weightAtt&lt;&lt;&quot; md&quot;&lt;&lt;LBMGET_FORCE(lev, ni,nj,nk).maxDistance );</span>
<a name="l00453"></a>00453                         <span class="keywordflow">if</span>(!<a class="code" href="../../d6/d69/solver__control_8cpp.html#a0ce8998ef55523b608fa00b80eda533e">NOFORCEENTRY</a>(lev, ni,nj,nk)) {
<a name="l00454"></a>00454                             <span class="comment">//? vals.weightAtt   += LBMGET_FORCE(lev, ni,nj,nk).weightAtt;</span>
<a name="l00455"></a>00455                             <span class="comment">//? vals.forceAtt    += LBMGET_FORCE(lev, ni,nj,nk).forceAtt;</span>
<a name="l00456"></a>00456                             vals.<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a> += <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, ni,nj,nk).maxDistance;
<a name="l00457"></a>00457                             vals.<a class="code" href="../../d3/df3/classControlForces.html#a2bf1d96d688618842b04fe7c86d1fb44">forceMaxd</a>   += <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, ni,nj,nk).forceMaxd;
<a name="l00458"></a>00458                             vals.<a class="code" href="../../d3/df3/classControlForces.html#a2006ed18b01eb20c4b3f1520c12cb990">weightVel</a>   += <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, ni,nj,nk).weightVel;
<a name="l00459"></a>00459                             vals.<a class="code" href="../../d3/df3/classControlForces.html#a1a71744ca441e3d8d1e0583e116abce1">forceVel</a>    += <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, ni,nj,nk).forceVel; 
<a name="l00460"></a>00460                             <span class="comment">// ignore att/compAv/avgVel here for now</span>
<a name="l00461"></a>00461                             nbs += 1.;
<a name="l00462"></a>00462                         }
<a name="l00463"></a>00463                     }
<a name="l00464"></a>00464                     <span class="keywordflow">if</span>(nbs&gt;0.) {
<a name="l00465"></a>00465                         nbs = 1./nbs;
<a name="l00466"></a>00466                         <span class="comment">//? LBMGET_FORCE(lev, i,j,k).weightAtt   =  vals.weightAtt*nbs;</span>
<a name="l00467"></a>00467                         <span class="comment">//? LBMGET_FORCE(lev, i,j,k).forceAtt    = vals.forceAtt*nbs;</span>
<a name="l00468"></a>00468                         <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).maxDistance = vals.<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a>*nbs;
<a name="l00469"></a>00469                         <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceMaxd   =  vals.<a class="code" href="../../d3/df3/classControlForces.html#a2bf1d96d688618842b04fe7c86d1fb44">forceMaxd</a>*nbs;
<a name="l00470"></a>00470                         <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).weightVel   =  vals.<a class="code" href="../../d3/df3/classControlForces.html#a2006ed18b01eb20c4b3f1520c12cb990">weightVel</a>*nbs;
<a name="l00471"></a>00471                         <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceVel    = vals.<a class="code" href="../../d3/df3/classControlForces.html#a1a71744ca441e3d8d1e0583e116abce1">forceVel</a>*nbs;
<a name="l00472"></a>00472                     }
<a name="l00473"></a>00473                         <span class="comment">/*ControlForces *ff = &amp;LBMGET_FORCE(lev, i,j,k);  // DEBUG</span>
<a name="l00474"></a>00474 <span class="comment">                        errMsg(&quot;CP&quot;,&quot;FE_MISSING rec at &quot;&lt;&lt;PRINT_IJK // DEBUG</span>
<a name="l00475"></a>00475 <span class="comment">                                &lt;&lt;&quot; w:&quot;&lt;&lt;ff-&gt;weightAtt&lt;&lt;&quot; wa:&quot; &lt;&lt;PRINT_VEC( ff-&gt;forceAtt[0],ff-&gt;forceAtt[1],ff-&gt;forceAtt[2] )  </span>
<a name="l00476"></a>00476 <span class="comment">                                &lt;&lt;&quot; v:&quot;&lt;&lt;ff-&gt;weightVel&lt;&lt;&quot; wv:&quot; &lt;&lt;PRINT_VEC( ff-&gt;forceVel[0],ff-&gt;forceVel[1],ff-&gt;forceVel[2] )  </span>
<a name="l00477"></a>00477 <span class="comment">                                &lt;&lt;&quot; v:&quot;&lt;&lt;ff-&gt;maxDistance&lt;&lt;&quot; wv:&quot; &lt;&lt;PRINT_VEC( ff-&gt;forceMaxd[0],ff-&gt;forceMaxd[1],ff-&gt;forceMaxd[2] )  ); // DEBUG */</span>
<a name="l00478"></a>00478                     <span class="comment">// else errMsg(&quot;CP&quot;,&quot;FE_MISSING rec at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; failed!&quot;); // DEBUG</span>
<a name="l00479"></a>00479                     
<a name="l00480"></a>00480                 }
<a name="l00481"></a>00481             }
<a name="l00482"></a>00482         }} <span class="comment">// ijk, lev</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <span class="comment">// mStepCnt &gt; mpControl-&gt;mCpUpdateInterval</span>
<a name="l00485"></a>00485         <span class="keywordflow">return</span>;
<a name="l00486"></a>00486     } <span class="keywordflow">else</span> {
<a name="l00487"></a>00487         <span class="comment">// nothing to do ...</span>
<a name="l00488"></a>00488         <span class="keywordflow">return</span>;
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">// reset</span>
<a name="l00492"></a>00492     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l00493"></a>00493         <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) { <a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).resetForces(); }
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495     <span class="comment">// do setup for coarsest level</span>
<a name="l00496"></a>00496     <span class="keyword">const</span> <span class="keywordtype">int</span> coarseLev = 0;
<a name="l00497"></a>00497     <span class="keyword">const</span> <span class="keywordtype">int</span> fineLev = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="comment">// init for current time</span>
<a name="l00500"></a>00500     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=0; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00501"></a>00501         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cparts = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts;
<a name="l00502"></a>00502         <a class="code" href="../../d5/de4/classLbmControlSet.html">LbmControlSet</a> *cset = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi];
<a name="l00503"></a>00503         
<a name="l00504"></a>00504         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a002964f845d0556f49c6b1d5685b20d0">setRadiusAtt</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a741d2a84ca3277c5db124b36b9d1d5bb">mcRadiusAtt</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>));
<a name="l00505"></a>00505         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a5c2fba55a1cc88e9d8923887003e516a">setRadiusVel</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#adce4e5234fac6f197f5de40e6a11e609">mcRadiusVel</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>));
<a name="l00506"></a>00506         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a68b785213815af3d4689d2a9253d75d2">setInfluenceAttraction</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a71ba5e52e50a4afa4a3f9e8626c222f4">mcForceAtt</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) );
<a name="l00507"></a>00507         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a3d520190f4ddb9808d0c3a15262f9b13">setInfluenceMaxdist</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a87f907ffea689c967c5d442a3deacff2">mcForceMaxd</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) );
<a name="l00508"></a>00508         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2174ecfaab852a97d5eb492593474af8">setRadiusMinMaxd</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a6bedd6ca5a33fc2a04a7c7c358cfb09b">mcRadiusMind</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>));
<a name="l00509"></a>00509         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a54c641eae66e1bada6b6dc6fad1ad981">setRadiusMaxd</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#ab6515fde447fdadd64d2a1deffb64fe6">mcRadiusMaxd</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>));
<a name="l00510"></a>00510         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6110880d0c548d650da564f0f0ad0c65">calculateKernelWeight</a>(); <span class="comment">// always necessary!?</span>
<a name="l00511"></a>00511         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#af4e606b0f0b28dadd60c513b774d7777">setOffset</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a107bca1b2e0a7d9d2f9668e1e64b62e0">mcCpOffset</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>)) );
<a name="l00512"></a>00512         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a375ae16744665b69f5883ffbed794fee">setScale</a>(  <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a1bcac253b047919356272bb9d2e2f606">mcCpScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>)) );
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2e039ab48abdc6205ec2a2b3dae0e42b">setInfluenceVelocity</a>( cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a2be04b3343543fd810bb809fa131fb62">mcForceVel</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[fineLev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a> );
<a name="l00515"></a>00515         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a93d161f6f5b2370e60a5051f9e7459f8">setLastOffset</a>( <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a107bca1b2e0a7d9d2f9668e1e64b62e0">mcCpOffset</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>-<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[fineLev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>)) );
<a name="l00516"></a>00516         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a4a4686e707df68722d6fbaae81bb8956">setLastScale</a>(  <a class="code" href="../../d2/d3c/solver__interface_8h.html#af54079b72428ed222b2063d35bb5a88d">vec2L</a>(cset-&gt;<a class="code" href="../../d5/de4/classLbmControlSet.html#a1bcac253b047919356272bb9d2e2f606">mcCpScale</a>.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>-<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[fineLev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>)) );
<a name="l00517"></a>00517         
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">// check actual values</span>
<a name="l00521"></a>00521     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> iatt  = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceAttraction());
<a name="l00522"></a>00522     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> ivel  = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceVelocity();
<a name="l00523"></a>00523     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> imaxd = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;getInfluenceMaxdist();
<a name="l00524"></a>00524     <span class="comment">//errMsg(&quot;FINCIT&quot;,&quot;iatt=&quot;&lt;&lt;iatt&lt;&lt;&quot; ivel=&quot;&lt;&lt;ivel&lt;&lt;&quot; imaxd=&quot;&lt;&lt;imaxd);</span>
<a name="l00525"></a>00525     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=1; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00526"></a>00526         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> iatt2  = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts-&gt;getInfluenceAttraction());
<a name="l00527"></a>00527         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> ivel2  = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts-&gt;getInfluenceVelocity();
<a name="l00528"></a>00528         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> imaxd2 = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts-&gt;getInfluenceMaxdist();
<a name="l00529"></a>00529         
<a name="l00530"></a>00530         <span class="comment">// we allow negative attraction force here!</span>
<a name="l00531"></a>00531         <span class="keywordflow">if</span>(iatt2 &gt; iatt)   iatt = iatt2;
<a name="l00532"></a>00532         
<a name="l00533"></a>00533         <span class="keywordflow">if</span>(ivel2 &gt;ivel)   ivel = ivel2;
<a name="l00534"></a>00534         <span class="keywordflow">if</span>(imaxd2&gt;imaxd)  imaxd= imaxd2;
<a name="l00535"></a>00535         <span class="comment">//errMsg(&quot;FINCIT&quot;,&quot; &quot;&lt;&lt;cpssi&lt;&lt;&quot; iatt2=&quot;&lt;&lt;iatt2&lt;&lt;&quot; ivel2=&quot;&lt;&lt;ivel2&lt;&lt;&quot; imaxd2=&quot;&lt;&lt;imaxd&lt;&lt;&quot; NEW &quot;&lt;&lt;&quot; iatt=&quot;&lt;&lt;iatt&lt;&lt;&quot; ivel=&quot;&lt;&lt;ivel&lt;&lt;&quot; imaxd=&quot;&lt;&lt;imaxd);</span>
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span>(iatt==0. &amp;&amp; ivel==0. &amp;&amp; imaxd==0.) {
<a name="l00539"></a>00539         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Skipped, all zero...&quot;</span>,4);
<a name="l00540"></a>00540         <span class="keywordflow">return</span>;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542     <span class="comment">//iatt  = mpControl-&gt;mCons[1]-&gt;mCparts-&gt;getInfluenceAttraction(); //ivel  = mpControl-&gt;mCons[1]-&gt;mCparts-&gt;getInfluenceVelocity(); //imaxd = mpControl-&gt;mCons[1]-&gt;mCparts-&gt;getInfluenceMaxdist(); // TTTTTT</span>
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="comment">// do control setup</span>
<a name="l00545"></a>00545     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=0; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00546"></a>00546         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cparts = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts;
<a name="l00547"></a>00547         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cpmotion = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCpmotion;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549         <span class="comment">// TEST!?</span>
<a name="l00550"></a>00550         <span class="keywordtype">bool</span> radmod = <span class="keyword">false</span>;
<a name="l00551"></a>00551         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> minRadSize = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[coarseLev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a> * 1.5;
<a name="l00552"></a>00552         <span class="keywordflow">if</span>((cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>()&gt;0.) &amp;&amp; (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>()&lt;minRadSize) &amp;&amp; (!radmod) ) {
<a name="l00553"></a>00553             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> radfac = minRadSize / cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>(); radmod=<span class="keyword">true</span>;
<a name="l00554"></a>00554             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Modified radii att, fac=&quot;</span>&lt;&lt;radfac, 7);
<a name="l00555"></a>00555             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a002964f845d0556f49c6b1d5685b20d0">setRadiusAtt</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>()*radfac);
<a name="l00556"></a>00556             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a5c2fba55a1cc88e9d8923887003e516a">setRadiusVel</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7b24e08bdd4befed47a07ec05bd3fbc2">getRadiusVel</a>()*radfac);
<a name="l00557"></a>00557             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a54c641eae66e1bada6b6dc6fad1ad981">setRadiusMaxd</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>()*radfac);
<a name="l00558"></a>00558             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2174ecfaab852a97d5eb492593474af8">setRadiusMinMaxd</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a9c299becaae5715f214381d1a9494d9a">getRadiusMinMaxd</a>()*radfac);
<a name="l00559"></a>00559         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7b24e08bdd4befed47a07ec05bd3fbc2">getRadiusVel</a>()&gt;0.) &amp;&amp; (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7b24e08bdd4befed47a07ec05bd3fbc2">getRadiusVel</a>()&lt;minRadSize) &amp;&amp; (!radmod) ) {
<a name="l00560"></a>00560             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> radfac = minRadSize / cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7b24e08bdd4befed47a07ec05bd3fbc2">getRadiusVel</a>();
<a name="l00561"></a>00561             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Modified radii vel, fac=&quot;</span>&lt;&lt;radfac, 7);
<a name="l00562"></a>00562             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a5c2fba55a1cc88e9d8923887003e516a">setRadiusVel</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7b24e08bdd4befed47a07ec05bd3fbc2">getRadiusVel</a>()*radfac);
<a name="l00563"></a>00563             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a54c641eae66e1bada6b6dc6fad1ad981">setRadiusMaxd</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>()*radfac);
<a name="l00564"></a>00564             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2174ecfaab852a97d5eb492593474af8">setRadiusMinMaxd</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a9c299becaae5715f214381d1a9494d9a">getRadiusMinMaxd</a>()*radfac);
<a name="l00565"></a>00565         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>()&gt;0.) &amp;&amp; (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>()&lt;minRadSize) &amp;&amp; (!radmod) ) {
<a name="l00566"></a>00566             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> radfac = minRadSize / cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>();
<a name="l00567"></a>00567             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Modified radii maxd, fac=&quot;</span>&lt;&lt;radfac, 7);
<a name="l00568"></a>00568             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a54c641eae66e1bada6b6dc6fad1ad981">setRadiusMaxd</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>()*radfac);
<a name="l00569"></a>00569             cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a2174ecfaab852a97d5eb492593474af8">setRadiusMinMaxd</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a9c299becaae5715f214381d1a9494d9a">getRadiusMinMaxd</a>()*radfac);
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571         <span class="keywordflow">if</span>(radmod) {
<a name="l00572"></a>00572             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Modified radii: att=&quot;</span>&lt;&lt; 
<a name="l00573"></a>00573                 cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>()&lt;&lt;<span class="stringliteral">&quot;, vel=&quot;</span> &lt;&lt; cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a7b24e08bdd4befed47a07ec05bd3fbc2">getRadiusVel</a>()&lt;&lt;<span class="stringliteral">&quot;, maxd=&quot;</span> &lt;&lt;
<a name="l00574"></a>00574                 cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>()&lt;&lt;<span class="stringliteral">&quot;, mind=&quot;</span> &lt;&lt; cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a9c299becaae5715f214381d1a9494d9a">getRadiusMinMaxd</a>() ,5);
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         cpmotion-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#ad4a0c61611419b1e33ee124acdb93127">prepareControl</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>+((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a>)*(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>()), <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>(), <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l00578"></a>00578         cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#ad4a0c61611419b1e33ee124acdb93127">prepareControl</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>+((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6f9ebdbfa9ff71b825f330dcbe11de72">mCpUpdateInterval</a>)*(<a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>()), <a class="code" href="../../db/dff/classLbmSolverInterface.html#a7408e004d2084b9f025365f0fcd038dd">mpParam</a>-&gt;<a class="code" href="../../d1/d7f/classParametrizer.html#ad6481f27613af196314d262f662a5c61">getTimestep</a>(), cpmotion );
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="comment">// do control...</span>
<a name="l00582"></a>00582     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l00583"></a>00583         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> levVolume = 1.;
<a name="l00584"></a>00584         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> levForceScale = 1.;
<a name="l00585"></a>00585         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ll=lev; ll&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; ll++) {
<a name="l00586"></a>00586             <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==3) levVolume *= 8.;
<a name="l00587"></a>00587             <span class="keywordflow">else</span> levVolume *= 4.;
<a name="l00588"></a>00588             levForceScale *= 2.;
<a name="l00589"></a>00589         }
<a name="l00590"></a>00590         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;LbmFsgrSolver::handleCpdata&quot;</span>,<span class="stringliteral">&quot;levVolume=&quot;</span>&lt;&lt;levVolume&lt;&lt;<span class="stringliteral">&quot; levForceScale=&quot;</span>&lt;&lt;levForceScale );
<a name="l00591"></a>00591     <span class="comment">//todo: scale velocity, att by level timestep!?</span>
<a name="l00592"></a>00592         
<a name="l00593"></a>00593     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=0; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00594"></a>00594         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cparts = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts;
<a name="l00595"></a>00595         <span class="comment">// ControlParticles *cpmotion = mpControl-&gt;mCons[cpssi]-&gt;mCpmotion;</span>
<a name="l00596"></a>00596         
<a name="l00597"></a>00597         <span class="comment">// if control set is not active skip it</span>
<a name="l00598"></a>00598         <span class="keywordflow">if</span>((cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a22a87e40938a4d80958245892b87be96">getControlTimStart</a>() &gt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a50412f936b85efad4ad14b135fd78847" title="total simulation time so far">mSimulationTime</a>) || (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a35578ba2f98f53de3cacfb8a0efd6a1c">getControlTimEnd</a>() &lt; <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa257ddf3865c461af52dcdd20f8ff955">mLastSimTime</a>))
<a name="l00599"></a>00599         {
<a name="l00600"></a>00600             <span class="keywordflow">continue</span>;
<a name="l00601"></a>00601         }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> velLatticeScale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>;
<a name="l00604"></a>00604         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gsx = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[0]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>);
<a name="l00605"></a>00605         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gsy = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[1]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>);
<a name="l00606"></a>00606         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gsz = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[2]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>);
<a name="l00607"></a>00607 <span class="preprocessor">#if LBMDIM==2</span>
<a name="l00608"></a>00608 <span class="preprocessor"></span>        gsz = gsx;
<a name="l00609"></a>00609 <span class="preprocessor">#endif</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>        <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> goffx = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0];
<a name="l00611"></a>00611         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> goffy = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1];
<a name="l00612"></a>00612         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> goffz = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2];
<a name="l00613"></a>00613 
<a name="l00614"></a>00614         <span class="comment">//const LbmFloat cpwIncFac = 2.0;</span>
<a name="l00615"></a>00615         <span class="comment">// max to two thirds of domain size</span>
<a name="l00616"></a>00616         <span class="keyword">const</span> <span class="keywordtype">int</span> cpw = <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#a74e75242132eaabbc1c512488a135926">MIN</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex/3, <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>( (<span class="keywordtype">int</span>)( cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>()  /gsx) +1  , 2) ); <span class="comment">// normal kernel, att,vel</span>
<a name="l00617"></a>00617         <span class="keyword">const</span> <span class="keywordtype">int</span> cpkarWidth = 2*cpw+1;
<a name="l00618"></a>00618         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a33b8f6be50103733da3e91be9c031d20">mCpKernel</a>.resize(cpkarWidth* cpkarWidth* cpkarWidth);
<a name="l00619"></a>00619         <a class="code" href="../../d2/d62/classControlParticle.html">ControlParticle</a> cpt; cpt.<a class="code" href="../../d2/d62/classControlParticle.html#af05bdac2f3d6fa3b7e58832fdb3d78e0">reset</a>();
<a name="l00620"></a>00620         cpt.<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a> = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>( (gsx*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)cpw)+goffx, (gsy*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)cpw)+goffy, (gsz*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)cpw)+goffz );  <span class="comment">// optimize?</span>
<a name="l00621"></a>00621         cpt.<a class="code" href="../../d2/d62/classControlParticle.html#aabc7306df21c2e02e3b5803523d75918">density</a> = 0.5; cpt.<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a> = 0.5;
<a name="l00622"></a>00622 <span class="preprocessor">#if LBMDIM==3</span>
<a name="l00623"></a>00623 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= 0; k&lt;cpkarWidth; ++k) {
<a name="l00624"></a>00624 <span class="preprocessor">#else // LBMDIM==3</span>
<a name="l00625"></a>00625 <span class="preprocessor"></span>        { <span class="keywordtype">int</span> k = cpw;
<a name="l00626"></a>00626 <span class="preprocessor">#endif </span>
<a name="l00627"></a>00627 <span class="preprocessor"></span>            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j= 0; j&lt;cpkarWidth; ++j) 
<a name="l00628"></a>00628                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;cpkarWidth; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00629"></a>00629                     <a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).resetForces();
<a name="l00630"></a>00630                     <span class="comment">//LbmFloat dx = i-cpw; LbmFloat dy = j-cpw; LbmFloat dz = k-cpw;</span>
<a name="l00631"></a>00631                     <span class="comment">//LbmVec dv = ( LbmVec(dx,dy,dz) );</span>
<a name="l00632"></a>00632                     <span class="comment">//LbmFloat dl = norm( dv ); //LbmVec dir = dv / dl;</span>
<a name="l00633"></a>00633                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> pos = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>( (gsx*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)+goffx, (gsy*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)j)+goffy, (gsz*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)k)+goffz );  <span class="comment">// optimize?</span>
<a name="l00634"></a>00634                     cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6bb5529b73db1b4e6703cbe1a095c2a4">calculateCpInfluenceOpt</a>( &amp;cpt, pos, <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(0,0,0), &amp;<a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>(i,j,k)  ,1. );
<a name="l00635"></a>00635                     <span class="comment">/*if((CPODEBUG)&amp;&amp;(k==cpw)) errMsg(&quot;kern&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; pos&quot;&lt;&lt;pos&lt;&lt;&quot; cpp&quot;&lt;&lt;cpt.pos </span>
<a name="l00636"></a>00636 <span class="comment">                        &lt;&lt;&quot; wf:&quot;&lt;&lt;KERN(i,j,k).weightAtt&lt;&lt;&quot; wa:&quot;&lt;&lt; PRINT_VEC( KERN(i,j,k).forceAtt[0],KERN(i,j,k).forceAtt[1],KERN(i,j,k).forceAtt[2] )  </span>
<a name="l00637"></a>00637 <span class="comment">                        &lt;&lt;&quot; wf:&quot;&lt;&lt;KERN(i,j,k).weightVel&lt;&lt;&quot; wa:&quot;&lt;&lt; PRINT_VEC( KERN(i,j,k).forceVel[0],KERN(i,j,k).forceVel[1],KERN(i,j,k).forceVel[2] )  </span>
<a name="l00638"></a>00638 <span class="comment">                        &lt;&lt;&quot; wf:&quot;&lt;&lt;KERN(i,j,k).maxDistance&lt;&lt;&quot; wa:&quot;&lt;&lt; PRINT_VEC( KERN(i,j,k).forceMaxd[0],KERN(i,j,k).forceMaxd[1],KERN(i,j,k).forceMaxd[2] )  ); // */</span>
<a name="l00639"></a>00639                     <a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>(i,j,k).weightAtt *= 2.;
<a name="l00640"></a>00640                     <a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>(i,j,k).forceAtt *= 2.;
<a name="l00641"></a>00641                     <span class="comment">//KERN(i,j,k).forceAtt[1] *= 2.; KERN(i,j,k).forceAtt[2] *= 2.;</span>
<a name="l00642"></a>00642                     <a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>(i,j,k).weightVel *= 2.;
<a name="l00643"></a>00643                     <a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>(i,j,k).forceVel *= 2.;
<a name="l00644"></a>00644                     <span class="comment">//KERN(i,j,k).forceVel[1] *= 2.; KERN(i,j,k).forceVel[2] *= 2.;</span>
<a name="l00645"></a>00645                 }
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#ac96a064946848d65b3ad3c7257a75c81">CPODEBUG</a>) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;cpw&quot;</span>,<span class="stringliteral">&quot; = &quot;</span>&lt;&lt;cpw&lt;&lt;<span class="stringliteral">&quot; f&quot;</span>&lt;&lt; cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>()&lt;&lt;<span class="stringliteral">&quot; gsx&quot;</span>&lt;&lt;gsx&lt;&lt;<span class="stringliteral">&quot; kpw&quot;</span>&lt;&lt;cpkarWidth); <span class="comment">// DEBUG</span>
<a name="l00649"></a>00649         <span class="comment">// first cp loop - add att and vel forces</span>
<a name="l00650"></a>00650         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cppi=0; cppi&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a849bffbb32b8334479f1b69e203cc070">getSize</a>(); cppi++) {
<a name="l00651"></a>00651             <a class="code" href="../../d2/d62/classControlParticle.html">ControlParticle</a> *cp = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(cppi);
<a name="l00652"></a>00652             <span class="keywordflow">if</span>(cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>&lt;=0.) <span class="keywordflow">continue</span>;
<a name="l00653"></a>00653             <span class="keyword">const</span> <span class="keywordtype">int</span> cpi = (int)( (cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a>[0]-goffx)/gsx );
<a name="l00654"></a>00654             <span class="keyword">const</span> <span class="keywordtype">int</span> cpj = (int)( (cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a>[1]-goffy)/gsy );
<a name="l00655"></a>00655             <span class="keywordtype">int</span>       cpk = (int)( (cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a>[2]-goffz)/gsz );
<a name="l00656"></a>00656             <span class="comment">/*if( ((LBMDIM==3)&amp;&amp;(BOUNDSKIP(cpk - cpwsm, getForZMinBnd(), getForZMaxBnd(lev) ))) ||</span>
<a name="l00657"></a>00657 <span class="comment">                ((LBMDIM==3)&amp;&amp;(BOUNDSKIP(cpk + cpwsm, getForZMinBnd(), getForZMaxBnd(lev) ))) ||</span>
<a name="l00658"></a>00658 <span class="comment">                BOUNDSKIP(cpj - cpwsm, 0, mLevel[lev].lSizey ) ||</span>
<a name="l00659"></a>00659 <span class="comment">                BOUNDSKIP(cpj + cpwsm, 0, mLevel[lev].lSizey ) ||</span>
<a name="l00660"></a>00660 <span class="comment">                BOUNDSKIP(cpi - cpwsm, 0, mLevel[lev].lSizex ) ||</span>
<a name="l00661"></a>00661 <span class="comment">                BOUNDSKIP(cpi + cpwsm, 0, mLevel[lev].lSizex ) ) {</span>
<a name="l00662"></a>00662 <span class="comment">                continue;</span>
<a name="l00663"></a>00663 <span class="comment">                } // */</span>
<a name="l00664"></a>00664             <span class="keywordtype">int</span> is,ie,js,je,ks,ke;
<a name="l00665"></a>00665             ks = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpk - cpw, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev) );
<a name="l00666"></a>00666             ke = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpk + cpw, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev) );
<a name="l00667"></a>00667             js = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpj - cpw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey );
<a name="l00668"></a>00668             je = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpj + cpw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey );
<a name="l00669"></a>00669             is = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpi - cpw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex );
<a name="l00670"></a>00670             ie = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpi + cpw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex );
<a name="l00671"></a>00671             <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { cpk = 0; ks = 0; ke = 1; }
<a name="l00672"></a>00672             <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#ac96a064946848d65b3ad3c7257a75c81">CPODEBUG</a>) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;cppft&quot;</span>,<span class="stringliteral">&quot;i&quot;</span>&lt;&lt;cppi&lt;&lt;<span class="stringliteral">&quot; cpw&quot;</span>&lt;&lt;cpw&lt;&lt;<span class="stringliteral">&quot; gpos&quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(cpi,cpj,cpk)&lt;&lt;<span class="stringliteral">&quot;   i:&quot;</span>&lt;&lt;is&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ie&lt;&lt;<span class="stringliteral">&quot;   j:&quot;</span>&lt;&lt;js&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;je&lt;&lt;<span class="stringliteral">&quot;   k:&quot;</span>&lt;&lt;ks&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ke&lt;&lt;<span class="stringliteral">&quot; &quot;</span>); <span class="comment">// DEBUG</span>
<a name="l00673"></a>00673             cpInfs++;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= ks; k&lt;ke; ++k) {
<a name="l00676"></a>00676                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j= js; j&lt;je; ++j) {
<a name="l00677"></a>00677 
<a name="l00678"></a>00678                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> *pflag = &amp;<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev,is,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr);
<a name="l00679"></a>00679                     <a class="code" href="../../d3/df3/classControlForces.html">ControlForces</a> *kk = &amp;<a class="code" href="../../d6/d69/solver__control_8cpp.html#aa31d424996f1ec1426e9710bba279b51">KERN</a>( is-cpi+cpw, j-cpj+cpw, k-cpk+cpw);
<a name="l00680"></a>00680                     <a class="code" href="../../d3/df3/classControlForces.html">ControlForces</a> *ff = &amp;<a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev,is,j,k); 
<a name="l00681"></a>00681                     pflag--; kk--; ff--;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= is; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ie; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00684"></a>00684                         <span class="comment">// first cp loop (att,vel)</span>
<a name="l00685"></a>00685                         pflag++; kk++; ff++;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687                         <span class="comment">//add weight for bnd cells</span>
<a name="l00688"></a>00688                         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> pwforce = kk-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a0f4f0cd14db361c0f605f1b1e5e1c7bd">weightAtt</a>;
<a name="l00689"></a>00689                         <span class="comment">// control particle mod,</span>
<a name="l00690"></a>00690                         <span class="comment">// dont add multiple CFFluid fsgr boundaries</span>
<a name="l00691"></a>00691                         <span class="keywordflow">if</span>(lev==mMaxRefine) {
<a name="l00692"></a>00692                             <span class="comment">//if( ( ((*pflag)&amp;(CFFluid )) &amp;&amp; (lev==mMaxRefine) ) ||</span>
<a name="l00693"></a>00693                                     <span class="comment">//( ((*pflag)&amp;(CFGrNorm)) &amp;&amp; (lev &lt;mMaxRefine) ) ) {</span>
<a name="l00694"></a>00694                             <span class="keywordflow">if</span>((*pflag)&amp;(<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a359bbf2f03fcbbfe1436259e9c2b1f60">CFUnused</a>)) {
<a name="l00695"></a>00695                                 <span class="comment">// check not fromcoarse?</span>
<a name="l00696"></a>00696                                 cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aabc7306df21c2e02e3b5803523d75918">density</a> += levVolume* kk-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a0f4f0cd14db361c0f605f1b1e5e1c7bd">weightAtt</a>; <span class="comment">// old CFFluid</span>
<a name="l00697"></a>00697                             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( (*pflag) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#aefab053b4a918a159ca2b4399e31ed45">CFEmpty</a>) ) {  
<a name="l00698"></a>00698                                 cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aabc7306df21c2e02e3b5803523d75918">density</a> -= levVolume* 0.5; 
<a name="l00699"></a>00699                             } <span class="keywordflow">else</span> { <span class="comment">//if( ((*pflag) &amp; (CFBnd)) ) {  </span>
<a name="l00700"></a>00700                                 cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aabc7306df21c2e02e3b5803523d75918">density</a> -= levVolume* 0.2;  <span class="comment">// penalty</span>
<a name="l00701"></a>00701                             }
<a name="l00702"></a>00702                         } <span class="keywordflow">else</span> {
<a name="l00703"></a>00703                             <span class="comment">//if((*pflag)&amp;(CFGrNorm)) {</span>
<a name="l00704"></a>00704                                 <span class="comment">//cp-&gt;density += levVolume* kk-&gt;weightAtt; // old CFFluid</span>
<a name="l00705"></a>00705                             <span class="comment">//} </span>
<a name="l00706"></a>00706                         }
<a name="l00707"></a>00707                         <span class="comment">//else if(!((*pflag) &amp; (CFUnused)) ) {  cp-&gt;density -= levVolume* 0.2; } // penalty</span>
<a name="l00708"></a>00708 
<a name="l00709"></a>00709                         <span class="keywordflow">if</span>( (*pflag) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) )  <span class="comment">// RFLAG_check</span>
<a name="l00710"></a>00710                         {
<a name="l00711"></a>00711 
<a name="l00712"></a>00712                             cpChecks++;
<a name="l00713"></a>00713                             <span class="comment">//const LbmFloat pwforce = kk-&gt;weightAtt;</span>
<a name="l00714"></a>00714                             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> pwvel = kk-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a2006ed18b01eb20c4b3f1520c12cb990">weightVel</a>;
<a name="l00715"></a>00715                             <span class="keywordflow">if</span>((pwforce==0.)&amp;&amp;(pwvel==0.)) { <span class="keywordflow">continue</span>; }
<a name="l00716"></a>00716                             ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a0f4f0cd14db361c0f605f1b1e5e1c7bd">weightAtt</a> += 1e-6; <span class="comment">// for distance</span>
<a name="l00717"></a>00717 
<a name="l00718"></a>00718                             <span class="keywordflow">if</span>(pwforce&gt;0.) {
<a name="l00719"></a>00719                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a0f4f0cd14db361c0f605f1b1e5e1c7bd">weightAtt</a> += pwforce *cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a> *cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>;
<a name="l00720"></a>00720                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a35ca0496a8591c4e595c7cc47b7fabd4">forceAtt</a> += kk-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a35ca0496a8591c4e595c7cc47b7fabd4">forceAtt</a> *levForceScale *cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a> *cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                                 <span class="comment">// old fill handling here</span>
<a name="l00723"></a>00723                                 <span class="keyword">const</span> <span class="keywordtype">int</span> workSet =<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2a319f3ae16856311222713e342184bf" title="current set of dist funcs">setCurr</a>;
<a name="l00724"></a>00724                                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> ux=0., uy=0., uz=0.;
<a name="l00725"></a>00725                                 <a class="code" href="../../d1/d24/solver__class_8h.html#a05299a1574e06e5aea3e901ff62ffd62">FORDF1</a>{  
<a name="l00726"></a>00726                                     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> dfn = <a class="code" href="../../d1/d24/solver__class_8h.html#a3aeec4e6dbda7449abaa9eee19d86038">QCELL</a>(lev, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k, workSet, l);
<a name="l00727"></a>00727                                     ux  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]*dfn);
<a name="l00728"></a>00728                                     uy  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]*dfn); 
<a name="l00729"></a>00729                                     uz  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]*dfn); 
<a name="l00730"></a>00730                                 }
<a name="l00731"></a>00731                                 <span class="comment">// control particle mod</span>
<a name="l00732"></a>00732                                 cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a53cc043a89fb37d722cacd4a2cfd1bd5">avgVelWeight</a> += levVolume*pwforce;
<a name="l00733"></a>00733                                 cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a2b0f7016efd6c64bc13195fa560b6d9d">avgVelAcc</a> += <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>(ux,uy,uz) * levVolume*pwforce;
<a name="l00734"></a>00734                             }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736                             <span class="keywordflow">if</span>(pwvel&gt;0.) {
<a name="l00737"></a>00737                                 <span class="comment">// TODO make switch? vel.influence depends on density weight... </span>
<a name="l00738"></a>00738                                 <span class="comment">// (reduced lowering with 0.75 factor)</span>
<a name="l00739"></a>00739                                 pwvel *=  cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a> *(1.-0.75*cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a>);
<a name="l00740"></a>00740                                 <span class="comment">// control particle mod</span>
<a name="l00741"></a>00741                                 <span class="comment">// todo use Omega instead!?</span>
<a name="l00742"></a>00742                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a1a71744ca441e3d8d1e0583e116abce1">forceVel</a> += cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#ac36936d930c565c935f501383905da44">vel</a>*levVolume*pwvel * velLatticeScale; <span class="comment">// levVolume?</span>
<a name="l00743"></a>00743                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a2006ed18b01eb20c4b3f1520c12cb990">weightVel</a> += levVolume*pwvel; <span class="comment">// levVolume?</span>
<a name="l00744"></a>00744                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#ac432dc2220bf635236ebd7a9b16446a0">compAv</a> += cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a7995c568540d1527cc9db0fd149ed328">avgVel</a>*levVolume*pwvel; <span class="comment">// levVolume?</span>
<a name="l00745"></a>00745                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a1e715cfd689c183043b1cef025e175f0">compAvWeight</a> += levVolume*pwvel; <span class="comment">// levVolume?</span>
<a name="l00746"></a>00746                             }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748                             <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#ac96a064946848d65b3ad3c7257a75c81">CPODEBUG</a>) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;cppft&quot;</span>,<span class="stringliteral">&quot;i&quot;</span>&lt;&lt;cppi&lt;&lt;<span class="stringliteral">&quot; at &quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#a0f456e0c862e871578fb308924863566">PRINT_IJK</a>&lt;&lt;<span class="stringliteral">&quot; kern:&quot;</span>&lt;&lt;
<a name="l00749"></a>00749                                     <a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-cpi+cpw, j-cpj+cpw, k-cpk+cpw )
<a name="l00750"></a>00750                                     <span class="comment">//&lt;&lt;&quot; w:&quot;&lt;&lt;ff-&gt;weightAtt&lt;&lt;&quot; wa:&quot;</span>
<a name="l00751"></a>00751                                     <span class="comment">//&lt;&lt;PRINT_VEC( ff-&gt;forceAtt[0],ff-&gt;forceAtt[1],ff-&gt;forceAtt[2] )  </span>
<a name="l00752"></a>00752                                     <span class="comment">//&lt;&lt;&quot; v:&quot;&lt;&lt;ff-&gt;weightVel&lt;&lt;&quot; wv:&quot;</span>
<a name="l00753"></a>00753                                     <span class="comment">//&lt;&lt;PRINT_VEC( ff-&gt;forceVel[0],ff-&gt;forceVel[1],ff-&gt;forceVel[2] )  </span>
<a name="l00754"></a>00754                                     <span class="comment">//&lt;&lt;&quot; v:&quot;&lt;&lt;ff-&gt;maxDistance&lt;&lt;&quot; wv:&quot;</span>
<a name="l00755"></a>00755                                     <span class="comment">//&lt;&lt;PRINT_VEC( ff-&gt;forceMaxd[0],ff-&gt;forceMaxd[1],ff-&gt;forceMaxd[2] )  </span>
<a name="l00756"></a>00756                                     );
<a name="l00757"></a>00757                         } <span class="comment">// celltype</span>
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                     } <span class="comment">// ijk</span>
<a name="l00760"></a>00760                 } <span class="comment">// ijk</span>
<a name="l00761"></a>00761             } <span class="comment">// ijk</span>
<a name="l00762"></a>00762         } <span class="comment">// cpi, end first cp loop (att,vel)</span>
<a name="l00763"></a>00763         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;LbmFsgrSolver::handleCpdata&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Force cpgrid &quot;</span>&lt;&lt;cpssi&lt;&lt;<span class="stringliteral">&quot; generated checks:&quot;</span>&lt;&lt;cpChecks&lt;&lt;<span class="stringliteral">&quot; infs:&quot;</span>&lt;&lt;cpInfs ,9);
<a name="l00764"></a>00764     } <span class="comment">//cpssi</span>
<a name="l00765"></a>00765     } <span class="comment">// lev</span>
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     <span class="comment">// second loop</span>
<a name="l00768"></a>00768     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l00769"></a>00769         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> levVolume = 1.;
<a name="l00770"></a>00770         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> levForceScale = 1.;
<a name="l00771"></a>00771         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ll=lev; ll&lt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; ll++) {
<a name="l00772"></a>00772             <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==3) levVolume *= 8.;
<a name="l00773"></a>00773             <span class="keywordflow">else</span> levVolume *= 4.;
<a name="l00774"></a>00774             levForceScale *= 2.;
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776     <span class="comment">// prepare maxd forces</span>
<a name="l00777"></a>00777     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=0; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00778"></a>00778         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cparts = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780         <span class="comment">// WARNING copied from above!</span>
<a name="l00781"></a>00781         <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> velLatticeScale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aaca9039d0c72020bbce09424438ef972" title="size of a single lbm step in time units on this level">timestep</a>/<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a3ea2c717c0576c860d331e689b33bb12" title="node size on this level (geometric, in world coordinates, not simulation units!)">nodeSize</a>;
<a name="l00782"></a>00782         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gsx = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[0]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a7306ebbc57a4e2c200990ef22aa1e0a4" title="local storage of mSizes">lSizex</a>);
<a name="l00783"></a>00783         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gsy = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[1]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#aa5460f8e9efb833143af49b400370fdb">lSizey</a>);
<a name="l00784"></a>00784         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> gsz = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[2]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].<a class="code" href="../../d9/d23/classFsgrLevelData.html#a2991956e53ba783f0c875bc177ce74da">lSizez</a>);
<a name="l00785"></a>00785 <span class="preprocessor">#if LBMDIM==2</span>
<a name="l00786"></a>00786 <span class="preprocessor"></span>        gsz = gsx;
<a name="l00787"></a>00787 <span class="preprocessor">#endif</span>
<a name="l00788"></a>00788 <span class="preprocessor"></span>        <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> goffx = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0];
<a name="l00789"></a>00789         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> goffy = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1];
<a name="l00790"></a>00790         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> goffz = <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2];
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         <span class="comment">//const LbmFloat cpwIncFac = 2.0;</span>
<a name="l00793"></a>00793         <span class="keyword">const</span> <span class="keywordtype">int</span> mdw = <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#a74e75242132eaabbc1c512488a135926">MIN</a>( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex/2, <a class="code" href="../../d4/d22/BOP__CarveInterface_8cpp.html#aacc3ee1a7f283f8ef65cea31f4436a95">MAX</a>( (<span class="keywordtype">int</span>)( cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a6f1aab4fcb5c0a31354939bb22298c90">getRadiusMaxd</a>() /gsx) +1  , 2) ); <span class="comment">// wide kernel, md</span>
<a name="l00794"></a>00794         <span class="keyword">const</span> <span class="keywordtype">int</span> mdkarWidth = 2*mdw+1;
<a name="l00795"></a>00795         <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a336e10879ae37b79c46a5f4a394948c5">mMdKernel</a>.resize(mdkarWidth* mdkarWidth* mdkarWidth);
<a name="l00796"></a>00796         <a class="code" href="../../d2/d62/classControlParticle.html">ControlParticle</a> cpt; cpt.<a class="code" href="../../d2/d62/classControlParticle.html#af05bdac2f3d6fa3b7e58832fdb3d78e0">reset</a>();
<a name="l00797"></a>00797         cpt.<a class="code" href="../../d2/d62/classControlParticle.html#aabc7306df21c2e02e3b5803523d75918">density</a> = 0.5; cpt.<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a> = 0.5;
<a name="l00798"></a>00798         cpt.<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a> = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>( (gsx*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)mdw)+goffx, (gsy*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)mdw)+goffy, (gsz*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)mdw)+goffz );  <span class="comment">// optimize?</span>
<a name="l00799"></a>00799 <span class="preprocessor">#if LBMDIM==3</span>
<a name="l00800"></a>00800 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= 0; k&lt;mdkarWidth; ++k) {
<a name="l00801"></a>00801 <span class="preprocessor">#else // LBMDIM==3</span>
<a name="l00802"></a>00802 <span class="preprocessor"></span>        { <span class="keywordtype">int</span> k = mdw;
<a name="l00803"></a>00803 <span class="preprocessor">#endif </span>
<a name="l00804"></a>00804 <span class="preprocessor"></span>            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j= 0; j&lt;mdkarWidth; ++j) 
<a name="l00805"></a>00805                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;mdkarWidth; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00806"></a>00806                     <a class="code" href="../../d6/d69/solver__control_8cpp.html#aa14b1f389e5694fafe5bff02ebcdfaf6">MDKERN</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).resetForces();
<a name="l00807"></a>00807                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> pos = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>( (gsx*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)+goffx, (gsy*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)j)+goffy, (gsz*(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)k)+goffz );  <span class="comment">// optimize?</span>
<a name="l00808"></a>00808                     cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#aa121fa56f0a88de429650ce609a9cb40">calculateMaxdForce</a>( &amp;cpt, pos, &amp;<a class="code" href="../../d6/d69/solver__control_8cpp.html#aa14b1f389e5694fafe5bff02ebcdfaf6">MDKERN</a>(i,j,k)  );
<a name="l00809"></a>00809                 }
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812         <span class="comment">// second cpi loop, maxd forces</span>
<a name="l00813"></a>00813         <span class="keywordflow">if</span>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#aaa6e7e8e55efc17b069c7f7f1fb8274a">getInfluenceMaxdist</a>()&gt;0.) {
<a name="l00814"></a>00814             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cppi=0; cppi&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a849bffbb32b8334479f1b69e203cc070">getSize</a>(); cppi++) {
<a name="l00815"></a>00815                 <a class="code" href="../../d2/d62/classControlParticle.html">ControlParticle</a> *cp = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(cppi);
<a name="l00816"></a>00816                 <span class="keywordflow">if</span>(cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>&lt;=0.) <span class="keywordflow">continue</span>;
<a name="l00817"></a>00817                 <span class="keyword">const</span> <span class="keywordtype">int</span> cpi = (int)( (cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a>[0]-goffx)/gsx );
<a name="l00818"></a>00818                 <span class="keyword">const</span> <span class="keywordtype">int</span> cpj = (int)( (cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a>[1]-goffy)/gsy );
<a name="l00819"></a>00819                 <span class="keywordtype">int</span>       cpk = (int)( (cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a>[2]-goffz)/gsz );
<a name="l00820"></a>00820 
<a name="l00821"></a>00821                 <span class="keywordtype">int</span> is,ie,js,je,ks,ke;
<a name="l00822"></a>00822                 ks = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpk - mdw, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev) );
<a name="l00823"></a>00823                 ke = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpk + mdw, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a662c0e7378bddab9a202250ac12bae1e" title="minimal and maximal z-coords (for 2D/3D loops)">getForZMinBnd</a>(), <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a7aecdeb42f9015acd750c73c594ea71f">getForZMaxBnd</a>(lev) );
<a name="l00824"></a>00824                 js = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpj - mdw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey );
<a name="l00825"></a>00825                 je = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpj + mdw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey );
<a name="l00826"></a>00826                 is = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpi - mdw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex );
<a name="l00827"></a>00827                 ie = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a9cdd037313a0e8a9e7fe92bece498770">BOUNDCHECK</a>(cpi + mdw, 0, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex );
<a name="l00828"></a>00828                 <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) { cpk = 0; ks = 0; ke = 1; }
<a name="l00829"></a>00829                 <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#ac96a064946848d65b3ad3c7257a75c81">CPODEBUG</a>) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;cppft&quot;</span>,<span class="stringliteral">&quot;i&quot;</span>&lt;&lt;cppi&lt;&lt;<span class="stringliteral">&quot; mdw&quot;</span>&lt;&lt;mdw&lt;&lt;<span class="stringliteral">&quot; gpos&quot;</span>&lt;&lt;<a class="code" href="../../de/df0/utilities_8h.html#aa1f5d23ceba93fcb09cf2c2258fb3ba5">PRINT_VEC</a>(cpi,cpj,cpk)&lt;&lt;<span class="stringliteral">&quot;   i:&quot;</span>&lt;&lt;is&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ie&lt;&lt;<span class="stringliteral">&quot;   j:&quot;</span>&lt;&lt;js&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;je&lt;&lt;<span class="stringliteral">&quot;   k:&quot;</span>&lt;&lt;ks&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;ke&lt;&lt;<span class="stringliteral">&quot; &quot;</span>); <span class="comment">// DEBUG</span>
<a name="l00830"></a>00830                 cpInfs++;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k= ks; k&lt;ke; ++k)
<a name="l00833"></a>00833                  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j= js; j&lt;je; ++j) {
<a name="l00834"></a>00834                     <a class="code" href="../../d2/d3c/solver__interface_8h.html#a94930675ea85a64cef414f52b22917ff">CellFlagType</a> *pflag = &amp;<a class="code" href="../../d1/d24/solver__class_8h.html#a571a0a03caf939a34bc8af115d2d4ba0">RFLAG</a>(lev,is-1,j,k, <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].setCurr);
<a name="l00835"></a>00835                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= is; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;ie; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00836"></a>00836                         <span class="comment">// second cpi loop, maxd forces</span>
<a name="l00837"></a>00837                         pflag++;
<a name="l00838"></a>00838                         <span class="keywordflow">if</span>( (*pflag) &amp; (<a class="code" href="../../d2/d3c/solver__interface_8h.html#a6b2692d470fe364a1d108e6264e3a842">CFFluid</a>|<a class="code" href="../../d2/d3c/solver__interface_8h.html#a8029ef4adefaa697c111eddcd5793f99">CFInter</a>) )  <span class="comment">// RFLAG_check</span>
<a name="l00839"></a>00839                         {
<a name="l00840"></a>00840                             cpChecks++;
<a name="l00841"></a>00841                             <a class="code" href="../../d3/df3/classControlForces.html">ControlForces</a> *ff = &amp;<a class="code" href="../../d1/d7f/solver__control_8h.html#a8efabb51b0170ba23bbf0fc6ef378311">LBMGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k); 
<a name="l00842"></a>00842                             <span class="keywordflow">if</span>(ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a0f4f0cd14db361c0f605f1b1e5e1c7bd">weightAtt</a> == 0.) {
<a name="l00843"></a>00843                                 <a class="code" href="../../d3/df3/classControlForces.html">ControlForces</a> *kk = &amp;<a class="code" href="../../d6/d69/solver__control_8cpp.html#aa14b1f389e5694fafe5bff02ebcdfaf6">MDKERN</a>( <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-cpi+mdw, j-cpj+mdw, k-cpk+mdw);
<a name="l00844"></a>00844                                 <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> pmdf = kk-&gt;<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a>;
<a name="l00845"></a>00845                                 <span class="keywordflow">if</span>((ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a> &gt; pmdf) || (ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a>&lt;0.))
<a name="l00846"></a>00846                                     ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#aeb01060c327c6fde3474b1c28658cd37">maxDistance</a> = pmdf;
<a name="l00847"></a>00847                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a2bf1d96d688618842b04fe7c86d1fb44">forceMaxd</a> = kk-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a2bf1d96d688618842b04fe7c86d1fb44">forceMaxd</a>;
<a name="l00848"></a>00848                                 <span class="comment">// todo use Omega instead!?</span>
<a name="l00849"></a>00849                                 ff-&gt;<a class="code" href="../../d3/df3/classControlForces.html#a1a71744ca441e3d8d1e0583e116abce1">forceVel</a> = cp-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#ac36936d930c565c935f501383905da44">vel</a>* velLatticeScale;
<a name="l00850"></a>00850                             }
<a name="l00851"></a>00851                         } <span class="comment">// celltype</span>
<a name="l00852"></a>00852                 } } <span class="comment">// ijk</span>
<a name="l00853"></a>00853             } <span class="comment">// cpi, md loop </span>
<a name="l00854"></a>00854         } <span class="comment">// maxd inf&gt;0 */</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856 
<a name="l00857"></a>00857         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::initControl&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Maxd cpgrid &quot;</span>&lt;&lt;cpssi&lt;&lt;<span class="stringliteral">&quot; generated checks:&quot;</span>&lt;&lt;cpChecks&lt;&lt;<span class="stringliteral">&quot; infs:&quot;</span>&lt;&lt;cpInfs ,9);
<a name="l00858"></a>00858     } <span class="comment">//cpssi</span>
<a name="l00859"></a>00859 
<a name="l00860"></a>00860     <span class="comment">// normalize, only done once for the whole array</span>
<a name="l00861"></a>00861     <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[0]-&gt;mCparts-&gt;finishControl( <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a8ce49bb4dc21d91d486ba4688d5564e0">mCpForces</a>[lev], iatt,ivel,imaxd );
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     } <span class="comment">// lev loop</span>
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> cpend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>(); 
<a name="l00866"></a>00866     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ControlData::handleCpdata&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Time for cpgrid generation:&quot;</span>&lt;&lt; <a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(cpend-cpstart)&lt;&lt;<span class="stringliteral">&quot;, checks:&quot;</span>&lt;&lt;cpChecks&lt;&lt;<span class="stringliteral">&quot; infs:&quot;</span>&lt;&lt;cpInfs&lt;&lt;<span class="stringliteral">&quot; &quot;</span> ,8);
<a name="l00867"></a>00867 
<a name="l00868"></a>00868     <span class="comment">// warning, may return  before</span>
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 <span class="preprocessor">#if LBM_USE_GUI==1</span>
<a name="l00872"></a>00872 <span class="preprocessor"></span>
<a name="l00873"></a><a class="code" href="../../d6/d69/solver__control_8cpp.html#a089e18d42628102e63489ad89318ab8c">00873</a> <span class="preprocessor">#define USE_GLUTILITIES</span>
<a name="l00874"></a>00874 <span class="preprocessor"></span><span class="preprocessor">#include &quot;../gui/gui_utilities.h&quot;</span>
<a name="l00875"></a>00875 
<a name="l00876"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5c1fac94e19f15f600900696963f2bb3">00876</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5c1fac94e19f15f600900696963f2bb3">LbmFsgrSolver::cpDebugDisplay</a>(<span class="keywordtype">int</span> dispset)
<a name="l00877"></a>00877 {
<a name="l00878"></a>00878     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> cpssi=0; cpssi&lt;(int)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>.size(); cpssi++) {
<a name="l00879"></a>00879         <a class="code" href="../../d1/d69/classControlParticles.html">ControlParticles</a> *cparts = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a15c75c41e59002140f86499683bf1f01">mCons</a>[cpssi]-&gt;mCparts;
<a name="l00880"></a>00880         <span class="comment">//ControlParticles *cpmotion = mpControl-&gt;mCons[cpssi]-&gt;mCpmotion;</span>
<a name="l00881"></a>00881         <span class="comment">// display cp parts</span>
<a name="l00882"></a>00882         <span class="keyword">const</span> <span class="keywordtype">bool</span> cpCubes = <span class="keyword">false</span>;
<a name="l00883"></a>00883         <span class="keyword">const</span> <span class="keywordtype">bool</span> cpDots = <span class="keyword">true</span>;
<a name="l00884"></a>00884         <span class="keyword">const</span> <span class="keywordtype">bool</span> cpCpdist = <span class="keyword">true</span>;
<a name="l00885"></a>00885         <span class="keyword">const</span> <span class="keywordtype">bool</span> cpHideIna = <span class="keyword">true</span>;
<a name="l00886"></a>00886         glShadeModel(GL_FLAT);
<a name="l00887"></a>00887         glDisable( GL_LIGHTING ); <span class="comment">// dont light lines</span>
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="comment">// dot influence</span>
<a name="l00890"></a>00890         <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a>&gt;0.) &amp;&amp; cpDots) {
<a name="l00891"></a>00891             glPointSize(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a> * 8.);
<a name="l00892"></a>00892             glBegin(GL_POINTS);
<a name="l00893"></a>00893             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a849bffbb32b8334479f1b69e203cc070">getSize</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00894"></a>00894                 <span class="keywordflow">if</span>((cpHideIna)&amp;&amp;( (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>&lt;=0.) || (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#ad3df056f0eee2e1d6677238a3939cfa6">size</a>&lt;=0.) )) <span class="keywordflow">continue</span>;
<a name="l00895"></a>00895                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> org( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a> ) );
<a name="l00896"></a>00896                 <span class="comment">//LbmFloat halfsize = 0.5; </span>
<a name="l00897"></a>00897                 <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> scale = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a>;
<a name="l00898"></a>00898                 <span class="comment">//glColor4f( scale,scale,scale,scale );</span>
<a name="l00899"></a>00899                 glColor4f( 0.,scale,0.,scale );
<a name="l00900"></a>00900                 glVertex3f( org[0],org[1],org[2] );
<a name="l00901"></a>00901                 <span class="comment">//errMsg(&quot;lbmDebugDisplay&quot;,&quot;CP &quot;&lt;&lt;i&lt;&lt;&quot; at &quot;&lt;&lt;org); // DEBUG</span>
<a name="l00902"></a>00902             }
<a name="l00903"></a>00903             glEnd();
<a name="l00904"></a>00904         }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906         <span class="comment">// cp positions</span>
<a name="l00907"></a>00907         <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a>&gt;0.) &amp;&amp; cpDots) {
<a name="l00908"></a>00908             glPointSize(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a> * 3.);
<a name="l00909"></a>00909             glBegin(GL_POINTS); 
<a name="l00910"></a>00910             glColor3f( 0,1,0 );
<a name="l00911"></a>00911         }
<a name="l00912"></a>00912         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a849bffbb32b8334479f1b69e203cc070">getSize</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00913"></a>00913             <span class="keywordflow">if</span>((cpHideIna)&amp;&amp;( (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>&lt;=0.) || (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#ad3df056f0eee2e1d6677238a3939cfa6">size</a>&lt;=0.) )) <span class="keywordflow">continue</span>;
<a name="l00914"></a>00914             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>  org( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a> ) );
<a name="l00915"></a>00915             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> halfsize = 0.5; 
<a name="l00916"></a>00916             <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> scale = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a8005725ebe117f1f36136f53de5528c5">getRadiusAtt</a>() * cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a603b51bc316beb652fce02aab496bd83">densityWeight</a>;
<a name="l00917"></a>00917             <span class="keywordflow">if</span>(cpCubes){    glLineWidth( 1 ); 
<a name="l00918"></a>00918                 glColor3f( 1,1,1 );
<a name="l00919"></a>00919                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> s = org-(halfsize * (scale)); 
<a name="l00920"></a>00920                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> e = org+(halfsize * (scale)); 
<a name="l00921"></a>00921                 drawCubeWire( s,e ); }
<a name="l00922"></a>00922             <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a4f8b950ae6e0226befbcad82cbed633f">mDebugCpscale</a>&gt;0.) &amp;&amp; cpDots) {
<a name="l00923"></a>00923                 glVertex3f( org[0],org[1],org[2] );
<a name="l00924"></a>00924             }
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926         <span class="keywordflow">if</span>(cpDots) glEnd();
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6d5217f404b79561ecdf48bab6717910">mDebugAvgVelScale</a>&gt;0.) {
<a name="l00929"></a>00929             <span class="keyword">const</span> <span class="keywordtype">float</span> scale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a6d5217f404b79561ecdf48bab6717910">mDebugAvgVelScale</a>;
<a name="l00930"></a>00930 
<a name="l00931"></a>00931             glColor3f( 1.0,1.0,1 );
<a name="l00932"></a>00932             glBegin(GL_LINES); 
<a name="l00933"></a>00933             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a849bffbb32b8334479f1b69e203cc070">getSize</a>(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00934"></a>00934                 <span class="keywordflow">if</span>((cpHideIna)&amp;&amp;( (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a107a4dd3a1ffce8b570ddcd442ea165a">influence</a>&lt;=0.) || (cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#ad3df056f0eee2e1d6677238a3939cfa6">size</a>&lt;=0.) )) <span class="keywordflow">continue</span>;
<a name="l00935"></a>00935                 <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a>  org( <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a48aeab97832e3c8fa0186de7019ef1f1">vec2G</a>(cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#aaa90a9f57c26b88edde98bd6f9595c1c">pos</a> ) );
<a name="l00936"></a>00936 
<a name="l00937"></a>00937                 <span class="comment">//errMsg(&quot;CPAVGVEL&quot;,&quot;i&quot;&lt;&lt;i&lt;&lt;&quot; pos&quot;&lt;&lt;org&lt;&lt;&quot; av&quot;&lt;&lt;cparts-&gt;getParticle(i)-&gt;avgVel);// DEBUG</span>
<a name="l00938"></a>00938                 <span class="keywordtype">float</span> dx = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a7995c568540d1527cc9db0fd149ed328">avgVel</a>[0];
<a name="l00939"></a>00939                 <span class="keywordtype">float</span> dy = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a7995c568540d1527cc9db0fd149ed328">avgVel</a>[1];
<a name="l00940"></a>00940                 <span class="keywordtype">float</span> dz = cparts-&gt;<a class="code" href="../../d1/d69/classControlParticles.html#a307e5b5663ccefab51be796189939262">getParticle</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="../../d2/d62/classControlParticle.html#a7995c568540d1527cc9db0fd149ed328">avgVel</a>[2];
<a name="l00941"></a>00941                 dx *= scale; dy *= scale; dz *= scale;
<a name="l00942"></a>00942                 glVertex3f( org[0],org[1],org[2] );
<a name="l00943"></a>00943                 glVertex3f( org[0]+dx,org[1]+dy,org[2]+dz );
<a name="l00944"></a>00944             }
<a name="l00945"></a>00945             glEnd();
<a name="l00946"></a>00946         } <span class="comment">// */</span>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948         <span class="keywordflow">if</span>( (<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) &amp;&amp; (cpCpdist) ) {
<a name="l00949"></a>00949             
<a name="l00950"></a>00950             <span class="comment">// debug, for use of e.g. LBMGET_FORCE LbmControlData *mpControl = this;</span>
<a name="l00951"></a>00951 <span class="preprocessor">#           define TESTGET_FORCE(lev,i,j,k)   mpControl-&gt;mCpForces[lev][ ((k*mLevel[lev].lSizey)+j)*mLevel[lev].lSizex+i ]</span>
<a name="l00952"></a>00952 <span class="preprocessor"></span>    
<a name="l00953"></a>00953             glBegin(GL_LINES);
<a name="l00954"></a>00954             <span class="comment">//const int lev=0; </span>
<a name="l00955"></a>00955             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> lev=0; lev&lt;=<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a475ab55b6567ca5902bb1c78aa629c8d">mMaxRefine</a>; lev++) {
<a name="l00956"></a>00956             <a class="code" href="../../d1/d24/solver__class_8h.html#a809f84de6a5afc68c78eedc2bd37e498">FSGR_FORIJK_BOUNDS</a>(lev) {
<a name="l00957"></a>00957                     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> pos = <a class="code" href="../../d2/d3c/solver__interface_8h.html#abde65d221fe8c68b1ec7abebb43726f5">LbmVec</a>( 
<a name="l00958"></a>00958                         ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[0]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizex) * ((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0.5) + <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[0], 
<a name="l00959"></a>00959                         ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[1]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizey) * ((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)j+0.5) + <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[1], 
<a name="l00960"></a>00960                         ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[2]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2])/(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a3fc2f0553686b535f6fd876e2906aa49">mLevel</a>[lev].lSizez) * ((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a>)k+0.5) + <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2]  );
<a name="l00961"></a>00961                     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>==2) pos[2] = ((<a class="code" href="../../db/dff/classLbmSolverInterface.html#a3abe44a4441918893c286b51b06ce67f">mvGeoEnd</a>[2]-<a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2])*0.5 + <a class="code" href="../../db/dff/classLbmSolverInterface.html#a5cb208d7cbef7bb21e60e226eda52629">mvGeoStart</a>[2]);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a46a003c30c613e476cae9e57103090e6">mDebugMaxdScale</a>&gt;0.) &amp;&amp; (<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).weightAtt&lt;=0.) )
<a name="l00964"></a>00964                     <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).maxDistance&gt;=0.) 
<a name="l00965"></a>00965                     <span class="keywordflow">if</span>(<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).maxDistance&lt;<a class="code" href="../../d0/d7c/controlparticles_8h.html#a1eae1139b03b1d873ad7f9e25592cc03">CPF_MAXDINIT</a> ) {
<a name="l00966"></a>00966                         <span class="keyword">const</span> <span class="keywordtype">float</span> scale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a46a003c30c613e476cae9e57103090e6">mDebugMaxdScale</a>*10001.;
<a name="l00967"></a>00967                         <span class="keywordtype">float</span> dx = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceMaxd[0];
<a name="l00968"></a>00968                         <span class="keywordtype">float</span> dy = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceMaxd[1];
<a name="l00969"></a>00969                         <span class="keywordtype">float</span> dz = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceMaxd[2];
<a name="l00970"></a>00970                         dx *= scale; dy *= scale; dz *= scale;
<a name="l00971"></a>00971                         glColor3f( 0,1,0 );
<a name="l00972"></a>00972                         glVertex3f( pos[0],pos[1],pos[2] );
<a name="l00973"></a>00973                         glVertex3f( pos[0]+dx,pos[1]+dy,pos[2]+dz );
<a name="l00974"></a>00974                     } <span class="comment">// */</span>
<a name="l00975"></a>00975                     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a40021b4667f034af47f5ea980a612711">mDebugAttScale</a>&gt;0.) &amp;&amp; (<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).weightAtt&gt;0.)) {
<a name="l00976"></a>00976                         <span class="keyword">const</span> <span class="keywordtype">float</span> scale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#a40021b4667f034af47f5ea980a612711">mDebugAttScale</a>*100011.;
<a name="l00977"></a>00977                         <span class="keywordtype">float</span> dx = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceAtt[0];
<a name="l00978"></a>00978                         <span class="keywordtype">float</span> dy = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceAtt[1];
<a name="l00979"></a>00979                         <span class="keywordtype">float</span> dz = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceAtt[2];
<a name="l00980"></a>00980                         dx *= scale; dy *= scale; dz *= scale;
<a name="l00981"></a>00981                         glColor3f( 1,0,0 );
<a name="l00982"></a>00982                         glVertex3f( pos[0],pos[1],pos[2] );
<a name="l00983"></a>00983                         glVertex3f( pos[0]+dx,pos[1]+dy,pos[2]+dz );
<a name="l00984"></a>00984                     } <span class="comment">// */</span>
<a name="l00985"></a>00985                     <span class="comment">// why check maxDistance?</span>
<a name="l00986"></a>00986                     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#afd94679948a0f636968f6759f6c91967">mDebugVelScale</a>&gt;0.) &amp;&amp; (<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).maxDistance+<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).weightVel&gt;0.)) {
<a name="l00987"></a>00987                         <span class="keywordtype">float</span> scale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#afd94679948a0f636968f6759f6c91967">mDebugVelScale</a>*1.;
<a name="l00988"></a>00988                         <span class="keywordtype">float</span> wvscale = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).weightVel;
<a name="l00989"></a>00989                         <span class="keywordtype">float</span> dx = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceVel[0];
<a name="l00990"></a>00990                         <span class="keywordtype">float</span> dy = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceVel[1];
<a name="l00991"></a>00991                         <span class="keywordtype">float</span> dz = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).forceVel[2];
<a name="l00992"></a>00992                         scale *= wvscale;
<a name="l00993"></a>00993                         dx *= scale; dy *= scale; dz *= scale;
<a name="l00994"></a>00994                         glColor3f( 0.2,0.2,1 );
<a name="l00995"></a>00995                         glVertex3f( pos[0],pos[1],pos[2] );
<a name="l00996"></a>00996                         glVertex3f( pos[0]+dx,pos[1]+dy,pos[2]+dz );
<a name="l00997"></a>00997                     } <span class="comment">// */</span>
<a name="l00998"></a>00998                     <span class="keywordflow">if</span>((<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#ae3c38ab0d8e08c367f33579f108963cc">mDebugCompavScale</a>&gt;0.) &amp;&amp; (<a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).compAvWeight&gt;0.)) {
<a name="l00999"></a>00999                         <span class="keyword">const</span> <span class="keywordtype">float</span> scale = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ad8940f9a94eea25287e1a031d877c8b7">mpControl</a>-&gt;<a class="code" href="../../d3/de0/classLbmControlData.html#ae3c38ab0d8e08c367f33579f108963cc">mDebugCompavScale</a>*1.;
<a name="l01000"></a>01000                         <span class="keywordtype">float</span> dx = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).compAv[0];
<a name="l01001"></a>01001                         <span class="keywordtype">float</span> dy = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).compAv[1];
<a name="l01002"></a>01002                         <span class="keywordtype">float</span> dz = <a class="code" href="../../d6/d69/solver__control_8cpp.html#a52f3996487c7f09ad4679c4b281a9cc8">TESTGET_FORCE</a>(lev,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>,j,k).compAv[2];
<a name="l01003"></a>01003                         dx *= scale; dy *= scale; dz *= scale;
<a name="l01004"></a>01004                         glColor3f( 0.2,0.2,1 );
<a name="l01005"></a>01005                         glVertex3f( pos[0],pos[1],pos[2] );
<a name="l01006"></a>01006                         glVertex3f( pos[0]+dx,pos[1]+dy,pos[2]+dz );
<a name="l01007"></a>01007                     } <span class="comment">// */</span>
<a name="l01008"></a>01008             } <span class="comment">// att,maxd</span>
<a name="l01009"></a>01009             }
<a name="l01010"></a>01010             glEnd();
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012     } <span class="comment">// cpssi</span>
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     <span class="comment">//fprintf(stderr,&quot;BLA\n&quot;);</span>
<a name="l01015"></a>01015     glEnable( GL_LIGHTING ); <span class="comment">// dont light lines</span>
<a name="l01016"></a>01016     glShadeModel(GL_SMOOTH);
<a name="l01017"></a>01017 }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 <span class="preprocessor">#else // LBM_USE_GUI==1</span>
<a name="l01020"></a>01020 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a5c1fac94e19f15f600900696963f2bb3">LbmFsgrSolver::cpDebugDisplay</a>(<span class="keywordtype">int</span> dispset) { }
<a name="l01021"></a>01021 <span class="preprocessor">#endif // LBM_USE_GUI==1</span>
<a name="l01022"></a>01022 <span class="preprocessor"></span>
<a name="l01023"></a>01023 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:55 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>
